webpackJsonp([1],{

/***/ 1002:
/***/ function(module, exports, __webpack_require__) {

"use strict";
eval("\"use strict\";\r\nvar router_1 = __webpack_require__(100);\r\nvar signup_component_1 = __webpack_require__(992);\r\nvar login_component_1 = __webpack_require__(991);\r\nvar auth_component_1 = __webpack_require__(990);\r\nvar auth_routes = [\r\n    { path: '', component: auth_component_1.AuthComponent, children: [\r\n            { path: 'login', component: login_component_1.LoginComponent },\r\n            { path: 'signup', component: signup_component_1.SignupComponent }\r\n        ] }\r\n];\r\nexports.authRouting = router_1.RouterModule.forChild(auth_routes);\r\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTAwMi5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL2Fzc2V0cy9hcHAvYXV0aC9hdXRoLnJvdXRpbmcudHM/NGFlYSJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcclxudmFyIHJvdXRlcl8xID0gcmVxdWlyZShcIkBhbmd1bGFyL3JvdXRlclwiKTtcclxudmFyIHNpZ251cF9jb21wb25lbnRfMSA9IHJlcXVpcmUoXCIuL3NpZ251cC5jb21wb25lbnRcIik7XHJcbnZhciBsb2dpbl9jb21wb25lbnRfMSA9IHJlcXVpcmUoXCIuL2xvZ2luLmNvbXBvbmVudFwiKTtcclxudmFyIGF1dGhfY29tcG9uZW50XzEgPSByZXF1aXJlKFwiLi9hdXRoLmNvbXBvbmVudFwiKTtcclxudmFyIGF1dGhfcm91dGVzID0gW1xyXG4gICAgeyBwYXRoOiAnJywgY29tcG9uZW50OiBhdXRoX2NvbXBvbmVudF8xLkF1dGhDb21wb25lbnQsIGNoaWxkcmVuOiBbXHJcbiAgICAgICAgICAgIHsgcGF0aDogJ2xvZ2luJywgY29tcG9uZW50OiBsb2dpbl9jb21wb25lbnRfMS5Mb2dpbkNvbXBvbmVudCB9LFxyXG4gICAgICAgICAgICB7IHBhdGg6ICdzaWdudXAnLCBjb21wb25lbnQ6IHNpZ251cF9jb21wb25lbnRfMS5TaWdudXBDb21wb25lbnQgfVxyXG4gICAgICAgIF0gfVxyXG5dO1xyXG5leHBvcnRzLmF1dGhSb3V0aW5nID0gcm91dGVyXzEuUm91dGVyTW9kdWxlLmZvckNoaWxkKGF1dGhfcm91dGVzKTtcclxuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9hc3NldHMvYXBwL2F1dGgvYXV0aC5yb3V0aW5nLnRzXG4vLyBtb2R1bGUgaWQgPSAxMDAyXG4vLyBtb2R1bGUgY2h1bmtzID0gMSJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ },

/***/ 1036:
/***/ function(module, exports) {

eval("module.exports = \"<div class=\\\"container\\\">\\r\\n    <router-outlet></router-outlet>\\r\\n</div>\";//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTAzNi5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL2Fzc2V0cy9hcHAvYXV0aC9hdXRoLmNvbXBvbmVudC5odG1sP2VjOTMiXSwic291cmNlc0NvbnRlbnQiOlsibW9kdWxlLmV4cG9ydHMgPSBcIjxkaXYgY2xhc3M9XFxcImNvbnRhaW5lclxcXCI+XFxyXFxuICAgIDxyb3V0ZXItb3V0bGV0Pjwvcm91dGVyLW91dGxldD5cXHJcXG48L2Rpdj5cIjtcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL2Fzc2V0cy9hcHAvYXV0aC9hdXRoLmNvbXBvbmVudC5odG1sXG4vLyBtb2R1bGUgaWQgPSAxMDM2XG4vLyBtb2R1bGUgY2h1bmtzID0gMSJdLCJtYXBwaW5ncyI6IkFBQUEiLCJzb3VyY2VSb290IjoiIn0=");

/***/ },

/***/ 1037:
/***/ function(module, exports) {

eval("module.exports = \"<div class=\\\"card centered\\\">\\r\\n    <div class=\\\"card-title\\\">Login</div>\\r\\n    <dip-error></dip-error>\\r\\n    <form class=\\\"top10\\\" [formGroup]=\\\"loginForm\\\" (ngSubmit)=\\\"onSubmit()\\\">\\r\\n        <div class=\\\"input-field\\\">\\r\\n            <input type=\\\"email\\\"\\r\\n                   id=\\\"email\\\"\\r\\n                   name=\\\"email\\\"\\r\\n                   formControlName=\\\"email\\\"\\r\\n                   #email\\r\\n                   [class.active]=\\\"email.value\\\">\\r\\n            <label for=\\\"email\\\">Email</label>\\r\\n        </div>\\r\\n        <div class=\\\"input-field\\\">\\r\\n            <input type=\\\"password\\\"\\r\\n                   id=\\\"password\\\"\\r\\n                   name=\\\"password\\\"\\r\\n                   formControlName=\\\"password\\\"\\r\\n                   #password\\r\\n                   style=\\\"width: 100%\\\"\\r\\n                   [class.active]=\\\"password.value\\\">\\r\\n            <label for=\\\"password\\\">Password</label>\\r\\n        </div>\\r\\n        <button class=\\\"button top20\\\"\\r\\n                type=\\\"submit\\\"\\r\\n                [disabled]=\\\"!loginForm.valid\\\">\\r\\n            Login\\r\\n        </button>\\r\\n    </form>\\r\\n</div>\\r\\n\\r\\n\";//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTAzNy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL2Fzc2V0cy9hcHAvYXV0aC9sb2dpbi5jb21wb25lbnQuaHRtbD9iYzExIl0sInNvdXJjZXNDb250ZW50IjpbIm1vZHVsZS5leHBvcnRzID0gXCI8ZGl2IGNsYXNzPVxcXCJjYXJkIGNlbnRlcmVkXFxcIj5cXHJcXG4gICAgPGRpdiBjbGFzcz1cXFwiY2FyZC10aXRsZVxcXCI+TG9naW48L2Rpdj5cXHJcXG4gICAgPGRpcC1lcnJvcj48L2RpcC1lcnJvcj5cXHJcXG4gICAgPGZvcm0gY2xhc3M9XFxcInRvcDEwXFxcIiBbZm9ybUdyb3VwXT1cXFwibG9naW5Gb3JtXFxcIiAobmdTdWJtaXQpPVxcXCJvblN1Ym1pdCgpXFxcIj5cXHJcXG4gICAgICAgIDxkaXYgY2xhc3M9XFxcImlucHV0LWZpZWxkXFxcIj5cXHJcXG4gICAgICAgICAgICA8aW5wdXQgdHlwZT1cXFwiZW1haWxcXFwiXFxyXFxuICAgICAgICAgICAgICAgICAgIGlkPVxcXCJlbWFpbFxcXCJcXHJcXG4gICAgICAgICAgICAgICAgICAgbmFtZT1cXFwiZW1haWxcXFwiXFxyXFxuICAgICAgICAgICAgICAgICAgIGZvcm1Db250cm9sTmFtZT1cXFwiZW1haWxcXFwiXFxyXFxuICAgICAgICAgICAgICAgICAgICNlbWFpbFxcclxcbiAgICAgICAgICAgICAgICAgICBbY2xhc3MuYWN0aXZlXT1cXFwiZW1haWwudmFsdWVcXFwiPlxcclxcbiAgICAgICAgICAgIDxsYWJlbCBmb3I9XFxcImVtYWlsXFxcIj5FbWFpbDwvbGFiZWw+XFxyXFxuICAgICAgICA8L2Rpdj5cXHJcXG4gICAgICAgIDxkaXYgY2xhc3M9XFxcImlucHV0LWZpZWxkXFxcIj5cXHJcXG4gICAgICAgICAgICA8aW5wdXQgdHlwZT1cXFwicGFzc3dvcmRcXFwiXFxyXFxuICAgICAgICAgICAgICAgICAgIGlkPVxcXCJwYXNzd29yZFxcXCJcXHJcXG4gICAgICAgICAgICAgICAgICAgbmFtZT1cXFwicGFzc3dvcmRcXFwiXFxyXFxuICAgICAgICAgICAgICAgICAgIGZvcm1Db250cm9sTmFtZT1cXFwicGFzc3dvcmRcXFwiXFxyXFxuICAgICAgICAgICAgICAgICAgICNwYXNzd29yZFxcclxcbiAgICAgICAgICAgICAgICAgICBzdHlsZT1cXFwid2lkdGg6IDEwMCVcXFwiXFxyXFxuICAgICAgICAgICAgICAgICAgIFtjbGFzcy5hY3RpdmVdPVxcXCJwYXNzd29yZC52YWx1ZVxcXCI+XFxyXFxuICAgICAgICAgICAgPGxhYmVsIGZvcj1cXFwicGFzc3dvcmRcXFwiPlBhc3N3b3JkPC9sYWJlbD5cXHJcXG4gICAgICAgIDwvZGl2PlxcclxcbiAgICAgICAgPGJ1dHRvbiBjbGFzcz1cXFwiYnV0dG9uIHRvcDIwXFxcIlxcclxcbiAgICAgICAgICAgICAgICB0eXBlPVxcXCJzdWJtaXRcXFwiXFxyXFxuICAgICAgICAgICAgICAgIFtkaXNhYmxlZF09XFxcIiFsb2dpbkZvcm0udmFsaWRcXFwiPlxcclxcbiAgICAgICAgICAgIExvZ2luXFxyXFxuICAgICAgICA8L2J1dHRvbj5cXHJcXG4gICAgPC9mb3JtPlxcclxcbjwvZGl2PlxcclxcblxcclxcblwiO1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vYXNzZXRzL2FwcC9hdXRoL2xvZ2luLmNvbXBvbmVudC5odG1sXG4vLyBtb2R1bGUgaWQgPSAxMDM3XG4vLyBtb2R1bGUgY2h1bmtzID0gMSJdLCJtYXBwaW5ncyI6IkFBQUEiLCJzb3VyY2VSb290IjoiIn0=");

/***/ },

/***/ 1038:
/***/ function(module, exports) {

eval("module.exports = \"<div class=\\\"card centered\\\">\\r\\n    <div class=\\\"card-title\\\">Sign up</div>\\r\\n    <dip-error></dip-error>\\r\\n    <form class=\\\"top10\\\" [formGroup]=\\\"signUpForm\\\" (ngSubmit)=\\\"onSubmit()\\\">\\r\\n        <div class=\\\"input-field\\\">\\r\\n            <input type=\\\"text\\\"\\r\\n                   id=\\\"firstName\\\"\\r\\n                   name=\\\"firstName\\\"\\r\\n                   formControlName=\\\"firstName\\\"\\r\\n                   #fn\\r\\n                   [class.active]=\\\"fn.value\\\">\\r\\n            <label for=\\\"firstName\\\">First name</label>\\r\\n        </div>\\r\\n        <div class=\\\"input-field\\\">\\r\\n            <input type=\\\"text\\\"\\r\\n                   id=\\\"lastName\\\"\\r\\n                   name=\\\"lastName\\\"\\r\\n                   formControlName=\\\"lastName\\\"\\r\\n                   #ln\\r\\n                   [class.active]=\\\"ln.value\\\">\\r\\n            <label for=\\\"lastName\\\">Last name</label>\\r\\n        </div>\\r\\n        <div class=\\\"input-field\\\">\\r\\n            <input type=\\\"email\\\"\\r\\n                   id=\\\"email\\\"\\r\\n                   name=\\\"email\\\"\\r\\n                   formControlName=\\\"email\\\"\\r\\n                   #email\\r\\n                   [class.active]=\\\"email.value\\\">\\r\\n            <label for=\\\"email\\\">Email</label>\\r\\n        </div>\\r\\n        <div class=\\\"input-field\\\">\\r\\n            <input type=\\\"password\\\"\\r\\n                   id=\\\"password\\\"\\r\\n                   name=\\\"password\\\"\\r\\n                   formControlName=\\\"password\\\"\\r\\n                   #pass\\r\\n                   [class.active]=\\\"pass.value\\\">\\r\\n            <label for=\\\"password\\\">Password</label>\\r\\n        </div>\\r\\n        <div class=\\\"input-field\\\">\\r\\n            <input type=\\\"password\\\"\\r\\n                   id=\\\"confirmPassword\\\"\\r\\n                   name=\\\"confirmPassword\\\"\\r\\n                   formControlName=\\\"confirmPassword\\\"\\r\\n                   #confPass\\r\\n                   [class.active]=\\\"confPass.value\\\">\\r\\n            <label for=\\\"confirmPassword\\\">Confirm password</label>\\r\\n        </div>\\r\\n        <button class=\\\"button top20\\\"\\r\\n                type=\\\"submit\\\"\\r\\n                [disabled]=\\\"!signUpForm.valid\\\">\\r\\n            Sign up\\r\\n        </button>\\r\\n    </form>\\r\\n</div>\";//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTAzOC5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL2Fzc2V0cy9hcHAvYXV0aC9zaWdudXAuY29tcG9uZW50Lmh0bWw/YTkxOSJdLCJzb3VyY2VzQ29udGVudCI6WyJtb2R1bGUuZXhwb3J0cyA9IFwiPGRpdiBjbGFzcz1cXFwiY2FyZCBjZW50ZXJlZFxcXCI+XFxyXFxuICAgIDxkaXYgY2xhc3M9XFxcImNhcmQtdGl0bGVcXFwiPlNpZ24gdXA8L2Rpdj5cXHJcXG4gICAgPGRpcC1lcnJvcj48L2RpcC1lcnJvcj5cXHJcXG4gICAgPGZvcm0gY2xhc3M9XFxcInRvcDEwXFxcIiBbZm9ybUdyb3VwXT1cXFwic2lnblVwRm9ybVxcXCIgKG5nU3VibWl0KT1cXFwib25TdWJtaXQoKVxcXCI+XFxyXFxuICAgICAgICA8ZGl2IGNsYXNzPVxcXCJpbnB1dC1maWVsZFxcXCI+XFxyXFxuICAgICAgICAgICAgPGlucHV0IHR5cGU9XFxcInRleHRcXFwiXFxyXFxuICAgICAgICAgICAgICAgICAgIGlkPVxcXCJmaXJzdE5hbWVcXFwiXFxyXFxuICAgICAgICAgICAgICAgICAgIG5hbWU9XFxcImZpcnN0TmFtZVxcXCJcXHJcXG4gICAgICAgICAgICAgICAgICAgZm9ybUNvbnRyb2xOYW1lPVxcXCJmaXJzdE5hbWVcXFwiXFxyXFxuICAgICAgICAgICAgICAgICAgICNmblxcclxcbiAgICAgICAgICAgICAgICAgICBbY2xhc3MuYWN0aXZlXT1cXFwiZm4udmFsdWVcXFwiPlxcclxcbiAgICAgICAgICAgIDxsYWJlbCBmb3I9XFxcImZpcnN0TmFtZVxcXCI+Rmlyc3QgbmFtZTwvbGFiZWw+XFxyXFxuICAgICAgICA8L2Rpdj5cXHJcXG4gICAgICAgIDxkaXYgY2xhc3M9XFxcImlucHV0LWZpZWxkXFxcIj5cXHJcXG4gICAgICAgICAgICA8aW5wdXQgdHlwZT1cXFwidGV4dFxcXCJcXHJcXG4gICAgICAgICAgICAgICAgICAgaWQ9XFxcImxhc3ROYW1lXFxcIlxcclxcbiAgICAgICAgICAgICAgICAgICBuYW1lPVxcXCJsYXN0TmFtZVxcXCJcXHJcXG4gICAgICAgICAgICAgICAgICAgZm9ybUNvbnRyb2xOYW1lPVxcXCJsYXN0TmFtZVxcXCJcXHJcXG4gICAgICAgICAgICAgICAgICAgI2xuXFxyXFxuICAgICAgICAgICAgICAgICAgIFtjbGFzcy5hY3RpdmVdPVxcXCJsbi52YWx1ZVxcXCI+XFxyXFxuICAgICAgICAgICAgPGxhYmVsIGZvcj1cXFwibGFzdE5hbWVcXFwiPkxhc3QgbmFtZTwvbGFiZWw+XFxyXFxuICAgICAgICA8L2Rpdj5cXHJcXG4gICAgICAgIDxkaXYgY2xhc3M9XFxcImlucHV0LWZpZWxkXFxcIj5cXHJcXG4gICAgICAgICAgICA8aW5wdXQgdHlwZT1cXFwiZW1haWxcXFwiXFxyXFxuICAgICAgICAgICAgICAgICAgIGlkPVxcXCJlbWFpbFxcXCJcXHJcXG4gICAgICAgICAgICAgICAgICAgbmFtZT1cXFwiZW1haWxcXFwiXFxyXFxuICAgICAgICAgICAgICAgICAgIGZvcm1Db250cm9sTmFtZT1cXFwiZW1haWxcXFwiXFxyXFxuICAgICAgICAgICAgICAgICAgICNlbWFpbFxcclxcbiAgICAgICAgICAgICAgICAgICBbY2xhc3MuYWN0aXZlXT1cXFwiZW1haWwudmFsdWVcXFwiPlxcclxcbiAgICAgICAgICAgIDxsYWJlbCBmb3I9XFxcImVtYWlsXFxcIj5FbWFpbDwvbGFiZWw+XFxyXFxuICAgICAgICA8L2Rpdj5cXHJcXG4gICAgICAgIDxkaXYgY2xhc3M9XFxcImlucHV0LWZpZWxkXFxcIj5cXHJcXG4gICAgICAgICAgICA8aW5wdXQgdHlwZT1cXFwicGFzc3dvcmRcXFwiXFxyXFxuICAgICAgICAgICAgICAgICAgIGlkPVxcXCJwYXNzd29yZFxcXCJcXHJcXG4gICAgICAgICAgICAgICAgICAgbmFtZT1cXFwicGFzc3dvcmRcXFwiXFxyXFxuICAgICAgICAgICAgICAgICAgIGZvcm1Db250cm9sTmFtZT1cXFwicGFzc3dvcmRcXFwiXFxyXFxuICAgICAgICAgICAgICAgICAgICNwYXNzXFxyXFxuICAgICAgICAgICAgICAgICAgIFtjbGFzcy5hY3RpdmVdPVxcXCJwYXNzLnZhbHVlXFxcIj5cXHJcXG4gICAgICAgICAgICA8bGFiZWwgZm9yPVxcXCJwYXNzd29yZFxcXCI+UGFzc3dvcmQ8L2xhYmVsPlxcclxcbiAgICAgICAgPC9kaXY+XFxyXFxuICAgICAgICA8ZGl2IGNsYXNzPVxcXCJpbnB1dC1maWVsZFxcXCI+XFxyXFxuICAgICAgICAgICAgPGlucHV0IHR5cGU9XFxcInBhc3N3b3JkXFxcIlxcclxcbiAgICAgICAgICAgICAgICAgICBpZD1cXFwiY29uZmlybVBhc3N3b3JkXFxcIlxcclxcbiAgICAgICAgICAgICAgICAgICBuYW1lPVxcXCJjb25maXJtUGFzc3dvcmRcXFwiXFxyXFxuICAgICAgICAgICAgICAgICAgIGZvcm1Db250cm9sTmFtZT1cXFwiY29uZmlybVBhc3N3b3JkXFxcIlxcclxcbiAgICAgICAgICAgICAgICAgICAjY29uZlBhc3NcXHJcXG4gICAgICAgICAgICAgICAgICAgW2NsYXNzLmFjdGl2ZV09XFxcImNvbmZQYXNzLnZhbHVlXFxcIj5cXHJcXG4gICAgICAgICAgICA8bGFiZWwgZm9yPVxcXCJjb25maXJtUGFzc3dvcmRcXFwiPkNvbmZpcm0gcGFzc3dvcmQ8L2xhYmVsPlxcclxcbiAgICAgICAgPC9kaXY+XFxyXFxuICAgICAgICA8YnV0dG9uIGNsYXNzPVxcXCJidXR0b24gdG9wMjBcXFwiXFxyXFxuICAgICAgICAgICAgICAgIHR5cGU9XFxcInN1Ym1pdFxcXCJcXHJcXG4gICAgICAgICAgICAgICAgW2Rpc2FibGVkXT1cXFwiIXNpZ25VcEZvcm0udmFsaWRcXFwiPlxcclxcbiAgICAgICAgICAgIFNpZ24gdXBcXHJcXG4gICAgICAgIDwvYnV0dG9uPlxcclxcbiAgICA8L2Zvcm0+XFxyXFxuPC9kaXY+XCI7XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9hc3NldHMvYXBwL2F1dGgvc2lnbnVwLmNvbXBvbmVudC5odG1sXG4vLyBtb2R1bGUgaWQgPSAxMDM4XG4vLyBtb2R1bGUgY2h1bmtzID0gMSJdLCJtYXBwaW5ncyI6IkFBQUEiLCJzb3VyY2VSb290IjoiIn0=");

/***/ },

/***/ 956:
/***/ function(module, exports, __webpack_require__) {

"use strict";
eval("\"use strict\";\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nvar core_1 = __webpack_require__(1);\r\nvar router_1 = __webpack_require__(100);\r\nvar common_1 = __webpack_require__(124);\r\nvar forms_1 = __webpack_require__(417);\r\nvar auth_component_1 = __webpack_require__(990);\r\nvar login_component_1 = __webpack_require__(991);\r\nvar signup_component_1 = __webpack_require__(992);\r\nvar auth_routing_1 = __webpack_require__(1002);\r\nvar shared_module_1 = __webpack_require__(974);\r\nvar AuthModule = (function () {\r\n    function AuthModule() {\r\n    }\r\n    AuthModule = __decorate([\r\n        core_1.NgModule({\r\n            imports: [\r\n                router_1.RouterModule,\r\n                forms_1.ReactiveFormsModule,\r\n                common_1.CommonModule,\r\n                auth_routing_1.authRouting,\r\n                shared_module_1.SharedModule\r\n            ],\r\n            exports: [auth_component_1.AuthComponent],\r\n            declarations: [auth_component_1.AuthComponent, login_component_1.LoginComponent, signup_component_1.SignupComponent]\r\n        }), \r\n        __metadata('design:paramtypes', [])\r\n    ], AuthModule);\r\n    return AuthModule;\r\n}());\r\nexports.AuthModule = AuthModule;\r\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTU2LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vYXNzZXRzL2FwcC9hdXRoL2F1dGgubW9kdWxlLnRzP2FiZDYiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XHJcbnZhciBfX2RlY29yYXRlID0gKHRoaXMgJiYgdGhpcy5fX2RlY29yYXRlKSB8fCBmdW5jdGlvbiAoZGVjb3JhdG9ycywgdGFyZ2V0LCBrZXksIGRlc2MpIHtcclxuICAgIHZhciBjID0gYXJndW1lbnRzLmxlbmd0aCwgciA9IGMgPCAzID8gdGFyZ2V0IDogZGVzYyA9PT0gbnVsbCA/IGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHRhcmdldCwga2V5KSA6IGRlc2MsIGQ7XHJcbiAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIFJlZmxlY3QuZGVjb3JhdGUgPT09IFwiZnVuY3Rpb25cIikgciA9IFJlZmxlY3QuZGVjb3JhdGUoZGVjb3JhdG9ycywgdGFyZ2V0LCBrZXksIGRlc2MpO1xyXG4gICAgZWxzZSBmb3IgKHZhciBpID0gZGVjb3JhdG9ycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgaWYgKGQgPSBkZWNvcmF0b3JzW2ldKSByID0gKGMgPCAzID8gZChyKSA6IGMgPiAzID8gZCh0YXJnZXQsIGtleSwgcikgOiBkKHRhcmdldCwga2V5KSkgfHwgcjtcclxuICAgIHJldHVybiBjID4gMyAmJiByICYmIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgciksIHI7XHJcbn07XHJcbnZhciBfX21ldGFkYXRhID0gKHRoaXMgJiYgdGhpcy5fX21ldGFkYXRhKSB8fCBmdW5jdGlvbiAoaywgdikge1xyXG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0Lm1ldGFkYXRhID09PSBcImZ1bmN0aW9uXCIpIHJldHVybiBSZWZsZWN0Lm1ldGFkYXRhKGssIHYpO1xyXG59O1xyXG52YXIgY29yZV8xID0gcmVxdWlyZShcIkBhbmd1bGFyL2NvcmVcIik7XHJcbnZhciByb3V0ZXJfMSA9IHJlcXVpcmUoXCJAYW5ndWxhci9yb3V0ZXJcIik7XHJcbnZhciBjb21tb25fMSA9IHJlcXVpcmUoXCJAYW5ndWxhci9jb21tb25cIik7XHJcbnZhciBmb3Jtc18xID0gcmVxdWlyZShcIkBhbmd1bGFyL2Zvcm1zXCIpO1xyXG52YXIgYXV0aF9jb21wb25lbnRfMSA9IHJlcXVpcmUoXCIuL2F1dGguY29tcG9uZW50XCIpO1xyXG52YXIgbG9naW5fY29tcG9uZW50XzEgPSByZXF1aXJlKFwiLi9sb2dpbi5jb21wb25lbnRcIik7XHJcbnZhciBzaWdudXBfY29tcG9uZW50XzEgPSByZXF1aXJlKFwiLi9zaWdudXAuY29tcG9uZW50XCIpO1xyXG52YXIgYXV0aF9yb3V0aW5nXzEgPSByZXF1aXJlKFwiLi9hdXRoLnJvdXRpbmdcIik7XHJcbnZhciBzaGFyZWRfbW9kdWxlXzEgPSByZXF1aXJlKFwiLi4vc2hhcmVkL3NoYXJlZC5tb2R1bGVcIik7XHJcbnZhciBBdXRoTW9kdWxlID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIEF1dGhNb2R1bGUoKSB7XHJcbiAgICB9XHJcbiAgICBBdXRoTW9kdWxlID0gX19kZWNvcmF0ZShbXHJcbiAgICAgICAgY29yZV8xLk5nTW9kdWxlKHtcclxuICAgICAgICAgICAgaW1wb3J0czogW1xyXG4gICAgICAgICAgICAgICAgcm91dGVyXzEuUm91dGVyTW9kdWxlLFxyXG4gICAgICAgICAgICAgICAgZm9ybXNfMS5SZWFjdGl2ZUZvcm1zTW9kdWxlLFxyXG4gICAgICAgICAgICAgICAgY29tbW9uXzEuQ29tbW9uTW9kdWxlLFxyXG4gICAgICAgICAgICAgICAgYXV0aF9yb3V0aW5nXzEuYXV0aFJvdXRpbmcsXHJcbiAgICAgICAgICAgICAgICBzaGFyZWRfbW9kdWxlXzEuU2hhcmVkTW9kdWxlXHJcbiAgICAgICAgICAgIF0sXHJcbiAgICAgICAgICAgIGV4cG9ydHM6IFthdXRoX2NvbXBvbmVudF8xLkF1dGhDb21wb25lbnRdLFxyXG4gICAgICAgICAgICBkZWNsYXJhdGlvbnM6IFthdXRoX2NvbXBvbmVudF8xLkF1dGhDb21wb25lbnQsIGxvZ2luX2NvbXBvbmVudF8xLkxvZ2luQ29tcG9uZW50LCBzaWdudXBfY29tcG9uZW50XzEuU2lnbnVwQ29tcG9uZW50XVxyXG4gICAgICAgIH0pLCBcclxuICAgICAgICBfX21ldGFkYXRhKCdkZXNpZ246cGFyYW10eXBlcycsIFtdKVxyXG4gICAgXSwgQXV0aE1vZHVsZSk7XHJcbiAgICByZXR1cm4gQXV0aE1vZHVsZTtcclxufSgpKTtcclxuZXhwb3J0cy5BdXRoTW9kdWxlID0gQXV0aE1vZHVsZTtcclxuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9hc3NldHMvYXBwL2F1dGgvYXV0aC5tb2R1bGUudHNcbi8vIG1vZHVsZSBpZCA9IDk1NlxuLy8gbW9kdWxlIGNodW5rcyA9IDEiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=");

/***/ },

/***/ 959:
/***/ function(module, exports, __webpack_require__) {

"use strict";
eval("\"use strict\";\nvar core_1 = __webpack_require__(1);\nvar UploadedFile = (function () {\n    function UploadedFile(id, originalName, size) {\n        this.id = id;\n        this.originalName = originalName;\n        this.size = size;\n        this.progress = {\n            loaded: 0,\n            total: 0,\n            percent: 0,\n            speed: 0,\n            speedHumanized: null\n        };\n        this.done = false;\n        this.error = false;\n        this.abort = false;\n        this.startTime = new Date().getTime();\n        this.endTime = 0;\n        this.speedAverage = 0;\n        this.speedAverageHumanized = null;\n    }\n    UploadedFile.prototype.setProgres = function (progress) {\n        this.progress = progress;\n    };\n    UploadedFile.prototype.setError = function () {\n        this.error = true;\n        this.done = true;\n    };\n    UploadedFile.prototype.setAbort = function () {\n        this.abort = true;\n        this.done = true;\n    };\n    UploadedFile.prototype.onFinished = function (status, statusText, response) {\n        this.endTime = new Date().getTime();\n        this.speedAverage = this.size / (this.endTime - this.startTime) * 1000;\n        this.speedAverage = parseInt(this.speedAverage, 10);\n        this.speedAverageHumanized = humanizeBytes(this.speedAverage);\n        this.status = status;\n        this.statusText = statusText;\n        this.response = response;\n        this.done = true;\n    };\n    return UploadedFile;\n}());\nexports.UploadedFile = UploadedFile;\nvar Ng2Uploader = (function () {\n    function Ng2Uploader() {\n        this.cors = false;\n        this.withCredentials = false;\n        this.multiple = false;\n        this.maxUploads = 3;\n        this.data = {};\n        this.autoUpload = true;\n        this.multipart = true;\n        this.method = 'POST';\n        this.debug = false;\n        this.customHeaders = {};\n        this.encodeHeaders = true;\n        this.authTokenPrefix = 'Bearer';\n        this.authToken = undefined;\n        this.fieldName = 'file';\n        this.fieldReset = true;\n        this.previewUrl = false;\n        this.calculateSpeed = false;\n        this._queue = [];\n        this._emitter = new core_1.EventEmitter();\n        this._previewEmitter = new core_1.EventEmitter();\n        this._beforeEmitter = new core_1.EventEmitter();\n    }\n    Ng2Uploader.prototype.setOptions = function (options) {\n        this.url = options.url != null ? options.url : this.url;\n        this.cors = options.cors != null ? options.cors : this.cors;\n        this.withCredentials = options.withCredentials != null ? options.withCredentials : this.withCredentials;\n        this.multiple = options.multiple != null ? options.multiple : this.multiple;\n        this.maxUploads = options.maxUploads != null ? options.maxUploads : this.maxUploads;\n        this.data = options.data != null ? options.data : this.data;\n        this.autoUpload = options.autoUpload != null ? options.autoUpload : this.autoUpload;\n        this.multipart = options.multipart != null ? options.multipart : this.multipart;\n        this.method = options.method != null ? options.method : this.method;\n        this.customHeaders = options.customHeaders != null ? options.customHeaders : this.customHeaders;\n        this.encodeHeaders = options.encodeHeaders != null ? options.encodeHeaders : this.encodeHeaders;\n        this.authTokenPrefix = options.authTokenPrefix != null ? options.authTokenPrefix : this.authTokenPrefix;\n        this.authToken = options.authToken != null ? options.authToken : this.authToken;\n        this.fieldName = options.fieldName != null ? options.fieldName : this.fieldName;\n        this.fieldReset = options.fieldReset != null ? options.fieldReset : this.fieldReset;\n        this.previewUrl = options.previewUrl != null ? options.previewUrl : this.previewUrl;\n        this.calculateSpeed = options.calculateSpeed != null ? options.calculateSpeed : this.calculateSpeed;\n        if (!this.multiple) {\n            this.maxUploads = 1;\n        }\n    };\n    Ng2Uploader.prototype.uploadFilesInQueue = function () {\n        var _this = this;\n        var newFiles = this._queue.filter(function (f) { return !f.uploading; });\n        newFiles.forEach(function (f) {\n            _this.uploadFile(f);\n        });\n    };\n    ;\n    Ng2Uploader.prototype.uploadFile = function (file) {\n        var _this = this;\n        var xhr = new XMLHttpRequest();\n        var form = new FormData();\n        form.append(this.fieldName, file, file.name);\n        Object.keys(this.data).forEach(function (k) {\n            form.append(k, _this.data[k]);\n        });\n        var uploadingFile = new UploadedFile(this.generateRandomIndex(), file.name, file.size);\n        var queueIndex = this._queue.indexOf(file);\n        var time = new Date().getTime();\n        var load = 0;\n        var speed = 0;\n        var speedHumanized = null;\n        xhr.upload.onprogress = function (e) {\n            if (e.lengthComputable) {\n                if (_this.calculateSpeed) {\n                    time = new Date().getTime() - time;\n                    load = e.loaded - load;\n                    speed = load / time * 1000;\n                    speed = parseInt(speed, 10);\n                    speedHumanized = humanizeBytes(speed);\n                }\n                var percent = Math.round(e.loaded / e.total * 100);\n                if (speed === 0) {\n                    uploadingFile.setProgres({\n                        total: e.total,\n                        loaded: e.loaded,\n                        percent: percent\n                    });\n                }\n                else {\n                    uploadingFile.setProgres({\n                        total: e.total,\n                        loaded: e.loaded,\n                        percent: percent,\n                        speed: speed,\n                        speedHumanized: speedHumanized\n                    });\n                }\n                _this._emitter.emit(uploadingFile);\n            }\n        };\n        xhr.upload.onabort = function (e) {\n            uploadingFile.setAbort();\n            _this._emitter.emit(uploadingFile);\n        };\n        xhr.upload.onerror = function (e) {\n            uploadingFile.setError();\n            _this._emitter.emit(uploadingFile);\n        };\n        xhr.onreadystatechange = function () {\n            if (xhr.readyState === XMLHttpRequest.DONE) {\n                uploadingFile.onFinished(xhr.status, xhr.statusText, xhr.response);\n                _this.removeFileFromQueue(queueIndex);\n                _this._emitter.emit(uploadingFile);\n            }\n        };\n        xhr.open(this.method, this.url, true);\n        xhr.withCredentials = this.withCredentials;\n        if (this.customHeaders) {\n            Object.keys(this.customHeaders).forEach(function (key) {\n                xhr.setRequestHeader(key, _this.customHeaders[key]);\n            });\n        }\n        if (this.authToken) {\n            xhr.setRequestHeader('Authorization', this.authTokenPrefix + \" \" + this.authToken);\n        }\n        this._beforeEmitter.emit(uploadingFile);\n        if (!uploadingFile.abort) {\n            xhr.send(form);\n        }\n        else {\n            this.removeFileFromQueue(queueIndex);\n        }\n    };\n    Ng2Uploader.prototype.addFilesToQueue = function (files) {\n        var _this = this;\n        this.clearQueue();\n        files.forEach(function (file, i) {\n            if (_this.isFile(file) && !_this.inQueue(file)) {\n                _this._queue.push(file);\n            }\n        });\n        if (this.previewUrl) {\n            files.forEach(function (file) { return _this.createFileUrl(file); });\n        }\n        if (this.autoUpload) {\n            this.uploadFilesInQueue();\n        }\n    };\n    Ng2Uploader.prototype.createFileUrl = function (file) {\n        var _this = this;\n        var reader = new FileReader();\n        reader.addEventListener('load', function () {\n            _this._previewEmitter.emit(reader.result);\n        });\n        reader.readAsDataURL(file);\n    };\n    Ng2Uploader.prototype.removeFileFromQueue = function (i) {\n        this._queue.splice(i, 1);\n    };\n    Ng2Uploader.prototype.clearQueue = function () {\n        this._queue = [];\n    };\n    Ng2Uploader.prototype.getQueueSize = function () {\n        return this._queue.length;\n    };\n    Ng2Uploader.prototype.inQueue = function (file) {\n        var fileInQueue = this._queue.filter(function (f) { return f === file; });\n        return fileInQueue.length ? true : false;\n    };\n    Ng2Uploader.prototype.isFile = function (file) {\n        return file !== null && (file instanceof Blob || (file.name && file.size));\n    };\n    Ng2Uploader.prototype.generateRandomIndex = function () {\n        return Math.random().toString(36).substring(7);\n    };\n    return Ng2Uploader;\n}());\nexports.Ng2Uploader = Ng2Uploader;\nvar UploadRejected = (function () {\n    function UploadRejected() {\n    }\n    Object.defineProperty(UploadRejected, \"EXTENSION_NOT_ALLOWED\", {\n        get: function () { return 'ExtensionNotAllowed'; },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(UploadRejected, \"MAX_SIZE_EXCEEDED\", {\n        get: function () { return 'MaxSizeExceeded'; },\n        enumerable: true,\n        configurable: true\n    });\n    return UploadRejected;\n}());\nexports.UploadRejected = UploadRejected;\nfunction humanizeBytes(bytes) {\n    if (bytes === 0) {\n        return '0 Byte';\n    }\n    var k = 1024;\n    var sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB'];\n    var i = Math.floor(Math.log(bytes) / Math.log(k));\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i] + '/s';\n}\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTU5LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vfi9uZzItdXBsb2FkZXIvc3JjL3NlcnZpY2VzL25nMi11cGxvYWRlci5qcz9hYjg3Il0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xudmFyIGNvcmVfMSA9IHJlcXVpcmUoXCJAYW5ndWxhci9jb3JlXCIpO1xudmFyIFVwbG9hZGVkRmlsZSA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gVXBsb2FkZWRGaWxlKGlkLCBvcmlnaW5hbE5hbWUsIHNpemUpIHtcbiAgICAgICAgdGhpcy5pZCA9IGlkO1xuICAgICAgICB0aGlzLm9yaWdpbmFsTmFtZSA9IG9yaWdpbmFsTmFtZTtcbiAgICAgICAgdGhpcy5zaXplID0gc2l6ZTtcbiAgICAgICAgdGhpcy5wcm9ncmVzcyA9IHtcbiAgICAgICAgICAgIGxvYWRlZDogMCxcbiAgICAgICAgICAgIHRvdGFsOiAwLFxuICAgICAgICAgICAgcGVyY2VudDogMCxcbiAgICAgICAgICAgIHNwZWVkOiAwLFxuICAgICAgICAgICAgc3BlZWRIdW1hbml6ZWQ6IG51bGxcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5kb25lID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZXJyb3IgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5hYm9ydCA9IGZhbHNlO1xuICAgICAgICB0aGlzLnN0YXJ0VGltZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgICAgICB0aGlzLmVuZFRpbWUgPSAwO1xuICAgICAgICB0aGlzLnNwZWVkQXZlcmFnZSA9IDA7XG4gICAgICAgIHRoaXMuc3BlZWRBdmVyYWdlSHVtYW5pemVkID0gbnVsbDtcbiAgICB9XG4gICAgVXBsb2FkZWRGaWxlLnByb3RvdHlwZS5zZXRQcm9ncmVzID0gZnVuY3Rpb24gKHByb2dyZXNzKSB7XG4gICAgICAgIHRoaXMucHJvZ3Jlc3MgPSBwcm9ncmVzcztcbiAgICB9O1xuICAgIFVwbG9hZGVkRmlsZS5wcm90b3R5cGUuc2V0RXJyb3IgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuZXJyb3IgPSB0cnVlO1xuICAgICAgICB0aGlzLmRvbmUgPSB0cnVlO1xuICAgIH07XG4gICAgVXBsb2FkZWRGaWxlLnByb3RvdHlwZS5zZXRBYm9ydCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5hYm9ydCA9IHRydWU7XG4gICAgICAgIHRoaXMuZG9uZSA9IHRydWU7XG4gICAgfTtcbiAgICBVcGxvYWRlZEZpbGUucHJvdG90eXBlLm9uRmluaXNoZWQgPSBmdW5jdGlvbiAoc3RhdHVzLCBzdGF0dXNUZXh0LCByZXNwb25zZSkge1xuICAgICAgICB0aGlzLmVuZFRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICAgICAgdGhpcy5zcGVlZEF2ZXJhZ2UgPSB0aGlzLnNpemUgLyAodGhpcy5lbmRUaW1lIC0gdGhpcy5zdGFydFRpbWUpICogMTAwMDtcbiAgICAgICAgdGhpcy5zcGVlZEF2ZXJhZ2UgPSBwYXJzZUludCh0aGlzLnNwZWVkQXZlcmFnZSwgMTApO1xuICAgICAgICB0aGlzLnNwZWVkQXZlcmFnZUh1bWFuaXplZCA9IGh1bWFuaXplQnl0ZXModGhpcy5zcGVlZEF2ZXJhZ2UpO1xuICAgICAgICB0aGlzLnN0YXR1cyA9IHN0YXR1cztcbiAgICAgICAgdGhpcy5zdGF0dXNUZXh0ID0gc3RhdHVzVGV4dDtcbiAgICAgICAgdGhpcy5yZXNwb25zZSA9IHJlc3BvbnNlO1xuICAgICAgICB0aGlzLmRvbmUgPSB0cnVlO1xuICAgIH07XG4gICAgcmV0dXJuIFVwbG9hZGVkRmlsZTtcbn0oKSk7XG5leHBvcnRzLlVwbG9hZGVkRmlsZSA9IFVwbG9hZGVkRmlsZTtcbnZhciBOZzJVcGxvYWRlciA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTmcyVXBsb2FkZXIoKSB7XG4gICAgICAgIHRoaXMuY29ycyA9IGZhbHNlO1xuICAgICAgICB0aGlzLndpdGhDcmVkZW50aWFscyA9IGZhbHNlO1xuICAgICAgICB0aGlzLm11bHRpcGxlID0gZmFsc2U7XG4gICAgICAgIHRoaXMubWF4VXBsb2FkcyA9IDM7XG4gICAgICAgIHRoaXMuZGF0YSA9IHt9O1xuICAgICAgICB0aGlzLmF1dG9VcGxvYWQgPSB0cnVlO1xuICAgICAgICB0aGlzLm11bHRpcGFydCA9IHRydWU7XG4gICAgICAgIHRoaXMubWV0aG9kID0gJ1BPU1QnO1xuICAgICAgICB0aGlzLmRlYnVnID0gZmFsc2U7XG4gICAgICAgIHRoaXMuY3VzdG9tSGVhZGVycyA9IHt9O1xuICAgICAgICB0aGlzLmVuY29kZUhlYWRlcnMgPSB0cnVlO1xuICAgICAgICB0aGlzLmF1dGhUb2tlblByZWZpeCA9ICdCZWFyZXInO1xuICAgICAgICB0aGlzLmF1dGhUb2tlbiA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5maWVsZE5hbWUgPSAnZmlsZSc7XG4gICAgICAgIHRoaXMuZmllbGRSZXNldCA9IHRydWU7XG4gICAgICAgIHRoaXMucHJldmlld1VybCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmNhbGN1bGF0ZVNwZWVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuX3F1ZXVlID0gW107XG4gICAgICAgIHRoaXMuX2VtaXR0ZXIgPSBuZXcgY29yZV8xLkV2ZW50RW1pdHRlcigpO1xuICAgICAgICB0aGlzLl9wcmV2aWV3RW1pdHRlciA9IG5ldyBjb3JlXzEuRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIHRoaXMuX2JlZm9yZUVtaXR0ZXIgPSBuZXcgY29yZV8xLkV2ZW50RW1pdHRlcigpO1xuICAgIH1cbiAgICBOZzJVcGxvYWRlci5wcm90b3R5cGUuc2V0T3B0aW9ucyA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgIHRoaXMudXJsID0gb3B0aW9ucy51cmwgIT0gbnVsbCA/IG9wdGlvbnMudXJsIDogdGhpcy51cmw7XG4gICAgICAgIHRoaXMuY29ycyA9IG9wdGlvbnMuY29ycyAhPSBudWxsID8gb3B0aW9ucy5jb3JzIDogdGhpcy5jb3JzO1xuICAgICAgICB0aGlzLndpdGhDcmVkZW50aWFscyA9IG9wdGlvbnMud2l0aENyZWRlbnRpYWxzICE9IG51bGwgPyBvcHRpb25zLndpdGhDcmVkZW50aWFscyA6IHRoaXMud2l0aENyZWRlbnRpYWxzO1xuICAgICAgICB0aGlzLm11bHRpcGxlID0gb3B0aW9ucy5tdWx0aXBsZSAhPSBudWxsID8gb3B0aW9ucy5tdWx0aXBsZSA6IHRoaXMubXVsdGlwbGU7XG4gICAgICAgIHRoaXMubWF4VXBsb2FkcyA9IG9wdGlvbnMubWF4VXBsb2FkcyAhPSBudWxsID8gb3B0aW9ucy5tYXhVcGxvYWRzIDogdGhpcy5tYXhVcGxvYWRzO1xuICAgICAgICB0aGlzLmRhdGEgPSBvcHRpb25zLmRhdGEgIT0gbnVsbCA/IG9wdGlvbnMuZGF0YSA6IHRoaXMuZGF0YTtcbiAgICAgICAgdGhpcy5hdXRvVXBsb2FkID0gb3B0aW9ucy5hdXRvVXBsb2FkICE9IG51bGwgPyBvcHRpb25zLmF1dG9VcGxvYWQgOiB0aGlzLmF1dG9VcGxvYWQ7XG4gICAgICAgIHRoaXMubXVsdGlwYXJ0ID0gb3B0aW9ucy5tdWx0aXBhcnQgIT0gbnVsbCA/IG9wdGlvbnMubXVsdGlwYXJ0IDogdGhpcy5tdWx0aXBhcnQ7XG4gICAgICAgIHRoaXMubWV0aG9kID0gb3B0aW9ucy5tZXRob2QgIT0gbnVsbCA/IG9wdGlvbnMubWV0aG9kIDogdGhpcy5tZXRob2Q7XG4gICAgICAgIHRoaXMuY3VzdG9tSGVhZGVycyA9IG9wdGlvbnMuY3VzdG9tSGVhZGVycyAhPSBudWxsID8gb3B0aW9ucy5jdXN0b21IZWFkZXJzIDogdGhpcy5jdXN0b21IZWFkZXJzO1xuICAgICAgICB0aGlzLmVuY29kZUhlYWRlcnMgPSBvcHRpb25zLmVuY29kZUhlYWRlcnMgIT0gbnVsbCA/IG9wdGlvbnMuZW5jb2RlSGVhZGVycyA6IHRoaXMuZW5jb2RlSGVhZGVycztcbiAgICAgICAgdGhpcy5hdXRoVG9rZW5QcmVmaXggPSBvcHRpb25zLmF1dGhUb2tlblByZWZpeCAhPSBudWxsID8gb3B0aW9ucy5hdXRoVG9rZW5QcmVmaXggOiB0aGlzLmF1dGhUb2tlblByZWZpeDtcbiAgICAgICAgdGhpcy5hdXRoVG9rZW4gPSBvcHRpb25zLmF1dGhUb2tlbiAhPSBudWxsID8gb3B0aW9ucy5hdXRoVG9rZW4gOiB0aGlzLmF1dGhUb2tlbjtcbiAgICAgICAgdGhpcy5maWVsZE5hbWUgPSBvcHRpb25zLmZpZWxkTmFtZSAhPSBudWxsID8gb3B0aW9ucy5maWVsZE5hbWUgOiB0aGlzLmZpZWxkTmFtZTtcbiAgICAgICAgdGhpcy5maWVsZFJlc2V0ID0gb3B0aW9ucy5maWVsZFJlc2V0ICE9IG51bGwgPyBvcHRpb25zLmZpZWxkUmVzZXQgOiB0aGlzLmZpZWxkUmVzZXQ7XG4gICAgICAgIHRoaXMucHJldmlld1VybCA9IG9wdGlvbnMucHJldmlld1VybCAhPSBudWxsID8gb3B0aW9ucy5wcmV2aWV3VXJsIDogdGhpcy5wcmV2aWV3VXJsO1xuICAgICAgICB0aGlzLmNhbGN1bGF0ZVNwZWVkID0gb3B0aW9ucy5jYWxjdWxhdGVTcGVlZCAhPSBudWxsID8gb3B0aW9ucy5jYWxjdWxhdGVTcGVlZCA6IHRoaXMuY2FsY3VsYXRlU3BlZWQ7XG4gICAgICAgIGlmICghdGhpcy5tdWx0aXBsZSkge1xuICAgICAgICAgICAgdGhpcy5tYXhVcGxvYWRzID0gMTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgTmcyVXBsb2FkZXIucHJvdG90eXBlLnVwbG9hZEZpbGVzSW5RdWV1ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdmFyIG5ld0ZpbGVzID0gdGhpcy5fcXVldWUuZmlsdGVyKGZ1bmN0aW9uIChmKSB7IHJldHVybiAhZi51cGxvYWRpbmc7IH0pO1xuICAgICAgICBuZXdGaWxlcy5mb3JFYWNoKGZ1bmN0aW9uIChmKSB7XG4gICAgICAgICAgICBfdGhpcy51cGxvYWRGaWxlKGYpO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIDtcbiAgICBOZzJVcGxvYWRlci5wcm90b3R5cGUudXBsb2FkRmlsZSA9IGZ1bmN0aW9uIChmaWxlKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgICAgdmFyIGZvcm0gPSBuZXcgRm9ybURhdGEoKTtcbiAgICAgICAgZm9ybS5hcHBlbmQodGhpcy5maWVsZE5hbWUsIGZpbGUsIGZpbGUubmFtZSk7XG4gICAgICAgIE9iamVjdC5rZXlzKHRoaXMuZGF0YSkuZm9yRWFjaChmdW5jdGlvbiAoaykge1xuICAgICAgICAgICAgZm9ybS5hcHBlbmQoaywgX3RoaXMuZGF0YVtrXSk7XG4gICAgICAgIH0pO1xuICAgICAgICB2YXIgdXBsb2FkaW5nRmlsZSA9IG5ldyBVcGxvYWRlZEZpbGUodGhpcy5nZW5lcmF0ZVJhbmRvbUluZGV4KCksIGZpbGUubmFtZSwgZmlsZS5zaXplKTtcbiAgICAgICAgdmFyIHF1ZXVlSW5kZXggPSB0aGlzLl9xdWV1ZS5pbmRleE9mKGZpbGUpO1xuICAgICAgICB2YXIgdGltZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgICAgICB2YXIgbG9hZCA9IDA7XG4gICAgICAgIHZhciBzcGVlZCA9IDA7XG4gICAgICAgIHZhciBzcGVlZEh1bWFuaXplZCA9IG51bGw7XG4gICAgICAgIHhoci51cGxvYWQub25wcm9ncmVzcyA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBpZiAoZS5sZW5ndGhDb21wdXRhYmxlKSB7XG4gICAgICAgICAgICAgICAgaWYgKF90aGlzLmNhbGN1bGF0ZVNwZWVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIHRpbWU7XG4gICAgICAgICAgICAgICAgICAgIGxvYWQgPSBlLmxvYWRlZCAtIGxvYWQ7XG4gICAgICAgICAgICAgICAgICAgIHNwZWVkID0gbG9hZCAvIHRpbWUgKiAxMDAwO1xuICAgICAgICAgICAgICAgICAgICBzcGVlZCA9IHBhcnNlSW50KHNwZWVkLCAxMCk7XG4gICAgICAgICAgICAgICAgICAgIHNwZWVkSHVtYW5pemVkID0gaHVtYW5pemVCeXRlcyhzcGVlZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciBwZXJjZW50ID0gTWF0aC5yb3VuZChlLmxvYWRlZCAvIGUudG90YWwgKiAxMDApO1xuICAgICAgICAgICAgICAgIGlmIChzcGVlZCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICB1cGxvYWRpbmdGaWxlLnNldFByb2dyZXMoe1xuICAgICAgICAgICAgICAgICAgICAgICAgdG90YWw6IGUudG90YWwsXG4gICAgICAgICAgICAgICAgICAgICAgICBsb2FkZWQ6IGUubG9hZGVkLFxuICAgICAgICAgICAgICAgICAgICAgICAgcGVyY2VudDogcGVyY2VudFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHVwbG9hZGluZ0ZpbGUuc2V0UHJvZ3Jlcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICB0b3RhbDogZS50b3RhbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRlZDogZS5sb2FkZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBwZXJjZW50OiBwZXJjZW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgc3BlZWQ6IHNwZWVkLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3BlZWRIdW1hbml6ZWQ6IHNwZWVkSHVtYW5pemVkXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBfdGhpcy5fZW1pdHRlci5lbWl0KHVwbG9hZGluZ0ZpbGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB4aHIudXBsb2FkLm9uYWJvcnQgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgdXBsb2FkaW5nRmlsZS5zZXRBYm9ydCgpO1xuICAgICAgICAgICAgX3RoaXMuX2VtaXR0ZXIuZW1pdCh1cGxvYWRpbmdGaWxlKTtcbiAgICAgICAgfTtcbiAgICAgICAgeGhyLnVwbG9hZC5vbmVycm9yID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIHVwbG9hZGluZ0ZpbGUuc2V0RXJyb3IoKTtcbiAgICAgICAgICAgIF90aGlzLl9lbWl0dGVyLmVtaXQodXBsb2FkaW5nRmlsZSk7XG4gICAgICAgIH07XG4gICAgICAgIHhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoeGhyLnJlYWR5U3RhdGUgPT09IFhNTEh0dHBSZXF1ZXN0LkRPTkUpIHtcbiAgICAgICAgICAgICAgICB1cGxvYWRpbmdGaWxlLm9uRmluaXNoZWQoeGhyLnN0YXR1cywgeGhyLnN0YXR1c1RleHQsIHhoci5yZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgX3RoaXMucmVtb3ZlRmlsZUZyb21RdWV1ZShxdWV1ZUluZGV4KTtcbiAgICAgICAgICAgICAgICBfdGhpcy5fZW1pdHRlci5lbWl0KHVwbG9hZGluZ0ZpbGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB4aHIub3Blbih0aGlzLm1ldGhvZCwgdGhpcy51cmwsIHRydWUpO1xuICAgICAgICB4aHIud2l0aENyZWRlbnRpYWxzID0gdGhpcy53aXRoQ3JlZGVudGlhbHM7XG4gICAgICAgIGlmICh0aGlzLmN1c3RvbUhlYWRlcnMpIHtcbiAgICAgICAgICAgIE9iamVjdC5rZXlzKHRoaXMuY3VzdG9tSGVhZGVycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoa2V5LCBfdGhpcy5jdXN0b21IZWFkZXJzW2tleV0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuYXV0aFRva2VuKSB7XG4gICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcignQXV0aG9yaXphdGlvbicsIHRoaXMuYXV0aFRva2VuUHJlZml4ICsgXCIgXCIgKyB0aGlzLmF1dGhUb2tlbik7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fYmVmb3JlRW1pdHRlci5lbWl0KHVwbG9hZGluZ0ZpbGUpO1xuICAgICAgICBpZiAoIXVwbG9hZGluZ0ZpbGUuYWJvcnQpIHtcbiAgICAgICAgICAgIHhoci5zZW5kKGZvcm0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5yZW1vdmVGaWxlRnJvbVF1ZXVlKHF1ZXVlSW5kZXgpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBOZzJVcGxvYWRlci5wcm90b3R5cGUuYWRkRmlsZXNUb1F1ZXVlID0gZnVuY3Rpb24gKGZpbGVzKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMuY2xlYXJRdWV1ZSgpO1xuICAgICAgICBmaWxlcy5mb3JFYWNoKGZ1bmN0aW9uIChmaWxlLCBpKSB7XG4gICAgICAgICAgICBpZiAoX3RoaXMuaXNGaWxlKGZpbGUpICYmICFfdGhpcy5pblF1ZXVlKGZpbGUpKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuX3F1ZXVlLnB1c2goZmlsZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAodGhpcy5wcmV2aWV3VXJsKSB7XG4gICAgICAgICAgICBmaWxlcy5mb3JFYWNoKGZ1bmN0aW9uIChmaWxlKSB7IHJldHVybiBfdGhpcy5jcmVhdGVGaWxlVXJsKGZpbGUpOyB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5hdXRvVXBsb2FkKSB7XG4gICAgICAgICAgICB0aGlzLnVwbG9hZEZpbGVzSW5RdWV1ZSgpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBOZzJVcGxvYWRlci5wcm90b3R5cGUuY3JlYXRlRmlsZVVybCA9IGZ1bmN0aW9uIChmaWxlKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xuICAgICAgICByZWFkZXIuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIF90aGlzLl9wcmV2aWV3RW1pdHRlci5lbWl0KHJlYWRlci5yZXN1bHQpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7XG4gICAgfTtcbiAgICBOZzJVcGxvYWRlci5wcm90b3R5cGUucmVtb3ZlRmlsZUZyb21RdWV1ZSA9IGZ1bmN0aW9uIChpKSB7XG4gICAgICAgIHRoaXMuX3F1ZXVlLnNwbGljZShpLCAxKTtcbiAgICB9O1xuICAgIE5nMlVwbG9hZGVyLnByb3RvdHlwZS5jbGVhclF1ZXVlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9xdWV1ZSA9IFtdO1xuICAgIH07XG4gICAgTmcyVXBsb2FkZXIucHJvdG90eXBlLmdldFF1ZXVlU2l6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3F1ZXVlLmxlbmd0aDtcbiAgICB9O1xuICAgIE5nMlVwbG9hZGVyLnByb3RvdHlwZS5pblF1ZXVlID0gZnVuY3Rpb24gKGZpbGUpIHtcbiAgICAgICAgdmFyIGZpbGVJblF1ZXVlID0gdGhpcy5fcXVldWUuZmlsdGVyKGZ1bmN0aW9uIChmKSB7IHJldHVybiBmID09PSBmaWxlOyB9KTtcbiAgICAgICAgcmV0dXJuIGZpbGVJblF1ZXVlLmxlbmd0aCA/IHRydWUgOiBmYWxzZTtcbiAgICB9O1xuICAgIE5nMlVwbG9hZGVyLnByb3RvdHlwZS5pc0ZpbGUgPSBmdW5jdGlvbiAoZmlsZSkge1xuICAgICAgICByZXR1cm4gZmlsZSAhPT0gbnVsbCAmJiAoZmlsZSBpbnN0YW5jZW9mIEJsb2IgfHwgKGZpbGUubmFtZSAmJiBmaWxlLnNpemUpKTtcbiAgICB9O1xuICAgIE5nMlVwbG9hZGVyLnByb3RvdHlwZS5nZW5lcmF0ZVJhbmRvbUluZGV4ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDcpO1xuICAgIH07XG4gICAgcmV0dXJuIE5nMlVwbG9hZGVyO1xufSgpKTtcbmV4cG9ydHMuTmcyVXBsb2FkZXIgPSBOZzJVcGxvYWRlcjtcbnZhciBVcGxvYWRSZWplY3RlZCA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gVXBsb2FkUmVqZWN0ZWQoKSB7XG4gICAgfVxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShVcGxvYWRSZWplY3RlZCwgXCJFWFRFTlNJT05fTk9UX0FMTE9XRURcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuICdFeHRlbnNpb25Ob3RBbGxvd2VkJzsgfSxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFVwbG9hZFJlamVjdGVkLCBcIk1BWF9TSVpFX0VYQ0VFREVEXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiAnTWF4U2l6ZUV4Y2VlZGVkJzsgfSxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgcmV0dXJuIFVwbG9hZFJlamVjdGVkO1xufSgpKTtcbmV4cG9ydHMuVXBsb2FkUmVqZWN0ZWQgPSBVcGxvYWRSZWplY3RlZDtcbmZ1bmN0aW9uIGh1bWFuaXplQnl0ZXMoYnl0ZXMpIHtcbiAgICBpZiAoYnl0ZXMgPT09IDApIHtcbiAgICAgICAgcmV0dXJuICcwIEJ5dGUnO1xuICAgIH1cbiAgICB2YXIgayA9IDEwMjQ7XG4gICAgdmFyIHNpemVzID0gWydCeXRlcycsICdLQicsICdNQicsICdHQicsICdUQicsICdQQiddO1xuICAgIHZhciBpID0gTWF0aC5mbG9vcihNYXRoLmxvZyhieXRlcykgLyBNYXRoLmxvZyhrKSk7XG4gICAgcmV0dXJuIHBhcnNlRmxvYXQoKGJ5dGVzIC8gTWF0aC5wb3coaywgaSkpLnRvRml4ZWQoMikpICsgJyAnICsgc2l6ZXNbaV0gKyAnL3MnO1xufVxuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9+L25nMi11cGxvYWRlci9zcmMvc2VydmljZXMvbmcyLXVwbG9hZGVyLmpzXG4vLyBtb2R1bGUgaWQgPSA5NTlcbi8vIG1vZHVsZSBjaHVua3MgPSAwIDEgMiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ },

/***/ 962:
/***/ function(module, exports, __webpack_require__) {

"use strict";
eval("\"use strict\";\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __metadata = (this && this.__metadata) || function (k, v) {\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\nvar core_1 = __webpack_require__(1);\nvar ng2_uploader_1 = __webpack_require__(959);\nvar NgFileDropDirective = (function () {\n    function NgFileDropDirective(el) {\n        var _this = this;\n        this.el = el;\n        this.onUpload = new core_1.EventEmitter();\n        this.onPreviewData = new core_1.EventEmitter();\n        this.onFileOver = new core_1.EventEmitter();\n        this.onUploadRejected = new core_1.EventEmitter();\n        this.beforeUpload = new core_1.EventEmitter();\n        this.files = [];\n        this.uploader = new ng2_uploader_1.Ng2Uploader();\n        setTimeout(function () {\n            _this.uploader.setOptions(_this.options);\n        });\n        this.uploader._emitter.subscribe(function (data) {\n            _this.onUpload.emit(data);\n            if (data.done) {\n                _this.files = _this.files.filter(function (f) { return f.name !== data.originalName; });\n            }\n        });\n        this.uploader._previewEmitter.subscribe(function (data) {\n            _this.onPreviewData.emit(data);\n        });\n        this.uploader._beforeEmitter.subscribe(function (uploadingFile) {\n            _this.beforeUpload.emit(uploadingFile);\n        });\n        setTimeout(function () {\n            if (_this.events instanceof core_1.EventEmitter) {\n                _this.events.subscribe(function (data) {\n                    if (data === 'startUpload') {\n                        _this.uploader.uploadFilesInQueue();\n                    }\n                });\n            }\n        });\n        this.initEvents();\n    }\n    Object.defineProperty(NgFileDropDirective.prototype, \"options\", {\n        get: function () {\n            return this._options;\n        },\n        set: function (value) {\n            this._options = value;\n            this.uploader.setOptions(this.options);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    NgFileDropDirective.prototype.initEvents = function () {\n        var _this = this;\n        if (typeof this.el.nativeElement.addEventListener === 'undefined') {\n            return;\n        }\n        this.el.nativeElement.addEventListener('drop', function (e) {\n            e.stopPropagation();\n            e.preventDefault();\n            _this.files = Array.from(e.dataTransfer.files);\n            if (_this.files.length) {\n                _this.uploader.addFilesToQueue(_this.files);\n            }\n        }, false);\n        this.el.nativeElement.addEventListener('dragenter', function (e) {\n            e.stopPropagation();\n            e.preventDefault();\n        }, false);\n        this.el.nativeElement.addEventListener('dragover', function (e) {\n            e.stopPropagation();\n            e.preventDefault();\n        }, false);\n    };\n    NgFileDropDirective.prototype.filterFilesByExtension = function () {\n        var _this = this;\n        this.files = this.files.filter(function (f) {\n            if (_this.options.allowedExtensions.indexOf(f.type) !== -1) {\n                return true;\n            }\n            var ext = f.name.split('.').pop();\n            if (_this.options.allowedExtensions.indexOf(ext) !== -1) {\n                return true;\n            }\n            _this.onUploadRejected.emit({ file: f, reason: ng2_uploader_1.UploadRejected.EXTENSION_NOT_ALLOWED });\n            return false;\n        });\n    };\n    NgFileDropDirective.prototype.onChange = function () {\n        if (!this.el.nativeElement.files || !this.el.nativeElement.files.length) {\n            return;\n        }\n        this.files = Array.from(this.el.nativeElement.files);\n        if (this.options.filterExtensions && this.options.allowedExtensions) {\n            this.filterFilesByExtension();\n        }\n        if (this.files.length) {\n            this.uploader.addFilesToQueue(this.files);\n        }\n    };\n    NgFileDropDirective.prototype.onDragOver = function (event) {\n        this.onFileOver.emit(true);\n    };\n    NgFileDropDirective.prototype.onDragLeave = function (event) {\n        this.onFileOver.emit(false);\n    };\n    return NgFileDropDirective;\n}());\n__decorate([\n    core_1.Input(),\n    __metadata(\"design:type\", core_1.EventEmitter)\n], NgFileDropDirective.prototype, \"events\", void 0);\n__decorate([\n    core_1.Output(),\n    __metadata(\"design:type\", core_1.EventEmitter)\n], NgFileDropDirective.prototype, \"onUpload\", void 0);\n__decorate([\n    core_1.Output(),\n    __metadata(\"design:type\", core_1.EventEmitter)\n], NgFileDropDirective.prototype, \"onPreviewData\", void 0);\n__decorate([\n    core_1.Output(),\n    __metadata(\"design:type\", core_1.EventEmitter)\n], NgFileDropDirective.prototype, \"onFileOver\", void 0);\n__decorate([\n    core_1.Output(),\n    __metadata(\"design:type\", core_1.EventEmitter)\n], NgFileDropDirective.prototype, \"onUploadRejected\", void 0);\n__decorate([\n    core_1.Output(),\n    __metadata(\"design:type\", core_1.EventEmitter)\n], NgFileDropDirective.prototype, \"beforeUpload\", void 0);\n__decorate([\n    core_1.Input('options'),\n    __metadata(\"design:type\", Object),\n    __metadata(\"design:paramtypes\", [Object])\n], NgFileDropDirective.prototype, \"options\", null);\n__decorate([\n    core_1.HostListener('change'),\n    __metadata(\"design:type\", Function),\n    __metadata(\"design:paramtypes\", []),\n    __metadata(\"design:returntype\", void 0)\n], NgFileDropDirective.prototype, \"onChange\", null);\n__decorate([\n    core_1.HostListener('dragover', ['$event']),\n    __metadata(\"design:type\", Function),\n    __metadata(\"design:paramtypes\", [Object]),\n    __metadata(\"design:returntype\", void 0)\n], NgFileDropDirective.prototype, \"onDragOver\", null);\n__decorate([\n    core_1.HostListener('dragleave', ['$event']),\n    __metadata(\"design:type\", Function),\n    __metadata(\"design:paramtypes\", [Object]),\n    __metadata(\"design:returntype\", Object)\n], NgFileDropDirective.prototype, \"onDragLeave\", null);\nNgFileDropDirective = __decorate([\n    core_1.Directive({\n        selector: '[ngFileDrop]'\n    }),\n    __metadata(\"design:paramtypes\", [core_1.ElementRef])\n], NgFileDropDirective);\nexports.NgFileDropDirective = NgFileDropDirective;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTYyLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vfi9uZzItdXBsb2FkZXIvc3JjL2RpcmVjdGl2ZXMvbmctZmlsZS1kcm9wLmpzPzcyYTEiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19kZWNvcmF0ZSA9ICh0aGlzICYmIHRoaXMuX19kZWNvcmF0ZSkgfHwgZnVuY3Rpb24gKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKSB7XG4gICAgdmFyIGMgPSBhcmd1bWVudHMubGVuZ3RoLCByID0gYyA8IDMgPyB0YXJnZXQgOiBkZXNjID09PSBudWxsID8gZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGFyZ2V0LCBrZXkpIDogZGVzYywgZDtcbiAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIFJlZmxlY3QuZGVjb3JhdGUgPT09IFwiZnVuY3Rpb25cIikgciA9IFJlZmxlY3QuZGVjb3JhdGUoZGVjb3JhdG9ycywgdGFyZ2V0LCBrZXksIGRlc2MpO1xuICAgIGVsc2UgZm9yICh2YXIgaSA9IGRlY29yYXRvcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIGlmIChkID0gZGVjb3JhdG9yc1tpXSkgciA9IChjIDwgMyA/IGQocikgOiBjID4gMyA/IGQodGFyZ2V0LCBrZXksIHIpIDogZCh0YXJnZXQsIGtleSkpIHx8IHI7XG4gICAgcmV0dXJuIGMgPiAzICYmIHIgJiYgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCByKSwgcjtcbn07XG52YXIgX19tZXRhZGF0YSA9ICh0aGlzICYmIHRoaXMuX19tZXRhZGF0YSkgfHwgZnVuY3Rpb24gKGssIHYpIHtcbiAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIFJlZmxlY3QubWV0YWRhdGEgPT09IFwiZnVuY3Rpb25cIikgcmV0dXJuIFJlZmxlY3QubWV0YWRhdGEoaywgdik7XG59O1xudmFyIGNvcmVfMSA9IHJlcXVpcmUoXCJAYW5ndWxhci9jb3JlXCIpO1xudmFyIG5nMl91cGxvYWRlcl8xID0gcmVxdWlyZShcIi4uL3NlcnZpY2VzL25nMi11cGxvYWRlclwiKTtcbnZhciBOZ0ZpbGVEcm9wRGlyZWN0aXZlID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBOZ0ZpbGVEcm9wRGlyZWN0aXZlKGVsKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMuZWwgPSBlbDtcbiAgICAgICAgdGhpcy5vblVwbG9hZCA9IG5ldyBjb3JlXzEuRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIHRoaXMub25QcmV2aWV3RGF0YSA9IG5ldyBjb3JlXzEuRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIHRoaXMub25GaWxlT3ZlciA9IG5ldyBjb3JlXzEuRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIHRoaXMub25VcGxvYWRSZWplY3RlZCA9IG5ldyBjb3JlXzEuRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIHRoaXMuYmVmb3JlVXBsb2FkID0gbmV3IGNvcmVfMS5FdmVudEVtaXR0ZXIoKTtcbiAgICAgICAgdGhpcy5maWxlcyA9IFtdO1xuICAgICAgICB0aGlzLnVwbG9hZGVyID0gbmV3IG5nMl91cGxvYWRlcl8xLk5nMlVwbG9hZGVyKCk7XG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgX3RoaXMudXBsb2FkZXIuc2V0T3B0aW9ucyhfdGhpcy5vcHRpb25zKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMudXBsb2FkZXIuX2VtaXR0ZXIuc3Vic2NyaWJlKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBfdGhpcy5vblVwbG9hZC5lbWl0KGRhdGEpO1xuICAgICAgICAgICAgaWYgKGRhdGEuZG9uZSkge1xuICAgICAgICAgICAgICAgIF90aGlzLmZpbGVzID0gX3RoaXMuZmlsZXMuZmlsdGVyKGZ1bmN0aW9uIChmKSB7IHJldHVybiBmLm5hbWUgIT09IGRhdGEub3JpZ2luYWxOYW1lOyB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMudXBsb2FkZXIuX3ByZXZpZXdFbWl0dGVyLnN1YnNjcmliZShmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgX3RoaXMub25QcmV2aWV3RGF0YS5lbWl0KGRhdGEpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy51cGxvYWRlci5fYmVmb3JlRW1pdHRlci5zdWJzY3JpYmUoZnVuY3Rpb24gKHVwbG9hZGluZ0ZpbGUpIHtcbiAgICAgICAgICAgIF90aGlzLmJlZm9yZVVwbG9hZC5lbWl0KHVwbG9hZGluZ0ZpbGUpO1xuICAgICAgICB9KTtcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoX3RoaXMuZXZlbnRzIGluc3RhbmNlb2YgY29yZV8xLkV2ZW50RW1pdHRlcikge1xuICAgICAgICAgICAgICAgIF90aGlzLmV2ZW50cy5zdWJzY3JpYmUoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEgPT09ICdzdGFydFVwbG9hZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnVwbG9hZGVyLnVwbG9hZEZpbGVzSW5RdWV1ZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmluaXRFdmVudHMoKTtcbiAgICB9XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KE5nRmlsZURyb3BEaXJlY3RpdmUucHJvdG90eXBlLCBcIm9wdGlvbnNcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9vcHRpb25zO1xuICAgICAgICB9LFxuICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy5fb3B0aW9ucyA9IHZhbHVlO1xuICAgICAgICAgICAgdGhpcy51cGxvYWRlci5zZXRPcHRpb25zKHRoaXMub3B0aW9ucyk7XG4gICAgICAgIH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIE5nRmlsZURyb3BEaXJlY3RpdmUucHJvdG90eXBlLmluaXRFdmVudHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIGlmICh0eXBlb2YgdGhpcy5lbC5uYXRpdmVFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2Ryb3AnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIF90aGlzLmZpbGVzID0gQXJyYXkuZnJvbShlLmRhdGFUcmFuc2Zlci5maWxlcyk7XG4gICAgICAgICAgICBpZiAoX3RoaXMuZmlsZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMudXBsb2FkZXIuYWRkRmlsZXNUb1F1ZXVlKF90aGlzLmZpbGVzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgZmFsc2UpO1xuICAgICAgICB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ2VudGVyJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH0sIGZhbHNlKTtcbiAgICAgICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdvdmVyJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH0sIGZhbHNlKTtcbiAgICB9O1xuICAgIE5nRmlsZURyb3BEaXJlY3RpdmUucHJvdG90eXBlLmZpbHRlckZpbGVzQnlFeHRlbnNpb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMuZmlsZXMgPSB0aGlzLmZpbGVzLmZpbHRlcihmdW5jdGlvbiAoZikge1xuICAgICAgICAgICAgaWYgKF90aGlzLm9wdGlvbnMuYWxsb3dlZEV4dGVuc2lvbnMuaW5kZXhPZihmLnR5cGUpICE9PSAtMSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGV4dCA9IGYubmFtZS5zcGxpdCgnLicpLnBvcCgpO1xuICAgICAgICAgICAgaWYgKF90aGlzLm9wdGlvbnMuYWxsb3dlZEV4dGVuc2lvbnMuaW5kZXhPZihleHQpICE9PSAtMSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgX3RoaXMub25VcGxvYWRSZWplY3RlZC5lbWl0KHsgZmlsZTogZiwgcmVhc29uOiBuZzJfdXBsb2FkZXJfMS5VcGxvYWRSZWplY3RlZC5FWFRFTlNJT05fTk9UX0FMTE9XRUQgfSk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgTmdGaWxlRHJvcERpcmVjdGl2ZS5wcm90b3R5cGUub25DaGFuZ2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICghdGhpcy5lbC5uYXRpdmVFbGVtZW50LmZpbGVzIHx8ICF0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuZmlsZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5maWxlcyA9IEFycmF5LmZyb20odGhpcy5lbC5uYXRpdmVFbGVtZW50LmZpbGVzKTtcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5maWx0ZXJFeHRlbnNpb25zICYmIHRoaXMub3B0aW9ucy5hbGxvd2VkRXh0ZW5zaW9ucykge1xuICAgICAgICAgICAgdGhpcy5maWx0ZXJGaWxlc0J5RXh0ZW5zaW9uKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuZmlsZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICB0aGlzLnVwbG9hZGVyLmFkZEZpbGVzVG9RdWV1ZSh0aGlzLmZpbGVzKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgTmdGaWxlRHJvcERpcmVjdGl2ZS5wcm90b3R5cGUub25EcmFnT3ZlciA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICB0aGlzLm9uRmlsZU92ZXIuZW1pdCh0cnVlKTtcbiAgICB9O1xuICAgIE5nRmlsZURyb3BEaXJlY3RpdmUucHJvdG90eXBlLm9uRHJhZ0xlYXZlID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIHRoaXMub25GaWxlT3Zlci5lbWl0KGZhbHNlKTtcbiAgICB9O1xuICAgIHJldHVybiBOZ0ZpbGVEcm9wRGlyZWN0aXZlO1xufSgpKTtcbl9fZGVjb3JhdGUoW1xuICAgIGNvcmVfMS5JbnB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBjb3JlXzEuRXZlbnRFbWl0dGVyKVxuXSwgTmdGaWxlRHJvcERpcmVjdGl2ZS5wcm90b3R5cGUsIFwiZXZlbnRzXCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBjb3JlXzEuT3V0cHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIGNvcmVfMS5FdmVudEVtaXR0ZXIpXG5dLCBOZ0ZpbGVEcm9wRGlyZWN0aXZlLnByb3RvdHlwZSwgXCJvblVwbG9hZFwiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgY29yZV8xLk91dHB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBjb3JlXzEuRXZlbnRFbWl0dGVyKVxuXSwgTmdGaWxlRHJvcERpcmVjdGl2ZS5wcm90b3R5cGUsIFwib25QcmV2aWV3RGF0YVwiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgY29yZV8xLk91dHB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBjb3JlXzEuRXZlbnRFbWl0dGVyKVxuXSwgTmdGaWxlRHJvcERpcmVjdGl2ZS5wcm90b3R5cGUsIFwib25GaWxlT3ZlclwiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgY29yZV8xLk91dHB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBjb3JlXzEuRXZlbnRFbWl0dGVyKVxuXSwgTmdGaWxlRHJvcERpcmVjdGl2ZS5wcm90b3R5cGUsIFwib25VcGxvYWRSZWplY3RlZFwiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgY29yZV8xLk91dHB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBjb3JlXzEuRXZlbnRFbWl0dGVyKVxuXSwgTmdGaWxlRHJvcERpcmVjdGl2ZS5wcm90b3R5cGUsIFwiYmVmb3JlVXBsb2FkXCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBjb3JlXzEuSW5wdXQoJ29wdGlvbnMnKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgT2JqZWN0KSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW09iamVjdF0pXG5dLCBOZ0ZpbGVEcm9wRGlyZWN0aXZlLnByb3RvdHlwZSwgXCJvcHRpb25zXCIsIG51bGwpO1xuX19kZWNvcmF0ZShbXG4gICAgY29yZV8xLkhvc3RMaXN0ZW5lcignY2hhbmdlJyksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIEZ1bmN0aW9uKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW10pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cmV0dXJudHlwZVwiLCB2b2lkIDApXG5dLCBOZ0ZpbGVEcm9wRGlyZWN0aXZlLnByb3RvdHlwZSwgXCJvbkNoYW5nZVwiLCBudWxsKTtcbl9fZGVjb3JhdGUoW1xuICAgIGNvcmVfMS5Ib3N0TGlzdGVuZXIoJ2RyYWdvdmVyJywgWyckZXZlbnQnXSksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIEZ1bmN0aW9uKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW09iamVjdF0pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cmV0dXJudHlwZVwiLCB2b2lkIDApXG5dLCBOZ0ZpbGVEcm9wRGlyZWN0aXZlLnByb3RvdHlwZSwgXCJvbkRyYWdPdmVyXCIsIG51bGwpO1xuX19kZWNvcmF0ZShbXG4gICAgY29yZV8xLkhvc3RMaXN0ZW5lcignZHJhZ2xlYXZlJywgWyckZXZlbnQnXSksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIEZ1bmN0aW9uKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW09iamVjdF0pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cmV0dXJudHlwZVwiLCBPYmplY3QpXG5dLCBOZ0ZpbGVEcm9wRGlyZWN0aXZlLnByb3RvdHlwZSwgXCJvbkRyYWdMZWF2ZVwiLCBudWxsKTtcbk5nRmlsZURyb3BEaXJlY3RpdmUgPSBfX2RlY29yYXRlKFtcbiAgICBjb3JlXzEuRGlyZWN0aXZlKHtcbiAgICAgICAgc2VsZWN0b3I6ICdbbmdGaWxlRHJvcF0nXG4gICAgfSksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtjb3JlXzEuRWxlbWVudFJlZl0pXG5dLCBOZ0ZpbGVEcm9wRGlyZWN0aXZlKTtcbmV4cG9ydHMuTmdGaWxlRHJvcERpcmVjdGl2ZSA9IE5nRmlsZURyb3BEaXJlY3RpdmU7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vbmcyLXVwbG9hZGVyL3NyYy9kaXJlY3RpdmVzL25nLWZpbGUtZHJvcC5qc1xuLy8gbW9kdWxlIGlkID0gOTYyXG4vLyBtb2R1bGUgY2h1bmtzID0gMCAxIDIiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9");

/***/ },

/***/ 963:
/***/ function(module, exports, __webpack_require__) {

"use strict";
eval("\"use strict\";\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __metadata = (this && this.__metadata) || function (k, v) {\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\nvar core_1 = __webpack_require__(1);\nvar ng2_uploader_1 = __webpack_require__(959);\nvar NgFileSelectDirective = (function () {\n    function NgFileSelectDirective(el) {\n        var _this = this;\n        this.el = el;\n        this.onUpload = new core_1.EventEmitter();\n        this.onPreviewData = new core_1.EventEmitter();\n        this.onUploadRejected = new core_1.EventEmitter();\n        this.beforeUpload = new core_1.EventEmitter();\n        this.files = [];\n        this.uploader = new ng2_uploader_1.Ng2Uploader();\n        setTimeout(function () {\n            _this.uploader.setOptions(_this.options);\n        });\n        this.uploader._emitter.subscribe(function (data) {\n            _this.onUpload.emit(data);\n            if (data.done) {\n                _this.files = _this.files.filter(function (f) { return f.name !== data.originalName; });\n                if (_this.uploader.fieldReset) {\n                    _this.el.nativeElement.value = '';\n                }\n            }\n        });\n        this.uploader._previewEmitter.subscribe(function (data) {\n            _this.onPreviewData.emit(data);\n        });\n        this.uploader._beforeEmitter.subscribe(function (uploadingFile) {\n            _this.beforeUpload.emit(uploadingFile);\n        });\n        setTimeout(function () {\n            if (_this.events) {\n                _this.events.subscribe(function (data) {\n                    if (data === 'startUpload') {\n                        _this.uploader.uploadFilesInQueue();\n                    }\n                });\n            }\n        });\n    }\n    Object.defineProperty(NgFileSelectDirective.prototype, \"options\", {\n        get: function () {\n            return this._options;\n        },\n        set: function (value) {\n            this._options = value;\n            this.uploader.setOptions(this.options);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    NgFileSelectDirective.prototype.filterFilesByExtension = function () {\n        var _this = this;\n        this.files = this.files.filter(function (f) {\n            if (_this.options.allowedExtensions.indexOf(f.type) !== -1) {\n                return true;\n            }\n            var ext = f.name.split('.').pop();\n            if (_this.options.allowedExtensions.indexOf(ext) !== -1) {\n                return true;\n            }\n            _this.onUploadRejected.emit({ file: f, reason: ng2_uploader_1.UploadRejected.EXTENSION_NOT_ALLOWED });\n            return false;\n        });\n    };\n    NgFileSelectDirective.prototype.onChange = function () {\n        if (!this.el.nativeElement.files) {\n            return;\n        }\n        this.files = Array.from(this.el.nativeElement.files);\n        if (this.options.filterExtensions && this.options.allowedExtensions) {\n            this.filterFilesByExtension();\n        }\n        if (this.files.length) {\n            this.uploader.addFilesToQueue(this.files);\n        }\n    };\n    return NgFileSelectDirective;\n}());\n__decorate([\n    core_1.Input(),\n    __metadata(\"design:type\", core_1.EventEmitter)\n], NgFileSelectDirective.prototype, \"events\", void 0);\n__decorate([\n    core_1.Output(),\n    __metadata(\"design:type\", core_1.EventEmitter)\n], NgFileSelectDirective.prototype, \"onUpload\", void 0);\n__decorate([\n    core_1.Output(),\n    __metadata(\"design:type\", core_1.EventEmitter)\n], NgFileSelectDirective.prototype, \"onPreviewData\", void 0);\n__decorate([\n    core_1.Output(),\n    __metadata(\"design:type\", core_1.EventEmitter)\n], NgFileSelectDirective.prototype, \"onUploadRejected\", void 0);\n__decorate([\n    core_1.Output(),\n    __metadata(\"design:type\", core_1.EventEmitter)\n], NgFileSelectDirective.prototype, \"beforeUpload\", void 0);\n__decorate([\n    core_1.Input('options'),\n    __metadata(\"design:type\", Object),\n    __metadata(\"design:paramtypes\", [Object])\n], NgFileSelectDirective.prototype, \"options\", null);\n__decorate([\n    core_1.HostListener('change'),\n    __metadata(\"design:type\", Function),\n    __metadata(\"design:paramtypes\", []),\n    __metadata(\"design:returntype\", void 0)\n], NgFileSelectDirective.prototype, \"onChange\", null);\nNgFileSelectDirective = __decorate([\n    core_1.Directive({\n        selector: '[ngFileSelect]'\n    }),\n    __metadata(\"design:paramtypes\", [core_1.ElementRef])\n], NgFileSelectDirective);\nexports.NgFileSelectDirective = NgFileSelectDirective;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTYzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vfi9uZzItdXBsb2FkZXIvc3JjL2RpcmVjdGl2ZXMvbmctZmlsZS1zZWxlY3QuanM/Njc0ZiJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2RlY29yYXRlID0gKHRoaXMgJiYgdGhpcy5fX2RlY29yYXRlKSB8fCBmdW5jdGlvbiAoZGVjb3JhdG9ycywgdGFyZ2V0LCBrZXksIGRlc2MpIHtcbiAgICB2YXIgYyA9IGFyZ3VtZW50cy5sZW5ndGgsIHIgPSBjIDwgMyA/IHRhcmdldCA6IGRlc2MgPT09IG51bGwgPyBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0YXJnZXQsIGtleSkgOiBkZXNjLCBkO1xuICAgIGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgUmVmbGVjdC5kZWNvcmF0ZSA9PT0gXCJmdW5jdGlvblwiKSByID0gUmVmbGVjdC5kZWNvcmF0ZShkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYyk7XG4gICAgZWxzZSBmb3IgKHZhciBpID0gZGVjb3JhdG9ycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgaWYgKGQgPSBkZWNvcmF0b3JzW2ldKSByID0gKGMgPCAzID8gZChyKSA6IGMgPiAzID8gZCh0YXJnZXQsIGtleSwgcikgOiBkKHRhcmdldCwga2V5KSkgfHwgcjtcbiAgICByZXR1cm4gYyA+IDMgJiYgciAmJiBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHIpLCByO1xufTtcbnZhciBfX21ldGFkYXRhID0gKHRoaXMgJiYgdGhpcy5fX21ldGFkYXRhKSB8fCBmdW5jdGlvbiAoaywgdikge1xuICAgIGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgUmVmbGVjdC5tZXRhZGF0YSA9PT0gXCJmdW5jdGlvblwiKSByZXR1cm4gUmVmbGVjdC5tZXRhZGF0YShrLCB2KTtcbn07XG52YXIgY29yZV8xID0gcmVxdWlyZShcIkBhbmd1bGFyL2NvcmVcIik7XG52YXIgbmcyX3VwbG9hZGVyXzEgPSByZXF1aXJlKFwiLi4vc2VydmljZXMvbmcyLXVwbG9hZGVyXCIpO1xudmFyIE5nRmlsZVNlbGVjdERpcmVjdGl2ZSA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTmdGaWxlU2VsZWN0RGlyZWN0aXZlKGVsKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMuZWwgPSBlbDtcbiAgICAgICAgdGhpcy5vblVwbG9hZCA9IG5ldyBjb3JlXzEuRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIHRoaXMub25QcmV2aWV3RGF0YSA9IG5ldyBjb3JlXzEuRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIHRoaXMub25VcGxvYWRSZWplY3RlZCA9IG5ldyBjb3JlXzEuRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIHRoaXMuYmVmb3JlVXBsb2FkID0gbmV3IGNvcmVfMS5FdmVudEVtaXR0ZXIoKTtcbiAgICAgICAgdGhpcy5maWxlcyA9IFtdO1xuICAgICAgICB0aGlzLnVwbG9hZGVyID0gbmV3IG5nMl91cGxvYWRlcl8xLk5nMlVwbG9hZGVyKCk7XG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgX3RoaXMudXBsb2FkZXIuc2V0T3B0aW9ucyhfdGhpcy5vcHRpb25zKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMudXBsb2FkZXIuX2VtaXR0ZXIuc3Vic2NyaWJlKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBfdGhpcy5vblVwbG9hZC5lbWl0KGRhdGEpO1xuICAgICAgICAgICAgaWYgKGRhdGEuZG9uZSkge1xuICAgICAgICAgICAgICAgIF90aGlzLmZpbGVzID0gX3RoaXMuZmlsZXMuZmlsdGVyKGZ1bmN0aW9uIChmKSB7IHJldHVybiBmLm5hbWUgIT09IGRhdGEub3JpZ2luYWxOYW1lOyB9KTtcbiAgICAgICAgICAgICAgICBpZiAoX3RoaXMudXBsb2FkZXIuZmllbGRSZXNldCkge1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5lbC5uYXRpdmVFbGVtZW50LnZhbHVlID0gJyc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy51cGxvYWRlci5fcHJldmlld0VtaXR0ZXIuc3Vic2NyaWJlKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBfdGhpcy5vblByZXZpZXdEYXRhLmVtaXQoZGF0YSk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnVwbG9hZGVyLl9iZWZvcmVFbWl0dGVyLnN1YnNjcmliZShmdW5jdGlvbiAodXBsb2FkaW5nRmlsZSkge1xuICAgICAgICAgICAgX3RoaXMuYmVmb3JlVXBsb2FkLmVtaXQodXBsb2FkaW5nRmlsZSk7XG4gICAgICAgIH0pO1xuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmIChfdGhpcy5ldmVudHMpIHtcbiAgICAgICAgICAgICAgICBfdGhpcy5ldmVudHMuc3Vic2NyaWJlKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhID09PSAnc3RhcnRVcGxvYWQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy51cGxvYWRlci51cGxvYWRGaWxlc0luUXVldWUoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KE5nRmlsZVNlbGVjdERpcmVjdGl2ZS5wcm90b3R5cGUsIFwib3B0aW9uc1wiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX29wdGlvbnM7XG4gICAgICAgIH0sXG4gICAgICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLl9vcHRpb25zID0gdmFsdWU7XG4gICAgICAgICAgICB0aGlzLnVwbG9hZGVyLnNldE9wdGlvbnModGhpcy5vcHRpb25zKTtcbiAgICAgICAgfSxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgTmdGaWxlU2VsZWN0RGlyZWN0aXZlLnByb3RvdHlwZS5maWx0ZXJGaWxlc0J5RXh0ZW5zaW9uID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB0aGlzLmZpbGVzID0gdGhpcy5maWxlcy5maWx0ZXIoZnVuY3Rpb24gKGYpIHtcbiAgICAgICAgICAgIGlmIChfdGhpcy5vcHRpb25zLmFsbG93ZWRFeHRlbnNpb25zLmluZGV4T2YoZi50eXBlKSAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBleHQgPSBmLm5hbWUuc3BsaXQoJy4nKS5wb3AoKTtcbiAgICAgICAgICAgIGlmIChfdGhpcy5vcHRpb25zLmFsbG93ZWRFeHRlbnNpb25zLmluZGV4T2YoZXh0KSAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF90aGlzLm9uVXBsb2FkUmVqZWN0ZWQuZW1pdCh7IGZpbGU6IGYsIHJlYXNvbjogbmcyX3VwbG9hZGVyXzEuVXBsb2FkUmVqZWN0ZWQuRVhURU5TSU9OX05PVF9BTExPV0VEIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIE5nRmlsZVNlbGVjdERpcmVjdGl2ZS5wcm90b3R5cGUub25DaGFuZ2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICghdGhpcy5lbC5uYXRpdmVFbGVtZW50LmZpbGVzKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5maWxlcyA9IEFycmF5LmZyb20odGhpcy5lbC5uYXRpdmVFbGVtZW50LmZpbGVzKTtcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5maWx0ZXJFeHRlbnNpb25zICYmIHRoaXMub3B0aW9ucy5hbGxvd2VkRXh0ZW5zaW9ucykge1xuICAgICAgICAgICAgdGhpcy5maWx0ZXJGaWxlc0J5RXh0ZW5zaW9uKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuZmlsZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICB0aGlzLnVwbG9hZGVyLmFkZEZpbGVzVG9RdWV1ZSh0aGlzLmZpbGVzKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgcmV0dXJuIE5nRmlsZVNlbGVjdERpcmVjdGl2ZTtcbn0oKSk7XG5fX2RlY29yYXRlKFtcbiAgICBjb3JlXzEuSW5wdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgY29yZV8xLkV2ZW50RW1pdHRlcilcbl0sIE5nRmlsZVNlbGVjdERpcmVjdGl2ZS5wcm90b3R5cGUsIFwiZXZlbnRzXCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBjb3JlXzEuT3V0cHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIGNvcmVfMS5FdmVudEVtaXR0ZXIpXG5dLCBOZ0ZpbGVTZWxlY3REaXJlY3RpdmUucHJvdG90eXBlLCBcIm9uVXBsb2FkXCIsIHZvaWQgMCk7XG5fX2RlY29yYXRlKFtcbiAgICBjb3JlXzEuT3V0cHV0KCksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIGNvcmVfMS5FdmVudEVtaXR0ZXIpXG5dLCBOZ0ZpbGVTZWxlY3REaXJlY3RpdmUucHJvdG90eXBlLCBcIm9uUHJldmlld0RhdGFcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIGNvcmVfMS5PdXRwdXQoKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgY29yZV8xLkV2ZW50RW1pdHRlcilcbl0sIE5nRmlsZVNlbGVjdERpcmVjdGl2ZS5wcm90b3R5cGUsIFwib25VcGxvYWRSZWplY3RlZFwiLCB2b2lkIDApO1xuX19kZWNvcmF0ZShbXG4gICAgY29yZV8xLk91dHB1dCgpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBjb3JlXzEuRXZlbnRFbWl0dGVyKVxuXSwgTmdGaWxlU2VsZWN0RGlyZWN0aXZlLnByb3RvdHlwZSwgXCJiZWZvcmVVcGxvYWRcIiwgdm9pZCAwKTtcbl9fZGVjb3JhdGUoW1xuICAgIGNvcmVfMS5JbnB1dCgnb3B0aW9ucycpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBPYmplY3QpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbT2JqZWN0XSlcbl0sIE5nRmlsZVNlbGVjdERpcmVjdGl2ZS5wcm90b3R5cGUsIFwib3B0aW9uc1wiLCBudWxsKTtcbl9fZGVjb3JhdGUoW1xuICAgIGNvcmVfMS5Ib3N0TGlzdGVuZXIoJ2NoYW5nZScpLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBGdW5jdGlvbiksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtdKSxcbiAgICBfX21ldGFkYXRhKFwiZGVzaWduOnJldHVybnR5cGVcIiwgdm9pZCAwKVxuXSwgTmdGaWxlU2VsZWN0RGlyZWN0aXZlLnByb3RvdHlwZSwgXCJvbkNoYW5nZVwiLCBudWxsKTtcbk5nRmlsZVNlbGVjdERpcmVjdGl2ZSA9IF9fZGVjb3JhdGUoW1xuICAgIGNvcmVfMS5EaXJlY3RpdmUoe1xuICAgICAgICBzZWxlY3RvcjogJ1tuZ0ZpbGVTZWxlY3RdJ1xuICAgIH0pLFxuICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbY29yZV8xLkVsZW1lbnRSZWZdKVxuXSwgTmdGaWxlU2VsZWN0RGlyZWN0aXZlKTtcbmV4cG9ydHMuTmdGaWxlU2VsZWN0RGlyZWN0aXZlID0gTmdGaWxlU2VsZWN0RGlyZWN0aXZlO1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9+L25nMi11cGxvYWRlci9zcmMvZGlyZWN0aXZlcy9uZy1maWxlLXNlbGVjdC5qc1xuLy8gbW9kdWxlIGlkID0gOTYzXG4vLyBtb2R1bGUgY2h1bmtzID0gMCAxIDIiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ },

/***/ 965:
/***/ function(module, exports, __webpack_require__) {

"use strict";
eval("\"use strict\";\nfunction __export(m) {\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\n}\n__export(__webpack_require__(962));\n__export(__webpack_require__(963));\n__export(__webpack_require__(959));\nvar ng2_uploader_module_1 = __webpack_require__(979);\nexports.Ng2UploaderModule = ng2_uploader_module_1.Ng2UploaderModule;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTY1LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vfi9uZzItdXBsb2FkZXIvaW5kZXguanM/NmIxYyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbmZ1bmN0aW9uIF9fZXhwb3J0KG0pIHtcbiAgICBmb3IgKHZhciBwIGluIG0pIGlmICghZXhwb3J0cy5oYXNPd25Qcm9wZXJ0eShwKSkgZXhwb3J0c1twXSA9IG1bcF07XG59XG5fX2V4cG9ydChyZXF1aXJlKFwiLi9zcmMvZGlyZWN0aXZlcy9uZy1maWxlLWRyb3BcIikpO1xuX19leHBvcnQocmVxdWlyZShcIi4vc3JjL2RpcmVjdGl2ZXMvbmctZmlsZS1zZWxlY3RcIikpO1xuX19leHBvcnQocmVxdWlyZShcIi4vc3JjL3NlcnZpY2VzL25nMi11cGxvYWRlclwiKSk7XG52YXIgbmcyX3VwbG9hZGVyX21vZHVsZV8xID0gcmVxdWlyZShcIi4vc3JjL21vZHVsZS9uZzItdXBsb2FkZXIubW9kdWxlXCIpO1xuZXhwb3J0cy5OZzJVcGxvYWRlck1vZHVsZSA9IG5nMl91cGxvYWRlcl9tb2R1bGVfMS5OZzJVcGxvYWRlck1vZHVsZTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vfi9uZzItdXBsb2FkZXIvaW5kZXguanNcbi8vIG1vZHVsZSBpZCA9IDk2NVxuLy8gbW9kdWxlIGNodW5rcyA9IDAgMSAyIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9");

/***/ },

/***/ 967:
/***/ function(module, exports, __webpack_require__) {

"use strict";
eval("\"use strict\";\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nvar core_1 = __webpack_require__(1);\r\nvar error_service_1 = __webpack_require__(418);\r\nvar ErrorComponent = (function () {\r\n    function ErrorComponent(_errorSvc) {\r\n        this._errorSvc = _errorSvc;\r\n        this.displayError = false;\r\n    }\r\n    ErrorComponent.prototype.ngOnInit = function () {\r\n        var _this = this;\r\n        this._errorSvc.errorOccurred.subscribe(function (errorData) {\r\n            _this.errorData = errorData;\r\n            _this.displayError = true;\r\n        });\r\n    };\r\n    ErrorComponent = __decorate([\r\n        core_1.Component({\r\n            selector: 'dip-error',\r\n            template: __webpack_require__(975),\r\n            styles: [__webpack_require__(980)]\r\n        }), \r\n        __metadata('design:paramtypes', [(typeof (_a = typeof error_service_1.ErrorService !== 'undefined' && error_service_1.ErrorService) === 'function' && _a) || Object])\r\n    ], ErrorComponent);\r\n    return ErrorComponent;\r\n    var _a;\r\n}());\r\nexports.ErrorComponent = ErrorComponent;\r\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTY3LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vYXNzZXRzL2FwcC9lcnJvci9lcnJvci5jb21wb25lbnQudHM/NWY1OCJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcclxudmFyIF9fZGVjb3JhdGUgPSAodGhpcyAmJiB0aGlzLl9fZGVjb3JhdGUpIHx8IGZ1bmN0aW9uIChkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYykge1xyXG4gICAgdmFyIGMgPSBhcmd1bWVudHMubGVuZ3RoLCByID0gYyA8IDMgPyB0YXJnZXQgOiBkZXNjID09PSBudWxsID8gZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGFyZ2V0LCBrZXkpIDogZGVzYywgZDtcclxuICAgIGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgUmVmbGVjdC5kZWNvcmF0ZSA9PT0gXCJmdW5jdGlvblwiKSByID0gUmVmbGVjdC5kZWNvcmF0ZShkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYyk7XHJcbiAgICBlbHNlIGZvciAodmFyIGkgPSBkZWNvcmF0b3JzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSBpZiAoZCA9IGRlY29yYXRvcnNbaV0pIHIgPSAoYyA8IDMgPyBkKHIpIDogYyA+IDMgPyBkKHRhcmdldCwga2V5LCByKSA6IGQodGFyZ2V0LCBrZXkpKSB8fCByO1xyXG4gICAgcmV0dXJuIGMgPiAzICYmIHIgJiYgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCByKSwgcjtcclxufTtcclxudmFyIF9fbWV0YWRhdGEgPSAodGhpcyAmJiB0aGlzLl9fbWV0YWRhdGEpIHx8IGZ1bmN0aW9uIChrLCB2KSB7XHJcbiAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIFJlZmxlY3QubWV0YWRhdGEgPT09IFwiZnVuY3Rpb25cIikgcmV0dXJuIFJlZmxlY3QubWV0YWRhdGEoaywgdik7XHJcbn07XHJcbnZhciBjb3JlXzEgPSByZXF1aXJlKFwiQGFuZ3VsYXIvY29yZVwiKTtcclxudmFyIGVycm9yX3NlcnZpY2VfMSA9IHJlcXVpcmUoXCIuL2Vycm9yLnNlcnZpY2VcIik7XHJcbnZhciBFcnJvckNvbXBvbmVudCA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBFcnJvckNvbXBvbmVudChfZXJyb3JTdmMpIHtcclxuICAgICAgICB0aGlzLl9lcnJvclN2YyA9IF9lcnJvclN2YztcclxuICAgICAgICB0aGlzLmRpc3BsYXlFcnJvciA9IGZhbHNlO1xyXG4gICAgfVxyXG4gICAgRXJyb3JDb21wb25lbnQucHJvdG90eXBlLm5nT25Jbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5fZXJyb3JTdmMuZXJyb3JPY2N1cnJlZC5zdWJzY3JpYmUoZnVuY3Rpb24gKGVycm9yRGF0YSkge1xyXG4gICAgICAgICAgICBfdGhpcy5lcnJvckRhdGEgPSBlcnJvckRhdGE7XHJcbiAgICAgICAgICAgIF90aGlzLmRpc3BsYXlFcnJvciA9IHRydWU7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgRXJyb3JDb21wb25lbnQgPSBfX2RlY29yYXRlKFtcclxuICAgICAgICBjb3JlXzEuQ29tcG9uZW50KHtcclxuICAgICAgICAgICAgc2VsZWN0b3I6ICdkaXAtZXJyb3InLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZTogcmVxdWlyZSgnLi9lcnJvci5jb21wb25lbnQuaHRtbCcpLFxyXG4gICAgICAgICAgICBzdHlsZXM6IFtyZXF1aXJlKCcuL2Vycm9yLmNvbXBvbmVudC5jc3MnKV1cclxuICAgICAgICB9KSwgXHJcbiAgICAgICAgX19tZXRhZGF0YSgnZGVzaWduOnBhcmFtdHlwZXMnLCBbKHR5cGVvZiAoX2EgPSB0eXBlb2YgZXJyb3Jfc2VydmljZV8xLkVycm9yU2VydmljZSAhPT0gJ3VuZGVmaW5lZCcgJiYgZXJyb3Jfc2VydmljZV8xLkVycm9yU2VydmljZSkgPT09ICdmdW5jdGlvbicgJiYgX2EpIHx8IE9iamVjdF0pXHJcbiAgICBdLCBFcnJvckNvbXBvbmVudCk7XHJcbiAgICByZXR1cm4gRXJyb3JDb21wb25lbnQ7XHJcbiAgICB2YXIgX2E7XHJcbn0oKSk7XHJcbmV4cG9ydHMuRXJyb3JDb21wb25lbnQgPSBFcnJvckNvbXBvbmVudDtcclxuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9hc3NldHMvYXBwL2Vycm9yL2Vycm9yLmNvbXBvbmVudC50c1xuLy8gbW9kdWxlIGlkID0gOTY3XG4vLyBtb2R1bGUgY2h1bmtzID0gMCAxIDIiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=");

/***/ },

/***/ 968:
/***/ function(module, exports, __webpack_require__) {

"use strict";
eval("\"use strict\";\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nvar core_1 = __webpack_require__(1);\r\nvar ComboboxComponent = (function () {\r\n    function ComboboxComponent() {\r\n        this.selectedItem = \"\";\r\n        this.selected = new core_1.EventEmitter();\r\n        this.open = false;\r\n    }\r\n    ComboboxComponent.prototype.ngOnInit = function () {\r\n        this.changeSelectedText(this.selectedItem);\r\n    };\r\n    // emit selected value\r\n    ComboboxComponent.prototype.selectItem = function (value) {\r\n        this.open = false;\r\n        this.selectedItem = value;\r\n        this.selected.emit(this.selectedItem);\r\n        this.changeSelectedText(value);\r\n    };\r\n    // open/close options\r\n    ComboboxComponent.prototype.onOpen = function () {\r\n        this.open = !this.open;\r\n    };\r\n    //get selected item\r\n    ComboboxComponent.prototype.changeSelectedText = function (value) {\r\n        if (value === void 0) { value = \"\"; }\r\n        this.displayed_item = this.items.find(function (item) { return item.value === value; });\r\n        if (!this.displayed_item) {\r\n            this.displayed_item = this.items[0];\r\n        }\r\n    };\r\n    __decorate([\r\n        core_1.Input(), \r\n        __metadata('design:type', Object)\r\n    ], ComboboxComponent.prototype, \"items\", void 0);\r\n    __decorate([\r\n        core_1.Input(), \r\n        __metadata('design:type', String)\r\n    ], ComboboxComponent.prototype, \"selectedItem\", void 0);\r\n    __decorate([\r\n        core_1.Input(), \r\n        __metadata('design:type', String)\r\n    ], ComboboxComponent.prototype, \"cbStyle\", void 0);\r\n    __decorate([\r\n        core_1.Input(), \r\n        __metadata('design:type', String)\r\n    ], ComboboxComponent.prototype, \"label\", void 0);\r\n    __decorate([\r\n        core_1.Output(), \r\n        __metadata('design:type', Object)\r\n    ], ComboboxComponent.prototype, \"selected\", void 0);\r\n    ComboboxComponent = __decorate([\r\n        core_1.Component({\r\n            selector: 'dip-combobox',\r\n            template: __webpack_require__(976),\r\n            styles: [__webpack_require__(981)]\r\n        }), \r\n        __metadata('design:paramtypes', [])\r\n    ], ComboboxComponent);\r\n    return ComboboxComponent;\r\n}());\r\nexports.ComboboxComponent = ComboboxComponent;\r\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTY4LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vYXNzZXRzL2FwcC9zaGFyZWQvY29udHJvbHMvY29tYm9ib3guY29tcG9uZW50LnRzP2MxNDMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XHJcbnZhciBfX2RlY29yYXRlID0gKHRoaXMgJiYgdGhpcy5fX2RlY29yYXRlKSB8fCBmdW5jdGlvbiAoZGVjb3JhdG9ycywgdGFyZ2V0LCBrZXksIGRlc2MpIHtcclxuICAgIHZhciBjID0gYXJndW1lbnRzLmxlbmd0aCwgciA9IGMgPCAzID8gdGFyZ2V0IDogZGVzYyA9PT0gbnVsbCA/IGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHRhcmdldCwga2V5KSA6IGRlc2MsIGQ7XHJcbiAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIFJlZmxlY3QuZGVjb3JhdGUgPT09IFwiZnVuY3Rpb25cIikgciA9IFJlZmxlY3QuZGVjb3JhdGUoZGVjb3JhdG9ycywgdGFyZ2V0LCBrZXksIGRlc2MpO1xyXG4gICAgZWxzZSBmb3IgKHZhciBpID0gZGVjb3JhdG9ycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgaWYgKGQgPSBkZWNvcmF0b3JzW2ldKSByID0gKGMgPCAzID8gZChyKSA6IGMgPiAzID8gZCh0YXJnZXQsIGtleSwgcikgOiBkKHRhcmdldCwga2V5KSkgfHwgcjtcclxuICAgIHJldHVybiBjID4gMyAmJiByICYmIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgciksIHI7XHJcbn07XHJcbnZhciBfX21ldGFkYXRhID0gKHRoaXMgJiYgdGhpcy5fX21ldGFkYXRhKSB8fCBmdW5jdGlvbiAoaywgdikge1xyXG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0Lm1ldGFkYXRhID09PSBcImZ1bmN0aW9uXCIpIHJldHVybiBSZWZsZWN0Lm1ldGFkYXRhKGssIHYpO1xyXG59O1xyXG52YXIgY29yZV8xID0gcmVxdWlyZSgnQGFuZ3VsYXIvY29yZScpO1xyXG52YXIgQ29tYm9ib3hDb21wb25lbnQgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gQ29tYm9ib3hDb21wb25lbnQoKSB7XHJcbiAgICAgICAgdGhpcy5zZWxlY3RlZEl0ZW0gPSBcIlwiO1xyXG4gICAgICAgIHRoaXMuc2VsZWN0ZWQgPSBuZXcgY29yZV8xLkV2ZW50RW1pdHRlcigpO1xyXG4gICAgICAgIHRoaXMub3BlbiA9IGZhbHNlO1xyXG4gICAgfVxyXG4gICAgQ29tYm9ib3hDb21wb25lbnQucHJvdG90eXBlLm5nT25Jbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoaXMuY2hhbmdlU2VsZWN0ZWRUZXh0KHRoaXMuc2VsZWN0ZWRJdGVtKTtcclxuICAgIH07XHJcbiAgICAvLyBlbWl0IHNlbGVjdGVkIHZhbHVlXHJcbiAgICBDb21ib2JveENvbXBvbmVudC5wcm90b3R5cGUuc2VsZWN0SXRlbSA9IGZ1bmN0aW9uICh2YWx1ZSkge1xyXG4gICAgICAgIHRoaXMub3BlbiA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuc2VsZWN0ZWRJdGVtID0gdmFsdWU7XHJcbiAgICAgICAgdGhpcy5zZWxlY3RlZC5lbWl0KHRoaXMuc2VsZWN0ZWRJdGVtKTtcclxuICAgICAgICB0aGlzLmNoYW5nZVNlbGVjdGVkVGV4dCh2YWx1ZSk7XHJcbiAgICB9O1xyXG4gICAgLy8gb3Blbi9jbG9zZSBvcHRpb25zXHJcbiAgICBDb21ib2JveENvbXBvbmVudC5wcm90b3R5cGUub25PcGVuID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoaXMub3BlbiA9ICF0aGlzLm9wZW47XHJcbiAgICB9O1xyXG4gICAgLy9nZXQgc2VsZWN0ZWQgaXRlbVxyXG4gICAgQ29tYm9ib3hDb21wb25lbnQucHJvdG90eXBlLmNoYW5nZVNlbGVjdGVkVGV4dCA9IGZ1bmN0aW9uICh2YWx1ZSkge1xyXG4gICAgICAgIGlmICh2YWx1ZSA9PT0gdm9pZCAwKSB7IHZhbHVlID0gXCJcIjsgfVxyXG4gICAgICAgIHRoaXMuZGlzcGxheWVkX2l0ZW0gPSB0aGlzLml0ZW1zLmZpbmQoZnVuY3Rpb24gKGl0ZW0pIHsgcmV0dXJuIGl0ZW0udmFsdWUgPT09IHZhbHVlOyB9KTtcclxuICAgICAgICBpZiAoIXRoaXMuZGlzcGxheWVkX2l0ZW0pIHtcclxuICAgICAgICAgICAgdGhpcy5kaXNwbGF5ZWRfaXRlbSA9IHRoaXMuaXRlbXNbMF07XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIGNvcmVfMS5JbnB1dCgpLCBcclxuICAgICAgICBfX21ldGFkYXRhKCdkZXNpZ246dHlwZScsIE9iamVjdClcclxuICAgIF0sIENvbWJvYm94Q29tcG9uZW50LnByb3RvdHlwZSwgXCJpdGVtc1wiLCB2b2lkIDApO1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgY29yZV8xLklucHV0KCksIFxyXG4gICAgICAgIF9fbWV0YWRhdGEoJ2Rlc2lnbjp0eXBlJywgU3RyaW5nKVxyXG4gICAgXSwgQ29tYm9ib3hDb21wb25lbnQucHJvdG90eXBlLCBcInNlbGVjdGVkSXRlbVwiLCB2b2lkIDApO1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgY29yZV8xLklucHV0KCksIFxyXG4gICAgICAgIF9fbWV0YWRhdGEoJ2Rlc2lnbjp0eXBlJywgU3RyaW5nKVxyXG4gICAgXSwgQ29tYm9ib3hDb21wb25lbnQucHJvdG90eXBlLCBcImNiU3R5bGVcIiwgdm9pZCAwKTtcclxuICAgIF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIGNvcmVfMS5JbnB1dCgpLCBcclxuICAgICAgICBfX21ldGFkYXRhKCdkZXNpZ246dHlwZScsIFN0cmluZylcclxuICAgIF0sIENvbWJvYm94Q29tcG9uZW50LnByb3RvdHlwZSwgXCJsYWJlbFwiLCB2b2lkIDApO1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgY29yZV8xLk91dHB1dCgpLCBcclxuICAgICAgICBfX21ldGFkYXRhKCdkZXNpZ246dHlwZScsIE9iamVjdClcclxuICAgIF0sIENvbWJvYm94Q29tcG9uZW50LnByb3RvdHlwZSwgXCJzZWxlY3RlZFwiLCB2b2lkIDApO1xyXG4gICAgQ29tYm9ib3hDb21wb25lbnQgPSBfX2RlY29yYXRlKFtcclxuICAgICAgICBjb3JlXzEuQ29tcG9uZW50KHtcclxuICAgICAgICAgICAgc2VsZWN0b3I6ICdkaXAtY29tYm9ib3gnLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZTogcmVxdWlyZSgnLi9jb21ib2JveC5jb21wb25lbnQuaHRtbCcpLFxyXG4gICAgICAgICAgICBzdHlsZXM6IFtyZXF1aXJlKCcuL2NvbWJvYm94LmNvbXBvbmVudC5jc3MnKV1cclxuICAgICAgICB9KSwgXHJcbiAgICAgICAgX19tZXRhZGF0YSgnZGVzaWduOnBhcmFtdHlwZXMnLCBbXSlcclxuICAgIF0sIENvbWJvYm94Q29tcG9uZW50KTtcclxuICAgIHJldHVybiBDb21ib2JveENvbXBvbmVudDtcclxufSgpKTtcclxuZXhwb3J0cy5Db21ib2JveENvbXBvbmVudCA9IENvbWJvYm94Q29tcG9uZW50O1xyXG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL2Fzc2V0cy9hcHAvc2hhcmVkL2NvbnRyb2xzL2NvbWJvYm94LmNvbXBvbmVudC50c1xuLy8gbW9kdWxlIGlkID0gOTY4XG4vLyBtb2R1bGUgY2h1bmtzID0gMCAxIDIiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ },

/***/ 969:
/***/ function(module, exports, __webpack_require__) {

"use strict";
eval("\"use strict\";\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nvar core_1 = __webpack_require__(1);\r\n__webpack_require__(978);\r\nvar TinyMceComponent = (function () {\r\n    function TinyMceComponent() {\r\n        this.onEditorKeyup = new core_1.EventEmitter();\r\n    }\r\n    TinyMceComponent.prototype.ngAfterViewInit = function () {\r\n        var _this = this;\r\n        tinymce.init({\r\n            selector: '#' + this.elementId,\r\n            plugins: ['link', 'paste', 'table', 'code', 'textcolor'],\r\n            toolbar: \"undo redo | styleselect fontsizeselect forecolor | bold italic | alignleft aligncenter alignright | link image | code\",\r\n            fontsize_formats: '8pt 10pt 12pt 14pt 18pt 24pt 36pt',\r\n            menubar: false,\r\n            setup: function (editor) {\r\n                _this.editor = editor;\r\n                editor.on(\"init\", function () {\r\n                    editor.setContent(_this.content || \"\");\r\n                });\r\n                editor.on('change', function () {\r\n                    var content = editor.getContent();\r\n                    _this.onEditorKeyup.emit(content);\r\n                });\r\n            },\r\n        });\r\n    };\r\n    TinyMceComponent.prototype.ngOnDestroy = function () {\r\n        tinymce.remove(this.editor);\r\n    };\r\n    __decorate([\r\n        core_1.Input(), \r\n        __metadata('design:type', Object)\r\n    ], TinyMceComponent.prototype, \"elementId\", void 0);\r\n    __decorate([\r\n        core_1.Input(), \r\n        __metadata('design:type', Object)\r\n    ], TinyMceComponent.prototype, \"content\", void 0);\r\n    __decorate([\r\n        core_1.Output(), \r\n        __metadata('design:type', Object)\r\n    ], TinyMceComponent.prototype, \"onEditorKeyup\", void 0);\r\n    TinyMceComponent = __decorate([\r\n        core_1.Component({\r\n            selector: 'dip-tinymce',\r\n            template: \"<textarea id=\\\"{{elementId}}\\\"></textarea>\"\r\n        }), \r\n        __metadata('design:paramtypes', [])\r\n    ], TinyMceComponent);\r\n    return TinyMceComponent;\r\n}());\r\nexports.TinyMceComponent = TinyMceComponent;\r\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTY5LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vYXNzZXRzL2FwcC9zaGFyZWQvY29udHJvbHMvdGlueW1jZS5jb21wb25lbnQudHM/MTQ5ZSJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcclxudmFyIF9fZGVjb3JhdGUgPSAodGhpcyAmJiB0aGlzLl9fZGVjb3JhdGUpIHx8IGZ1bmN0aW9uIChkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYykge1xyXG4gICAgdmFyIGMgPSBhcmd1bWVudHMubGVuZ3RoLCByID0gYyA8IDMgPyB0YXJnZXQgOiBkZXNjID09PSBudWxsID8gZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGFyZ2V0LCBrZXkpIDogZGVzYywgZDtcclxuICAgIGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgUmVmbGVjdC5kZWNvcmF0ZSA9PT0gXCJmdW5jdGlvblwiKSByID0gUmVmbGVjdC5kZWNvcmF0ZShkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYyk7XHJcbiAgICBlbHNlIGZvciAodmFyIGkgPSBkZWNvcmF0b3JzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSBpZiAoZCA9IGRlY29yYXRvcnNbaV0pIHIgPSAoYyA8IDMgPyBkKHIpIDogYyA+IDMgPyBkKHRhcmdldCwga2V5LCByKSA6IGQodGFyZ2V0LCBrZXkpKSB8fCByO1xyXG4gICAgcmV0dXJuIGMgPiAzICYmIHIgJiYgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCByKSwgcjtcclxufTtcclxudmFyIF9fbWV0YWRhdGEgPSAodGhpcyAmJiB0aGlzLl9fbWV0YWRhdGEpIHx8IGZ1bmN0aW9uIChrLCB2KSB7XHJcbiAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIFJlZmxlY3QubWV0YWRhdGEgPT09IFwiZnVuY3Rpb25cIikgcmV0dXJuIFJlZmxlY3QubWV0YWRhdGEoaywgdik7XHJcbn07XHJcbnZhciBjb3JlXzEgPSByZXF1aXJlKCdAYW5ndWxhci9jb3JlJyk7XHJcbnJlcXVpcmUoJ3RpbnltY2UnKTtcclxudmFyIFRpbnlNY2VDb21wb25lbnQgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gVGlueU1jZUNvbXBvbmVudCgpIHtcclxuICAgICAgICB0aGlzLm9uRWRpdG9yS2V5dXAgPSBuZXcgY29yZV8xLkV2ZW50RW1pdHRlcigpO1xyXG4gICAgfVxyXG4gICAgVGlueU1jZUNvbXBvbmVudC5wcm90b3R5cGUubmdBZnRlclZpZXdJbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdGlueW1jZS5pbml0KHtcclxuICAgICAgICAgICAgc2VsZWN0b3I6ICcjJyArIHRoaXMuZWxlbWVudElkLFxyXG4gICAgICAgICAgICBwbHVnaW5zOiBbJ2xpbmsnLCAncGFzdGUnLCAndGFibGUnLCAnY29kZScsICd0ZXh0Y29sb3InXSxcclxuICAgICAgICAgICAgdG9vbGJhcjogXCJ1bmRvIHJlZG8gfCBzdHlsZXNlbGVjdCBmb250c2l6ZXNlbGVjdCBmb3JlY29sb3IgfCBib2xkIGl0YWxpYyB8IGFsaWdubGVmdCBhbGlnbmNlbnRlciBhbGlnbnJpZ2h0IHwgbGluayBpbWFnZSB8IGNvZGVcIixcclxuICAgICAgICAgICAgZm9udHNpemVfZm9ybWF0czogJzhwdCAxMHB0IDEycHQgMTRwdCAxOHB0IDI0cHQgMzZwdCcsXHJcbiAgICAgICAgICAgIG1lbnViYXI6IGZhbHNlLFxyXG4gICAgICAgICAgICBzZXR1cDogZnVuY3Rpb24gKGVkaXRvcikge1xyXG4gICAgICAgICAgICAgICAgX3RoaXMuZWRpdG9yID0gZWRpdG9yO1xyXG4gICAgICAgICAgICAgICAgZWRpdG9yLm9uKFwiaW5pdFwiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZWRpdG9yLnNldENvbnRlbnQoX3RoaXMuY29udGVudCB8fCBcIlwiKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgZWRpdG9yLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbnRlbnQgPSBlZGl0b3IuZ2V0Q29udGVudCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIF90aGlzLm9uRWRpdG9yS2V5dXAuZW1pdChjb250ZW50KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIFRpbnlNY2VDb21wb25lbnQucHJvdG90eXBlLm5nT25EZXN0cm95ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRpbnltY2UucmVtb3ZlKHRoaXMuZWRpdG9yKTtcclxuICAgIH07XHJcbiAgICBfX2RlY29yYXRlKFtcclxuICAgICAgICBjb3JlXzEuSW5wdXQoKSwgXHJcbiAgICAgICAgX19tZXRhZGF0YSgnZGVzaWduOnR5cGUnLCBPYmplY3QpXHJcbiAgICBdLCBUaW55TWNlQ29tcG9uZW50LnByb3RvdHlwZSwgXCJlbGVtZW50SWRcIiwgdm9pZCAwKTtcclxuICAgIF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIGNvcmVfMS5JbnB1dCgpLCBcclxuICAgICAgICBfX21ldGFkYXRhKCdkZXNpZ246dHlwZScsIE9iamVjdClcclxuICAgIF0sIFRpbnlNY2VDb21wb25lbnQucHJvdG90eXBlLCBcImNvbnRlbnRcIiwgdm9pZCAwKTtcclxuICAgIF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIGNvcmVfMS5PdXRwdXQoKSwgXHJcbiAgICAgICAgX19tZXRhZGF0YSgnZGVzaWduOnR5cGUnLCBPYmplY3QpXHJcbiAgICBdLCBUaW55TWNlQ29tcG9uZW50LnByb3RvdHlwZSwgXCJvbkVkaXRvcktleXVwXCIsIHZvaWQgMCk7XHJcbiAgICBUaW55TWNlQ29tcG9uZW50ID0gX19kZWNvcmF0ZShbXHJcbiAgICAgICAgY29yZV8xLkNvbXBvbmVudCh7XHJcbiAgICAgICAgICAgIHNlbGVjdG9yOiAnZGlwLXRpbnltY2UnLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZTogXCI8dGV4dGFyZWEgaWQ9XFxcInt7ZWxlbWVudElkfX1cXFwiPjwvdGV4dGFyZWE+XCJcclxuICAgICAgICB9KSwgXHJcbiAgICAgICAgX19tZXRhZGF0YSgnZGVzaWduOnBhcmFtdHlwZXMnLCBbXSlcclxuICAgIF0sIFRpbnlNY2VDb21wb25lbnQpO1xyXG4gICAgcmV0dXJuIFRpbnlNY2VDb21wb25lbnQ7XHJcbn0oKSk7XHJcbmV4cG9ydHMuVGlueU1jZUNvbXBvbmVudCA9IFRpbnlNY2VDb21wb25lbnQ7XHJcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vYXNzZXRzL2FwcC9zaGFyZWQvY29udHJvbHMvdGlueW1jZS5jb21wb25lbnQudHNcbi8vIG1vZHVsZSBpZCA9IDk2OVxuLy8gbW9kdWxlIGNodW5rcyA9IDAgMSAyIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=");

/***/ },

/***/ 970:
/***/ function(module, exports, __webpack_require__) {

"use strict";
eval("\"use strict\";\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nvar core_1 = __webpack_require__(1);\r\nvar UploaderComponent = (function () {\r\n    function UploaderComponent() {\r\n        this.hasBaseDropZoneOver = false;\r\n        this.uploadedFile = new core_1.EventEmitter();\r\n        this.response = {};\r\n    }\r\n    UploaderComponent.prototype.ngOnInit = function () {\r\n        this.zone = new core_1.NgZone({ enableLongStackTrace: false });\r\n        if (this.inputOptions) {\r\n            this.options = this.inputOptions;\r\n        }\r\n        else {\r\n            this.options = {\r\n                url: 'http://localhost:10050/upload',\r\n                filterExtensions: true,\r\n                allowedExtensions: ['image/png', 'image/jpg'],\r\n                calculateSpeed: true,\r\n                data: {},\r\n                customHeaders: {\r\n                    'custom-header': 'value'\r\n                }\r\n            };\r\n        }\r\n    };\r\n    UploaderComponent.prototype.handleUpload = function (data) {\r\n        if (data && data.response) {\r\n            //this.response = data;\r\n            //this.progress = Math.floor(data.progress.percent / 100);\r\n            data = JSON.parse(data.response);\r\n            this.uploadedFile.emit(data[0]);\r\n        }\r\n    };\r\n    UploaderComponent.prototype.fileOverBase = function (e) {\r\n        this.hasBaseDropZoneOver = e;\r\n    };\r\n    UploaderComponent.prototype.deleteImage = function () {\r\n        this.hasBaseDropZoneOver = false;\r\n        this.uploadedFile.emit(null);\r\n    };\r\n    __decorate([\r\n        core_1.Input(), \r\n        __metadata('design:type', Object)\r\n    ], UploaderComponent.prototype, \"inputFile\", void 0);\r\n    __decorate([\r\n        core_1.Input(), \r\n        __metadata('design:type', Object)\r\n    ], UploaderComponent.prototype, \"inputOptions\", void 0);\r\n    __decorate([\r\n        core_1.Input(), \r\n        __metadata('design:type', Object)\r\n    ], UploaderComponent.prototype, \"width\", void 0);\r\n    __decorate([\r\n        core_1.Output(), \r\n        __metadata('design:type', Object)\r\n    ], UploaderComponent.prototype, \"uploadedFile\", void 0);\r\n    UploaderComponent = __decorate([\r\n        core_1.Component({\r\n            selector: 'dip-uploader',\r\n            template: __webpack_require__(977),\r\n            styles: [__webpack_require__(982)]\r\n        }), \r\n        __metadata('design:paramtypes', [])\r\n    ], UploaderComponent);\r\n    return UploaderComponent;\r\n}());\r\nexports.UploaderComponent = UploaderComponent;\r\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTcwLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vYXNzZXRzL2FwcC9zaGFyZWQvY29udHJvbHMvdXBsb2FkZXIvdXBsb2FkZXIuY29tcG9uZW50LnRzP2RjNzgiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XHJcbnZhciBfX2RlY29yYXRlID0gKHRoaXMgJiYgdGhpcy5fX2RlY29yYXRlKSB8fCBmdW5jdGlvbiAoZGVjb3JhdG9ycywgdGFyZ2V0LCBrZXksIGRlc2MpIHtcclxuICAgIHZhciBjID0gYXJndW1lbnRzLmxlbmd0aCwgciA9IGMgPCAzID8gdGFyZ2V0IDogZGVzYyA9PT0gbnVsbCA/IGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHRhcmdldCwga2V5KSA6IGRlc2MsIGQ7XHJcbiAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIFJlZmxlY3QuZGVjb3JhdGUgPT09IFwiZnVuY3Rpb25cIikgciA9IFJlZmxlY3QuZGVjb3JhdGUoZGVjb3JhdG9ycywgdGFyZ2V0LCBrZXksIGRlc2MpO1xyXG4gICAgZWxzZSBmb3IgKHZhciBpID0gZGVjb3JhdG9ycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgaWYgKGQgPSBkZWNvcmF0b3JzW2ldKSByID0gKGMgPCAzID8gZChyKSA6IGMgPiAzID8gZCh0YXJnZXQsIGtleSwgcikgOiBkKHRhcmdldCwga2V5KSkgfHwgcjtcclxuICAgIHJldHVybiBjID4gMyAmJiByICYmIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgciksIHI7XHJcbn07XHJcbnZhciBfX21ldGFkYXRhID0gKHRoaXMgJiYgdGhpcy5fX21ldGFkYXRhKSB8fCBmdW5jdGlvbiAoaywgdikge1xyXG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0Lm1ldGFkYXRhID09PSBcImZ1bmN0aW9uXCIpIHJldHVybiBSZWZsZWN0Lm1ldGFkYXRhKGssIHYpO1xyXG59O1xyXG52YXIgY29yZV8xID0gcmVxdWlyZShcIkBhbmd1bGFyL2NvcmVcIik7XHJcbnZhciBVcGxvYWRlckNvbXBvbmVudCA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBVcGxvYWRlckNvbXBvbmVudCgpIHtcclxuICAgICAgICB0aGlzLmhhc0Jhc2VEcm9wWm9uZU92ZXIgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLnVwbG9hZGVkRmlsZSA9IG5ldyBjb3JlXzEuRXZlbnRFbWl0dGVyKCk7XHJcbiAgICAgICAgdGhpcy5yZXNwb25zZSA9IHt9O1xyXG4gICAgfVxyXG4gICAgVXBsb2FkZXJDb21wb25lbnQucHJvdG90eXBlLm5nT25Jbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoaXMuem9uZSA9IG5ldyBjb3JlXzEuTmdab25lKHsgZW5hYmxlTG9uZ1N0YWNrVHJhY2U6IGZhbHNlIH0pO1xyXG4gICAgICAgIGlmICh0aGlzLmlucHV0T3B0aW9ucykge1xyXG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMgPSB0aGlzLmlucHV0T3B0aW9ucztcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgICAgIHVybDogJ2h0dHA6Ly9sb2NhbGhvc3Q6MTAwNTAvdXBsb2FkJyxcclxuICAgICAgICAgICAgICAgIGZpbHRlckV4dGVuc2lvbnM6IHRydWUsXHJcbiAgICAgICAgICAgICAgICBhbGxvd2VkRXh0ZW5zaW9uczogWydpbWFnZS9wbmcnLCAnaW1hZ2UvanBnJ10sXHJcbiAgICAgICAgICAgICAgICBjYWxjdWxhdGVTcGVlZDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIGRhdGE6IHt9LFxyXG4gICAgICAgICAgICAgICAgY3VzdG9tSGVhZGVyczoge1xyXG4gICAgICAgICAgICAgICAgICAgICdjdXN0b20taGVhZGVyJzogJ3ZhbHVlJ1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBVcGxvYWRlckNvbXBvbmVudC5wcm90b3R5cGUuaGFuZGxlVXBsb2FkID0gZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICBpZiAoZGF0YSAmJiBkYXRhLnJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIC8vdGhpcy5yZXNwb25zZSA9IGRhdGE7XHJcbiAgICAgICAgICAgIC8vdGhpcy5wcm9ncmVzcyA9IE1hdGguZmxvb3IoZGF0YS5wcm9ncmVzcy5wZXJjZW50IC8gMTAwKTtcclxuICAgICAgICAgICAgZGF0YSA9IEpTT04ucGFyc2UoZGF0YS5yZXNwb25zZSk7XHJcbiAgICAgICAgICAgIHRoaXMudXBsb2FkZWRGaWxlLmVtaXQoZGF0YVswXSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFVwbG9hZGVyQ29tcG9uZW50LnByb3RvdHlwZS5maWxlT3ZlckJhc2UgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgIHRoaXMuaGFzQmFzZURyb3Bab25lT3ZlciA9IGU7XHJcbiAgICB9O1xyXG4gICAgVXBsb2FkZXJDb21wb25lbnQucHJvdG90eXBlLmRlbGV0ZUltYWdlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoaXMuaGFzQmFzZURyb3Bab25lT3ZlciA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMudXBsb2FkZWRGaWxlLmVtaXQobnVsbCk7XHJcbiAgICB9O1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgY29yZV8xLklucHV0KCksIFxyXG4gICAgICAgIF9fbWV0YWRhdGEoJ2Rlc2lnbjp0eXBlJywgT2JqZWN0KVxyXG4gICAgXSwgVXBsb2FkZXJDb21wb25lbnQucHJvdG90eXBlLCBcImlucHV0RmlsZVwiLCB2b2lkIDApO1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgY29yZV8xLklucHV0KCksIFxyXG4gICAgICAgIF9fbWV0YWRhdGEoJ2Rlc2lnbjp0eXBlJywgT2JqZWN0KVxyXG4gICAgXSwgVXBsb2FkZXJDb21wb25lbnQucHJvdG90eXBlLCBcImlucHV0T3B0aW9uc1wiLCB2b2lkIDApO1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgY29yZV8xLklucHV0KCksIFxyXG4gICAgICAgIF9fbWV0YWRhdGEoJ2Rlc2lnbjp0eXBlJywgT2JqZWN0KVxyXG4gICAgXSwgVXBsb2FkZXJDb21wb25lbnQucHJvdG90eXBlLCBcIndpZHRoXCIsIHZvaWQgMCk7XHJcbiAgICBfX2RlY29yYXRlKFtcclxuICAgICAgICBjb3JlXzEuT3V0cHV0KCksIFxyXG4gICAgICAgIF9fbWV0YWRhdGEoJ2Rlc2lnbjp0eXBlJywgT2JqZWN0KVxyXG4gICAgXSwgVXBsb2FkZXJDb21wb25lbnQucHJvdG90eXBlLCBcInVwbG9hZGVkRmlsZVwiLCB2b2lkIDApO1xyXG4gICAgVXBsb2FkZXJDb21wb25lbnQgPSBfX2RlY29yYXRlKFtcclxuICAgICAgICBjb3JlXzEuQ29tcG9uZW50KHtcclxuICAgICAgICAgICAgc2VsZWN0b3I6ICdkaXAtdXBsb2FkZXInLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZTogcmVxdWlyZSgnLi91cGxvYWRlci5jb21wb25lbnQuaHRtbCcpLFxyXG4gICAgICAgICAgICBzdHlsZXM6IFtyZXF1aXJlKCcuL3VwbG9hZGVyLmNvbXBvbmVudC5jc3MnKV1cclxuICAgICAgICB9KSwgXHJcbiAgICAgICAgX19tZXRhZGF0YSgnZGVzaWduOnBhcmFtdHlwZXMnLCBbXSlcclxuICAgIF0sIFVwbG9hZGVyQ29tcG9uZW50KTtcclxuICAgIHJldHVybiBVcGxvYWRlckNvbXBvbmVudDtcclxufSgpKTtcclxuZXhwb3J0cy5VcGxvYWRlckNvbXBvbmVudCA9IFVwbG9hZGVyQ29tcG9uZW50O1xyXG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL2Fzc2V0cy9hcHAvc2hhcmVkL2NvbnRyb2xzL3VwbG9hZGVyL3VwbG9hZGVyLmNvbXBvbmVudC50c1xuLy8gbW9kdWxlIGlkID0gOTcwXG4vLyBtb2R1bGUgY2h1bmtzID0gMCAxIDIiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9");

/***/ },

/***/ 971:
/***/ function(module, exports, __webpack_require__) {

"use strict";
eval("\"use strict\";\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nvar core_1 = __webpack_require__(1);\r\nvar FormatedPrice = (function () {\r\n    function FormatedPrice() {\r\n    }\r\n    FormatedPrice.prototype.transform = function (price) {\r\n        if (!price) {\r\n            return 0;\r\n        }\r\n        return (price / 100).toFixed(2);\r\n    };\r\n    FormatedPrice = __decorate([\r\n        core_1.Pipe({\r\n            name: 'formatedPrice'\r\n        }), \r\n        __metadata('design:paramtypes', [])\r\n    ], FormatedPrice);\r\n    return FormatedPrice;\r\n}());\r\nexports.FormatedPrice = FormatedPrice;\r\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTcxLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vYXNzZXRzL2FwcC9zaGFyZWQvcGlwZXMvZm9ybWF0ZWQtcHJpY2UucGlwZS50cz9hMWM0Il0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xyXG52YXIgX19kZWNvcmF0ZSA9ICh0aGlzICYmIHRoaXMuX19kZWNvcmF0ZSkgfHwgZnVuY3Rpb24gKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKSB7XHJcbiAgICB2YXIgYyA9IGFyZ3VtZW50cy5sZW5ndGgsIHIgPSBjIDwgMyA/IHRhcmdldCA6IGRlc2MgPT09IG51bGwgPyBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0YXJnZXQsIGtleSkgOiBkZXNjLCBkO1xyXG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0LmRlY29yYXRlID09PSBcImZ1bmN0aW9uXCIpIHIgPSBSZWZsZWN0LmRlY29yYXRlKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKTtcclxuICAgIGVsc2UgZm9yICh2YXIgaSA9IGRlY29yYXRvcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIGlmIChkID0gZGVjb3JhdG9yc1tpXSkgciA9IChjIDwgMyA/IGQocikgOiBjID4gMyA/IGQodGFyZ2V0LCBrZXksIHIpIDogZCh0YXJnZXQsIGtleSkpIHx8IHI7XHJcbiAgICByZXR1cm4gYyA+IDMgJiYgciAmJiBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHIpLCByO1xyXG59O1xyXG52YXIgX19tZXRhZGF0YSA9ICh0aGlzICYmIHRoaXMuX19tZXRhZGF0YSkgfHwgZnVuY3Rpb24gKGssIHYpIHtcclxuICAgIGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgUmVmbGVjdC5tZXRhZGF0YSA9PT0gXCJmdW5jdGlvblwiKSByZXR1cm4gUmVmbGVjdC5tZXRhZGF0YShrLCB2KTtcclxufTtcclxudmFyIGNvcmVfMSA9IHJlcXVpcmUoXCJAYW5ndWxhci9jb3JlXCIpO1xyXG52YXIgRm9ybWF0ZWRQcmljZSA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBGb3JtYXRlZFByaWNlKCkge1xyXG4gICAgfVxyXG4gICAgRm9ybWF0ZWRQcmljZS5wcm90b3R5cGUudHJhbnNmb3JtID0gZnVuY3Rpb24gKHByaWNlKSB7XHJcbiAgICAgICAgaWYgKCFwcmljZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIChwcmljZSAvIDEwMCkudG9GaXhlZCgyKTtcclxuICAgIH07XHJcbiAgICBGb3JtYXRlZFByaWNlID0gX19kZWNvcmF0ZShbXHJcbiAgICAgICAgY29yZV8xLlBpcGUoe1xyXG4gICAgICAgICAgICBuYW1lOiAnZm9ybWF0ZWRQcmljZSdcclxuICAgICAgICB9KSwgXHJcbiAgICAgICAgX19tZXRhZGF0YSgnZGVzaWduOnBhcmFtdHlwZXMnLCBbXSlcclxuICAgIF0sIEZvcm1hdGVkUHJpY2UpO1xyXG4gICAgcmV0dXJuIEZvcm1hdGVkUHJpY2U7XHJcbn0oKSk7XHJcbmV4cG9ydHMuRm9ybWF0ZWRQcmljZSA9IEZvcm1hdGVkUHJpY2U7XHJcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vYXNzZXRzL2FwcC9zaGFyZWQvcGlwZXMvZm9ybWF0ZWQtcHJpY2UucGlwZS50c1xuLy8gbW9kdWxlIGlkID0gOTcxXG4vLyBtb2R1bGUgY2h1bmtzID0gMCAxIDIiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9");

/***/ },

/***/ 972:
/***/ function(module, exports, __webpack_require__) {

"use strict";
eval("\"use strict\";\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nvar core_1 = __webpack_require__(1);\r\nvar platform_browser_1 = __webpack_require__(175);\r\nvar SanitizeHtml = (function () {\r\n    function SanitizeHtml(_sanitizer) {\r\n        this._sanitizer = _sanitizer;\r\n    }\r\n    SanitizeHtml.prototype.transform = function (v) {\r\n        if (!v) {\r\n            return \"\";\r\n        }\r\n        return this._sanitizer.bypassSecurityTrustHtml(v);\r\n    };\r\n    SanitizeHtml = __decorate([\r\n        core_1.Pipe({\r\n            name: 'sanitizeHtml'\r\n        }), \r\n        __metadata('design:paramtypes', [(typeof (_a = typeof platform_browser_1.DomSanitizer !== 'undefined' && platform_browser_1.DomSanitizer) === 'function' && _a) || Object])\r\n    ], SanitizeHtml);\r\n    return SanitizeHtml;\r\n    var _a;\r\n}());\r\nexports.SanitizeHtml = SanitizeHtml;\r\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTcyLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vYXNzZXRzL2FwcC9zaGFyZWQvcGlwZXMvc2FuaXRpemUtaHRtbC5waXBlLnRzP2Y1MjkiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XHJcbnZhciBfX2RlY29yYXRlID0gKHRoaXMgJiYgdGhpcy5fX2RlY29yYXRlKSB8fCBmdW5jdGlvbiAoZGVjb3JhdG9ycywgdGFyZ2V0LCBrZXksIGRlc2MpIHtcclxuICAgIHZhciBjID0gYXJndW1lbnRzLmxlbmd0aCwgciA9IGMgPCAzID8gdGFyZ2V0IDogZGVzYyA9PT0gbnVsbCA/IGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHRhcmdldCwga2V5KSA6IGRlc2MsIGQ7XHJcbiAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIFJlZmxlY3QuZGVjb3JhdGUgPT09IFwiZnVuY3Rpb25cIikgciA9IFJlZmxlY3QuZGVjb3JhdGUoZGVjb3JhdG9ycywgdGFyZ2V0LCBrZXksIGRlc2MpO1xyXG4gICAgZWxzZSBmb3IgKHZhciBpID0gZGVjb3JhdG9ycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgaWYgKGQgPSBkZWNvcmF0b3JzW2ldKSByID0gKGMgPCAzID8gZChyKSA6IGMgPiAzID8gZCh0YXJnZXQsIGtleSwgcikgOiBkKHRhcmdldCwga2V5KSkgfHwgcjtcclxuICAgIHJldHVybiBjID4gMyAmJiByICYmIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgciksIHI7XHJcbn07XHJcbnZhciBfX21ldGFkYXRhID0gKHRoaXMgJiYgdGhpcy5fX21ldGFkYXRhKSB8fCBmdW5jdGlvbiAoaywgdikge1xyXG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0Lm1ldGFkYXRhID09PSBcImZ1bmN0aW9uXCIpIHJldHVybiBSZWZsZWN0Lm1ldGFkYXRhKGssIHYpO1xyXG59O1xyXG52YXIgY29yZV8xID0gcmVxdWlyZShcIkBhbmd1bGFyL2NvcmVcIik7XHJcbnZhciBwbGF0Zm9ybV9icm93c2VyXzEgPSByZXF1aXJlKFwiQGFuZ3VsYXIvcGxhdGZvcm0tYnJvd3NlclwiKTtcclxudmFyIFNhbml0aXplSHRtbCA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBTYW5pdGl6ZUh0bWwoX3Nhbml0aXplcikge1xyXG4gICAgICAgIHRoaXMuX3Nhbml0aXplciA9IF9zYW5pdGl6ZXI7XHJcbiAgICB9XHJcbiAgICBTYW5pdGl6ZUh0bWwucHJvdG90eXBlLnRyYW5zZm9ybSA9IGZ1bmN0aW9uICh2KSB7XHJcbiAgICAgICAgaWYgKCF2KSB7XHJcbiAgICAgICAgICAgIHJldHVybiBcIlwiO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5fc2FuaXRpemVyLmJ5cGFzc1NlY3VyaXR5VHJ1c3RIdG1sKHYpO1xyXG4gICAgfTtcclxuICAgIFNhbml0aXplSHRtbCA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIGNvcmVfMS5QaXBlKHtcclxuICAgICAgICAgICAgbmFtZTogJ3Nhbml0aXplSHRtbCdcclxuICAgICAgICB9KSwgXHJcbiAgICAgICAgX19tZXRhZGF0YSgnZGVzaWduOnBhcmFtdHlwZXMnLCBbKHR5cGVvZiAoX2EgPSB0eXBlb2YgcGxhdGZvcm1fYnJvd3Nlcl8xLkRvbVNhbml0aXplciAhPT0gJ3VuZGVmaW5lZCcgJiYgcGxhdGZvcm1fYnJvd3Nlcl8xLkRvbVNhbml0aXplcikgPT09ICdmdW5jdGlvbicgJiYgX2EpIHx8IE9iamVjdF0pXHJcbiAgICBdLCBTYW5pdGl6ZUh0bWwpO1xyXG4gICAgcmV0dXJuIFNhbml0aXplSHRtbDtcclxuICAgIHZhciBfYTtcclxufSgpKTtcclxuZXhwb3J0cy5TYW5pdGl6ZUh0bWwgPSBTYW5pdGl6ZUh0bWw7XHJcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vYXNzZXRzL2FwcC9zaGFyZWQvcGlwZXMvc2FuaXRpemUtaHRtbC5waXBlLnRzXG4vLyBtb2R1bGUgaWQgPSA5NzJcbi8vIG1vZHVsZSBjaHVua3MgPSAwIDEgMiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=");

/***/ },

/***/ 973:
/***/ function(module, exports, __webpack_require__) {

"use strict";
eval("\"use strict\";\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nvar core_1 = __webpack_require__(1);\r\nvar platform_browser_1 = __webpack_require__(175);\r\nvar SanitizeUrl = (function () {\r\n    function SanitizeUrl(_sanitizer) {\r\n        this._sanitizer = _sanitizer;\r\n    }\r\n    SanitizeUrl.prototype.transform = function (v) {\r\n        console.log(v);\r\n        if (!v) {\r\n            return \"\";\r\n        }\r\n        return this._sanitizer.bypassSecurityTrustResourceUrl(v);\r\n    };\r\n    SanitizeUrl = __decorate([\r\n        core_1.Pipe({\r\n            name: 'sanitizeUrl'\r\n        }), \r\n        __metadata('design:paramtypes', [(typeof (_a = typeof platform_browser_1.DomSanitizer !== 'undefined' && platform_browser_1.DomSanitizer) === 'function' && _a) || Object])\r\n    ], SanitizeUrl);\r\n    return SanitizeUrl;\r\n    var _a;\r\n}());\r\nexports.SanitizeUrl = SanitizeUrl;\r\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTczLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vYXNzZXRzL2FwcC9zaGFyZWQvcGlwZXMvc2FuaXRpemUtdXJsLnBpcGUudHM/N2ViMSJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcclxudmFyIF9fZGVjb3JhdGUgPSAodGhpcyAmJiB0aGlzLl9fZGVjb3JhdGUpIHx8IGZ1bmN0aW9uIChkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYykge1xyXG4gICAgdmFyIGMgPSBhcmd1bWVudHMubGVuZ3RoLCByID0gYyA8IDMgPyB0YXJnZXQgOiBkZXNjID09PSBudWxsID8gZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGFyZ2V0LCBrZXkpIDogZGVzYywgZDtcclxuICAgIGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgUmVmbGVjdC5kZWNvcmF0ZSA9PT0gXCJmdW5jdGlvblwiKSByID0gUmVmbGVjdC5kZWNvcmF0ZShkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYyk7XHJcbiAgICBlbHNlIGZvciAodmFyIGkgPSBkZWNvcmF0b3JzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSBpZiAoZCA9IGRlY29yYXRvcnNbaV0pIHIgPSAoYyA8IDMgPyBkKHIpIDogYyA+IDMgPyBkKHRhcmdldCwga2V5LCByKSA6IGQodGFyZ2V0LCBrZXkpKSB8fCByO1xyXG4gICAgcmV0dXJuIGMgPiAzICYmIHIgJiYgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCByKSwgcjtcclxufTtcclxudmFyIF9fbWV0YWRhdGEgPSAodGhpcyAmJiB0aGlzLl9fbWV0YWRhdGEpIHx8IGZ1bmN0aW9uIChrLCB2KSB7XHJcbiAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIFJlZmxlY3QubWV0YWRhdGEgPT09IFwiZnVuY3Rpb25cIikgcmV0dXJuIFJlZmxlY3QubWV0YWRhdGEoaywgdik7XHJcbn07XHJcbnZhciBjb3JlXzEgPSByZXF1aXJlKFwiQGFuZ3VsYXIvY29yZVwiKTtcclxudmFyIHBsYXRmb3JtX2Jyb3dzZXJfMSA9IHJlcXVpcmUoXCJAYW5ndWxhci9wbGF0Zm9ybS1icm93c2VyXCIpO1xyXG52YXIgU2FuaXRpemVVcmwgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gU2FuaXRpemVVcmwoX3Nhbml0aXplcikge1xyXG4gICAgICAgIHRoaXMuX3Nhbml0aXplciA9IF9zYW5pdGl6ZXI7XHJcbiAgICB9XHJcbiAgICBTYW5pdGl6ZVVybC5wcm90b3R5cGUudHJhbnNmb3JtID0gZnVuY3Rpb24gKHYpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyh2KTtcclxuICAgICAgICBpZiAoIXYpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFwiXCI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLl9zYW5pdGl6ZXIuYnlwYXNzU2VjdXJpdHlUcnVzdFJlc291cmNlVXJsKHYpO1xyXG4gICAgfTtcclxuICAgIFNhbml0aXplVXJsID0gX19kZWNvcmF0ZShbXHJcbiAgICAgICAgY29yZV8xLlBpcGUoe1xyXG4gICAgICAgICAgICBuYW1lOiAnc2FuaXRpemVVcmwnXHJcbiAgICAgICAgfSksIFxyXG4gICAgICAgIF9fbWV0YWRhdGEoJ2Rlc2lnbjpwYXJhbXR5cGVzJywgWyh0eXBlb2YgKF9hID0gdHlwZW9mIHBsYXRmb3JtX2Jyb3dzZXJfMS5Eb21TYW5pdGl6ZXIgIT09ICd1bmRlZmluZWQnICYmIHBsYXRmb3JtX2Jyb3dzZXJfMS5Eb21TYW5pdGl6ZXIpID09PSAnZnVuY3Rpb24nICYmIF9hKSB8fCBPYmplY3RdKVxyXG4gICAgXSwgU2FuaXRpemVVcmwpO1xyXG4gICAgcmV0dXJuIFNhbml0aXplVXJsO1xyXG4gICAgdmFyIF9hO1xyXG59KCkpO1xyXG5leHBvcnRzLlNhbml0aXplVXJsID0gU2FuaXRpemVVcmw7XHJcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vYXNzZXRzL2FwcC9zaGFyZWQvcGlwZXMvc2FuaXRpemUtdXJsLnBpcGUudHNcbi8vIG1vZHVsZSBpZCA9IDk3M1xuLy8gbW9kdWxlIGNodW5rcyA9IDAgMSAyIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9");

/***/ },

/***/ 974:
/***/ function(module, exports, __webpack_require__) {

"use strict";
eval("\"use strict\";\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nvar core_1 = __webpack_require__(1);\r\nvar common_1 = __webpack_require__(124);\r\nvar error_component_1 = __webpack_require__(967);\r\nvar forms_1 = __webpack_require__(417);\r\nvar combobox_component_1 = __webpack_require__(968);\r\nvar uploader_component_1 = __webpack_require__(970);\r\nvar ng2_uploader_1 = __webpack_require__(965);\r\nvar tinymce_component_1 = __webpack_require__(969);\r\nvar sanitize_html_pipe_1 = __webpack_require__(972);\r\nvar sanitize_url_pipe_1 = __webpack_require__(973);\r\nvar formated_price_pipe_1 = __webpack_require__(971);\r\nvar SharedModule = (function () {\r\n    function SharedModule() {\r\n    }\r\n    SharedModule = __decorate([\r\n        core_1.NgModule({\r\n            imports: [\r\n                common_1.CommonModule,\r\n                forms_1.FormsModule,\r\n                ng2_uploader_1.Ng2UploaderModule,\r\n            ],\r\n            declarations: [\r\n                error_component_1.ErrorComponent,\r\n                combobox_component_1.ComboboxComponent,\r\n                uploader_component_1.UploaderComponent,\r\n                tinymce_component_1.TinyMceComponent,\r\n                sanitize_html_pipe_1.SanitizeHtml,\r\n                sanitize_url_pipe_1.SanitizeUrl,\r\n                formated_price_pipe_1.FormatedPrice\r\n            ],\r\n            exports: [\r\n                error_component_1.ErrorComponent,\r\n                combobox_component_1.ComboboxComponent,\r\n                uploader_component_1.UploaderComponent,\r\n                tinymce_component_1.TinyMceComponent,\r\n                sanitize_html_pipe_1.SanitizeHtml,\r\n                sanitize_url_pipe_1.SanitizeUrl,\r\n                formated_price_pipe_1.FormatedPrice\r\n            ]\r\n        }), \r\n        __metadata('design:paramtypes', [])\r\n    ], SharedModule);\r\n    return SharedModule;\r\n}());\r\nexports.SharedModule = SharedModule;\r\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTc0LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vYXNzZXRzL2FwcC9zaGFyZWQvc2hhcmVkLm1vZHVsZS50cz83MjZhIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xyXG52YXIgX19kZWNvcmF0ZSA9ICh0aGlzICYmIHRoaXMuX19kZWNvcmF0ZSkgfHwgZnVuY3Rpb24gKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKSB7XHJcbiAgICB2YXIgYyA9IGFyZ3VtZW50cy5sZW5ndGgsIHIgPSBjIDwgMyA/IHRhcmdldCA6IGRlc2MgPT09IG51bGwgPyBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0YXJnZXQsIGtleSkgOiBkZXNjLCBkO1xyXG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0LmRlY29yYXRlID09PSBcImZ1bmN0aW9uXCIpIHIgPSBSZWZsZWN0LmRlY29yYXRlKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKTtcclxuICAgIGVsc2UgZm9yICh2YXIgaSA9IGRlY29yYXRvcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIGlmIChkID0gZGVjb3JhdG9yc1tpXSkgciA9IChjIDwgMyA/IGQocikgOiBjID4gMyA/IGQodGFyZ2V0LCBrZXksIHIpIDogZCh0YXJnZXQsIGtleSkpIHx8IHI7XHJcbiAgICByZXR1cm4gYyA+IDMgJiYgciAmJiBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHIpLCByO1xyXG59O1xyXG52YXIgX19tZXRhZGF0YSA9ICh0aGlzICYmIHRoaXMuX19tZXRhZGF0YSkgfHwgZnVuY3Rpb24gKGssIHYpIHtcclxuICAgIGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgUmVmbGVjdC5tZXRhZGF0YSA9PT0gXCJmdW5jdGlvblwiKSByZXR1cm4gUmVmbGVjdC5tZXRhZGF0YShrLCB2KTtcclxufTtcclxudmFyIGNvcmVfMSA9IHJlcXVpcmUoXCJAYW5ndWxhci9jb3JlXCIpO1xyXG52YXIgY29tbW9uXzEgPSByZXF1aXJlKFwiQGFuZ3VsYXIvY29tbW9uXCIpO1xyXG52YXIgZXJyb3JfY29tcG9uZW50XzEgPSByZXF1aXJlKFwiLi4vZXJyb3IvZXJyb3IuY29tcG9uZW50XCIpO1xyXG52YXIgZm9ybXNfMSA9IHJlcXVpcmUoXCJAYW5ndWxhci9mb3Jtc1wiKTtcclxudmFyIGNvbWJvYm94X2NvbXBvbmVudF8xID0gcmVxdWlyZShcIi4vY29udHJvbHMvY29tYm9ib3guY29tcG9uZW50XCIpO1xyXG52YXIgdXBsb2FkZXJfY29tcG9uZW50XzEgPSByZXF1aXJlKFwiLi9jb250cm9scy91cGxvYWRlci91cGxvYWRlci5jb21wb25lbnRcIik7XHJcbnZhciBuZzJfdXBsb2FkZXJfMSA9IHJlcXVpcmUoXCJuZzItdXBsb2FkZXJcIik7XHJcbnZhciB0aW55bWNlX2NvbXBvbmVudF8xID0gcmVxdWlyZShcIi4vY29udHJvbHMvdGlueW1jZS5jb21wb25lbnRcIik7XHJcbnZhciBzYW5pdGl6ZV9odG1sX3BpcGVfMSA9IHJlcXVpcmUoXCIuL3BpcGVzL3Nhbml0aXplLWh0bWwucGlwZVwiKTtcclxudmFyIHNhbml0aXplX3VybF9waXBlXzEgPSByZXF1aXJlKFwiLi9waXBlcy9zYW5pdGl6ZS11cmwucGlwZVwiKTtcclxudmFyIGZvcm1hdGVkX3ByaWNlX3BpcGVfMSA9IHJlcXVpcmUoXCIuL3BpcGVzL2Zvcm1hdGVkLXByaWNlLnBpcGVcIik7XHJcbnZhciBTaGFyZWRNb2R1bGUgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gU2hhcmVkTW9kdWxlKCkge1xyXG4gICAgfVxyXG4gICAgU2hhcmVkTW9kdWxlID0gX19kZWNvcmF0ZShbXHJcbiAgICAgICAgY29yZV8xLk5nTW9kdWxlKHtcclxuICAgICAgICAgICAgaW1wb3J0czogW1xyXG4gICAgICAgICAgICAgICAgY29tbW9uXzEuQ29tbW9uTW9kdWxlLFxyXG4gICAgICAgICAgICAgICAgZm9ybXNfMS5Gb3Jtc01vZHVsZSxcclxuICAgICAgICAgICAgICAgIG5nMl91cGxvYWRlcl8xLk5nMlVwbG9hZGVyTW9kdWxlLFxyXG4gICAgICAgICAgICBdLFxyXG4gICAgICAgICAgICBkZWNsYXJhdGlvbnM6IFtcclxuICAgICAgICAgICAgICAgIGVycm9yX2NvbXBvbmVudF8xLkVycm9yQ29tcG9uZW50LFxyXG4gICAgICAgICAgICAgICAgY29tYm9ib3hfY29tcG9uZW50XzEuQ29tYm9ib3hDb21wb25lbnQsXHJcbiAgICAgICAgICAgICAgICB1cGxvYWRlcl9jb21wb25lbnRfMS5VcGxvYWRlckNvbXBvbmVudCxcclxuICAgICAgICAgICAgICAgIHRpbnltY2VfY29tcG9uZW50XzEuVGlueU1jZUNvbXBvbmVudCxcclxuICAgICAgICAgICAgICAgIHNhbml0aXplX2h0bWxfcGlwZV8xLlNhbml0aXplSHRtbCxcclxuICAgICAgICAgICAgICAgIHNhbml0aXplX3VybF9waXBlXzEuU2FuaXRpemVVcmwsXHJcbiAgICAgICAgICAgICAgICBmb3JtYXRlZF9wcmljZV9waXBlXzEuRm9ybWF0ZWRQcmljZVxyXG4gICAgICAgICAgICBdLFxyXG4gICAgICAgICAgICBleHBvcnRzOiBbXHJcbiAgICAgICAgICAgICAgICBlcnJvcl9jb21wb25lbnRfMS5FcnJvckNvbXBvbmVudCxcclxuICAgICAgICAgICAgICAgIGNvbWJvYm94X2NvbXBvbmVudF8xLkNvbWJvYm94Q29tcG9uZW50LFxyXG4gICAgICAgICAgICAgICAgdXBsb2FkZXJfY29tcG9uZW50XzEuVXBsb2FkZXJDb21wb25lbnQsXHJcbiAgICAgICAgICAgICAgICB0aW55bWNlX2NvbXBvbmVudF8xLlRpbnlNY2VDb21wb25lbnQsXHJcbiAgICAgICAgICAgICAgICBzYW5pdGl6ZV9odG1sX3BpcGVfMS5TYW5pdGl6ZUh0bWwsXHJcbiAgICAgICAgICAgICAgICBzYW5pdGl6ZV91cmxfcGlwZV8xLlNhbml0aXplVXJsLFxyXG4gICAgICAgICAgICAgICAgZm9ybWF0ZWRfcHJpY2VfcGlwZV8xLkZvcm1hdGVkUHJpY2VcclxuICAgICAgICAgICAgXVxyXG4gICAgICAgIH0pLCBcclxuICAgICAgICBfX21ldGFkYXRhKCdkZXNpZ246cGFyYW10eXBlcycsIFtdKVxyXG4gICAgXSwgU2hhcmVkTW9kdWxlKTtcclxuICAgIHJldHVybiBTaGFyZWRNb2R1bGU7XHJcbn0oKSk7XHJcbmV4cG9ydHMuU2hhcmVkTW9kdWxlID0gU2hhcmVkTW9kdWxlO1xyXG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL2Fzc2V0cy9hcHAvc2hhcmVkL3NoYXJlZC5tb2R1bGUudHNcbi8vIG1vZHVsZSBpZCA9IDk3NFxuLy8gbW9kdWxlIGNodW5rcyA9IDAgMSAyIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=");

/***/ },

/***/ 975:
/***/ function(module, exports) {

eval("module.exports = \"<div id=\\\"error-panel\\\">\\r\\n    <div class=\\\"card-panel\\\" *ngIf=\\\"displayError\\\">\\r\\n        <h3 class=\\\"error-text\\\">{{errorData.title}}</h3>\\r\\n    </div>\\r\\n</div>\";//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTc1LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vYXNzZXRzL2FwcC9lcnJvci9lcnJvci5jb21wb25lbnQuaHRtbD85NjM3Il0sInNvdXJjZXNDb250ZW50IjpbIm1vZHVsZS5leHBvcnRzID0gXCI8ZGl2IGlkPVxcXCJlcnJvci1wYW5lbFxcXCI+XFxyXFxuICAgIDxkaXYgY2xhc3M9XFxcImNhcmQtcGFuZWxcXFwiICpuZ0lmPVxcXCJkaXNwbGF5RXJyb3JcXFwiPlxcclxcbiAgICAgICAgPGgzIGNsYXNzPVxcXCJlcnJvci10ZXh0XFxcIj57e2Vycm9yRGF0YS50aXRsZX19PC9oMz5cXHJcXG4gICAgPC9kaXY+XFxyXFxuPC9kaXY+XCI7XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9hc3NldHMvYXBwL2Vycm9yL2Vycm9yLmNvbXBvbmVudC5odG1sXG4vLyBtb2R1bGUgaWQgPSA5NzVcbi8vIG1vZHVsZSBjaHVua3MgPSAwIDEgMiJdLCJtYXBwaW5ncyI6IkFBQUEiLCJzb3VyY2VSb290IjoiIn0=");

/***/ },

/***/ 976:
/***/ function(module, exports) {

eval("module.exports = \"<div class=\\\"form-field\\\">\\r\\n    <div class=\\\"form-label\\\" *ngIf=\\\"label\\\">\\r\\n        <label>{{label}}</label>\\r\\n    </div>\\r\\n    <div class=\\\"combobox\\\">\\r\\n        <div class=\\\"cb-trigger\\\" (click)=\\\"onOpen()\\\" [class.empty]=\\\"displayed_item.value === ''\\\" [ngStyle]=\\\"cbStyle\\\">\\r\\n            {{displayed_item.text}}\\r\\n            <span class=\\\"down-arrow\\\"></span>\\r\\n        </div>\\r\\n        <ul class=\\\"cb-items\\\" *ngIf=\\\"open\\\">\\r\\n            <li class=\\\"cb-item\\\"\\r\\n                [class.selected]=\\\"displayed_item.value==item.value\\\"\\r\\n                (click)=\\\"selectItem(item.value)\\\"\\r\\n                *ngFor=\\\"let item of items\\\">\\r\\n\\r\\n                {{item.text}}\\r\\n            </li>\\r\\n        </ul>\\r\\n    </div>\\r\\n</div>\\r\\n\";//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTc2LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vYXNzZXRzL2FwcC9zaGFyZWQvY29udHJvbHMvY29tYm9ib3guY29tcG9uZW50Lmh0bWw/MzMxZCJdLCJzb3VyY2VzQ29udGVudCI6WyJtb2R1bGUuZXhwb3J0cyA9IFwiPGRpdiBjbGFzcz1cXFwiZm9ybS1maWVsZFxcXCI+XFxyXFxuICAgIDxkaXYgY2xhc3M9XFxcImZvcm0tbGFiZWxcXFwiICpuZ0lmPVxcXCJsYWJlbFxcXCI+XFxyXFxuICAgICAgICA8bGFiZWw+e3tsYWJlbH19PC9sYWJlbD5cXHJcXG4gICAgPC9kaXY+XFxyXFxuICAgIDxkaXYgY2xhc3M9XFxcImNvbWJvYm94XFxcIj5cXHJcXG4gICAgICAgIDxkaXYgY2xhc3M9XFxcImNiLXRyaWdnZXJcXFwiIChjbGljayk9XFxcIm9uT3BlbigpXFxcIiBbY2xhc3MuZW1wdHldPVxcXCJkaXNwbGF5ZWRfaXRlbS52YWx1ZSA9PT0gJydcXFwiIFtuZ1N0eWxlXT1cXFwiY2JTdHlsZVxcXCI+XFxyXFxuICAgICAgICAgICAge3tkaXNwbGF5ZWRfaXRlbS50ZXh0fX1cXHJcXG4gICAgICAgICAgICA8c3BhbiBjbGFzcz1cXFwiZG93bi1hcnJvd1xcXCI+PC9zcGFuPlxcclxcbiAgICAgICAgPC9kaXY+XFxyXFxuICAgICAgICA8dWwgY2xhc3M9XFxcImNiLWl0ZW1zXFxcIiAqbmdJZj1cXFwib3BlblxcXCI+XFxyXFxuICAgICAgICAgICAgPGxpIGNsYXNzPVxcXCJjYi1pdGVtXFxcIlxcclxcbiAgICAgICAgICAgICAgICBbY2xhc3Muc2VsZWN0ZWRdPVxcXCJkaXNwbGF5ZWRfaXRlbS52YWx1ZT09aXRlbS52YWx1ZVxcXCJcXHJcXG4gICAgICAgICAgICAgICAgKGNsaWNrKT1cXFwic2VsZWN0SXRlbShpdGVtLnZhbHVlKVxcXCJcXHJcXG4gICAgICAgICAgICAgICAgKm5nRm9yPVxcXCJsZXQgaXRlbSBvZiBpdGVtc1xcXCI+XFxyXFxuXFxyXFxuICAgICAgICAgICAgICAgIHt7aXRlbS50ZXh0fX1cXHJcXG4gICAgICAgICAgICA8L2xpPlxcclxcbiAgICAgICAgPC91bD5cXHJcXG4gICAgPC9kaXY+XFxyXFxuPC9kaXY+XFxyXFxuXCI7XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9hc3NldHMvYXBwL3NoYXJlZC9jb250cm9scy9jb21ib2JveC5jb21wb25lbnQuaHRtbFxuLy8gbW9kdWxlIGlkID0gOTc2XG4vLyBtb2R1bGUgY2h1bmtzID0gMCAxIDIiXSwibWFwcGluZ3MiOiJBQUFBIiwic291cmNlUm9vdCI6IiJ9");

/***/ },

/***/ 977:
/***/ function(module, exports) {

eval("module.exports = \"<div class=\\\"uploader\\\" [style.width.px]=\\\"width\\\">\\r\\n    <!--if no file-->\\r\\n    <label class=\\\"uploader-zone\\\"\\r\\n           *ngIf=\\\"!inputFile\\\"\\r\\n           for=\\\"uploader\\\"\\r\\n           ngFileDrop\\r\\n           [options]=\\\"options\\\"\\r\\n           (onUpload)=\\\"handleUpload($event)\\\"\\r\\n           [ngClass]=\\\"{'file-over': hasBaseDropZoneOver}\\\"\\r\\n           (onFileOver)=\\\"fileOverBase($event)\\\">\\r\\n        Upload (drag & drop)\\r\\n\\r\\n        <input type=\\\"file\\\"\\r\\n               id=\\\"uploader\\\"\\r\\n               style=\\\"display: none;\\\"\\r\\n               ngFileSelect\\r\\n               [options]=\\\"options\\\"\\r\\n               (onUpload)=\\\"handleUpload($event)\\\">\\r\\n    </label>\\r\\n\\r\\n    <!--if file uploaded-->\\r\\n    <div class=\\\"with-background\\\" *ngIf=\\\"inputFile\\\" [ngStyle]=\\\"{'background-image': 'url(/uploaded/'+ inputFile.filename +')' }\\\">\\r\\n        <div class=\\\"delete-image\\\" (click)=\\\"deleteImage()\\\"></div>\\r\\n    </div>\\r\\n</div>\";//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTc3LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vYXNzZXRzL2FwcC9zaGFyZWQvY29udHJvbHMvdXBsb2FkZXIvdXBsb2FkZXIuY29tcG9uZW50Lmh0bWw/NzEwNyJdLCJzb3VyY2VzQ29udGVudCI6WyJtb2R1bGUuZXhwb3J0cyA9IFwiPGRpdiBjbGFzcz1cXFwidXBsb2FkZXJcXFwiIFtzdHlsZS53aWR0aC5weF09XFxcIndpZHRoXFxcIj5cXHJcXG4gICAgPCEtLWlmIG5vIGZpbGUtLT5cXHJcXG4gICAgPGxhYmVsIGNsYXNzPVxcXCJ1cGxvYWRlci16b25lXFxcIlxcclxcbiAgICAgICAgICAgKm5nSWY9XFxcIiFpbnB1dEZpbGVcXFwiXFxyXFxuICAgICAgICAgICBmb3I9XFxcInVwbG9hZGVyXFxcIlxcclxcbiAgICAgICAgICAgbmdGaWxlRHJvcFxcclxcbiAgICAgICAgICAgW29wdGlvbnNdPVxcXCJvcHRpb25zXFxcIlxcclxcbiAgICAgICAgICAgKG9uVXBsb2FkKT1cXFwiaGFuZGxlVXBsb2FkKCRldmVudClcXFwiXFxyXFxuICAgICAgICAgICBbbmdDbGFzc109XFxcInsnZmlsZS1vdmVyJzogaGFzQmFzZURyb3Bab25lT3Zlcn1cXFwiXFxyXFxuICAgICAgICAgICAob25GaWxlT3Zlcik9XFxcImZpbGVPdmVyQmFzZSgkZXZlbnQpXFxcIj5cXHJcXG4gICAgICAgIFVwbG9hZCAoZHJhZyAmIGRyb3ApXFxyXFxuXFxyXFxuICAgICAgICA8aW5wdXQgdHlwZT1cXFwiZmlsZVxcXCJcXHJcXG4gICAgICAgICAgICAgICBpZD1cXFwidXBsb2FkZXJcXFwiXFxyXFxuICAgICAgICAgICAgICAgc3R5bGU9XFxcImRpc3BsYXk6IG5vbmU7XFxcIlxcclxcbiAgICAgICAgICAgICAgIG5nRmlsZVNlbGVjdFxcclxcbiAgICAgICAgICAgICAgIFtvcHRpb25zXT1cXFwib3B0aW9uc1xcXCJcXHJcXG4gICAgICAgICAgICAgICAob25VcGxvYWQpPVxcXCJoYW5kbGVVcGxvYWQoJGV2ZW50KVxcXCI+XFxyXFxuICAgIDwvbGFiZWw+XFxyXFxuXFxyXFxuICAgIDwhLS1pZiBmaWxlIHVwbG9hZGVkLS0+XFxyXFxuICAgIDxkaXYgY2xhc3M9XFxcIndpdGgtYmFja2dyb3VuZFxcXCIgKm5nSWY9XFxcImlucHV0RmlsZVxcXCIgW25nU3R5bGVdPVxcXCJ7J2JhY2tncm91bmQtaW1hZ2UnOiAndXJsKC91cGxvYWRlZC8nKyBpbnB1dEZpbGUuZmlsZW5hbWUgKycpJyB9XFxcIj5cXHJcXG4gICAgICAgIDxkaXYgY2xhc3M9XFxcImRlbGV0ZS1pbWFnZVxcXCIgKGNsaWNrKT1cXFwiZGVsZXRlSW1hZ2UoKVxcXCI+PC9kaXY+XFxyXFxuICAgIDwvZGl2PlxcclxcbjwvZGl2PlwiO1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vYXNzZXRzL2FwcC9zaGFyZWQvY29udHJvbHMvdXBsb2FkZXIvdXBsb2FkZXIuY29tcG9uZW50Lmh0bWxcbi8vIG1vZHVsZSBpZCA9IDk3N1xuLy8gbW9kdWxlIGNodW5rcyA9IDAgMSAyIl0sIm1hcHBpbmdzIjoiQUFBQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ },

/***/ 978:
/***/ function(module, exports, __webpack_require__) {

eval("/* WEBPACK VAR INJECTION */(function(setImmediate) {/*** IMPORTS FROM imports-loader ***/\n(function() {\n\n// 4.5.1 (2016-12-07)\n\n/**\n * Compiled inline version. (Library mode)\n */\n\n/*jshint smarttabs:true, undef:true, latedef:true, curly:true, bitwise:true, camelcase:true */\n/*globals $code */\n\n(function(exports, undefined) {\n\t\"use strict\";\n\n\tvar modules = {};\n\n\tfunction require(ids, callback) {\n\t\tvar module, defs = [];\n\n\t\tfor (var i = 0; i < ids.length; ++i) {\n\t\t\tmodule = modules[ids[i]] || resolve(ids[i]);\n\t\t\tif (!module) {\n\t\t\t\tthrow 'module definition dependecy not found: ' + ids[i];\n\t\t\t}\n\n\t\t\tdefs.push(module);\n\t\t}\n\n\t\tcallback.apply(null, defs);\n\t}\n\n\tfunction define(id, dependencies, definition) {\n\t\tif (typeof id !== 'string') {\n\t\t\tthrow 'invalid module definition, module id must be defined and be a string';\n\t\t}\n\n\t\tif (dependencies === undefined) {\n\t\t\tthrow 'invalid module definition, dependencies must be specified';\n\t\t}\n\n\t\tif (definition === undefined) {\n\t\t\tthrow 'invalid module definition, definition function must be specified';\n\t\t}\n\n\t\trequire(dependencies, function() {\n\t\t\tmodules[id] = definition.apply(null, arguments);\n\t\t});\n\t}\n\n\tfunction defined(id) {\n\t\treturn !!modules[id];\n\t}\n\n\tfunction resolve(id) {\n\t\tvar target = exports;\n\t\tvar fragments = id.split(/[.\\/]/);\n\n\t\tfor (var fi = 0; fi < fragments.length; ++fi) {\n\t\t\tif (!target[fragments[fi]]) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttarget = target[fragments[fi]];\n\t\t}\n\n\t\treturn target;\n\t}\n\n\tfunction expose(ids) {\n\t\tvar i, target, id, fragments, privateModules;\n\n\t\tfor (i = 0; i < ids.length; i++) {\n\t\t\ttarget = exports;\n\t\t\tid = ids[i];\n\t\t\tfragments = id.split(/[.\\/]/);\n\n\t\t\tfor (var fi = 0; fi < fragments.length - 1; ++fi) {\n\t\t\t\tif (target[fragments[fi]] === undefined) {\n\t\t\t\t\ttarget[fragments[fi]] = {};\n\t\t\t\t}\n\n\t\t\t\ttarget = target[fragments[fi]];\n\t\t\t}\n\n\t\t\ttarget[fragments[fragments.length - 1]] = modules[id];\n\t\t}\n\n\t\t// Expose private modules for unit tests\n\t\tif (exports.AMDLC_TESTS) {\n\t\t\tprivateModules = exports.privateModules || {};\n\n\t\t\tfor (id in modules) {\n\t\t\t\tprivateModules[id] = modules[id];\n\t\t\t}\n\n\t\t\tfor (i = 0; i < ids.length; i++) {\n\t\t\t\tdelete privateModules[ids[i]];\n\t\t\t}\n\n\t\t\texports.privateModules = privateModules;\n\t\t}\n\t}\n\n// Included from: js/tinymce/classes/geom/Rect.js\n\n/**\n * Rect.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Contains various tools for rect/position calculation.\n *\n * @class tinymce.geom.Rect\n */\ndefine(\"tinymce/geom/Rect\", [\n], function() {\n\t\"use strict\";\n\n\tvar min = Math.min, max = Math.max, round = Math.round;\n\n\t/**\n\t * Returns the rect positioned based on the relative position name\n\t * to the target rect.\n\t *\n\t * @method relativePosition\n\t * @param {Rect} rect Source rect to modify into a new rect.\n\t * @param {Rect} targetRect Rect to move relative to based on the rel option.\n\t * @param {String} rel Relative position. For example: tr-bl.\n\t */\n\tfunction relativePosition(rect, targetRect, rel) {\n\t\tvar x, y, w, h, targetW, targetH;\n\n\t\tx = targetRect.x;\n\t\ty = targetRect.y;\n\t\tw = rect.w;\n\t\th = rect.h;\n\t\ttargetW = targetRect.w;\n\t\ttargetH = targetRect.h;\n\n\t\trel = (rel || '').split('');\n\n\t\tif (rel[0] === 'b') {\n\t\t\ty += targetH;\n\t\t}\n\n\t\tif (rel[1] === 'r') {\n\t\t\tx += targetW;\n\t\t}\n\n\t\tif (rel[0] === 'c') {\n\t\t\ty += round(targetH / 2);\n\t\t}\n\n\t\tif (rel[1] === 'c') {\n\t\t\tx += round(targetW / 2);\n\t\t}\n\n\t\tif (rel[3] === 'b') {\n\t\t\ty -= h;\n\t\t}\n\n\t\tif (rel[4] === 'r') {\n\t\t\tx -= w;\n\t\t}\n\n\t\tif (rel[3] === 'c') {\n\t\t\ty -= round(h / 2);\n\t\t}\n\n\t\tif (rel[4] === 'c') {\n\t\t\tx -= round(w / 2);\n\t\t}\n\n\t\treturn create(x, y, w, h);\n\t}\n\n\t/**\n\t * Tests various positions to get the most suitable one.\n\t *\n\t * @method findBestRelativePosition\n\t * @param {Rect} rect Rect to use as source.\n\t * @param {Rect} targetRect Rect to move relative to.\n\t * @param {Rect} constrainRect Rect to constrain within.\n\t * @param {Array} rels Array of relative positions to test against.\n\t */\n\tfunction findBestRelativePosition(rect, targetRect, constrainRect, rels) {\n\t\tvar pos, i;\n\n\t\tfor (i = 0; i < rels.length; i++) {\n\t\t\tpos = relativePosition(rect, targetRect, rels[i]);\n\n\t\t\tif (pos.x >= constrainRect.x && pos.x + pos.w <= constrainRect.w + constrainRect.x &&\n\t\t\t\tpos.y >= constrainRect.y && pos.y + pos.h <= constrainRect.h + constrainRect.y) {\n\t\t\t\treturn rels[i];\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t/**\n\t * Inflates the rect in all directions.\n\t *\n\t * @method inflate\n\t * @param {Rect} rect Rect to expand.\n\t * @param {Number} w Relative width to expand by.\n\t * @param {Number} h Relative height to expand by.\n\t * @return {Rect} New expanded rect.\n\t */\n\tfunction inflate(rect, w, h) {\n\t\treturn create(rect.x - w, rect.y - h, rect.w + w * 2, rect.h + h * 2);\n\t}\n\n\t/**\n\t * Returns the intersection of the specified rectangles.\n\t *\n\t * @method intersect\n\t * @param {Rect} rect The first rectangle to compare.\n\t * @param {Rect} cropRect The second rectangle to compare.\n\t * @return {Rect} The intersection of the two rectangles or null if they don't intersect.\n\t */\n\tfunction intersect(rect, cropRect) {\n\t\tvar x1, y1, x2, y2;\n\n\t\tx1 = max(rect.x, cropRect.x);\n\t\ty1 = max(rect.y, cropRect.y);\n\t\tx2 = min(rect.x + rect.w, cropRect.x + cropRect.w);\n\t\ty2 = min(rect.y + rect.h, cropRect.y + cropRect.h);\n\n\t\tif (x2 - x1 < 0 || y2 - y1 < 0) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn create(x1, y1, x2 - x1, y2 - y1);\n\t}\n\n\t/**\n\t * Returns a rect clamped within the specified clamp rect. This forces the\n\t * rect to be inside the clamp rect.\n\t *\n\t * @method clamp\n\t * @param {Rect} rect Rectangle to force within clamp rect.\n\t * @param {Rect} clampRect Rectable to force within.\n\t * @param {Boolean} fixedSize True/false if size should be fixed.\n\t * @return {Rect} Clamped rect.\n\t */\n\tfunction clamp(rect, clampRect, fixedSize) {\n\t\tvar underflowX1, underflowY1, overflowX2, overflowY2,\n\t\t\tx1, y1, x2, y2, cx2, cy2;\n\n\t\tx1 = rect.x;\n\t\ty1 = rect.y;\n\t\tx2 = rect.x + rect.w;\n\t\ty2 = rect.y + rect.h;\n\t\tcx2 = clampRect.x + clampRect.w;\n\t\tcy2 = clampRect.y + clampRect.h;\n\n\t\tunderflowX1 = max(0, clampRect.x - x1);\n\t\tunderflowY1 = max(0, clampRect.y - y1);\n\t\toverflowX2 = max(0, x2 - cx2);\n\t\toverflowY2 = max(0, y2 - cy2);\n\n\t\tx1 += underflowX1;\n\t\ty1 += underflowY1;\n\n\t\tif (fixedSize) {\n\t\t\tx2 += underflowX1;\n\t\t\ty2 += underflowY1;\n\t\t\tx1 -= overflowX2;\n\t\t\ty1 -= overflowY2;\n\t\t}\n\n\t\tx2 -= overflowX2;\n\t\ty2 -= overflowY2;\n\n\t\treturn create(x1, y1, x2 - x1, y2 - y1);\n\t}\n\n\t/**\n\t * Creates a new rectangle object.\n\t *\n\t * @method create\n\t * @param {Number} x Rectangle x location.\n\t * @param {Number} y Rectangle y location.\n\t * @param {Number} w Rectangle width.\n\t * @param {Number} h Rectangle height.\n\t * @return {Rect} New rectangle object.\n\t */\n\tfunction create(x, y, w, h) {\n\t\treturn {x: x, y: y, w: w, h: h};\n\t}\n\n\t/**\n\t * Creates a new rectangle object form a clientRects object.\n\t *\n\t * @method fromClientRect\n\t * @param {ClientRect} clientRect DOM ClientRect object.\n\t * @return {Rect} New rectangle object.\n\t */\n\tfunction fromClientRect(clientRect) {\n\t\treturn create(clientRect.left, clientRect.top, clientRect.width, clientRect.height);\n\t}\n\n\treturn {\n\t\tinflate: inflate,\n\t\trelativePosition: relativePosition,\n\t\tfindBestRelativePosition: findBestRelativePosition,\n\t\tintersect: intersect,\n\t\tclamp: clamp,\n\t\tcreate: create,\n\t\tfromClientRect: fromClientRect\n\t};\n});\n\n// Included from: js/tinymce/classes/util/Promise.js\n\n/**\n * Promise.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * Promise polyfill under MIT license: https://github.com/taylorhakes/promise-polyfill\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/* eslint-disable */\n/* jshint ignore:start */\n\n/**\n * Modifed to be a feature fill and wrapped as tinymce module.\n */\ndefine(\"tinymce/util/Promise\", [], function() {\n\tif (window.Promise) {\n\t\treturn window.Promise;\n\t}\n\n\t// Use polyfill for setImmediate for performance gains\n\tvar asap = Promise.immediateFn || (typeof setImmediate === 'function' && setImmediate) ||\n\t\tfunction(fn) { setTimeout(fn, 1); };\n\n\t// Polyfill for Function.prototype.bind\n\tfunction bind(fn, thisArg) {\n\t\treturn function() {\n\t\t\tfn.apply(thisArg, arguments);\n\t\t};\n\t}\n\n\tvar isArray = Array.isArray || function(value) { return Object.prototype.toString.call(value) === \"[object Array]\"; };\n\n\tfunction Promise(fn) {\n\t\tif (typeof this !== 'object') throw new TypeError('Promises must be constructed via new');\n\t\tif (typeof fn !== 'function') throw new TypeError('not a function');\n\t\tthis._state = null;\n\t\tthis._value = null;\n\t\tthis._deferreds = [];\n\n\t\tdoResolve(fn, bind(resolve, this), bind(reject, this));\n\t}\n\n\tfunction handle(deferred) {\n\t\tvar me = this;\n\t\tif (this._state === null) {\n\t\t\tthis._deferreds.push(deferred);\n\t\t\treturn;\n\t\t}\n\t\tasap(function() {\n\t\t\tvar cb = me._state ? deferred.onFulfilled : deferred.onRejected;\n\t\t\tif (cb === null) {\n\t\t\t\t(me._state ? deferred.resolve : deferred.reject)(me._value);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar ret;\n\t\t\ttry {\n\t\t\t\tret = cb(me._value);\n\t\t\t}\n\t\t\tcatch (e) {\n\t\t\t\tdeferred.reject(e);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tdeferred.resolve(ret);\n\t\t});\n\t}\n\n\tfunction resolve(newValue) {\n\t\ttry { //Promise Resolution Procedure: https://github.com/promises-aplus/promises-spec#the-promise-resolution-procedure\n\t\t\tif (newValue === this) throw new TypeError('A promise cannot be resolved with itself.');\n\t\t\tif (newValue && (typeof newValue === 'object' || typeof newValue === 'function')) {\n\t\t\t\tvar then = newValue.then;\n\t\t\t\tif (typeof then === 'function') {\n\t\t\t\t\tdoResolve(bind(then, newValue), bind(resolve, this), bind(reject, this));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._state = true;\n\t\t\tthis._value = newValue;\n\t\t\tfinale.call(this);\n\t\t} catch (e) { reject.call(this, e); }\n\t}\n\n\tfunction reject(newValue) {\n\t\tthis._state = false;\n\t\tthis._value = newValue;\n\t\tfinale.call(this);\n\t}\n\n\tfunction finale() {\n\t\tfor (var i = 0, len = this._deferreds.length; i < len; i++) {\n\t\t\thandle.call(this, this._deferreds[i]);\n\t\t}\n\t\tthis._deferreds = null;\n\t}\n\n\tfunction Handler(onFulfilled, onRejected, resolve, reject){\n\t\tthis.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\n\t\tthis.onRejected = typeof onRejected === 'function' ? onRejected : null;\n\t\tthis.resolve = resolve;\n\t\tthis.reject = reject;\n\t}\n\n\t/**\n\t * Take a potentially misbehaving resolver function and make sure\n\t * onFulfilled and onRejected are only called once.\n\t *\n\t * Makes no guarantees about asynchrony.\n\t */\n\tfunction doResolve(fn, onFulfilled, onRejected) {\n\t\tvar done = false;\n\t\ttry {\n\t\t\tfn(function (value) {\n\t\t\t\tif (done) return;\n\t\t\t\tdone = true;\n\t\t\t\tonFulfilled(value);\n\t\t\t}, function (reason) {\n\t\t\t\tif (done) return;\n\t\t\t\tdone = true;\n\t\t\t\tonRejected(reason);\n\t\t\t});\n\t\t} catch (ex) {\n\t\t\tif (done) return;\n\t\t\tdone = true;\n\t\t\tonRejected(ex);\n\t\t}\n\t}\n\n\tPromise.prototype['catch'] = function (onRejected) {\n\t\treturn this.then(null, onRejected);\n\t};\n\n\tPromise.prototype.then = function(onFulfilled, onRejected) {\n\t\tvar me = this;\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\thandle.call(me, new Handler(onFulfilled, onRejected, resolve, reject));\n\t\t});\n\t};\n\n\tPromise.all = function () {\n\t\tvar args = Array.prototype.slice.call(arguments.length === 1 && isArray(arguments[0]) ? arguments[0] : arguments);\n\n\t\treturn new Promise(function (resolve, reject) {\n\t\t\tif (args.length === 0) return resolve([]);\n\t\t\tvar remaining = args.length;\n\t\t\tfunction res(i, val) {\n\t\t\t\ttry {\n\t\t\t\t\tif (val && (typeof val === 'object' || typeof val === 'function')) {\n\t\t\t\t\t\tvar then = val.then;\n\t\t\t\t\t\tif (typeof then === 'function') {\n\t\t\t\t\t\t\tthen.call(val, function (val) { res(i, val); }, reject);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\targs[i] = val;\n\t\t\t\t\tif (--remaining === 0) {\n\t\t\t\t\t\tresolve(args);\n\t\t\t\t\t}\n\t\t\t\t} catch (ex) {\n\t\t\t\t\treject(ex);\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (var i = 0; i < args.length; i++) {\n\t\t\t\tres(i, args[i]);\n\t\t\t}\n\t\t});\n\t};\n\n\tPromise.resolve = function (value) {\n\t\tif (value && typeof value === 'object' && value.constructor === Promise) {\n\t\t\treturn value;\n\t\t}\n\n\t\treturn new Promise(function (resolve) {\n\t\t\tresolve(value);\n\t\t});\n\t};\n\n\tPromise.reject = function (value) {\n\t\treturn new Promise(function (resolve, reject) {\n\t\t\treject(value);\n\t\t});\n\t};\n\n\tPromise.race = function (values) {\n\t\treturn new Promise(function (resolve, reject) {\n\t\t\tfor(var i = 0, len = values.length; i < len; i++) {\n\t\t\t\tvalues[i].then(resolve, reject);\n\t\t\t}\n\t\t});\n\t};\n\n\treturn Promise;\n});\n\n/* jshint ignore:end */\n/* eslint-enable */\n\n// Included from: js/tinymce/classes/util/Delay.js\n\n/**\n * Delay.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Utility class for working with delayed actions like setTimeout.\n *\n * @class tinymce.util.Delay\n */\ndefine(\"tinymce/util/Delay\", [\n\t\"tinymce/util/Promise\"\n], function(Promise) {\n\tvar requestAnimationFramePromise;\n\n\tfunction requestAnimationFrame(callback, element) {\n\t\tvar i, requestAnimationFrameFunc = window.requestAnimationFrame, vendors = ['ms', 'moz', 'webkit'];\n\n\t\tfunction featurefill(callback) {\n\t\t\twindow.setTimeout(callback, 0);\n\t\t}\n\n\t\tfor (i = 0; i < vendors.length && !requestAnimationFrameFunc; i++) {\n\t\t\trequestAnimationFrameFunc = window[vendors[i] + 'RequestAnimationFrame'];\n\t\t}\n\n\t\tif (!requestAnimationFrameFunc) {\n\t\t\trequestAnimationFrameFunc = featurefill;\n\t\t}\n\n\t\trequestAnimationFrameFunc(callback, element);\n\t}\n\n\tfunction wrappedSetTimeout(callback, time) {\n\t\tif (typeof time != 'number') {\n\t\t\ttime = 0;\n\t\t}\n\n\t\treturn setTimeout(callback, time);\n\t}\n\n\tfunction wrappedSetInterval(callback, time) {\n\t\tif (typeof time != 'number') {\n\t\t\ttime = 1; // IE 8 needs it to be > 0\n\t\t}\n\n\t\treturn setInterval(callback, time);\n\t}\n\n\tfunction wrappedClearTimeout(id) {\n\t\treturn clearTimeout(id);\n\t}\n\n\tfunction wrappedClearInterval(id) {\n\t\treturn clearInterval(id);\n\t}\n\n\tfunction debounce(callback, time) {\n\t\tvar timer, func;\n\n\t\tfunc = function() {\n\t\t\tvar args = arguments;\n\n\t\t\tclearTimeout(timer);\n\n\t\t\ttimer = wrappedSetTimeout(function() {\n\t\t\t\tcallback.apply(this, args);\n\t\t\t}, time);\n\t\t};\n\n\t\tfunc.stop = function() {\n\t\t\tclearTimeout(timer);\n\t\t};\n\n\t\treturn func;\n\t}\n\n\treturn {\n\t\t/**\n\t\t * Requests an animation frame and fallbacks to a timeout on older browsers.\n\t\t *\n\t\t * @method requestAnimationFrame\n\t\t * @param {function} callback Callback to execute when a new frame is available.\n\t\t * @param {DOMElement} element Optional element to scope it to.\n\t\t */\n\t\trequestAnimationFrame: function(callback, element) {\n\t\t\tif (requestAnimationFramePromise) {\n\t\t\t\trequestAnimationFramePromise.then(callback);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\trequestAnimationFramePromise = new Promise(function(resolve) {\n\t\t\t\tif (!element) {\n\t\t\t\t\telement = document.body;\n\t\t\t\t}\n\n\t\t\t\trequestAnimationFrame(resolve, element);\n\t\t\t}).then(callback);\n\t\t},\n\n\t\t/**\n\t\t * Sets a timer in ms and executes the specified callback when the timer runs out.\n\t\t *\n\t\t * @method setTimeout\n\t\t * @param {function} callback Callback to execute when timer runs out.\n\t\t * @param {Number} time Optional time to wait before the callback is executed, defaults to 0.\n\t\t * @return {Number} Timeout id number.\n\t\t */\n\t\tsetTimeout: wrappedSetTimeout,\n\n\t\t/**\n\t\t * Sets an interval timer in ms and executes the specified callback at every interval of that time.\n\t\t *\n\t\t * @method setInterval\n\t\t * @param {function} callback Callback to execute when interval time runs out.\n\t\t * @param {Number} time Optional time to wait before the callback is executed, defaults to 0.\n\t\t * @return {Number} Timeout id number.\n\t\t */\n\t\tsetInterval: wrappedSetInterval,\n\n\t\t/**\n\t\t * Sets an editor timeout it's similar to setTimeout except that it checks if the editor instance is\n\t\t * still alive when the callback gets executed.\n\t\t *\n\t\t * @method setEditorTimeout\n\t\t * @param {tinymce.Editor} editor Editor instance to check the removed state on.\n\t\t * @param {function} callback Callback to execute when timer runs out.\n\t\t * @param {Number} time Optional time to wait before the callback is executed, defaults to 0.\n\t\t * @return {Number} Timeout id number.\n\t\t */\n\t\tsetEditorTimeout: function(editor, callback, time) {\n\t\t\treturn wrappedSetTimeout(function() {\n\t\t\t\tif (!editor.removed) {\n\t\t\t\t\tcallback();\n\t\t\t\t}\n\t\t\t}, time);\n\t\t},\n\n\t\t/**\n\t\t * Sets an interval timer it's similar to setInterval except that it checks if the editor instance is\n\t\t * still alive when the callback gets executed.\n\t\t *\n\t\t * @method setEditorInterval\n\t\t * @param {function} callback Callback to execute when interval time runs out.\n\t\t * @param {Number} time Optional time to wait before the callback is executed, defaults to 0.\n\t\t * @return {Number} Timeout id number.\n\t\t */\n\t\tsetEditorInterval: function(editor, callback, time) {\n\t\t\tvar timer;\n\n\t\t\ttimer = wrappedSetInterval(function() {\n\t\t\t\tif (!editor.removed) {\n\t\t\t\t\tcallback();\n\t\t\t\t} else {\n\t\t\t\t\tclearInterval(timer);\n\t\t\t\t}\n\t\t\t}, time);\n\n\t\t\treturn timer;\n\t\t},\n\n\t\t/**\n\t\t * Creates debounced callback function that only gets executed once within the specified time.\n\t\t *\n\t\t * @method debounce\n\t\t * @param {function} callback Callback to execute when timer finishes.\n\t\t * @param {Number} time Optional time to wait before the callback is executed, defaults to 0.\n\t\t * @return {Function} debounced function callback.\n\t\t */\n\t\tdebounce: debounce,\n\n\t\t// Throttle needs to be debounce due to backwards compatibility.\n\t\tthrottle: debounce,\n\n\t\t/**\n\t\t * Clears an interval timer so it won't execute.\n\t\t *\n\t\t * @method clearInterval\n\t\t * @param {Number} Interval timer id number.\n\t\t */\n\t\tclearInterval: wrappedClearInterval,\n\n\t\t/**\n\t\t * Clears an timeout timer so it won't execute.\n\t\t *\n\t\t * @method clearTimeout\n\t\t * @param {Number} Timeout timer id number.\n\t\t */\n\t\tclearTimeout: wrappedClearTimeout\n\t};\n});\n\n// Included from: js/tinymce/classes/Env.js\n\n/**\n * Env.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class contains various environment constants like browser versions etc.\n * Normally you don't want to sniff specific browser versions but sometimes you have\n * to when it's impossible to feature detect. So use this with care.\n *\n * @class tinymce.Env\n * @static\n */\ndefine(\"tinymce/Env\", [], function() {\n\tvar nav = navigator, userAgent = nav.userAgent;\n\tvar opera, webkit, ie, ie11, ie12, gecko, mac, iDevice, android, fileApi, phone, tablet, windowsPhone;\n\n\tfunction matchMediaQuery(query) {\n\t\treturn \"matchMedia\" in window ? matchMedia(query).matches : false;\n\t}\n\n\topera = window.opera && window.opera.buildNumber;\n\tandroid = /Android/.test(userAgent);\n\twebkit = /WebKit/.test(userAgent);\n\tie = !webkit && !opera && (/MSIE/gi).test(userAgent) && (/Explorer/gi).test(nav.appName);\n\tie = ie && /MSIE (\\w+)\\./.exec(userAgent)[1];\n\tie11 = userAgent.indexOf('Trident/') != -1 && (userAgent.indexOf('rv:') != -1 || nav.appName.indexOf('Netscape') != -1) ? 11 : false;\n\tie12 = (userAgent.indexOf('Edge/') != -1 && !ie && !ie11) ? 12 : false;\n\tie = ie || ie11 || ie12;\n\tgecko = !webkit && !ie11 && /Gecko/.test(userAgent);\n\tmac = userAgent.indexOf('Mac') != -1;\n\tiDevice = /(iPad|iPhone)/.test(userAgent);\n\tfileApi = \"FormData\" in window && \"FileReader\" in window && \"URL\" in window && !!URL.createObjectURL;\n\tphone = matchMediaQuery(\"only screen and (max-device-width: 480px)\") && (android || iDevice);\n\ttablet = matchMediaQuery(\"only screen and (min-width: 800px)\") && (android || iDevice);\n\twindowsPhone = userAgent.indexOf('Windows Phone') != -1;\n\n\tif (ie12) {\n\t\twebkit = false;\n\t}\n\n\t// Is a iPad/iPhone and not on iOS5 sniff the WebKit version since older iOS WebKit versions\n\t// says it has contentEditable support but there is no visible caret.\n\tvar contentEditable = !iDevice || fileApi || userAgent.match(/AppleWebKit\\/(\\d*)/)[1] >= 534;\n\n\treturn {\n\t\t/**\n\t\t * Constant that is true if the browser is Opera.\n\t\t *\n\t\t * @property opera\n\t\t * @type Boolean\n\t\t * @final\n\t\t */\n\t\topera: opera,\n\n\t\t/**\n\t\t * Constant that is true if the browser is WebKit (Safari/Chrome).\n\t\t *\n\t\t * @property webKit\n\t\t * @type Boolean\n\t\t * @final\n\t\t */\n\t\twebkit: webkit,\n\n\t\t/**\n\t\t * Constant that is more than zero if the browser is IE.\n\t\t *\n\t\t * @property ie\n\t\t * @type Boolean\n\t\t * @final\n\t\t */\n\t\tie: ie,\n\n\t\t/**\n\t\t * Constant that is true if the browser is Gecko.\n\t\t *\n\t\t * @property gecko\n\t\t * @type Boolean\n\t\t * @final\n\t\t */\n\t\tgecko: gecko,\n\n\t\t/**\n\t\t * Constant that is true if the os is Mac OS.\n\t\t *\n\t\t * @property mac\n\t\t * @type Boolean\n\t\t * @final\n\t\t */\n\t\tmac: mac,\n\n\t\t/**\n\t\t * Constant that is true if the os is iOS.\n\t\t *\n\t\t * @property iOS\n\t\t * @type Boolean\n\t\t * @final\n\t\t */\n\t\tiOS: iDevice,\n\n\t\t/**\n\t\t * Constant that is true if the os is android.\n\t\t *\n\t\t * @property android\n\t\t * @type Boolean\n\t\t * @final\n\t\t */\n\t\tandroid: android,\n\n\t\t/**\n\t\t * Constant that is true if the browser supports editing.\n\t\t *\n\t\t * @property contentEditable\n\t\t * @type Boolean\n\t\t * @final\n\t\t */\n\t\tcontentEditable: contentEditable,\n\n\t\t/**\n\t\t * Transparent image data url.\n\t\t *\n\t\t * @property transparentSrc\n\t\t * @type Boolean\n\t\t * @final\n\t\t */\n\t\ttransparentSrc: \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\",\n\n\t\t/**\n\t\t * Returns true/false if the browser can or can't place the caret after a inline block like an image.\n\t\t *\n\t\t * @property noCaretAfter\n\t\t * @type Boolean\n\t\t * @final\n\t\t */\n\t\tcaretAfter: ie != 8,\n\n\t\t/**\n\t\t * Constant that is true if the browser supports native DOM Ranges. IE 9+.\n\t\t *\n\t\t * @property range\n\t\t * @type Boolean\n\t\t */\n\t\trange: window.getSelection && \"Range\" in window,\n\n\t\t/**\n\t\t * Returns the IE document mode for non IE browsers this will fake IE 10.\n\t\t *\n\t\t * @property documentMode\n\t\t * @type Number\n\t\t */\n\t\tdocumentMode: ie && !ie12 ? (document.documentMode || 7) : 10,\n\n\t\t/**\n\t\t * Constant that is true if the browser has a modern file api.\n\t\t *\n\t\t * @property fileApi\n\t\t * @type Boolean\n\t\t */\n\t\tfileApi: fileApi,\n\n\t\t/**\n\t\t * Constant that is true if the browser supports contentEditable=false regions.\n\t\t *\n\t\t * @property ceFalse\n\t\t * @type Boolean\n\t\t */\n\t\tceFalse: (ie === false || ie > 8),\n\n\t\t/**\n\t\t * Constant if CSP mode is possible or not. Meaning we can't use script urls for the iframe.\n\t\t */\n\t\tcanHaveCSP: (ie === false || ie > 11),\n\n\t\tdesktop: !phone && !tablet,\n\t\twindowsPhone: windowsPhone\n\t};\n});\n\n// Included from: js/tinymce/classes/dom/EventUtils.js\n\n/**\n * EventUtils.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/*jshint loopfunc:true*/\n/*eslint no-loop-func:0 */\n\n/**\n * This class wraps the browsers native event logic with more convenient methods.\n *\n * @class tinymce.dom.EventUtils\n */\ndefine(\"tinymce/dom/EventUtils\", [\n\t\"tinymce/util/Delay\",\n\t\"tinymce/Env\"\n], function(Delay, Env) {\n\t\"use strict\";\n\n\tvar eventExpandoPrefix = \"mce-data-\";\n\tvar mouseEventRe = /^(?:mouse|contextmenu)|click/;\n\tvar deprecated = {\n\t\tkeyLocation: 1, layerX: 1, layerY: 1, returnValue: 1,\n\t\twebkitMovementX: 1, webkitMovementY: 1, keyIdentifier: 1\n\t};\n\n\t/**\n\t * Binds a native event to a callback on the speified target.\n\t */\n\tfunction addEvent(target, name, callback, capture) {\n\t\tif (target.addEventListener) {\n\t\t\ttarget.addEventListener(name, callback, capture || false);\n\t\t} else if (target.attachEvent) {\n\t\t\ttarget.attachEvent('on' + name, callback);\n\t\t}\n\t}\n\n\t/**\n\t * Unbinds a native event callback on the specified target.\n\t */\n\tfunction removeEvent(target, name, callback, capture) {\n\t\tif (target.removeEventListener) {\n\t\t\ttarget.removeEventListener(name, callback, capture || false);\n\t\t} else if (target.detachEvent) {\n\t\t\ttarget.detachEvent('on' + name, callback);\n\t\t}\n\t}\n\n\t/**\n\t * Gets the event target based on shadow dom properties like path and deepPath.\n\t */\n\tfunction getTargetFromShadowDom(event, defaultTarget) {\n\t\tvar path, target = defaultTarget;\n\n\t\t// When target element is inside Shadow DOM we need to take first element from path\n\t\t// otherwise we'll get Shadow Root parent, not actual target element\n\n\t\t// Normalize target for WebComponents v0 implementation (in Chrome)\n\t\tpath = event.path;\n\t\tif (path && path.length > 0) {\n\t\t\ttarget = path[0];\n\t\t}\n\n\t\t// Normalize target for WebComponents v1 implementation (standard)\n\t\tif (event.deepPath) {\n\t\t\tpath = event.deepPath();\n\t\t\tif (path && path.length > 0) {\n\t\t\t\ttarget = path[0];\n\t\t\t}\n\t\t}\n\n\t\treturn target;\n\t}\n\n\t/**\n\t * Normalizes a native event object or just adds the event specific methods on a custom event.\n\t */\n\tfunction fix(originalEvent, data) {\n\t\tvar name, event = data || {}, undef;\n\n\t\t// Dummy function that gets replaced on the delegation state functions\n\t\tfunction returnFalse() {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Dummy function that gets replaced on the delegation state functions\n\t\tfunction returnTrue() {\n\t\t\treturn true;\n\t\t}\n\n\t\t// Copy all properties from the original event\n\t\tfor (name in originalEvent) {\n\t\t\t// layerX/layerY is deprecated in Chrome and produces a warning\n\t\t\tif (!deprecated[name]) {\n\t\t\t\tevent[name] = originalEvent[name];\n\t\t\t}\n\t\t}\n\n\t\t// Normalize target IE uses srcElement\n\t\tif (!event.target) {\n\t\t\tevent.target = event.srcElement || document;\n\t\t}\n\n\t\t// Experimental shadow dom support\n\t\tif (Env.experimentalShadowDom) {\n\t\t\tevent.target = getTargetFromShadowDom(originalEvent, event.target);\n\t\t}\n\n\t\t// Calculate pageX/Y if missing and clientX/Y available\n\t\tif (originalEvent && mouseEventRe.test(originalEvent.type) && originalEvent.pageX === undef && originalEvent.clientX !== undef) {\n\t\t\tvar eventDoc = event.target.ownerDocument || document;\n\t\t\tvar doc = eventDoc.documentElement;\n\t\t\tvar body = eventDoc.body;\n\n\t\t\tevent.pageX = originalEvent.clientX + (doc && doc.scrollLeft || body && body.scrollLeft || 0) -\n\t\t\t\t(doc && doc.clientLeft || body && body.clientLeft || 0);\n\n\t\t\tevent.pageY = originalEvent.clientY + (doc && doc.scrollTop || body && body.scrollTop || 0) -\n\t\t\t\t(doc && doc.clientTop || body && body.clientTop || 0);\n\t\t}\n\n\t\t// Add preventDefault method\n\t\tevent.preventDefault = function() {\n\t\t\tevent.isDefaultPrevented = returnTrue;\n\n\t\t\t// Execute preventDefault on the original event object\n\t\t\tif (originalEvent) {\n\t\t\t\tif (originalEvent.preventDefault) {\n\t\t\t\t\toriginalEvent.preventDefault();\n\t\t\t\t} else {\n\t\t\t\t\toriginalEvent.returnValue = false; // IE\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t// Add stopPropagation\n\t\tevent.stopPropagation = function() {\n\t\t\tevent.isPropagationStopped = returnTrue;\n\n\t\t\t// Execute stopPropagation on the original event object\n\t\t\tif (originalEvent) {\n\t\t\t\tif (originalEvent.stopPropagation) {\n\t\t\t\t\toriginalEvent.stopPropagation();\n\t\t\t\t} else {\n\t\t\t\t\toriginalEvent.cancelBubble = true; // IE\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t// Add stopImmediatePropagation\n\t\tevent.stopImmediatePropagation = function() {\n\t\t\tevent.isImmediatePropagationStopped = returnTrue;\n\t\t\tevent.stopPropagation();\n\t\t};\n\n\t\t// Add event delegation states\n\t\tif (!event.isDefaultPrevented) {\n\t\t\tevent.isDefaultPrevented = returnFalse;\n\t\t\tevent.isPropagationStopped = returnFalse;\n\t\t\tevent.isImmediatePropagationStopped = returnFalse;\n\t\t}\n\n\t\t// Add missing metaKey for IE 8\n\t\tif (typeof event.metaKey == 'undefined') {\n\t\t\tevent.metaKey = false;\n\t\t}\n\n\t\treturn event;\n\t}\n\n\t/**\n\t * Bind a DOMContentLoaded event across browsers and executes the callback once the page DOM is initialized.\n\t * It will also set/check the domLoaded state of the event_utils instance so ready isn't called multiple times.\n\t */\n\tfunction bindOnReady(win, callback, eventUtils) {\n\t\tvar doc = win.document, event = {type: 'ready'};\n\n\t\tif (eventUtils.domLoaded) {\n\t\t\tcallback(event);\n\t\t\treturn;\n\t\t}\n\n\t\t// Gets called when the DOM is ready\n\t\tfunction readyHandler() {\n\t\t\tif (!eventUtils.domLoaded) {\n\t\t\t\teventUtils.domLoaded = true;\n\t\t\t\tcallback(event);\n\t\t\t}\n\t\t}\n\n\t\tfunction waitForDomLoaded() {\n\t\t\t// Check complete or interactive state if there is a body\n\t\t\t// element on some iframes IE 8 will produce a null body\n\t\t\tif (doc.readyState === \"complete\" || (doc.readyState === \"interactive\" && doc.body)) {\n\t\t\t\tremoveEvent(doc, \"readystatechange\", waitForDomLoaded);\n\t\t\t\treadyHandler();\n\t\t\t}\n\t\t}\n\n\t\tfunction tryScroll() {\n\t\t\ttry {\n\t\t\t\t// If IE is used, use the trick by Diego Perini licensed under MIT by request to the author.\n\t\t\t\t// http://javascript.nwbox.com/IEContentLoaded/\n\t\t\t\tdoc.documentElement.doScroll(\"left\");\n\t\t\t} catch (ex) {\n\t\t\t\tDelay.setTimeout(tryScroll);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treadyHandler();\n\t\t}\n\n\t\t// Use W3C method\n\t\tif (doc.addEventListener) {\n\t\t\tif (doc.readyState === \"complete\") {\n\t\t\t\treadyHandler();\n\t\t\t} else {\n\t\t\t\taddEvent(win, 'DOMContentLoaded', readyHandler);\n\t\t\t}\n\t\t} else {\n\t\t\t// Use IE method\n\t\t\taddEvent(doc, \"readystatechange\", waitForDomLoaded);\n\n\t\t\t// Wait until we can scroll, when we can the DOM is initialized\n\t\t\tif (doc.documentElement.doScroll && win.self === win.top) {\n\t\t\t\ttryScroll();\n\t\t\t}\n\t\t}\n\n\t\t// Fallback if any of the above methods should fail for some odd reason\n\t\taddEvent(win, 'load', readyHandler);\n\t}\n\n\t/**\n\t * This class enables you to bind/unbind native events to elements and normalize it's behavior across browsers.\n\t */\n\tfunction EventUtils() {\n\t\tvar self = this, events = {}, count, expando, hasFocusIn, hasMouseEnterLeave, mouseEnterLeave;\n\n\t\texpando = eventExpandoPrefix + (+new Date()).toString(32);\n\t\thasMouseEnterLeave = \"onmouseenter\" in document.documentElement;\n\t\thasFocusIn = \"onfocusin\" in document.documentElement;\n\t\tmouseEnterLeave = {mouseenter: 'mouseover', mouseleave: 'mouseout'};\n\t\tcount = 1;\n\n\t\t// State if the DOMContentLoaded was executed or not\n\t\tself.domLoaded = false;\n\t\tself.events = events;\n\n\t\t/**\n\t\t * Executes all event handler callbacks for a specific event.\n\t\t *\n\t\t * @private\n\t\t * @param {Event} evt Event object.\n\t\t * @param {String} id Expando id value to look for.\n\t\t */\n\t\tfunction executeHandlers(evt, id) {\n\t\t\tvar callbackList, i, l, callback, container = events[id];\n\n\t\t\tcallbackList = container && container[evt.type];\n\t\t\tif (callbackList) {\n\t\t\t\tfor (i = 0, l = callbackList.length; i < l; i++) {\n\t\t\t\t\tcallback = callbackList[i];\n\n\t\t\t\t\t// Check if callback exists might be removed if a unbind is called inside the callback\n\t\t\t\t\tif (callback && callback.func.call(callback.scope, evt) === false) {\n\t\t\t\t\t\tevt.preventDefault();\n\t\t\t\t\t}\n\n\t\t\t\t\t// Should we stop propagation to immediate listeners\n\t\t\t\t\tif (evt.isImmediatePropagationStopped()) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Binds a callback to an event on the specified target.\n\t\t *\n\t\t * @method bind\n\t\t * @param {Object} target Target node/window or custom object.\n\t\t * @param {String} names Name of the event to bind.\n\t\t * @param {function} callback Callback function to execute when the event occurs.\n\t\t * @param {Object} scope Scope to call the callback function on, defaults to target.\n\t\t * @return {function} Callback function that got bound.\n\t\t */\n\t\tself.bind = function(target, names, callback, scope) {\n\t\t\tvar id, callbackList, i, name, fakeName, nativeHandler, capture, win = window;\n\n\t\t\t// Native event handler function patches the event and executes the callbacks for the expando\n\t\t\tfunction defaultNativeHandler(evt) {\n\t\t\t\texecuteHandlers(fix(evt || win.event), id);\n\t\t\t}\n\n\t\t\t// Don't bind to text nodes or comments\n\t\t\tif (!target || target.nodeType === 3 || target.nodeType === 8) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Create or get events id for the target\n\t\t\tif (!target[expando]) {\n\t\t\t\tid = count++;\n\t\t\t\ttarget[expando] = id;\n\t\t\t\tevents[id] = {};\n\t\t\t} else {\n\t\t\t\tid = target[expando];\n\t\t\t}\n\n\t\t\t// Setup the specified scope or use the target as a default\n\t\t\tscope = scope || target;\n\n\t\t\t// Split names and bind each event, enables you to bind multiple events with one call\n\t\t\tnames = names.split(' ');\n\t\t\ti = names.length;\n\t\t\twhile (i--) {\n\t\t\t\tname = names[i];\n\t\t\t\tnativeHandler = defaultNativeHandler;\n\t\t\t\tfakeName = capture = false;\n\n\t\t\t\t// Use ready instead of DOMContentLoaded\n\t\t\t\tif (name === \"DOMContentLoaded\") {\n\t\t\t\t\tname = \"ready\";\n\t\t\t\t}\n\n\t\t\t\t// DOM is already ready\n\t\t\t\tif (self.domLoaded && name === \"ready\" && target.readyState == 'complete') {\n\t\t\t\t\tcallback.call(scope, fix({type: name}));\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Handle mouseenter/mouseleaver\n\t\t\t\tif (!hasMouseEnterLeave) {\n\t\t\t\t\tfakeName = mouseEnterLeave[name];\n\n\t\t\t\t\tif (fakeName) {\n\t\t\t\t\t\tnativeHandler = function(evt) {\n\t\t\t\t\t\t\tvar current, related;\n\n\t\t\t\t\t\t\tcurrent = evt.currentTarget;\n\t\t\t\t\t\t\trelated = evt.relatedTarget;\n\n\t\t\t\t\t\t\t// Check if related is inside the current target if it's not then the event should\n\t\t\t\t\t\t\t// be ignored since it's a mouseover/mouseout inside the element\n\t\t\t\t\t\t\tif (related && current.contains) {\n\t\t\t\t\t\t\t\t// Use contains for performance\n\t\t\t\t\t\t\t\trelated = current.contains(related);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\twhile (related && related !== current) {\n\t\t\t\t\t\t\t\t\trelated = related.parentNode;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Fire fake event\n\t\t\t\t\t\t\tif (!related) {\n\t\t\t\t\t\t\t\tevt = fix(evt || win.event);\n\t\t\t\t\t\t\t\tevt.type = evt.type === 'mouseout' ? 'mouseleave' : 'mouseenter';\n\t\t\t\t\t\t\t\tevt.target = current;\n\t\t\t\t\t\t\t\texecuteHandlers(evt, id);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Fake bubbling of focusin/focusout\n\t\t\t\tif (!hasFocusIn && (name === \"focusin\" || name === \"focusout\")) {\n\t\t\t\t\tcapture = true;\n\t\t\t\t\tfakeName = name === \"focusin\" ? \"focus\" : \"blur\";\n\t\t\t\t\tnativeHandler = function(evt) {\n\t\t\t\t\t\tevt = fix(evt || win.event);\n\t\t\t\t\t\tevt.type = evt.type === 'focus' ? 'focusin' : 'focusout';\n\t\t\t\t\t\texecuteHandlers(evt, id);\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\t// Setup callback list and bind native event\n\t\t\t\tcallbackList = events[id][name];\n\t\t\t\tif (!callbackList) {\n\t\t\t\t\tevents[id][name] = callbackList = [{func: callback, scope: scope}];\n\t\t\t\t\tcallbackList.fakeName = fakeName;\n\t\t\t\t\tcallbackList.capture = capture;\n\t\t\t\t\t//callbackList.callback = callback;\n\n\t\t\t\t\t// Add the nativeHandler to the callback list so that we can later unbind it\n\t\t\t\t\tcallbackList.nativeHandler = nativeHandler;\n\n\t\t\t\t\t// Check if the target has native events support\n\n\t\t\t\t\tif (name === \"ready\") {\n\t\t\t\t\t\tbindOnReady(target, nativeHandler, self);\n\t\t\t\t\t} else {\n\t\t\t\t\t\taddEvent(target, fakeName || name, nativeHandler, capture);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (name === \"ready\" && self.domLoaded) {\n\t\t\t\t\t\tcallback({type: name});\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// If it already has an native handler then just push the callback\n\t\t\t\t\t\tcallbackList.push({func: callback, scope: scope});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ttarget = callbackList = 0; // Clean memory for IE\n\n\t\t\treturn callback;\n\t\t};\n\n\t\t/**\n\t\t * Unbinds the specified event by name, name and callback or all events on the target.\n\t\t *\n\t\t * @method unbind\n\t\t * @param {Object} target Target node/window or custom object.\n\t\t * @param {String} names Optional event name to unbind.\n\t\t * @param {function} callback Optional callback function to unbind.\n\t\t * @return {EventUtils} Event utils instance.\n\t\t */\n\t\tself.unbind = function(target, names, callback) {\n\t\t\tvar id, callbackList, i, ci, name, eventMap;\n\n\t\t\t// Don't bind to text nodes or comments\n\t\t\tif (!target || target.nodeType === 3 || target.nodeType === 8) {\n\t\t\t\treturn self;\n\t\t\t}\n\n\t\t\t// Unbind event or events if the target has the expando\n\t\t\tid = target[expando];\n\t\t\tif (id) {\n\t\t\t\teventMap = events[id];\n\n\t\t\t\t// Specific callback\n\t\t\t\tif (names) {\n\t\t\t\t\tnames = names.split(' ');\n\t\t\t\t\ti = names.length;\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tname = names[i];\n\t\t\t\t\t\tcallbackList = eventMap[name];\n\n\t\t\t\t\t\t// Unbind the event if it exists in the map\n\t\t\t\t\t\tif (callbackList) {\n\t\t\t\t\t\t\t// Remove specified callback\n\t\t\t\t\t\t\tif (callback) {\n\t\t\t\t\t\t\t\tci = callbackList.length;\n\t\t\t\t\t\t\t\twhile (ci--) {\n\t\t\t\t\t\t\t\t\tif (callbackList[ci].func === callback) {\n\t\t\t\t\t\t\t\t\t\tvar nativeHandler = callbackList.nativeHandler;\n\t\t\t\t\t\t\t\t\t\tvar fakeName = callbackList.fakeName, capture = callbackList.capture;\n\n\t\t\t\t\t\t\t\t\t\t// Clone callbackList since unbind inside a callback would otherwise break the handlers loop\n\t\t\t\t\t\t\t\t\t\tcallbackList = callbackList.slice(0, ci).concat(callbackList.slice(ci + 1));\n\t\t\t\t\t\t\t\t\t\tcallbackList.nativeHandler = nativeHandler;\n\t\t\t\t\t\t\t\t\t\tcallbackList.fakeName = fakeName;\n\t\t\t\t\t\t\t\t\t\tcallbackList.capture = capture;\n\n\t\t\t\t\t\t\t\t\t\teventMap[name] = callbackList;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Remove all callbacks if there isn't a specified callback or there is no callbacks left\n\t\t\t\t\t\t\tif (!callback || callbackList.length === 0) {\n\t\t\t\t\t\t\t\tdelete eventMap[name];\n\t\t\t\t\t\t\t\tremoveEvent(target, callbackList.fakeName || name, callbackList.nativeHandler, callbackList.capture);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// All events for a specific element\n\t\t\t\t\tfor (name in eventMap) {\n\t\t\t\t\t\tcallbackList = eventMap[name];\n\t\t\t\t\t\tremoveEvent(target, callbackList.fakeName || name, callbackList.nativeHandler, callbackList.capture);\n\t\t\t\t\t}\n\n\t\t\t\t\teventMap = {};\n\t\t\t\t}\n\n\t\t\t\t// Check if object is empty, if it isn't then we won't remove the expando map\n\t\t\t\tfor (name in eventMap) {\n\t\t\t\t\treturn self;\n\t\t\t\t}\n\n\t\t\t\t// Delete event object\n\t\t\t\tdelete events[id];\n\n\t\t\t\t// Remove expando from target\n\t\t\t\ttry {\n\t\t\t\t\t// IE will fail here since it can't delete properties from window\n\t\t\t\t\tdelete target[expando];\n\t\t\t\t} catch (ex) {\n\t\t\t\t\t// IE will set it to null\n\t\t\t\t\ttarget[expando] = null;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn self;\n\t\t};\n\n\t\t/**\n\t\t * Fires the specified event on the specified target.\n\t\t *\n\t\t * @method fire\n\t\t * @param {Object} target Target node/window or custom object.\n\t\t * @param {String} name Event name to fire.\n\t\t * @param {Object} args Optional arguments to send to the observers.\n\t\t * @return {EventUtils} Event utils instance.\n\t\t */\n\t\tself.fire = function(target, name, args) {\n\t\t\tvar id;\n\n\t\t\t// Don't bind to text nodes or comments\n\t\t\tif (!target || target.nodeType === 3 || target.nodeType === 8) {\n\t\t\t\treturn self;\n\t\t\t}\n\n\t\t\t// Build event object by patching the args\n\t\t\targs = fix(null, args);\n\t\t\targs.type = name;\n\t\t\targs.target = target;\n\n\t\t\tdo {\n\t\t\t\t// Found an expando that means there is listeners to execute\n\t\t\t\tid = target[expando];\n\t\t\t\tif (id) {\n\t\t\t\t\texecuteHandlers(args, id);\n\t\t\t\t}\n\n\t\t\t\t// Walk up the DOM\n\t\t\t\ttarget = target.parentNode || target.ownerDocument || target.defaultView || target.parentWindow;\n\t\t\t} while (target && !args.isPropagationStopped());\n\n\t\t\treturn self;\n\t\t};\n\n\t\t/**\n\t\t * Removes all bound event listeners for the specified target. This will also remove any bound\n\t\t * listeners to child nodes within that target.\n\t\t *\n\t\t * @method clean\n\t\t * @param {Object} target Target node/window object.\n\t\t * @return {EventUtils} Event utils instance.\n\t\t */\n\t\tself.clean = function(target) {\n\t\t\tvar i, children, unbind = self.unbind;\n\n\t\t\t// Don't bind to text nodes or comments\n\t\t\tif (!target || target.nodeType === 3 || target.nodeType === 8) {\n\t\t\t\treturn self;\n\t\t\t}\n\n\t\t\t// Unbind any element on the specified target\n\t\t\tif (target[expando]) {\n\t\t\t\tunbind(target);\n\t\t\t}\n\n\t\t\t// Target doesn't have getElementsByTagName it's probably a window object then use it's document to find the children\n\t\t\tif (!target.getElementsByTagName) {\n\t\t\t\ttarget = target.document;\n\t\t\t}\n\n\t\t\t// Remove events from each child element\n\t\t\tif (target && target.getElementsByTagName) {\n\t\t\t\tunbind(target);\n\n\t\t\t\tchildren = target.getElementsByTagName('*');\n\t\t\t\ti = children.length;\n\t\t\t\twhile (i--) {\n\t\t\t\t\ttarget = children[i];\n\n\t\t\t\t\tif (target[expando]) {\n\t\t\t\t\t\tunbind(target);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn self;\n\t\t};\n\n\t\t/**\n\t\t * Destroys the event object. Call this on IE to remove memory leaks.\n\t\t */\n\t\tself.destroy = function() {\n\t\t\tevents = {};\n\t\t};\n\n\t\t// Legacy function for canceling events\n\t\tself.cancel = function(e) {\n\t\t\tif (e) {\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopImmediatePropagation();\n\t\t\t}\n\n\t\t\treturn false;\n\t\t};\n\t}\n\n\tEventUtils.Event = new EventUtils();\n\tEventUtils.Event.bind(window, 'ready', function() {});\n\n\treturn EventUtils;\n});\n\n// Included from: js/tinymce/classes/dom/Sizzle.js\n\n/**\n * Sizzle.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n *\n * @ignore-file\n */\n\n/*jshint bitwise:false, expr:true, noempty:false, sub:true, eqnull:true, latedef:false, maxlen:255 */\n/*eslint-disable */\n\n/**\n * Sizzle CSS Selector Engine v@VERSION\n * http://sizzlejs.com/\n *\n * Copyright 2008, 2014 jQuery Foundation, Inc. and other contributors\n * Released under the MIT license\n * http://jquery.org/license\n *\n * Date: @DATE\n */\ndefine(\"tinymce/dom/Sizzle\", [], function() {\nvar i,\n\tsupport,\n\tExpr,\n\tgetText,\n\tisXML,\n\ttokenize,\n\tcompile,\n\tselect,\n\toutermostContext,\n\tsortInput,\n\thasDuplicate,\n\n\t// Local document vars\n\tsetDocument,\n\tdocument,\n\tdocElem,\n\tdocumentIsHTML,\n\trbuggyQSA,\n\trbuggyMatches,\n\tmatches,\n\tcontains,\n\n\t// Instance-specific data\n\texpando = \"sizzle\" + -(new Date()),\n\tpreferredDoc = window.document,\n\tdirruns = 0,\n\tdone = 0,\n\tclassCache = createCache(),\n\ttokenCache = createCache(),\n\tcompilerCache = createCache(),\n\tsortOrder = function( a, b ) {\n\t\tif ( a === b ) {\n\t\t\thasDuplicate = true;\n\t\t}\n\t\treturn 0;\n\t},\n\n\t// General-purpose constants\n\tstrundefined = typeof undefined,\n\tMAX_NEGATIVE = 1 << 31,\n\n\t// Instance methods\n\thasOwn = ({}).hasOwnProperty,\n\tarr = [],\n\tpop = arr.pop,\n\tpush_native = arr.push,\n\tpush = arr.push,\n\tslice = arr.slice,\n\t// Use a stripped-down indexOf if we can't use a native one\n\tindexOf = arr.indexOf || function( elem ) {\n\t\tvar i = 0,\n\t\t\tlen = this.length;\n\t\tfor ( ; i < len; i++ ) {\n\t\t\tif ( this[i] === elem ) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\t\treturn -1;\n\t},\n\n\tbooleans = \"checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped\",\n\n\t// Regular expressions\n\n\t// http://www.w3.org/TR/css3-selectors/#whitespace\n\twhitespace = \"[\\\\x20\\\\t\\\\r\\\\n\\\\f]\",\n\n\t// http://www.w3.org/TR/CSS21/syndata.html#value-def-identifier\n\tidentifier = \"(?:\\\\\\\\.|[\\\\w-]|[^\\\\x00-\\\\xa0])+\",\n\n\t// Attribute selectors: http://www.w3.org/TR/selectors/#attribute-selectors\n\tattributes = \"\\\\[\" + whitespace + \"*(\" + identifier + \")(?:\" + whitespace +\n\t\t// Operator (capture 2)\n\t\t\"*([*^$|!~]?=)\" + whitespace +\n\t\t// \"Attribute values must be CSS identifiers [capture 5] or strings [capture 3 or capture 4]\"\n\t\t\"*(?:'((?:\\\\\\\\.|[^\\\\\\\\'])*)'|\\\"((?:\\\\\\\\.|[^\\\\\\\\\\\"])*)\\\"|(\" + identifier + \"))|)\" + whitespace +\n\t\t\"*\\\\]\",\n\n\tpseudos = \":(\" + identifier + \")(?:\\\\((\" +\n\t\t// To reduce the number of selectors needing tokenize in the preFilter, prefer arguments:\n\t\t// 1. quoted (capture 3; capture 4 or capture 5)\n\t\t\"('((?:\\\\\\\\.|[^\\\\\\\\'])*)'|\\\"((?:\\\\\\\\.|[^\\\\\\\\\\\"])*)\\\")|\" +\n\t\t// 2. simple (capture 6)\n\t\t\"((?:\\\\\\\\.|[^\\\\\\\\()[\\\\]]|\" + attributes + \")*)|\" +\n\t\t// 3. anything else (capture 2)\n\t\t\".*\" +\n\t\t\")\\\\)|)\",\n\n\t// Leading and non-escaped trailing whitespace, capturing some non-whitespace characters preceding the latter\n\trtrim = new RegExp( \"^\" + whitespace + \"+|((?:^|[^\\\\\\\\])(?:\\\\\\\\.)*)\" + whitespace + \"+$\", \"g\" ),\n\n\trcomma = new RegExp( \"^\" + whitespace + \"*,\" + whitespace + \"*\" ),\n\trcombinators = new RegExp( \"^\" + whitespace + \"*([>+~]|\" + whitespace + \")\" + whitespace + \"*\" ),\n\n\trattributeQuotes = new RegExp( \"=\" + whitespace + \"*([^\\\\]'\\\"]*?)\" + whitespace + \"*\\\\]\", \"g\" ),\n\n\trpseudo = new RegExp( pseudos ),\n\tridentifier = new RegExp( \"^\" + identifier + \"$\" ),\n\n\tmatchExpr = {\n\t\t\"ID\": new RegExp( \"^#(\" + identifier + \")\" ),\n\t\t\"CLASS\": new RegExp( \"^\\\\.(\" + identifier + \")\" ),\n\t\t\"TAG\": new RegExp( \"^(\" + identifier + \"|[*])\" ),\n\t\t\"ATTR\": new RegExp( \"^\" + attributes ),\n\t\t\"PSEUDO\": new RegExp( \"^\" + pseudos ),\n\t\t\"CHILD\": new RegExp( \"^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\\\(\" + whitespace +\n\t\t\t\"*(even|odd|(([+-]|)(\\\\d*)n|)\" + whitespace + \"*(?:([+-]|)\" + whitespace +\n\t\t\t\"*(\\\\d+)|))\" + whitespace + \"*\\\\)|)\", \"i\" ),\n\t\t\"bool\": new RegExp( \"^(?:\" + booleans + \")$\", \"i\" ),\n\t\t// For use in libraries implementing .is()\n\t\t// We use this for POS matching in `select`\n\t\t\"needsContext\": new RegExp( \"^\" + whitespace + \"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\\\(\" +\n\t\t\twhitespace + \"*((?:-\\\\d)?\\\\d*)\" + whitespace + \"*\\\\)|)(?=[^-]|$)\", \"i\" )\n\t},\n\n\trinputs = /^(?:input|select|textarea|button)$/i,\n\trheader = /^h\\d$/i,\n\n\trnative = /^[^{]+\\{\\s*\\[native \\w/,\n\n\t// Easily-parseable/retrievable ID or TAG or CLASS selectors\n\trquickExpr = /^(?:#([\\w-]+)|(\\w+)|\\.([\\w-]+))$/,\n\n\trsibling = /[+~]/,\n\trescape = /'|\\\\/g,\n\n\t// CSS escapes http://www.w3.org/TR/CSS21/syndata.html#escaped-characters\n\trunescape = new RegExp( \"\\\\\\\\([\\\\da-f]{1,6}\" + whitespace + \"?|(\" + whitespace + \")|.)\", \"ig\" ),\n\tfunescape = function( _, escaped, escapedWhitespace ) {\n\t\tvar high = \"0x\" + escaped - 0x10000;\n\t\t// NaN means non-codepoint\n\t\t// Support: Firefox<24\n\t\t// Workaround erroneous numeric interpretation of +\"0x\"\n\t\treturn high !== high || escapedWhitespace ?\n\t\t\tescaped :\n\t\t\thigh < 0 ?\n\t\t\t\t// BMP codepoint\n\t\t\t\tString.fromCharCode( high + 0x10000 ) :\n\t\t\t\t// Supplemental Plane codepoint (surrogate pair)\n\t\t\t\tString.fromCharCode( high >> 10 | 0xD800, high & 0x3FF | 0xDC00 );\n\t};\n\n// Optimize for push.apply( _, NodeList )\ntry {\n\tpush.apply(\n\t\t(arr = slice.call( preferredDoc.childNodes )),\n\t\tpreferredDoc.childNodes\n\t);\n\t// Support: Android<4.0\n\t// Detect silently failing push.apply\n\tarr[ preferredDoc.childNodes.length ].nodeType;\n} catch ( e ) {\n\tpush = { apply: arr.length ?\n\n\t\t// Leverage slice if possible\n\t\tfunction( target, els ) {\n\t\t\tpush_native.apply( target, slice.call(els) );\n\t\t} :\n\n\t\t// Support: IE<9\n\t\t// Otherwise append directly\n\t\tfunction( target, els ) {\n\t\t\tvar j = target.length,\n\t\t\t\ti = 0;\n\t\t\t// Can't trust NodeList.length\n\t\t\twhile ( (target[j++] = els[i++]) ) {}\n\t\t\ttarget.length = j - 1;\n\t\t}\n\t};\n}\n\nfunction Sizzle( selector, context, results, seed ) {\n\tvar match, elem, m, nodeType,\n\t\t// QSA vars\n\t\ti, groups, old, nid, newContext, newSelector;\n\n\tif ( ( context ? context.ownerDocument || context : preferredDoc ) !== document ) {\n\t\tsetDocument( context );\n\t}\n\n\tcontext = context || document;\n\tresults = results || [];\n\n\tif ( !selector || typeof selector !== \"string\" ) {\n\t\treturn results;\n\t}\n\n\tif ( (nodeType = context.nodeType) !== 1 && nodeType !== 9 ) {\n\t\treturn [];\n\t}\n\n\tif ( documentIsHTML && !seed ) {\n\n\t\t// Shortcuts\n\t\tif ( (match = rquickExpr.exec( selector )) ) {\n\t\t\t// Speed-up: Sizzle(\"#ID\")\n\t\t\tif ( (m = match[1]) ) {\n\t\t\t\tif ( nodeType === 9 ) {\n\t\t\t\t\telem = context.getElementById( m );\n\t\t\t\t\t// Check parentNode to catch when Blackberry 4.6 returns\n\t\t\t\t\t// nodes that are no longer in the document (jQuery #6963)\n\t\t\t\t\tif ( elem && elem.parentNode ) {\n\t\t\t\t\t\t// Handle the case where IE, Opera, and Webkit return items\n\t\t\t\t\t\t// by name instead of ID\n\t\t\t\t\t\tif ( elem.id === m ) {\n\t\t\t\t\t\t\tresults.push( elem );\n\t\t\t\t\t\t\treturn results;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn results;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// Context is not a document\n\t\t\t\t\tif ( context.ownerDocument && (elem = context.ownerDocument.getElementById( m )) &&\n\t\t\t\t\t\tcontains( context, elem ) && elem.id === m ) {\n\t\t\t\t\t\tresults.push( elem );\n\t\t\t\t\t\treturn results;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t// Speed-up: Sizzle(\"TAG\")\n\t\t\t} else if ( match[2] ) {\n\t\t\t\tpush.apply( results, context.getElementsByTagName( selector ) );\n\t\t\t\treturn results;\n\n\t\t\t// Speed-up: Sizzle(\".CLASS\")\n\t\t\t} else if ( (m = match[3]) && support.getElementsByClassName ) {\n\t\t\t\tpush.apply( results, context.getElementsByClassName( m ) );\n\t\t\t\treturn results;\n\t\t\t}\n\t\t}\n\n\t\t// QSA path\n\t\tif ( support.qsa && (!rbuggyQSA || !rbuggyQSA.test( selector )) ) {\n\t\t\tnid = old = expando;\n\t\t\tnewContext = context;\n\t\t\tnewSelector = nodeType === 9 && selector;\n\n\t\t\t// qSA works strangely on Element-rooted queries\n\t\t\t// We can work around this by specifying an extra ID on the root\n\t\t\t// and working up from there (Thanks to Andrew Dupont for the technique)\n\t\t\t// IE 8 doesn't work on object elements\n\t\t\tif ( nodeType === 1 && context.nodeName.toLowerCase() !== \"object\" ) {\n\t\t\t\tgroups = tokenize( selector );\n\n\t\t\t\tif ( (old = context.getAttribute(\"id\")) ) {\n\t\t\t\t\tnid = old.replace( rescape, \"\\\\$&\" );\n\t\t\t\t} else {\n\t\t\t\t\tcontext.setAttribute( \"id\", nid );\n\t\t\t\t}\n\t\t\t\tnid = \"[id='\" + nid + \"'] \";\n\n\t\t\t\ti = groups.length;\n\t\t\t\twhile ( i-- ) {\n\t\t\t\t\tgroups[i] = nid + toSelector( groups[i] );\n\t\t\t\t}\n\t\t\t\tnewContext = rsibling.test( selector ) && testContext( context.parentNode ) || context;\n\t\t\t\tnewSelector = groups.join(\",\");\n\t\t\t}\n\n\t\t\tif ( newSelector ) {\n\t\t\t\ttry {\n\t\t\t\t\tpush.apply( results,\n\t\t\t\t\t\tnewContext.querySelectorAll( newSelector )\n\t\t\t\t\t);\n\t\t\t\t\treturn results;\n\t\t\t\t} catch(qsaError) {\n\t\t\t\t} finally {\n\t\t\t\t\tif ( !old ) {\n\t\t\t\t\t\tcontext.removeAttribute(\"id\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// All others\n\treturn select( selector.replace( rtrim, \"$1\" ), context, results, seed );\n}\n\n/**\n * Create key-value caches of limited size\n * @returns {Function(string, Object)} Returns the Object data after storing it on itself with\n *\tproperty name the (space-suffixed) string and (if the cache is larger than Expr.cacheLength)\n *\tdeleting the oldest entry\n */\nfunction createCache() {\n\tvar keys = [];\n\n\tfunction cache( key, value ) {\n\t\t// Use (key + \" \") to avoid collision with native prototype properties (see Issue #157)\n\t\tif ( keys.push( key + \" \" ) > Expr.cacheLength ) {\n\t\t\t// Only keep the most recent entries\n\t\t\tdelete cache[ keys.shift() ];\n\t\t}\n\t\treturn (cache[ key + \" \" ] = value);\n\t}\n\treturn cache;\n}\n\n/**\n * Mark a function for special use by Sizzle\n * @param {Function} fn The function to mark\n */\nfunction markFunction( fn ) {\n\tfn[ expando ] = true;\n\treturn fn;\n}\n\n/**\n * Support testing using an element\n * @param {Function} fn Passed the created div and expects a boolean result\n */\nfunction assert( fn ) {\n\tvar div = document.createElement(\"div\");\n\n\ttry {\n\t\treturn !!fn( div );\n\t} catch (e) {\n\t\treturn false;\n\t} finally {\n\t\t// Remove from its parent by default\n\t\tif ( div.parentNode ) {\n\t\t\tdiv.parentNode.removeChild( div );\n\t\t}\n\t\t// release memory in IE\n\t\tdiv = null;\n\t}\n}\n\n/**\n * Adds the same handler for all of the specified attrs\n * @param {String} attrs Pipe-separated list of attributes\n * @param {Function} handler The method that will be applied\n */\nfunction addHandle( attrs, handler ) {\n\tvar arr = attrs.split(\"|\"),\n\t\ti = attrs.length;\n\n\twhile ( i-- ) {\n\t\tExpr.attrHandle[ arr[i] ] = handler;\n\t}\n}\n\n/**\n * Checks document order of two siblings\n * @param {Element} a\n * @param {Element} b\n * @returns {Number} Returns less than 0 if a precedes b, greater than 0 if a follows b\n */\nfunction siblingCheck( a, b ) {\n\tvar cur = b && a,\n\t\tdiff = cur && a.nodeType === 1 && b.nodeType === 1 &&\n\t\t\t( ~b.sourceIndex || MAX_NEGATIVE ) -\n\t\t\t( ~a.sourceIndex || MAX_NEGATIVE );\n\n\t// Use IE sourceIndex if available on both nodes\n\tif ( diff ) {\n\t\treturn diff;\n\t}\n\n\t// Check if b follows a\n\tif ( cur ) {\n\t\twhile ( (cur = cur.nextSibling) ) {\n\t\t\tif ( cur === b ) {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn a ? 1 : -1;\n}\n\n/**\n * Returns a function to use in pseudos for input types\n * @param {String} type\n */\nfunction createInputPseudo( type ) {\n\treturn function( elem ) {\n\t\tvar name = elem.nodeName.toLowerCase();\n\t\treturn name === \"input\" && elem.type === type;\n\t};\n}\n\n/**\n * Returns a function to use in pseudos for buttons\n * @param {String} type\n */\nfunction createButtonPseudo( type ) {\n\treturn function( elem ) {\n\t\tvar name = elem.nodeName.toLowerCase();\n\t\treturn (name === \"input\" || name === \"button\") && elem.type === type;\n\t};\n}\n\n/**\n * Returns a function to use in pseudos for positionals\n * @param {Function} fn\n */\nfunction createPositionalPseudo( fn ) {\n\treturn markFunction(function( argument ) {\n\t\targument = +argument;\n\t\treturn markFunction(function( seed, matches ) {\n\t\t\tvar j,\n\t\t\t\tmatchIndexes = fn( [], seed.length, argument ),\n\t\t\t\ti = matchIndexes.length;\n\n\t\t\t// Match elements found at the specified indexes\n\t\t\twhile ( i-- ) {\n\t\t\t\tif ( seed[ (j = matchIndexes[i]) ] ) {\n\t\t\t\t\tseed[j] = !(matches[j] = seed[j]);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t});\n}\n\n/**\n * Checks a node for validity as a Sizzle context\n * @param {Element|Object=} context\n * @returns {Element|Object|Boolean} The input node if acceptable, otherwise a falsy value\n */\nfunction testContext( context ) {\n\treturn context && typeof context.getElementsByTagName !== strundefined && context;\n}\n\n// Expose support vars for convenience\nsupport = Sizzle.support = {};\n\n/**\n * Detects XML nodes\n * @param {Element|Object} elem An element or a document\n * @returns {Boolean} True iff elem is a non-HTML XML node\n */\nisXML = Sizzle.isXML = function( elem ) {\n\t// documentElement is verified for cases where it doesn't yet exist\n\t// (such as loading iframes in IE - #4833)\n\tvar documentElement = elem && (elem.ownerDocument || elem).documentElement;\n\treturn documentElement ? documentElement.nodeName !== \"HTML\" : false;\n};\n\n/**\n * Sets document-related variables once based on the current document\n * @param {Element|Object} [doc] An element or document object to use to set the document\n * @returns {Object} Returns the current document\n */\nsetDocument = Sizzle.setDocument = function( node ) {\n\tvar hasCompare,\n\t\tdoc = node ? node.ownerDocument || node : preferredDoc,\n\t\tparent = doc.defaultView;\n\n\tfunction getTop(win) {\n\t\t// Edge throws a lovely Object expected if you try to get top on a detached reference see #2642\n\t\ttry {\n\t\t\treturn win.top;\n\t\t} catch (ex) {\n\t\t\t// Ignore\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t// If no document and documentElement is available, return\n\tif ( doc === document || doc.nodeType !== 9 || !doc.documentElement ) {\n\t\treturn document;\n\t}\n\n\t// Set our document\n\tdocument = doc;\n\tdocElem = doc.documentElement;\n\n\t// Support tests\n\tdocumentIsHTML = !isXML( doc );\n\n\t// Support: IE>8\n\t// If iframe document is assigned to \"document\" variable and if iframe has been reloaded,\n\t// IE will throw \"permission denied\" error when accessing \"document\" variable, see jQuery #13936\n\t// IE6-8 do not support the defaultView property so parent will be undefined\n\tif ( parent && parent !== getTop(parent) ) {\n\t\t// IE11 does not have attachEvent, so all must suffer\n\t\tif ( parent.addEventListener ) {\n\t\t\tparent.addEventListener( \"unload\", function() {\n\t\t\t\tsetDocument();\n\t\t\t}, false );\n\t\t} else if ( parent.attachEvent ) {\n\t\t\tparent.attachEvent( \"onunload\", function() {\n\t\t\t\tsetDocument();\n\t\t\t});\n\t\t}\n\t}\n\n\t/* Attributes\n\t---------------------------------------------------------------------- */\n\n\t// Support: IE<8\n\t// Verify that getAttribute really returns attributes and not properties (excepting IE8 booleans)\n\tsupport.attributes = assert(function( div ) {\n\t\tdiv.className = \"i\";\n\t\treturn !div.getAttribute(\"className\");\n\t});\n\n\t/* getElement(s)By*\n\t---------------------------------------------------------------------- */\n\n\t// Check if getElementsByTagName(\"*\") returns only elements\n\tsupport.getElementsByTagName = assert(function( div ) {\n\t\tdiv.appendChild( doc.createComment(\"\") );\n\t\treturn !div.getElementsByTagName(\"*\").length;\n\t});\n\n\t// Support: IE<9\n\tsupport.getElementsByClassName = rnative.test( doc.getElementsByClassName );\n\n\t// Support: IE<10\n\t// Check if getElementById returns elements by name\n\t// The broken getElementById methods don't pick up programatically-set names,\n\t// so use a roundabout getElementsByName test\n\tsupport.getById = assert(function( div ) {\n\t\tdocElem.appendChild( div ).id = expando;\n\t\treturn !doc.getElementsByName || !doc.getElementsByName( expando ).length;\n\t});\n\n\t// ID find and filter\n\tif ( support.getById ) {\n\t\tExpr.find[\"ID\"] = function( id, context ) {\n\t\t\tif ( typeof context.getElementById !== strundefined && documentIsHTML ) {\n\t\t\t\tvar m = context.getElementById( id );\n\t\t\t\t// Check parentNode to catch when Blackberry 4.6 returns\n\t\t\t\t// nodes that are no longer in the document #6963\n\t\t\t\treturn m && m.parentNode ? [ m ] : [];\n\t\t\t}\n\t\t};\n\t\tExpr.filter[\"ID\"] = function( id ) {\n\t\t\tvar attrId = id.replace( runescape, funescape );\n\t\t\treturn function( elem ) {\n\t\t\t\treturn elem.getAttribute(\"id\") === attrId;\n\t\t\t};\n\t\t};\n\t} else {\n\t\t// Support: IE6/7\n\t\t// getElementById is not reliable as a find shortcut\n\t\tdelete Expr.find[\"ID\"];\n\n\t\tExpr.filter[\"ID\"] =  function( id ) {\n\t\t\tvar attrId = id.replace( runescape, funescape );\n\t\t\treturn function( elem ) {\n\t\t\t\tvar node = typeof elem.getAttributeNode !== strundefined && elem.getAttributeNode(\"id\");\n\t\t\t\treturn node && node.value === attrId;\n\t\t\t};\n\t\t};\n\t}\n\n\t// Tag\n\tExpr.find[\"TAG\"] = support.getElementsByTagName ?\n\t\tfunction( tag, context ) {\n\t\t\tif ( typeof context.getElementsByTagName !== strundefined ) {\n\t\t\t\treturn context.getElementsByTagName( tag );\n\t\t\t}\n\t\t} :\n\t\tfunction( tag, context ) {\n\t\t\tvar elem,\n\t\t\t\ttmp = [],\n\t\t\t\ti = 0,\n\t\t\t\tresults = context.getElementsByTagName( tag );\n\n\t\t\t// Filter out possible comments\n\t\t\tif ( tag === \"*\" ) {\n\t\t\t\twhile ( (elem = results[i++]) ) {\n\t\t\t\t\tif ( elem.nodeType === 1 ) {\n\t\t\t\t\t\ttmp.push( elem );\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn tmp;\n\t\t\t}\n\t\t\treturn results;\n\t\t};\n\n\t// Class\n\tExpr.find[\"CLASS\"] = support.getElementsByClassName && function( className, context ) {\n\t\tif ( documentIsHTML ) {\n\t\t\treturn context.getElementsByClassName( className );\n\t\t}\n\t};\n\n\t/* QSA/matchesSelector\n\t---------------------------------------------------------------------- */\n\n\t// QSA and matchesSelector support\n\n\t// matchesSelector(:active) reports false when true (IE9/Opera 11.5)\n\trbuggyMatches = [];\n\n\t// qSa(:focus) reports false when true (Chrome 21)\n\t// We allow this because of a bug in IE8/9 that throws an error\n\t// whenever `document.activeElement` is accessed on an iframe\n\t// So, we allow :focus to pass through QSA all the time to avoid the IE error\n\t// See http://bugs.jquery.com/ticket/13378\n\trbuggyQSA = [];\n\n\tif ( (support.qsa = rnative.test( doc.querySelectorAll )) ) {\n\t\t// Build QSA regex\n\t\t// Regex strategy adopted from Diego Perini\n\t\tassert(function( div ) {\n\t\t\t// Select is set to empty string on purpose\n\t\t\t// This is to test IE's treatment of not explicitly\n\t\t\t// setting a boolean content attribute,\n\t\t\t// since its presence should be enough\n\t\t\t// http://bugs.jquery.com/ticket/12359\n\t\t\tdiv.innerHTML = \"<select msallowcapture=''><option selected=''></option></select>\";\n\n\t\t\t// Support: IE8, Opera 11-12.16\n\t\t\t// Nothing should be selected when empty strings follow ^= or $= or *=\n\t\t\t// The test attribute must be unknown in Opera but \"safe\" for WinRT\n\t\t\t// http://msdn.microsoft.com/en-us/library/ie/hh465388.aspx#attribute_section\n\t\t\tif ( div.querySelectorAll(\"[msallowcapture^='']\").length ) {\n\t\t\t\trbuggyQSA.push( \"[*^$]=\" + whitespace + \"*(?:''|\\\"\\\")\" );\n\t\t\t}\n\n\t\t\t// Support: IE8\n\t\t\t// Boolean attributes and \"value\" are not treated correctly\n\t\t\tif ( !div.querySelectorAll(\"[selected]\").length ) {\n\t\t\t\trbuggyQSA.push( \"\\\\[\" + whitespace + \"*(?:value|\" + booleans + \")\" );\n\t\t\t}\n\n\t\t\t// Webkit/Opera - :checked should return selected option elements\n\t\t\t// http://www.w3.org/TR/2011/REC-css3-selectors-20110929/#checked\n\t\t\t// IE8 throws error here and will not see later tests\n\t\t\tif ( !div.querySelectorAll(\":checked\").length ) {\n\t\t\t\trbuggyQSA.push(\":checked\");\n\t\t\t}\n\t\t});\n\n\t\tassert(function( div ) {\n\t\t\t// Support: Windows 8 Native Apps\n\t\t\t// The type and name attributes are restricted during .innerHTML assignment\n\t\t\tvar input = doc.createElement(\"input\");\n\t\t\tinput.setAttribute( \"type\", \"hidden\" );\n\t\t\tdiv.appendChild( input ).setAttribute( \"name\", \"D\" );\n\n\t\t\t// Support: IE8\n\t\t\t// Enforce case-sensitivity of name attribute\n\t\t\tif ( div.querySelectorAll(\"[name=d]\").length ) {\n\t\t\t\trbuggyQSA.push( \"name\" + whitespace + \"*[*^$|!~]?=\" );\n\t\t\t}\n\n\t\t\t// FF 3.5 - :enabled/:disabled and hidden elements (hidden elements are still enabled)\n\t\t\t// IE8 throws error here and will not see later tests\n\t\t\tif ( !div.querySelectorAll(\":enabled\").length ) {\n\t\t\t\trbuggyQSA.push( \":enabled\", \":disabled\" );\n\t\t\t}\n\n\t\t\t// Opera 10-11 does not throw on post-comma invalid pseudos\n\t\t\tdiv.querySelectorAll(\"*,:x\");\n\t\t\trbuggyQSA.push(\",.*:\");\n\t\t});\n\t}\n\n\tif ( (support.matchesSelector = rnative.test( (matches = docElem.matches ||\n\t\tdocElem.webkitMatchesSelector ||\n\t\tdocElem.mozMatchesSelector ||\n\t\tdocElem.oMatchesSelector ||\n\t\tdocElem.msMatchesSelector) )) ) {\n\n\t\tassert(function( div ) {\n\t\t\t// Check to see if it's possible to do matchesSelector\n\t\t\t// on a disconnected node (IE 9)\n\t\t\tsupport.disconnectedMatch = matches.call( div, \"div\" );\n\n\t\t\t// This should fail with an exception\n\t\t\t// Gecko does not error, returns false instead\n\t\t\tmatches.call( div, \"[s!='']:x\" );\n\t\t\trbuggyMatches.push( \"!=\", pseudos );\n\t\t});\n\t}\n\n\trbuggyQSA = rbuggyQSA.length && new RegExp( rbuggyQSA.join(\"|\") );\n\trbuggyMatches = rbuggyMatches.length && new RegExp( rbuggyMatches.join(\"|\") );\n\n\t/* Contains\n\t---------------------------------------------------------------------- */\n\thasCompare = rnative.test( docElem.compareDocumentPosition );\n\n\t// Element contains another\n\t// Purposefully does not implement inclusive descendent\n\t// As in, an element does not contain itself\n\tcontains = hasCompare || rnative.test( docElem.contains ) ?\n\t\tfunction( a, b ) {\n\t\t\tvar adown = a.nodeType === 9 ? a.documentElement : a,\n\t\t\t\tbup = b && b.parentNode;\n\t\t\treturn a === bup || !!( bup && bup.nodeType === 1 && (\n\t\t\t\tadown.contains ?\n\t\t\t\t\tadown.contains( bup ) :\n\t\t\t\t\ta.compareDocumentPosition && a.compareDocumentPosition( bup ) & 16\n\t\t\t));\n\t\t} :\n\t\tfunction( a, b ) {\n\t\t\tif ( b ) {\n\t\t\t\twhile ( (b = b.parentNode) ) {\n\t\t\t\t\tif ( b === a ) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t};\n\n\t/* Sorting\n\t---------------------------------------------------------------------- */\n\n\t// Document order sorting\n\tsortOrder = hasCompare ?\n\tfunction( a, b ) {\n\n\t\t// Flag for duplicate removal\n\t\tif ( a === b ) {\n\t\t\thasDuplicate = true;\n\t\t\treturn 0;\n\t\t}\n\n\t\t// Sort on method existence if only one input has compareDocumentPosition\n\t\tvar compare = !a.compareDocumentPosition - !b.compareDocumentPosition;\n\t\tif ( compare ) {\n\t\t\treturn compare;\n\t\t}\n\n\t\t// Calculate position if both inputs belong to the same document\n\t\tcompare = ( a.ownerDocument || a ) === ( b.ownerDocument || b ) ?\n\t\t\ta.compareDocumentPosition( b ) :\n\n\t\t\t// Otherwise we know they are disconnected\n\t\t\t1;\n\n\t\t// Disconnected nodes\n\t\tif ( compare & 1 ||\n\t\t\t(!support.sortDetached && b.compareDocumentPosition( a ) === compare) ) {\n\n\t\t\t// Choose the first element that is related to our preferred document\n\t\t\tif ( a === doc || a.ownerDocument === preferredDoc && contains(preferredDoc, a) ) {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\tif ( b === doc || b.ownerDocument === preferredDoc && contains(preferredDoc, b) ) {\n\t\t\t\treturn 1;\n\t\t\t}\n\n\t\t\t// Maintain original order\n\t\t\treturn sortInput ?\n\t\t\t\t( indexOf.call( sortInput, a ) - indexOf.call( sortInput, b ) ) :\n\t\t\t\t0;\n\t\t}\n\n\t\treturn compare & 4 ? -1 : 1;\n\t} :\n\tfunction( a, b ) {\n\t\t// Exit early if the nodes are identical\n\t\tif ( a === b ) {\n\t\t\thasDuplicate = true;\n\t\t\treturn 0;\n\t\t}\n\n\t\tvar cur,\n\t\t\ti = 0,\n\t\t\taup = a.parentNode,\n\t\t\tbup = b.parentNode,\n\t\t\tap = [ a ],\n\t\t\tbp = [ b ];\n\n\t\t// Parentless nodes are either documents or disconnected\n\t\tif ( !aup || !bup ) {\n\t\t\treturn a === doc ? -1 :\n\t\t\t\tb === doc ? 1 :\n\t\t\t\taup ? -1 :\n\t\t\t\tbup ? 1 :\n\t\t\t\tsortInput ?\n\t\t\t\t( indexOf.call( sortInput, a ) - indexOf.call( sortInput, b ) ) :\n\t\t\t\t0;\n\n\t\t// If the nodes are siblings, we can do a quick check\n\t\t} else if ( aup === bup ) {\n\t\t\treturn siblingCheck( a, b );\n\t\t}\n\n\t\t// Otherwise we need full lists of their ancestors for comparison\n\t\tcur = a;\n\t\twhile ( (cur = cur.parentNode) ) {\n\t\t\tap.unshift( cur );\n\t\t}\n\t\tcur = b;\n\t\twhile ( (cur = cur.parentNode) ) {\n\t\t\tbp.unshift( cur );\n\t\t}\n\n\t\t// Walk down the tree looking for a discrepancy\n\t\twhile ( ap[i] === bp[i] ) {\n\t\t\ti++;\n\t\t}\n\n\t\treturn i ?\n\t\t\t// Do a sibling check if the nodes have a common ancestor\n\t\t\tsiblingCheck( ap[i], bp[i] ) :\n\n\t\t\t// Otherwise nodes in our document sort first\n\t\t\tap[i] === preferredDoc ? -1 :\n\t\t\tbp[i] === preferredDoc ? 1 :\n\t\t\t0;\n\t};\n\n\treturn doc;\n};\n\nSizzle.matches = function( expr, elements ) {\n\treturn Sizzle( expr, null, null, elements );\n};\n\nSizzle.matchesSelector = function( elem, expr ) {\n\t// Set document vars if needed\n\tif ( ( elem.ownerDocument || elem ) !== document ) {\n\t\tsetDocument( elem );\n\t}\n\n\t// Make sure that attribute selectors are quoted\n\texpr = expr.replace( rattributeQuotes, \"='$1']\" );\n\n\tif ( support.matchesSelector && documentIsHTML &&\n\t\t( !rbuggyMatches || !rbuggyMatches.test( expr ) ) &&\n\t\t( !rbuggyQSA     || !rbuggyQSA.test( expr ) ) ) {\n\n\t\ttry {\n\t\t\tvar ret = matches.call( elem, expr );\n\n\t\t\t// IE 9's matchesSelector returns false on disconnected nodes\n\t\t\tif ( ret || support.disconnectedMatch ||\n\t\t\t\t\t// As well, disconnected nodes are said to be in a document\n\t\t\t\t\t// fragment in IE 9\n\t\t\t\t\telem.document && elem.document.nodeType !== 11 ) {\n\t\t\t\treturn ret;\n\t\t\t}\n\t\t} catch(e) {}\n\t}\n\n\treturn Sizzle( expr, document, null, [ elem ] ).length > 0;\n};\n\nSizzle.contains = function( context, elem ) {\n\t// Set document vars if needed\n\tif ( ( context.ownerDocument || context ) !== document ) {\n\t\tsetDocument( context );\n\t}\n\treturn contains( context, elem );\n};\n\nSizzle.attr = function( elem, name ) {\n\t// Set document vars if needed\n\tif ( ( elem.ownerDocument || elem ) !== document ) {\n\t\tsetDocument( elem );\n\t}\n\n\tvar fn = Expr.attrHandle[ name.toLowerCase() ],\n\t\t// Don't get fooled by Object.prototype properties (jQuery #13807)\n\t\tval = fn && hasOwn.call( Expr.attrHandle, name.toLowerCase() ) ?\n\t\t\tfn( elem, name, !documentIsHTML ) :\n\t\t\tundefined;\n\n\treturn val !== undefined ?\n\t\tval :\n\t\tsupport.attributes || !documentIsHTML ?\n\t\t\telem.getAttribute( name ) :\n\t\t\t(val = elem.getAttributeNode(name)) && val.specified ?\n\t\t\t\tval.value :\n\t\t\t\tnull;\n};\n\nSizzle.error = function( msg ) {\n\tthrow new Error( \"Syntax error, unrecognized expression: \" + msg );\n};\n\n/**\n * Document sorting and removing duplicates\n * @param {ArrayLike} results\n */\nSizzle.uniqueSort = function( results ) {\n\tvar elem,\n\t\tduplicates = [],\n\t\tj = 0,\n\t\ti = 0;\n\n\t// Unless we *know* we can detect duplicates, assume their presence\n\thasDuplicate = !support.detectDuplicates;\n\tsortInput = !support.sortStable && results.slice( 0 );\n\tresults.sort( sortOrder );\n\n\tif ( hasDuplicate ) {\n\t\twhile ( (elem = results[i++]) ) {\n\t\t\tif ( elem === results[ i ] ) {\n\t\t\t\tj = duplicates.push( i );\n\t\t\t}\n\t\t}\n\t\twhile ( j-- ) {\n\t\t\tresults.splice( duplicates[ j ], 1 );\n\t\t}\n\t}\n\n\t// Clear input after sorting to release objects\n\t// See https://github.com/jquery/sizzle/pull/225\n\tsortInput = null;\n\n\treturn results;\n};\n\n/**\n * Utility function for retrieving the text value of an array of DOM nodes\n * @param {Array|Element} elem\n */\ngetText = Sizzle.getText = function( elem ) {\n\tvar node,\n\t\tret = \"\",\n\t\ti = 0,\n\t\tnodeType = elem.nodeType;\n\n\tif ( !nodeType ) {\n\t\t// If no nodeType, this is expected to be an array\n\t\twhile ( (node = elem[i++]) ) {\n\t\t\t// Do not traverse comment nodes\n\t\t\tret += getText( node );\n\t\t}\n\t} else if ( nodeType === 1 || nodeType === 9 || nodeType === 11 ) {\n\t\t// Use textContent for elements\n\t\t// innerText usage removed for consistency of new lines (jQuery #11153)\n\t\tif ( typeof elem.textContent === \"string\" ) {\n\t\t\treturn elem.textContent;\n\t\t} else {\n\t\t\t// Traverse its children\n\t\t\tfor ( elem = elem.firstChild; elem; elem = elem.nextSibling ) {\n\t\t\t\tret += getText( elem );\n\t\t\t}\n\t\t}\n\t} else if ( nodeType === 3 || nodeType === 4 ) {\n\t\treturn elem.nodeValue;\n\t}\n\t// Do not include comment or processing instruction nodes\n\n\treturn ret;\n};\n\nExpr = Sizzle.selectors = {\n\n\t// Can be adjusted by the user\n\tcacheLength: 50,\n\n\tcreatePseudo: markFunction,\n\n\tmatch: matchExpr,\n\n\tattrHandle: {},\n\n\tfind: {},\n\n\trelative: {\n\t\t\">\": { dir: \"parentNode\", first: true },\n\t\t\" \": { dir: \"parentNode\" },\n\t\t\"+\": { dir: \"previousSibling\", first: true },\n\t\t\"~\": { dir: \"previousSibling\" }\n\t},\n\n\tpreFilter: {\n\t\t\"ATTR\": function( match ) {\n\t\t\tmatch[1] = match[1].replace( runescape, funescape );\n\n\t\t\t// Move the given value to match[3] whether quoted or unquoted\n\t\t\tmatch[3] = ( match[3] || match[4] || match[5] || \"\" ).replace( runescape, funescape );\n\n\t\t\tif ( match[2] === \"~=\" ) {\n\t\t\t\tmatch[3] = \" \" + match[3] + \" \";\n\t\t\t}\n\n\t\t\treturn match.slice( 0, 4 );\n\t\t},\n\n\t\t\"CHILD\": function( match ) {\n\t\t\t/* matches from matchExpr[\"CHILD\"]\n\t\t\t\t1 type (only|nth|...)\n\t\t\t\t2 what (child|of-type)\n\t\t\t\t3 argument (even|odd|\\d*|\\d*n([+-]\\d+)?|...)\n\t\t\t\t4 xn-component of xn+y argument ([+-]?\\d*n|)\n\t\t\t\t5 sign of xn-component\n\t\t\t\t6 x of xn-component\n\t\t\t\t7 sign of y-component\n\t\t\t\t8 y of y-component\n\t\t\t*/\n\t\t\tmatch[1] = match[1].toLowerCase();\n\n\t\t\tif ( match[1].slice( 0, 3 ) === \"nth\" ) {\n\t\t\t\t// nth-* requires argument\n\t\t\t\tif ( !match[3] ) {\n\t\t\t\t\tSizzle.error( match[0] );\n\t\t\t\t}\n\n\t\t\t\t// numeric x and y parameters for Expr.filter.CHILD\n\t\t\t\t// remember that false/true cast respectively to 0/1\n\t\t\t\tmatch[4] = +( match[4] ? match[5] + (match[6] || 1) : 2 * ( match[3] === \"even\" || match[3] === \"odd\" ) );\n\t\t\t\tmatch[5] = +( ( match[7] + match[8] ) || match[3] === \"odd\" );\n\n\t\t\t// other types prohibit arguments\n\t\t\t} else if ( match[3] ) {\n\t\t\t\tSizzle.error( match[0] );\n\t\t\t}\n\n\t\t\treturn match;\n\t\t},\n\n\t\t\"PSEUDO\": function( match ) {\n\t\t\tvar excess,\n\t\t\t\tunquoted = !match[6] && match[2];\n\n\t\t\tif ( matchExpr[\"CHILD\"].test( match[0] ) ) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\t// Accept quoted arguments as-is\n\t\t\tif ( match[3] ) {\n\t\t\t\tmatch[2] = match[4] || match[5] || \"\";\n\n\t\t\t// Strip excess characters from unquoted arguments\n\t\t\t} else if ( unquoted && rpseudo.test( unquoted ) &&\n\t\t\t\t// Get excess from tokenize (recursively)\n\t\t\t\t(excess = tokenize( unquoted, true )) &&\n\t\t\t\t// advance to the next closing parenthesis\n\t\t\t\t(excess = unquoted.indexOf( \")\", unquoted.length - excess ) - unquoted.length) ) {\n\n\t\t\t\t// excess is a negative index\n\t\t\t\tmatch[0] = match[0].slice( 0, excess );\n\t\t\t\tmatch[2] = unquoted.slice( 0, excess );\n\t\t\t}\n\n\t\t\t// Return only captures needed by the pseudo filter method (type and argument)\n\t\t\treturn match.slice( 0, 3 );\n\t\t}\n\t},\n\n\tfilter: {\n\n\t\t\"TAG\": function( nodeNameSelector ) {\n\t\t\tvar nodeName = nodeNameSelector.replace( runescape, funescape ).toLowerCase();\n\t\t\treturn nodeNameSelector === \"*\" ?\n\t\t\t\tfunction() { return true; } :\n\t\t\t\tfunction( elem ) {\n\t\t\t\t\treturn elem.nodeName && elem.nodeName.toLowerCase() === nodeName;\n\t\t\t\t};\n\t\t},\n\n\t\t\"CLASS\": function( className ) {\n\t\t\tvar pattern = classCache[ className + \" \" ];\n\n\t\t\treturn pattern ||\n\t\t\t\t(pattern = new RegExp( \"(^|\" + whitespace + \")\" + className + \"(\" + whitespace + \"|$)\" )) &&\n\t\t\t\tclassCache( className, function( elem ) {\n\t\t\t\t\treturn pattern.test( typeof elem.className === \"string\" && elem.className || typeof elem.getAttribute !== strundefined && elem.getAttribute(\"class\") || \"\" );\n\t\t\t\t});\n\t\t},\n\n\t\t\"ATTR\": function( name, operator, check ) {\n\t\t\treturn function( elem ) {\n\t\t\t\tvar result = Sizzle.attr( elem, name );\n\n\t\t\t\tif ( result == null ) {\n\t\t\t\t\treturn operator === \"!=\";\n\t\t\t\t}\n\t\t\t\tif ( !operator ) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tresult += \"\";\n\n\t\t\t\treturn operator === \"=\" ? result === check :\n\t\t\t\t\toperator === \"!=\" ? result !== check :\n\t\t\t\t\toperator === \"^=\" ? check && result.indexOf( check ) === 0 :\n\t\t\t\t\toperator === \"*=\" ? check && result.indexOf( check ) > -1 :\n\t\t\t\t\toperator === \"$=\" ? check && result.slice( -check.length ) === check :\n\t\t\t\t\toperator === \"~=\" ? ( \" \" + result + \" \" ).indexOf( check ) > -1 :\n\t\t\t\t\toperator === \"|=\" ? result === check || result.slice( 0, check.length + 1 ) === check + \"-\" :\n\t\t\t\t\tfalse;\n\t\t\t};\n\t\t},\n\n\t\t\"CHILD\": function( type, what, argument, first, last ) {\n\t\t\tvar simple = type.slice( 0, 3 ) !== \"nth\",\n\t\t\t\tforward = type.slice( -4 ) !== \"last\",\n\t\t\t\tofType = what === \"of-type\";\n\n\t\t\treturn first === 1 && last === 0 ?\n\n\t\t\t\t// Shortcut for :nth-*(n)\n\t\t\t\tfunction( elem ) {\n\t\t\t\t\treturn !!elem.parentNode;\n\t\t\t\t} :\n\n\t\t\t\tfunction( elem, context, xml ) {\n\t\t\t\t\tvar cache, outerCache, node, diff, nodeIndex, start,\n\t\t\t\t\t\tdir = simple !== forward ? \"nextSibling\" : \"previousSibling\",\n\t\t\t\t\t\tparent = elem.parentNode,\n\t\t\t\t\t\tname = ofType && elem.nodeName.toLowerCase(),\n\t\t\t\t\t\tuseCache = !xml && !ofType;\n\n\t\t\t\t\tif ( parent ) {\n\n\t\t\t\t\t\t// :(first|last|only)-(child|of-type)\n\t\t\t\t\t\tif ( simple ) {\n\t\t\t\t\t\t\twhile ( dir ) {\n\t\t\t\t\t\t\t\tnode = elem;\n\t\t\t\t\t\t\t\twhile ( (node = node[ dir ]) ) {\n\t\t\t\t\t\t\t\t\tif ( ofType ? node.nodeName.toLowerCase() === name : node.nodeType === 1 ) {\n\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t// Reverse direction for :only-* (if we haven't yet done so)\n\t\t\t\t\t\t\t\tstart = dir = type === \"only\" && !start && \"nextSibling\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tstart = [ forward ? parent.firstChild : parent.lastChild ];\n\n\t\t\t\t\t\t// non-xml :nth-child(...) stores cache data on `parent`\n\t\t\t\t\t\tif ( forward && useCache ) {\n\t\t\t\t\t\t\t// Seek `elem` from a previously-cached index\n\t\t\t\t\t\t\touterCache = parent[ expando ] || (parent[ expando ] = {});\n\t\t\t\t\t\t\tcache = outerCache[ type ] || [];\n\t\t\t\t\t\t\tnodeIndex = cache[0] === dirruns && cache[1];\n\t\t\t\t\t\t\tdiff = cache[0] === dirruns && cache[2];\n\t\t\t\t\t\t\tnode = nodeIndex && parent.childNodes[ nodeIndex ];\n\n\t\t\t\t\t\t\twhile ( (node = ++nodeIndex && node && node[ dir ] ||\n\n\t\t\t\t\t\t\t\t// Fallback to seeking `elem` from the start\n\t\t\t\t\t\t\t\t(diff = nodeIndex = 0) || start.pop()) ) {\n\n\t\t\t\t\t\t\t\t// When found, cache indexes on `parent` and break\n\t\t\t\t\t\t\t\tif ( node.nodeType === 1 && ++diff && node === elem ) {\n\t\t\t\t\t\t\t\t\touterCache[ type ] = [ dirruns, nodeIndex, diff ];\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Use previously-cached element index if available\n\t\t\t\t\t\t} else if ( useCache && (cache = (elem[ expando ] || (elem[ expando ] = {}))[ type ]) && cache[0] === dirruns ) {\n\t\t\t\t\t\t\tdiff = cache[1];\n\n\t\t\t\t\t\t// xml :nth-child(...) or :nth-last-child(...) or :nth(-last)?-of-type(...)\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Use the same loop as above to seek `elem` from the start\n\t\t\t\t\t\t\twhile ( (node = ++nodeIndex && node && node[ dir ] ||\n\t\t\t\t\t\t\t\t(diff = nodeIndex = 0) || start.pop()) ) {\n\n\t\t\t\t\t\t\t\tif ( ( ofType ? node.nodeName.toLowerCase() === name : node.nodeType === 1 ) && ++diff ) {\n\t\t\t\t\t\t\t\t\t// Cache the index of each encountered element\n\t\t\t\t\t\t\t\t\tif ( useCache ) {\n\t\t\t\t\t\t\t\t\t\t(node[ expando ] || (node[ expando ] = {}))[ type ] = [ dirruns, diff ];\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tif ( node === elem ) {\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Incorporate the offset, then check against cycle size\n\t\t\t\t\t\tdiff -= last;\n\t\t\t\t\t\treturn diff === first || ( diff % first === 0 && diff / first >= 0 );\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t},\n\n\t\t\"PSEUDO\": function( pseudo, argument ) {\n\t\t\t// pseudo-class names are case-insensitive\n\t\t\t// http://www.w3.org/TR/selectors/#pseudo-classes\n\t\t\t// Prioritize by case sensitivity in case custom pseudos are added with uppercase letters\n\t\t\t// Remember that setFilters inherits from pseudos\n\t\t\tvar args,\n\t\t\t\tfn = Expr.pseudos[ pseudo ] || Expr.setFilters[ pseudo.toLowerCase() ] ||\n\t\t\t\t\tSizzle.error( \"unsupported pseudo: \" + pseudo );\n\n\t\t\t// The user may use createPseudo to indicate that\n\t\t\t// arguments are needed to create the filter function\n\t\t\t// just as Sizzle does\n\t\t\tif ( fn[ expando ] ) {\n\t\t\t\treturn fn( argument );\n\t\t\t}\n\n\t\t\t// But maintain support for old signatures\n\t\t\tif ( fn.length > 1 ) {\n\t\t\t\targs = [ pseudo, pseudo, \"\", argument ];\n\t\t\t\treturn Expr.setFilters.hasOwnProperty( pseudo.toLowerCase() ) ?\n\t\t\t\t\tmarkFunction(function( seed, matches ) {\n\t\t\t\t\t\tvar idx,\n\t\t\t\t\t\t\tmatched = fn( seed, argument ),\n\t\t\t\t\t\t\ti = matched.length;\n\t\t\t\t\t\twhile ( i-- ) {\n\t\t\t\t\t\t\tidx = indexOf.call( seed, matched[i] );\n\t\t\t\t\t\t\tseed[ idx ] = !( matches[ idx ] = matched[i] );\n\t\t\t\t\t\t}\n\t\t\t\t\t}) :\n\t\t\t\t\tfunction( elem ) {\n\t\t\t\t\t\treturn fn( elem, 0, args );\n\t\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn fn;\n\t\t}\n\t},\n\n\tpseudos: {\n\t\t// Potentially complex pseudos\n\t\t\"not\": markFunction(function( selector ) {\n\t\t\t// Trim the selector passed to compile\n\t\t\t// to avoid treating leading and trailing\n\t\t\t// spaces as combinators\n\t\t\tvar input = [],\n\t\t\t\tresults = [],\n\t\t\t\tmatcher = compile( selector.replace( rtrim, \"$1\" ) );\n\n\t\t\treturn matcher[ expando ] ?\n\t\t\t\tmarkFunction(function( seed, matches, context, xml ) {\n\t\t\t\t\tvar elem,\n\t\t\t\t\t\tunmatched = matcher( seed, null, xml, [] ),\n\t\t\t\t\t\ti = seed.length;\n\n\t\t\t\t\t// Match elements unmatched by `matcher`\n\t\t\t\t\twhile ( i-- ) {\n\t\t\t\t\t\tif ( (elem = unmatched[i]) ) {\n\t\t\t\t\t\t\tseed[i] = !(matches[i] = elem);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}) :\n\t\t\t\tfunction( elem, context, xml ) {\n\t\t\t\t\tinput[0] = elem;\n\t\t\t\t\tmatcher( input, null, xml, results );\n\t\t\t\t\treturn !results.pop();\n\t\t\t\t};\n\t\t}),\n\n\t\t\"has\": markFunction(function( selector ) {\n\t\t\treturn function( elem ) {\n\t\t\t\treturn Sizzle( selector, elem ).length > 0;\n\t\t\t};\n\t\t}),\n\n\t\t\"contains\": markFunction(function( text ) {\n\t\t\ttext = text.replace( runescape, funescape );\n\t\t\treturn function( elem ) {\n\t\t\t\treturn ( elem.textContent || elem.innerText || getText( elem ) ).indexOf( text ) > -1;\n\t\t\t};\n\t\t}),\n\n\t\t// \"Whether an element is represented by a :lang() selector\n\t\t// is based solely on the element's language value\n\t\t// being equal to the identifier C,\n\t\t// or beginning with the identifier C immediately followed by \"-\".\n\t\t// The matching of C against the element's language value is performed case-insensitively.\n\t\t// The identifier C does not have to be a valid language name.\"\n\t\t// http://www.w3.org/TR/selectors/#lang-pseudo\n\t\t\"lang\": markFunction( function( lang ) {\n\t\t\t// lang value must be a valid identifier\n\t\t\tif ( !ridentifier.test(lang || \"\") ) {\n\t\t\t\tSizzle.error( \"unsupported lang: \" + lang );\n\t\t\t}\n\t\t\tlang = lang.replace( runescape, funescape ).toLowerCase();\n\t\t\treturn function( elem ) {\n\t\t\t\tvar elemLang;\n\t\t\t\tdo {\n\t\t\t\t\tif ( (elemLang = documentIsHTML ?\n\t\t\t\t\t\telem.lang :\n\t\t\t\t\t\telem.getAttribute(\"xml:lang\") || elem.getAttribute(\"lang\")) ) {\n\n\t\t\t\t\t\telemLang = elemLang.toLowerCase();\n\t\t\t\t\t\treturn elemLang === lang || elemLang.indexOf( lang + \"-\" ) === 0;\n\t\t\t\t\t}\n\t\t\t\t} while ( (elem = elem.parentNode) && elem.nodeType === 1 );\n\t\t\t\treturn false;\n\t\t\t};\n\t\t}),\n\n\t\t// Miscellaneous\n\t\t\"target\": function( elem ) {\n\t\t\tvar hash = window.location && window.location.hash;\n\t\t\treturn hash && hash.slice( 1 ) === elem.id;\n\t\t},\n\n\t\t\"root\": function( elem ) {\n\t\t\treturn elem === docElem;\n\t\t},\n\n\t\t\"focus\": function( elem ) {\n\t\t\treturn elem === document.activeElement && (!document.hasFocus || document.hasFocus()) && !!(elem.type || elem.href || ~elem.tabIndex);\n\t\t},\n\n\t\t// Boolean properties\n\t\t\"enabled\": function( elem ) {\n\t\t\treturn elem.disabled === false;\n\t\t},\n\n\t\t\"disabled\": function( elem ) {\n\t\t\treturn elem.disabled === true;\n\t\t},\n\n\t\t\"checked\": function( elem ) {\n\t\t\t// In CSS3, :checked should return both checked and selected elements\n\t\t\t// http://www.w3.org/TR/2011/REC-css3-selectors-20110929/#checked\n\t\t\tvar nodeName = elem.nodeName.toLowerCase();\n\t\t\treturn (nodeName === \"input\" && !!elem.checked) || (nodeName === \"option\" && !!elem.selected);\n\t\t},\n\n\t\t\"selected\": function( elem ) {\n\t\t\t// Accessing this property makes selected-by-default\n\t\t\t// options in Safari work properly\n\t\t\tif ( elem.parentNode ) {\n\t\t\t\telem.parentNode.selectedIndex;\n\t\t\t}\n\n\t\t\treturn elem.selected === true;\n\t\t},\n\n\t\t// Contents\n\t\t\"empty\": function( elem ) {\n\t\t\t// http://www.w3.org/TR/selectors/#empty-pseudo\n\t\t\t// :empty is negated by element (1) or content nodes (text: 3; cdata: 4; entity ref: 5),\n\t\t\t//   but not by others (comment: 8; processing instruction: 7; etc.)\n\t\t\t// nodeType < 6 works because attributes (2) do not appear as children\n\t\t\tfor ( elem = elem.firstChild; elem; elem = elem.nextSibling ) {\n\t\t\t\tif ( elem.nodeType < 6 ) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t},\n\n\t\t\"parent\": function( elem ) {\n\t\t\treturn !Expr.pseudos[\"empty\"]( elem );\n\t\t},\n\n\t\t// Element/input types\n\t\t\"header\": function( elem ) {\n\t\t\treturn rheader.test( elem.nodeName );\n\t\t},\n\n\t\t\"input\": function( elem ) {\n\t\t\treturn rinputs.test( elem.nodeName );\n\t\t},\n\n\t\t\"button\": function( elem ) {\n\t\t\tvar name = elem.nodeName.toLowerCase();\n\t\t\treturn name === \"input\" && elem.type === \"button\" || name === \"button\";\n\t\t},\n\n\t\t\"text\": function( elem ) {\n\t\t\tvar attr;\n\t\t\treturn elem.nodeName.toLowerCase() === \"input\" &&\n\t\t\t\telem.type === \"text\" &&\n\n\t\t\t\t// Support: IE<8\n\t\t\t\t// New HTML5 attribute values (e.g., \"search\") appear with elem.type === \"text\"\n\t\t\t\t( (attr = elem.getAttribute(\"type\")) == null || attr.toLowerCase() === \"text\" );\n\t\t},\n\n\t\t// Position-in-collection\n\t\t\"first\": createPositionalPseudo(function() {\n\t\t\treturn [ 0 ];\n\t\t}),\n\n\t\t\"last\": createPositionalPseudo(function( matchIndexes, length ) {\n\t\t\treturn [ length - 1 ];\n\t\t}),\n\n\t\t\"eq\": createPositionalPseudo(function( matchIndexes, length, argument ) {\n\t\t\treturn [ argument < 0 ? argument + length : argument ];\n\t\t}),\n\n\t\t\"even\": createPositionalPseudo(function( matchIndexes, length ) {\n\t\t\tvar i = 0;\n\t\t\tfor ( ; i < length; i += 2 ) {\n\t\t\t\tmatchIndexes.push( i );\n\t\t\t}\n\t\t\treturn matchIndexes;\n\t\t}),\n\n\t\t\"odd\": createPositionalPseudo(function( matchIndexes, length ) {\n\t\t\tvar i = 1;\n\t\t\tfor ( ; i < length; i += 2 ) {\n\t\t\t\tmatchIndexes.push( i );\n\t\t\t}\n\t\t\treturn matchIndexes;\n\t\t}),\n\n\t\t\"lt\": createPositionalPseudo(function( matchIndexes, length, argument ) {\n\t\t\tvar i = argument < 0 ? argument + length : argument;\n\t\t\tfor ( ; --i >= 0; ) {\n\t\t\t\tmatchIndexes.push( i );\n\t\t\t}\n\t\t\treturn matchIndexes;\n\t\t}),\n\n\t\t\"gt\": createPositionalPseudo(function( matchIndexes, length, argument ) {\n\t\t\tvar i = argument < 0 ? argument + length : argument;\n\t\t\tfor ( ; ++i < length; ) {\n\t\t\t\tmatchIndexes.push( i );\n\t\t\t}\n\t\t\treturn matchIndexes;\n\t\t})\n\t}\n};\n\nExpr.pseudos[\"nth\"] = Expr.pseudos[\"eq\"];\n\n// Add button/input type pseudos\nfor ( i in { radio: true, checkbox: true, file: true, password: true, image: true } ) {\n\tExpr.pseudos[ i ] = createInputPseudo( i );\n}\nfor ( i in { submit: true, reset: true } ) {\n\tExpr.pseudos[ i ] = createButtonPseudo( i );\n}\n\n// Easy API for creating new setFilters\nfunction setFilters() {}\nsetFilters.prototype = Expr.filters = Expr.pseudos;\nExpr.setFilters = new setFilters();\n\ntokenize = Sizzle.tokenize = function( selector, parseOnly ) {\n\tvar matched, match, tokens, type,\n\t\tsoFar, groups, preFilters,\n\t\tcached = tokenCache[ selector + \" \" ];\n\n\tif ( cached ) {\n\t\treturn parseOnly ? 0 : cached.slice( 0 );\n\t}\n\n\tsoFar = selector;\n\tgroups = [];\n\tpreFilters = Expr.preFilter;\n\n\twhile ( soFar ) {\n\n\t\t// Comma and first run\n\t\tif ( !matched || (match = rcomma.exec( soFar )) ) {\n\t\t\tif ( match ) {\n\t\t\t\t// Don't consume trailing commas as valid\n\t\t\t\tsoFar = soFar.slice( match[0].length ) || soFar;\n\t\t\t}\n\t\t\tgroups.push( (tokens = []) );\n\t\t}\n\n\t\tmatched = false;\n\n\t\t// Combinators\n\t\tif ( (match = rcombinators.exec( soFar )) ) {\n\t\t\tmatched = match.shift();\n\t\t\ttokens.push({\n\t\t\t\tvalue: matched,\n\t\t\t\t// Cast descendant combinators to space\n\t\t\t\ttype: match[0].replace( rtrim, \" \" )\n\t\t\t});\n\t\t\tsoFar = soFar.slice( matched.length );\n\t\t}\n\n\t\t// Filters\n\t\tfor ( type in Expr.filter ) {\n\t\t\tif ( (match = matchExpr[ type ].exec( soFar )) && (!preFilters[ type ] ||\n\t\t\t\t(match = preFilters[ type ]( match ))) ) {\n\t\t\t\tmatched = match.shift();\n\t\t\t\ttokens.push({\n\t\t\t\t\tvalue: matched,\n\t\t\t\t\ttype: type,\n\t\t\t\t\tmatches: match\n\t\t\t\t});\n\t\t\t\tsoFar = soFar.slice( matched.length );\n\t\t\t}\n\t\t}\n\n\t\tif ( !matched ) {\n\t\t\tbreak;\n\t\t}\n\t}\n\n\t// Return the length of the invalid excess\n\t// if we're just parsing\n\t// Otherwise, throw an error or return tokens\n\treturn parseOnly ?\n\t\tsoFar.length :\n\t\tsoFar ?\n\t\t\tSizzle.error( selector ) :\n\t\t\t// Cache the tokens\n\t\t\ttokenCache( selector, groups ).slice( 0 );\n};\n\nfunction toSelector( tokens ) {\n\tvar i = 0,\n\t\tlen = tokens.length,\n\t\tselector = \"\";\n\tfor ( ; i < len; i++ ) {\n\t\tselector += tokens[i].value;\n\t}\n\treturn selector;\n}\n\nfunction addCombinator( matcher, combinator, base ) {\n\tvar dir = combinator.dir,\n\t\tcheckNonElements = base && dir === \"parentNode\",\n\t\tdoneName = done++;\n\n\treturn combinator.first ?\n\t\t// Check against closest ancestor/preceding element\n\t\tfunction( elem, context, xml ) {\n\t\t\twhile ( (elem = elem[ dir ]) ) {\n\t\t\t\tif ( elem.nodeType === 1 || checkNonElements ) {\n\t\t\t\t\treturn matcher( elem, context, xml );\n\t\t\t\t}\n\t\t\t}\n\t\t} :\n\n\t\t// Check against all ancestor/preceding elements\n\t\tfunction( elem, context, xml ) {\n\t\t\tvar oldCache, outerCache,\n\t\t\t\tnewCache = [ dirruns, doneName ];\n\n\t\t\t// We can't set arbitrary data on XML nodes, so they don't benefit from dir caching\n\t\t\tif ( xml ) {\n\t\t\t\twhile ( (elem = elem[ dir ]) ) {\n\t\t\t\t\tif ( elem.nodeType === 1 || checkNonElements ) {\n\t\t\t\t\t\tif ( matcher( elem, context, xml ) ) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\twhile ( (elem = elem[ dir ]) ) {\n\t\t\t\t\tif ( elem.nodeType === 1 || checkNonElements ) {\n\t\t\t\t\t\touterCache = elem[ expando ] || (elem[ expando ] = {});\n\t\t\t\t\t\tif ( (oldCache = outerCache[ dir ]) &&\n\t\t\t\t\t\t\toldCache[ 0 ] === dirruns && oldCache[ 1 ] === doneName ) {\n\n\t\t\t\t\t\t\t// Assign to newCache so results back-propagate to previous elements\n\t\t\t\t\t\t\treturn (newCache[ 2 ] = oldCache[ 2 ]);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Reuse newcache so results back-propagate to previous elements\n\t\t\t\t\t\t\touterCache[ dir ] = newCache;\n\n\t\t\t\t\t\t\t// A match means we're done; a fail means we have to keep checking\n\t\t\t\t\t\t\tif ( (newCache[ 2 ] = matcher( elem, context, xml )) ) {\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n}\n\nfunction elementMatcher( matchers ) {\n\treturn matchers.length > 1 ?\n\t\tfunction( elem, context, xml ) {\n\t\t\tvar i = matchers.length;\n\t\t\twhile ( i-- ) {\n\t\t\t\tif ( !matchers[i]( elem, context, xml ) ) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t} :\n\t\tmatchers[0];\n}\n\nfunction multipleContexts( selector, contexts, results ) {\n\tvar i = 0,\n\t\tlen = contexts.length;\n\tfor ( ; i < len; i++ ) {\n\t\tSizzle( selector, contexts[i], results );\n\t}\n\treturn results;\n}\n\nfunction condense( unmatched, map, filter, context, xml ) {\n\tvar elem,\n\t\tnewUnmatched = [],\n\t\ti = 0,\n\t\tlen = unmatched.length,\n\t\tmapped = map != null;\n\n\tfor ( ; i < len; i++ ) {\n\t\tif ( (elem = unmatched[i]) ) {\n\t\t\tif ( !filter || filter( elem, context, xml ) ) {\n\t\t\t\tnewUnmatched.push( elem );\n\t\t\t\tif ( mapped ) {\n\t\t\t\t\tmap.push( i );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn newUnmatched;\n}\n\nfunction setMatcher( preFilter, selector, matcher, postFilter, postFinder, postSelector ) {\n\tif ( postFilter && !postFilter[ expando ] ) {\n\t\tpostFilter = setMatcher( postFilter );\n\t}\n\tif ( postFinder && !postFinder[ expando ] ) {\n\t\tpostFinder = setMatcher( postFinder, postSelector );\n\t}\n\treturn markFunction(function( seed, results, context, xml ) {\n\t\tvar temp, i, elem,\n\t\t\tpreMap = [],\n\t\t\tpostMap = [],\n\t\t\tpreexisting = results.length,\n\n\t\t\t// Get initial elements from seed or context\n\t\t\telems = seed || multipleContexts( selector || \"*\", context.nodeType ? [ context ] : context, [] ),\n\n\t\t\t// Prefilter to get matcher input, preserving a map for seed-results synchronization\n\t\t\tmatcherIn = preFilter && ( seed || !selector ) ?\n\t\t\t\tcondense( elems, preMap, preFilter, context, xml ) :\n\t\t\t\telems,\n\n\t\t\tmatcherOut = matcher ?\n\t\t\t\t// If we have a postFinder, or filtered seed, or non-seed postFilter or preexisting results,\n\t\t\t\tpostFinder || ( seed ? preFilter : preexisting || postFilter ) ?\n\n\t\t\t\t\t// ...intermediate processing is necessary\n\t\t\t\t\t[] :\n\n\t\t\t\t\t// ...otherwise use results directly\n\t\t\t\t\tresults :\n\t\t\t\tmatcherIn;\n\n\t\t// Find primary matches\n\t\tif ( matcher ) {\n\t\t\tmatcher( matcherIn, matcherOut, context, xml );\n\t\t}\n\n\t\t// Apply postFilter\n\t\tif ( postFilter ) {\n\t\t\ttemp = condense( matcherOut, postMap );\n\t\t\tpostFilter( temp, [], context, xml );\n\n\t\t\t// Un-match failing elements by moving them back to matcherIn\n\t\t\ti = temp.length;\n\t\t\twhile ( i-- ) {\n\t\t\t\tif ( (elem = temp[i]) ) {\n\t\t\t\t\tmatcherOut[ postMap[i] ] = !(matcherIn[ postMap[i] ] = elem);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif ( seed ) {\n\t\t\tif ( postFinder || preFilter ) {\n\t\t\t\tif ( postFinder ) {\n\t\t\t\t\t// Get the final matcherOut by condensing this intermediate into postFinder contexts\n\t\t\t\t\ttemp = [];\n\t\t\t\t\ti = matcherOut.length;\n\t\t\t\t\twhile ( i-- ) {\n\t\t\t\t\t\tif ( (elem = matcherOut[i]) ) {\n\t\t\t\t\t\t\t// Restore matcherIn since elem is not yet a final match\n\t\t\t\t\t\t\ttemp.push( (matcherIn[i] = elem) );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tpostFinder( null, (matcherOut = []), temp, xml );\n\t\t\t\t}\n\n\t\t\t\t// Move matched elements from seed to results to keep them synchronized\n\t\t\t\ti = matcherOut.length;\n\t\t\t\twhile ( i-- ) {\n\t\t\t\t\tif ( (elem = matcherOut[i]) &&\n\t\t\t\t\t\t(temp = postFinder ? indexOf.call( seed, elem ) : preMap[i]) > -1 ) {\n\n\t\t\t\t\t\tseed[temp] = !(results[temp] = elem);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t// Add elements to results, through postFinder if defined\n\t\t} else {\n\t\t\tmatcherOut = condense(\n\t\t\t\tmatcherOut === results ?\n\t\t\t\t\tmatcherOut.splice( preexisting, matcherOut.length ) :\n\t\t\t\t\tmatcherOut\n\t\t\t);\n\t\t\tif ( postFinder ) {\n\t\t\t\tpostFinder( null, results, matcherOut, xml );\n\t\t\t} else {\n\t\t\t\tpush.apply( results, matcherOut );\n\t\t\t}\n\t\t}\n\t});\n}\n\nfunction matcherFromTokens( tokens ) {\n\tvar checkContext, matcher, j,\n\t\tlen = tokens.length,\n\t\tleadingRelative = Expr.relative[ tokens[0].type ],\n\t\timplicitRelative = leadingRelative || Expr.relative[\" \"],\n\t\ti = leadingRelative ? 1 : 0,\n\n\t\t// The foundational matcher ensures that elements are reachable from top-level context(s)\n\t\tmatchContext = addCombinator( function( elem ) {\n\t\t\treturn elem === checkContext;\n\t\t}, implicitRelative, true ),\n\t\tmatchAnyContext = addCombinator( function( elem ) {\n\t\t\treturn indexOf.call( checkContext, elem ) > -1;\n\t\t}, implicitRelative, true ),\n\t\tmatchers = [ function( elem, context, xml ) {\n\t\t\treturn ( !leadingRelative && ( xml || context !== outermostContext ) ) || (\n\t\t\t\t(checkContext = context).nodeType ?\n\t\t\t\t\tmatchContext( elem, context, xml ) :\n\t\t\t\t\tmatchAnyContext( elem, context, xml ) );\n\t\t} ];\n\n\tfor ( ; i < len; i++ ) {\n\t\tif ( (matcher = Expr.relative[ tokens[i].type ]) ) {\n\t\t\tmatchers = [ addCombinator(elementMatcher( matchers ), matcher) ];\n\t\t} else {\n\t\t\tmatcher = Expr.filter[ tokens[i].type ].apply( null, tokens[i].matches );\n\n\t\t\t// Return special upon seeing a positional matcher\n\t\t\tif ( matcher[ expando ] ) {\n\t\t\t\t// Find the next relative operator (if any) for proper handling\n\t\t\t\tj = ++i;\n\t\t\t\tfor ( ; j < len; j++ ) {\n\t\t\t\t\tif ( Expr.relative[ tokens[j].type ] ) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn setMatcher(\n\t\t\t\t\ti > 1 && elementMatcher( matchers ),\n\t\t\t\t\ti > 1 && toSelector(\n\t\t\t\t\t\t// If the preceding token was a descendant combinator, insert an implicit any-element `*`\n\t\t\t\t\t\ttokens.slice( 0, i - 1 ).concat({ value: tokens[ i - 2 ].type === \" \" ? \"*\" : \"\" })\n\t\t\t\t\t).replace( rtrim, \"$1\" ),\n\t\t\t\t\tmatcher,\n\t\t\t\t\ti < j && matcherFromTokens( tokens.slice( i, j ) ),\n\t\t\t\t\tj < len && matcherFromTokens( (tokens = tokens.slice( j )) ),\n\t\t\t\t\tj < len && toSelector( tokens )\n\t\t\t\t);\n\t\t\t}\n\t\t\tmatchers.push( matcher );\n\t\t}\n\t}\n\n\treturn elementMatcher( matchers );\n}\n\nfunction matcherFromGroupMatchers( elementMatchers, setMatchers ) {\n\tvar bySet = setMatchers.length > 0,\n\t\tbyElement = elementMatchers.length > 0,\n\t\tsuperMatcher = function( seed, context, xml, results, outermost ) {\n\t\t\tvar elem, j, matcher,\n\t\t\t\tmatchedCount = 0,\n\t\t\t\ti = \"0\",\n\t\t\t\tunmatched = seed && [],\n\t\t\t\tsetMatched = [],\n\t\t\t\tcontextBackup = outermostContext,\n\t\t\t\t// We must always have either seed elements or outermost context\n\t\t\t\telems = seed || byElement && Expr.find[\"TAG\"]( \"*\", outermost ),\n\t\t\t\t// Use integer dirruns iff this is the outermost matcher\n\t\t\t\tdirrunsUnique = (dirruns += contextBackup == null ? 1 : Math.random() || 0.1),\n\t\t\t\tlen = elems.length;\n\n\t\t\tif ( outermost ) {\n\t\t\t\toutermostContext = context !== document && context;\n\t\t\t}\n\n\t\t\t// Add elements passing elementMatchers directly to results\n\t\t\t// Keep `i` a string if there are no elements so `matchedCount` will be \"00\" below\n\t\t\t// Support: IE<9, Safari\n\t\t\t// Tolerate NodeList properties (IE: \"length\"; Safari: <number>) matching elements by id\n\t\t\tfor ( ; i !== len && (elem = elems[i]) != null; i++ ) {\n\t\t\t\tif ( byElement && elem ) {\n\t\t\t\t\tj = 0;\n\t\t\t\t\twhile ( (matcher = elementMatchers[j++]) ) {\n\t\t\t\t\t\tif ( matcher( elem, context, xml ) ) {\n\t\t\t\t\t\t\tresults.push( elem );\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif ( outermost ) {\n\t\t\t\t\t\tdirruns = dirrunsUnique;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Track unmatched elements for set filters\n\t\t\t\tif ( bySet ) {\n\t\t\t\t\t// They will have gone through all possible matchers\n\t\t\t\t\tif ( (elem = !matcher && elem) ) {\n\t\t\t\t\t\tmatchedCount--;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Lengthen the array for every element, matched or not\n\t\t\t\t\tif ( seed ) {\n\t\t\t\t\t\tunmatched.push( elem );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Apply set filters to unmatched elements\n\t\t\tmatchedCount += i;\n\t\t\tif ( bySet && i !== matchedCount ) {\n\t\t\t\tj = 0;\n\t\t\t\twhile ( (matcher = setMatchers[j++]) ) {\n\t\t\t\t\tmatcher( unmatched, setMatched, context, xml );\n\t\t\t\t}\n\n\t\t\t\tif ( seed ) {\n\t\t\t\t\t// Reintegrate element matches to eliminate the need for sorting\n\t\t\t\t\tif ( matchedCount > 0 ) {\n\t\t\t\t\t\twhile ( i-- ) {\n\t\t\t\t\t\t\tif ( !(unmatched[i] || setMatched[i]) ) {\n\t\t\t\t\t\t\t\tsetMatched[i] = pop.call( results );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Discard index placeholder values to get only actual matches\n\t\t\t\t\tsetMatched = condense( setMatched );\n\t\t\t\t}\n\n\t\t\t\t// Add matches to results\n\t\t\t\tpush.apply( results, setMatched );\n\n\t\t\t\t// Seedless set matches succeeding multiple successful matchers stipulate sorting\n\t\t\t\tif ( outermost && !seed && setMatched.length > 0 &&\n\t\t\t\t\t( matchedCount + setMatchers.length ) > 1 ) {\n\n\t\t\t\t\tSizzle.uniqueSort( results );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Override manipulation of globals by nested matchers\n\t\t\tif ( outermost ) {\n\t\t\t\tdirruns = dirrunsUnique;\n\t\t\t\toutermostContext = contextBackup;\n\t\t\t}\n\n\t\t\treturn unmatched;\n\t\t};\n\n\treturn bySet ?\n\t\tmarkFunction( superMatcher ) :\n\t\tsuperMatcher;\n}\n\ncompile = Sizzle.compile = function( selector, match /* Internal Use Only */ ) {\n\tvar i,\n\t\tsetMatchers = [],\n\t\telementMatchers = [],\n\t\tcached = compilerCache[ selector + \" \" ];\n\n\tif ( !cached ) {\n\t\t// Generate a function of recursive functions that can be used to check each element\n\t\tif ( !match ) {\n\t\t\tmatch = tokenize( selector );\n\t\t}\n\t\ti = match.length;\n\t\twhile ( i-- ) {\n\t\t\tcached = matcherFromTokens( match[i] );\n\t\t\tif ( cached[ expando ] ) {\n\t\t\t\tsetMatchers.push( cached );\n\t\t\t} else {\n\t\t\t\telementMatchers.push( cached );\n\t\t\t}\n\t\t}\n\n\t\t// Cache the compiled function\n\t\tcached = compilerCache( selector, matcherFromGroupMatchers( elementMatchers, setMatchers ) );\n\n\t\t// Save selector and tokenization\n\t\tcached.selector = selector;\n\t}\n\treturn cached;\n};\n\n/**\n * A low-level selection function that works with Sizzle's compiled\n *  selector functions\n * @param {String|Function} selector A selector or a pre-compiled\n *  selector function built with Sizzle.compile\n * @param {Element} context\n * @param {Array} [results]\n * @param {Array} [seed] A set of elements to match against\n */\nselect = Sizzle.select = function( selector, context, results, seed ) {\n\tvar i, tokens, token, type, find,\n\t\tcompiled = typeof selector === \"function\" && selector,\n\t\tmatch = !seed && tokenize( (selector = compiled.selector || selector) );\n\n\tresults = results || [];\n\n\t// Try to minimize operations if there is no seed and only one group\n\tif ( match.length === 1 ) {\n\n\t\t// Take a shortcut and set the context if the root selector is an ID\n\t\ttokens = match[0] = match[0].slice( 0 );\n\t\tif ( tokens.length > 2 && (token = tokens[0]).type === \"ID\" &&\n\t\t\t\tsupport.getById && context.nodeType === 9 && documentIsHTML &&\n\t\t\t\tExpr.relative[ tokens[1].type ] ) {\n\n\t\t\tcontext = ( Expr.find[\"ID\"]( token.matches[0].replace(runescape, funescape), context ) || [] )[0];\n\t\t\tif ( !context ) {\n\t\t\t\treturn results;\n\n\t\t\t// Precompiled matchers will still verify ancestry, so step up a level\n\t\t\t} else if ( compiled ) {\n\t\t\t\tcontext = context.parentNode;\n\t\t\t}\n\n\t\t\tselector = selector.slice( tokens.shift().value.length );\n\t\t}\n\n\t\t// Fetch a seed set for right-to-left matching\n\t\ti = matchExpr[\"needsContext\"].test( selector ) ? 0 : tokens.length;\n\t\twhile ( i-- ) {\n\t\t\ttoken = tokens[i];\n\n\t\t\t// Abort if we hit a combinator\n\t\t\tif ( Expr.relative[ (type = token.type) ] ) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif ( (find = Expr.find[ type ]) ) {\n\t\t\t\t// Search, expanding context for leading sibling combinators\n\t\t\t\tif ( (seed = find(\n\t\t\t\t\ttoken.matches[0].replace( runescape, funescape ),\n\t\t\t\t\trsibling.test( tokens[0].type ) && testContext( context.parentNode ) || context\n\t\t\t\t)) ) {\n\n\t\t\t\t\t// If seed is empty or no tokens remain, we can return early\n\t\t\t\t\ttokens.splice( i, 1 );\n\t\t\t\t\tselector = seed.length && toSelector( tokens );\n\t\t\t\t\tif ( !selector ) {\n\t\t\t\t\t\tpush.apply( results, seed );\n\t\t\t\t\t\treturn results;\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// Compile and execute a filtering function if one is not provided\n\t// Provide `match` to avoid retokenization if we modified the selector above\n\t( compiled || compile( selector, match ) )(\n\t\tseed,\n\t\tcontext,\n\t\t!documentIsHTML,\n\t\tresults,\n\t\trsibling.test( selector ) && testContext( context.parentNode ) || context\n\t);\n\treturn results;\n};\n\n// One-time assignments\n\n// Sort stability\nsupport.sortStable = expando.split(\"\").sort( sortOrder ).join(\"\") === expando;\n\n// Support: Chrome 14-35+\n// Always assume duplicates if they aren't passed to the comparison function\nsupport.detectDuplicates = !!hasDuplicate;\n\n// Initialize against the default document\nsetDocument();\n\n// Support: Webkit<537.32 - Safari 6.0.3/Chrome 25 (fixed in Chrome 27)\n// Detached nodes confoundingly follow *each other*\nsupport.sortDetached = assert(function( div1 ) {\n\t// Should return 1, but returns 4 (following)\n\treturn div1.compareDocumentPosition( document.createElement(\"div\") ) & 1;\n});\n\n// Support: IE<8\n// Prevent attribute/property \"interpolation\"\n// http://msdn.microsoft.com/en-us/library/ms536429%28VS.85%29.aspx\nif ( !assert(function( div ) {\n\tdiv.innerHTML = \"<a href='#'></a>\";\n\treturn div.firstChild.getAttribute(\"href\") === \"#\" ;\n}) ) {\n\taddHandle( \"type|href|height|width\", function( elem, name, isXML ) {\n\t\tif ( !isXML ) {\n\t\t\treturn elem.getAttribute( name, name.toLowerCase() === \"type\" ? 1 : 2 );\n\t\t}\n\t});\n}\n\n// Support: IE<9\n// Use defaultValue in place of getAttribute(\"value\")\nif ( !support.attributes || !assert(function( div ) {\n\tdiv.innerHTML = \"<input/>\";\n\tdiv.firstChild.setAttribute( \"value\", \"\" );\n\treturn div.firstChild.getAttribute( \"value\" ) === \"\";\n}) ) {\n\taddHandle( \"value\", function( elem, name, isXML ) {\n\t\tif ( !isXML && elem.nodeName.toLowerCase() === \"input\" ) {\n\t\t\treturn elem.defaultValue;\n\t\t}\n\t});\n}\n\n// Support: IE<9\n// Use getAttributeNode to fetch booleans when getAttribute lies\nif ( !assert(function( div ) {\n\treturn div.getAttribute(\"disabled\") == null;\n}) ) {\n\taddHandle( booleans, function( elem, name, isXML ) {\n\t\tvar val;\n\t\tif ( !isXML ) {\n\t\t\treturn elem[ name ] === true ? name.toLowerCase() :\n\t\t\t\t\t(val = elem.getAttributeNode( name )) && val.specified ?\n\t\t\t\t\tval.value :\n\t\t\t\tnull;\n\t\t}\n\t});\n}\n\n// EXPOSE\nreturn Sizzle;\n});\n\n/*eslint-enable */\n\n// Included from: js/tinymce/classes/util/Arr.js\n\n/**\n * Arr.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Array utility class.\n *\n * @private\n * @class tinymce.util.Arr\n */\ndefine(\"tinymce/util/Arr\", [], function() {\n\tvar isArray = Array.isArray || function(obj) {\n\t\treturn Object.prototype.toString.call(obj) === \"[object Array]\";\n\t};\n\n\tfunction toArray(obj) {\n\t\tvar array = obj, i, l;\n\n\t\tif (!isArray(obj)) {\n\t\t\tarray = [];\n\t\t\tfor (i = 0, l = obj.length; i < l; i++) {\n\t\t\t\tarray[i] = obj[i];\n\t\t\t}\n\t\t}\n\n\t\treturn array;\n\t}\n\n\tfunction each(o, cb, s) {\n\t\tvar n, l;\n\n\t\tif (!o) {\n\t\t\treturn 0;\n\t\t}\n\n\t\ts = s || o;\n\n\t\tif (o.length !== undefined) {\n\t\t\t// Indexed arrays, needed for Safari\n\t\t\tfor (n = 0, l = o.length; n < l; n++) {\n\t\t\t\tif (cb.call(s, o[n], n, o) === false) {\n\t\t\t\t\treturn 0;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\t// Hashtables\n\t\t\tfor (n in o) {\n\t\t\t\tif (o.hasOwnProperty(n)) {\n\t\t\t\t\tif (cb.call(s, o[n], n, o) === false) {\n\t\t\t\t\t\treturn 0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn 1;\n\t}\n\n\tfunction map(array, callback) {\n\t\tvar out = [];\n\n\t\teach(array, function(item, index) {\n\t\t\tout.push(callback(item, index, array));\n\t\t});\n\n\t\treturn out;\n\t}\n\n\tfunction filter(a, f) {\n\t\tvar o = [];\n\n\t\teach(a, function(v, index) {\n\t\t\tif (!f || f(v, index, a)) {\n\t\t\t\to.push(v);\n\t\t\t}\n\t\t});\n\n\t\treturn o;\n\t}\n\n\tfunction indexOf(a, v) {\n\t\tvar i, l;\n\n\t\tif (a) {\n\t\t\tfor (i = 0, l = a.length; i < l; i++) {\n\t\t\t\tif (a[i] === v) {\n\t\t\t\t\treturn i;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn -1;\n\t}\n\n\tfunction reduce(collection, iteratee, accumulator, thisArg) {\n\t\tvar i = 0;\n\n\t\tif (arguments.length < 3) {\n\t\t\taccumulator = collection[0];\n\t\t}\n\n\t\tfor (; i < collection.length; i++) {\n\t\t\taccumulator = iteratee.call(thisArg, accumulator, collection[i], i);\n\t\t}\n\n\t\treturn accumulator;\n\t}\n\n\tfunction findIndex(array, predicate, thisArg) {\n\t\tvar i, l;\n\n\t\tfor (i = 0, l = array.length; i < l; i++) {\n\t\t\tif (predicate.call(thisArg, array[i], i, array)) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\n\t\treturn -1;\n\t}\n\n\tfunction find(array, predicate, thisArg) {\n\t\tvar idx = findIndex(array, predicate, thisArg);\n\n\t\tif (idx !== -1) {\n\t\t\treturn array[idx];\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tfunction last(collection) {\n\t\treturn collection[collection.length - 1];\n\t}\n\n\treturn {\n\t\tisArray: isArray,\n\t\ttoArray: toArray,\n\t\teach: each,\n\t\tmap: map,\n\t\tfilter: filter,\n\t\tindexOf: indexOf,\n\t\treduce: reduce,\n\t\tfindIndex: findIndex,\n\t\tfind: find,\n\t\tlast: last\n\t};\n});\n\n// Included from: js/tinymce/classes/util/Tools.js\n\n/**\n * Tools.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class contains various utlity functions. These are also exposed\n * directly on the tinymce namespace.\n *\n * @class tinymce.util.Tools\n */\ndefine(\"tinymce/util/Tools\", [\n\t\"tinymce/Env\",\n\t\"tinymce/util/Arr\"\n], function(Env, Arr) {\n\t/**\n\t * Removes whitespace from the beginning and end of a string.\n\t *\n\t * @method trim\n\t * @param {String} s String to remove whitespace from.\n\t * @return {String} New string with removed whitespace.\n\t */\n\tvar whiteSpaceRegExp = /^\\s*|\\s*$/g;\n\n\tfunction trim(str) {\n\t\treturn (str === null || str === undefined) ? '' : (\"\" + str).replace(whiteSpaceRegExp, '');\n\t}\n\n\t/**\n\t * Checks if a object is of a specific type for example an array.\n\t *\n\t * @method is\n\t * @param {Object} obj Object to check type of.\n\t * @param {string} type Optional type to check for.\n\t * @return {Boolean} true/false if the object is of the specified type.\n\t */\n\tfunction is(obj, type) {\n\t\tif (!type) {\n\t\t\treturn obj !== undefined;\n\t\t}\n\n\t\tif (type == 'array' && Arr.isArray(obj)) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn typeof obj == type;\n\t}\n\n\t/**\n\t * Makes a name/object map out of an array with names.\n\t *\n\t * @method makeMap\n\t * @param {Array/String} items Items to make map out of.\n\t * @param {String} delim Optional delimiter to split string by.\n\t * @param {Object} map Optional map to add items to.\n\t * @return {Object} Name/value map of items.\n\t */\n\tfunction makeMap(items, delim, map) {\n\t\tvar i;\n\n\t\titems = items || [];\n\t\tdelim = delim || ',';\n\n\t\tif (typeof items == \"string\") {\n\t\t\titems = items.split(delim);\n\t\t}\n\n\t\tmap = map || {};\n\n\t\ti = items.length;\n\t\twhile (i--) {\n\t\t\tmap[items[i]] = {};\n\t\t}\n\n\t\treturn map;\n\t}\n\n\t/**\n\t * JavaScript does not protect hasOwnProperty method, so it is possible to overwrite it. This is\n\t * object independent version.\n\t *\n\t * @param {Object} obj\n\t * @param {String} prop\n\t * @returns {Boolean}\n\t */\n\tfunction hasOwnProperty(obj, prop) {\n\t\treturn Object.prototype.hasOwnProperty.call(obj, prop);\n\t}\n\n\t/**\n\t * Creates a class, subclass or static singleton.\n\t * More details on this method can be found in the Wiki.\n\t *\n\t * @method create\n\t * @param {String} s Class name, inheritance and prefix.\n\t * @param {Object} p Collection of methods to add to the class.\n\t * @param {Object} root Optional root object defaults to the global window object.\n\t * @example\n\t * // Creates a basic class\n\t * tinymce.create('tinymce.somepackage.SomeClass', {\n\t *     SomeClass: function() {\n\t *         // Class constructor\n\t *     },\n\t *\n\t *     method: function() {\n\t *         // Some method\n\t *     }\n\t * });\n\t *\n\t * // Creates a basic subclass class\n\t * tinymce.create('tinymce.somepackage.SomeSubClass:tinymce.somepackage.SomeClass', {\n\t *     SomeSubClass: function() {\n\t *         // Class constructor\n\t *         this.parent(); // Call parent constructor\n\t *     },\n\t *\n\t *     method: function() {\n\t *         // Some method\n\t *         this.parent(); // Call parent method\n\t *     },\n\t *\n\t *     'static': {\n\t *         staticMethod: function() {\n\t *             // Static method\n\t *         }\n\t *     }\n\t * });\n\t *\n\t * // Creates a singleton/static class\n\t * tinymce.create('static tinymce.somepackage.SomeSingletonClass', {\n\t *     method: function() {\n\t *         // Some method\n\t *     }\n\t * });\n\t */\n\tfunction create(s, p, root) {\n\t\tvar self = this, sp, ns, cn, scn, c, de = 0;\n\n\t\t// Parse : <prefix> <class>:<super class>\n\t\ts = /^((static) )?([\\w.]+)(:([\\w.]+))?/.exec(s);\n\t\tcn = s[3].match(/(^|\\.)(\\w+)$/i)[2]; // Class name\n\n\t\t// Create namespace for new class\n\t\tns = self.createNS(s[3].replace(/\\.\\w+$/, ''), root);\n\n\t\t// Class already exists\n\t\tif (ns[cn]) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Make pure static class\n\t\tif (s[2] == 'static') {\n\t\t\tns[cn] = p;\n\n\t\t\tif (this.onCreate) {\n\t\t\t\tthis.onCreate(s[2], s[3], ns[cn]);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\t// Create default constructor\n\t\tif (!p[cn]) {\n\t\t\tp[cn] = function() {};\n\t\t\tde = 1;\n\t\t}\n\n\t\t// Add constructor and methods\n\t\tns[cn] = p[cn];\n\t\tself.extend(ns[cn].prototype, p);\n\n\t\t// Extend\n\t\tif (s[5]) {\n\t\t\tsp = self.resolve(s[5]).prototype;\n\t\t\tscn = s[5].match(/\\.(\\w+)$/i)[1]; // Class name\n\n\t\t\t// Extend constructor\n\t\t\tc = ns[cn];\n\t\t\tif (de) {\n\t\t\t\t// Add passthrough constructor\n\t\t\t\tns[cn] = function() {\n\t\t\t\t\treturn sp[scn].apply(this, arguments);\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\t// Add inherit constructor\n\t\t\t\tns[cn] = function() {\n\t\t\t\t\tthis.parent = sp[scn];\n\t\t\t\t\treturn c.apply(this, arguments);\n\t\t\t\t};\n\t\t\t}\n\t\t\tns[cn].prototype[cn] = ns[cn];\n\n\t\t\t// Add super methods\n\t\t\tself.each(sp, function(f, n) {\n\t\t\t\tns[cn].prototype[n] = sp[n];\n\t\t\t});\n\n\t\t\t// Add overridden methods\n\t\t\tself.each(p, function(f, n) {\n\t\t\t\t// Extend methods if needed\n\t\t\t\tif (sp[n]) {\n\t\t\t\t\tns[cn].prototype[n] = function() {\n\t\t\t\t\t\tthis.parent = sp[n];\n\t\t\t\t\t\treturn f.apply(this, arguments);\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\tif (n != cn) {\n\t\t\t\t\t\tns[cn].prototype[n] = f;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// Add static methods\n\t\t/*jshint sub:true*/\n\t\t/*eslint dot-notation:0*/\n\t\tself.each(p['static'], function(f, n) {\n\t\t\tns[cn][n] = f;\n\t\t});\n\t}\n\n\tfunction extend(obj, ext) {\n\t\tvar i, l, name, args = arguments, value;\n\n\t\tfor (i = 1, l = args.length; i < l; i++) {\n\t\t\text = args[i];\n\t\t\tfor (name in ext) {\n\t\t\t\tif (ext.hasOwnProperty(name)) {\n\t\t\t\t\tvalue = ext[name];\n\n\t\t\t\t\tif (value !== undefined) {\n\t\t\t\t\t\tobj[name] = value;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn obj;\n\t}\n\n\t/**\n\t * Executed the specified function for each item in a object tree.\n\t *\n\t * @method walk\n\t * @param {Object} o Object tree to walk though.\n\t * @param {function} f Function to call for each item.\n\t * @param {String} n Optional name of collection inside the objects to walk for example childNodes.\n\t * @param {String} s Optional scope to execute the function in.\n\t */\n\tfunction walk(o, f, n, s) {\n\t\ts = s || this;\n\n\t\tif (o) {\n\t\t\tif (n) {\n\t\t\t\to = o[n];\n\t\t\t}\n\n\t\t\tArr.each(o, function(o, i) {\n\t\t\t\tif (f.call(s, o, i, n) === false) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\twalk(o, f, n, s);\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Creates a namespace on a specific object.\n\t *\n\t * @method createNS\n\t * @param {String} n Namespace to create for example a.b.c.d.\n\t * @param {Object} o Optional object to add namespace to, defaults to window.\n\t * @return {Object} New namespace object the last item in path.\n\t * @example\n\t * // Create some namespace\n\t * tinymce.createNS('tinymce.somepackage.subpackage');\n\t *\n\t * // Add a singleton\n\t * var tinymce.somepackage.subpackage.SomeSingleton = {\n\t *     method: function() {\n\t *         // Some method\n\t *     }\n\t * };\n\t */\n\tfunction createNS(n, o) {\n\t\tvar i, v;\n\n\t\to = o || window;\n\n\t\tn = n.split('.');\n\t\tfor (i = 0; i < n.length; i++) {\n\t\t\tv = n[i];\n\n\t\t\tif (!o[v]) {\n\t\t\t\to[v] = {};\n\t\t\t}\n\n\t\t\to = o[v];\n\t\t}\n\n\t\treturn o;\n\t}\n\n\t/**\n\t * Resolves a string and returns the object from a specific structure.\n\t *\n\t * @method resolve\n\t * @param {String} n Path to resolve for example a.b.c.d.\n\t * @param {Object} o Optional object to search though, defaults to window.\n\t * @return {Object} Last object in path or null if it couldn't be resolved.\n\t * @example\n\t * // Resolve a path into an object reference\n\t * var obj = tinymce.resolve('a.b.c.d');\n\t */\n\tfunction resolve(n, o) {\n\t\tvar i, l;\n\n\t\to = o || window;\n\n\t\tn = n.split('.');\n\t\tfor (i = 0, l = n.length; i < l; i++) {\n\t\t\to = o[n[i]];\n\n\t\t\tif (!o) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn o;\n\t}\n\n\t/**\n\t * Splits a string but removes the whitespace before and after each value.\n\t *\n\t * @method explode\n\t * @param {string} s String to split.\n\t * @param {string} d Delimiter to split by.\n\t * @example\n\t * // Split a string into an array with a,b,c\n\t * var arr = tinymce.explode('a, b,   c');\n\t */\n\tfunction explode(s, d) {\n\t\tif (!s || is(s, 'array')) {\n\t\t\treturn s;\n\t\t}\n\n\t\treturn Arr.map(s.split(d || ','), trim);\n\t}\n\n\tfunction _addCacheSuffix(url) {\n\t\tvar cacheSuffix = Env.cacheSuffix;\n\n\t\tif (cacheSuffix) {\n\t\t\turl += (url.indexOf('?') === -1 ? '?' : '&') + cacheSuffix;\n\t\t}\n\n\t\treturn url;\n\t}\n\n\treturn {\n\t\ttrim: trim,\n\n\t\t/**\n\t\t * Returns true/false if the object is an array or not.\n\t\t *\n\t\t * @method isArray\n\t\t * @param {Object} obj Object to check.\n\t\t * @return {boolean} true/false state if the object is an array or not.\n\t\t */\n\t\tisArray: Arr.isArray,\n\n\t\tis: is,\n\n\t\t/**\n\t\t * Converts the specified object into a real JavaScript array.\n\t\t *\n\t\t * @method toArray\n\t\t * @param {Object} obj Object to convert into array.\n\t\t * @return {Array} Array object based in input.\n\t\t */\n\t\ttoArray: Arr.toArray,\n\t\tmakeMap: makeMap,\n\n\t\t/**\n\t\t * Performs an iteration of all items in a collection such as an object or array. This method will execure the\n\t\t * callback function for each item in the collection, if the callback returns false the iteration will terminate.\n\t\t * The callback has the following format: cb(value, key_or_index).\n\t\t *\n\t\t * @method each\n\t\t * @param {Object} o Collection to iterate.\n\t\t * @param {function} cb Callback function to execute for each item.\n\t\t * @param {Object} s Optional scope to execute the callback in.\n\t\t * @example\n\t\t * // Iterate an array\n\t\t * tinymce.each([1,2,3], function(v, i) {\n\t\t *     console.debug(\"Value: \" + v + \", Index: \" + i);\n\t\t * });\n\t\t *\n\t\t * // Iterate an object\n\t\t * tinymce.each({a: 1, b: 2, c: 3], function(v, k) {\n\t\t *     console.debug(\"Value: \" + v + \", Key: \" + k);\n\t\t * });\n\t\t */\n\t\teach: Arr.each,\n\n\t\t/**\n\t\t * Creates a new array by the return value of each iteration function call. This enables you to convert\n\t\t * one array list into another.\n\t\t *\n\t\t * @method map\n\t\t * @param {Array} array Array of items to iterate.\n\t\t * @param {function} callback Function to call for each item. It's return value will be the new value.\n\t\t * @return {Array} Array with new values based on function return values.\n\t\t */\n\t\tmap: Arr.map,\n\n\t\t/**\n\t\t * Filters out items from the input array by calling the specified function for each item.\n\t\t * If the function returns false the item will be excluded if it returns true it will be included.\n\t\t *\n\t\t * @method grep\n\t\t * @param {Array} a Array of items to loop though.\n\t\t * @param {function} f Function to call for each item. Include/exclude depends on it's return value.\n\t\t * @return {Array} New array with values imported and filtered based in input.\n\t\t * @example\n\t\t * // Filter out some items, this will return an array with 4 and 5\n\t\t * var items = tinymce.grep([1,2,3,4,5], function(v) {return v > 3;});\n\t\t */\n\t\tgrep: Arr.filter,\n\n\t\t/**\n\t\t * Returns an index of the item or -1 if item is not present in the array.\n\t\t *\n\t\t * @method inArray\n\t\t * @param {any} item Item to search for.\n\t\t * @param {Array} arr Array to search in.\n\t\t * @return {Number} index of the item or -1 if item was not found.\n\t\t */\n\t\tinArray: Arr.indexOf,\n\n\t\thasOwn: hasOwnProperty,\n\n\t\textend: extend,\n\t\tcreate: create,\n\t\twalk: walk,\n\t\tcreateNS: createNS,\n\t\tresolve: resolve,\n\t\texplode: explode,\n\t\t_addCacheSuffix: _addCacheSuffix\n\t};\n});\n\n// Included from: js/tinymce/classes/dom/DomQuery.js\n\n/**\n * DomQuery.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class mimics most of the jQuery API:\n *\n * This is whats currently implemented:\n * - Utility functions\n * - DOM traversial\n * - DOM manipulation\n * - Event binding\n *\n * This is not currently implemented:\n * - Dimension\n * - Ajax\n * - Animation\n * - Advanced chaining\n *\n * @example\n * var $ = tinymce.dom.DomQuery;\n * $('p').attr('attr', 'value').addClass('class');\n *\n * @class tinymce.dom.DomQuery\n */\ndefine(\"tinymce/dom/DomQuery\", [\n\t\"tinymce/dom/EventUtils\",\n\t\"tinymce/dom/Sizzle\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/Env\"\n], function(EventUtils, Sizzle, Tools, Env) {\n\tvar doc = document, push = Array.prototype.push, slice = Array.prototype.slice;\n\tvar rquickExpr = /^(?:[^#<]*(<[\\w\\W]+>)[^>]*$|#([\\w\\-]*)$)/;\n\tvar Event = EventUtils.Event, undef;\n\tvar skipUniques = Tools.makeMap('children,contents,next,prev');\n\n\tfunction isDefined(obj) {\n\t\treturn typeof obj !== 'undefined';\n\t}\n\n\tfunction isString(obj) {\n\t\treturn typeof obj === 'string';\n\t}\n\n\tfunction isWindow(obj) {\n\t\treturn obj && obj == obj.window;\n\t}\n\n\tfunction createFragment(html, fragDoc) {\n\t\tvar frag, node, container;\n\n\t\tfragDoc = fragDoc || doc;\n\t\tcontainer = fragDoc.createElement('div');\n\t\tfrag = fragDoc.createDocumentFragment();\n\t\tcontainer.innerHTML = html;\n\n\t\twhile ((node = container.firstChild)) {\n\t\t\tfrag.appendChild(node);\n\t\t}\n\n\t\treturn frag;\n\t}\n\n\tfunction domManipulate(targetNodes, sourceItem, callback, reverse) {\n\t\tvar i;\n\n\t\tif (isString(sourceItem)) {\n\t\t\tsourceItem = createFragment(sourceItem, getElementDocument(targetNodes[0]));\n\t\t} else if (sourceItem.length && !sourceItem.nodeType) {\n\t\t\tsourceItem = DomQuery.makeArray(sourceItem);\n\n\t\t\tif (reverse) {\n\t\t\t\tfor (i = sourceItem.length - 1; i >= 0; i--) {\n\t\t\t\t\tdomManipulate(targetNodes, sourceItem[i], callback, reverse);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (i = 0; i < sourceItem.length; i++) {\n\t\t\t\t\tdomManipulate(targetNodes, sourceItem[i], callback, reverse);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn targetNodes;\n\t\t}\n\n\t\tif (sourceItem.nodeType) {\n\t\t\ti = targetNodes.length;\n\t\t\twhile (i--) {\n\t\t\t\tcallback.call(targetNodes[i], sourceItem);\n\t\t\t}\n\t\t}\n\n\t\treturn targetNodes;\n\t}\n\n\tfunction hasClass(node, className) {\n\t\treturn node && className && (' ' + node.className + ' ').indexOf(' ' + className + ' ') !== -1;\n\t}\n\n\tfunction wrap(elements, wrapper, all) {\n\t\tvar lastParent, newWrapper;\n\n\t\twrapper = DomQuery(wrapper)[0];\n\n\t\telements.each(function() {\n\t\t\tvar self = this;\n\n\t\t\tif (!all || lastParent != self.parentNode) {\n\t\t\t\tlastParent = self.parentNode;\n\t\t\t\tnewWrapper = wrapper.cloneNode(false);\n\t\t\t\tself.parentNode.insertBefore(newWrapper, self);\n\t\t\t\tnewWrapper.appendChild(self);\n\t\t\t} else {\n\t\t\t\tnewWrapper.appendChild(self);\n\t\t\t}\n\t\t});\n\n\t\treturn elements;\n\t}\n\n\tvar numericCssMap = Tools.makeMap('fillOpacity fontWeight lineHeight opacity orphans widows zIndex zoom', ' ');\n\tvar booleanMap = Tools.makeMap('checked compact declare defer disabled ismap multiple nohref noshade nowrap readonly selected', ' ');\n\tvar propFix = {\n\t\t'for': 'htmlFor',\n\t\t'class': 'className',\n\t\t'readonly': 'readOnly'\n\t};\n\tvar cssFix = {\n\t\t'float': 'cssFloat'\n\t};\n\n\tvar attrHooks = {}, cssHooks = {};\n\n\tfunction DomQuery(selector, context) {\n\t\t/*eslint new-cap:0 */\n\t\treturn new DomQuery.fn.init(selector, context);\n\t}\n\n\tfunction inArray(item, array) {\n\t\tvar i;\n\n\t\tif (array.indexOf) {\n\t\t\treturn array.indexOf(item);\n\t\t}\n\n\t\ti = array.length;\n\t\twhile (i--) {\n\t\t\tif (array[i] === item) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\n\t\treturn -1;\n\t}\n\n\tvar whiteSpaceRegExp = /^\\s*|\\s*$/g;\n\n\tfunction trim(str) {\n\t\treturn (str === null || str === undef) ? '' : (\"\" + str).replace(whiteSpaceRegExp, '');\n\t}\n\n\tfunction each(obj, callback) {\n\t\tvar length, key, i, undef, value;\n\n\t\tif (obj) {\n\t\t\tlength = obj.length;\n\n\t\t\tif (length === undef) {\n\t\t\t\t// Loop object items\n\t\t\t\tfor (key in obj) {\n\t\t\t\t\tif (obj.hasOwnProperty(key)) {\n\t\t\t\t\t\tvalue = obj[key];\n\t\t\t\t\t\tif (callback.call(value, key, value) === false) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Loop array items\n\t\t\t\tfor (i = 0; i < length; i++) {\n\t\t\t\t\tvalue = obj[i];\n\t\t\t\t\tif (callback.call(value, i, value) === false) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn obj;\n\t}\n\n\tfunction grep(array, callback) {\n\t\tvar out = [];\n\n\t\teach(array, function(i, item) {\n\t\t\tif (callback(item, i)) {\n\t\t\t\tout.push(item);\n\t\t\t}\n\t\t});\n\n\t\treturn out;\n\t}\n\n\tfunction getElementDocument(element) {\n\t\tif (!element) {\n\t\t\treturn doc;\n\t\t}\n\n\t\tif (element.nodeType == 9) {\n\t\t\treturn element;\n\t\t}\n\n\t\treturn element.ownerDocument;\n\t}\n\n\tDomQuery.fn = DomQuery.prototype = {\n\t\tconstructor: DomQuery,\n\n\t\t/**\n\t\t * Selector for the current set.\n\t\t *\n\t\t * @property selector\n\t\t * @type String\n\t\t */\n\t\tselector: \"\",\n\n\t\t/**\n\t\t * Context used to create the set.\n\t\t *\n\t\t * @property context\n\t\t * @type Element\n\t\t */\n\t\tcontext: null,\n\n\t\t/**\n\t\t * Number of items in the current set.\n\t\t *\n\t\t * @property length\n\t\t * @type Number\n\t\t */\n\t\tlength: 0,\n\n\t\t/**\n\t\t * Constructs a new DomQuery instance with the specified selector or context.\n\t\t *\n\t\t * @constructor\n\t\t * @method init\n\t\t * @param {String/Array/DomQuery} selector Optional CSS selector/Array or array like object or HTML string.\n\t\t * @param {Document/Element} context Optional context to search in.\n\t\t */\n\t\tinit: function(selector, context) {\n\t\t\tvar self = this, match, node;\n\n\t\t\tif (!selector) {\n\t\t\t\treturn self;\n\t\t\t}\n\n\t\t\tif (selector.nodeType) {\n\t\t\t\tself.context = self[0] = selector;\n\t\t\t\tself.length = 1;\n\n\t\t\t\treturn self;\n\t\t\t}\n\n\t\t\tif (context && context.nodeType) {\n\t\t\t\tself.context = context;\n\t\t\t} else {\n\t\t\t\tif (context) {\n\t\t\t\t\treturn DomQuery(selector).attr(context);\n\t\t\t\t}\n\n\t\t\t\tself.context = context = document;\n\t\t\t}\n\n\t\t\tif (isString(selector)) {\n\t\t\t\tself.selector = selector;\n\n\t\t\t\tif (selector.charAt(0) === \"<\" && selector.charAt(selector.length - 1) === \">\" && selector.length >= 3) {\n\t\t\t\t\tmatch = [null, selector, null];\n\t\t\t\t} else {\n\t\t\t\t\tmatch = rquickExpr.exec(selector);\n\t\t\t\t}\n\n\t\t\t\tif (match) {\n\t\t\t\t\tif (match[1]) {\n\t\t\t\t\t\tnode = createFragment(selector, getElementDocument(context)).firstChild;\n\n\t\t\t\t\t\twhile (node) {\n\t\t\t\t\t\t\tpush.call(self, node);\n\t\t\t\t\t\t\tnode = node.nextSibling;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnode = getElementDocument(context).getElementById(match[2]);\n\n\t\t\t\t\t\tif (!node) {\n\t\t\t\t\t\t\treturn self;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (node.id !== match[2]) {\n\t\t\t\t\t\t\treturn self.find(selector);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tself.length = 1;\n\t\t\t\t\t\tself[0] = node;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\treturn DomQuery(context).find(selector);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.add(selector, false);\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Converts the current set to an array.\n\t\t *\n\t\t * @method toArray\n\t\t * @return {Array} Array of all nodes in set.\n\t\t */\n\t\ttoArray: function() {\n\t\t\treturn Tools.toArray(this);\n\t\t},\n\n\t\t/**\n\t\t * Adds new nodes to the set.\n\t\t *\n\t\t * @method add\n\t\t * @param {Array/tinymce.dom.DomQuery} items Array of all nodes to add to set.\n\t\t * @param {Boolean} sort Optional sort flag that enables sorting of elements.\n\t\t * @return {tinymce.dom.DomQuery} New instance with nodes added.\n\t\t */\n\t\tadd: function(items, sort) {\n\t\t\tvar self = this, nodes, i;\n\n\t\t\tif (isString(items)) {\n\t\t\t\treturn self.add(DomQuery(items));\n\t\t\t}\n\n\t\t\tif (sort !== false) {\n\t\t\t\tnodes = DomQuery.unique(self.toArray().concat(DomQuery.makeArray(items)));\n\t\t\t\tself.length = nodes.length;\n\t\t\t\tfor (i = 0; i < nodes.length; i++) {\n\t\t\t\t\tself[i] = nodes[i];\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tpush.apply(self, DomQuery.makeArray(items));\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Sets/gets attributes on the elements in the current set.\n\t\t *\n\t\t * @method attr\n\t\t * @param {String/Object} name Name of attribute to get or an object with attributes to set.\n\t\t * @param {String} value Optional value to set.\n\t\t * @return {tinymce.dom.DomQuery/String} Current set or the specified attribute when only the name is specified.\n\t\t */\n\t\tattr: function(name, value) {\n\t\t\tvar self = this, hook;\n\n\t\t\tif (typeof name === \"object\") {\n\t\t\t\teach(name, function(name, value) {\n\t\t\t\t\tself.attr(name, value);\n\t\t\t\t});\n\t\t\t} else if (isDefined(value)) {\n\t\t\t\tthis.each(function() {\n\t\t\t\t\tvar hook;\n\n\t\t\t\t\tif (this.nodeType === 1) {\n\t\t\t\t\t\thook = attrHooks[name];\n\t\t\t\t\t\tif (hook && hook.set) {\n\t\t\t\t\t\t\thook.set(this, value);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (value === null) {\n\t\t\t\t\t\t\tthis.removeAttribute(name, 2);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.setAttribute(name, value, 2);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tif (self[0] && self[0].nodeType === 1) {\n\t\t\t\t\thook = attrHooks[name];\n\t\t\t\t\tif (hook && hook.get) {\n\t\t\t\t\t\treturn hook.get(self[0], name);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (booleanMap[name]) {\n\t\t\t\t\t\treturn self.prop(name) ? name : undef;\n\t\t\t\t\t}\n\n\t\t\t\t\tvalue = self[0].getAttribute(name, 2);\n\n\t\t\t\t\tif (value === null) {\n\t\t\t\t\t\tvalue = undef;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Removes attributse on the elements in the current set.\n\t\t *\n\t\t * @method removeAttr\n\t\t * @param {String/Object} name Name of attribute to remove.\n\t\t * @return {tinymce.dom.DomQuery/String} Current set.\n\t\t */\n\t\tremoveAttr: function(name) {\n\t\t\treturn this.attr(name, null);\n\t\t},\n\n\t\t/**\n\t\t * Sets/gets properties on the elements in the current set.\n\t\t *\n\t\t * @method attr\n\t\t * @param {String/Object} name Name of property to get or an object with properties to set.\n\t\t * @param {String} value Optional value to set.\n\t\t * @return {tinymce.dom.DomQuery/String} Current set or the specified property when only the name is specified.\n\t\t */\n\t\tprop: function(name, value) {\n\t\t\tvar self = this;\n\n\t\t\tname = propFix[name] || name;\n\n\t\t\tif (typeof name === \"object\") {\n\t\t\t\teach(name, function(name, value) {\n\t\t\t\t\tself.prop(name, value);\n\t\t\t\t});\n\t\t\t} else if (isDefined(value)) {\n\t\t\t\tthis.each(function() {\n\t\t\t\t\tif (this.nodeType == 1) {\n\t\t\t\t\t\tthis[name] = value;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tif (self[0] && self[0].nodeType && name in self[0]) {\n\t\t\t\t\treturn self[0][name];\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Sets/gets styles on the elements in the current set.\n\t\t *\n\t\t * @method css\n\t\t * @param {String/Object} name Name of style to get or an object with styles to set.\n\t\t * @param {String} value Optional value to set.\n\t\t * @return {tinymce.dom.DomQuery/String} Current set or the specified style when only the name is specified.\n\t\t */\n\t\tcss: function(name, value) {\n\t\t\tvar self = this, elm, hook;\n\n\t\t\tfunction camel(name) {\n\t\t\t\treturn name.replace(/-(\\D)/g, function(a, b) {\n\t\t\t\t\treturn b.toUpperCase();\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction dashed(name) {\n\t\t\t\treturn name.replace(/[A-Z]/g, function(a) {\n\t\t\t\t\treturn '-' + a;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (typeof name === \"object\") {\n\t\t\t\teach(name, function(name, value) {\n\t\t\t\t\tself.css(name, value);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tif (isDefined(value)) {\n\t\t\t\t\tname = camel(name);\n\n\t\t\t\t\t// Default px suffix on these\n\t\t\t\t\tif (typeof value === 'number' && !numericCssMap[name]) {\n\t\t\t\t\t\tvalue += 'px';\n\t\t\t\t\t}\n\n\t\t\t\t\tself.each(function() {\n\t\t\t\t\t\tvar style = this.style;\n\n\t\t\t\t\t\thook = cssHooks[name];\n\t\t\t\t\t\tif (hook && hook.set) {\n\t\t\t\t\t\t\thook.set(this, value);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tthis.style[cssFix[name] || name] = value;\n\t\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t\t// Ignore\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (value === null || value === '') {\n\t\t\t\t\t\t\tif (style.removeProperty) {\n\t\t\t\t\t\t\t\tstyle.removeProperty(dashed(name));\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tstyle.removeAttribute(name);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\telm = self[0];\n\n\t\t\t\t\thook = cssHooks[name];\n\t\t\t\t\tif (hook && hook.get) {\n\t\t\t\t\t\treturn hook.get(elm);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (elm.ownerDocument.defaultView) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\treturn elm.ownerDocument.defaultView.getComputedStyle(elm, null).getPropertyValue(dashed(name));\n\t\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t\treturn undef;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (elm.currentStyle) {\n\t\t\t\t\t\treturn elm.currentStyle[camel(name)];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Removes all nodes in set from the document.\n\t\t *\n\t\t * @method remove\n\t\t * @return {tinymce.dom.DomQuery} Current set with the removed nodes.\n\t\t */\n\t\tremove: function() {\n\t\t\tvar self = this, node, i = this.length;\n\n\t\t\twhile (i--) {\n\t\t\t\tnode = self[i];\n\t\t\t\tEvent.clean(node);\n\n\t\t\t\tif (node.parentNode) {\n\t\t\t\t\tnode.parentNode.removeChild(node);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Empties all elements in set.\n\t\t *\n\t\t * @method empty\n\t\t * @return {tinymce.dom.DomQuery} Current set with the empty nodes.\n\t\t */\n\t\tempty: function() {\n\t\t\tvar self = this, node, i = this.length;\n\n\t\t\twhile (i--) {\n\t\t\t\tnode = self[i];\n\t\t\t\twhile (node.firstChild) {\n\t\t\t\t\tnode.removeChild(node.firstChild);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Sets or gets the HTML of the current set or first set node.\n\t\t *\n\t\t * @method html\n\t\t * @param {String} value Optional innerHTML value to set on each element.\n\t\t * @return {tinymce.dom.DomQuery/String} Current set or the innerHTML of the first element.\n\t\t */\n\t\thtml: function(value) {\n\t\t\tvar self = this, i;\n\n\t\t\tif (isDefined(value)) {\n\t\t\t\ti = self.length;\n\n\t\t\t\ttry {\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tself[i].innerHTML = value;\n\t\t\t\t\t}\n\t\t\t\t} catch (ex) {\n\t\t\t\t\t// Workaround for \"Unknown runtime error\" when DIV is added to P on IE\n\t\t\t\t\tDomQuery(self[i]).empty().append(value);\n\t\t\t\t}\n\n\t\t\t\treturn self;\n\t\t\t}\n\n\t\t\treturn self[0] ? self[0].innerHTML : '';\n\t\t},\n\n\t\t/**\n\t\t * Sets or gets the text of the current set or first set node.\n\t\t *\n\t\t * @method text\n\t\t * @param {String} value Optional innerText value to set on each element.\n\t\t * @return {tinymce.dom.DomQuery/String} Current set or the innerText of the first element.\n\t\t */\n\t\ttext: function(value) {\n\t\t\tvar self = this, i;\n\n\t\t\tif (isDefined(value)) {\n\t\t\t\ti = self.length;\n\t\t\t\twhile (i--) {\n\t\t\t\t\tif (\"innerText\" in self[i]) {\n\t\t\t\t\t\tself[i].innerText = value;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself[0].textContent = value;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn self;\n\t\t\t}\n\n\t\t\treturn self[0] ? (self[0].innerText || self[0].textContent) : '';\n\t\t},\n\n\t\t/**\n\t\t * Appends the specified node/html or node set to the current set nodes.\n\t\t *\n\t\t * @method append\n\t\t * @param {String/Element/Array/tinymce.dom.DomQuery} content Content to append to each element in set.\n\t\t * @return {tinymce.dom.DomQuery} Current set.\n\t\t */\n\t\tappend: function() {\n\t\t\treturn domManipulate(this, arguments, function(node) {\n\t\t\t\t// Either element or Shadow Root\n\t\t\t\tif (this.nodeType === 1 || (this.host && this.host.nodeType === 1)) {\n\t\t\t\t\tthis.appendChild(node);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Prepends the specified node/html or node set to the current set nodes.\n\t\t *\n\t\t * @method prepend\n\t\t * @param {String/Element/Array/tinymce.dom.DomQuery} content Content to prepend to each element in set.\n\t\t * @return {tinymce.dom.DomQuery} Current set.\n\t\t */\n\t\tprepend: function() {\n\t\t\treturn domManipulate(this, arguments, function(node) {\n\t\t\t\t// Either element or Shadow Root\n\t\t\t\tif (this.nodeType === 1 || (this.host && this.host.nodeType === 1)) {\n\t\t\t\t\tthis.insertBefore(node, this.firstChild);\n\t\t\t\t}\n\t\t\t}, true);\n\t\t},\n\n\t\t/**\n\t\t * Adds the specified elements before current set nodes.\n\t\t *\n\t\t * @method before\n\t\t * @param {String/Element/Array/tinymce.dom.DomQuery} content Content to add before to each element in set.\n\t\t * @return {tinymce.dom.DomQuery} Current set.\n\t\t */\n\t\tbefore: function() {\n\t\t\tvar self = this;\n\n\t\t\tif (self[0] && self[0].parentNode) {\n\t\t\t\treturn domManipulate(self, arguments, function(node) {\n\t\t\t\t\tthis.parentNode.insertBefore(node, this);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Adds the specified elements after current set nodes.\n\t\t *\n\t\t * @method after\n\t\t * @param {String/Element/Array/tinymce.dom.DomQuery} content Content to add after to each element in set.\n\t\t * @return {tinymce.dom.DomQuery} Current set.\n\t\t */\n\t\tafter: function() {\n\t\t\tvar self = this;\n\n\t\t\tif (self[0] && self[0].parentNode) {\n\t\t\t\treturn domManipulate(self, arguments, function(node) {\n\t\t\t\t\tthis.parentNode.insertBefore(node, this.nextSibling);\n\t\t\t\t}, true);\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Appends the specified set nodes to the specified selector/instance.\n\t\t *\n\t\t * @method appendTo\n\t\t * @param {String/Element/Array/tinymce.dom.DomQuery} val Item to append the current set to.\n\t\t * @return {tinymce.dom.DomQuery} Current set with the appended nodes.\n\t\t */\n\t\tappendTo: function(val) {\n\t\t\tDomQuery(val).append(this);\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Prepends the specified set nodes to the specified selector/instance.\n\t\t *\n\t\t * @method prependTo\n\t\t * @param {String/Element/Array/tinymce.dom.DomQuery} val Item to prepend the current set to.\n\t\t * @return {tinymce.dom.DomQuery} Current set with the prepended nodes.\n\t\t */\n\t\tprependTo: function(val) {\n\t\t\tDomQuery(val).prepend(this);\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Replaces the nodes in set with the specified content.\n\t\t *\n\t\t * @method replaceWith\n\t\t * @param {String/Element/Array/tinymce.dom.DomQuery} content Content to replace nodes with.\n\t\t * @return {tinymce.dom.DomQuery} Set with replaced nodes.\n\t\t */\n\t\treplaceWith: function(content) {\n\t\t\treturn this.before(content).remove();\n\t\t},\n\n\t\t/**\n\t\t * Wraps all elements in set with the specified wrapper.\n\t\t *\n\t\t * @method wrap\n\t\t * @param {String/Element/Array/tinymce.dom.DomQuery} content Content to wrap nodes with.\n\t\t * @return {tinymce.dom.DomQuery} Set with wrapped nodes.\n\t\t */\n\t\twrap: function(content) {\n\t\t\treturn wrap(this, content);\n\t\t},\n\n\t\t/**\n\t\t * Wraps all nodes in set with the specified wrapper. If the nodes are siblings all of them\n\t\t * will be wrapped in the same wrapper.\n\t\t *\n\t\t * @method wrapAll\n\t\t * @param {String/Element/Array/tinymce.dom.DomQuery} content Content to wrap nodes with.\n\t\t * @return {tinymce.dom.DomQuery} Set with wrapped nodes.\n\t\t */\n\t\twrapAll: function(content) {\n\t\t\treturn wrap(this, content, true);\n\t\t},\n\n\t\t/**\n\t\t * Wraps all elements inner contents in set with the specified wrapper.\n\t\t *\n\t\t * @method wrapInner\n\t\t * @param {String/Element/Array/tinymce.dom.DomQuery} content Content to wrap nodes with.\n\t\t * @return {tinymce.dom.DomQuery} Set with wrapped nodes.\n\t\t */\n\t\twrapInner: function(content) {\n\t\t\tthis.each(function() {\n\t\t\t\tDomQuery(this).contents().wrapAll(content);\n\t\t\t});\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Unwraps all elements by removing the parent element of each item in set.\n\t\t *\n\t\t * @method unwrap\n\t\t * @return {tinymce.dom.DomQuery} Set with unwrapped nodes.\n\t\t */\n\t\tunwrap: function() {\n\t\t\treturn this.parent().each(function() {\n\t\t\t\tDomQuery(this).replaceWith(this.childNodes);\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Clones all nodes in set.\n\t\t *\n\t\t * @method clone\n\t\t * @return {tinymce.dom.DomQuery} Set with cloned nodes.\n\t\t */\n\t\tclone: function() {\n\t\t\tvar result = [];\n\n\t\t\tthis.each(function() {\n\t\t\t\tresult.push(this.cloneNode(true));\n\t\t\t});\n\n\t\t\treturn DomQuery(result);\n\t\t},\n\n\t\t/**\n\t\t * Adds the specified class name to the current set elements.\n\t\t *\n\t\t * @method addClass\n\t\t * @param {String} className Class name to add.\n\t\t * @return {tinymce.dom.DomQuery} Current set.\n\t\t */\n\t\taddClass: function(className) {\n\t\t\treturn this.toggleClass(className, true);\n\t\t},\n\n\t\t/**\n\t\t * Removes the specified class name to the current set elements.\n\t\t *\n\t\t * @method removeClass\n\t\t * @param {String} className Class name to remove.\n\t\t * @return {tinymce.dom.DomQuery} Current set.\n\t\t */\n\t\tremoveClass: function(className) {\n\t\t\treturn this.toggleClass(className, false);\n\t\t},\n\n\t\t/**\n\t\t * Toggles the specified class name on the current set elements.\n\t\t *\n\t\t * @method toggleClass\n\t\t * @param {String} className Class name to add/remove.\n\t\t * @param {Boolean} state Optional state to toggle on/off.\n\t\t * @return {tinymce.dom.DomQuery} Current set.\n\t\t */\n\t\ttoggleClass: function(className, state) {\n\t\t\tvar self = this;\n\n\t\t\t// Functions are not supported\n\t\t\tif (typeof className != 'string') {\n\t\t\t\treturn self;\n\t\t\t}\n\n\t\t\tif (className.indexOf(' ') !== -1) {\n\t\t\t\teach(className.split(' '), function() {\n\t\t\t\t\tself.toggleClass(this, state);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tself.each(function(index, node) {\n\t\t\t\t\tvar existingClassName, classState;\n\n\t\t\t\t\tclassState = hasClass(node, className);\n\t\t\t\t\tif (classState !== state) {\n\t\t\t\t\t\texistingClassName = node.className;\n\n\t\t\t\t\t\tif (classState) {\n\t\t\t\t\t\t\tnode.className = trim((\" \" + existingClassName + \" \").replace(' ' + className + ' ', ' '));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tnode.className += existingClassName ? ' ' + className : className;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Returns true/false if the first item in set has the specified class.\n\t\t *\n\t\t * @method hasClass\n\t\t * @param {String} className Class name to check for.\n\t\t * @return {Boolean} True/false if the set has the specified class.\n\t\t */\n\t\thasClass: function(className) {\n\t\t\treturn hasClass(this[0], className);\n\t\t},\n\n\t\t/**\n\t\t * Executes the callback function for each item DomQuery collection. If you return false in the\n\t\t * callback it will break the loop.\n\t\t *\n\t\t * @method each\n\t\t * @param {function} callback Callback function to execute for each item.\n\t\t * @return {tinymce.dom.DomQuery} Current set.\n\t\t */\n\t\teach: function(callback) {\n\t\t\treturn each(this, callback);\n\t\t},\n\n\t\t/**\n\t\t * Binds an event with callback function to the elements in set.\n\t\t *\n\t\t * @method on\n\t\t * @param {String} name Name of the event to bind.\n\t\t * @param {function} callback Callback function to execute when the event occurs.\n\t\t * @return {tinymce.dom.DomQuery} Current set.\n\t\t */\n\t\ton: function(name, callback) {\n\t\t\treturn this.each(function() {\n\t\t\t\tEvent.bind(this, name, callback);\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Unbinds an event with callback function to the elements in set.\n\t\t *\n\t\t * @method off\n\t\t * @param {String} name Optional name of the event to bind.\n\t\t * @param {function} callback Optional callback function to execute when the event occurs.\n\t\t * @return {tinymce.dom.DomQuery} Current set.\n\t\t */\n\t\toff: function(name, callback) {\n\t\t\treturn this.each(function() {\n\t\t\t\tEvent.unbind(this, name, callback);\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Triggers the specified event by name or event object.\n\t\t *\n\t\t * @method trigger\n\t\t * @param {String/Object} name Name of the event to trigger or event object.\n\t\t * @return {tinymce.dom.DomQuery} Current set.\n\t\t */\n\t\ttrigger: function(name) {\n\t\t\treturn this.each(function() {\n\t\t\t\tif (typeof name == 'object') {\n\t\t\t\t\tEvent.fire(this, name.type, name);\n\t\t\t\t} else {\n\t\t\t\t\tEvent.fire(this, name);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Shows all elements in set.\n\t\t *\n\t\t * @method show\n\t\t * @return {tinymce.dom.DomQuery} Current set.\n\t\t */\n\t\tshow: function() {\n\t\t\treturn this.css('display', '');\n\t\t},\n\n\t\t/**\n\t\t * Hides all elements in set.\n\t\t *\n\t\t * @method hide\n\t\t * @return {tinymce.dom.DomQuery} Current set.\n\t\t */\n\t\thide: function() {\n\t\t\treturn this.css('display', 'none');\n\t\t},\n\n\t\t/**\n\t\t * Slices the current set.\n\t\t *\n\t\t * @method slice\n\t\t * @param {Number} start Start index to slice at.\n\t\t * @param {Number} end Optional end index to end slice at.\n\t\t * @return {tinymce.dom.DomQuery} Sliced set.\n\t\t */\n\t\tslice: function() {\n\t\t\treturn new DomQuery(slice.apply(this, arguments));\n\t\t},\n\n\t\t/**\n\t\t * Makes the set equal to the specified index.\n\t\t *\n\t\t * @method eq\n\t\t * @param {Number} index Index to set it equal to.\n\t\t * @return {tinymce.dom.DomQuery} Single item set.\n\t\t */\n\t\teq: function(index) {\n\t\t\treturn index === -1 ? this.slice(index) : this.slice(index, +index + 1);\n\t\t},\n\n\t\t/**\n\t\t * Makes the set equal to first element in set.\n\t\t *\n\t\t * @method first\n\t\t * @return {tinymce.dom.DomQuery} Single item set.\n\t\t */\n\t\tfirst: function() {\n\t\t\treturn this.eq(0);\n\t\t},\n\n\t\t/**\n\t\t * Makes the set equal to last element in set.\n\t\t *\n\t\t * @method last\n\t\t * @return {tinymce.dom.DomQuery} Single item set.\n\t\t */\n\t\tlast: function() {\n\t\t\treturn this.eq(-1);\n\t\t},\n\n\t\t/**\n\t\t * Finds elements by the specified selector for each element in set.\n\t\t *\n\t\t * @method find\n\t\t * @param {String} selector Selector to find elements by.\n\t\t * @return {tinymce.dom.DomQuery} Set with matches elements.\n\t\t */\n\t\tfind: function(selector) {\n\t\t\tvar i, l, ret = [];\n\n\t\t\tfor (i = 0, l = this.length; i < l; i++) {\n\t\t\t\tDomQuery.find(selector, this[i], ret);\n\t\t\t}\n\n\t\t\treturn DomQuery(ret);\n\t\t},\n\n\t\t/**\n\t\t * Filters the current set with the specified selector.\n\t\t *\n\t\t * @method filter\n\t\t * @param {String/function} selector Selector to filter elements by.\n\t\t * @return {tinymce.dom.DomQuery} Set with filtered elements.\n\t\t */\n\t\tfilter: function(selector) {\n\t\t\tif (typeof selector == 'function') {\n\t\t\t\treturn DomQuery(grep(this.toArray(), function(item, i) {\n\t\t\t\t\treturn selector(i, item);\n\t\t\t\t}));\n\t\t\t}\n\n\t\t\treturn DomQuery(DomQuery.filter(selector, this.toArray()));\n\t\t},\n\n\t\t/**\n\t\t * Gets the current node or any parent matching the specified selector.\n\t\t *\n\t\t * @method closest\n\t\t * @param {String/Element/tinymce.dom.DomQuery} selector Selector or element to find.\n\t\t * @return {tinymce.dom.DomQuery} Set with closest elements.\n\t\t */\n\t\tclosest: function(selector) {\n\t\t\tvar result = [];\n\n\t\t\tif (selector instanceof DomQuery) {\n\t\t\t\tselector = selector[0];\n\t\t\t}\n\n\t\t\tthis.each(function(i, node) {\n\t\t\t\twhile (node) {\n\t\t\t\t\tif (typeof selector == 'string' && DomQuery(node).is(selector)) {\n\t\t\t\t\t\tresult.push(node);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t} else if (node == selector) {\n\t\t\t\t\t\tresult.push(node);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn DomQuery(result);\n\t\t},\n\n\t\t/**\n\t\t * Returns the offset of the first element in set or sets the top/left css properties of all elements in set.\n\t\t *\n\t\t * @method offset\n\t\t * @param {Object} offset Optional offset object to set on each item.\n\t\t * @return {Object/tinymce.dom.DomQuery} Returns the first element offset or the current set if you specified an offset.\n\t\t */\n\t\toffset: function(offset) {\n\t\t\tvar elm, doc, docElm;\n\t\t\tvar x = 0, y = 0, pos;\n\n\t\t\tif (!offset) {\n\t\t\t\telm = this[0];\n\n\t\t\t\tif (elm) {\n\t\t\t\t\tdoc = elm.ownerDocument;\n\t\t\t\t\tdocElm = doc.documentElement;\n\n\t\t\t\t\tif (elm.getBoundingClientRect) {\n\t\t\t\t\t\tpos = elm.getBoundingClientRect();\n\t\t\t\t\t\tx = pos.left + (docElm.scrollLeft || doc.body.scrollLeft) - docElm.clientLeft;\n\t\t\t\t\t\ty = pos.top + (docElm.scrollTop || doc.body.scrollTop) - docElm.clientTop;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\tleft: x,\n\t\t\t\t\ttop: y\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn this.css(offset);\n\t\t},\n\n\t\tpush: push,\n\t\tsort: [].sort,\n\t\tsplice: [].splice\n\t};\n\n\t// Static members\n\tTools.extend(DomQuery, {\n\t\t/**\n\t\t * Extends the specified object with one or more objects.\n\t\t *\n\t\t * @static\n\t\t * @method extend\n\t\t * @param {Object} target Target object to extend with new items.\n\t\t * @param {Object..} object Object to extend the target with.\n\t\t * @return {Object} Extended input object.\n\t\t */\n\t\textend: Tools.extend,\n\n\t\t/**\n\t\t * Creates an array out of an array like object.\n\t\t *\n\t\t * @static\n\t\t * @method makeArray\n\t\t * @param {Object} object Object to convert to array.\n\t\t * @return {Array} Array produced from object.\n\t\t */\n\t\tmakeArray: function(object) {\n\t\t\tif (isWindow(object) || object.nodeType) {\n\t\t\t\treturn [object];\n\t\t\t}\n\n\t\t\treturn Tools.toArray(object);\n\t\t},\n\n\t\t/**\n\t\t * Returns the index of the specified item inside the array.\n\t\t *\n\t\t * @static\n\t\t * @method inArray\n\t\t * @param {Object} item Item to look for.\n\t\t * @param {Array} array Array to look for item in.\n\t\t * @return {Number} Index of the item or -1.\n\t\t */\n\t\tinArray: inArray,\n\n\t\t/**\n\t\t * Returns true/false if the specified object is an array or not.\n\t\t *\n\t\t * @static\n\t\t * @method isArray\n\t\t * @param {Object} array Object to check if it's an array or not.\n\t\t * @return {Boolean} True/false if the object is an array.\n\t\t */\n\t\tisArray: Tools.isArray,\n\n\t\t/**\n\t\t * Executes the callback function for each item in array/object. If you return false in the\n\t\t * callback it will break the loop.\n\t\t *\n\t\t * @static\n\t\t * @method each\n\t\t * @param {Object} obj Object to iterate.\n\t\t * @param {function} callback Callback function to execute for each item.\n\t\t */\n\t\teach: each,\n\n\t\t/**\n\t\t * Removes whitespace from the beginning and end of a string.\n\t\t *\n\t\t * @static\n\t\t * @method trim\n\t\t * @param {String} str String to remove whitespace from.\n\t\t * @return {String} New string with removed whitespace.\n\t\t */\n\t\ttrim: trim,\n\n\t\t/**\n\t\t * Filters out items from the input array by calling the specified function for each item.\n\t\t * If the function returns false the item will be excluded if it returns true it will be included.\n\t\t *\n\t\t * @static\n\t\t * @method grep\n\t\t * @param {Array} array Array of items to loop though.\n\t\t * @param {function} callback Function to call for each item. Include/exclude depends on it's return value.\n\t\t * @return {Array} New array with values imported and filtered based in input.\n\t\t * @example\n\t\t * // Filter out some items, this will return an array with 4 and 5\n\t\t * var items = DomQuery.grep([1, 2, 3, 4, 5], function(v) {return v > 3;});\n\t\t */\n\t\tgrep: grep,\n\n\t\t// Sizzle\n\t\tfind: Sizzle,\n\t\texpr: Sizzle.selectors,\n\t\tunique: Sizzle.uniqueSort,\n\t\ttext: Sizzle.getText,\n\t\tcontains: Sizzle.contains,\n\t\tfilter: function(expr, elems, not) {\n\t\t\tvar i = elems.length;\n\n\t\t\tif (not) {\n\t\t\t\texpr = \":not(\" + expr + \")\";\n\t\t\t}\n\n\t\t\twhile (i--) {\n\t\t\t\tif (elems[i].nodeType != 1) {\n\t\t\t\t\telems.splice(i, 1);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (elems.length === 1) {\n\t\t\t\telems = DomQuery.find.matchesSelector(elems[0], expr) ? [elems[0]] : [];\n\t\t\t} else {\n\t\t\t\telems = DomQuery.find.matches(expr, elems);\n\t\t\t}\n\n\t\t\treturn elems;\n\t\t}\n\t});\n\n\tfunction dir(el, prop, until) {\n\t\tvar matched = [], cur = el[prop];\n\n\t\tif (typeof until != 'string' && until instanceof DomQuery) {\n\t\t\tuntil = until[0];\n\t\t}\n\n\t\twhile (cur && cur.nodeType !== 9) {\n\t\t\tif (until !== undefined) {\n\t\t\t\tif (cur === until) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (typeof until == 'string' && DomQuery(cur).is(until)) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (cur.nodeType === 1) {\n\t\t\t\tmatched.push(cur);\n\t\t\t}\n\n\t\t\tcur = cur[prop];\n\t\t}\n\n\t\treturn matched;\n\t}\n\n\tfunction sibling(node, siblingName, nodeType, until) {\n\t\tvar result = [];\n\n\t\tif (until instanceof DomQuery) {\n\t\t\tuntil = until[0];\n\t\t}\n\n\t\tfor (; node; node = node[siblingName]) {\n\t\t\tif (nodeType && node.nodeType !== nodeType) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (until !== undefined) {\n\t\t\t\tif (node === until) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (typeof until == 'string' && DomQuery(node).is(until)) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tresult.push(node);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tfunction firstSibling(node, siblingName, nodeType) {\n\t\tfor (node = node[siblingName]; node; node = node[siblingName]) {\n\t\t\tif (node.nodeType == nodeType) {\n\t\t\t\treturn node;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\teach({\n\t\t/**\n\t\t * Returns a new collection with the parent of each item in current collection matching the optional selector.\n\t\t *\n\t\t * @method parent\n\t\t * @param {Element/tinymce.dom.DomQuery} node Node to match parents against.\n\t\t * @return {tinymce.dom.DomQuery} New DomQuery instance with all matching parents.\n\t\t */\n\t\tparent: function(node) {\n\t\t\tvar parent = node.parentNode;\n\n\t\t\treturn parent && parent.nodeType !== 11 ? parent : null;\n\t\t},\n\n\t\t/**\n\t\t * Returns a new collection with the all the parents of each item in current collection matching the optional selector.\n\t\t *\n\t\t * @method parents\n\t\t * @param {Element/tinymce.dom.DomQuery} node Node to match parents against.\n\t\t * @return {tinymce.dom.DomQuery} New DomQuery instance with all matching parents.\n\t\t */\n\t\tparents: function(node) {\n\t\t\treturn dir(node, \"parentNode\");\n\t\t},\n\n\t\t/**\n\t\t * Returns a new collection with next sibling of each item in current collection matching the optional selector.\n\t\t *\n\t\t * @method next\n\t\t * @param {Element/tinymce.dom.DomQuery} node Node to match the next element against.\n\t\t * @return {tinymce.dom.DomQuery} New DomQuery instance with all matching elements.\n\t\t */\n\t\tnext: function(node) {\n\t\t\treturn firstSibling(node, 'nextSibling', 1);\n\t\t},\n\n\t\t/**\n\t\t * Returns a new collection with previous sibling of each item in current collection matching the optional selector.\n\t\t *\n\t\t * @method prev\n\t\t * @param {Element/tinymce.dom.DomQuery} node Node to match the previous element against.\n\t\t * @return {tinymce.dom.DomQuery} New DomQuery instance with all matching elements.\n\t\t */\n\t\tprev: function(node) {\n\t\t\treturn firstSibling(node, 'previousSibling', 1);\n\t\t},\n\n\t\t/**\n\t\t * Returns all child elements matching the optional selector.\n\t\t *\n\t\t * @method children\n\t\t * @param {Element/tinymce.dom.DomQuery} node Node to match the elements against.\n\t\t * @return {tinymce.dom.DomQuery} New DomQuery instance with all matching elements.\n\t\t */\n\t\tchildren: function(node) {\n\t\t\treturn sibling(node.firstChild, 'nextSibling', 1);\n\t\t},\n\n\t\t/**\n\t\t * Returns all child nodes matching the optional selector.\n\t\t *\n\t\t * @method contents\n\t\t * @param {Element/tinymce.dom.DomQuery} node Node to get the contents of.\n\t\t * @return {tinymce.dom.DomQuery} New DomQuery instance with all matching elements.\n\t\t */\n\t\tcontents: function(node) {\n\t\t\treturn Tools.toArray((node.nodeName === \"iframe\" ? node.contentDocument || node.contentWindow.document : node).childNodes);\n\t\t}\n\t}, function(name, fn) {\n\t\tDomQuery.fn[name] = function(selector) {\n\t\t\tvar self = this, result = [];\n\n\t\t\tself.each(function() {\n\t\t\t\tvar nodes = fn.call(result, this, selector, result);\n\n\t\t\t\tif (nodes) {\n\t\t\t\t\tif (DomQuery.isArray(nodes)) {\n\t\t\t\t\t\tresult.push.apply(result, nodes);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult.push(nodes);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// If traversing on multiple elements we might get the same elements twice\n\t\t\tif (this.length > 1) {\n\t\t\t\tif (!skipUniques[name]) {\n\t\t\t\t\tresult = DomQuery.unique(result);\n\t\t\t\t}\n\n\t\t\t\tif (name.indexOf('parents') === 0) {\n\t\t\t\t\tresult = result.reverse();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tresult = DomQuery(result);\n\n\t\t\tif (selector) {\n\t\t\t\treturn result.filter(selector);\n\t\t\t}\n\n\t\t\treturn result;\n\t\t};\n\t});\n\n\teach({\n\t\t/**\n\t\t * Returns a new collection with the all the parents until the matching selector/element\n\t\t * of each item in current collection matching the optional selector.\n\t\t *\n\t\t * @method parentsUntil\n\t\t * @param {Element/tinymce.dom.DomQuery} node Node to find parent of.\n\t\t * @param {String/Element/tinymce.dom.DomQuery} until Until the matching selector or element.\n\t\t * @return {tinymce.dom.DomQuery} New DomQuery instance with all matching parents.\n\t\t */\n\t\tparentsUntil: function(node, until) {\n\t\t\treturn dir(node, \"parentNode\", until);\n\t\t},\n\n\t\t/**\n\t\t * Returns a new collection with all next siblings of each item in current collection matching the optional selector.\n\t\t *\n\t\t * @method nextUntil\n\t\t * @param {Element/tinymce.dom.DomQuery} node Node to find next siblings on.\n\t\t * @param {String/Element/tinymce.dom.DomQuery} until Until the matching selector or element.\n\t\t * @return {tinymce.dom.DomQuery} New DomQuery instance with all matching elements.\n\t\t */\n\t\tnextUntil: function(node, until) {\n\t\t\treturn sibling(node, 'nextSibling', 1, until).slice(1);\n\t\t},\n\n\t\t/**\n\t\t * Returns a new collection with all previous siblings of each item in current collection matching the optional selector.\n\t\t *\n\t\t * @method prevUntil\n\t\t * @param {Element/tinymce.dom.DomQuery} node Node to find previous siblings on.\n\t\t * @param {String/Element/tinymce.dom.DomQuery} until Until the matching selector or element.\n\t\t * @return {tinymce.dom.DomQuery} New DomQuery instance with all matching elements.\n\t\t */\n\t\tprevUntil: function(node, until) {\n\t\t\treturn sibling(node, 'previousSibling', 1, until).slice(1);\n\t\t}\n\t}, function(name, fn) {\n\t\tDomQuery.fn[name] = function(selector, filter) {\n\t\t\tvar self = this, result = [];\n\n\t\t\tself.each(function() {\n\t\t\t\tvar nodes = fn.call(result, this, selector, result);\n\n\t\t\t\tif (nodes) {\n\t\t\t\t\tif (DomQuery.isArray(nodes)) {\n\t\t\t\t\t\tresult.push.apply(result, nodes);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult.push(nodes);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// If traversing on multiple elements we might get the same elements twice\n\t\t\tif (this.length > 1) {\n\t\t\t\tresult = DomQuery.unique(result);\n\n\t\t\t\tif (name.indexOf('parents') === 0 || name === 'prevUntil') {\n\t\t\t\t\tresult = result.reverse();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tresult = DomQuery(result);\n\n\t\t\tif (filter) {\n\t\t\t\treturn result.filter(filter);\n\t\t\t}\n\n\t\t\treturn result;\n\t\t};\n\t});\n\n\t/**\n\t * Returns true/false if the current set items matches the selector.\n\t *\n\t * @method is\n\t * @param {String} selector Selector to match the elements against.\n\t * @return {Boolean} True/false if the current set matches the selector.\n\t */\n\tDomQuery.fn.is = function(selector) {\n\t\treturn !!selector && this.filter(selector).length > 0;\n\t};\n\n\tDomQuery.fn.init.prototype = DomQuery.fn;\n\n\tDomQuery.overrideDefaults = function(callback) {\n\t\tvar defaults;\n\n\t\tfunction sub(selector, context) {\n\t\t\tdefaults = defaults || callback();\n\n\t\t\tif (arguments.length === 0) {\n\t\t\t\tselector = defaults.element;\n\t\t\t}\n\n\t\t\tif (!context) {\n\t\t\t\tcontext = defaults.context;\n\t\t\t}\n\n\t\t\treturn new sub.fn.init(selector, context);\n\t\t}\n\n\t\tDomQuery.extend(sub, this);\n\n\t\treturn sub;\n\t};\n\n\tfunction appendHooks(targetHooks, prop, hooks) {\n\t\teach(hooks, function(name, func) {\n\t\t\ttargetHooks[name] = targetHooks[name] || {};\n\t\t\ttargetHooks[name][prop] = func;\n\t\t});\n\t}\n\n\tif (Env.ie && Env.ie < 8) {\n\t\tappendHooks(attrHooks, 'get', {\n\t\t\tmaxlength: function(elm) {\n\t\t\t\tvar value = elm.maxLength;\n\n\t\t\t\tif (value === 0x7fffffff) {\n\t\t\t\t\treturn undef;\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t},\n\n\t\t\tsize: function(elm) {\n\t\t\t\tvar value = elm.size;\n\n\t\t\t\tif (value === 20) {\n\t\t\t\t\treturn undef;\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t},\n\n\t\t\t'class': function(elm) {\n\t\t\t\treturn elm.className;\n\t\t\t},\n\n\t\t\tstyle: function(elm) {\n\t\t\t\tvar value = elm.style.cssText;\n\n\t\t\t\tif (value.length === 0) {\n\t\t\t\t\treturn undef;\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t}\n\t\t});\n\n\t\tappendHooks(attrHooks, 'set', {\n\t\t\t'class': function(elm, value) {\n\t\t\t\telm.className = value;\n\t\t\t},\n\n\t\t\tstyle: function(elm, value) {\n\t\t\t\telm.style.cssText = value;\n\t\t\t}\n\t\t});\n\t}\n\n\tif (Env.ie && Env.ie < 9) {\n\t\t/*jshint sub:true */\n\t\t/*eslint dot-notation: 0*/\n\t\tcssFix['float'] = 'styleFloat';\n\n\t\tappendHooks(cssHooks, 'set', {\n\t\t\topacity: function(elm, value) {\n\t\t\t\tvar style = elm.style;\n\n\t\t\t\tif (value === null || value === '') {\n\t\t\t\t\tstyle.removeAttribute('filter');\n\t\t\t\t} else {\n\t\t\t\t\tstyle.zoom = 1;\n\t\t\t\t\tstyle.filter = 'alpha(opacity=' + (value * 100) + ')';\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tDomQuery.attrHooks = attrHooks;\n\tDomQuery.cssHooks = cssHooks;\n\n\treturn DomQuery;\n});\n\n// Included from: js/tinymce/classes/html/Styles.js\n\n/**\n * Styles.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class is used to parse CSS styles it also compresses styles to reduce the output size.\n *\n * @example\n * var Styles = new tinymce.html.Styles({\n *    url_converter: function(url) {\n *       return url;\n *    }\n * });\n *\n * styles = Styles.parse('border: 1px solid red');\n * styles.color = 'red';\n *\n * console.log(new tinymce.html.StyleSerializer().serialize(styles));\n *\n * @class tinymce.html.Styles\n * @version 3.4\n */\ndefine(\"tinymce/html/Styles\", [], function() {\n\treturn function(settings, schema) {\n\t\t/*jshint maxlen:255 */\n\t\t/*eslint max-len:0 */\n\t\tvar rgbRegExp = /rgb\\s*\\(\\s*([0-9]+)\\s*,\\s*([0-9]+)\\s*,\\s*([0-9]+)\\s*\\)/gi,\n\t\t\turlOrStrRegExp = /(?:url(?:(?:\\(\\s*\\\"([^\\\"]+)\\\"\\s*\\))|(?:\\(\\s*\\'([^\\']+)\\'\\s*\\))|(?:\\(\\s*([^)\\s]+)\\s*\\))))|(?:\\'([^\\']+)\\')|(?:\\\"([^\\\"]+)\\\")/gi,\n\t\t\tstyleRegExp = /\\s*([^:]+):\\s*([^;]+);?/g,\n\t\t\ttrimRightRegExp = /\\s+$/,\n\t\t\ti, encodingLookup = {}, encodingItems, validStyles, invalidStyles, invisibleChar = '\\uFEFF';\n\n\t\tsettings = settings || {};\n\n\t\tif (schema) {\n\t\t\tvalidStyles = schema.getValidStyles();\n\t\t\tinvalidStyles = schema.getInvalidStyles();\n\t\t}\n\n\t\tencodingItems = ('\\\\\" \\\\\\' \\\\; \\\\: ; : ' + invisibleChar).split(' ');\n\t\tfor (i = 0; i < encodingItems.length; i++) {\n\t\t\tencodingLookup[encodingItems[i]] = invisibleChar + i;\n\t\t\tencodingLookup[invisibleChar + i] = encodingItems[i];\n\t\t}\n\n\t\tfunction toHex(match, r, g, b) {\n\t\t\tfunction hex(val) {\n\t\t\t\tval = parseInt(val, 10).toString(16);\n\n\t\t\t\treturn val.length > 1 ? val : '0' + val; // 0 -> 00\n\t\t\t}\n\n\t\t\treturn '#' + hex(r) + hex(g) + hex(b);\n\t\t}\n\n\t\treturn {\n\t\t\t/**\n\t\t\t * Parses the specified RGB color value and returns a hex version of that color.\n\t\t\t *\n\t\t\t * @method toHex\n\t\t\t * @param {String} color RGB string value like rgb(1,2,3)\n\t\t\t * @return {String} Hex version of that RGB value like #FF00FF.\n\t\t\t */\n\t\t\ttoHex: function(color) {\n\t\t\t\treturn color.replace(rgbRegExp, toHex);\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Parses the specified style value into an object collection. This parser will also\n\t\t\t * merge and remove any redundant items that browsers might have added. It will also convert non hex\n\t\t\t * colors to hex values. Urls inside the styles will also be converted to absolute/relative based on settings.\n\t\t\t *\n\t\t\t * @method parse\n\t\t\t * @param {String} css Style value to parse for example: border:1px solid red;.\n\t\t\t * @return {Object} Object representation of that style like {border: '1px solid red'}\n\t\t\t */\n\t\t\tparse: function(css) {\n\t\t\t\tvar styles = {}, matches, name, value, isEncoded, urlConverter = settings.url_converter;\n\t\t\t\tvar urlConverterScope = settings.url_converter_scope || this;\n\n\t\t\t\tfunction compress(prefix, suffix, noJoin) {\n\t\t\t\t\tvar top, right, bottom, left;\n\n\t\t\t\t\ttop = styles[prefix + '-top' + suffix];\n\t\t\t\t\tif (!top) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tright = styles[prefix + '-right' + suffix];\n\t\t\t\t\tif (!right) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tbottom = styles[prefix + '-bottom' + suffix];\n\t\t\t\t\tif (!bottom) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tleft = styles[prefix + '-left' + suffix];\n\t\t\t\t\tif (!left) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar box = [top, right, bottom, left];\n\t\t\t\t\ti = box.length - 1;\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tif (box[i] !== box[i + 1]) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (i > -1 && noJoin) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tstyles[prefix + suffix] = i == -1 ? box[0] : box.join(' ');\n\t\t\t\t\tdelete styles[prefix + '-top' + suffix];\n\t\t\t\t\tdelete styles[prefix + '-right' + suffix];\n\t\t\t\t\tdelete styles[prefix + '-bottom' + suffix];\n\t\t\t\t\tdelete styles[prefix + '-left' + suffix];\n\t\t\t\t}\n\n\t\t\t\t/**\n\t\t\t\t * Checks if the specific style can be compressed in other words if all border-width are equal.\n\t\t\t\t */\n\t\t\t\tfunction canCompress(key) {\n\t\t\t\t\tvar value = styles[key], i;\n\n\t\t\t\t\tif (!value) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvalue = value.split(' ');\n\t\t\t\t\ti = value.length;\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tif (value[i] !== value[0]) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tstyles[key] = value[0];\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\t/**\n\t\t\t\t * Compresses multiple styles into one style.\n\t\t\t\t */\n\t\t\t\tfunction compress2(target, a, b, c) {\n\t\t\t\t\tif (!canCompress(a)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!canCompress(b)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!canCompress(c)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Compress\n\t\t\t\t\tstyles[target] = styles[a] + ' ' + styles[b] + ' ' + styles[c];\n\t\t\t\t\tdelete styles[a];\n\t\t\t\t\tdelete styles[b];\n\t\t\t\t\tdelete styles[c];\n\t\t\t\t}\n\n\t\t\t\t// Encodes the specified string by replacing all \\\" \\' ; : with _<num>\n\t\t\t\tfunction encode(str) {\n\t\t\t\t\tisEncoded = true;\n\n\t\t\t\t\treturn encodingLookup[str];\n\t\t\t\t}\n\n\t\t\t\t// Decodes the specified string by replacing all _<num> with it's original value \\\" \\' etc\n\t\t\t\t// It will also decode the \\\" \\' if keep_slashes is set to fale or omitted\n\t\t\t\tfunction decode(str, keep_slashes) {\n\t\t\t\t\tif (isEncoded) {\n\t\t\t\t\t\tstr = str.replace(/\\uFEFF[0-9]/g, function(str) {\n\t\t\t\t\t\t\treturn encodingLookup[str];\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!keep_slashes) {\n\t\t\t\t\t\tstr = str.replace(/\\\\([\\'\\\";:])/g, \"$1\");\n\t\t\t\t\t}\n\n\t\t\t\t\treturn str;\n\t\t\t\t}\n\n\t\t\t\tfunction decodeSingleHexSequence(escSeq) {\n\t\t\t\t\treturn String.fromCharCode(parseInt(escSeq.slice(1), 16));\n\t\t\t\t}\n\n\t\t\t\tfunction decodeHexSequences(value) {\n\t\t\t\t\treturn value.replace(/\\\\[0-9a-f]+/gi, decodeSingleHexSequence);\n\t\t\t\t}\n\n\t\t\t\tfunction processUrl(match, url, url2, url3, str, str2) {\n\t\t\t\t\tstr = str || str2;\n\n\t\t\t\t\tif (str) {\n\t\t\t\t\t\tstr = decode(str);\n\n\t\t\t\t\t\t// Force strings into single quote format\n\t\t\t\t\t\treturn \"'\" + str.replace(/\\'/g, \"\\\\'\") + \"'\";\n\t\t\t\t\t}\n\n\t\t\t\t\turl = decode(url || url2 || url3);\n\n\t\t\t\t\tif (!settings.allow_script_urls) {\n\t\t\t\t\t\tvar scriptUrl = url.replace(/[\\s\\r\\n]+/g, '');\n\n\t\t\t\t\t\tif (/(java|vb)script:/i.test(scriptUrl)) {\n\t\t\t\t\t\t\treturn \"\";\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!settings.allow_svg_data_urls && /^data:image\\/svg/i.test(scriptUrl)) {\n\t\t\t\t\t\t\treturn \"\";\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Convert the URL to relative/absolute depending on config\n\t\t\t\t\tif (urlConverter) {\n\t\t\t\t\t\turl = urlConverter.call(urlConverterScope, url, 'style');\n\t\t\t\t\t}\n\n\t\t\t\t\t// Output new URL format\n\t\t\t\t\treturn \"url('\" + url.replace(/\\'/g, \"\\\\'\") + \"')\";\n\t\t\t\t}\n\n\t\t\t\tif (css) {\n\t\t\t\t\tcss = css.replace(/[\\u0000-\\u001F]/g, '');\n\n\t\t\t\t\t// Encode \\\" \\' % and ; and : inside strings so they don't interfere with the style parsing\n\t\t\t\t\tcss = css.replace(/\\\\[\\\"\\';:\\uFEFF]/g, encode).replace(/\\\"[^\\\"]+\\\"|\\'[^\\']+\\'/g, function(str) {\n\t\t\t\t\t\treturn str.replace(/[;:]/g, encode);\n\t\t\t\t\t});\n\n\t\t\t\t\t// Parse styles\n\t\t\t\t\twhile ((matches = styleRegExp.exec(css))) {\n\t\t\t\t\t\tstyleRegExp.lastIndex = matches.index + matches[0].length;\n\t\t\t\t\t\tname = matches[1].replace(trimRightRegExp, '').toLowerCase();\n\t\t\t\t\t\tvalue = matches[2].replace(trimRightRegExp, '');\n\n\t\t\t\t\t\tif (name && value) {\n\t\t\t\t\t\t\t// Decode escaped sequences like \\65 -> e\n\t\t\t\t\t\t\tname = decodeHexSequences(name);\n\t\t\t\t\t\t\tvalue = decodeHexSequences(value);\n\n\t\t\t\t\t\t\t// Skip properties with double quotes and sequences like \\\" \\' in their names\n\t\t\t\t\t\t\t// See 'mXSS Attacks: Attacking well-secured Web-Applications by using innerHTML Mutations'\n\t\t\t\t\t\t\t// https://cure53.de/fp170.pdf\n\t\t\t\t\t\t\tif (name.indexOf(invisibleChar) !== -1 || name.indexOf('\"') !== -1) {\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Don't allow behavior name or expression/comments within the values\n\t\t\t\t\t\t\tif (!settings.allow_script_urls && (name == \"behavior\" || /expression\\s*\\(|\\/\\*|\\*\\//.test(value))) {\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Opera will produce 700 instead of bold in their style values\n\t\t\t\t\t\t\tif (name === 'font-weight' && value === '700') {\n\t\t\t\t\t\t\t\tvalue = 'bold';\n\t\t\t\t\t\t\t} else if (name === 'color' || name === 'background-color') { // Lowercase colors like RED\n\t\t\t\t\t\t\t\tvalue = value.toLowerCase();\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Convert RGB colors to HEX\n\t\t\t\t\t\t\tvalue = value.replace(rgbRegExp, toHex);\n\n\t\t\t\t\t\t\t// Convert URLs and force them into url('value') format\n\t\t\t\t\t\t\tvalue = value.replace(urlOrStrRegExp, processUrl);\n\t\t\t\t\t\t\tstyles[name] = isEncoded ? decode(value, true) : value;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t// Compress the styles to reduce it's size for example IE will expand styles\n\t\t\t\t\tcompress(\"border\", \"\", true);\n\t\t\t\t\tcompress(\"border\", \"-width\");\n\t\t\t\t\tcompress(\"border\", \"-color\");\n\t\t\t\t\tcompress(\"border\", \"-style\");\n\t\t\t\t\tcompress(\"padding\", \"\");\n\t\t\t\t\tcompress(\"margin\", \"\");\n\t\t\t\t\tcompress2('border', 'border-width', 'border-style', 'border-color');\n\n\t\t\t\t\t// Remove pointless border, IE produces these\n\t\t\t\t\tif (styles.border === 'medium none') {\n\t\t\t\t\t\tdelete styles.border;\n\t\t\t\t\t}\n\n\t\t\t\t\t// IE 11 will produce a border-image: none when getting the style attribute from <p style=\"border: 1px solid red\"></p>\n\t\t\t\t\t// So let us assume it shouldn't be there\n\t\t\t\t\tif (styles['border-image'] === 'none') {\n\t\t\t\t\t\tdelete styles['border-image'];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn styles;\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Serializes the specified style object into a string.\n\t\t\t *\n\t\t\t * @method serialize\n\t\t\t * @param {Object} styles Object to serialize as string for example: {border: '1px solid red'}\n\t\t\t * @param {String} elementName Optional element name, if specified only the styles that matches the schema will be serialized.\n\t\t\t * @return {String} String representation of the style object for example: border: 1px solid red.\n\t\t\t */\n\t\t\tserialize: function(styles, elementName) {\n\t\t\t\tvar css = '', name, value;\n\n\t\t\t\tfunction serializeStyles(name) {\n\t\t\t\t\tvar styleList, i, l, value;\n\n\t\t\t\t\tstyleList = validStyles[name];\n\t\t\t\t\tif (styleList) {\n\t\t\t\t\t\tfor (i = 0, l = styleList.length; i < l; i++) {\n\t\t\t\t\t\t\tname = styleList[i];\n\t\t\t\t\t\t\tvalue = styles[name];\n\n\t\t\t\t\t\t\tif (value) {\n\t\t\t\t\t\t\t\tcss += (css.length > 0 ? ' ' : '') + name + ': ' + value + ';';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction isValid(name, elementName) {\n\t\t\t\t\tvar styleMap;\n\n\t\t\t\t\tstyleMap = invalidStyles['*'];\n\t\t\t\t\tif (styleMap && styleMap[name]) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tstyleMap = invalidStyles[elementName];\n\t\t\t\t\tif (styleMap && styleMap[name]) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\t// Serialize styles according to schema\n\t\t\t\tif (elementName && validStyles) {\n\t\t\t\t\t// Serialize global styles and element specific styles\n\t\t\t\t\tserializeStyles('*');\n\t\t\t\t\tserializeStyles(elementName);\n\t\t\t\t} else {\n\t\t\t\t\t// Output the styles in the order they are inside the object\n\t\t\t\t\tfor (name in styles) {\n\t\t\t\t\t\tvalue = styles[name];\n\n\t\t\t\t\t\tif (value && (!invalidStyles || isValid(name, elementName))) {\n\t\t\t\t\t\t\tcss += (css.length > 0 ? ' ' : '') + name + ': ' + value + ';';\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn css;\n\t\t\t}\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/dom/TreeWalker.js\n\n/**\n * TreeWalker.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * TreeWalker class enables you to walk the DOM in a linear manner.\n *\n * @class tinymce.dom.TreeWalker\n * @example\n * var walker = new tinymce.dom.TreeWalker(startNode);\n *\n * do {\n *     console.log(walker.current());\n * } while (walker.next());\n */\ndefine(\"tinymce/dom/TreeWalker\", [], function() {\n\t/**\n\t * Constructs a new TreeWalker instance.\n\t *\n\t * @constructor\n\t * @method TreeWalker\n\t * @param {Node} startNode Node to start walking from.\n\t * @param {node} rootNode Optional root node to never walk out of.\n\t */\n\treturn function(startNode, rootNode) {\n\t\tvar node = startNode;\n\n\t\tfunction findSibling(node, startName, siblingName, shallow) {\n\t\t\tvar sibling, parent;\n\n\t\t\tif (node) {\n\t\t\t\t// Walk into nodes if it has a start\n\t\t\t\tif (!shallow && node[startName]) {\n\t\t\t\t\treturn node[startName];\n\t\t\t\t}\n\n\t\t\t\t// Return the sibling if it has one\n\t\t\t\tif (node != rootNode) {\n\t\t\t\t\tsibling = node[siblingName];\n\t\t\t\t\tif (sibling) {\n\t\t\t\t\t\treturn sibling;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Walk up the parents to look for siblings\n\t\t\t\t\tfor (parent = node.parentNode; parent && parent != rootNode; parent = parent.parentNode) {\n\t\t\t\t\t\tsibling = parent[siblingName];\n\t\t\t\t\t\tif (sibling) {\n\t\t\t\t\t\t\treturn sibling;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction findPreviousNode(node, startName, siblingName, shallow) {\n\t\t\tvar sibling, parent, child;\n\n\t\t\tif (node) {\n\t\t\t\tsibling = node[siblingName];\n\t\t\t\tif (rootNode && sibling === rootNode) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (sibling) {\n\t\t\t\t\tif (!shallow) {\n\t\t\t\t\t\t// Walk up the parents to look for siblings\n\t\t\t\t\t\tfor (child = sibling[startName]; child; child = child[startName]) {\n\t\t\t\t\t\t\tif (!child[startName]) {\n\t\t\t\t\t\t\t\treturn child;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn sibling;\n\t\t\t\t}\n\n\t\t\t\tparent = node.parentNode;\n\t\t\t\tif (parent && parent !== rootNode) {\n\t\t\t\t\treturn parent;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Returns the current node.\n\t\t *\n\t\t * @method current\n\t\t * @return {Node} Current node where the walker is.\n\t\t */\n\t\tthis.current = function() {\n\t\t\treturn node;\n\t\t};\n\n\t\t/**\n\t\t * Walks to the next node in tree.\n\t\t *\n\t\t * @method next\n\t\t * @return {Node} Current node where the walker is after moving to the next node.\n\t\t */\n\t\tthis.next = function(shallow) {\n\t\t\tnode = findSibling(node, 'firstChild', 'nextSibling', shallow);\n\t\t\treturn node;\n\t\t};\n\n\t\t/**\n\t\t * Walks to the previous node in tree.\n\t\t *\n\t\t * @method prev\n\t\t * @return {Node} Current node where the walker is after moving to the previous node.\n\t\t */\n\t\tthis.prev = function(shallow) {\n\t\t\tnode = findSibling(node, 'lastChild', 'previousSibling', shallow);\n\t\t\treturn node;\n\t\t};\n\n\t\tthis.prev2 = function(shallow) {\n\t\t\tnode = findPreviousNode(node, 'lastChild', 'previousSibling', shallow);\n\t\t\treturn node;\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/dom/Range.js\n\n/**\n * Range.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Old IE Range.\n *\n * @private\n * @class tinymce.dom.Range\n */\ndefine(\"tinymce/dom/Range\", [\n\t\"tinymce/util/Tools\"\n], function(Tools) {\n\t// Range constructor\n\tfunction Range(dom) {\n\t\tvar self = this,\n\t\t\tdoc = dom.doc,\n\t\t\tEXTRACT = 0,\n\t\t\tCLONE = 1,\n\t\t\tDELETE = 2,\n\t\t\tTRUE = true,\n\t\t\tFALSE = false,\n\t\t\tSTART_OFFSET = 'startOffset',\n\t\t\tSTART_CONTAINER = 'startContainer',\n\t\t\tEND_CONTAINER = 'endContainer',\n\t\t\tEND_OFFSET = 'endOffset',\n\t\t\textend = Tools.extend,\n\t\t\tnodeIndex = dom.nodeIndex;\n\n\t\tfunction createDocumentFragment() {\n\t\t\treturn doc.createDocumentFragment();\n\t\t}\n\n\t\tfunction setStart(n, o) {\n\t\t\t_setEndPoint(TRUE, n, o);\n\t\t}\n\n\t\tfunction setEnd(n, o) {\n\t\t\t_setEndPoint(FALSE, n, o);\n\t\t}\n\n\t\tfunction setStartBefore(n) {\n\t\t\tsetStart(n.parentNode, nodeIndex(n));\n\t\t}\n\n\t\tfunction setStartAfter(n) {\n\t\t\tsetStart(n.parentNode, nodeIndex(n) + 1);\n\t\t}\n\n\t\tfunction setEndBefore(n) {\n\t\t\tsetEnd(n.parentNode, nodeIndex(n));\n\t\t}\n\n\t\tfunction setEndAfter(n) {\n\t\t\tsetEnd(n.parentNode, nodeIndex(n) + 1);\n\t\t}\n\n\t\tfunction collapse(ts) {\n\t\t\tif (ts) {\n\t\t\t\tself[END_CONTAINER] = self[START_CONTAINER];\n\t\t\t\tself[END_OFFSET] = self[START_OFFSET];\n\t\t\t} else {\n\t\t\t\tself[START_CONTAINER] = self[END_CONTAINER];\n\t\t\t\tself[START_OFFSET] = self[END_OFFSET];\n\t\t\t}\n\n\t\t\tself.collapsed = TRUE;\n\t\t}\n\n\t\tfunction selectNode(n) {\n\t\t\tsetStartBefore(n);\n\t\t\tsetEndAfter(n);\n\t\t}\n\n\t\tfunction selectNodeContents(n) {\n\t\t\tsetStart(n, 0);\n\t\t\tsetEnd(n, n.nodeType === 1 ? n.childNodes.length : n.nodeValue.length);\n\t\t}\n\n\t\tfunction compareBoundaryPoints(h, r) {\n\t\t\tvar sc = self[START_CONTAINER], so = self[START_OFFSET], ec = self[END_CONTAINER], eo = self[END_OFFSET],\n\t\t\trsc = r.startContainer, rso = r.startOffset, rec = r.endContainer, reo = r.endOffset;\n\n\t\t\t// Check START_TO_START\n\t\t\tif (h === 0) {\n\t\t\t\treturn _compareBoundaryPoints(sc, so, rsc, rso);\n\t\t\t}\n\n\t\t\t// Check START_TO_END\n\t\t\tif (h === 1) {\n\t\t\t\treturn _compareBoundaryPoints(ec, eo, rsc, rso);\n\t\t\t}\n\n\t\t\t// Check END_TO_END\n\t\t\tif (h === 2) {\n\t\t\t\treturn _compareBoundaryPoints(ec, eo, rec, reo);\n\t\t\t}\n\n\t\t\t// Check END_TO_START\n\t\t\tif (h === 3) {\n\t\t\t\treturn _compareBoundaryPoints(sc, so, rec, reo);\n\t\t\t}\n\t\t}\n\n\t\tfunction deleteContents() {\n\t\t\t_traverse(DELETE);\n\t\t}\n\n\t\tfunction extractContents() {\n\t\t\treturn _traverse(EXTRACT);\n\t\t}\n\n\t\tfunction cloneContents() {\n\t\t\treturn _traverse(CLONE);\n\t\t}\n\n\t\tfunction insertNode(n) {\n\t\t\tvar startContainer = this[START_CONTAINER],\n\t\t\t\tstartOffset = this[START_OFFSET], nn, o;\n\n\t\t\t// Node is TEXT_NODE or CDATA\n\t\t\tif ((startContainer.nodeType === 3 || startContainer.nodeType === 4) && startContainer.nodeValue) {\n\t\t\t\tif (!startOffset) {\n\t\t\t\t\t// At the start of text\n\t\t\t\t\tstartContainer.parentNode.insertBefore(n, startContainer);\n\t\t\t\t} else if (startOffset >= startContainer.nodeValue.length) {\n\t\t\t\t\t// At the end of text\n\t\t\t\t\tdom.insertAfter(n, startContainer);\n\t\t\t\t} else {\n\t\t\t\t\t// Middle, need to split\n\t\t\t\t\tnn = startContainer.splitText(startOffset);\n\t\t\t\t\tstartContainer.parentNode.insertBefore(n, nn);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Insert element node\n\t\t\t\tif (startContainer.childNodes.length > 0) {\n\t\t\t\t\to = startContainer.childNodes[startOffset];\n\t\t\t\t}\n\n\t\t\t\tif (o) {\n\t\t\t\t\tstartContainer.insertBefore(n, o);\n\t\t\t\t} else {\n\t\t\t\t\tif (startContainer.nodeType == 3) {\n\t\t\t\t\t\tdom.insertAfter(n, startContainer);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstartContainer.appendChild(n);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction surroundContents(n) {\n\t\t\tvar f = self.extractContents();\n\n\t\t\tself.insertNode(n);\n\t\t\tn.appendChild(f);\n\t\t\tself.selectNode(n);\n\t\t}\n\n\t\tfunction cloneRange() {\n\t\t\treturn extend(new Range(dom), {\n\t\t\t\tstartContainer: self[START_CONTAINER],\n\t\t\t\tstartOffset: self[START_OFFSET],\n\t\t\t\tendContainer: self[END_CONTAINER],\n\t\t\t\tendOffset: self[END_OFFSET],\n\t\t\t\tcollapsed: self.collapsed,\n\t\t\t\tcommonAncestorContainer: self.commonAncestorContainer\n\t\t\t});\n\t\t}\n\n\t\t// Private methods\n\n\t\tfunction _getSelectedNode(container, offset) {\n\t\t\tvar child;\n\n\t\t\t// TEXT_NODE\n\t\t\tif (container.nodeType == 3) {\n\t\t\t\treturn container;\n\t\t\t}\n\n\t\t\tif (offset < 0) {\n\t\t\t\treturn container;\n\t\t\t}\n\n\t\t\tchild = container.firstChild;\n\t\t\twhile (child && offset > 0) {\n\t\t\t\t--offset;\n\t\t\t\tchild = child.nextSibling;\n\t\t\t}\n\n\t\t\tif (child) {\n\t\t\t\treturn child;\n\t\t\t}\n\n\t\t\treturn container;\n\t\t}\n\n\t\tfunction _isCollapsed() {\n\t\t\treturn (self[START_CONTAINER] == self[END_CONTAINER] && self[START_OFFSET] == self[END_OFFSET]);\n\t\t}\n\n\t\tfunction _compareBoundaryPoints(containerA, offsetA, containerB, offsetB) {\n\t\t\tvar c, offsetC, n, cmnRoot, childA, childB;\n\n\t\t\t// In the first case the boundary-points have the same container. A is before B\n\t\t\t// if its offset is less than the offset of B, A is equal to B if its offset is\n\t\t\t// equal to the offset of B, and A is after B if its offset is greater than the\n\t\t\t// offset of B.\n\t\t\tif (containerA == containerB) {\n\t\t\t\tif (offsetA == offsetB) {\n\t\t\t\t\treturn 0; // equal\n\t\t\t\t}\n\n\t\t\t\tif (offsetA < offsetB) {\n\t\t\t\t\treturn -1; // before\n\t\t\t\t}\n\n\t\t\t\treturn 1; // after\n\t\t\t}\n\n\t\t\t// In the second case a child node C of the container of A is an ancestor\n\t\t\t// container of B. In this case, A is before B if the offset of A is less than or\n\t\t\t// equal to the index of the child node C and A is after B otherwise.\n\t\t\tc = containerB;\n\t\t\twhile (c && c.parentNode != containerA) {\n\t\t\t\tc = c.parentNode;\n\t\t\t}\n\n\t\t\tif (c) {\n\t\t\t\toffsetC = 0;\n\t\t\t\tn = containerA.firstChild;\n\n\t\t\t\twhile (n != c && offsetC < offsetA) {\n\t\t\t\t\toffsetC++;\n\t\t\t\t\tn = n.nextSibling;\n\t\t\t\t}\n\n\t\t\t\tif (offsetA <= offsetC) {\n\t\t\t\t\treturn -1; // before\n\t\t\t\t}\n\n\t\t\t\treturn 1; // after\n\t\t\t}\n\n\t\t\t// In the third case a child node C of the container of B is an ancestor container\n\t\t\t// of A. In this case, A is before B if the index of the child node C is less than\n\t\t\t// the offset of B and A is after B otherwise.\n\t\t\tc = containerA;\n\t\t\twhile (c && c.parentNode != containerB) {\n\t\t\t\tc = c.parentNode;\n\t\t\t}\n\n\t\t\tif (c) {\n\t\t\t\toffsetC = 0;\n\t\t\t\tn = containerB.firstChild;\n\n\t\t\t\twhile (n != c && offsetC < offsetB) {\n\t\t\t\t\toffsetC++;\n\t\t\t\t\tn = n.nextSibling;\n\t\t\t\t}\n\n\t\t\t\tif (offsetC < offsetB) {\n\t\t\t\t\treturn -1; // before\n\t\t\t\t}\n\n\t\t\t\treturn 1; // after\n\t\t\t}\n\n\t\t\t// In the fourth case, none of three other cases hold: the containers of A and B\n\t\t\t// are siblings or descendants of sibling nodes. In this case, A is before B if\n\t\t\t// the container of A is before the container of B in a pre-order traversal of the\n\t\t\t// Ranges' context tree and A is after B otherwise.\n\t\t\tcmnRoot = dom.findCommonAncestor(containerA, containerB);\n\t\t\tchildA = containerA;\n\n\t\t\twhile (childA && childA.parentNode != cmnRoot) {\n\t\t\t\tchildA = childA.parentNode;\n\t\t\t}\n\n\t\t\tif (!childA) {\n\t\t\t\tchildA = cmnRoot;\n\t\t\t}\n\n\t\t\tchildB = containerB;\n\t\t\twhile (childB && childB.parentNode != cmnRoot) {\n\t\t\t\tchildB = childB.parentNode;\n\t\t\t}\n\n\t\t\tif (!childB) {\n\t\t\t\tchildB = cmnRoot;\n\t\t\t}\n\n\t\t\tif (childA == childB) {\n\t\t\t\treturn 0; // equal\n\t\t\t}\n\n\t\t\tn = cmnRoot.firstChild;\n\t\t\twhile (n) {\n\t\t\t\tif (n == childA) {\n\t\t\t\t\treturn -1; // before\n\t\t\t\t}\n\n\t\t\t\tif (n == childB) {\n\t\t\t\t\treturn 1; // after\n\t\t\t\t}\n\n\t\t\t\tn = n.nextSibling;\n\t\t\t}\n\t\t}\n\n\t\tfunction _setEndPoint(st, n, o) {\n\t\t\tvar ec, sc;\n\n\t\t\tif (st) {\n\t\t\t\tself[START_CONTAINER] = n;\n\t\t\t\tself[START_OFFSET] = o;\n\t\t\t} else {\n\t\t\t\tself[END_CONTAINER] = n;\n\t\t\t\tself[END_OFFSET] = o;\n\t\t\t}\n\n\t\t\t// If one boundary-point of a Range is set to have a root container\n\t\t\t// other than the current one for the Range, the Range is collapsed to\n\t\t\t// the new position. This enforces the restriction that both boundary-\n\t\t\t// points of a Range must have the same root container.\n\t\t\tec = self[END_CONTAINER];\n\t\t\twhile (ec.parentNode) {\n\t\t\t\tec = ec.parentNode;\n\t\t\t}\n\n\t\t\tsc = self[START_CONTAINER];\n\t\t\twhile (sc.parentNode) {\n\t\t\t\tsc = sc.parentNode;\n\t\t\t}\n\n\t\t\tif (sc == ec) {\n\t\t\t\t// The start position of a Range is guaranteed to never be after the\n\t\t\t\t// end position. To enforce this restriction, if the start is set to\n\t\t\t\t// be at a position after the end, the Range is collapsed to that\n\t\t\t\t// position.\n\t\t\t\tif (_compareBoundaryPoints(self[START_CONTAINER], self[START_OFFSET], self[END_CONTAINER], self[END_OFFSET]) > 0) {\n\t\t\t\t\tself.collapse(st);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tself.collapse(st);\n\t\t\t}\n\n\t\t\tself.collapsed = _isCollapsed();\n\t\t\tself.commonAncestorContainer = dom.findCommonAncestor(self[START_CONTAINER], self[END_CONTAINER]);\n\t\t}\n\n\t\tfunction _traverse(how) {\n\t\t\tvar c, endContainerDepth = 0, startContainerDepth = 0, p, depthDiff, startNode, endNode, sp, ep;\n\n\t\t\tif (self[START_CONTAINER] == self[END_CONTAINER]) {\n\t\t\t\treturn _traverseSameContainer(how);\n\t\t\t}\n\n\t\t\tfor (c = self[END_CONTAINER], p = c.parentNode; p; c = p, p = p.parentNode) {\n\t\t\t\tif (p == self[START_CONTAINER]) {\n\t\t\t\t\treturn _traverseCommonStartContainer(c, how);\n\t\t\t\t}\n\n\t\t\t\t++endContainerDepth;\n\t\t\t}\n\n\t\t\tfor (c = self[START_CONTAINER], p = c.parentNode; p; c = p, p = p.parentNode) {\n\t\t\t\tif (p == self[END_CONTAINER]) {\n\t\t\t\t\treturn _traverseCommonEndContainer(c, how);\n\t\t\t\t}\n\n\t\t\t\t++startContainerDepth;\n\t\t\t}\n\n\t\t\tdepthDiff = startContainerDepth - endContainerDepth;\n\n\t\t\tstartNode = self[START_CONTAINER];\n\t\t\twhile (depthDiff > 0) {\n\t\t\t\tstartNode = startNode.parentNode;\n\t\t\t\tdepthDiff--;\n\t\t\t}\n\n\t\t\tendNode = self[END_CONTAINER];\n\t\t\twhile (depthDiff < 0) {\n\t\t\t\tendNode = endNode.parentNode;\n\t\t\t\tdepthDiff++;\n\t\t\t}\n\n\t\t\t// ascend the ancestor hierarchy until we have a common parent.\n\t\t\tfor (sp = startNode.parentNode, ep = endNode.parentNode; sp != ep; sp = sp.parentNode, ep = ep.parentNode) {\n\t\t\t\tstartNode = sp;\n\t\t\t\tendNode = ep;\n\t\t\t}\n\n\t\t\treturn _traverseCommonAncestors(startNode, endNode, how);\n\t\t}\n\n\t\tfunction _traverseSameContainer(how) {\n\t\t\tvar frag, s, sub, n, cnt, sibling, xferNode, start, len;\n\n\t\t\tif (how != DELETE) {\n\t\t\t\tfrag = createDocumentFragment();\n\t\t\t}\n\n\t\t\t// If selection is empty, just return the fragment\n\t\t\tif (self[START_OFFSET] == self[END_OFFSET]) {\n\t\t\t\treturn frag;\n\t\t\t}\n\n\t\t\t// Text node needs special case handling\n\t\t\tif (self[START_CONTAINER].nodeType == 3) { // TEXT_NODE\n\t\t\t\t// get the substring\n\t\t\t\ts = self[START_CONTAINER].nodeValue;\n\t\t\t\tsub = s.substring(self[START_OFFSET], self[END_OFFSET]);\n\n\t\t\t\t// set the original text node to its new value\n\t\t\t\tif (how != CLONE) {\n\t\t\t\t\tn = self[START_CONTAINER];\n\t\t\t\t\tstart = self[START_OFFSET];\n\t\t\t\t\tlen = self[END_OFFSET] - self[START_OFFSET];\n\n\t\t\t\t\tif (start === 0 && len >= n.nodeValue.length - 1) {\n\t\t\t\t\t\tn.parentNode.removeChild(n);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tn.deleteData(start, len);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Nothing is partially selected, so collapse to start point\n\t\t\t\t\tself.collapse(TRUE);\n\t\t\t\t}\n\n\t\t\t\tif (how == DELETE) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (sub.length > 0) {\n\t\t\t\t\tfrag.appendChild(doc.createTextNode(sub));\n\t\t\t\t}\n\n\t\t\t\treturn frag;\n\t\t\t}\n\n\t\t\t// Copy nodes between the start/end offsets.\n\t\t\tn = _getSelectedNode(self[START_CONTAINER], self[START_OFFSET]);\n\t\t\tcnt = self[END_OFFSET] - self[START_OFFSET];\n\n\t\t\twhile (n && cnt > 0) {\n\t\t\t\tsibling = n.nextSibling;\n\t\t\t\txferNode = _traverseFullySelected(n, how);\n\n\t\t\t\tif (frag) {\n\t\t\t\t\tfrag.appendChild(xferNode);\n\t\t\t\t}\n\n\t\t\t\t--cnt;\n\t\t\t\tn = sibling;\n\t\t\t}\n\n\t\t\t// Nothing is partially selected, so collapse to start point\n\t\t\tif (how != CLONE) {\n\t\t\t\tself.collapse(TRUE);\n\t\t\t}\n\n\t\t\treturn frag;\n\t\t}\n\n\t\tfunction _traverseCommonStartContainer(endAncestor, how) {\n\t\t\tvar frag, n, endIdx, cnt, sibling, xferNode;\n\n\t\t\tif (how != DELETE) {\n\t\t\t\tfrag = createDocumentFragment();\n\t\t\t}\n\n\t\t\tn = _traverseRightBoundary(endAncestor, how);\n\n\t\t\tif (frag) {\n\t\t\t\tfrag.appendChild(n);\n\t\t\t}\n\n\t\t\tendIdx = nodeIndex(endAncestor);\n\t\t\tcnt = endIdx - self[START_OFFSET];\n\n\t\t\tif (cnt <= 0) {\n\t\t\t\t// Collapse to just before the endAncestor, which\n\t\t\t\t// is partially selected.\n\t\t\t\tif (how != CLONE) {\n\t\t\t\t\tself.setEndBefore(endAncestor);\n\t\t\t\t\tself.collapse(FALSE);\n\t\t\t\t}\n\n\t\t\t\treturn frag;\n\t\t\t}\n\n\t\t\tn = endAncestor.previousSibling;\n\t\t\twhile (cnt > 0) {\n\t\t\t\tsibling = n.previousSibling;\n\t\t\t\txferNode = _traverseFullySelected(n, how);\n\n\t\t\t\tif (frag) {\n\t\t\t\t\tfrag.insertBefore(xferNode, frag.firstChild);\n\t\t\t\t}\n\n\t\t\t\t--cnt;\n\t\t\t\tn = sibling;\n\t\t\t}\n\n\t\t\t// Collapse to just before the endAncestor, which\n\t\t\t// is partially selected.\n\t\t\tif (how != CLONE) {\n\t\t\t\tself.setEndBefore(endAncestor);\n\t\t\t\tself.collapse(FALSE);\n\t\t\t}\n\n\t\t\treturn frag;\n\t\t}\n\n\t\tfunction _traverseCommonEndContainer(startAncestor, how) {\n\t\t\tvar frag, startIdx, n, cnt, sibling, xferNode;\n\n\t\t\tif (how != DELETE) {\n\t\t\t\tfrag = createDocumentFragment();\n\t\t\t}\n\n\t\t\tn = _traverseLeftBoundary(startAncestor, how);\n\t\t\tif (frag) {\n\t\t\t\tfrag.appendChild(n);\n\t\t\t}\n\n\t\t\tstartIdx = nodeIndex(startAncestor);\n\t\t\t++startIdx; // Because we already traversed it\n\n\t\t\tcnt = self[END_OFFSET] - startIdx;\n\t\t\tn = startAncestor.nextSibling;\n\t\t\twhile (n && cnt > 0) {\n\t\t\t\tsibling = n.nextSibling;\n\t\t\t\txferNode = _traverseFullySelected(n, how);\n\n\t\t\t\tif (frag) {\n\t\t\t\t\tfrag.appendChild(xferNode);\n\t\t\t\t}\n\n\t\t\t\t--cnt;\n\t\t\t\tn = sibling;\n\t\t\t}\n\n\t\t\tif (how != CLONE) {\n\t\t\t\tself.setStartAfter(startAncestor);\n\t\t\t\tself.collapse(TRUE);\n\t\t\t}\n\n\t\t\treturn frag;\n\t\t}\n\n\t\tfunction _traverseCommonAncestors(startAncestor, endAncestor, how) {\n\t\t\tvar n, frag, startOffset, endOffset, cnt, sibling, nextSibling;\n\n\t\t\tif (how != DELETE) {\n\t\t\t\tfrag = createDocumentFragment();\n\t\t\t}\n\n\t\t\tn = _traverseLeftBoundary(startAncestor, how);\n\t\t\tif (frag) {\n\t\t\t\tfrag.appendChild(n);\n\t\t\t}\n\n\t\t\tstartOffset = nodeIndex(startAncestor);\n\t\t\tendOffset = nodeIndex(endAncestor);\n\t\t\t++startOffset;\n\n\t\t\tcnt = endOffset - startOffset;\n\t\t\tsibling = startAncestor.nextSibling;\n\n\t\t\twhile (cnt > 0) {\n\t\t\t\tnextSibling = sibling.nextSibling;\n\t\t\t\tn = _traverseFullySelected(sibling, how);\n\n\t\t\t\tif (frag) {\n\t\t\t\t\tfrag.appendChild(n);\n\t\t\t\t}\n\n\t\t\t\tsibling = nextSibling;\n\t\t\t\t--cnt;\n\t\t\t}\n\n\t\t\tn = _traverseRightBoundary(endAncestor, how);\n\n\t\t\tif (frag) {\n\t\t\t\tfrag.appendChild(n);\n\t\t\t}\n\n\t\t\tif (how != CLONE) {\n\t\t\t\tself.setStartAfter(startAncestor);\n\t\t\t\tself.collapse(TRUE);\n\t\t\t}\n\n\t\t\treturn frag;\n\t\t}\n\n\t\tfunction _traverseRightBoundary(root, how) {\n\t\t\tvar next = _getSelectedNode(self[END_CONTAINER], self[END_OFFSET] - 1), parent, clonedParent;\n\t\t\tvar prevSibling, clonedChild, clonedGrandParent, isFullySelected = next != self[END_CONTAINER];\n\n\t\t\tif (next == root) {\n\t\t\t\treturn _traverseNode(next, isFullySelected, FALSE, how);\n\t\t\t}\n\n\t\t\tparent = next.parentNode;\n\t\t\tclonedParent = _traverseNode(parent, FALSE, FALSE, how);\n\n\t\t\twhile (parent) {\n\t\t\t\twhile (next) {\n\t\t\t\t\tprevSibling = next.previousSibling;\n\t\t\t\t\tclonedChild = _traverseNode(next, isFullySelected, FALSE, how);\n\n\t\t\t\t\tif (how != DELETE) {\n\t\t\t\t\t\tclonedParent.insertBefore(clonedChild, clonedParent.firstChild);\n\t\t\t\t\t}\n\n\t\t\t\t\tisFullySelected = TRUE;\n\t\t\t\t\tnext = prevSibling;\n\t\t\t\t}\n\n\t\t\t\tif (parent == root) {\n\t\t\t\t\treturn clonedParent;\n\t\t\t\t}\n\n\t\t\t\tnext = parent.previousSibling;\n\t\t\t\tparent = parent.parentNode;\n\n\t\t\t\tclonedGrandParent = _traverseNode(parent, FALSE, FALSE, how);\n\n\t\t\t\tif (how != DELETE) {\n\t\t\t\t\tclonedGrandParent.appendChild(clonedParent);\n\t\t\t\t}\n\n\t\t\t\tclonedParent = clonedGrandParent;\n\t\t\t}\n\t\t}\n\n\t\tfunction _traverseLeftBoundary(root, how) {\n\t\t\tvar next = _getSelectedNode(self[START_CONTAINER], self[START_OFFSET]), isFullySelected = next != self[START_CONTAINER];\n\t\t\tvar parent, clonedParent, nextSibling, clonedChild, clonedGrandParent;\n\n\t\t\tif (next == root) {\n\t\t\t\treturn _traverseNode(next, isFullySelected, TRUE, how);\n\t\t\t}\n\n\t\t\tparent = next.parentNode;\n\t\t\tclonedParent = _traverseNode(parent, FALSE, TRUE, how);\n\n\t\t\twhile (parent) {\n\t\t\t\twhile (next) {\n\t\t\t\t\tnextSibling = next.nextSibling;\n\t\t\t\t\tclonedChild = _traverseNode(next, isFullySelected, TRUE, how);\n\n\t\t\t\t\tif (how != DELETE) {\n\t\t\t\t\t\tclonedParent.appendChild(clonedChild);\n\t\t\t\t\t}\n\n\t\t\t\t\tisFullySelected = TRUE;\n\t\t\t\t\tnext = nextSibling;\n\t\t\t\t}\n\n\t\t\t\tif (parent == root) {\n\t\t\t\t\treturn clonedParent;\n\t\t\t\t}\n\n\t\t\t\tnext = parent.nextSibling;\n\t\t\t\tparent = parent.parentNode;\n\n\t\t\t\tclonedGrandParent = _traverseNode(parent, FALSE, TRUE, how);\n\n\t\t\t\tif (how != DELETE) {\n\t\t\t\t\tclonedGrandParent.appendChild(clonedParent);\n\t\t\t\t}\n\n\t\t\t\tclonedParent = clonedGrandParent;\n\t\t\t}\n\t\t}\n\n\t\tfunction _traverseNode(n, isFullySelected, isLeft, how) {\n\t\t\tvar txtValue, newNodeValue, oldNodeValue, offset, newNode;\n\n\t\t\tif (isFullySelected) {\n\t\t\t\treturn _traverseFullySelected(n, how);\n\t\t\t}\n\n\t\t\t// TEXT_NODE\n\t\t\tif (n.nodeType == 3) {\n\t\t\t\ttxtValue = n.nodeValue;\n\n\t\t\t\tif (isLeft) {\n\t\t\t\t\toffset = self[START_OFFSET];\n\t\t\t\t\tnewNodeValue = txtValue.substring(offset);\n\t\t\t\t\toldNodeValue = txtValue.substring(0, offset);\n\t\t\t\t} else {\n\t\t\t\t\toffset = self[END_OFFSET];\n\t\t\t\t\tnewNodeValue = txtValue.substring(0, offset);\n\t\t\t\t\toldNodeValue = txtValue.substring(offset);\n\t\t\t\t}\n\n\t\t\t\tif (how != CLONE) {\n\t\t\t\t\tn.nodeValue = oldNodeValue;\n\t\t\t\t}\n\n\t\t\t\tif (how == DELETE) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tnewNode = dom.clone(n, FALSE);\n\t\t\t\tnewNode.nodeValue = newNodeValue;\n\n\t\t\t\treturn newNode;\n\t\t\t}\n\n\t\t\tif (how == DELETE) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treturn dom.clone(n, FALSE);\n\t\t}\n\n\t\tfunction _traverseFullySelected(n, how) {\n\t\t\tif (how != DELETE) {\n\t\t\t\treturn how == CLONE ? dom.clone(n, TRUE) : n;\n\t\t\t}\n\n\t\t\tn.parentNode.removeChild(n);\n\t\t}\n\n\t\tfunction toStringIE() {\n\t\t\treturn dom.create('body', null, cloneContents()).outerText;\n\t\t}\n\n\t\textend(self, {\n\t\t\t// Initial states\n\t\t\tstartContainer: doc,\n\t\t\tstartOffset: 0,\n\t\t\tendContainer: doc,\n\t\t\tendOffset: 0,\n\t\t\tcollapsed: TRUE,\n\t\t\tcommonAncestorContainer: doc,\n\n\t\t\t// Range constants\n\t\t\tSTART_TO_START: 0,\n\t\t\tSTART_TO_END: 1,\n\t\t\tEND_TO_END: 2,\n\t\t\tEND_TO_START: 3,\n\n\t\t\t// Public methods\n\t\t\tsetStart: setStart,\n\t\t\tsetEnd: setEnd,\n\t\t\tsetStartBefore: setStartBefore,\n\t\t\tsetStartAfter: setStartAfter,\n\t\t\tsetEndBefore: setEndBefore,\n\t\t\tsetEndAfter: setEndAfter,\n\t\t\tcollapse: collapse,\n\t\t\tselectNode: selectNode,\n\t\t\tselectNodeContents: selectNodeContents,\n\t\t\tcompareBoundaryPoints: compareBoundaryPoints,\n\t\t\tdeleteContents: deleteContents,\n\t\t\textractContents: extractContents,\n\t\t\tcloneContents: cloneContents,\n\t\t\tinsertNode: insertNode,\n\t\t\tsurroundContents: surroundContents,\n\t\t\tcloneRange: cloneRange,\n\t\t\ttoStringIE: toStringIE\n\t\t});\n\n\t\treturn self;\n\t}\n\n\t// Older IE versions doesn't let you override toString by it's constructor so we have to stick it in the prototype\n\tRange.prototype.toString = function() {\n\t\treturn this.toStringIE();\n\t};\n\n\treturn Range;\n});\n\n// Included from: js/tinymce/classes/html/Entities.js\n\n/**\n * Entities.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/*jshint bitwise:false */\n/*eslint no-bitwise:0 */\n\n/**\n * Entity encoder class.\n *\n * @class tinymce.html.Entities\n * @static\n * @version 3.4\n */\ndefine(\"tinymce/html/Entities\", [\n\t\"tinymce/util/Tools\"\n], function(Tools) {\n\tvar makeMap = Tools.makeMap;\n\n\tvar namedEntities, baseEntities, reverseEntities,\n\t\tattrsCharsRegExp = /[&<>\\\"\\u0060\\u007E-\\uD7FF\\uE000-\\uFFEF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/g,\n\t\ttextCharsRegExp = /[<>&\\u007E-\\uD7FF\\uE000-\\uFFEF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/g,\n\t\trawCharsRegExp = /[<>&\\\"\\']/g,\n\t\tentityRegExp = /&#([a-z0-9]+);?|&([a-z0-9]+);/gi,\n\t\tasciiMap = {\n\t\t\t128: \"\\u20AC\", 130: \"\\u201A\", 131: \"\\u0192\", 132: \"\\u201E\", 133: \"\\u2026\", 134: \"\\u2020\",\n\t\t\t135: \"\\u2021\", 136: \"\\u02C6\", 137: \"\\u2030\", 138: \"\\u0160\", 139: \"\\u2039\", 140: \"\\u0152\",\n\t\t\t142: \"\\u017D\", 145: \"\\u2018\", 146: \"\\u2019\", 147: \"\\u201C\", 148: \"\\u201D\", 149: \"\\u2022\",\n\t\t\t150: \"\\u2013\", 151: \"\\u2014\", 152: \"\\u02DC\", 153: \"\\u2122\", 154: \"\\u0161\", 155: \"\\u203A\",\n\t\t\t156: \"\\u0153\", 158: \"\\u017E\", 159: \"\\u0178\"\n\t\t};\n\n\t// Raw entities\n\tbaseEntities = {\n\t\t'\\\"': '&quot;', // Needs to be escaped since the YUI compressor would otherwise break the code\n\t\t\"'\": '&#39;',\n\t\t'<': '&lt;',\n\t\t'>': '&gt;',\n\t\t'&': '&amp;',\n\t\t'\\u0060': '&#96;'\n\t};\n\n\t// Reverse lookup table for raw entities\n\treverseEntities = {\n\t\t'&lt;': '<',\n\t\t'&gt;': '>',\n\t\t'&amp;': '&',\n\t\t'&quot;': '\"',\n\t\t'&apos;': \"'\"\n\t};\n\n\t// Decodes text by using the browser\n\tfunction nativeDecode(text) {\n\t\tvar elm;\n\n\t\telm = document.createElement(\"div\");\n\t\telm.innerHTML = text;\n\n\t\treturn elm.textContent || elm.innerText || text;\n\t}\n\n\t// Build a two way lookup table for the entities\n\tfunction buildEntitiesLookup(items, radix) {\n\t\tvar i, chr, entity, lookup = {};\n\n\t\tif (items) {\n\t\t\titems = items.split(',');\n\t\t\tradix = radix || 10;\n\n\t\t\t// Build entities lookup table\n\t\t\tfor (i = 0; i < items.length; i += 2) {\n\t\t\t\tchr = String.fromCharCode(parseInt(items[i], radix));\n\n\t\t\t\t// Only add non base entities\n\t\t\t\tif (!baseEntities[chr]) {\n\t\t\t\t\tentity = '&' + items[i + 1] + ';';\n\t\t\t\t\tlookup[chr] = entity;\n\t\t\t\t\tlookup[entity] = chr;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn lookup;\n\t\t}\n\t}\n\n\t// Unpack entities lookup where the numbers are in radix 32 to reduce the size\n\tnamedEntities = buildEntitiesLookup(\n\t\t'50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,' +\n\t\t'5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,' +\n\t\t'5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,' +\n\t\t'5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,' +\n\t\t'68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,' +\n\t\t'6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,' +\n\t\t'6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,' +\n\t\t'75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,' +\n\t\t'7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,' +\n\t\t'7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,' +\n\t\t'sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,' +\n\t\t'st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,' +\n\t\t't9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,' +\n\t\t'tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,' +\n\t\t'u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,' +\n\t\t'81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,' +\n\t\t'8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,' +\n\t\t'8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,' +\n\t\t'8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,' +\n\t\t'8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,' +\n\t\t'nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,' +\n\t\t'rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,' +\n\t\t'Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,' +\n\t\t'80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,' +\n\t\t'811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro', 32);\n\n\tvar Entities = {\n\t\t/**\n\t\t * Encodes the specified string using raw entities. This means only the required XML base entities will be encoded.\n\t\t *\n\t\t * @method encodeRaw\n\t\t * @param {String} text Text to encode.\n\t\t * @param {Boolean} attr Optional flag to specify if the text is attribute contents.\n\t\t * @return {String} Entity encoded text.\n\t\t */\n\t\tencodeRaw: function(text, attr) {\n\t\t\treturn text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function(chr) {\n\t\t\t\treturn baseEntities[chr] || chr;\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Encoded the specified text with both the attributes and text entities. This function will produce larger text contents\n\t\t * since it doesn't know if the context is within a attribute or text node. This was added for compatibility\n\t\t * and is exposed as the DOMUtils.encode function.\n\t\t *\n\t\t * @method encodeAllRaw\n\t\t * @param {String} text Text to encode.\n\t\t * @return {String} Entity encoded text.\n\t\t */\n\t\tencodeAllRaw: function(text) {\n\t\t\treturn ('' + text).replace(rawCharsRegExp, function(chr) {\n\t\t\t\treturn baseEntities[chr] || chr;\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Encodes the specified string using numeric entities. The core entities will be\n\t\t * encoded as named ones but all non lower ascii characters will be encoded into numeric entities.\n\t\t *\n\t\t * @method encodeNumeric\n\t\t * @param {String} text Text to encode.\n\t\t * @param {Boolean} attr Optional flag to specify if the text is attribute contents.\n\t\t * @return {String} Entity encoded text.\n\t\t */\n\t\tencodeNumeric: function(text, attr) {\n\t\t\treturn text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function(chr) {\n\t\t\t\t// Multi byte sequence convert it to a single entity\n\t\t\t\tif (chr.length > 1) {\n\t\t\t\t\treturn '&#' + (((chr.charCodeAt(0) - 0xD800) * 0x400) + (chr.charCodeAt(1) - 0xDC00) + 0x10000) + ';';\n\t\t\t\t}\n\n\t\t\t\treturn baseEntities[chr] || '&#' + chr.charCodeAt(0) + ';';\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Encodes the specified string using named entities. The core entities will be encoded\n\t\t * as named ones but all non lower ascii characters will be encoded into named entities.\n\t\t *\n\t\t * @method encodeNamed\n\t\t * @param {String} text Text to encode.\n\t\t * @param {Boolean} attr Optional flag to specify if the text is attribute contents.\n\t\t * @param {Object} entities Optional parameter with entities to use.\n\t\t * @return {String} Entity encoded text.\n\t\t */\n\t\tencodeNamed: function(text, attr, entities) {\n\t\t\tentities = entities || namedEntities;\n\n\t\t\treturn text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function(chr) {\n\t\t\t\treturn baseEntities[chr] || entities[chr] || chr;\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Returns an encode function based on the name(s) and it's optional entities.\n\t\t *\n\t\t * @method getEncodeFunc\n\t\t * @param {String} name Comma separated list of encoders for example named,numeric.\n\t\t * @param {String} entities Optional parameter with entities to use instead of the built in set.\n\t\t * @return {function} Encode function to be used.\n\t\t */\n\t\tgetEncodeFunc: function(name, entities) {\n\t\t\tentities = buildEntitiesLookup(entities) || namedEntities;\n\n\t\t\tfunction encodeNamedAndNumeric(text, attr) {\n\t\t\t\treturn text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function(chr) {\n\t\t\t\t\treturn baseEntities[chr] || entities[chr] || '&#' + chr.charCodeAt(0) + ';' || chr;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction encodeCustomNamed(text, attr) {\n\t\t\t\treturn Entities.encodeNamed(text, attr, entities);\n\t\t\t}\n\n\t\t\t// Replace + with , to be compatible with previous TinyMCE versions\n\t\t\tname = makeMap(name.replace(/\\+/g, ','));\n\n\t\t\t// Named and numeric encoder\n\t\t\tif (name.named && name.numeric) {\n\t\t\t\treturn encodeNamedAndNumeric;\n\t\t\t}\n\n\t\t\t// Named encoder\n\t\t\tif (name.named) {\n\t\t\t\t// Custom names\n\t\t\t\tif (entities) {\n\t\t\t\t\treturn encodeCustomNamed;\n\t\t\t\t}\n\n\t\t\t\treturn Entities.encodeNamed;\n\t\t\t}\n\n\t\t\t// Numeric\n\t\t\tif (name.numeric) {\n\t\t\t\treturn Entities.encodeNumeric;\n\t\t\t}\n\n\t\t\t// Raw encoder\n\t\t\treturn Entities.encodeRaw;\n\t\t},\n\n\t\t/**\n\t\t * Decodes the specified string, this will replace entities with raw UTF characters.\n\t\t *\n\t\t * @method decode\n\t\t * @param {String} text Text to entity decode.\n\t\t * @return {String} Entity decoded string.\n\t\t */\n\t\tdecode: function(text) {\n\t\t\treturn text.replace(entityRegExp, function(all, numeric) {\n\t\t\t\tif (numeric) {\n\t\t\t\t\tif (numeric.charAt(0).toLowerCase() === 'x') {\n\t\t\t\t\t\tnumeric = parseInt(numeric.substr(1), 16);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnumeric = parseInt(numeric, 10);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Support upper UTF\n\t\t\t\t\tif (numeric > 0xFFFF) {\n\t\t\t\t\t\tnumeric -= 0x10000;\n\n\t\t\t\t\t\treturn String.fromCharCode(0xD800 + (numeric >> 10), 0xDC00 + (numeric & 0x3FF));\n\t\t\t\t\t}\n\n\t\t\t\t\treturn asciiMap[numeric] || String.fromCharCode(numeric);\n\t\t\t\t}\n\n\t\t\t\treturn reverseEntities[all] || namedEntities[all] || nativeDecode(all);\n\t\t\t});\n\t\t}\n\t};\n\n\treturn Entities;\n});\n\n// Included from: js/tinymce/classes/dom/StyleSheetLoader.js\n\n/**\n * StyleSheetLoader.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class handles loading of external stylesheets and fires events when these are loaded.\n *\n * @class tinymce.dom.StyleSheetLoader\n * @private\n */\ndefine(\"tinymce/dom/StyleSheetLoader\", [\n\t\"tinymce/util/Tools\",\n\t\"tinymce/util/Delay\"\n], function(Tools, Delay) {\n\t\"use strict\";\n\n\treturn function(document, settings) {\n\t\tvar idCount = 0, loadedStates = {}, maxLoadTime;\n\n\t\tsettings = settings || {};\n\t\tmaxLoadTime = settings.maxLoadTime || 5000;\n\n\t\tfunction appendToHead(node) {\n\t\t\tdocument.getElementsByTagName('head')[0].appendChild(node);\n\t\t}\n\n\t\t/**\n\t\t * Loads the specified css style sheet file and call the loadedCallback once it's finished loading.\n\t\t *\n\t\t * @method load\n\t\t * @param {String} url Url to be loaded.\n\t\t * @param {Function} loadedCallback Callback to be executed when loaded.\n\t\t * @param {Function} errorCallback Callback to be executed when failed loading.\n\t\t */\n\t\tfunction load(url, loadedCallback, errorCallback) {\n\t\t\tvar link, style, startTime, state;\n\n\t\t\tfunction passed() {\n\t\t\t\tvar callbacks = state.passed, i = callbacks.length;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tcallbacks[i]();\n\t\t\t\t}\n\n\t\t\t\tstate.status = 2;\n\t\t\t\tstate.passed = [];\n\t\t\t\tstate.failed = [];\n\t\t\t}\n\n\t\t\tfunction failed() {\n\t\t\t\tvar callbacks = state.failed, i = callbacks.length;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tcallbacks[i]();\n\t\t\t\t}\n\n\t\t\t\tstate.status = 3;\n\t\t\t\tstate.passed = [];\n\t\t\t\tstate.failed = [];\n\t\t\t}\n\n\t\t\t// Sniffs for older WebKit versions that have the link.onload but a broken one\n\t\t\tfunction isOldWebKit() {\n\t\t\t\tvar webKitChunks = navigator.userAgent.match(/WebKit\\/(\\d*)/);\n\t\t\t\treturn !!(webKitChunks && webKitChunks[1] < 536);\n\t\t\t}\n\n\t\t\t// Calls the waitCallback until the test returns true or the timeout occurs\n\t\t\tfunction wait(testCallback, waitCallback) {\n\t\t\t\tif (!testCallback()) {\n\t\t\t\t\t// Wait for timeout\n\t\t\t\t\tif ((new Date().getTime()) - startTime < maxLoadTime) {\n\t\t\t\t\t\tDelay.setTimeout(waitCallback);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfailed();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Workaround for WebKit that doesn't properly support the onload event for link elements\n\t\t\t// Or WebKit that fires the onload event before the StyleSheet is added to the document\n\t\t\tfunction waitForWebKitLinkLoaded() {\n\t\t\t\twait(function() {\n\t\t\t\t\tvar styleSheets = document.styleSheets, styleSheet, i = styleSheets.length, owner;\n\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tstyleSheet = styleSheets[i];\n\t\t\t\t\t\towner = styleSheet.ownerNode ? styleSheet.ownerNode : styleSheet.owningElement;\n\t\t\t\t\t\tif (owner && owner.id === link.id) {\n\t\t\t\t\t\t\tpassed();\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}, waitForWebKitLinkLoaded);\n\t\t\t}\n\n\t\t\t// Workaround for older Geckos that doesn't have any onload event for StyleSheets\n\t\t\tfunction waitForGeckoLinkLoaded() {\n\t\t\t\twait(function() {\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// Accessing the cssRules will throw an exception until the CSS file is loaded\n\t\t\t\t\t\tvar cssRules = style.sheet.cssRules;\n\t\t\t\t\t\tpassed();\n\t\t\t\t\t\treturn !!cssRules;\n\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t// Ignore\n\t\t\t\t\t}\n\t\t\t\t}, waitForGeckoLinkLoaded);\n\t\t\t}\n\n\t\t\turl = Tools._addCacheSuffix(url);\n\n\t\t\tif (!loadedStates[url]) {\n\t\t\t\tstate = {\n\t\t\t\t\tpassed: [],\n\t\t\t\t\tfailed: []\n\t\t\t\t};\n\n\t\t\t\tloadedStates[url] = state;\n\t\t\t} else {\n\t\t\t\tstate = loadedStates[url];\n\t\t\t}\n\n\t\t\tif (loadedCallback) {\n\t\t\t\tstate.passed.push(loadedCallback);\n\t\t\t}\n\n\t\t\tif (errorCallback) {\n\t\t\t\tstate.failed.push(errorCallback);\n\t\t\t}\n\n\t\t\t// Is loading wait for it to pass\n\t\t\tif (state.status == 1) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Has finished loading and was success\n\t\t\tif (state.status == 2) {\n\t\t\t\tpassed();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Has finished loading and was a failure\n\t\t\tif (state.status == 3) {\n\t\t\t\tfailed();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Start loading\n\t\t\tstate.status = 1;\n\t\t\tlink = document.createElement('link');\n\t\t\tlink.rel = 'stylesheet';\n\t\t\tlink.type = 'text/css';\n\t\t\tlink.id = 'u' + (idCount++);\n\t\t\tlink.async = false;\n\t\t\tlink.defer = false;\n\t\t\tstartTime = new Date().getTime();\n\n\t\t\t// Feature detect onload on link element and sniff older webkits since it has an broken onload event\n\t\t\tif (\"onload\" in link && !isOldWebKit()) {\n\t\t\t\tlink.onload = waitForWebKitLinkLoaded;\n\t\t\t\tlink.onerror = failed;\n\t\t\t} else {\n\t\t\t\t// Sniff for old Firefox that doesn't support the onload event on link elements\n\t\t\t\t// TODO: Remove this in the future when everyone uses modern browsers\n\t\t\t\tif (navigator.userAgent.indexOf(\"Firefox\") > 0) {\n\t\t\t\t\tstyle = document.createElement('style');\n\t\t\t\t\tstyle.textContent = '@import \"' + url + '\"';\n\t\t\t\t\twaitForGeckoLinkLoaded();\n\t\t\t\t\tappendToHead(style);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Use the id owner on older webkits\n\t\t\t\twaitForWebKitLinkLoaded();\n\t\t\t}\n\n\t\t\tappendToHead(link);\n\t\t\tlink.href = url;\n\t\t}\n\n\t\tthis.load = load;\n\t};\n});\n\n// Included from: js/tinymce/classes/dom/DOMUtils.js\n\n/**\n * DOMUtils.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Utility class for various DOM manipulation and retrieval functions.\n *\n * @class tinymce.dom.DOMUtils\n * @example\n * // Add a class to an element by id in the page\n * tinymce.DOM.addClass('someid', 'someclass');\n *\n * // Add a class to an element by id inside the editor\n * tinymce.activeEditor.dom.addClass('someid', 'someclass');\n */\ndefine(\"tinymce/dom/DOMUtils\", [\n\t\"tinymce/dom/Sizzle\",\n\t\"tinymce/dom/DomQuery\",\n\t\"tinymce/html/Styles\",\n\t\"tinymce/dom/EventUtils\",\n\t\"tinymce/dom/TreeWalker\",\n\t\"tinymce/dom/Range\",\n\t\"tinymce/html/Entities\",\n\t\"tinymce/Env\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/dom/StyleSheetLoader\"\n], function(Sizzle, $, Styles, EventUtils, TreeWalker, Range, Entities, Env, Tools, StyleSheetLoader) {\n\t// Shorten names\n\tvar each = Tools.each, is = Tools.is, grep = Tools.grep, trim = Tools.trim;\n\tvar isIE = Env.ie;\n\tvar simpleSelectorRe = /^([a-z0-9],?)+$/i;\n\tvar whiteSpaceRegExp = /^[ \\t\\r\\n]*$/;\n\n\tfunction setupAttrHooks(domUtils, settings) {\n\t\tvar attrHooks = {}, keepValues = settings.keep_values, keepUrlHook;\n\n\t\tkeepUrlHook = {\n\t\t\tset: function($elm, value, name) {\n\t\t\t\tif (settings.url_converter) {\n\t\t\t\t\tvalue = settings.url_converter.call(settings.url_converter_scope || domUtils, value, name, $elm[0]);\n\t\t\t\t}\n\n\t\t\t\t$elm.attr('data-mce-' + name, value).attr(name, value);\n\t\t\t},\n\n\t\t\tget: function($elm, name) {\n\t\t\t\treturn $elm.attr('data-mce-' + name) || $elm.attr(name);\n\t\t\t}\n\t\t};\n\n\t\tattrHooks = {\n\t\t\tstyle: {\n\t\t\t\tset: function($elm, value) {\n\t\t\t\t\tif (value !== null && typeof value === 'object') {\n\t\t\t\t\t\t$elm.css(value);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (keepValues) {\n\t\t\t\t\t\t$elm.attr('data-mce-style', value);\n\t\t\t\t\t}\n\n\t\t\t\t\t$elm.attr('style', value);\n\t\t\t\t},\n\n\t\t\t\tget: function($elm) {\n\t\t\t\t\tvar value = $elm.attr('data-mce-style') || $elm.attr('style');\n\n\t\t\t\t\tvalue = domUtils.serializeStyle(domUtils.parseStyle(value), $elm[0].nodeName);\n\n\t\t\t\t\treturn value;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tif (keepValues) {\n\t\t\tattrHooks.href = attrHooks.src = keepUrlHook;\n\t\t}\n\n\t\treturn attrHooks;\n\t}\n\n\tfunction updateInternalStyleAttr(domUtils, $elm) {\n\t\tvar value = $elm.attr('style');\n\n\t\tvalue = domUtils.serializeStyle(domUtils.parseStyle(value), $elm[0].nodeName);\n\n\t\tif (!value) {\n\t\t\tvalue = null;\n\t\t}\n\n\t\t$elm.attr('data-mce-style', value);\n\t}\n\n\tfunction nodeIndex(node, normalized) {\n\t\tvar idx = 0, lastNodeType, nodeType;\n\n\t\tif (node) {\n\t\t\tfor (lastNodeType = node.nodeType, node = node.previousSibling; node; node = node.previousSibling) {\n\t\t\t\tnodeType = node.nodeType;\n\n\t\t\t\t// Normalize text nodes\n\t\t\t\tif (normalized && nodeType == 3) {\n\t\t\t\t\tif (nodeType == lastNodeType || !node.nodeValue.length) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tidx++;\n\t\t\t\tlastNodeType = nodeType;\n\t\t\t}\n\t\t}\n\n\t\treturn idx;\n\t}\n\n\t/**\n\t * Constructs a new DOMUtils instance. Consult the Wiki for more details on settings etc for this class.\n\t *\n\t * @constructor\n\t * @method DOMUtils\n\t * @param {Document} doc Document reference to bind the utility class to.\n\t * @param {settings} settings Optional settings collection.\n\t */\n\tfunction DOMUtils(doc, settings) {\n\t\tvar self = this, blockElementsMap;\n\n\t\tself.doc = doc;\n\t\tself.win = window;\n\t\tself.files = {};\n\t\tself.counter = 0;\n\t\tself.stdMode = !isIE || doc.documentMode >= 8;\n\t\tself.boxModel = !isIE || doc.compatMode == \"CSS1Compat\" || self.stdMode;\n\t\tself.styleSheetLoader = new StyleSheetLoader(doc);\n\t\tself.boundEvents = [];\n\t\tself.settings = settings = settings || {};\n\t\tself.schema = settings.schema;\n\t\tself.styles = new Styles({\n\t\t\turl_converter: settings.url_converter,\n\t\t\turl_converter_scope: settings.url_converter_scope\n\t\t}, settings.schema);\n\n\t\tself.fixDoc(doc);\n\t\tself.events = settings.ownEvents ? new EventUtils(settings.proxy) : EventUtils.Event;\n\t\tself.attrHooks = setupAttrHooks(self, settings);\n\t\tblockElementsMap = settings.schema ? settings.schema.getBlockElements() : {};\n\t\tself.$ = $.overrideDefaults(function() {\n\t\t\treturn {\n\t\t\t\tcontext: doc,\n\t\t\t\telement: self.getRoot()\n\t\t\t};\n\t\t});\n\n\t\t/**\n\t\t * Returns true/false if the specified element is a block element or not.\n\t\t *\n\t\t * @method isBlock\n\t\t * @param {Node/String} node Element/Node to check.\n\t\t * @return {Boolean} True/False state if the node is a block element or not.\n\t\t */\n\t\tself.isBlock = function(node) {\n\t\t\t// Fix for #5446\n\t\t\tif (!node) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// This function is called in module pattern style since it might be executed with the wrong this scope\n\t\t\tvar type = node.nodeType;\n\n\t\t\t// If it's a node then check the type and use the nodeName\n\t\t\tif (type) {\n\t\t\t\treturn !!(type === 1 && blockElementsMap[node.nodeName]);\n\t\t\t}\n\n\t\t\treturn !!blockElementsMap[node];\n\t\t};\n\t}\n\n\tDOMUtils.prototype = {\n\t\t$$: function(elm) {\n\t\t\tif (typeof elm == 'string') {\n\t\t\t\telm = this.get(elm);\n\t\t\t}\n\n\t\t\treturn this.$(elm);\n\t\t},\n\n\t\troot: null,\n\n\t\tfixDoc: function(doc) {\n\t\t\tvar settings = this.settings, name;\n\n\t\t\tif (isIE && settings.schema) {\n\t\t\t\t// Add missing HTML 4/5 elements to IE\n\t\t\t\t('abbr article aside audio canvas ' +\n\t\t\t\t'details figcaption figure footer ' +\n\t\t\t\t'header hgroup mark menu meter nav ' +\n\t\t\t\t'output progress section summary ' +\n\t\t\t\t'time video').replace(/\\w+/g, function(name) {\n\t\t\t\t\tdoc.createElement(name);\n\t\t\t\t});\n\n\t\t\t\t// Create all custom elements\n\t\t\t\tfor (name in settings.schema.getCustomElements()) {\n\t\t\t\t\tdoc.createElement(name);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tclone: function(node, deep) {\n\t\t\tvar self = this, clone, doc;\n\n\t\t\t// TODO: Add feature detection here in the future\n\t\t\tif (!isIE || node.nodeType !== 1 || deep) {\n\t\t\t\treturn node.cloneNode(deep);\n\t\t\t}\n\n\t\t\tdoc = self.doc;\n\n\t\t\t// Make a HTML5 safe shallow copy\n\t\t\tif (!deep) {\n\t\t\t\tclone = doc.createElement(node.nodeName);\n\n\t\t\t\t// Copy attribs\n\t\t\t\teach(self.getAttribs(node), function(attr) {\n\t\t\t\t\tself.setAttrib(clone, attr.nodeName, self.getAttrib(node, attr.nodeName));\n\t\t\t\t});\n\n\t\t\t\treturn clone;\n\t\t\t}\n\n\t\t\treturn clone.firstChild;\n\t\t},\n\n\t\t/**\n\t\t * Returns the root node of the document. This is normally the body but might be a DIV. Parents like getParent will not\n\t\t * go above the point of this root node.\n\t\t *\n\t\t * @method getRoot\n\t\t * @return {Element} Root element for the utility class.\n\t\t */\n\t\tgetRoot: function() {\n\t\t\tvar self = this;\n\n\t\t\treturn self.settings.root_element || self.doc.body;\n\t\t},\n\n\t\t/**\n\t\t * Returns the viewport of the window.\n\t\t *\n\t\t * @method getViewPort\n\t\t * @param {Window} win Optional window to get viewport of.\n\t\t * @return {Object} Viewport object with fields x, y, w and h.\n\t\t */\n\t\tgetViewPort: function(win) {\n\t\t\tvar doc, rootElm;\n\n\t\t\twin = !win ? this.win : win;\n\t\t\tdoc = win.document;\n\t\t\trootElm = this.boxModel ? doc.documentElement : doc.body;\n\n\t\t\t// Returns viewport size excluding scrollbars\n\t\t\treturn {\n\t\t\t\tx: win.pageXOffset || rootElm.scrollLeft,\n\t\t\t\ty: win.pageYOffset || rootElm.scrollTop,\n\t\t\t\tw: win.innerWidth || rootElm.clientWidth,\n\t\t\t\th: win.innerHeight || rootElm.clientHeight\n\t\t\t};\n\t\t},\n\n\t\t/**\n\t\t * Returns the rectangle for a specific element.\n\t\t *\n\t\t * @method getRect\n\t\t * @param {Element/String} elm Element object or element ID to get rectangle from.\n\t\t * @return {object} Rectangle for specified element object with x, y, w, h fields.\n\t\t */\n\t\tgetRect: function(elm) {\n\t\t\tvar self = this, pos, size;\n\n\t\t\telm = self.get(elm);\n\t\t\tpos = self.getPos(elm);\n\t\t\tsize = self.getSize(elm);\n\n\t\t\treturn {\n\t\t\t\tx: pos.x, y: pos.y,\n\t\t\t\tw: size.w, h: size.h\n\t\t\t};\n\t\t},\n\n\t\t/**\n\t\t * Returns the size dimensions of the specified element.\n\t\t *\n\t\t * @method getSize\n\t\t * @param {Element/String} elm Element object or element ID to get rectangle from.\n\t\t * @return {object} Rectangle for specified element object with w, h fields.\n\t\t */\n\t\tgetSize: function(elm) {\n\t\t\tvar self = this, w, h;\n\n\t\t\telm = self.get(elm);\n\t\t\tw = self.getStyle(elm, 'width');\n\t\t\th = self.getStyle(elm, 'height');\n\n\t\t\t// Non pixel value, then force offset/clientWidth\n\t\t\tif (w.indexOf('px') === -1) {\n\t\t\t\tw = 0;\n\t\t\t}\n\n\t\t\t// Non pixel value, then force offset/clientWidth\n\t\t\tif (h.indexOf('px') === -1) {\n\t\t\t\th = 0;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tw: parseInt(w, 10) || elm.offsetWidth || elm.clientWidth,\n\t\t\t\th: parseInt(h, 10) || elm.offsetHeight || elm.clientHeight\n\t\t\t};\n\t\t},\n\n\t\t/**\n\t\t * Returns a node by the specified selector function. This function will\n\t\t * loop through all parent nodes and call the specified function for each node.\n\t\t * If the function then returns true indicating that it has found what it was looking for, the loop execution will then end\n\t\t * and the node it found will be returned.\n\t\t *\n\t\t * @method getParent\n\t\t * @param {Node/String} node DOM node to search parents on or ID string.\n\t\t * @param {function} selector Selection function or CSS selector to execute on each node.\n\t\t * @param {Node} root Optional root element, never go below this point.\n\t\t * @return {Node} DOM Node or null if it wasn't found.\n\t\t */\n\t\tgetParent: function(node, selector, root) {\n\t\t\treturn this.getParents(node, selector, root, false);\n\t\t},\n\n\t\t/**\n\t\t * Returns a node list of all parents matching the specified selector function or pattern.\n\t\t * If the function then returns true indicating that it has found what it was looking for and that node will be collected.\n\t\t *\n\t\t * @method getParents\n\t\t * @param {Node/String} node DOM node to search parents on or ID string.\n\t\t * @param {function} selector Selection function to execute on each node or CSS pattern.\n\t\t * @param {Node} root Optional root element, never go below this point.\n\t\t * @return {Array} Array of nodes or null if it wasn't found.\n\t\t */\n\t\tgetParents: function(node, selector, root, collect) {\n\t\t\tvar self = this, selectorVal, result = [];\n\n\t\t\tnode = self.get(node);\n\t\t\tcollect = collect === undefined;\n\n\t\t\t// Default root on inline mode\n\t\t\troot = root || (self.getRoot().nodeName != 'BODY' ? self.getRoot().parentNode : null);\n\n\t\t\t// Wrap node name as func\n\t\t\tif (is(selector, 'string')) {\n\t\t\t\tselectorVal = selector;\n\n\t\t\t\tif (selector === '*') {\n\t\t\t\t\tselector = function(node) {\n\t\t\t\t\t\treturn node.nodeType == 1;\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\tselector = function(node) {\n\t\t\t\t\t\treturn self.is(node, selectorVal);\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\twhile (node) {\n\t\t\t\tif (node == root || !node.nodeType || node.nodeType === 9) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (!selector || selector(node)) {\n\t\t\t\t\tif (collect) {\n\t\t\t\t\t\tresult.push(node);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tnode = node.parentNode;\n\t\t\t}\n\n\t\t\treturn collect ? result : null;\n\t\t},\n\n\t\t/**\n\t\t * Returns the specified element by ID or the input element if it isn't a string.\n\t\t *\n\t\t * @method get\n\t\t * @param {String/Element} n Element id to look for or element to just pass though.\n\t\t * @return {Element} Element matching the specified id or null if it wasn't found.\n\t\t */\n\t\tget: function(elm) {\n\t\t\tvar name;\n\n\t\t\tif (elm && this.doc && typeof elm == 'string') {\n\t\t\t\tname = elm;\n\t\t\t\telm = this.doc.getElementById(elm);\n\n\t\t\t\t// IE and Opera returns meta elements when they match the specified input ID, but getElementsByName seems to do the trick\n\t\t\t\tif (elm && elm.id !== name) {\n\t\t\t\t\treturn this.doc.getElementsByName(name)[1];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn elm;\n\t\t},\n\n\t\t/**\n\t\t * Returns the next node that matches selector or function\n\t\t *\n\t\t * @method getNext\n\t\t * @param {Node} node Node to find siblings from.\n\t\t * @param {String/function} selector Selector CSS expression or function.\n\t\t * @return {Node} Next node item matching the selector or null if it wasn't found.\n\t\t */\n\t\tgetNext: function(node, selector) {\n\t\t\treturn this._findSib(node, selector, 'nextSibling');\n\t\t},\n\n\t\t/**\n\t\t * Returns the previous node that matches selector or function\n\t\t *\n\t\t * @method getPrev\n\t\t * @param {Node} node Node to find siblings from.\n\t\t * @param {String/function} selector Selector CSS expression or function.\n\t\t * @return {Node} Previous node item matching the selector or null if it wasn't found.\n\t\t */\n\t\tgetPrev: function(node, selector) {\n\t\t\treturn this._findSib(node, selector, 'previousSibling');\n\t\t},\n\n\t\t// #ifndef jquery\n\n\t\t/**\n\t\t * Selects specific elements by a CSS level 3 pattern. For example \"div#a1 p.test\".\n\t\t * This function is optimized for the most common patterns needed in TinyMCE but it also performs well enough\n\t\t * on more complex patterns.\n\t\t *\n\t\t * @method select\n\t\t * @param {String} selector CSS level 3 pattern to select/find elements by.\n\t\t * @param {Object} scope Optional root element/scope element to search in.\n\t\t * @return {Array} Array with all matched elements.\n\t\t * @example\n\t\t * // Adds a class to all paragraphs in the currently active editor\n\t\t * tinymce.activeEditor.dom.addClass(tinymce.activeEditor.dom.select('p'), 'someclass');\n\t\t *\n\t\t * // Adds a class to all spans that have the test class in the currently active editor\n\t\t * tinymce.activeEditor.dom.addClass(tinymce.activeEditor.dom.select('span.test'), 'someclass')\n\t\t */\n\t\tselect: function(selector, scope) {\n\t\t\tvar self = this;\n\n\t\t\t/*eslint new-cap:0 */\n\t\t\treturn Sizzle(selector, self.get(scope) || self.settings.root_element || self.doc, []);\n\t\t},\n\n\t\t/**\n\t\t * Returns true/false if the specified element matches the specified css pattern.\n\t\t *\n\t\t * @method is\n\t\t * @param {Node/NodeList} elm DOM node to match or an array of nodes to match.\n\t\t * @param {String} selector CSS pattern to match the element against.\n\t\t */\n\t\tis: function(elm, selector) {\n\t\t\tvar i;\n\n\t\t\t// If it isn't an array then try to do some simple selectors instead of Sizzle for to boost performance\n\t\t\tif (elm.length === undefined) {\n\t\t\t\t// Simple all selector\n\t\t\t\tif (selector === '*') {\n\t\t\t\t\treturn elm.nodeType == 1;\n\t\t\t\t}\n\n\t\t\t\t// Simple selector just elements\n\t\t\t\tif (simpleSelectorRe.test(selector)) {\n\t\t\t\t\tselector = selector.toLowerCase().split(/,/);\n\t\t\t\t\telm = elm.nodeName.toLowerCase();\n\n\t\t\t\t\tfor (i = selector.length - 1; i >= 0; i--) {\n\t\t\t\t\t\tif (selector[i] == elm) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Is non element\n\t\t\tif (elm.nodeType && elm.nodeType != 1) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tvar elms = elm.nodeType ? [elm] : elm;\n\n\t\t\t/*eslint new-cap:0 */\n\t\t\treturn Sizzle(selector, elms[0].ownerDocument || elms[0], null, elms).length > 0;\n\t\t},\n\n\t\t// #endif\n\n\t\t/**\n\t\t * Adds the specified element to another element or elements.\n\t\t *\n\t\t * @method add\n\t\t * @param {String/Element/Array} parentElm Element id string, DOM node element or array of ids or elements to add to.\n\t\t * @param {String/Element} name Name of new element to add or existing element to add.\n\t\t * @param {Object} attrs Optional object collection with arguments to add to the new element(s).\n\t\t * @param {String} html Optional inner HTML contents to add for each element.\n\t\t * @param {Boolean} create Optional flag if the element should be created or added.\n\t\t * @return {Element/Array} Element that got created, or an array of created elements if multiple input elements\n\t\t * were passed in.\n\t\t * @example\n\t\t * // Adds a new paragraph to the end of the active editor\n\t\t * tinymce.activeEditor.dom.add(tinymce.activeEditor.getBody(), 'p', {title: 'my title'}, 'Some content');\n\t\t */\n\t\tadd: function(parentElm, name, attrs, html, create) {\n\t\t\tvar self = this;\n\n\t\t\treturn this.run(parentElm, function(parentElm) {\n\t\t\t\tvar newElm;\n\n\t\t\t\tnewElm = is(name, 'string') ? self.doc.createElement(name) : name;\n\t\t\t\tself.setAttribs(newElm, attrs);\n\n\t\t\t\tif (html) {\n\t\t\t\t\tif (html.nodeType) {\n\t\t\t\t\t\tnewElm.appendChild(html);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.setHTML(newElm, html);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn !create ? parentElm.appendChild(newElm) : newElm;\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Creates a new element.\n\t\t *\n\t\t * @method create\n\t\t * @param {String} name Name of new element.\n\t\t * @param {Object} attrs Optional object name/value collection with element attributes.\n\t\t * @param {String} html Optional HTML string to set as inner HTML of the element.\n\t\t * @return {Element} HTML DOM node element that got created.\n\t\t * @example\n\t\t * // Adds an element where the caret/selection is in the active editor\n\t\t * var el = tinymce.activeEditor.dom.create('div', {id: 'test', 'class': 'myclass'}, 'some content');\n\t\t * tinymce.activeEditor.selection.setNode(el);\n\t\t */\n\t\tcreate: function(name, attrs, html) {\n\t\t\treturn this.add(this.doc.createElement(name), name, attrs, html, 1);\n\t\t},\n\n\t\t/**\n\t\t * Creates HTML string for element. The element will be closed unless an empty inner HTML string is passed in.\n\t\t *\n\t\t * @method createHTML\n\t\t * @param {String} name Name of new element.\n\t\t * @param {Object} attrs Optional object name/value collection with element attributes.\n\t\t * @param {String} html Optional HTML string to set as inner HTML of the element.\n\t\t * @return {String} String with new HTML element, for example: <a href=\"#\">test</a>.\n\t\t * @example\n\t\t * // Creates a html chunk and inserts it at the current selection/caret location\n\t\t * tinymce.activeEditor.selection.setContent(tinymce.activeEditor.dom.createHTML('a', {href: 'test.html'}, 'some line'));\n\t\t */\n\t\tcreateHTML: function(name, attrs, html) {\n\t\t\tvar outHtml = '', key;\n\n\t\t\toutHtml += '<' + name;\n\n\t\t\tfor (key in attrs) {\n\t\t\t\tif (attrs.hasOwnProperty(key) && attrs[key] !== null && typeof attrs[key] != 'undefined') {\n\t\t\t\t\toutHtml += ' ' + key + '=\"' + this.encode(attrs[key]) + '\"';\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// A call to tinymce.is doesn't work for some odd reason on IE9 possible bug inside their JS runtime\n\t\t\tif (typeof html != \"undefined\") {\n\t\t\t\treturn outHtml + '>' + html + '</' + name + '>';\n\t\t\t}\n\n\t\t\treturn outHtml + ' />';\n\t\t},\n\n\t\t/**\n\t\t * Creates a document fragment out of the specified HTML string.\n\t\t *\n\t\t * @method createFragment\n\t\t * @param {String} html Html string to create fragment from.\n\t\t * @return {DocumentFragment} Document fragment node.\n\t\t */\n\t\tcreateFragment: function(html) {\n\t\t\tvar frag, node, doc = this.doc, container;\n\n\t\t\tcontainer = doc.createElement(\"div\");\n\t\t\tfrag = doc.createDocumentFragment();\n\n\t\t\tif (html) {\n\t\t\t\tcontainer.innerHTML = html;\n\t\t\t}\n\n\t\t\twhile ((node = container.firstChild)) {\n\t\t\t\tfrag.appendChild(node);\n\t\t\t}\n\n\t\t\treturn frag;\n\t\t},\n\n\t\t/**\n\t\t * Removes/deletes the specified element(s) from the DOM.\n\t\t *\n\t\t * @method remove\n\t\t * @param {String/Element/Array} node ID of element or DOM element object or array containing multiple elements/ids.\n\t\t * @param {Boolean} keepChildren Optional state to keep children or not. If set to true all children will be\n\t\t * placed at the location of the removed element.\n\t\t * @return {Element/Array} HTML DOM element that got removed, or an array of removed elements if multiple input elements\n\t\t * were passed in.\n\t\t * @example\n\t\t * // Removes all paragraphs in the active editor\n\t\t * tinymce.activeEditor.dom.remove(tinymce.activeEditor.dom.select('p'));\n\t\t *\n\t\t * // Removes an element by id in the document\n\t\t * tinymce.DOM.remove('mydiv');\n\t\t */\n\t\tremove: function(node, keepChildren) {\n\t\t\tnode = this.$$(node);\n\n\t\t\tif (keepChildren) {\n\t\t\t\tnode.each(function() {\n\t\t\t\t\tvar child;\n\n\t\t\t\t\twhile ((child = this.firstChild)) {\n\t\t\t\t\t\tif (child.nodeType == 3 && child.data.length === 0) {\n\t\t\t\t\t\t\tthis.removeChild(child);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.parentNode.insertBefore(child, this);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}).remove();\n\t\t\t} else {\n\t\t\t\tnode.remove();\n\t\t\t}\n\n\t\t\treturn node.length > 1 ? node.toArray() : node[0];\n\t\t},\n\n\t\t/**\n\t\t * Sets the CSS style value on a HTML element. The name can be a camelcase string\n\t\t * or the CSS style name like background-color.\n\t\t *\n\t\t * @method setStyle\n\t\t * @param {String/Element/Array} elm HTML element/Array of elements to set CSS style value on.\n\t\t * @param {String} name Name of the style value to set.\n\t\t * @param {String} value Value to set on the style.\n\t\t * @example\n\t\t * // Sets a style value on all paragraphs in the currently active editor\n\t\t * tinymce.activeEditor.dom.setStyle(tinymce.activeEditor.dom.select('p'), 'background-color', 'red');\n\t\t *\n\t\t * // Sets a style value to an element by id in the current document\n\t\t * tinymce.DOM.setStyle('mydiv', 'background-color', 'red');\n\t\t */\n\t\tsetStyle: function(elm, name, value) {\n\t\t\telm = this.$$(elm).css(name, value);\n\n\t\t\tif (this.settings.update_styles) {\n\t\t\t\tupdateInternalStyleAttr(this, elm);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Returns the current style or runtime/computed value of an element.\n\t\t *\n\t\t * @method getStyle\n\t\t * @param {String/Element} elm HTML element or element id string to get style from.\n\t\t * @param {String} name Style name to return.\n\t\t * @param {Boolean} computed Computed style.\n\t\t * @return {String} Current style or computed style value of an element.\n\t\t */\n\t\tgetStyle: function(elm, name, computed) {\n\t\t\telm = this.$$(elm);\n\n\t\t\tif (computed) {\n\t\t\t\treturn elm.css(name);\n\t\t\t}\n\n\t\t\t// Camelcase it, if needed\n\t\t\tname = name.replace(/-(\\D)/g, function(a, b) {\n\t\t\t\treturn b.toUpperCase();\n\t\t\t});\n\n\t\t\tif (name == 'float') {\n\t\t\t\tname = Env.ie && Env.ie < 12 ? 'styleFloat' : 'cssFloat';\n\t\t\t}\n\n\t\t\treturn elm[0] && elm[0].style ? elm[0].style[name] : undefined;\n\t\t},\n\n\t\t/**\n\t\t * Sets multiple styles on the specified element(s).\n\t\t *\n\t\t * @method setStyles\n\t\t * @param {Element/String/Array} elm DOM element, element id string or array of elements/ids to set styles on.\n\t\t * @param {Object} styles Name/Value collection of style items to add to the element(s).\n\t\t * @example\n\t\t * // Sets styles on all paragraphs in the currently active editor\n\t\t * tinymce.activeEditor.dom.setStyles(tinymce.activeEditor.dom.select('p'), {'background-color': 'red', 'color': 'green'});\n\t\t *\n\t\t * // Sets styles to an element by id in the current document\n\t\t * tinymce.DOM.setStyles('mydiv', {'background-color': 'red', 'color': 'green'});\n\t\t */\n\t\tsetStyles: function(elm, styles) {\n\t\t\telm = this.$$(elm).css(styles);\n\n\t\t\tif (this.settings.update_styles) {\n\t\t\t\tupdateInternalStyleAttr(this, elm);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Removes all attributes from an element or elements.\n\t\t *\n\t\t * @method removeAllAttribs\n\t\t * @param {Element/String/Array} e DOM element, element id string or array of elements/ids to remove attributes from.\n\t\t */\n\t\tremoveAllAttribs: function(e) {\n\t\t\treturn this.run(e, function(e) {\n\t\t\t\tvar i, attrs = e.attributes;\n\t\t\t\tfor (i = attrs.length - 1; i >= 0; i--) {\n\t\t\t\t\te.removeAttributeNode(attrs.item(i));\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Sets the specified attribute of an element or elements.\n\t\t *\n\t\t * @method setAttrib\n\t\t * @param {Element/String/Array} elm DOM element, element id string or array of elements/ids to set attribute on.\n\t\t * @param {String} name Name of attribute to set.\n\t\t * @param {String} value Value to set on the attribute - if this value is falsy like null, 0 or '' it will remove\n\t\t * the attribute instead.\n\t\t * @example\n\t\t * // Sets class attribute on all paragraphs in the active editor\n\t\t * tinymce.activeEditor.dom.setAttrib(tinymce.activeEditor.dom.select('p'), 'class', 'myclass');\n\t\t *\n\t\t * // Sets class attribute on a specific element in the current page\n\t\t * tinymce.dom.setAttrib('mydiv', 'class', 'myclass');\n\t\t */\n\t\tsetAttrib: function(elm, name, value) {\n\t\t\tvar self = this, originalValue, hook, settings = self.settings;\n\n\t\t\tif (value === '') {\n\t\t\t\tvalue = null;\n\t\t\t}\n\n\t\t\telm = self.$$(elm);\n\t\t\toriginalValue = elm.attr(name);\n\n\t\t\tif (!elm.length) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\thook = self.attrHooks[name];\n\t\t\tif (hook && hook.set) {\n\t\t\t\thook.set(elm, value, name);\n\t\t\t} else {\n\t\t\t\telm.attr(name, value);\n\t\t\t}\n\n\t\t\tif (originalValue != value && settings.onSetAttrib) {\n\t\t\t\tsettings.onSetAttrib({\n\t\t\t\t\tattrElm: elm,\n\t\t\t\t\tattrName: name,\n\t\t\t\t\tattrValue: value\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Sets two or more specified attributes of an element or elements.\n\t\t *\n\t\t * @method setAttribs\n\t\t * @param {Element/String/Array} elm DOM element, element id string or array of elements/ids to set attributes on.\n\t\t * @param {Object} attrs Name/Value collection of attribute items to add to the element(s).\n\t\t * @example\n\t\t * // Sets class and title attributes on all paragraphs in the active editor\n\t\t * tinymce.activeEditor.dom.setAttribs(tinymce.activeEditor.dom.select('p'), {'class': 'myclass', title: 'some title'});\n\t\t *\n\t\t * // Sets class and title attributes on a specific element in the current page\n\t\t * tinymce.DOM.setAttribs('mydiv', {'class': 'myclass', title: 'some title'});\n\t\t */\n\t\tsetAttribs: function(elm, attrs) {\n\t\t\tvar self = this;\n\n\t\t\tself.$$(elm).each(function(i, node) {\n\t\t\t\teach(attrs, function(value, name) {\n\t\t\t\t\tself.setAttrib(node, name, value);\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Returns the specified attribute by name.\n\t\t *\n\t\t * @method getAttrib\n\t\t * @param {String/Element} elm Element string id or DOM element to get attribute from.\n\t\t * @param {String} name Name of attribute to get.\n\t\t * @param {String} defaultVal Optional default value to return if the attribute didn't exist.\n\t\t * @return {String} Attribute value string, default value or null if the attribute wasn't found.\n\t\t */\n\t\tgetAttrib: function(elm, name, defaultVal) {\n\t\t\tvar self = this, hook, value;\n\n\t\t\telm = self.$$(elm);\n\n\t\t\tif (elm.length) {\n\t\t\t\thook = self.attrHooks[name];\n\n\t\t\t\tif (hook && hook.get) {\n\t\t\t\t\tvalue = hook.get(elm, name);\n\t\t\t\t} else {\n\t\t\t\t\tvalue = elm.attr(name);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (typeof value == 'undefined') {\n\t\t\t\tvalue = defaultVal || '';\n\t\t\t}\n\n\t\t\treturn value;\n\t\t},\n\n\t\t/**\n\t\t * Returns the absolute x, y position of a node. The position will be returned in an object with x, y fields.\n\t\t *\n\t\t * @method getPos\n\t\t * @param {Element/String} elm HTML element or element id to get x, y position from.\n\t\t * @param {Element} rootElm Optional root element to stop calculations at.\n\t\t * @return {object} Absolute position of the specified element object with x, y fields.\n\t\t */\n\t\tgetPos: function(elm, rootElm) {\n\t\t\tvar self = this, x = 0, y = 0, offsetParent, doc = self.doc, body = doc.body, pos;\n\n\t\t\telm = self.get(elm);\n\t\t\trootElm = rootElm || body;\n\n\t\t\tif (elm) {\n\t\t\t\t// Use getBoundingClientRect if it exists since it's faster than looping offset nodes\n\t\t\t\t// Fallback to offsetParent calculations if the body isn't static better since it stops at the body root\n\t\t\t\tif (rootElm === body && elm.getBoundingClientRect && $(body).css('position') === 'static') {\n\t\t\t\t\tpos = elm.getBoundingClientRect();\n\t\t\t\t\trootElm = self.boxModel ? doc.documentElement : body;\n\n\t\t\t\t\t// Add scroll offsets from documentElement or body since IE with the wrong box model will use d.body and so do WebKit\n\t\t\t\t\t// Also remove the body/documentelement clientTop/clientLeft on IE 6, 7 since they offset the position\n\t\t\t\t\tx = pos.left + (doc.documentElement.scrollLeft || body.scrollLeft) - rootElm.clientLeft;\n\t\t\t\t\ty = pos.top + (doc.documentElement.scrollTop || body.scrollTop) - rootElm.clientTop;\n\n\t\t\t\t\treturn {x: x, y: y};\n\t\t\t\t}\n\n\t\t\t\toffsetParent = elm;\n\t\t\t\twhile (offsetParent && offsetParent != rootElm && offsetParent.nodeType) {\n\t\t\t\t\tx += offsetParent.offsetLeft || 0;\n\t\t\t\t\ty += offsetParent.offsetTop || 0;\n\t\t\t\t\toffsetParent = offsetParent.offsetParent;\n\t\t\t\t}\n\n\t\t\t\toffsetParent = elm.parentNode;\n\t\t\t\twhile (offsetParent && offsetParent != rootElm && offsetParent.nodeType) {\n\t\t\t\t\tx -= offsetParent.scrollLeft || 0;\n\t\t\t\t\ty -= offsetParent.scrollTop || 0;\n\t\t\t\t\toffsetParent = offsetParent.parentNode;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn {x: x, y: y};\n\t\t},\n\n\t\t/**\n\t\t * Parses the specified style value into an object collection. This parser will also\n\t\t * merge and remove any redundant items that browsers might have added. It will also convert non-hex\n\t\t * colors to hex values. Urls inside the styles will also be converted to absolute/relative based on settings.\n\t\t *\n\t\t * @method parseStyle\n\t\t * @param {String} cssText Style value to parse, for example: border:1px solid red;.\n\t\t * @return {Object} Object representation of that style, for example: {border: '1px solid red'}\n\t\t */\n\t\tparseStyle: function(cssText) {\n\t\t\treturn this.styles.parse(cssText);\n\t\t},\n\n\t\t/**\n\t\t * Serializes the specified style object into a string.\n\t\t *\n\t\t * @method serializeStyle\n\t\t * @param {Object} styles Object to serialize as string, for example: {border: '1px solid red'}\n\t\t * @param {String} name Optional element name.\n\t\t * @return {String} String representation of the style object, for example: border: 1px solid red.\n\t\t */\n\t\tserializeStyle: function(styles, name) {\n\t\t\treturn this.styles.serialize(styles, name);\n\t\t},\n\n\t\t/**\n\t\t * Adds a style element at the top of the document with the specified cssText content.\n\t\t *\n\t\t * @method addStyle\n\t\t * @param {String} cssText CSS Text style to add to top of head of document.\n\t\t */\n\t\taddStyle: function(cssText) {\n\t\t\tvar self = this, doc = self.doc, head, styleElm;\n\n\t\t\t// Prevent inline from loading the same styles twice\n\t\t\tif (self !== DOMUtils.DOM && doc === document) {\n\t\t\t\tvar addedStyles = DOMUtils.DOM.addedStyles;\n\n\t\t\t\taddedStyles = addedStyles || [];\n\t\t\t\tif (addedStyles[cssText]) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\taddedStyles[cssText] = true;\n\t\t\t\tDOMUtils.DOM.addedStyles = addedStyles;\n\t\t\t}\n\n\t\t\t// Create style element if needed\n\t\t\tstyleElm = doc.getElementById('mceDefaultStyles');\n\t\t\tif (!styleElm) {\n\t\t\t\tstyleElm = doc.createElement('style');\n\t\t\t\tstyleElm.id = 'mceDefaultStyles';\n\t\t\t\tstyleElm.type = 'text/css';\n\n\t\t\t\thead = doc.getElementsByTagName('head')[0];\n\t\t\t\tif (head.firstChild) {\n\t\t\t\t\thead.insertBefore(styleElm, head.firstChild);\n\t\t\t\t} else {\n\t\t\t\t\thead.appendChild(styleElm);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Append style data to old or new style element\n\t\t\tif (styleElm.styleSheet) {\n\t\t\t\tstyleElm.styleSheet.cssText += cssText;\n\t\t\t} else {\n\t\t\t\tstyleElm.appendChild(doc.createTextNode(cssText));\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Imports/loads the specified CSS file into the document bound to the class.\n\t\t *\n\t\t * @method loadCSS\n\t\t * @param {String} url URL to CSS file to load.\n\t\t * @example\n\t\t * // Loads a CSS file dynamically into the current document\n\t\t * tinymce.DOM.loadCSS('somepath/some.css');\n\t\t *\n\t\t * // Loads a CSS file into the currently active editor instance\n\t\t * tinymce.activeEditor.dom.loadCSS('somepath/some.css');\n\t\t *\n\t\t * // Loads a CSS file into an editor instance by id\n\t\t * tinymce.get('someid').dom.loadCSS('somepath/some.css');\n\t\t *\n\t\t * // Loads multiple CSS files into the current document\n\t\t * tinymce.DOM.loadCSS('somepath/some.css,somepath/someother.css');\n\t\t */\n\t\tloadCSS: function(url) {\n\t\t\tvar self = this, doc = self.doc, head;\n\n\t\t\t// Prevent inline from loading the same CSS file twice\n\t\t\tif (self !== DOMUtils.DOM && doc === document) {\n\t\t\t\tDOMUtils.DOM.loadCSS(url);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!url) {\n\t\t\t\turl = '';\n\t\t\t}\n\n\t\t\thead = doc.getElementsByTagName('head')[0];\n\n\t\t\teach(url.split(','), function(url) {\n\t\t\t\tvar link;\n\n\t\t\t\turl = Tools._addCacheSuffix(url);\n\n\t\t\t\tif (self.files[url]) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tself.files[url] = true;\n\t\t\t\tlink = self.create('link', {rel: 'stylesheet', href: url});\n\n\t\t\t\t// IE 8 has a bug where dynamically loading stylesheets would produce a 1 item remaining bug\n\t\t\t\t// This fix seems to resolve that issue by recalcing the document once a stylesheet finishes loading\n\t\t\t\t// It's ugly but it seems to work fine.\n\t\t\t\tif (isIE && doc.documentMode && doc.recalc) {\n\t\t\t\t\tlink.onload = function() {\n\t\t\t\t\t\tif (doc.recalc) {\n\t\t\t\t\t\t\tdoc.recalc();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tlink.onload = null;\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\thead.appendChild(link);\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Adds a class to the specified element or elements.\n\t\t *\n\t\t * @method addClass\n\t\t * @param {String/Element/Array} elm Element ID string or DOM element or array with elements or IDs.\n\t\t * @param {String} cls Class name to add to each element.\n\t\t * @return {String/Array} String with new class value or array with new class values for all elements.\n\t\t * @example\n\t\t * // Adds a class to all paragraphs in the active editor\n\t\t * tinymce.activeEditor.dom.addClass(tinymce.activeEditor.dom.select('p'), 'myclass');\n\t\t *\n\t\t * // Adds a class to a specific element in the current page\n\t\t * tinymce.DOM.addClass('mydiv', 'myclass');\n\t\t */\n\t\taddClass: function(elm, cls) {\n\t\t\tthis.$$(elm).addClass(cls);\n\t\t},\n\n\t\t/**\n\t\t * Removes a class from the specified element or elements.\n\t\t *\n\t\t * @method removeClass\n\t\t * @param {String/Element/Array} elm Element ID string or DOM element or array with elements or IDs.\n\t\t * @param {String} cls Class name to remove from each element.\n\t\t * @return {String/Array} String of remaining class name(s), or an array of strings if multiple input elements\n\t\t * were passed in.\n\t\t * @example\n\t\t * // Removes a class from all paragraphs in the active editor\n\t\t * tinymce.activeEditor.dom.removeClass(tinymce.activeEditor.dom.select('p'), 'myclass');\n\t\t *\n\t\t * // Removes a class from a specific element in the current page\n\t\t * tinymce.DOM.removeClass('mydiv', 'myclass');\n\t\t */\n\t\tremoveClass: function(elm, cls) {\n\t\t\tthis.toggleClass(elm, cls, false);\n\t\t},\n\n\t\t/**\n\t\t * Returns true if the specified element has the specified class.\n\t\t *\n\t\t * @method hasClass\n\t\t * @param {String/Element} elm HTML element or element id string to check CSS class on.\n\t\t * @param {String} cls CSS class to check for.\n\t\t * @return {Boolean} true/false if the specified element has the specified class.\n\t\t */\n\t\thasClass: function(elm, cls) {\n\t\t\treturn this.$$(elm).hasClass(cls);\n\t\t},\n\n\t\t/**\n\t\t * Toggles the specified class on/off.\n\t\t *\n\t\t * @method toggleClass\n\t\t * @param {Element} elm Element to toggle class on.\n\t\t * @param {[type]} cls Class to toggle on/off.\n\t\t * @param {[type]} state Optional state to set.\n\t\t */\n\t\ttoggleClass: function(elm, cls, state) {\n\t\t\tthis.$$(elm).toggleClass(cls, state).each(function() {\n\t\t\t\tif (this.className === '') {\n\t\t\t\t\t$(this).attr('class', null);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Shows the specified element(s) by ID by setting the \"display\" style.\n\t\t *\n\t\t * @method show\n\t\t * @param {String/Element/Array} elm ID of DOM element or DOM element or array with elements or IDs to show.\n\t\t */\n\t\tshow: function(elm) {\n\t\t\tthis.$$(elm).show();\n\t\t},\n\n\t\t/**\n\t\t * Hides the specified element(s) by ID by setting the \"display\" style.\n\t\t *\n\t\t * @method hide\n\t\t * @param {String/Element/Array} elm ID of DOM element or DOM element or array with elements or IDs to hide.\n\t\t * @example\n\t\t * // Hides an element by id in the document\n\t\t * tinymce.DOM.hide('myid');\n\t\t */\n\t\thide: function(elm) {\n\t\t\tthis.$$(elm).hide();\n\t\t},\n\n\t\t/**\n\t\t * Returns true/false if the element is hidden or not by checking the \"display\" style.\n\t\t *\n\t\t * @method isHidden\n\t\t * @param {String/Element} elm Id or element to check display state on.\n\t\t * @return {Boolean} true/false if the element is hidden or not.\n\t\t */\n\t\tisHidden: function(elm) {\n\t\t\treturn this.$$(elm).css('display') == 'none';\n\t\t},\n\n\t\t/**\n\t\t * Returns a unique id. This can be useful when generating elements on the fly.\n\t\t * This method will not check if the element already exists.\n\t\t *\n\t\t * @method uniqueId\n\t\t * @param {String} prefix Optional prefix to add in front of all ids - defaults to \"mce_\".\n\t\t * @return {String} Unique id.\n\t\t */\n\t\tuniqueId: function(prefix) {\n\t\t\treturn (!prefix ? 'mce_' : prefix) + (this.counter++);\n\t\t},\n\n\t\t/**\n\t\t * Sets the specified HTML content inside the element or elements. The HTML will first be processed. This means\n\t\t * URLs will get converted, hex color values fixed etc. Check processHTML for details.\n\t\t *\n\t\t * @method setHTML\n\t\t * @param {Element/String/Array} elm DOM element, element id string or array of elements/ids to set HTML inside of.\n\t\t * @param {String} html HTML content to set as inner HTML of the element.\n\t\t * @example\n\t\t * // Sets the inner HTML of all paragraphs in the active editor\n\t\t * tinymce.activeEditor.dom.setHTML(tinymce.activeEditor.dom.select('p'), 'some inner html');\n\t\t *\n\t\t * // Sets the inner HTML of an element by id in the document\n\t\t * tinymce.DOM.setHTML('mydiv', 'some inner html');\n\t\t */\n\t\tsetHTML: function(elm, html) {\n\t\t\telm = this.$$(elm);\n\n\t\t\tif (isIE) {\n\t\t\t\telm.each(function(i, target) {\n\t\t\t\t\tif (target.canHaveHTML === false) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Remove all child nodes, IE keeps empty text nodes in DOM\n\t\t\t\t\twhile (target.firstChild) {\n\t\t\t\t\t\ttarget.removeChild(target.firstChild);\n\t\t\t\t\t}\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// IE will remove comments from the beginning\n\t\t\t\t\t\t// unless you padd the contents with something\n\t\t\t\t\t\ttarget.innerHTML = '<br>' + html;\n\t\t\t\t\t\ttarget.removeChild(target.firstChild);\n\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t// IE sometimes produces an unknown runtime error on innerHTML if it's a div inside a p\n\t\t\t\t\t\t$('<div></div>').html('<br>' + html).contents().slice(1).appendTo(target);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn html;\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\telm.html(html);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Returns the outer HTML of an element.\n\t\t *\n\t\t * @method getOuterHTML\n\t\t * @param {String/Element} elm Element ID or element object to get outer HTML from.\n\t\t * @return {String} Outer HTML string.\n\t\t * @example\n\t\t * tinymce.DOM.getOuterHTML(editorElement);\n\t\t * tinymce.activeEditor.getOuterHTML(tinymce.activeEditor.getBody());\n\t\t */\n\t\tgetOuterHTML: function(elm) {\n\t\t\telm = this.get(elm);\n\n\t\t\t// Older FF doesn't have outerHTML 3.6 is still used by some orgaizations\n\t\t\treturn elm.nodeType == 1 && \"outerHTML\" in elm ? elm.outerHTML : $('<div></div>').append($(elm).clone()).html();\n\t\t},\n\n\t\t/**\n\t\t * Sets the specified outer HTML on an element or elements.\n\t\t *\n\t\t * @method setOuterHTML\n\t\t * @param {Element/String/Array} elm DOM element, element id string or array of elements/ids to set outer HTML on.\n\t\t * @param {Object} html HTML code to set as outer value for the element.\n\t\t * @example\n\t\t * // Sets the outer HTML of all paragraphs in the active editor\n\t\t * tinymce.activeEditor.dom.setOuterHTML(tinymce.activeEditor.dom.select('p'), '<div>some html</div>');\n\t\t *\n\t\t * // Sets the outer HTML of an element by id in the document\n\t\t * tinymce.DOM.setOuterHTML('mydiv', '<div>some html</div>');\n\t\t */\n\t\tsetOuterHTML: function(elm, html) {\n\t\t\tvar self = this;\n\n\t\t\tself.$$(elm).each(function() {\n\t\t\t\ttry {\n\t\t\t\t\t// Older FF doesn't have outerHTML 3.6 is still used by some organizations\n\t\t\t\t\tif (\"outerHTML\" in this) {\n\t\t\t\t\t\tthis.outerHTML = html;\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t} catch (ex) {\n\t\t\t\t\t// Ignore\n\t\t\t\t}\n\n\t\t\t\t// OuterHTML for IE it sometimes produces an \"unknown runtime error\"\n\t\t\t\tself.remove($(this).html(html), true);\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Entity decodes a string. This method decodes any HTML entities, such as &aring;.\n\t\t *\n\t\t * @method decode\n\t\t * @param {String} s String to decode entities on.\n\t\t * @return {String} Entity decoded string.\n\t\t */\n\t\tdecode: Entities.decode,\n\n\t\t/**\n\t\t * Entity encodes a string. This method encodes the most common entities, such as <>\"&.\n\t\t *\n\t\t * @method encode\n\t\t * @param {String} text String to encode with entities.\n\t\t * @return {String} Entity encoded string.\n\t\t */\n\t\tencode: Entities.encodeAllRaw,\n\n\t\t/**\n\t\t * Inserts an element after the reference element.\n\t\t *\n\t\t * @method insertAfter\n\t\t * @param {Element} node Element to insert after the reference.\n\t\t * @param {Element/String/Array} referenceNode Reference element, element id or array of elements to insert after.\n\t\t * @return {Element/Array} Element that got added or an array with elements.\n\t\t */\n\t\tinsertAfter: function(node, referenceNode) {\n\t\t\treferenceNode = this.get(referenceNode);\n\n\t\t\treturn this.run(node, function(node) {\n\t\t\t\tvar parent, nextSibling;\n\n\t\t\t\tparent = referenceNode.parentNode;\n\t\t\t\tnextSibling = referenceNode.nextSibling;\n\n\t\t\t\tif (nextSibling) {\n\t\t\t\t\tparent.insertBefore(node, nextSibling);\n\t\t\t\t} else {\n\t\t\t\t\tparent.appendChild(node);\n\t\t\t\t}\n\n\t\t\t\treturn node;\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Replaces the specified element or elements with the new element specified. The new element will\n\t\t * be cloned if multiple input elements are passed in.\n\t\t *\n\t\t * @method replace\n\t\t * @param {Element} newElm New element to replace old ones with.\n\t\t * @param {Element/String/Array} oldElm Element DOM node, element id or array of elements or ids to replace.\n\t\t * @param {Boolean} keepChildren Optional keep children state, if set to true child nodes from the old object will be added\n\t\t * to new ones.\n\t\t */\n\t\treplace: function(newElm, oldElm, keepChildren) {\n\t\t\tvar self = this;\n\n\t\t\treturn self.run(oldElm, function(oldElm) {\n\t\t\t\tif (is(oldElm, 'array')) {\n\t\t\t\t\tnewElm = newElm.cloneNode(true);\n\t\t\t\t}\n\n\t\t\t\tif (keepChildren) {\n\t\t\t\t\teach(grep(oldElm.childNodes), function(node) {\n\t\t\t\t\t\tnewElm.appendChild(node);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn oldElm.parentNode.replaceChild(newElm, oldElm);\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Renames the specified element and keeps its attributes and children.\n\t\t *\n\t\t * @method rename\n\t\t * @param {Element} elm Element to rename.\n\t\t * @param {String} name Name of the new element.\n\t\t * @return {Element} New element or the old element if it needed renaming.\n\t\t */\n\t\trename: function(elm, name) {\n\t\t\tvar self = this, newElm;\n\n\t\t\tif (elm.nodeName != name.toUpperCase()) {\n\t\t\t\t// Rename block element\n\t\t\t\tnewElm = self.create(name);\n\n\t\t\t\t// Copy attribs to new block\n\t\t\t\teach(self.getAttribs(elm), function(attrNode) {\n\t\t\t\t\tself.setAttrib(newElm, attrNode.nodeName, self.getAttrib(elm, attrNode.nodeName));\n\t\t\t\t});\n\n\t\t\t\t// Replace block\n\t\t\t\tself.replace(newElm, elm, 1);\n\t\t\t}\n\n\t\t\treturn newElm || elm;\n\t\t},\n\n\t\t/**\n\t\t * Find the common ancestor of two elements. This is a shorter method than using the DOM Range logic.\n\t\t *\n\t\t * @method findCommonAncestor\n\t\t * @param {Element} a Element to find common ancestor of.\n\t\t * @param {Element} b Element to find common ancestor of.\n\t\t * @return {Element} Common ancestor element of the two input elements.\n\t\t */\n\t\tfindCommonAncestor: function(a, b) {\n\t\t\tvar ps = a, pe;\n\n\t\t\twhile (ps) {\n\t\t\t\tpe = b;\n\n\t\t\t\twhile (pe && ps != pe) {\n\t\t\t\t\tpe = pe.parentNode;\n\t\t\t\t}\n\n\t\t\t\tif (ps == pe) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tps = ps.parentNode;\n\t\t\t}\n\n\t\t\tif (!ps && a.ownerDocument) {\n\t\t\t\treturn a.ownerDocument.documentElement;\n\t\t\t}\n\n\t\t\treturn ps;\n\t\t},\n\n\t\t/**\n\t\t * Parses the specified RGB color value and returns a hex version of that color.\n\t\t *\n\t\t * @method toHex\n\t\t * @param {String} rgbVal RGB string value like rgb(1,2,3)\n\t\t * @return {String} Hex version of that RGB value like #FF00FF.\n\t\t */\n\t\ttoHex: function(rgbVal) {\n\t\t\treturn this.styles.toHex(Tools.trim(rgbVal));\n\t\t},\n\n\t\t/**\n\t\t * Executes the specified function on the element by id or dom element node or array of elements/id.\n\t\t *\n\t\t * @method run\n\t\t * @param {String/Element/Array} elm ID or DOM element object or array with ids or elements.\n\t\t * @param {function} func Function to execute for each item.\n\t\t * @param {Object} scope Optional scope to execute the function in.\n\t\t * @return {Object/Array} Single object, or an array of objects if multiple input elements were passed in.\n\t\t */\n\t\trun: function(elm, func, scope) {\n\t\t\tvar self = this, result;\n\n\t\t\tif (typeof elm === 'string') {\n\t\t\t\telm = self.get(elm);\n\t\t\t}\n\n\t\t\tif (!elm) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tscope = scope || this;\n\t\t\tif (!elm.nodeType && (elm.length || elm.length === 0)) {\n\t\t\t\tresult = [];\n\n\t\t\t\teach(elm, function(elm, i) {\n\t\t\t\t\tif (elm) {\n\t\t\t\t\t\tif (typeof elm == 'string') {\n\t\t\t\t\t\t\telm = self.get(elm);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tresult.push(func.call(scope, elm, i));\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn result;\n\t\t\t}\n\n\t\t\treturn func.call(scope, elm);\n\t\t},\n\n\t\t/**\n\t\t * Returns a NodeList with attributes for the element.\n\t\t *\n\t\t * @method getAttribs\n\t\t * @param {HTMLElement/string} elm Element node or string id to get attributes from.\n\t\t * @return {NodeList} NodeList with attributes.\n\t\t */\n\t\tgetAttribs: function(elm) {\n\t\t\tvar attrs;\n\n\t\t\telm = this.get(elm);\n\n\t\t\tif (!elm) {\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tif (isIE) {\n\t\t\t\tattrs = [];\n\n\t\t\t\t// Object will throw exception in IE\n\t\t\t\tif (elm.nodeName == 'OBJECT') {\n\t\t\t\t\treturn elm.attributes;\n\t\t\t\t}\n\n\t\t\t\t// IE doesn't keep the selected attribute if you clone option elements\n\t\t\t\tif (elm.nodeName === 'OPTION' && this.getAttrib(elm, 'selected')) {\n\t\t\t\t\tattrs.push({specified: 1, nodeName: 'selected'});\n\t\t\t\t}\n\n\t\t\t\t// It's crazy that this is faster in IE but it's because it returns all attributes all the time\n\t\t\t\tvar attrRegExp = /<\\/?[\\w:\\-]+ ?|=[\\\"][^\\\"]+\\\"|=\\'[^\\']+\\'|=[\\w\\-]+|>/gi;\n\t\t\t\telm.cloneNode(false).outerHTML.replace(attrRegExp, '').replace(/[\\w:\\-]+/gi, function(a) {\n\t\t\t\t\tattrs.push({specified: 1, nodeName: a});\n\t\t\t\t});\n\n\t\t\t\treturn attrs;\n\t\t\t}\n\n\t\t\treturn elm.attributes;\n\t\t},\n\n\t\t/**\n\t\t * Returns true/false if the specified node is to be considered empty or not.\n\t\t *\n\t\t * @example\n\t\t * tinymce.DOM.isEmpty(node, {img: true});\n\t\t * @method isEmpty\n\t\t * @param {Object} elements Optional name/value object with elements that are automatically treated as non-empty elements.\n\t\t * @return {Boolean} true/false if the node is empty or not.\n\t\t */\n\t\tisEmpty: function(node, elements) {\n\t\t\tvar self = this, i, attributes, type, walker, name, brCount = 0;\n\n\t\t\tnode = node.firstChild;\n\t\t\tif (node) {\n\t\t\t\twalker = new TreeWalker(node, node.parentNode);\n\t\t\t\telements = elements || (self.schema ? self.schema.getNonEmptyElements() : null);\n\n\t\t\t\tdo {\n\t\t\t\t\ttype = node.nodeType;\n\n\t\t\t\t\tif (type === 1) {\n\t\t\t\t\t\t// Ignore bogus elements\n\t\t\t\t\t\tvar bogusVal = node.getAttribute('data-mce-bogus');\n\t\t\t\t\t\tif (bogusVal) {\n\t\t\t\t\t\t\tnode = walker.next(bogusVal === 'all');\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Keep empty elements like <img />\n\t\t\t\t\t\tname = node.nodeName.toLowerCase();\n\t\t\t\t\t\tif (elements && elements[name]) {\n\t\t\t\t\t\t\t// Ignore single BR elements in blocks like <p><br /></p> or <p><span><br /></span></p>\n\t\t\t\t\t\t\tif (name === 'br') {\n\t\t\t\t\t\t\t\tbrCount++;\n\t\t\t\t\t\t\t\tnode = walker.next();\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Keep elements with data-bookmark attributes or name attribute like <a name=\"1\"></a>\n\t\t\t\t\t\tattributes = self.getAttribs(node);\n\t\t\t\t\t\ti = attributes.length;\n\t\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\t\tname = attributes[i].nodeName;\n\t\t\t\t\t\t\tif (name === \"name\" || name === 'data-mce-bookmark') {\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Keep comment nodes\n\t\t\t\t\tif (type == 8) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Keep non whitespace text nodes\n\t\t\t\t\tif ((type === 3 && !whiteSpaceRegExp.test(node.nodeValue))) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tnode = walker.next();\n\t\t\t\t} while (node);\n\t\t\t}\n\n\t\t\treturn brCount <= 1;\n\t\t},\n\n\t\t/**\n\t\t * Creates a new DOM Range object. This will use the native DOM Range API if it's\n\t\t * available. If it's not, it will fall back to the custom TinyMCE implementation.\n\t\t *\n\t\t * @method createRng\n\t\t * @return {DOMRange} DOM Range object.\n\t\t * @example\n\t\t * var rng = tinymce.DOM.createRng();\n\t\t * alert(rng.startContainer + \",\" + rng.startOffset);\n\t\t */\n\t\tcreateRng: function() {\n\t\t\tvar doc = this.doc;\n\n\t\t\treturn doc.createRange ? doc.createRange() : new Range(this);\n\t\t},\n\n\t\t/**\n\t\t * Returns the index of the specified node within its parent.\n\t\t *\n\t\t * @method nodeIndex\n\t\t * @param {Node} node Node to look for.\n\t\t * @param {boolean} normalized Optional true/false state if the index is what it would be after a normalization.\n\t\t * @return {Number} Index of the specified node.\n\t\t */\n\t\tnodeIndex: nodeIndex,\n\n\t\t/**\n\t\t * Splits an element into two new elements and places the specified split\n\t\t * element or elements between the new ones. For example splitting the paragraph at the bold element in\n\t\t * this example <p>abc<b>abc</b>123</p> would produce <p>abc</p><b>abc</b><p>123</p>.\n\t\t *\n\t\t * @method split\n\t\t * @param {Element} parentElm Parent element to split.\n\t\t * @param {Element} splitElm Element to split at.\n\t\t * @param {Element} replacementElm Optional replacement element to replace the split element with.\n\t\t * @return {Element} Returns the split element or the replacement element if that is specified.\n\t\t */\n\t\tsplit: function(parentElm, splitElm, replacementElm) {\n\t\t\tvar self = this, r = self.createRng(), bef, aft, pa;\n\n\t\t\t// W3C valid browsers tend to leave empty nodes to the left/right side of the contents - this makes sense\n\t\t\t// but we don't want that in our code since it serves no purpose for the end user\n\t\t\t// For example splitting this html at the bold element:\n\t\t\t//   <p>text 1<span><b>CHOP</b></span>text 2</p>\n\t\t\t// would produce:\n\t\t\t//   <p>text 1<span></span></p><b>CHOP</b><p><span></span>text 2</p>\n\t\t\t// this function will then trim off empty edges and produce:\n\t\t\t//   <p>text 1</p><b>CHOP</b><p>text 2</p>\n\t\t\tfunction trimNode(node) {\n\t\t\t\tvar i, children = node.childNodes, type = node.nodeType;\n\n\t\t\t\tfunction surroundedBySpans(node) {\n\t\t\t\t\tvar previousIsSpan = node.previousSibling && node.previousSibling.nodeName == 'SPAN';\n\t\t\t\t\tvar nextIsSpan = node.nextSibling && node.nextSibling.nodeName == 'SPAN';\n\t\t\t\t\treturn previousIsSpan && nextIsSpan;\n\t\t\t\t}\n\n\t\t\t\tif (type == 1 && node.getAttribute('data-mce-type') == 'bookmark') {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tfor (i = children.length - 1; i >= 0; i--) {\n\t\t\t\t\ttrimNode(children[i]);\n\t\t\t\t}\n\n\t\t\t\tif (type != 9) {\n\t\t\t\t\t// Keep non whitespace text nodes\n\t\t\t\t\tif (type == 3 && node.nodeValue.length > 0) {\n\t\t\t\t\t\t// If parent element isn't a block or there isn't any useful contents for example \"<p>   </p>\"\n\t\t\t\t\t\t// Also keep text nodes with only spaces if surrounded by spans.\n\t\t\t\t\t\t// eg. \"<p><span>a</span> <span>b</span></p>\" should keep space between a and b\n\t\t\t\t\t\tvar trimmedLength = trim(node.nodeValue).length;\n\t\t\t\t\t\tif (!self.isBlock(node.parentNode) || trimmedLength > 0 || trimmedLength === 0 && surroundedBySpans(node)) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (type == 1) {\n\t\t\t\t\t\t// If the only child is a bookmark then move it up\n\t\t\t\t\t\tchildren = node.childNodes;\n\n\t\t\t\t\t\t// TODO fix this complex if\n\t\t\t\t\t\tif (children.length == 1 && children[0] && children[0].nodeType == 1 &&\n\t\t\t\t\t\t\tchildren[0].getAttribute('data-mce-type') == 'bookmark') {\n\t\t\t\t\t\t\tnode.parentNode.insertBefore(children[0], node);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Keep non empty elements or img, hr etc\n\t\t\t\t\t\tif (children.length || /^(br|hr|input|img)$/i.test(node.nodeName)) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tself.remove(node);\n\t\t\t\t}\n\n\t\t\t\treturn node;\n\t\t\t}\n\n\t\t\tif (parentElm && splitElm) {\n\t\t\t\t// Get before chunk\n\t\t\t\tr.setStart(parentElm.parentNode, self.nodeIndex(parentElm));\n\t\t\t\tr.setEnd(splitElm.parentNode, self.nodeIndex(splitElm));\n\t\t\t\tbef = r.extractContents();\n\n\t\t\t\t// Get after chunk\n\t\t\t\tr = self.createRng();\n\t\t\t\tr.setStart(splitElm.parentNode, self.nodeIndex(splitElm) + 1);\n\t\t\t\tr.setEnd(parentElm.parentNode, self.nodeIndex(parentElm) + 1);\n\t\t\t\taft = r.extractContents();\n\n\t\t\t\t// Insert before chunk\n\t\t\t\tpa = parentElm.parentNode;\n\t\t\t\tpa.insertBefore(trimNode(bef), parentElm);\n\n\t\t\t\t// Insert middle chunk\n\t\t\t\tif (replacementElm) {\n\t\t\t\t\tpa.insertBefore(replacementElm, parentElm);\n\t\t\t\t\t//pa.replaceChild(replacementElm, splitElm);\n\t\t\t\t} else {\n\t\t\t\t\tpa.insertBefore(splitElm, parentElm);\n\t\t\t\t}\n\n\t\t\t\t// Insert after chunk\n\t\t\t\tpa.insertBefore(trimNode(aft), parentElm);\n\t\t\t\tself.remove(parentElm);\n\n\t\t\t\treturn replacementElm || splitElm;\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Adds an event handler to the specified object.\n\t\t *\n\t\t * @method bind\n\t\t * @param {Element/Document/Window/Array} target Target element to bind events to.\n\t\t * handler to or an array of elements/ids/documents.\n\t\t * @param {String} name Name of event handler to add, for example: click.\n\t\t * @param {function} func Function to execute when the event occurs.\n\t\t * @param {Object} scope Optional scope to execute the function in.\n\t\t * @return {function} Function callback handler the same as the one passed in.\n\t\t */\n\t\tbind: function(target, name, func, scope) {\n\t\t\tvar self = this;\n\n\t\t\tif (Tools.isArray(target)) {\n\t\t\t\tvar i = target.length;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\ttarget[i] = self.bind(target[i], name, func, scope);\n\t\t\t\t}\n\n\t\t\t\treturn target;\n\t\t\t}\n\n\t\t\t// Collect all window/document events bound by editor instance\n\t\t\tif (self.settings.collect && (target === self.doc || target === self.win)) {\n\t\t\t\tself.boundEvents.push([target, name, func, scope]);\n\t\t\t}\n\n\t\t\treturn self.events.bind(target, name, func, scope || self);\n\t\t},\n\n\t\t/**\n\t\t * Removes the specified event handler by name and function from an element or collection of elements.\n\t\t *\n\t\t * @method unbind\n\t\t * @param {Element/Document/Window/Array} target Target element to unbind events on.\n\t\t * @param {String} name Event handler name, for example: \"click\"\n\t\t * @param {function} func Function to remove.\n\t\t * @return {bool/Array} Bool state of true if the handler was removed, or an array of states if multiple input elements\n\t\t * were passed in.\n\t\t */\n\t\tunbind: function(target, name, func) {\n\t\t\tvar self = this, i;\n\n\t\t\tif (Tools.isArray(target)) {\n\t\t\t\ti = target.length;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\ttarget[i] = self.unbind(target[i], name, func);\n\t\t\t\t}\n\n\t\t\t\treturn target;\n\t\t\t}\n\n\t\t\t// Remove any bound events matching the input\n\t\t\tif (self.boundEvents && (target === self.doc || target === self.win)) {\n\t\t\t\ti = self.boundEvents.length;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tvar item = self.boundEvents[i];\n\n\t\t\t\t\tif (target == item[0] && (!name || name == item[1]) && (!func || func == item[2])) {\n\t\t\t\t\t\tthis.events.unbind(item[0], item[1], item[2]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn this.events.unbind(target, name, func);\n\t\t},\n\n\t\t/**\n\t\t * Fires the specified event name with object on target.\n\t\t *\n\t\t * @method fire\n\t\t * @param {Node/Document/Window} target Target element or object to fire event on.\n\t\t * @param {String} name Name of the event to fire.\n\t\t * @param {Object} evt Event object to send.\n\t\t * @return {Event} Event object.\n\t\t */\n\t\tfire: function(target, name, evt) {\n\t\t\treturn this.events.fire(target, name, evt);\n\t\t},\n\n\t\t// Returns the content editable state of a node\n\t\tgetContentEditable: function(node) {\n\t\t\tvar contentEditable;\n\n\t\t\t// Check type\n\t\t\tif (!node || node.nodeType != 1) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\t// Check for fake content editable\n\t\t\tcontentEditable = node.getAttribute(\"data-mce-contenteditable\");\n\t\t\tif (contentEditable && contentEditable !== \"inherit\") {\n\t\t\t\treturn contentEditable;\n\t\t\t}\n\n\t\t\t// Check for real content editable\n\t\t\treturn node.contentEditable !== \"inherit\" ? node.contentEditable : null;\n\t\t},\n\n\t\tgetContentEditableParent: function(node) {\n\t\t\tvar root = this.getRoot(), state = null;\n\n\t\t\tfor (; node && node !== root; node = node.parentNode) {\n\t\t\t\tstate = this.getContentEditable(node);\n\n\t\t\t\tif (state !== null) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn state;\n\t\t},\n\n\t\t/**\n\t\t * Destroys all internal references to the DOM to solve IE leak issues.\n\t\t *\n\t\t * @method destroy\n\t\t */\n\t\tdestroy: function() {\n\t\t\tvar self = this;\n\n\t\t\t// Unbind all events bound to window/document by editor instance\n\t\t\tif (self.boundEvents) {\n\t\t\t\tvar i = self.boundEvents.length;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tvar item = self.boundEvents[i];\n\t\t\t\t\tthis.events.unbind(item[0], item[1], item[2]);\n\t\t\t\t}\n\n\t\t\t\tself.boundEvents = null;\n\t\t\t}\n\n\t\t\t// Restore sizzle document to window.document\n\t\t\t// Since the current document might be removed producing \"Permission denied\" on IE see #6325\n\t\t\tif (Sizzle.setDocument) {\n\t\t\t\tSizzle.setDocument();\n\t\t\t}\n\n\t\t\tself.win = self.doc = self.root = self.events = self.frag = null;\n\t\t},\n\n\t\tisChildOf: function(node, parent) {\n\t\t\twhile (node) {\n\t\t\t\tif (parent === node) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tnode = node.parentNode;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\n\t\t// #ifdef debug\n\n\t\tdumpRng: function(r) {\n\t\t\treturn (\n\t\t\t\t'startContainer: ' + r.startContainer.nodeName +\n\t\t\t\t', startOffset: ' + r.startOffset +\n\t\t\t\t', endContainer: ' + r.endContainer.nodeName +\n\t\t\t\t', endOffset: ' + r.endOffset\n\t\t\t);\n\t\t},\n\n\t\t// #endif\n\n\t\t_findSib: function(node, selector, name) {\n\t\t\tvar self = this, func = selector;\n\n\t\t\tif (node) {\n\t\t\t\t// If expression make a function of it using is\n\t\t\t\tif (typeof func == 'string') {\n\t\t\t\t\tfunc = function(node) {\n\t\t\t\t\t\treturn self.is(node, selector);\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\t// Loop all siblings\n\t\t\t\tfor (node = node[name]; node; node = node[name]) {\n\t\t\t\t\tif (func(node)) {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn null;\n\t\t}\n\t};\n\n\t/**\n\t * Instance of DOMUtils for the current document.\n\t *\n\t * @static\n\t * @property DOM\n\t * @type tinymce.dom.DOMUtils\n\t * @example\n\t * // Example of how to add a class to some element by id\n\t * tinymce.DOM.addClass('someid', 'someclass');\n\t */\n\tDOMUtils.DOM = new DOMUtils(document);\n\tDOMUtils.nodeIndex = nodeIndex;\n\n\treturn DOMUtils;\n});\n\n// Included from: js/tinymce/classes/dom/ScriptLoader.js\n\n/**\n * ScriptLoader.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/*globals console*/\n\n/**\n * This class handles asynchronous/synchronous loading of JavaScript files it will execute callbacks\n * when various items gets loaded. This class is useful to load external JavaScript files.\n *\n * @class tinymce.dom.ScriptLoader\n * @example\n * // Load a script from a specific URL using the global script loader\n * tinymce.ScriptLoader.load('somescript.js');\n *\n * // Load a script using a unique instance of the script loader\n * var scriptLoader = new tinymce.dom.ScriptLoader();\n *\n * scriptLoader.load('somescript.js');\n *\n * // Load multiple scripts\n * var scriptLoader = new tinymce.dom.ScriptLoader();\n *\n * scriptLoader.add('somescript1.js');\n * scriptLoader.add('somescript2.js');\n * scriptLoader.add('somescript3.js');\n *\n * scriptLoader.loadQueue(function() {\n *    alert('All scripts are now loaded.');\n * });\n */\ndefine(\"tinymce/dom/ScriptLoader\", [\n\t\"tinymce/dom/DOMUtils\",\n\t\"tinymce/util/Tools\"\n], function(DOMUtils, Tools) {\n\tvar DOM = DOMUtils.DOM;\n\tvar each = Tools.each, grep = Tools.grep;\n\n\tfunction ScriptLoader() {\n\t\tvar QUEUED = 0,\n\t\t\tLOADING = 1,\n\t\t\tLOADED = 2,\n\t\t\tstates = {},\n\t\t\tqueue = [],\n\t\t\tscriptLoadedCallbacks = {},\n\t\t\tqueueLoadedCallbacks = [],\n\t\t\tloading = 0,\n\t\t\tundef;\n\n\t\t/**\n\t\t * Loads a specific script directly without adding it to the load queue.\n\t\t *\n\t\t * @method load\n\t\t * @param {String} url Absolute URL to script to add.\n\t\t * @param {function} callback Optional callback function to execute ones this script gets loaded.\n\t\t */\n\t\tfunction loadScript(url, callback) {\n\t\t\tvar dom = DOM, elm, id;\n\n\t\t\t// Execute callback when script is loaded\n\t\t\tfunction done() {\n\t\t\t\tdom.remove(id);\n\n\t\t\t\tif (elm) {\n\t\t\t\t\telm.onreadystatechange = elm.onload = elm = null;\n\t\t\t\t}\n\n\t\t\t\tcallback();\n\t\t\t}\n\n\t\t\tfunction error() {\n\t\t\t\t/*eslint no-console:0 */\n\n\t\t\t\t// Report the error so it's easier for people to spot loading errors\n\t\t\t\tif (typeof console !== \"undefined\" && console.log) {\n\t\t\t\t\tconsole.log(\"Failed to load: \" + url);\n\t\t\t\t}\n\n\t\t\t\t// We can't mark it as done if there is a load error since\n\t\t\t\t// A) We don't want to produce 404 errors on the server and\n\t\t\t\t// B) the onerror event won't fire on all browsers.\n\t\t\t\t// done();\n\t\t\t}\n\n\t\t\tid = dom.uniqueId();\n\n\t\t\t// Create new script element\n\t\t\telm = document.createElement('script');\n\t\t\telm.id = id;\n\t\t\telm.type = 'text/javascript';\n\t\t\telm.src = Tools._addCacheSuffix(url);\n\n\t\t\t// Seems that onreadystatechange works better on IE 10 onload seems to fire incorrectly\n\t\t\tif (\"onreadystatechange\" in elm) {\n\t\t\t\telm.onreadystatechange = function() {\n\t\t\t\t\tif (/loaded|complete/.test(elm.readyState)) {\n\t\t\t\t\t\tdone();\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\telm.onload = done;\n\t\t\t}\n\n\t\t\t// Add onerror event will get fired on some browsers but not all of them\n\t\t\telm.onerror = error;\n\n\t\t\t// Add script to document\n\t\t\t(document.getElementsByTagName('head')[0] || document.body).appendChild(elm);\n\t\t}\n\n\t\t/**\n\t\t * Returns true/false if a script has been loaded or not.\n\t\t *\n\t\t * @method isDone\n\t\t * @param {String} url URL to check for.\n\t\t * @return {Boolean} true/false if the URL is loaded.\n\t\t */\n\t\tthis.isDone = function(url) {\n\t\t\treturn states[url] == LOADED;\n\t\t};\n\n\t\t/**\n\t\t * Marks a specific script to be loaded. This can be useful if a script got loaded outside\n\t\t * the script loader or to skip it from loading some script.\n\t\t *\n\t\t * @method markDone\n\t\t * @param {string} url Absolute URL to the script to mark as loaded.\n\t\t */\n\t\tthis.markDone = function(url) {\n\t\t\tstates[url] = LOADED;\n\t\t};\n\n\t\t/**\n\t\t * Adds a specific script to the load queue of the script loader.\n\t\t *\n\t\t * @method add\n\t\t * @param {String} url Absolute URL to script to add.\n\t\t * @param {function} callback Optional callback function to execute ones this script gets loaded.\n\t\t * @param {Object} scope Optional scope to execute callback in.\n\t\t */\n\t\tthis.add = this.load = function(url, callback, scope) {\n\t\t\tvar state = states[url];\n\n\t\t\t// Add url to load queue\n\t\t\tif (state == undef) {\n\t\t\t\tqueue.push(url);\n\t\t\t\tstates[url] = QUEUED;\n\t\t\t}\n\n\t\t\tif (callback) {\n\t\t\t\t// Store away callback for later execution\n\t\t\t\tif (!scriptLoadedCallbacks[url]) {\n\t\t\t\t\tscriptLoadedCallbacks[url] = [];\n\t\t\t\t}\n\n\t\t\t\tscriptLoadedCallbacks[url].push({\n\t\t\t\t\tfunc: callback,\n\t\t\t\t\tscope: scope || this\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\n\t\tthis.remove = function(url) {\n\t\t\tdelete states[url];\n\t\t\tdelete scriptLoadedCallbacks[url];\n\t\t};\n\n\t\t/**\n\t\t * Starts the loading of the queue.\n\t\t *\n\t\t * @method loadQueue\n\t\t * @param {function} callback Optional callback to execute when all queued items are loaded.\n\t\t * @param {Object} scope Optional scope to execute the callback in.\n\t\t */\n\t\tthis.loadQueue = function(callback, scope) {\n\t\t\tthis.loadScripts(queue, callback, scope);\n\t\t};\n\n\t\t/**\n\t\t * Loads the specified queue of files and executes the callback ones they are loaded.\n\t\t * This method is generally not used outside this class but it might be useful in some scenarios.\n\t\t *\n\t\t * @method loadScripts\n\t\t * @param {Array} scripts Array of queue items to load.\n\t\t * @param {function} callback Optional callback to execute ones all items are loaded.\n\t\t * @param {Object} scope Optional scope to execute callback in.\n\t\t */\n\t\tthis.loadScripts = function(scripts, callback, scope) {\n\t\t\tvar loadScripts;\n\n\t\t\tfunction execScriptLoadedCallbacks(url) {\n\t\t\t\t// Execute URL callback functions\n\t\t\t\teach(scriptLoadedCallbacks[url], function(callback) {\n\t\t\t\t\tcallback.func.call(callback.scope);\n\t\t\t\t});\n\n\t\t\t\tscriptLoadedCallbacks[url] = undef;\n\t\t\t}\n\n\t\t\tqueueLoadedCallbacks.push({\n\t\t\t\tfunc: callback,\n\t\t\t\tscope: scope || this\n\t\t\t});\n\n\t\t\tloadScripts = function() {\n\t\t\t\tvar loadingScripts = grep(scripts);\n\n\t\t\t\t// Current scripts has been handled\n\t\t\t\tscripts.length = 0;\n\n\t\t\t\t// Load scripts that needs to be loaded\n\t\t\t\teach(loadingScripts, function(url) {\n\t\t\t\t\t// Script is already loaded then execute script callbacks directly\n\t\t\t\t\tif (states[url] == LOADED) {\n\t\t\t\t\t\texecScriptLoadedCallbacks(url);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Is script not loading then start loading it\n\t\t\t\t\tif (states[url] != LOADING) {\n\t\t\t\t\t\tstates[url] = LOADING;\n\t\t\t\t\t\tloading++;\n\n\t\t\t\t\t\tloadScript(url, function() {\n\t\t\t\t\t\t\tstates[url] = LOADED;\n\t\t\t\t\t\t\tloading--;\n\n\t\t\t\t\t\t\texecScriptLoadedCallbacks(url);\n\n\t\t\t\t\t\t\t// Load more scripts if they where added by the recently loaded script\n\t\t\t\t\t\t\tloadScripts();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// No scripts are currently loading then execute all pending queue loaded callbacks\n\t\t\t\tif (!loading) {\n\t\t\t\t\teach(queueLoadedCallbacks, function(callback) {\n\t\t\t\t\t\tcallback.func.call(callback.scope);\n\t\t\t\t\t});\n\n\t\t\t\t\tqueueLoadedCallbacks.length = 0;\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tloadScripts();\n\t\t};\n\t}\n\n\tScriptLoader.ScriptLoader = new ScriptLoader();\n\n\treturn ScriptLoader;\n});\n\n// Included from: js/tinymce/classes/AddOnManager.js\n\n/**\n * AddOnManager.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class handles the loading of themes/plugins or other add-ons and their language packs.\n *\n * @class tinymce.AddOnManager\n */\ndefine(\"tinymce/AddOnManager\", [\n\t\"tinymce/dom/ScriptLoader\",\n\t\"tinymce/util/Tools\"\n], function(ScriptLoader, Tools) {\n\tvar each = Tools.each;\n\n\tfunction AddOnManager() {\n\t\tvar self = this;\n\n\t\tself.items = [];\n\t\tself.urls = {};\n\t\tself.lookup = {};\n\t}\n\n\tAddOnManager.prototype = {\n\t\t/**\n\t\t * Returns the specified add on by the short name.\n\t\t *\n\t\t * @method get\n\t\t * @param {String} name Add-on to look for.\n\t\t * @return {tinymce.Theme/tinymce.Plugin} Theme or plugin add-on instance or undefined.\n\t\t */\n\t\tget: function(name) {\n\t\t\tif (this.lookup[name]) {\n\t\t\t\treturn this.lookup[name].instance;\n\t\t\t}\n\n\t\t\treturn undefined;\n\t\t},\n\n\t\tdependencies: function(name) {\n\t\t\tvar result;\n\n\t\t\tif (this.lookup[name]) {\n\t\t\t\tresult = this.lookup[name].dependencies;\n\t\t\t}\n\n\t\t\treturn result || [];\n\t\t},\n\n\t\t/**\n\t\t * Loads a language pack for the specified add-on.\n\t\t *\n\t\t * @method requireLangPack\n\t\t * @param {String} name Short name of the add-on.\n\t\t * @param {String} languages Optional comma or space separated list of languages to check if it matches the name.\n\t\t */\n\t\trequireLangPack: function(name, languages) {\n\t\t\tvar language = AddOnManager.language;\n\n\t\t\tif (language && AddOnManager.languageLoad !== false) {\n\t\t\t\tif (languages) {\n\t\t\t\t\tlanguages = ',' + languages + ',';\n\n\t\t\t\t\t// Load short form sv.js or long form sv_SE.js\n\t\t\t\t\tif (languages.indexOf(',' + language.substr(0, 2) + ',') != -1) {\n\t\t\t\t\t\tlanguage = language.substr(0, 2);\n\t\t\t\t\t} else if (languages.indexOf(',' + language + ',') == -1) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tScriptLoader.ScriptLoader.add(this.urls[name] + '/langs/' + language + '.js');\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Adds a instance of the add-on by it's short name.\n\t\t *\n\t\t * @method add\n\t\t * @param {String} id Short name/id for the add-on.\n\t\t * @param {tinymce.Theme/tinymce.Plugin} addOn Theme or plugin to add.\n\t\t * @return {tinymce.Theme/tinymce.Plugin} The same theme or plugin instance that got passed in.\n\t\t * @example\n\t\t * // Create a simple plugin\n\t\t * tinymce.create('tinymce.plugins.TestPlugin', {\n\t\t *   TestPlugin: function(ed, url) {\n\t\t *   ed.on('click', function(e) {\n\t\t *      ed.windowManager.alert('Hello World!');\n\t\t *   });\n\t\t *   }\n\t\t * });\n\t\t *\n\t\t * // Register plugin using the add method\n\t\t * tinymce.PluginManager.add('test', tinymce.plugins.TestPlugin);\n\t\t *\n\t\t * // Initialize TinyMCE\n\t\t * tinymce.init({\n\t\t *  ...\n\t\t *  plugins: '-test' // Init the plugin but don't try to load it\n\t\t * });\n\t\t */\n\t\tadd: function(id, addOn, dependencies) {\n\t\t\tthis.items.push(addOn);\n\t\t\tthis.lookup[id] = {instance: addOn, dependencies: dependencies};\n\n\t\t\treturn addOn;\n\t\t},\n\n\t\tremove: function(name) {\n\t\t\tdelete this.urls[name];\n\t\t\tdelete this.lookup[name];\n\t\t},\n\n\t\tcreateUrl: function(baseUrl, dep) {\n\t\t\tif (typeof dep === \"object\") {\n\t\t\t\treturn dep;\n\t\t\t}\n\n\t\t\treturn {prefix: baseUrl.prefix, resource: dep, suffix: baseUrl.suffix};\n\t\t},\n\n\t\t/**\n\t\t * Add a set of components that will make up the add-on. Using the url of the add-on name as the base url.\n\t\t * This should be used in development mode.  A new compressor/javascript munger process will ensure that the\n\t\t * components are put together into the plugin.js file and compressed correctly.\n\t\t *\n\t\t * @method addComponents\n\t\t * @param {String} pluginName name of the plugin to load scripts from (will be used to get the base url for the plugins).\n\t\t * @param {Array} scripts Array containing the names of the scripts to load.\n\t\t */\n\t\taddComponents: function(pluginName, scripts) {\n\t\t\tvar pluginUrl = this.urls[pluginName];\n\n\t\t\teach(scripts, function(script) {\n\t\t\t\tScriptLoader.ScriptLoader.add(pluginUrl + \"/\" + script);\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Loads an add-on from a specific url.\n\t\t *\n\t\t * @method load\n\t\t * @param {String} name Short name of the add-on that gets loaded.\n\t\t * @param {String} addOnUrl URL to the add-on that will get loaded.\n\t\t * @param {function} callback Optional callback to execute ones the add-on is loaded.\n\t\t * @param {Object} scope Optional scope to execute the callback in.\n\t\t * @example\n\t\t * // Loads a plugin from an external URL\n\t\t * tinymce.PluginManager.load('myplugin', '/some/dir/someplugin/plugin.js');\n\t\t *\n\t\t * // Initialize TinyMCE\n\t\t * tinymce.init({\n\t\t *  ...\n\t\t *  plugins: '-myplugin' // Don't try to load it again\n\t\t * });\n\t\t */\n\t\tload: function(name, addOnUrl, callback, scope) {\n\t\t\tvar self = this, url = addOnUrl;\n\n\t\t\tfunction loadDependencies() {\n\t\t\t\tvar dependencies = self.dependencies(name);\n\n\t\t\t\teach(dependencies, function(dep) {\n\t\t\t\t\tvar newUrl = self.createUrl(addOnUrl, dep);\n\n\t\t\t\t\tself.load(newUrl.resource, newUrl, undefined, undefined);\n\t\t\t\t});\n\n\t\t\t\tif (callback) {\n\t\t\t\t\tif (scope) {\n\t\t\t\t\t\tcallback.call(scope);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcallback.call(ScriptLoader);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (self.urls[name]) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (typeof addOnUrl === \"object\") {\n\t\t\t\turl = addOnUrl.prefix + addOnUrl.resource + addOnUrl.suffix;\n\t\t\t}\n\n\t\t\tif (url.indexOf('/') !== 0 && url.indexOf('://') == -1) {\n\t\t\t\turl = AddOnManager.baseURL + '/' + url;\n\t\t\t}\n\n\t\t\tself.urls[name] = url.substring(0, url.lastIndexOf('/'));\n\n\t\t\tif (self.lookup[name]) {\n\t\t\t\tloadDependencies();\n\t\t\t} else {\n\t\t\t\tScriptLoader.ScriptLoader.add(url, loadDependencies, scope);\n\t\t\t}\n\t\t}\n\t};\n\n\tAddOnManager.PluginManager = new AddOnManager();\n\tAddOnManager.ThemeManager = new AddOnManager();\n\n\treturn AddOnManager;\n});\n\n/**\n * TinyMCE theme class.\n *\n * @class tinymce.Theme\n */\n\n/**\n * This method is responsible for rendering/generating the overall user interface with toolbars, buttons, iframe containers etc.\n *\n * @method renderUI\n * @param {Object} obj Object parameter containing the targetNode DOM node that will be replaced visually with an editor instance.\n * @return {Object} an object with items like iframeContainer, editorContainer, sizeContainer, deltaWidth, deltaHeight.\n */\n\n/**\n * Plugin base class, this is a pseudo class that describes how a plugin is to be created for TinyMCE. The methods below are all optional.\n *\n * @class tinymce.Plugin\n * @example\n * tinymce.PluginManager.add('example', function(editor, url) {\n *     // Add a button that opens a window\n *     editor.addButton('example', {\n *         text: 'My button',\n *         icon: false,\n *         onclick: function() {\n *             // Open window\n *             editor.windowManager.open({\n *                 title: 'Example plugin',\n *                 body: [\n *                     {type: 'textbox', name: 'title', label: 'Title'}\n *                 ],\n *                 onsubmit: function(e) {\n *                     // Insert content when the window form is submitted\n *                     editor.insertContent('Title: ' + e.data.title);\n *                 }\n *             });\n *         }\n *     });\n *\n *     // Adds a menu item to the tools menu\n *     editor.addMenuItem('example', {\n *         text: 'Example plugin',\n *         context: 'tools',\n *         onclick: function() {\n *             // Open window with a specific url\n *             editor.windowManager.open({\n *                 title: 'TinyMCE site',\n *                 url: 'http://www.tinymce.com',\n *                 width: 800,\n *                 height: 600,\n *                 buttons: [{\n *                     text: 'Close',\n *                     onclick: 'close'\n *                 }]\n *             });\n *         }\n *     });\n * });\n */\n\n// Included from: js/tinymce/classes/dom/NodeType.js\n\n/**\n * NodeType.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Contains various node validation functions.\n *\n * @private\n * @class tinymce.dom.NodeType\n */\ndefine(\"tinymce/dom/NodeType\", [], function() {\n\tfunction isNodeType(type) {\n\t\treturn function(node) {\n\t\t\treturn !!node && node.nodeType == type;\n\t\t};\n\t}\n\n\tvar isElement = isNodeType(1);\n\n\tfunction matchNodeNames(names) {\n\t\tnames = names.toLowerCase().split(' ');\n\n\t\treturn function(node) {\n\t\t\tvar i, name;\n\n\t\t\tif (node && node.nodeType) {\n\t\t\t\tname = node.nodeName.toLowerCase();\n\n\t\t\t\tfor (i = 0; i < names.length; i++) {\n\t\t\t\t\tif (name === names[i]) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t};\n\t}\n\n\tfunction matchStyleValues(name, values) {\n\t\tvalues = values.toLowerCase().split(' ');\n\n\t\treturn function(node) {\n\t\t\tvar i, cssValue;\n\n\t\t\tif (isElement(node)) {\n\t\t\t\tfor (i = 0; i < values.length; i++) {\n\t\t\t\t\tcssValue = getComputedStyle(node, null).getPropertyValue(name);\n\t\t\t\t\tif (cssValue === values[i]) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t};\n\t}\n\n\tfunction hasPropValue(propName, propValue) {\n\t\treturn function(node) {\n\t\t\treturn isElement(node) && node[propName] === propValue;\n\t\t};\n\t}\n\n\tfunction hasAttributeValue(attrName, attrValue) {\n\t\treturn function(node) {\n\t\t\treturn isElement(node) && node.getAttribute(attrName) === attrValue;\n\t\t};\n\t}\n\n\tfunction isBogus(node) {\n\t\treturn isElement(node) && node.hasAttribute('data-mce-bogus');\n\t}\n\n\tfunction hasContentEditableState(value) {\n\t\treturn function(node) {\n\t\t\tif (isElement(node)) {\n\t\t\t\tif (node.contentEditable === value) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tif (node.getAttribute('data-mce-contenteditable') === value) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t};\n\t}\n\n\treturn {\n\t\tisText: isNodeType(3),\n\t\tisElement: isElement,\n\t\tisComment: isNodeType(8),\n\t\tisBr: matchNodeNames('br'),\n\t\tisContentEditableTrue: hasContentEditableState('true'),\n\t\tisContentEditableFalse: hasContentEditableState('false'),\n\t\tmatchNodeNames: matchNodeNames,\n\t\thasPropValue: hasPropValue,\n\t\thasAttributeValue: hasAttributeValue,\n\t\tmatchStyleValues: matchStyleValues,\n\t\tisBogus: isBogus\n\t};\n});\n\n// Included from: js/tinymce/classes/text/Zwsp.js\n\n/**\n * Zwsp.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Utility functions for working with zero width space\n * characters used as character containers etc.\n *\n * @private\n * @class tinymce.text.Zwsp\n * @example\n * var isZwsp = Zwsp.isZwsp('\\uFEFF');\n * var abc = Zwsp.trim('a\\uFEFFc');\n */\ndefine(\"tinymce/text/Zwsp\", [], function() {\n\tvar ZWSP = '\\uFEFF';\n\n\tfunction isZwsp(chr) {\n\t\treturn chr == ZWSP;\n\t}\n\n\tfunction trim(str) {\n\t\treturn str.replace(new RegExp(ZWSP, 'g'), '');\n\t}\n\n\treturn {\n\t\tisZwsp: isZwsp,\n\t\tZWSP: ZWSP,\n\t\ttrim: trim\n\t};\n});\n\n// Included from: js/tinymce/classes/caret/CaretContainer.js\n\n/**\n * CaretContainer.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This module handles caret containers. A caret container is a node that\n * holds the caret for positional purposes.\n *\n * @private\n * @class tinymce.caret.CaretContainer\n */\ndefine(\"tinymce/caret/CaretContainer\", [\n\t\"tinymce/dom/NodeType\",\n\t\"tinymce/text/Zwsp\"\n], function(NodeType, Zwsp) {\n\tvar isElement = NodeType.isElement,\n\t\tisText = NodeType.isText;\n\n\tfunction isCaretContainerBlock(node) {\n\t\tif (isText(node)) {\n\t\t\tnode = node.parentNode;\n\t\t}\n\n\t\treturn isElement(node) && node.hasAttribute('data-mce-caret');\n\t}\n\n\tfunction isCaretContainerInline(node) {\n\t\treturn isText(node) && Zwsp.isZwsp(node.data);\n\t}\n\n\tfunction isCaretContainer(node) {\n\t\treturn isCaretContainerBlock(node) || isCaretContainerInline(node);\n\t}\n\n\tfunction removeNode(node) {\n\t\tvar parentNode = node.parentNode;\n\t\tif (parentNode) {\n\t\t\tparentNode.removeChild(node);\n\t\t}\n\t}\n\n\tfunction getNodeValue(node) {\n\t\ttry {\n\t\t\treturn node.nodeValue;\n\t\t} catch (ex) {\n\t\t\t// IE sometimes produces \"Invalid argument\" on nodes\n\t\t\treturn \"\";\n\t\t}\n\t}\n\n\tfunction setNodeValue(node, text) {\n\t\tif (text.length === 0) {\n\t\t\tremoveNode(node);\n\t\t} else {\n\t\t\tnode.nodeValue = text;\n\t\t}\n\t}\n\n\tfunction insertInline(node, before) {\n\t\tvar doc, sibling, textNode, parentNode;\n\n\t\tdoc = node.ownerDocument;\n\t\ttextNode = doc.createTextNode(Zwsp.ZWSP);\n\t\tparentNode = node.parentNode;\n\n\t\tif (!before) {\n\t\t\tsibling = node.nextSibling;\n\t\t\tif (isText(sibling)) {\n\t\t\t\tif (isCaretContainer(sibling)) {\n\t\t\t\t\treturn sibling;\n\t\t\t\t}\n\n\t\t\t\tif (startsWithCaretContainer(sibling)) {\n\t\t\t\t\tsibling.splitText(1);\n\t\t\t\t\treturn sibling;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (node.nextSibling) {\n\t\t\t\tparentNode.insertBefore(textNode, node.nextSibling);\n\t\t\t} else {\n\t\t\t\tparentNode.appendChild(textNode);\n\t\t\t}\n\t\t} else {\n\t\t\tsibling = node.previousSibling;\n\t\t\tif (isText(sibling)) {\n\t\t\t\tif (isCaretContainer(sibling)) {\n\t\t\t\t\treturn sibling;\n\t\t\t\t}\n\n\t\t\t\tif (endsWithCaretContainer(sibling)) {\n\t\t\t\t\treturn sibling.splitText(sibling.data.length - 1);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tparentNode.insertBefore(textNode, node);\n\t\t}\n\n\t\treturn textNode;\n\t}\n\n\tfunction createBogusBr() {\n\t\tvar br = document.createElement('br');\n\t\tbr.setAttribute('data-mce-bogus', '1');\n\t\treturn br;\n\t}\n\n\tfunction insertBlock(blockName, node, before) {\n\t\tvar doc, blockNode, parentNode;\n\n\t\tdoc = node.ownerDocument;\n\t\tblockNode = doc.createElement(blockName);\n\t\tblockNode.setAttribute('data-mce-caret', before ? 'before' : 'after');\n\t\tblockNode.setAttribute('data-mce-bogus', 'all');\n\t\tblockNode.appendChild(createBogusBr());\n\t\tparentNode = node.parentNode;\n\n\t\tif (!before) {\n\t\t\tif (node.nextSibling) {\n\t\t\t\tparentNode.insertBefore(blockNode, node.nextSibling);\n\t\t\t} else {\n\t\t\t\tparentNode.appendChild(blockNode);\n\t\t\t}\n\t\t} else {\n\t\t\tparentNode.insertBefore(blockNode, node);\n\t\t}\n\n\t\treturn blockNode;\n\t}\n\n\tfunction hasContent(node) {\n\t\treturn node.firstChild !== node.lastChild || !NodeType.isBr(node.firstChild);\n\t}\n\n\tfunction remove(caretContainerNode) {\n\t\tif (isElement(caretContainerNode) && isCaretContainer(caretContainerNode)) {\n\t\t\tif (hasContent(caretContainerNode)) {\n\t\t\t\tcaretContainerNode.removeAttribute('data-mce-caret');\n\t\t\t} else {\n\t\t\t\tremoveNode(caretContainerNode);\n\t\t\t}\n\t\t}\n\n\t\tif (isText(caretContainerNode)) {\n\t\t\tvar text = Zwsp.trim(getNodeValue(caretContainerNode));\n\t\t\tsetNodeValue(caretContainerNode, text);\n\t\t}\n\t}\n\n\tfunction startsWithCaretContainer(node) {\n\t\treturn isText(node) && node.data[0] == Zwsp.ZWSP;\n\t}\n\n\tfunction endsWithCaretContainer(node) {\n\t\treturn isText(node) && node.data[node.data.length - 1] == Zwsp.ZWSP;\n\t}\n\n\tfunction trimBogusBr(elm) {\n\t\tvar brs = elm.getElementsByTagName('br');\n\t\tvar lastBr = brs[brs.length - 1];\n\t\tif (NodeType.isBogus(lastBr)) {\n\t\t\tlastBr.parentNode.removeChild(lastBr);\n\t\t}\n\t}\n\n\tfunction showCaretContainerBlock(caretContainer) {\n\t\tif (caretContainer && caretContainer.hasAttribute('data-mce-caret')) {\n\t\t\ttrimBogusBr(caretContainer);\n\t\t\tcaretContainer.removeAttribute('data-mce-caret');\n\t\t\tcaretContainer.removeAttribute('data-mce-bogus');\n\t\t\tcaretContainer.removeAttribute('style');\n\t\t\tcaretContainer.removeAttribute('_moz_abspos');\n\t\t\treturn caretContainer;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\treturn {\n\t\tisCaretContainer: isCaretContainer,\n\t\tisCaretContainerBlock: isCaretContainerBlock,\n\t\tisCaretContainerInline: isCaretContainerInline,\n\t\tshowCaretContainerBlock: showCaretContainerBlock,\n\t\tinsertInline: insertInline,\n\t\tinsertBlock: insertBlock,\n\t\thasContent: hasContent,\n\t\tremove: remove,\n\t\tstartsWithCaretContainer: startsWithCaretContainer,\n\t\tendsWithCaretContainer: endsWithCaretContainer\n\t};\n});\n\n// Included from: js/tinymce/classes/dom/RangeUtils.js\n\n/**\n * RangeUtils.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class contains a few utility methods for ranges.\n *\n * @class tinymce.dom.RangeUtils\n */\ndefine(\"tinymce/dom/RangeUtils\", [\n\t\"tinymce/util/Tools\",\n\t\"tinymce/dom/TreeWalker\",\n\t\"tinymce/dom/NodeType\",\n\t\"tinymce/dom/Range\",\n\t\"tinymce/caret/CaretContainer\"\n], function(Tools, TreeWalker, NodeType, Range, CaretContainer) {\n\tvar each = Tools.each,\n\t\tisContentEditableTrue = NodeType.isContentEditableTrue,\n\t\tisContentEditableFalse = NodeType.isContentEditableFalse,\n\t\tisCaretContainer = CaretContainer.isCaretContainer;\n\n\tfunction hasCeProperty(node) {\n\t\treturn isContentEditableTrue(node) || isContentEditableFalse(node);\n\t}\n\n\tfunction getEndChild(container, index) {\n\t\tvar childNodes = container.childNodes;\n\n\t\tindex--;\n\n\t\tif (index > childNodes.length - 1) {\n\t\t\tindex = childNodes.length - 1;\n\t\t} else if (index < 0) {\n\t\t\tindex = 0;\n\t\t}\n\n\t\treturn childNodes[index] || container;\n\t}\n\n\tfunction findParent(node, rootNode, predicate) {\n\t\twhile (node && node !== rootNode) {\n\t\t\tif (predicate(node)) {\n\t\t\t\treturn node;\n\t\t\t}\n\n\t\t\tnode = node.parentNode;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tfunction hasParent(node, rootNode, predicate) {\n\t\treturn findParent(node, rootNode, predicate) !== null;\n\t}\n\n\tfunction isFormatterCaret(node) {\n\t\treturn node.id === '_mce_caret';\n\t}\n\n\tfunction isCeFalseCaretContainer(node, rootNode) {\n\t\treturn isCaretContainer(node) && hasParent(node, rootNode, isFormatterCaret) === false;\n\t}\n\n\tfunction RangeUtils(dom) {\n\t\t/**\n\t\t * Walks the specified range like object and executes the callback for each sibling collection it finds.\n\t\t *\n\t\t * @private\n\t\t * @method walk\n\t\t * @param {Object} rng Range like object.\n\t\t * @param {function} callback Callback function to execute for each sibling collection.\n\t\t */\n\t\tthis.walk = function(rng, callback) {\n\t\t\tvar startContainer = rng.startContainer,\n\t\t\t\tstartOffset = rng.startOffset,\n\t\t\t\tendContainer = rng.endContainer,\n\t\t\t\tendOffset = rng.endOffset,\n\t\t\t\tancestor, startPoint,\n\t\t\t\tendPoint, node, parent, siblings, nodes;\n\n\t\t\t// Handle table cell selection the table plugin enables\n\t\t\t// you to fake select table cells and perform formatting actions on them\n\t\t\tnodes = dom.select('td[data-mce-selected],th[data-mce-selected]');\n\t\t\tif (nodes.length > 0) {\n\t\t\t\teach(nodes, function(node) {\n\t\t\t\t\tcallback([node]);\n\t\t\t\t});\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Excludes start/end text node if they are out side the range\n\t\t\t *\n\t\t\t * @private\n\t\t\t * @param {Array} nodes Nodes to exclude items from.\n\t\t\t * @return {Array} Array with nodes excluding the start/end container if needed.\n\t\t\t */\n\t\t\tfunction exclude(nodes) {\n\t\t\t\tvar node;\n\n\t\t\t\t// First node is excluded\n\t\t\t\tnode = nodes[0];\n\t\t\t\tif (node.nodeType === 3 && node === startContainer && startOffset >= node.nodeValue.length) {\n\t\t\t\t\tnodes.splice(0, 1);\n\t\t\t\t}\n\n\t\t\t\t// Last node is excluded\n\t\t\t\tnode = nodes[nodes.length - 1];\n\t\t\t\tif (endOffset === 0 && nodes.length > 0 && node === endContainer && node.nodeType === 3) {\n\t\t\t\t\tnodes.splice(nodes.length - 1, 1);\n\t\t\t\t}\n\n\t\t\t\treturn nodes;\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Collects siblings\n\t\t\t *\n\t\t\t * @private\n\t\t\t * @param {Node} node Node to collect siblings from.\n\t\t\t * @param {String} name Name of the sibling to check for.\n\t\t\t * @param {Node} end_node\n\t\t\t * @return {Array} Array of collected siblings.\n\t\t\t */\n\t\t\tfunction collectSiblings(node, name, end_node) {\n\t\t\t\tvar siblings = [];\n\n\t\t\t\tfor (; node && node != end_node; node = node[name]) {\n\t\t\t\t\tsiblings.push(node);\n\t\t\t\t}\n\n\t\t\t\treturn siblings;\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Find an end point this is the node just before the common ancestor root.\n\t\t\t *\n\t\t\t * @private\n\t\t\t * @param {Node} node Node to start at.\n\t\t\t * @param {Node} root Root/ancestor element to stop just before.\n\t\t\t * @return {Node} Node just before the root element.\n\t\t\t */\n\t\t\tfunction findEndPoint(node, root) {\n\t\t\t\tdo {\n\t\t\t\t\tif (node.parentNode == root) {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t}\n\n\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t} while (node);\n\t\t\t}\n\n\t\t\tfunction walkBoundary(start_node, end_node, next) {\n\t\t\t\tvar siblingName = next ? 'nextSibling' : 'previousSibling';\n\n\t\t\t\tfor (node = start_node, parent = node.parentNode; node && node != end_node; node = parent) {\n\t\t\t\t\tparent = node.parentNode;\n\t\t\t\t\tsiblings = collectSiblings(node == start_node ? node : node[siblingName], siblingName);\n\n\t\t\t\t\tif (siblings.length) {\n\t\t\t\t\t\tif (!next) {\n\t\t\t\t\t\t\tsiblings.reverse();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcallback(exclude(siblings));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// If index based start position then resolve it\n\t\t\tif (startContainer.nodeType == 1 && startContainer.hasChildNodes()) {\n\t\t\t\tstartContainer = startContainer.childNodes[startOffset];\n\t\t\t}\n\n\t\t\t// If index based end position then resolve it\n\t\t\tif (endContainer.nodeType == 1 && endContainer.hasChildNodes()) {\n\t\t\t\tendContainer = getEndChild(endContainer, endOffset);\n\t\t\t}\n\n\t\t\t// Same container\n\t\t\tif (startContainer == endContainer) {\n\t\t\t\treturn callback(exclude([startContainer]));\n\t\t\t}\n\n\t\t\t// Find common ancestor and end points\n\t\t\tancestor = dom.findCommonAncestor(startContainer, endContainer);\n\n\t\t\t// Process left side\n\t\t\tfor (node = startContainer; node; node = node.parentNode) {\n\t\t\t\tif (node === endContainer) {\n\t\t\t\t\treturn walkBoundary(startContainer, ancestor, true);\n\t\t\t\t}\n\n\t\t\t\tif (node === ancestor) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Process right side\n\t\t\tfor (node = endContainer; node; node = node.parentNode) {\n\t\t\t\tif (node === startContainer) {\n\t\t\t\t\treturn walkBoundary(endContainer, ancestor);\n\t\t\t\t}\n\n\t\t\t\tif (node === ancestor) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Find start/end point\n\t\t\tstartPoint = findEndPoint(startContainer, ancestor) || startContainer;\n\t\t\tendPoint = findEndPoint(endContainer, ancestor) || endContainer;\n\n\t\t\t// Walk left leaf\n\t\t\twalkBoundary(startContainer, startPoint, true);\n\n\t\t\t// Walk the middle from start to end point\n\t\t\tsiblings = collectSiblings(\n\t\t\t\tstartPoint == startContainer ? startPoint : startPoint.nextSibling,\n\t\t\t\t'nextSibling',\n\t\t\t\tendPoint == endContainer ? endPoint.nextSibling : endPoint\n\t\t\t);\n\n\t\t\tif (siblings.length) {\n\t\t\t\tcallback(exclude(siblings));\n\t\t\t}\n\n\t\t\t// Walk right leaf\n\t\t\twalkBoundary(endContainer, endPoint);\n\t\t};\n\n\t\t/**\n\t\t * Splits the specified range at it's start/end points.\n\t\t *\n\t\t * @private\n\t\t * @param {Range/RangeObject} rng Range to split.\n\t\t * @return {Object} Range position object.\n\t\t */\n\t\tthis.split = function(rng) {\n\t\t\tvar startContainer = rng.startContainer,\n\t\t\t\tstartOffset = rng.startOffset,\n\t\t\t\tendContainer = rng.endContainer,\n\t\t\t\tendOffset = rng.endOffset;\n\n\t\t\tfunction splitText(node, offset) {\n\t\t\t\treturn node.splitText(offset);\n\t\t\t}\n\n\t\t\t// Handle single text node\n\t\t\tif (startContainer == endContainer && startContainer.nodeType == 3) {\n\t\t\t\tif (startOffset > 0 && startOffset < startContainer.nodeValue.length) {\n\t\t\t\t\tendContainer = splitText(startContainer, startOffset);\n\t\t\t\t\tstartContainer = endContainer.previousSibling;\n\n\t\t\t\t\tif (endOffset > startOffset) {\n\t\t\t\t\t\tendOffset = endOffset - startOffset;\n\t\t\t\t\t\tstartContainer = endContainer = splitText(endContainer, endOffset).previousSibling;\n\t\t\t\t\t\tendOffset = endContainer.nodeValue.length;\n\t\t\t\t\t\tstartOffset = 0;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tendOffset = 0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Split startContainer text node if needed\n\t\t\t\tif (startContainer.nodeType == 3 && startOffset > 0 && startOffset < startContainer.nodeValue.length) {\n\t\t\t\t\tstartContainer = splitText(startContainer, startOffset);\n\t\t\t\t\tstartOffset = 0;\n\t\t\t\t}\n\n\t\t\t\t// Split endContainer text node if needed\n\t\t\t\tif (endContainer.nodeType == 3 && endOffset > 0 && endOffset < endContainer.nodeValue.length) {\n\t\t\t\t\tendContainer = splitText(endContainer, endOffset).previousSibling;\n\t\t\t\t\tendOffset = endContainer.nodeValue.length;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tstartContainer: startContainer,\n\t\t\t\tstartOffset: startOffset,\n\t\t\t\tendContainer: endContainer,\n\t\t\t\tendOffset: endOffset\n\t\t\t};\n\t\t};\n\n\t\t/**\n\t\t * Normalizes the specified range by finding the closest best suitable caret location.\n\t\t *\n\t\t * @private\n\t\t * @param {Range} rng Range to normalize.\n\t\t * @return {Boolean} True/false if the specified range was normalized or not.\n\t\t */\n\t\tthis.normalize = function(rng) {\n\t\t\tvar normalized, collapsed;\n\n\t\t\tfunction normalizeEndPoint(start) {\n\t\t\t\tvar container, offset, walker, body = dom.getRoot(), node, nonEmptyElementsMap;\n\t\t\t\tvar directionLeft, isAfterNode;\n\n\t\t\t\tfunction isTableCell(node) {\n\t\t\t\t\treturn node && /^(TD|TH|CAPTION)$/.test(node.nodeName);\n\t\t\t\t}\n\n\t\t\t\tfunction hasBrBeforeAfter(node, left) {\n\t\t\t\t\tvar walker = new TreeWalker(node, dom.getParent(node.parentNode, dom.isBlock) || body);\n\n\t\t\t\t\twhile ((node = walker[left ? 'prev' : 'next']())) {\n\t\t\t\t\t\tif (node.nodeName === \"BR\") {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction hasContentEditableFalseParent(node) {\n\t\t\t\t\twhile (node && node != body) {\n\t\t\t\t\t\tif (isContentEditableFalse(node)) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tfunction isPrevNode(node, name) {\n\t\t\t\t\treturn node.previousSibling && node.previousSibling.nodeName == name;\n\t\t\t\t}\n\n\t\t\t\t// Walks the dom left/right to find a suitable text node to move the endpoint into\n\t\t\t\t// It will only walk within the current parent block or body and will stop if it hits a block or a BR/IMG\n\t\t\t\tfunction findTextNodeRelative(left, startNode) {\n\t\t\t\t\tvar walker, lastInlineElement, parentBlockContainer;\n\n\t\t\t\t\tstartNode = startNode || container;\n\t\t\t\t\tparentBlockContainer = dom.getParent(startNode.parentNode, dom.isBlock) || body;\n\n\t\t\t\t\t// Lean left before the BR element if it's the only BR within a block element. Gecko bug: #6680\n\t\t\t\t\t// This: <p><br>|</p> becomes <p>|<br></p>\n\t\t\t\t\tif (left && startNode.nodeName == 'BR' && isAfterNode && dom.isEmpty(parentBlockContainer)) {\n\t\t\t\t\t\tcontainer = startNode.parentNode;\n\t\t\t\t\t\toffset = dom.nodeIndex(startNode);\n\t\t\t\t\t\tnormalized = true;\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Walk left until we hit a text node we can move to or a block/br/img\n\t\t\t\t\twalker = new TreeWalker(startNode, parentBlockContainer);\n\t\t\t\t\twhile ((node = walker[left ? 'prev' : 'next']())) {\n\t\t\t\t\t\t// Break if we hit a non content editable node\n\t\t\t\t\t\tif (dom.getContentEditableParent(node) === \"false\" || isCeFalseCaretContainer(node, dom.getRoot())) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Found text node that has a length\n\t\t\t\t\t\tif (node.nodeType === 3 && node.nodeValue.length > 0) {\n\t\t\t\t\t\t\tcontainer = node;\n\t\t\t\t\t\t\toffset = left ? node.nodeValue.length : 0;\n\t\t\t\t\t\t\tnormalized = true;\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Break if we find a block or a BR/IMG/INPUT etc\n\t\t\t\t\t\tif (dom.isBlock(node) || nonEmptyElementsMap[node.nodeName.toLowerCase()]) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tlastInlineElement = node;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Only fetch the last inline element when in caret mode for now\n\t\t\t\t\tif (collapsed && lastInlineElement) {\n\t\t\t\t\t\tcontainer = lastInlineElement;\n\t\t\t\t\t\tnormalized = true;\n\t\t\t\t\t\toffset = 0;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tcontainer = rng[(start ? 'start' : 'end') + 'Container'];\n\t\t\t\toffset = rng[(start ? 'start' : 'end') + 'Offset'];\n\t\t\t\tisAfterNode = container.nodeType == 1 && offset === container.childNodes.length;\n\t\t\t\tnonEmptyElementsMap = dom.schema.getNonEmptyElements();\n\t\t\t\tdirectionLeft = start;\n\n\t\t\t\tif (isCaretContainer(container)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (container.nodeType == 1 && offset > container.childNodes.length - 1) {\n\t\t\t\t\tdirectionLeft = false;\n\t\t\t\t}\n\n\t\t\t\t// If the container is a document move it to the body element\n\t\t\t\tif (container.nodeType === 9) {\n\t\t\t\t\tcontainer = dom.getRoot();\n\t\t\t\t\toffset = 0;\n\t\t\t\t}\n\n\t\t\t\t// If the container is body try move it into the closest text node or position\n\t\t\t\tif (container === body) {\n\t\t\t\t\t// If start is before/after a image, table etc\n\t\t\t\t\tif (directionLeft) {\n\t\t\t\t\t\tnode = container.childNodes[offset > 0 ? offset - 1 : 0];\n\t\t\t\t\t\tif (node) {\n\t\t\t\t\t\t\tif (isCaretContainer(node)) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (nonEmptyElementsMap[node.nodeName] || node.nodeName == \"TABLE\") {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Resolve the index\n\t\t\t\t\tif (container.hasChildNodes()) {\n\t\t\t\t\t\toffset = Math.min(!directionLeft && offset > 0 ? offset - 1 : offset, container.childNodes.length - 1);\n\t\t\t\t\t\tcontainer = container.childNodes[offset];\n\t\t\t\t\t\toffset = 0;\n\n\t\t\t\t\t\t// Don't normalize non collapsed selections like <p>[a</p><table></table>]\n\t\t\t\t\t\tif (!collapsed && container === body.lastChild && container.nodeName === 'TABLE') {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (hasContentEditableFalseParent(container) || isCaretContainer(container)) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Don't walk into elements that doesn't have any child nodes like a IMG\n\t\t\t\t\t\tif (container.hasChildNodes() && !/TABLE/.test(container.nodeName)) {\n\t\t\t\t\t\t\t// Walk the DOM to find a text node to place the caret at or a BR\n\t\t\t\t\t\t\tnode = container;\n\t\t\t\t\t\t\twalker = new TreeWalker(container, body);\n\n\t\t\t\t\t\t\tdo {\n\t\t\t\t\t\t\t\tif (isContentEditableFalse(node) || isCaretContainer(node)) {\n\t\t\t\t\t\t\t\t\tnormalized = false;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// Found a text node use that position\n\t\t\t\t\t\t\t\tif (node.nodeType === 3 && node.nodeValue.length > 0) {\n\t\t\t\t\t\t\t\t\toffset = directionLeft ? 0 : node.nodeValue.length;\n\t\t\t\t\t\t\t\t\tcontainer = node;\n\t\t\t\t\t\t\t\t\tnormalized = true;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// Found a BR/IMG element that we can place the caret before\n\t\t\t\t\t\t\t\tif (nonEmptyElementsMap[node.nodeName.toLowerCase()] && !isTableCell(node)) {\n\t\t\t\t\t\t\t\t\toffset = dom.nodeIndex(node);\n\t\t\t\t\t\t\t\t\tcontainer = node.parentNode;\n\n\t\t\t\t\t\t\t\t\t// Put caret after image when moving the end point\n\t\t\t\t\t\t\t\t\tif (node.nodeName == \"IMG\" && !directionLeft) {\n\t\t\t\t\t\t\t\t\t\toffset++;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tnormalized = true;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} while ((node = (directionLeft ? walker.next() : walker.prev())));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Lean the caret to the left if possible\n\t\t\t\tif (collapsed) {\n\t\t\t\t\t// So this: <b>x</b><i>|x</i>\n\t\t\t\t\t// Becomes: <b>x|</b><i>x</i>\n\t\t\t\t\t// Seems that only gecko has issues with this\n\t\t\t\t\tif (container.nodeType === 3 && offset === 0) {\n\t\t\t\t\t\tfindTextNodeRelative(true);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Lean left into empty inline elements when the caret is before a BR\n\t\t\t\t\t// So this: <i><b></b><i>|<br></i>\n\t\t\t\t\t// Becomes: <i><b>|</b><i><br></i>\n\t\t\t\t\t// Seems that only gecko has issues with this.\n\t\t\t\t\t// Special edge case for <p><a>x</a>|<br></p> since we don't want <p><a>x|</a><br></p>\n\t\t\t\t\tif (container.nodeType === 1) {\n\t\t\t\t\t\tnode = container.childNodes[offset];\n\n\t\t\t\t\t\t// Offset is after the containers last child\n\t\t\t\t\t\t// then use the previous child for normalization\n\t\t\t\t\t\tif (!node) {\n\t\t\t\t\t\t\tnode = container.childNodes[offset - 1];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (node && node.nodeName === 'BR' && !isPrevNode(node, 'A') &&\n\t\t\t\t\t\t\t!hasBrBeforeAfter(node) && !hasBrBeforeAfter(node, true)) {\n\t\t\t\t\t\t\tfindTextNodeRelative(true, node);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Lean the start of the selection right if possible\n\t\t\t\t// So this: x[<b>x]</b>\n\t\t\t\t// Becomes: x<b>[x]</b>\n\t\t\t\tif (directionLeft && !collapsed && container.nodeType === 3 && offset === container.nodeValue.length) {\n\t\t\t\t\tfindTextNodeRelative(false);\n\t\t\t\t}\n\n\t\t\t\t// Set endpoint if it was normalized\n\t\t\t\tif (normalized) {\n\t\t\t\t\trng['set' + (start ? 'Start' : 'End')](container, offset);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcollapsed = rng.collapsed;\n\n\t\t\tnormalizeEndPoint(true);\n\n\t\t\tif (!collapsed) {\n\t\t\t\tnormalizeEndPoint();\n\t\t\t}\n\n\t\t\t// If it was collapsed then make sure it still is\n\t\t\tif (normalized && collapsed) {\n\t\t\t\trng.collapse(true);\n\t\t\t}\n\n\t\t\treturn normalized;\n\t\t};\n\t}\n\n\t/**\n\t * Compares two ranges and checks if they are equal.\n\t *\n\t * @static\n\t * @method compareRanges\n\t * @param {DOMRange} rng1 First range to compare.\n\t * @param {DOMRange} rng2 First range to compare.\n\t * @return {Boolean} true/false if the ranges are equal.\n\t */\n\tRangeUtils.compareRanges = function(rng1, rng2) {\n\t\tif (rng1 && rng2) {\n\t\t\t// Compare native IE ranges\n\t\t\tif (rng1.item || rng1.duplicate) {\n\t\t\t\t// Both are control ranges and the selected element matches\n\t\t\t\tif (rng1.item && rng2.item && rng1.item(0) === rng2.item(0)) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\t// Both are text ranges and the range matches\n\t\t\t\tif (rng1.isEqual && rng2.isEqual && rng2.isEqual(rng1)) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Compare w3c ranges\n\t\t\t\treturn rng1.startContainer == rng2.startContainer && rng1.startOffset == rng2.startOffset;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t};\n\n\t/**\n\t * Finds the closest selection rect tries to get the range from that.\n\t */\n\tfunction findClosestIeRange(clientX, clientY, doc) {\n\t\tvar element, rng, rects;\n\n\t\telement = doc.elementFromPoint(clientX, clientY);\n\t\trng = doc.body.createTextRange();\n\n\t\tif (!element || element.tagName == 'HTML') {\n\t\t\telement = doc.body;\n\t\t}\n\n\t\trng.moveToElementText(element);\n\t\trects = Tools.toArray(rng.getClientRects());\n\n\t\trects = rects.sort(function(a, b) {\n\t\t\ta = Math.abs(Math.max(a.top - clientY, a.bottom - clientY));\n\t\t\tb = Math.abs(Math.max(b.top - clientY, b.bottom - clientY));\n\n\t\t\treturn a - b;\n\t\t});\n\n\t\tif (rects.length > 0) {\n\t\t\tclientY = (rects[0].bottom + rects[0].top) / 2;\n\n\t\t\ttry {\n\t\t\t\trng.moveToPoint(clientX, clientY);\n\t\t\t\trng.collapse(true);\n\n\t\t\t\treturn rng;\n\t\t\t} catch (ex) {\n\t\t\t\t// At least we tried\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tfunction moveOutOfContentEditableFalse(rng, rootNode) {\n\t\tvar parentElement = rng && rng.parentElement ? rng.parentElement() : null;\n\t\treturn isContentEditableFalse(findParent(parentElement, rootNode, hasCeProperty)) ? null : rng;\n\t}\n\n\t/**\n\t * Gets the caret range for the given x/y location.\n\t *\n\t * @static\n\t * @method getCaretRangeFromPoint\n\t * @param {Number} clientX X coordinate for range\n\t * @param {Number} clientY Y coordinate for range\n\t * @param {Document} doc Document that x/y are relative to\n\t * @returns {Range} caret range\n\t */\n\tRangeUtils.getCaretRangeFromPoint = function(clientX, clientY, doc) {\n\t\tvar rng, point;\n\n\t\tif (doc.caretPositionFromPoint) {\n\t\t\tpoint = doc.caretPositionFromPoint(clientX, clientY);\n\t\t\trng = doc.createRange();\n\t\t\trng.setStart(point.offsetNode, point.offset);\n\t\t\trng.collapse(true);\n\t\t} else if (doc.caretRangeFromPoint) {\n\t\t\trng = doc.caretRangeFromPoint(clientX, clientY);\n\t\t} else if (doc.body.createTextRange) {\n\t\t\trng = doc.body.createTextRange();\n\n\t\t\ttry {\n\t\t\t\trng.moveToPoint(clientX, clientY);\n\t\t\t\trng.collapse(true);\n\t\t\t} catch (ex) {\n\t\t\t\trng = findClosestIeRange(clientX, clientY, doc);\n\t\t\t}\n\n\t\t\treturn moveOutOfContentEditableFalse(rng, doc.body);\n\t\t}\n\n\t\treturn rng;\n\t};\n\n\tRangeUtils.getSelectedNode = function(range) {\n\t\tvar startContainer = range.startContainer,\n\t\t\tstartOffset = range.startOffset;\n\n\t\tif (startContainer.hasChildNodes() && range.endOffset == startOffset + 1) {\n\t\t\treturn startContainer.childNodes[startOffset];\n\t\t}\n\n\t\treturn null;\n\t};\n\n\tRangeUtils.getNode = function(container, offset) {\n\t\tif (container.nodeType == 1 && container.hasChildNodes()) {\n\t\t\tif (offset >= container.childNodes.length) {\n\t\t\t\toffset = container.childNodes.length - 1;\n\t\t\t}\n\n\t\t\tcontainer = container.childNodes[offset];\n\t\t}\n\n\t\treturn container;\n\t};\n\n\treturn RangeUtils;\n});\n\n// Included from: js/tinymce/classes/NodeChange.js\n\n/**\n * NodeChange.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class handles the nodechange event dispatching both manual and through selection change events.\n *\n * @class tinymce.NodeChange\n * @private\n */\ndefine(\"tinymce/NodeChange\", [\n\t\"tinymce/dom/RangeUtils\",\n\t\"tinymce/Env\",\n\t\"tinymce/util/Delay\"\n], function(RangeUtils, Env, Delay) {\n\treturn function(editor) {\n\t\tvar lastRng, lastPath = [];\n\n\t\t/**\n\t\t * Returns true/false if the current element path has been changed or not.\n\t\t *\n\t\t * @private\n\t\t * @return {Boolean} True if the element path is the same false if it's not.\n\t\t */\n\t\tfunction isSameElementPath(startElm) {\n\t\t\tvar i, currentPath;\n\n\t\t\tcurrentPath = editor.$(startElm).parentsUntil(editor.getBody()).add(startElm);\n\t\t\tif (currentPath.length === lastPath.length) {\n\t\t\t\tfor (i = currentPath.length; i >= 0; i--) {\n\t\t\t\t\tif (currentPath[i] !== lastPath[i]) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (i === -1) {\n\t\t\t\t\tlastPath = currentPath;\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlastPath = currentPath;\n\n\t\t\treturn false;\n\t\t}\n\n\t\t// Gecko doesn't support the \"selectionchange\" event\n\t\tif (!('onselectionchange' in editor.getDoc())) {\n\t\t\teditor.on('NodeChange Click MouseUp KeyUp Focus', function(e) {\n\t\t\t\tvar nativeRng, fakeRng;\n\n\t\t\t\t// Since DOM Ranges mutate on modification\n\t\t\t\t// of the DOM we need to clone it's contents\n\t\t\t\tnativeRng = editor.selection.getRng();\n\t\t\t\tfakeRng = {\n\t\t\t\t\tstartContainer: nativeRng.startContainer,\n\t\t\t\t\tstartOffset: nativeRng.startOffset,\n\t\t\t\t\tendContainer: nativeRng.endContainer,\n\t\t\t\t\tendOffset: nativeRng.endOffset\n\t\t\t\t};\n\n\t\t\t\t// Always treat nodechange as a selectionchange since applying\n\t\t\t\t// formatting to the current range wouldn't update the range but it's parent\n\t\t\t\tif (e.type == 'nodechange' || !RangeUtils.compareRanges(fakeRng, lastRng)) {\n\t\t\t\t\teditor.fire('SelectionChange');\n\t\t\t\t}\n\n\t\t\t\tlastRng = fakeRng;\n\t\t\t});\n\t\t}\n\n\t\t// IE has a bug where it fires a selectionchange on right click that has a range at the start of the body\n\t\t// When the contextmenu event fires the selection is located at the right location\n\t\teditor.on('contextmenu', function() {\n\t\t\teditor.fire('SelectionChange');\n\t\t});\n\n\t\t// Selection change is delayed ~200ms on IE when you click inside the current range\n\t\teditor.on('SelectionChange', function() {\n\t\t\tvar startElm = editor.selection.getStart(true);\n\n\t\t\t// IE 8 will fire a selectionchange event with an incorrect selection\n\t\t\t// when focusing out of table cells. Click inside cell -> toolbar = Invalid SelectionChange event\n\t\t\tif (!Env.range && editor.selection.isCollapsed()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!isSameElementPath(startElm) && editor.dom.isChildOf(startElm, editor.getBody())) {\n\t\t\t\teditor.nodeChanged({selectionChange: true});\n\t\t\t}\n\t\t});\n\n\t\t// Fire an extra nodeChange on mouseup for compatibility reasons\n\t\teditor.on('MouseUp', function(e) {\n\t\t\tif (!e.isDefaultPrevented()) {\n\t\t\t\t// Delay nodeChanged call for WebKit edge case issue where the range\n\t\t\t\t// isn't updated until after you click outside a selected image\n\t\t\t\tif (editor.selection.getNode().nodeName == 'IMG') {\n\t\t\t\t\tDelay.setEditorTimeout(editor, function() {\n\t\t\t\t\t\teditor.nodeChanged();\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\teditor.nodeChanged();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t/**\n\t\t * Dispatches out a onNodeChange event to all observers. This method should be called when you\n\t\t * need to update the UI states or element path etc.\n\t\t *\n\t\t * @method nodeChanged\n\t\t * @param {Object} args Optional args to pass to NodeChange event handlers.\n\t\t */\n\t\tthis.nodeChanged = function(args) {\n\t\t\tvar selection = editor.selection, node, parents, root;\n\n\t\t\t// Fix for bug #1896577 it seems that this can not be fired while the editor is loading\n\t\t\tif (editor.initialized && selection && !editor.settings.disable_nodechange && !editor.readonly) {\n\t\t\t\t// Get start node\n\t\t\t\troot = editor.getBody();\n\t\t\t\tnode = selection.getStart() || root;\n\n\t\t\t\t// Make sure the node is within the editor root or is the editor root\n\t\t\t\tif (node.ownerDocument != editor.getDoc() || !editor.dom.isChildOf(node, root)) {\n\t\t\t\t\tnode = root;\n\t\t\t\t}\n\n\t\t\t\t// Edge case for <p>|<img></p>\n\t\t\t\tif (node.nodeName == 'IMG' && selection.isCollapsed()) {\n\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t}\n\n\t\t\t\t// Get parents and add them to object\n\t\t\t\tparents = [];\n\t\t\t\teditor.dom.getParent(node, function(node) {\n\t\t\t\t\tif (node === root) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\tparents.push(node);\n\t\t\t\t});\n\n\t\t\t\targs = args || {};\n\t\t\t\targs.element = node;\n\t\t\t\targs.parents = parents;\n\n\t\t\t\teditor.fire('NodeChange', args);\n\t\t\t}\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/html/Node.js\n\n/**\n * Node.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class is a minimalistic implementation of a DOM like node used by the DomParser class.\n *\n * @example\n * var node = new tinymce.html.Node('strong', 1);\n * someRoot.append(node);\n *\n * @class tinymce.html.Node\n * @version 3.4\n */\ndefine(\"tinymce/html/Node\", [], function() {\n\tvar whiteSpaceRegExp = /^[ \\t\\r\\n]*$/, typeLookup = {\n\t\t'#text': 3,\n\t\t'#comment': 8,\n\t\t'#cdata': 4,\n\t\t'#pi': 7,\n\t\t'#doctype': 10,\n\t\t'#document-fragment': 11\n\t};\n\n\t// Walks the tree left/right\n\tfunction walk(node, root_node, prev) {\n\t\tvar sibling, parent, startName = prev ? 'lastChild' : 'firstChild', siblingName = prev ? 'prev' : 'next';\n\n\t\t// Walk into nodes if it has a start\n\t\tif (node[startName]) {\n\t\t\treturn node[startName];\n\t\t}\n\n\t\t// Return the sibling if it has one\n\t\tif (node !== root_node) {\n\t\t\tsibling = node[siblingName];\n\n\t\t\tif (sibling) {\n\t\t\t\treturn sibling;\n\t\t\t}\n\n\t\t\t// Walk up the parents to look for siblings\n\t\t\tfor (parent = node.parent; parent && parent !== root_node; parent = parent.parent) {\n\t\t\t\tsibling = parent[siblingName];\n\n\t\t\t\tif (sibling) {\n\t\t\t\t\treturn sibling;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Constructs a new Node instance.\n\t *\n\t * @constructor\n\t * @method Node\n\t * @param {String} name Name of the node type.\n\t * @param {Number} type Numeric type representing the node.\n\t */\n\tfunction Node(name, type) {\n\t\tthis.name = name;\n\t\tthis.type = type;\n\n\t\tif (type === 1) {\n\t\t\tthis.attributes = [];\n\t\t\tthis.attributes.map = {};\n\t\t}\n\t}\n\n\tNode.prototype = {\n\t\t/**\n\t\t * Replaces the current node with the specified one.\n\t\t *\n\t\t * @example\n\t\t * someNode.replace(someNewNode);\n\t\t *\n\t\t * @method replace\n\t\t * @param {tinymce.html.Node} node Node to replace the current node with.\n\t\t * @return {tinymce.html.Node} The old node that got replaced.\n\t\t */\n\t\treplace: function(node) {\n\t\t\tvar self = this;\n\n\t\t\tif (node.parent) {\n\t\t\t\tnode.remove();\n\t\t\t}\n\n\t\t\tself.insert(node, self);\n\t\t\tself.remove();\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Gets/sets or removes an attribute by name.\n\t\t *\n\t\t * @example\n\t\t * someNode.attr(\"name\", \"value\"); // Sets an attribute\n\t\t * console.log(someNode.attr(\"name\")); // Gets an attribute\n\t\t * someNode.attr(\"name\", null); // Removes an attribute\n\t\t *\n\t\t * @method attr\n\t\t * @param {String} name Attribute name to set or get.\n\t\t * @param {String} value Optional value to set.\n\t\t * @return {String/tinymce.html.Node} String or undefined on a get operation or the current node on a set operation.\n\t\t */\n\t\tattr: function(name, value) {\n\t\t\tvar self = this, attrs, i, undef;\n\n\t\t\tif (typeof name !== \"string\") {\n\t\t\t\tfor (i in name) {\n\t\t\t\t\tself.attr(i, name[i]);\n\t\t\t\t}\n\n\t\t\t\treturn self;\n\t\t\t}\n\n\t\t\tif ((attrs = self.attributes)) {\n\t\t\t\tif (value !== undef) {\n\t\t\t\t\t// Remove attribute\n\t\t\t\t\tif (value === null) {\n\t\t\t\t\t\tif (name in attrs.map) {\n\t\t\t\t\t\t\tdelete attrs.map[name];\n\n\t\t\t\t\t\t\ti = attrs.length;\n\t\t\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\t\t\tif (attrs[i].name === name) {\n\t\t\t\t\t\t\t\t\tattrs = attrs.splice(i, 1);\n\t\t\t\t\t\t\t\t\treturn self;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn self;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Set attribute\n\t\t\t\t\tif (name in attrs.map) {\n\t\t\t\t\t\t// Set attribute\n\t\t\t\t\t\ti = attrs.length;\n\t\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\t\tif (attrs[i].name === name) {\n\t\t\t\t\t\t\t\tattrs[i].value = value;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tattrs.push({name: name, value: value});\n\t\t\t\t\t}\n\n\t\t\t\t\tattrs.map[name] = value;\n\n\t\t\t\t\treturn self;\n\t\t\t\t}\n\n\t\t\t\treturn attrs.map[name];\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Does a shallow clones the node into a new node. It will also exclude id attributes since\n\t\t * there should only be one id per document.\n\t\t *\n\t\t * @example\n\t\t * var clonedNode = node.clone();\n\t\t *\n\t\t * @method clone\n\t\t * @return {tinymce.html.Node} New copy of the original node.\n\t\t */\n\t\tclone: function() {\n\t\t\tvar self = this, clone = new Node(self.name, self.type), i, l, selfAttrs, selfAttr, cloneAttrs;\n\n\t\t\t// Clone element attributes\n\t\t\tif ((selfAttrs = self.attributes)) {\n\t\t\t\tcloneAttrs = [];\n\t\t\t\tcloneAttrs.map = {};\n\n\t\t\t\tfor (i = 0, l = selfAttrs.length; i < l; i++) {\n\t\t\t\t\tselfAttr = selfAttrs[i];\n\n\t\t\t\t\t// Clone everything except id\n\t\t\t\t\tif (selfAttr.name !== 'id') {\n\t\t\t\t\t\tcloneAttrs[cloneAttrs.length] = {name: selfAttr.name, value: selfAttr.value};\n\t\t\t\t\t\tcloneAttrs.map[selfAttr.name] = selfAttr.value;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tclone.attributes = cloneAttrs;\n\t\t\t}\n\n\t\t\tclone.value = self.value;\n\t\t\tclone.shortEnded = self.shortEnded;\n\n\t\t\treturn clone;\n\t\t},\n\n\t\t/**\n\t\t * Wraps the node in in another node.\n\t\t *\n\t\t * @example\n\t\t * node.wrap(wrapperNode);\n\t\t *\n\t\t * @method wrap\n\t\t */\n\t\twrap: function(wrapper) {\n\t\t\tvar self = this;\n\n\t\t\tself.parent.insert(wrapper, self);\n\t\t\twrapper.append(self);\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Unwraps the node in other words it removes the node but keeps the children.\n\t\t *\n\t\t * @example\n\t\t * node.unwrap();\n\t\t *\n\t\t * @method unwrap\n\t\t */\n\t\tunwrap: function() {\n\t\t\tvar self = this, node, next;\n\n\t\t\tfor (node = self.firstChild; node;) {\n\t\t\t\tnext = node.next;\n\t\t\t\tself.insert(node, self, true);\n\t\t\t\tnode = next;\n\t\t\t}\n\n\t\t\tself.remove();\n\t\t},\n\n\t\t/**\n\t\t * Removes the node from it's parent.\n\t\t *\n\t\t * @example\n\t\t * node.remove();\n\t\t *\n\t\t * @method remove\n\t\t * @return {tinymce.html.Node} Current node that got removed.\n\t\t */\n\t\tremove: function() {\n\t\t\tvar self = this, parent = self.parent, next = self.next, prev = self.prev;\n\n\t\t\tif (parent) {\n\t\t\t\tif (parent.firstChild === self) {\n\t\t\t\t\tparent.firstChild = next;\n\n\t\t\t\t\tif (next) {\n\t\t\t\t\t\tnext.prev = null;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tprev.next = next;\n\t\t\t\t}\n\n\t\t\t\tif (parent.lastChild === self) {\n\t\t\t\t\tparent.lastChild = prev;\n\n\t\t\t\t\tif (prev) {\n\t\t\t\t\t\tprev.next = null;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tnext.prev = prev;\n\t\t\t\t}\n\n\t\t\t\tself.parent = self.next = self.prev = null;\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Appends a new node as a child of the current node.\n\t\t *\n\t\t * @example\n\t\t * node.append(someNode);\n\t\t *\n\t\t * @method append\n\t\t * @param {tinymce.html.Node} node Node to append as a child of the current one.\n\t\t * @return {tinymce.html.Node} The node that got appended.\n\t\t */\n\t\tappend: function(node) {\n\t\t\tvar self = this, last;\n\n\t\t\tif (node.parent) {\n\t\t\t\tnode.remove();\n\t\t\t}\n\n\t\t\tlast = self.lastChild;\n\t\t\tif (last) {\n\t\t\t\tlast.next = node;\n\t\t\t\tnode.prev = last;\n\t\t\t\tself.lastChild = node;\n\t\t\t} else {\n\t\t\t\tself.lastChild = self.firstChild = node;\n\t\t\t}\n\n\t\t\tnode.parent = self;\n\n\t\t\treturn node;\n\t\t},\n\n\t\t/**\n\t\t * Inserts a node at a specific position as a child of the current node.\n\t\t *\n\t\t * @example\n\t\t * parentNode.insert(newChildNode, oldChildNode);\n\t\t *\n\t\t * @method insert\n\t\t * @param {tinymce.html.Node} node Node to insert as a child of the current node.\n\t\t * @param {tinymce.html.Node} ref_node Reference node to set node before/after.\n\t\t * @param {Boolean} before Optional state to insert the node before the reference node.\n\t\t * @return {tinymce.html.Node} The node that got inserted.\n\t\t */\n\t\tinsert: function(node, ref_node, before) {\n\t\t\tvar parent;\n\n\t\t\tif (node.parent) {\n\t\t\t\tnode.remove();\n\t\t\t}\n\n\t\t\tparent = ref_node.parent || this;\n\n\t\t\tif (before) {\n\t\t\t\tif (ref_node === parent.firstChild) {\n\t\t\t\t\tparent.firstChild = node;\n\t\t\t\t} else {\n\t\t\t\t\tref_node.prev.next = node;\n\t\t\t\t}\n\n\t\t\t\tnode.prev = ref_node.prev;\n\t\t\t\tnode.next = ref_node;\n\t\t\t\tref_node.prev = node;\n\t\t\t} else {\n\t\t\t\tif (ref_node === parent.lastChild) {\n\t\t\t\t\tparent.lastChild = node;\n\t\t\t\t} else {\n\t\t\t\t\tref_node.next.prev = node;\n\t\t\t\t}\n\n\t\t\t\tnode.next = ref_node.next;\n\t\t\t\tnode.prev = ref_node;\n\t\t\t\tref_node.next = node;\n\t\t\t}\n\n\t\t\tnode.parent = parent;\n\n\t\t\treturn node;\n\t\t},\n\n\t\t/**\n\t\t * Get all children by name.\n\t\t *\n\t\t * @method getAll\n\t\t * @param {String} name Name of the child nodes to collect.\n\t\t * @return {Array} Array with child nodes matchin the specified name.\n\t\t */\n\t\tgetAll: function(name) {\n\t\t\tvar self = this, node, collection = [];\n\n\t\t\tfor (node = self.firstChild; node; node = walk(node, self)) {\n\t\t\t\tif (node.name === name) {\n\t\t\t\t\tcollection.push(node);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn collection;\n\t\t},\n\n\t\t/**\n\t\t * Removes all children of the current node.\n\t\t *\n\t\t * @method empty\n\t\t * @return {tinymce.html.Node} The current node that got cleared.\n\t\t */\n\t\tempty: function() {\n\t\t\tvar self = this, nodes, i, node;\n\n\t\t\t// Remove all children\n\t\t\tif (self.firstChild) {\n\t\t\t\tnodes = [];\n\n\t\t\t\t// Collect the children\n\t\t\t\tfor (node = self.firstChild; node; node = walk(node, self)) {\n\t\t\t\t\tnodes.push(node);\n\t\t\t\t}\n\n\t\t\t\t// Remove the children\n\t\t\t\ti = nodes.length;\n\t\t\t\twhile (i--) {\n\t\t\t\t\tnode = nodes[i];\n\t\t\t\t\tnode.parent = node.firstChild = node.lastChild = node.next = node.prev = null;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tself.firstChild = self.lastChild = null;\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Returns true/false if the node is to be considered empty or not.\n\t\t *\n\t\t * @example\n\t\t * node.isEmpty({img: true});\n\t\t * @method isEmpty\n\t\t * @param {Object} elements Name/value object with elements that are automatically treated as non empty elements.\n\t\t * @return {Boolean} true/false if the node is empty or not.\n\t\t */\n\t\tisEmpty: function(elements) {\n\t\t\tvar self = this, node = self.firstChild, i, name;\n\n\t\t\tif (node) {\n\t\t\t\tdo {\n\t\t\t\t\tif (node.type === 1) {\n\t\t\t\t\t\t// Ignore bogus elements\n\t\t\t\t\t\tif (node.attributes.map['data-mce-bogus']) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Keep empty elements like <img />\n\t\t\t\t\t\tif (elements[node.name]) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Keep bookmark nodes and name attribute like <a name=\"1\"></a>\n\t\t\t\t\t\ti = node.attributes.length;\n\t\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\t\tname = node.attributes[i].name;\n\t\t\t\t\t\t\tif (name === \"name\" || name.indexOf('data-mce-bookmark') === 0) {\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Keep comments\n\t\t\t\t\tif (node.type === 8) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Keep non whitespace text nodes\n\t\t\t\t\tif ((node.type === 3 && !whiteSpaceRegExp.test(node.value))) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t} while ((node = walk(node, self)));\n\t\t\t}\n\n\t\t\treturn true;\n\t\t},\n\n\t\t/**\n\t\t * Walks to the next or previous node and returns that node or null if it wasn't found.\n\t\t *\n\t\t * @method walk\n\t\t * @param {Boolean} prev Optional previous node state defaults to false.\n\t\t * @return {tinymce.html.Node} Node that is next to or previous of the current node.\n\t\t */\n\t\twalk: function(prev) {\n\t\t\treturn walk(this, null, prev);\n\t\t}\n\t};\n\n\t/**\n\t * Creates a node of a specific type.\n\t *\n\t * @static\n\t * @method create\n\t * @param {String} name Name of the node type to create for example \"b\" or \"#text\".\n\t * @param {Object} attrs Name/value collection of attributes that will be applied to elements.\n\t */\n\tNode.create = function(name, attrs) {\n\t\tvar node, attrName;\n\n\t\t// Create node\n\t\tnode = new Node(name, typeLookup[name] || 1);\n\n\t\t// Add attributes if needed\n\t\tif (attrs) {\n\t\t\tfor (attrName in attrs) {\n\t\t\t\tnode.attr(attrName, attrs[attrName]);\n\t\t\t}\n\t\t}\n\n\t\treturn node;\n\t};\n\n\treturn Node;\n});\n\n// Included from: js/tinymce/classes/html/Schema.js\n\n/**\n * Schema.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Schema validator class.\n *\n * @class tinymce.html.Schema\n * @example\n *  if (tinymce.activeEditor.schema.isValidChild('p', 'span'))\n *    alert('span is valid child of p.');\n *\n *  if (tinymce.activeEditor.schema.getElementRule('p'))\n *    alert('P is a valid element.');\n *\n * @class tinymce.html.Schema\n * @version 3.4\n */\ndefine(\"tinymce/html/Schema\", [\n\t\"tinymce/util/Tools\"\n], function(Tools) {\n\tvar mapCache = {}, dummyObj = {};\n\tvar makeMap = Tools.makeMap, each = Tools.each, extend = Tools.extend, explode = Tools.explode, inArray = Tools.inArray;\n\n\tfunction split(items, delim) {\n\t\titems = Tools.trim(items);\n\t\treturn items ? items.split(delim || ' ') : [];\n\t}\n\n\t/**\n\t * Builds a schema lookup table\n\t *\n\t * @private\n\t * @param {String} type html4, html5 or html5-strict schema type.\n\t * @return {Object} Schema lookup table.\n\t */\n\tfunction compileSchema(type) {\n\t\tvar schema = {}, globalAttributes, blockContent;\n\t\tvar phrasingContent, flowContent, html4BlockContent, html4PhrasingContent;\n\n\t\tfunction add(name, attributes, children) {\n\t\t\tvar ni, attributesOrder, element;\n\n\t\t\tfunction arrayToMap(array, obj) {\n\t\t\t\tvar map = {}, i, l;\n\n\t\t\t\tfor (i = 0, l = array.length; i < l; i++) {\n\t\t\t\t\tmap[array[i]] = obj || {};\n\t\t\t\t}\n\n\t\t\t\treturn map;\n\t\t\t}\n\n\t\t\tchildren = children || [];\n\t\t\tattributes = attributes || \"\";\n\n\t\t\tif (typeof children === \"string\") {\n\t\t\t\tchildren = split(children);\n\t\t\t}\n\n\t\t\tname = split(name);\n\t\t\tni = name.length;\n\t\t\twhile (ni--) {\n\t\t\t\tattributesOrder = split([globalAttributes, attributes].join(' '));\n\n\t\t\t\telement = {\n\t\t\t\t\tattributes: arrayToMap(attributesOrder),\n\t\t\t\t\tattributesOrder: attributesOrder,\n\t\t\t\t\tchildren: arrayToMap(children, dummyObj)\n\t\t\t\t};\n\n\t\t\t\tschema[name[ni]] = element;\n\t\t\t}\n\t\t}\n\n\t\tfunction addAttrs(name, attributes) {\n\t\t\tvar ni, schemaItem, i, l;\n\n\t\t\tname = split(name);\n\t\t\tni = name.length;\n\t\t\tattributes = split(attributes);\n\t\t\twhile (ni--) {\n\t\t\t\tschemaItem = schema[name[ni]];\n\t\t\t\tfor (i = 0, l = attributes.length; i < l; i++) {\n\t\t\t\t\tschemaItem.attributes[attributes[i]] = {};\n\t\t\t\t\tschemaItem.attributesOrder.push(attributes[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Use cached schema\n\t\tif (mapCache[type]) {\n\t\t\treturn mapCache[type];\n\t\t}\n\n\t\t// Attributes present on all elements\n\t\tglobalAttributes = \"id accesskey class dir lang style tabindex title\";\n\n\t\t// Event attributes can be opt-in/opt-out\n\t\t/*eventAttributes = split(\"onabort onblur oncancel oncanplay oncanplaythrough onchange onclick onclose oncontextmenu oncuechange \" +\n\t\t \"ondblclick ondrag ondragend ondragenter ondragleave ondragover ondragstart ondrop ondurationchange onemptied onended \" +\n\t\t \"onerror onfocus oninput oninvalid onkeydown onkeypress onkeyup onload onloadeddata onloadedmetadata onloadstart \" +\n\t\t \"onmousedown onmousemove onmouseout onmouseover onmouseup onmousewheel onpause onplay onplaying onprogress onratechange \" +\n\t\t \"onreset onscroll onseeked onseeking onseeking onselect onshow onstalled onsubmit onsuspend ontimeupdate onvolumechange \" +\n\t\t \"onwaiting\"\n\t\t );*/\n\n\t\t// Block content elements\n\t\tblockContent =\n\t\t\t\"address blockquote div dl fieldset form h1 h2 h3 h4 h5 h6 hr menu ol p pre table ul\";\n\n\t\t// Phrasing content elements from the HTML5 spec (inline)\n\t\tphrasingContent =\n\t\t\t\"a abbr b bdo br button cite code del dfn em embed i iframe img input ins kbd \" +\n\t\t\t\"label map noscript object q s samp script select small span strong sub sup \" +\n\t\t\t\"textarea u var #text #comment\"\n\t\t;\n\n\t\t// Add HTML5 items to globalAttributes, blockContent, phrasingContent\n\t\tif (type != \"html4\") {\n\t\t\tglobalAttributes += \" contenteditable contextmenu draggable dropzone \" +\n\t\t\t\t\"hidden spellcheck translate\";\n\t\t\tblockContent += \" article aside details dialog figure header footer hgroup section nav\";\n\t\t\tphrasingContent += \" audio canvas command datalist mark meter output picture \" +\n\t\t\t\t\"progress time wbr video ruby bdi keygen\";\n\t\t}\n\n\t\t// Add HTML4 elements unless it's html5-strict\n\t\tif (type != \"html5-strict\") {\n\t\t\tglobalAttributes += \" xml:lang\";\n\n\t\t\thtml4PhrasingContent = \"acronym applet basefont big font strike tt\";\n\t\t\tphrasingContent = [phrasingContent, html4PhrasingContent].join(' ');\n\n\t\t\teach(split(html4PhrasingContent), function(name) {\n\t\t\t\tadd(name, \"\", phrasingContent);\n\t\t\t});\n\n\t\t\thtml4BlockContent = \"center dir isindex noframes\";\n\t\t\tblockContent = [blockContent, html4BlockContent].join(' ');\n\n\t\t\t// Flow content elements from the HTML5 spec (block+inline)\n\t\t\tflowContent = [blockContent, phrasingContent].join(' ');\n\n\t\t\teach(split(html4BlockContent), function(name) {\n\t\t\t\tadd(name, \"\", flowContent);\n\t\t\t});\n\t\t}\n\n\t\t// Flow content elements from the HTML5 spec (block+inline)\n\t\tflowContent = flowContent || [blockContent, phrasingContent].join(\" \");\n\n\t\t// HTML4 base schema TODO: Move HTML5 specific attributes to HTML5 specific if statement\n\t\t// Schema items <element name>, <specific attributes>, <children ..>\n\t\tadd(\"html\", \"manifest\", \"head body\");\n\t\tadd(\"head\", \"\", \"base command link meta noscript script style title\");\n\t\tadd(\"title hr noscript br\");\n\t\tadd(\"base\", \"href target\");\n\t\tadd(\"link\", \"href rel media hreflang type sizes hreflang\");\n\t\tadd(\"meta\", \"name http-equiv content charset\");\n\t\tadd(\"style\", \"media type scoped\");\n\t\tadd(\"script\", \"src async defer type charset\");\n\t\tadd(\"body\", \"onafterprint onbeforeprint onbeforeunload onblur onerror onfocus \" +\n\t\t\"onhashchange onload onmessage onoffline ononline onpagehide onpageshow \" +\n\t\t\"onpopstate onresize onscroll onstorage onunload\", flowContent);\n\t\tadd(\"address dt dd div caption\", \"\", flowContent);\n\t\tadd(\"h1 h2 h3 h4 h5 h6 pre p abbr code var samp kbd sub sup i b u bdo span legend em strong small s cite dfn\", \"\", phrasingContent);\n\t\tadd(\"blockquote\", \"cite\", flowContent);\n\t\tadd(\"ol\", \"reversed start type\", \"li\");\n\t\tadd(\"ul\", \"\", \"li\");\n\t\tadd(\"li\", \"value\", flowContent);\n\t\tadd(\"dl\", \"\", \"dt dd\");\n\t\tadd(\"a\", \"href target rel media hreflang type\", phrasingContent);\n\t\tadd(\"q\", \"cite\", phrasingContent);\n\t\tadd(\"ins del\", \"cite datetime\", flowContent);\n\t\tadd(\"img\", \"src sizes srcset alt usemap ismap width height\");\n\t\tadd(\"iframe\", \"src name width height\", flowContent);\n\t\tadd(\"embed\", \"src type width height\");\n\t\tadd(\"object\", \"data type typemustmatch name usemap form width height\", [flowContent, \"param\"].join(' '));\n\t\tadd(\"param\", \"name value\");\n\t\tadd(\"map\", \"name\", [flowContent, \"area\"].join(' '));\n\t\tadd(\"area\", \"alt coords shape href target rel media hreflang type\");\n\t\tadd(\"table\", \"border\", \"caption colgroup thead tfoot tbody tr\" + (type == \"html4\" ? \" col\" : \"\"));\n\t\tadd(\"colgroup\", \"span\", \"col\");\n\t\tadd(\"col\", \"span\");\n\t\tadd(\"tbody thead tfoot\", \"\", \"tr\");\n\t\tadd(\"tr\", \"\", \"td th\");\n\t\tadd(\"td\", \"colspan rowspan headers\", flowContent);\n\t\tadd(\"th\", \"colspan rowspan headers scope abbr\", flowContent);\n\t\tadd(\"form\", \"accept-charset action autocomplete enctype method name novalidate target\", flowContent);\n\t\tadd(\"fieldset\", \"disabled form name\", [flowContent, \"legend\"].join(' '));\n\t\tadd(\"label\", \"form for\", phrasingContent);\n\t\tadd(\"input\", \"accept alt autocomplete checked dirname disabled form formaction formenctype formmethod formnovalidate \" +\n\t\t\t\t\"formtarget height list max maxlength min multiple name pattern readonly required size src step type value width\"\n\t\t);\n\t\tadd(\"button\", \"disabled form formaction formenctype formmethod formnovalidate formtarget name type value\",\n\t\t\ttype == \"html4\" ? flowContent : phrasingContent);\n\t\tadd(\"select\", \"disabled form multiple name required size\", \"option optgroup\");\n\t\tadd(\"optgroup\", \"disabled label\", \"option\");\n\t\tadd(\"option\", \"disabled label selected value\");\n\t\tadd(\"textarea\", \"cols dirname disabled form maxlength name readonly required rows wrap\");\n\t\tadd(\"menu\", \"type label\", [flowContent, \"li\"].join(' '));\n\t\tadd(\"noscript\", \"\", flowContent);\n\n\t\t// Extend with HTML5 elements\n\t\tif (type != \"html4\") {\n\t\t\tadd(\"wbr\");\n\t\t\tadd(\"ruby\", \"\", [phrasingContent, \"rt rp\"].join(' '));\n\t\t\tadd(\"figcaption\", \"\", flowContent);\n\t\t\tadd(\"mark rt rp summary bdi\", \"\", phrasingContent);\n\t\t\tadd(\"canvas\", \"width height\", flowContent);\n\t\t\tadd(\"video\", \"src crossorigin poster preload autoplay mediagroup loop \" +\n\t\t\t\t\"muted controls width height buffered\", [flowContent, \"track source\"].join(' '));\n\t\t\tadd(\"audio\", \"src crossorigin preload autoplay mediagroup loop muted controls \" +\n\t\t\t\t\"buffered volume\", [flowContent, \"track source\"].join(' '));\n\t\t\tadd(\"picture\", \"\", \"img source\");\n\t\t\tadd(\"source\", \"src srcset type media sizes\");\n\t\t\tadd(\"track\", \"kind src srclang label default\");\n\t\t\tadd(\"datalist\", \"\", [phrasingContent, \"option\"].join(' '));\n\t\t\tadd(\"article section nav aside header footer\", \"\", flowContent);\n\t\t\tadd(\"hgroup\", \"\", \"h1 h2 h3 h4 h5 h6\");\n\t\t\tadd(\"figure\", \"\", [flowContent, \"figcaption\"].join(' '));\n\t\t\tadd(\"time\", \"datetime\", phrasingContent);\n\t\t\tadd(\"dialog\", \"open\", flowContent);\n\t\t\tadd(\"command\", \"type label icon disabled checked radiogroup command\");\n\t\t\tadd(\"output\", \"for form name\", phrasingContent);\n\t\t\tadd(\"progress\", \"value max\", phrasingContent);\n\t\t\tadd(\"meter\", \"value min max low high optimum\", phrasingContent);\n\t\t\tadd(\"details\", \"open\", [flowContent, \"summary\"].join(' '));\n\t\t\tadd(\"keygen\", \"autofocus challenge disabled form keytype name\");\n\t\t}\n\n\t\t// Extend with HTML4 attributes unless it's html5-strict\n\t\tif (type != \"html5-strict\") {\n\t\t\taddAttrs(\"script\", \"language xml:space\");\n\t\t\taddAttrs(\"style\", \"xml:space\");\n\t\t\taddAttrs(\"object\", \"declare classid code codebase codetype archive standby align border hspace vspace\");\n\t\t\taddAttrs(\"embed\", \"align name hspace vspace\");\n\t\t\taddAttrs(\"param\", \"valuetype type\");\n\t\t\taddAttrs(\"a\", \"charset name rev shape coords\");\n\t\t\taddAttrs(\"br\", \"clear\");\n\t\t\taddAttrs(\"applet\", \"codebase archive code object alt name width height align hspace vspace\");\n\t\t\taddAttrs(\"img\", \"name longdesc align border hspace vspace\");\n\t\t\taddAttrs(\"iframe\", \"longdesc frameborder marginwidth marginheight scrolling align\");\n\t\t\taddAttrs(\"font basefont\", \"size color face\");\n\t\t\taddAttrs(\"input\", \"usemap align\");\n\t\t\taddAttrs(\"select\", \"onchange\");\n\t\t\taddAttrs(\"textarea\");\n\t\t\taddAttrs(\"h1 h2 h3 h4 h5 h6 div p legend caption\", \"align\");\n\t\t\taddAttrs(\"ul\", \"type compact\");\n\t\t\taddAttrs(\"li\", \"type\");\n\t\t\taddAttrs(\"ol dl menu dir\", \"compact\");\n\t\t\taddAttrs(\"pre\", \"width xml:space\");\n\t\t\taddAttrs(\"hr\", \"align noshade size width\");\n\t\t\taddAttrs(\"isindex\", \"prompt\");\n\t\t\taddAttrs(\"table\", \"summary width frame rules cellspacing cellpadding align bgcolor\");\n\t\t\taddAttrs(\"col\", \"width align char charoff valign\");\n\t\t\taddAttrs(\"colgroup\", \"width align char charoff valign\");\n\t\t\taddAttrs(\"thead\", \"align char charoff valign\");\n\t\t\taddAttrs(\"tr\", \"align char charoff valign bgcolor\");\n\t\t\taddAttrs(\"th\", \"axis align char charoff valign nowrap bgcolor width height\");\n\t\t\taddAttrs(\"form\", \"accept\");\n\t\t\taddAttrs(\"td\", \"abbr axis scope align char charoff valign nowrap bgcolor width height\");\n\t\t\taddAttrs(\"tfoot\", \"align char charoff valign\");\n\t\t\taddAttrs(\"tbody\", \"align char charoff valign\");\n\t\t\taddAttrs(\"area\", \"nohref\");\n\t\t\taddAttrs(\"body\", \"background bgcolor text link vlink alink\");\n\t\t}\n\n\t\t// Extend with HTML5 attributes unless it's html4\n\t\tif (type != \"html4\") {\n\t\t\taddAttrs(\"input button select textarea\", \"autofocus\");\n\t\t\taddAttrs(\"input textarea\", \"placeholder\");\n\t\t\taddAttrs(\"a\", \"download\");\n\t\t\taddAttrs(\"link script img\", \"crossorigin\");\n\t\t\taddAttrs(\"iframe\", \"sandbox seamless allowfullscreen\"); // Excluded: srcdoc\n\t\t}\n\n\t\t// Special: iframe, ruby, video, audio, label\n\n\t\t// Delete children of the same name from it's parent\n\t\t// For example: form can't have a child of the name form\n\t\teach(split('a form meter progress dfn'), function(name) {\n\t\t\tif (schema[name]) {\n\t\t\t\tdelete schema[name].children[name];\n\t\t\t}\n\t\t});\n\n\t\t// Delete header, footer, sectioning and heading content descendants\n\t\t/*each('dt th address', function(name) {\n\t\t delete schema[name].children[name];\n\t\t });*/\n\n\t\t// Caption can't have tables\n\t\tdelete schema.caption.children.table;\n\n\t\t// Delete scripts by default due to possible XSS\n\t\tdelete schema.script;\n\n\t\t// TODO: LI:s can only have value if parent is OL\n\n\t\t// TODO: Handle transparent elements\n\t\t// a ins del canvas map\n\n\t\tmapCache[type] = schema;\n\n\t\treturn schema;\n\t}\n\n\tfunction compileElementMap(value, mode) {\n\t\tvar styles;\n\n\t\tif (value) {\n\t\t\tstyles = {};\n\n\t\t\tif (typeof value == 'string') {\n\t\t\t\tvalue = {\n\t\t\t\t\t'*': value\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t// Convert styles into a rule list\n\t\t\teach(value, function(value, key) {\n\t\t\t\tstyles[key] = styles[key.toUpperCase()] = mode == 'map' ? makeMap(value, /[, ]/) : explode(value, /[, ]/);\n\t\t\t});\n\t\t}\n\n\t\treturn styles;\n\t}\n\n\t/**\n\t * Constructs a new Schema instance.\n\t *\n\t * @constructor\n\t * @method Schema\n\t * @param {Object} settings Name/value settings object.\n\t */\n\treturn function(settings) {\n\t\tvar self = this, elements = {}, children = {}, patternElements = [], validStyles, invalidStyles, schemaItems;\n\t\tvar whiteSpaceElementsMap, selfClosingElementsMap, shortEndedElementsMap, boolAttrMap, validClasses;\n\t\tvar blockElementsMap, nonEmptyElementsMap, moveCaretBeforeOnEnterElementsMap, textBlockElementsMap, textInlineElementsMap;\n\t\tvar customElementsMap = {}, specialElements = {};\n\n\t\t// Creates an lookup table map object for the specified option or the default value\n\t\tfunction createLookupTable(option, default_value, extendWith) {\n\t\t\tvar value = settings[option];\n\n\t\t\tif (!value) {\n\t\t\t\t// Get cached default map or make it if needed\n\t\t\t\tvalue = mapCache[option];\n\n\t\t\t\tif (!value) {\n\t\t\t\t\tvalue = makeMap(default_value, ' ', makeMap(default_value.toUpperCase(), ' '));\n\t\t\t\t\tvalue = extend(value, extendWith);\n\n\t\t\t\t\tmapCache[option] = value;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Create custom map\n\t\t\t\tvalue = makeMap(value, /[, ]/, makeMap(value.toUpperCase(), /[, ]/));\n\t\t\t}\n\n\t\t\treturn value;\n\t\t}\n\n\t\tsettings = settings || {};\n\t\tschemaItems = compileSchema(settings.schema);\n\n\t\t// Allow all elements and attributes if verify_html is set to false\n\t\tif (settings.verify_html === false) {\n\t\t\tsettings.valid_elements = '*[*]';\n\t\t}\n\n\t\tvalidStyles = compileElementMap(settings.valid_styles);\n\t\tinvalidStyles = compileElementMap(settings.invalid_styles, 'map');\n\t\tvalidClasses = compileElementMap(settings.valid_classes, 'map');\n\n\t\t// Setup map objects\n\t\twhiteSpaceElementsMap = createLookupTable('whitespace_elements', 'pre script noscript style textarea video audio iframe object');\n\t\tselfClosingElementsMap = createLookupTable('self_closing_elements', 'colgroup dd dt li option p td tfoot th thead tr');\n\t\tshortEndedElementsMap = createLookupTable('short_ended_elements', 'area base basefont br col frame hr img input isindex link ' +\n\t\t'meta param embed source wbr track');\n\t\tboolAttrMap = createLookupTable('boolean_attributes', 'checked compact declare defer disabled ismap multiple nohref noresize ' +\n\t\t'noshade nowrap readonly selected autoplay loop controls');\n\t\tnonEmptyElementsMap = createLookupTable('non_empty_elements', 'td th iframe video audio object script', shortEndedElementsMap);\n\t\tmoveCaretBeforeOnEnterElementsMap = createLookupTable('move_caret_before_on_enter_elements', 'table', nonEmptyElementsMap);\n\t\ttextBlockElementsMap = createLookupTable('text_block_elements', 'h1 h2 h3 h4 h5 h6 p div address pre form ' +\n\t\t'blockquote center dir fieldset header footer article section hgroup aside nav figure');\n\t\tblockElementsMap = createLookupTable('block_elements', 'hr table tbody thead tfoot ' +\n\t\t'th tr td li ol ul caption dl dt dd noscript menu isindex option ' +\n\t\t'datalist select optgroup figcaption', textBlockElementsMap);\n\t\ttextInlineElementsMap = createLookupTable('text_inline_elements', 'span strong b em i font strike u var cite ' +\n\t\t'dfn code mark q sup sub samp');\n\n\t\teach((settings.special || 'script noscript style textarea').split(' '), function(name) {\n\t\t\tspecialElements[name] = new RegExp('<\\/' + name + '[^>]*>', 'gi');\n\t\t});\n\n\t\t// Converts a wildcard expression string to a regexp for example *a will become /.*a/.\n\t\tfunction patternToRegExp(str) {\n\t\t\treturn new RegExp('^' + str.replace(/([?+*])/g, '.$1') + '$');\n\t\t}\n\n\t\t// Parses the specified valid_elements string and adds to the current rules\n\t\t// This function is a bit hard to read since it's heavily optimized for speed\n\t\tfunction addValidElements(validElements) {\n\t\t\tvar ei, el, ai, al, matches, element, attr, attrData, elementName, attrName, attrType, attributes, attributesOrder,\n\t\t\t\tprefix, outputName, globalAttributes, globalAttributesOrder, key, value,\n\t\t\t\telementRuleRegExp = /^([#+\\-])?([^\\[!\\/]+)(?:\\/([^\\[!]+))?(?:(!?)\\[([^\\]]+)\\])?$/,\n\t\t\t\tattrRuleRegExp = /^([!\\-])?(\\w+::\\w+|[^=:<]+)?(?:([=:<])(.*))?$/,\n\t\t\t\thasPatternsRegExp = /[*?+]/;\n\n\t\t\tif (validElements) {\n\t\t\t\t// Split valid elements into an array with rules\n\t\t\t\tvalidElements = split(validElements, ',');\n\n\t\t\t\tif (elements['@']) {\n\t\t\t\t\tglobalAttributes = elements['@'].attributes;\n\t\t\t\t\tglobalAttributesOrder = elements['@'].attributesOrder;\n\t\t\t\t}\n\n\t\t\t\t// Loop all rules\n\t\t\t\tfor (ei = 0, el = validElements.length; ei < el; ei++) {\n\t\t\t\t\t// Parse element rule\n\t\t\t\t\tmatches = elementRuleRegExp.exec(validElements[ei]);\n\t\t\t\t\tif (matches) {\n\t\t\t\t\t\t// Setup local names for matches\n\t\t\t\t\t\tprefix = matches[1];\n\t\t\t\t\t\telementName = matches[2];\n\t\t\t\t\t\toutputName = matches[3];\n\t\t\t\t\t\tattrData = matches[5];\n\n\t\t\t\t\t\t// Create new attributes and attributesOrder\n\t\t\t\t\t\tattributes = {};\n\t\t\t\t\t\tattributesOrder = [];\n\n\t\t\t\t\t\t// Create the new element\n\t\t\t\t\t\telement = {\n\t\t\t\t\t\t\tattributes: attributes,\n\t\t\t\t\t\t\tattributesOrder: attributesOrder\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\t// Padd empty elements prefix\n\t\t\t\t\t\tif (prefix === '#') {\n\t\t\t\t\t\t\telement.paddEmpty = true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Remove empty elements prefix\n\t\t\t\t\t\tif (prefix === '-') {\n\t\t\t\t\t\t\telement.removeEmpty = true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (matches[4] === '!') {\n\t\t\t\t\t\t\telement.removeEmptyAttrs = true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Copy attributes from global rule into current rule\n\t\t\t\t\t\tif (globalAttributes) {\n\t\t\t\t\t\t\tfor (key in globalAttributes) {\n\t\t\t\t\t\t\t\tattributes[key] = globalAttributes[key];\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tattributesOrder.push.apply(attributesOrder, globalAttributesOrder);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Attributes defined\n\t\t\t\t\t\tif (attrData) {\n\t\t\t\t\t\t\tattrData = split(attrData, '|');\n\t\t\t\t\t\t\tfor (ai = 0, al = attrData.length; ai < al; ai++) {\n\t\t\t\t\t\t\t\tmatches = attrRuleRegExp.exec(attrData[ai]);\n\t\t\t\t\t\t\t\tif (matches) {\n\t\t\t\t\t\t\t\t\tattr = {};\n\t\t\t\t\t\t\t\t\tattrType = matches[1];\n\t\t\t\t\t\t\t\t\tattrName = matches[2].replace(/::/g, ':');\n\t\t\t\t\t\t\t\t\tprefix = matches[3];\n\t\t\t\t\t\t\t\t\tvalue = matches[4];\n\n\t\t\t\t\t\t\t\t\t// Required\n\t\t\t\t\t\t\t\t\tif (attrType === '!') {\n\t\t\t\t\t\t\t\t\t\telement.attributesRequired = element.attributesRequired || [];\n\t\t\t\t\t\t\t\t\t\telement.attributesRequired.push(attrName);\n\t\t\t\t\t\t\t\t\t\tattr.required = true;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t// Denied from global\n\t\t\t\t\t\t\t\t\tif (attrType === '-') {\n\t\t\t\t\t\t\t\t\t\tdelete attributes[attrName];\n\t\t\t\t\t\t\t\t\t\tattributesOrder.splice(inArray(attributesOrder, attrName), 1);\n\t\t\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t// Default value\n\t\t\t\t\t\t\t\t\tif (prefix) {\n\t\t\t\t\t\t\t\t\t\t// Default value\n\t\t\t\t\t\t\t\t\t\tif (prefix === '=') {\n\t\t\t\t\t\t\t\t\t\t\telement.attributesDefault = element.attributesDefault || [];\n\t\t\t\t\t\t\t\t\t\t\telement.attributesDefault.push({name: attrName, value: value});\n\t\t\t\t\t\t\t\t\t\t\tattr.defaultValue = value;\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t// Forced value\n\t\t\t\t\t\t\t\t\t\tif (prefix === ':') {\n\t\t\t\t\t\t\t\t\t\t\telement.attributesForced = element.attributesForced || [];\n\t\t\t\t\t\t\t\t\t\t\telement.attributesForced.push({name: attrName, value: value});\n\t\t\t\t\t\t\t\t\t\t\tattr.forcedValue = value;\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t// Required values\n\t\t\t\t\t\t\t\t\t\tif (prefix === '<') {\n\t\t\t\t\t\t\t\t\t\t\tattr.validValues = makeMap(value, '?');\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t// Check for attribute patterns\n\t\t\t\t\t\t\t\t\tif (hasPatternsRegExp.test(attrName)) {\n\t\t\t\t\t\t\t\t\t\telement.attributePatterns = element.attributePatterns || [];\n\t\t\t\t\t\t\t\t\t\tattr.pattern = patternToRegExp(attrName);\n\t\t\t\t\t\t\t\t\t\telement.attributePatterns.push(attr);\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t// Add attribute to order list if it doesn't already exist\n\t\t\t\t\t\t\t\t\t\tif (!attributes[attrName]) {\n\t\t\t\t\t\t\t\t\t\t\tattributesOrder.push(attrName);\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tattributes[attrName] = attr;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Global rule, store away these for later usage\n\t\t\t\t\t\tif (!globalAttributes && elementName == '@') {\n\t\t\t\t\t\t\tglobalAttributes = attributes;\n\t\t\t\t\t\t\tglobalAttributesOrder = attributesOrder;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Handle substitute elements such as b/strong\n\t\t\t\t\t\tif (outputName) {\n\t\t\t\t\t\t\telement.outputName = elementName;\n\t\t\t\t\t\t\telements[outputName] = element;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Add pattern or exact element\n\t\t\t\t\t\tif (hasPatternsRegExp.test(elementName)) {\n\t\t\t\t\t\t\telement.pattern = patternToRegExp(elementName);\n\t\t\t\t\t\t\tpatternElements.push(element);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\telements[elementName] = element;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction setValidElements(validElements) {\n\t\t\telements = {};\n\t\t\tpatternElements = [];\n\n\t\t\taddValidElements(validElements);\n\n\t\t\teach(schemaItems, function(element, name) {\n\t\t\t\tchildren[name] = element.children;\n\t\t\t});\n\t\t}\n\n\t\t// Adds custom non HTML elements to the schema\n\t\tfunction addCustomElements(customElements) {\n\t\t\tvar customElementRegExp = /^(~)?(.+)$/;\n\n\t\t\tif (customElements) {\n\t\t\t\t// Flush cached items since we are altering the default maps\n\t\t\t\tmapCache.text_block_elements = mapCache.block_elements = null;\n\n\t\t\t\teach(split(customElements, ','), function(rule) {\n\t\t\t\t\tvar matches = customElementRegExp.exec(rule),\n\t\t\t\t\t\tinline = matches[1] === '~',\n\t\t\t\t\t\tcloneName = inline ? 'span' : 'div',\n\t\t\t\t\t\tname = matches[2];\n\n\t\t\t\t\tchildren[name] = children[cloneName];\n\t\t\t\t\tcustomElementsMap[name] = cloneName;\n\n\t\t\t\t\t// If it's not marked as inline then add it to valid block elements\n\t\t\t\t\tif (!inline) {\n\t\t\t\t\t\tblockElementsMap[name.toUpperCase()] = {};\n\t\t\t\t\t\tblockElementsMap[name] = {};\n\t\t\t\t\t}\n\n\t\t\t\t\t// Add elements clone if needed\n\t\t\t\t\tif (!elements[name]) {\n\t\t\t\t\t\tvar customRule = elements[cloneName];\n\n\t\t\t\t\t\tcustomRule = extend({}, customRule);\n\t\t\t\t\t\tdelete customRule.removeEmptyAttrs;\n\t\t\t\t\t\tdelete customRule.removeEmpty;\n\n\t\t\t\t\t\telements[name] = customRule;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Add custom elements at span/div positions\n\t\t\t\t\teach(children, function(element, elmName) {\n\t\t\t\t\t\tif (element[cloneName]) {\n\t\t\t\t\t\t\tchildren[elmName] = element = extend({}, children[elmName]);\n\t\t\t\t\t\t\telement[name] = element[cloneName];\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t// Adds valid children to the schema object\n\t\tfunction addValidChildren(validChildren) {\n\t\t\tvar childRuleRegExp = /^([+\\-]?)(\\w+)\\[([^\\]]+)\\]$/;\n\n\t\t\t// Invalidate the schema cache if the schema is mutated\n\t\t\tmapCache[settings.schema] = null;\n\n\t\t\tif (validChildren) {\n\t\t\t\teach(split(validChildren, ','), function(rule) {\n\t\t\t\t\tvar matches = childRuleRegExp.exec(rule), parent, prefix;\n\n\t\t\t\t\tif (matches) {\n\t\t\t\t\t\tprefix = matches[1];\n\n\t\t\t\t\t\t// Add/remove items from default\n\t\t\t\t\t\tif (prefix) {\n\t\t\t\t\t\t\tparent = children[matches[2]];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tparent = children[matches[2]] = {'#comment': {}};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tparent = children[matches[2]];\n\n\t\t\t\t\t\teach(split(matches[3], '|'), function(child) {\n\t\t\t\t\t\t\tif (prefix === '-') {\n\t\t\t\t\t\t\t\tdelete parent[child];\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tparent[child] = {};\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tfunction getElementRule(name) {\n\t\t\tvar element = elements[name], i;\n\n\t\t\t// Exact match found\n\t\t\tif (element) {\n\t\t\t\treturn element;\n\t\t\t}\n\n\t\t\t// No exact match then try the patterns\n\t\t\ti = patternElements.length;\n\t\t\twhile (i--) {\n\t\t\t\telement = patternElements[i];\n\n\t\t\t\tif (element.pattern.test(name)) {\n\t\t\t\t\treturn element;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (!settings.valid_elements) {\n\t\t\t// No valid elements defined then clone the elements from the schema spec\n\t\t\teach(schemaItems, function(element, name) {\n\t\t\t\telements[name] = {\n\t\t\t\t\tattributes: element.attributes,\n\t\t\t\t\tattributesOrder: element.attributesOrder\n\t\t\t\t};\n\n\t\t\t\tchildren[name] = element.children;\n\t\t\t});\n\n\t\t\t// Switch these on HTML4\n\t\t\tif (settings.schema != \"html5\") {\n\t\t\t\teach(split('strong/b em/i'), function(item) {\n\t\t\t\t\titem = split(item, '/');\n\t\t\t\t\telements[item[1]].outputName = item[0];\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Add default alt attribute for images, removed since alt=\"\" is treated as presentational.\n\t\t\t// elements.img.attributesDefault = [{name: 'alt', value: ''}];\n\n\t\t\t// Remove these if they are empty by default\n\t\t\teach(split('ol ul sub sup blockquote span font a table tbody tr strong em b i'), function(name) {\n\t\t\t\tif (elements[name]) {\n\t\t\t\t\telements[name].removeEmpty = true;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Padd these by default\n\t\t\teach(split('p h1 h2 h3 h4 h5 h6 th td pre div address caption'), function(name) {\n\t\t\t\telements[name].paddEmpty = true;\n\t\t\t});\n\n\t\t\t// Remove these if they have no attributes\n\t\t\teach(split('span'), function(name) {\n\t\t\t\telements[name].removeEmptyAttrs = true;\n\t\t\t});\n\n\t\t\t// Remove these by default\n\t\t\t// TODO: Reenable in 4.1\n\t\t\t/*each(split('script style'), function(name) {\n\t\t\t delete elements[name];\n\t\t\t });*/\n\t\t} else {\n\t\t\tsetValidElements(settings.valid_elements);\n\t\t}\n\n\t\taddCustomElements(settings.custom_elements);\n\t\taddValidChildren(settings.valid_children);\n\t\taddValidElements(settings.extended_valid_elements);\n\n\t\t// Todo: Remove this when we fix list handling to be valid\n\t\taddValidChildren('+ol[ul|ol],+ul[ul|ol]');\n\n\n\t\t// Some elements are not valid by themselves - require parents\n\t\teach({\n\t\t\tdd: 'dl',\n\t\t\tdt: 'dl',\n\t\t\tli: 'ul ol',\n\t\t\ttd: 'tr',\n\t\t\tth: 'tr',\n\t\t\ttr: 'tbody thead tfoot',\n\t\t\ttbody: 'table',\n\t\t\tthead: 'table',\n\t\t\ttfoot: 'table',\n\t\t\tlegend: 'fieldset',\n\t\t\tarea: 'map',\n\t\t\tparam: 'video audio object'\n\t\t}, function(parents, item) {\n\t\t\tif (elements[item]) {\n\t\t\t\telements[item].parentsRequired = split(parents);\n\t\t\t}\n\t\t});\n\n\n\t\t// Delete invalid elements\n\t\tif (settings.invalid_elements) {\n\t\t\teach(explode(settings.invalid_elements), function(item) {\n\t\t\t\tif (elements[item]) {\n\t\t\t\t\tdelete elements[item];\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// If the user didn't allow span only allow internal spans\n\t\tif (!getElementRule('span')) {\n\t\t\taddValidElements('span[!data-mce-type|*]');\n\t\t}\n\n\t\t/**\n\t\t * Name/value map object with valid parents and children to those parents.\n\t\t *\n\t\t * @example\n\t\t * children = {\n\t\t *    div:{p:{}, h1:{}}\n\t\t * };\n\t\t * @field children\n\t\t * @type Object\n\t\t */\n\t\tself.children = children;\n\n\t\t/**\n\t\t * Name/value map object with valid styles for each element.\n\t\t *\n\t\t * @method getValidStyles\n\t\t * @type Object\n\t\t */\n\t\tself.getValidStyles = function() {\n\t\t\treturn validStyles;\n\t\t};\n\n\t\t/**\n\t\t * Name/value map object with valid styles for each element.\n\t\t *\n\t\t * @method getInvalidStyles\n\t\t * @type Object\n\t\t */\n\t\tself.getInvalidStyles = function() {\n\t\t\treturn invalidStyles;\n\t\t};\n\n\t\t/**\n\t\t * Name/value map object with valid classes for each element.\n\t\t *\n\t\t * @method getValidClasses\n\t\t * @type Object\n\t\t */\n\t\tself.getValidClasses = function() {\n\t\t\treturn validClasses;\n\t\t};\n\n\t\t/**\n\t\t * Returns a map with boolean attributes.\n\t\t *\n\t\t * @method getBoolAttrs\n\t\t * @return {Object} Name/value lookup map for boolean attributes.\n\t\t */\n\t\tself.getBoolAttrs = function() {\n\t\t\treturn boolAttrMap;\n\t\t};\n\n\t\t/**\n\t\t * Returns a map with block elements.\n\t\t *\n\t\t * @method getBlockElements\n\t\t * @return {Object} Name/value lookup map for block elements.\n\t\t */\n\t\tself.getBlockElements = function() {\n\t\t\treturn blockElementsMap;\n\t\t};\n\n\t\t/**\n\t\t * Returns a map with text block elements. Such as: p,h1-h6,div,address\n\t\t *\n\t\t * @method getTextBlockElements\n\t\t * @return {Object} Name/value lookup map for block elements.\n\t\t */\n\t\tself.getTextBlockElements = function() {\n\t\t\treturn textBlockElementsMap;\n\t\t};\n\n\t\t/**\n\t\t * Returns a map of inline text format nodes for example strong/span or ins.\n\t\t *\n\t\t * @method getTextInlineElements\n\t\t * @return {Object} Name/value lookup map for text format elements.\n\t\t */\n\t\tself.getTextInlineElements = function() {\n\t\t\treturn textInlineElementsMap;\n\t\t};\n\n\t\t/**\n\t\t * Returns a map with short ended elements such as BR or IMG.\n\t\t *\n\t\t * @method getShortEndedElements\n\t\t * @return {Object} Name/value lookup map for short ended elements.\n\t\t */\n\t\tself.getShortEndedElements = function() {\n\t\t\treturn shortEndedElementsMap;\n\t\t};\n\n\t\t/**\n\t\t * Returns a map with self closing tags such as <li>.\n\t\t *\n\t\t * @method getSelfClosingElements\n\t\t * @return {Object} Name/value lookup map for self closing tags elements.\n\t\t */\n\t\tself.getSelfClosingElements = function() {\n\t\t\treturn selfClosingElementsMap;\n\t\t};\n\n\t\t/**\n\t\t * Returns a map with elements that should be treated as contents regardless if it has text\n\t\t * content in them or not such as TD, VIDEO or IMG.\n\t\t *\n\t\t * @method getNonEmptyElements\n\t\t * @return {Object} Name/value lookup map for non empty elements.\n\t\t */\n\t\tself.getNonEmptyElements = function() {\n\t\t\treturn nonEmptyElementsMap;\n\t\t};\n\n\t\t/**\n\t\t * Returns a map with elements that the caret should be moved in front of after enter is\n\t\t * pressed\n\t\t *\n\t\t * @method getMoveCaretBeforeOnEnterElements\n\t\t * @return {Object} Name/value lookup map for elements to place the caret in front of.\n\t\t */\n\t\tself.getMoveCaretBeforeOnEnterElements = function() {\n\t\t\treturn moveCaretBeforeOnEnterElementsMap;\n\t\t};\n\n\t\t/**\n\t\t * Returns a map with elements where white space is to be preserved like PRE or SCRIPT.\n\t\t *\n\t\t * @method getWhiteSpaceElements\n\t\t * @return {Object} Name/value lookup map for white space elements.\n\t\t */\n\t\tself.getWhiteSpaceElements = function() {\n\t\t\treturn whiteSpaceElementsMap;\n\t\t};\n\n\t\t/**\n\t\t * Returns a map with special elements. These are elements that needs to be parsed\n\t\t * in a special way such as script, style, textarea etc. The map object values\n\t\t * are regexps used to find the end of the element.\n\t\t *\n\t\t * @method getSpecialElements\n\t\t * @return {Object} Name/value lookup map for special elements.\n\t\t */\n\t\tself.getSpecialElements = function() {\n\t\t\treturn specialElements;\n\t\t};\n\n\t\t/**\n\t\t * Returns true/false if the specified element and it's child is valid or not\n\t\t * according to the schema.\n\t\t *\n\t\t * @method isValidChild\n\t\t * @param {String} name Element name to check for.\n\t\t * @param {String} child Element child to verify.\n\t\t * @return {Boolean} True/false if the element is a valid child of the specified parent.\n\t\t */\n\t\tself.isValidChild = function(name, child) {\n\t\t\tvar parent = children[name];\n\n\t\t\treturn !!(parent && parent[child]);\n\t\t};\n\n\t\t/**\n\t\t * Returns true/false if the specified element name and optional attribute is\n\t\t * valid according to the schema.\n\t\t *\n\t\t * @method isValid\n\t\t * @param {String} name Name of element to check.\n\t\t * @param {String} attr Optional attribute name to check for.\n\t\t * @return {Boolean} True/false if the element and attribute is valid.\n\t\t */\n\t\tself.isValid = function(name, attr) {\n\t\t\tvar attrPatterns, i, rule = getElementRule(name);\n\n\t\t\t// Check if it's a valid element\n\t\t\tif (rule) {\n\t\t\t\tif (attr) {\n\t\t\t\t\t// Check if attribute name exists\n\t\t\t\t\tif (rule.attributes[attr]) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Check if attribute matches a regexp pattern\n\t\t\t\t\tattrPatterns = rule.attributePatterns;\n\t\t\t\t\tif (attrPatterns) {\n\t\t\t\t\t\ti = attrPatterns.length;\n\t\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\t\tif (attrPatterns[i].pattern.test(name)) {\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// No match\n\t\t\treturn false;\n\t\t};\n\n\t\t/**\n\t\t * Returns true/false if the specified element is valid or not\n\t\t * according to the schema.\n\t\t *\n\t\t * @method getElementRule\n\t\t * @param {String} name Element name to check for.\n\t\t * @return {Object} Element object or undefined if the element isn't valid.\n\t\t */\n\t\tself.getElementRule = getElementRule;\n\n\t\t/**\n\t\t * Returns an map object of all custom elements.\n\t\t *\n\t\t * @method getCustomElements\n\t\t * @return {Object} Name/value map object of all custom elements.\n\t\t */\n\t\tself.getCustomElements = function() {\n\t\t\treturn customElementsMap;\n\t\t};\n\n\t\t/**\n\t\t * Parses a valid elements string and adds it to the schema. The valid elements\n\t\t * format is for example \"element[attr=default|otherattr]\".\n\t\t * Existing rules will be replaced with the ones specified, so this extends the schema.\n\t\t *\n\t\t * @method addValidElements\n\t\t * @param {String} valid_elements String in the valid elements format to be parsed.\n\t\t */\n\t\tself.addValidElements = addValidElements;\n\n\t\t/**\n\t\t * Parses a valid elements string and sets it to the schema. The valid elements\n\t\t * format is for example \"element[attr=default|otherattr]\".\n\t\t * Existing rules will be replaced with the ones specified, so this extends the schema.\n\t\t *\n\t\t * @method setValidElements\n\t\t * @param {String} valid_elements String in the valid elements format to be parsed.\n\t\t */\n\t\tself.setValidElements = setValidElements;\n\n\t\t/**\n\t\t * Adds custom non HTML elements to the schema.\n\t\t *\n\t\t * @method addCustomElements\n\t\t * @param {String} custom_elements Comma separated list of custom elements to add.\n\t\t */\n\t\tself.addCustomElements = addCustomElements;\n\n\t\t/**\n\t\t * Parses a valid children string and adds them to the schema structure. The valid children\n\t\t * format is for example: \"element[child1|child2]\".\n\t\t *\n\t\t * @method addValidChildren\n\t\t * @param {String} valid_children Valid children elements string to parse\n\t\t */\n\t\tself.addValidChildren = addValidChildren;\n\n\t\tself.elements = elements;\n\t};\n});\n\n// Included from: js/tinymce/classes/html/SaxParser.js\n\n/**\n * SaxParser.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/*eslint max-depth:[2, 9] */\n\n/**\n * This class parses HTML code using pure JavaScript and executes various events for each item it finds. It will\n * always execute the events in the right order for tag soup code like <b><p></b></p>. It will also remove elements\n * and attributes that doesn't fit the schema if the validate setting is enabled.\n *\n * @example\n * var parser = new tinymce.html.SaxParser({\n *     validate: true,\n *\n *     comment: function(text) {\n *         console.log('Comment:', text);\n *     },\n *\n *     cdata: function(text) {\n *         console.log('CDATA:', text);\n *     },\n *\n *     text: function(text, raw) {\n *         console.log('Text:', text, 'Raw:', raw);\n *     },\n *\n *     start: function(name, attrs, empty) {\n *         console.log('Start:', name, attrs, empty);\n *     },\n *\n *     end: function(name) {\n *         console.log('End:', name);\n *     },\n *\n *     pi: function(name, text) {\n *         console.log('PI:', name, text);\n *     },\n *\n *     doctype: function(text) {\n *         console.log('DocType:', text);\n *     }\n * }, schema);\n * @class tinymce.html.SaxParser\n * @version 3.4\n */\ndefine(\"tinymce/html/SaxParser\", [\n\t\"tinymce/html/Schema\",\n\t\"tinymce/html/Entities\",\n\t\"tinymce/util/Tools\"\n], function(Schema, Entities, Tools) {\n\tvar each = Tools.each;\n\n\t/**\n\t * Returns the index of the end tag for a specific start tag. This can be\n\t * used to skip all children of a parent element from being processed.\n\t *\n\t * @private\n\t * @method findEndTag\n\t * @param {tinymce.html.Schema} schema Schema instance to use to match short ended elements.\n\t * @param {String} html HTML string to find the end tag in.\n\t * @param {Number} startIndex Indext to start searching at should be after the start tag.\n\t * @return {Number} Index of the end tag.\n\t */\n\tfunction findEndTag(schema, html, startIndex) {\n\t\tvar count = 1, index, matches, tokenRegExp, shortEndedElements;\n\n\t\tshortEndedElements = schema.getShortEndedElements();\n\t\ttokenRegExp = /<([!?\\/])?([A-Za-z0-9\\-_\\:\\.]+)((?:\\s+[^\"\\'>]+(?:(?:\"[^\"]*\")|(?:\\'[^\\']*\\')|[^>]*))*|\\/|\\s+)>/g;\n\t\ttokenRegExp.lastIndex = index = startIndex;\n\n\t\twhile ((matches = tokenRegExp.exec(html))) {\n\t\t\tindex = tokenRegExp.lastIndex;\n\n\t\t\tif (matches[1] === '/') { // End element\n\t\t\t\tcount--;\n\t\t\t} else if (!matches[1]) { // Start element\n\t\t\t\tif (matches[2] in shortEndedElements) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tcount++;\n\t\t\t}\n\n\t\t\tif (count === 0) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn index;\n\t}\n\n\t/**\n\t * Constructs a new SaxParser instance.\n\t *\n\t * @constructor\n\t * @method SaxParser\n\t * @param {Object} settings Name/value collection of settings. comment, cdata, text, start and end are callbacks.\n\t * @param {tinymce.html.Schema} schema HTML Schema class to use when parsing.\n\t */\n\tfunction SaxParser(settings, schema) {\n\t\tvar self = this;\n\n\t\tfunction noop() {}\n\n\t\tsettings = settings || {};\n\t\tself.schema = schema = schema || new Schema();\n\n\t\tif (settings.fix_self_closing !== false) {\n\t\t\tsettings.fix_self_closing = true;\n\t\t}\n\n\t\t// Add handler functions from settings and setup default handlers\n\t\teach('comment cdata text start end pi doctype'.split(' '), function(name) {\n\t\t\tif (name) {\n\t\t\t\tself[name] = settings[name] || noop;\n\t\t\t}\n\t\t});\n\n\t\t/**\n\t\t * Parses the specified HTML string and executes the callbacks for each item it finds.\n\t\t *\n\t\t * @example\n\t\t * new SaxParser({...}).parse('<b>text</b>');\n\t\t * @method parse\n\t\t * @param {String} html Html string to sax parse.\n\t\t */\n\t\tself.parse = function(html) {\n\t\t\tvar self = this, matches, index = 0, value, endRegExp, stack = [], attrList, i, text, name;\n\t\t\tvar isInternalElement, removeInternalElements, shortEndedElements, fillAttrsMap, isShortEnded;\n\t\t\tvar validate, elementRule, isValidElement, attr, attribsValue, validAttributesMap, validAttributePatterns;\n\t\t\tvar attributesRequired, attributesDefault, attributesForced;\n\t\t\tvar anyAttributesRequired, selfClosing, tokenRegExp, attrRegExp, specialElements, attrValue, idCount = 0;\n\t\t\tvar decode = Entities.decode, fixSelfClosing, filteredUrlAttrs = Tools.makeMap('src,href,data,background,formaction,poster');\n\t\t\tvar scriptUriRegExp = /((java|vb)script|mhtml):/i, dataUriRegExp = /^data:/i;\n\n\t\t\tfunction processEndTag(name) {\n\t\t\t\tvar pos, i;\n\n\t\t\t\t// Find position of parent of the same type\n\t\t\t\tpos = stack.length;\n\t\t\t\twhile (pos--) {\n\t\t\t\t\tif (stack[pos].name === name) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Found parent\n\t\t\t\tif (pos >= 0) {\n\t\t\t\t\t// Close all the open elements\n\t\t\t\t\tfor (i = stack.length - 1; i >= pos; i--) {\n\t\t\t\t\t\tname = stack[i];\n\n\t\t\t\t\t\tif (name.valid) {\n\t\t\t\t\t\t\tself.end(name.name);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Remove the open elements from the stack\n\t\t\t\t\tstack.length = pos;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction parseAttribute(match, name, value, val2, val3) {\n\t\t\t\tvar attrRule, i, trimRegExp = /[\\s\\u0000-\\u001F]+/g;\n\n\t\t\t\tname = name.toLowerCase();\n\t\t\t\tvalue = name in fillAttrsMap ? name : decode(value || val2 || val3 || ''); // Handle boolean attribute than value attribute\n\n\t\t\t\t// Validate name and value pass through all data- attributes\n\t\t\t\tif (validate && !isInternalElement && name.indexOf('data-') !== 0) {\n\t\t\t\t\tattrRule = validAttributesMap[name];\n\n\t\t\t\t\t// Find rule by pattern matching\n\t\t\t\t\tif (!attrRule && validAttributePatterns) {\n\t\t\t\t\t\ti = validAttributePatterns.length;\n\t\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\t\tattrRule = validAttributePatterns[i];\n\t\t\t\t\t\t\tif (attrRule.pattern.test(name)) {\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// No rule matched\n\t\t\t\t\t\tif (i === -1) {\n\t\t\t\t\t\t\tattrRule = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// No attribute rule found\n\t\t\t\t\tif (!attrRule) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Validate value\n\t\t\t\t\tif (attrRule.validValues && !(value in attrRule.validValues)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Block any javascript: urls or non image data uris\n\t\t\t\tif (filteredUrlAttrs[name] && !settings.allow_script_urls) {\n\t\t\t\t\tvar uri = value.replace(trimRegExp, '');\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// Might throw malformed URI sequence\n\t\t\t\t\t\turi = decodeURIComponent(uri);\n\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t// Fallback to non UTF-8 decoder\n\t\t\t\t\t\turi = unescape(uri);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (scriptUriRegExp.test(uri)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!settings.allow_html_data_urls && dataUriRegExp.test(uri) && !/^data:image\\//i.test(uri)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Add attribute to list and map\n\t\t\t\tattrList.map[name] = value;\n\t\t\t\tattrList.push({\n\t\t\t\t\tname: name,\n\t\t\t\t\tvalue: value\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Precompile RegExps and map objects\n\t\t\ttokenRegExp = new RegExp('<(?:' +\n\t\t\t\t'(?:!--([\\\\w\\\\W]*?)-->)|' + // Comment\n\t\t\t\t'(?:!\\\\[CDATA\\\\[([\\\\w\\\\W]*?)\\\\]\\\\]>)|' + // CDATA\n\t\t\t\t'(?:!DOCTYPE([\\\\w\\\\W]*?)>)|' + // DOCTYPE\n\t\t\t\t'(?:\\\\?([^\\\\s\\\\/<>]+) ?([\\\\w\\\\W]*?)[?/]>)|' + // PI\n\t\t\t\t'(?:\\\\/([^>]+)>)|' + // End element\n\t\t\t\t'(?:([A-Za-z0-9\\\\-_\\\\:\\\\.]+)((?:\\\\s+[^\"\\'>]+(?:(?:\"[^\"]*\")|(?:\\'[^\\']*\\')|[^>]*))*|\\\\/|\\\\s+)>)' + // Start element\n\t\t\t')', 'g');\n\n\t\t\tattrRegExp = /([\\w:\\-]+)(?:\\s*=\\s*(?:(?:\\\"((?:[^\\\"])*)\\\")|(?:\\'((?:[^\\'])*)\\')|([^>\\s]+)))?/g;\n\n\t\t\t// Setup lookup tables for empty elements and boolean attributes\n\t\t\tshortEndedElements = schema.getShortEndedElements();\n\t\t\tselfClosing = settings.self_closing_elements || schema.getSelfClosingElements();\n\t\t\tfillAttrsMap = schema.getBoolAttrs();\n\t\t\tvalidate = settings.validate;\n\t\t\tremoveInternalElements = settings.remove_internals;\n\t\t\tfixSelfClosing = settings.fix_self_closing;\n\t\t\tspecialElements = schema.getSpecialElements();\n\n\t\t\twhile ((matches = tokenRegExp.exec(html))) {\n\t\t\t\t// Text\n\t\t\t\tif (index < matches.index) {\n\t\t\t\t\tself.text(decode(html.substr(index, matches.index - index)));\n\t\t\t\t}\n\n\t\t\t\tif ((value = matches[6])) { // End element\n\t\t\t\t\tvalue = value.toLowerCase();\n\n\t\t\t\t\t// IE will add a \":\" in front of elements it doesn't understand like custom elements or HTML5 elements\n\t\t\t\t\tif (value.charAt(0) === ':') {\n\t\t\t\t\t\tvalue = value.substr(1);\n\t\t\t\t\t}\n\n\t\t\t\t\tprocessEndTag(value);\n\t\t\t\t} else if ((value = matches[7])) { // Start element\n\t\t\t\t\tvalue = value.toLowerCase();\n\n\t\t\t\t\t// IE will add a \":\" in front of elements it doesn't understand like custom elements or HTML5 elements\n\t\t\t\t\tif (value.charAt(0) === ':') {\n\t\t\t\t\t\tvalue = value.substr(1);\n\t\t\t\t\t}\n\n\t\t\t\t\tisShortEnded = value in shortEndedElements;\n\n\t\t\t\t\t// Is self closing tag for example an <li> after an open <li>\n\t\t\t\t\tif (fixSelfClosing && selfClosing[value] && stack.length > 0 && stack[stack.length - 1].name === value) {\n\t\t\t\t\t\tprocessEndTag(value);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Validate element\n\t\t\t\t\tif (!validate || (elementRule = schema.getElementRule(value))) {\n\t\t\t\t\t\tisValidElement = true;\n\n\t\t\t\t\t\t// Grab attributes map and patters when validation is enabled\n\t\t\t\t\t\tif (validate) {\n\t\t\t\t\t\t\tvalidAttributesMap = elementRule.attributes;\n\t\t\t\t\t\t\tvalidAttributePatterns = elementRule.attributePatterns;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Parse attributes\n\t\t\t\t\t\tif ((attribsValue = matches[8])) {\n\t\t\t\t\t\t\tisInternalElement = attribsValue.indexOf('data-mce-type') !== -1; // Check if the element is an internal element\n\n\t\t\t\t\t\t\t// If the element has internal attributes then remove it if we are told to do so\n\t\t\t\t\t\t\tif (isInternalElement && removeInternalElements) {\n\t\t\t\t\t\t\t\tisValidElement = false;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tattrList = [];\n\t\t\t\t\t\t\tattrList.map = {};\n\n\t\t\t\t\t\t\tattribsValue.replace(attrRegExp, parseAttribute);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tattrList = [];\n\t\t\t\t\t\t\tattrList.map = {};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Process attributes if validation is enabled\n\t\t\t\t\t\tif (validate && !isInternalElement) {\n\t\t\t\t\t\t\tattributesRequired = elementRule.attributesRequired;\n\t\t\t\t\t\t\tattributesDefault = elementRule.attributesDefault;\n\t\t\t\t\t\t\tattributesForced = elementRule.attributesForced;\n\t\t\t\t\t\t\tanyAttributesRequired = elementRule.removeEmptyAttrs;\n\n\t\t\t\t\t\t\t// Check if any attribute exists\n\t\t\t\t\t\t\tif (anyAttributesRequired && !attrList.length) {\n\t\t\t\t\t\t\t\tisValidElement = false;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Handle forced attributes\n\t\t\t\t\t\t\tif (attributesForced) {\n\t\t\t\t\t\t\t\ti = attributesForced.length;\n\t\t\t\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\t\t\t\tattr = attributesForced[i];\n\t\t\t\t\t\t\t\t\tname = attr.name;\n\t\t\t\t\t\t\t\t\tattrValue = attr.value;\n\n\t\t\t\t\t\t\t\t\tif (attrValue === '{$uid}') {\n\t\t\t\t\t\t\t\t\t\tattrValue = 'mce_' + idCount++;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tattrList.map[name] = attrValue;\n\t\t\t\t\t\t\t\t\tattrList.push({name: name, value: attrValue});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Handle default attributes\n\t\t\t\t\t\t\tif (attributesDefault) {\n\t\t\t\t\t\t\t\ti = attributesDefault.length;\n\t\t\t\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\t\t\t\tattr = attributesDefault[i];\n\t\t\t\t\t\t\t\t\tname = attr.name;\n\n\t\t\t\t\t\t\t\t\tif (!(name in attrList.map)) {\n\t\t\t\t\t\t\t\t\t\tattrValue = attr.value;\n\n\t\t\t\t\t\t\t\t\t\tif (attrValue === '{$uid}') {\n\t\t\t\t\t\t\t\t\t\t\tattrValue = 'mce_' + idCount++;\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tattrList.map[name] = attrValue;\n\t\t\t\t\t\t\t\t\t\tattrList.push({name: name, value: attrValue});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Handle required attributes\n\t\t\t\t\t\t\tif (attributesRequired) {\n\t\t\t\t\t\t\t\ti = attributesRequired.length;\n\t\t\t\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\t\t\t\tif (attributesRequired[i] in attrList.map) {\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// None of the required attributes where found\n\t\t\t\t\t\t\t\tif (i === -1) {\n\t\t\t\t\t\t\t\t\tisValidElement = false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Invalidate element if it's marked as bogus\n\t\t\t\t\t\t\tif ((attr = attrList.map['data-mce-bogus'])) {\n\t\t\t\t\t\t\t\tif (attr === 'all') {\n\t\t\t\t\t\t\t\t\tindex = findEndTag(schema, html, tokenRegExp.lastIndex);\n\t\t\t\t\t\t\t\t\ttokenRegExp.lastIndex = index;\n\t\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tisValidElement = false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (isValidElement) {\n\t\t\t\t\t\t\tself.start(value, attrList, isShortEnded);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tisValidElement = false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Treat script, noscript and style a bit different since they may include code that looks like elements\n\t\t\t\t\tif ((endRegExp = specialElements[value])) {\n\t\t\t\t\t\tendRegExp.lastIndex = index = matches.index + matches[0].length;\n\n\t\t\t\t\t\tif ((matches = endRegExp.exec(html))) {\n\t\t\t\t\t\t\tif (isValidElement) {\n\t\t\t\t\t\t\t\ttext = html.substr(index, matches.index - index);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tindex = matches.index + matches[0].length;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ttext = html.substr(index);\n\t\t\t\t\t\t\tindex = html.length;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (isValidElement) {\n\t\t\t\t\t\t\tif (text.length > 0) {\n\t\t\t\t\t\t\t\tself.text(text, true);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tself.end(value);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttokenRegExp.lastIndex = index;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Push value on to stack\n\t\t\t\t\tif (!isShortEnded) {\n\t\t\t\t\t\tif (!attribsValue || attribsValue.indexOf('/') != attribsValue.length - 1) {\n\t\t\t\t\t\t\tstack.push({name: value, valid: isValidElement});\n\t\t\t\t\t\t} else if (isValidElement) {\n\t\t\t\t\t\t\tself.end(value);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if ((value = matches[1])) { // Comment\n\t\t\t\t\t// Padd comment value to avoid browsers from parsing invalid comments as HTML\n\t\t\t\t\tif (value.charAt(0) === '>') {\n\t\t\t\t\t\tvalue = ' ' + value;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!settings.allow_conditional_comments && value.substr(0, 3).toLowerCase() === '[if') {\n\t\t\t\t\t\tvalue = ' ' + value;\n\t\t\t\t\t}\n\n\t\t\t\t\tself.comment(value);\n\t\t\t\t} else if ((value = matches[2])) { // CDATA\n\t\t\t\t\tself.cdata(value);\n\t\t\t\t} else if ((value = matches[3])) { // DOCTYPE\n\t\t\t\t\tself.doctype(value);\n\t\t\t\t} else if ((value = matches[4])) { // PI\n\t\t\t\t\tself.pi(value, matches[5]);\n\t\t\t\t}\n\n\t\t\t\tindex = matches.index + matches[0].length;\n\t\t\t}\n\n\t\t\t// Text\n\t\t\tif (index < html.length) {\n\t\t\t\tself.text(decode(html.substr(index)));\n\t\t\t}\n\n\t\t\t// Close any open elements\n\t\t\tfor (i = stack.length - 1; i >= 0; i--) {\n\t\t\t\tvalue = stack[i];\n\n\t\t\t\tif (value.valid) {\n\t\t\t\t\tself.end(value.name);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\tSaxParser.findEndTag = findEndTag;\n\n\treturn SaxParser;\n});\n\n// Included from: js/tinymce/classes/html/DomParser.js\n\n/**\n * DomParser.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class parses HTML code into a DOM like structure of nodes it will remove redundant whitespace and make\n * sure that the node tree is valid according to the specified schema.\n * So for example: <p>a<p>b</p>c</p> will become <p>a</p><p>b</p><p>c</p>\n *\n * @example\n * var parser = new tinymce.html.DomParser({validate: true}, schema);\n * var rootNode = parser.parse('<h1>content</h1>');\n *\n * @class tinymce.html.DomParser\n * @version 3.4\n */\ndefine(\"tinymce/html/DomParser\", [\n\t\"tinymce/html/Node\",\n\t\"tinymce/html/Schema\",\n\t\"tinymce/html/SaxParser\",\n\t\"tinymce/util/Tools\"\n], function(Node, Schema, SaxParser, Tools) {\n\tvar makeMap = Tools.makeMap, each = Tools.each, explode = Tools.explode, extend = Tools.extend;\n\n\t/**\n\t * Constructs a new DomParser instance.\n\t *\n\t * @constructor\n\t * @method DomParser\n\t * @param {Object} settings Name/value collection of settings. comment, cdata, text, start and end are callbacks.\n\t * @param {tinymce.html.Schema} schema HTML Schema class to use when parsing.\n\t */\n\treturn function(settings, schema) {\n\t\tvar self = this, nodeFilters = {}, attributeFilters = [], matchedNodes = {}, matchedAttributes = {};\n\n\t\tsettings = settings || {};\n\t\tsettings.validate = \"validate\" in settings ? settings.validate : true;\n\t\tsettings.root_name = settings.root_name || 'body';\n\t\tself.schema = schema = schema || new Schema();\n\n\t\tfunction fixInvalidChildren(nodes) {\n\t\t\tvar ni, node, parent, parents, newParent, currentNode, tempNode, childNode, i;\n\t\t\tvar nonEmptyElements, nonSplitableElements, textBlockElements, specialElements, sibling, nextNode;\n\n\t\t\tnonSplitableElements = makeMap('tr,td,th,tbody,thead,tfoot,table');\n\t\t\tnonEmptyElements = schema.getNonEmptyElements();\n\t\t\ttextBlockElements = schema.getTextBlockElements();\n\t\t\tspecialElements = schema.getSpecialElements();\n\n\t\t\tfor (ni = 0; ni < nodes.length; ni++) {\n\t\t\t\tnode = nodes[ni];\n\n\t\t\t\t// Already removed or fixed\n\t\t\t\tif (!node.parent || node.fixed) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// If the invalid element is a text block and the text block is within a parent LI element\n\t\t\t\t// Then unwrap the first text block and convert other sibling text blocks to LI elements similar to Word/Open Office\n\t\t\t\tif (textBlockElements[node.name] && node.parent.name == 'li') {\n\t\t\t\t\t// Move sibling text blocks after LI element\n\t\t\t\t\tsibling = node.next;\n\t\t\t\t\twhile (sibling) {\n\t\t\t\t\t\tif (textBlockElements[sibling.name]) {\n\t\t\t\t\t\t\tsibling.name = 'li';\n\t\t\t\t\t\t\tsibling.fixed = true;\n\t\t\t\t\t\t\tnode.parent.insert(sibling, node.parent);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tsibling = sibling.next;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Unwrap current text block\n\t\t\t\t\tnode.unwrap(node);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Get list of all parent nodes until we find a valid parent to stick the child into\n\t\t\t\tparents = [node];\n\t\t\t\tfor (parent = node.parent; parent && !schema.isValidChild(parent.name, node.name) &&\n\t\t\t\t\t!nonSplitableElements[parent.name]; parent = parent.parent) {\n\t\t\t\t\tparents.push(parent);\n\t\t\t\t}\n\n\t\t\t\t// Found a suitable parent\n\t\t\t\tif (parent && parents.length > 1) {\n\t\t\t\t\t// Reverse the array since it makes looping easier\n\t\t\t\t\tparents.reverse();\n\n\t\t\t\t\t// Clone the related parent and insert that after the moved node\n\t\t\t\t\tnewParent = currentNode = self.filterNode(parents[0].clone());\n\n\t\t\t\t\t// Start cloning and moving children on the left side of the target node\n\t\t\t\t\tfor (i = 0; i < parents.length - 1; i++) {\n\t\t\t\t\t\tif (schema.isValidChild(currentNode.name, parents[i].name)) {\n\t\t\t\t\t\t\ttempNode = self.filterNode(parents[i].clone());\n\t\t\t\t\t\t\tcurrentNode.append(tempNode);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ttempNode = currentNode;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfor (childNode = parents[i].firstChild; childNode && childNode != parents[i + 1];) {\n\t\t\t\t\t\t\tnextNode = childNode.next;\n\t\t\t\t\t\t\ttempNode.append(childNode);\n\t\t\t\t\t\t\tchildNode = nextNode;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcurrentNode = tempNode;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!newParent.isEmpty(nonEmptyElements)) {\n\t\t\t\t\t\tparent.insert(newParent, parents[0], true);\n\t\t\t\t\t\tparent.insert(node, newParent);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tparent.insert(node, parents[0], true);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Check if the element is empty by looking through it's contents and special treatment for <p><br /></p>\n\t\t\t\t\tparent = parents[0];\n\t\t\t\t\tif (parent.isEmpty(nonEmptyElements) || parent.firstChild === parent.lastChild && parent.firstChild.name === 'br') {\n\t\t\t\t\t\tparent.empty().remove();\n\t\t\t\t\t}\n\t\t\t\t} else if (node.parent) {\n\t\t\t\t\t// If it's an LI try to find a UL/OL for it or wrap it\n\t\t\t\t\tif (node.name === 'li') {\n\t\t\t\t\t\tsibling = node.prev;\n\t\t\t\t\t\tif (sibling && (sibling.name === 'ul' || sibling.name === 'ul')) {\n\t\t\t\t\t\t\tsibling.append(node);\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tsibling = node.next;\n\t\t\t\t\t\tif (sibling && (sibling.name === 'ul' || sibling.name === 'ul')) {\n\t\t\t\t\t\t\tsibling.insert(node, sibling.firstChild, true);\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnode.wrap(self.filterNode(new Node('ul', 1)));\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Try wrapping the element in a DIV\n\t\t\t\t\tif (schema.isValidChild(node.parent.name, 'div') && schema.isValidChild('div', node.name)) {\n\t\t\t\t\t\tnode.wrap(self.filterNode(new Node('div', 1)));\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// We failed wrapping it, then remove or unwrap it\n\t\t\t\t\t\tif (specialElements[node.name]) {\n\t\t\t\t\t\t\tnode.empty().remove();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tnode.unwrap();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Runs the specified node though the element and attributes filters.\n\t\t *\n\t\t * @method filterNode\n\t\t * @param {tinymce.html.Node} Node the node to run filters on.\n\t\t * @return {tinymce.html.Node} The passed in node.\n\t\t */\n\t\tself.filterNode = function(node) {\n\t\t\tvar i, name, list;\n\n\t\t\t// Run element filters\n\t\t\tif (name in nodeFilters) {\n\t\t\t\tlist = matchedNodes[name];\n\n\t\t\t\tif (list) {\n\t\t\t\t\tlist.push(node);\n\t\t\t\t} else {\n\t\t\t\t\tmatchedNodes[name] = [node];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Run attribute filters\n\t\t\ti = attributeFilters.length;\n\t\t\twhile (i--) {\n\t\t\t\tname = attributeFilters[i].name;\n\n\t\t\t\tif (name in node.attributes.map) {\n\t\t\t\t\tlist = matchedAttributes[name];\n\n\t\t\t\t\tif (list) {\n\t\t\t\t\t\tlist.push(node);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tmatchedAttributes[name] = [node];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn node;\n\t\t};\n\n\t\t/**\n\t\t * Adds a node filter function to the parser, the parser will collect the specified nodes by name\n\t\t * and then execute the callback ones it has finished parsing the document.\n\t\t *\n\t\t * @example\n\t\t * parser.addNodeFilter('p,h1', function(nodes, name) {\n\t\t *\t\tfor (var i = 0; i < nodes.length; i++) {\n\t\t *\t\t\tconsole.log(nodes[i].name);\n\t\t *\t\t}\n\t\t * });\n\t\t * @method addNodeFilter\n\t\t * @method {String} name Comma separated list of nodes to collect.\n\t\t * @param {function} callback Callback function to execute once it has collected nodes.\n\t\t */\n\t\tself.addNodeFilter = function(name, callback) {\n\t\t\teach(explode(name), function(name) {\n\t\t\t\tvar list = nodeFilters[name];\n\n\t\t\t\tif (!list) {\n\t\t\t\t\tnodeFilters[name] = list = [];\n\t\t\t\t}\n\n\t\t\t\tlist.push(callback);\n\t\t\t});\n\t\t};\n\n\t\t/**\n\t\t * Adds a attribute filter function to the parser, the parser will collect nodes that has the specified attributes\n\t\t * and then execute the callback ones it has finished parsing the document.\n\t\t *\n\t\t * @example\n\t\t * parser.addAttributeFilter('src,href', function(nodes, name) {\n\t\t *\t\tfor (var i = 0; i < nodes.length; i++) {\n\t\t *\t\t\tconsole.log(nodes[i].name);\n\t\t *\t\t}\n\t\t * });\n\t\t * @method addAttributeFilter\n\t\t * @method {String} name Comma separated list of nodes to collect.\n\t\t * @param {function} callback Callback function to execute once it has collected nodes.\n\t\t */\n\t\tself.addAttributeFilter = function(name, callback) {\n\t\t\teach(explode(name), function(name) {\n\t\t\t\tvar i;\n\n\t\t\t\tfor (i = 0; i < attributeFilters.length; i++) {\n\t\t\t\t\tif (attributeFilters[i].name === name) {\n\t\t\t\t\t\tattributeFilters[i].callbacks.push(callback);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tattributeFilters.push({name: name, callbacks: [callback]});\n\t\t\t});\n\t\t};\n\n\t\t/**\n\t\t * Parses the specified HTML string into a DOM like node tree and returns the result.\n\t\t *\n\t\t * @example\n\t\t * var rootNode = new DomParser({...}).parse('<b>text</b>');\n\t\t * @method parse\n\t\t * @param {String} html Html string to sax parse.\n\t\t * @param {Object} args Optional args object that gets passed to all filter functions.\n\t\t * @return {tinymce.html.Node} Root node containing the tree.\n\t\t */\n\t\tself.parse = function(html, args) {\n\t\t\tvar parser, rootNode, node, nodes, i, l, fi, fl, list, name, validate;\n\t\t\tvar blockElements, startWhiteSpaceRegExp, invalidChildren = [], isInWhiteSpacePreservedElement;\n\t\t\tvar endWhiteSpaceRegExp, allWhiteSpaceRegExp, isAllWhiteSpaceRegExp, whiteSpaceElements;\n\t\t\tvar children, nonEmptyElements, rootBlockName;\n\n\t\t\targs = args || {};\n\t\t\tmatchedNodes = {};\n\t\t\tmatchedAttributes = {};\n\t\t\tblockElements = extend(makeMap('script,style,head,html,body,title,meta,param'), schema.getBlockElements());\n\t\t\tnonEmptyElements = schema.getNonEmptyElements();\n\t\t\tchildren = schema.children;\n\t\t\tvalidate = settings.validate;\n\t\t\trootBlockName = \"forced_root_block\" in args ? args.forced_root_block : settings.forced_root_block;\n\n\t\t\twhiteSpaceElements = schema.getWhiteSpaceElements();\n\t\t\tstartWhiteSpaceRegExp = /^[ \\t\\r\\n]+/;\n\t\t\tendWhiteSpaceRegExp = /[ \\t\\r\\n]+$/;\n\t\t\tallWhiteSpaceRegExp = /[ \\t\\r\\n]+/g;\n\t\t\tisAllWhiteSpaceRegExp = /^[ \\t\\r\\n]+$/;\n\n\t\t\tfunction addRootBlocks() {\n\t\t\t\tvar node = rootNode.firstChild, next, rootBlockNode;\n\n\t\t\t\t// Removes whitespace at beginning and end of block so:\n\t\t\t\t// <p> x </p> -> <p>x</p>\n\t\t\t\tfunction trim(rootBlockNode) {\n\t\t\t\t\tif (rootBlockNode) {\n\t\t\t\t\t\tnode = rootBlockNode.firstChild;\n\t\t\t\t\t\tif (node && node.type == 3) {\n\t\t\t\t\t\t\tnode.value = node.value.replace(startWhiteSpaceRegExp, '');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnode = rootBlockNode.lastChild;\n\t\t\t\t\t\tif (node && node.type == 3) {\n\t\t\t\t\t\t\tnode.value = node.value.replace(endWhiteSpaceRegExp, '');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Check if rootBlock is valid within rootNode for example if P is valid in H1 if H1 is the contentEditabe root\n\t\t\t\tif (!schema.isValidChild(rootNode.name, rootBlockName.toLowerCase())) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\twhile (node) {\n\t\t\t\t\tnext = node.next;\n\n\t\t\t\t\tif (node.type == 3 || (node.type == 1 && node.name !== 'p' &&\n\t\t\t\t\t\t!blockElements[node.name] && !node.attr('data-mce-type'))) {\n\t\t\t\t\t\tif (!rootBlockNode) {\n\t\t\t\t\t\t\t// Create a new root block element\n\t\t\t\t\t\t\trootBlockNode = createNode(rootBlockName, 1);\n\t\t\t\t\t\t\trootBlockNode.attr(settings.forced_root_block_attrs);\n\t\t\t\t\t\t\trootNode.insert(rootBlockNode, node);\n\t\t\t\t\t\t\trootBlockNode.append(node);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trootBlockNode.append(node);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttrim(rootBlockNode);\n\t\t\t\t\t\trootBlockNode = null;\n\t\t\t\t\t}\n\n\t\t\t\t\tnode = next;\n\t\t\t\t}\n\n\t\t\t\ttrim(rootBlockNode);\n\t\t\t}\n\n\t\t\tfunction createNode(name, type) {\n\t\t\t\tvar node = new Node(name, type), list;\n\n\t\t\t\tif (name in nodeFilters) {\n\t\t\t\t\tlist = matchedNodes[name];\n\n\t\t\t\t\tif (list) {\n\t\t\t\t\t\tlist.push(node);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tmatchedNodes[name] = [node];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn node;\n\t\t\t}\n\n\t\t\tfunction removeWhitespaceBefore(node) {\n\t\t\t\tvar textNode, textNodeNext, textVal, sibling, blockElements = schema.getBlockElements();\n\n\t\t\t\tfor (textNode = node.prev; textNode && textNode.type === 3;) {\n\t\t\t\t\ttextVal = textNode.value.replace(endWhiteSpaceRegExp, '');\n\n\t\t\t\t\t// Found a text node with non whitespace then trim that and break\n\t\t\t\t\tif (textVal.length > 0) {\n\t\t\t\t\t\ttextNode.value = textVal;\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\ttextNodeNext = textNode.next;\n\n\t\t\t\t\t// Fix for bug #7543 where bogus nodes would produce empty\n\t\t\t\t\t// text nodes and these would be removed if a nested list was before it\n\t\t\t\t\tif (textNodeNext) {\n\t\t\t\t\t\tif (textNodeNext.type == 3 && textNodeNext.value.length) {\n\t\t\t\t\t\t\ttextNode = textNode.prev;\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!blockElements[textNodeNext.name] && textNodeNext.name != 'script' && textNodeNext.name != 'style') {\n\t\t\t\t\t\t\ttextNode = textNode.prev;\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tsibling = textNode.prev;\n\t\t\t\t\ttextNode.remove();\n\t\t\t\t\ttextNode = sibling;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction cloneAndExcludeBlocks(input) {\n\t\t\t\tvar name, output = {};\n\n\t\t\t\tfor (name in input) {\n\t\t\t\t\tif (name !== 'li' && name != 'p') {\n\t\t\t\t\t\toutput[name] = input[name];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn output;\n\t\t\t}\n\n\t\t\tparser = new SaxParser({\n\t\t\t\tvalidate: validate,\n\t\t\t\tallow_script_urls: settings.allow_script_urls,\n\t\t\t\tallow_conditional_comments: settings.allow_conditional_comments,\n\n\t\t\t\t// Exclude P and LI from DOM parsing since it's treated better by the DOM parser\n\t\t\t\tself_closing_elements: cloneAndExcludeBlocks(schema.getSelfClosingElements()),\n\n\t\t\t\tcdata: function(text) {\n\t\t\t\t\tnode.append(createNode('#cdata', 4)).value = text;\n\t\t\t\t},\n\n\t\t\t\ttext: function(text, raw) {\n\t\t\t\t\tvar textNode;\n\n\t\t\t\t\t// Trim all redundant whitespace on non white space elements\n\t\t\t\t\tif (!isInWhiteSpacePreservedElement) {\n\t\t\t\t\t\ttext = text.replace(allWhiteSpaceRegExp, ' ');\n\n\t\t\t\t\t\tif (node.lastChild && blockElements[node.lastChild.name]) {\n\t\t\t\t\t\t\ttext = text.replace(startWhiteSpaceRegExp, '');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Do we need to create the node\n\t\t\t\t\tif (text.length !== 0) {\n\t\t\t\t\t\ttextNode = createNode('#text', 3);\n\t\t\t\t\t\ttextNode.raw = !!raw;\n\t\t\t\t\t\tnode.append(textNode).value = text;\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\tcomment: function(text) {\n\t\t\t\t\tnode.append(createNode('#comment', 8)).value = text;\n\t\t\t\t},\n\n\t\t\t\tpi: function(name, text) {\n\t\t\t\t\tnode.append(createNode(name, 7)).value = text;\n\t\t\t\t\tremoveWhitespaceBefore(node);\n\t\t\t\t},\n\n\t\t\t\tdoctype: function(text) {\n\t\t\t\t\tvar newNode;\n\n\t\t\t\t\tnewNode = node.append(createNode('#doctype', 10));\n\t\t\t\t\tnewNode.value = text;\n\t\t\t\t\tremoveWhitespaceBefore(node);\n\t\t\t\t},\n\n\t\t\t\tstart: function(name, attrs, empty) {\n\t\t\t\t\tvar newNode, attrFiltersLen, elementRule, attrName, parent;\n\n\t\t\t\t\telementRule = validate ? schema.getElementRule(name) : {};\n\t\t\t\t\tif (elementRule) {\n\t\t\t\t\t\tnewNode = createNode(elementRule.outputName || name, 1);\n\t\t\t\t\t\tnewNode.attributes = attrs;\n\t\t\t\t\t\tnewNode.shortEnded = empty;\n\n\t\t\t\t\t\tnode.append(newNode);\n\n\t\t\t\t\t\t// Check if node is valid child of the parent node is the child is\n\t\t\t\t\t\t// unknown we don't collect it since it's probably a custom element\n\t\t\t\t\t\tparent = children[node.name];\n\t\t\t\t\t\tif (parent && children[newNode.name] && !parent[newNode.name]) {\n\t\t\t\t\t\t\tinvalidChildren.push(newNode);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tattrFiltersLen = attributeFilters.length;\n\t\t\t\t\t\twhile (attrFiltersLen--) {\n\t\t\t\t\t\t\tattrName = attributeFilters[attrFiltersLen].name;\n\n\t\t\t\t\t\t\tif (attrName in attrs.map) {\n\t\t\t\t\t\t\t\tlist = matchedAttributes[attrName];\n\n\t\t\t\t\t\t\t\tif (list) {\n\t\t\t\t\t\t\t\t\tlist.push(newNode);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tmatchedAttributes[attrName] = [newNode];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Trim whitespace before block\n\t\t\t\t\t\tif (blockElements[name]) {\n\t\t\t\t\t\t\tremoveWhitespaceBefore(newNode);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Change current node if the element wasn't empty i.e not <br /> or <img />\n\t\t\t\t\t\tif (!empty) {\n\t\t\t\t\t\t\tnode = newNode;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Check if we are inside a whitespace preserved element\n\t\t\t\t\t\tif (!isInWhiteSpacePreservedElement && whiteSpaceElements[name]) {\n\t\t\t\t\t\t\tisInWhiteSpacePreservedElement = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\tend: function(name) {\n\t\t\t\t\tvar textNode, elementRule, text, sibling, tempNode;\n\n\t\t\t\t\telementRule = validate ? schema.getElementRule(name) : {};\n\t\t\t\t\tif (elementRule) {\n\t\t\t\t\t\tif (blockElements[name]) {\n\t\t\t\t\t\t\tif (!isInWhiteSpacePreservedElement) {\n\t\t\t\t\t\t\t\t// Trim whitespace of the first node in a block\n\t\t\t\t\t\t\t\ttextNode = node.firstChild;\n\t\t\t\t\t\t\t\tif (textNode && textNode.type === 3) {\n\t\t\t\t\t\t\t\t\ttext = textNode.value.replace(startWhiteSpaceRegExp, '');\n\n\t\t\t\t\t\t\t\t\t// Any characters left after trim or should we remove it\n\t\t\t\t\t\t\t\t\tif (text.length > 0) {\n\t\t\t\t\t\t\t\t\t\ttextNode.value = text;\n\t\t\t\t\t\t\t\t\t\ttextNode = textNode.next;\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tsibling = textNode.next;\n\t\t\t\t\t\t\t\t\t\ttextNode.remove();\n\t\t\t\t\t\t\t\t\t\ttextNode = sibling;\n\n\t\t\t\t\t\t\t\t\t\t// Remove any pure whitespace siblings\n\t\t\t\t\t\t\t\t\t\twhile (textNode && textNode.type === 3) {\n\t\t\t\t\t\t\t\t\t\t\ttext = textNode.value;\n\t\t\t\t\t\t\t\t\t\t\tsibling = textNode.next;\n\n\t\t\t\t\t\t\t\t\t\t\tif (text.length === 0 || isAllWhiteSpaceRegExp.test(text)) {\n\t\t\t\t\t\t\t\t\t\t\t\ttextNode.remove();\n\t\t\t\t\t\t\t\t\t\t\t\ttextNode = sibling;\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\ttextNode = sibling;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// Trim whitespace of the last node in a block\n\t\t\t\t\t\t\t\ttextNode = node.lastChild;\n\t\t\t\t\t\t\t\tif (textNode && textNode.type === 3) {\n\t\t\t\t\t\t\t\t\ttext = textNode.value.replace(endWhiteSpaceRegExp, '');\n\n\t\t\t\t\t\t\t\t\t// Any characters left after trim or should we remove it\n\t\t\t\t\t\t\t\t\tif (text.length > 0) {\n\t\t\t\t\t\t\t\t\t\ttextNode.value = text;\n\t\t\t\t\t\t\t\t\t\ttextNode = textNode.prev;\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tsibling = textNode.prev;\n\t\t\t\t\t\t\t\t\t\ttextNode.remove();\n\t\t\t\t\t\t\t\t\t\ttextNode = sibling;\n\n\t\t\t\t\t\t\t\t\t\t// Remove any pure whitespace siblings\n\t\t\t\t\t\t\t\t\t\twhile (textNode && textNode.type === 3) {\n\t\t\t\t\t\t\t\t\t\t\ttext = textNode.value;\n\t\t\t\t\t\t\t\t\t\t\tsibling = textNode.prev;\n\n\t\t\t\t\t\t\t\t\t\t\tif (text.length === 0 || isAllWhiteSpaceRegExp.test(text)) {\n\t\t\t\t\t\t\t\t\t\t\t\ttextNode.remove();\n\t\t\t\t\t\t\t\t\t\t\t\ttextNode = sibling;\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\ttextNode = sibling;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Trim start white space\n\t\t\t\t\t\t\t// Removed due to: #5424\n\t\t\t\t\t\t\t/*textNode = node.prev;\n\t\t\t\t\t\t\tif (textNode && textNode.type === 3) {\n\t\t\t\t\t\t\t\ttext = textNode.value.replace(startWhiteSpaceRegExp, '');\n\n\t\t\t\t\t\t\t\tif (text.length > 0)\n\t\t\t\t\t\t\t\t\ttextNode.value = text;\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\ttextNode.remove();\n\t\t\t\t\t\t\t}*/\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Check if we exited a whitespace preserved element\n\t\t\t\t\t\tif (isInWhiteSpacePreservedElement && whiteSpaceElements[name]) {\n\t\t\t\t\t\t\tisInWhiteSpacePreservedElement = false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Handle empty nodes\n\t\t\t\t\t\tif (elementRule.removeEmpty || elementRule.paddEmpty) {\n\t\t\t\t\t\t\tif (node.isEmpty(nonEmptyElements)) {\n\t\t\t\t\t\t\t\tif (elementRule.paddEmpty) {\n\t\t\t\t\t\t\t\t\tnode.empty().append(new Node('#text', '3')).value = '\\u00a0';\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t// Leave nodes that have a name like <a name=\"name\">\n\t\t\t\t\t\t\t\t\tif (!node.attributes.map.name && !node.attributes.map.id) {\n\t\t\t\t\t\t\t\t\t\ttempNode = node.parent;\n\n\t\t\t\t\t\t\t\t\t\tif (blockElements[node.name]) {\n\t\t\t\t\t\t\t\t\t\t\tnode.empty().remove();\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tnode.unwrap();\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tnode = tempNode;\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnode = node.parent;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, schema);\n\n\t\t\trootNode = node = new Node(args.context || settings.root_name, 11);\n\n\t\t\tparser.parse(html);\n\n\t\t\t// Fix invalid children or report invalid children in a contextual parsing\n\t\t\tif (validate && invalidChildren.length) {\n\t\t\t\tif (!args.context) {\n\t\t\t\t\tfixInvalidChildren(invalidChildren);\n\t\t\t\t} else {\n\t\t\t\t\targs.invalid = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Wrap nodes in the root into block elements if the root is body\n\t\t\tif (rootBlockName && (rootNode.name == 'body' || args.isRootContent)) {\n\t\t\t\taddRootBlocks();\n\t\t\t}\n\n\t\t\t// Run filters only when the contents is valid\n\t\t\tif (!args.invalid) {\n\t\t\t\t// Run node filters\n\t\t\t\tfor (name in matchedNodes) {\n\t\t\t\t\tlist = nodeFilters[name];\n\t\t\t\t\tnodes = matchedNodes[name];\n\n\t\t\t\t\t// Remove already removed children\n\t\t\t\t\tfi = nodes.length;\n\t\t\t\t\twhile (fi--) {\n\t\t\t\t\t\tif (!nodes[fi].parent) {\n\t\t\t\t\t\t\tnodes.splice(fi, 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (i = 0, l = list.length; i < l; i++) {\n\t\t\t\t\t\tlist[i](nodes, name, args);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Run attribute filters\n\t\t\t\tfor (i = 0, l = attributeFilters.length; i < l; i++) {\n\t\t\t\t\tlist = attributeFilters[i];\n\n\t\t\t\t\tif (list.name in matchedAttributes) {\n\t\t\t\t\t\tnodes = matchedAttributes[list.name];\n\n\t\t\t\t\t\t// Remove already removed children\n\t\t\t\t\t\tfi = nodes.length;\n\t\t\t\t\t\twhile (fi--) {\n\t\t\t\t\t\t\tif (!nodes[fi].parent) {\n\t\t\t\t\t\t\t\tnodes.splice(fi, 1);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfor (fi = 0, fl = list.callbacks.length; fi < fl; fi++) {\n\t\t\t\t\t\t\tlist.callbacks[fi](nodes, list.name, args);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn rootNode;\n\t\t};\n\n\t\t// Remove <br> at end of block elements Gecko and WebKit injects BR elements to\n\t\t// make it possible to place the caret inside empty blocks. This logic tries to remove\n\t\t// these elements and keep br elements that where intended to be there intact\n\t\tif (settings.remove_trailing_brs) {\n\t\t\tself.addNodeFilter('br', function(nodes) {\n\t\t\t\tvar i, l = nodes.length, node, blockElements = extend({}, schema.getBlockElements());\n\t\t\t\tvar nonEmptyElements = schema.getNonEmptyElements(), parent, lastParent, prev, prevName;\n\t\t\t\tvar elementRule, textNode;\n\n\t\t\t\t// Remove brs from body element as well\n\t\t\t\tblockElements.body = 1;\n\n\t\t\t\t// Must loop forwards since it will otherwise remove all brs in <p>a<br><br><br></p>\n\t\t\t\tfor (i = 0; i < l; i++) {\n\t\t\t\t\tnode = nodes[i];\n\t\t\t\t\tparent = node.parent;\n\n\t\t\t\t\tif (blockElements[node.parent.name] && node === parent.lastChild) {\n\t\t\t\t\t\t// Loop all nodes to the left of the current node and check for other BR elements\n\t\t\t\t\t\t// excluding bookmarks since they are invisible\n\t\t\t\t\t\tprev = node.prev;\n\t\t\t\t\t\twhile (prev) {\n\t\t\t\t\t\t\tprevName = prev.name;\n\n\t\t\t\t\t\t\t// Ignore bookmarks\n\t\t\t\t\t\t\tif (prevName !== \"span\" || prev.attr('data-mce-type') !== 'bookmark') {\n\t\t\t\t\t\t\t\t// Found a non BR element\n\t\t\t\t\t\t\t\tif (prevName !== \"br\") {\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// Found another br it's a <br><br> structure then don't remove anything\n\t\t\t\t\t\t\t\tif (prevName === 'br') {\n\t\t\t\t\t\t\t\t\tnode = null;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tprev = prev.prev;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (node) {\n\t\t\t\t\t\t\tnode.remove();\n\n\t\t\t\t\t\t\t// Is the parent to be considered empty after we removed the BR\n\t\t\t\t\t\t\tif (parent.isEmpty(nonEmptyElements)) {\n\t\t\t\t\t\t\t\telementRule = schema.getElementRule(parent.name);\n\n\t\t\t\t\t\t\t\t// Remove or padd the element depending on schema rule\n\t\t\t\t\t\t\t\tif (elementRule) {\n\t\t\t\t\t\t\t\t\tif (elementRule.removeEmpty) {\n\t\t\t\t\t\t\t\t\t\tparent.remove();\n\t\t\t\t\t\t\t\t\t} else if (elementRule.paddEmpty) {\n\t\t\t\t\t\t\t\t\t\tparent.empty().append(new Node('#text', 3)).value = '\\u00a0';\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Replaces BR elements inside inline elements like <p><b><i><br></i></b></p>\n\t\t\t\t\t\t// so they become <p><b><i>&nbsp;</i></b></p>\n\t\t\t\t\t\tlastParent = node;\n\t\t\t\t\t\twhile (parent && parent.firstChild === lastParent && parent.lastChild === lastParent) {\n\t\t\t\t\t\t\tlastParent = parent;\n\n\t\t\t\t\t\t\tif (blockElements[parent.name]) {\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tparent = parent.parent;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (lastParent === parent) {\n\t\t\t\t\t\t\ttextNode = new Node('#text', 3);\n\t\t\t\t\t\t\ttextNode.value = '\\u00a0';\n\t\t\t\t\t\t\tnode.replace(textNode);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (!settings.allow_unsafe_link_target) {\n\t\t\tself.addAttributeFilter('href', function(nodes) {\n\t\t\t\tvar i = nodes.length, node, rel;\n\t\t\t\tvar rules = 'noopener noreferrer';\n\n\t\t\t\tfunction addTargetRules(rel) {\n\t\t\t\t\trel = removeTargetRules(rel);\n\t\t\t\t\treturn rel ? [rel, rules].join(' ') : rules;\n\t\t\t\t}\n\n\t\t\t\tfunction removeTargetRules(rel) {\n\t\t\t\t\tvar regExp = new RegExp('(' + rules.replace(' ', '|') + ')', 'g');\n\t\t\t\t\tif (rel) {\n\t\t\t\t\t\trel = Tools.trim(rel.replace(regExp, ''));\n\t\t\t\t\t}\n\t\t\t\t\treturn rel ? rel : null;\n\t\t\t\t}\n\n\t\t\t\tfunction toggleTargetRules(rel, isUnsafe) {\n\t\t\t\t\treturn isUnsafe ? addTargetRules(rel) : removeTargetRules(rel);\n\t\t\t\t}\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tnode = nodes[i];\n\t\t\t\t\trel = node.attr('rel');\n\t\t\t\t\tif (node.name === 'a') {\n\t\t\t\t\t\tnode.attr('rel', toggleTargetRules(rel, node.attr('target') == '_blank'));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// Force anchor names closed, unless the setting \"allow_html_in_named_anchor\" is explicitly included.\n\t\tif (!settings.allow_html_in_named_anchor) {\n\t\t\tself.addAttributeFilter('id,name', function(nodes) {\n\t\t\t\tvar i = nodes.length, sibling, prevSibling, parent, node;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tnode = nodes[i];\n\t\t\t\t\tif (node.name === 'a' && node.firstChild && !node.attr('href')) {\n\t\t\t\t\t\tparent = node.parent;\n\n\t\t\t\t\t\t// Move children after current node\n\t\t\t\t\t\tsibling = node.lastChild;\n\t\t\t\t\t\tdo {\n\t\t\t\t\t\t\tprevSibling = sibling.prev;\n\t\t\t\t\t\t\tparent.insert(sibling, node);\n\t\t\t\t\t\t\tsibling = prevSibling;\n\t\t\t\t\t\t} while (sibling);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (settings.validate && schema.getValidClasses()) {\n\t\t\tself.addAttributeFilter('class', function(nodes) {\n\t\t\t\tvar i = nodes.length, node, classList, ci, className, classValue;\n\t\t\t\tvar validClasses = schema.getValidClasses(), validClassesMap, valid;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tnode = nodes[i];\n\t\t\t\t\tclassList = node.attr('class').split(' ');\n\t\t\t\t\tclassValue = '';\n\n\t\t\t\t\tfor (ci = 0; ci < classList.length; ci++) {\n\t\t\t\t\t\tclassName = classList[ci];\n\t\t\t\t\t\tvalid = false;\n\n\t\t\t\t\t\tvalidClassesMap = validClasses['*'];\n\t\t\t\t\t\tif (validClassesMap && validClassesMap[className]) {\n\t\t\t\t\t\t\tvalid = true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvalidClassesMap = validClasses[node.name];\n\t\t\t\t\t\tif (!valid && validClassesMap && validClassesMap[className]) {\n\t\t\t\t\t\t\tvalid = true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (valid) {\n\t\t\t\t\t\t\tif (classValue) {\n\t\t\t\t\t\t\t\tclassValue += ' ';\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tclassValue += className;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!classValue.length) {\n\t\t\t\t\t\tclassValue = null;\n\t\t\t\t\t}\n\n\t\t\t\t\tnode.attr('class', classValue);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t};\n});\n\n// Included from: js/tinymce/classes/html/Writer.js\n\n/**\n * Writer.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class is used to write HTML tags out it can be used with the Serializer or the SaxParser.\n *\n * @class tinymce.html.Writer\n * @example\n * var writer = new tinymce.html.Writer({indent: true});\n * var parser = new tinymce.html.SaxParser(writer).parse('<p><br></p>');\n * console.log(writer.getContent());\n *\n * @class tinymce.html.Writer\n * @version 3.4\n */\ndefine(\"tinymce/html/Writer\", [\n\t\"tinymce/html/Entities\",\n\t\"tinymce/util/Tools\"\n], function(Entities, Tools) {\n\tvar makeMap = Tools.makeMap;\n\n\t/**\n\t * Constructs a new Writer instance.\n\t *\n\t * @constructor\n\t * @method Writer\n\t * @param {Object} settings Name/value settings object.\n\t */\n\treturn function(settings) {\n\t\tvar html = [], indent, indentBefore, indentAfter, encode, htmlOutput;\n\n\t\tsettings = settings || {};\n\t\tindent = settings.indent;\n\t\tindentBefore = makeMap(settings.indent_before || '');\n\t\tindentAfter = makeMap(settings.indent_after || '');\n\t\tencode = Entities.getEncodeFunc(settings.entity_encoding || 'raw', settings.entities);\n\t\thtmlOutput = settings.element_format == \"html\";\n\n\t\treturn {\n\t\t\t/**\n\t\t\t * Writes the a start element such as <p id=\"a\">.\n\t\t\t *\n\t\t\t * @method start\n\t\t\t * @param {String} name Name of the element.\n\t\t\t * @param {Array} attrs Optional attribute array or undefined if it hasn't any.\n\t\t\t * @param {Boolean} empty Optional empty state if the tag should end like <br />.\n\t\t\t */\n\t\t\tstart: function(name, attrs, empty) {\n\t\t\t\tvar i, l, attr, value;\n\n\t\t\t\tif (indent && indentBefore[name] && html.length > 0) {\n\t\t\t\t\tvalue = html[html.length - 1];\n\n\t\t\t\t\tif (value.length > 0 && value !== '\\n') {\n\t\t\t\t\t\thtml.push('\\n');\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\thtml.push('<', name);\n\n\t\t\t\tif (attrs) {\n\t\t\t\t\tfor (i = 0, l = attrs.length; i < l; i++) {\n\t\t\t\t\t\tattr = attrs[i];\n\t\t\t\t\t\thtml.push(' ', attr.name, '=\"', encode(attr.value, true), '\"');\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!empty || htmlOutput) {\n\t\t\t\t\thtml[html.length] = '>';\n\t\t\t\t} else {\n\t\t\t\t\thtml[html.length] = ' />';\n\t\t\t\t}\n\n\t\t\t\tif (empty && indent && indentAfter[name] && html.length > 0) {\n\t\t\t\t\tvalue = html[html.length - 1];\n\n\t\t\t\t\tif (value.length > 0 && value !== '\\n') {\n\t\t\t\t\t\thtml.push('\\n');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Writes the a end element such as </p>.\n\t\t\t *\n\t\t\t * @method end\n\t\t\t * @param {String} name Name of the element.\n\t\t\t */\n\t\t\tend: function(name) {\n\t\t\t\tvar value;\n\n\t\t\t\t/*if (indent && indentBefore[name] && html.length > 0) {\n\t\t\t\t\tvalue = html[html.length - 1];\n\n\t\t\t\t\tif (value.length > 0 && value !== '\\n')\n\t\t\t\t\t\thtml.push('\\n');\n\t\t\t\t}*/\n\n\t\t\t\thtml.push('</', name, '>');\n\n\t\t\t\tif (indent && indentAfter[name] && html.length > 0) {\n\t\t\t\t\tvalue = html[html.length - 1];\n\n\t\t\t\t\tif (value.length > 0 && value !== '\\n') {\n\t\t\t\t\t\thtml.push('\\n');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Writes a text node.\n\t\t\t *\n\t\t\t * @method text\n\t\t\t * @param {String} text String to write out.\n\t\t\t * @param {Boolean} raw Optional raw state if true the contents wont get encoded.\n\t\t\t */\n\t\t\ttext: function(text, raw) {\n\t\t\t\tif (text.length > 0) {\n\t\t\t\t\thtml[html.length] = raw ? text : encode(text);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Writes a cdata node such as <![CDATA[data]]>.\n\t\t\t *\n\t\t\t * @method cdata\n\t\t\t * @param {String} text String to write out inside the cdata.\n\t\t\t */\n\t\t\tcdata: function(text) {\n\t\t\t\thtml.push('<![CDATA[', text, ']]>');\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Writes a comment node such as <!-- Comment -->.\n\t\t\t *\n\t\t\t * @method cdata\n\t\t\t * @param {String} text String to write out inside the comment.\n\t\t\t */\n\t\t\tcomment: function(text) {\n\t\t\t\thtml.push('<!--', text, '-->');\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Writes a PI node such as <?xml attr=\"value\" ?>.\n\t\t\t *\n\t\t\t * @method pi\n\t\t\t * @param {String} name Name of the pi.\n\t\t\t * @param {String} text String to write out inside the pi.\n\t\t\t */\n\t\t\tpi: function(name, text) {\n\t\t\t\tif (text) {\n\t\t\t\t\thtml.push('<?', name, ' ', encode(text), '?>');\n\t\t\t\t} else {\n\t\t\t\t\thtml.push('<?', name, '?>');\n\t\t\t\t}\n\n\t\t\t\tif (indent) {\n\t\t\t\t\thtml.push('\\n');\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Writes a doctype node such as <!DOCTYPE data>.\n\t\t\t *\n\t\t\t * @method doctype\n\t\t\t * @param {String} text String to write out inside the doctype.\n\t\t\t */\n\t\t\tdoctype: function(text) {\n\t\t\t\thtml.push('<!DOCTYPE', text, '>', indent ? '\\n' : '');\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Resets the internal buffer if one wants to reuse the writer.\n\t\t\t *\n\t\t\t * @method reset\n\t\t\t */\n\t\t\treset: function() {\n\t\t\t\thtml.length = 0;\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Returns the contents that got serialized.\n\t\t\t *\n\t\t\t * @method getContent\n\t\t\t * @return {String} HTML contents that got written down.\n\t\t\t */\n\t\t\tgetContent: function() {\n\t\t\t\treturn html.join('').replace(/\\n$/, '');\n\t\t\t}\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/html/Serializer.js\n\n/**\n * Serializer.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class is used to serialize down the DOM tree into a string using a Writer instance.\n *\n *\n * @example\n * new tinymce.html.Serializer().serialize(new tinymce.html.DomParser().parse('<p>text</p>'));\n * @class tinymce.html.Serializer\n * @version 3.4\n */\ndefine(\"tinymce/html/Serializer\", [\n\t\"tinymce/html/Writer\",\n\t\"tinymce/html/Schema\"\n], function(Writer, Schema) {\n\t/**\n\t * Constructs a new Serializer instance.\n\t *\n\t * @constructor\n\t * @method Serializer\n\t * @param {Object} settings Name/value settings object.\n\t * @param {tinymce.html.Schema} schema Schema instance to use.\n\t */\n\treturn function(settings, schema) {\n\t\tvar self = this, writer = new Writer(settings);\n\n\t\tsettings = settings || {};\n\t\tsettings.validate = \"validate\" in settings ? settings.validate : true;\n\n\t\tself.schema = schema = schema || new Schema();\n\t\tself.writer = writer;\n\n\t\t/**\n\t\t * Serializes the specified node into a string.\n\t\t *\n\t\t * @example\n\t\t * new tinymce.html.Serializer().serialize(new tinymce.html.DomParser().parse('<p>text</p>'));\n\t\t * @method serialize\n\t\t * @param {tinymce.html.Node} node Node instance to serialize.\n\t\t * @return {String} String with HTML based on DOM tree.\n\t\t */\n\t\tself.serialize = function(node) {\n\t\t\tvar handlers, validate;\n\n\t\t\tvalidate = settings.validate;\n\n\t\t\thandlers = {\n\t\t\t\t// #text\n\t\t\t\t3: function(node) {\n\t\t\t\t\twriter.text(node.value, node.raw);\n\t\t\t\t},\n\n\t\t\t\t// #comment\n\t\t\t\t8: function(node) {\n\t\t\t\t\twriter.comment(node.value);\n\t\t\t\t},\n\n\t\t\t\t// Processing instruction\n\t\t\t\t7: function(node) {\n\t\t\t\t\twriter.pi(node.name, node.value);\n\t\t\t\t},\n\n\t\t\t\t// Doctype\n\t\t\t\t10: function(node) {\n\t\t\t\t\twriter.doctype(node.value);\n\t\t\t\t},\n\n\t\t\t\t// CDATA\n\t\t\t\t4: function(node) {\n\t\t\t\t\twriter.cdata(node.value);\n\t\t\t\t},\n\n\t\t\t\t// Document fragment\n\t\t\t\t11: function(node) {\n\t\t\t\t\tif ((node = node.firstChild)) {\n\t\t\t\t\t\tdo {\n\t\t\t\t\t\t\twalk(node);\n\t\t\t\t\t\t} while ((node = node.next));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\twriter.reset();\n\n\t\t\tfunction walk(node) {\n\t\t\t\tvar handler = handlers[node.type], name, isEmpty, attrs, attrName, attrValue, sortedAttrs, i, l, elementRule;\n\n\t\t\t\tif (!handler) {\n\t\t\t\t\tname = node.name;\n\t\t\t\t\tisEmpty = node.shortEnded;\n\t\t\t\t\tattrs = node.attributes;\n\n\t\t\t\t\t// Sort attributes\n\t\t\t\t\tif (validate && attrs && attrs.length > 1) {\n\t\t\t\t\t\tsortedAttrs = [];\n\t\t\t\t\t\tsortedAttrs.map = {};\n\n\t\t\t\t\t\telementRule = schema.getElementRule(node.name);\n\t\t\t\t\t\tif (elementRule) {\n\t\t\t\t\t\t\tfor (i = 0, l = elementRule.attributesOrder.length; i < l; i++) {\n\t\t\t\t\t\t\t\tattrName = elementRule.attributesOrder[i];\n\n\t\t\t\t\t\t\t\tif (attrName in attrs.map) {\n\t\t\t\t\t\t\t\t\tattrValue = attrs.map[attrName];\n\t\t\t\t\t\t\t\t\tsortedAttrs.map[attrName] = attrValue;\n\t\t\t\t\t\t\t\t\tsortedAttrs.push({name: attrName, value: attrValue});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tfor (i = 0, l = attrs.length; i < l; i++) {\n\t\t\t\t\t\t\t\tattrName = attrs[i].name;\n\n\t\t\t\t\t\t\t\tif (!(attrName in sortedAttrs.map)) {\n\t\t\t\t\t\t\t\t\tattrValue = attrs.map[attrName];\n\t\t\t\t\t\t\t\t\tsortedAttrs.map[attrName] = attrValue;\n\t\t\t\t\t\t\t\t\tsortedAttrs.push({name: attrName, value: attrValue});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tattrs = sortedAttrs;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\twriter.start(node.name, attrs, isEmpty);\n\n\t\t\t\t\tif (!isEmpty) {\n\t\t\t\t\t\tif ((node = node.firstChild)) {\n\t\t\t\t\t\t\tdo {\n\t\t\t\t\t\t\t\twalk(node);\n\t\t\t\t\t\t\t} while ((node = node.next));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\twriter.end(name);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\thandler(node);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Serialize element and treat all non elements as fragments\n\t\t\tif (node.type == 1 && !settings.inner) {\n\t\t\t\twalk(node);\n\t\t\t} else {\n\t\t\t\thandlers[11](node);\n\t\t\t}\n\n\t\t\treturn writer.getContent();\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/dom/Serializer.js\n\n/**\n * Serializer.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class is used to serialize DOM trees into a string. Consult the TinyMCE Wiki API for\n * more details and examples on how to use this class.\n *\n * @class tinymce.dom.Serializer\n */\ndefine(\"tinymce/dom/Serializer\", [\n\t\"tinymce/dom/DOMUtils\",\n\t\"tinymce/html/DomParser\",\n\t\"tinymce/html/SaxParser\",\n\t\"tinymce/html/Entities\",\n\t\"tinymce/html/Serializer\",\n\t\"tinymce/html/Node\",\n\t\"tinymce/html/Schema\",\n\t\"tinymce/Env\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/text/Zwsp\"\n], function(DOMUtils, DomParser, SaxParser, Entities, Serializer, Node, Schema, Env, Tools, Zwsp) {\n\tvar each = Tools.each, trim = Tools.trim;\n\tvar DOM = DOMUtils.DOM;\n\n\t/**\n\t * IE 11 has a fantastic bug where it will produce two trailing BR elements to iframe bodies when\n\t * the iframe is hidden by display: none on a parent container. The DOM is actually out of sync\n\t * with innerHTML in this case. It's like IE adds shadow DOM BR elements that appears on innerHTML\n\t * but not as the lastChild of the body. So this fix simply removes the last two\n\t * BR elements at the end of the document.\n\t *\n\t * Example of what happens: <body>text</body> becomes <body>text<br><br></body>\n\t */\n\tfunction trimTrailingBr(rootNode) {\n\t\tvar brNode1, brNode2;\n\n\t\tfunction isBr(node) {\n\t\t\treturn node && node.name === 'br';\n\t\t}\n\n\t\tbrNode1 = rootNode.lastChild;\n\t\tif (isBr(brNode1)) {\n\t\t\tbrNode2 = brNode1.prev;\n\n\t\t\tif (isBr(brNode2)) {\n\t\t\t\tbrNode1.remove();\n\t\t\t\tbrNode2.remove();\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Constructs a new DOM serializer class.\n\t *\n\t * @constructor\n\t * @method Serializer\n\t * @param {Object} settings Serializer settings object.\n\t * @param {tinymce.Editor} editor Optional editor to bind events to and get schema/dom from.\n\t */\n\treturn function(settings, editor) {\n\t\tvar dom, schema, htmlParser, tempAttrs = [\"data-mce-selected\"];\n\n\t\tif (editor) {\n\t\t\tdom = editor.dom;\n\t\t\tschema = editor.schema;\n\t\t}\n\n\t\tfunction trimHtml(html) {\n\t\t\tvar trimContentRegExp = new RegExp([\n\t\t\t\t'<span[^>]+data-mce-bogus[^>]+>[\\u200B\\uFEFF]+<\\\\/span>', // Trim bogus spans like caret containers\n\t\t\t\t'\\\\s?(' + tempAttrs.join('|') + ')=\"[^\"]+\"' // Trim temporaty data-mce prefixed attributes like data-mce-selected\n\t\t\t].join('|'), 'gi');\n\n\t\t\thtml = Zwsp.trim(html.replace(trimContentRegExp, ''));\n\n\t\t\treturn html;\n\t\t}\n\n\t\tfunction trimContent(html) {\n\t\t\tvar content = html;\n\t\t\tvar bogusAllRegExp = /<(\\w+) [^>]*data-mce-bogus=\"all\"[^>]*>/g;\n\t\t\tvar endTagIndex, index, matchLength, matches, shortEndedElements, schema = editor.schema;\n\n\t\t\tcontent = trimHtml(content);\n\t\t\tshortEndedElements = schema.getShortEndedElements();\n\n\t\t\t// Remove all bogus elements marked with \"all\"\n\t\t\twhile ((matches = bogusAllRegExp.exec(content))) {\n\t\t\t\tindex = bogusAllRegExp.lastIndex;\n\t\t\t\tmatchLength = matches[0].length;\n\n\t\t\t\tif (shortEndedElements[matches[1]]) {\n\t\t\t\t\tendTagIndex = index;\n\t\t\t\t} else {\n\t\t\t\t\tendTagIndex = SaxParser.findEndTag(schema, content, index);\n\t\t\t\t}\n\n\t\t\t\tcontent = content.substring(0, index - matchLength) + content.substring(endTagIndex);\n\t\t\t\tbogusAllRegExp.lastIndex = index - matchLength;\n\t\t\t}\n\n\t\t\treturn trim(content);\n\t\t}\n\n\t\t/**\n\t\t * Returns a trimmed version of the editor contents to be used for the undo level. This\n\t\t * will remove any data-mce-bogus=\"all\" marked elements since these are used for UI it will also\n\t\t * remove the data-mce-selected attributes used for selection of objects and caret containers.\n\t\t * It will keep all data-mce-bogus=\"1\" elements since these can be used to place the caret etc and will\n\t\t * be removed by the serialization logic when you save.\n\t\t *\n\t\t * @private\n\t\t * @return {String} HTML contents of the editor excluding some internal bogus elements.\n\t\t */\n\t\tfunction getTrimmedContent() {\n\t\t\treturn trimContent(editor.getBody().innerHTML);\n\t\t}\n\n\t\tfunction addTempAttr(name) {\n\t\t\tif (Tools.inArray(tempAttrs, name) === -1) {\n\t\t\t\thtmlParser.addAttributeFilter(name, function(nodes, name) {\n\t\t\t\t\tvar i = nodes.length;\n\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tnodes[i].attr(name, null);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\ttempAttrs.push(name);\n\t\t\t}\n\t\t}\n\n\t\t// Default DOM and Schema if they are undefined\n\t\tdom = dom || DOM;\n\t\tschema = schema || new Schema(settings);\n\t\tsettings.entity_encoding = settings.entity_encoding || 'named';\n\t\tsettings.remove_trailing_brs = \"remove_trailing_brs\" in settings ? settings.remove_trailing_brs : true;\n\n\t\thtmlParser = new DomParser(settings, schema);\n\n\t\t// Convert tabindex back to elements when serializing contents\n\t\thtmlParser.addAttributeFilter('data-mce-tabindex', function(nodes, name) {\n\t\t\tvar i = nodes.length, node;\n\n\t\t\twhile (i--) {\n\t\t\t\tnode = nodes[i];\n\t\t\t\tnode.attr('tabindex', node.attributes.map['data-mce-tabindex']);\n\t\t\t\tnode.attr(name, null);\n\t\t\t}\n\t\t});\n\n\t\t// Convert move data-mce-src, data-mce-href and data-mce-style into nodes or process them if needed\n\t\thtmlParser.addAttributeFilter('src,href,style', function(nodes, name) {\n\t\t\tvar i = nodes.length, node, value, internalName = 'data-mce-' + name;\n\t\t\tvar urlConverter = settings.url_converter, urlConverterScope = settings.url_converter_scope, undef;\n\n\t\t\twhile (i--) {\n\t\t\t\tnode = nodes[i];\n\n\t\t\t\tvalue = node.attributes.map[internalName];\n\t\t\t\tif (value !== undef) {\n\t\t\t\t\t// Set external name to internal value and remove internal\n\t\t\t\t\tnode.attr(name, value.length > 0 ? value : null);\n\t\t\t\t\tnode.attr(internalName, null);\n\t\t\t\t} else {\n\t\t\t\t\t// No internal attribute found then convert the value we have in the DOM\n\t\t\t\t\tvalue = node.attributes.map[name];\n\n\t\t\t\t\tif (name === \"style\") {\n\t\t\t\t\t\tvalue = dom.serializeStyle(dom.parseStyle(value), node.name);\n\t\t\t\t\t} else if (urlConverter) {\n\t\t\t\t\t\tvalue = urlConverter.call(urlConverterScope, value, name, node.name);\n\t\t\t\t\t}\n\n\t\t\t\t\tnode.attr(name, value.length > 0 ? value : null);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t// Remove internal classes mceItem<..> or mceSelected\n\t\thtmlParser.addAttributeFilter('class', function(nodes) {\n\t\t\tvar i = nodes.length, node, value;\n\n\t\t\twhile (i--) {\n\t\t\t\tnode = nodes[i];\n\t\t\t\tvalue = node.attr('class');\n\n\t\t\t\tif (value) {\n\t\t\t\t\tvalue = node.attr('class').replace(/(?:^|\\s)mce-item-\\w+(?!\\S)/g, '');\n\t\t\t\t\tnode.attr('class', value.length > 0 ? value : null);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t// Remove bookmark elements\n\t\thtmlParser.addAttributeFilter('data-mce-type', function(nodes, name, args) {\n\t\t\tvar i = nodes.length, node;\n\n\t\t\twhile (i--) {\n\t\t\t\tnode = nodes[i];\n\n\t\t\t\tif (node.attributes.map['data-mce-type'] === 'bookmark' && !args.cleanup) {\n\t\t\t\t\tnode.remove();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\thtmlParser.addNodeFilter('noscript', function(nodes) {\n\t\t\tvar i = nodes.length, node;\n\n\t\t\twhile (i--) {\n\t\t\t\tnode = nodes[i].firstChild;\n\n\t\t\t\tif (node) {\n\t\t\t\t\tnode.value = Entities.decode(node.value);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t// Force script into CDATA sections and remove the mce- prefix also add comments around styles\n\t\thtmlParser.addNodeFilter('script,style', function(nodes, name) {\n\t\t\tvar i = nodes.length, node, value, type;\n\n\t\t\tfunction trim(value) {\n\t\t\t\t/*jshint maxlen:255 */\n\t\t\t\t/*eslint max-len:0 */\n\t\t\t\treturn value.replace(/(<!--\\[CDATA\\[|\\]\\]-->)/g, '\\n')\n\t\t\t\t\t\t.replace(/^[\\r\\n]*|[\\r\\n]*$/g, '')\n\t\t\t\t\t\t.replace(/^\\s*((<!--)?(\\s*\\/\\/)?\\s*<!\\[CDATA\\[|(<!--\\s*)?\\/\\*\\s*<!\\[CDATA\\[\\s*\\*\\/|(\\/\\/)?\\s*<!--|\\/\\*\\s*<!--\\s*\\*\\/)\\s*[\\r\\n]*/gi, '')\n\t\t\t\t\t\t.replace(/\\s*(\\/\\*\\s*\\]\\]>\\s*\\*\\/(-->)?|\\s*\\/\\/\\s*\\]\\]>(-->)?|\\/\\/\\s*(-->)?|\\]\\]>|\\/\\*\\s*-->\\s*\\*\\/|\\s*-->\\s*)\\s*$/g, '');\n\t\t\t}\n\n\t\t\twhile (i--) {\n\t\t\t\tnode = nodes[i];\n\t\t\t\tvalue = node.firstChild ? node.firstChild.value : '';\n\n\t\t\t\tif (name === \"script\") {\n\t\t\t\t\t// Remove mce- prefix from script elements and remove default type since the user specified\n\t\t\t\t\t// a script element without type attribute\n\t\t\t\t\ttype = node.attr('type');\n\t\t\t\t\tif (type) {\n\t\t\t\t\t\tnode.attr('type', type == 'mce-no/type' ? null : type.replace(/^mce\\-/, ''));\n\t\t\t\t\t}\n\n\t\t\t\t\tif (value.length > 0) {\n\t\t\t\t\t\tnode.firstChild.value = '// <![CDATA[\\n' + trim(value) + '\\n// ]]>';\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (value.length > 0) {\n\t\t\t\t\t\tnode.firstChild.value = '<!--\\n' + trim(value) + '\\n-->';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t// Convert comments to cdata and handle protected comments\n\t\thtmlParser.addNodeFilter('#comment', function(nodes) {\n\t\t\tvar i = nodes.length, node;\n\n\t\t\twhile (i--) {\n\t\t\t\tnode = nodes[i];\n\n\t\t\t\tif (node.value.indexOf('[CDATA[') === 0) {\n\t\t\t\t\tnode.name = '#cdata';\n\t\t\t\t\tnode.type = 4;\n\t\t\t\t\tnode.value = node.value.replace(/^\\[CDATA\\[|\\]\\]$/g, '');\n\t\t\t\t} else if (node.value.indexOf('mce:protected ') === 0) {\n\t\t\t\t\tnode.name = \"#text\";\n\t\t\t\t\tnode.type = 3;\n\t\t\t\t\tnode.raw = true;\n\t\t\t\t\tnode.value = unescape(node.value).substr(14);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\thtmlParser.addNodeFilter('xml:namespace,input', function(nodes, name) {\n\t\t\tvar i = nodes.length, node;\n\n\t\t\twhile (i--) {\n\t\t\t\tnode = nodes[i];\n\t\t\t\tif (node.type === 7) {\n\t\t\t\t\tnode.remove();\n\t\t\t\t} else if (node.type === 1) {\n\t\t\t\t\tif (name === \"input\" && !(\"type\" in node.attributes.map)) {\n\t\t\t\t\t\tnode.attr('type', 'text');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t// Fix list elements, TODO: Replace this later\n\t\tif (settings.fix_list_elements) {\n\t\t\thtmlParser.addNodeFilter('ul,ol', function(nodes) {\n\t\t\t\tvar i = nodes.length, node, parentNode;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tnode = nodes[i];\n\t\t\t\t\tparentNode = node.parent;\n\n\t\t\t\t\tif (parentNode.name === 'ul' || parentNode.name === 'ol') {\n\t\t\t\t\t\tif (node.prev && node.prev.name === 'li') {\n\t\t\t\t\t\t\tnode.prev.append(node);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// Remove internal data attributes\n\t\thtmlParser.addAttributeFilter(\n\t\t\t'data-mce-src,data-mce-href,data-mce-style,' +\n\t\t\t'data-mce-selected,data-mce-expando,' +\n\t\t\t'data-mce-type,data-mce-resize',\n\n\t\t\tfunction(nodes, name) {\n\t\t\t\tvar i = nodes.length;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tnodes[i].attr(name, null);\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\n\t\t// Return public methods\n\t\treturn {\n\t\t\t/**\n\t\t\t * Schema instance that was used to when the Serializer was constructed.\n\t\t\t *\n\t\t\t * @field {tinymce.html.Schema} schema\n\t\t\t */\n\t\t\tschema: schema,\n\n\t\t\t/**\n\t\t\t * Adds a node filter function to the parser used by the serializer, the parser will collect the specified nodes by name\n\t\t\t * and then execute the callback ones it has finished parsing the document.\n\t\t\t *\n\t\t\t * @example\n\t\t\t * parser.addNodeFilter('p,h1', function(nodes, name) {\n\t\t\t *\t\tfor (var i = 0; i < nodes.length; i++) {\n\t\t\t *\t\t\tconsole.log(nodes[i].name);\n\t\t\t *\t\t}\n\t\t\t * });\n\t\t\t * @method addNodeFilter\n\t\t\t * @method {String} name Comma separated list of nodes to collect.\n\t\t\t * @param {function} callback Callback function to execute once it has collected nodes.\n\t\t\t */\n\t\t\taddNodeFilter: htmlParser.addNodeFilter,\n\n\t\t\t/**\n\t\t\t * Adds a attribute filter function to the parser used by the serializer, the parser will\n\t\t\t * collect nodes that has the specified attributes\n\t\t\t * and then execute the callback ones it has finished parsing the document.\n\t\t\t *\n\t\t\t * @example\n\t\t\t * parser.addAttributeFilter('src,href', function(nodes, name) {\n\t\t\t *\t\tfor (var i = 0; i < nodes.length; i++) {\n\t\t\t *\t\t\tconsole.log(nodes[i].name);\n\t\t\t *\t\t}\n\t\t\t * });\n\t\t\t * @method addAttributeFilter\n\t\t\t * @method {String} name Comma separated list of nodes to collect.\n\t\t\t * @param {function} callback Callback function to execute once it has collected nodes.\n\t\t\t */\n\t\t\taddAttributeFilter: htmlParser.addAttributeFilter,\n\n\t\t\t/**\n\t\t\t * Serializes the specified browser DOM node into a HTML string.\n\t\t\t *\n\t\t\t * @method serialize\n\t\t\t * @param {DOMNode} node DOM node to serialize.\n\t\t\t * @param {Object} args Arguments option that gets passed to event handlers.\n\t\t\t */\n\t\t\tserialize: function(node, args) {\n\t\t\t\tvar self = this, impl, doc, oldDoc, htmlSerializer, content, rootNode;\n\n\t\t\t\t// Explorer won't clone contents of script and style and the\n\t\t\t\t// selected index of select elements are cleared on a clone operation.\n\t\t\t\tif (Env.ie && dom.select('script,style,select,map').length > 0) {\n\t\t\t\t\tcontent = node.innerHTML;\n\t\t\t\t\tnode = node.cloneNode(false);\n\t\t\t\t\tdom.setHTML(node, content);\n\t\t\t\t} else {\n\t\t\t\t\tnode = node.cloneNode(true);\n\t\t\t\t}\n\n\t\t\t\t// Nodes needs to be attached to something in WebKit/Opera\n\t\t\t\t// This fix will make DOM ranges and make Sizzle happy!\n\t\t\t\timpl = document.implementation;\n\t\t\t\tif (impl.createHTMLDocument) {\n\t\t\t\t\t// Create an empty HTML document\n\t\t\t\t\tdoc = impl.createHTMLDocument(\"\");\n\n\t\t\t\t\t// Add the element or it's children if it's a body element to the new document\n\t\t\t\t\teach(node.nodeName == 'BODY' ? node.childNodes : [node], function(node) {\n\t\t\t\t\t\tdoc.body.appendChild(doc.importNode(node, true));\n\t\t\t\t\t});\n\n\t\t\t\t\t// Grab first child or body element for serialization\n\t\t\t\t\tif (node.nodeName != 'BODY') {\n\t\t\t\t\t\tnode = doc.body.firstChild;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnode = doc.body;\n\t\t\t\t\t}\n\n\t\t\t\t\t// set the new document in DOMUtils so createElement etc works\n\t\t\t\t\toldDoc = dom.doc;\n\t\t\t\t\tdom.doc = doc;\n\t\t\t\t}\n\n\t\t\t\targs = args || {};\n\t\t\t\targs.format = args.format || 'html';\n\n\t\t\t\t// Don't wrap content if we want selected html\n\t\t\t\tif (args.selection) {\n\t\t\t\t\targs.forced_root_block = '';\n\t\t\t\t}\n\n\t\t\t\t// Pre process\n\t\t\t\tif (!args.no_events) {\n\t\t\t\t\targs.node = node;\n\t\t\t\t\tself.onPreProcess(args);\n\t\t\t\t}\n\n\t\t\t\t// Parse HTML\n\t\t\t\trootNode = htmlParser.parse(trim(args.getInner ? node.innerHTML : dom.getOuterHTML(node)), args);\n\t\t\t\ttrimTrailingBr(rootNode);\n\n\t\t\t\t// Serialize HTML\n\t\t\t\thtmlSerializer = new Serializer(settings, schema);\n\t\t\t\targs.content = htmlSerializer.serialize(rootNode);\n\n\t\t\t\t// Replace all BOM characters for now until we can find a better solution\n\t\t\t\tif (!args.cleanup) {\n\t\t\t\t\targs.content = Zwsp.trim(args.content);\n\t\t\t\t\targs.content = args.content.replace(/\\uFEFF/g, '');\n\t\t\t\t}\n\n\t\t\t\t// Post process\n\t\t\t\tif (!args.no_events) {\n\t\t\t\t\tself.onPostProcess(args);\n\t\t\t\t}\n\n\t\t\t\t// Restore the old document if it was changed\n\t\t\t\tif (oldDoc) {\n\t\t\t\t\tdom.doc = oldDoc;\n\t\t\t\t}\n\n\t\t\t\targs.node = null;\n\n\t\t\t\treturn args.content;\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Adds valid elements rules to the serializers schema instance this enables you to specify things\n\t\t\t * like what elements should be outputted and what attributes specific elements might have.\n\t\t\t * Consult the Wiki for more details on this format.\n\t\t\t *\n\t\t\t * @method addRules\n\t\t\t * @param {String} rules Valid elements rules string to add to schema.\n\t\t\t */\n\t\t\taddRules: function(rules) {\n\t\t\t\tschema.addValidElements(rules);\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Sets the valid elements rules to the serializers schema instance this enables you to specify things\n\t\t\t * like what elements should be outputted and what attributes specific elements might have.\n\t\t\t * Consult the Wiki for more details on this format.\n\t\t\t *\n\t\t\t * @method setRules\n\t\t\t * @param {String} rules Valid elements rules string.\n\t\t\t */\n\t\t\tsetRules: function(rules) {\n\t\t\t\tschema.setValidElements(rules);\n\t\t\t},\n\n\t\t\tonPreProcess: function(args) {\n\t\t\t\tif (editor) {\n\t\t\t\t\teditor.fire('PreProcess', args);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tonPostProcess: function(args) {\n\t\t\t\tif (editor) {\n\t\t\t\t\teditor.fire('PostProcess', args);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Adds a temporary internal attribute these attributes will get removed on undo and\n\t\t\t * when getting contents out of the editor.\n\t\t\t *\n\t\t\t * @method addTempAttr\n\t\t\t * @param {String} name string\n\t\t\t */\n\t\t\taddTempAttr: addTempAttr,\n\n\t\t\t// Internal\n\t\t\ttrimHtml: trimHtml,\n\t\t\tgetTrimmedContent: getTrimmedContent,\n\t\t\ttrimContent: trimContent\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/dom/TridentSelection.js\n\n/**\n * TridentSelection.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Selection class for old explorer versions. This one fakes the\n * native selection object available on modern browsers.\n *\n * @private\n * @class tinymce.dom.TridentSelection\n */\ndefine(\"tinymce/dom/TridentSelection\", [], function() {\n\tfunction Selection(selection) {\n\t\tvar self = this, dom = selection.dom, FALSE = false;\n\n\t\tfunction getPosition(rng, start) {\n\t\t\tvar checkRng, startIndex = 0, endIndex, inside,\n\t\t\t\tchildren, child, offset, index, position = -1, parent;\n\n\t\t\t// Setup test range, collapse it and get the parent\n\t\t\tcheckRng = rng.duplicate();\n\t\t\tcheckRng.collapse(start);\n\t\t\tparent = checkRng.parentElement();\n\n\t\t\t// Check if the selection is within the right document\n\t\t\tif (parent.ownerDocument !== selection.dom.doc) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// IE will report non editable elements as it's parent so look for an editable one\n\t\t\twhile (parent.contentEditable === \"false\") {\n\t\t\t\tparent = parent.parentNode;\n\t\t\t}\n\n\t\t\t// If parent doesn't have any children then return that we are inside the element\n\t\t\tif (!parent.hasChildNodes()) {\n\t\t\t\treturn {node: parent, inside: 1};\n\t\t\t}\n\n\t\t\t// Setup node list and endIndex\n\t\t\tchildren = parent.children;\n\t\t\tendIndex = children.length - 1;\n\n\t\t\t// Perform a binary search for the position\n\t\t\twhile (startIndex <= endIndex) {\n\t\t\t\tindex = Math.floor((startIndex + endIndex) / 2);\n\n\t\t\t\t// Move selection to node and compare the ranges\n\t\t\t\tchild = children[index];\n\t\t\t\tcheckRng.moveToElementText(child);\n\t\t\t\tposition = checkRng.compareEndPoints(start ? 'StartToStart' : 'EndToEnd', rng);\n\n\t\t\t\t// Before/after or an exact match\n\t\t\t\tif (position > 0) {\n\t\t\t\t\tendIndex = index - 1;\n\t\t\t\t} else if (position < 0) {\n\t\t\t\t\tstartIndex = index + 1;\n\t\t\t\t} else {\n\t\t\t\t\treturn {node: child};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Check if child position is before or we didn't find a position\n\t\t\tif (position < 0) {\n\t\t\t\t// No element child was found use the parent element and the offset inside that\n\t\t\t\tif (!child) {\n\t\t\t\t\tcheckRng.moveToElementText(parent);\n\t\t\t\t\tcheckRng.collapse(true);\n\t\t\t\t\tchild = parent;\n\t\t\t\t\tinside = true;\n\t\t\t\t} else {\n\t\t\t\t\tcheckRng.collapse(false);\n\t\t\t\t}\n\n\t\t\t\t// Walk character by character in text node until we hit the selected range endpoint,\n\t\t\t\t// hit the end of document or parent isn't the right one\n\t\t\t\t// We need to walk char by char since rng.text or rng.htmlText will trim line endings\n\t\t\t\toffset = 0;\n\t\t\t\twhile (checkRng.compareEndPoints(start ? 'StartToStart' : 'StartToEnd', rng) !== 0) {\n\t\t\t\t\tif (checkRng.move('character', 1) === 0 || parent != checkRng.parentElement()) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\toffset++;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Child position is after the selection endpoint\n\t\t\t\tcheckRng.collapse(true);\n\n\t\t\t\t// Walk character by character in text node until we hit the selected range endpoint, hit\n\t\t\t\t// the end of document or parent isn't the right one\n\t\t\t\toffset = 0;\n\t\t\t\twhile (checkRng.compareEndPoints(start ? 'StartToStart' : 'StartToEnd', rng) !== 0) {\n\t\t\t\t\tif (checkRng.move('character', -1) === 0 || parent != checkRng.parentElement()) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\toffset++;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn {node: child, position: position, offset: offset, inside: inside};\n\t\t}\n\n\t\t// Returns a W3C DOM compatible range object by using the IE Range API\n\t\tfunction getRange() {\n\t\t\tvar ieRange = selection.getRng(), domRange = dom.createRng(), element, collapsed, tmpRange, element2, bookmark;\n\n\t\t\t// If selection is outside the current document just return an empty range\n\t\t\telement = ieRange.item ? ieRange.item(0) : ieRange.parentElement();\n\t\t\tif (element.ownerDocument != dom.doc) {\n\t\t\t\treturn domRange;\n\t\t\t}\n\n\t\t\tcollapsed = selection.isCollapsed();\n\n\t\t\t// Handle control selection\n\t\t\tif (ieRange.item) {\n\t\t\t\tdomRange.setStart(element.parentNode, dom.nodeIndex(element));\n\t\t\t\tdomRange.setEnd(domRange.startContainer, domRange.startOffset + 1);\n\n\t\t\t\treturn domRange;\n\t\t\t}\n\n\t\t\tfunction findEndPoint(start) {\n\t\t\t\tvar endPoint = getPosition(ieRange, start), container, offset, textNodeOffset = 0, sibling, undef, nodeValue;\n\n\t\t\t\tcontainer = endPoint.node;\n\t\t\t\toffset = endPoint.offset;\n\n\t\t\t\tif (endPoint.inside && !container.hasChildNodes()) {\n\t\t\t\t\tdomRange[start ? 'setStart' : 'setEnd'](container, 0);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (offset === undef) {\n\t\t\t\t\tdomRange[start ? 'setStartBefore' : 'setEndAfter'](container);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (endPoint.position < 0) {\n\t\t\t\t\tsibling = endPoint.inside ? container.firstChild : container.nextSibling;\n\n\t\t\t\t\tif (!sibling) {\n\t\t\t\t\t\tdomRange[start ? 'setStartAfter' : 'setEndAfter'](container);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!offset) {\n\t\t\t\t\t\tif (sibling.nodeType == 3) {\n\t\t\t\t\t\t\tdomRange[start ? 'setStart' : 'setEnd'](sibling, 0);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdomRange[start ? 'setStartBefore' : 'setEndBefore'](sibling);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Find the text node and offset\n\t\t\t\t\twhile (sibling) {\n\t\t\t\t\t\tif (sibling.nodeType == 3) {\n\t\t\t\t\t\t\tnodeValue = sibling.nodeValue;\n\t\t\t\t\t\t\ttextNodeOffset += nodeValue.length;\n\n\t\t\t\t\t\t\t// We are at or passed the position we where looking for\n\t\t\t\t\t\t\tif (textNodeOffset >= offset) {\n\t\t\t\t\t\t\t\tcontainer = sibling;\n\t\t\t\t\t\t\t\ttextNodeOffset -= offset;\n\t\t\t\t\t\t\t\ttextNodeOffset = nodeValue.length - textNodeOffset;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tsibling = sibling.nextSibling;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// Find the text node and offset\n\t\t\t\t\tsibling = container.previousSibling;\n\n\t\t\t\t\tif (!sibling) {\n\t\t\t\t\t\treturn domRange[start ? 'setStartBefore' : 'setEndBefore'](container);\n\t\t\t\t\t}\n\n\t\t\t\t\t// If there isn't any text to loop then use the first position\n\t\t\t\t\tif (!offset) {\n\t\t\t\t\t\tif (container.nodeType == 3) {\n\t\t\t\t\t\t\tdomRange[start ? 'setStart' : 'setEnd'](sibling, container.nodeValue.length);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdomRange[start ? 'setStartAfter' : 'setEndAfter'](sibling);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\twhile (sibling) {\n\t\t\t\t\t\tif (sibling.nodeType == 3) {\n\t\t\t\t\t\t\ttextNodeOffset += sibling.nodeValue.length;\n\n\t\t\t\t\t\t\t// We are at or passed the position we where looking for\n\t\t\t\t\t\t\tif (textNodeOffset >= offset) {\n\t\t\t\t\t\t\t\tcontainer = sibling;\n\t\t\t\t\t\t\t\ttextNodeOffset -= offset;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tsibling = sibling.previousSibling;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tdomRange[start ? 'setStart' : 'setEnd'](container, textNodeOffset);\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\t// Find start point\n\t\t\t\tfindEndPoint(true);\n\n\t\t\t\t// Find end point if needed\n\t\t\t\tif (!collapsed) {\n\t\t\t\t\tfindEndPoint();\n\t\t\t\t}\n\t\t\t} catch (ex) {\n\t\t\t\t// IE has a nasty bug where text nodes might throw \"invalid argument\" when you\n\t\t\t\t// access the nodeValue or other properties of text nodes. This seems to happen when\n\t\t\t\t// text nodes are split into two nodes by a delete/backspace call.\n\t\t\t\t// So let us detect and try to fix it.\n\t\t\t\tif (ex.number == -2147024809) {\n\t\t\t\t\t// Get the current selection\n\t\t\t\t\tbookmark = self.getBookmark(2);\n\n\t\t\t\t\t// Get start element\n\t\t\t\t\ttmpRange = ieRange.duplicate();\n\t\t\t\t\ttmpRange.collapse(true);\n\t\t\t\t\telement = tmpRange.parentElement();\n\n\t\t\t\t\t// Get end element\n\t\t\t\t\tif (!collapsed) {\n\t\t\t\t\t\ttmpRange = ieRange.duplicate();\n\t\t\t\t\t\ttmpRange.collapse(false);\n\t\t\t\t\t\telement2 = tmpRange.parentElement();\n\t\t\t\t\t\telement2.innerHTML = element2.innerHTML;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Remove the broken elements\n\t\t\t\t\telement.innerHTML = element.innerHTML;\n\n\t\t\t\t\t// Restore the selection\n\t\t\t\t\tself.moveToBookmark(bookmark);\n\n\t\t\t\t\t// Since the range has moved we need to re-get it\n\t\t\t\t\tieRange = selection.getRng();\n\n\t\t\t\t\t// Find start point\n\t\t\t\t\tfindEndPoint(true);\n\n\t\t\t\t\t// Find end point if needed\n\t\t\t\t\tif (!collapsed) {\n\t\t\t\t\t\tfindEndPoint();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthrow ex; // Throw other errors\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn domRange;\n\t\t}\n\n\t\tthis.getBookmark = function(type) {\n\t\t\tvar rng = selection.getRng(), bookmark = {};\n\n\t\t\tfunction getIndexes(node) {\n\t\t\t\tvar parent, root, children, i, indexes = [];\n\n\t\t\t\tparent = node.parentNode;\n\t\t\t\troot = dom.getRoot().parentNode;\n\n\t\t\t\twhile (parent != root && parent.nodeType !== 9) {\n\t\t\t\t\tchildren = parent.children;\n\n\t\t\t\t\ti = children.length;\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tif (node === children[i]) {\n\t\t\t\t\t\t\tindexes.push(i);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tnode = parent;\n\t\t\t\t\tparent = parent.parentNode;\n\t\t\t\t}\n\n\t\t\t\treturn indexes;\n\t\t\t}\n\n\t\t\tfunction getBookmarkEndPoint(start) {\n\t\t\t\tvar position;\n\n\t\t\t\tposition = getPosition(rng, start);\n\t\t\t\tif (position) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tposition: position.position,\n\t\t\t\t\t\toffset: position.offset,\n\t\t\t\t\t\tindexes: getIndexes(position.node),\n\t\t\t\t\t\tinside: position.inside\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Non ubstructive bookmark\n\t\t\tif (type === 2) {\n\t\t\t\t// Handle text selection\n\t\t\t\tif (!rng.item) {\n\t\t\t\t\tbookmark.start = getBookmarkEndPoint(true);\n\n\t\t\t\t\tif (!selection.isCollapsed()) {\n\t\t\t\t\t\tbookmark.end = getBookmarkEndPoint();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tbookmark.start = {ctrl: true, indexes: getIndexes(rng.item(0))};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn bookmark;\n\t\t};\n\n\t\tthis.moveToBookmark = function(bookmark) {\n\t\t\tvar rng, body = dom.doc.body;\n\n\t\t\tfunction resolveIndexes(indexes) {\n\t\t\t\tvar node, i, idx, children;\n\n\t\t\t\tnode = dom.getRoot();\n\t\t\t\tfor (i = indexes.length - 1; i >= 0; i--) {\n\t\t\t\t\tchildren = node.children;\n\t\t\t\t\tidx = indexes[i];\n\n\t\t\t\t\tif (idx <= children.length - 1) {\n\t\t\t\t\t\tnode = children[idx];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn node;\n\t\t\t}\n\n\t\t\tfunction setBookmarkEndPoint(start) {\n\t\t\t\tvar endPoint = bookmark[start ? 'start' : 'end'], moveLeft, moveRng, undef, offset;\n\n\t\t\t\tif (endPoint) {\n\t\t\t\t\tmoveLeft = endPoint.position > 0;\n\n\t\t\t\t\tmoveRng = body.createTextRange();\n\t\t\t\t\tmoveRng.moveToElementText(resolveIndexes(endPoint.indexes));\n\n\t\t\t\t\toffset = endPoint.offset;\n\t\t\t\t\tif (offset !== undef) {\n\t\t\t\t\t\tmoveRng.collapse(endPoint.inside || moveLeft);\n\t\t\t\t\t\tmoveRng.moveStart('character', moveLeft ? -offset : offset);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tmoveRng.collapse(start);\n\t\t\t\t\t}\n\n\t\t\t\t\trng.setEndPoint(start ? 'StartToStart' : 'EndToStart', moveRng);\n\n\t\t\t\t\tif (start) {\n\t\t\t\t\t\trng.collapse(true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (bookmark.start) {\n\t\t\t\tif (bookmark.start.ctrl) {\n\t\t\t\t\trng = body.createControlRange();\n\t\t\t\t\trng.addElement(resolveIndexes(bookmark.start.indexes));\n\t\t\t\t\trng.select();\n\t\t\t\t} else {\n\t\t\t\t\trng = body.createTextRange();\n\t\t\t\t\tsetBookmarkEndPoint(true);\n\t\t\t\t\tsetBookmarkEndPoint();\n\t\t\t\t\trng.select();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tthis.addRange = function(rng) {\n\t\t\tvar ieRng, ctrlRng, startContainer, startOffset, endContainer, endOffset, sibling,\n\t\t\t\tdoc = selection.dom.doc, body = doc.body, nativeRng, ctrlElm;\n\n\t\t\tfunction setEndPoint(start) {\n\t\t\t\tvar container, offset, marker, tmpRng, nodes;\n\n\t\t\t\tmarker = dom.create('a');\n\t\t\t\tcontainer = start ? startContainer : endContainer;\n\t\t\t\toffset = start ? startOffset : endOffset;\n\t\t\t\ttmpRng = ieRng.duplicate();\n\n\t\t\t\tif (container == doc || container == doc.documentElement) {\n\t\t\t\t\tcontainer = body;\n\t\t\t\t\toffset = 0;\n\t\t\t\t}\n\n\t\t\t\tif (container.nodeType == 3) {\n\t\t\t\t\tcontainer.parentNode.insertBefore(marker, container);\n\t\t\t\t\ttmpRng.moveToElementText(marker);\n\t\t\t\t\ttmpRng.moveStart('character', offset);\n\t\t\t\t\tdom.remove(marker);\n\t\t\t\t\tieRng.setEndPoint(start ? 'StartToStart' : 'EndToEnd', tmpRng);\n\t\t\t\t} else {\n\t\t\t\t\tnodes = container.childNodes;\n\n\t\t\t\t\tif (nodes.length) {\n\t\t\t\t\t\tif (offset >= nodes.length) {\n\t\t\t\t\t\t\tdom.insertAfter(marker, nodes[nodes.length - 1]);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcontainer.insertBefore(marker, nodes[offset]);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttmpRng.moveToElementText(marker);\n\t\t\t\t\t} else if (container.canHaveHTML) {\n\t\t\t\t\t\t// Empty node selection for example <div>|</div>\n\t\t\t\t\t\t// Setting innerHTML with a span marker then remove that marker seems to keep empty block elements open\n\t\t\t\t\t\tcontainer.innerHTML = '<span>&#xFEFF;</span>';\n\t\t\t\t\t\tmarker = container.firstChild;\n\t\t\t\t\t\ttmpRng.moveToElementText(marker);\n\t\t\t\t\t\ttmpRng.collapse(FALSE); // Collapse false works better than true for some odd reason\n\t\t\t\t\t}\n\n\t\t\t\t\tieRng.setEndPoint(start ? 'StartToStart' : 'EndToEnd', tmpRng);\n\t\t\t\t\tdom.remove(marker);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Setup some shorter versions\n\t\t\tstartContainer = rng.startContainer;\n\t\t\tstartOffset = rng.startOffset;\n\t\t\tendContainer = rng.endContainer;\n\t\t\tendOffset = rng.endOffset;\n\t\t\tieRng = body.createTextRange();\n\n\t\t\t// If single element selection then try making a control selection out of it\n\t\t\tif (startContainer == endContainer && startContainer.nodeType == 1) {\n\t\t\t\t// Trick to place the caret inside an empty block element like <p></p>\n\t\t\t\tif (startOffset == endOffset && !startContainer.hasChildNodes()) {\n\t\t\t\t\tif (startContainer.canHaveHTML) {\n\t\t\t\t\t\t// Check if previous sibling is an empty block if it is then we need to render it\n\t\t\t\t\t\t// IE would otherwise move the caret into the sibling instead of the empty startContainer see: #5236\n\t\t\t\t\t\t// Example this: <p></p><p>|</p> would become this: <p>|</p><p></p>\n\t\t\t\t\t\tsibling = startContainer.previousSibling;\n\t\t\t\t\t\tif (sibling && !sibling.hasChildNodes() && dom.isBlock(sibling)) {\n\t\t\t\t\t\t\tsibling.innerHTML = '&#xFEFF;';\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsibling = null;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tstartContainer.innerHTML = '<span>&#xFEFF;</span><span>&#xFEFF;</span>';\n\t\t\t\t\t\tieRng.moveToElementText(startContainer.lastChild);\n\t\t\t\t\t\tieRng.select();\n\t\t\t\t\t\tdom.doc.selection.clear();\n\t\t\t\t\t\tstartContainer.innerHTML = '';\n\n\t\t\t\t\t\tif (sibling) {\n\t\t\t\t\t\t\tsibling.innerHTML = '';\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tstartOffset = dom.nodeIndex(startContainer);\n\t\t\t\t\tstartContainer = startContainer.parentNode;\n\t\t\t\t}\n\n\t\t\t\tif (startOffset == endOffset - 1) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tctrlElm = startContainer.childNodes[startOffset];\n\t\t\t\t\t\tctrlRng = body.createControlRange();\n\t\t\t\t\t\tctrlRng.addElement(ctrlElm);\n\t\t\t\t\t\tctrlRng.select();\n\n\t\t\t\t\t\t// Check if the range produced is on the correct element and is a control range\n\t\t\t\t\t\t// On IE 8 it will select the parent contentEditable container if you select an inner element see: #5398\n\t\t\t\t\t\tnativeRng = selection.getRng();\n\t\t\t\t\t\tif (nativeRng.item && ctrlElm === nativeRng.item(0)) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t// Ignore\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Set start/end point of selection\n\t\t\tsetEndPoint(true);\n\t\t\tsetEndPoint();\n\n\t\t\t// Select the new range and scroll it into view\n\t\t\tieRng.select();\n\t\t};\n\n\t\t// Expose range method\n\t\tthis.getRangeAt = getRange;\n\t}\n\n\treturn Selection;\n});\n\n// Included from: js/tinymce/classes/util/VK.js\n\n/**\n * VK.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This file exposes a set of the common KeyCodes for use. Please grow it as needed.\n */\ndefine(\"tinymce/util/VK\", [\n\t\"tinymce/Env\"\n], function(Env) {\n\treturn {\n\t\tBACKSPACE: 8,\n\t\tDELETE: 46,\n\t\tDOWN: 40,\n\t\tENTER: 13,\n\t\tLEFT: 37,\n\t\tRIGHT: 39,\n\t\tSPACEBAR: 32,\n\t\tTAB: 9,\n\t\tUP: 38,\n\n\t\tmodifierPressed: function(e) {\n\t\t\treturn e.shiftKey || e.ctrlKey || e.altKey || this.metaKeyPressed(e);\n\t\t},\n\n\t\tmetaKeyPressed: function(e) {\n\t\t\t// Check if ctrl or meta key is pressed. Edge case for AltGr on Windows where it produces ctrlKey+altKey states\n\t\t\treturn (Env.mac ? e.metaKey : e.ctrlKey && !e.altKey);\n\t\t}\n\t};\n});\n\n// Included from: js/tinymce/classes/dom/ControlSelection.js\n\n/**\n * ControlSelection.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class handles control selection of elements. Controls are elements\n * that can be resized and needs to be selected as a whole. It adds custom resize handles\n * to all browser engines that support properly disabling the built in resize logic.\n *\n * @class tinymce.dom.ControlSelection\n */\ndefine(\"tinymce/dom/ControlSelection\", [\n\t\"tinymce/util/VK\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/util/Delay\",\n\t\"tinymce/Env\",\n\t\"tinymce/dom/NodeType\"\n], function(VK, Tools, Delay, Env, NodeType) {\n\tvar isContentEditableFalse = NodeType.isContentEditableFalse;\n\tvar isContentEditableTrue = NodeType.isContentEditableTrue;\n\n\tfunction getContentEditableRoot(root, node) {\n\t\twhile (node && node != root) {\n\t\t\tif (isContentEditableTrue(node) || isContentEditableFalse(node)) {\n\t\t\t\treturn node;\n\t\t\t}\n\n\t\t\tnode = node.parentNode;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\treturn function(selection, editor) {\n\t\tvar dom = editor.dom, each = Tools.each;\n\t\tvar selectedElm, selectedElmGhost, resizeHelper, resizeHandles, selectedHandle, lastMouseDownEvent;\n\t\tvar startX, startY, selectedElmX, selectedElmY, startW, startH, ratio, resizeStarted;\n\t\tvar width, height, editableDoc = editor.getDoc(), rootDocument = document, isIE = Env.ie && Env.ie < 11;\n\t\tvar abs = Math.abs, round = Math.round, rootElement = editor.getBody(), startScrollWidth, startScrollHeight;\n\n\t\t// Details about each resize handle how to scale etc\n\t\tresizeHandles = {\n\t\t\t// Name: x multiplier, y multiplier, delta size x, delta size y\n\t\t\t/*n: [0.5, 0, 0, -1],\n\t\t\te: [1, 0.5, 1, 0],\n\t\t\ts: [0.5, 1, 0, 1],\n\t\t\tw: [0, 0.5, -1, 0],*/\n\t\t\tnw: [0, 0, -1, -1],\n\t\t\tne: [1, 0, 1, -1],\n\t\t\tse: [1, 1, 1, 1],\n\t\t\tsw: [0, 1, -1, 1]\n\t\t};\n\n\t\t// Add CSS for resize handles, cloned element and selected\n\t\tvar rootClass = '.mce-content-body';\n\t\teditor.contentStyles.push(\n\t\t\trootClass + ' div.mce-resizehandle {' +\n\t\t\t\t'position: absolute;' +\n\t\t\t\t'border: 1px solid black;' +\n\t\t\t\t'box-sizing: box-sizing;' +\n\t\t\t\t'background: #FFF;' +\n\t\t\t\t'width: 7px;' +\n\t\t\t\t'height: 7px;' +\n\t\t\t\t'z-index: 10000' +\n\t\t\t'}' +\n\t\t\trootClass + ' .mce-resizehandle:hover {' +\n\t\t\t\t'background: #000' +\n\t\t\t'}' +\n\t\t\trootClass + ' img[data-mce-selected],' + rootClass + ' hr[data-mce-selected] {' +\n\t\t\t\t'outline: 1px solid black;' +\n\t\t\t\t'resize: none' + // Have been talks about implementing this in browsers\n\t\t\t'}' +\n\t\t\trootClass + ' .mce-clonedresizable {' +\n\t\t\t\t'position: absolute;' +\n\t\t\t\t(Env.gecko ? '' : 'outline: 1px dashed black;') + // Gecko produces trails while resizing\n\t\t\t\t'opacity: .5;' +\n\t\t\t\t'filter: alpha(opacity=50);' +\n\t\t\t\t'z-index: 10000' +\n\t\t\t'}' +\n\t\t\trootClass + ' .mce-resize-helper {' +\n\t\t\t\t'background: #555;' +\n\t\t\t\t'background: rgba(0,0,0,0.75);' +\n\t\t\t\t'border-radius: 3px;' +\n\t\t\t\t'border: 1px;' +\n\t\t\t\t'color: white;' +\n\t\t\t\t'display: none;' +\n\t\t\t\t'font-family: sans-serif;' +\n\t\t\t\t'font-size: 12px;' +\n\t\t\t\t'white-space: nowrap;' +\n\t\t\t\t'line-height: 14px;' +\n\t\t\t\t'margin: 5px 10px;' +\n\t\t\t\t'padding: 5px;' +\n\t\t\t\t'position: absolute;' +\n\t\t\t\t'z-index: 10001' +\n\t\t\t'}'\n\t\t);\n\n\t\tfunction isResizable(elm) {\n\t\t\tvar selector = editor.settings.object_resizing;\n\n\t\t\tif (selector === false || Env.iOS) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (typeof selector != 'string') {\n\t\t\t\tselector = 'table,img,div';\n\t\t\t}\n\n\t\t\tif (elm.getAttribute('data-mce-resize') === 'false') {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (elm == editor.getBody()) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn editor.dom.is(elm, selector);\n\t\t}\n\n\t\tfunction resizeGhostElement(e) {\n\t\t\tvar deltaX, deltaY, proportional;\n\t\t\tvar resizeHelperX, resizeHelperY;\n\n\t\t\t// Calc new width/height\n\t\t\tdeltaX = e.screenX - startX;\n\t\t\tdeltaY = e.screenY - startY;\n\n\t\t\t// Calc new size\n\t\t\twidth = deltaX * selectedHandle[2] + startW;\n\t\t\theight = deltaY * selectedHandle[3] + startH;\n\n\t\t\t// Never scale down lower than 5 pixels\n\t\t\twidth = width < 5 ? 5 : width;\n\t\t\theight = height < 5 ? 5 : height;\n\n\t\t\tif (selectedElm.nodeName == \"IMG\" && editor.settings.resize_img_proportional !== false) {\n\t\t\t\tproportional = !VK.modifierPressed(e);\n\t\t\t} else {\n\t\t\t\tproportional = VK.modifierPressed(e) || (selectedElm.nodeName == \"IMG\" && selectedHandle[2] * selectedHandle[3] !== 0);\n\t\t\t}\n\n\t\t\t// Constrain proportions\n\t\t\tif (proportional) {\n\t\t\t\tif (abs(deltaX) > abs(deltaY)) {\n\t\t\t\t\theight = round(width * ratio);\n\t\t\t\t\twidth = round(height / ratio);\n\t\t\t\t} else {\n\t\t\t\t\twidth = round(height / ratio);\n\t\t\t\t\theight = round(width * ratio);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Update ghost size\n\t\t\tdom.setStyles(selectedElmGhost, {\n\t\t\t\twidth: width,\n\t\t\t\theight: height\n\t\t\t});\n\n\t\t\t// Update resize helper position\n\t\t\tresizeHelperX = selectedHandle.startPos.x + deltaX;\n\t\t\tresizeHelperY = selectedHandle.startPos.y + deltaY;\n\t\t\tresizeHelperX = resizeHelperX > 0 ? resizeHelperX : 0;\n\t\t\tresizeHelperY = resizeHelperY > 0 ? resizeHelperY : 0;\n\n\t\t\tdom.setStyles(resizeHelper, {\n\t\t\t\tleft: resizeHelperX,\n\t\t\t\ttop: resizeHelperY,\n\t\t\t\tdisplay: 'block'\n\t\t\t});\n\n\t\t\tresizeHelper.innerHTML = width + ' &times; ' + height;\n\n\t\t\t// Update ghost X position if needed\n\t\t\tif (selectedHandle[2] < 0 && selectedElmGhost.clientWidth <= width) {\n\t\t\t\tdom.setStyle(selectedElmGhost, 'left', selectedElmX + (startW - width));\n\t\t\t}\n\n\t\t\t// Update ghost Y position if needed\n\t\t\tif (selectedHandle[3] < 0 && selectedElmGhost.clientHeight <= height) {\n\t\t\t\tdom.setStyle(selectedElmGhost, 'top', selectedElmY + (startH - height));\n\t\t\t}\n\n\t\t\t// Calculate how must overflow we got\n\t\t\tdeltaX = rootElement.scrollWidth - startScrollWidth;\n\t\t\tdeltaY = rootElement.scrollHeight - startScrollHeight;\n\n\t\t\t// Re-position the resize helper based on the overflow\n\t\t\tif (deltaX + deltaY !== 0) {\n\t\t\t\tdom.setStyles(resizeHelper, {\n\t\t\t\t\tleft: resizeHelperX - deltaX,\n\t\t\t\t\ttop: resizeHelperY - deltaY\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (!resizeStarted) {\n\t\t\t\teditor.fire('ObjectResizeStart', {target: selectedElm, width: startW, height: startH});\n\t\t\t\tresizeStarted = true;\n\t\t\t}\n\t\t}\n\n\t\tfunction endGhostResize() {\n\t\t\tresizeStarted = false;\n\n\t\t\tfunction setSizeProp(name, value) {\n\t\t\t\tif (value) {\n\t\t\t\t\t// Resize by using style or attribute\n\t\t\t\t\tif (selectedElm.style[name] || !editor.schema.isValid(selectedElm.nodeName.toLowerCase(), name)) {\n\t\t\t\t\t\tdom.setStyle(selectedElm, name, value);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdom.setAttrib(selectedElm, name, value);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Set width/height properties\n\t\t\tsetSizeProp('width', width);\n\t\t\tsetSizeProp('height', height);\n\n\t\t\tdom.unbind(editableDoc, 'mousemove', resizeGhostElement);\n\t\t\tdom.unbind(editableDoc, 'mouseup', endGhostResize);\n\n\t\t\tif (rootDocument != editableDoc) {\n\t\t\t\tdom.unbind(rootDocument, 'mousemove', resizeGhostElement);\n\t\t\t\tdom.unbind(rootDocument, 'mouseup', endGhostResize);\n\t\t\t}\n\n\t\t\t// Remove ghost/helper and update resize handle positions\n\t\t\tdom.remove(selectedElmGhost);\n\t\t\tdom.remove(resizeHelper);\n\n\t\t\tif (!isIE || selectedElm.nodeName == \"TABLE\") {\n\t\t\t\tshowResizeRect(selectedElm);\n\t\t\t}\n\n\t\t\teditor.fire('ObjectResized', {target: selectedElm, width: width, height: height});\n\t\t\tdom.setAttrib(selectedElm, 'style', dom.getAttrib(selectedElm, 'style'));\n\t\t\teditor.nodeChanged();\n\t\t}\n\n\t\tfunction showResizeRect(targetElm, mouseDownHandleName, mouseDownEvent) {\n\t\t\tvar position, targetWidth, targetHeight, e, rect;\n\n\t\t\thideResizeRect();\n\t\t\tunbindResizeHandleEvents();\n\n\t\t\t// Get position and size of target\n\t\t\tposition = dom.getPos(targetElm, rootElement);\n\t\t\tselectedElmX = position.x;\n\t\t\tselectedElmY = position.y;\n\t\t\trect = targetElm.getBoundingClientRect(); // Fix for Gecko offsetHeight for table with caption\n\t\t\ttargetWidth = rect.width || (rect.right - rect.left);\n\t\t\ttargetHeight = rect.height || (rect.bottom - rect.top);\n\n\t\t\t// Reset width/height if user selects a new image/table\n\t\t\tif (selectedElm != targetElm) {\n\t\t\t\tdetachResizeStartListener();\n\t\t\t\tselectedElm = targetElm;\n\t\t\t\twidth = height = 0;\n\t\t\t}\n\n\t\t\t// Makes it possible to disable resizing\n\t\t\te = editor.fire('ObjectSelected', {target: targetElm});\n\n\t\t\tif (isResizable(targetElm) && !e.isDefaultPrevented()) {\n\t\t\t\teach(resizeHandles, function(handle, name) {\n\t\t\t\t\tvar handleElm;\n\n\t\t\t\t\tfunction startDrag(e) {\n\t\t\t\t\t\tstartX = e.screenX;\n\t\t\t\t\t\tstartY = e.screenY;\n\t\t\t\t\t\tstartW = selectedElm.clientWidth;\n\t\t\t\t\t\tstartH = selectedElm.clientHeight;\n\t\t\t\t\t\tratio = startH / startW;\n\t\t\t\t\t\tselectedHandle = handle;\n\n\t\t\t\t\t\thandle.startPos = {\n\t\t\t\t\t\t\tx: targetWidth * handle[0] + selectedElmX,\n\t\t\t\t\t\t\ty: targetHeight * handle[1] + selectedElmY\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tstartScrollWidth = rootElement.scrollWidth;\n\t\t\t\t\t\tstartScrollHeight = rootElement.scrollHeight;\n\n\t\t\t\t\t\tselectedElmGhost = selectedElm.cloneNode(true);\n\t\t\t\t\t\tdom.addClass(selectedElmGhost, 'mce-clonedresizable');\n\t\t\t\t\t\tdom.setAttrib(selectedElmGhost, 'data-mce-bogus', 'all');\n\t\t\t\t\t\tselectedElmGhost.contentEditable = false; // Hides IE move layer cursor\n\t\t\t\t\t\tselectedElmGhost.unSelectabe = true;\n\t\t\t\t\t\tdom.setStyles(selectedElmGhost, {\n\t\t\t\t\t\t\tleft: selectedElmX,\n\t\t\t\t\t\t\ttop: selectedElmY,\n\t\t\t\t\t\t\tmargin: 0\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tselectedElmGhost.removeAttribute('data-mce-selected');\n\t\t\t\t\t\trootElement.appendChild(selectedElmGhost);\n\n\t\t\t\t\t\tdom.bind(editableDoc, 'mousemove', resizeGhostElement);\n\t\t\t\t\t\tdom.bind(editableDoc, 'mouseup', endGhostResize);\n\n\t\t\t\t\t\tif (rootDocument != editableDoc) {\n\t\t\t\t\t\t\tdom.bind(rootDocument, 'mousemove', resizeGhostElement);\n\t\t\t\t\t\t\tdom.bind(rootDocument, 'mouseup', endGhostResize);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tresizeHelper = dom.add(rootElement, 'div', {\n\t\t\t\t\t\t\t'class': 'mce-resize-helper',\n\t\t\t\t\t\t\t'data-mce-bogus': 'all'\n\t\t\t\t\t\t}, startW + ' &times; ' + startH);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (mouseDownHandleName) {\n\t\t\t\t\t\t// Drag started by IE native resizestart\n\t\t\t\t\t\tif (name == mouseDownHandleName) {\n\t\t\t\t\t\t\tstartDrag(mouseDownEvent);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Get existing or render resize handle\n\t\t\t\t\thandleElm = dom.get('mceResizeHandle' + name);\n\t\t\t\t\tif (handleElm) {\n\t\t\t\t\t\tdom.remove(handleElm);\n\t\t\t\t\t}\n\n\t\t\t\t\thandleElm = dom.add(rootElement, 'div', {\n\t\t\t\t\t\tid: 'mceResizeHandle' + name,\n\t\t\t\t\t\t'data-mce-bogus': 'all',\n\t\t\t\t\t\t'class': 'mce-resizehandle',\n\t\t\t\t\t\tunselectable: true,\n\t\t\t\t\t\tstyle: 'cursor:' + name + '-resize; margin:0; padding:0'\n\t\t\t\t\t});\n\n\t\t\t\t\t// Hides IE move layer cursor\n\t\t\t\t\t// If we set it on Chrome we get this wounderful bug: #6725\n\t\t\t\t\tif (Env.ie) {\n\t\t\t\t\t\thandleElm.contentEditable = false;\n\t\t\t\t\t}\n\n\t\t\t\t\tdom.bind(handleElm, 'mousedown', function(e) {\n\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tstartDrag(e);\n\t\t\t\t\t});\n\n\t\t\t\t\thandle.elm = handleElm;\n\n\t\t\t\t\t// Position element\n\t\t\t\t\tdom.setStyles(handleElm, {\n\t\t\t\t\t\tleft: (targetWidth * handle[0] + selectedElmX) - (handleElm.offsetWidth / 2),\n\t\t\t\t\t\ttop: (targetHeight * handle[1] + selectedElmY) - (handleElm.offsetHeight / 2)\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\thideResizeRect();\n\t\t\t}\n\n\t\t\tselectedElm.setAttribute('data-mce-selected', '1');\n\t\t}\n\n\t\tfunction hideResizeRect() {\n\t\t\tvar name, handleElm;\n\n\t\t\tunbindResizeHandleEvents();\n\n\t\t\tif (selectedElm) {\n\t\t\t\tselectedElm.removeAttribute('data-mce-selected');\n\t\t\t}\n\n\t\t\tfor (name in resizeHandles) {\n\t\t\t\thandleElm = dom.get('mceResizeHandle' + name);\n\t\t\t\tif (handleElm) {\n\t\t\t\t\tdom.unbind(handleElm);\n\t\t\t\t\tdom.remove(handleElm);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction updateResizeRect(e) {\n\t\t\tvar startElm, controlElm;\n\n\t\t\tfunction isChildOrEqual(node, parent) {\n\t\t\t\tif (node) {\n\t\t\t\t\tdo {\n\t\t\t\t\t\tif (node === parent) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t} while ((node = node.parentNode));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Ignore all events while resizing or if the editor instance was removed\n\t\t\tif (resizeStarted || editor.removed) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Remove data-mce-selected from all elements since they might have been copied using Ctrl+c/v\n\t\t\teach(dom.select('img[data-mce-selected],hr[data-mce-selected]'), function(img) {\n\t\t\t\timg.removeAttribute('data-mce-selected');\n\t\t\t});\n\n\t\t\tcontrolElm = e.type == 'mousedown' ? e.target : selection.getNode();\n\t\t\tcontrolElm = dom.$(controlElm).closest(isIE ? 'table' : 'table,img,hr')[0];\n\n\t\t\tif (isChildOrEqual(controlElm, rootElement)) {\n\t\t\t\tdisableGeckoResize();\n\t\t\t\tstartElm = selection.getStart(true);\n\n\t\t\t\tif (isChildOrEqual(startElm, controlElm) && isChildOrEqual(selection.getEnd(true), controlElm)) {\n\t\t\t\t\tif (!isIE || (controlElm != startElm && startElm.nodeName !== 'IMG')) {\n\t\t\t\t\t\tshowResizeRect(controlElm);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\thideResizeRect();\n\t\t}\n\n\t\tfunction attachEvent(elm, name, func) {\n\t\t\tif (elm && elm.attachEvent) {\n\t\t\t\telm.attachEvent('on' + name, func);\n\t\t\t}\n\t\t}\n\n\t\tfunction detachEvent(elm, name, func) {\n\t\t\tif (elm && elm.detachEvent) {\n\t\t\t\telm.detachEvent('on' + name, func);\n\t\t\t}\n\t\t}\n\n\t\tfunction resizeNativeStart(e) {\n\t\t\tvar target = e.srcElement, pos, name, corner, cornerX, cornerY, relativeX, relativeY;\n\n\t\t\tpos = target.getBoundingClientRect();\n\t\t\trelativeX = lastMouseDownEvent.clientX - pos.left;\n\t\t\trelativeY = lastMouseDownEvent.clientY - pos.top;\n\n\t\t\t// Figure out what corner we are draging on\n\t\t\tfor (name in resizeHandles) {\n\t\t\t\tcorner = resizeHandles[name];\n\n\t\t\t\tcornerX = target.offsetWidth * corner[0];\n\t\t\t\tcornerY = target.offsetHeight * corner[1];\n\n\t\t\t\tif (abs(cornerX - relativeX) < 8 && abs(cornerY - relativeY) < 8) {\n\t\t\t\t\tselectedHandle = corner;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Remove native selection and let the magic begin\n\t\t\tresizeStarted = true;\n\t\t\teditor.fire('ObjectResizeStart', {\n\t\t\t\ttarget: selectedElm,\n\t\t\t\twidth: selectedElm.clientWidth,\n\t\t\t\theight: selectedElm.clientHeight\n\t\t\t});\n\t\t\teditor.getDoc().selection.empty();\n\t\t\tshowResizeRect(target, name, lastMouseDownEvent);\n\t\t}\n\n\t\tfunction preventDefault(e) {\n\t\t\tif (e.preventDefault) {\n\t\t\t\te.preventDefault();\n\t\t\t} else {\n\t\t\t\te.returnValue = false; // IE\n\t\t\t}\n\t\t}\n\n\t\tfunction isWithinContentEditableFalse(elm) {\n\t\t\treturn isContentEditableFalse(getContentEditableRoot(editor.getBody(), elm));\n\t\t}\n\n\t\tfunction nativeControlSelect(e) {\n\t\t\tvar target = e.srcElement;\n\n\t\t\tif (isWithinContentEditableFalse(target)) {\n\t\t\t\tpreventDefault(e);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (target != selectedElm) {\n\t\t\t\teditor.fire('ObjectSelected', {target: target});\n\t\t\t\tdetachResizeStartListener();\n\n\t\t\t\tif (target.id.indexOf('mceResizeHandle') === 0) {\n\t\t\t\t\te.returnValue = false;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (target.nodeName == 'IMG' || target.nodeName == 'TABLE') {\n\t\t\t\t\thideResizeRect();\n\t\t\t\t\tselectedElm = target;\n\t\t\t\t\tattachEvent(target, 'resizestart', resizeNativeStart);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction detachResizeStartListener() {\n\t\t\tdetachEvent(selectedElm, 'resizestart', resizeNativeStart);\n\t\t}\n\n\t\tfunction unbindResizeHandleEvents() {\n\t\t\tfor (var name in resizeHandles) {\n\t\t\t\tvar handle = resizeHandles[name];\n\n\t\t\t\tif (handle.elm) {\n\t\t\t\t\tdom.unbind(handle.elm);\n\t\t\t\t\tdelete handle.elm;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction disableGeckoResize() {\n\t\t\ttry {\n\t\t\t\t// Disable object resizing on Gecko\n\t\t\t\teditor.getDoc().execCommand('enableObjectResizing', false, false);\n\t\t\t} catch (ex) {\n\t\t\t\t// Ignore\n\t\t\t}\n\t\t}\n\n\t\tfunction controlSelect(elm) {\n\t\t\tvar ctrlRng;\n\n\t\t\tif (!isIE) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tctrlRng = editableDoc.body.createControlRange();\n\n\t\t\ttry {\n\t\t\t\tctrlRng.addElement(elm);\n\t\t\t\tctrlRng.select();\n\t\t\t\treturn true;\n\t\t\t} catch (ex) {\n\t\t\t\t// Ignore since the element can't be control selected for example a P tag\n\t\t\t}\n\t\t}\n\n\t\teditor.on('init', function() {\n\t\t\tif (isIE) {\n\t\t\t\t// Hide the resize rect on resize and reselect the image\n\t\t\t\teditor.on('ObjectResized', function(e) {\n\t\t\t\t\tif (e.target.nodeName != 'TABLE') {\n\t\t\t\t\t\thideResizeRect();\n\t\t\t\t\t\tcontrolSelect(e.target);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tattachEvent(rootElement, 'controlselect', nativeControlSelect);\n\n\t\t\t\teditor.on('mousedown', function(e) {\n\t\t\t\t\tlastMouseDownEvent = e;\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tdisableGeckoResize();\n\n\t\t\t\t// Sniff sniff, hard to feature detect this stuff\n\t\t\t\tif (Env.ie >= 11) {\n\t\t\t\t\t// Needs to be mousedown for drag/drop to work on IE 11\n\t\t\t\t\t// Needs to be click on Edge to properly select images\n\t\t\t\t\teditor.on('mousedown click', function(e) {\n\t\t\t\t\t\tvar target = e.target, nodeName = target.nodeName;\n\n\t\t\t\t\t\tif (!resizeStarted && /^(TABLE|IMG|HR)$/.test(nodeName) && !isWithinContentEditableFalse(target)) {\n\t\t\t\t\t\t\teditor.selection.select(target, nodeName == 'TABLE');\n\n\t\t\t\t\t\t\t// Only fire once since nodeChange is expensive\n\t\t\t\t\t\t\tif (e.type == 'mousedown') {\n\t\t\t\t\t\t\t\teditor.nodeChanged();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\teditor.dom.bind(rootElement, 'mscontrolselect', function(e) {\n\t\t\t\t\t\tfunction delayedSelect(node) {\n\t\t\t\t\t\t\tDelay.setEditorTimeout(editor, function() {\n\t\t\t\t\t\t\t\teditor.selection.select(node);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (isWithinContentEditableFalse(e.target)) {\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\tdelayedSelect(e.target);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (/^(TABLE|IMG|HR)$/.test(e.target.nodeName)) {\n\t\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\t\t// This moves the selection from being a control selection to a text like selection like in WebKit #6753\n\t\t\t\t\t\t\t// TODO: Fix this the day IE works like other browsers without this nasty native ugly control selections.\n\t\t\t\t\t\t\tif (e.target.tagName == 'IMG') {\n\t\t\t\t\t\t\t\tdelayedSelect(e.target);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar throttledUpdateResizeRect = Delay.throttle(function(e) {\n\t\t\t\tif (!editor.composing) {\n\t\t\t\t\tupdateResizeRect(e);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teditor.on('nodechange ResizeEditor ResizeWindow drop', throttledUpdateResizeRect);\n\n\t\t\t// Update resize rect while typing in a table\n\t\t\teditor.on('keyup compositionend', function(e) {\n\t\t\t\t// Don't update the resize rect while composing since it blows away the IME see: #2710\n\t\t\t\tif (selectedElm && selectedElm.nodeName == \"TABLE\") {\n\t\t\t\t\tthrottledUpdateResizeRect(e);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teditor.on('hide blur', hideResizeRect);\n\n\t\t\t// Hide rect on focusout since it would float on top of windows otherwise\n\t\t\t//editor.on('focusout', hideResizeRect);\n\t\t});\n\n\t\teditor.on('remove', unbindResizeHandleEvents);\n\n\t\tfunction destroy() {\n\t\t\tselectedElm = selectedElmGhost = null;\n\n\t\t\tif (isIE) {\n\t\t\t\tdetachResizeStartListener();\n\t\t\t\tdetachEvent(rootElement, 'controlselect', nativeControlSelect);\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tisResizable: isResizable,\n\t\t\tshowResizeRect: showResizeRect,\n\t\t\thideResizeRect: hideResizeRect,\n\t\t\tupdateResizeRect: updateResizeRect,\n\t\t\tcontrolSelect: controlSelect,\n\t\t\tdestroy: destroy\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/util/Fun.js\n\n/**\n * Fun.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Functional utility class.\n *\n * @private\n * @class tinymce.util.Fun\n */\ndefine(\"tinymce/util/Fun\", [], function() {\n\tvar slice = [].slice;\n\n\tfunction constant(value) {\n\t\treturn function() {\n\t\t\treturn value;\n\t\t};\n\t}\n\n\tfunction negate(predicate) {\n\t\treturn function(x) {\n\t\t\treturn !predicate(x);\n\t\t};\n\t}\n\n\tfunction compose(f, g) {\n\t\treturn function(x) {\n\t\t\treturn f(g(x));\n\t\t};\n\t}\n\n\tfunction or() {\n\t\tvar args = slice.call(arguments);\n\n\t\treturn function(x) {\n\t\t\tfor (var i = 0; i < args.length; i++) {\n\t\t\t\tif (args[i](x)) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t};\n\t}\n\n\tfunction and() {\n\t\tvar args = slice.call(arguments);\n\n\t\treturn function(x) {\n\t\t\tfor (var i = 0; i < args.length; i++) {\n\t\t\t\tif (!args[i](x)) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn true;\n\t\t};\n\t}\n\n\tfunction curry(fn) {\n\t\tvar args = slice.call(arguments);\n\n\t\tif (args.length - 1 >= fn.length) {\n\t\t\treturn fn.apply(this, args.slice(1));\n\t\t}\n\n\t\treturn function() {\n\t\t\tvar tempArgs = args.concat([].slice.call(arguments));\n\t\t\treturn curry.apply(this, tempArgs);\n\t\t};\n\t}\n\n\tfunction noop() {\n\t}\n\n\treturn {\n\t\tconstant: constant,\n\t\tnegate: negate,\n\t\tand: and,\n\t\tor: or,\n\t\tcurry: curry,\n\t\tcompose: compose,\n\t\tnoop: noop\n\t};\n});\n\n// Included from: js/tinymce/classes/caret/CaretCandidate.js\n\n/**\n * CaretCandidate.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This module contains logic for handling caret candidates. A caret candidate is\n * for example text nodes, images, input elements, cE=false elements etc.\n *\n * @private\n * @class tinymce.caret.CaretCandidate\n */\ndefine(\"tinymce/caret/CaretCandidate\", [\n\t\"tinymce/dom/NodeType\",\n\t\"tinymce/util/Arr\",\n\t\"tinymce/caret/CaretContainer\"\n], function(NodeType, Arr, CaretContainer) {\n\tvar isContentEditableTrue = NodeType.isContentEditableTrue,\n\t\tisContentEditableFalse = NodeType.isContentEditableFalse,\n\t\tisBr = NodeType.isBr,\n\t\tisText = NodeType.isText,\n\t\tisInvalidTextElement = NodeType.matchNodeNames('script style textarea'),\n\t\tisAtomicInline = NodeType.matchNodeNames('img input textarea hr iframe video audio object'),\n\t\tisTable = NodeType.matchNodeNames('table'),\n\t\tisCaretContainer = CaretContainer.isCaretContainer;\n\n\tfunction isCaretCandidate(node) {\n\t\tif (isCaretContainer(node)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (isText(node)) {\n\t\t\tif (isInvalidTextElement(node.parentNode)) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn isAtomicInline(node) || isBr(node) || isTable(node) || isContentEditableFalse(node);\n\t}\n\n\tfunction isInEditable(node, rootNode) {\n\t\tfor (node = node.parentNode; node && node != rootNode; node = node.parentNode) {\n\t\t\tif (isContentEditableFalse(node)) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (isContentEditableTrue(node)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tfunction isAtomicContentEditableFalse(node) {\n\t\tif (!isContentEditableFalse(node)) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn Arr.reduce(node.getElementsByTagName('*'), function(result, elm) {\n\t\t\treturn result || isContentEditableTrue(elm);\n\t\t}, false) !== true;\n\t}\n\n\tfunction isAtomic(node) {\n\t\treturn isAtomicInline(node) || isAtomicContentEditableFalse(node);\n\t}\n\n\tfunction isEditableCaretCandidate(node, rootNode) {\n\t\treturn isCaretCandidate(node) && isInEditable(node, rootNode);\n\t}\n\n\treturn {\n\t\tisCaretCandidate: isCaretCandidate,\n\t\tisInEditable: isInEditable,\n\t\tisAtomic: isAtomic,\n\t\tisEditableCaretCandidate: isEditableCaretCandidate\n\t};\n});\n\n// Included from: js/tinymce/classes/geom/ClientRect.js\n\n/**\n * ClientRect.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Utility functions for working with client rects.\n *\n * @private\n * @class tinymce.geom.ClientRect\n */\ndefine(\"tinymce/geom/ClientRect\", [], function() {\n\tvar round = Math.round;\n\n\tfunction clone(rect) {\n\t\tif (!rect) {\n\t\t\treturn {left: 0, top: 0, bottom: 0, right: 0, width: 0, height: 0};\n\t\t}\n\n\t\treturn {\n\t\t\tleft: round(rect.left),\n\t\t\ttop: round(rect.top),\n\t\t\tbottom: round(rect.bottom),\n\t\t\tright: round(rect.right),\n\t\t\twidth: round(rect.width),\n\t\t\theight: round(rect.height)\n\t\t};\n\t}\n\n\tfunction collapse(clientRect, toStart) {\n\t\tclientRect = clone(clientRect);\n\n\t\tif (toStart) {\n\t\t\tclientRect.right = clientRect.left;\n\t\t} else {\n\t\t\tclientRect.left = clientRect.left + clientRect.width;\n\t\t\tclientRect.right = clientRect.left;\n\t\t}\n\n\t\tclientRect.width = 0;\n\n\t\treturn clientRect;\n\t}\n\n\tfunction isEqual(rect1, rect2) {\n\t\treturn (\n\t\t\trect1.left === rect2.left &&\n\t\t\trect1.top === rect2.top &&\n\t\t\trect1.bottom === rect2.bottom &&\n\t\t\trect1.right === rect2.right\n\t\t);\n\t}\n\n\tfunction isValidOverflow(overflowY, clientRect1, clientRect2) {\n\t\treturn overflowY >= 0 && overflowY <= Math.min(clientRect1.height, clientRect2.height) / 2;\n\n\t}\n\n\tfunction isAbove(clientRect1, clientRect2) {\n\t\tif (clientRect1.bottom < clientRect2.top) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (clientRect1.top > clientRect2.bottom) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn isValidOverflow(clientRect2.top - clientRect1.bottom, clientRect1, clientRect2);\n\t}\n\n\tfunction isBelow(clientRect1, clientRect2) {\n\t\tif (clientRect1.top > clientRect2.bottom) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (clientRect1.bottom < clientRect2.top) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn isValidOverflow(clientRect2.bottom - clientRect1.top, clientRect1, clientRect2);\n\t}\n\n\tfunction isLeft(clientRect1, clientRect2) {\n\t\treturn clientRect1.left < clientRect2.left;\n\t}\n\n\tfunction isRight(clientRect1, clientRect2) {\n\t\treturn clientRect1.right > clientRect2.right;\n\t}\n\n\tfunction compare(clientRect1, clientRect2) {\n\t\tif (isAbove(clientRect1, clientRect2)) {\n\t\t\treturn -1;\n\t\t}\n\n\t\tif (isBelow(clientRect1, clientRect2)) {\n\t\t\treturn 1;\n\t\t}\n\n\t\tif (isLeft(clientRect1, clientRect2)) {\n\t\t\treturn -1;\n\t\t}\n\n\t\tif (isRight(clientRect1, clientRect2)) {\n\t\t\treturn 1;\n\t\t}\n\n\t\treturn 0;\n\t}\n\n\tfunction containsXY(clientRect, clientX, clientY) {\n\t\treturn (\n\t\t\tclientX >= clientRect.left &&\n\t\t\tclientX <= clientRect.right &&\n\t\t\tclientY >= clientRect.top &&\n\t\t\tclientY <= clientRect.bottom\n\t\t);\n\t}\n\n\treturn {\n\t\tclone: clone,\n\t\tcollapse: collapse,\n\t\tisEqual: isEqual,\n\t\tisAbove: isAbove,\n\t\tisBelow: isBelow,\n\t\tisLeft: isLeft,\n\t\tisRight: isRight,\n\t\tcompare: compare,\n\t\tcontainsXY: containsXY\n\t};\n});\n\n// Included from: js/tinymce/classes/text/ExtendingChar.js\n\n/**\n * ExtendingChar.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class contains logic for detecting extending characters.\n *\n * @private\n * @class tinymce.text.ExtendingChar\n * @example\n * var isExtending = ExtendingChar.isExtendingChar('a');\n */\ndefine(\"tinymce/text/ExtendingChar\", [], function() {\n\t// Generated from: http://www.unicode.org/Public/UNIDATA/DerivedCoreProperties.txt\n\t// Only includes the characters in that fit into UCS-2 16 bit\n\tvar extendingChars = new RegExp(\n\t\t\"[\\u0300-\\u036F\\u0483-\\u0487\\u0488-\\u0489\\u0591-\\u05BD\\u05BF\\u05C1-\\u05C2\\u05C4-\\u05C5\\u05C7\\u0610-\\u061A\" +\n\t\t\"\\u064B-\\u065F\\u0670\\u06D6-\\u06DC\\u06DF-\\u06E4\\u06E7-\\u06E8\\u06EA-\\u06ED\\u0711\\u0730-\\u074A\\u07A6-\\u07B0\" +\n\t\t\"\\u07EB-\\u07F3\\u0816-\\u0819\\u081B-\\u0823\\u0825-\\u0827\\u0829-\\u082D\\u0859-\\u085B\\u08E3-\\u0902\\u093A\\u093C\" +\n\t\t\"\\u0941-\\u0948\\u094D\\u0951-\\u0957\\u0962-\\u0963\\u0981\\u09BC\\u09BE\\u09C1-\\u09C4\\u09CD\\u09D7\\u09E2-\\u09E3\" +\n\t\t\"\\u0A01-\\u0A02\\u0A3C\\u0A41-\\u0A42\\u0A47-\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A70-\\u0A71\\u0A75\\u0A81-\\u0A82\\u0ABC\" +\n\t\t\"\\u0AC1-\\u0AC5\\u0AC7-\\u0AC8\\u0ACD\\u0AE2-\\u0AE3\\u0B01\\u0B3C\\u0B3E\\u0B3F\\u0B41-\\u0B44\\u0B4D\\u0B56\\u0B57\" +\n\t\t\"\\u0B62-\\u0B63\\u0B82\\u0BBE\\u0BC0\\u0BCD\\u0BD7\\u0C00\\u0C3E-\\u0C40\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55-\\u0C56\" +\n\t\t\"\\u0C62-\\u0C63\\u0C81\\u0CBC\\u0CBF\\u0CC2\\u0CC6\\u0CCC-\\u0CCD\\u0CD5-\\u0CD6\\u0CE2-\\u0CE3\\u0D01\\u0D3E\\u0D41-\\u0D44\" +\n\t\t\"\\u0D4D\\u0D57\\u0D62-\\u0D63\\u0DCA\\u0DCF\\u0DD2-\\u0DD4\\u0DD6\\u0DDF\\u0E31\\u0E34-\\u0E3A\\u0E47-\\u0E4E\\u0EB1\\u0EB4-\\u0EB9\" +\n\t\t\"\\u0EBB-\\u0EBC\\u0EC8-\\u0ECD\\u0F18-\\u0F19\\u0F35\\u0F37\\u0F39\\u0F71-\\u0F7E\\u0F80-\\u0F84\\u0F86-\\u0F87\\u0F8D-\\u0F97\" +\n\t\t\"\\u0F99-\\u0FBC\\u0FC6\\u102D-\\u1030\\u1032-\\u1037\\u1039-\\u103A\\u103D-\\u103E\\u1058-\\u1059\\u105E-\\u1060\\u1071-\\u1074\" +\n\t\t\"\\u1082\\u1085-\\u1086\\u108D\\u109D\\u135D-\\u135F\\u1712-\\u1714\\u1732-\\u1734\\u1752-\\u1753\\u1772-\\u1773\\u17B4-\\u17B5\" +\n\t\t\"\\u17B7-\\u17BD\\u17C6\\u17C9-\\u17D3\\u17DD\\u180B-\\u180D\\u18A9\\u1920-\\u1922\\u1927-\\u1928\\u1932\\u1939-\\u193B\\u1A17-\\u1A18\" +\n\t\t\"\\u1A1B\\u1A56\\u1A58-\\u1A5E\\u1A60\\u1A62\\u1A65-\\u1A6C\\u1A73-\\u1A7C\\u1A7F\\u1AB0-\\u1ABD\\u1ABE\\u1B00-\\u1B03\\u1B34\" +\n\t\t\"\\u1B36-\\u1B3A\\u1B3C\\u1B42\\u1B6B-\\u1B73\\u1B80-\\u1B81\\u1BA2-\\u1BA5\\u1BA8-\\u1BA9\\u1BAB-\\u1BAD\\u1BE6\\u1BE8-\\u1BE9\" +\n\t\t\"\\u1BED\\u1BEF-\\u1BF1\\u1C2C-\\u1C33\\u1C36-\\u1C37\\u1CD0-\\u1CD2\\u1CD4-\\u1CE0\\u1CE2-\\u1CE8\\u1CED\\u1CF4\\u1CF8-\\u1CF9\" +\n\t\t\"\\u1DC0-\\u1DF5\\u1DFC-\\u1DFF\\u200C-\\u200D\\u20D0-\\u20DC\\u20DD-\\u20E0\\u20E1\\u20E2-\\u20E4\\u20E5-\\u20F0\\u2CEF-\\u2CF1\" +\n\t\t\"\\u2D7F\\u2DE0-\\u2DFF\\u302A-\\u302D\\u302E-\\u302F\\u3099-\\u309A\\uA66F\\uA670-\\uA672\\uA674-\\uA67D\\uA69E-\\uA69F\\uA6F0-\\uA6F1\" +\n\t\t\"\\uA802\\uA806\\uA80B\\uA825-\\uA826\\uA8C4\\uA8E0-\\uA8F1\\uA926-\\uA92D\\uA947-\\uA951\\uA980-\\uA982\\uA9B3\\uA9B6-\\uA9B9\\uA9BC\" +\n\t\t\"\\uA9E5\\uAA29-\\uAA2E\\uAA31-\\uAA32\\uAA35-\\uAA36\\uAA43\\uAA4C\\uAA7C\\uAAB0\\uAAB2-\\uAAB4\\uAAB7-\\uAAB8\\uAABE-\\uAABF\\uAAC1\" +\n\t\t\"\\uAAEC-\\uAAED\\uAAF6\\uABE5\\uABE8\\uABED\\uFB1E\\uFE00-\\uFE0F\\uFE20-\\uFE2F\\uFF9E-\\uFF9F]\"\n\t);\n\n\tfunction isExtendingChar(ch) {\n\t\treturn typeof ch == \"string\" && ch.charCodeAt(0) >= 768 && extendingChars.test(ch);\n\t}\n\n\treturn {\n\t\tisExtendingChar: isExtendingChar\n\t};\n});\n\n// Included from: js/tinymce/classes/caret/CaretPosition.js\n\n/**\n * CaretPosition.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This module contains logic for creating caret positions within a document a caretposition\n * is similar to a DOMRange object but it doesn't have two endpoints and is also more lightweight\n * since it's now updated live when the DOM changes.\n *\n * @private\n * @class tinymce.caret.CaretPosition\n * @example\n * var caretPos1 = new CaretPosition(container, offset);\n * var caretPos2 = CaretPosition.fromRangeStart(someRange);\n */\ndefine(\"tinymce/caret/CaretPosition\", [\n\t\"tinymce/util/Fun\",\n\t\"tinymce/dom/NodeType\",\n\t\"tinymce/dom/DOMUtils\",\n\t\"tinymce/dom/RangeUtils\",\n\t\"tinymce/caret/CaretCandidate\",\n\t\"tinymce/geom/ClientRect\",\n\t\"tinymce/text/ExtendingChar\"\n], function(Fun, NodeType, DOMUtils, RangeUtils, CaretCandidate, ClientRect, ExtendingChar) {\n\tvar isElement = NodeType.isElement,\n\t\tisCaretCandidate = CaretCandidate.isCaretCandidate,\n\t\tisBlock = NodeType.matchStyleValues('display', 'block table'),\n\t\tisFloated = NodeType.matchStyleValues('float', 'left right'),\n\t\tisValidElementCaretCandidate = Fun.and(isElement, isCaretCandidate, Fun.negate(isFloated)),\n\t\tisNotPre = Fun.negate(NodeType.matchStyleValues('white-space', 'pre pre-line pre-wrap')),\n\t\tisText = NodeType.isText,\n\t\tisBr = NodeType.isBr,\n\t\tnodeIndex = DOMUtils.nodeIndex,\n\t\tresolveIndex = RangeUtils.getNode;\n\n\tfunction createRange(doc) {\n\t\treturn \"createRange\" in doc ? doc.createRange() : DOMUtils.DOM.createRng();\n\t}\n\n\tfunction isWhiteSpace(chr) {\n\t\treturn chr && /[\\r\\n\\t ]/.test(chr);\n\t}\n\n\tfunction isHiddenWhiteSpaceRange(range) {\n\t\tvar container = range.startContainer,\n\t\t\toffset = range.startOffset,\n\t\t\ttext;\n\n\t\tif (isWhiteSpace(range.toString()) && isNotPre(container.parentNode)) {\n\t\t\ttext = container.data;\n\n\t\t\tif (isWhiteSpace(text[offset - 1]) || isWhiteSpace(text[offset + 1])) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tfunction getCaretPositionClientRects(caretPosition) {\n\t\tvar clientRects = [], beforeNode, node;\n\n\t\t// Hack for older WebKit versions that doesn't\n\t\t// support getBoundingClientRect on BR elements\n\t\tfunction getBrClientRect(brNode) {\n\t\t\tvar doc = brNode.ownerDocument,\n\t\t\t\trng = createRange(doc),\n\t\t\t\tnbsp = doc.createTextNode('\\u00a0'),\n\t\t\t\tparentNode = brNode.parentNode,\n\t\t\t\tclientRect;\n\n\t\t\tparentNode.insertBefore(nbsp, brNode);\n\t\t\trng.setStart(nbsp, 0);\n\t\t\trng.setEnd(nbsp, 1);\n\t\t\tclientRect = ClientRect.clone(rng.getBoundingClientRect());\n\t\t\tparentNode.removeChild(nbsp);\n\n\t\t\treturn clientRect;\n\t\t}\n\n\t\tfunction getBoundingClientRect(item) {\n\t\t\tvar clientRect, clientRects;\n\n\t\t\tclientRects = item.getClientRects();\n\t\t\tif (clientRects.length > 0) {\n\t\t\t\tclientRect = ClientRect.clone(clientRects[0]);\n\t\t\t} else {\n\t\t\t\tclientRect = ClientRect.clone(item.getBoundingClientRect());\n\t\t\t}\n\n\t\t\tif (isBr(item) && clientRect.left === 0) {\n\t\t\t\treturn getBrClientRect(item);\n\t\t\t}\n\n\t\t\treturn clientRect;\n\t\t}\n\n\t\tfunction collapseAndInflateWidth(clientRect, toStart) {\n\t\t\tclientRect = ClientRect.collapse(clientRect, toStart);\n\t\t\tclientRect.width = 1;\n\t\t\tclientRect.right = clientRect.left + 1;\n\n\t\t\treturn clientRect;\n\t\t}\n\n\t\tfunction addUniqueAndValidRect(clientRect) {\n\t\t\tif (clientRect.height === 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (clientRects.length > 0) {\n\t\t\t\tif (ClientRect.isEqual(clientRect, clientRects[clientRects.length - 1])) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tclientRects.push(clientRect);\n\t\t}\n\n\t\tfunction addCharacterOffset(container, offset) {\n\t\t\tvar range = createRange(container.ownerDocument);\n\n\t\t\tif (offset < container.data.length) {\n\t\t\t\tif (ExtendingChar.isExtendingChar(container.data[offset])) {\n\t\t\t\t\treturn clientRects;\n\t\t\t\t}\n\n\t\t\t\t// WebKit returns two client rects for a position after an extending\n\t\t\t\t// character a\\uxxx|b so expand on \"b\" and collapse to start of \"b\" box\n\t\t\t\tif (ExtendingChar.isExtendingChar(container.data[offset - 1])) {\n\t\t\t\t\trange.setStart(container, offset);\n\t\t\t\t\trange.setEnd(container, offset + 1);\n\n\t\t\t\t\tif (!isHiddenWhiteSpaceRange(range)) {\n\t\t\t\t\t\taddUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range), false));\n\t\t\t\t\t\treturn clientRects;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (offset > 0) {\n\t\t\t\trange.setStart(container, offset - 1);\n\t\t\t\trange.setEnd(container, offset);\n\n\t\t\t\tif (!isHiddenWhiteSpaceRange(range)) {\n\t\t\t\t\taddUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range), false));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (offset < container.data.length) {\n\t\t\t\trange.setStart(container, offset);\n\t\t\t\trange.setEnd(container, offset + 1);\n\n\t\t\t\tif (!isHiddenWhiteSpaceRange(range)) {\n\t\t\t\t\taddUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range), true));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (isText(caretPosition.container())) {\n\t\t\taddCharacterOffset(caretPosition.container(), caretPosition.offset());\n\t\t\treturn clientRects;\n\t\t}\n\n\t\tif (isElement(caretPosition.container())) {\n\t\t\tif (caretPosition.isAtEnd()) {\n\t\t\t\tnode = resolveIndex(caretPosition.container(), caretPosition.offset());\n\t\t\t\tif (isText(node)) {\n\t\t\t\t\taddCharacterOffset(node, node.data.length);\n\t\t\t\t}\n\n\t\t\t\tif (isValidElementCaretCandidate(node) && !isBr(node)) {\n\t\t\t\t\taddUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node), false));\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tnode = resolveIndex(caretPosition.container(), caretPosition.offset());\n\t\t\t\tif (isText(node)) {\n\t\t\t\t\taddCharacterOffset(node, 0);\n\t\t\t\t}\n\n\t\t\t\tif (isValidElementCaretCandidate(node) && caretPosition.isAtEnd()) {\n\t\t\t\t\taddUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node), false));\n\t\t\t\t\treturn clientRects;\n\t\t\t\t}\n\n\t\t\t\tbeforeNode = resolveIndex(caretPosition.container(), caretPosition.offset() - 1);\n\t\t\t\tif (isValidElementCaretCandidate(beforeNode) && !isBr(beforeNode)) {\n\t\t\t\t\tif (isBlock(beforeNode) || isBlock(node) || !isValidElementCaretCandidate(node)) {\n\t\t\t\t\t\taddUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(beforeNode), false));\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (isValidElementCaretCandidate(node)) {\n\t\t\t\t\taddUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node), true));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn clientRects;\n\t}\n\n\t/**\n\t * Represents a location within the document by a container and an offset.\n\t *\n\t * @constructor\n\t * @param {Node} container Container node.\n\t * @param {Number} offset Offset within that container node.\n\t * @param {Array} clientRects Optional client rects array for the position.\n\t */\n\tfunction CaretPosition(container, offset, clientRects) {\n\t\tfunction isAtStart() {\n\t\t\tif (isText(container)) {\n\t\t\t\treturn offset === 0;\n\t\t\t}\n\n\t\t\treturn offset === 0;\n\t\t}\n\n\t\tfunction isAtEnd() {\n\t\t\tif (isText(container)) {\n\t\t\t\treturn offset >= container.data.length;\n\t\t\t}\n\n\t\t\treturn offset >= container.childNodes.length;\n\t\t}\n\n\t\tfunction toRange() {\n\t\t\tvar range;\n\n\t\t\trange = createRange(container.ownerDocument);\n\t\t\trange.setStart(container, offset);\n\t\t\trange.setEnd(container, offset);\n\n\t\t\treturn range;\n\t\t}\n\n\t\tfunction getClientRects() {\n\t\t\tif (!clientRects) {\n\t\t\t\tclientRects = getCaretPositionClientRects(new CaretPosition(container, offset));\n\t\t\t}\n\n\t\t\treturn clientRects;\n\t\t}\n\n\t\tfunction isVisible() {\n\t\t\treturn getClientRects().length > 0;\n\t\t}\n\n\t\tfunction isEqual(caretPosition) {\n\t\t\treturn caretPosition && container === caretPosition.container() && offset === caretPosition.offset();\n\t\t}\n\n\t\tfunction getNode(before) {\n\t\t\treturn resolveIndex(container, before ? offset - 1 : offset);\n\t\t}\n\n\t\treturn {\n\t\t\t/**\n\t\t\t * Returns the container node.\n\t\t\t *\n\t\t\t * @method container\n\t\t\t * @return {Node} Container node.\n\t\t\t */\n\t\t\tcontainer: Fun.constant(container),\n\n\t\t\t/**\n\t\t\t * Returns the offset within the container node.\n\t\t\t *\n\t\t\t * @method offset\n\t\t\t * @return {Number} Offset within the container node.\n\t\t\t */\n\t\t\toffset: Fun.constant(offset),\n\n\t\t\t/**\n\t\t\t * Returns a range out of a the caret position.\n\t\t\t *\n\t\t\t * @method toRange\n\t\t\t * @return {DOMRange} range for the caret position.\n\t\t\t */\n\t\t\ttoRange: toRange,\n\n\t\t\t/**\n\t\t\t * Returns the client rects for the caret position. Might be multiple rects between\n\t\t\t * block elements.\n\t\t\t *\n\t\t\t * @method getClientRects\n\t\t\t * @return {Array} Array of client rects.\n\t\t\t */\n\t\t\tgetClientRects: getClientRects,\n\n\t\t\t/**\n\t\t\t * Returns true if the caret location is visible/displayed on screen.\n\t\t\t *\n\t\t\t * @method isVisible\n\t\t\t * @return {Boolean} true/false if the position is visible or not.\n\t\t\t */\n\t\t\tisVisible: isVisible,\n\n\t\t\t/**\n\t\t\t * Returns true if the caret location is at the beginning of text node or container.\n\t\t\t *\n\t\t\t * @method isVisible\n\t\t\t * @return {Boolean} true/false if the position is at the beginning.\n\t\t\t */\n\t\t\tisAtStart: isAtStart,\n\n\t\t\t/**\n\t\t\t * Returns true if the caret location is at the end of text node or container.\n\t\t\t *\n\t\t\t * @method isVisible\n\t\t\t * @return {Boolean} true/false if the position is at the end.\n\t\t\t */\n\t\t\tisAtEnd: isAtEnd,\n\n\t\t\t/**\n\t\t\t * Compares the caret position to another caret position. This will only compare the\n\t\t\t * container and offset not it's visual position.\n\t\t\t *\n\t\t\t * @method isEqual\n\t\t\t * @param {tinymce.caret.CaretPosition} caretPosition Caret position to compare with.\n\t\t\t * @return {Boolean} true if the caret positions are equal.\n\t\t\t */\n\t\t\tisEqual: isEqual,\n\n\t\t\t/**\n\t\t\t * Returns the closest resolved node from a node index. That means if you have an offset after the\n\t\t\t * last node in a container it will return that last node.\n\t\t\t *\n\t\t\t * @method getNode\n\t\t\t * @return {Node} Node that is closest to the index.\n\t\t\t */\n\t\t\tgetNode: getNode\n\t\t};\n\t}\n\n\t/**\n\t * Creates a caret position from the start of a range.\n\t *\n\t * @method fromRangeStart\n\t * @param {DOMRange} range DOM Range to create caret position from.\n\t * @return {tinymce.caret.CaretPosition} Caret position from the start of DOM range.\n\t */\n\tCaretPosition.fromRangeStart = function(range) {\n\t\treturn new CaretPosition(range.startContainer, range.startOffset);\n\t};\n\n\t/**\n\t * Creates a caret position from the end of a range.\n\t *\n\t * @method fromRangeEnd\n\t * @param {DOMRange} range DOM Range to create caret position from.\n\t * @return {tinymce.caret.CaretPosition} Caret position from the end of DOM range.\n\t */\n\tCaretPosition.fromRangeEnd = function(range) {\n\t\treturn new CaretPosition(range.endContainer, range.endOffset);\n\t};\n\n\t/**\n\t * Creates a caret position from a node and places the offset after it.\n\t *\n\t * @method after\n\t * @param {Node} node Node to get caret position from.\n\t * @return {tinymce.caret.CaretPosition} Caret position from the node.\n\t */\n\tCaretPosition.after = function(node) {\n\t\treturn new CaretPosition(node.parentNode, nodeIndex(node) + 1);\n\t};\n\n\t/**\n\t * Creates a caret position from a node and places the offset before it.\n\t *\n\t * @method before\n\t * @param {Node} node Node to get caret position from.\n\t * @return {tinymce.caret.CaretPosition} Caret position from the node.\n\t */\n\tCaretPosition.before = function(node) {\n\t\treturn new CaretPosition(node.parentNode, nodeIndex(node));\n\t};\n\n\treturn CaretPosition;\n});\n\n// Included from: js/tinymce/classes/caret/CaretBookmark.js\n\n/**\n * CaretBookmark.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This module creates or resolves xpath like string representation of a CaretPositions.\n *\n * The format is a / separated list of chunks with:\n * <element|text()>[index|after|before]\n *\n * For example:\n *  p[0]/b[0]/text()[0],1 = <p><b>a|c</b></p>\n *  p[0]/img[0],before = <p>|<img></p>\n *  p[0]/img[0],after = <p><img>|</p>\n *\n * @private\n * @static\n * @class tinymce.caret.CaretBookmark\n * @example\n * var bookmark = CaretBookmark.create(rootElm, CaretPosition.before(rootElm.firstChild));\n * var caretPosition = CaretBookmark.resolve(bookmark);\n */\ndefine('tinymce/caret/CaretBookmark', [\n\t'tinymce/dom/NodeType',\n\t'tinymce/dom/DOMUtils',\n\t'tinymce/util/Fun',\n\t'tinymce/util/Arr',\n\t'tinymce/caret/CaretPosition'\n], function(NodeType, DomUtils, Fun, Arr, CaretPosition) {\n\tvar isText = NodeType.isText,\n\t\tisBogus = NodeType.isBogus,\n\t\tnodeIndex = DomUtils.nodeIndex;\n\n\tfunction normalizedParent(node) {\n\t\tvar parentNode = node.parentNode;\n\n\t\tif (isBogus(parentNode)) {\n\t\t\treturn normalizedParent(parentNode);\n\t\t}\n\n\t\treturn parentNode;\n\t}\n\n\tfunction getChildNodes(node) {\n\t\tif (!node) {\n\t\t\treturn [];\n\t\t}\n\n\t\treturn Arr.reduce(node.childNodes, function(result, node) {\n\t\t\tif (isBogus(node) && node.nodeName != 'BR') {\n\t\t\t\tresult = result.concat(getChildNodes(node));\n\t\t\t} else {\n\t\t\t\tresult.push(node);\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}, []);\n\t}\n\n\tfunction normalizedTextOffset(textNode, offset) {\n\t\twhile ((textNode = textNode.previousSibling)) {\n\t\t\tif (!isText(textNode)) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\toffset += textNode.data.length;\n\t\t}\n\n\t\treturn offset;\n\t}\n\n\tfunction equal(targetValue) {\n\t\treturn function(value) {\n\t\t\treturn targetValue === value;\n\t\t};\n\t}\n\n\tfunction normalizedNodeIndex(node) {\n\t\tvar nodes, index, numTextFragments;\n\n\t\tnodes = getChildNodes(normalizedParent(node));\n\t\tindex = Arr.findIndex(nodes, equal(node), node);\n\t\tnodes = nodes.slice(0, index + 1);\n\t\tnumTextFragments = Arr.reduce(nodes, function(result, node, i) {\n\t\t\tif (isText(node) && isText(nodes[i - 1])) {\n\t\t\t\tresult++;\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}, 0);\n\n\t\tnodes = Arr.filter(nodes, NodeType.matchNodeNames(node.nodeName));\n\t\tindex = Arr.findIndex(nodes, equal(node), node);\n\n\t\treturn index - numTextFragments;\n\t}\n\n\tfunction createPathItem(node) {\n\t\tvar name;\n\n\t\tif (isText(node)) {\n\t\t\tname = 'text()';\n\t\t} else {\n\t\t\tname = node.nodeName.toLowerCase();\n\t\t}\n\n\t\treturn name + '[' + normalizedNodeIndex(node) + ']';\n\t}\n\n\tfunction parentsUntil(rootNode, node, predicate) {\n\t\tvar parents = [];\n\n\t\tfor (node = node.parentNode; node != rootNode; node = node.parentNode) {\n\t\t\tif (predicate && predicate(node)) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tparents.push(node);\n\t\t}\n\n\t\treturn parents;\n\t}\n\n\tfunction create(rootNode, caretPosition) {\n\t\tvar container, offset, path = [],\n\t\t\toutputOffset, childNodes, parents;\n\n\t\tcontainer = caretPosition.container();\n\t\toffset = caretPosition.offset();\n\n\t\tif (isText(container)) {\n\t\t\toutputOffset = normalizedTextOffset(container, offset);\n\t\t} else {\n\t\t\tchildNodes = container.childNodes;\n\t\t\tif (offset >= childNodes.length) {\n\t\t\t\toutputOffset = 'after';\n\t\t\t\toffset = childNodes.length - 1;\n\t\t\t} else {\n\t\t\t\toutputOffset = 'before';\n\t\t\t}\n\n\t\t\tcontainer = childNodes[offset];\n\t\t}\n\n\t\tpath.push(createPathItem(container));\n\t\tparents = parentsUntil(rootNode, container);\n\t\tparents = Arr.filter(parents, Fun.negate(NodeType.isBogus));\n\t\tpath = path.concat(Arr.map(parents, function(node) {\n\t\t\treturn createPathItem(node);\n\t\t}));\n\n\t\treturn path.reverse().join('/') + ',' + outputOffset;\n\t}\n\n\tfunction resolvePathItem(node, name, index) {\n\t\tvar nodes = getChildNodes(node);\n\n\t\tnodes = Arr.filter(nodes, function(node, index) {\n\t\t\treturn !isText(node) || !isText(nodes[index - 1]);\n\t\t});\n\n\t\tnodes = Arr.filter(nodes, NodeType.matchNodeNames(name));\n\t\treturn nodes[index];\n\t}\n\n\tfunction findTextPosition(container, offset) {\n\t\tvar node = container, targetOffset = 0, dataLen;\n\n\t\twhile (isText(node)) {\n\t\t\tdataLen = node.data.length;\n\n\t\t\tif (offset >= targetOffset && offset <= targetOffset + dataLen) {\n\t\t\t\tcontainer = node;\n\t\t\t\toffset = offset - targetOffset;\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (!isText(node.nextSibling)) {\n\t\t\t\tcontainer = node;\n\t\t\t\toffset = dataLen;\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\ttargetOffset += dataLen;\n\t\t\tnode = node.nextSibling;\n\t\t}\n\n\t\tif (offset > container.data.length) {\n\t\t\toffset = container.data.length;\n\t\t}\n\n\t\treturn new CaretPosition(container, offset);\n\t}\n\n\tfunction resolve(rootNode, path) {\n\t\tvar parts, container, offset;\n\n\t\tif (!path) {\n\t\t\treturn null;\n\t\t}\n\n\t\tparts = path.split(',');\n\t\tpath = parts[0].split('/');\n\t\toffset = parts.length > 1 ? parts[1] : 'before';\n\n\t\tcontainer = Arr.reduce(path, function(result, value) {\n\t\t\tvalue = /([\\w\\-\\(\\)]+)\\[([0-9]+)\\]/.exec(value);\n\t\t\tif (!value) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (value[1] === 'text()') {\n\t\t\t\tvalue[1] = '#text';\n\t\t\t}\n\n\t\t\treturn resolvePathItem(result, value[1], parseInt(value[2], 10));\n\t\t}, rootNode);\n\n\t\tif (!container) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif (!isText(container)) {\n\t\t\tif (offset === 'after') {\n\t\t\t\toffset = nodeIndex(container) + 1;\n\t\t\t} else {\n\t\t\t\toffset = nodeIndex(container);\n\t\t\t}\n\n\t\t\treturn new CaretPosition(container.parentNode, offset);\n\t\t}\n\n\t\treturn findTextPosition(container, parseInt(offset, 10));\n\t}\n\n\treturn {\n\t\t/**\n\t\t * Create a xpath bookmark location for the specified caret position.\n\t\t *\n\t\t * @method create\n\t\t * @param {Node} rootNode Root node to create bookmark within.\n\t\t * @param {tinymce.caret.CaretPosition} caretPosition Caret position within the root node.\n\t\t * @return {String} String xpath like location of caret position.\n\t\t */\n\t\tcreate: create,\n\n\t\t/**\n\t\t * Resolves a xpath like bookmark location to the a caret position.\n\t\t *\n\t\t * @method resolve\n\t\t * @param {Node} rootNode Root node to resolve xpath bookmark within.\n\t\t * @param {String} bookmark Bookmark string to resolve.\n\t\t * @return {tinymce.caret.CaretPosition} Caret position resolved from xpath like bookmark.\n\t\t */\n\t\tresolve: resolve\n\t};\n});\n\n// Included from: js/tinymce/classes/dom/BookmarkManager.js\n\n/**\n * BookmarkManager.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class handles selection bookmarks.\n *\n * @class tinymce.dom.BookmarkManager\n */\ndefine(\"tinymce/dom/BookmarkManager\", [\n\t\"tinymce/Env\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/caret/CaretContainer\",\n\t\"tinymce/caret/CaretBookmark\",\n\t\"tinymce/caret/CaretPosition\",\n\t\"tinymce/dom/NodeType\",\n\t\"tinymce/dom/RangeUtils\"\n], function(Env, Tools, CaretContainer, CaretBookmark, CaretPosition, NodeType, RangeUtils) {\n\tvar isContentEditableFalse = NodeType.isContentEditableFalse;\n\n\t/**\n\t * Constructs a new BookmarkManager instance for a specific selection instance.\n\t *\n\t * @constructor\n\t * @method BookmarkManager\n\t * @param {tinymce.dom.Selection} selection Selection instance to handle bookmarks for.\n\t */\n\tfunction BookmarkManager(selection) {\n\t\tvar dom = selection.dom;\n\n\t\t/**\n\t\t * Returns a bookmark location for the current selection. This bookmark object\n\t\t * can then be used to restore the selection after some content modification to the document.\n\t\t *\n\t\t * @method getBookmark\n\t\t * @param {Number} type Optional state if the bookmark should be simple or not. Default is complex.\n\t\t * @param {Boolean} normalized Optional state that enables you to get a position that it would be after normalization.\n\t\t * @return {Object} Bookmark object, use moveToBookmark with this object to restore the selection.\n\t\t * @example\n\t\t * // Stores a bookmark of the current selection\n\t\t * var bm = tinymce.activeEditor.selection.getBookmark();\n\t\t *\n\t\t * tinymce.activeEditor.setContent(tinymce.activeEditor.getContent() + 'Some new content');\n\t\t *\n\t\t * // Restore the selection bookmark\n\t\t * tinymce.activeEditor.selection.moveToBookmark(bm);\n\t\t */\n\t\tthis.getBookmark = function(type, normalized) {\n\t\t\tvar rng, rng2, id, collapsed, name, element, chr = '&#xFEFF;', styles;\n\n\t\t\tfunction findIndex(name, element) {\n\t\t\t\tvar count = 0;\n\n\t\t\t\tTools.each(dom.select(name), function(node) {\n\t\t\t\t\tif (node.getAttribute('data-mce-bogus') === 'all') {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (node == element) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tcount++;\n\t\t\t\t});\n\n\t\t\t\treturn count;\n\t\t\t}\n\n\t\t\tfunction normalizeTableCellSelection(rng) {\n\t\t\t\tfunction moveEndPoint(start) {\n\t\t\t\t\tvar container, offset, childNodes, prefix = start ? 'start' : 'end';\n\n\t\t\t\t\tcontainer = rng[prefix + 'Container'];\n\t\t\t\t\toffset = rng[prefix + 'Offset'];\n\n\t\t\t\t\tif (container.nodeType == 1 && container.nodeName == \"TR\") {\n\t\t\t\t\t\tchildNodes = container.childNodes;\n\t\t\t\t\t\tcontainer = childNodes[Math.min(start ? offset : offset - 1, childNodes.length - 1)];\n\t\t\t\t\t\tif (container) {\n\t\t\t\t\t\t\toffset = start ? 0 : container.childNodes.length;\n\t\t\t\t\t\t\trng['set' + (start ? 'Start' : 'End')](container, offset);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tmoveEndPoint(true);\n\t\t\t\tmoveEndPoint();\n\n\t\t\t\treturn rng;\n\t\t\t}\n\n\t\t\tfunction getLocation(rng) {\n\t\t\t\tvar root = dom.getRoot(), bookmark = {};\n\n\t\t\t\tfunction getPoint(rng, start) {\n\t\t\t\t\tvar container = rng[start ? 'startContainer' : 'endContainer'],\n\t\t\t\t\t\toffset = rng[start ? 'startOffset' : 'endOffset'], point = [], node, childNodes, after = 0;\n\n\t\t\t\t\tif (container.nodeType == 3) {\n\t\t\t\t\t\tif (normalized) {\n\t\t\t\t\t\t\tfor (node = container.previousSibling; node && node.nodeType == 3; node = node.previousSibling) {\n\t\t\t\t\t\t\t\toffset += node.nodeValue.length;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tpoint.push(offset);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tchildNodes = container.childNodes;\n\n\t\t\t\t\t\tif (offset >= childNodes.length && childNodes.length) {\n\t\t\t\t\t\t\tafter = 1;\n\t\t\t\t\t\t\toffset = Math.max(0, childNodes.length - 1);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tpoint.push(dom.nodeIndex(childNodes[offset], normalized) + after);\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (; container && container != root; container = container.parentNode) {\n\t\t\t\t\t\tpoint.push(dom.nodeIndex(container, normalized));\n\t\t\t\t\t}\n\n\t\t\t\t\treturn point;\n\t\t\t\t}\n\n\t\t\t\tbookmark.start = getPoint(rng, true);\n\n\t\t\t\tif (!selection.isCollapsed()) {\n\t\t\t\t\tbookmark.end = getPoint(rng);\n\t\t\t\t}\n\n\t\t\t\treturn bookmark;\n\t\t\t}\n\n\t\t\tfunction findAdjacentContentEditableFalseElm(rng) {\n\t\t\t\tfunction findSibling(node, offset) {\n\t\t\t\t\tvar sibling;\n\n\t\t\t\t\tif (NodeType.isElement(node)) {\n\t\t\t\t\t\tnode = RangeUtils.getNode(node, offset);\n\t\t\t\t\t\tif (isContentEditableFalse(node)) {\n\t\t\t\t\t\t\treturn node;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (CaretContainer.isCaretContainer(node)) {\n\t\t\t\t\t\tif (NodeType.isText(node) && CaretContainer.isCaretContainerBlock(node)) {\n\t\t\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tsibling = node.previousSibling;\n\t\t\t\t\t\tif (isContentEditableFalse(sibling)) {\n\t\t\t\t\t\t\treturn sibling;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tsibling = node.nextSibling;\n\t\t\t\t\t\tif (isContentEditableFalse(sibling)) {\n\t\t\t\t\t\t\treturn sibling;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn findSibling(rng.startContainer, rng.startOffset) || findSibling(rng.endContainer, rng.endOffset);\n\t\t\t}\n\n\t\t\tif (type == 2) {\n\t\t\t\telement = selection.getNode();\n\t\t\t\tname = element ? element.nodeName : null;\n\t\t\t\trng = selection.getRng();\n\n\t\t\t\tif (isContentEditableFalse(element) || name == 'IMG') {\n\t\t\t\t\treturn {name: name, index: findIndex(name, element)};\n\t\t\t\t}\n\n\t\t\t\tif (selection.tridentSel) {\n\t\t\t\t\treturn selection.tridentSel.getBookmark(type);\n\t\t\t\t}\n\n\t\t\t\telement = findAdjacentContentEditableFalseElm(rng);\n\t\t\t\tif (element) {\n\t\t\t\t\tname = element.tagName;\n\t\t\t\t\treturn {name: name, index: findIndex(name, element)};\n\t\t\t\t}\n\n\t\t\t\treturn getLocation(rng);\n\t\t\t}\n\n\t\t\tif (type == 3) {\n\t\t\t\trng = selection.getRng();\n\n\t\t\t\treturn {\n\t\t\t\t\tstart: CaretBookmark.create(dom.getRoot(), CaretPosition.fromRangeStart(rng)),\n\t\t\t\t\tend: CaretBookmark.create(dom.getRoot(), CaretPosition.fromRangeEnd(rng))\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t// Handle simple range\n\t\t\tif (type) {\n\t\t\t\treturn {rng: selection.getRng()};\n\t\t\t}\n\n\t\t\trng = selection.getRng();\n\t\t\tid = dom.uniqueId();\n\t\t\tcollapsed = selection.isCollapsed();\n\t\t\tstyles = 'overflow:hidden;line-height:0px';\n\n\t\t\t// Explorer method\n\t\t\tif (rng.duplicate || rng.item) {\n\t\t\t\t// Text selection\n\t\t\t\tif (!rng.item) {\n\t\t\t\t\trng2 = rng.duplicate();\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// Insert start marker\n\t\t\t\t\t\trng.collapse();\n\t\t\t\t\t\trng.pasteHTML('<span data-mce-type=\"bookmark\" id=\"' + id + '_start\" style=\"' + styles + '\">' + chr + '</span>');\n\n\t\t\t\t\t\t// Insert end marker\n\t\t\t\t\t\tif (!collapsed) {\n\t\t\t\t\t\t\trng2.collapse(false);\n\n\t\t\t\t\t\t\t// Detect the empty space after block elements in IE and move the\n\t\t\t\t\t\t\t// end back one character <p></p>] becomes <p>]</p>\n\t\t\t\t\t\t\trng.moveToElementText(rng2.parentElement());\n\t\t\t\t\t\t\tif (rng.compareEndPoints('StartToEnd', rng2) === 0) {\n\t\t\t\t\t\t\t\trng2.move('character', -1);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\trng2.pasteHTML('<span data-mce-type=\"bookmark\" id=\"' + id + '_end\" style=\"' + styles + '\">' + chr + '</span>');\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t// IE might throw unspecified error so lets ignore it\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// Control selection\n\t\t\t\t\telement = rng.item(0);\n\t\t\t\t\tname = element.nodeName;\n\n\t\t\t\t\treturn {name: name, index: findIndex(name, element)};\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\telement = selection.getNode();\n\t\t\t\tname = element.nodeName;\n\t\t\t\tif (name == 'IMG') {\n\t\t\t\t\treturn {name: name, index: findIndex(name, element)};\n\t\t\t\t}\n\n\t\t\t\t// W3C method\n\t\t\t\trng2 = normalizeTableCellSelection(rng.cloneRange());\n\n\t\t\t\t// Insert end marker\n\t\t\t\tif (!collapsed) {\n\t\t\t\t\trng2.collapse(false);\n\t\t\t\t\trng2.insertNode(dom.create('span', {'data-mce-type': \"bookmark\", id: id + '_end', style: styles}, chr));\n\t\t\t\t}\n\n\t\t\t\trng = normalizeTableCellSelection(rng);\n\t\t\t\trng.collapse(true);\n\t\t\t\trng.insertNode(dom.create('span', {'data-mce-type': \"bookmark\", id: id + '_start', style: styles}, chr));\n\t\t\t}\n\n\t\t\tselection.moveToBookmark({id: id, keep: 1});\n\n\t\t\treturn {id: id};\n\t\t};\n\n\t\t/**\n\t\t * Restores the selection to the specified bookmark.\n\t\t *\n\t\t * @method moveToBookmark\n\t\t * @param {Object} bookmark Bookmark to restore selection from.\n\t\t * @return {Boolean} true/false if it was successful or not.\n\t\t * @example\n\t\t * // Stores a bookmark of the current selection\n\t\t * var bm = tinymce.activeEditor.selection.getBookmark();\n\t\t *\n\t\t * tinymce.activeEditor.setContent(tinymce.activeEditor.getContent() + 'Some new content');\n\t\t *\n\t\t * // Restore the selection bookmark\n\t\t * tinymce.activeEditor.selection.moveToBookmark(bm);\n\t\t */\n\t\tthis.moveToBookmark = function(bookmark) {\n\t\t\tvar rng, root, startContainer, endContainer, startOffset, endOffset;\n\n\t\t\tfunction setEndPoint(start) {\n\t\t\t\tvar point = bookmark[start ? 'start' : 'end'], i, node, offset, children;\n\n\t\t\t\tif (point) {\n\t\t\t\t\toffset = point[0];\n\n\t\t\t\t\t// Find container node\n\t\t\t\t\tfor (node = root, i = point.length - 1; i >= 1; i--) {\n\t\t\t\t\t\tchildren = node.childNodes;\n\n\t\t\t\t\t\tif (point[i] > children.length - 1) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnode = children[point[i]];\n\t\t\t\t\t}\n\n\t\t\t\t\t// Move text offset to best suitable location\n\t\t\t\t\tif (node.nodeType === 3) {\n\t\t\t\t\t\toffset = Math.min(point[0], node.nodeValue.length);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Move element offset to best suitable location\n\t\t\t\t\tif (node.nodeType === 1) {\n\t\t\t\t\t\toffset = Math.min(point[0], node.childNodes.length);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Set offset within container node\n\t\t\t\t\tif (start) {\n\t\t\t\t\t\trng.setStart(node, offset);\n\t\t\t\t\t} else {\n\t\t\t\t\t\trng.setEnd(node, offset);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tfunction restoreEndPoint(suffix) {\n\t\t\t\tvar marker = dom.get(bookmark.id + '_' + suffix), node, idx, next, prev, keep = bookmark.keep;\n\n\t\t\t\tif (marker) {\n\t\t\t\t\tnode = marker.parentNode;\n\n\t\t\t\t\tif (suffix == 'start') {\n\t\t\t\t\t\tif (!keep) {\n\t\t\t\t\t\t\tidx = dom.nodeIndex(marker);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tnode = marker.firstChild;\n\t\t\t\t\t\t\tidx = 1;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tstartContainer = endContainer = node;\n\t\t\t\t\t\tstartOffset = endOffset = idx;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (!keep) {\n\t\t\t\t\t\t\tidx = dom.nodeIndex(marker);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tnode = marker.firstChild;\n\t\t\t\t\t\t\tidx = 1;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tendContainer = node;\n\t\t\t\t\t\tendOffset = idx;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!keep) {\n\t\t\t\t\t\tprev = marker.previousSibling;\n\t\t\t\t\t\tnext = marker.nextSibling;\n\n\t\t\t\t\t\t// Remove all marker text nodes\n\t\t\t\t\t\tTools.each(Tools.grep(marker.childNodes), function(node) {\n\t\t\t\t\t\t\tif (node.nodeType == 3) {\n\t\t\t\t\t\t\t\tnode.nodeValue = node.nodeValue.replace(/\\uFEFF/g, '');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// Remove marker but keep children if for example contents where inserted into the marker\n\t\t\t\t\t\t// Also remove duplicated instances of the marker for example by a\n\t\t\t\t\t\t// split operation or by WebKit auto split on paste feature\n\t\t\t\t\t\twhile ((marker = dom.get(bookmark.id + '_' + suffix))) {\n\t\t\t\t\t\t\tdom.remove(marker, 1);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// If siblings are text nodes then merge them unless it's Opera since it some how removes the node\n\t\t\t\t\t\t// and we are sniffing since adding a lot of detection code for a browser with 3% of the market\n\t\t\t\t\t\t// isn't worth the effort. Sorry, Opera but it's just a fact\n\t\t\t\t\t\tif (prev && next && prev.nodeType == next.nodeType && prev.nodeType == 3 && !Env.opera) {\n\t\t\t\t\t\t\tidx = prev.nodeValue.length;\n\t\t\t\t\t\t\tprev.appendData(next.nodeValue);\n\t\t\t\t\t\t\tdom.remove(next);\n\n\t\t\t\t\t\t\tif (suffix == 'start') {\n\t\t\t\t\t\t\t\tstartContainer = endContainer = prev;\n\t\t\t\t\t\t\t\tstartOffset = endOffset = idx;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tendContainer = prev;\n\t\t\t\t\t\t\t\tendOffset = idx;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction addBogus(node) {\n\t\t\t\t// Adds a bogus BR element for empty block elements\n\t\t\t\tif (dom.isBlock(node) && !node.innerHTML && !Env.ie) {\n\t\t\t\t\tnode.innerHTML = '<br data-mce-bogus=\"1\" />';\n\t\t\t\t}\n\n\t\t\t\treturn node;\n\t\t\t}\n\n\t\t\tfunction resolveCaretPositionBookmark() {\n\t\t\t\tvar rng, pos;\n\n\t\t\t\trng = dom.createRng();\n\t\t\t\tpos = CaretBookmark.resolve(dom.getRoot(), bookmark.start);\n\t\t\t\trng.setStart(pos.container(), pos.offset());\n\n\t\t\t\tpos = CaretBookmark.resolve(dom.getRoot(), bookmark.end);\n\t\t\t\trng.setEnd(pos.container(), pos.offset());\n\n\t\t\t\treturn rng;\n\t\t\t}\n\n\t\t\tif (bookmark) {\n\t\t\t\tif (Tools.isArray(bookmark.start)) {\n\t\t\t\t\trng = dom.createRng();\n\t\t\t\t\troot = dom.getRoot();\n\n\t\t\t\t\tif (selection.tridentSel) {\n\t\t\t\t\t\treturn selection.tridentSel.moveToBookmark(bookmark);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (setEndPoint(true) && setEndPoint()) {\n\t\t\t\t\t\tselection.setRng(rng);\n\t\t\t\t\t}\n\t\t\t\t} else if (typeof bookmark.start == 'string') {\n\t\t\t\t\tselection.setRng(resolveCaretPositionBookmark(bookmark));\n\t\t\t\t} else if (bookmark.id) {\n\t\t\t\t\t// Restore start/end points\n\t\t\t\t\trestoreEndPoint('start');\n\t\t\t\t\trestoreEndPoint('end');\n\n\t\t\t\t\tif (startContainer) {\n\t\t\t\t\t\trng = dom.createRng();\n\t\t\t\t\t\trng.setStart(addBogus(startContainer), startOffset);\n\t\t\t\t\t\trng.setEnd(addBogus(endContainer), endOffset);\n\t\t\t\t\t\tselection.setRng(rng);\n\t\t\t\t\t}\n\t\t\t\t} else if (bookmark.name) {\n\t\t\t\t\tselection.select(dom.select(bookmark.name)[bookmark.index]);\n\t\t\t\t} else if (bookmark.rng) {\n\t\t\t\t\tselection.setRng(bookmark.rng);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\t/**\n\t * Returns true/false if the specified node is a bookmark node or not.\n\t *\n\t * @static\n\t * @method isBookmarkNode\n\t * @param {DOMNode} node DOM Node to check if it's a bookmark node or not.\n\t * @return {Boolean} true/false if the node is a bookmark node or not.\n\t */\n\tBookmarkManager.isBookmarkNode = function(node) {\n\t\treturn node && node.tagName === 'SPAN' && node.getAttribute('data-mce-type') === 'bookmark';\n\t};\n\n\treturn BookmarkManager;\n});\n\n// Included from: js/tinymce/classes/dom/Selection.js\n\n/**\n * Selection.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class handles text and control selection it's an crossbrowser utility class.\n * Consult the TinyMCE Wiki API for more details and examples on how to use this class.\n *\n * @class tinymce.dom.Selection\n * @example\n * // Getting the currently selected node for the active editor\n * alert(tinymce.activeEditor.selection.getNode().nodeName);\n */\ndefine(\"tinymce/dom/Selection\", [\n\t\"tinymce/dom/TreeWalker\",\n\t\"tinymce/dom/TridentSelection\",\n\t\"tinymce/dom/ControlSelection\",\n\t\"tinymce/dom/RangeUtils\",\n\t\"tinymce/dom/BookmarkManager\",\n\t\"tinymce/dom/NodeType\",\n\t\"tinymce/Env\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/caret/CaretPosition\"\n], function(TreeWalker, TridentSelection, ControlSelection, RangeUtils, BookmarkManager, NodeType, Env, Tools, CaretPosition) {\n\tvar each = Tools.each, trim = Tools.trim;\n\tvar isIE = Env.ie;\n\n\t/**\n\t * Constructs a new selection instance.\n\t *\n\t * @constructor\n\t * @method Selection\n\t * @param {tinymce.dom.DOMUtils} dom DOMUtils object reference.\n\t * @param {Window} win Window to bind the selection object to.\n\t * @param {tinymce.Editor} editor Editor instance of the selection.\n\t * @param {tinymce.dom.Serializer} serializer DOM serialization class to use for getContent.\n\t */\n\tfunction Selection(dom, win, serializer, editor) {\n\t\tvar self = this;\n\n\t\tself.dom = dom;\n\t\tself.win = win;\n\t\tself.serializer = serializer;\n\t\tself.editor = editor;\n\t\tself.bookmarkManager = new BookmarkManager(self);\n\t\tself.controlSelection = new ControlSelection(self, editor);\n\n\t\t// No W3C Range support\n\t\tif (!self.win.getSelection) {\n\t\t\tself.tridentSel = new TridentSelection(self);\n\t\t}\n\t}\n\n\tSelection.prototype = {\n\t\t/**\n\t\t * Move the selection cursor range to the specified node and offset.\n\t\t * If there is no node specified it will move it to the first suitable location within the body.\n\t\t *\n\t\t * @method setCursorLocation\n\t\t * @param {Node} node Optional node to put the cursor in.\n\t\t * @param {Number} offset Optional offset from the start of the node to put the cursor at.\n\t\t */\n\t\tsetCursorLocation: function(node, offset) {\n\t\t\tvar self = this, rng = self.dom.createRng();\n\n\t\t\tif (!node) {\n\t\t\t\tself._moveEndPoint(rng, self.editor.getBody(), true);\n\t\t\t\tself.setRng(rng);\n\t\t\t} else {\n\t\t\t\trng.setStart(node, offset);\n\t\t\t\trng.setEnd(node, offset);\n\t\t\t\tself.setRng(rng);\n\t\t\t\tself.collapse(false);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Returns the selected contents using the DOM serializer passed in to this class.\n\t\t *\n\t\t * @method getContent\n\t\t * @param {Object} args Optional settings class with for example output format text or html.\n\t\t * @return {String} Selected contents in for example HTML format.\n\t\t * @example\n\t\t * // Alerts the currently selected contents\n\t\t * alert(tinymce.activeEditor.selection.getContent());\n\t\t *\n\t\t * // Alerts the currently selected contents as plain text\n\t\t * alert(tinymce.activeEditor.selection.getContent({format: 'text'}));\n\t\t */\n\t\tgetContent: function(args) {\n\t\t\tvar self = this, rng = self.getRng(), tmpElm = self.dom.create(\"body\");\n\t\t\tvar se = self.getSel(), whiteSpaceBefore, whiteSpaceAfter, fragment;\n\n\t\t\targs = args || {};\n\t\t\twhiteSpaceBefore = whiteSpaceAfter = '';\n\t\t\targs.get = true;\n\t\t\targs.format = args.format || 'html';\n\t\t\targs.selection = true;\n\t\t\tself.editor.fire('BeforeGetContent', args);\n\n\t\t\tif (args.format == 'text') {\n\t\t\t\treturn self.isCollapsed() ? '' : (rng.text || (se.toString ? se.toString() : ''));\n\t\t\t}\n\n\t\t\tif (rng.cloneContents) {\n\t\t\t\tfragment = rng.cloneContents();\n\n\t\t\t\tif (fragment) {\n\t\t\t\t\ttmpElm.appendChild(fragment);\n\t\t\t\t}\n\t\t\t} else if (rng.item !== undefined || rng.htmlText !== undefined) {\n\t\t\t\t// IE will produce invalid markup if elements are present that\n\t\t\t\t// it doesn't understand like custom elements or HTML5 elements.\n\t\t\t\t// Adding a BR in front of the contents and then remoiving it seems to fix it though.\n\t\t\t\ttmpElm.innerHTML = '<br>' + (rng.item ? rng.item(0).outerHTML : rng.htmlText);\n\t\t\t\ttmpElm.removeChild(tmpElm.firstChild);\n\t\t\t} else {\n\t\t\t\ttmpElm.innerHTML = rng.toString();\n\t\t\t}\n\n\t\t\t// Keep whitespace before and after\n\t\t\tif (/^\\s/.test(tmpElm.innerHTML)) {\n\t\t\t\twhiteSpaceBefore = ' ';\n\t\t\t}\n\n\t\t\tif (/\\s+$/.test(tmpElm.innerHTML)) {\n\t\t\t\twhiteSpaceAfter = ' ';\n\t\t\t}\n\n\t\t\targs.getInner = true;\n\n\t\t\targs.content = self.isCollapsed() ? '' : whiteSpaceBefore + self.serializer.serialize(tmpElm, args) + whiteSpaceAfter;\n\t\t\tself.editor.fire('GetContent', args);\n\n\t\t\treturn args.content;\n\t\t},\n\n\t\t/**\n\t\t * Sets the current selection to the specified content. If any contents is selected it will be replaced\n\t\t * with the contents passed in to this function. If there is no selection the contents will be inserted\n\t\t * where the caret is placed in the editor/page.\n\t\t *\n\t\t * @method setContent\n\t\t * @param {String} content HTML contents to set could also be other formats depending on settings.\n\t\t * @param {Object} args Optional settings object with for example data format.\n\t\t * @example\n\t\t * // Inserts some HTML contents at the current selection\n\t\t * tinymce.activeEditor.selection.setContent('<strong>Some contents</strong>');\n\t\t */\n\t\tsetContent: function(content, args) {\n\t\t\tvar self = this, rng = self.getRng(), caretNode, doc = self.win.document, frag, temp;\n\n\t\t\targs = args || {format: 'html'};\n\t\t\targs.set = true;\n\t\t\targs.selection = true;\n\t\t\targs.content = content;\n\n\t\t\t// Dispatch before set content event\n\t\t\tif (!args.no_events) {\n\t\t\t\tself.editor.fire('BeforeSetContent', args);\n\t\t\t}\n\n\t\t\tcontent = args.content;\n\n\t\t\tif (rng.insertNode) {\n\t\t\t\t// Make caret marker since insertNode places the caret in the beginning of text after insert\n\t\t\t\tcontent += '<span id=\"__caret\">_</span>';\n\n\t\t\t\t// Delete and insert new node\n\t\t\t\tif (rng.startContainer == doc && rng.endContainer == doc) {\n\t\t\t\t\t// WebKit will fail if the body is empty since the range is then invalid and it can't insert contents\n\t\t\t\t\tdoc.body.innerHTML = content;\n\t\t\t\t} else {\n\t\t\t\t\trng.deleteContents();\n\n\t\t\t\t\tif (doc.body.childNodes.length === 0) {\n\t\t\t\t\t\tdoc.body.innerHTML = content;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// createContextualFragment doesn't exists in IE 9 DOMRanges\n\t\t\t\t\t\tif (rng.createContextualFragment) {\n\t\t\t\t\t\t\trng.insertNode(rng.createContextualFragment(content));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Fake createContextualFragment call in IE 9\n\t\t\t\t\t\t\tfrag = doc.createDocumentFragment();\n\t\t\t\t\t\t\ttemp = doc.createElement('div');\n\n\t\t\t\t\t\t\tfrag.appendChild(temp);\n\t\t\t\t\t\t\ttemp.outerHTML = content;\n\n\t\t\t\t\t\t\trng.insertNode(frag);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Move to caret marker\n\t\t\t\tcaretNode = self.dom.get('__caret');\n\n\t\t\t\t// Make sure we wrap it compleatly, Opera fails with a simple select call\n\t\t\t\trng = doc.createRange();\n\t\t\t\trng.setStartBefore(caretNode);\n\t\t\t\trng.setEndBefore(caretNode);\n\t\t\t\tself.setRng(rng);\n\n\t\t\t\t// Remove the caret position\n\t\t\t\tself.dom.remove('__caret');\n\n\t\t\t\ttry {\n\t\t\t\t\tself.setRng(rng);\n\t\t\t\t} catch (ex) {\n\t\t\t\t\t// Might fail on Opera for some odd reason\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (rng.item) {\n\t\t\t\t\t// Delete content and get caret text selection\n\t\t\t\t\tdoc.execCommand('Delete', false, null);\n\t\t\t\t\trng = self.getRng();\n\t\t\t\t}\n\n\t\t\t\t// Explorer removes spaces from the beginning of pasted contents\n\t\t\t\tif (/^\\s+/.test(content)) {\n\t\t\t\t\trng.pasteHTML('<span id=\"__mce_tmp\">_</span>' + content);\n\t\t\t\t\tself.dom.remove('__mce_tmp');\n\t\t\t\t} else {\n\t\t\t\t\trng.pasteHTML(content);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Dispatch set content event\n\t\t\tif (!args.no_events) {\n\t\t\t\tself.editor.fire('SetContent', args);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Returns the start element of a selection range. If the start is in a text\n\t\t * node the parent element will be returned.\n\t\t *\n\t\t * @method getStart\n\t\t * @param {Boolean} real Optional state to get the real parent when the selection is collapsed not the closest element.\n\t\t * @return {Element} Start element of selection range.\n\t\t */\n\t\tgetStart: function(real) {\n\t\t\tvar self = this, rng = self.getRng(), startElement, parentElement, checkRng, node;\n\n\t\t\tif (rng.duplicate || rng.item) {\n\t\t\t\t// Control selection, return first item\n\t\t\t\tif (rng.item) {\n\t\t\t\t\treturn rng.item(0);\n\t\t\t\t}\n\n\t\t\t\t// Get start element\n\t\t\t\tcheckRng = rng.duplicate();\n\t\t\t\tcheckRng.collapse(1);\n\t\t\t\tstartElement = checkRng.parentElement();\n\t\t\t\tif (startElement.ownerDocument !== self.dom.doc) {\n\t\t\t\t\tstartElement = self.dom.getRoot();\n\t\t\t\t}\n\n\t\t\t\t// Check if range parent is inside the start element, then return the inner parent element\n\t\t\t\t// This will fix issues when a single element is selected, IE would otherwise return the wrong start element\n\t\t\t\tparentElement = node = rng.parentElement();\n\t\t\t\twhile ((node = node.parentNode)) {\n\t\t\t\t\tif (node == startElement) {\n\t\t\t\t\t\tstartElement = parentElement;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn startElement;\n\t\t\t}\n\n\t\t\tstartElement = rng.startContainer;\n\n\t\t\tif (startElement.nodeType == 1 && startElement.hasChildNodes()) {\n\t\t\t\tif (!real || !rng.collapsed) {\n\t\t\t\t\tstartElement = startElement.childNodes[Math.min(startElement.childNodes.length - 1, rng.startOffset)];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (startElement && startElement.nodeType == 3) {\n\t\t\t\treturn startElement.parentNode;\n\t\t\t}\n\n\t\t\treturn startElement;\n\t\t},\n\n\t\t/**\n\t\t * Returns the end element of a selection range. If the end is in a text\n\t\t * node the parent element will be returned.\n\t\t *\n\t\t * @method getEnd\n\t\t * @param {Boolean} real Optional state to get the real parent when the selection is collapsed not the closest element.\n\t\t * @return {Element} End element of selection range.\n\t\t */\n\t\tgetEnd: function(real) {\n\t\t\tvar self = this, rng = self.getRng(), endElement, endOffset;\n\n\t\t\tif (rng.duplicate || rng.item) {\n\t\t\t\tif (rng.item) {\n\t\t\t\t\treturn rng.item(0);\n\t\t\t\t}\n\n\t\t\t\trng = rng.duplicate();\n\t\t\t\trng.collapse(0);\n\t\t\t\tendElement = rng.parentElement();\n\t\t\t\tif (endElement.ownerDocument !== self.dom.doc) {\n\t\t\t\t\tendElement = self.dom.getRoot();\n\t\t\t\t}\n\n\t\t\t\tif (endElement && endElement.nodeName == 'BODY') {\n\t\t\t\t\treturn endElement.lastChild || endElement;\n\t\t\t\t}\n\n\t\t\t\treturn endElement;\n\t\t\t}\n\n\t\t\tendElement = rng.endContainer;\n\t\t\tendOffset = rng.endOffset;\n\n\t\t\tif (endElement.nodeType == 1 && endElement.hasChildNodes()) {\n\t\t\t\tif (!real || !rng.collapsed) {\n\t\t\t\t\tendElement = endElement.childNodes[endOffset > 0 ? endOffset - 1 : endOffset];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (endElement && endElement.nodeType == 3) {\n\t\t\t\treturn endElement.parentNode;\n\t\t\t}\n\n\t\t\treturn endElement;\n\t\t},\n\n\t\t/**\n\t\t * Returns a bookmark location for the current selection. This bookmark object\n\t\t * can then be used to restore the selection after some content modification to the document.\n\t\t *\n\t\t * @method getBookmark\n\t\t * @param {Number} type Optional state if the bookmark should be simple or not. Default is complex.\n\t\t * @param {Boolean} normalized Optional state that enables you to get a position that it would be after normalization.\n\t\t * @return {Object} Bookmark object, use moveToBookmark with this object to restore the selection.\n\t\t * @example\n\t\t * // Stores a bookmark of the current selection\n\t\t * var bm = tinymce.activeEditor.selection.getBookmark();\n\t\t *\n\t\t * tinymce.activeEditor.setContent(tinymce.activeEditor.getContent() + 'Some new content');\n\t\t *\n\t\t * // Restore the selection bookmark\n\t\t * tinymce.activeEditor.selection.moveToBookmark(bm);\n\t\t */\n\t\tgetBookmark: function(type, normalized) {\n\t\t\treturn this.bookmarkManager.getBookmark(type, normalized);\n\t\t},\n\n\t\t/**\n\t\t * Restores the selection to the specified bookmark.\n\t\t *\n\t\t * @method moveToBookmark\n\t\t * @param {Object} bookmark Bookmark to restore selection from.\n\t\t * @return {Boolean} true/false if it was successful or not.\n\t\t * @example\n\t\t * // Stores a bookmark of the current selection\n\t\t * var bm = tinymce.activeEditor.selection.getBookmark();\n\t\t *\n\t\t * tinymce.activeEditor.setContent(tinymce.activeEditor.getContent() + 'Some new content');\n\t\t *\n\t\t * // Restore the selection bookmark\n\t\t * tinymce.activeEditor.selection.moveToBookmark(bm);\n\t\t */\n\t\tmoveToBookmark: function(bookmark) {\n\t\t\treturn this.bookmarkManager.moveToBookmark(bookmark);\n\t\t},\n\n\t\t/**\n\t\t * Selects the specified element. This will place the start and end of the selection range around the element.\n\t\t *\n\t\t * @method select\n\t\t * @param {Element} node HTML DOM element to select.\n\t\t * @param {Boolean} content Optional bool state if the contents should be selected or not on non IE browser.\n\t\t * @return {Element} Selected element the same element as the one that got passed in.\n\t\t * @example\n\t\t * // Select the first paragraph in the active editor\n\t\t * tinymce.activeEditor.selection.select(tinymce.activeEditor.dom.select('p')[0]);\n\t\t */\n\t\tselect: function(node, content) {\n\t\t\tvar self = this, dom = self.dom, rng = dom.createRng(), idx;\n\n\t\t\t// Clear stored range set by FocusManager\n\t\t\tself.lastFocusBookmark = null;\n\n\t\t\tif (node) {\n\t\t\t\tif (!content && self.controlSelection.controlSelect(node)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tidx = dom.nodeIndex(node);\n\t\t\t\trng.setStart(node.parentNode, idx);\n\t\t\t\trng.setEnd(node.parentNode, idx + 1);\n\n\t\t\t\t// Find first/last text node or BR element\n\t\t\t\tif (content) {\n\t\t\t\t\tself._moveEndPoint(rng, node, true);\n\t\t\t\t\tself._moveEndPoint(rng, node);\n\t\t\t\t}\n\n\t\t\t\tself.setRng(rng);\n\t\t\t}\n\n\t\t\treturn node;\n\t\t},\n\n\t\t/**\n\t\t * Returns true/false if the selection range is collapsed or not. Collapsed means if it's a caret or a larger selection.\n\t\t *\n\t\t * @method isCollapsed\n\t\t * @return {Boolean} true/false state if the selection range is collapsed or not.\n\t\t * Collapsed means if it's a caret or a larger selection.\n\t\t */\n\t\tisCollapsed: function() {\n\t\t\tvar self = this, rng = self.getRng(), sel = self.getSel();\n\n\t\t\tif (!rng || rng.item) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (rng.compareEndPoints) {\n\t\t\t\treturn rng.compareEndPoints('StartToEnd', rng) === 0;\n\t\t\t}\n\n\t\t\treturn !sel || rng.collapsed;\n\t\t},\n\n\t\t/**\n\t\t * Collapse the selection to start or end of range.\n\t\t *\n\t\t * @method collapse\n\t\t * @param {Boolean} toStart Optional boolean state if to collapse to end or not. Defaults to false.\n\t\t */\n\t\tcollapse: function(toStart) {\n\t\t\tvar self = this, rng = self.getRng(), node;\n\n\t\t\t// Control range on IE\n\t\t\tif (rng.item) {\n\t\t\t\tnode = rng.item(0);\n\t\t\t\trng = self.win.document.body.createTextRange();\n\t\t\t\trng.moveToElementText(node);\n\t\t\t}\n\n\t\t\trng.collapse(!!toStart);\n\t\t\tself.setRng(rng);\n\t\t},\n\n\t\t/**\n\t\t * Returns the browsers internal selection object.\n\t\t *\n\t\t * @method getSel\n\t\t * @return {Selection} Internal browser selection object.\n\t\t */\n\t\tgetSel: function() {\n\t\t\tvar win = this.win;\n\n\t\t\treturn win.getSelection ? win.getSelection() : win.document.selection;\n\t\t},\n\n\t\t/**\n\t\t * Returns the browsers internal range object.\n\t\t *\n\t\t * @method getRng\n\t\t * @param {Boolean} w3c Forces a compatible W3C range on IE.\n\t\t * @return {Range} Internal browser range object.\n\t\t * @see http://www.quirksmode.org/dom/range_intro.html\n\t\t * @see http://www.dotvoid.com/2001/03/using-the-range-object-in-mozilla/\n\t\t */\n\t\tgetRng: function(w3c) {\n\t\t\tvar self = this, selection, rng, elm, doc, ieRng, evt;\n\n\t\t\tfunction tryCompareBoundaryPoints(how, sourceRange, destinationRange) {\n\t\t\t\ttry {\n\t\t\t\t\treturn sourceRange.compareBoundaryPoints(how, destinationRange);\n\t\t\t\t} catch (ex) {\n\t\t\t\t\t// Gecko throws wrong document exception if the range points\n\t\t\t\t\t// to nodes that where removed from the dom #6690\n\t\t\t\t\t// Browsers should mutate existing DOMRange instances so that they always point\n\t\t\t\t\t// to something in the document this is not the case in Gecko works fine in IE/WebKit/Blink\n\t\t\t\t\t// For performance reasons just return -1\n\t\t\t\t\treturn -1;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!self.win) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tdoc = self.win.document;\n\n\t\t\tif (typeof doc === 'undefined' || doc === null) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\t// Use last rng passed from FocusManager if it's available this enables\n\t\t\t// calls to editor.selection.getStart() to work when caret focus is lost on IE\n\t\t\tif (!w3c && self.lastFocusBookmark) {\n\t\t\t\tvar bookmark = self.lastFocusBookmark;\n\n\t\t\t\t// Convert bookmark to range IE 11 fix\n\t\t\t\tif (bookmark.startContainer) {\n\t\t\t\t\trng = doc.createRange();\n\t\t\t\t\trng.setStart(bookmark.startContainer, bookmark.startOffset);\n\t\t\t\t\trng.setEnd(bookmark.endContainer, bookmark.endOffset);\n\t\t\t\t} else {\n\t\t\t\t\trng = bookmark;\n\t\t\t\t}\n\n\t\t\t\treturn rng;\n\t\t\t}\n\n\t\t\t// Found tridentSel object then we need to use that one\n\t\t\tif (w3c && self.tridentSel) {\n\t\t\t\treturn self.tridentSel.getRangeAt(0);\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tif ((selection = self.getSel())) {\n\t\t\t\t\tif (selection.rangeCount > 0) {\n\t\t\t\t\t\trng = selection.getRangeAt(0);\n\t\t\t\t\t} else {\n\t\t\t\t\t\trng = selection.createRange ? selection.createRange() : doc.createRange();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} catch (ex) {\n\t\t\t\t// IE throws unspecified error here if TinyMCE is placed in a frame/iframe\n\t\t\t}\n\n\t\t\tevt = self.editor.fire('GetSelectionRange', {range: rng});\n\t\t\tif (evt.range !== rng) {\n\t\t\t\treturn evt.range;\n\t\t\t}\n\n\t\t\t// We have W3C ranges and it's IE then fake control selection since IE9 doesn't handle that correctly yet\n\t\t\t// IE 11 doesn't support the selection object so we check for that as well\n\t\t\tif (isIE && rng && rng.setStart && doc.selection) {\n\t\t\t\ttry {\n\t\t\t\t\t// IE will sometimes throw an exception here\n\t\t\t\t\tieRng = doc.selection.createRange();\n\t\t\t\t} catch (ex) {\n\t\t\t\t\t// Ignore\n\t\t\t\t}\n\n\t\t\t\tif (ieRng && ieRng.item) {\n\t\t\t\t\telm = ieRng.item(0);\n\t\t\t\t\trng = doc.createRange();\n\t\t\t\t\trng.setStartBefore(elm);\n\t\t\t\t\trng.setEndAfter(elm);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// No range found then create an empty one\n\t\t\t// This can occur when the editor is placed in a hidden container element on Gecko\n\t\t\t// Or on IE when there was an exception\n\t\t\tif (!rng) {\n\t\t\t\trng = doc.createRange ? doc.createRange() : doc.body.createTextRange();\n\t\t\t}\n\n\t\t\t// If range is at start of document then move it to start of body\n\t\t\tif (rng.setStart && rng.startContainer.nodeType === 9 && rng.collapsed) {\n\t\t\t\telm = self.dom.getRoot();\n\t\t\t\trng.setStart(elm, 0);\n\t\t\t\trng.setEnd(elm, 0);\n\t\t\t}\n\n\t\t\tif (self.selectedRange && self.explicitRange) {\n\t\t\t\tif (tryCompareBoundaryPoints(rng.START_TO_START, rng, self.selectedRange) === 0 &&\n\t\t\t\t\ttryCompareBoundaryPoints(rng.END_TO_END, rng, self.selectedRange) === 0) {\n\t\t\t\t\t// Safari, Opera and Chrome only ever select text which causes the range to change.\n\t\t\t\t\t// This lets us use the originally set range if the selection hasn't been changed by the user.\n\t\t\t\t\trng = self.explicitRange;\n\t\t\t\t} else {\n\t\t\t\t\tself.selectedRange = null;\n\t\t\t\t\tself.explicitRange = null;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn rng;\n\t\t},\n\n\t\t/**\n\t\t * Changes the selection to the specified DOM range.\n\t\t *\n\t\t * @method setRng\n\t\t * @param {Range} rng Range to select.\n\t\t * @param {Boolean} forward Optional boolean if the selection is forwards or backwards.\n\t\t */\n\t\tsetRng: function(rng, forward) {\n\t\t\tvar self = this, sel, node, evt;\n\n\t\t\tif (!rng) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Is IE specific range\n\t\t\tif (rng.select) {\n\t\t\t\tself.explicitRange = null;\n\n\t\t\t\ttry {\n\t\t\t\t\trng.select();\n\t\t\t\t} catch (ex) {\n\t\t\t\t\t// Needed for some odd IE bug #1843306\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!self.tridentSel) {\n\t\t\t\tsel = self.getSel();\n\n\t\t\t\tevt = self.editor.fire('SetSelectionRange', {range: rng});\n\t\t\t\trng = evt.range;\n\n\t\t\t\tif (sel) {\n\t\t\t\t\tself.explicitRange = rng;\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tsel.removeAllRanges();\n\t\t\t\t\t\tsel.addRange(rng);\n\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t// IE might throw errors here if the editor is within a hidden container and selection is changed\n\t\t\t\t\t}\n\n\t\t\t\t\t// Forward is set to false and we have an extend function\n\t\t\t\t\tif (forward === false && sel.extend) {\n\t\t\t\t\t\tsel.collapse(rng.endContainer, rng.endOffset);\n\t\t\t\t\t\tsel.extend(rng.startContainer, rng.startOffset);\n\t\t\t\t\t}\n\n\t\t\t\t\t// adding range isn't always successful so we need to check range count otherwise an exception can occur\n\t\t\t\t\tself.selectedRange = sel.rangeCount > 0 ? sel.getRangeAt(0) : null;\n\t\t\t\t}\n\n\t\t\t\t// WebKit egde case selecting images works better using setBaseAndExtent\n\t\t\t\tif (!rng.collapsed && rng.startContainer == rng.endContainer && sel.setBaseAndExtent && !Env.ie) {\n\t\t\t\t\tif (rng.endOffset - rng.startOffset < 2) {\n\t\t\t\t\t\tif (rng.startContainer.hasChildNodes()) {\n\t\t\t\t\t\t\tnode = rng.startContainer.childNodes[rng.startOffset];\n\t\t\t\t\t\t\tif (node && node.tagName == 'IMG') {\n\t\t\t\t\t\t\t\tself.getSel().setBaseAndExtent(node, 0, node, 1);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tself.editor.fire('AfterSetSelectionRange', {range: rng});\n\t\t\t} else {\n\t\t\t\t// Is W3C Range fake range on IE\n\t\t\t\tif (rng.cloneRange) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tself.tridentSel.addRange(rng);\n\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t//IE9 throws an error here if called before selection is placed in the editor\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Sets the current selection to the specified DOM element.\n\t\t *\n\t\t * @method setNode\n\t\t * @param {Element} elm Element to set as the contents of the selection.\n\t\t * @return {Element} Returns the element that got passed in.\n\t\t * @example\n\t\t * // Inserts a DOM node at current selection/caret location\n\t\t * tinymce.activeEditor.selection.setNode(tinymce.activeEditor.dom.create('img', {src: 'some.gif', title: 'some title'}));\n\t\t */\n\t\tsetNode: function(elm) {\n\t\t\tvar self = this;\n\n\t\t\tself.setContent(self.dom.getOuterHTML(elm));\n\n\t\t\treturn elm;\n\t\t},\n\n\t\t/**\n\t\t * Returns the currently selected element or the common ancestor element for both start and end of the selection.\n\t\t *\n\t\t * @method getNode\n\t\t * @return {Element} Currently selected element or common ancestor element.\n\t\t * @example\n\t\t * // Alerts the currently selected elements node name\n\t\t * alert(tinymce.activeEditor.selection.getNode().nodeName);\n\t\t */\n\t\tgetNode: function() {\n\t\t\tvar self = this, rng = self.getRng(), elm;\n\t\t\tvar startContainer, endContainer, startOffset, endOffset, root = self.dom.getRoot();\n\n\t\t\tfunction skipEmptyTextNodes(node, forwards) {\n\t\t\t\tvar orig = node;\n\n\t\t\t\twhile (node && node.nodeType === 3 && node.length === 0) {\n\t\t\t\t\tnode = forwards ? node.nextSibling : node.previousSibling;\n\t\t\t\t}\n\n\t\t\t\treturn node || orig;\n\t\t\t}\n\n\t\t\t// Range maybe lost after the editor is made visible again\n\t\t\tif (!rng) {\n\t\t\t\treturn root;\n\t\t\t}\n\n\t\t\tstartContainer = rng.startContainer;\n\t\t\tendContainer = rng.endContainer;\n\t\t\tstartOffset = rng.startOffset;\n\t\t\tendOffset = rng.endOffset;\n\n\t\t\tif (rng.setStart) {\n\t\t\t\telm = rng.commonAncestorContainer;\n\n\t\t\t\t// Handle selection a image or other control like element such as anchors\n\t\t\t\tif (!rng.collapsed) {\n\t\t\t\t\tif (startContainer == endContainer) {\n\t\t\t\t\t\tif (endOffset - startOffset < 2) {\n\t\t\t\t\t\t\tif (startContainer.hasChildNodes()) {\n\t\t\t\t\t\t\t\telm = startContainer.childNodes[startOffset];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// If the anchor node is a element instead of a text node then return this element\n\t\t\t\t\t//if (tinymce.isWebKit && sel.anchorNode && sel.anchorNode.nodeType == 1)\n\t\t\t\t\t//\treturn sel.anchorNode.childNodes[sel.anchorOffset];\n\n\t\t\t\t\t// Handle cases where the selection is immediately wrapped around a node and return that node instead of it's parent.\n\t\t\t\t\t// This happens when you double click an underlined word in FireFox.\n\t\t\t\t\tif (startContainer.nodeType === 3 && endContainer.nodeType === 3) {\n\t\t\t\t\t\tif (startContainer.length === startOffset) {\n\t\t\t\t\t\t\tstartContainer = skipEmptyTextNodes(startContainer.nextSibling, true);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tstartContainer = startContainer.parentNode;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (endOffset === 0) {\n\t\t\t\t\t\t\tendContainer = skipEmptyTextNodes(endContainer.previousSibling, false);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tendContainer = endContainer.parentNode;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (startContainer && startContainer === endContainer) {\n\t\t\t\t\t\t\treturn startContainer;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (elm && elm.nodeType == 3) {\n\t\t\t\t\treturn elm.parentNode;\n\t\t\t\t}\n\n\t\t\t\treturn elm;\n\t\t\t}\n\n\t\t\telm = rng.item ? rng.item(0) : rng.parentElement();\n\n\t\t\t// IE 7 might return elements outside the iframe\n\t\t\tif (elm.ownerDocument !== self.win.document) {\n\t\t\t\telm = root;\n\t\t\t}\n\n\t\t\treturn elm;\n\t\t},\n\n\t\tgetSelectedBlocks: function(startElm, endElm) {\n\t\t\tvar self = this, dom = self.dom, node, root, selectedBlocks = [];\n\n\t\t\troot = dom.getRoot();\n\t\t\tstartElm = dom.getParent(startElm || self.getStart(), dom.isBlock);\n\t\t\tendElm = dom.getParent(endElm || self.getEnd(), dom.isBlock);\n\n\t\t\tif (startElm && startElm != root) {\n\t\t\t\tselectedBlocks.push(startElm);\n\t\t\t}\n\n\t\t\tif (startElm && endElm && startElm != endElm) {\n\t\t\t\tnode = startElm;\n\n\t\t\t\tvar walker = new TreeWalker(startElm, root);\n\t\t\t\twhile ((node = walker.next()) && node != endElm) {\n\t\t\t\t\tif (dom.isBlock(node)) {\n\t\t\t\t\t\tselectedBlocks.push(node);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (endElm && startElm != endElm && endElm != root) {\n\t\t\t\tselectedBlocks.push(endElm);\n\t\t\t}\n\n\t\t\treturn selectedBlocks;\n\t\t},\n\n\t\tisForward: function() {\n\t\t\tvar dom = this.dom, sel = this.getSel(), anchorRange, focusRange;\n\n\t\t\t// No support for selection direction then always return true\n\t\t\tif (!sel || !sel.anchorNode || !sel.focusNode) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tanchorRange = dom.createRng();\n\t\t\tanchorRange.setStart(sel.anchorNode, sel.anchorOffset);\n\t\t\tanchorRange.collapse(true);\n\n\t\t\tfocusRange = dom.createRng();\n\t\t\tfocusRange.setStart(sel.focusNode, sel.focusOffset);\n\t\t\tfocusRange.collapse(true);\n\n\t\t\treturn anchorRange.compareBoundaryPoints(anchorRange.START_TO_START, focusRange) <= 0;\n\t\t},\n\n\t\tnormalize: function() {\n\t\t\tvar self = this, rng = self.getRng();\n\n\t\t\tif (Env.range && new RangeUtils(self.dom).normalize(rng)) {\n\t\t\t\tself.setRng(rng, self.isForward());\n\t\t\t}\n\n\t\t\treturn rng;\n\t\t},\n\n\t\t/**\n\t\t * Executes callback when the current selection starts/stops matching the specified selector. The current\n\t\t * state will be passed to the callback as it's first argument.\n\t\t *\n\t\t * @method selectorChanged\n\t\t * @param {String} selector CSS selector to check for.\n\t\t * @param {function} callback Callback with state and args when the selector is matches or not.\n\t\t */\n\t\tselectorChanged: function(selector, callback) {\n\t\t\tvar self = this, currentSelectors;\n\n\t\t\tif (!self.selectorChangedData) {\n\t\t\t\tself.selectorChangedData = {};\n\t\t\t\tcurrentSelectors = {};\n\n\t\t\t\tself.editor.on('NodeChange', function(e) {\n\t\t\t\t\tvar node = e.element, dom = self.dom, parents = dom.getParents(node, null, dom.getRoot()), matchedSelectors = {};\n\n\t\t\t\t\t// Check for new matching selectors\n\t\t\t\t\teach(self.selectorChangedData, function(callbacks, selector) {\n\t\t\t\t\t\teach(parents, function(node) {\n\t\t\t\t\t\t\tif (dom.is(node, selector)) {\n\t\t\t\t\t\t\t\tif (!currentSelectors[selector]) {\n\t\t\t\t\t\t\t\t\t// Execute callbacks\n\t\t\t\t\t\t\t\t\teach(callbacks, function(callback) {\n\t\t\t\t\t\t\t\t\t\tcallback(true, {node: node, selector: selector, parents: parents});\n\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\tcurrentSelectors[selector] = callbacks;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tmatchedSelectors[selector] = callbacks;\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\n\t\t\t\t\t// Check if current selectors still match\n\t\t\t\t\teach(currentSelectors, function(callbacks, selector) {\n\t\t\t\t\t\tif (!matchedSelectors[selector]) {\n\t\t\t\t\t\t\tdelete currentSelectors[selector];\n\n\t\t\t\t\t\t\teach(callbacks, function(callback) {\n\t\t\t\t\t\t\t\tcallback(false, {node: node, selector: selector, parents: parents});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Add selector listeners\n\t\t\tif (!self.selectorChangedData[selector]) {\n\t\t\t\tself.selectorChangedData[selector] = [];\n\t\t\t}\n\n\t\t\tself.selectorChangedData[selector].push(callback);\n\n\t\t\treturn self;\n\t\t},\n\n\t\tgetScrollContainer: function() {\n\t\t\tvar scrollContainer, node = this.dom.getRoot();\n\n\t\t\twhile (node && node.nodeName != 'BODY') {\n\t\t\t\tif (node.scrollHeight > node.clientHeight) {\n\t\t\t\t\tscrollContainer = node;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tnode = node.parentNode;\n\t\t\t}\n\n\t\t\treturn scrollContainer;\n\t\t},\n\n\t\tscrollIntoView: function(elm, alignToTop) {\n\t\t\tvar y, viewPort, self = this, dom = self.dom, root = dom.getRoot(), viewPortY, viewPortH, offsetY = 0;\n\n\t\t\tfunction getPos(elm) {\n\t\t\t\tvar x = 0, y = 0;\n\n\t\t\t\tvar offsetParent = elm;\n\t\t\t\twhile (offsetParent && offsetParent.nodeType) {\n\t\t\t\t\tx += offsetParent.offsetLeft || 0;\n\t\t\t\t\ty += offsetParent.offsetTop || 0;\n\t\t\t\t\toffsetParent = offsetParent.offsetParent;\n\t\t\t\t}\n\n\t\t\t\treturn {x: x, y: y};\n\t\t\t}\n\n\t\t\tif (!NodeType.isElement(elm)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (alignToTop === false) {\n\t\t\t\toffsetY = elm.offsetHeight;\n\t\t\t}\n\n\t\t\tif (root.nodeName != 'BODY') {\n\t\t\t\tvar scrollContainer = self.getScrollContainer();\n\t\t\t\tif (scrollContainer) {\n\t\t\t\t\ty = getPos(elm).y - getPos(scrollContainer).y + offsetY;\n\t\t\t\t\tviewPortH = scrollContainer.clientHeight;\n\t\t\t\t\tviewPortY = scrollContainer.scrollTop;\n\t\t\t\t\tif (y < viewPortY || y + 25 > viewPortY + viewPortH) {\n\t\t\t\t\t\tscrollContainer.scrollTop = y < viewPortY ? y : y - viewPortH + 25;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tviewPort = dom.getViewPort(self.editor.getWin());\n\t\t\ty = dom.getPos(elm).y + offsetY;\n\t\t\tviewPortY = viewPort.y;\n\t\t\tviewPortH = viewPort.h;\n\t\t\tif (y < viewPort.y || y + 25 > viewPortY + viewPortH) {\n\t\t\t\tself.editor.getWin().scrollTo(0, y < viewPortY ? y : y - viewPortH + 25);\n\t\t\t}\n\t\t},\n\n\t\tplaceCaretAt: function(clientX, clientY) {\n\t\t\tthis.setRng(RangeUtils.getCaretRangeFromPoint(clientX, clientY, this.editor.getDoc()));\n\t\t},\n\n\t\t_moveEndPoint: function(rng, node, start) {\n\t\t\tvar root = node, walker = new TreeWalker(node, root);\n\t\t\tvar nonEmptyElementsMap = this.dom.schema.getNonEmptyElements();\n\n\t\t\tdo {\n\t\t\t\t// Text node\n\t\t\t\tif (node.nodeType == 3 && trim(node.nodeValue).length !== 0) {\n\t\t\t\t\tif (start) {\n\t\t\t\t\t\trng.setStart(node, 0);\n\t\t\t\t\t} else {\n\t\t\t\t\t\trng.setEnd(node, node.nodeValue.length);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// BR/IMG/INPUT elements but not table cells\n\t\t\t\tif (nonEmptyElementsMap[node.nodeName] && !/^(TD|TH)$/.test(node.nodeName)) {\n\t\t\t\t\tif (start) {\n\t\t\t\t\t\trng.setStartBefore(node);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (node.nodeName == 'BR') {\n\t\t\t\t\t\t\trng.setEndBefore(node);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trng.setEndAfter(node);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Found empty text block old IE can place the selection inside those\n\t\t\t\tif (Env.ie && Env.ie < 11 && this.dom.isBlock(node) && this.dom.isEmpty(node)) {\n\t\t\t\t\tif (start) {\n\t\t\t\t\t\trng.setStart(node, 0);\n\t\t\t\t\t} else {\n\t\t\t\t\t\trng.setEnd(node, 0);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t} while ((node = (start ? walker.next() : walker.prev())));\n\n\t\t\t// Failed to find any text node or other suitable location then move to the root of body\n\t\t\tif (root.nodeName == 'BODY') {\n\t\t\t\tif (start) {\n\t\t\t\t\trng.setStart(root, 0);\n\t\t\t\t} else {\n\t\t\t\t\trng.setEnd(root, root.childNodes.length);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tgetBoundingClientRect:  function() {\n\t\t\tvar rng = this.getRng();\n\t\t\treturn rng.collapsed ? CaretPosition.fromRangeStart(rng).getClientRects()[0] : rng.getBoundingClientRect();\n\t\t},\n\n\t\tdestroy: function() {\n\t\t\tthis.win = null;\n\t\t\tthis.controlSelection.destroy();\n\t\t}\n\t};\n\n\treturn Selection;\n});\n\n// Included from: js/tinymce/classes/dom/ElementUtils.js\n\n/**\n * ElementUtils.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Utility class for various element specific functions.\n *\n * @private\n * @class tinymce.dom.ElementUtils\n */\ndefine(\"tinymce/dom/ElementUtils\", [\n\t\"tinymce/dom/BookmarkManager\",\n\t\"tinymce/util/Tools\"\n], function(BookmarkManager, Tools) {\n\tvar each = Tools.each;\n\n\tfunction ElementUtils(dom) {\n\t\t/**\n\t\t * Compares two nodes and checks if it's attributes and styles matches.\n\t\t * This doesn't compare classes as items since their order is significant.\n\t\t *\n\t\t * @method compare\n\t\t * @param {Node} node1 First node to compare with.\n\t\t * @param {Node} node2 Second node to compare with.\n\t\t * @return {boolean} True/false if the nodes are the same or not.\n\t\t */\n\t\tthis.compare = function(node1, node2) {\n\t\t\t// Not the same name\n\t\t\tif (node1.nodeName != node2.nodeName) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Returns all the nodes attributes excluding internal ones, styles and classes.\n\t\t\t *\n\t\t\t * @private\n\t\t\t * @param {Node} node Node to get attributes from.\n\t\t\t * @return {Object} Name/value object with attributes and attribute values.\n\t\t\t */\n\t\t\tfunction getAttribs(node) {\n\t\t\t\tvar attribs = {};\n\n\t\t\t\teach(dom.getAttribs(node), function(attr) {\n\t\t\t\t\tvar name = attr.nodeName.toLowerCase();\n\n\t\t\t\t\t// Don't compare internal attributes or style\n\t\t\t\t\tif (name.indexOf('_') !== 0 && name !== 'style' && name.indexOf('data-') !== 0) {\n\t\t\t\t\t\tattribs[name] = dom.getAttrib(node, name);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn attribs;\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Compares two objects checks if it's key + value exists in the other one.\n\t\t\t *\n\t\t\t * @private\n\t\t\t * @param {Object} obj1 First object to compare.\n\t\t\t * @param {Object} obj2 Second object to compare.\n\t\t\t * @return {boolean} True/false if the objects matches or not.\n\t\t\t */\n\t\t\tfunction compareObjects(obj1, obj2) {\n\t\t\t\tvar value, name;\n\n\t\t\t\tfor (name in obj1) {\n\t\t\t\t\t// Obj1 has item obj2 doesn't have\n\t\t\t\t\tif (obj1.hasOwnProperty(name)) {\n\t\t\t\t\t\tvalue = obj2[name];\n\n\t\t\t\t\t\t// Obj2 doesn't have obj1 item\n\t\t\t\t\t\tif (typeof value == \"undefined\") {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Obj2 item has a different value\n\t\t\t\t\t\tif (obj1[name] != value) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Delete similar value\n\t\t\t\t\t\tdelete obj2[name];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Check if obj 2 has something obj 1 doesn't have\n\t\t\t\tfor (name in obj2) {\n\t\t\t\t\t// Obj2 has item obj1 doesn't have\n\t\t\t\t\tif (obj2.hasOwnProperty(name)) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t// Attribs are not the same\n\t\t\tif (!compareObjects(getAttribs(node1), getAttribs(node2))) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// Styles are not the same\n\t\t\tif (!compareObjects(dom.parseStyle(dom.getAttrib(node1, 'style')), dom.parseStyle(dom.getAttrib(node2, 'style')))) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn !BookmarkManager.isBookmarkNode(node1) && !BookmarkManager.isBookmarkNode(node2);\n\t\t};\n\t}\n\n\treturn ElementUtils;\n});\n\n// Included from: js/tinymce/classes/fmt/Preview.js\n\n/**\n * Preview.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Internal class for generating previews styles for formats.\n *\n * Example:\n *  Preview.getCssText(editor, 'bold');\n *\n * @private\n * @class tinymce.fmt.Preview\n */\ndefine(\"tinymce/fmt/Preview\", [\n\t\"tinymce/dom/DOMUtils\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/html/Schema\"\n], function(DOMUtils, Tools, Schema) {\n\tvar each = Tools.each;\n\tvar dom = DOMUtils.DOM;\n\n\tfunction parsedSelectorToHtml(ancestry, editor) {\n\t\tvar elm, item, fragment;\n\t\tvar schema = editor && editor.schema || new Schema({});\n\n\t\tfunction decorate(elm, item) {\n\t\t\tif (item.classes.length) {\n\t\t\t\tdom.addClass(elm, item.classes.join(' '));\n\t\t\t}\n\t\t\tdom.setAttribs(elm, item.attrs);\n\t\t}\n\n\t\tfunction createElement(sItem) {\n\t\t\tvar elm;\n\n\t\t\titem = typeof sItem === 'string' ? {\n\t\t\t\tname: sItem,\n\t\t\t\tclasses: [],\n\t\t\t\tattrs: {}\n\t\t\t} : sItem;\n\n\t\t\telm = dom.create(item.name);\n\t\t\tdecorate(elm, item);\n\t\t\treturn elm;\n\t\t}\n\n\t\tfunction getRequiredParent(elm, candidate) {\n\t\t\tvar name = typeof elm !== 'string' ? elm.nodeName.toLowerCase() : elm;\n\t\t\tvar elmRule = schema.getElementRule(name);\n\t\t\tvar parentsRequired = elmRule.parentsRequired;\n\n\t\t\tif (parentsRequired && parentsRequired.length) {\n\t\t\t\treturn candidate && Tools.inArray(parentsRequired, candidate) !== -1 ? candidate : parentsRequired[0];\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\tfunction wrapInHtml(elm, ancestry, siblings) {\n\t\t\tvar parent, parentCandidate, parentRequired;\n\t\t\tvar ancestor = ancestry.length && ancestry[0];\n\t\t\tvar ancestorName = ancestor && ancestor.name;\n\n\t\t\tparentRequired = getRequiredParent(elm, ancestorName);\n\n\t\t\tif (parentRequired) {\n\t\t\t\tif (ancestorName == parentRequired) {\n\t\t\t\t\tparentCandidate = ancestry[0];\n\t\t\t\t\tancestry = ancestry.slice(1);\n\t\t\t\t} else {\n\t\t\t\t\tparentCandidate = parentRequired;\n\t\t\t\t}\n\t\t\t} else if (ancestor) {\n\t\t\t\tparentCandidate = ancestry[0];\n\t\t\t\tancestry = ancestry.slice(1);\n\t\t\t} else if (!siblings) {\n\t\t\t\treturn elm;\n\t\t\t}\n\n\t\t\tif (parentCandidate) {\n\t\t\t\tparent = createElement(parentCandidate);\n\t\t\t\tparent.appendChild(elm);\n\t\t\t}\n\n\t\t\tif (siblings) {\n\t\t\t\tif (!parent) {\n\t\t\t\t\t// if no more ancestry, wrap in generic div\n\t\t\t\t\tparent = dom.create('div');\n\t\t\t\t\tparent.appendChild(elm);\n\t\t\t\t}\n\n\t\t\t\tTools.each(siblings, function(sibling) {\n\t\t\t\t\tvar siblingElm = createElement(sibling);\n\t\t\t\t\tparent.insertBefore(siblingElm, elm);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn wrapInHtml(parent, ancestry, parentCandidate && parentCandidate.siblings);\n\t\t}\n\n\t\tif (ancestry && ancestry.length) {\n\t\t\titem = ancestry[0];\n\t\t\telm = createElement(item);\n\t\t\tfragment = dom.create('div');\n\t\t\tfragment.appendChild(wrapInHtml(elm, ancestry.slice(1), item.siblings));\n\t\t\treturn fragment;\n\t\t} else {\n\t\t\treturn '';\n\t\t}\n\t}\n\n\n\tfunction selectorToHtml(selector, editor) {\n\t\treturn parsedSelectorToHtml(parseSelector(selector, editor));\n\t}\n\n\n\tfunction parseSelectorItem(item) {\n\t\tvar tagName;\n\t\tvar obj = {\n\t\t\tclasses: [],\n\t\t\tattrs: {}\n\t\t};\n\n\t\titem = obj.selector = Tools.trim(item);\n\n\t\tif (item !== '*') {\n\t\t\t// matching IDs, CLASSes, ATTRIBUTES and PSEUDOs\n\t\t\ttagName = item.replace(/(?:([#\\.]|::?)([\\w\\-]+)|(\\[)([^\\]]+)\\]?)/g, function($0, $1, $2, $3, $4) {\n\t\t\t\tswitch ($1) {\n\t\t\t\t\tcase '#':\n\t\t\t\t\t\tobj.attrs.id = $2;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase '.':\n\t\t\t\t\t\tobj.classes.push($2);\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase ':':\n\t\t\t\t\t\tif (Tools.inArray('checked disabled enabled read-only required'.split(' '), $2) !== -1) {\n\t\t\t\t\t\t\tobj.attrs[$2] = $2;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\t// atribute matched\n\t\t\t\tif ($3 == '[') {\n\t\t\t\t\tvar m = $4.match(/([\\w\\-]+)(?:\\=\\\"([^\\\"]+))?/);\n\t\t\t\t\tif (m) {\n\t\t\t\t\t\tobj.attrs[m[1]] = m[2];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn '';\n\t\t\t});\n\t\t}\n\n\t\tobj.name = tagName || 'div';\n\t\treturn obj;\n\t}\n\n\n\tfunction parseSelector(selector) {\n\t\tif (!selector || typeof selector !== 'string') {\n\t\t\treturn [];\n\t\t}\n\n\t\t// take into account only first one\n\t\tselector = selector.split(/\\s*,\\s*/)[0];\n\n\t\t// tighten\n\t\tselector = selector.replace(/\\s*(~\\+|~|\\+|>)\\s*/g, '$1');\n\n\t\t// split either on > or on space, but not the one inside brackets\n\t\treturn Tools.map(selector.split(/(?:>|\\s+(?![^\\[\\]]+\\]))/), function(item) {\n\t\t\t// process each sibling selector separately\n\t\t\tvar siblings = Tools.map(item.split(/(?:~\\+|~|\\+)/), parseSelectorItem);\n\t\t\tvar obj = siblings.pop(); // the last one is our real target\n\n\t\t\tif (siblings.length) {\n\t\t\t\tobj.siblings = siblings;\n\t\t\t}\n\t\t\treturn obj;\n\t\t}).reverse();\n\t}\n\n\n\tfunction getCssText(editor, format) {\n\t\tvar name, previewFrag, previewElm, items;\n\t\tvar previewCss = '', parentFontSize, previewStyles;\n\n\t\tpreviewStyles = editor.settings.preview_styles;\n\n\t\t// No preview forced\n\t\tif (previewStyles === false) {\n\t\t\treturn '';\n\t\t}\n\n\t\t// Default preview\n\t\tif (typeof previewStyles !== 'string') {\n\t\t\tpreviewStyles = 'font-family font-size font-weight font-style text-decoration ' +\n\t\t\t\t'text-transform color background-color border border-radius outline text-shadow';\n\t\t}\n\n\t\t// Removes any variables since these can't be previewed\n\t\tfunction removeVars(val) {\n\t\t\treturn val.replace(/%(\\w+)/g, '');\n\t\t}\n\n\t\t// Create block/inline element to use for preview\n\t\tif (typeof format == \"string\") {\n\t\t\tformat = editor.formatter.get(format);\n\t\t\tif (!format) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tformat = format[0];\n\t\t}\n\n\t\t// Format specific preview override\n\t\t// TODO: This should probably be further reduced by the previewStyles option\n\t\tif ('preview' in format) {\n\t\t\tpreviewStyles = format.preview;\n\t\t\tif (previewStyles === false) {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t}\n\n\t\tname = format.block || format.inline || 'span';\n\n\t\titems = parseSelector(format.selector);\n\t\tif (items.length) {\n\t\t\tif (!items[0].name) { // e.g. something like ul > .someClass was provided\n\t\t\t\titems[0].name = name;\n\t\t\t}\n\t\t\tname = format.selector;\n\t\t\tpreviewFrag = parsedSelectorToHtml(items);\n\t\t} else {\n\t\t\tpreviewFrag = parsedSelectorToHtml([name]);\n\t\t}\n\n\t\tpreviewElm = dom.select(name, previewFrag)[0] || previewFrag.firstChild;\n\n\t\t// Add format styles to preview element\n\t\teach(format.styles, function(value, name) {\n\t\t\tvalue = removeVars(value);\n\n\t\t\tif (value) {\n\t\t\t\tdom.setStyle(previewElm, name, value);\n\t\t\t}\n\t\t});\n\n\t\t// Add attributes to preview element\n\t\teach(format.attributes, function(value, name) {\n\t\t\tvalue = removeVars(value);\n\n\t\t\tif (value) {\n\t\t\t\tdom.setAttrib(previewElm, name, value);\n\t\t\t}\n\t\t});\n\n\t\t// Add classes to preview element\n\t\teach(format.classes, function(value) {\n\t\t\tvalue = removeVars(value);\n\n\t\t\tif (!dom.hasClass(previewElm, value)) {\n\t\t\t\tdom.addClass(previewElm, value);\n\t\t\t}\n\t\t});\n\n\t\teditor.fire('PreviewFormats');\n\n\t\t// Add the previewElm outside the visual area\n\t\tdom.setStyles(previewFrag, {position: 'absolute', left: -0xFFFF});\n\t\teditor.getBody().appendChild(previewFrag);\n\n\t\t// Get parent container font size so we can compute px values out of em/% for older IE:s\n\t\tparentFontSize = dom.getStyle(editor.getBody(), 'fontSize', true);\n\t\tparentFontSize = /px$/.test(parentFontSize) ? parseInt(parentFontSize, 10) : 0;\n\n\t\teach(previewStyles.split(' '), function(name) {\n\t\t\tvar value = dom.getStyle(previewElm, name, true);\n\n\t\t\t// If background is transparent then check if the body has a background color we can use\n\t\t\tif (name == 'background-color' && /transparent|rgba\\s*\\([^)]+,\\s*0\\)/.test(value)) {\n\t\t\t\tvalue = dom.getStyle(editor.getBody(), name, true);\n\n\t\t\t\t// Ignore white since it's the default color, not the nicest fix\n\t\t\t\t// TODO: Fix this by detecting runtime style\n\t\t\t\tif (dom.toHex(value).toLowerCase() == '#ffffff') {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (name == 'color') {\n\t\t\t\t// Ignore black since it's the default color, not the nicest fix\n\t\t\t\t// TODO: Fix this by detecting runtime style\n\t\t\t\tif (dom.toHex(value).toLowerCase() == '#000000') {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Old IE won't calculate the font size so we need to do that manually\n\t\t\tif (name == 'font-size') {\n\t\t\t\tif (/em|%$/.test(value)) {\n\t\t\t\t\tif (parentFontSize === 0) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Convert font size from em/% to px\n\t\t\t\t\tvalue = parseFloat(value, 10) / (/%$/.test(value) ? 100 : 1);\n\t\t\t\t\tvalue = (value * parentFontSize) + 'px';\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (name == \"border\" && value) {\n\t\t\t\tpreviewCss += 'padding:0 2px;';\n\t\t\t}\n\n\t\t\tpreviewCss += name + ':' + value + ';';\n\t\t});\n\n\t\teditor.fire('AfterPreviewFormats');\n\n\t\t//previewCss += 'line-height:normal';\n\n\t\tdom.remove(previewFrag);\n\n\t\treturn previewCss;\n\t}\n\n\treturn {\n\t\tgetCssText: getCssText,\n\t\tparseSelector: parseSelector,\n\t\tselectorToHtml: selectorToHtml\n\t};\n});\n\n// Included from: js/tinymce/classes/fmt/Hooks.js\n\n/**\n * Hooks.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Internal class for overriding formatting.\n *\n * @private\n * @class tinymce.fmt.Hooks\n */\ndefine(\"tinymce/fmt/Hooks\", [\n\t\"tinymce/util/Arr\",\n\t\"tinymce/dom/NodeType\",\n\t\"tinymce/dom/DomQuery\"\n], function(Arr, NodeType, $) {\n\tvar postProcessHooks = {}, filter = Arr.filter, each = Arr.each;\n\n\tfunction addPostProcessHook(name, hook) {\n\t\tvar hooks = postProcessHooks[name];\n\n\t\tif (!hooks) {\n\t\t\tpostProcessHooks[name] = hooks = [];\n\t\t}\n\n\t\tpostProcessHooks[name].push(hook);\n\t}\n\n\tfunction postProcess(name, editor) {\n\t\teach(postProcessHooks[name], function(hook) {\n\t\t\thook(editor);\n\t\t});\n\t}\n\n\taddPostProcessHook(\"pre\", function(editor) {\n\t\tvar rng = editor.selection.getRng(), isPre, blocks;\n\n\t\tfunction hasPreSibling(pre) {\n\t\t\treturn isPre(pre.previousSibling) && Arr.indexOf(blocks, pre.previousSibling) != -1;\n\t\t}\n\n\t\tfunction joinPre(pre1, pre2) {\n\t\t\t$(pre2).remove();\n\t\t\t$(pre1).append('<br><br>').append(pre2.childNodes);\n\t\t}\n\n\t\tisPre = NodeType.matchNodeNames('pre');\n\n\t\tif (!rng.collapsed) {\n\t\t\tblocks = editor.selection.getSelectedBlocks();\n\n\t\t\teach(filter(filter(blocks, isPre), hasPreSibling), function(pre) {\n\t\t\t\tjoinPre(pre.previousSibling, pre);\n\t\t\t});\n\t\t}\n\t});\n\n\treturn {\n\t\tpostProcess: postProcess\n\t};\n});\n\n// Included from: js/tinymce/classes/Formatter.js\n\n/**\n * Formatter.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Text formatter engine class. This class is used to apply formats like bold, italic, font size\n * etc to the current selection or specific nodes. This engine was built to replace the browser's\n * default formatting logic for execCommand due to its inconsistent and buggy behavior.\n *\n * @class tinymce.Formatter\n * @example\n *  tinymce.activeEditor.formatter.register('mycustomformat', {\n *    inline: 'span',\n *    styles: {color: '#ff0000'}\n *  });\n *\n *  tinymce.activeEditor.formatter.apply('mycustomformat');\n */\ndefine(\"tinymce/Formatter\", [\n\t\"tinymce/dom/TreeWalker\",\n\t\"tinymce/dom/RangeUtils\",\n\t\"tinymce/dom/BookmarkManager\",\n\t\"tinymce/dom/ElementUtils\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/fmt/Preview\",\n\t\"tinymce/fmt/Hooks\"\n], function(TreeWalker, RangeUtils, BookmarkManager, ElementUtils, Tools, Preview, Hooks) {\n\t/**\n\t * Constructs a new formatter instance.\n\t *\n\t * @constructor Formatter\n\t * @param {tinymce.Editor} ed Editor instance to construct the formatter engine to.\n\t */\n\treturn function(ed) {\n\t\tvar formats = {},\n\t\t\tdom = ed.dom,\n\t\t\tselection = ed.selection,\n\t\t\trangeUtils = new RangeUtils(dom),\n\t\t\tisValid = ed.schema.isValidChild,\n\t\t\tisBlock = dom.isBlock,\n\t\t\tforcedRootBlock = ed.settings.forced_root_block,\n\t\t\tnodeIndex = dom.nodeIndex,\n\t\t\tINVISIBLE_CHAR = '\\uFEFF',\n\t\t\tMCE_ATTR_RE = /^(src|href|style)$/,\n\t\t\tFALSE = false,\n\t\t\tTRUE = true,\n\t\t\tformatChangeData,\n\t\t\tundef,\n\t\t\tgetContentEditable = dom.getContentEditable,\n\t\t\tdisableCaretContainer,\n\t\t\tmarkCaretContainersBogus,\n\t\t\tisBookmarkNode = BookmarkManager.isBookmarkNode;\n\n\t\tvar each = Tools.each,\n\t\t\tgrep = Tools.grep,\n\t\t\twalk = Tools.walk,\n\t\t\textend = Tools.extend;\n\n\t\tfunction isTextBlock(name) {\n\t\t\tif (name.nodeType) {\n\t\t\t\tname = name.nodeName;\n\t\t\t}\n\n\t\t\treturn !!ed.schema.getTextBlockElements()[name.toLowerCase()];\n\t\t}\n\n\t\tfunction isTableCell(node) {\n\t\t\treturn /^(TH|TD)$/.test(node.nodeName);\n\t\t}\n\n\t\tfunction isInlineBlock(node) {\n\t\t\treturn node && /^(IMG)$/.test(node.nodeName);\n\t\t}\n\n\t\tfunction getParents(node, selector) {\n\t\t\treturn dom.getParents(node, selector, dom.getRoot());\n\t\t}\n\n\t\tfunction isCaretNode(node) {\n\t\t\treturn node.nodeType === 1 && node.id === '_mce_caret';\n\t\t}\n\n\t\tfunction defaultFormats() {\n\t\t\tregister({\n\t\t\t\tvaligntop: [\n\t\t\t\t\t{selector: 'td,th', styles: {'verticalAlign': 'top'}}\n\t\t\t\t],\n\n\t\t\t\tvalignmiddle: [\n\t\t\t\t\t{selector: 'td,th', styles: {'verticalAlign': 'middle'}}\n\t\t\t\t],\n\n\t\t\t\tvalignbottom: [\n\t\t\t\t\t{selector: 'td,th', styles: {'verticalAlign': 'bottom'}}\n\t\t\t\t],\n\n\t\t\t\talignleft: [\n\t\t\t\t\t{\n\t\t\t\t\t\tselector: 'figure.image',\n\t\t\t\t\t\tcollapsed: false,\n\t\t\t\t\t\tclasses: 'align-left',\n\t\t\t\t\t\tceFalseOverride: true,\n\t\t\t\t\t\tpreview: 'font-family font-size'\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tselector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',\n\t\t\t\t\t\tstyles: {\n\t\t\t\t\t\t\ttextAlign: 'left'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tinherit: false,\n\t\t\t\t\t\tpreview: false,\n\t\t\t\t\t\tdefaultBlock: 'div'\n\t\t\t\t\t},\n\t\t\t\t\t{selector: 'img,table', collapsed: false, styles: {'float': 'left'}, preview: 'font-family font-size'}\n\t\t\t\t],\n\n\t\t\t\taligncenter: [\n\t\t\t\t\t{\n\t\t\t\t\t\tselector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',\n\t\t\t\t\t\tstyles: {\n\t\t\t\t\t\t\ttextAlign: 'center'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tinherit: false,\n\t\t\t\t\t\tpreview: false,\n\t\t\t\t\t\tdefaultBlock: 'div'\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tselector: 'figure.image',\n\t\t\t\t\t\tcollapsed: false,\n\t\t\t\t\t\tclasses: 'align-center',\n\t\t\t\t\t\tceFalseOverride: true,\n\t\t\t\t\t\tpreview: 'font-family font-size'\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tselector: 'img',\n\t\t\t\t\t\tcollapsed: false,\n\t\t\t\t\t\tstyles: {\n\t\t\t\t\t\t\tdisplay: 'block',\n\t\t\t\t\t\t\tmarginLeft: 'auto',\n\t\t\t\t\t\t\tmarginRight: 'auto'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tpreview: false\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tselector: 'table',\n\t\t\t\t\t\tcollapsed: false,\n\t\t\t\t\t\tstyles: {\n\t\t\t\t\t\t\tmarginLeft: 'auto',\n\t\t\t\t\t\t\tmarginRight: 'auto'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tpreview: 'font-family font-size'\n\t\t\t\t\t}\n\t\t\t\t],\n\n\t\t\t\talignright: [\n\t\t\t\t\t{\n\t\t\t\t\t\tselector: 'figure.image',\n\t\t\t\t\t\tcollapsed: false,\n\t\t\t\t\t\tclasses: 'align-right',\n\t\t\t\t\t\tceFalseOverride: true,\n\t\t\t\t\t\tpreview: 'font-family font-size'\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tselector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',\n\t\t\t\t\t\tstyles: {\n\t\t\t\t\t\t\ttextAlign: 'right'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tinherit: false,\n\t\t\t\t\t\tpreview: 'font-family font-size',\n\t\t\t\t\t\tdefaultBlock: 'div'\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tselector: 'img,table',\n\t\t\t\t\t\tcollapsed: false,\n\t\t\t\t\t\tstyles: {\n\t\t\t\t\t\t\t'float': 'right'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tpreview: 'font-family font-size'\n\t\t\t\t\t}\n\t\t\t\t],\n\n\t\t\t\talignjustify: [\n\t\t\t\t\t{\n\t\t\t\t\t\tselector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',\n\t\t\t\t\t\tstyles: {\n\t\t\t\t\t\t\ttextAlign: 'justify'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tinherit: false,\n\t\t\t\t\t\tdefaultBlock: 'div',\n\t\t\t\t\t\tpreview: 'font-family font-size'\n\t\t\t\t\t}\n\t\t\t\t],\n\n\t\t\t\tbold: [\n\t\t\t\t\t{inline: 'strong', remove: 'all'},\n\t\t\t\t\t{inline: 'span', styles: {fontWeight: 'bold'}},\n\t\t\t\t\t{inline: 'b', remove: 'all'}\n\t\t\t\t],\n\n\t\t\t\titalic: [\n\t\t\t\t\t{inline: 'em', remove: 'all'},\n\t\t\t\t\t{inline: 'span', styles: {fontStyle: 'italic'}},\n\t\t\t\t\t{inline: 'i', remove: 'all'}\n\t\t\t\t],\n\n\t\t\t\tunderline: [\n\t\t\t\t\t{inline: 'span', styles: {textDecoration: 'underline'}, exact: true},\n\t\t\t\t\t{inline: 'u', remove: 'all'}\n\t\t\t\t],\n\n\t\t\t\tstrikethrough: [\n\t\t\t\t\t{inline: 'span', styles: {textDecoration: 'line-through'}, exact: true},\n\t\t\t\t\t{inline: 'strike', remove: 'all'}\n\t\t\t\t],\n\n\t\t\t\tforecolor: {inline: 'span', styles: {color: '%value'}, links: true, remove_similar: true},\n\t\t\t\thilitecolor: {inline: 'span', styles: {backgroundColor: '%value'}, links: true, remove_similar: true},\n\t\t\t\tfontname: {inline: 'span', styles: {fontFamily: '%value'}},\n\t\t\t\tfontsize: {inline: 'span', styles: {fontSize: '%value'}},\n\t\t\t\tfontsize_class: {inline: 'span', attributes: {'class': '%value'}},\n\t\t\t\tblockquote: {block: 'blockquote', wrapper: 1, remove: 'all'},\n\t\t\t\tsubscript: {inline: 'sub'},\n\t\t\t\tsuperscript: {inline: 'sup'},\n\t\t\t\tcode: {inline: 'code'},\n\n\t\t\t\tlink: {inline: 'a', selector: 'a', remove: 'all', split: true, deep: true,\n\t\t\t\t\tonmatch: function() {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t},\n\n\t\t\t\t\tonformat: function(elm, fmt, vars) {\n\t\t\t\t\t\teach(vars, function(value, key) {\n\t\t\t\t\t\t\tdom.setAttrib(elm, key, value);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\tremoveformat: [\n\t\t\t\t\t{\n\t\t\t\t\t\tselector: 'b,strong,em,i,font,u,strike,sub,sup,dfn,code,samp,kbd,var,cite,mark,q,del,ins',\n\t\t\t\t\t\tremove: 'all',\n\t\t\t\t\t\tsplit: true,\n\t\t\t\t\t\texpand: false,\n\t\t\t\t\t\tblock_expand: true,\n\t\t\t\t\t\tdeep: true\n\t\t\t\t\t},\n\t\t\t\t\t{selector: 'span', attributes: ['style', 'class'], remove: 'empty', split: true, expand: false, deep: true},\n\t\t\t\t\t{selector: '*', attributes: ['style', 'class'], split: false, expand: false, deep: true}\n\t\t\t\t]\n\t\t\t});\n\n\t\t\t// Register default block formats\n\t\t\teach('p h1 h2 h3 h4 h5 h6 div address pre div dt dd samp'.split(/\\s/), function(name) {\n\t\t\t\tregister(name, {block: name, remove: 'all'});\n\t\t\t});\n\n\t\t\t// Register user defined formats\n\t\t\tregister(ed.settings.formats);\n\t\t}\n\n\t\tfunction addKeyboardShortcuts() {\n\t\t\t// Add some inline shortcuts\n\t\t\ted.addShortcut('meta+b', 'bold_desc', 'Bold');\n\t\t\ted.addShortcut('meta+i', 'italic_desc', 'Italic');\n\t\t\ted.addShortcut('meta+u', 'underline_desc', 'Underline');\n\n\t\t\t// BlockFormat shortcuts keys\n\t\t\tfor (var i = 1; i <= 6; i++) {\n\t\t\t\ted.addShortcut('access+' + i, '', ['FormatBlock', false, 'h' + i]);\n\t\t\t}\n\n\t\t\ted.addShortcut('access+7', '', ['FormatBlock', false, 'p']);\n\t\t\ted.addShortcut('access+8', '', ['FormatBlock', false, 'div']);\n\t\t\ted.addShortcut('access+9', '', ['FormatBlock', false, 'address']);\n\t\t}\n\n\t\t// Public functions\n\n\t\t/**\n\t\t * Returns the format by name or all formats if no name is specified.\n\t\t *\n\t\t * @method get\n\t\t * @param {String} name Optional name to retrieve by.\n\t\t * @return {Array/Object} Array/Object with all registered formats or a specific format.\n\t\t */\n\t\tfunction get(name) {\n\t\t\treturn name ? formats[name] : formats;\n\t\t}\n\n\t\t/**\n\t\t * Registers a specific format by name.\n\t\t *\n\t\t * @method register\n\t\t * @param {Object/String} name Name of the format for example \"bold\".\n\t\t * @param {Object/Array} format Optional format object or array of format variants\n\t\t * can only be omitted if the first arg is an object.\n\t\t */\n\t\tfunction register(name, format) {\n\t\t\tif (name) {\n\t\t\t\tif (typeof name !== 'string') {\n\t\t\t\t\teach(name, function(format, name) {\n\t\t\t\t\t\tregister(name, format);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\t// Force format into array and add it to internal collection\n\t\t\t\t\tformat = format.length ? format : [format];\n\n\t\t\t\t\teach(format, function(format) {\n\t\t\t\t\t\t// Set deep to false by default on selector formats this to avoid removing\n\t\t\t\t\t\t// alignment on images inside paragraphs when alignment is changed on paragraphs\n\t\t\t\t\t\tif (format.deep === undef) {\n\t\t\t\t\t\t\tformat.deep = !format.selector;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Default to true\n\t\t\t\t\t\tif (format.split === undef) {\n\t\t\t\t\t\t\tformat.split = !format.selector || format.inline;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Default to true\n\t\t\t\t\t\tif (format.remove === undef && format.selector && !format.inline) {\n\t\t\t\t\t\t\tformat.remove = 'none';\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Mark format as a mixed format inline + block level\n\t\t\t\t\t\tif (format.selector && format.inline) {\n\t\t\t\t\t\t\tformat.mixed = true;\n\t\t\t\t\t\t\tformat.block_expand = true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Split classes if needed\n\t\t\t\t\t\tif (typeof format.classes === 'string') {\n\t\t\t\t\t\t\tformat.classes = format.classes.split(/\\s+/);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tformats[name] = format;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Unregister a specific format by name.\n\t\t *\n\t\t * @method unregister\n\t\t * @param {String} name Name of the format for example \"bold\".\n\t\t */\n\t\tfunction unregister(name) {\n\t\t\tif (name && formats[name]) {\n\t\t\t\tdelete formats[name];\n\t\t\t}\n\n\t\t\treturn formats;\n\t\t}\n\n\t\tfunction matchesUnInheritedFormatSelector(node, name) {\n\t\t\tvar formatList = get(name);\n\n\t\t\tif (formatList) {\n\t\t\t\tfor (var i = 0; i < formatList.length; i++) {\n\t\t\t\t\tif (formatList[i].inherit === false && dom.is(node, formatList[i].selector)) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\tfunction getTextDecoration(node) {\n\t\t\tvar decoration;\n\n\t\t\ted.dom.getParent(node, function(n) {\n\t\t\t\tdecoration = ed.dom.getStyle(n, 'text-decoration');\n\t\t\t\treturn decoration && decoration !== 'none';\n\t\t\t});\n\n\t\t\treturn decoration;\n\t\t}\n\n\t\tfunction processUnderlineAndColor(node) {\n\t\t\tvar textDecoration;\n\t\t\tif (node.nodeType === 1 && node.parentNode && node.parentNode.nodeType === 1) {\n\t\t\t\ttextDecoration = getTextDecoration(node.parentNode);\n\t\t\t\tif (ed.dom.getStyle(node, 'color') && textDecoration) {\n\t\t\t\t\ted.dom.setStyle(node, 'text-decoration', textDecoration);\n\t\t\t\t} else if (ed.dom.getStyle(node, 'text-decoration') === textDecoration) {\n\t\t\t\t\ted.dom.setStyle(node, 'text-decoration', null);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Applies the specified format to the current selection or specified node.\n\t\t *\n\t\t * @method apply\n\t\t * @param {String} name Name of format to apply.\n\t\t * @param {Object} vars Optional list of variables to replace within format before applying it.\n\t\t * @param {Node} node Optional node to apply the format to defaults to current selection.\n\t\t */\n\t\tfunction apply(name, vars, node) {\n\t\t\tvar formatList = get(name), format = formatList[0], bookmark, rng, isCollapsed = !node && selection.isCollapsed();\n\n\t\t\tfunction setElementFormat(elm, fmt) {\n\t\t\t\tfmt = fmt || format;\n\n\t\t\t\tif (elm) {\n\t\t\t\t\tif (fmt.onformat) {\n\t\t\t\t\t\tfmt.onformat(elm, fmt, vars, node);\n\t\t\t\t\t}\n\n\t\t\t\t\teach(fmt.styles, function(value, name) {\n\t\t\t\t\t\tdom.setStyle(elm, name, replaceVars(value, vars));\n\t\t\t\t\t});\n\n\t\t\t\t\t// Needed for the WebKit span spam bug\n\t\t\t\t\t// TODO: Remove this once WebKit/Blink fixes this\n\t\t\t\t\tif (fmt.styles) {\n\t\t\t\t\t\tvar styleVal = dom.getAttrib(elm, 'style');\n\n\t\t\t\t\t\tif (styleVal) {\n\t\t\t\t\t\t\telm.setAttribute('data-mce-style', styleVal);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\teach(fmt.attributes, function(value, name) {\n\t\t\t\t\t\tdom.setAttrib(elm, name, replaceVars(value, vars));\n\t\t\t\t\t});\n\n\t\t\t\t\teach(fmt.classes, function(value) {\n\t\t\t\t\t\tvalue = replaceVars(value, vars);\n\n\t\t\t\t\t\tif (!dom.hasClass(elm, value)) {\n\t\t\t\t\t\t\tdom.addClass(elm, value);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction applyNodeStyle(formatList, node) {\n\t\t\t\tvar found = false;\n\n\t\t\t\tif (!format.selector) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Look for matching formats\n\t\t\t\teach(formatList, function(format) {\n\t\t\t\t\t// Check collapsed state if it exists\n\t\t\t\t\tif ('collapsed' in format && format.collapsed !== isCollapsed) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (dom.is(node, format.selector) && !isCaretNode(node)) {\n\t\t\t\t\t\tsetElementFormat(node, format);\n\t\t\t\t\t\tfound = true;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn found;\n\t\t\t}\n\n\t\t\t// This converts: <p>[a</p><p>]b</p> -> <p>[a]</p><p>b</p>\n\t\t\tfunction adjustSelectionToVisibleSelection() {\n\t\t\t\tfunction findSelectionEnd(start, end) {\n\t\t\t\t\tvar walker = new TreeWalker(end);\n\t\t\t\t\tfor (node = walker.prev2(); node; node = walker.prev2()) {\n\t\t\t\t\t\tif (node.nodeType == 3 && node.data.length > 0) {\n\t\t\t\t\t\t\treturn node;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (node.childNodes.length > 1 || node == start || node.tagName == 'BR') {\n\t\t\t\t\t\t\treturn node;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Adjust selection so that a end container with a end offset of zero is not included in the selection\n\t\t\t\t// as this isn't visible to the user.\n\t\t\t\tvar rng = ed.selection.getRng();\n\t\t\t\tvar start = rng.startContainer;\n\t\t\t\tvar end = rng.endContainer;\n\n\t\t\t\tif (start != end && rng.endOffset === 0) {\n\t\t\t\t\tvar newEnd = findSelectionEnd(start, end);\n\t\t\t\t\tvar endOffset = newEnd.nodeType == 3 ? newEnd.data.length : newEnd.childNodes.length;\n\n\t\t\t\t\trng.setEnd(newEnd, endOffset);\n\t\t\t\t}\n\n\t\t\t\treturn rng;\n\t\t\t}\n\n\t\t\tfunction applyRngStyle(rng, bookmark, node_specific) {\n\t\t\t\tvar newWrappers = [], wrapName, wrapElm, contentEditable = true;\n\n\t\t\t\t// Setup wrapper element\n\t\t\t\twrapName = format.inline || format.block;\n\t\t\t\twrapElm = dom.create(wrapName);\n\t\t\t\tsetElementFormat(wrapElm);\n\n\t\t\t\trangeUtils.walk(rng, function(nodes) {\n\t\t\t\t\tvar currentWrapElm;\n\n\t\t\t\t\t/**\n\t\t\t\t\t * Process a list of nodes wrap them.\n\t\t\t\t\t */\n\t\t\t\t\tfunction process(node) {\n\t\t\t\t\t\tvar nodeName, parentName, hasContentEditableState, lastContentEditable;\n\n\t\t\t\t\t\tlastContentEditable = contentEditable;\n\t\t\t\t\t\tnodeName = node.nodeName.toLowerCase();\n\t\t\t\t\t\tparentName = node.parentNode.nodeName.toLowerCase();\n\n\t\t\t\t\t\t// Node has a contentEditable value\n\t\t\t\t\t\tif (node.nodeType === 1 && getContentEditable(node)) {\n\t\t\t\t\t\t\tlastContentEditable = contentEditable;\n\t\t\t\t\t\t\tcontentEditable = getContentEditable(node) === \"true\";\n\t\t\t\t\t\t\thasContentEditableState = true; // We don't want to wrap the container only it's children\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Stop wrapping on br elements\n\t\t\t\t\t\tif (isEq(nodeName, 'br')) {\n\t\t\t\t\t\t\tcurrentWrapElm = 0;\n\n\t\t\t\t\t\t\t// Remove any br elements when we wrap things\n\t\t\t\t\t\t\tif (format.block) {\n\t\t\t\t\t\t\t\tdom.remove(node);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// If node is wrapper type\n\t\t\t\t\t\tif (format.wrapper && matchNode(node, name, vars)) {\n\t\t\t\t\t\t\tcurrentWrapElm = 0;\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Can we rename the block\n\t\t\t\t\t\t// TODO: Break this if up, too complex\n\t\t\t\t\t\tif (contentEditable && !hasContentEditableState && format.block &&\n\t\t\t\t\t\t\t!format.wrapper && isTextBlock(nodeName) && isValid(parentName, wrapName)) {\n\t\t\t\t\t\t\tnode = dom.rename(node, wrapName);\n\t\t\t\t\t\t\tsetElementFormat(node);\n\t\t\t\t\t\t\tnewWrappers.push(node);\n\t\t\t\t\t\t\tcurrentWrapElm = 0;\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Handle selector patterns\n\t\t\t\t\t\tif (format.selector) {\n\t\t\t\t\t\t\tvar found = applyNodeStyle(formatList, node);\n\n\t\t\t\t\t\t\t// Continue processing if a selector match wasn't found and a inline element is defined\n\t\t\t\t\t\t\tif (!format.inline || found) {\n\t\t\t\t\t\t\t\tcurrentWrapElm = 0;\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Is it valid to wrap this item\n\t\t\t\t\t\t// TODO: Break this if up, too complex\n\t\t\t\t\t\tif (contentEditable && !hasContentEditableState && isValid(wrapName, nodeName) && isValid(parentName, wrapName) &&\n\t\t\t\t\t\t\t\t!(!node_specific && node.nodeType === 3 &&\n\t\t\t\t\t\t\t\tnode.nodeValue.length === 1 &&\n\t\t\t\t\t\t\t\tnode.nodeValue.charCodeAt(0) === 65279) &&\n\t\t\t\t\t\t\t\t!isCaretNode(node) &&\n\t\t\t\t\t\t\t\t(!format.inline || !isBlock(node))) {\n\t\t\t\t\t\t\t// Start wrapping\n\t\t\t\t\t\t\tif (!currentWrapElm) {\n\t\t\t\t\t\t\t\t// Wrap the node\n\t\t\t\t\t\t\t\tcurrentWrapElm = dom.clone(wrapElm, FALSE);\n\t\t\t\t\t\t\t\tnode.parentNode.insertBefore(currentWrapElm, node);\n\t\t\t\t\t\t\t\tnewWrappers.push(currentWrapElm);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tcurrentWrapElm.appendChild(node);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Start a new wrapper for possible children\n\t\t\t\t\t\t\tcurrentWrapElm = 0;\n\n\t\t\t\t\t\t\teach(grep(node.childNodes), process);\n\n\t\t\t\t\t\t\tif (hasContentEditableState) {\n\t\t\t\t\t\t\t\tcontentEditable = lastContentEditable; // Restore last contentEditable state from stack\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// End the last wrapper\n\t\t\t\t\t\t\tcurrentWrapElm = 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Process siblings from range\n\t\t\t\t\teach(nodes, process);\n\t\t\t\t});\n\n\t\t\t\t// Apply formats to links as well to get the color of the underline to change as well\n\t\t\t\tif (format.links === true) {\n\t\t\t\t\teach(newWrappers, function(node) {\n\t\t\t\t\t\tfunction process(node) {\n\t\t\t\t\t\t\tif (node.nodeName === 'A') {\n\t\t\t\t\t\t\t\tsetElementFormat(node, format);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\teach(grep(node.childNodes), process);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tprocess(node);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t// Cleanup\n\t\t\t\teach(newWrappers, function(node) {\n\t\t\t\t\tvar childCount;\n\n\t\t\t\t\tfunction getChildCount(node) {\n\t\t\t\t\t\tvar count = 0;\n\n\t\t\t\t\t\teach(node.childNodes, function(node) {\n\t\t\t\t\t\t\tif (!isWhiteSpaceNode(node) && !isBookmarkNode(node)) {\n\t\t\t\t\t\t\t\tcount++;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn count;\n\t\t\t\t\t}\n\n\t\t\t\t\tfunction mergeStyles(node) {\n\t\t\t\t\t\tvar child, clone;\n\n\t\t\t\t\t\teach(node.childNodes, function(node) {\n\t\t\t\t\t\t\tif (node.nodeType == 1 && !isBookmarkNode(node) && !isCaretNode(node)) {\n\t\t\t\t\t\t\t\tchild = node;\n\t\t\t\t\t\t\t\treturn FALSE; // break loop\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// If child was found and of the same type as the current node\n\t\t\t\t\t\tif (child && !isBookmarkNode(child) && matchName(child, format)) {\n\t\t\t\t\t\t\tclone = dom.clone(child, FALSE);\n\t\t\t\t\t\t\tsetElementFormat(clone);\n\n\t\t\t\t\t\t\tdom.replace(clone, node, TRUE);\n\t\t\t\t\t\t\tdom.remove(child, 1);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn clone || node;\n\t\t\t\t\t}\n\n\t\t\t\t\tchildCount = getChildCount(node);\n\n\t\t\t\t\t// Remove empty nodes but only if there is multiple wrappers and they are not block\n\t\t\t\t\t// elements so never remove single <h1></h1> since that would remove the\n\t\t\t\t\t// current empty block element where the caret is at\n\t\t\t\t\tif ((newWrappers.length > 1 || !isBlock(node)) && childCount === 0) {\n\t\t\t\t\t\tdom.remove(node, 1);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (format.inline || format.wrapper) {\n\t\t\t\t\t\t// Merges the current node with it's children of similar type to reduce the number of elements\n\t\t\t\t\t\tif (!format.exact && childCount === 1) {\n\t\t\t\t\t\t\tnode = mergeStyles(node);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Remove/merge children\n\t\t\t\t\t\teach(formatList, function(format) {\n\t\t\t\t\t\t\t// Merge all children of similar type will move styles from child to parent\n\t\t\t\t\t\t\t// this: <span style=\"color:red\"><b><span style=\"color:red; font-size:10px\">text</span></b></span>\n\t\t\t\t\t\t\t// will become: <span style=\"color:red\"><b><span style=\"font-size:10px\">text</span></b></span>\n\t\t\t\t\t\t\teach(dom.select(format.inline, node), function(child) {\n\t\t\t\t\t\t\t\tif (isBookmarkNode(child)) {\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tremoveFormat(format, vars, child, format.exact ? child : null);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// Remove child if direct parent is of same type\n\t\t\t\t\t\tif (matchNode(node.parentNode, name, vars)) {\n\t\t\t\t\t\t\tdom.remove(node, 1);\n\t\t\t\t\t\t\tnode = 0;\n\t\t\t\t\t\t\treturn TRUE;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Look for parent with similar style format\n\t\t\t\t\t\tif (format.merge_with_parents) {\n\t\t\t\t\t\t\tdom.getParent(node.parentNode, function(parent) {\n\t\t\t\t\t\t\t\tif (matchNode(parent, name, vars)) {\n\t\t\t\t\t\t\t\t\tdom.remove(node, 1);\n\t\t\t\t\t\t\t\t\tnode = 0;\n\t\t\t\t\t\t\t\t\treturn TRUE;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Merge next and previous siblings if they are similar <b>text</b><b>text</b> becomes <b>texttext</b>\n\t\t\t\t\t\tif (node && format.merge_siblings !== false) {\n\t\t\t\t\t\t\tnode = mergeSiblings(getNonWhiteSpaceSibling(node), node);\n\t\t\t\t\t\t\tnode = mergeSiblings(node, getNonWhiteSpaceSibling(node, TRUE));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (getContentEditable(selection.getNode()) === \"false\") {\n\t\t\t\tnode = selection.getNode();\n\t\t\t\tfor (var i = 0, l = formatList.length; i < l; i++) {\n\t\t\t\t\tif (formatList[i].ceFalseOverride && dom.is(node, formatList[i].selector)) {\n\t\t\t\t\t\tsetElementFormat(node, formatList[i]);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (format) {\n\t\t\t\tif (node) {\n\t\t\t\t\tif (node.nodeType) {\n\t\t\t\t\t\tif (!applyNodeStyle(formatList, node)) {\n\t\t\t\t\t\t\trng = dom.createRng();\n\t\t\t\t\t\t\trng.setStartBefore(node);\n\t\t\t\t\t\t\trng.setEndAfter(node);\n\t\t\t\t\t\t\tapplyRngStyle(expandRng(rng, formatList), null, true);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tapplyRngStyle(node, null, true);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (!isCollapsed || !format.inline || dom.select('td[data-mce-selected],th[data-mce-selected]').length) {\n\t\t\t\t\t\t// Obtain selection node before selection is unselected by applyRngStyle()\n\t\t\t\t\t\tvar curSelNode = ed.selection.getNode();\n\n\t\t\t\t\t\t// If the formats have a default block and we can't find a parent block then\n\t\t\t\t\t\t// start wrapping it with a DIV this is for forced_root_blocks: false\n\t\t\t\t\t\t// It's kind of a hack but people should be using the default block type P since all desktop editors work that way\n\t\t\t\t\t\tif (!forcedRootBlock && formatList[0].defaultBlock && !dom.getParent(curSelNode, dom.isBlock)) {\n\t\t\t\t\t\t\tapply(formatList[0].defaultBlock);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Apply formatting to selection\n\t\t\t\t\t\ted.selection.setRng(adjustSelectionToVisibleSelection());\n\t\t\t\t\t\tbookmark = selection.getBookmark();\n\t\t\t\t\t\tapplyRngStyle(expandRng(selection.getRng(TRUE), formatList), bookmark);\n\n\t\t\t\t\t\t// Colored nodes should be underlined so that the color of the underline matches the text color.\n\t\t\t\t\t\tif (format.styles && (format.styles.color || format.styles.textDecoration)) {\n\t\t\t\t\t\t\twalk(curSelNode, processUnderlineAndColor, 'childNodes');\n\t\t\t\t\t\t\tprocessUnderlineAndColor(curSelNode);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tselection.moveToBookmark(bookmark);\n\t\t\t\t\t\tmoveStart(selection.getRng(TRUE));\n\t\t\t\t\t\ted.nodeChanged();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tperformCaretAction('apply', name, vars);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tHooks.postProcess(name, ed);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Removes the specified format from the current selection or specified node.\n\t\t *\n\t\t * @method remove\n\t\t * @param {String} name Name of format to remove.\n\t\t * @param {Object} vars Optional list of variables to replace within format before removing it.\n\t\t * @param {Node/Range} node Optional node or DOM range to remove the format from defaults to current selection.\n\t\t */\n\t\tfunction remove(name, vars, node, similar) {\n\t\t\tvar formatList = get(name), format = formatList[0], bookmark, rng, contentEditable = true;\n\n\t\t\t// Merges the styles for each node\n\t\t\tfunction process(node) {\n\t\t\t\tvar children, i, l, lastContentEditable, hasContentEditableState;\n\n\t\t\t\t// Node has a contentEditable value\n\t\t\t\tif (node.nodeType === 1 && getContentEditable(node)) {\n\t\t\t\t\tlastContentEditable = contentEditable;\n\t\t\t\t\tcontentEditable = getContentEditable(node) === \"true\";\n\t\t\t\t\thasContentEditableState = true; // We don't want to wrap the container only it's children\n\t\t\t\t}\n\n\t\t\t\t// Grab the children first since the nodelist might be changed\n\t\t\t\tchildren = grep(node.childNodes);\n\n\t\t\t\t// Process current node\n\t\t\t\tif (contentEditable && !hasContentEditableState) {\n\t\t\t\t\tfor (i = 0, l = formatList.length; i < l; i++) {\n\t\t\t\t\t\tif (removeFormat(formatList[i], vars, node, node)) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Process the children\n\t\t\t\tif (format.deep) {\n\t\t\t\t\tif (children.length) {\n\t\t\t\t\t\tfor (i = 0, l = children.length; i < l; i++) {\n\t\t\t\t\t\t\tprocess(children[i]);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (hasContentEditableState) {\n\t\t\t\t\t\t\tcontentEditable = lastContentEditable; // Restore last contentEditable state from stack\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction findFormatRoot(container) {\n\t\t\t\tvar formatRoot;\n\n\t\t\t\t// Find format root\n\t\t\t\teach(getParents(container.parentNode).reverse(), function(parent) {\n\t\t\t\t\tvar format;\n\n\t\t\t\t\t// Find format root element\n\t\t\t\t\tif (!formatRoot && parent.id != '_start' && parent.id != '_end') {\n\t\t\t\t\t\t// Is the node matching the format we are looking for\n\t\t\t\t\t\tformat = matchNode(parent, name, vars, similar);\n\t\t\t\t\t\tif (format && format.split !== false) {\n\t\t\t\t\t\t\tformatRoot = parent;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn formatRoot;\n\t\t\t}\n\n\t\t\tfunction wrapAndSplit(formatRoot, container, target, split) {\n\t\t\t\tvar parent, clone, lastClone, firstClone, i, formatRootParent;\n\n\t\t\t\t// Format root found then clone formats and split it\n\t\t\t\tif (formatRoot) {\n\t\t\t\t\tformatRootParent = formatRoot.parentNode;\n\n\t\t\t\t\tfor (parent = container.parentNode; parent && parent != formatRootParent; parent = parent.parentNode) {\n\t\t\t\t\t\tclone = dom.clone(parent, FALSE);\n\n\t\t\t\t\t\tfor (i = 0; i < formatList.length; i++) {\n\t\t\t\t\t\t\tif (removeFormat(formatList[i], vars, clone, clone)) {\n\t\t\t\t\t\t\t\tclone = 0;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Build wrapper node\n\t\t\t\t\t\tif (clone) {\n\t\t\t\t\t\t\tif (lastClone) {\n\t\t\t\t\t\t\t\tclone.appendChild(lastClone);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (!firstClone) {\n\t\t\t\t\t\t\t\tfirstClone = clone;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tlastClone = clone;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Never split block elements if the format is mixed\n\t\t\t\t\tif (split && (!format.mixed || !isBlock(formatRoot))) {\n\t\t\t\t\t\tcontainer = dom.split(formatRoot, container);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Wrap container in cloned formats\n\t\t\t\t\tif (lastClone) {\n\t\t\t\t\t\ttarget.parentNode.insertBefore(lastClone, target);\n\t\t\t\t\t\tfirstClone.appendChild(target);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn container;\n\t\t\t}\n\n\t\t\tfunction splitToFormatRoot(container) {\n\t\t\t\treturn wrapAndSplit(findFormatRoot(container), container, container, true);\n\t\t\t}\n\n\t\t\tfunction unwrap(start) {\n\t\t\t\tvar node = dom.get(start ? '_start' : '_end'),\n\t\t\t\t\tout = node[start ? 'firstChild' : 'lastChild'];\n\n\t\t\t\t// If the end is placed within the start the result will be removed\n\t\t\t\t// So this checks if the out node is a bookmark node if it is it\n\t\t\t\t// checks for another more suitable node\n\t\t\t\tif (isBookmarkNode(out)) {\n\t\t\t\t\tout = out[start ? 'firstChild' : 'lastChild'];\n\t\t\t\t}\n\n\t\t\t\t// Since dom.remove removes empty text nodes then we need to try to find a better node\n\t\t\t\tif (out.nodeType == 3 && out.data.length === 0) {\n\t\t\t\t\tout = start ? node.previousSibling || node.nextSibling : node.nextSibling || node.previousSibling;\n\t\t\t\t}\n\n\t\t\t\tdom.remove(node, true);\n\n\t\t\t\treturn out;\n\t\t\t}\n\n\t\t\tfunction removeRngStyle(rng) {\n\t\t\t\tvar startContainer, endContainer;\n\t\t\t\tvar commonAncestorContainer = rng.commonAncestorContainer;\n\n\t\t\t\trng = expandRng(rng, formatList, TRUE);\n\n\t\t\t\tif (format.split) {\n\t\t\t\t\tstartContainer = getContainer(rng, TRUE);\n\t\t\t\t\tendContainer = getContainer(rng);\n\n\t\t\t\t\tif (startContainer != endContainer) {\n\t\t\t\t\t\t// WebKit will render the table incorrectly if we wrap a TH or TD in a SPAN\n\t\t\t\t\t\t// so let's see if we can use the first child instead\n\t\t\t\t\t\t// This will happen if you triple click a table cell and use remove formatting\n\t\t\t\t\t\tif (/^(TR|TH|TD)$/.test(startContainer.nodeName) && startContainer.firstChild) {\n\t\t\t\t\t\t\tif (startContainer.nodeName == \"TR\") {\n\t\t\t\t\t\t\t\tstartContainer = startContainer.firstChild.firstChild || startContainer;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tstartContainer = startContainer.firstChild || startContainer;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Try to adjust endContainer as well if cells on the same row were selected - bug #6410\n\t\t\t\t\t\tif (commonAncestorContainer &&\n\t\t\t\t\t\t\t/^T(HEAD|BODY|FOOT|R)$/.test(commonAncestorContainer.nodeName) &&\n\t\t\t\t\t\t\tisTableCell(endContainer) && endContainer.firstChild) {\n\t\t\t\t\t\t\tendContainer = endContainer.firstChild || endContainer;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (dom.isChildOf(startContainer, endContainer) && !isBlock(endContainer) &&\n\t\t\t\t\t\t\t!isTableCell(startContainer) && !isTableCell(endContainer)) {\n\t\t\t\t\t\t\tstartContainer = wrap(startContainer, 'span', {id: '_start', 'data-mce-type': 'bookmark'});\n\t\t\t\t\t\t\tsplitToFormatRoot(startContainer);\n\t\t\t\t\t\t\tstartContainer = unwrap(TRUE);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Wrap start/end nodes in span element since these might be cloned/moved\n\t\t\t\t\t\tstartContainer = wrap(startContainer, 'span', {id: '_start', 'data-mce-type': 'bookmark'});\n\t\t\t\t\t\tendContainer = wrap(endContainer, 'span', {id: '_end', 'data-mce-type': 'bookmark'});\n\n\t\t\t\t\t\t// Split start/end\n\t\t\t\t\t\tsplitToFormatRoot(startContainer);\n\t\t\t\t\t\tsplitToFormatRoot(endContainer);\n\n\t\t\t\t\t\t// Unwrap start/end to get real elements again\n\t\t\t\t\t\tstartContainer = unwrap(TRUE);\n\t\t\t\t\t\tendContainer = unwrap();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstartContainer = endContainer = splitToFormatRoot(startContainer);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Update range positions since they might have changed after the split operations\n\t\t\t\t\trng.startContainer = startContainer.parentNode ? startContainer.parentNode : startContainer;\n\t\t\t\t\trng.startOffset = nodeIndex(startContainer);\n\t\t\t\t\trng.endContainer = endContainer.parentNode ? endContainer.parentNode : endContainer;\n\t\t\t\t\trng.endOffset = nodeIndex(endContainer) + 1;\n\t\t\t\t}\n\n\t\t\t\t// Remove items between start/end\n\t\t\t\trangeUtils.walk(rng, function(nodes) {\n\t\t\t\t\teach(nodes, function(node) {\n\t\t\t\t\t\tprocess(node);\n\n\t\t\t\t\t\t// Remove parent span if it only contains text-decoration: underline, yet a parent node is also underlined.\n\t\t\t\t\t\tif (node.nodeType === 1 && ed.dom.getStyle(node, 'text-decoration') === 'underline' &&\n\t\t\t\t\t\t\tnode.parentNode && getTextDecoration(node.parentNode) === 'underline') {\n\t\t\t\t\t\t\tremoveFormat({\n\t\t\t\t\t\t\t\t'deep': false,\n\t\t\t\t\t\t\t\t'exact': true,\n\t\t\t\t\t\t\t\t'inline': 'span',\n\t\t\t\t\t\t\t\t'styles': {\n\t\t\t\t\t\t\t\t\t'textDecoration': 'underline'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}, null, node);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Handle node\n\t\t\tif (node) {\n\t\t\t\tif (node.nodeType) {\n\t\t\t\t\trng = dom.createRng();\n\t\t\t\t\trng.setStartBefore(node);\n\t\t\t\t\trng.setEndAfter(node);\n\t\t\t\t\tremoveRngStyle(rng);\n\t\t\t\t} else {\n\t\t\t\t\tremoveRngStyle(node);\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (getContentEditable(selection.getNode()) === \"false\") {\n\t\t\t\tnode = selection.getNode();\n\t\t\t\tfor (var i = 0, l = formatList.length; i < l; i++) {\n\t\t\t\t\tif (formatList[i].ceFalseOverride) {\n\t\t\t\t\t\tif (removeFormat(formatList[i], vars, node, node)) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!selection.isCollapsed() || !format.inline || dom.select('td[data-mce-selected],th[data-mce-selected]').length) {\n\t\t\t\tbookmark = selection.getBookmark();\n\t\t\t\tremoveRngStyle(selection.getRng(TRUE));\n\t\t\t\tselection.moveToBookmark(bookmark);\n\n\t\t\t\t// Check if start element still has formatting then we are at: \"<b>text|</b>text\"\n\t\t\t\t// and need to move the start into the next text node\n\t\t\t\tif (format.inline && match(name, vars, selection.getStart())) {\n\t\t\t\t\tmoveStart(selection.getRng(true));\n\t\t\t\t}\n\n\t\t\t\ted.nodeChanged();\n\t\t\t} else {\n\t\t\t\tperformCaretAction('remove', name, vars, similar);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Toggles the specified format on/off.\n\t\t *\n\t\t * @method toggle\n\t\t * @param {String} name Name of format to apply/remove.\n\t\t * @param {Object} vars Optional list of variables to replace within format before applying/removing it.\n\t\t * @param {Node} node Optional node to apply the format to or remove from. Defaults to current selection.\n\t\t */\n\t\tfunction toggle(name, vars, node) {\n\t\t\tvar fmt = get(name);\n\n\t\t\tif (match(name, vars, node) && (!('toggle' in fmt[0]) || fmt[0].toggle)) {\n\t\t\t\tremove(name, vars, node);\n\t\t\t} else {\n\t\t\t\tapply(name, vars, node);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Return true/false if the specified node has the specified format.\n\t\t *\n\t\t * @method matchNode\n\t\t * @param {Node} node Node to check the format on.\n\t\t * @param {String} name Format name to check.\n\t\t * @param {Object} vars Optional list of variables to replace before checking it.\n\t\t * @param {Boolean} similar Match format that has similar properties.\n\t\t * @return {Object} Returns the format object it matches or undefined if it doesn't match.\n\t\t */\n\t\tfunction matchNode(node, name, vars, similar) {\n\t\t\tvar formatList = get(name), format, i, classes;\n\n\t\t\tfunction matchItems(node, format, item_name) {\n\t\t\t\tvar key, value, items = format[item_name], i;\n\n\t\t\t\t// Custom match\n\t\t\t\tif (format.onmatch) {\n\t\t\t\t\treturn format.onmatch(node, format, item_name);\n\t\t\t\t}\n\n\t\t\t\t// Check all items\n\t\t\t\tif (items) {\n\t\t\t\t\t// Non indexed object\n\t\t\t\t\tif (items.length === undef) {\n\t\t\t\t\t\tfor (key in items) {\n\t\t\t\t\t\t\tif (items.hasOwnProperty(key)) {\n\t\t\t\t\t\t\t\tif (item_name === 'attributes') {\n\t\t\t\t\t\t\t\t\tvalue = dom.getAttrib(node, key);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tvalue = getStyle(node, key);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (similar && !value && !format.exact) {\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif ((!similar || format.exact) && !isEq(value, normalizeStyleValue(replaceVars(items[key], vars), key))) {\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Only one match needed for indexed arrays\n\t\t\t\t\t\tfor (i = 0; i < items.length; i++) {\n\t\t\t\t\t\t\tif (item_name === 'attributes' ? dom.getAttrib(node, items[i]) : getStyle(node, items[i])) {\n\t\t\t\t\t\t\t\treturn format;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn format;\n\t\t\t}\n\n\t\t\tif (formatList && node) {\n\t\t\t\t// Check each format in list\n\t\t\t\tfor (i = 0; i < formatList.length; i++) {\n\t\t\t\t\tformat = formatList[i];\n\n\t\t\t\t\t// Name name, attributes, styles and classes\n\t\t\t\t\tif (matchName(node, format) && matchItems(node, format, 'attributes') && matchItems(node, format, 'styles')) {\n\t\t\t\t\t\t// Match classes\n\t\t\t\t\t\tif ((classes = format.classes)) {\n\t\t\t\t\t\t\tfor (i = 0; i < classes.length; i++) {\n\t\t\t\t\t\t\t\tif (!dom.hasClass(node, classes[i])) {\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn format;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Matches the current selection or specified node against the specified format name.\n\t\t *\n\t\t * @method match\n\t\t * @param {String} name Name of format to match.\n\t\t * @param {Object} vars Optional list of variables to replace before checking it.\n\t\t * @param {Node} node Optional node to check.\n\t\t * @return {boolean} true/false if the specified selection/node matches the format.\n\t\t */\n\t\tfunction match(name, vars, node) {\n\t\t\tvar startNode;\n\n\t\t\tfunction matchParents(node) {\n\t\t\t\tvar root = dom.getRoot();\n\n\t\t\t\tif (node === root) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Find first node with similar format settings\n\t\t\t\tnode = dom.getParent(node, function(node) {\n\t\t\t\t\tif (matchesUnInheritedFormatSelector(node, name)) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn node.parentNode === root || !!matchNode(node, name, vars, true);\n\t\t\t\t});\n\n\t\t\t\t// Do an exact check on the similar format element\n\t\t\t\treturn matchNode(node, name, vars);\n\t\t\t}\n\n\t\t\t// Check specified node\n\t\t\tif (node) {\n\t\t\t\treturn matchParents(node);\n\t\t\t}\n\n\t\t\t// Check selected node\n\t\t\tnode = selection.getNode();\n\t\t\tif (matchParents(node)) {\n\t\t\t\treturn TRUE;\n\t\t\t}\n\n\t\t\t// Check start node if it's different\n\t\t\tstartNode = selection.getStart();\n\t\t\tif (startNode != node) {\n\t\t\t\tif (matchParents(startNode)) {\n\t\t\t\t\treturn TRUE;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn FALSE;\n\t\t}\n\n\t\t/**\n\t\t * Matches the current selection against the array of formats and returns a new array with matching formats.\n\t\t *\n\t\t * @method matchAll\n\t\t * @param {Array} names Name of format to match.\n\t\t * @param {Object} vars Optional list of variables to replace before checking it.\n\t\t * @return {Array} Array with matched formats.\n\t\t */\n\t\tfunction matchAll(names, vars) {\n\t\t\tvar startElement, matchedFormatNames = [], checkedMap = {};\n\n\t\t\t// Check start of selection for formats\n\t\t\tstartElement = selection.getStart();\n\t\t\tdom.getParent(startElement, function(node) {\n\t\t\t\tvar i, name;\n\n\t\t\t\tfor (i = 0; i < names.length; i++) {\n\t\t\t\t\tname = names[i];\n\n\t\t\t\t\tif (!checkedMap[name] && matchNode(node, name, vars)) {\n\t\t\t\t\t\tcheckedMap[name] = true;\n\t\t\t\t\t\tmatchedFormatNames.push(name);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, dom.getRoot());\n\n\t\t\treturn matchedFormatNames;\n\t\t}\n\n\t\t/**\n\t\t * Returns true/false if the specified format can be applied to the current selection or not. It\n\t\t * will currently only check the state for selector formats, it returns true on all other format types.\n\t\t *\n\t\t * @method canApply\n\t\t * @param {String} name Name of format to check.\n\t\t * @return {boolean} true/false if the specified format can be applied to the current selection/node.\n\t\t */\n\t\tfunction canApply(name) {\n\t\t\tvar formatList = get(name), startNode, parents, i, x, selector;\n\n\t\t\tif (formatList) {\n\t\t\t\tstartNode = selection.getStart();\n\t\t\t\tparents = getParents(startNode);\n\n\t\t\t\tfor (x = formatList.length - 1; x >= 0; x--) {\n\t\t\t\t\tselector = formatList[x].selector;\n\n\t\t\t\t\t// Format is not selector based then always return TRUE\n\t\t\t\t\t// Is it has a defaultBlock then it's likely it can be applied for example align on a non block element line\n\t\t\t\t\tif (!selector || formatList[x].defaultBlock) {\n\t\t\t\t\t\treturn TRUE;\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (i = parents.length - 1; i >= 0; i--) {\n\t\t\t\t\t\tif (dom.is(parents[i], selector)) {\n\t\t\t\t\t\t\treturn TRUE;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn FALSE;\n\t\t}\n\n\t\t/**\n\t\t * Executes the specified callback when the current selection matches the formats or not.\n\t\t *\n\t\t * @method formatChanged\n\t\t * @param {String} formats Comma separated list of formats to check for.\n\t\t * @param {function} callback Callback with state and args when the format is changed/toggled on/off.\n\t\t * @param {Boolean} similar True/false state if the match should handle similar or exact formats.\n\t\t */\n\t\tfunction formatChanged(formats, callback, similar) {\n\t\t\tvar currentFormats;\n\n\t\t\t// Setup format node change logic\n\t\t\tif (!formatChangeData) {\n\t\t\t\tformatChangeData = {};\n\t\t\t\tcurrentFormats = {};\n\n\t\t\t\ted.on('NodeChange', function(e) {\n\t\t\t\t\tvar parents = getParents(e.element), matchedFormats = {};\n\n\t\t\t\t\t// Ignore bogus nodes like the <a> tag created by moveStart()\n\t\t\t\t\tparents = Tools.grep(parents, function(node) {\n\t\t\t\t\t\treturn node.nodeType == 1 && !node.getAttribute('data-mce-bogus');\n\t\t\t\t\t});\n\n\t\t\t\t\t// Check for new formats\n\t\t\t\t\teach(formatChangeData, function(callbacks, format) {\n\t\t\t\t\t\teach(parents, function(node) {\n\t\t\t\t\t\t\tif (matchNode(node, format, {}, callbacks.similar)) {\n\t\t\t\t\t\t\t\tif (!currentFormats[format]) {\n\t\t\t\t\t\t\t\t\t// Execute callbacks\n\t\t\t\t\t\t\t\t\teach(callbacks, function(callback) {\n\t\t\t\t\t\t\t\t\t\tcallback(true, {node: node, format: format, parents: parents});\n\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\tcurrentFormats[format] = callbacks;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tmatchedFormats[format] = callbacks;\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (matchesUnInheritedFormatSelector(node, format)) {\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\n\t\t\t\t\t// Check if current formats still match\n\t\t\t\t\teach(currentFormats, function(callbacks, format) {\n\t\t\t\t\t\tif (!matchedFormats[format]) {\n\t\t\t\t\t\t\tdelete currentFormats[format];\n\n\t\t\t\t\t\t\teach(callbacks, function(callback) {\n\t\t\t\t\t\t\t\tcallback(false, {node: e.element, format: format, parents: parents});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Add format listeners\n\t\t\teach(formats.split(','), function(format) {\n\t\t\t\tif (!formatChangeData[format]) {\n\t\t\t\t\tformatChangeData[format] = [];\n\t\t\t\t\tformatChangeData[format].similar = similar;\n\t\t\t\t}\n\n\t\t\t\tformatChangeData[format].push(callback);\n\t\t\t});\n\n\t\t\treturn this;\n\t\t}\n\n\t\t/**\n\t\t * Returns a preview css text for the specified format.\n\t\t *\n\t\t * @method getCssText\n\t\t * @param {String/Object} format Format to generate preview css text for.\n\t\t * @return {String} Css text for the specified format.\n\t\t * @example\n\t\t * var cssText1 = editor.formatter.getCssText('bold');\n\t\t * var cssText2 = editor.formatter.getCssText({inline: 'b'});\n\t\t */\n\t\tfunction getCssText(format) {\n\t\t\treturn Preview.getCssText(ed, format);\n\t\t}\n\n\t\t// Expose to public\n\t\textend(this, {\n\t\t\tget: get,\n\t\t\tregister: register,\n\t\t\tunregister: unregister,\n\t\t\tapply: apply,\n\t\t\tremove: remove,\n\t\t\ttoggle: toggle,\n\t\t\tmatch: match,\n\t\t\tmatchAll: matchAll,\n\t\t\tmatchNode: matchNode,\n\t\t\tcanApply: canApply,\n\t\t\tformatChanged: formatChanged,\n\t\t\tgetCssText: getCssText\n\t\t});\n\n\t\t// Initialize\n\t\tdefaultFormats();\n\t\taddKeyboardShortcuts();\n\t\ted.on('BeforeGetContent', function(e) {\n\t\t\tif (markCaretContainersBogus && e.format != 'raw') {\n\t\t\t\tmarkCaretContainersBogus();\n\t\t\t}\n\t\t});\n\t\ted.on('mouseup keydown', function(e) {\n\t\t\tif (disableCaretContainer) {\n\t\t\t\tdisableCaretContainer(e);\n\t\t\t}\n\t\t});\n\n\t\t// Private functions\n\n\t\t/**\n\t\t * Checks if the specified nodes name matches the format inline/block or selector.\n\t\t *\n\t\t * @private\n\t\t * @param {Node} node Node to match against the specified format.\n\t\t * @param {Object} format Format object o match with.\n\t\t * @return {boolean} true/false if the format matches.\n\t\t */\n\t\tfunction matchName(node, format) {\n\t\t\t// Check for inline match\n\t\t\tif (isEq(node, format.inline)) {\n\t\t\t\treturn TRUE;\n\t\t\t}\n\n\t\t\t// Check for block match\n\t\t\tif (isEq(node, format.block)) {\n\t\t\t\treturn TRUE;\n\t\t\t}\n\n\t\t\t// Check for selector match\n\t\t\tif (format.selector) {\n\t\t\t\treturn node.nodeType == 1 && dom.is(node, format.selector);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Compares two string/nodes regardless of their case.\n\t\t *\n\t\t * @private\n\t\t * @param {String/Node} str1 Node or string to compare.\n\t\t * @param {String/Node} str2 Node or string to compare.\n\t\t * @return {boolean} True/false if they match.\n\t\t */\n\t\tfunction isEq(str1, str2) {\n\t\t\tstr1 = str1 || '';\n\t\t\tstr2 = str2 || '';\n\n\t\t\tstr1 = '' + (str1.nodeName || str1);\n\t\t\tstr2 = '' + (str2.nodeName || str2);\n\n\t\t\treturn str1.toLowerCase() == str2.toLowerCase();\n\t\t}\n\n\t\t/**\n\t\t * Returns the style by name on the specified node. This method modifies the style\n\t\t * contents to make it more easy to match. This will resolve a few browser issues.\n\t\t *\n\t\t * @private\n\t\t * @param {Node} node to get style from.\n\t\t * @param {String} name Style name to get.\n\t\t * @return {String} Style item value.\n\t\t */\n\t\tfunction getStyle(node, name) {\n\t\t\treturn normalizeStyleValue(dom.getStyle(node, name), name);\n\t\t}\n\n\t\t/**\n\t\t * Normalize style value by name. This method modifies the style contents\n\t\t * to make it more easy to match. This will resolve a few browser issues.\n\t\t *\n\t\t * @private\n\t\t * @param {String} value Value to get style from.\n\t\t * @param {String} name Style name to get.\n\t\t * @return {String} Style item value.\n\t\t */\n\t\tfunction normalizeStyleValue(value, name) {\n\t\t\t// Force the format to hex\n\t\t\tif (name == 'color' || name == 'backgroundColor') {\n\t\t\t\tvalue = dom.toHex(value);\n\t\t\t}\n\n\t\t\t// Opera will return bold as 700\n\t\t\tif (name == 'fontWeight' && value == 700) {\n\t\t\t\tvalue = 'bold';\n\t\t\t}\n\n\t\t\t// Normalize fontFamily so \"'Font name', Font\" becomes: \"Font name,Font\"\n\t\t\tif (name == 'fontFamily') {\n\t\t\t\tvalue = value.replace(/[\\'\\\"]/g, '').replace(/,\\s+/g, ',');\n\t\t\t}\n\n\t\t\treturn '' + value;\n\t\t}\n\n\t\t/**\n\t\t * Replaces variables in the value. The variable format is %var.\n\t\t *\n\t\t * @private\n\t\t * @param {String} value Value to replace variables in.\n\t\t * @param {Object} vars Name/value array with variables to replace.\n\t\t * @return {String} New value with replaced variables.\n\t\t */\n\t\tfunction replaceVars(value, vars) {\n\t\t\tif (typeof value != \"string\") {\n\t\t\t\tvalue = value(vars);\n\t\t\t} else if (vars) {\n\t\t\t\tvalue = value.replace(/%(\\w+)/g, function(str, name) {\n\t\t\t\t\treturn vars[name] || str;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn value;\n\t\t}\n\n\t\tfunction isWhiteSpaceNode(node) {\n\t\t\treturn node && node.nodeType === 3 && /^([\\t \\r\\n]+|)$/.test(node.nodeValue);\n\t\t}\n\n\t\tfunction wrap(node, name, attrs) {\n\t\t\tvar wrapper = dom.create(name, attrs);\n\n\t\t\tnode.parentNode.insertBefore(wrapper, node);\n\t\t\twrapper.appendChild(node);\n\n\t\t\treturn wrapper;\n\t\t}\n\n\t\t/**\n\t\t * Expands the specified range like object to depending on format.\n\t\t *\n\t\t * For example on block formats it will move the start/end position\n\t\t * to the beginning of the current block.\n\t\t *\n\t\t * @private\n\t\t * @param {Object} rng Range like object.\n\t\t * @param {Array} format Array with formats to expand by.\n\t\t * @param {Boolean} remove\n\t\t * @return {Object} Expanded range like object.\n\t\t */\n\t\tfunction expandRng(rng, format, remove) {\n\t\t\tvar lastIdx, leaf, endPoint,\n\t\t\t\tstartContainer = rng.startContainer,\n\t\t\t\tstartOffset = rng.startOffset,\n\t\t\t\tendContainer = rng.endContainer,\n\t\t\t\tendOffset = rng.endOffset;\n\n\t\t\t// This function walks up the tree if there is no siblings before/after the node\n\t\t\tfunction findParentContainer(start) {\n\t\t\t\tvar container, parent, sibling, siblingName, root;\n\n\t\t\t\tcontainer = parent = start ? startContainer : endContainer;\n\t\t\t\tsiblingName = start ? 'previousSibling' : 'nextSibling';\n\t\t\t\troot = dom.getRoot();\n\n\t\t\t\tfunction isBogusBr(node) {\n\t\t\t\t\treturn node.nodeName == \"BR\" && node.getAttribute('data-mce-bogus') && !node.nextSibling;\n\t\t\t\t}\n\n\t\t\t\t// If it's a text node and the offset is inside the text\n\t\t\t\tif (container.nodeType == 3 && !isWhiteSpaceNode(container)) {\n\t\t\t\t\tif (start ? startOffset > 0 : endOffset < container.nodeValue.length) {\n\t\t\t\t\t\treturn container;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t/*eslint no-constant-condition:0 */\n\t\t\t\twhile (true) {\n\t\t\t\t\t// Stop expanding on block elements\n\t\t\t\t\tif (!format[0].block_expand && isBlock(parent)) {\n\t\t\t\t\t\treturn parent;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Walk left/right\n\t\t\t\t\tfor (sibling = parent[siblingName]; sibling; sibling = sibling[siblingName]) {\n\t\t\t\t\t\tif (!isBookmarkNode(sibling) && !isWhiteSpaceNode(sibling) && !isBogusBr(sibling)) {\n\t\t\t\t\t\t\treturn parent;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Check if we can move up are we at root level or body level\n\t\t\t\t\tif (parent == root || parent.parentNode == root) {\n\t\t\t\t\t\tcontainer = parent;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tparent = parent.parentNode;\n\t\t\t\t}\n\n\t\t\t\treturn container;\n\t\t\t}\n\n\t\t\t// This function walks down the tree to find the leaf at the selection.\n\t\t\t// The offset is also returned as if node initially a leaf, the offset may be in the middle of the text node.\n\t\t\tfunction findLeaf(node, offset) {\n\t\t\t\tif (offset === undef) {\n\t\t\t\t\toffset = node.nodeType === 3 ? node.length : node.childNodes.length;\n\t\t\t\t}\n\n\t\t\t\twhile (node && node.hasChildNodes()) {\n\t\t\t\t\tnode = node.childNodes[offset];\n\t\t\t\t\tif (node) {\n\t\t\t\t\t\toffset = node.nodeType === 3 ? node.length : node.childNodes.length;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn {node: node, offset: offset};\n\t\t\t}\n\n\t\t\t// If index based start position then resolve it\n\t\t\tif (startContainer.nodeType == 1 && startContainer.hasChildNodes()) {\n\t\t\t\tlastIdx = startContainer.childNodes.length - 1;\n\t\t\t\tstartContainer = startContainer.childNodes[startOffset > lastIdx ? lastIdx : startOffset];\n\n\t\t\t\tif (startContainer.nodeType == 3) {\n\t\t\t\t\tstartOffset = 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// If index based end position then resolve it\n\t\t\tif (endContainer.nodeType == 1 && endContainer.hasChildNodes()) {\n\t\t\t\tlastIdx = endContainer.childNodes.length - 1;\n\t\t\t\tendContainer = endContainer.childNodes[endOffset > lastIdx ? lastIdx : endOffset - 1];\n\n\t\t\t\tif (endContainer.nodeType == 3) {\n\t\t\t\t\tendOffset = endContainer.nodeValue.length;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Expands the node to the closes contentEditable false element if it exists\n\t\t\tfunction findParentContentEditable(node) {\n\t\t\t\tvar parent = node;\n\n\t\t\t\twhile (parent) {\n\t\t\t\t\tif (parent.nodeType === 1 && getContentEditable(parent)) {\n\t\t\t\t\t\treturn getContentEditable(parent) === \"false\" ? parent : node;\n\t\t\t\t\t}\n\n\t\t\t\t\tparent = parent.parentNode;\n\t\t\t\t}\n\n\t\t\t\treturn node;\n\t\t\t}\n\n\t\t\tfunction findWordEndPoint(container, offset, start) {\n\t\t\t\tvar walker, node, pos, lastTextNode;\n\n\t\t\t\tfunction findSpace(node, offset) {\n\t\t\t\t\tvar pos, pos2, str = node.nodeValue;\n\n\t\t\t\t\tif (typeof offset == \"undefined\") {\n\t\t\t\t\t\toffset = start ? str.length : 0;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (start) {\n\t\t\t\t\t\tpos = str.lastIndexOf(' ', offset);\n\t\t\t\t\t\tpos2 = str.lastIndexOf('\\u00a0', offset);\n\t\t\t\t\t\tpos = pos > pos2 ? pos : pos2;\n\n\t\t\t\t\t\t// Include the space on remove to avoid tag soup\n\t\t\t\t\t\tif (pos !== -1 && !remove) {\n\t\t\t\t\t\t\tpos++;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpos = str.indexOf(' ', offset);\n\t\t\t\t\t\tpos2 = str.indexOf('\\u00a0', offset);\n\t\t\t\t\t\tpos = pos !== -1 && (pos2 === -1 || pos < pos2) ? pos : pos2;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn pos;\n\t\t\t\t}\n\n\t\t\t\tif (container.nodeType === 3) {\n\t\t\t\t\tpos = findSpace(container, offset);\n\n\t\t\t\t\tif (pos !== -1) {\n\t\t\t\t\t\treturn {container: container, offset: pos};\n\t\t\t\t\t}\n\n\t\t\t\t\tlastTextNode = container;\n\t\t\t\t}\n\n\t\t\t\t// Walk the nodes inside the block\n\t\t\t\twalker = new TreeWalker(container, dom.getParent(container, isBlock) || ed.getBody());\n\t\t\t\twhile ((node = walker[start ? 'prev' : 'next']())) {\n\t\t\t\t\tif (node.nodeType === 3) {\n\t\t\t\t\t\tlastTextNode = node;\n\t\t\t\t\t\tpos = findSpace(node);\n\n\t\t\t\t\t\tif (pos !== -1) {\n\t\t\t\t\t\t\treturn {container: node, offset: pos};\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (isBlock(node)) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (lastTextNode) {\n\t\t\t\t\tif (start) {\n\t\t\t\t\t\toffset = 0;\n\t\t\t\t\t} else {\n\t\t\t\t\t\toffset = lastTextNode.length;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn {container: lastTextNode, offset: offset};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction findSelectorEndPoint(container, sibling_name) {\n\t\t\t\tvar parents, i, y, curFormat;\n\n\t\t\t\tif (container.nodeType == 3 && container.nodeValue.length === 0 && container[sibling_name]) {\n\t\t\t\t\tcontainer = container[sibling_name];\n\t\t\t\t}\n\n\t\t\t\tparents = getParents(container);\n\t\t\t\tfor (i = 0; i < parents.length; i++) {\n\t\t\t\t\tfor (y = 0; y < format.length; y++) {\n\t\t\t\t\t\tcurFormat = format[y];\n\n\t\t\t\t\t\t// If collapsed state is set then skip formats that doesn't match that\n\t\t\t\t\t\tif (\"collapsed\" in curFormat && curFormat.collapsed !== rng.collapsed) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (dom.is(parents[i], curFormat.selector)) {\n\t\t\t\t\t\t\treturn parents[i];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn container;\n\t\t\t}\n\n\t\t\tfunction findBlockEndPoint(container, sibling_name) {\n\t\t\t\tvar node, root = dom.getRoot();\n\n\t\t\t\t// Expand to block of similar type\n\t\t\t\tif (!format[0].wrapper) {\n\t\t\t\t\tnode = dom.getParent(container, format[0].block, root);\n\t\t\t\t}\n\n\t\t\t\t// Expand to first wrappable block element or any block element\n\t\t\t\tif (!node) {\n\t\t\t\t\tnode = dom.getParent(container.nodeType == 3 ? container.parentNode : container, function(node) {\n\t\t\t\t\t\t// Fixes #6183 where it would expand to editable parent element in inline mode\n\t\t\t\t\t\treturn node != root && isTextBlock(node);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t// Exclude inner lists from wrapping\n\t\t\t\tif (node && format[0].wrapper) {\n\t\t\t\t\tnode = getParents(node, 'ul,ol').reverse()[0] || node;\n\t\t\t\t}\n\n\t\t\t\t// Didn't find a block element look for first/last wrappable element\n\t\t\t\tif (!node) {\n\t\t\t\t\tnode = container;\n\n\t\t\t\t\twhile (node[sibling_name] && !isBlock(node[sibling_name])) {\n\t\t\t\t\t\tnode = node[sibling_name];\n\n\t\t\t\t\t\t// Break on BR but include it will be removed later on\n\t\t\t\t\t\t// we can't remove it now since we need to check if it can be wrapped\n\t\t\t\t\t\tif (isEq(node, 'br')) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn node || container;\n\t\t\t}\n\n\t\t\t// Expand to closest contentEditable element\n\t\t\tstartContainer = findParentContentEditable(startContainer);\n\t\t\tendContainer = findParentContentEditable(endContainer);\n\n\t\t\t// Exclude bookmark nodes if possible\n\t\t\tif (isBookmarkNode(startContainer.parentNode) || isBookmarkNode(startContainer)) {\n\t\t\t\tstartContainer = isBookmarkNode(startContainer) ? startContainer : startContainer.parentNode;\n\t\t\t\tstartContainer = startContainer.nextSibling || startContainer;\n\n\t\t\t\tif (startContainer.nodeType == 3) {\n\t\t\t\t\tstartOffset = 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (isBookmarkNode(endContainer.parentNode) || isBookmarkNode(endContainer)) {\n\t\t\t\tendContainer = isBookmarkNode(endContainer) ? endContainer : endContainer.parentNode;\n\t\t\t\tendContainer = endContainer.previousSibling || endContainer;\n\n\t\t\t\tif (endContainer.nodeType == 3) {\n\t\t\t\t\tendOffset = endContainer.length;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (format[0].inline) {\n\t\t\t\tif (rng.collapsed) {\n\t\t\t\t\t// Expand left to closest word boundary\n\t\t\t\t\tendPoint = findWordEndPoint(startContainer, startOffset, true);\n\t\t\t\t\tif (endPoint) {\n\t\t\t\t\t\tstartContainer = endPoint.container;\n\t\t\t\t\t\tstartOffset = endPoint.offset;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Expand right to closest word boundary\n\t\t\t\t\tendPoint = findWordEndPoint(endContainer, endOffset);\n\t\t\t\t\tif (endPoint) {\n\t\t\t\t\t\tendContainer = endPoint.container;\n\t\t\t\t\t\tendOffset = endPoint.offset;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Avoid applying formatting to a trailing space.\n\t\t\t\tleaf = findLeaf(endContainer, endOffset);\n\t\t\t\tif (leaf.node) {\n\t\t\t\t\twhile (leaf.node && leaf.offset === 0 && leaf.node.previousSibling) {\n\t\t\t\t\t\tleaf = findLeaf(leaf.node.previousSibling);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (leaf.node && leaf.offset > 0 && leaf.node.nodeType === 3 &&\n\t\t\t\t\t\t\tleaf.node.nodeValue.charAt(leaf.offset - 1) === ' ') {\n\n\t\t\t\t\t\tif (leaf.offset > 1) {\n\t\t\t\t\t\t\tendContainer = leaf.node;\n\t\t\t\t\t\t\tendContainer.splitText(leaf.offset - 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Move start/end point up the tree if the leaves are sharp and if we are in different containers\n\t\t\t// Example * becomes !: !<p><b><i>*text</i><i>text*</i></b></p>!\n\t\t\t// This will reduce the number of wrapper elements that needs to be created\n\t\t\t// Move start point up the tree\n\t\t\tif (format[0].inline || format[0].block_expand) {\n\t\t\t\tif (!format[0].inline || (startContainer.nodeType != 3 || startOffset === 0)) {\n\t\t\t\t\tstartContainer = findParentContainer(true);\n\t\t\t\t}\n\n\t\t\t\tif (!format[0].inline || (endContainer.nodeType != 3 || endOffset === endContainer.nodeValue.length)) {\n\t\t\t\t\tendContainer = findParentContainer();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Expand start/end container to matching selector\n\t\t\tif (format[0].selector && format[0].expand !== FALSE && !format[0].inline) {\n\t\t\t\t// Find new startContainer/endContainer if there is better one\n\t\t\t\tstartContainer = findSelectorEndPoint(startContainer, 'previousSibling');\n\t\t\t\tendContainer = findSelectorEndPoint(endContainer, 'nextSibling');\n\t\t\t}\n\n\t\t\t// Expand start/end container to matching block element or text node\n\t\t\tif (format[0].block || format[0].selector) {\n\t\t\t\t// Find new startContainer/endContainer if there is better one\n\t\t\t\tstartContainer = findBlockEndPoint(startContainer, 'previousSibling');\n\t\t\t\tendContainer = findBlockEndPoint(endContainer, 'nextSibling');\n\n\t\t\t\t// Non block element then try to expand up the leaf\n\t\t\t\tif (format[0].block) {\n\t\t\t\t\tif (!isBlock(startContainer)) {\n\t\t\t\t\t\tstartContainer = findParentContainer(true);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!isBlock(endContainer)) {\n\t\t\t\t\t\tendContainer = findParentContainer();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Setup index for startContainer\n\t\t\tif (startContainer.nodeType == 1) {\n\t\t\t\tstartOffset = nodeIndex(startContainer);\n\t\t\t\tstartContainer = startContainer.parentNode;\n\t\t\t}\n\n\t\t\t// Setup index for endContainer\n\t\t\tif (endContainer.nodeType == 1) {\n\t\t\t\tendOffset = nodeIndex(endContainer) + 1;\n\t\t\t\tendContainer = endContainer.parentNode;\n\t\t\t}\n\n\t\t\t// Return new range like object\n\t\t\treturn {\n\t\t\t\tstartContainer: startContainer,\n\t\t\t\tstartOffset: startOffset,\n\t\t\t\tendContainer: endContainer,\n\t\t\t\tendOffset: endOffset\n\t\t\t};\n\t\t}\n\n\t\tfunction isColorFormatAndAnchor(node, format) {\n\t\t\treturn format.links && node.tagName == 'A';\n\t\t}\n\n\t\t/**\n\t\t * Removes the specified format for the specified node. It will also remove the node if it doesn't have\n\t\t * any attributes if the format specifies it to do so.\n\t\t *\n\t\t * @private\n\t\t * @param {Object} format Format object with items to remove from node.\n\t\t * @param {Object} vars Name/value object with variables to apply to format.\n\t\t * @param {Node} node Node to remove the format styles on.\n\t\t * @param {Node} compare_node Optional compare node, if specified the styles will be compared to that node.\n\t\t * @return {Boolean} True/false if the node was removed or not.\n\t\t */\n\t\tfunction removeFormat(format, vars, node, compare_node) {\n\t\t\tvar i, attrs, stylesModified;\n\n\t\t\t// Check if node matches format\n\t\t\tif (!matchName(node, format) && !isColorFormatAndAnchor(node, format)) {\n\t\t\t\treturn FALSE;\n\t\t\t}\n\n\t\t\t// Should we compare with format attribs and styles\n\t\t\tif (format.remove != 'all') {\n\t\t\t\t// Remove styles\n\t\t\t\teach(format.styles, function(value, name) {\n\t\t\t\t\tvalue = normalizeStyleValue(replaceVars(value, vars), name);\n\n\t\t\t\t\t// Indexed array\n\t\t\t\t\tif (typeof name === 'number') {\n\t\t\t\t\t\tname = value;\n\t\t\t\t\t\tcompare_node = 0;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (format.remove_similar || (!compare_node || isEq(getStyle(compare_node, name), value))) {\n\t\t\t\t\t\tdom.setStyle(node, name, '');\n\t\t\t\t\t}\n\n\t\t\t\t\tstylesModified = 1;\n\t\t\t\t});\n\n\t\t\t\t// Remove style attribute if it's empty\n\t\t\t\tif (stylesModified && dom.getAttrib(node, 'style') === '') {\n\t\t\t\t\tnode.removeAttribute('style');\n\t\t\t\t\tnode.removeAttribute('data-mce-style');\n\t\t\t\t}\n\n\t\t\t\t// Remove attributes\n\t\t\t\teach(format.attributes, function(value, name) {\n\t\t\t\t\tvar valueOut;\n\n\t\t\t\t\tvalue = replaceVars(value, vars);\n\n\t\t\t\t\t// Indexed array\n\t\t\t\t\tif (typeof name === 'number') {\n\t\t\t\t\t\tname = value;\n\t\t\t\t\t\tcompare_node = 0;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!compare_node || isEq(dom.getAttrib(compare_node, name), value)) {\n\t\t\t\t\t\t// Keep internal classes\n\t\t\t\t\t\tif (name == 'class') {\n\t\t\t\t\t\t\tvalue = dom.getAttrib(node, name);\n\t\t\t\t\t\t\tif (value) {\n\t\t\t\t\t\t\t\t// Build new class value where everything is removed except the internal prefixed classes\n\t\t\t\t\t\t\t\tvalueOut = '';\n\t\t\t\t\t\t\t\teach(value.split(/\\s+/), function(cls) {\n\t\t\t\t\t\t\t\t\tif (/mce\\-\\w+/.test(cls)) {\n\t\t\t\t\t\t\t\t\t\tvalueOut += (valueOut ? ' ' : '') + cls;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t// We got some internal classes left\n\t\t\t\t\t\t\t\tif (valueOut) {\n\t\t\t\t\t\t\t\t\tdom.setAttrib(node, name, valueOut);\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// IE6 has a bug where the attribute doesn't get removed correctly\n\t\t\t\t\t\tif (name == \"class\") {\n\t\t\t\t\t\t\tnode.removeAttribute('className');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Remove mce prefixed attributes\n\t\t\t\t\t\tif (MCE_ATTR_RE.test(name)) {\n\t\t\t\t\t\t\tnode.removeAttribute('data-mce-' + name);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnode.removeAttribute(name);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Remove classes\n\t\t\t\teach(format.classes, function(value) {\n\t\t\t\t\tvalue = replaceVars(value, vars);\n\n\t\t\t\t\tif (!compare_node || dom.hasClass(compare_node, value)) {\n\t\t\t\t\t\tdom.removeClass(node, value);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Check for non internal attributes\n\t\t\t\tattrs = dom.getAttribs(node);\n\t\t\t\tfor (i = 0; i < attrs.length; i++) {\n\t\t\t\t\tvar attrName = attrs[i].nodeName;\n\t\t\t\t\tif (attrName.indexOf('_') !== 0 && attrName.indexOf('data-') !== 0) {\n\t\t\t\t\t\treturn FALSE;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Remove the inline child if it's empty for example <b> or <span>\n\t\t\tif (format.remove != 'none') {\n\t\t\t\tremoveNode(node, format);\n\t\t\t\treturn TRUE;\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Removes the node and wrap it's children in paragraphs before doing so or\n\t\t * appends BR elements to the beginning/end of the block element if forcedRootBlocks is disabled.\n\t\t *\n\t\t * If the div in the node below gets removed:\n\t\t *  text<div>text</div>text\n\t\t *\n\t\t * Output becomes:\n\t\t *  text<div><br />text<br /></div>text\n\t\t *\n\t\t * So when the div is removed the result is:\n\t\t *  text<br />text<br />text\n\t\t *\n\t\t * @private\n\t\t * @param {Node} node Node to remove + apply BR/P elements to.\n\t\t * @param {Object} format Format rule.\n\t\t * @return {Node} Input node.\n\t\t */\n\t\tfunction removeNode(node, format) {\n\t\t\tvar parentNode = node.parentNode, rootBlockElm;\n\n\t\t\tfunction find(node, next, inc) {\n\t\t\t\tnode = getNonWhiteSpaceSibling(node, next, inc);\n\n\t\t\t\treturn !node || (node.nodeName == 'BR' || isBlock(node));\n\t\t\t}\n\n\t\t\tif (format.block) {\n\t\t\t\tif (!forcedRootBlock) {\n\t\t\t\t\t// Append BR elements if needed before we remove the block\n\t\t\t\t\tif (isBlock(node) && !isBlock(parentNode)) {\n\t\t\t\t\t\tif (!find(node, FALSE) && !find(node.firstChild, TRUE, 1)) {\n\t\t\t\t\t\t\tnode.insertBefore(dom.create('br'), node.firstChild);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!find(node, TRUE) && !find(node.lastChild, FALSE, 1)) {\n\t\t\t\t\t\t\tnode.appendChild(dom.create('br'));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// Wrap the block in a forcedRootBlock if we are at the root of document\n\t\t\t\t\tif (parentNode == dom.getRoot()) {\n\t\t\t\t\t\tif (!format.list_block || !isEq(node, format.list_block)) {\n\t\t\t\t\t\t\teach(grep(node.childNodes), function(node) {\n\t\t\t\t\t\t\t\tif (isValid(forcedRootBlock, node.nodeName.toLowerCase())) {\n\t\t\t\t\t\t\t\t\tif (!rootBlockElm) {\n\t\t\t\t\t\t\t\t\t\trootBlockElm = wrap(node, forcedRootBlock);\n\t\t\t\t\t\t\t\t\t\tdom.setAttribs(rootBlockElm, ed.settings.forced_root_block_attrs);\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\trootBlockElm.appendChild(node);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\trootBlockElm = 0;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Never remove nodes that isn't the specified inline element if a selector is specified too\n\t\t\tif (format.selector && format.inline && !isEq(format.inline, node)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tdom.remove(node, 1);\n\t\t}\n\n\t\t/**\n\t\t * Returns the next/previous non whitespace node.\n\t\t *\n\t\t * @private\n\t\t * @param {Node} node Node to start at.\n\t\t * @param {boolean} next (Optional) Include next or previous node defaults to previous.\n\t\t * @param {boolean} inc (Optional) Include the current node in checking. Defaults to false.\n\t\t * @return {Node} Next or previous node or undefined if it wasn't found.\n\t\t */\n\t\tfunction getNonWhiteSpaceSibling(node, next, inc) {\n\t\t\tif (node) {\n\t\t\t\tnext = next ? 'nextSibling' : 'previousSibling';\n\n\t\t\t\tfor (node = inc ? node : node[next]; node; node = node[next]) {\n\t\t\t\t\tif (node.nodeType == 1 || !isWhiteSpaceNode(node)) {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Merges the next/previous sibling element if they match.\n\t\t *\n\t\t * @private\n\t\t * @param {Node} prev Previous node to compare/merge.\n\t\t * @param {Node} next Next node to compare/merge.\n\t\t * @return {Node} Next node if we didn't merge and prev node if we did.\n\t\t */\n\t\tfunction mergeSiblings(prev, next) {\n\t\t\tvar sibling, tmpSibling, elementUtils = new ElementUtils(dom);\n\n\t\t\tfunction findElementSibling(node, sibling_name) {\n\t\t\t\tfor (sibling = node; sibling; sibling = sibling[sibling_name]) {\n\t\t\t\t\tif (sibling.nodeType == 3 && sibling.nodeValue.length !== 0) {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (sibling.nodeType == 1 && !isBookmarkNode(sibling)) {\n\t\t\t\t\t\treturn sibling;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn node;\n\t\t\t}\n\n\t\t\t// Check if next/prev exists and that they are elements\n\t\t\tif (prev && next) {\n\t\t\t\t// If previous sibling is empty then jump over it\n\t\t\t\tprev = findElementSibling(prev, 'previousSibling');\n\t\t\t\tnext = findElementSibling(next, 'nextSibling');\n\n\t\t\t\t// Compare next and previous nodes\n\t\t\t\tif (elementUtils.compare(prev, next)) {\n\t\t\t\t\t// Append nodes between\n\t\t\t\t\tfor (sibling = prev.nextSibling; sibling && sibling != next;) {\n\t\t\t\t\t\ttmpSibling = sibling;\n\t\t\t\t\t\tsibling = sibling.nextSibling;\n\t\t\t\t\t\tprev.appendChild(tmpSibling);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Remove next node\n\t\t\t\t\tdom.remove(next);\n\n\t\t\t\t\t// Move children into prev node\n\t\t\t\t\teach(grep(next.childNodes), function(node) {\n\t\t\t\t\t\tprev.appendChild(node);\n\t\t\t\t\t});\n\n\t\t\t\t\treturn prev;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn next;\n\t\t}\n\n\t\tfunction getContainer(rng, start) {\n\t\t\tvar container, offset, lastIdx;\n\n\t\t\tcontainer = rng[start ? 'startContainer' : 'endContainer'];\n\t\t\toffset = rng[start ? 'startOffset' : 'endOffset'];\n\n\t\t\tif (container.nodeType == 1) {\n\t\t\t\tlastIdx = container.childNodes.length - 1;\n\n\t\t\t\tif (!start && offset) {\n\t\t\t\t\toffset--;\n\t\t\t\t}\n\n\t\t\t\tcontainer = container.childNodes[offset > lastIdx ? lastIdx : offset];\n\t\t\t}\n\n\t\t\t// If start text node is excluded then walk to the next node\n\t\t\tif (container.nodeType === 3 && start && offset >= container.nodeValue.length) {\n\t\t\t\tcontainer = new TreeWalker(container, ed.getBody()).next() || container;\n\t\t\t}\n\n\t\t\t// If end text node is excluded then walk to the previous node\n\t\t\tif (container.nodeType === 3 && !start && offset === 0) {\n\t\t\t\tcontainer = new TreeWalker(container, ed.getBody()).prev() || container;\n\t\t\t}\n\n\t\t\treturn container;\n\t\t}\n\n\t\tfunction performCaretAction(type, name, vars, similar) {\n\t\t\tvar caretContainerId = '_mce_caret', debug = ed.settings.caret_debug;\n\n\t\t\t// Creates a caret container bogus element\n\t\t\tfunction createCaretContainer(fill) {\n\t\t\t\tvar caretContainer = dom.create('span', {id: caretContainerId, 'data-mce-bogus': true, style: debug ? 'color:red' : ''});\n\n\t\t\t\tif (fill) {\n\t\t\t\t\tcaretContainer.appendChild(ed.getDoc().createTextNode(INVISIBLE_CHAR));\n\t\t\t\t}\n\n\t\t\t\treturn caretContainer;\n\t\t\t}\n\n\t\t\tfunction isCaretContainerEmpty(node, nodes) {\n\t\t\t\twhile (node) {\n\t\t\t\t\tif ((node.nodeType === 3 && node.nodeValue !== INVISIBLE_CHAR) || node.childNodes.length > 1) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Collect nodes\n\t\t\t\t\tif (nodes && node.nodeType === 1) {\n\t\t\t\t\t\tnodes.push(node);\n\t\t\t\t\t}\n\n\t\t\t\t\tnode = node.firstChild;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t// Returns any parent caret container element\n\t\t\tfunction getParentCaretContainer(node) {\n\t\t\t\twhile (node) {\n\t\t\t\t\tif (node.id === caretContainerId) {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t}\n\n\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Finds the first text node in the specified node\n\t\t\tfunction findFirstTextNode(node) {\n\t\t\t\tvar walker;\n\n\t\t\t\tif (node) {\n\t\t\t\t\twalker = new TreeWalker(node, node);\n\n\t\t\t\t\tfor (node = walker.current(); node; node = walker.next()) {\n\t\t\t\t\t\tif (node.nodeType === 3) {\n\t\t\t\t\t\t\treturn node;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Removes the caret container for the specified node or all on the current document\n\t\t\tfunction removeCaretContainer(node, move_caret) {\n\t\t\t\tvar child, rng;\n\n\t\t\t\tif (!node) {\n\t\t\t\t\tnode = getParentCaretContainer(selection.getStart());\n\n\t\t\t\t\tif (!node) {\n\t\t\t\t\t\twhile ((node = dom.get(caretContainerId))) {\n\t\t\t\t\t\t\tremoveCaretContainer(node, false);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\trng = selection.getRng(true);\n\n\t\t\t\t\tif (isCaretContainerEmpty(node)) {\n\t\t\t\t\t\tif (move_caret !== false) {\n\t\t\t\t\t\t\trng.setStartBefore(node);\n\t\t\t\t\t\t\trng.setEndBefore(node);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdom.remove(node);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tchild = findFirstTextNode(node);\n\n\t\t\t\t\t\tif (child.nodeValue.charAt(0) === INVISIBLE_CHAR) {\n\t\t\t\t\t\t\tchild.deleteData(0, 1);\n\n\t\t\t\t\t\t\t// Fix for bug #6976\n\t\t\t\t\t\t\tif (rng.startContainer == child && rng.startOffset > 0) {\n\t\t\t\t\t\t\t\trng.setStart(child, rng.startOffset - 1);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (rng.endContainer == child && rng.endOffset > 0) {\n\t\t\t\t\t\t\t\trng.setEnd(child, rng.endOffset - 1);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdom.remove(node, 1);\n\t\t\t\t\t}\n\n\t\t\t\t\tselection.setRng(rng);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Applies formatting to the caret position\n\t\t\tfunction applyCaretFormat() {\n\t\t\t\tvar rng, caretContainer, textNode, offset, bookmark, container, text;\n\n\t\t\t\trng = selection.getRng(true);\n\t\t\t\toffset = rng.startOffset;\n\t\t\t\tcontainer = rng.startContainer;\n\t\t\t\ttext = container.nodeValue;\n\n\t\t\t\tcaretContainer = getParentCaretContainer(selection.getStart());\n\t\t\t\tif (caretContainer) {\n\t\t\t\t\ttextNode = findFirstTextNode(caretContainer);\n\t\t\t\t}\n\n\t\t\t\t// Expand to word is caret is in the middle of a text node and the char before/after is a alpha numeric character\n\t\t\t\tif (text && offset > 0 && offset < text.length && /\\w/.test(text.charAt(offset)) && /\\w/.test(text.charAt(offset - 1))) {\n\t\t\t\t\t// Get bookmark of caret position\n\t\t\t\t\tbookmark = selection.getBookmark();\n\n\t\t\t\t\t// Collapse bookmark range (WebKit)\n\t\t\t\t\trng.collapse(true);\n\n\t\t\t\t\t// Expand the range to the closest word and split it at those points\n\t\t\t\t\trng = expandRng(rng, get(name));\n\t\t\t\t\trng = rangeUtils.split(rng);\n\n\t\t\t\t\t// Apply the format to the range\n\t\t\t\t\tapply(name, vars, rng);\n\n\t\t\t\t\t// Move selection back to caret position\n\t\t\t\t\tselection.moveToBookmark(bookmark);\n\t\t\t\t} else {\n\t\t\t\t\tif (!caretContainer || textNode.nodeValue !== INVISIBLE_CHAR) {\n\t\t\t\t\t\tcaretContainer = createCaretContainer(true);\n\t\t\t\t\t\ttextNode = caretContainer.firstChild;\n\n\t\t\t\t\t\trng.insertNode(caretContainer);\n\t\t\t\t\t\toffset = 1;\n\n\t\t\t\t\t\tapply(name, vars, caretContainer);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tapply(name, vars, caretContainer);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Move selection to text node\n\t\t\t\t\tselection.setCursorLocation(textNode, offset);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction removeCaretFormat() {\n\t\t\t\tvar rng = selection.getRng(true), container, offset, bookmark,\n\t\t\t\t\thasContentAfter, node, formatNode, parents = [], i, caretContainer;\n\n\t\t\t\tcontainer = rng.startContainer;\n\t\t\t\toffset = rng.startOffset;\n\t\t\t\tnode = container;\n\n\t\t\t\tif (container.nodeType == 3) {\n\t\t\t\t\tif (offset != container.nodeValue.length) {\n\t\t\t\t\t\thasContentAfter = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t}\n\n\t\t\t\twhile (node) {\n\t\t\t\t\tif (matchNode(node, name, vars, similar)) {\n\t\t\t\t\t\tformatNode = node;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (node.nextSibling) {\n\t\t\t\t\t\thasContentAfter = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tparents.push(node);\n\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t}\n\n\t\t\t\t// Node doesn't have the specified format\n\t\t\t\tif (!formatNode) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Is there contents after the caret then remove the format on the element\n\t\t\t\tif (hasContentAfter) {\n\t\t\t\t\t// Get bookmark of caret position\n\t\t\t\t\tbookmark = selection.getBookmark();\n\n\t\t\t\t\t// Collapse bookmark range (WebKit)\n\t\t\t\t\trng.collapse(true);\n\n\t\t\t\t\t// Expand the range to the closest word and split it at those points\n\t\t\t\t\trng = expandRng(rng, get(name), true);\n\t\t\t\t\trng = rangeUtils.split(rng);\n\n\t\t\t\t\t// Remove the format from the range\n\t\t\t\t\tremove(name, vars, rng);\n\n\t\t\t\t\t// Move selection back to caret position\n\t\t\t\t\tselection.moveToBookmark(bookmark);\n\t\t\t\t} else {\n\t\t\t\t\tcaretContainer = createCaretContainer();\n\n\t\t\t\t\tnode = caretContainer;\n\t\t\t\t\tfor (i = parents.length - 1; i >= 0; i--) {\n\t\t\t\t\t\tnode.appendChild(dom.clone(parents[i], false));\n\t\t\t\t\t\tnode = node.firstChild;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Insert invisible character into inner most format element\n\t\t\t\t\tnode.appendChild(dom.doc.createTextNode(INVISIBLE_CHAR));\n\t\t\t\t\tnode = node.firstChild;\n\n\t\t\t\t\tvar block = dom.getParent(formatNode, isTextBlock);\n\n\t\t\t\t\tif (block && dom.isEmpty(block)) {\n\t\t\t\t\t\t// Replace formatNode with caretContainer when removing format from empty block like <p><b>|</b></p>\n\t\t\t\t\t\tformatNode.parentNode.replaceChild(caretContainer, formatNode);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Insert caret container after the formatted node\n\t\t\t\t\t\tdom.insertAfter(caretContainer, formatNode);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Move selection to text node\n\t\t\t\t\tselection.setCursorLocation(node, 1);\n\n\t\t\t\t\t// If the formatNode is empty, we can remove it safely.\n\t\t\t\t\tif (dom.isEmpty(formatNode)) {\n\t\t\t\t\t\tdom.remove(formatNode);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Checks if the parent caret container node isn't empty if that is the case it\n\t\t\t// will remove the bogus state on all children that isn't empty\n\t\t\tfunction unmarkBogusCaretParents() {\n\t\t\t\tvar caretContainer;\n\n\t\t\t\tcaretContainer = getParentCaretContainer(selection.getStart());\n\t\t\t\tif (caretContainer && !dom.isEmpty(caretContainer)) {\n\t\t\t\t\twalk(caretContainer, function(node) {\n\t\t\t\t\t\tif (node.nodeType == 1 && node.id !== caretContainerId && !dom.isEmpty(node)) {\n\t\t\t\t\t\t\tdom.setAttrib(node, 'data-mce-bogus', null);\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 'childNodes');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Only bind the caret events once\n\t\t\tif (!ed._hasCaretEvents) {\n\t\t\t\t// Mark current caret container elements as bogus when getting the contents so we don't end up with empty elements\n\t\t\t\tmarkCaretContainersBogus = function() {\n\t\t\t\t\tvar nodes = [], i;\n\n\t\t\t\t\tif (isCaretContainerEmpty(getParentCaretContainer(selection.getStart()), nodes)) {\n\t\t\t\t\t\t// Mark children\n\t\t\t\t\t\ti = nodes.length;\n\t\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\t\tdom.setAttrib(nodes[i], 'data-mce-bogus', '1');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tdisableCaretContainer = function(e) {\n\t\t\t\t\tvar keyCode = e.keyCode;\n\n\t\t\t\t\tremoveCaretContainer();\n\n\t\t\t\t\t// Remove caret container if it's empty\n\t\t\t\t\tif (keyCode == 8 && selection.isCollapsed() && selection.getStart().innerHTML == INVISIBLE_CHAR) {\n\t\t\t\t\t\tremoveCaretContainer(getParentCaretContainer(selection.getStart()));\n\t\t\t\t\t}\n\n\t\t\t\t\t// Remove caret container on keydown and it's left/right arrow keys\n\t\t\t\t\tif (keyCode == 37 || keyCode == 39) {\n\t\t\t\t\t\tremoveCaretContainer(getParentCaretContainer(selection.getStart()));\n\t\t\t\t\t}\n\n\t\t\t\t\tunmarkBogusCaretParents();\n\t\t\t\t};\n\n\t\t\t\t// Remove bogus state if they got filled by contents using editor.selection.setContent\n\t\t\t\ted.on('SetContent', function(e) {\n\t\t\t\t\tif (e.selection) {\n\t\t\t\t\t\tunmarkBogusCaretParents();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\ted._hasCaretEvents = true;\n\t\t\t}\n\n\t\t\t// Do apply or remove caret format\n\t\t\tif (type == \"apply\") {\n\t\t\t\tapplyCaretFormat();\n\t\t\t} else {\n\t\t\t\tremoveCaretFormat();\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Moves the start to the first suitable text node.\n\t\t */\n\t\tfunction moveStart(rng) {\n\t\t\tvar container = rng.startContainer,\n\t\t\t\t\toffset = rng.startOffset, isAtEndOfText,\n\t\t\t\t\twalker, node, nodes, tmpNode;\n\n\t\t\tif (rng.startContainer == rng.endContainer) {\n\t\t\t\tif (isInlineBlock(rng.startContainer.childNodes[rng.startOffset])) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Convert text node into index if possible\n\t\t\tif (container.nodeType == 3 && offset >= container.nodeValue.length) {\n\t\t\t\t// Get the parent container location and walk from there\n\t\t\t\toffset = nodeIndex(container);\n\t\t\t\tcontainer = container.parentNode;\n\t\t\t\tisAtEndOfText = true;\n\t\t\t}\n\n\t\t\t// Move startContainer/startOffset in to a suitable node\n\t\t\tif (container.nodeType == 1) {\n\t\t\t\tnodes = container.childNodes;\n\t\t\t\tcontainer = nodes[Math.min(offset, nodes.length - 1)];\n\t\t\t\twalker = new TreeWalker(container, dom.getParent(container, dom.isBlock));\n\n\t\t\t\t// If offset is at end of the parent node walk to the next one\n\t\t\t\tif (offset > nodes.length - 1 || isAtEndOfText) {\n\t\t\t\t\twalker.next();\n\t\t\t\t}\n\n\t\t\t\tfor (node = walker.current(); node; node = walker.next()) {\n\t\t\t\t\tif (node.nodeType == 3 && !isWhiteSpaceNode(node)) {\n\t\t\t\t\t\t// IE has a \"neat\" feature where it moves the start node into the closest element\n\t\t\t\t\t\t// we can avoid this by inserting an element before it and then remove it after we set the selection\n\t\t\t\t\t\ttmpNode = dom.create('a', {'data-mce-bogus': 'all'}, INVISIBLE_CHAR);\n\t\t\t\t\t\tnode.parentNode.insertBefore(tmpNode, node);\n\n\t\t\t\t\t\t// Set selection and remove tmpNode\n\t\t\t\t\t\trng.setStart(node, 0);\n\t\t\t\t\t\tselection.setRng(rng);\n\t\t\t\t\t\tdom.remove(tmpNode);\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n});\n\n// Included from: js/tinymce/classes/undo/Diff.js\n\n/**\n * Diff.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * JS Implementation of the O(ND) Difference Algorithm by Eugene W. Myers.\n *\n * @class tinymce.undo.Diff\n * @private\n */\ndefine(\"tinymce/undo/Diff\", [\n], function () {\n\tvar KEEP = 0, INSERT = 1, DELETE = 2;\n\n\tvar diff = function (left, right) {\n\t\tvar size = left.length + right.length + 2;\n\t\tvar vDown = new Array(size);\n\t\tvar vUp = new Array(size);\n\n\t\tvar snake = function (start, end, diag) {\n\t\t\treturn {\n\t\t\t\tstart: start,\n\t\t\t\tend: end,\n\t\t\t\tdiag: diag\n\t\t\t};\n\t\t};\n\n\t\tvar buildScript = function (start1, end1, start2, end2, script) {\n\t\t\tvar middle = getMiddleSnake(start1, end1, start2, end2);\n\n\t\t\tif (middle === null || middle.start === end1 && middle.diag === end1 - end2 ||\n\t\t\t\tmiddle.end === start1 && middle.diag === start1 - start2) {\n\t\t\t\tvar i = start1;\n\t\t\t\tvar j = start2;\n\t\t\t\twhile (i < end1 || j < end2) {\n\t\t\t\t\tif (i < end1 && j < end2 && left[i] === right[j]) {\n\t\t\t\t\t\tscript.push([KEEP, left[i]]);\n\t\t\t\t\t\t++i;\n\t\t\t\t\t\t++j;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (end1 - start1 > end2 - start2) {\n\t\t\t\t\t\t\tscript.push([DELETE, left[i]]);\n\t\t\t\t\t\t\t++i;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tscript.push([INSERT, right[j]]);\n\t\t\t\t\t\t\t++j;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tbuildScript(start1, middle.start, start2, middle.start - middle.diag, script);\n\t\t\t\tfor (var i2 = middle.start; i2 < middle.end; ++i2) {\n\t\t\t\t\tscript.push([KEEP, left[i2]]);\n\t\t\t\t}\n\t\t\t\tbuildScript(middle.end, end1, middle.end - middle.diag, end2, script);\n\t\t\t}\n\t\t};\n\n\t\tvar buildSnake = function (start, diag, end1, end2) {\n\t\t\tvar end = start;\n\t\t\twhile (end - diag < end2 && end < end1 && left[end] === right[end - diag]) {\n\t\t\t\t++end;\n\t\t\t}\n\t\t\treturn snake(start, end, diag);\n\t\t};\n\n\t\tvar getMiddleSnake = function (start1, end1, start2, end2) {\n\t\t\t// Myers Algorithm\n\t\t\t// Initialisations\n\t\t\tvar m = end1 - start1;\n\t\t\tvar n = end2 - start2;\n\t\t\tif (m === 0 || n === 0) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tvar delta = m - n;\n\t\t\tvar sum = n + m;\n\t\t\tvar offset = (sum % 2 === 0 ? sum : sum + 1) / 2;\n\t\t\tvDown[1 + offset] = start1;\n\t\t\tvUp[1 + offset] = end1 + 1;\n\n\t\t\tfor (var d = 0; d <= offset; ++d) {\n\t\t\t\t// Down\n\t\t\t\tfor (var k = -d; k <= d; k += 2) {\n\t\t\t\t\t// First step\n\n\t\t\t\t\tvar i = k + offset;\n\t\t\t\t\tif (k === -d || k != d && vDown[i - 1] < vDown[i + 1]) {\n\t\t\t\t\t\tvDown[i] = vDown[i + 1];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvDown[i] = vDown[i - 1] + 1;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar x = vDown[i];\n\t\t\t\t\tvar y = x - start1 + start2 - k;\n\n\t\t\t\t\twhile (x < end1 && y < end2 && left[x] === right[y]) {\n\t\t\t\t\t\tvDown[i] = ++x;\n\t\t\t\t\t\t++y;\n\t\t\t\t\t}\n\t\t\t\t\t// Second step\n\t\t\t\t\tif (delta % 2 != 0 && delta - d <= k && k <= delta + d) {\n\t\t\t\t\t\tif (vUp[i - delta] <= vDown[i]) {\n\t\t\t\t\t\t\treturn buildSnake(vUp[i - delta], k + start1 - start2, end1, end2);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Up\n\t\t\t\tfor (k = delta - d; k <= delta + d; k += 2) {\n\t\t\t\t\t// First step\n\t\t\t\t\ti = k + offset - delta;\n\t\t\t\t\tif (k === delta - d || k != delta + d && vUp[i + 1] <= vUp[i - 1]) {\n\t\t\t\t\t\tvUp[i] = vUp[i + 1] - 1;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvUp[i] = vUp[i - 1];\n\t\t\t\t\t}\n\n\t\t\t\t\tx = vUp[i] - 1;\n\t\t\t\t\ty = x - start1 + start2 - k;\n\t\t\t\t\twhile (x >= start1 && y >= start2 && left[x] === right[y]) {\n\t\t\t\t\t\tvUp[i] = x--;\n\t\t\t\t\t\ty--;\n\t\t\t\t\t}\n\t\t\t\t\t// Second step\n\t\t\t\t\tif (delta % 2 === 0 && -d <= k && k <= d) {\n\t\t\t\t\t\tif (vUp[i] <= vDown[i + delta]) {\n\t\t\t\t\t\t\treturn buildSnake(vUp[i], k + start1 - start2, end1, end2);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tvar script = [];\n\t\tbuildScript(0, left.length, 0, right.length, script);\n\t\treturn script;\n\t};\n\n\treturn {\n\t\tKEEP: KEEP,\n\t\tDELETE: DELETE,\n\t\tINSERT: INSERT,\n\t\tdiff: diff\n\t};\n});\n\n// Included from: js/tinymce/classes/undo/Fragments.js\n\n/**\n * Fragments.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This module reads and applies html fragments from/to dom nodes.\n *\n * @class tinymce.undo.Fragments\n * @private\n */\ndefine(\"tinymce/undo/Fragments\", [\n\t\"tinymce/util/Arr\",\n\t\"tinymce/html/Entities\",\n\t\"tinymce/undo/Diff\"\n], function (Arr, Entities, Diff) {\n\tvar getOuterHtml = function (elm) {\n\t\tif (elm.nodeType === 1) {\n\t\t\treturn elm.outerHTML;\n\t\t} else if (elm.nodeType === 3) {\n\t\t\treturn Entities.encodeRaw(elm.data, false);\n\t\t} else if (elm.nodeType === 8) {\n\t\t\treturn '<!--' + elm.data + '-->';\n\t\t}\n\n\t\treturn '';\n\t};\n\n\tvar createFragment = function(html) {\n\t\tvar frag, node, container;\n\n\t\tcontainer = document.createElement(\"div\");\n\t\tfrag = document.createDocumentFragment();\n\n\t\tif (html) {\n\t\t\tcontainer.innerHTML = html;\n\t\t}\n\n\t\twhile ((node = container.firstChild)) {\n\t\t\tfrag.appendChild(node);\n\t\t}\n\n\t\treturn frag;\n\t};\n\n\tvar insertAt = function (elm, html, index) {\n\t\tvar fragment = createFragment(html);\n\t\tif (elm.hasChildNodes() && index < elm.childNodes.length) {\n\t\t\tvar target = elm.childNodes[index];\n\t\t\ttarget.parentNode.insertBefore(fragment, target);\n\t\t} else {\n\t\t\telm.appendChild(fragment);\n\t\t}\n\t};\n\n\tvar removeAt = function (elm, index) {\n\t\tif (elm.hasChildNodes() && index < elm.childNodes.length) {\n\t\t\tvar target = elm.childNodes[index];\n\t\t\ttarget.parentNode.removeChild(target);\n\t\t}\n\t};\n\n\tvar applyDiff = function (diff, elm) {\n\t\tvar index = 0;\n\t\tArr.each(diff, function (action) {\n\t\t\tif (action[0] === Diff.KEEP) {\n\t\t\t\tindex++;\n\t\t\t} else if (action[0] === Diff.INSERT) {\n\t\t\t\tinsertAt(elm, action[1], index);\n\t\t\t\tindex++;\n\t\t\t} else if (action[0] === Diff.DELETE) {\n\t\t\t\tremoveAt(elm, index);\n\t\t\t}\n\t\t});\n\t};\n\n\tvar read = function (elm) {\n\t\treturn Arr.map(elm.childNodes, getOuterHtml);\n\t};\n\n\tvar write = function (fragments, elm) {\n\t\tvar currentFragments = Arr.map(elm.childNodes, getOuterHtml);\n\t\tapplyDiff(Diff.diff(currentFragments, fragments), elm);\n\t\treturn elm;\n\t};\n\n\treturn {\n\t\tread: read,\n\t\twrite: write\n\t};\n});\n\n// Included from: js/tinymce/classes/undo/Levels.js\n\n/**\n * Levels.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This module handles getting/setting undo levels to/from editor instances.\n *\n * @class tinymce.undo.Levels\n * @private\n */\ndefine(\"tinymce/undo/Levels\", [\n\t\"tinymce/util/Arr\",\n\t\"tinymce/undo/Fragments\"\n], function (Arr, Fragments) {\n\tvar hasIframes = function (html) {\n\t\treturn html.indexOf('</iframe>') !== -1;\n\t};\n\n\tvar createFragmentedLevel = function (fragments) {\n\t\treturn {\n\t\t\ttype: 'fragmented',\n\t\t\tfragments: fragments,\n\t\t\tcontent: '',\n\t\t\tbookmark: null,\n\t\t\tbeforeBookmark: null\n\t\t};\n\t};\n\n\tvar createCompleteLevel = function (content) {\n\t\treturn {\n\t\t\ttype: 'complete',\n\t\t\tfragments: null,\n\t\t\tcontent: content,\n\t\t\tbookmark: null,\n\t\t\tbeforeBookmark: null\n\t\t};\n\t};\n\n\tvar createFromEditor = function (editor) {\n\t\tvar fragments, content;\n\n\t\tfragments = Fragments.read(editor.getBody());\n\t\tcontent = Arr.map(fragments, function (html) {\n\t\t\treturn editor.serializer.trimContent(html);\n\t\t}).join('');\n\n\t\treturn hasIframes(content) ? createFragmentedLevel(fragments) : createCompleteLevel(content);\n\t};\n\n\tvar applyToEditor = function (editor, level, before) {\n\t\tif (level.type === 'fragmented') {\n\t\t\tFragments.write(level.fragments, editor.getBody());\n\t\t} else {\n\t\t\teditor.setContent(level.content, {format: 'raw'});\n\t\t}\n\n\t\teditor.selection.moveToBookmark(before ? level.beforeBookmark : level.bookmark);\n\t};\n\n\tvar getLevelContent = function (level) {\n\t\treturn level.type === 'fragmented' ? level.fragments.join('') : level.content;\n\t};\n\n\tvar isEq = function (level1, level2) {\n\t\treturn getLevelContent(level1) === getLevelContent(level2);\n\t};\n\n\treturn {\n\t\tcreateFragmentedLevel: createFragmentedLevel,\n\t\tcreateCompleteLevel: createCompleteLevel,\n\t\tcreateFromEditor: createFromEditor,\n\t\tapplyToEditor: applyToEditor,\n\t\tisEq: isEq\n\t};\n});\n\n// Included from: js/tinymce/classes/UndoManager.js\n\n/**\n * UndoManager.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class handles the undo/redo history levels for the editor. Since the built-in undo/redo has major drawbacks a custom one was needed.\n *\n * @class tinymce.UndoManager\n */\ndefine(\"tinymce/UndoManager\", [\n\t\"tinymce/util/VK\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/undo/Levels\",\n\t\"tinymce/Env\"\n], function(VK, Tools, Levels, Env) {\n\treturn function(editor) {\n\t\tvar self = this, index = 0, data = [], beforeBookmark, isFirstTypedCharacter, locks = 0;\n\n\t\tfunction setDirty(state) {\n\t\t\teditor.setDirty(state);\n\t\t}\n\n\t\tfunction addNonTypingUndoLevel(e) {\n\t\t\tself.typing = false;\n\t\t\tself.add({}, e);\n\t\t}\n\n\t\tfunction endTyping() {\n\t\t\tif (self.typing) {\n\t\t\t\tself.typing = false;\n\t\t\t\tself.add();\n\t\t\t}\n\t\t}\n\n\t\t// Add initial undo level when the editor is initialized\n\t\teditor.on('init', function() {\n\t\t\tself.add();\n\t\t});\n\n\t\t// Get position before an execCommand is processed\n\t\teditor.on('BeforeExecCommand', function(e) {\n\t\t\tvar cmd = e.command;\n\n\t\t\tif (cmd !== 'Undo' && cmd !== 'Redo' && cmd !== 'mceRepaint') {\n\t\t\t\tendTyping();\n\t\t\t\tself.beforeChange();\n\t\t\t}\n\t\t});\n\n\t\t// Add undo level after an execCommand call was made\n\t\teditor.on('ExecCommand', function(e) {\n\t\t\tvar cmd = e.command;\n\n\t\t\tif (cmd !== 'Undo' && cmd !== 'Redo' && cmd !== 'mceRepaint') {\n\t\t\t\taddNonTypingUndoLevel(e);\n\t\t\t}\n\t\t});\n\n\t\teditor.on('ObjectResizeStart Cut', function() {\n\t\t\tself.beforeChange();\n\t\t});\n\n\t\teditor.on('SaveContent ObjectResized blur', addNonTypingUndoLevel);\n\t\teditor.on('DragEnd', addNonTypingUndoLevel);\n\n\t\teditor.on('KeyUp', function(e) {\n\t\t\tvar keyCode = e.keyCode;\n\n\t\t\t// If key is prevented then don't add undo level\n\t\t\t// This would happen on keyboard shortcuts for example\n\t\t\tif (e.isDefaultPrevented()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ((keyCode >= 33 && keyCode <= 36) || (keyCode >= 37 && keyCode <= 40) || keyCode === 45 || e.ctrlKey) {\n\t\t\t\taddNonTypingUndoLevel();\n\t\t\t\teditor.nodeChanged();\n\t\t\t}\n\n\t\t\tif (keyCode === 46 || keyCode === 8 || (Env.mac && (keyCode === 91 || keyCode === 93))) {\n\t\t\t\teditor.nodeChanged();\n\t\t\t}\n\n\t\t\t// Fire a TypingUndo event on the first character entered\n\t\t\tif (isFirstTypedCharacter && self.typing) {\n\t\t\t\t// Make it dirty if the content was changed after typing the first character\n\t\t\t\tif (!editor.isDirty()) {\n\t\t\t\t\tsetDirty(data[0] && !Levels.isEq(Levels.createFromEditor(editor), data[0]));\n\n\t\t\t\t\t// Fire initial change event\n\t\t\t\t\tif (editor.isDirty()) {\n\t\t\t\t\t\teditor.fire('change', {level: data[0], lastLevel: null});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\teditor.fire('TypingUndo');\n\t\t\t\tisFirstTypedCharacter = false;\n\t\t\t\teditor.nodeChanged();\n\t\t\t}\n\t\t});\n\n\t\teditor.on('KeyDown', function(e) {\n\t\t\tvar keyCode = e.keyCode;\n\n\t\t\t// If key is prevented then don't add undo level\n\t\t\t// This would happen on keyboard shortcuts for example\n\t\t\tif (e.isDefaultPrevented()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Is character position keys left,right,up,down,home,end,pgdown,pgup,enter\n\t\t\tif ((keyCode >= 33 && keyCode <= 36) || (keyCode >= 37 && keyCode <= 40) || keyCode === 45) {\n\t\t\t\tif (self.typing) {\n\t\t\t\t\taddNonTypingUndoLevel(e);\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// If key isn't Ctrl+Alt/AltGr\n\t\t\tvar modKey = (e.ctrlKey && !e.altKey) || e.metaKey;\n\t\t\tif ((keyCode < 16 || keyCode > 20) && keyCode !== 224 && keyCode !== 91 && !self.typing && !modKey) {\n\t\t\t\tself.beforeChange();\n\t\t\t\tself.typing = true;\n\t\t\t\tself.add({}, e);\n\t\t\t\tisFirstTypedCharacter = true;\n\t\t\t}\n\t\t});\n\n\t\teditor.on('MouseDown', function(e) {\n\t\t\tif (self.typing) {\n\t\t\t\taddNonTypingUndoLevel(e);\n\t\t\t}\n\t\t});\n\n\t\t// Add keyboard shortcuts for undo/redo keys\n\t\teditor.addShortcut('meta+z', '', 'Undo');\n\t\teditor.addShortcut('meta+y,meta+shift+z', '', 'Redo');\n\n\t\teditor.on('AddUndo Undo Redo ClearUndos', function(e) {\n\t\t\tif (!e.isDefaultPrevented()) {\n\t\t\t\teditor.nodeChanged();\n\t\t\t}\n\t\t});\n\n\t\t/*eslint consistent-this:0 */\n\t\tself = {\n\t\t\t// Explode for debugging reasons\n\t\t\tdata: data,\n\n\t\t\t/**\n\t\t\t * State if the user is currently typing or not. This will add a typing operation into one undo\n\t\t\t * level instead of one new level for each keystroke.\n\t\t\t *\n\t\t\t * @field {Boolean} typing\n\t\t\t */\n\t\t\ttyping: false,\n\n\t\t\t/**\n\t\t\t * Stores away a bookmark to be used when performing an undo action so that the selection is before\n\t\t\t * the change has been made.\n\t\t\t *\n\t\t\t * @method beforeChange\n\t\t\t */\n\t\t\tbeforeChange: function() {\n\t\t\t\tif (!locks) {\n\t\t\t\t\tbeforeBookmark = editor.selection.getBookmark(2, true);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Adds a new undo level/snapshot to the undo list.\n\t\t\t *\n\t\t\t * @method add\n\t\t\t * @param {Object} level Optional undo level object to add.\n\t\t\t * @param {DOMEvent} event Optional event responsible for the creation of the undo level.\n\t\t\t * @return {Object} Undo level that got added or null it a level wasn't needed.\n\t\t\t */\n\t\t\tadd: function(level, event) {\n\t\t\t\tvar i, settings = editor.settings, lastLevel, currentLevel;\n\n\t\t\t\tcurrentLevel = Levels.createFromEditor(editor);\n\t\t\t\tlevel = level || {};\n\t\t\t\tlevel = Tools.extend(level, currentLevel);\n\n\t\t\t\tif (locks || editor.removed) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tlastLevel = data[index];\n\t\t\t\tif (editor.fire('BeforeAddUndo', {level: level, lastLevel: lastLevel, originalEvent: event}).isDefaultPrevented()) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\t// Add undo level if needed\n\t\t\t\tif (lastLevel && Levels.isEq(lastLevel, level)) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\t// Set before bookmark on previous level\n\t\t\t\tif (data[index]) {\n\t\t\t\t\tdata[index].beforeBookmark = beforeBookmark;\n\t\t\t\t}\n\n\t\t\t\t// Time to compress\n\t\t\t\tif (settings.custom_undo_redo_levels) {\n\t\t\t\t\tif (data.length > settings.custom_undo_redo_levels) {\n\t\t\t\t\t\tfor (i = 0; i < data.length - 1; i++) {\n\t\t\t\t\t\t\tdata[i] = data[i + 1];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdata.length--;\n\t\t\t\t\t\tindex = data.length;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Get a non intrusive normalized bookmark\n\t\t\t\tlevel.bookmark = editor.selection.getBookmark(2, true);\n\n\t\t\t\t// Crop array if needed\n\t\t\t\tif (index < data.length - 1) {\n\t\t\t\t\tdata.length = index + 1;\n\t\t\t\t}\n\n\t\t\t\tdata.push(level);\n\t\t\t\tindex = data.length - 1;\n\n\t\t\t\tvar args = {level: level, lastLevel: lastLevel, originalEvent: event};\n\n\t\t\t\teditor.fire('AddUndo', args);\n\n\t\t\t\tif (index > 0) {\n\t\t\t\t\tsetDirty(true);\n\t\t\t\t\teditor.fire('change', args);\n\t\t\t\t}\n\n\t\t\t\treturn level;\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Undoes the last action.\n\t\t\t *\n\t\t\t * @method undo\n\t\t\t * @return {Object} Undo level or null if no undo was performed.\n\t\t\t */\n\t\t\tundo: function() {\n\t\t\t\tvar level;\n\n\t\t\t\tif (self.typing) {\n\t\t\t\t\tself.add();\n\t\t\t\t\tself.typing = false;\n\t\t\t\t}\n\n\t\t\t\tif (index > 0) {\n\t\t\t\t\tlevel = data[--index];\n\t\t\t\t\tLevels.applyToEditor(editor, level, true);\n\t\t\t\t\tsetDirty(true);\n\t\t\t\t\teditor.fire('undo', {level: level});\n\t\t\t\t}\n\n\t\t\t\treturn level;\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Redoes the last action.\n\t\t\t *\n\t\t\t * @method redo\n\t\t\t * @return {Object} Redo level or null if no redo was performed.\n\t\t\t */\n\t\t\tredo: function() {\n\t\t\t\tvar level;\n\n\t\t\t\tif (index < data.length - 1) {\n\t\t\t\t\tlevel = data[++index];\n\t\t\t\t\tLevels.applyToEditor(editor, level, false);\n\t\t\t\t\tsetDirty(true);\n\t\t\t\t\teditor.fire('redo', {level: level});\n\t\t\t\t}\n\n\t\t\t\treturn level;\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Removes all undo levels.\n\t\t\t *\n\t\t\t * @method clear\n\t\t\t */\n\t\t\tclear: function() {\n\t\t\t\tdata = [];\n\t\t\t\tindex = 0;\n\t\t\t\tself.typing = false;\n\t\t\t\tself.data = data;\n\t\t\t\teditor.fire('ClearUndos');\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Returns true/false if the undo manager has any undo levels.\n\t\t\t *\n\t\t\t * @method hasUndo\n\t\t\t * @return {Boolean} true/false if the undo manager has any undo levels.\n\t\t\t */\n\t\t\thasUndo: function() {\n\t\t\t\t// Has undo levels or typing and content isn't the same as the initial level\n\t\t\t\treturn index > 0 || (self.typing && data[0] && !Levels.isEq(Levels.createFromEditor(editor), data[0]));\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Returns true/false if the undo manager has any redo levels.\n\t\t\t *\n\t\t\t * @method hasRedo\n\t\t\t * @return {Boolean} true/false if the undo manager has any redo levels.\n\t\t\t */\n\t\t\thasRedo: function() {\n\t\t\t\treturn index < data.length - 1 && !self.typing;\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Executes the specified mutator function as an undo transaction. The selection\n\t\t\t * before the modification will be stored to the undo stack and if the DOM changes\n\t\t\t * it will add a new undo level. Any methods within the translation that adds undo levels will\n\t\t\t * be ignored. So a translation can include calls to execCommand or editor.insertContent.\n\t\t\t *\n\t\t\t * @method transact\n\t\t\t * @param {function} callback Function that gets executed and has dom manipulation logic in it.\n\t\t\t * @return {Object} Undo level that got added or null it a level wasn't needed.\n\t\t\t */\n\t\t\ttransact: function(callback) {\n\t\t\t\tendTyping();\n\t\t\t\tself.beforeChange();\n\n\t\t\t\ttry {\n\t\t\t\t\tlocks++;\n\t\t\t\t\tcallback();\n\t\t\t\t} finally {\n\t\t\t\t\tlocks--;\n\t\t\t\t}\n\n\t\t\t\treturn self.add();\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Adds an extra \"hidden\" undo level by first applying the first mutation and store that to the undo stack\n\t\t\t * then roll back that change and do the second mutation on top of the stack. This will produce an extra\n\t\t\t * undo level that the user doesn't see until they undo.\n\t\t\t *\n\t\t\t * @method extra\n\t\t\t * @param {function} callback1 Function that does mutation but gets stored as a \"hidden\" extra undo level.\n\t\t\t * @param {function} callback2 Function that does mutation but gets displayed to the user.\n\t\t\t */\n\t\t\textra: function (callback1, callback2) {\n\t\t\t\tvar lastLevel, bookmark;\n\n\t\t\t\tif (self.transact(callback1)) {\n\t\t\t\t\tbookmark = data[index].bookmark;\n\t\t\t\t\tlastLevel = data[index - 1];\n\t\t\t\t\tLevels.applyToEditor(editor, lastLevel, true);\n\n\t\t\t\t\tif (self.transact(callback2)) {\n\t\t\t\t\t\tdata[index - 1].beforeBookmark = bookmark;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\treturn self;\n\t};\n});\n\n// Included from: js/tinymce/classes/EnterKey.js\n\n/**\n * EnterKey.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Contains logic for handling the enter key to split/generate block elements.\n *\n * @private\n * @class tinymce.EnterKey\n */\ndefine(\"tinymce/EnterKey\", [\n\t\"tinymce/dom/TreeWalker\",\n\t\"tinymce/dom/RangeUtils\",\n\t\"tinymce/caret/CaretContainer\",\n\t\"tinymce/Env\"\n], function(TreeWalker, RangeUtils, CaretContainer, Env) {\n\tvar isIE = Env.ie && Env.ie < 11;\n\n\treturn function(editor) {\n\t\tvar dom = editor.dom, selection = editor.selection, settings = editor.settings;\n\t\tvar undoManager = editor.undoManager, schema = editor.schema, nonEmptyElementsMap = schema.getNonEmptyElements(),\n\t\t\tmoveCaretBeforeOnEnterElementsMap = schema.getMoveCaretBeforeOnEnterElements();\n\n\t\tfunction handleEnterKey(evt) {\n\t\t\tvar rng, tmpRng, editableRoot, container, offset, parentBlock, documentMode, shiftKey,\n\t\t\t\tnewBlock, fragment, containerBlock, parentBlockName, containerBlockName, newBlockName, isAfterLastNodeInContainer;\n\n\t\t\t// Returns true if the block can be split into two blocks or not\n\t\t\tfunction canSplitBlock(node) {\n\t\t\t\treturn node &&\n\t\t\t\t\tdom.isBlock(node) &&\n\t\t\t\t\t!/^(TD|TH|CAPTION|FORM)$/.test(node.nodeName) &&\n\t\t\t\t\t!/^(fixed|absolute)/i.test(node.style.position) &&\n\t\t\t\t\tdom.getContentEditable(node) !== \"true\";\n\t\t\t}\n\n\t\t\tfunction isTableCell(node) {\n\t\t\t\treturn node && /^(TD|TH|CAPTION)$/.test(node.nodeName);\n\t\t\t}\n\n\t\t\t// Renders empty block on IE\n\t\t\tfunction renderBlockOnIE(block) {\n\t\t\t\tvar oldRng;\n\n\t\t\t\tif (dom.isBlock(block)) {\n\t\t\t\t\toldRng = selection.getRng();\n\t\t\t\t\tblock.appendChild(dom.create('span', null, '\\u00a0'));\n\t\t\t\t\tselection.select(block);\n\t\t\t\t\tblock.lastChild.outerHTML = '';\n\t\t\t\t\tselection.setRng(oldRng);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Remove the first empty inline element of the block so this: <p><b><em></em></b>x</p> becomes this: <p>x</p>\n\t\t\tfunction trimInlineElementsOnLeftSideOfBlock(block) {\n\t\t\t\tvar node = block, firstChilds = [], i;\n\n\t\t\t\tif (!node) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Find inner most first child ex: <p><i><b>*</b></i></p>\n\t\t\t\twhile ((node = node.firstChild)) {\n\t\t\t\t\tif (dom.isBlock(node)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (node.nodeType == 1 && !nonEmptyElementsMap[node.nodeName.toLowerCase()]) {\n\t\t\t\t\t\tfirstChilds.push(node);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ti = firstChilds.length;\n\t\t\t\twhile (i--) {\n\t\t\t\t\tnode = firstChilds[i];\n\t\t\t\t\tif (!node.hasChildNodes() || (node.firstChild == node.lastChild && node.firstChild.nodeValue === '')) {\n\t\t\t\t\t\tdom.remove(node);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Remove <a> </a> see #5381\n\t\t\t\t\t\tif (node.nodeName == \"A\" && (node.innerText || node.textContent) === ' ') {\n\t\t\t\t\t\t\tdom.remove(node);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Moves the caret to a suitable position within the root for example in the first non\n\t\t\t// pure whitespace text node or before an image\n\t\t\tfunction moveToCaretPosition(root) {\n\t\t\t\tvar walker, node, rng, lastNode = root, tempElm;\n\t\t\t\tfunction firstNonWhiteSpaceNodeSibling(node) {\n\t\t\t\t\twhile (node) {\n\t\t\t\t\t\tif (node.nodeType == 1 || (node.nodeType == 3 && node.data && /[\\r\\n\\s]/.test(node.data))) {\n\t\t\t\t\t\t\treturn node;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnode = node.nextSibling;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!root) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Old IE versions doesn't properly render blocks with br elements in them\n\t\t\t\t// For example <p><br></p> wont be rendered correctly in a contentEditable area\n\t\t\t\t// until you remove the br producing <p></p>\n\t\t\t\tif (Env.ie && Env.ie < 9 && parentBlock && parentBlock.firstChild) {\n\t\t\t\t\tif (parentBlock.firstChild == parentBlock.lastChild && parentBlock.firstChild.tagName == 'BR') {\n\t\t\t\t\t\tdom.remove(parentBlock.firstChild);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (/^(LI|DT|DD)$/.test(root.nodeName)) {\n\t\t\t\t\tvar firstChild = firstNonWhiteSpaceNodeSibling(root.firstChild);\n\n\t\t\t\t\tif (firstChild && /^(UL|OL|DL)$/.test(firstChild.nodeName)) {\n\t\t\t\t\t\troot.insertBefore(dom.doc.createTextNode('\\u00a0'), root.firstChild);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\trng = dom.createRng();\n\n\t\t\t\t// Normalize whitespace to remove empty text nodes. Fix for: #6904\n\t\t\t\t// Gecko will be able to place the caret in empty text nodes but it won't render propery\n\t\t\t\t// Older IE versions will sometimes crash so for now ignore all IE versions\n\t\t\t\tif (!Env.ie) {\n\t\t\t\t\troot.normalize();\n\t\t\t\t}\n\n\t\t\t\tif (root.hasChildNodes()) {\n\t\t\t\t\twalker = new TreeWalker(root, root);\n\n\t\t\t\t\twhile ((node = walker.current())) {\n\t\t\t\t\t\tif (node.nodeType == 3) {\n\t\t\t\t\t\t\trng.setStart(node, 0);\n\t\t\t\t\t\t\trng.setEnd(node, 0);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (moveCaretBeforeOnEnterElementsMap[node.nodeName.toLowerCase()]) {\n\t\t\t\t\t\t\trng.setStartBefore(node);\n\t\t\t\t\t\t\trng.setEndBefore(node);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tlastNode = node;\n\t\t\t\t\t\tnode = walker.next();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!node) {\n\t\t\t\t\t\trng.setStart(lastNode, 0);\n\t\t\t\t\t\trng.setEnd(lastNode, 0);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (root.nodeName == 'BR') {\n\t\t\t\t\t\tif (root.nextSibling && dom.isBlock(root.nextSibling)) {\n\t\t\t\t\t\t\t// Trick on older IE versions to render the caret before the BR between two lists\n\t\t\t\t\t\t\tif (!documentMode || documentMode < 9) {\n\t\t\t\t\t\t\t\ttempElm = dom.create('br');\n\t\t\t\t\t\t\t\troot.parentNode.insertBefore(tempElm, root);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\trng.setStartBefore(root);\n\t\t\t\t\t\t\trng.setEndBefore(root);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trng.setStartAfter(root);\n\t\t\t\t\t\t\trng.setEndAfter(root);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\trng.setStart(root, 0);\n\t\t\t\t\t\trng.setEnd(root, 0);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tselection.setRng(rng);\n\n\t\t\t\t// Remove tempElm created for old IE:s\n\t\t\t\tdom.remove(tempElm);\n\t\t\t\tselection.scrollIntoView(root);\n\t\t\t}\n\n\t\t\tfunction setForcedBlockAttrs(node) {\n\t\t\t\tvar forcedRootBlockName = settings.forced_root_block;\n\n\t\t\t\tif (forcedRootBlockName && forcedRootBlockName.toLowerCase() === node.tagName.toLowerCase()) {\n\t\t\t\t\tdom.setAttribs(node, settings.forced_root_block_attrs);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction emptyBlock(elm) {\n\t\t\t\t// BR is needed in empty blocks on non IE browsers\n\t\t\t\telm.innerHTML = !isIE ? '<br data-mce-bogus=\"1\">' : '';\n\t\t\t}\n\n\t\t\t// Creates a new block element by cloning the current one or creating a new one if the name is specified\n\t\t\t// This function will also copy any text formatting from the parent block and add it to the new one\n\t\t\tfunction createNewBlock(name) {\n\t\t\t\tvar node = container, block, clonedNode, caretNode, textInlineElements = schema.getTextInlineElements();\n\n\t\t\t\tif (name || parentBlockName == \"TABLE\") {\n\t\t\t\t\tblock = dom.create(name || newBlockName);\n\t\t\t\t\tsetForcedBlockAttrs(block);\n\t\t\t\t} else {\n\t\t\t\t\tblock = parentBlock.cloneNode(false);\n\t\t\t\t}\n\n\t\t\t\tcaretNode = block;\n\n\t\t\t\t// Clone any parent styles\n\t\t\t\tif (settings.keep_styles !== false) {\n\t\t\t\t\tdo {\n\t\t\t\t\t\tif (textInlineElements[node.nodeName]) {\n\t\t\t\t\t\t\t// Never clone a caret containers\n\t\t\t\t\t\t\tif (node.id == '_mce_caret') {\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tclonedNode = node.cloneNode(false);\n\t\t\t\t\t\t\tdom.setAttrib(clonedNode, 'id', ''); // Remove ID since it needs to be document unique\n\n\t\t\t\t\t\t\tif (block.hasChildNodes()) {\n\t\t\t\t\t\t\t\tclonedNode.appendChild(block.firstChild);\n\t\t\t\t\t\t\t\tblock.appendChild(clonedNode);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tcaretNode = clonedNode;\n\t\t\t\t\t\t\t\tblock.appendChild(clonedNode);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} while ((node = node.parentNode) && node != editableRoot);\n\t\t\t\t}\n\n\t\t\t\t// BR is needed in empty blocks on non IE browsers\n\t\t\t\tif (!isIE) {\n\t\t\t\t\tcaretNode.innerHTML = '<br data-mce-bogus=\"1\">';\n\t\t\t\t}\n\n\t\t\t\treturn block;\n\t\t\t}\n\n\t\t\t// Returns true/false if the caret is at the start/end of the parent block element\n\t\t\tfunction isCaretAtStartOrEndOfBlock(start) {\n\t\t\t\tvar walker, node, name;\n\n\t\t\t\t// Caret is in the middle of a text node like \"a|b\"\n\t\t\t\tif (container.nodeType == 3 && (start ? offset > 0 : offset < container.nodeValue.length)) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// If after the last element in block node edge case for #5091\n\t\t\t\tif (container.parentNode == parentBlock && isAfterLastNodeInContainer && !start) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\t// If the caret if before the first element in parentBlock\n\t\t\t\tif (start && container.nodeType == 1 && container == parentBlock.firstChild) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\t// Caret can be before/after a table\n\t\t\t\tif (container.nodeName === \"TABLE\" || (container.previousSibling && container.previousSibling.nodeName == \"TABLE\")) {\n\t\t\t\t\treturn (isAfterLastNodeInContainer && !start) || (!isAfterLastNodeInContainer && start);\n\t\t\t\t}\n\n\t\t\t\t// Walk the DOM and look for text nodes or non empty elements\n\t\t\t\twalker = new TreeWalker(container, parentBlock);\n\n\t\t\t\t// If caret is in beginning or end of a text block then jump to the next/previous node\n\t\t\t\tif (container.nodeType == 3) {\n\t\t\t\t\tif (start && offset === 0) {\n\t\t\t\t\t\twalker.prev();\n\t\t\t\t\t} else if (!start && offset == container.nodeValue.length) {\n\t\t\t\t\t\twalker.next();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\twhile ((node = walker.current())) {\n\t\t\t\t\tif (node.nodeType === 1) {\n\t\t\t\t\t\t// Ignore bogus elements\n\t\t\t\t\t\tif (!node.getAttribute('data-mce-bogus')) {\n\t\t\t\t\t\t\t// Keep empty elements like <img /> <input /> but not trailing br:s like <p>text|<br></p>\n\t\t\t\t\t\t\tname = node.nodeName.toLowerCase();\n\t\t\t\t\t\t\tif (nonEmptyElementsMap[name] && name !== 'br') {\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (node.nodeType === 3 && !/^[ \\t\\r\\n]*$/.test(node.nodeValue)) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (start) {\n\t\t\t\t\t\twalker.prev();\n\t\t\t\t\t} else {\n\t\t\t\t\t\twalker.next();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t// Wraps any text nodes or inline elements in the specified forced root block name\n\t\t\tfunction wrapSelfAndSiblingsInDefaultBlock(container, offset) {\n\t\t\t\tvar newBlock, parentBlock, startNode, node, next, rootBlockName, blockName = newBlockName || 'P';\n\n\t\t\t\t// Not in a block element or in a table cell or caption\n\t\t\t\tparentBlock = dom.getParent(container, dom.isBlock);\n\t\t\t\tif (!parentBlock || !canSplitBlock(parentBlock)) {\n\t\t\t\t\tparentBlock = parentBlock || editableRoot;\n\n\t\t\t\t\tif (parentBlock == editor.getBody() || isTableCell(parentBlock)) {\n\t\t\t\t\t\trootBlockName = parentBlock.nodeName.toLowerCase();\n\t\t\t\t\t} else {\n\t\t\t\t\t\trootBlockName = parentBlock.parentNode.nodeName.toLowerCase();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!parentBlock.hasChildNodes()) {\n\t\t\t\t\t\tnewBlock = dom.create(blockName);\n\t\t\t\t\t\tsetForcedBlockAttrs(newBlock);\n\t\t\t\t\t\tparentBlock.appendChild(newBlock);\n\t\t\t\t\t\trng.setStart(newBlock, 0);\n\t\t\t\t\t\trng.setEnd(newBlock, 0);\n\t\t\t\t\t\treturn newBlock;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Find parent that is the first child of parentBlock\n\t\t\t\t\tnode = container;\n\t\t\t\t\twhile (node.parentNode != parentBlock) {\n\t\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Loop left to find start node start wrapping at\n\t\t\t\t\twhile (node && !dom.isBlock(node)) {\n\t\t\t\t\t\tstartNode = node;\n\t\t\t\t\t\tnode = node.previousSibling;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (startNode && schema.isValidChild(rootBlockName, blockName.toLowerCase())) {\n\t\t\t\t\t\tnewBlock = dom.create(blockName);\n\t\t\t\t\t\tsetForcedBlockAttrs(newBlock);\n\t\t\t\t\t\tstartNode.parentNode.insertBefore(newBlock, startNode);\n\n\t\t\t\t\t\t// Start wrapping until we hit a block\n\t\t\t\t\t\tnode = startNode;\n\t\t\t\t\t\twhile (node && !dom.isBlock(node)) {\n\t\t\t\t\t\t\tnext = node.nextSibling;\n\t\t\t\t\t\t\tnewBlock.appendChild(node);\n\t\t\t\t\t\t\tnode = next;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Restore range to it's past location\n\t\t\t\t\t\trng.setStart(container, offset);\n\t\t\t\t\t\trng.setEnd(container, offset);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn container;\n\t\t\t}\n\n\t\t\t// Inserts a block or br before/after or in the middle of a split list of the LI is empty\n\t\t\tfunction handleEmptyListItem() {\n\t\t\t\tfunction isFirstOrLastLi(first) {\n\t\t\t\t\tvar node = containerBlock[first ? 'firstChild' : 'lastChild'];\n\n\t\t\t\t\t// Find first/last element since there might be whitespace there\n\t\t\t\t\twhile (node) {\n\t\t\t\t\t\tif (node.nodeType == 1) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnode = node[first ? 'nextSibling' : 'previousSibling'];\n\t\t\t\t\t}\n\n\t\t\t\t\treturn node === parentBlock;\n\t\t\t\t}\n\n\t\t\t\tfunction getContainerBlock() {\n\t\t\t\t\tvar containerBlockParent = containerBlock.parentNode;\n\n\t\t\t\t\tif (/^(LI|DT|DD)$/.test(containerBlockParent.nodeName)) {\n\t\t\t\t\t\treturn containerBlockParent;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn containerBlock;\n\t\t\t\t}\n\n\t\t\t\tif (containerBlock == editor.getBody()) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Check if we are in an nested list\n\t\t\t\tvar containerBlockParentName = containerBlock.parentNode.nodeName;\n\t\t\t\tif (/^(OL|UL|LI)$/.test(containerBlockParentName)) {\n\t\t\t\t\tnewBlockName = 'LI';\n\t\t\t\t}\n\n\t\t\t\tnewBlock = newBlockName ? createNewBlock(newBlockName) : dom.create('BR');\n\n\t\t\t\tif (isFirstOrLastLi(true) && isFirstOrLastLi()) {\n\t\t\t\t\tif (containerBlockParentName == 'LI') {\n\t\t\t\t\t\t// Nested list is inside a LI\n\t\t\t\t\t\tdom.insertAfter(newBlock, getContainerBlock());\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Is first and last list item then replace the OL/UL with a text block\n\t\t\t\t\t\tdom.replace(newBlock, containerBlock);\n\t\t\t\t\t}\n\t\t\t\t} else if (isFirstOrLastLi(true)) {\n\t\t\t\t\tif (containerBlockParentName == 'LI') {\n\t\t\t\t\t\t// List nested in an LI then move the list to a new sibling LI\n\t\t\t\t\t\tdom.insertAfter(newBlock, getContainerBlock());\n\t\t\t\t\t\tnewBlock.appendChild(dom.doc.createTextNode(' ')); // Needed for IE so the caret can be placed\n\t\t\t\t\t\tnewBlock.appendChild(containerBlock);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// First LI in list then remove LI and add text block before list\n\t\t\t\t\t\tcontainerBlock.parentNode.insertBefore(newBlock, containerBlock);\n\t\t\t\t\t}\n\t\t\t\t} else if (isFirstOrLastLi()) {\n\t\t\t\t\t// Last LI in list then remove LI and add text block after list\n\t\t\t\t\tdom.insertAfter(newBlock, getContainerBlock());\n\t\t\t\t\trenderBlockOnIE(newBlock);\n\t\t\t\t} else {\n\t\t\t\t\t// Middle LI in list the split the list and insert a text block in the middle\n\t\t\t\t\t// Extract after fragment and insert it after the current block\n\t\t\t\t\tcontainerBlock = getContainerBlock();\n\t\t\t\t\ttmpRng = rng.cloneRange();\n\t\t\t\t\ttmpRng.setStartAfter(parentBlock);\n\t\t\t\t\ttmpRng.setEndAfter(containerBlock);\n\t\t\t\t\tfragment = tmpRng.extractContents();\n\n\t\t\t\t\tif (newBlockName == 'LI' && fragment.firstChild.nodeName == 'LI') {\n\t\t\t\t\t\tnewBlock = fragment.firstChild;\n\t\t\t\t\t\tdom.insertAfter(fragment, containerBlock);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdom.insertAfter(fragment, containerBlock);\n\t\t\t\t\t\tdom.insertAfter(newBlock, containerBlock);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tdom.remove(parentBlock);\n\t\t\t\tmoveToCaretPosition(newBlock);\n\t\t\t\tundoManager.add();\n\t\t\t}\n\n\t\t\t// Inserts a BR element if the forced_root_block option is set to false or empty string\n\t\t\tfunction insertBr() {\n\t\t\t\teditor.execCommand(\"InsertLineBreak\", false, evt);\n\t\t\t}\n\n\t\t\t// Trims any linebreaks at the beginning of node user for example when pressing enter in a PRE element\n\t\t\tfunction trimLeadingLineBreaks(node) {\n\t\t\t\tdo {\n\t\t\t\t\tif (node.nodeType === 3) {\n\t\t\t\t\t\tnode.nodeValue = node.nodeValue.replace(/^[\\r\\n]+/, '');\n\t\t\t\t\t}\n\n\t\t\t\t\tnode = node.firstChild;\n\t\t\t\t} while (node);\n\t\t\t}\n\n\t\t\tfunction getEditableRoot(node) {\n\t\t\t\tvar root = dom.getRoot(), parent, editableRoot;\n\n\t\t\t\t// Get all parents until we hit a non editable parent or the root\n\t\t\t\tparent = node;\n\t\t\t\twhile (parent !== root && dom.getContentEditable(parent) !== \"false\") {\n\t\t\t\t\tif (dom.getContentEditable(parent) === \"true\") {\n\t\t\t\t\t\teditableRoot = parent;\n\t\t\t\t\t}\n\n\t\t\t\t\tparent = parent.parentNode;\n\t\t\t\t}\n\n\t\t\t\treturn parent !== root ? editableRoot : root;\n\t\t\t}\n\n\t\t\t// Adds a BR at the end of blocks that only contains an IMG or INPUT since\n\t\t\t// these might be floated and then they won't expand the block\n\t\t\tfunction addBrToBlockIfNeeded(block) {\n\t\t\t\tvar lastChild;\n\n\t\t\t\t// IE will render the blocks correctly other browsers needs a BR\n\t\t\t\tif (!isIE) {\n\t\t\t\t\tblock.normalize(); // Remove empty text nodes that got left behind by the extract\n\n\t\t\t\t\t// Check if the block is empty or contains a floated last child\n\t\t\t\t\tlastChild = block.lastChild;\n\t\t\t\t\tif (!lastChild || (/^(left|right)$/gi.test(dom.getStyle(lastChild, 'float', true)))) {\n\t\t\t\t\t\tdom.add(block, 'br');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction insertNewBlockAfter() {\n\t\t\t\t// If the caret is at the end of a header we produce a P tag after it similar to Word unless we are in a hgroup\n\t\t\t\tif (/^(H[1-6]|PRE|FIGURE)$/.test(parentBlockName) && containerBlockName != 'HGROUP') {\n\t\t\t\t\tnewBlock = createNewBlock(newBlockName);\n\t\t\t\t} else {\n\t\t\t\t\tnewBlock = createNewBlock();\n\t\t\t\t}\n\n\t\t\t\t// Split the current container block element if enter is pressed inside an empty inner block element\n\t\t\t\tif (settings.end_container_on_empty_block && canSplitBlock(containerBlock) && dom.isEmpty(parentBlock)) {\n\t\t\t\t\t// Split container block for example a BLOCKQUOTE at the current blockParent location for example a P\n\t\t\t\t\tnewBlock = dom.split(containerBlock, parentBlock);\n\t\t\t\t} else {\n\t\t\t\t\tdom.insertAfter(newBlock, parentBlock);\n\t\t\t\t}\n\n\t\t\t\tmoveToCaretPosition(newBlock);\n\t\t\t}\n\n\t\t\trng = selection.getRng(true);\n\n\t\t\t// Event is blocked by some other handler for example the lists plugin\n\t\t\tif (evt.isDefaultPrevented()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Delete any selected contents\n\t\t\tif (!rng.collapsed) {\n\t\t\t\teditor.execCommand('Delete');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Setup range items and newBlockName\n\t\t\tnew RangeUtils(dom).normalize(rng);\n\t\t\tcontainer = rng.startContainer;\n\t\t\toffset = rng.startOffset;\n\t\t\tnewBlockName = (settings.force_p_newlines ? 'p' : '') || settings.forced_root_block;\n\t\t\tnewBlockName = newBlockName ? newBlockName.toUpperCase() : '';\n\t\t\tdocumentMode = dom.doc.documentMode;\n\t\t\tshiftKey = evt.shiftKey;\n\n\t\t\t// Resolve node index\n\t\t\tif (container.nodeType == 1 && container.hasChildNodes()) {\n\t\t\t\tisAfterLastNodeInContainer = offset > container.childNodes.length - 1;\n\n\t\t\t\tcontainer = container.childNodes[Math.min(offset, container.childNodes.length - 1)] || container;\n\t\t\t\tif (isAfterLastNodeInContainer && container.nodeType == 3) {\n\t\t\t\t\toffset = container.nodeValue.length;\n\t\t\t\t} else {\n\t\t\t\t\toffset = 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Get editable root node, normally the body element but sometimes a div or span\n\t\t\teditableRoot = getEditableRoot(container);\n\n\t\t\t// If there is no editable root then enter is done inside a contentEditable false element\n\t\t\tif (!editableRoot) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tundoManager.beforeChange();\n\n\t\t\t// If editable root isn't block nor the root of the editor\n\t\t\tif (!dom.isBlock(editableRoot) && editableRoot != dom.getRoot()) {\n\t\t\t\tif (!newBlockName || shiftKey) {\n\t\t\t\t\tinsertBr();\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Wrap the current node and it's sibling in a default block if it's needed.\n\t\t\t// for example this <td>text|<b>text2</b></td> will become this <td><p>text|<b>text2</p></b></td>\n\t\t\t// This won't happen if root blocks are disabled or the shiftKey is pressed\n\t\t\tif ((newBlockName && !shiftKey) || (!newBlockName && shiftKey)) {\n\t\t\t\tcontainer = wrapSelfAndSiblingsInDefaultBlock(container, offset);\n\t\t\t}\n\n\t\t\t// Find parent block and setup empty block paddings\n\t\t\tparentBlock = dom.getParent(container, dom.isBlock);\n\t\t\tcontainerBlock = parentBlock ? dom.getParent(parentBlock.parentNode, dom.isBlock) : null;\n\n\t\t\t// Setup block names\n\t\t\tparentBlockName = parentBlock ? parentBlock.nodeName.toUpperCase() : ''; // IE < 9 & HTML5\n\t\t\tcontainerBlockName = containerBlock ? containerBlock.nodeName.toUpperCase() : ''; // IE < 9 & HTML5\n\n\t\t\t// Enter inside block contained within a LI then split or insert before/after LI\n\t\t\tif (containerBlockName == 'LI' && !evt.ctrlKey) {\n\t\t\t\tparentBlock = containerBlock;\n\t\t\t\tparentBlockName = containerBlockName;\n\t\t\t}\n\n\t\t\tif (editor.undoManager.typing) {\n\t\t\t\teditor.undoManager.typing = false;\n\t\t\t\teditor.undoManager.add();\n\t\t\t}\n\n\t\t\t// Handle enter in list item\n\t\t\tif (/^(LI|DT|DD)$/.test(parentBlockName)) {\n\t\t\t\tif (!newBlockName && shiftKey) {\n\t\t\t\t\tinsertBr();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Handle enter inside an empty list item\n\t\t\t\tif (dom.isEmpty(parentBlock)) {\n\t\t\t\t\thandleEmptyListItem();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Don't split PRE tags but insert a BR instead easier when writing code samples etc\n\t\t\tif (parentBlockName == 'PRE' && settings.br_in_pre !== false) {\n\t\t\t\tif (!shiftKey) {\n\t\t\t\t\tinsertBr();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// If no root block is configured then insert a BR by default or if the shiftKey is pressed\n\t\t\t\tif ((!newBlockName && !shiftKey && parentBlockName != 'LI') || (newBlockName && shiftKey)) {\n\t\t\t\t\tinsertBr();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// If parent block is root then never insert new blocks\n\t\t\tif (newBlockName && parentBlock === editor.getBody()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Default block name if it's not configured\n\t\t\tnewBlockName = newBlockName || 'P';\n\n\t\t\t// Insert new block before/after the parent block depending on caret location\n\t\t\tif (CaretContainer.isCaretContainerBlock(parentBlock)) {\n\t\t\t\tnewBlock = CaretContainer.showCaretContainerBlock(parentBlock);\n\t\t\t} else if (isCaretAtStartOrEndOfBlock()) {\n\t\t\t\tinsertNewBlockAfter();\n\t\t\t} else if (isCaretAtStartOrEndOfBlock(true)) {\n\t\t\t\t// Insert new block before\n\t\t\t\tnewBlock = parentBlock.parentNode.insertBefore(createNewBlock(), parentBlock);\n\t\t\t\trenderBlockOnIE(newBlock);\n\t\t\t\tmoveToCaretPosition(parentBlock);\n\t\t\t} else {\n\t\t\t\t// Extract after fragment and insert it after the current block\n\t\t\t\ttmpRng = rng.cloneRange();\n\t\t\t\ttmpRng.setEndAfter(parentBlock);\n\t\t\t\tfragment = tmpRng.extractContents();\n\t\t\t\ttrimLeadingLineBreaks(fragment);\n\t\t\t\tnewBlock = fragment.firstChild;\n\t\t\t\tdom.insertAfter(fragment, parentBlock);\n\t\t\t\ttrimInlineElementsOnLeftSideOfBlock(newBlock);\n\t\t\t\taddBrToBlockIfNeeded(parentBlock);\n\n\t\t\t\tif (dom.isEmpty(parentBlock)) {\n\t\t\t\t\temptyBlock(parentBlock);\n\t\t\t\t}\n\n\t\t\t\tnewBlock.normalize();\n\n\t\t\t\t// New block might become empty if it's <p><b>a |</b></p>\n\t\t\t\tif (dom.isEmpty(newBlock)) {\n\t\t\t\t\tdom.remove(newBlock);\n\t\t\t\t\tinsertNewBlockAfter();\n\t\t\t\t} else {\n\t\t\t\t\tmoveToCaretPosition(newBlock);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tdom.setAttrib(newBlock, 'id', ''); // Remove ID since it needs to be document unique\n\n\t\t\t// Allow custom handling of new blocks\n\t\t\teditor.fire('NewBlock', {newBlock: newBlock});\n\n\t\t\tundoManager.typing = false;\n\t\t\tundoManager.add();\n\t\t}\n\n\t\teditor.on('keydown', function(evt) {\n\t\t\tif (evt.keyCode == 13) {\n\t\t\t\tif (handleEnterKey(evt) !== false) {\n\t\t\t\t\tevt.preventDefault();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t};\n});\n\n// Included from: js/tinymce/classes/ForceBlocks.js\n\n/**\n * ForceBlocks.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Makes sure that everything gets wrapped in paragraphs.\n *\n * @private\n * @class tinymce.ForceBlocks\n */\ndefine(\"tinymce/ForceBlocks\", [], function() {\n\treturn function(editor) {\n\t\tvar settings = editor.settings, dom = editor.dom, selection = editor.selection;\n\t\tvar schema = editor.schema, blockElements = schema.getBlockElements();\n\n\t\tfunction addRootBlocks() {\n\t\t\tvar node = selection.getStart(), rootNode = editor.getBody(), rng;\n\t\t\tvar startContainer, startOffset, endContainer, endOffset, rootBlockNode;\n\t\t\tvar tempNode, offset = -0xFFFFFF, wrapped, restoreSelection;\n\t\t\tvar tmpRng, rootNodeName, forcedRootBlock;\n\n\t\t\tforcedRootBlock = settings.forced_root_block;\n\n\t\t\tif (!node || node.nodeType !== 1 || !forcedRootBlock) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Check if node is wrapped in block\n\t\t\twhile (node && node != rootNode) {\n\t\t\t\tif (blockElements[node.nodeName]) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tnode = node.parentNode;\n\t\t\t}\n\n\t\t\t// Get current selection\n\t\t\trng = selection.getRng();\n\t\t\tif (rng.setStart) {\n\t\t\t\tstartContainer = rng.startContainer;\n\t\t\t\tstartOffset = rng.startOffset;\n\t\t\t\tendContainer = rng.endContainer;\n\t\t\t\tendOffset = rng.endOffset;\n\n\t\t\t\ttry {\n\t\t\t\t\trestoreSelection = editor.getDoc().activeElement === rootNode;\n\t\t\t\t} catch (ex) {\n\t\t\t\t\t// IE throws unspecified error here sometimes\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Force control range into text range\n\t\t\t\tif (rng.item) {\n\t\t\t\t\tnode = rng.item(0);\n\t\t\t\t\trng = editor.getDoc().body.createTextRange();\n\t\t\t\t\trng.moveToElementText(node);\n\t\t\t\t}\n\n\t\t\t\trestoreSelection = rng.parentElement().ownerDocument === editor.getDoc();\n\t\t\t\ttmpRng = rng.duplicate();\n\t\t\t\ttmpRng.collapse(true);\n\t\t\t\tstartOffset = tmpRng.move('character', offset) * -1;\n\n\t\t\t\tif (!tmpRng.collapsed) {\n\t\t\t\t\ttmpRng = rng.duplicate();\n\t\t\t\t\ttmpRng.collapse(false);\n\t\t\t\t\tendOffset = (tmpRng.move('character', offset) * -1) - startOffset;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Wrap non block elements and text nodes\n\t\t\tnode = rootNode.firstChild;\n\t\t\trootNodeName = rootNode.nodeName.toLowerCase();\n\t\t\twhile (node) {\n\t\t\t\t// TODO: Break this up, too complex\n\t\t\t\tif (((node.nodeType === 3 || (node.nodeType == 1 && !blockElements[node.nodeName]))) &&\n\t\t\t\t\tschema.isValidChild(rootNodeName, forcedRootBlock.toLowerCase())) {\n\t\t\t\t\t// Remove empty text nodes\n\t\t\t\t\tif (node.nodeType === 3 && node.nodeValue.length === 0) {\n\t\t\t\t\t\ttempNode = node;\n\t\t\t\t\t\tnode = node.nextSibling;\n\t\t\t\t\t\tdom.remove(tempNode);\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!rootBlockNode) {\n\t\t\t\t\t\trootBlockNode = dom.create(forcedRootBlock, editor.settings.forced_root_block_attrs);\n\t\t\t\t\t\tnode.parentNode.insertBefore(rootBlockNode, node);\n\t\t\t\t\t\twrapped = true;\n\t\t\t\t\t}\n\n\t\t\t\t\ttempNode = node;\n\t\t\t\t\tnode = node.nextSibling;\n\t\t\t\t\trootBlockNode.appendChild(tempNode);\n\t\t\t\t} else {\n\t\t\t\t\trootBlockNode = null;\n\t\t\t\t\tnode = node.nextSibling;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (wrapped && restoreSelection) {\n\t\t\t\tif (rng.setStart) {\n\t\t\t\t\trng.setStart(startContainer, startOffset);\n\t\t\t\t\trng.setEnd(endContainer, endOffset);\n\t\t\t\t\tselection.setRng(rng);\n\t\t\t\t} else {\n\t\t\t\t\t// Only select if the previous selection was inside the document to prevent auto focus in quirks mode\n\t\t\t\t\ttry {\n\t\t\t\t\t\trng = editor.getDoc().body.createTextRange();\n\t\t\t\t\t\trng.moveToElementText(rootNode);\n\t\t\t\t\t\trng.collapse(true);\n\t\t\t\t\t\trng.moveStart('character', startOffset);\n\n\t\t\t\t\t\tif (endOffset > 0) {\n\t\t\t\t\t\t\trng.moveEnd('character', endOffset);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\trng.select();\n\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t// Ignore\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\teditor.nodeChanged();\n\t\t\t}\n\t\t}\n\n\t\t// Force root blocks\n\t\tif (settings.forced_root_block) {\n\t\t\teditor.on('NodeChange', addRootBlocks);\n\t\t}\n\t};\n});\n\n// Included from: js/tinymce/classes/caret/CaretUtils.js\n\n/**\n * CaretUtils.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Utility functions shared by the caret logic.\n *\n * @private\n * @class tinymce.caret.CaretUtils\n */\ndefine(\"tinymce/caret/CaretUtils\", [\n\t\"tinymce/util/Fun\",\n\t\"tinymce/dom/TreeWalker\",\n\t\"tinymce/dom/NodeType\",\n\t\"tinymce/caret/CaretPosition\",\n\t\"tinymce/caret/CaretContainer\",\n\t\"tinymce/caret/CaretCandidate\"\n], function(Fun, TreeWalker, NodeType, CaretPosition, CaretContainer, CaretCandidate) {\n\tvar isContentEditableTrue = NodeType.isContentEditableTrue,\n\t\tisContentEditableFalse = NodeType.isContentEditableFalse,\n\t\tisBlockLike = NodeType.matchStyleValues('display', 'block table table-cell table-caption'),\n\t\tisCaretContainer = CaretContainer.isCaretContainer,\n\t\tisCaretContainerBlock = CaretContainer.isCaretContainerBlock,\n\t\tcurry = Fun.curry,\n\t\tisElement = NodeType.isElement,\n\t\tisCaretCandidate = CaretCandidate.isCaretCandidate;\n\n\tfunction isForwards(direction) {\n\t\treturn direction > 0;\n\t}\n\n\tfunction isBackwards(direction) {\n\t\treturn direction < 0;\n\t}\n\n\tfunction skipCaretContainers(walk, shallow) {\n\t\tvar node;\n\n\t\twhile ((node = walk(shallow))) {\n\t\t\tif (!isCaretContainerBlock(node)) {\n\t\t\t\treturn node;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tfunction findNode(node, direction, predicateFn, rootNode, shallow) {\n\t\tvar walker = new TreeWalker(node, rootNode);\n\n\t\tif (isBackwards(direction)) {\n\t\t\tif (isContentEditableFalse(node) || isCaretContainerBlock(node)) {\n\t\t\t\tnode = skipCaretContainers(walker.prev, true);\n\t\t\t\tif (predicateFn(node)) {\n\t\t\t\t\treturn node;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\twhile ((node = skipCaretContainers(walker.prev, shallow))) {\n\t\t\t\tif (predicateFn(node)) {\n\t\t\t\t\treturn node;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (isForwards(direction)) {\n\t\t\tif (isContentEditableFalse(node) || isCaretContainerBlock(node)) {\n\t\t\t\tnode = skipCaretContainers(walker.next, true);\n\t\t\t\tif (predicateFn(node)) {\n\t\t\t\t\treturn node;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\twhile ((node = skipCaretContainers(walker.next, shallow))) {\n\t\t\t\tif (predicateFn(node)) {\n\t\t\t\t\treturn node;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tfunction getEditingHost(node, rootNode) {\n\t\tfor (node = node.parentNode; node && node != rootNode; node = node.parentNode) {\n\t\t\tif (isContentEditableTrue(node)) {\n\t\t\t\treturn node;\n\t\t\t}\n\t\t}\n\n\t\treturn rootNode;\n\t}\n\n\tfunction getParentBlock(node, rootNode) {\n\t\twhile (node && node != rootNode) {\n\t\t\tif (isBlockLike(node)) {\n\t\t\t\treturn node;\n\t\t\t}\n\n\t\t\tnode = node.parentNode;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tfunction isInSameBlock(caretPosition1, caretPosition2, rootNode) {\n\t\treturn getParentBlock(caretPosition1.container(), rootNode) == getParentBlock(caretPosition2.container(), rootNode);\n\t}\n\n\tfunction isInSameEditingHost(caretPosition1, caretPosition2, rootNode) {\n\t\treturn getEditingHost(caretPosition1.container(), rootNode) == getEditingHost(caretPosition2.container(), rootNode);\n\t}\n\n\tfunction getChildNodeAtRelativeOffset(relativeOffset, caretPosition) {\n\t\tvar container, offset;\n\n\t\tif (!caretPosition) {\n\t\t\treturn null;\n\t\t}\n\n\t\tcontainer = caretPosition.container();\n\t\toffset = caretPosition.offset();\n\n\t\tif (!isElement(container)) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn container.childNodes[offset + relativeOffset];\n\t}\n\n\tfunction beforeAfter(before, node) {\n\t\tvar range = node.ownerDocument.createRange();\n\n\t\tif (before) {\n\t\t\trange.setStartBefore(node);\n\t\t\trange.setEndBefore(node);\n\t\t} else {\n\t\t\trange.setStartAfter(node);\n\t\t\trange.setEndAfter(node);\n\t\t}\n\n\t\treturn range;\n\t}\n\n\tfunction isNodesInSameBlock(rootNode, node1, node2) {\n\t\treturn getParentBlock(node1, rootNode) == getParentBlock(node2, rootNode);\n\t}\n\n\tfunction lean(left, rootNode, node) {\n\t\tvar sibling, siblingName;\n\n\t\tif (left) {\n\t\t\tsiblingName = 'previousSibling';\n\t\t} else {\n\t\t\tsiblingName = 'nextSibling';\n\t\t}\n\n\t\twhile (node && node != rootNode) {\n\t\t\tsibling = node[siblingName];\n\n\t\t\tif (isCaretContainer(sibling)) {\n\t\t\t\tsibling = sibling[siblingName];\n\t\t\t}\n\n\t\t\tif (isContentEditableFalse(sibling)) {\n\t\t\t\tif (isNodesInSameBlock(rootNode, sibling, node)) {\n\t\t\t\t\treturn sibling;\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (isCaretCandidate(sibling)) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tnode = node.parentNode;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tvar before = curry(beforeAfter, true);\n\tvar after = curry(beforeAfter, false);\n\n\tfunction normalizeRange(direction, rootNode, range) {\n\t\tvar node, container, offset, location;\n\t\tvar leanLeft = curry(lean, true, rootNode);\n\t\tvar leanRight = curry(lean, false, rootNode);\n\n\t\tcontainer = range.startContainer;\n\t\toffset = range.startOffset;\n\n\t\tif (CaretContainer.isCaretContainerBlock(container)) {\n\t\t\tif (!isElement(container)) {\n\t\t\t\tcontainer = container.parentNode;\n\t\t\t}\n\n\t\t\tlocation = container.getAttribute('data-mce-caret');\n\n\t\t\tif (location == 'before') {\n\t\t\t\tnode = container.nextSibling;\n\t\t\t\tif (isContentEditableFalse(node)) {\n\t\t\t\t\treturn before(node);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (location == 'after') {\n\t\t\t\tnode = container.previousSibling;\n\t\t\t\tif (isContentEditableFalse(node)) {\n\t\t\t\t\treturn after(node);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (!range.collapsed) {\n\t\t\treturn range;\n\t\t}\n\n\t\tif (NodeType.isText(container)) {\n\t\t\tif (isCaretContainer(container)) {\n\t\t\t\tif (direction === 1) {\n\t\t\t\t\tnode = leanRight(container);\n\t\t\t\t\tif (node) {\n\t\t\t\t\t\treturn before(node);\n\t\t\t\t\t}\n\n\t\t\t\t\tnode = leanLeft(container);\n\t\t\t\t\tif (node) {\n\t\t\t\t\t\treturn after(node);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (direction === -1) {\n\t\t\t\t\tnode = leanLeft(container);\n\t\t\t\t\tif (node) {\n\t\t\t\t\t\treturn after(node);\n\t\t\t\t\t}\n\n\t\t\t\t\tnode = leanRight(container);\n\t\t\t\t\tif (node) {\n\t\t\t\t\t\treturn before(node);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn range;\n\t\t\t}\n\n\t\t\tif (CaretContainer.endsWithCaretContainer(container) && offset >= container.data.length - 1) {\n\t\t\t\tif (direction === 1) {\n\t\t\t\t\tnode = leanRight(container);\n\t\t\t\t\tif (node) {\n\t\t\t\t\t\treturn before(node);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn range;\n\t\t\t}\n\n\t\t\tif (CaretContainer.startsWithCaretContainer(container) && offset <= 1) {\n\t\t\t\tif (direction === -1) {\n\t\t\t\t\tnode = leanLeft(container);\n\t\t\t\t\tif (node) {\n\t\t\t\t\t\treturn after(node);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn range;\n\t\t\t}\n\n\t\t\tif (offset === container.data.length) {\n\t\t\t\tnode = leanRight(container);\n\t\t\t\tif (node) {\n\t\t\t\t\treturn before(node);\n\t\t\t\t}\n\n\t\t\t\treturn range;\n\t\t\t}\n\n\t\t\tif (offset === 0) {\n\t\t\t\tnode = leanLeft(container);\n\t\t\t\tif (node) {\n\t\t\t\t\treturn after(node);\n\t\t\t\t}\n\n\t\t\t\treturn range;\n\t\t\t}\n\t\t}\n\n\t\treturn range;\n\t}\n\n\tfunction isNextToContentEditableFalse(relativeOffset, caretPosition) {\n\t\treturn isContentEditableFalse(getChildNodeAtRelativeOffset(relativeOffset, caretPosition));\n\t}\n\n\treturn {\n\t\tisForwards: isForwards,\n\t\tisBackwards: isBackwards,\n\t\tfindNode: findNode,\n\t\tgetEditingHost: getEditingHost,\n\t\tgetParentBlock: getParentBlock,\n\t\tisInSameBlock: isInSameBlock,\n\t\tisInSameEditingHost: isInSameEditingHost,\n\t\tisBeforeContentEditableFalse: curry(isNextToContentEditableFalse, 0),\n\t\tisAfterContentEditableFalse: curry(isNextToContentEditableFalse, -1),\n\t\tnormalizeRange: normalizeRange\n\t};\n});\n\n// Included from: js/tinymce/classes/caret/CaretWalker.js\n\n/**\n * CaretWalker.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This module contains logic for moving around a virtual caret in logical order within a DOM element.\n *\n * It ignores the most obvious invalid caret locations such as within a script element or within a\n * contentEditable=false element but it will return locations that isn't possible to render visually.\n *\n * @private\n * @class tinymce.caret.CaretWalker\n * @example\n * var caretWalker = new CaretWalker(rootElm);\n *\n * var prevLogicalCaretPosition = caretWalker.prev(CaretPosition.fromRangeStart(range));\n * var nextLogicalCaretPosition = caretWalker.next(CaretPosition.fromRangeEnd(range));\n */\ndefine(\"tinymce/caret/CaretWalker\", [\n\t\"tinymce/dom/NodeType\",\n\t\"tinymce/caret/CaretCandidate\",\n\t\"tinymce/caret/CaretPosition\",\n\t\"tinymce/caret/CaretUtils\",\n\t\"tinymce/util/Arr\",\n\t\"tinymce/util/Fun\"\n], function(NodeType, CaretCandidate, CaretPosition, CaretUtils, Arr, Fun) {\n\tvar isContentEditableFalse = NodeType.isContentEditableFalse,\n\t\tisText = NodeType.isText,\n\t\tisElement = NodeType.isElement,\n\t\tisBr = NodeType.isBr,\n\t\tisForwards = CaretUtils.isForwards,\n\t\tisBackwards = CaretUtils.isBackwards,\n\t\tisCaretCandidate = CaretCandidate.isCaretCandidate,\n\t\tisAtomic = CaretCandidate.isAtomic,\n\t\tisEditableCaretCandidate = CaretCandidate.isEditableCaretCandidate;\n\n\tfunction getParents(node, rootNode) {\n\t\tvar parents = [];\n\n\t\twhile (node && node != rootNode) {\n\t\t\tparents.push(node);\n\t\t\tnode = node.parentNode;\n\t\t}\n\n\t\treturn parents;\n\t}\n\n\tfunction nodeAtIndex(container, offset) {\n\t\tif (container.hasChildNodes() && offset < container.childNodes.length) {\n\t\t\treturn container.childNodes[offset];\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tfunction getCaretCandidatePosition(direction, node) {\n\t\tif (isForwards(direction)) {\n\t\t\tif (isCaretCandidate(node.previousSibling) && !isText(node.previousSibling)) {\n\t\t\t\treturn CaretPosition.before(node);\n\t\t\t}\n\n\t\t\tif (isText(node)) {\n\t\t\t\treturn CaretPosition(node, 0);\n\t\t\t}\n\t\t}\n\n\t\tif (isBackwards(direction)) {\n\t\t\tif (isCaretCandidate(node.nextSibling) && !isText(node.nextSibling)) {\n\t\t\t\treturn CaretPosition.after(node);\n\t\t\t}\n\n\t\t\tif (isText(node)) {\n\t\t\t\treturn CaretPosition(node, node.data.length);\n\t\t\t}\n\t\t}\n\n\t\tif (isBackwards(direction)) {\n\t\t\tif (isBr(node)) {\n\t\t\t\treturn CaretPosition.before(node);\n\t\t\t}\n\n\t\t\treturn CaretPosition.after(node);\n\t\t}\n\n\t\treturn CaretPosition.before(node);\n\t}\n\n\t// Jumps over BR elements <p>|<br></p><p>a</p> -> <p><br></p><p>|a</p>\n\tfunction isBrBeforeBlock(node, rootNode) {\n\t\tvar next;\n\n\t\tif (!NodeType.isBr(node)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tnext = findCaretPosition(1, CaretPosition.after(node), rootNode);\n\t\tif (!next) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn !CaretUtils.isInSameBlock(CaretPosition.before(node), CaretPosition.before(next), rootNode);\n\t}\n\n\tfunction findCaretPosition(direction, startCaretPosition, rootNode) {\n\t\tvar container, offset, node, nextNode, innerNode,\n\t\t\trootContentEditableFalseElm, caretPosition;\n\n\t\tif (!isElement(rootNode) || !startCaretPosition) {\n\t\t\treturn null;\n\t\t}\n\n\t\tcaretPosition = startCaretPosition;\n\t\tcontainer = caretPosition.container();\n\t\toffset = caretPosition.offset();\n\n\t\tif (isText(container)) {\n\t\t\tif (isBackwards(direction) && offset > 0) {\n\t\t\t\treturn CaretPosition(container, --offset);\n\t\t\t}\n\n\t\t\tif (isForwards(direction) && offset < container.length) {\n\t\t\t\treturn CaretPosition(container, ++offset);\n\t\t\t}\n\n\t\t\tnode = container;\n\t\t} else {\n\t\t\tif (isBackwards(direction) && offset > 0) {\n\t\t\t\tnextNode = nodeAtIndex(container, offset - 1);\n\t\t\t\tif (isCaretCandidate(nextNode)) {\n\t\t\t\t\tif (!isAtomic(nextNode)) {\n\t\t\t\t\t\tinnerNode = CaretUtils.findNode(nextNode, direction, isEditableCaretCandidate, nextNode);\n\t\t\t\t\t\tif (innerNode) {\n\t\t\t\t\t\t\tif (isText(innerNode)) {\n\t\t\t\t\t\t\t\treturn CaretPosition(innerNode, innerNode.data.length);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn CaretPosition.after(innerNode);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (isText(nextNode)) {\n\t\t\t\t\t\treturn CaretPosition(nextNode, nextNode.data.length);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn CaretPosition.before(nextNode);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (isForwards(direction) && offset < container.childNodes.length) {\n\t\t\t\tnextNode = nodeAtIndex(container, offset);\n\t\t\t\tif (isCaretCandidate(nextNode)) {\n\t\t\t\t\tif (isBrBeforeBlock(nextNode, rootNode)) {\n\t\t\t\t\t\treturn findCaretPosition(direction, CaretPosition.after(nextNode), rootNode);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!isAtomic(nextNode)) {\n\t\t\t\t\t\tinnerNode = CaretUtils.findNode(nextNode, direction, isEditableCaretCandidate, nextNode);\n\t\t\t\t\t\tif (innerNode) {\n\t\t\t\t\t\t\tif (isText(innerNode)) {\n\t\t\t\t\t\t\t\treturn CaretPosition(innerNode, 0);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn CaretPosition.before(innerNode);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (isText(nextNode)) {\n\t\t\t\t\t\treturn CaretPosition(nextNode, 0);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn CaretPosition.after(nextNode);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tnode = caretPosition.getNode();\n\t\t}\n\n\t\tif ((isForwards(direction) && caretPosition.isAtEnd()) || (isBackwards(direction) && caretPosition.isAtStart())) {\n\t\t\tnode = CaretUtils.findNode(node, direction, Fun.constant(true), rootNode, true);\n\t\t\tif (isEditableCaretCandidate(node)) {\n\t\t\t\treturn getCaretCandidatePosition(direction, node);\n\t\t\t}\n\t\t}\n\n\t\tnextNode = CaretUtils.findNode(node, direction, isEditableCaretCandidate, rootNode);\n\n\t\trootContentEditableFalseElm = Arr.last(Arr.filter(getParents(container, rootNode), isContentEditableFalse));\n\t\tif (rootContentEditableFalseElm && (!nextNode || !rootContentEditableFalseElm.contains(nextNode))) {\n\t\t\tif (isForwards(direction)) {\n\t\t\t\tcaretPosition = CaretPosition.after(rootContentEditableFalseElm);\n\t\t\t} else {\n\t\t\t\tcaretPosition = CaretPosition.before(rootContentEditableFalseElm);\n\t\t\t}\n\n\t\t\treturn caretPosition;\n\t\t}\n\n\t\tif (nextNode) {\n\t\t\treturn getCaretCandidatePosition(direction, nextNode);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\treturn function(rootNode) {\n\t\treturn {\n\t\t\t/**\n\t\t\t * Returns the next logical caret position from the specificed input\n\t\t\t * caretPoisiton or null if there isn't any more positions left for example\n\t\t\t * at the end specified root element.\n\t\t\t *\n\t\t\t * @method next\n\t\t\t * @param {tinymce.caret.CaretPosition} caretPosition Caret position to start from.\n\t\t\t * @return {tinymce.caret.CaretPosition} CaretPosition or null if no position was found.\n\t\t\t */\n\t\t\tnext: function(caretPosition) {\n\t\t\t\treturn findCaretPosition(1, caretPosition, rootNode);\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Returns the previous logical caret position from the specificed input\n\t\t\t * caretPoisiton or null if there isn't any more positions left for example\n\t\t\t * at the end specified root element.\n\t\t\t *\n\t\t\t * @method prev\n\t\t\t * @param {tinymce.caret.CaretPosition} caretPosition Caret position to start from.\n\t\t\t * @return {tinymce.caret.CaretPosition} CaretPosition or null if no position was found.\n\t\t\t */\n\t\t\tprev: function(caretPosition) {\n\t\t\t\treturn findCaretPosition(-1, caretPosition, rootNode);\n\t\t\t}\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/InsertList.js\n\n/**\n * InsertList.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Handles inserts of lists into the editor instance.\n *\n * @class tinymce.InsertList\n * @private\n */\ndefine(\"tinymce/InsertList\", [\n\t\"tinymce/util/Tools\",\n\t\"tinymce/caret/CaretWalker\",\n\t\"tinymce/caret/CaretPosition\"\n], function(Tools, CaretWalker, CaretPosition) {\n\tvar isListFragment = function(fragment) {\n\t\tvar firstChild = fragment.firstChild;\n\t\tvar lastChild = fragment.lastChild;\n\n\t\t// Skip meta since it's likely <meta><ul>..</ul>\n\t\tif (firstChild && firstChild.name === 'meta') {\n\t\t\tfirstChild = firstChild.next;\n\t\t}\n\n\t\t// Skip mce_marker since it's likely <ul>..</ul><span id=\"mce_marker\"></span>\n\t\tif (lastChild && lastChild.attr('id') === 'mce_marker') {\n\t\t\tlastChild = lastChild.prev;\n\t\t}\n\n\t\tif (!firstChild || firstChild !== lastChild) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn firstChild.name === 'ul' || firstChild.name === 'ol';\n\t};\n\n\tvar cleanupDomFragment = function (domFragment) {\n\t\tvar firstChild = domFragment.firstChild;\n\t\tvar lastChild = domFragment.lastChild;\n\n\t\t// TODO: remove the meta tag from paste logic\n\t\tif (firstChild && firstChild.nodeName === 'META') {\n\t\t\tfirstChild.parentNode.removeChild(firstChild);\n\t\t}\n\n\t\tif (lastChild && lastChild.id === 'mce_marker') {\n\t\t\tlastChild.parentNode.removeChild(lastChild);\n\t\t}\n\n\t\treturn domFragment;\n\t};\n\n\tvar toDomFragment = function(dom, serializer, fragment) {\n\t\tvar html = serializer.serialize(fragment);\n\t\tvar domFragment = dom.createFragment(html);\n\n\t\treturn cleanupDomFragment(domFragment);\n\t};\n\n\tvar listItems = function(elm) {\n\t\treturn Tools.grep(elm.childNodes, function(child) {\n\t\t\treturn child.nodeName === 'LI';\n\t\t});\n\t};\n\n\tvar isEmpty = function (elm) {\n\t\treturn !elm.firstChild;\n\t};\n\n\tvar trimListItems = function(elms) {\n\t\treturn elms.length > 0 && isEmpty(elms[elms.length - 1]) ? elms.slice(0, -1) : elms;\n\t};\n\n\tvar getParentLi = function(dom, node) {\n\t\tvar parentBlock = dom.getParent(node, dom.isBlock);\n\t\treturn parentBlock && parentBlock.nodeName === 'LI' ? parentBlock : null;\n\t};\n\n\tvar isParentBlockLi = function(dom, node) {\n\t\treturn !!getParentLi(dom, node);\n\t};\n\n\tvar getSplit = function(parentNode, rng) {\n\t\tvar beforeRng = rng.cloneRange();\n\t\tvar afterRng = rng.cloneRange();\n\n\t\tbeforeRng.setStartBefore(parentNode);\n\t\tafterRng.setEndAfter(parentNode);\n\n\t\treturn [\n\t\t\tbeforeRng.cloneContents(),\n\t\t\tafterRng.cloneContents()\n\t\t];\n\t};\n\n\tvar findFirstIn = function(node, rootNode) {\n\t\tvar caretPos = CaretPosition.before(node);\n\t\tvar caretWalker = new CaretWalker(rootNode);\n\t\tvar newCaretPos = caretWalker.next(caretPos);\n\n\t\treturn newCaretPos ? newCaretPos.toRange() : null;\n\t};\n\n\tvar findLastOf = function(node, rootNode) {\n\t\tvar caretPos = CaretPosition.after(node);\n\t\tvar caretWalker = new CaretWalker(rootNode);\n\t\tvar newCaretPos = caretWalker.prev(caretPos);\n\n\t\treturn newCaretPos ? newCaretPos.toRange() : null;\n\t};\n\n\tvar insertMiddle = function(target, elms, rootNode, rng) {\n\t\tvar parts = getSplit(target, rng);\n\t\tvar parentElm = target.parentNode;\n\n\t\tparentElm.insertBefore(parts[0], target);\n\t\tTools.each(elms, function(li) {\n\t\t\tparentElm.insertBefore(li, target);\n\t\t});\n\t\tparentElm.insertBefore(parts[1], target);\n\t\tparentElm.removeChild(target);\n\n\t\treturn findLastOf(elms[elms.length - 1], rootNode);\n\t};\n\n\tvar insertBefore = function(target, elms, rootNode) {\n\t\tvar parentElm = target.parentNode;\n\n\t\tTools.each(elms, function(elm) {\n\t\t\tparentElm.insertBefore(elm, target);\n\t\t});\n\n\t\treturn findFirstIn(target, rootNode);\n\t};\n\n\tvar insertAfter = function(target, elms, rootNode, dom) {\n\t\tdom.insertAfter(elms.reverse(), target);\n\t\treturn findLastOf(elms[0], rootNode);\n\t};\n\n\tvar insertAtCaret = function(serializer, dom, rng, fragment) {\n\t\tvar domFragment = toDomFragment(dom, serializer, fragment);\n\t\tvar liTarget = getParentLi(dom, rng.startContainer);\n\t\tvar liElms = trimListItems(listItems(domFragment.firstChild));\n\t\tvar BEGINNING = 1, END = 2;\n\t\tvar rootNode = dom.getRoot();\n\n\t\tvar isAt = function(location) {\n\t\t\tvar caretPos = CaretPosition.fromRangeStart(rng);\n\t\t\tvar caretWalker = new CaretWalker(dom.getRoot());\n\t\t\tvar newPos = location === BEGINNING ? caretWalker.prev(caretPos) : caretWalker.next(caretPos);\n\n\t\t\treturn newPos ? getParentLi(dom, newPos.getNode()) !== liTarget : true;\n\t\t};\n\n\t\tif (isAt(BEGINNING)) {\n\t\t\treturn insertBefore(liTarget, liElms, rootNode);\n\t\t} else if (isAt(END)) {\n\t\t\treturn insertAfter(liTarget, liElms, rootNode, dom);\n\t\t}\n\n\t\treturn insertMiddle(liTarget, liElms, rootNode, rng);\n\t};\n\n\treturn {\n\t\tisListFragment: isListFragment,\n\t\tinsertAtCaret: insertAtCaret,\n\t\tisParentBlockLi: isParentBlockLi,\n\t\ttrimListItems: trimListItems,\n\t\tlistItems: listItems\n\t};\n});\n\n// Included from: js/tinymce/classes/InsertContent.js\n\n/**\n * InsertContent.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Handles inserts of contents into the editor instance.\n *\n * @class tinymce.InsertContent\n * @private\n */\ndefine(\"tinymce/InsertContent\", [\n\t\"tinymce/Env\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/html/Serializer\",\n\t\"tinymce/caret/CaretWalker\",\n\t\"tinymce/caret/CaretPosition\",\n\t\"tinymce/dom/ElementUtils\",\n\t\"tinymce/dom/NodeType\",\n\t\"tinymce/InsertList\"\n], function(Env, Tools, Serializer, CaretWalker, CaretPosition, ElementUtils, NodeType, InsertList) {\n\tvar isTableCell = NodeType.matchNodeNames('td th');\n\n\tvar insertHtmlAtCaret = function(editor, value, details) {\n\t\tvar parser, serializer, parentNode, rootNode, fragment, args;\n\t\tvar marker, rng, node, node2, bookmarkHtml, merge;\n\t\tvar textInlineElements = editor.schema.getTextInlineElements();\n\t\tvar selection = editor.selection, dom = editor.dom;\n\n\t\tfunction trimOrPaddLeftRight(html) {\n\t\t\tvar rng, container, offset;\n\n\t\t\trng = selection.getRng(true);\n\t\t\tcontainer = rng.startContainer;\n\t\t\toffset = rng.startOffset;\n\n\t\t\tfunction hasSiblingText(siblingName) {\n\t\t\t\treturn container[siblingName] && container[siblingName].nodeType == 3;\n\t\t\t}\n\n\t\t\tif (container.nodeType == 3) {\n\t\t\t\tif (offset > 0) {\n\t\t\t\t\thtml = html.replace(/^&nbsp;/, ' ');\n\t\t\t\t} else if (!hasSiblingText('previousSibling')) {\n\t\t\t\t\thtml = html.replace(/^ /, '&nbsp;');\n\t\t\t\t}\n\n\t\t\t\tif (offset < container.length) {\n\t\t\t\t\thtml = html.replace(/&nbsp;(<br>|)$/, ' ');\n\t\t\t\t} else if (!hasSiblingText('nextSibling')) {\n\t\t\t\t\thtml = html.replace(/(&nbsp;| )(<br>|)$/, '&nbsp;');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn html;\n\t\t}\n\n\t\t// Removes &nbsp; from a [b] c -> a &nbsp;c -> a c\n\t\tfunction trimNbspAfterDeleteAndPaddValue() {\n\t\t\tvar rng, container, offset;\n\n\t\t\trng = selection.getRng(true);\n\t\t\tcontainer = rng.startContainer;\n\t\t\toffset = rng.startOffset;\n\n\t\t\tif (container.nodeType == 3 && rng.collapsed) {\n\t\t\t\tif (container.data[offset] === '\\u00a0') {\n\t\t\t\t\tcontainer.deleteData(offset, 1);\n\n\t\t\t\t\tif (!/[\\u00a0| ]$/.test(value)) {\n\t\t\t\t\t\tvalue += ' ';\n\t\t\t\t\t}\n\t\t\t\t} else if (container.data[offset - 1] === '\\u00a0') {\n\t\t\t\t\tcontainer.deleteData(offset - 1, 1);\n\n\t\t\t\t\tif (!/[\\u00a0| ]$/.test(value)) {\n\t\t\t\t\t\tvalue = ' ' + value;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction reduceInlineTextElements() {\n\t\t\tif (merge) {\n\t\t\t\tvar root = editor.getBody(), elementUtils = new ElementUtils(dom);\n\n\t\t\t\tTools.each(dom.select('*[data-mce-fragment]'), function(node) {\n\t\t\t\t\tfor (var testNode = node.parentNode; testNode && testNode != root; testNode = testNode.parentNode) {\n\t\t\t\t\t\tif (textInlineElements[node.nodeName.toLowerCase()] && elementUtils.compare(testNode, node)) {\n\t\t\t\t\t\t\tdom.remove(node, true);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tfunction markFragmentElements(fragment) {\n\t\t\tvar node = fragment;\n\n\t\t\twhile ((node = node.walk())) {\n\t\t\t\tif (node.type === 1) {\n\t\t\t\t\tnode.attr('data-mce-fragment', '1');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction umarkFragmentElements(elm) {\n\t\t\tTools.each(elm.getElementsByTagName('*'), function(elm) {\n\t\t\t\telm.removeAttribute('data-mce-fragment');\n\t\t\t});\n\t\t}\n\n\t\tfunction isPartOfFragment(node) {\n\t\t\treturn !!node.getAttribute('data-mce-fragment');\n\t\t}\n\n\t\tfunction canHaveChildren(node) {\n\t\t\treturn node && !editor.schema.getShortEndedElements()[node.nodeName];\n\t\t}\n\n\t\tfunction moveSelectionToMarker(marker) {\n\t\t\tvar parentEditableFalseElm, parentBlock, nextRng;\n\n\t\t\tfunction getContentEditableFalseParent(node) {\n\t\t\t\tvar root = editor.getBody();\n\n\t\t\t\tfor (; node && node !== root; node = node.parentNode) {\n\t\t\t\t\tif (editor.dom.getContentEditable(node) === 'false') {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (!marker) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tselection.scrollIntoView(marker);\n\n\t\t\t// If marker is in cE=false then move selection to that element instead\n\t\t\tparentEditableFalseElm = getContentEditableFalseParent(marker);\n\t\t\tif (parentEditableFalseElm) {\n\t\t\t\tdom.remove(marker);\n\t\t\t\tselection.select(parentEditableFalseElm);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Move selection before marker and remove it\n\t\t\trng = dom.createRng();\n\n\t\t\t// If previous sibling is a text node set the selection to the end of that node\n\t\t\tnode = marker.previousSibling;\n\t\t\tif (node && node.nodeType == 3) {\n\t\t\t\trng.setStart(node, node.nodeValue.length);\n\n\t\t\t\t// TODO: Why can't we normalize on IE\n\t\t\t\tif (!Env.ie) {\n\t\t\t\t\tnode2 = marker.nextSibling;\n\t\t\t\t\tif (node2 && node2.nodeType == 3) {\n\t\t\t\t\t\tnode.appendData(node2.data);\n\t\t\t\t\t\tnode2.parentNode.removeChild(node2);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// If the previous sibling isn't a text node or doesn't exist set the selection before the marker node\n\t\t\t\trng.setStartBefore(marker);\n\t\t\t\trng.setEndBefore(marker);\n\t\t\t}\n\n\t\t\tfunction findNextCaretRng(rng) {\n\t\t\t\tvar caretPos = CaretPosition.fromRangeStart(rng);\n\t\t\t\tvar caretWalker = new CaretWalker(editor.getBody());\n\n\t\t\t\tcaretPos = caretWalker.next(caretPos);\n\t\t\t\tif (caretPos) {\n\t\t\t\t\treturn caretPos.toRange();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Remove the marker node and set the new range\n\t\t\tparentBlock = dom.getParent(marker, dom.isBlock);\n\t\t\tdom.remove(marker);\n\n\t\t\tif (parentBlock && dom.isEmpty(parentBlock)) {\n\t\t\t\teditor.$(parentBlock).empty();\n\n\t\t\t\trng.setStart(parentBlock, 0);\n\t\t\t\trng.setEnd(parentBlock, 0);\n\n\t\t\t\tif (!isTableCell(parentBlock) && !isPartOfFragment(parentBlock) && (nextRng = findNextCaretRng(rng))) {\n\t\t\t\t\trng = nextRng;\n\t\t\t\t\tdom.remove(parentBlock);\n\t\t\t\t} else {\n\t\t\t\t\tdom.add(parentBlock, dom.create('br', {'data-mce-bogus': '1'}));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tselection.setRng(rng);\n\t\t}\n\n\t\t// Check for whitespace before/after value\n\t\tif (/^ | $/.test(value)) {\n\t\t\tvalue = trimOrPaddLeftRight(value);\n\t\t}\n\n\t\t// Setup parser and serializer\n\t\tparser = editor.parser;\n\t\tmerge = details.merge;\n\n\t\tserializer = new Serializer({\n\t\t\tvalidate: editor.settings.validate\n\t\t}, editor.schema);\n\t\tbookmarkHtml = '<span id=\"mce_marker\" data-mce-type=\"bookmark\">&#xFEFF;&#x200B;</span>';\n\n\t\t// Run beforeSetContent handlers on the HTML to be inserted\n\t\targs = {content: value, format: 'html', selection: true};\n\t\teditor.fire('BeforeSetContent', args);\n\t\tvalue = args.content;\n\n\t\t// Add caret at end of contents if it's missing\n\t\tif (value.indexOf('{$caret}') == -1) {\n\t\t\tvalue += '{$caret}';\n\t\t}\n\n\t\t// Replace the caret marker with a span bookmark element\n\t\tvalue = value.replace(/\\{\\$caret\\}/, bookmarkHtml);\n\n\t\t// If selection is at <body>|<p></p> then move it into <body><p>|</p>\n\t\trng = selection.getRng();\n\t\tvar caretElement = rng.startContainer || (rng.parentElement ? rng.parentElement() : null);\n\t\tvar body = editor.getBody();\n\t\tif (caretElement === body && selection.isCollapsed()) {\n\t\t\tif (dom.isBlock(body.firstChild) && canHaveChildren(body.firstChild) && dom.isEmpty(body.firstChild)) {\n\t\t\t\trng = dom.createRng();\n\t\t\t\trng.setStart(body.firstChild, 0);\n\t\t\t\trng.setEnd(body.firstChild, 0);\n\t\t\t\tselection.setRng(rng);\n\t\t\t}\n\t\t}\n\n\t\t// Insert node maker where we will insert the new HTML and get it's parent\n\t\tif (!selection.isCollapsed()) {\n\t\t\t// Fix for #2595 seems that delete removes one extra character on\n\t\t\t// WebKit for some odd reason if you double click select a word\n\t\t\teditor.selection.setRng(editor.selection.getRng());\n\t\t\teditor.getDoc().execCommand('Delete', false, null);\n\t\t\ttrimNbspAfterDeleteAndPaddValue();\n\t\t}\n\n\t\tparentNode = selection.getNode();\n\n\t\t// Parse the fragment within the context of the parent node\n\t\tvar parserArgs = {context: parentNode.nodeName.toLowerCase(), data: details.data};\n\t\tfragment = parser.parse(value, parserArgs);\n\n\t\t// Custom handling of lists\n\t\tif (details.paste === true && InsertList.isListFragment(fragment) && InsertList.isParentBlockLi(dom, parentNode)) {\n\t\t\trng = InsertList.insertAtCaret(serializer, dom, editor.selection.getRng(true), fragment);\n\t\t\teditor.selection.setRng(rng);\n\t\t\teditor.fire('SetContent', args);\n\t\t\treturn;\n\t\t}\n\n\t\tmarkFragmentElements(fragment);\n\n\t\t// Move the caret to a more suitable location\n\t\tnode = fragment.lastChild;\n\t\tif (node.attr('id') == 'mce_marker') {\n\t\t\tmarker = node;\n\n\t\t\tfor (node = node.prev; node; node = node.walk(true)) {\n\t\t\t\tif (node.type == 3 || !dom.isBlock(node.name)) {\n\t\t\t\t\tif (editor.schema.isValidChild(node.parent.name, 'span')) {\n\t\t\t\t\t\tnode.parent.insert(marker, node, node.name === 'br');\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\teditor._selectionOverrides.showBlockCaretContainer(parentNode);\n\n\t\t// If parser says valid we can insert the contents into that parent\n\t\tif (!parserArgs.invalid) {\n\t\t\tvalue = serializer.serialize(fragment);\n\n\t\t\t// Check if parent is empty or only has one BR element then set the innerHTML of that parent\n\t\t\tnode = parentNode.firstChild;\n\t\t\tnode2 = parentNode.lastChild;\n\t\t\tif (!node || (node === node2 && node.nodeName === 'BR')) {\n\t\t\t\tdom.setHTML(parentNode, value);\n\t\t\t} else {\n\t\t\t\tselection.setContent(value);\n\t\t\t}\n\t\t} else {\n\t\t\t// If the fragment was invalid within that context then we need\n\t\t\t// to parse and process the parent it's inserted into\n\n\t\t\t// Insert bookmark node and get the parent\n\t\t\tselection.setContent(bookmarkHtml);\n\t\t\tparentNode = selection.getNode();\n\t\t\trootNode = editor.getBody();\n\n\t\t\t// Opera will return the document node when selection is in root\n\t\t\tif (parentNode.nodeType == 9) {\n\t\t\t\tparentNode = node = rootNode;\n\t\t\t} else {\n\t\t\t\tnode = parentNode;\n\t\t\t}\n\n\t\t\t// Find the ancestor just before the root element\n\t\t\twhile (node !== rootNode) {\n\t\t\t\tparentNode = node;\n\t\t\t\tnode = node.parentNode;\n\t\t\t}\n\n\t\t\t// Get the outer/inner HTML depending on if we are in the root and parser and serialize that\n\t\t\tvalue = parentNode == rootNode ? rootNode.innerHTML : dom.getOuterHTML(parentNode);\n\t\t\tvalue = serializer.serialize(\n\t\t\t\tparser.parse(\n\t\t\t\t\t// Need to replace by using a function since $ in the contents would otherwise be a problem\n\t\t\t\t\tvalue.replace(/<span (id=\"mce_marker\"|id=mce_marker).+?<\\/span>/i, function() {\n\t\t\t\t\t\treturn serializer.serialize(fragment);\n\t\t\t\t\t})\n\t\t\t\t)\n\t\t\t);\n\n\t\t\t// Set the inner/outer HTML depending on if we are in the root or not\n\t\t\tif (parentNode == rootNode) {\n\t\t\t\tdom.setHTML(rootNode, value);\n\t\t\t} else {\n\t\t\t\tdom.setOuterHTML(parentNode, value);\n\t\t\t}\n\t\t}\n\n\t\treduceInlineTextElements();\n\t\tmoveSelectionToMarker(dom.get('mce_marker'));\n\t\tumarkFragmentElements(editor.getBody());\n\t\teditor.fire('SetContent', args);\n\t\teditor.addVisual();\n\t};\n\n\tvar processValue = function (value) {\n\t\tvar details;\n\n\t\tif (typeof value !== 'string') {\n\t\t\tdetails = Tools.extend({\n\t\t\t\tpaste: value.paste,\n\t\t\t\tdata: {\n\t\t\t\t\tpaste: value.paste\n\t\t\t\t}\n\t\t\t}, value);\n\n\t\t\treturn {\n\t\t\t\tcontent: value.content,\n\t\t\t\tdetails: details\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\tcontent: value,\n\t\t\tdetails: {}\n\t\t};\n\t};\n\n\tvar insertAtCaret = function (editor, value) {\n\t\tvar result = processValue(value);\n\t\tinsertHtmlAtCaret(editor, result.content, result.details);\n\t};\n\n\treturn {\n\t\tinsertAtCaret: insertAtCaret\n\t};\n});\n\n// Included from: js/tinymce/classes/EditorCommands.js\n\n/**\n * EditorCommands.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class enables you to add custom editor commands and it contains\n * overrides for native browser commands to address various bugs and issues.\n *\n * @class tinymce.EditorCommands\n */\ndefine(\"tinymce/EditorCommands\", [\n\t\"tinymce/Env\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/dom/RangeUtils\",\n\t\"tinymce/dom/TreeWalker\",\n\t\"tinymce/InsertContent\"\n], function(Env, Tools, RangeUtils, TreeWalker, InsertContent) {\n\t// Added for compression purposes\n\tvar each = Tools.each, extend = Tools.extend;\n\tvar map = Tools.map, inArray = Tools.inArray, explode = Tools.explode;\n\tvar isOldIE = Env.ie && Env.ie < 11;\n\tvar TRUE = true, FALSE = false;\n\n\treturn function(editor) {\n\t\tvar dom, selection, formatter,\n\t\t\tcommands = {state: {}, exec: {}, value: {}},\n\t\t\tsettings = editor.settings,\n\t\t\tbookmark;\n\n\t\teditor.on('PreInit', function() {\n\t\t\tdom = editor.dom;\n\t\t\tselection = editor.selection;\n\t\t\tsettings = editor.settings;\n\t\t\tformatter = editor.formatter;\n\t\t});\n\n\t\t/**\n\t\t * Executes the specified command.\n\t\t *\n\t\t * @method execCommand\n\t\t * @param {String} command Command to execute.\n\t\t * @param {Boolean} ui Optional user interface state.\n\t\t * @param {Object} value Optional value for command.\n\t\t * @param {Object} args Optional extra arguments to the execCommand.\n\t\t * @return {Boolean} true/false if the command was found or not.\n\t\t */\n\t\tfunction execCommand(command, ui, value, args) {\n\t\t\tvar func, customCommand, state = 0;\n\n\t\t\tif (!/^(mceAddUndoLevel|mceEndUndoLevel|mceBeginUndoLevel|mceRepaint)$/.test(command) && (!args || !args.skip_focus)) {\n\t\t\t\teditor.focus();\n\t\t\t}\n\n\t\t\targs = editor.fire('BeforeExecCommand', {command: command, ui: ui, value: value});\n\t\t\tif (args.isDefaultPrevented()) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tcustomCommand = command.toLowerCase();\n\t\t\tif ((func = commands.exec[customCommand])) {\n\t\t\t\tfunc(customCommand, ui, value);\n\t\t\t\teditor.fire('ExecCommand', {command: command, ui: ui, value: value});\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t// Plugin commands\n\t\t\teach(editor.plugins, function(p) {\n\t\t\t\tif (p.execCommand && p.execCommand(command, ui, value)) {\n\t\t\t\t\teditor.fire('ExecCommand', {command: command, ui: ui, value: value});\n\t\t\t\t\tstate = true;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (state) {\n\t\t\t\treturn state;\n\t\t\t}\n\n\t\t\t// Theme commands\n\t\t\tif (editor.theme && editor.theme.execCommand && editor.theme.execCommand(command, ui, value)) {\n\t\t\t\teditor.fire('ExecCommand', {command: command, ui: ui, value: value});\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t// Browser commands\n\t\t\ttry {\n\t\t\t\tstate = editor.getDoc().execCommand(command, ui, value);\n\t\t\t} catch (ex) {\n\t\t\t\t// Ignore old IE errors\n\t\t\t}\n\n\t\t\tif (state) {\n\t\t\t\teditor.fire('ExecCommand', {command: command, ui: ui, value: value});\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\t/**\n\t\t * Queries the current state for a command for example if the current selection is \"bold\".\n\t\t *\n\t\t * @method queryCommandState\n\t\t * @param {String} command Command to check the state of.\n\t\t * @return {Boolean/Number} true/false if the selected contents is bold or not, -1 if it's not found.\n\t\t */\n\t\tfunction queryCommandState(command) {\n\t\t\tvar func;\n\n\t\t\t// Is hidden then return undefined\n\t\t\tif (editor.quirks.isHidden()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcommand = command.toLowerCase();\n\t\t\tif ((func = commands.state[command])) {\n\t\t\t\treturn func(command);\n\t\t\t}\n\n\t\t\t// Browser commands\n\t\t\ttry {\n\t\t\t\treturn editor.getDoc().queryCommandState(command);\n\t\t\t} catch (ex) {\n\t\t\t\t// Fails sometimes see bug: 1896577\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\t/**\n\t\t * Queries the command value for example the current fontsize.\n\t\t *\n\t\t * @method queryCommandValue\n\t\t * @param {String} command Command to check the value of.\n\t\t * @return {Object} Command value of false if it's not found.\n\t\t */\n\t\tfunction queryCommandValue(command) {\n\t\t\tvar func;\n\n\t\t\t// Is hidden then return undefined\n\t\t\tif (editor.quirks.isHidden()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcommand = command.toLowerCase();\n\t\t\tif ((func = commands.value[command])) {\n\t\t\t\treturn func(command);\n\t\t\t}\n\n\t\t\t// Browser commands\n\t\t\ttry {\n\t\t\t\treturn editor.getDoc().queryCommandValue(command);\n\t\t\t} catch (ex) {\n\t\t\t\t// Fails sometimes see bug: 1896577\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Adds commands to the command collection.\n\t\t *\n\t\t * @method addCommands\n\t\t * @param {Object} command_list Name/value collection with commands to add, the names can also be comma separated.\n\t\t * @param {String} type Optional type to add, defaults to exec. Can be value or state as well.\n\t\t */\n\t\tfunction addCommands(command_list, type) {\n\t\t\ttype = type || 'exec';\n\n\t\t\teach(command_list, function(callback, command) {\n\t\t\t\teach(command.toLowerCase().split(','), function(command) {\n\t\t\t\t\tcommands[type][command] = callback;\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tfunction addCommand(command, callback, scope) {\n\t\t\tcommand = command.toLowerCase();\n\t\t\tcommands.exec[command] = function(command, ui, value, args) {\n\t\t\t\treturn callback.call(scope || editor, ui, value, args);\n\t\t\t};\n\t\t}\n\n\t\t/**\n\t\t * Returns true/false if the command is supported or not.\n\t\t *\n\t\t * @method queryCommandSupported\n\t\t * @param {String} command Command that we check support for.\n\t\t * @return {Boolean} true/false if the command is supported or not.\n\t\t */\n\t\tfunction queryCommandSupported(command) {\n\t\t\tcommand = command.toLowerCase();\n\n\t\t\tif (commands.exec[command]) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t// Browser commands\n\t\t\ttry {\n\t\t\t\treturn editor.getDoc().queryCommandSupported(command);\n\t\t\t} catch (ex) {\n\t\t\t\t// Fails sometimes see bug: 1896577\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\tfunction addQueryStateHandler(command, callback, scope) {\n\t\t\tcommand = command.toLowerCase();\n\t\t\tcommands.state[command] = function() {\n\t\t\t\treturn callback.call(scope || editor);\n\t\t\t};\n\t\t}\n\n\t\tfunction addQueryValueHandler(command, callback, scope) {\n\t\t\tcommand = command.toLowerCase();\n\t\t\tcommands.value[command] = function() {\n\t\t\t\treturn callback.call(scope || editor);\n\t\t\t};\n\t\t}\n\n\t\tfunction hasCustomCommand(command) {\n\t\t\tcommand = command.toLowerCase();\n\t\t\treturn !!commands.exec[command];\n\t\t}\n\n\t\t// Expose public methods\n\t\textend(this, {\n\t\t\texecCommand: execCommand,\n\t\t\tqueryCommandState: queryCommandState,\n\t\t\tqueryCommandValue: queryCommandValue,\n\t\t\tqueryCommandSupported: queryCommandSupported,\n\t\t\taddCommands: addCommands,\n\t\t\taddCommand: addCommand,\n\t\t\taddQueryStateHandler: addQueryStateHandler,\n\t\t\taddQueryValueHandler: addQueryValueHandler,\n\t\t\thasCustomCommand: hasCustomCommand\n\t\t});\n\n\t\t// Private methods\n\n\t\tfunction execNativeCommand(command, ui, value) {\n\t\t\tif (ui === undefined) {\n\t\t\t\tui = FALSE;\n\t\t\t}\n\n\t\t\tif (value === undefined) {\n\t\t\t\tvalue = null;\n\t\t\t}\n\n\t\t\treturn editor.getDoc().execCommand(command, ui, value);\n\t\t}\n\n\t\tfunction isFormatMatch(name) {\n\t\t\treturn formatter.match(name);\n\t\t}\n\n\t\tfunction toggleFormat(name, value) {\n\t\t\tformatter.toggle(name, value ? {value: value} : undefined);\n\t\t\teditor.nodeChanged();\n\t\t}\n\n\t\tfunction storeSelection(type) {\n\t\t\tbookmark = selection.getBookmark(type);\n\t\t}\n\n\t\tfunction restoreSelection() {\n\t\t\tselection.moveToBookmark(bookmark);\n\t\t}\n\n\t\t// Add execCommand overrides\n\t\taddCommands({\n\t\t\t// Ignore these, added for compatibility\n\t\t\t'mceResetDesignMode,mceBeginUndoLevel': function() {},\n\n\t\t\t// Add undo manager logic\n\t\t\t'mceEndUndoLevel,mceAddUndoLevel': function() {\n\t\t\t\teditor.undoManager.add();\n\t\t\t},\n\n\t\t\t'Cut,Copy,Paste': function(command) {\n\t\t\t\tvar doc = editor.getDoc(), failed;\n\n\t\t\t\t// Try executing the native command\n\t\t\t\ttry {\n\t\t\t\t\texecNativeCommand(command);\n\t\t\t\t} catch (ex) {\n\t\t\t\t\t// Command failed\n\t\t\t\t\tfailed = TRUE;\n\t\t\t\t}\n\n\t\t\t\t// Chrome reports the paste command as supported however older IE:s will return false for cut/paste\n\t\t\t\tif (command === 'paste' && !doc.queryCommandEnabled(command)) {\n\t\t\t\t\tfailed = true;\n\t\t\t\t}\n\n\t\t\t\t// Present alert message about clipboard access not being available\n\t\t\t\tif (failed || !doc.queryCommandSupported(command)) {\n\t\t\t\t\tvar msg = editor.translate(\n\t\t\t\t\t\t\"Your browser doesn't support direct access to the clipboard. \" +\n\t\t\t\t\t\t\"Please use the Ctrl+X/C/V keyboard shortcuts instead.\"\n\t\t\t\t\t);\n\n\t\t\t\t\tif (Env.mac) {\n\t\t\t\t\t\tmsg = msg.replace(/Ctrl\\+/g, '\\u2318+');\n\t\t\t\t\t}\n\n\t\t\t\t\teditor.notificationManager.open({text: msg, type: 'error'});\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t// Override unlink command\n\t\t\tunlink: function() {\n\t\t\t\tif (selection.isCollapsed()) {\n\t\t\t\t\tvar elm = editor.dom.getParent(editor.selection.getStart(), 'a');\n\t\t\t\t\tif (elm) {\n\t\t\t\t\t\teditor.dom.remove(elm, true);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tformatter.remove(\"link\");\n\t\t\t},\n\n\t\t\t// Override justify commands to use the text formatter engine\n\t\t\t'JustifyLeft,JustifyCenter,JustifyRight,JustifyFull,JustifyNone': function(command) {\n\t\t\t\tvar align = command.substring(7);\n\n\t\t\t\tif (align == 'full') {\n\t\t\t\t\talign = 'justify';\n\t\t\t\t}\n\n\t\t\t\t// Remove all other alignments first\n\t\t\t\teach('left,center,right,justify'.split(','), function(name) {\n\t\t\t\t\tif (align != name) {\n\t\t\t\t\t\tformatter.remove('align' + name);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (align != 'none') {\n\t\t\t\t\ttoggleFormat('align' + align);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t// Override list commands to fix WebKit bug\n\t\t\t'InsertUnorderedList,InsertOrderedList': function(command) {\n\t\t\t\tvar listElm, listParent;\n\n\t\t\t\texecNativeCommand(command);\n\n\t\t\t\t// WebKit produces lists within block elements so we need to split them\n\t\t\t\t// we will replace the native list creation logic to custom logic later on\n\t\t\t\t// TODO: Remove this when the list creation logic is removed\n\t\t\t\tlistElm = dom.getParent(selection.getNode(), 'ol,ul');\n\t\t\t\tif (listElm) {\n\t\t\t\t\tlistParent = listElm.parentNode;\n\n\t\t\t\t\t// If list is within a text block then split that block\n\t\t\t\t\tif (/^(H[1-6]|P|ADDRESS|PRE)$/.test(listParent.nodeName)) {\n\t\t\t\t\t\tstoreSelection();\n\t\t\t\t\t\tdom.split(listParent, listElm);\n\t\t\t\t\t\trestoreSelection();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t// Override commands to use the text formatter engine\n\t\t\t'Bold,Italic,Underline,Strikethrough,Superscript,Subscript': function(command) {\n\t\t\t\ttoggleFormat(command);\n\t\t\t},\n\n\t\t\t// Override commands to use the text formatter engine\n\t\t\t'ForeColor,HiliteColor,FontName': function(command, ui, value) {\n\t\t\t\ttoggleFormat(command, value);\n\t\t\t},\n\n\t\t\tFontSize: function(command, ui, value) {\n\t\t\t\tvar fontClasses, fontSizes;\n\n\t\t\t\t// Convert font size 1-7 to styles\n\t\t\t\tif (value >= 1 && value <= 7) {\n\t\t\t\t\tfontSizes = explode(settings.font_size_style_values);\n\t\t\t\t\tfontClasses = explode(settings.font_size_classes);\n\n\t\t\t\t\tif (fontClasses) {\n\t\t\t\t\t\tvalue = fontClasses[value - 1] || value;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvalue = fontSizes[value - 1] || value;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ttoggleFormat(command, value);\n\t\t\t},\n\n\t\t\tRemoveFormat: function(command) {\n\t\t\t\tformatter.remove(command);\n\t\t\t},\n\n\t\t\tmceBlockQuote: function() {\n\t\t\t\ttoggleFormat('blockquote');\n\t\t\t},\n\n\t\t\tFormatBlock: function(command, ui, value) {\n\t\t\t\treturn toggleFormat(value || 'p');\n\t\t\t},\n\n\t\t\tmceCleanup: function() {\n\t\t\t\tvar bookmark = selection.getBookmark();\n\n\t\t\t\teditor.setContent(editor.getContent({cleanup: TRUE}), {cleanup: TRUE});\n\n\t\t\t\tselection.moveToBookmark(bookmark);\n\t\t\t},\n\n\t\t\tmceRemoveNode: function(command, ui, value) {\n\t\t\t\tvar node = value || selection.getNode();\n\n\t\t\t\t// Make sure that the body node isn't removed\n\t\t\t\tif (node != editor.getBody()) {\n\t\t\t\t\tstoreSelection();\n\t\t\t\t\teditor.dom.remove(node, TRUE);\n\t\t\t\t\trestoreSelection();\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tmceSelectNodeDepth: function(command, ui, value) {\n\t\t\t\tvar counter = 0;\n\n\t\t\t\tdom.getParent(selection.getNode(), function(node) {\n\t\t\t\t\tif (node.nodeType == 1 && counter++ == value) {\n\t\t\t\t\t\tselection.select(node);\n\t\t\t\t\t\treturn FALSE;\n\t\t\t\t\t}\n\t\t\t\t}, editor.getBody());\n\t\t\t},\n\n\t\t\tmceSelectNode: function(command, ui, value) {\n\t\t\t\tselection.select(value);\n\t\t\t},\n\n\t\t\tmceInsertContent: function(command, ui, value) {\n\t\t\t\tInsertContent.insertAtCaret(editor, value);\n\t\t\t},\n\n\t\t\tmceInsertRawHTML: function(command, ui, value) {\n\t\t\t\tselection.setContent('tiny_mce_marker');\n\t\t\t\teditor.setContent(\n\t\t\t\t\teditor.getContent().replace(/tiny_mce_marker/g, function() {\n\t\t\t\t\t\treturn value;\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t},\n\n\t\t\tmceToggleFormat: function(command, ui, value) {\n\t\t\t\ttoggleFormat(value);\n\t\t\t},\n\n\t\t\tmceSetContent: function(command, ui, value) {\n\t\t\t\teditor.setContent(value);\n\t\t\t},\n\n\t\t\t'Indent,Outdent': function(command) {\n\t\t\t\tvar intentValue, indentUnit, value;\n\n\t\t\t\t// Setup indent level\n\t\t\t\tintentValue = settings.indentation;\n\t\t\t\tindentUnit = /[a-z%]+$/i.exec(intentValue);\n\t\t\t\tintentValue = parseInt(intentValue, 10);\n\n\t\t\t\tif (!queryCommandState('InsertUnorderedList') && !queryCommandState('InsertOrderedList')) {\n\t\t\t\t\t// If forced_root_blocks is set to false we don't have a block to indent so lets create a div\n\t\t\t\t\tif (!settings.forced_root_block && !dom.getParent(selection.getNode(), dom.isBlock)) {\n\t\t\t\t\t\tformatter.apply('div');\n\t\t\t\t\t}\n\n\t\t\t\t\teach(selection.getSelectedBlocks(), function(element) {\n\t\t\t\t\t\tif (dom.getContentEditable(element) === \"false\") {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (element.nodeName !== \"LI\") {\n\t\t\t\t\t\t\tvar indentStyleName = editor.getParam('indent_use_margin', false) ? 'margin' : 'padding';\n\t\t\t\t\t\t\tindentStyleName = element.nodeName === 'TABLE' ? 'margin' : indentStyleName;\n\t\t\t\t\t\t\tindentStyleName += dom.getStyle(element, 'direction', true) == 'rtl' ? 'Right' : 'Left';\n\n\t\t\t\t\t\t\tif (command == 'outdent') {\n\t\t\t\t\t\t\t\tvalue = Math.max(0, parseInt(element.style[indentStyleName] || 0, 10) - intentValue);\n\t\t\t\t\t\t\t\tdom.setStyle(element, indentStyleName, value ? value + indentUnit : '');\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tvalue = (parseInt(element.style[indentStyleName] || 0, 10) + intentValue) + indentUnit;\n\t\t\t\t\t\t\t\tdom.setStyle(element, indentStyleName, value);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\texecNativeCommand(command);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tmceRepaint: function() {\n\t\t\t},\n\n\t\t\tInsertHorizontalRule: function() {\n\t\t\t\teditor.execCommand('mceInsertContent', false, '<hr />');\n\t\t\t},\n\n\t\t\tmceToggleVisualAid: function() {\n\t\t\t\teditor.hasVisual = !editor.hasVisual;\n\t\t\t\teditor.addVisual();\n\t\t\t},\n\n\t\t\tmceReplaceContent: function(command, ui, value) {\n\t\t\t\teditor.execCommand('mceInsertContent', false, value.replace(/\\{\\$selection\\}/g, selection.getContent({format: 'text'})));\n\t\t\t},\n\n\t\t\tmceInsertLink: function(command, ui, value) {\n\t\t\t\tvar anchor;\n\n\t\t\t\tif (typeof value == 'string') {\n\t\t\t\t\tvalue = {href: value};\n\t\t\t\t}\n\n\t\t\t\tanchor = dom.getParent(selection.getNode(), 'a');\n\n\t\t\t\t// Spaces are never valid in URLs and it's a very common mistake for people to make so we fix it here.\n\t\t\t\tvalue.href = value.href.replace(' ', '%20');\n\n\t\t\t\t// Remove existing links if there could be child links or that the href isn't specified\n\t\t\t\tif (!anchor || !value.href) {\n\t\t\t\t\tformatter.remove('link');\n\t\t\t\t}\n\n\t\t\t\t// Apply new link to selection\n\t\t\t\tif (value.href) {\n\t\t\t\t\tformatter.apply('link', value, anchor);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tselectAll: function() {\n\t\t\t\tvar root = dom.getRoot(), rng;\n\n\t\t\t\tif (selection.getRng().setStart) {\n\t\t\t\t\trng = dom.createRng();\n\t\t\t\t\trng.setStart(root, 0);\n\t\t\t\t\trng.setEnd(root, root.childNodes.length);\n\t\t\t\t\tselection.setRng(rng);\n\t\t\t\t} else {\n\t\t\t\t\t// IE will render it's own root level block elements and sometimes\n\t\t\t\t\t// even put font elements in them when the user starts typing. So we need to\n\t\t\t\t\t// move the selection to a more suitable element from this:\n\t\t\t\t\t// <body>|<p></p></body> to this: <body><p>|</p></body>\n\t\t\t\t\trng = selection.getRng();\n\t\t\t\t\tif (!rng.item) {\n\t\t\t\t\t\trng.moveToElementText(root);\n\t\t\t\t\t\trng.select();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t\"delete\": function() {\n\t\t\t\texecNativeCommand(\"Delete\");\n\n\t\t\t\t// Check if body is empty after the delete call if so then set the contents\n\t\t\t\t// to an empty string and move the caret to any block produced by that operation\n\t\t\t\t// this fixes the issue with root blocks not being properly produced after a delete call on IE\n\t\t\t\tvar body = editor.getBody();\n\n\t\t\t\tif (dom.isEmpty(body)) {\n\t\t\t\t\teditor.setContent('');\n\n\t\t\t\t\tif (body.firstChild && dom.isBlock(body.firstChild)) {\n\t\t\t\t\t\teditor.selection.setCursorLocation(body.firstChild, 0);\n\t\t\t\t\t} else {\n\t\t\t\t\t\teditor.selection.setCursorLocation(body, 0);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tmceNewDocument: function() {\n\t\t\t\teditor.setContent('');\n\t\t\t},\n\n\t\t\tInsertLineBreak: function(command, ui, value) {\n\t\t\t\t// We load the current event in from EnterKey.js when appropriate to heed\n\t\t\t\t// certain event-specific variations such as ctrl-enter in a list\n\t\t\t\tvar evt = value;\n\t\t\t\tvar brElm, extraBr, marker;\n\t\t\t\tvar rng = selection.getRng(true);\n\t\t\t\tnew RangeUtils(dom).normalize(rng);\n\n\t\t\t\tvar offset = rng.startOffset;\n\t\t\t\tvar container = rng.startContainer;\n\n\t\t\t\t// Resolve node index\n\t\t\t\tif (container.nodeType == 1 && container.hasChildNodes()) {\n\t\t\t\t\tvar isAfterLastNodeInContainer = offset > container.childNodes.length - 1;\n\n\t\t\t\t\tcontainer = container.childNodes[Math.min(offset, container.childNodes.length - 1)] || container;\n\t\t\t\t\tif (isAfterLastNodeInContainer && container.nodeType == 3) {\n\t\t\t\t\t\toffset = container.nodeValue.length;\n\t\t\t\t\t} else {\n\t\t\t\t\t\toffset = 0;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tvar parentBlock = dom.getParent(container, dom.isBlock);\n\t\t\t\tvar parentBlockName = parentBlock ? parentBlock.nodeName.toUpperCase() : ''; // IE < 9 & HTML5\n\t\t\t\tvar containerBlock = parentBlock ? dom.getParent(parentBlock.parentNode, dom.isBlock) : null;\n\t\t\t\tvar containerBlockName = containerBlock ? containerBlock.nodeName.toUpperCase() : ''; // IE < 9 & HTML5\n\n\t\t\t\t// Enter inside block contained within a LI then split or insert before/after LI\n\t\t\t\tvar isControlKey = evt && evt.ctrlKey;\n\t\t\t\tif (containerBlockName == 'LI' && !isControlKey) {\n\t\t\t\t\tparentBlock = containerBlock;\n\t\t\t\t\tparentBlockName = containerBlockName;\n\t\t\t\t}\n\n\t\t\t\t// Walks the parent block to the right and look for BR elements\n\t\t\t\tfunction hasRightSideContent() {\n\t\t\t\t\tvar walker = new TreeWalker(container, parentBlock), node;\n\t\t\t\t\tvar nonEmptyElementsMap = editor.schema.getNonEmptyElements();\n\n\t\t\t\t\twhile ((node = walker.next())) {\n\t\t\t\t\t\tif (nonEmptyElementsMap[node.nodeName.toLowerCase()] || node.length > 0) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (container && container.nodeType == 3 && offset >= container.nodeValue.length) {\n\t\t\t\t\t// Insert extra BR element at the end block elements\n\t\t\t\t\tif (!isOldIE && !hasRightSideContent()) {\n\t\t\t\t\t\tbrElm = dom.create('br');\n\t\t\t\t\t\trng.insertNode(brElm);\n\t\t\t\t\t\trng.setStartAfter(brElm);\n\t\t\t\t\t\trng.setEndAfter(brElm);\n\t\t\t\t\t\textraBr = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tbrElm = dom.create('br');\n\t\t\t\trng.insertNode(brElm);\n\n\t\t\t\t// Rendering modes below IE8 doesn't display BR elements in PRE unless we have a \\n before it\n\t\t\t\tvar documentMode = dom.doc.documentMode;\n\t\t\t\tif (isOldIE && parentBlockName == 'PRE' && (!documentMode || documentMode < 8)) {\n\t\t\t\t\tbrElm.parentNode.insertBefore(dom.doc.createTextNode('\\r'), brElm);\n\t\t\t\t}\n\n\t\t\t\t// Insert temp marker and scroll to that\n\t\t\t\tmarker = dom.create('span', {}, '&nbsp;');\n\t\t\t\tbrElm.parentNode.insertBefore(marker, brElm);\n\t\t\t\tselection.scrollIntoView(marker);\n\t\t\t\tdom.remove(marker);\n\n\t\t\t\tif (!extraBr) {\n\t\t\t\t\trng.setStartAfter(brElm);\n\t\t\t\t\trng.setEndAfter(brElm);\n\t\t\t\t} else {\n\t\t\t\t\trng.setStartBefore(brElm);\n\t\t\t\t\trng.setEndBefore(brElm);\n\t\t\t\t}\n\n\t\t\t\tselection.setRng(rng);\n\t\t\t\teditor.undoManager.add();\n\n\t\t\t\treturn TRUE;\n\t\t\t}\n\t\t});\n\n\t\t// Add queryCommandState overrides\n\t\taddCommands({\n\t\t\t// Override justify commands\n\t\t\t'JustifyLeft,JustifyCenter,JustifyRight,JustifyFull': function(command) {\n\t\t\t\tvar name = 'align' + command.substring(7);\n\t\t\t\tvar nodes = selection.isCollapsed() ? [dom.getParent(selection.getNode(), dom.isBlock)] : selection.getSelectedBlocks();\n\t\t\t\tvar matches = map(nodes, function(node) {\n\t\t\t\t\treturn !!formatter.matchNode(node, name);\n\t\t\t\t});\n\t\t\t\treturn inArray(matches, TRUE) !== -1;\n\t\t\t},\n\n\t\t\t'Bold,Italic,Underline,Strikethrough,Superscript,Subscript': function(command) {\n\t\t\t\treturn isFormatMatch(command);\n\t\t\t},\n\n\t\t\tmceBlockQuote: function() {\n\t\t\t\treturn isFormatMatch('blockquote');\n\t\t\t},\n\n\t\t\tOutdent: function() {\n\t\t\t\tvar node;\n\n\t\t\t\tif (settings.inline_styles) {\n\t\t\t\t\tif ((node = dom.getParent(selection.getStart(), dom.isBlock)) && parseInt(node.style.paddingLeft, 10) > 0) {\n\t\t\t\t\t\treturn TRUE;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ((node = dom.getParent(selection.getEnd(), dom.isBlock)) && parseInt(node.style.paddingLeft, 10) > 0) {\n\t\t\t\t\t\treturn TRUE;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn (\n\t\t\t\t\tqueryCommandState('InsertUnorderedList') ||\n\t\t\t\t\tqueryCommandState('InsertOrderedList') ||\n\t\t\t\t\t(!settings.inline_styles && !!dom.getParent(selection.getNode(), 'BLOCKQUOTE'))\n\t\t\t\t);\n\t\t\t},\n\n\t\t\t'InsertUnorderedList,InsertOrderedList': function(command) {\n\t\t\t\tvar list = dom.getParent(selection.getNode(), 'ul,ol');\n\n\t\t\t\treturn list &&\n\t\t\t\t\t(\n\t\t\t\t\t\tcommand === 'insertunorderedlist' && list.tagName === 'UL' ||\n\t\t\t\t\t\tcommand === 'insertorderedlist' && list.tagName === 'OL'\n\t\t\t\t\t);\n\t\t\t}\n\t\t}, 'state');\n\n\t\t// Add queryCommandValue overrides\n\t\taddCommands({\n\t\t\t'FontSize,FontName': function(command) {\n\t\t\t\tvar value = 0, parent;\n\n\t\t\t\tif ((parent = dom.getParent(selection.getNode(), 'span'))) {\n\t\t\t\t\tif (command == 'fontsize') {\n\t\t\t\t\t\tvalue = parent.style.fontSize;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvalue = parent.style.fontFamily.replace(/, /g, ',').replace(/[\\'\\\"]/g, '').toLowerCase();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t}\n\t\t}, 'value');\n\n\t\t// Add undo manager logic\n\t\taddCommands({\n\t\t\tUndo: function() {\n\t\t\t\teditor.undoManager.undo();\n\t\t\t},\n\n\t\t\tRedo: function() {\n\t\t\t\teditor.undoManager.redo();\n\t\t\t}\n\t\t});\n\t};\n});\n\n// Included from: js/tinymce/classes/util/URI.js\n\n/**\n * URI.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class handles parsing, modification and serialization of URI/URL strings.\n * @class tinymce.util.URI\n */\ndefine(\"tinymce/util/URI\", [\n\t\"tinymce/util/Tools\"\n], function(Tools) {\n\tvar each = Tools.each, trim = Tools.trim;\n\tvar queryParts = \"source protocol authority userInfo user password host port relative path directory file query anchor\".split(' ');\n\tvar DEFAULT_PORTS = {\n\t\t'ftp': 21,\n\t\t'http': 80,\n\t\t'https': 443,\n\t\t'mailto': 25\n\t};\n\n\t/**\n\t * Constructs a new URI instance.\n\t *\n\t * @constructor\n\t * @method URI\n\t * @param {String} url URI string to parse.\n\t * @param {Object} settings Optional settings object.\n\t */\n\tfunction URI(url, settings) {\n\t\tvar self = this, baseUri, base_url;\n\n\t\turl = trim(url);\n\t\tsettings = self.settings = settings || {};\n\t\tbaseUri = settings.base_uri;\n\n\t\t// Strange app protocol that isn't http/https or local anchor\n\t\t// For example: mailto,skype,tel etc.\n\t\tif (/^([\\w\\-]+):([^\\/]{2})/i.test(url) || /^\\s*#/.test(url)) {\n\t\t\tself.source = url;\n\t\t\treturn;\n\t\t}\n\n\t\tvar isProtocolRelative = url.indexOf('//') === 0;\n\n\t\t// Absolute path with no host, fake host and protocol\n\t\tif (url.indexOf('/') === 0 && !isProtocolRelative) {\n\t\t\turl = (baseUri ? baseUri.protocol || 'http' : 'http') + '://mce_host' + url;\n\t\t}\n\n\t\t// Relative path http:// or protocol relative //path\n\t\tif (!/^[\\w\\-]*:?\\/\\//.test(url)) {\n\t\t\tbase_url = settings.base_uri ? settings.base_uri.path : new URI(location.href).directory;\n\t\t\tif (settings.base_uri.protocol === \"\") {\n\t\t\t\turl = '//mce_host' + self.toAbsPath(base_url, url);\n\t\t\t} else {\n\t\t\t\turl = /([^#?]*)([#?]?.*)/.exec(url);\n\t\t\t\turl = ((baseUri && baseUri.protocol) || 'http') + '://mce_host' + self.toAbsPath(base_url, url[1]) + url[2];\n\t\t\t}\n\t\t}\n\n\t\t// Parse URL (Credits goes to Steave, http://blog.stevenlevithan.com/archives/parseuri)\n\t\turl = url.replace(/@@/g, '(mce_at)'); // Zope 3 workaround, they use @@something\n\n\t\t/*jshint maxlen: 255 */\n\t\t/*eslint max-len: 0 */\n\t\turl = /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@\\/]*):?([^:@\\/]*))?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/.exec(url);\n\n\t\teach(queryParts, function(v, i) {\n\t\t\tvar part = url[i];\n\n\t\t\t// Zope 3 workaround, they use @@something\n\t\t\tif (part) {\n\t\t\t\tpart = part.replace(/\\(mce_at\\)/g, '@@');\n\t\t\t}\n\n\t\t\tself[v] = part;\n\t\t});\n\n\t\tif (baseUri) {\n\t\t\tif (!self.protocol) {\n\t\t\t\tself.protocol = baseUri.protocol;\n\t\t\t}\n\n\t\t\tif (!self.userInfo) {\n\t\t\t\tself.userInfo = baseUri.userInfo;\n\t\t\t}\n\n\t\t\tif (!self.port && self.host === 'mce_host') {\n\t\t\t\tself.port = baseUri.port;\n\t\t\t}\n\n\t\t\tif (!self.host || self.host === 'mce_host') {\n\t\t\t\tself.host = baseUri.host;\n\t\t\t}\n\n\t\t\tself.source = '';\n\t\t}\n\n\t\tif (isProtocolRelative) {\n\t\t\tself.protocol = '';\n\t\t}\n\n\t\t//t.path = t.path || '/';\n\t}\n\n\tURI.prototype = {\n\t\t/**\n\t\t * Sets the internal path part of the URI.\n\t\t *\n\t\t * @method setPath\n\t\t * @param {string} path Path string to set.\n\t\t */\n\t\tsetPath: function(path) {\n\t\t\tvar self = this;\n\n\t\t\tpath = /^(.*?)\\/?(\\w+)?$/.exec(path);\n\n\t\t\t// Update path parts\n\t\t\tself.path = path[0];\n\t\t\tself.directory = path[1];\n\t\t\tself.file = path[2];\n\n\t\t\t// Rebuild source\n\t\t\tself.source = '';\n\t\t\tself.getURI();\n\t\t},\n\n\t\t/**\n\t\t * Converts the specified URI into a relative URI based on the current URI instance location.\n\t\t *\n\t\t * @method toRelative\n\t\t * @param {String} uri URI to convert into a relative path/URI.\n\t\t * @return {String} Relative URI from the point specified in the current URI instance.\n\t\t * @example\n\t\t * // Converts an absolute URL to an relative URL url will be somedir/somefile.htm\n\t\t * var url = new tinymce.util.URI('http://www.site.com/dir/').toRelative('http://www.site.com/dir/somedir/somefile.htm');\n\t\t */\n\t\ttoRelative: function(uri) {\n\t\t\tvar self = this, output;\n\n\t\t\tif (uri === \"./\") {\n\t\t\t\treturn uri;\n\t\t\t}\n\n\t\t\turi = new URI(uri, {base_uri: self});\n\n\t\t\t// Not on same domain/port or protocol\n\t\t\tif ((uri.host != 'mce_host' && self.host != uri.host && uri.host) || self.port != uri.port ||\n\t\t\t\t(self.protocol != uri.protocol && uri.protocol !== \"\")) {\n\t\t\t\treturn uri.getURI();\n\t\t\t}\n\n\t\t\tvar tu = self.getURI(), uu = uri.getURI();\n\n\t\t\t// Allow usage of the base_uri when relative_urls = true\n\t\t\tif (tu == uu || (tu.charAt(tu.length - 1) == \"/\" && tu.substr(0, tu.length - 1) == uu)) {\n\t\t\t\treturn tu;\n\t\t\t}\n\n\t\t\toutput = self.toRelPath(self.path, uri.path);\n\n\t\t\t// Add query\n\t\t\tif (uri.query) {\n\t\t\t\toutput += '?' + uri.query;\n\t\t\t}\n\n\t\t\t// Add anchor\n\t\t\tif (uri.anchor) {\n\t\t\t\toutput += '#' + uri.anchor;\n\t\t\t}\n\n\t\t\treturn output;\n\t\t},\n\n\t\t/**\n\t\t * Converts the specified URI into a absolute URI based on the current URI instance location.\n\t\t *\n\t\t * @method toAbsolute\n\t\t * @param {String} uri URI to convert into a relative path/URI.\n\t\t * @param {Boolean} noHost No host and protocol prefix.\n\t\t * @return {String} Absolute URI from the point specified in the current URI instance.\n\t\t * @example\n\t\t * // Converts an relative URL to an absolute URL url will be http://www.site.com/dir/somedir/somefile.htm\n\t\t * var url = new tinymce.util.URI('http://www.site.com/dir/').toAbsolute('somedir/somefile.htm');\n\t\t */\n\t\ttoAbsolute: function(uri, noHost) {\n\t\t\turi = new URI(uri, {base_uri: this});\n\n\t\t\treturn uri.getURI(noHost && this.isSameOrigin(uri));\n\t\t},\n\n\t\t/**\n\t\t * Determine whether the given URI has the same origin as this URI.  Based on RFC-6454.\n\t\t * Supports default ports for protocols listed in DEFAULT_PORTS.  Unsupported protocols will fail safe: they\n\t\t * won't match, if the port specifications differ.\n\t\t *\n\t\t * @method isSameOrigin\n\t\t * @param {tinymce.util.URI} uri Uri instance to compare.\n\t\t * @returns {Boolean} True if the origins are the same.\n\t\t */\n\t\tisSameOrigin: function(uri) {\n\t\t\tif (this.host == uri.host && this.protocol == uri.protocol) {\n\t\t\t\tif (this.port == uri.port) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tvar defaultPort = DEFAULT_PORTS[this.protocol];\n\t\t\t\tif (defaultPort && ((this.port || defaultPort) == (uri.port || defaultPort))) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\n\t\t/**\n\t\t * Converts a absolute path into a relative path.\n\t\t *\n\t\t * @method toRelPath\n\t\t * @param {String} base Base point to convert the path from.\n\t\t * @param {String} path Absolute path to convert into a relative path.\n\t\t */\n\t\ttoRelPath: function(base, path) {\n\t\t\tvar items, breakPoint = 0, out = '', i, l;\n\n\t\t\t// Split the paths\n\t\t\tbase = base.substring(0, base.lastIndexOf('/'));\n\t\t\tbase = base.split('/');\n\t\t\titems = path.split('/');\n\n\t\t\tif (base.length >= items.length) {\n\t\t\t\tfor (i = 0, l = base.length; i < l; i++) {\n\t\t\t\t\tif (i >= items.length || base[i] != items[i]) {\n\t\t\t\t\t\tbreakPoint = i + 1;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (base.length < items.length) {\n\t\t\t\tfor (i = 0, l = items.length; i < l; i++) {\n\t\t\t\t\tif (i >= base.length || base[i] != items[i]) {\n\t\t\t\t\t\tbreakPoint = i + 1;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (breakPoint === 1) {\n\t\t\t\treturn path;\n\t\t\t}\n\n\t\t\tfor (i = 0, l = base.length - (breakPoint - 1); i < l; i++) {\n\t\t\t\tout += \"../\";\n\t\t\t}\n\n\t\t\tfor (i = breakPoint - 1, l = items.length; i < l; i++) {\n\t\t\t\tif (i != breakPoint - 1) {\n\t\t\t\t\tout += \"/\" + items[i];\n\t\t\t\t} else {\n\t\t\t\t\tout += items[i];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn out;\n\t\t},\n\n\t\t/**\n\t\t * Converts a relative path into a absolute path.\n\t\t *\n\t\t * @method toAbsPath\n\t\t * @param {String} base Base point to convert the path from.\n\t\t * @param {String} path Relative path to convert into an absolute path.\n\t\t */\n\t\ttoAbsPath: function(base, path) {\n\t\t\tvar i, nb = 0, o = [], tr, outPath;\n\n\t\t\t// Split paths\n\t\t\ttr = /\\/$/.test(path) ? '/' : '';\n\t\t\tbase = base.split('/');\n\t\t\tpath = path.split('/');\n\n\t\t\t// Remove empty chunks\n\t\t\teach(base, function(k) {\n\t\t\t\tif (k) {\n\t\t\t\t\to.push(k);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tbase = o;\n\n\t\t\t// Merge relURLParts chunks\n\t\t\tfor (i = path.length - 1, o = []; i >= 0; i--) {\n\t\t\t\t// Ignore empty or .\n\t\t\t\tif (path[i].length === 0 || path[i] === \".\") {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Is parent\n\t\t\t\tif (path[i] === '..') {\n\t\t\t\t\tnb++;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Move up\n\t\t\t\tif (nb > 0) {\n\t\t\t\t\tnb--;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\to.push(path[i]);\n\t\t\t}\n\n\t\t\ti = base.length - nb;\n\n\t\t\t// If /a/b/c or /\n\t\t\tif (i <= 0) {\n\t\t\t\toutPath = o.reverse().join('/');\n\t\t\t} else {\n\t\t\t\toutPath = base.slice(0, i).join('/') + '/' + o.reverse().join('/');\n\t\t\t}\n\n\t\t\t// Add front / if it's needed\n\t\t\tif (outPath.indexOf('/') !== 0) {\n\t\t\t\toutPath = '/' + outPath;\n\t\t\t}\n\n\t\t\t// Add traling / if it's needed\n\t\t\tif (tr && outPath.lastIndexOf('/') !== outPath.length - 1) {\n\t\t\t\toutPath += tr;\n\t\t\t}\n\n\t\t\treturn outPath;\n\t\t},\n\n\t\t/**\n\t\t * Returns the full URI of the internal structure.\n\t\t *\n\t\t * @method getURI\n\t\t * @param {Boolean} noProtoHost Optional no host and protocol part. Defaults to false.\n\t\t */\n\t\tgetURI: function(noProtoHost) {\n\t\t\tvar s, self = this;\n\n\t\t\t// Rebuild source\n\t\t\tif (!self.source || noProtoHost) {\n\t\t\t\ts = '';\n\n\t\t\t\tif (!noProtoHost) {\n\t\t\t\t\tif (self.protocol) {\n\t\t\t\t\t\ts += self.protocol + '://';\n\t\t\t\t\t} else {\n\t\t\t\t\t\ts += '//';\n\t\t\t\t\t}\n\n\t\t\t\t\tif (self.userInfo) {\n\t\t\t\t\t\ts += self.userInfo + '@';\n\t\t\t\t\t}\n\n\t\t\t\t\tif (self.host) {\n\t\t\t\t\t\ts += self.host;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (self.port) {\n\t\t\t\t\t\ts += ':' + self.port;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (self.path) {\n\t\t\t\t\ts += self.path;\n\t\t\t\t}\n\n\t\t\t\tif (self.query) {\n\t\t\t\t\ts += '?' + self.query;\n\t\t\t\t}\n\n\t\t\t\tif (self.anchor) {\n\t\t\t\t\ts += '#' + self.anchor;\n\t\t\t\t}\n\n\t\t\t\tself.source = s;\n\t\t\t}\n\n\t\t\treturn self.source;\n\t\t}\n\t};\n\n\tURI.parseDataUri = function(uri) {\n\t\tvar type, matches;\n\n\t\turi = decodeURIComponent(uri).split(',');\n\n\t\tmatches = /data:([^;]+)/.exec(uri[0]);\n\t\tif (matches) {\n\t\t\ttype = matches[1];\n\t\t}\n\n\t\treturn {\n\t\t\ttype: type,\n\t\t\tdata: uri[1]\n\t\t};\n\t};\n\n\tURI.getDocumentBaseUrl = function(loc) {\n\t\tvar baseUrl;\n\n\t\t// Pass applewebdata:// and other non web protocols though\n\t\tif (loc.protocol.indexOf('http') !== 0 && loc.protocol !== 'file:') {\n\t\t\tbaseUrl = loc.href;\n\t\t} else {\n\t\t\tbaseUrl = loc.protocol + '//' + loc.host + loc.pathname;\n\t\t}\n\n\t\tif (/^[^:]+:\\/\\/\\/?[^\\/]+\\//.test(baseUrl)) {\n\t\t\tbaseUrl = baseUrl.replace(/[\\?#].*$/, '').replace(/[\\/\\\\][^\\/]+$/, '');\n\n\t\t\tif (!/[\\/\\\\]$/.test(baseUrl)) {\n\t\t\t\tbaseUrl += '/';\n\t\t\t}\n\t\t}\n\n\t\treturn baseUrl;\n\t};\n\n\treturn URI;\n});\n\n// Included from: js/tinymce/classes/util/Class.js\n\n/**\n * Class.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This utilitiy class is used for easier inheritance.\n *\n * Features:\n * * Exposed super functions: this._super();\n * * Mixins\n * * Dummy functions\n * * Property functions: var value = object.value(); and object.value(newValue);\n * * Static functions\n * * Defaults settings\n */\ndefine(\"tinymce/util/Class\", [\n\t\"tinymce/util/Tools\"\n], function(Tools) {\n\tvar each = Tools.each, extend = Tools.extend;\n\n\tvar extendClass, initializing;\n\n\tfunction Class() {\n\t}\n\n\t// Provides classical inheritance, based on code made by John Resig\n\tClass.extend = extendClass = function(prop) {\n\t\tvar self = this, _super = self.prototype, prototype, name, member;\n\n\t\t// The dummy class constructor\n\t\tfunction Class() {\n\t\t\tvar i, mixins, mixin, self = this;\n\n\t\t\t// All construction is actually done in the init method\n\t\t\tif (!initializing) {\n\t\t\t\t// Run class constuctor\n\t\t\t\tif (self.init) {\n\t\t\t\t\tself.init.apply(self, arguments);\n\t\t\t\t}\n\n\t\t\t\t// Run mixin constructors\n\t\t\t\tmixins = self.Mixins;\n\t\t\t\tif (mixins) {\n\t\t\t\t\ti = mixins.length;\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tmixin = mixins[i];\n\t\t\t\t\t\tif (mixin.init) {\n\t\t\t\t\t\t\tmixin.init.apply(self, arguments);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Dummy function, needs to be extended in order to provide functionality\n\t\tfunction dummy() {\n\t\t\treturn this;\n\t\t}\n\n\t\t// Creates a overloaded method for the class\n\t\t// this enables you to use this._super(); to call the super function\n\t\tfunction createMethod(name, fn) {\n\t\t\treturn function() {\n\t\t\t\tvar self = this, tmp = self._super, ret;\n\n\t\t\t\tself._super = _super[name];\n\t\t\t\tret = fn.apply(self, arguments);\n\t\t\t\tself._super = tmp;\n\n\t\t\t\treturn ret;\n\t\t\t};\n\t\t}\n\n\t\t// Instantiate a base class (but only create the instance,\n\t\t// don't run the init constructor)\n\t\tinitializing = true;\n\n\t\t/*eslint new-cap:0 */\n\t\tprototype = new self();\n\t\tinitializing = false;\n\n\t\t// Add mixins\n\t\tif (prop.Mixins) {\n\t\t\teach(prop.Mixins, function(mixin) {\n\t\t\t\tfor (var name in mixin) {\n\t\t\t\t\tif (name !== \"init\") {\n\t\t\t\t\t\tprop[name] = mixin[name];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (_super.Mixins) {\n\t\t\t\tprop.Mixins = _super.Mixins.concat(prop.Mixins);\n\t\t\t}\n\t\t}\n\n\t\t// Generate dummy methods\n\t\tif (prop.Methods) {\n\t\t\teach(prop.Methods.split(','), function(name) {\n\t\t\t\tprop[name] = dummy;\n\t\t\t});\n\t\t}\n\n\t\t// Generate property methods\n\t\tif (prop.Properties) {\n\t\t\teach(prop.Properties.split(','), function(name) {\n\t\t\t\tvar fieldName = '_' + name;\n\n\t\t\t\tprop[name] = function(value) {\n\t\t\t\t\tvar self = this, undef;\n\n\t\t\t\t\t// Set value\n\t\t\t\t\tif (value !== undef) {\n\t\t\t\t\t\tself[fieldName] = value;\n\n\t\t\t\t\t\treturn self;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Get value\n\t\t\t\t\treturn self[fieldName];\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\n\t\t// Static functions\n\t\tif (prop.Statics) {\n\t\t\teach(prop.Statics, function(func, name) {\n\t\t\t\tClass[name] = func;\n\t\t\t});\n\t\t}\n\n\t\t// Default settings\n\t\tif (prop.Defaults && _super.Defaults) {\n\t\t\tprop.Defaults = extend({}, _super.Defaults, prop.Defaults);\n\t\t}\n\n\t\t// Copy the properties over onto the new prototype\n\t\tfor (name in prop) {\n\t\t\tmember = prop[name];\n\n\t\t\tif (typeof member == \"function\" && _super[name]) {\n\t\t\t\tprototype[name] = createMethod(name, member);\n\t\t\t} else {\n\t\t\t\tprototype[name] = member;\n\t\t\t}\n\t\t}\n\n\t\t// Populate our constructed prototype object\n\t\tClass.prototype = prototype;\n\n\t\t// Enforce the constructor to be what we expect\n\t\tClass.constructor = Class;\n\n\t\t// And make this class extendible\n\t\tClass.extend = extendClass;\n\n\t\treturn Class;\n\t};\n\n\treturn Class;\n});\n\n// Included from: js/tinymce/classes/util/EventDispatcher.js\n\n/**\n * EventDispatcher.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class lets you add/remove and fire events by name on the specified scope. This makes\n * it easy to add event listener logic to any class.\n *\n * @class tinymce.util.EventDispatcher\n * @example\n *  var eventDispatcher = new EventDispatcher();\n *\n *  eventDispatcher.on('click', function() {console.log('data');});\n *  eventDispatcher.fire('click', {data: 123});\n */\ndefine(\"tinymce/util/EventDispatcher\", [\n\t\"tinymce/util/Tools\"\n], function(Tools) {\n\tvar nativeEvents = Tools.makeMap(\n\t\t\"focus blur focusin focusout click dblclick mousedown mouseup mousemove mouseover beforepaste paste cut copy selectionchange \" +\n\t\t\"mouseout mouseenter mouseleave wheel keydown keypress keyup input contextmenu dragstart dragend dragover \" +\n\t\t\"draggesture dragdrop drop drag submit \" +\n\t\t\"compositionstart compositionend compositionupdate touchstart touchmove touchend\",\n\t\t' '\n\t);\n\n\tfunction Dispatcher(settings) {\n\t\tvar self = this, scope, bindings = {}, toggleEvent;\n\n\t\tfunction returnFalse() {\n\t\t\treturn false;\n\t\t}\n\n\t\tfunction returnTrue() {\n\t\t\treturn true;\n\t\t}\n\n\t\tsettings = settings || {};\n\t\tscope = settings.scope || self;\n\t\ttoggleEvent = settings.toggleEvent || returnFalse;\n\n\t\t/**\n\t\t * Fires the specified event by name.\n\t\t *\n\t\t * @method fire\n\t\t * @param {String} name Name of the event to fire.\n\t\t * @param {Object?} args Event arguments.\n\t\t * @return {Object} Event args instance passed in.\n\t\t * @example\n\t\t * instance.fire('event', {...});\n\t\t */\n\t\tfunction fire(name, args) {\n\t\t\tvar handlers, i, l, callback;\n\n\t\t\tname = name.toLowerCase();\n\t\t\targs = args || {};\n\t\t\targs.type = name;\n\n\t\t\t// Setup target is there isn't one\n\t\t\tif (!args.target) {\n\t\t\t\targs.target = scope;\n\t\t\t}\n\n\t\t\t// Add event delegation methods if they are missing\n\t\t\tif (!args.preventDefault) {\n\t\t\t\t// Add preventDefault method\n\t\t\t\targs.preventDefault = function() {\n\t\t\t\t\targs.isDefaultPrevented = returnTrue;\n\t\t\t\t};\n\n\t\t\t\t// Add stopPropagation\n\t\t\t\targs.stopPropagation = function() {\n\t\t\t\t\targs.isPropagationStopped = returnTrue;\n\t\t\t\t};\n\n\t\t\t\t// Add stopImmediatePropagation\n\t\t\t\targs.stopImmediatePropagation = function() {\n\t\t\t\t\targs.isImmediatePropagationStopped = returnTrue;\n\t\t\t\t};\n\n\t\t\t\t// Add event delegation states\n\t\t\t\targs.isDefaultPrevented = returnFalse;\n\t\t\t\targs.isPropagationStopped = returnFalse;\n\t\t\t\targs.isImmediatePropagationStopped = returnFalse;\n\t\t\t}\n\n\t\t\tif (settings.beforeFire) {\n\t\t\t\tsettings.beforeFire(args);\n\t\t\t}\n\n\t\t\thandlers = bindings[name];\n\t\t\tif (handlers) {\n\t\t\t\tfor (i = 0, l = handlers.length; i < l; i++) {\n\t\t\t\t\tcallback = handlers[i];\n\n\t\t\t\t\t// Unbind handlers marked with \"once\"\n\t\t\t\t\tif (callback.once) {\n\t\t\t\t\t\toff(name, callback.func);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Stop immediate propagation if needed\n\t\t\t\t\tif (args.isImmediatePropagationStopped()) {\n\t\t\t\t\t\targs.stopPropagation();\n\t\t\t\t\t\treturn args;\n\t\t\t\t\t}\n\n\t\t\t\t\t// If callback returns false then prevent default and stop all propagation\n\t\t\t\t\tif (callback.func.call(scope, args) === false) {\n\t\t\t\t\t\targs.preventDefault();\n\t\t\t\t\t\treturn args;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn args;\n\t\t}\n\n\t\t/**\n\t\t * Binds an event listener to a specific event by name.\n\t\t *\n\t\t * @method on\n\t\t * @param {String} name Event name or space separated list of events to bind.\n\t\t * @param {callback} callback Callback to be executed when the event occurs.\n\t\t * @param {Boolean} first Optional flag if the event should be prepended. Use this with care.\n\t\t * @return {Object} Current class instance.\n\t\t * @example\n\t\t * instance.on('event', function(e) {\n\t\t *     // Callback logic\n\t\t * });\n\t\t */\n\t\tfunction on(name, callback, prepend, extra) {\n\t\t\tvar handlers, names, i;\n\n\t\t\tif (callback === false) {\n\t\t\t\tcallback = returnFalse;\n\t\t\t}\n\n\t\t\tif (callback) {\n\t\t\t\tcallback = {\n\t\t\t\t\tfunc: callback\n\t\t\t\t};\n\n\t\t\t\tif (extra) {\n\t\t\t\t\tTools.extend(callback, extra);\n\t\t\t\t}\n\n\t\t\t\tnames = name.toLowerCase().split(' ');\n\t\t\t\ti = names.length;\n\t\t\t\twhile (i--) {\n\t\t\t\t\tname = names[i];\n\t\t\t\t\thandlers = bindings[name];\n\t\t\t\t\tif (!handlers) {\n\t\t\t\t\t\thandlers = bindings[name] = [];\n\t\t\t\t\t\ttoggleEvent(name, true);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (prepend) {\n\t\t\t\t\t\thandlers.unshift(callback);\n\t\t\t\t\t} else {\n\t\t\t\t\t\thandlers.push(callback);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn self;\n\t\t}\n\n\t\t/**\n\t\t * Unbinds an event listener to a specific event by name.\n\t\t *\n\t\t * @method off\n\t\t * @param {String?} name Name of the event to unbind.\n\t\t * @param {callback?} callback Callback to unbind.\n\t\t * @return {Object} Current class instance.\n\t\t * @example\n\t\t * // Unbind specific callback\n\t\t * instance.off('event', handler);\n\t\t *\n\t\t * // Unbind all listeners by name\n\t\t * instance.off('event');\n\t\t *\n\t\t * // Unbind all events\n\t\t * instance.off();\n\t\t */\n\t\tfunction off(name, callback) {\n\t\t\tvar i, handlers, bindingName, names, hi;\n\n\t\t\tif (name) {\n\t\t\t\tnames = name.toLowerCase().split(' ');\n\t\t\t\ti = names.length;\n\t\t\t\twhile (i--) {\n\t\t\t\t\tname = names[i];\n\t\t\t\t\thandlers = bindings[name];\n\n\t\t\t\t\t// Unbind all handlers\n\t\t\t\t\tif (!name) {\n\t\t\t\t\t\tfor (bindingName in bindings) {\n\t\t\t\t\t\t\ttoggleEvent(bindingName, false);\n\t\t\t\t\t\t\tdelete bindings[bindingName];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn self;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (handlers) {\n\t\t\t\t\t\t// Unbind all by name\n\t\t\t\t\t\tif (!callback) {\n\t\t\t\t\t\t\thandlers.length = 0;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Unbind specific ones\n\t\t\t\t\t\t\thi = handlers.length;\n\t\t\t\t\t\t\twhile (hi--) {\n\t\t\t\t\t\t\t\tif (handlers[hi].func === callback) {\n\t\t\t\t\t\t\t\t\thandlers = handlers.slice(0, hi).concat(handlers.slice(hi + 1));\n\t\t\t\t\t\t\t\t\tbindings[name] = handlers;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!handlers.length) {\n\t\t\t\t\t\t\ttoggleEvent(name, false);\n\t\t\t\t\t\t\tdelete bindings[name];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (name in bindings) {\n\t\t\t\t\ttoggleEvent(name, false);\n\t\t\t\t}\n\n\t\t\t\tbindings = {};\n\t\t\t}\n\n\t\t\treturn self;\n\t\t}\n\n\t\t/**\n\t\t * Binds an event listener to a specific event by name\n\t\t * and automatically unbind the event once the callback fires.\n\t\t *\n\t\t * @method once\n\t\t * @param {String} name Event name or space separated list of events to bind.\n\t\t * @param {callback} callback Callback to be executed when the event occurs.\n\t\t * @param {Boolean} first Optional flag if the event should be prepended. Use this with care.\n\t\t * @return {Object} Current class instance.\n\t\t * @example\n\t\t * instance.once('event', function(e) {\n\t\t *     // Callback logic\n\t\t * });\n\t\t */\n\t\tfunction once(name, callback, prepend) {\n\t\t\treturn on(name, callback, prepend, {once: true});\n\t\t}\n\n\t\t/**\n\t\t * Returns true/false if the dispatcher has a event of the specified name.\n\t\t *\n\t\t * @method has\n\t\t * @param {String} name Name of the event to check for.\n\t\t * @return {Boolean} true/false if the event exists or not.\n\t\t */\n\t\tfunction has(name) {\n\t\t\tname = name.toLowerCase();\n\t\t\treturn !(!bindings[name] || bindings[name].length === 0);\n\t\t}\n\n\t\t// Expose\n\t\tself.fire = fire;\n\t\tself.on = on;\n\t\tself.off = off;\n\t\tself.once = once;\n\t\tself.has = has;\n\t}\n\n\t/**\n\t * Returns true/false if the specified event name is a native browser event or not.\n\t *\n\t * @method isNative\n\t * @param {String} name Name to check if it's native.\n\t * @return {Boolean} true/false if the event is native or not.\n\t * @static\n\t */\n\tDispatcher.isNative = function(name) {\n\t\treturn !!nativeEvents[name.toLowerCase()];\n\t};\n\n\treturn Dispatcher;\n});\n\n// Included from: js/tinymce/classes/data/Binding.js\n\n/**\n * Binding.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class gets dynamically extended to provide a binding between two models. This makes it possible to\n * sync the state of two properties in two models by a layer of abstraction.\n *\n * @private\n * @class tinymce.data.Binding\n */\ndefine(\"tinymce/data/Binding\", [], function() {\n\t/**\n\t * Constructs a new bidning.\n\t *\n\t * @constructor\n\t * @method Binding\n\t * @param {Object} settings Settings to the binding.\n\t */\n\tfunction Binding(settings) {\n\t\tthis.create = settings.create;\n\t}\n\n\t/**\n\t * Creates a binding for a property on a model.\n\t *\n\t * @method create\n\t * @param {tinymce.data.ObservableObject} model Model to create binding to.\n\t * @param {String} name Name of property to bind.\n\t * @return {tinymce.data.Binding} Binding instance.\n\t */\n\tBinding.create = function(model, name) {\n\t\treturn new Binding({\n\t\t\tcreate: function(otherModel, otherName) {\n\t\t\t\tvar bindings;\n\n\t\t\t\tfunction fromSelfToOther(e) {\n\t\t\t\t\totherModel.set(otherName, e.value);\n\t\t\t\t}\n\n\t\t\t\tfunction fromOtherToSelf(e) {\n\t\t\t\t\tmodel.set(name, e.value);\n\t\t\t\t}\n\n\t\t\t\totherModel.on('change:' + otherName, fromOtherToSelf);\n\t\t\t\tmodel.on('change:' + name, fromSelfToOther);\n\n\t\t\t\t// Keep track of the bindings\n\t\t\t\tbindings = otherModel._bindings;\n\n\t\t\t\tif (!bindings) {\n\t\t\t\t\tbindings = otherModel._bindings = [];\n\n\t\t\t\t\totherModel.on('destroy', function() {\n\t\t\t\t\t\tvar i = bindings.length;\n\n\t\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\t\tbindings[i]();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tbindings.push(function() {\n\t\t\t\t\tmodel.off('change:' + name, fromSelfToOther);\n\t\t\t\t});\n\n\t\t\t\treturn model.get(name);\n\t\t\t}\n\t\t});\n\t};\n\n\treturn Binding;\n});\n\n// Included from: js/tinymce/classes/util/Observable.js\n\n/**\n * Observable.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This mixin will add event binding logic to classes.\n *\n * @mixin tinymce.util.Observable\n */\ndefine(\"tinymce/util/Observable\", [\n\t\"tinymce/util/EventDispatcher\"\n], function(EventDispatcher) {\n\tfunction getEventDispatcher(obj) {\n\t\tif (!obj._eventDispatcher) {\n\t\t\tobj._eventDispatcher = new EventDispatcher({\n\t\t\t\tscope: obj,\n\t\t\t\ttoggleEvent: function(name, state) {\n\t\t\t\t\tif (EventDispatcher.isNative(name) && obj.toggleNativeEvent) {\n\t\t\t\t\t\tobj.toggleNativeEvent(name, state);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn obj._eventDispatcher;\n\t}\n\n\treturn {\n\t\t/**\n\t\t * Fires the specified event by name. Consult the\n\t\t * <a href=\"/advanced/events\">event reference</a> for more details on each event.\n\t\t *\n\t\t * @method fire\n\t\t * @param {String} name Name of the event to fire.\n\t\t * @param {Object?} args Event arguments.\n\t\t * @param {Boolean?} bubble True/false if the event is to be bubbled.\n\t\t * @return {Object} Event args instance passed in.\n\t\t * @example\n\t\t * instance.fire('event', {...});\n\t\t */\n\t\tfire: function(name, args, bubble) {\n\t\t\tvar self = this;\n\n\t\t\t// Prevent all events except the remove event after the instance has been removed\n\t\t\tif (self.removed && name !== \"remove\") {\n\t\t\t\treturn args;\n\t\t\t}\n\n\t\t\targs = getEventDispatcher(self).fire(name, args, bubble);\n\n\t\t\t// Bubble event up to parents\n\t\t\tif (bubble !== false && self.parent) {\n\t\t\t\tvar parent = self.parent();\n\t\t\t\twhile (parent && !args.isPropagationStopped()) {\n\t\t\t\t\tparent.fire(name, args, false);\n\t\t\t\t\tparent = parent.parent();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn args;\n\t\t},\n\n\t\t/**\n\t\t * Binds an event listener to a specific event by name. Consult the\n\t\t * <a href=\"/advanced/events\">event reference</a> for more details on each event.\n\t\t *\n\t\t * @method on\n\t\t * @param {String} name Event name or space separated list of events to bind.\n\t\t * @param {callback} callback Callback to be executed when the event occurs.\n\t\t * @param {Boolean} first Optional flag if the event should be prepended. Use this with care.\n\t\t * @return {Object} Current class instance.\n\t\t * @example\n\t\t * instance.on('event', function(e) {\n\t\t *     // Callback logic\n\t\t * });\n\t\t */\n\t\ton: function(name, callback, prepend) {\n\t\t\treturn getEventDispatcher(this).on(name, callback, prepend);\n\t\t},\n\n\t\t/**\n\t\t * Unbinds an event listener to a specific event by name. Consult the\n\t\t * <a href=\"/advanced/events\">event reference</a> for more details on each event.\n\t\t *\n\t\t * @method off\n\t\t * @param {String?} name Name of the event to unbind.\n\t\t * @param {callback?} callback Callback to unbind.\n\t\t * @return {Object} Current class instance.\n\t\t * @example\n\t\t * // Unbind specific callback\n\t\t * instance.off('event', handler);\n\t\t *\n\t\t * // Unbind all listeners by name\n\t\t * instance.off('event');\n\t\t *\n\t\t * // Unbind all events\n\t\t * instance.off();\n\t\t */\n\t\toff: function(name, callback) {\n\t\t\treturn getEventDispatcher(this).off(name, callback);\n\t\t},\n\n\t\t/**\n\t\t * Bind the event callback and once it fires the callback is removed. Consult the\n\t\t * <a href=\"/advanced/events\">event reference</a> for more details on each event.\n\t\t *\n\t\t * @method once\n\t\t * @param {String} name Name of the event to bind.\n\t\t * @param {callback} callback Callback to bind only once.\n\t\t * @return {Object} Current class instance.\n\t\t */\n\t\tonce: function(name, callback) {\n\t\t\treturn getEventDispatcher(this).once(name, callback);\n\t\t},\n\n\t\t/**\n\t\t * Returns true/false if the object has a event of the specified name.\n\t\t *\n\t\t * @method hasEventListeners\n\t\t * @param {String} name Name of the event to check for.\n\t\t * @return {Boolean} true/false if the event exists or not.\n\t\t */\n\t\thasEventListeners: function(name) {\n\t\t\treturn getEventDispatcher(this).has(name);\n\t\t}\n\t};\n});\n\n// Included from: js/tinymce/classes/data/ObservableObject.js\n\n/**\n * ObservableObject.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class is a object that is observable when properties changes a change event gets emitted.\n *\n * @private\n * @class tinymce.data.ObservableObject\n */\ndefine(\"tinymce/data/ObservableObject\", [\n\t\"tinymce/data/Binding\",\n\t\"tinymce/util/Observable\",\n\t\"tinymce/util/Class\",\n\t\"tinymce/util/Tools\"\n], function(Binding, Observable, Class, Tools) {\n\tfunction isNode(node) {\n\t\treturn node.nodeType > 0;\n\t}\n\n\t// Todo: Maybe this should be shallow compare since it might be huge object references\n\tfunction isEqual(a, b) {\n\t\tvar k, checked;\n\n\t\t// Strict equals\n\t\tif (a === b) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// Compare null\n\t\tif (a === null || b === null) {\n\t\t\treturn a === b;\n\t\t}\n\n\t\t// Compare number, boolean, string, undefined\n\t\tif (typeof a !== \"object\" || typeof b !== \"object\") {\n\t\t\treturn a === b;\n\t\t}\n\n\t\t// Compare arrays\n\t\tif (Tools.isArray(b)) {\n\t\t\tif (a.length !== b.length) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tk = a.length;\n\t\t\twhile (k--) {\n\t\t\t\tif (!isEqual(a[k], b[k])) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Shallow compare nodes\n\t\tif (isNode(a) || isNode(b)) {\n\t\t\treturn a === b;\n\t\t}\n\n\t\t// Compare objects\n\t\tchecked = {};\n\t\tfor (k in b) {\n\t\t\tif (!isEqual(a[k], b[k])) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tchecked[k] = true;\n\t\t}\n\n\t\tfor (k in a) {\n\t\t\tif (!checked[k] && !isEqual(a[k], b[k])) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\treturn Class.extend({\n\t\tMixins: [Observable],\n\n\t\t/**\n\t\t * Constructs a new observable object instance.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} data Initial data for the object.\n\t\t */\n\t\tinit: function(data) {\n\t\t\tvar name, value;\n\n\t\t\tdata = data || {};\n\n\t\t\tfor (name in data) {\n\t\t\t\tvalue = data[name];\n\n\t\t\t\tif (value instanceof Binding) {\n\t\t\t\t\tdata[name] = value.create(this, name);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.data = data;\n\t\t},\n\n\t\t/**\n\t\t * Sets a property on the value this will call\n\t\t * observers if the value is a change from the current value.\n\t\t *\n\t\t * @method set\n\t\t * @param {String/object} name Name of the property to set or a object of items to set.\n\t\t * @param {Object} value Value to set for the property.\n\t\t * @return {tinymce.data.ObservableObject} Observable object instance.\n\t\t */\n\t\tset: function(name, value) {\n\t\t\tvar key, args, oldValue = this.data[name];\n\n\t\t\tif (value instanceof Binding) {\n\t\t\t\tvalue = value.create(this, name);\n\t\t\t}\n\n\t\t\tif (typeof name === \"object\") {\n\t\t\t\tfor (key in name) {\n\t\t\t\t\tthis.set(key, name[key]);\n\t\t\t\t}\n\n\t\t\t\treturn this;\n\t\t\t}\n\n\t\t\tif (!isEqual(oldValue, value)) {\n\t\t\t\tthis.data[name] = value;\n\n\t\t\t\targs = {\n\t\t\t\t\ttarget: this,\n\t\t\t\t\tname: name,\n\t\t\t\t\tvalue: value,\n\t\t\t\t\toldValue: oldValue\n\t\t\t\t};\n\n\t\t\t\tthis.fire('change:' + name, args);\n\t\t\t\tthis.fire('change', args);\n\t\t\t}\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Gets a property by name.\n\t\t *\n\t\t * @method get\n\t\t * @param {String} name Name of the property to get.\n\t\t * @return {Object} Object value of propery.\n\t\t */\n\t\tget: function(name) {\n\t\t\treturn this.data[name];\n\t\t},\n\n\t\t/**\n\t\t * Returns true/false if the specified property exists.\n\t\t *\n\t\t * @method has\n\t\t * @param {String} name Name of the property to check for.\n\t\t * @return {Boolean} true/false if the item exists.\n\t\t */\n\t\thas: function(name) {\n\t\t\treturn name in this.data;\n\t\t},\n\n\t\t/**\n\t\t * Returns a dynamic property binding for the specified property name. This makes\n\t\t * it possible to sync the state of two properties in two ObservableObject instances.\n\t\t *\n\t\t * @method bind\n\t\t * @param {String} name Name of the property to sync with the property it's inserted to.\n\t\t * @return {tinymce.data.Binding} Data binding instance.\n\t\t */\n\t\tbind: function(name) {\n\t\t\treturn Binding.create(this, name);\n\t\t},\n\n\t\t/**\n\t\t * Destroys the observable object and fires the \"destroy\"\n\t\t * event and clean up any internal resources.\n\t\t *\n\t\t * @method destroy\n\t\t */\n\t\tdestroy: function() {\n\t\t\tthis.fire('destroy');\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/Selector.js\n\n/**\n * Selector.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/*eslint no-nested-ternary:0 */\n\n/**\n * Selector engine, enables you to select controls by using CSS like expressions.\n * We currently only support basic CSS expressions to reduce the size of the core\n * and the ones we support should be enough for most cases.\n *\n * @example\n * Supported expressions:\n *  element\n *  element#name\n *  element.class\n *  element[attr]\n *  element[attr*=value]\n *  element[attr~=value]\n *  element[attr!=value]\n *  element[attr^=value]\n *  element[attr$=value]\n *  element:<state>\n *  element:not(<expression>)\n *  element:first\n *  element:last\n *  element:odd\n *  element:even\n *  element element\n *  element > element\n *\n * @class tinymce.ui.Selector\n */\ndefine(\"tinymce/ui/Selector\", [\n\t\"tinymce/util/Class\"\n], function(Class) {\n\t\"use strict\";\n\n\t/**\n\t * Produces an array with a unique set of objects. It will not compare the values\n\t * but the references of the objects.\n\t *\n\t * @private\n\t * @method unqiue\n\t * @param {Array} array Array to make into an array with unique items.\n\t * @return {Array} Array with unique items.\n\t */\n\tfunction unique(array) {\n\t\tvar uniqueItems = [], i = array.length, item;\n\n\t\twhile (i--) {\n\t\t\titem = array[i];\n\n\t\t\tif (!item.__checked) {\n\t\t\t\tuniqueItems.push(item);\n\t\t\t\titem.__checked = 1;\n\t\t\t}\n\t\t}\n\n\t\ti = uniqueItems.length;\n\t\twhile (i--) {\n\t\t\tdelete uniqueItems[i].__checked;\n\t\t}\n\n\t\treturn uniqueItems;\n\t}\n\n\tvar expression = /^([\\w\\\\*]+)?(?:#([\\w\\-\\\\]+))?(?:\\.([\\w\\\\\\.]+))?(?:\\[\\@?([\\w\\\\]+)([\\^\\$\\*!~]?=)([\\w\\\\]+)\\])?(?:\\:(.+))?/i;\n\n\t/*jshint maxlen:255 */\n\t/*eslint max-len:0 */\n\tvar chunker = /((?:\\((?:\\([^()]+\\)|[^()]+)+\\)|\\[(?:\\[[^\\[\\]]*\\]|['\"][^'\"]*['\"]|[^\\[\\]'\"]+)+\\]|\\\\.|[^ >+~,(\\[\\\\]+)+|[>+~])(\\s*,\\s*)?((?:.|\\r|\\n)*)/g,\n\t\twhiteSpace = /^\\s*|\\s*$/g,\n\t\tCollection;\n\n\tvar Selector = Class.extend({\n\t\t/**\n\t\t * Constructs a new Selector instance.\n\t\t *\n\t\t * @constructor\n\t\t * @method init\n\t\t * @param {String} selector CSS like selector expression.\n\t\t */\n\t\tinit: function(selector) {\n\t\t\tvar match = this.match;\n\n\t\t\tfunction compileNameFilter(name) {\n\t\t\t\tif (name) {\n\t\t\t\t\tname = name.toLowerCase();\n\n\t\t\t\t\treturn function(item) {\n\t\t\t\t\t\treturn name === '*' || item.type === name;\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction compileIdFilter(id) {\n\t\t\t\tif (id) {\n\t\t\t\t\treturn function(item) {\n\t\t\t\t\t\treturn item._name === id;\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction compileClassesFilter(classes) {\n\t\t\t\tif (classes) {\n\t\t\t\t\tclasses = classes.split('.');\n\n\t\t\t\t\treturn function(item) {\n\t\t\t\t\t\tvar i = classes.length;\n\n\t\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\t\tif (!item.classes.contains(classes[i])) {\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction compileAttrFilter(name, cmp, check) {\n\t\t\t\tif (name) {\n\t\t\t\t\treturn function(item) {\n\t\t\t\t\t\tvar value = item[name] ? item[name]() : '';\n\n\t\t\t\t\t\treturn !cmp ? !!check :\n\t\t\t\t\t\t\tcmp === \"=\" ? value === check :\n\t\t\t\t\t\t\tcmp === \"*=\" ? value.indexOf(check) >= 0 :\n\t\t\t\t\t\t\tcmp === \"~=\" ? (\" \" + value + \" \").indexOf(\" \" + check + \" \") >= 0 :\n\t\t\t\t\t\t\tcmp === \"!=\" ? value != check :\n\t\t\t\t\t\t\tcmp === \"^=\" ? value.indexOf(check) === 0 :\n\t\t\t\t\t\t\tcmp === \"$=\" ? value.substr(value.length - check.length) === check :\n\t\t\t\t\t\t\tfalse;\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction compilePsuedoFilter(name) {\n\t\t\t\tvar notSelectors;\n\n\t\t\t\tif (name) {\n\t\t\t\t\tname = /(?:not\\((.+)\\))|(.+)/i.exec(name);\n\n\t\t\t\t\tif (!name[1]) {\n\t\t\t\t\t\tname = name[2];\n\n\t\t\t\t\t\treturn function(item, index, length) {\n\t\t\t\t\t\t\treturn name === 'first' ? index === 0 :\n\t\t\t\t\t\t\t\tname === 'last' ? index === length - 1 :\n\t\t\t\t\t\t\t\tname === 'even' ? index % 2 === 0 :\n\t\t\t\t\t\t\t\tname === 'odd' ? index % 2 === 1 :\n\t\t\t\t\t\t\t\titem[name] ? item[name]() :\n\t\t\t\t\t\t\t\tfalse;\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t\t// Compile not expression\n\t\t\t\t\tnotSelectors = parseChunks(name[1], []);\n\n\t\t\t\t\treturn function(item) {\n\t\t\t\t\t\treturn !match(item, notSelectors);\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction compile(selector, filters, direct) {\n\t\t\t\tvar parts;\n\n\t\t\t\tfunction add(filter) {\n\t\t\t\t\tif (filter) {\n\t\t\t\t\t\tfilters.push(filter);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Parse expression into parts\n\t\t\t\tparts = expression.exec(selector.replace(whiteSpace, ''));\n\n\t\t\t\tadd(compileNameFilter(parts[1]));\n\t\t\t\tadd(compileIdFilter(parts[2]));\n\t\t\t\tadd(compileClassesFilter(parts[3]));\n\t\t\t\tadd(compileAttrFilter(parts[4], parts[5], parts[6]));\n\t\t\t\tadd(compilePsuedoFilter(parts[7]));\n\n\t\t\t\t// Mark the filter with pseudo for performance\n\t\t\t\tfilters.pseudo = !!parts[7];\n\t\t\t\tfilters.direct = direct;\n\n\t\t\t\treturn filters;\n\t\t\t}\n\n\t\t\t// Parser logic based on Sizzle by John Resig\n\t\t\tfunction parseChunks(selector, selectors) {\n\t\t\t\tvar parts = [], extra, matches, i;\n\n\t\t\t\tdo {\n\t\t\t\t\tchunker.exec(\"\");\n\t\t\t\t\tmatches = chunker.exec(selector);\n\n\t\t\t\t\tif (matches) {\n\t\t\t\t\t\tselector = matches[3];\n\t\t\t\t\t\tparts.push(matches[1]);\n\n\t\t\t\t\t\tif (matches[2]) {\n\t\t\t\t\t\t\textra = matches[3];\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} while (matches);\n\n\t\t\t\tif (extra) {\n\t\t\t\t\tparseChunks(extra, selectors);\n\t\t\t\t}\n\n\t\t\t\tselector = [];\n\t\t\t\tfor (i = 0; i < parts.length; i++) {\n\t\t\t\t\tif (parts[i] != '>') {\n\t\t\t\t\t\tselector.push(compile(parts[i], [], parts[i - 1] === '>'));\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tselectors.push(selector);\n\n\t\t\t\treturn selectors;\n\t\t\t}\n\n\t\t\tthis._selectors = parseChunks(selector, []);\n\t\t},\n\n\t\t/**\n\t\t * Returns true/false if the selector matches the specified control.\n\t\t *\n\t\t * @method match\n\t\t * @param {tinymce.ui.Control} control Control to match against the selector.\n\t\t * @param {Array} selectors Optional array of selectors, mostly used internally.\n\t\t * @return {Boolean} true/false state if the control matches or not.\n\t\t */\n\t\tmatch: function(control, selectors) {\n\t\t\tvar i, l, si, sl, selector, fi, fl, filters, index, length, siblings, count, item;\n\n\t\t\tselectors = selectors || this._selectors;\n\t\t\tfor (i = 0, l = selectors.length; i < l; i++) {\n\t\t\t\tselector = selectors[i];\n\t\t\t\tsl = selector.length;\n\t\t\t\titem = control;\n\t\t\t\tcount = 0;\n\n\t\t\t\tfor (si = sl - 1; si >= 0; si--) {\n\t\t\t\t\tfilters = selector[si];\n\n\t\t\t\t\twhile (item) {\n\t\t\t\t\t\t// Find the index and length since a pseudo filter like :first needs it\n\t\t\t\t\t\tif (filters.pseudo) {\n\t\t\t\t\t\t\tsiblings = item.parent().items();\n\t\t\t\t\t\t\tindex = length = siblings.length;\n\t\t\t\t\t\t\twhile (index--) {\n\t\t\t\t\t\t\t\tif (siblings[index] === item) {\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfor (fi = 0, fl = filters.length; fi < fl; fi++) {\n\t\t\t\t\t\t\tif (!filters[fi](item, index, length)) {\n\t\t\t\t\t\t\t\tfi = fl + 1;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (fi === fl) {\n\t\t\t\t\t\t\tcount++;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// If it didn't match the right most expression then\n\t\t\t\t\t\t\t// break since it's no point looking at the parents\n\t\t\t\t\t\t\tif (si === sl - 1) {\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\titem = item.parent();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// If we found all selectors then return true otherwise continue looking\n\t\t\t\tif (count === sl) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\n\t\t/**\n\t\t * Returns a tinymce.ui.Collection with matches of the specified selector inside the specified container.\n\t\t *\n\t\t * @method find\n\t\t * @param {tinymce.ui.Control} container Container to look for items in.\n\t\t * @return {tinymce.ui.Collection} Collection with matched elements.\n\t\t */\n\t\tfind: function(container) {\n\t\t\tvar matches = [], i, l, selectors = this._selectors;\n\n\t\t\tfunction collect(items, selector, index) {\n\t\t\t\tvar i, l, fi, fl, item, filters = selector[index];\n\n\t\t\t\tfor (i = 0, l = items.length; i < l; i++) {\n\t\t\t\t\titem = items[i];\n\n\t\t\t\t\t// Run each filter against the item\n\t\t\t\t\tfor (fi = 0, fl = filters.length; fi < fl; fi++) {\n\t\t\t\t\t\tif (!filters[fi](item, i, l)) {\n\t\t\t\t\t\t\tfi = fl + 1;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// All filters matched the item\n\t\t\t\t\tif (fi === fl) {\n\t\t\t\t\t\t// Matched item is on the last expression like: panel toolbar [button]\n\t\t\t\t\t\tif (index == selector.length - 1) {\n\t\t\t\t\t\t\tmatches.push(item);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Collect next expression type\n\t\t\t\t\t\t\tif (item.items) {\n\t\t\t\t\t\t\t\tcollect(item.items(), selector, index + 1);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (filters.direct) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Collect child items\n\t\t\t\t\tif (item.items) {\n\t\t\t\t\t\tcollect(item.items(), selector, index);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (container.items) {\n\t\t\t\tfor (i = 0, l = selectors.length; i < l; i++) {\n\t\t\t\t\tcollect(container.items(), selectors[i], 0);\n\t\t\t\t}\n\n\t\t\t\t// Unique the matches if needed\n\t\t\t\tif (l > 1) {\n\t\t\t\t\tmatches = unique(matches);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Fix for circular reference\n\t\t\tif (!Collection) {\n\t\t\t\t// TODO: Fix me!\n\t\t\t\tCollection = Selector.Collection;\n\t\t\t}\n\n\t\t\treturn new Collection(matches);\n\t\t}\n\t});\n\n\treturn Selector;\n});\n\n// Included from: js/tinymce/classes/ui/Collection.js\n\n/**\n * Collection.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Control collection, this class contains control instances and it enables you to\n * perform actions on all the contained items. This is very similar to how jQuery works.\n *\n * @example\n * someCollection.show().disabled(true);\n *\n * @class tinymce.ui.Collection\n */\ndefine(\"tinymce/ui/Collection\", [\n\t\"tinymce/util/Tools\",\n\t\"tinymce/ui/Selector\",\n\t\"tinymce/util/Class\"\n], function(Tools, Selector, Class) {\n\t\"use strict\";\n\n\tvar Collection, proto, push = Array.prototype.push, slice = Array.prototype.slice;\n\n\tproto = {\n\t\t/**\n\t\t * Current number of contained control instances.\n\t\t *\n\t\t * @field length\n\t\t * @type Number\n\t\t */\n\t\tlength: 0,\n\n\t\t/**\n\t\t * Constructor for the collection.\n\t\t *\n\t\t * @constructor\n\t\t * @method init\n\t\t * @param {Array} items Optional array with items to add.\n\t\t */\n\t\tinit: function(items) {\n\t\t\tif (items) {\n\t\t\t\tthis.add(items);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Adds new items to the control collection.\n\t\t *\n\t\t * @method add\n\t\t * @param {Array} items Array if items to add to collection.\n\t\t * @return {tinymce.ui.Collection} Current collection instance.\n\t\t */\n\t\tadd: function(items) {\n\t\t\tvar self = this;\n\n\t\t\t// Force single item into array\n\t\t\tif (!Tools.isArray(items)) {\n\t\t\t\tif (items instanceof Collection) {\n\t\t\t\t\tself.add(items.toArray());\n\t\t\t\t} else {\n\t\t\t\t\tpush.call(self, items);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tpush.apply(self, items);\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Sets the contents of the collection. This will remove any existing items\n\t\t * and replace them with the ones specified in the input array.\n\t\t *\n\t\t * @method set\n\t\t * @param {Array} items Array with items to set into the Collection.\n\t\t * @return {tinymce.ui.Collection} Collection instance.\n\t\t */\n\t\tset: function(items) {\n\t\t\tvar self = this, len = self.length, i;\n\n\t\t\tself.length = 0;\n\t\t\tself.add(items);\n\n\t\t\t// Remove old entries\n\t\t\tfor (i = self.length; i < len; i++) {\n\t\t\t\tdelete self[i];\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Filters the collection item based on the specified selector expression or selector function.\n\t\t *\n\t\t * @method filter\n\t\t * @param {String} selector Selector expression to filter items by.\n\t\t * @return {tinymce.ui.Collection} Collection containing the filtered items.\n\t\t */\n\t\tfilter: function(selector) {\n\t\t\tvar self = this, i, l, matches = [], item, match;\n\n\t\t\t// Compile string into selector expression\n\t\t\tif (typeof selector === \"string\") {\n\t\t\t\tselector = new Selector(selector);\n\n\t\t\t\tmatch = function(item) {\n\t\t\t\t\treturn selector.match(item);\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\t// Use selector as matching function\n\t\t\t\tmatch = selector;\n\t\t\t}\n\n\t\t\tfor (i = 0, l = self.length; i < l; i++) {\n\t\t\t\titem = self[i];\n\n\t\t\t\tif (match(item)) {\n\t\t\t\t\tmatches.push(item);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn new Collection(matches);\n\t\t},\n\n\t\t/**\n\t\t * Slices the items within the collection.\n\t\t *\n\t\t * @method slice\n\t\t * @param {Number} index Index to slice at.\n\t\t * @param {Number} len Optional length to slice.\n\t\t * @return {tinymce.ui.Collection} Current collection.\n\t\t */\n\t\tslice: function() {\n\t\t\treturn new Collection(slice.apply(this, arguments));\n\t\t},\n\n\t\t/**\n\t\t * Makes the current collection equal to the specified index.\n\t\t *\n\t\t * @method eq\n\t\t * @param {Number} index Index of the item to set the collection to.\n\t\t * @return {tinymce.ui.Collection} Current collection.\n\t\t */\n\t\teq: function(index) {\n\t\t\treturn index === -1 ? this.slice(index) : this.slice(index, +index + 1);\n\t\t},\n\n\t\t/**\n\t\t * Executes the specified callback on each item in collection.\n\t\t *\n\t\t * @method each\n\t\t * @param {function} callback Callback to execute for each item in collection.\n\t\t * @return {tinymce.ui.Collection} Current collection instance.\n\t\t */\n\t\teach: function(callback) {\n\t\t\tTools.each(this, callback);\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Returns an JavaScript array object of the contents inside the collection.\n\t\t *\n\t\t * @method toArray\n\t\t * @return {Array} Array with all items from collection.\n\t\t */\n\t\ttoArray: function() {\n\t\t\treturn Tools.toArray(this);\n\t\t},\n\n\t\t/**\n\t\t * Finds the index of the specified control or return -1 if it isn't in the collection.\n\t\t *\n\t\t * @method indexOf\n\t\t * @param {Control} ctrl Control instance to look for.\n\t\t * @return {Number} Index of the specified control or -1.\n\t\t */\n\t\tindexOf: function(ctrl) {\n\t\t\tvar self = this, i = self.length;\n\n\t\t\twhile (i--) {\n\t\t\t\tif (self[i] === ctrl) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn i;\n\t\t},\n\n\t\t/**\n\t\t * Returns a new collection of the contents in reverse order.\n\t\t *\n\t\t * @method reverse\n\t\t * @return {tinymce.ui.Collection} Collection instance with reversed items.\n\t\t */\n\t\treverse: function() {\n\t\t\treturn new Collection(Tools.toArray(this).reverse());\n\t\t},\n\n\t\t/**\n\t\t * Returns true/false if the class exists or not.\n\t\t *\n\t\t * @method hasClass\n\t\t * @param {String} cls Class to check for.\n\t\t * @return {Boolean} true/false state if the class exists or not.\n\t\t */\n\t\thasClass: function(cls) {\n\t\t\treturn this[0] ? this[0].classes.contains(cls) : false;\n\t\t},\n\n\t\t/**\n\t\t * Sets/gets the specific property on the items in the collection. The same as executing control.<property>(<value>);\n\t\t *\n\t\t * @method prop\n\t\t * @param {String} name Property name to get/set.\n\t\t * @param {Object} value Optional object value to set.\n\t\t * @return {tinymce.ui.Collection} Current collection instance or value of the first item on a get operation.\n\t\t */\n\t\tprop: function(name, value) {\n\t\t\tvar self = this, undef, item;\n\n\t\t\tif (value !== undef) {\n\t\t\t\tself.each(function(item) {\n\t\t\t\t\tif (item[name]) {\n\t\t\t\t\t\titem[name](value);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn self;\n\t\t\t}\n\n\t\t\titem = self[0];\n\n\t\t\tif (item && item[name]) {\n\t\t\t\treturn item[name]();\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Executes the specific function name with optional arguments an all items in collection if it exists.\n\t\t *\n\t\t * @example collection.exec(\"myMethod\", arg1, arg2, arg3);\n\t\t * @method exec\n\t\t * @param {String} name Name of the function to execute.\n\t\t * @param {Object} ... Multiple arguments to pass to each function.\n\t\t * @return {tinymce.ui.Collection} Current collection.\n\t\t */\n\t\texec: function(name) {\n\t\t\tvar self = this, args = Tools.toArray(arguments).slice(1);\n\n\t\t\tself.each(function(item) {\n\t\t\t\tif (item[name]) {\n\t\t\t\t\titem[name].apply(item, args);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Remove all items from collection and DOM.\n\t\t *\n\t\t * @method remove\n\t\t * @return {tinymce.ui.Collection} Current collection.\n\t\t */\n\t\tremove: function() {\n\t\t\tvar i = this.length;\n\n\t\t\twhile (i--) {\n\t\t\t\tthis[i].remove();\n\t\t\t}\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Adds a class to all items in the collection.\n\t\t *\n\t\t * @method addClass\n\t\t * @param {String} cls Class to add to each item.\n\t\t * @return {tinymce.ui.Collection} Current collection instance.\n\t\t */\n\t\taddClass: function(cls) {\n\t\t\treturn this.each(function(item) {\n\t\t\t\titem.classes.add(cls);\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Removes the specified class from all items in collection.\n\t\t *\n\t\t * @method removeClass\n\t\t * @param {String} cls Class to remove from each item.\n\t\t * @return {tinymce.ui.Collection} Current collection instance.\n\t\t */\n\t\tremoveClass: function(cls) {\n\t\t\treturn this.each(function(item) {\n\t\t\t\titem.classes.remove(cls);\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Fires the specified event by name and arguments on the control. This will execute all\n\t\t * bound event handlers.\n\t\t *\n\t\t * @method fire\n\t\t * @param {String} name Name of the event to fire.\n\t\t * @param {Object} args Optional arguments to pass to the event.\n\t\t * @return {tinymce.ui.Collection} Current collection instance.\n\t\t */\n\t\t// fire: function(event, args) {}, -- Generated by code below\n\n\t\t/**\n\t\t * Binds a callback to the specified event. This event can both be\n\t\t * native browser events like \"click\" or custom ones like PostRender.\n\t\t *\n\t\t * The callback function will have two parameters the first one being the control that received the event\n\t\t * the second one will be the event object either the browsers native event object or a custom JS object.\n\t\t *\n\t\t * @method on\n\t\t * @param {String} name Name of the event to bind. For example \"click\".\n\t\t * @param {String/function} callback Callback function to execute ones the event occurs.\n\t\t * @return {tinymce.ui.Collection} Current collection instance.\n\t\t */\n\t\t// on: function(name, callback) {}, -- Generated by code below\n\n\t\t/**\n\t\t * Unbinds the specified event and optionally a specific callback. If you omit the name\n\t\t * parameter all event handlers will be removed. If you omit the callback all event handles\n\t\t * by the specified name will be removed.\n\t\t *\n\t\t * @method off\n\t\t * @param {String} name Optional name for the event to unbind.\n\t\t * @param {function} callback Optional callback function to unbind.\n\t\t * @return {tinymce.ui.Collection} Current collection instance.\n\t\t */\n\t\t// off: function(name, callback) {}, -- Generated by code below\n\n\t\t/**\n\t\t * Shows the items in the current collection.\n\t\t *\n\t\t * @method show\n\t\t * @return {tinymce.ui.Collection} Current collection instance.\n\t\t */\n\t\t// show: function() {}, -- Generated by code below\n\n\t\t/**\n\t\t * Hides the items in the current collection.\n\t\t *\n\t\t * @method hide\n\t\t * @return {tinymce.ui.Collection} Current collection instance.\n\t\t */\n\t\t// hide: function() {}, -- Generated by code below\n\n\t\t/**\n\t\t * Sets/gets the text contents of the items in the current collection.\n\t\t *\n\t\t * @method text\n\t\t * @return {tinymce.ui.Collection} Current collection instance or text value of the first item on a get operation.\n\t\t */\n\t\t// text: function(value) {}, -- Generated by code below\n\n\t\t/**\n\t\t * Sets/gets the name contents of the items in the current collection.\n\t\t *\n\t\t * @method name\n\t\t * @return {tinymce.ui.Collection} Current collection instance or name value of the first item on a get operation.\n\t\t */\n\t\t// name: function(value) {}, -- Generated by code below\n\n\t\t/**\n\t\t * Sets/gets the disabled state on the items in the current collection.\n\t\t *\n\t\t * @method disabled\n\t\t * @return {tinymce.ui.Collection} Current collection instance or disabled state of the first item on a get operation.\n\t\t */\n\t\t// disabled: function(state) {}, -- Generated by code below\n\n\t\t/**\n\t\t * Sets/gets the active state on the items in the current collection.\n\t\t *\n\t\t * @method active\n\t\t * @return {tinymce.ui.Collection} Current collection instance or active state of the first item on a get operation.\n\t\t */\n\t\t// active: function(state) {}, -- Generated by code below\n\n\t\t/**\n\t\t * Sets/gets the selected state on the items in the current collection.\n\t\t *\n\t\t * @method selected\n\t\t * @return {tinymce.ui.Collection} Current collection instance or selected state of the first item on a get operation.\n\t\t */\n\t\t// selected: function(state) {}, -- Generated by code below\n\n\t\t/**\n\t\t * Sets/gets the selected state on the items in the current collection.\n\t\t *\n\t\t * @method visible\n\t\t * @return {tinymce.ui.Collection} Current collection instance or visible state of the first item on a get operation.\n\t\t */\n\t\t// visible: function(state) {}, -- Generated by code below\n\t};\n\n\t// Extend tinymce.ui.Collection prototype with some generated control specific methods\n\tTools.each('fire on off show hide append prepend before after reflow'.split(' '), function(name) {\n\t\tproto[name] = function() {\n\t\t\tvar args = Tools.toArray(arguments);\n\n\t\t\tthis.each(function(ctrl) {\n\t\t\t\tif (name in ctrl) {\n\t\t\t\t\tctrl[name].apply(ctrl, args);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn this;\n\t\t};\n\t});\n\n\t// Extend tinymce.ui.Collection prototype with some property methods\n\tTools.each('text name disabled active selected checked visible parent value data'.split(' '), function(name) {\n\t\tproto[name] = function(value) {\n\t\t\treturn this.prop(name, value);\n\t\t};\n\t});\n\n\t// Create class based on the new prototype\n\tCollection = Class.extend(proto);\n\n\t// Stick Collection into Selector to prevent circual references\n\tSelector.Collection = Collection;\n\n\treturn Collection;\n});\n\n// Included from: js/tinymce/classes/ui/DomUtils.js\n\n/**\n * DomUtils.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Private UI DomUtils proxy.\n *\n * @private\n * @class tinymce.ui.DomUtils\n */\ndefine(\"tinymce/ui/DomUtils\", [\n\t\"tinymce/Env\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/dom/DOMUtils\"\n], function(Env, Tools, DOMUtils) {\n\t\"use strict\";\n\n\tvar count = 0;\n\n\tvar funcs = {\n\t\tid: function() {\n\t\t\treturn 'mceu_' + (count++);\n\t\t},\n\n\t\tcreate: function(name, attrs, children) {\n\t\t\tvar elm = document.createElement(name);\n\n\t\t\tDOMUtils.DOM.setAttribs(elm, attrs);\n\n\t\t\tif (typeof children === 'string') {\n\t\t\t\telm.innerHTML = children;\n\t\t\t} else {\n\t\t\t\tTools.each(children, function(child) {\n\t\t\t\t\tif (child.nodeType) {\n\t\t\t\t\t\telm.appendChild(child);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn elm;\n\t\t},\n\n\t\tcreateFragment: function(html) {\n\t\t\treturn DOMUtils.DOM.createFragment(html);\n\t\t},\n\n\t\tgetWindowSize: function() {\n\t\t\treturn DOMUtils.DOM.getViewPort();\n\t\t},\n\n\t\tgetSize: function(elm) {\n\t\t\tvar width, height;\n\n\t\t\tif (elm.getBoundingClientRect) {\n\t\t\t\tvar rect = elm.getBoundingClientRect();\n\n\t\t\t\twidth = Math.max(rect.width || (rect.right - rect.left), elm.offsetWidth);\n\t\t\t\theight = Math.max(rect.height || (rect.bottom - rect.bottom), elm.offsetHeight);\n\t\t\t} else {\n\t\t\t\twidth = elm.offsetWidth;\n\t\t\t\theight = elm.offsetHeight;\n\t\t\t}\n\n\t\t\treturn {width: width, height: height};\n\t\t},\n\n\t\tgetPos: function(elm, root) {\n\t\t\treturn DOMUtils.DOM.getPos(elm, root || funcs.getContainer());\n\t\t},\n\n\t\tgetContainer: function () {\n\t\t\treturn Env.container ? Env.container : document.body;\n\t\t},\n\n\t\tgetViewPort: function(win) {\n\t\t\treturn DOMUtils.DOM.getViewPort(win);\n\t\t},\n\n\t\tget: function(id) {\n\t\t\treturn document.getElementById(id);\n\t\t},\n\n\t\taddClass: function(elm, cls) {\n\t\t\treturn DOMUtils.DOM.addClass(elm, cls);\n\t\t},\n\n\t\tremoveClass: function(elm, cls) {\n\t\t\treturn DOMUtils.DOM.removeClass(elm, cls);\n\t\t},\n\n\t\thasClass: function(elm, cls) {\n\t\t\treturn DOMUtils.DOM.hasClass(elm, cls);\n\t\t},\n\n\t\ttoggleClass: function(elm, cls, state) {\n\t\t\treturn DOMUtils.DOM.toggleClass(elm, cls, state);\n\t\t},\n\n\t\tcss: function(elm, name, value) {\n\t\t\treturn DOMUtils.DOM.setStyle(elm, name, value);\n\t\t},\n\n\t\tgetRuntimeStyle: function(elm, name) {\n\t\t\treturn DOMUtils.DOM.getStyle(elm, name, true);\n\t\t},\n\n\t\ton: function(target, name, callback, scope) {\n\t\t\treturn DOMUtils.DOM.bind(target, name, callback, scope);\n\t\t},\n\n\t\toff: function(target, name, callback) {\n\t\t\treturn DOMUtils.DOM.unbind(target, name, callback);\n\t\t},\n\n\t\tfire: function(target, name, args) {\n\t\t\treturn DOMUtils.DOM.fire(target, name, args);\n\t\t},\n\n\t\tinnerHtml: function(elm, html) {\n\t\t\t// Workaround for <div> in <p> bug on IE 8 #6178\n\t\t\tDOMUtils.DOM.setHTML(elm, html);\n\t\t}\n\t};\n\n\treturn funcs;\n});\n\n// Included from: js/tinymce/classes/ui/BoxUtils.js\n\n/**\n * BoxUtils.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Utility class for box parsing and measuring.\n *\n * @private\n * @class tinymce.ui.BoxUtils\n */\ndefine(\"tinymce/ui/BoxUtils\", [\n], function() {\n\t\"use strict\";\n\n\treturn {\n\t\t/**\n\t\t * Parses the specified box value. A box value contains 1-4 properties in clockwise order.\n\t\t *\n\t\t * @method parseBox\n\t\t * @param {String/Number} value Box value \"0 1 2 3\" or \"0\" etc.\n\t\t * @return {Object} Object with top/right/bottom/left properties.\n\t\t * @private\n\t\t */\n\t\tparseBox: function(value) {\n\t\t\tvar len, radix = 10;\n\n\t\t\tif (!value) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (typeof value === \"number\") {\n\t\t\t\tvalue = value || 0;\n\n\t\t\t\treturn {\n\t\t\t\t\ttop: value,\n\t\t\t\t\tleft: value,\n\t\t\t\t\tbottom: value,\n\t\t\t\t\tright: value\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tvalue = value.split(' ');\n\t\t\tlen = value.length;\n\n\t\t\tif (len === 1) {\n\t\t\t\tvalue[1] = value[2] = value[3] = value[0];\n\t\t\t} else if (len === 2) {\n\t\t\t\tvalue[2] = value[0];\n\t\t\t\tvalue[3] = value[1];\n\t\t\t} else if (len === 3) {\n\t\t\t\tvalue[3] = value[1];\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\ttop: parseInt(value[0], radix) || 0,\n\t\t\t\tright: parseInt(value[1], radix) || 0,\n\t\t\t\tbottom: parseInt(value[2], radix) || 0,\n\t\t\t\tleft: parseInt(value[3], radix) || 0\n\t\t\t};\n\t\t},\n\n\t\tmeasureBox: function(elm, prefix) {\n\t\t\tfunction getStyle(name) {\n\t\t\t\tvar defaultView = document.defaultView;\n\n\t\t\t\tif (defaultView) {\n\t\t\t\t\t// Remove camelcase\n\t\t\t\t\tname = name.replace(/[A-Z]/g, function(a) {\n\t\t\t\t\t\treturn '-' + a;\n\t\t\t\t\t});\n\n\t\t\t\t\treturn defaultView.getComputedStyle(elm, null).getPropertyValue(name);\n\t\t\t\t}\n\n\t\t\t\treturn elm.currentStyle[name];\n\t\t\t}\n\n\t\t\tfunction getSide(name) {\n\t\t\t\tvar val = parseFloat(getStyle(name), 10);\n\n\t\t\t\treturn isNaN(val) ? 0 : val;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\ttop: getSide(prefix + \"TopWidth\"),\n\t\t\t\tright: getSide(prefix + \"RightWidth\"),\n\t\t\t\tbottom: getSide(prefix + \"BottomWidth\"),\n\t\t\t\tleft: getSide(prefix + \"LeftWidth\")\n\t\t\t};\n\t\t}\n\t};\n});\n\n// Included from: js/tinymce/classes/ui/ClassList.js\n\n/**\n * ClassList.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Handles adding and removal of classes.\n *\n * @private\n * @class tinymce.ui.ClassList\n */\ndefine(\"tinymce/ui/ClassList\", [\n\t\"tinymce/util/Tools\"\n], function(Tools) {\n\t\"use strict\";\n\n\tfunction noop() {\n\t}\n\n\t/**\n\t * Constructs a new class list the specified onchange\n\t * callback will be executed when the class list gets modifed.\n\t *\n\t * @constructor ClassList\n\t * @param {function} onchange Onchange callback to be executed.\n\t */\n\tfunction ClassList(onchange) {\n\t\tthis.cls = [];\n\t\tthis.cls._map = {};\n\t\tthis.onchange = onchange || noop;\n\t\tthis.prefix = '';\n\t}\n\n\tTools.extend(ClassList.prototype, {\n\t\t/**\n\t\t * Adds a new class to the class list.\n\t\t *\n\t\t * @method add\n\t\t * @param {String} cls Class to be added.\n\t\t * @return {tinymce.ui.ClassList} Current class list instance.\n\t\t */\n\t\tadd: function(cls) {\n\t\t\tif (cls && !this.contains(cls)) {\n\t\t\t\tthis.cls._map[cls] = true;\n\t\t\t\tthis.cls.push(cls);\n\t\t\t\tthis._change();\n\t\t\t}\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Removes the specified class from the class list.\n\t\t *\n\t\t * @method remove\n\t\t * @param {String} cls Class to be removed.\n\t\t * @return {tinymce.ui.ClassList} Current class list instance.\n\t\t */\n\t\tremove: function(cls) {\n\t\t\tif (this.contains(cls)) {\n\t\t\t\tfor (var i = 0; i < this.cls.length; i++) {\n\t\t\t\t\tif (this.cls[i] === cls) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.cls.splice(i, 1);\n\t\t\t\tdelete this.cls._map[cls];\n\t\t\t\tthis._change();\n\t\t\t}\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Toggles a class in the class list.\n\t\t *\n\t\t * @method toggle\n\t\t * @param {String} cls Class to be added/removed.\n\t\t * @param {Boolean} state Optional state if it should be added/removed.\n\t\t * @return {tinymce.ui.ClassList} Current class list instance.\n\t\t */\n\t\ttoggle: function(cls, state) {\n\t\t\tvar curState = this.contains(cls);\n\n\t\t\tif (curState !== state) {\n\t\t\t\tif (curState) {\n\t\t\t\t\tthis.remove(cls);\n\t\t\t\t} else {\n\t\t\t\t\tthis.add(cls);\n\t\t\t\t}\n\n\t\t\t\tthis._change();\n\t\t\t}\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Returns true if the class list has the specified class.\n\t\t *\n\t\t * @method contains\n\t\t * @param {String} cls Class to look for.\n\t\t * @return {Boolean} true/false if the class exists or not.\n\t\t */\n\t\tcontains: function(cls) {\n\t\t\treturn !!this.cls._map[cls];\n\t\t},\n\n\t\t/**\n\t\t * Returns a space separated list of classes.\n\t\t *\n\t\t * @method toString\n\t\t * @return {String} Space separated list of classes.\n\t\t */\n\n\t\t_change: function() {\n\t\t\tdelete this.clsValue;\n\t\t\tthis.onchange.call(this);\n\t\t}\n\t});\n\n\t// IE 8 compatibility\n\tClassList.prototype.toString = function() {\n\t\tvar value;\n\n\t\tif (this.clsValue) {\n\t\t\treturn this.clsValue;\n\t\t}\n\n\t\tvalue = '';\n\t\tfor (var i = 0; i < this.cls.length; i++) {\n\t\t\tif (i > 0) {\n\t\t\t\tvalue += ' ';\n\t\t\t}\n\n\t\t\tvalue += this.prefix + this.cls[i];\n\t\t}\n\n\t\treturn value;\n\t};\n\n\treturn ClassList;\n});\n\n// Included from: js/tinymce/classes/ui/ReflowQueue.js\n\n/**\n * ReflowQueue.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class will automatically reflow controls on the next animation frame within a few milliseconds on older browsers.\n * If the user manually reflows then the automatic reflow will be cancelled. This class is used internally when various control states\n * changes that triggers a reflow.\n *\n * @class tinymce.ui.ReflowQueue\n * @static\n */\ndefine(\"tinymce/ui/ReflowQueue\", [\n\t\"tinymce/util/Delay\"\n], function(Delay) {\n\tvar dirtyCtrls = {}, animationFrameRequested;\n\n\treturn {\n\t\t/**\n\t\t * Adds a control to the next automatic reflow call. This is the control that had a state\n\t\t * change for example if the control was hidden/shown.\n\t\t *\n\t\t * @method add\n\t\t * @param {tinymce.ui.Control} ctrl Control to add to queue.\n\t\t */\n\t\tadd: function(ctrl) {\n\t\t\tvar parent = ctrl.parent();\n\n\t\t\tif (parent) {\n\t\t\t\tif (!parent._layout || parent._layout.isNative()) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!dirtyCtrls[parent._id]) {\n\t\t\t\t\tdirtyCtrls[parent._id] = parent;\n\t\t\t\t}\n\n\t\t\t\tif (!animationFrameRequested) {\n\t\t\t\t\tanimationFrameRequested = true;\n\n\t\t\t\t\tDelay.requestAnimationFrame(function() {\n\t\t\t\t\t\tvar id, ctrl;\n\n\t\t\t\t\t\tanimationFrameRequested = false;\n\n\t\t\t\t\t\tfor (id in dirtyCtrls) {\n\t\t\t\t\t\t\tctrl = dirtyCtrls[id];\n\n\t\t\t\t\t\t\tif (ctrl.state.get('rendered')) {\n\t\t\t\t\t\t\t\tctrl.reflow();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdirtyCtrls = {};\n\t\t\t\t\t}, document.body);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Removes the specified control from the automatic reflow. This will happen when for example the user\n\t\t * manually triggers a reflow.\n\t\t *\n\t\t * @method remove\n\t\t * @param {tinymce.ui.Control} ctrl Control to remove from queue.\n\t\t */\n\t\tremove: function(ctrl) {\n\t\t\tif (dirtyCtrls[ctrl._id]) {\n\t\t\t\tdelete dirtyCtrls[ctrl._id];\n\t\t\t}\n\t\t}\n\t};\n});\n\n// Included from: js/tinymce/classes/ui/Control.js\n\n/**\n * Control.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/*eslint consistent-this:0 */\n\n/**\n * This is the base class for all controls and containers. All UI control instances inherit\n * from this one as it has the base logic needed by all of them.\n *\n * @class tinymce.ui.Control\n */\ndefine(\"tinymce/ui/Control\", [\n\t\"tinymce/util/Class\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/util/EventDispatcher\",\n\t\"tinymce/data/ObservableObject\",\n\t\"tinymce/ui/Collection\",\n\t\"tinymce/ui/DomUtils\",\n\t\"tinymce/dom/DomQuery\",\n\t\"tinymce/ui/BoxUtils\",\n\t\"tinymce/ui/ClassList\",\n\t\"tinymce/ui/ReflowQueue\"\n], function(Class, Tools, EventDispatcher, ObservableObject, Collection, DomUtils, $, BoxUtils, ClassList, ReflowQueue) {\n\t\"use strict\";\n\n\tvar hasMouseWheelEventSupport = \"onmousewheel\" in document;\n\tvar hasWheelEventSupport = false;\n\tvar classPrefix = \"mce-\";\n\tvar Control, idCounter = 0;\n\n\tvar proto = {\n\t\tStatics: {\n\t\t\tclassPrefix: classPrefix\n\t\t},\n\n\t\tisRtl: function() {\n\t\t\treturn Control.rtl;\n\t\t},\n\n\t\t/**\n\t\t * Class/id prefix to use for all controls.\n\t\t *\n\t\t * @final\n\t\t * @field {String} classPrefix\n\t\t */\n\t\tclassPrefix: classPrefix,\n\n\t\t/**\n\t\t * Constructs a new control instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t * @setting {String} style Style CSS properties to add.\n\t\t * @setting {String} border Border box values example: 1 1 1 1\n\t\t * @setting {String} padding Padding box values example: 1 1 1 1\n\t\t * @setting {String} margin Margin box values example: 1 1 1 1\n\t\t * @setting {Number} minWidth Minimal width for the control.\n\t\t * @setting {Number} minHeight Minimal height for the control.\n\t\t * @setting {String} classes Space separated list of classes to add.\n\t\t * @setting {String} role WAI-ARIA role to use for control.\n\t\t * @setting {Boolean} hidden Is the control hidden by default.\n\t\t * @setting {Boolean} disabled Is the control disabled by default.\n\t\t * @setting {String} name Name of the control instance.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this, classes, defaultClasses;\n\n\t\t\tfunction applyClasses(classes) {\n\t\t\t\tvar i;\n\n\t\t\t\tclasses = classes.split(' ');\n\t\t\t\tfor (i = 0; i < classes.length; i++) {\n\t\t\t\t\tself.classes.add(classes[i]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tself.settings = settings = Tools.extend({}, self.Defaults, settings);\n\n\t\t\t// Initial states\n\t\t\tself._id = settings.id || ('mceu_' + (idCounter++));\n\t\t\tself._aria = {role: settings.role};\n\t\t\tself._elmCache = {};\n\t\t\tself.$ = $;\n\n\t\t\tself.state = new ObservableObject({\n\t\t\t\tvisible: true,\n\t\t\t\tactive: false,\n\t\t\t\tdisabled: false,\n\t\t\t\tvalue: ''\n\t\t\t});\n\n\t\t\tself.data = new ObservableObject(settings.data);\n\n\t\t\tself.classes = new ClassList(function() {\n\t\t\t\tif (self.state.get('rendered')) {\n\t\t\t\t\tself.getEl().className = this.toString();\n\t\t\t\t}\n\t\t\t});\n\t\t\tself.classes.prefix = self.classPrefix;\n\n\t\t\t// Setup classes\n\t\t\tclasses = settings.classes;\n\t\t\tif (classes) {\n\t\t\t\tif (self.Defaults) {\n\t\t\t\t\tdefaultClasses = self.Defaults.classes;\n\n\t\t\t\t\tif (defaultClasses && classes != defaultClasses) {\n\t\t\t\t\t\tapplyClasses(defaultClasses);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tapplyClasses(classes);\n\t\t\t}\n\n\t\t\tTools.each('title text name visible disabled active value'.split(' '), function(name) {\n\t\t\t\tif (name in settings) {\n\t\t\t\t\tself[name](settings[name]);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.on('click', function() {\n\t\t\t\tif (self.disabled()) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t/**\n\t\t\t * Name/value object with settings for the current control.\n\t\t\t *\n\t\t\t * @field {Object} settings\n\t\t\t */\n\t\t\tself.settings = settings;\n\n\t\t\tself.borderBox = BoxUtils.parseBox(settings.border);\n\t\t\tself.paddingBox = BoxUtils.parseBox(settings.padding);\n\t\t\tself.marginBox = BoxUtils.parseBox(settings.margin);\n\n\t\t\tif (settings.hidden) {\n\t\t\t\tself.hide();\n\t\t\t}\n\t\t},\n\n\t\t// Will generate getter/setter methods for these properties\n\t\tProperties: 'parent,name',\n\n\t\t/**\n\t\t * Returns the root element to render controls into.\n\t\t *\n\t\t * @method getContainerElm\n\t\t * @return {Element} HTML DOM element to render into.\n\t\t */\n\t\tgetContainerElm: function() {\n\t\t\treturn DomUtils.getContainer();\n\t\t},\n\n\t\t/**\n\t\t * Returns a control instance for the current DOM element.\n\t\t *\n\t\t * @method getParentCtrl\n\t\t * @param {Element} elm HTML dom element to get parent control from.\n\t\t * @return {tinymce.ui.Control} Control instance or undefined.\n\t\t */\n\t\tgetParentCtrl: function(elm) {\n\t\t\tvar ctrl, lookup = this.getRoot().controlIdLookup;\n\n\t\t\twhile (elm && lookup) {\n\t\t\t\tctrl = lookup[elm.id];\n\t\t\t\tif (ctrl) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\telm = elm.parentNode;\n\t\t\t}\n\n\t\t\treturn ctrl;\n\t\t},\n\n\t\t/**\n\t\t * Initializes the current controls layout rect.\n\t\t * This will be executed by the layout managers to determine the\n\t\t * default minWidth/minHeight etc.\n\t\t *\n\t\t * @method initLayoutRect\n\t\t * @return {Object} Layout rect instance.\n\t\t */\n\t\tinitLayoutRect: function() {\n\t\t\tvar self = this, settings = self.settings, borderBox, layoutRect;\n\t\t\tvar elm = self.getEl(), width, height, minWidth, minHeight, autoResize;\n\t\t\tvar startMinWidth, startMinHeight, initialSize;\n\n\t\t\t// Measure the current element\n\t\t\tborderBox = self.borderBox = self.borderBox || BoxUtils.measureBox(elm, 'border');\n\t\t\tself.paddingBox = self.paddingBox || BoxUtils.measureBox(elm, 'padding');\n\t\t\tself.marginBox = self.marginBox || BoxUtils.measureBox(elm, 'margin');\n\t\t\tinitialSize = DomUtils.getSize(elm);\n\n\t\t\t// Setup minWidth/minHeight and width/height\n\t\t\tstartMinWidth = settings.minWidth;\n\t\t\tstartMinHeight = settings.minHeight;\n\t\t\tminWidth = startMinWidth || initialSize.width;\n\t\t\tminHeight = startMinHeight || initialSize.height;\n\t\t\twidth = settings.width;\n\t\t\theight = settings.height;\n\t\t\tautoResize = settings.autoResize;\n\t\t\tautoResize = typeof autoResize != \"undefined\" ? autoResize : !width && !height;\n\n\t\t\twidth = width || minWidth;\n\t\t\theight = height || minHeight;\n\n\t\t\tvar deltaW = borderBox.left + borderBox.right;\n\t\t\tvar deltaH = borderBox.top + borderBox.bottom;\n\n\t\t\tvar maxW = settings.maxWidth || 0xFFFF;\n\t\t\tvar maxH = settings.maxHeight || 0xFFFF;\n\n\t\t\t// Setup initial layout rect\n\t\t\tself._layoutRect = layoutRect = {\n\t\t\t\tx: settings.x || 0,\n\t\t\t\ty: settings.y || 0,\n\t\t\t\tw: width,\n\t\t\t\th: height,\n\t\t\t\tdeltaW: deltaW,\n\t\t\t\tdeltaH: deltaH,\n\t\t\t\tcontentW: width - deltaW,\n\t\t\t\tcontentH: height - deltaH,\n\t\t\t\tinnerW: width - deltaW,\n\t\t\t\tinnerH: height - deltaH,\n\t\t\t\tstartMinWidth: startMinWidth || 0,\n\t\t\t\tstartMinHeight: startMinHeight || 0,\n\t\t\t\tminW: Math.min(minWidth, maxW),\n\t\t\t\tminH: Math.min(minHeight, maxH),\n\t\t\t\tmaxW: maxW,\n\t\t\t\tmaxH: maxH,\n\t\t\t\tautoResize: autoResize,\n\t\t\t\tscrollW: 0\n\t\t\t};\n\n\t\t\tself._lastLayoutRect = {};\n\n\t\t\treturn layoutRect;\n\t\t},\n\n\t\t/**\n\t\t * Getter/setter for the current layout rect.\n\t\t *\n\t\t * @method layoutRect\n\t\t * @param {Object} [newRect] Optional new layout rect.\n\t\t * @return {tinymce.ui.Control/Object} Current control or rect object.\n\t\t */\n\t\tlayoutRect: function(newRect) {\n\t\t\tvar self = this, curRect = self._layoutRect, lastLayoutRect, size, deltaWidth, deltaHeight, undef, repaintControls;\n\n\t\t\t// Initialize default layout rect\n\t\t\tif (!curRect) {\n\t\t\t\tcurRect = self.initLayoutRect();\n\t\t\t}\n\n\t\t\t// Set new rect values\n\t\t\tif (newRect) {\n\t\t\t\t// Calc deltas between inner and outer sizes\n\t\t\t\tdeltaWidth = curRect.deltaW;\n\t\t\t\tdeltaHeight = curRect.deltaH;\n\n\t\t\t\t// Set x position\n\t\t\t\tif (newRect.x !== undef) {\n\t\t\t\t\tcurRect.x = newRect.x;\n\t\t\t\t}\n\n\t\t\t\t// Set y position\n\t\t\t\tif (newRect.y !== undef) {\n\t\t\t\t\tcurRect.y = newRect.y;\n\t\t\t\t}\n\n\t\t\t\t// Set minW\n\t\t\t\tif (newRect.minW !== undef) {\n\t\t\t\t\tcurRect.minW = newRect.minW;\n\t\t\t\t}\n\n\t\t\t\t// Set minH\n\t\t\t\tif (newRect.minH !== undef) {\n\t\t\t\t\tcurRect.minH = newRect.minH;\n\t\t\t\t}\n\n\t\t\t\t// Set new width and calculate inner width\n\t\t\t\tsize = newRect.w;\n\t\t\t\tif (size !== undef) {\n\t\t\t\t\tsize = size < curRect.minW ? curRect.minW : size;\n\t\t\t\t\tsize = size > curRect.maxW ? curRect.maxW : size;\n\t\t\t\t\tcurRect.w = size;\n\t\t\t\t\tcurRect.innerW = size - deltaWidth;\n\t\t\t\t}\n\n\t\t\t\t// Set new height and calculate inner height\n\t\t\t\tsize = newRect.h;\n\t\t\t\tif (size !== undef) {\n\t\t\t\t\tsize = size < curRect.minH ? curRect.minH : size;\n\t\t\t\t\tsize = size > curRect.maxH ? curRect.maxH : size;\n\t\t\t\t\tcurRect.h = size;\n\t\t\t\t\tcurRect.innerH = size - deltaHeight;\n\t\t\t\t}\n\n\t\t\t\t// Set new inner width and calculate width\n\t\t\t\tsize = newRect.innerW;\n\t\t\t\tif (size !== undef) {\n\t\t\t\t\tsize = size < curRect.minW - deltaWidth ? curRect.minW - deltaWidth : size;\n\t\t\t\t\tsize = size > curRect.maxW - deltaWidth ? curRect.maxW - deltaWidth : size;\n\t\t\t\t\tcurRect.innerW = size;\n\t\t\t\t\tcurRect.w = size + deltaWidth;\n\t\t\t\t}\n\n\t\t\t\t// Set new height and calculate inner height\n\t\t\t\tsize = newRect.innerH;\n\t\t\t\tif (size !== undef) {\n\t\t\t\t\tsize = size < curRect.minH - deltaHeight ? curRect.minH - deltaHeight : size;\n\t\t\t\t\tsize = size > curRect.maxH - deltaHeight ? curRect.maxH - deltaHeight : size;\n\t\t\t\t\tcurRect.innerH = size;\n\t\t\t\t\tcurRect.h = size + deltaHeight;\n\t\t\t\t}\n\n\t\t\t\t// Set new contentW\n\t\t\t\tif (newRect.contentW !== undef) {\n\t\t\t\t\tcurRect.contentW = newRect.contentW;\n\t\t\t\t}\n\n\t\t\t\t// Set new contentH\n\t\t\t\tif (newRect.contentH !== undef) {\n\t\t\t\t\tcurRect.contentH = newRect.contentH;\n\t\t\t\t}\n\n\t\t\t\t// Compare last layout rect with the current one to see if we need to repaint or not\n\t\t\t\tlastLayoutRect = self._lastLayoutRect;\n\t\t\t\tif (lastLayoutRect.x !== curRect.x || lastLayoutRect.y !== curRect.y ||\n\t\t\t\t\tlastLayoutRect.w !== curRect.w || lastLayoutRect.h !== curRect.h) {\n\t\t\t\t\trepaintControls = Control.repaintControls;\n\n\t\t\t\t\tif (repaintControls) {\n\t\t\t\t\t\tif (repaintControls.map && !repaintControls.map[self._id]) {\n\t\t\t\t\t\t\trepaintControls.push(self);\n\t\t\t\t\t\t\trepaintControls.map[self._id] = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tlastLayoutRect.x = curRect.x;\n\t\t\t\t\tlastLayoutRect.y = curRect.y;\n\t\t\t\t\tlastLayoutRect.w = curRect.w;\n\t\t\t\t\tlastLayoutRect.h = curRect.h;\n\t\t\t\t}\n\n\t\t\t\treturn self;\n\t\t\t}\n\n\t\t\treturn curRect;\n\t\t},\n\n\t\t/**\n\t\t * Repaints the control after a layout operation.\n\t\t *\n\t\t * @method repaint\n\t\t */\n\t\trepaint: function() {\n\t\t\tvar self = this, style, bodyStyle, bodyElm, rect, borderBox;\n\t\t\tvar borderW, borderH, lastRepaintRect, round, value;\n\n\t\t\t// Use Math.round on all values on IE < 9\n\t\t\tround = !document.createRange ? Math.round : function(value) {\n\t\t\t\treturn value;\n\t\t\t};\n\n\t\t\tstyle = self.getEl().style;\n\t\t\trect = self._layoutRect;\n\t\t\tlastRepaintRect = self._lastRepaintRect || {};\n\n\t\t\tborderBox = self.borderBox;\n\t\t\tborderW = borderBox.left + borderBox.right;\n\t\t\tborderH = borderBox.top + borderBox.bottom;\n\n\t\t\tif (rect.x !== lastRepaintRect.x) {\n\t\t\t\tstyle.left = round(rect.x) + 'px';\n\t\t\t\tlastRepaintRect.x = rect.x;\n\t\t\t}\n\n\t\t\tif (rect.y !== lastRepaintRect.y) {\n\t\t\t\tstyle.top = round(rect.y) + 'px';\n\t\t\t\tlastRepaintRect.y = rect.y;\n\t\t\t}\n\n\t\t\tif (rect.w !== lastRepaintRect.w) {\n\t\t\t\tvalue = round(rect.w - borderW);\n\t\t\t\tstyle.width = (value >= 0 ? value : 0) + 'px';\n\t\t\t\tlastRepaintRect.w = rect.w;\n\t\t\t}\n\n\t\t\tif (rect.h !== lastRepaintRect.h) {\n\t\t\t\tvalue = round(rect.h - borderH);\n\t\t\t\tstyle.height = (value >= 0 ? value : 0) + 'px';\n\t\t\t\tlastRepaintRect.h = rect.h;\n\t\t\t}\n\n\t\t\t// Update body if needed\n\t\t\tif (self._hasBody && rect.innerW !== lastRepaintRect.innerW) {\n\t\t\t\tvalue = round(rect.innerW);\n\n\t\t\t\tbodyElm = self.getEl('body');\n\t\t\t\tif (bodyElm) {\n\t\t\t\t\tbodyStyle = bodyElm.style;\n\t\t\t\t\tbodyStyle.width = (value >= 0 ? value : 0) + 'px';\n\t\t\t\t}\n\n\t\t\t\tlastRepaintRect.innerW = rect.innerW;\n\t\t\t}\n\n\t\t\tif (self._hasBody && rect.innerH !== lastRepaintRect.innerH) {\n\t\t\t\tvalue = round(rect.innerH);\n\n\t\t\t\tbodyElm = bodyElm || self.getEl('body');\n\t\t\t\tif (bodyElm) {\n\t\t\t\t\tbodyStyle = bodyStyle || bodyElm.style;\n\t\t\t\t\tbodyStyle.height = (value >= 0 ? value : 0) + 'px';\n\t\t\t\t}\n\n\t\t\t\tlastRepaintRect.innerH = rect.innerH;\n\t\t\t}\n\n\t\t\tself._lastRepaintRect = lastRepaintRect;\n\t\t\tself.fire('repaint', {}, false);\n\t\t},\n\n\t\t/**\n\t\t * Updates the controls layout rect by re-measuing it.\n\t\t */\n\t\tupdateLayoutRect: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.parent()._lastRect = null;\n\n\t\t\tDomUtils.css(self.getEl(), {width: '', height: ''});\n\n\t\t\tself._layoutRect = self._lastRepaintRect = self._lastLayoutRect = null;\n\t\t\tself.initLayoutRect();\n\t\t},\n\n\t\t/**\n\t\t * Binds a callback to the specified event. This event can both be\n\t\t * native browser events like \"click\" or custom ones like PostRender.\n\t\t *\n\t\t * The callback function will be passed a DOM event like object that enables yout do stop propagation.\n\t\t *\n\t\t * @method on\n\t\t * @param {String} name Name of the event to bind. For example \"click\".\n\t\t * @param {String/function} callback Callback function to execute ones the event occurs.\n\t\t * @return {tinymce.ui.Control} Current control object.\n\t\t */\n\t\ton: function(name, callback) {\n\t\t\tvar self = this;\n\n\t\t\tfunction resolveCallbackName(name) {\n\t\t\t\tvar callback, scope;\n\n\t\t\t\tif (typeof name != 'string') {\n\t\t\t\t\treturn name;\n\t\t\t\t}\n\n\t\t\t\treturn function(e) {\n\t\t\t\t\tif (!callback) {\n\t\t\t\t\t\tself.parentsAndSelf().each(function(ctrl) {\n\t\t\t\t\t\t\tvar callbacks = ctrl.settings.callbacks;\n\n\t\t\t\t\t\t\tif (callbacks && (callback = callbacks[name])) {\n\t\t\t\t\t\t\t\tscope = ctrl;\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!callback) {\n\t\t\t\t\t\te.action = name;\n\t\t\t\t\t\tthis.fire('execute', e);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn callback.call(scope, e);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tgetEventDispatcher(self).on(name, resolveCallbackName(callback));\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Unbinds the specified event and optionally a specific callback. If you omit the name\n\t\t * parameter all event handlers will be removed. If you omit the callback all event handles\n\t\t * by the specified name will be removed.\n\t\t *\n\t\t * @method off\n\t\t * @param {String} [name] Name for the event to unbind.\n\t\t * @param {function} [callback] Callback function to unbind.\n\t\t * @return {tinymce.ui.Control} Current control object.\n\t\t */\n\t\toff: function(name, callback) {\n\t\t\tgetEventDispatcher(this).off(name, callback);\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Fires the specified event by name and arguments on the control. This will execute all\n\t\t * bound event handlers.\n\t\t *\n\t\t * @method fire\n\t\t * @param {String} name Name of the event to fire.\n\t\t * @param {Object} [args] Arguments to pass to the event.\n\t\t * @param {Boolean} [bubble] Value to control bubbling. Defaults to true.\n\t\t * @return {Object} Current arguments object.\n\t\t */\n\t\tfire: function(name, args, bubble) {\n\t\t\tvar self = this;\n\n\t\t\targs = args || {};\n\n\t\t\tif (!args.control) {\n\t\t\t\targs.control = self;\n\t\t\t}\n\n\t\t\targs = getEventDispatcher(self).fire(name, args);\n\n\t\t\t// Bubble event up to parents\n\t\t\tif (bubble !== false && self.parent) {\n\t\t\t\tvar parent = self.parent();\n\t\t\t\twhile (parent && !args.isPropagationStopped()) {\n\t\t\t\t\tparent.fire(name, args, false);\n\t\t\t\t\tparent = parent.parent();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn args;\n\t\t},\n\n\t\t/**\n\t\t * Returns true/false if the specified event has any listeners.\n\t\t *\n\t\t * @method hasEventListeners\n\t\t * @param {String} name Name of the event to check for.\n\t\t * @return {Boolean} True/false state if the event has listeners.\n\t\t */\n\t\thasEventListeners: function(name) {\n\t\t\treturn getEventDispatcher(this).has(name);\n\t\t},\n\n\t\t/**\n\t\t * Returns a control collection with all parent controls.\n\t\t *\n\t\t * @method parents\n\t\t * @param {String} selector Optional selector expression to find parents.\n\t\t * @return {tinymce.ui.Collection} Collection with all parent controls.\n\t\t */\n\t\tparents: function(selector) {\n\t\t\tvar self = this, ctrl, parents = new Collection();\n\n\t\t\t// Add each parent to collection\n\t\t\tfor (ctrl = self.parent(); ctrl; ctrl = ctrl.parent()) {\n\t\t\t\tparents.add(ctrl);\n\t\t\t}\n\n\t\t\t// Filter away everything that doesn't match the selector\n\t\t\tif (selector) {\n\t\t\t\tparents = parents.filter(selector);\n\t\t\t}\n\n\t\t\treturn parents;\n\t\t},\n\n\t\t/**\n\t\t * Returns the current control and it's parents.\n\t\t *\n\t\t * @method parentsAndSelf\n\t\t * @param {String} selector Optional selector expression to find parents.\n\t\t * @return {tinymce.ui.Collection} Collection with all parent controls.\n\t\t */\n\t\tparentsAndSelf: function(selector) {\n\t\t\treturn new Collection(this).add(this.parents(selector));\n\t\t},\n\n\t\t/**\n\t\t * Returns the control next to the current control.\n\t\t *\n\t\t * @method next\n\t\t * @return {tinymce.ui.Control} Next control instance.\n\t\t */\n\t\tnext: function() {\n\t\t\tvar parentControls = this.parent().items();\n\n\t\t\treturn parentControls[parentControls.indexOf(this) + 1];\n\t\t},\n\n\t\t/**\n\t\t * Returns the control previous to the current control.\n\t\t *\n\t\t * @method prev\n\t\t * @return {tinymce.ui.Control} Previous control instance.\n\t\t */\n\t\tprev: function() {\n\t\t\tvar parentControls = this.parent().items();\n\n\t\t\treturn parentControls[parentControls.indexOf(this) - 1];\n\t\t},\n\n\t\t/**\n\t\t * Sets the inner HTML of the control element.\n\t\t *\n\t\t * @method innerHtml\n\t\t * @param {String} html Html string to set as inner html.\n\t\t * @return {tinymce.ui.Control} Current control object.\n\t\t */\n\t\tinnerHtml: function(html) {\n\t\t\tthis.$el.html(html);\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Returns the control DOM element or sub element.\n\t\t *\n\t\t * @method getEl\n\t\t * @param {String} [suffix] Suffix to get element by.\n\t\t * @return {Element} HTML DOM element for the current control or it's children.\n\t\t */\n\t\tgetEl: function(suffix) {\n\t\t\tvar id = suffix ? this._id + '-' + suffix : this._id;\n\n\t\t\tif (!this._elmCache[id]) {\n\t\t\t\tthis._elmCache[id] = $('#' + id)[0];\n\t\t\t}\n\n\t\t\treturn this._elmCache[id];\n\t\t},\n\n\t\t/**\n\t\t * Sets the visible state to true.\n\t\t *\n\t\t * @method show\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\tshow: function() {\n\t\t\treturn this.visible(true);\n\t\t},\n\n\t\t/**\n\t\t * Sets the visible state to false.\n\t\t *\n\t\t * @method hide\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\thide: function() {\n\t\t\treturn this.visible(false);\n\t\t},\n\n\t\t/**\n\t\t * Focuses the current control.\n\t\t *\n\t\t * @method focus\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\tfocus: function() {\n\t\t\ttry {\n\t\t\t\tthis.getEl().focus();\n\t\t\t} catch (ex) {\n\t\t\t\t// Ignore IE error\n\t\t\t}\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Blurs the current control.\n\t\t *\n\t\t * @method blur\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\tblur: function() {\n\t\t\tthis.getEl().blur();\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Sets the specified aria property.\n\t\t *\n\t\t * @method aria\n\t\t * @param {String} name Name of the aria property to set.\n\t\t * @param {String} value Value of the aria property.\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\taria: function(name, value) {\n\t\t\tvar self = this, elm = self.getEl(self.ariaTarget);\n\n\t\t\tif (typeof value === \"undefined\") {\n\t\t\t\treturn self._aria[name];\n\t\t\t}\n\n\t\t\tself._aria[name] = value;\n\n\t\t\tif (self.state.get('rendered')) {\n\t\t\t\telm.setAttribute(name == 'role' ? name : 'aria-' + name, value);\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Encodes the specified string with HTML entities. It will also\n\t\t * translate the string to different languages.\n\t\t *\n\t\t * @method encode\n\t\t * @param {String/Object/Array} text Text to entity encode.\n\t\t * @param {Boolean} [translate=true] False if the contents shouldn't be translated.\n\t\t * @return {String} Encoded and possible traslated string.\n\t\t */\n\t\tencode: function(text, translate) {\n\t\t\tif (translate !== false) {\n\t\t\t\ttext = this.translate(text);\n\t\t\t}\n\n\t\t\treturn (text || '').replace(/[&<>\"]/g, function(match) {\n\t\t\t\treturn '&#' + match.charCodeAt(0) + ';';\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Returns the translated string.\n\t\t *\n\t\t * @method translate\n\t\t * @param {String} text Text to translate.\n\t\t * @return {String} Translated string or the same as the input.\n\t\t */\n\t\ttranslate: function(text) {\n\t\t\treturn Control.translate ? Control.translate(text) : text;\n\t\t},\n\n\t\t/**\n\t\t * Adds items before the current control.\n\t\t *\n\t\t * @method before\n\t\t * @param {Array/tinymce.ui.Collection} items Array of items to prepend before this control.\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\tbefore: function(items) {\n\t\t\tvar self = this, parent = self.parent();\n\n\t\t\tif (parent) {\n\t\t\t\tparent.insert(items, parent.items().indexOf(self), true);\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Adds items after the current control.\n\t\t *\n\t\t * @method after\n\t\t * @param {Array/tinymce.ui.Collection} items Array of items to append after this control.\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\tafter: function(items) {\n\t\t\tvar self = this, parent = self.parent();\n\n\t\t\tif (parent) {\n\t\t\t\tparent.insert(items, parent.items().indexOf(self));\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Removes the current control from DOM and from UI collections.\n\t\t *\n\t\t * @method remove\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\tremove: function() {\n\t\t\tvar self = this, elm = self.getEl(), parent = self.parent(), newItems, i;\n\n\t\t\tif (self.items) {\n\t\t\t\tvar controls = self.items().toArray();\n\t\t\t\ti = controls.length;\n\t\t\t\twhile (i--) {\n\t\t\t\t\tcontrols[i].remove();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (parent && parent.items) {\n\t\t\t\tnewItems = [];\n\n\t\t\t\tparent.items().each(function(item) {\n\t\t\t\t\tif (item !== self) {\n\t\t\t\t\t\tnewItems.push(item);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tparent.items().set(newItems);\n\t\t\t\tparent._lastRect = null;\n\t\t\t}\n\n\t\t\tif (self._eventsRoot && self._eventsRoot == self) {\n\t\t\t\t$(elm).off();\n\t\t\t}\n\n\t\t\tvar lookup = self.getRoot().controlIdLookup;\n\t\t\tif (lookup) {\n\t\t\t\tdelete lookup[self._id];\n\t\t\t}\n\n\t\t\tif (elm && elm.parentNode) {\n\t\t\t\telm.parentNode.removeChild(elm);\n\t\t\t}\n\n\t\t\tself.state.set('rendered', false);\n\t\t\tself.state.destroy();\n\n\t\t\tself.fire('remove');\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Renders the control before the specified element.\n\t\t *\n\t\t * @method renderBefore\n\t\t * @param {Element} elm Element to render before.\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\trenderBefore: function(elm) {\n\t\t\t$(elm).before(this.renderHtml());\n\t\t\tthis.postRender();\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Renders the control to the specified element.\n\t\t *\n\t\t * @method renderBefore\n\t\t * @param {Element} elm Element to render to.\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\trenderTo: function(elm) {\n\t\t\t$(elm || this.getContainerElm()).append(this.renderHtml());\n\t\t\tthis.postRender();\n\t\t\treturn this;\n\t\t},\n\n\t\tpreRender: function() {\n\t\t},\n\n\t\trender: function() {\n\t\t},\n\n\t\trenderHtml: function() {\n\t\t\treturn '<div id=\"' + this._id + '\" class=\"' + this.classes + '\"></div>';\n\t\t},\n\n\t\t/**\n\t\t * Post render method. Called after the control has been rendered to the target.\n\t\t *\n\t\t * @method postRender\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\tpostRender: function() {\n\t\t\tvar self = this, settings = self.settings, elm, box, parent, name, parentEventsRoot;\n\n\t\t\tself.$el = $(self.getEl());\n\t\t\tself.state.set('rendered', true);\n\n\t\t\t// Bind on<event> settings\n\t\t\tfor (name in settings) {\n\t\t\t\tif (name.indexOf(\"on\") === 0) {\n\t\t\t\t\tself.on(name.substr(2), settings[name]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (self._eventsRoot) {\n\t\t\t\tfor (parent = self.parent(); !parentEventsRoot && parent; parent = parent.parent()) {\n\t\t\t\t\tparentEventsRoot = parent._eventsRoot;\n\t\t\t\t}\n\n\t\t\t\tif (parentEventsRoot) {\n\t\t\t\t\tfor (name in parentEventsRoot._nativeEvents) {\n\t\t\t\t\t\tself._nativeEvents[name] = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tbindPendingEvents(self);\n\n\t\t\tif (settings.style) {\n\t\t\t\telm = self.getEl();\n\t\t\t\tif (elm) {\n\t\t\t\t\telm.setAttribute('style', settings.style);\n\t\t\t\t\telm.style.cssText = settings.style;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (self.settings.border) {\n\t\t\t\tbox = self.borderBox;\n\t\t\t\tself.$el.css({\n\t\t\t\t\t'border-top-width': box.top,\n\t\t\t\t\t'border-right-width': box.right,\n\t\t\t\t\t'border-bottom-width': box.bottom,\n\t\t\t\t\t'border-left-width': box.left\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Add instance to lookup\n\t\t\tvar root = self.getRoot();\n\t\t\tif (!root.controlIdLookup) {\n\t\t\t\troot.controlIdLookup = {};\n\t\t\t}\n\n\t\t\troot.controlIdLookup[self._id] = self;\n\n\t\t\tfor (var key in self._aria) {\n\t\t\t\tself.aria(key, self._aria[key]);\n\t\t\t}\n\n\t\t\tif (self.state.get('visible') === false) {\n\t\t\t\tself.getEl().style.display = 'none';\n\t\t\t}\n\n\t\t\tself.bindStates();\n\n\t\t\tself.state.on('change:visible', function(e) {\n\t\t\t\tvar state = e.value, parentCtrl;\n\n\t\t\t\tif (self.state.get('rendered')) {\n\t\t\t\t\tself.getEl().style.display = state === false ? 'none' : '';\n\n\t\t\t\t\t// Need to force a reflow here on IE 8\n\t\t\t\t\tself.getEl().getBoundingClientRect();\n\t\t\t\t}\n\n\t\t\t\t// Parent container needs to reflow\n\t\t\t\tparentCtrl = self.parent();\n\t\t\t\tif (parentCtrl) {\n\t\t\t\t\tparentCtrl._lastRect = null;\n\t\t\t\t}\n\n\t\t\t\tself.fire(state ? 'show' : 'hide');\n\n\t\t\t\tReflowQueue.add(self);\n\t\t\t});\n\n\t\t\tself.fire('postrender', {}, false);\n\t\t},\n\n\t\tbindStates: function() {\n\t\t},\n\n\t\t/**\n\t\t * Scrolls the current control into view.\n\t\t *\n\t\t * @method scrollIntoView\n\t\t * @param {String} align Alignment in view top|center|bottom.\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\tscrollIntoView: function(align) {\n\t\t\tfunction getOffset(elm, rootElm) {\n\t\t\t\tvar x, y, parent = elm;\n\n\t\t\t\tx = y = 0;\n\t\t\t\twhile (parent && parent != rootElm && parent.nodeType) {\n\t\t\t\t\tx += parent.offsetLeft || 0;\n\t\t\t\t\ty += parent.offsetTop || 0;\n\t\t\t\t\tparent = parent.offsetParent;\n\t\t\t\t}\n\n\t\t\t\treturn {x: x, y: y};\n\t\t\t}\n\n\t\t\tvar elm = this.getEl(), parentElm = elm.parentNode;\n\t\t\tvar x, y, width, height, parentWidth, parentHeight;\n\t\t\tvar pos = getOffset(elm, parentElm);\n\n\t\t\tx = pos.x;\n\t\t\ty = pos.y;\n\t\t\twidth = elm.offsetWidth;\n\t\t\theight = elm.offsetHeight;\n\t\t\tparentWidth = parentElm.clientWidth;\n\t\t\tparentHeight = parentElm.clientHeight;\n\n\t\t\tif (align == \"end\") {\n\t\t\t\tx -= parentWidth - width;\n\t\t\t\ty -= parentHeight - height;\n\t\t\t} else if (align == \"center\") {\n\t\t\t\tx -= (parentWidth / 2) - (width / 2);\n\t\t\t\ty -= (parentHeight / 2) - (height / 2);\n\t\t\t}\n\n\t\t\tparentElm.scrollLeft = x;\n\t\t\tparentElm.scrollTop = y;\n\n\t\t\treturn this;\n\t\t},\n\n\t\tgetRoot: function() {\n\t\t\tvar ctrl = this, rootControl, parents = [];\n\n\t\t\twhile (ctrl) {\n\t\t\t\tif (ctrl.rootControl) {\n\t\t\t\t\trootControl = ctrl.rootControl;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tparents.push(ctrl);\n\t\t\t\trootControl = ctrl;\n\t\t\t\tctrl = ctrl.parent();\n\t\t\t}\n\n\t\t\tif (!rootControl) {\n\t\t\t\trootControl = this;\n\t\t\t}\n\n\t\t\tvar i = parents.length;\n\t\t\twhile (i--) {\n\t\t\t\tparents[i].rootControl = rootControl;\n\t\t\t}\n\n\t\t\treturn rootControl;\n\t\t},\n\n\t\t/**\n\t\t * Reflows the current control and it's parents.\n\t\t * This should be used after you for example append children to the current control so\n\t\t * that the layout managers know that they need to reposition everything.\n\t\t *\n\t\t * @example\n\t\t * container.append({type: 'button', text: 'My button'}).reflow();\n\t\t *\n\t\t * @method reflow\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\treflow: function() {\n\t\t\tReflowQueue.remove(this);\n\n\t\t\tvar parent = this.parent();\n\t\t\tif (parent._layout && !parent._layout.isNative()) {\n\t\t\t\tparent.reflow();\n\t\t\t}\n\n\t\t\treturn this;\n\t\t}\n\n\t\t/**\n\t\t * Sets/gets the parent container for the control.\n\t\t *\n\t\t * @method parent\n\t\t * @param {tinymce.ui.Container} parent Optional parent to set.\n\t\t * @return {tinymce.ui.Control} Parent control or the current control on a set action.\n\t\t */\n\t\t// parent: function(parent) {} -- Generated\n\n\t\t/**\n\t\t * Sets/gets the text for the control.\n\t\t *\n\t\t * @method text\n\t\t * @param {String} value Value to set to control.\n\t\t * @return {String/tinymce.ui.Control} Current control on a set operation or current value on a get.\n\t\t */\n\t\t// text: function(value) {} -- Generated\n\n\t\t/**\n\t\t * Sets/gets the disabled state on the control.\n\t\t *\n\t\t * @method disabled\n\t\t * @param {Boolean} state Value to set to control.\n\t\t * @return {Boolean/tinymce.ui.Control} Current control on a set operation or current state on a get.\n\t\t */\n\t\t// disabled: function(state) {} -- Generated\n\n\t\t/**\n\t\t * Sets/gets the active for the control.\n\t\t *\n\t\t * @method active\n\t\t * @param {Boolean} state Value to set to control.\n\t\t * @return {Boolean/tinymce.ui.Control} Current control on a set operation or current state on a get.\n\t\t */\n\t\t// active: function(state) {} -- Generated\n\n\t\t/**\n\t\t * Sets/gets the name for the control.\n\t\t *\n\t\t * @method name\n\t\t * @param {String} value Value to set to control.\n\t\t * @return {String/tinymce.ui.Control} Current control on a set operation or current value on a get.\n\t\t */\n\t\t// name: function(value) {} -- Generated\n\n\t\t/**\n\t\t * Sets/gets the title for the control.\n\t\t *\n\t\t * @method title\n\t\t * @param {String} value Value to set to control.\n\t\t * @return {String/tinymce.ui.Control} Current control on a set operation or current value on a get.\n\t\t */\n\t\t// title: function(value) {} -- Generated\n\n\t\t/**\n\t\t * Sets/gets the visible for the control.\n\t\t *\n\t\t * @method visible\n\t\t * @param {Boolean} state Value to set to control.\n\t\t * @return {Boolean/tinymce.ui.Control} Current control on a set operation or current state on a get.\n\t\t */\n\t\t// visible: function(value) {} -- Generated\n\t};\n\n\t/**\n\t * Setup state properties.\n\t */\n\tTools.each('text title visible disabled active value'.split(' '), function(name) {\n\t\tproto[name] = function(value) {\n\t\t\tif (arguments.length === 0) {\n\t\t\t\treturn this.state.get(name);\n\t\t\t}\n\n\t\t\tif (typeof value != \"undefined\") {\n\t\t\t\tthis.state.set(name, value);\n\t\t\t}\n\n\t\t\treturn this;\n\t\t};\n\t});\n\n\tControl = Class.extend(proto);\n\n\tfunction getEventDispatcher(obj) {\n\t\tif (!obj._eventDispatcher) {\n\t\t\tobj._eventDispatcher = new EventDispatcher({\n\t\t\t\tscope: obj,\n\t\t\t\ttoggleEvent: function(name, state) {\n\t\t\t\t\tif (state && EventDispatcher.isNative(name)) {\n\t\t\t\t\t\tif (!obj._nativeEvents) {\n\t\t\t\t\t\t\tobj._nativeEvents = {};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tobj._nativeEvents[name] = true;\n\n\t\t\t\t\t\tif (obj.state.get('rendered')) {\n\t\t\t\t\t\t\tbindPendingEvents(obj);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn obj._eventDispatcher;\n\t}\n\n\tfunction bindPendingEvents(eventCtrl) {\n\t\tvar i, l, parents, eventRootCtrl, nativeEvents, name;\n\n\t\tfunction delegate(e) {\n\t\t\tvar control = eventCtrl.getParentCtrl(e.target);\n\n\t\t\tif (control) {\n\t\t\t\tcontrol.fire(e.type, e);\n\t\t\t}\n\t\t}\n\n\t\tfunction mouseLeaveHandler() {\n\t\t\tvar ctrl = eventRootCtrl._lastHoverCtrl;\n\n\t\t\tif (ctrl) {\n\t\t\t\tctrl.fire(\"mouseleave\", {target: ctrl.getEl()});\n\n\t\t\t\tctrl.parents().each(function(ctrl) {\n\t\t\t\t\tctrl.fire(\"mouseleave\", {target: ctrl.getEl()});\n\t\t\t\t});\n\n\t\t\t\teventRootCtrl._lastHoverCtrl = null;\n\t\t\t}\n\t\t}\n\n\t\tfunction mouseEnterHandler(e) {\n\t\t\tvar ctrl = eventCtrl.getParentCtrl(e.target), lastCtrl = eventRootCtrl._lastHoverCtrl, idx = 0, i, parents, lastParents;\n\n\t\t\t// Over on a new control\n\t\t\tif (ctrl !== lastCtrl) {\n\t\t\t\teventRootCtrl._lastHoverCtrl = ctrl;\n\n\t\t\t\tparents = ctrl.parents().toArray().reverse();\n\t\t\t\tparents.push(ctrl);\n\n\t\t\t\tif (lastCtrl) {\n\t\t\t\t\tlastParents = lastCtrl.parents().toArray().reverse();\n\t\t\t\t\tlastParents.push(lastCtrl);\n\n\t\t\t\t\tfor (idx = 0; idx < lastParents.length; idx++) {\n\t\t\t\t\t\tif (parents[idx] !== lastParents[idx]) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (i = lastParents.length - 1; i >= idx; i--) {\n\t\t\t\t\t\tlastCtrl = lastParents[i];\n\t\t\t\t\t\tlastCtrl.fire(\"mouseleave\", {\n\t\t\t\t\t\t\ttarget: lastCtrl.getEl()\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfor (i = idx; i < parents.length; i++) {\n\t\t\t\t\tctrl = parents[i];\n\t\t\t\t\tctrl.fire(\"mouseenter\", {\n\t\t\t\t\t\ttarget: ctrl.getEl()\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction fixWheelEvent(e) {\n\t\t\te.preventDefault();\n\n\t\t\tif (e.type == \"mousewheel\") {\n\t\t\t\te.deltaY = -1 / 40 * e.wheelDelta;\n\n\t\t\t\tif (e.wheelDeltaX) {\n\t\t\t\t\te.deltaX = -1 / 40 * e.wheelDeltaX;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\te.deltaX = 0;\n\t\t\t\te.deltaY = e.detail;\n\t\t\t}\n\n\t\t\te = eventCtrl.fire(\"wheel\", e);\n\t\t}\n\n\t\tnativeEvents = eventCtrl._nativeEvents;\n\t\tif (nativeEvents) {\n\t\t\t// Find event root element if it exists\n\t\t\tparents = eventCtrl.parents().toArray();\n\t\t\tparents.unshift(eventCtrl);\n\t\t\tfor (i = 0, l = parents.length; !eventRootCtrl && i < l; i++) {\n\t\t\t\teventRootCtrl = parents[i]._eventsRoot;\n\t\t\t}\n\n\t\t\t// Event root wasn't found the use the root control\n\t\t\tif (!eventRootCtrl) {\n\t\t\t\teventRootCtrl = parents[parents.length - 1] || eventCtrl;\n\t\t\t}\n\n\t\t\t// Set the eventsRoot property on children that didn't have it\n\t\t\teventCtrl._eventsRoot = eventRootCtrl;\n\t\t\tfor (l = i, i = 0; i < l; i++) {\n\t\t\t\tparents[i]._eventsRoot = eventRootCtrl;\n\t\t\t}\n\n\t\t\tvar eventRootDelegates = eventRootCtrl._delegates;\n\t\t\tif (!eventRootDelegates) {\n\t\t\t\teventRootDelegates = eventRootCtrl._delegates = {};\n\t\t\t}\n\n\t\t\t// Bind native event delegates\n\t\t\tfor (name in nativeEvents) {\n\t\t\t\tif (!nativeEvents) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (name === \"wheel\" && !hasWheelEventSupport) {\n\t\t\t\t\tif (hasMouseWheelEventSupport) {\n\t\t\t\t\t\t$(eventCtrl.getEl()).on(\"mousewheel\", fixWheelEvent);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$(eventCtrl.getEl()).on(\"DOMMouseScroll\", fixWheelEvent);\n\t\t\t\t\t}\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Special treatment for mousenter/mouseleave since these doesn't bubble\n\t\t\t\tif (name === \"mouseenter\" || name === \"mouseleave\") {\n\t\t\t\t\t// Fake mousenter/mouseleave\n\t\t\t\t\tif (!eventRootCtrl._hasMouseEnter) {\n\t\t\t\t\t\t$(eventRootCtrl.getEl()).on(\"mouseleave\", mouseLeaveHandler).on(\"mouseover\", mouseEnterHandler);\n\t\t\t\t\t\teventRootCtrl._hasMouseEnter = 1;\n\t\t\t\t\t}\n\t\t\t\t} else if (!eventRootDelegates[name]) {\n\t\t\t\t\t$(eventRootCtrl.getEl()).on(name, delegate);\n\t\t\t\t\teventRootDelegates[name] = true;\n\t\t\t\t}\n\n\t\t\t\t// Remove the event once it's bound\n\t\t\t\tnativeEvents[name] = false;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn Control;\n});\n\n// Included from: js/tinymce/classes/ui/Factory.js\n\n/**\n * Factory.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/*global tinymce:true */\n\n/**\n * This class is a factory for control instances. This enables you\n * to create instances of controls without having to require the UI controls directly.\n *\n * It also allow you to override or add new control types.\n *\n * @class tinymce.ui.Factory\n */\ndefine(\"tinymce/ui/Factory\", [], function() {\n\t\"use strict\";\n\n\tvar types = {}, namespaceInit;\n\n\treturn {\n\t\t/**\n\t\t * Adds a new control instance type to the factory.\n\t\t *\n\t\t * @method add\n\t\t * @param {String} type Type name for example \"button\".\n\t\t * @param {function} typeClass Class type function.\n\t\t */\n\t\tadd: function(type, typeClass) {\n\t\t\ttypes[type.toLowerCase()] = typeClass;\n\t\t},\n\n\t\t/**\n\t\t * Returns true/false if the specified type exists or not.\n\t\t *\n\t\t * @method has\n\t\t * @param {String} type Type to look for.\n\t\t * @return {Boolean} true/false if the control by name exists.\n\t\t */\n\t\thas: function(type) {\n\t\t\treturn !!types[type.toLowerCase()];\n\t\t},\n\n\t\t/**\n\t\t * Creates a new control instance based on the settings provided. The instance created will be\n\t\t * based on the specified type property it can also create whole structures of components out of\n\t\t * the specified JSON object.\n\t\t *\n\t\t * @example\n\t\t * tinymce.ui.Factory.create({\n\t\t *     type: 'button',\n\t\t *     text: 'Hello world!'\n\t\t * });\n\t\t *\n\t\t * @method create\n\t\t * @param {Object/String} settings Name/Value object with items used to create the type.\n\t\t * @return {tinymce.ui.Control} Control instance based on the specified type.\n\t\t */\n\t\tcreate: function(type, settings) {\n\t\t\tvar ControlType, name, namespace;\n\n\t\t\t// Build type lookup\n\t\t\tif (!namespaceInit) {\n\t\t\t\tnamespace = tinymce.ui;\n\n\t\t\t\tfor (name in namespace) {\n\t\t\t\t\ttypes[name.toLowerCase()] = namespace[name];\n\t\t\t\t}\n\n\t\t\t\tnamespaceInit = true;\n\t\t\t}\n\n\t\t\t// If string is specified then use it as the type\n\t\t\tif (typeof type == 'string') {\n\t\t\t\tsettings = settings || {};\n\t\t\t\tsettings.type = type;\n\t\t\t} else {\n\t\t\t\tsettings = type;\n\t\t\t\ttype = settings.type;\n\t\t\t}\n\n\t\t\t// Find control type\n\t\t\ttype = type.toLowerCase();\n\t\t\tControlType = types[type];\n\n\t\t\t// #if debug\n\n\t\t\tif (!ControlType) {\n\t\t\t\tthrow new Error(\"Could not find control by type: \" + type);\n\t\t\t}\n\n\t\t\t// #endif\n\n\t\t\tControlType = new ControlType(settings);\n\t\t\tControlType.type = type; // Set the type on the instance, this will be used by the Selector engine\n\n\t\t\treturn ControlType;\n\t\t}\n\t};\n});\n\n// Included from: js/tinymce/classes/ui/KeyboardNavigation.js\n\n/**\n * KeyboardNavigation.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class handles keyboard navigation of controls and elements.\n *\n * @class tinymce.ui.KeyboardNavigation\n */\ndefine(\"tinymce/ui/KeyboardNavigation\", [\n], function() {\n\t\"use strict\";\n\n\t/**\n\t * This class handles all keyboard navigation for WAI-ARIA support. Each root container\n\t * gets an instance of this class.\n\t *\n\t * @constructor\n\t */\n\treturn function(settings) {\n\t\tvar root = settings.root, focusedElement, focusedControl;\n\n\t\tfunction isElement(node) {\n\t\t\treturn node && node.nodeType === 1;\n\t\t}\n\n\t\ttry {\n\t\t\tfocusedElement = document.activeElement;\n\t\t} catch (ex) {\n\t\t\t// IE sometimes fails to return a proper element\n\t\t\tfocusedElement = document.body;\n\t\t}\n\n\t\tfocusedControl = root.getParentCtrl(focusedElement);\n\n\t\t/**\n\t\t * Returns the currently focused elements wai aria role of the currently\n\t\t * focused element or specified element.\n\t\t *\n\t\t * @private\n\t\t * @param {Element} elm Optional element to get role from.\n\t\t * @return {String} Role of specified element.\n\t\t */\n\t\tfunction getRole(elm) {\n\t\t\telm = elm || focusedElement;\n\n\t\t\tif (isElement(elm)) {\n\t\t\t\treturn elm.getAttribute('role');\n\t\t\t}\n\n\t\t\treturn null;\n\t\t}\n\n\t\t/**\n\t\t * Returns the wai role of the parent element of the currently\n\t\t * focused element or specified element.\n\t\t *\n\t\t * @private\n\t\t * @param {Element} elm Optional element to get parent role from.\n\t\t * @return {String} Role of the first parent that has a role.\n\t\t */\n\t\tfunction getParentRole(elm) {\n\t\t\tvar role, parent = elm || focusedElement;\n\n\t\t\twhile ((parent = parent.parentNode)) {\n\t\t\t\tif ((role = getRole(parent))) {\n\t\t\t\t\treturn role;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Returns a wai aria property by name for example aria-selected.\n\t\t *\n\t\t * @private\n\t\t * @param {String} name Name of the aria property to get for example \"disabled\".\n\t\t * @return {String} Aria property value.\n\t\t */\n\t\tfunction getAriaProp(name) {\n\t\t\tvar elm = focusedElement;\n\n\t\t\tif (isElement(elm)) {\n\t\t\t\treturn elm.getAttribute('aria-' + name);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Is the element a text input element or not.\n\t\t *\n\t\t * @private\n\t\t * @param {Element} elm Element to check if it's an text input element or not.\n\t\t * @return {Boolean} True/false if the element is a text element or not.\n\t\t */\n\t\tfunction isTextInputElement(elm) {\n\t\t\tvar tagName = elm.tagName.toUpperCase();\n\n\t\t\t// Notice: since type can be \"email\" etc we don't check the type\n\t\t\t// So all input elements gets treated as text input elements\n\t\t\treturn tagName == \"INPUT\" || tagName == \"TEXTAREA\" || tagName == \"SELECT\";\n\t\t}\n\n\t\t/**\n\t\t * Returns true/false if the specified element can be focused or not.\n\t\t *\n\t\t * @private\n\t\t * @param {Element} elm DOM element to check if it can be focused or not.\n\t\t * @return {Boolean} True/false if the element can have focus.\n\t\t */\n\t\tfunction canFocus(elm) {\n\t\t\tif (isTextInputElement(elm) && !elm.hidden) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (/^(button|menuitem|checkbox|tab|menuitemcheckbox|option|gridcell|slider)$/.test(getRole(elm))) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\t/**\n\t\t * Returns an array of focusable visible elements within the specified container element.\n\t\t *\n\t\t * @private\n\t\t * @param {Element} elm DOM element to find focusable elements within.\n\t\t * @return {Array} Array of focusable elements.\n\t\t */\n\t\tfunction getFocusElements(elm) {\n\t\t\tvar elements = [];\n\n\t\t\tfunction collect(elm) {\n\t\t\t\tif (elm.nodeType != 1 || elm.style.display == 'none' || elm.disabled) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (canFocus(elm)) {\n\t\t\t\t\telements.push(elm);\n\t\t\t\t}\n\n\t\t\t\tfor (var i = 0; i < elm.childNodes.length; i++) {\n\t\t\t\t\tcollect(elm.childNodes[i]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcollect(elm || root.getEl());\n\n\t\t\treturn elements;\n\t\t}\n\n\t\t/**\n\t\t * Returns the navigation root control for the specified control. The navigation root\n\t\t * is the control that the keyboard navigation gets scoped to for example a menubar or toolbar group.\n\t\t * It will look for parents of the specified target control or the currently focused control if this option is omitted.\n\t\t *\n\t\t * @private\n\t\t * @param {tinymce.ui.Control} targetControl Optional target control to find root of.\n\t\t * @return {tinymce.ui.Control} Navigation root control.\n\t\t */\n\t\tfunction getNavigationRoot(targetControl) {\n\t\t\tvar navigationRoot, controls;\n\n\t\t\ttargetControl = targetControl || focusedControl;\n\t\t\tcontrols = targetControl.parents().toArray();\n\t\t\tcontrols.unshift(targetControl);\n\n\t\t\tfor (var i = 0; i < controls.length; i++) {\n\t\t\t\tnavigationRoot = controls[i];\n\n\t\t\t\tif (navigationRoot.settings.ariaRoot) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn navigationRoot;\n\t\t}\n\n\t\t/**\n\t\t * Focuses the first item in the specified targetControl element or the last aria index if the\n\t\t * navigation root has the ariaRemember option enabled.\n\t\t *\n\t\t * @private\n\t\t * @param {tinymce.ui.Control} targetControl Target control to focus the first item in.\n\t\t */\n\t\tfunction focusFirst(targetControl) {\n\t\t\tvar navigationRoot = getNavigationRoot(targetControl);\n\t\t\tvar focusElements = getFocusElements(navigationRoot.getEl());\n\n\t\t\tif (navigationRoot.settings.ariaRemember && \"lastAriaIndex\" in navigationRoot) {\n\t\t\t\tmoveFocusToIndex(navigationRoot.lastAriaIndex, focusElements);\n\t\t\t} else {\n\t\t\t\tmoveFocusToIndex(0, focusElements);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Moves the focus to the specified index within the elements list.\n\t\t * This will scope the index to the size of the element list if it changed.\n\t\t *\n\t\t * @private\n\t\t * @param {Number} idx Specified index to move to.\n\t\t * @param {Array} elements Array with dom elements to move focus within.\n\t\t * @return {Number} Input index or a changed index if it was out of range.\n\t\t */\n\t\tfunction moveFocusToIndex(idx, elements) {\n\t\t\tif (idx < 0) {\n\t\t\t\tidx = elements.length - 1;\n\t\t\t} else if (idx >= elements.length) {\n\t\t\t\tidx = 0;\n\t\t\t}\n\n\t\t\tif (elements[idx]) {\n\t\t\t\telements[idx].focus();\n\t\t\t}\n\n\t\t\treturn idx;\n\t\t}\n\n\t\t/**\n\t\t * Moves the focus forwards or backwards.\n\t\t *\n\t\t * @private\n\t\t * @param {Number} dir Direction to move in positive means forward, negative means backwards.\n\t\t * @param {Array} elements Optional array of elements to move within defaults to the current navigation roots elements.\n\t\t */\n\t\tfunction moveFocus(dir, elements) {\n\t\t\tvar idx = -1, navigationRoot = getNavigationRoot();\n\n\t\t\telements = elements || getFocusElements(navigationRoot.getEl());\n\n\t\t\tfor (var i = 0; i < elements.length; i++) {\n\t\t\t\tif (elements[i] === focusedElement) {\n\t\t\t\t\tidx = i;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tidx += dir;\n\t\t\tnavigationRoot.lastAriaIndex = moveFocusToIndex(idx, elements);\n\t\t}\n\n\t\t/**\n\t\t * Moves the focus to the left this is called by the left key.\n\t\t *\n\t\t * @private\n\t\t */\n\t\tfunction left() {\n\t\t\tvar parentRole = getParentRole();\n\n\t\t\tif (parentRole == \"tablist\") {\n\t\t\t\tmoveFocus(-1, getFocusElements(focusedElement.parentNode));\n\t\t\t} else if (focusedControl.parent().submenu) {\n\t\t\t\tcancel();\n\t\t\t} else {\n\t\t\t\tmoveFocus(-1);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Moves the focus to the right this is called by the right key.\n\t\t *\n\t\t * @private\n\t\t */\n\t\tfunction right() {\n\t\t\tvar role = getRole(), parentRole = getParentRole();\n\n\t\t\tif (parentRole == \"tablist\") {\n\t\t\t\tmoveFocus(1, getFocusElements(focusedElement.parentNode));\n\t\t\t} else if (role == \"menuitem\" && parentRole == \"menu\" && getAriaProp('haspopup')) {\n\t\t\t\tenter();\n\t\t\t} else {\n\t\t\t\tmoveFocus(1);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Moves the focus to the up this is called by the up key.\n\t\t *\n\t\t * @private\n\t\t */\n\t\tfunction up() {\n\t\t\tmoveFocus(-1);\n\t\t}\n\n\t\t/**\n\t\t * Moves the focus to the up this is called by the down key.\n\t\t *\n\t\t * @private\n\t\t */\n\t\tfunction down() {\n\t\t\tvar role = getRole(), parentRole = getParentRole();\n\n\t\t\tif (role == \"menuitem\" && parentRole == \"menubar\") {\n\t\t\t\tenter();\n\t\t\t} else if (role == \"button\" && getAriaProp('haspopup')) {\n\t\t\t\tenter({key: 'down'});\n\t\t\t} else {\n\t\t\t\tmoveFocus(1);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Moves the focus to the next item or previous item depending on shift key.\n\t\t *\n\t\t * @private\n\t\t * @param {DOMEvent} e DOM event object.\n\t\t */\n\t\tfunction tab(e) {\n\t\t\tvar parentRole = getParentRole();\n\n\t\t\tif (parentRole == \"tablist\") {\n\t\t\t\tvar elm = getFocusElements(focusedControl.getEl('body'))[0];\n\n\t\t\t\tif (elm) {\n\t\t\t\t\telm.focus();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tmoveFocus(e.shiftKey ? -1 : 1);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Calls the cancel event on the currently focused control. This is normally done using the Esc key.\n\t\t *\n\t\t * @private\n\t\t */\n\t\tfunction cancel() {\n\t\t\tfocusedControl.fire('cancel');\n\t\t}\n\n\t\t/**\n\t\t * Calls the click event on the currently focused control. This is normally done using the Enter/Space keys.\n\t\t *\n\t\t * @private\n\t\t * @param {Object} aria Optional aria data to pass along with the enter event.\n\t\t */\n\t\tfunction enter(aria) {\n\t\t\taria = aria || {};\n\t\t\tfocusedControl.fire('click', {target: focusedElement, aria: aria});\n\t\t}\n\n\t\troot.on('keydown', function(e) {\n\t\t\tfunction handleNonTabOrEscEvent(e, handler) {\n\t\t\t\t// Ignore non tab keys for text elements\n\t\t\t\tif (isTextInputElement(focusedElement)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (getRole(focusedElement) === 'slider') {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (handler(e) !== false) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (e.isDefaultPrevented()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tswitch (e.keyCode) {\n\t\t\t\tcase 37: // DOM_VK_LEFT\n\t\t\t\t\thandleNonTabOrEscEvent(e, left);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 39: // DOM_VK_RIGHT\n\t\t\t\t\thandleNonTabOrEscEvent(e, right);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 38: // DOM_VK_UP\n\t\t\t\t\thandleNonTabOrEscEvent(e, up);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 40: // DOM_VK_DOWN\n\t\t\t\t\thandleNonTabOrEscEvent(e, down);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 27: // DOM_VK_ESCAPE\n\t\t\t\t\tcancel();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 14: // DOM_VK_ENTER\n\t\t\t\tcase 13: // DOM_VK_RETURN\n\t\t\t\tcase 32: // DOM_VK_SPACE\n\t\t\t\t\thandleNonTabOrEscEvent(e, enter);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 9: // DOM_VK_TAB\n\t\t\t\t\tif (tab(e) !== false) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\n\t\troot.on('focusin', function(e) {\n\t\t\tfocusedElement = e.target;\n\t\t\tfocusedControl = e.control;\n\t\t});\n\n\t\treturn {\n\t\t\tfocusFirst: focusFirst\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/ui/Container.js\n\n/**\n * Container.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Container control. This is extended by all controls that can have\n * children such as panels etc. You can also use this class directly as an\n * generic container instance. The container doesn't have any specific role or style.\n *\n * @-x-less Container.less\n * @class tinymce.ui.Container\n * @extends tinymce.ui.Control\n */\ndefine(\"tinymce/ui/Container\", [\n\t\"tinymce/ui/Control\",\n\t\"tinymce/ui/Collection\",\n\t\"tinymce/ui/Selector\",\n\t\"tinymce/ui/Factory\",\n\t\"tinymce/ui/KeyboardNavigation\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/dom/DomQuery\",\n\t\"tinymce/ui/ClassList\",\n\t\"tinymce/ui/ReflowQueue\"\n], function(Control, Collection, Selector, Factory, KeyboardNavigation, Tools, $, ClassList, ReflowQueue) {\n\t\"use strict\";\n\n\tvar selectorCache = {};\n\n\treturn Control.extend({\n\t\t/**\n\t\t * Constructs a new control instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t * @setting {Array} items Items to add to container in JSON format or control instances.\n\t\t * @setting {String} layout Layout manager by name to use.\n\t\t * @setting {Object} defaults Default settings to apply to all items.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tself._super(settings);\n\t\t\tsettings = self.settings;\n\n\t\t\tif (settings.fixed) {\n\t\t\t\tself.state.set('fixed', true);\n\t\t\t}\n\n\t\t\tself._items = new Collection();\n\n\t\t\tif (self.isRtl()) {\n\t\t\t\tself.classes.add('rtl');\n\t\t\t}\n\n\t\t\tself.bodyClasses = new ClassList(function() {\n\t\t\t\tif (self.state.get('rendered')) {\n\t\t\t\t\tself.getEl('body').className = this.toString();\n\t\t\t\t}\n\t\t\t});\n\t\t\tself.bodyClasses.prefix = self.classPrefix;\n\n\t\t\tself.classes.add('container');\n\t\t\tself.bodyClasses.add('container-body');\n\n\t\t\tif (settings.containerCls) {\n\t\t\t\tself.classes.add(settings.containerCls);\n\t\t\t}\n\n\t\t\tself._layout = Factory.create((settings.layout || '') + 'layout');\n\n\t\t\tif (self.settings.items) {\n\t\t\t\tself.add(self.settings.items);\n\t\t\t} else {\n\t\t\t\tself.add(self.render());\n\t\t\t}\n\n\t\t\t// TODO: Fix this!\n\t\t\tself._hasBody = true;\n\t\t},\n\n\t\t/**\n\t\t * Returns a collection of child items that the container currently have.\n\t\t *\n\t\t * @method items\n\t\t * @return {tinymce.ui.Collection} Control collection direct child controls.\n\t\t */\n\t\titems: function() {\n\t\t\treturn this._items;\n\t\t},\n\n\t\t/**\n\t\t * Find child controls by selector.\n\t\t *\n\t\t * @method find\n\t\t * @param {String} selector Selector CSS pattern to find children by.\n\t\t * @return {tinymce.ui.Collection} Control collection with child controls.\n\t\t */\n\t\tfind: function(selector) {\n\t\t\tselector = selectorCache[selector] = selectorCache[selector] || new Selector(selector);\n\n\t\t\treturn selector.find(this);\n\t\t},\n\n\t\t/**\n\t\t * Adds one or many items to the current container. This will create instances of\n\t\t * the object representations if needed.\n\t\t *\n\t\t * @method add\n\t\t * @param {Array/Object/tinymce.ui.Control} items Array or item that will be added to the container.\n\t\t * @return {tinymce.ui.Collection} Current collection control.\n\t\t */\n\t\tadd: function(items) {\n\t\t\tvar self = this;\n\n\t\t\tself.items().add(self.create(items)).parent(self);\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Focuses the current container instance. This will look\n\t\t * for the first control in the container and focus that.\n\t\t *\n\t\t * @method focus\n\t\t * @param {Boolean} keyboard Optional true/false if the focus was a keyboard focus or not.\n\t\t * @return {tinymce.ui.Collection} Current instance.\n\t\t */\n\t\tfocus: function(keyboard) {\n\t\t\tvar self = this, focusCtrl, keyboardNav, items;\n\n\t\t\tif (keyboard) {\n\t\t\t\tkeyboardNav = self.keyboardNav || self.parents().eq(-1)[0].keyboardNav;\n\n\t\t\t\tif (keyboardNav) {\n\t\t\t\t\tkeyboardNav.focusFirst(self);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\titems = self.find('*');\n\n\t\t\t// TODO: Figure out a better way to auto focus alert dialog buttons\n\t\t\tif (self.statusbar) {\n\t\t\t\titems.add(self.statusbar.items());\n\t\t\t}\n\n\t\t\titems.each(function(ctrl) {\n\t\t\t\tif (ctrl.settings.autofocus) {\n\t\t\t\t\tfocusCtrl = null;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (ctrl.canFocus) {\n\t\t\t\t\tfocusCtrl = focusCtrl || ctrl;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (focusCtrl) {\n\t\t\t\tfocusCtrl.focus();\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Replaces the specified child control with a new control.\n\t\t *\n\t\t * @method replace\n\t\t * @param {tinymce.ui.Control} oldItem Old item to be replaced.\n\t\t * @param {tinymce.ui.Control} newItem New item to be inserted.\n\t\t */\n\t\treplace: function(oldItem, newItem) {\n\t\t\tvar ctrlElm, items = this.items(), i = items.length;\n\n\t\t\t// Replace the item in collection\n\t\t\twhile (i--) {\n\t\t\t\tif (items[i] === oldItem) {\n\t\t\t\t\titems[i] = newItem;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (i >= 0) {\n\t\t\t\t// Remove new item from DOM\n\t\t\t\tctrlElm = newItem.getEl();\n\t\t\t\tif (ctrlElm) {\n\t\t\t\t\tctrlElm.parentNode.removeChild(ctrlElm);\n\t\t\t\t}\n\n\t\t\t\t// Remove old item from DOM\n\t\t\t\tctrlElm = oldItem.getEl();\n\t\t\t\tif (ctrlElm) {\n\t\t\t\t\tctrlElm.parentNode.removeChild(ctrlElm);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Adopt the item\n\t\t\tnewItem.parent(this);\n\t\t},\n\n\t\t/**\n\t\t * Creates the specified items. If any of the items is plain JSON style objects\n\t\t * it will convert these into real tinymce.ui.Control instances.\n\t\t *\n\t\t * @method create\n\t\t * @param {Array} items Array of items to convert into control instances.\n\t\t * @return {Array} Array with control instances.\n\t\t */\n\t\tcreate: function(items) {\n\t\t\tvar self = this, settings, ctrlItems = [];\n\n\t\t\t// Non array structure, then force it into an array\n\t\t\tif (!Tools.isArray(items)) {\n\t\t\t\titems = [items];\n\t\t\t}\n\n\t\t\t// Add default type to each child control\n\t\t\tTools.each(items, function(item) {\n\t\t\t\tif (item) {\n\t\t\t\t\t// Construct item if needed\n\t\t\t\t\tif (!(item instanceof Control)) {\n\t\t\t\t\t\t// Name only then convert it to an object\n\t\t\t\t\t\tif (typeof item == \"string\") {\n\t\t\t\t\t\t\titem = {type: item};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Create control instance based on input settings and default settings\n\t\t\t\t\t\tsettings = Tools.extend({}, self.settings.defaults, item);\n\t\t\t\t\t\titem.type = settings.type = settings.type || item.type || self.settings.defaultType ||\n\t\t\t\t\t\t\t(settings.defaults ? settings.defaults.type : null);\n\t\t\t\t\t\titem = Factory.create(settings);\n\t\t\t\t\t}\n\n\t\t\t\t\tctrlItems.push(item);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn ctrlItems;\n\t\t},\n\n\t\t/**\n\t\t * Renders new control instances.\n\t\t *\n\t\t * @private\n\t\t */\n\t\trenderNew: function() {\n\t\t\tvar self = this;\n\n\t\t\t// Render any new items\n\t\t\tself.items().each(function(ctrl, index) {\n\t\t\t\tvar containerElm;\n\n\t\t\t\tctrl.parent(self);\n\n\t\t\t\tif (!ctrl.state.get('rendered')) {\n\t\t\t\t\tcontainerElm = self.getEl('body');\n\n\t\t\t\t\t// Insert or append the item\n\t\t\t\t\tif (containerElm.hasChildNodes() && index <= containerElm.childNodes.length - 1) {\n\t\t\t\t\t\t$(containerElm.childNodes[index]).before(ctrl.renderHtml());\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$(containerElm).append(ctrl.renderHtml());\n\t\t\t\t\t}\n\n\t\t\t\t\tctrl.postRender();\n\t\t\t\t\tReflowQueue.add(ctrl);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself._layout.applyClasses(self.items().filter(':visible'));\n\t\t\tself._lastRect = null;\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Appends new instances to the current container.\n\t\t *\n\t\t * @method append\n\t\t * @param {Array/tinymce.ui.Collection} items Array if controls to append.\n\t\t * @return {tinymce.ui.Container} Current container instance.\n\t\t */\n\t\tappend: function(items) {\n\t\t\treturn this.add(items).renderNew();\n\t\t},\n\n\t\t/**\n\t\t * Prepends new instances to the current container.\n\t\t *\n\t\t * @method prepend\n\t\t * @param {Array/tinymce.ui.Collection} items Array if controls to prepend.\n\t\t * @return {tinymce.ui.Container} Current container instance.\n\t\t */\n\t\tprepend: function(items) {\n\t\t\tvar self = this;\n\n\t\t\tself.items().set(self.create(items).concat(self.items().toArray()));\n\n\t\t\treturn self.renderNew();\n\t\t},\n\n\t\t/**\n\t\t * Inserts an control at a specific index.\n\t\t *\n\t\t * @method insert\n\t\t * @param {Array/tinymce.ui.Collection} items Array if controls to insert.\n\t\t * @param {Number} index Index to insert controls at.\n\t\t * @param {Boolean} [before=false] Inserts controls before the index.\n\t\t */\n\t\tinsert: function(items, index, before) {\n\t\t\tvar self = this, curItems, beforeItems, afterItems;\n\n\t\t\titems = self.create(items);\n\t\t\tcurItems = self.items();\n\n\t\t\tif (!before && index < curItems.length - 1) {\n\t\t\t\tindex += 1;\n\t\t\t}\n\n\t\t\tif (index >= 0 && index < curItems.length) {\n\t\t\t\tbeforeItems = curItems.slice(0, index).toArray();\n\t\t\t\tafterItems = curItems.slice(index).toArray();\n\t\t\t\tcurItems.set(beforeItems.concat(items, afterItems));\n\t\t\t}\n\n\t\t\treturn self.renderNew();\n\t\t},\n\n\t\t/**\n\t\t * Populates the form fields from the specified JSON data object.\n\t\t *\n\t\t * Control items in the form that matches the data will have it's value set.\n\t\t *\n\t\t * @method fromJSON\n\t\t * @param {Object} data JSON data object to set control values by.\n\t\t * @return {tinymce.ui.Container} Current form instance.\n\t\t */\n\t\tfromJSON: function(data) {\n\t\t\tvar self = this;\n\n\t\t\tfor (var name in data) {\n\t\t\t\tself.find('#' + name).value(data[name]);\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Serializes the form into a JSON object by getting all items\n\t\t * that has a name and a value.\n\t\t *\n\t\t * @method toJSON\n\t\t * @return {Object} JSON object with form data.\n\t\t */\n\t\ttoJSON: function() {\n\t\t\tvar self = this, data = {};\n\n\t\t\tself.find('*').each(function(ctrl) {\n\t\t\t\tvar name = ctrl.name(), value = ctrl.value();\n\n\t\t\t\tif (name && typeof value != \"undefined\") {\n\t\t\t\t\tdata[name] = value;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn data;\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, layout = self._layout, role = this.settings.role;\n\n\t\t\tself.preRender();\n\t\t\tlayout.preRender(self);\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + self._id + '\" class=\"' + self.classes + '\"' + (role ? ' role=\"' + this.settings.role + '\"' : '') + '>' +\n\t\t\t\t\t'<div id=\"' + self._id + '-body\" class=\"' + self.bodyClasses + '\">' +\n\t\t\t\t\t\t(self.settings.html || '') + layout.renderHtml(self) +\n\t\t\t\t\t'</div>' +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Post render method. Called after the control has been rendered to the target.\n\t\t *\n\t\t * @method postRender\n\t\t * @return {tinymce.ui.Container} Current combobox instance.\n\t\t */\n\t\tpostRender: function() {\n\t\t\tvar self = this, box;\n\n\t\t\tself.items().exec('postRender');\n\t\t\tself._super();\n\n\t\t\tself._layout.postRender(self);\n\t\t\tself.state.set('rendered', true);\n\n\t\t\tif (self.settings.style) {\n\t\t\t\tself.$el.css(self.settings.style);\n\t\t\t}\n\n\t\t\tif (self.settings.border) {\n\t\t\t\tbox = self.borderBox;\n\t\t\t\tself.$el.css({\n\t\t\t\t\t'border-top-width': box.top,\n\t\t\t\t\t'border-right-width': box.right,\n\t\t\t\t\t'border-bottom-width': box.bottom,\n\t\t\t\t\t'border-left-width': box.left\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (!self.parent()) {\n\t\t\t\tself.keyboardNav = new KeyboardNavigation({\n\t\t\t\t\troot: self\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Initializes the current controls layout rect.\n\t\t * This will be executed by the layout managers to determine the\n\t\t * default minWidth/minHeight etc.\n\t\t *\n\t\t * @method initLayoutRect\n\t\t * @return {Object} Layout rect instance.\n\t\t */\n\t\tinitLayoutRect: function() {\n\t\t\tvar self = this, layoutRect = self._super();\n\n\t\t\t// Recalc container size by asking layout manager\n\t\t\tself._layout.recalc(self);\n\n\t\t\treturn layoutRect;\n\t\t},\n\n\t\t/**\n\t\t * Recalculates the positions of the controls in the current container.\n\t\t * This is invoked by the reflow method and shouldn't be called directly.\n\t\t *\n\t\t * @method recalc\n\t\t */\n\t\trecalc: function() {\n\t\t\tvar self = this, rect = self._layoutRect, lastRect = self._lastRect;\n\n\t\t\tif (!lastRect || lastRect.w != rect.w || lastRect.h != rect.h) {\n\t\t\t\tself._layout.recalc(self);\n\t\t\t\trect = self.layoutRect();\n\t\t\t\tself._lastRect = {x: rect.x, y: rect.y, w: rect.w, h: rect.h};\n\t\t\t\treturn true;\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Reflows the current container and it's children and possible parents.\n\t\t * This should be used after you for example append children to the current control so\n\t\t * that the layout managers know that they need to reposition everything.\n\t\t *\n\t\t * @example\n\t\t * container.append({type: 'button', text: 'My button'}).reflow();\n\t\t *\n\t\t * @method reflow\n\t\t * @return {tinymce.ui.Container} Current container instance.\n\t\t */\n\t\treflow: function() {\n\t\t\tvar i;\n\n\t\t\tReflowQueue.remove(this);\n\n\t\t\tif (this.visible()) {\n\t\t\t\tControl.repaintControls = [];\n\t\t\t\tControl.repaintControls.map = {};\n\n\t\t\t\tthis.recalc();\n\t\t\t\ti = Control.repaintControls.length;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tControl.repaintControls[i].repaint();\n\t\t\t\t}\n\n\t\t\t\t// TODO: Fix me!\n\t\t\t\tif (this.settings.layout !== \"flow\" && this.settings.layout !== \"stack\") {\n\t\t\t\t\tthis.repaint();\n\t\t\t\t}\n\n\t\t\t\tControl.repaintControls = [];\n\t\t\t}\n\n\t\t\treturn this;\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/DragHelper.js\n\n/**\n * DragHelper.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Drag/drop helper class.\n *\n * @example\n * var dragHelper = new tinymce.ui.DragHelper('mydiv', {\n *     start: function(evt) {\n *     },\n *\n *     drag: function(evt) {\n *     },\n *\n *     end: function(evt) {\n *     }\n * });\n *\n * @class tinymce.ui.DragHelper\n */\ndefine(\"tinymce/ui/DragHelper\", [\n\t\"tinymce/dom/DomQuery\"\n], function($) {\n\t\"use strict\";\n\n\tfunction getDocumentSize(doc) {\n\t\tvar documentElement, body, scrollWidth, clientWidth;\n\t\tvar offsetWidth, scrollHeight, clientHeight, offsetHeight, max = Math.max;\n\n\t\tdocumentElement = doc.documentElement;\n\t\tbody = doc.body;\n\n\t\tscrollWidth = max(documentElement.scrollWidth, body.scrollWidth);\n\t\tclientWidth = max(documentElement.clientWidth, body.clientWidth);\n\t\toffsetWidth = max(documentElement.offsetWidth, body.offsetWidth);\n\n\t\tscrollHeight = max(documentElement.scrollHeight, body.scrollHeight);\n\t\tclientHeight = max(documentElement.clientHeight, body.clientHeight);\n\t\toffsetHeight = max(documentElement.offsetHeight, body.offsetHeight);\n\n\t\treturn {\n\t\t\twidth: scrollWidth < offsetWidth ? clientWidth : scrollWidth,\n\t\t\theight: scrollHeight < offsetHeight ? clientHeight : scrollHeight\n\t\t};\n\t}\n\n\tfunction updateWithTouchData(e) {\n\t\tvar keys, i;\n\n\t\tif (e.changedTouches) {\n\t\t\tkeys = \"screenX screenY pageX pageY clientX clientY\".split(' ');\n\t\t\tfor (i = 0; i < keys.length; i++) {\n\t\t\t\te[keys[i]] = e.changedTouches[0][keys[i]];\n\t\t\t}\n\t\t}\n\t}\n\n\treturn function(id, settings) {\n\t\tvar $eventOverlay, doc = settings.document || document, downButton, start, stop, drag, startX, startY;\n\n\t\tsettings = settings || {};\n\n\t\tfunction getHandleElm() {\n\t\t\treturn doc.getElementById(settings.handle || id);\n\t\t}\n\n\t\tstart = function(e) {\n\t\t\tvar docSize = getDocumentSize(doc), handleElm, cursor;\n\n\t\t\tupdateWithTouchData(e);\n\n\t\t\te.preventDefault();\n\t\t\tdownButton = e.button;\n\t\t\thandleElm = getHandleElm();\n\t\t\tstartX = e.screenX;\n\t\t\tstartY = e.screenY;\n\n\t\t\t// Grab cursor from handle so we can place it on overlay\n\t\t\tif (window.getComputedStyle) {\n\t\t\t\tcursor = window.getComputedStyle(handleElm, null).getPropertyValue(\"cursor\");\n\t\t\t} else {\n\t\t\t\tcursor = handleElm.runtimeStyle.cursor;\n\t\t\t}\n\n\t\t\t$eventOverlay = $('<div></div>').css({\n\t\t\t\tposition: \"absolute\",\n\t\t\t\ttop: 0, left: 0,\n\t\t\t\twidth: docSize.width,\n\t\t\t\theight: docSize.height,\n\t\t\t\tzIndex: 0x7FFFFFFF,\n\t\t\t\topacity: 0.0001,\n\t\t\t\tcursor: cursor\n\t\t\t}).appendTo(doc.body);\n\n\t\t\t$(doc).on('mousemove touchmove', drag).on('mouseup touchend', stop);\n\n\t\t\tsettings.start(e);\n\t\t};\n\n\t\tdrag = function(e) {\n\t\t\tupdateWithTouchData(e);\n\n\t\t\tif (e.button !== downButton) {\n\t\t\t\treturn stop(e);\n\t\t\t}\n\n\t\t\te.deltaX = e.screenX - startX;\n\t\t\te.deltaY = e.screenY - startY;\n\n\t\t\te.preventDefault();\n\t\t\tsettings.drag(e);\n\t\t};\n\n\t\tstop = function(e) {\n\t\t\tupdateWithTouchData(e);\n\n\t\t\t$(doc).off('mousemove touchmove', drag).off('mouseup touchend', stop);\n\n\t\t\t$eventOverlay.remove();\n\n\t\t\tif (settings.stop) {\n\t\t\t\tsettings.stop(e);\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Destroys the drag/drop helper instance.\n\t\t *\n\t\t * @method destroy\n\t\t */\n\t\tthis.destroy = function() {\n\t\t\t$(getHandleElm()).off();\n\t\t};\n\n\t\t$(getHandleElm()).on('mousedown touchstart', start);\n\t};\n});\n\n// Included from: js/tinymce/classes/ui/Scrollable.js\n\n/**\n * Scrollable.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This mixin makes controls scrollable using custom scrollbars.\n *\n * @-x-less Scrollable.less\n * @mixin tinymce.ui.Scrollable\n */\ndefine(\"tinymce/ui/Scrollable\", [\n\t\"tinymce/dom/DomQuery\",\n\t\"tinymce/ui/DragHelper\"\n], function($, DragHelper) {\n\t\"use strict\";\n\n\treturn {\n\t\tinit: function() {\n\t\t\tvar self = this;\n\t\t\tself.on('repaint', self.renderScroll);\n\t\t},\n\n\t\trenderScroll: function() {\n\t\t\tvar self = this, margin = 2;\n\n\t\t\tfunction repaintScroll() {\n\t\t\t\tvar hasScrollH, hasScrollV, bodyElm;\n\n\t\t\t\tfunction repaintAxis(axisName, posName, sizeName, contentSizeName, hasScroll, ax) {\n\t\t\t\t\tvar containerElm, scrollBarElm, scrollThumbElm;\n\t\t\t\t\tvar containerSize, scrollSize, ratio, rect;\n\t\t\t\t\tvar posNameLower, sizeNameLower;\n\n\t\t\t\t\tscrollBarElm = self.getEl('scroll' + axisName);\n\t\t\t\t\tif (scrollBarElm) {\n\t\t\t\t\t\tposNameLower = posName.toLowerCase();\n\t\t\t\t\t\tsizeNameLower = sizeName.toLowerCase();\n\n\t\t\t\t\t\t$(self.getEl('absend')).css(posNameLower, self.layoutRect()[contentSizeName] - 1);\n\n\t\t\t\t\t\tif (!hasScroll) {\n\t\t\t\t\t\t\t$(scrollBarElm).css('display', 'none');\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$(scrollBarElm).css('display', 'block');\n\t\t\t\t\t\tcontainerElm = self.getEl('body');\n\t\t\t\t\t\tscrollThumbElm = self.getEl('scroll' + axisName + \"t\");\n\t\t\t\t\t\tcontainerSize = containerElm[\"client\" + sizeName] - (margin * 2);\n\t\t\t\t\t\tcontainerSize -= hasScrollH && hasScrollV ? scrollBarElm[\"client\" + ax] : 0;\n\t\t\t\t\t\tscrollSize = containerElm[\"scroll\" + sizeName];\n\t\t\t\t\t\tratio = containerSize / scrollSize;\n\n\t\t\t\t\t\trect = {};\n\t\t\t\t\t\trect[posNameLower] = containerElm[\"offset\" + posName] + margin;\n\t\t\t\t\t\trect[sizeNameLower] = containerSize;\n\t\t\t\t\t\t$(scrollBarElm).css(rect);\n\n\t\t\t\t\t\trect = {};\n\t\t\t\t\t\trect[posNameLower] = containerElm[\"scroll\" + posName] * ratio;\n\t\t\t\t\t\trect[sizeNameLower] = containerSize * ratio;\n\t\t\t\t\t\t$(scrollThumbElm).css(rect);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tbodyElm = self.getEl('body');\n\t\t\t\thasScrollH = bodyElm.scrollWidth > bodyElm.clientWidth;\n\t\t\t\thasScrollV = bodyElm.scrollHeight > bodyElm.clientHeight;\n\n\t\t\t\trepaintAxis(\"h\", \"Left\", \"Width\", \"contentW\", hasScrollH, \"Height\");\n\t\t\t\trepaintAxis(\"v\", \"Top\", \"Height\", \"contentH\", hasScrollV, \"Width\");\n\t\t\t}\n\n\t\t\tfunction addScroll() {\n\t\t\t\tfunction addScrollAxis(axisName, posName, sizeName, deltaPosName, ax) {\n\t\t\t\t\tvar scrollStart, axisId = self._id + '-scroll' + axisName, prefix = self.classPrefix;\n\n\t\t\t\t\t$(self.getEl()).append(\n\t\t\t\t\t\t'<div id=\"' + axisId + '\" class=\"' + prefix + 'scrollbar ' + prefix + 'scrollbar-' + axisName + '\">' +\n\t\t\t\t\t\t\t'<div id=\"' + axisId + 't\" class=\"' + prefix + 'scrollbar-thumb\"></div>' +\n\t\t\t\t\t\t'</div>'\n\t\t\t\t\t);\n\n\t\t\t\t\tself.draghelper = new DragHelper(axisId + 't', {\n\t\t\t\t\t\tstart: function() {\n\t\t\t\t\t\t\tscrollStart = self.getEl('body')[\"scroll\" + posName];\n\t\t\t\t\t\t\t$('#' + axisId).addClass(prefix + 'active');\n\t\t\t\t\t\t},\n\n\t\t\t\t\t\tdrag: function(e) {\n\t\t\t\t\t\t\tvar ratio, hasScrollH, hasScrollV, containerSize, layoutRect = self.layoutRect();\n\n\t\t\t\t\t\t\thasScrollH = layoutRect.contentW > layoutRect.innerW;\n\t\t\t\t\t\t\thasScrollV = layoutRect.contentH > layoutRect.innerH;\n\t\t\t\t\t\t\tcontainerSize = self.getEl('body')[\"client\" + sizeName] - (margin * 2);\n\t\t\t\t\t\t\tcontainerSize -= hasScrollH && hasScrollV ? self.getEl('scroll' + axisName)[\"client\" + ax] : 0;\n\n\t\t\t\t\t\t\tratio = containerSize / self.getEl('body')[\"scroll\" + sizeName];\n\t\t\t\t\t\t\tself.getEl('body')[\"scroll\" + posName] = scrollStart + (e[\"delta\" + deltaPosName] / ratio);\n\t\t\t\t\t\t},\n\n\t\t\t\t\t\tstop: function() {\n\t\t\t\t\t\t\t$('#' + axisId).removeClass(prefix + 'active');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tself.classes.add('scroll');\n\n\t\t\t\taddScrollAxis(\"v\", \"Top\", \"Height\", \"Y\", \"Width\");\n\t\t\t\taddScrollAxis(\"h\", \"Left\", \"Width\", \"X\", \"Height\");\n\t\t\t}\n\n\t\t\tif (self.settings.autoScroll) {\n\t\t\t\tif (!self._hasScroll) {\n\t\t\t\t\tself._hasScroll = true;\n\t\t\t\t\taddScroll();\n\n\t\t\t\t\tself.on('wheel', function(e) {\n\t\t\t\t\t\tvar bodyEl = self.getEl('body');\n\n\t\t\t\t\t\tbodyEl.scrollLeft += (e.deltaX || 0) * 10;\n\t\t\t\t\t\tbodyEl.scrollTop += e.deltaY * 10;\n\n\t\t\t\t\t\trepaintScroll();\n\t\t\t\t\t});\n\n\t\t\t\t\t$(self.getEl('body')).on(\"scroll\", repaintScroll);\n\t\t\t\t}\n\n\t\t\t\trepaintScroll();\n\t\t\t}\n\t\t}\n\t};\n});\n\n// Included from: js/tinymce/classes/ui/Panel.js\n\n/**\n * Panel.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a new panel.\n *\n * @-x-less Panel.less\n * @class tinymce.ui.Panel\n * @extends tinymce.ui.Container\n * @mixes tinymce.ui.Scrollable\n */\ndefine(\"tinymce/ui/Panel\", [\n\t\"tinymce/ui/Container\",\n\t\"tinymce/ui/Scrollable\"\n], function(Container, Scrollable) {\n\t\"use strict\";\n\n\treturn Container.extend({\n\t\tDefaults: {\n\t\t\tlayout: 'fit',\n\t\t\tcontainerCls: 'panel'\n\t\t},\n\n\t\tMixins: [Scrollable],\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, layout = self._layout, innerHtml = self.settings.html;\n\n\t\t\tself.preRender();\n\t\t\tlayout.preRender(self);\n\n\t\t\tif (typeof innerHtml == \"undefined\") {\n\t\t\t\tinnerHtml = (\n\t\t\t\t\t'<div id=\"' + self._id + '-body\" class=\"' + self.bodyClasses + '\">' +\n\t\t\t\t\t\tlayout.renderHtml(self) +\n\t\t\t\t\t'</div>'\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tif (typeof innerHtml == 'function') {\n\t\t\t\t\tinnerHtml = innerHtml.call(self);\n\t\t\t\t}\n\n\t\t\t\tself._hasBody = false;\n\t\t\t}\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + self._id + '\" class=\"' + self.classes + '\" hidefocus=\"1\" tabindex=\"-1\" role=\"group\">' +\n\t\t\t\t\t(self._preBodyHtml || '') +\n\t\t\t\t\tinnerHtml +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/Movable.js\n\n/**\n * Movable.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Movable mixin. Makes controls movable absolute and relative to other elements.\n *\n * @mixin tinymce.ui.Movable\n */\ndefine(\"tinymce/ui/Movable\", [\n\t\"tinymce/ui/DomUtils\"\n], function(DomUtils) {\n\t\"use strict\";\n\n\tfunction calculateRelativePosition(ctrl, targetElm, rel) {\n\t\tvar ctrlElm, pos, x, y, selfW, selfH, targetW, targetH, viewport, size;\n\n\t\tviewport = DomUtils.getViewPort();\n\n\t\t// Get pos of target\n\t\tpos = DomUtils.getPos(targetElm);\n\t\tx = pos.x;\n\t\ty = pos.y;\n\n\t\tif (ctrl.state.get('fixed') && DomUtils.getRuntimeStyle(document.body, 'position') == 'static') {\n\t\t\tx -= viewport.x;\n\t\t\ty -= viewport.y;\n\t\t}\n\n\t\t// Get size of self\n\t\tctrlElm = ctrl.getEl();\n\t\tsize = DomUtils.getSize(ctrlElm);\n\t\tselfW = size.width;\n\t\tselfH = size.height;\n\n\t\t// Get size of target\n\t\tsize = DomUtils.getSize(targetElm);\n\t\ttargetW = size.width;\n\t\ttargetH = size.height;\n\n\t\t// Parse align string\n\t\trel = (rel || '').split('');\n\n\t\t// Target corners\n\t\tif (rel[0] === 'b') {\n\t\t\ty += targetH;\n\t\t}\n\n\t\tif (rel[1] === 'r') {\n\t\t\tx += targetW;\n\t\t}\n\n\t\tif (rel[0] === 'c') {\n\t\t\ty += Math.round(targetH / 2);\n\t\t}\n\n\t\tif (rel[1] === 'c') {\n\t\t\tx += Math.round(targetW / 2);\n\t\t}\n\n\t\t// Self corners\n\t\tif (rel[3] === 'b') {\n\t\t\ty -= selfH;\n\t\t}\n\n\t\tif (rel[4] === 'r') {\n\t\t\tx -= selfW;\n\t\t}\n\n\t\tif (rel[3] === 'c') {\n\t\t\ty -= Math.round(selfH / 2);\n\t\t}\n\n\t\tif (rel[4] === 'c') {\n\t\t\tx -= Math.round(selfW / 2);\n\t\t}\n\n\t\treturn {\n\t\t\tx: x,\n\t\t\ty: y,\n\t\t\tw: selfW,\n\t\t\th: selfH\n\t\t};\n\t}\n\n\treturn {\n\t\t/**\n\t\t * Tests various positions to get the most suitable one.\n\t\t *\n\t\t * @method testMoveRel\n\t\t * @param {DOMElement} elm Element to position against.\n\t\t * @param {Array} rels Array with relative positions.\n\t\t * @return {String} Best suitable relative position.\n\t\t */\n\t\ttestMoveRel: function(elm, rels) {\n\t\t\tvar viewPortRect = DomUtils.getViewPort();\n\n\t\t\tfor (var i = 0; i < rels.length; i++) {\n\t\t\t\tvar pos = calculateRelativePosition(this, elm, rels[i]);\n\n\t\t\t\tif (this.state.get('fixed')) {\n\t\t\t\t\tif (pos.x > 0 && pos.x + pos.w < viewPortRect.w && pos.y > 0 && pos.y + pos.h < viewPortRect.h) {\n\t\t\t\t\t\treturn rels[i];\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (pos.x > viewPortRect.x && pos.x + pos.w < viewPortRect.w + viewPortRect.x &&\n\t\t\t\t\t\tpos.y > viewPortRect.y && pos.y + pos.h < viewPortRect.h + viewPortRect.y) {\n\t\t\t\t\t\treturn rels[i];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn rels[0];\n\t\t},\n\n\t\t/**\n\t\t * Move relative to the specified element.\n\t\t *\n\t\t * @method moveRel\n\t\t * @param {Element} elm Element to move relative to.\n\t\t * @param {String} rel Relative mode. For example: br-tl.\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\tmoveRel: function(elm, rel) {\n\t\t\tif (typeof rel != 'string') {\n\t\t\t\trel = this.testMoveRel(elm, rel);\n\t\t\t}\n\n\t\t\tvar pos = calculateRelativePosition(this, elm, rel);\n\t\t\treturn this.moveTo(pos.x, pos.y);\n\t\t},\n\n\t\t/**\n\t\t * Move by a relative x, y values.\n\t\t *\n\t\t * @method moveBy\n\t\t * @param {Number} dx Relative x position.\n\t\t * @param {Number} dy Relative y position.\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\tmoveBy: function(dx, dy) {\n\t\t\tvar self = this, rect = self.layoutRect();\n\n\t\t\tself.moveTo(rect.x + dx, rect.y + dy);\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Move to absolute position.\n\t\t *\n\t\t * @method moveTo\n\t\t * @param {Number} x Absolute x position.\n\t\t * @param {Number} y Absolute y position.\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\tmoveTo: function(x, y) {\n\t\t\tvar self = this;\n\n\t\t\t// TODO: Move this to some global class\n\t\t\tfunction constrain(value, max, size) {\n\t\t\t\tif (value < 0) {\n\t\t\t\t\treturn 0;\n\t\t\t\t}\n\n\t\t\t\tif (value + size > max) {\n\t\t\t\t\tvalue = max - size;\n\t\t\t\t\treturn value < 0 ? 0 : value;\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t}\n\n\t\t\tif (self.settings.constrainToViewport) {\n\t\t\t\tvar viewPortRect = DomUtils.getViewPort(window);\n\t\t\t\tvar layoutRect = self.layoutRect();\n\n\t\t\t\tx = constrain(x, viewPortRect.w + viewPortRect.x, layoutRect.w);\n\t\t\t\ty = constrain(y, viewPortRect.h + viewPortRect.y, layoutRect.h);\n\t\t\t}\n\n\t\t\tif (self.state.get('rendered')) {\n\t\t\t\tself.layoutRect({x: x, y: y}).repaint();\n\t\t\t} else {\n\t\t\t\tself.settings.x = x;\n\t\t\t\tself.settings.y = y;\n\t\t\t}\n\n\t\t\tself.fire('move', {x: x, y: y});\n\n\t\t\treturn self;\n\t\t}\n\t};\n});\n\n// Included from: js/tinymce/classes/ui/Resizable.js\n\n/**\n * Resizable.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Resizable mixin. Enables controls to be resized.\n *\n * @mixin tinymce.ui.Resizable\n */\ndefine(\"tinymce/ui/Resizable\", [\n\t\"tinymce/ui/DomUtils\"\n], function(DomUtils) {\n\t\"use strict\";\n\n\treturn {\n\t\t/**\n\t\t * Resizes the control to contents.\n\t\t *\n\t\t * @method resizeToContent\n\t\t */\n\t\tresizeToContent: function() {\n\t\t\tthis._layoutRect.autoResize = true;\n\t\t\tthis._lastRect = null;\n\t\t\tthis.reflow();\n\t\t},\n\n\t\t/**\n\t\t * Resizes the control to a specific width/height.\n\t\t *\n\t\t * @method resizeTo\n\t\t * @param {Number} w Control width.\n\t\t * @param {Number} h Control height.\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\tresizeTo: function(w, h) {\n\t\t\t// TODO: Fix hack\n\t\t\tif (w <= 1 || h <= 1) {\n\t\t\t\tvar rect = DomUtils.getWindowSize();\n\n\t\t\t\tw = w <= 1 ? w * rect.w : w;\n\t\t\t\th = h <= 1 ? h * rect.h : h;\n\t\t\t}\n\n\t\t\tthis._layoutRect.autoResize = false;\n\t\t\treturn this.layoutRect({minW: w, minH: h, w: w, h: h}).reflow();\n\t\t},\n\n\t\t/**\n\t\t * Resizes the control to a specific relative width/height.\n\t\t *\n\t\t * @method resizeBy\n\t\t * @param {Number} dw Relative control width.\n\t\t * @param {Number} dh Relative control height.\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\tresizeBy: function(dw, dh) {\n\t\t\tvar self = this, rect = self.layoutRect();\n\n\t\t\treturn self.resizeTo(rect.w + dw, rect.h + dh);\n\t\t}\n\t};\n});\n\n// Included from: js/tinymce/classes/ui/FloatPanel.js\n\n/**\n * FloatPanel.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class creates a floating panel.\n *\n * @-x-less FloatPanel.less\n * @class tinymce.ui.FloatPanel\n * @extends tinymce.ui.Panel\n * @mixes tinymce.ui.Movable\n * @mixes tinymce.ui.Resizable\n */\ndefine(\"tinymce/ui/FloatPanel\", [\n\t\"tinymce/ui/Panel\",\n\t\"tinymce/ui/Movable\",\n\t\"tinymce/ui/Resizable\",\n\t\"tinymce/ui/DomUtils\",\n\t\"tinymce/dom/DomQuery\",\n\t\"tinymce/util/Delay\"\n], function(Panel, Movable, Resizable, DomUtils, $, Delay) {\n\t\"use strict\";\n\n\tvar documentClickHandler, documentScrollHandler, windowResizeHandler, visiblePanels = [];\n\tvar zOrder = [], hasModal;\n\n\tfunction isChildOf(ctrl, parent) {\n\t\twhile (ctrl) {\n\t\t\tif (ctrl == parent) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tctrl = ctrl.parent();\n\t\t}\n\t}\n\n\tfunction skipOrHidePanels(e) {\n\t\t// Hide any float panel when a click/focus out is out side that float panel and the\n\t\t// float panels direct parent for example a click on a menu button\n\t\tvar i = visiblePanels.length;\n\n\t\twhile (i--) {\n\t\t\tvar panel = visiblePanels[i], clickCtrl = panel.getParentCtrl(e.target);\n\n\t\t\tif (panel.settings.autohide) {\n\t\t\t\tif (clickCtrl) {\n\t\t\t\t\tif (isChildOf(clickCtrl, panel) || panel.parent() === clickCtrl) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\te = panel.fire('autohide', {target: e.target});\n\t\t\t\tif (!e.isDefaultPrevented()) {\n\t\t\t\t\tpanel.hide();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction bindDocumentClickHandler() {\n\n\t\tif (!documentClickHandler) {\n\t\t\tdocumentClickHandler = function(e) {\n\t\t\t\t// Gecko fires click event and in the wrong order on Mac so lets normalize\n\t\t\t\tif (e.button == 2) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tskipOrHidePanels(e);\n\t\t\t};\n\n\t\t\t$(document).on('click touchstart', documentClickHandler);\n\t\t}\n\t}\n\n\tfunction bindDocumentScrollHandler() {\n\t\tif (!documentScrollHandler) {\n\t\t\tdocumentScrollHandler = function() {\n\t\t\t\tvar i;\n\n\t\t\t\ti = visiblePanels.length;\n\t\t\t\twhile (i--) {\n\t\t\t\t\trepositionPanel(visiblePanels[i]);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t$(window).on('scroll', documentScrollHandler);\n\t\t}\n\t}\n\n\tfunction bindWindowResizeHandler() {\n\t\tif (!windowResizeHandler) {\n\t\t\tvar docElm = document.documentElement, clientWidth = docElm.clientWidth, clientHeight = docElm.clientHeight;\n\n\t\t\twindowResizeHandler = function() {\n\t\t\t\t// Workaround for #7065 IE 7 fires resize events event though the window wasn't resized\n\t\t\t\tif (!document.all || clientWidth != docElm.clientWidth || clientHeight != docElm.clientHeight) {\n\t\t\t\t\tclientWidth = docElm.clientWidth;\n\t\t\t\t\tclientHeight = docElm.clientHeight;\n\t\t\t\t\tFloatPanel.hideAll();\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t$(window).on('resize', windowResizeHandler);\n\t\t}\n\t}\n\n\t/**\n\t * Repositions the panel to the top of page if the panel is outside of the visual viewport. It will\n\t * also reposition all child panels of the current panel.\n\t */\n\tfunction repositionPanel(panel) {\n\t\tvar scrollY = DomUtils.getViewPort().y;\n\n\t\tfunction toggleFixedChildPanels(fixed, deltaY) {\n\t\t\tvar parent;\n\n\t\t\tfor (var i = 0; i < visiblePanels.length; i++) {\n\t\t\t\tif (visiblePanels[i] != panel) {\n\t\t\t\t\tparent = visiblePanels[i].parent();\n\n\t\t\t\t\twhile (parent && (parent = parent.parent())) {\n\t\t\t\t\t\tif (parent == panel) {\n\t\t\t\t\t\t\tvisiblePanels[i].fixed(fixed).moveBy(0, deltaY).repaint();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (panel.settings.autofix) {\n\t\t\tif (!panel.state.get('fixed')) {\n\t\t\t\tpanel._autoFixY = panel.layoutRect().y;\n\n\t\t\t\tif (panel._autoFixY < scrollY) {\n\t\t\t\t\tpanel.fixed(true).layoutRect({y: 0}).repaint();\n\t\t\t\t\ttoggleFixedChildPanels(true, scrollY - panel._autoFixY);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (panel._autoFixY > scrollY) {\n\t\t\t\t\tpanel.fixed(false).layoutRect({y: panel._autoFixY}).repaint();\n\t\t\t\t\ttoggleFixedChildPanels(false, panel._autoFixY - scrollY);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction addRemove(add, ctrl) {\n\t\tvar i, zIndex = FloatPanel.zIndex || 0xFFFF, topModal;\n\n\t\tif (add) {\n\t\t\tzOrder.push(ctrl);\n\t\t} else {\n\t\t\ti = zOrder.length;\n\n\t\t\twhile (i--) {\n\t\t\t\tif (zOrder[i] === ctrl) {\n\t\t\t\t\tzOrder.splice(i, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (zOrder.length) {\n\t\t\tfor (i = 0; i < zOrder.length; i++) {\n\t\t\t\tif (zOrder[i].modal) {\n\t\t\t\t\tzIndex++;\n\t\t\t\t\ttopModal = zOrder[i];\n\t\t\t\t}\n\n\t\t\t\tzOrder[i].getEl().style.zIndex = zIndex;\n\t\t\t\tzOrder[i].zIndex = zIndex;\n\t\t\t\tzIndex++;\n\t\t\t}\n\t\t}\n\n\t\tvar modalBlockEl = $('#' + ctrl.classPrefix + 'modal-block', ctrl.getContainerElm())[0];\n\n\t\tif (topModal) {\n\t\t\t$(modalBlockEl).css('z-index', topModal.zIndex - 1);\n\t\t} else if (modalBlockEl) {\n\t\t\tmodalBlockEl.parentNode.removeChild(modalBlockEl);\n\t\t\thasModal = false;\n\t\t}\n\n\t\tFloatPanel.currentZIndex = zIndex;\n\t}\n\n\tvar FloatPanel = Panel.extend({\n\t\tMixins: [Movable, Resizable],\n\n\t\t/**\n\t\t * Constructs a new control instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t * @setting {Boolean} autohide Automatically hide the panel.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tself._super(settings);\n\t\t\tself._eventsRoot = self;\n\n\t\t\tself.classes.add('floatpanel');\n\n\t\t\t// Hide floatpanes on click out side the root button\n\t\t\tif (settings.autohide) {\n\t\t\t\tbindDocumentClickHandler();\n\t\t\t\tbindWindowResizeHandler();\n\t\t\t\tvisiblePanels.push(self);\n\t\t\t}\n\n\t\t\tif (settings.autofix) {\n\t\t\t\tbindDocumentScrollHandler();\n\n\t\t\t\tself.on('move', function() {\n\t\t\t\t\trepositionPanel(this);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tself.on('postrender show', function(e) {\n\t\t\t\tif (e.control == self) {\n\t\t\t\t\tvar $modalBlockEl, prefix = self.classPrefix;\n\n\t\t\t\t\tif (self.modal && !hasModal) {\n\t\t\t\t\t\t$modalBlockEl = $('#' + prefix + 'modal-block', self.getContainerElm());\n\t\t\t\t\t\tif (!$modalBlockEl[0]) {\n\t\t\t\t\t\t\t$modalBlockEl = $(\n\t\t\t\t\t\t\t\t'<div id=\"' + prefix + 'modal-block\" class=\"' + prefix + 'reset ' + prefix + 'fade\"></div>'\n\t\t\t\t\t\t\t).appendTo(self.getContainerElm());\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tDelay.setTimeout(function() {\n\t\t\t\t\t\t\t$modalBlockEl.addClass(prefix + 'in');\n\t\t\t\t\t\t\t$(self.getEl()).addClass(prefix + 'in');\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\thasModal = true;\n\t\t\t\t\t}\n\n\t\t\t\t\taddRemove(true, self);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.on('show', function() {\n\t\t\t\tself.parents().each(function(ctrl) {\n\t\t\t\t\tif (ctrl.state.get('fixed')) {\n\t\t\t\t\t\tself.fixed(true);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tif (settings.popover) {\n\t\t\t\tself._preBodyHtml = '<div class=\"' + self.classPrefix + 'arrow\"></div>';\n\t\t\t\tself.classes.add('popover').add('bottom').add(self.isRtl() ? 'end' : 'start');\n\t\t\t}\n\n\t\t\tself.aria('label', settings.ariaLabel);\n\t\t\tself.aria('labelledby', self._id);\n\t\t\tself.aria('describedby', self.describedBy || self._id + '-none');\n\t\t},\n\n\t\tfixed: function(state) {\n\t\t\tvar self = this;\n\n\t\t\tif (self.state.get('fixed') != state) {\n\t\t\t\tif (self.state.get('rendered')) {\n\t\t\t\t\tvar viewport = DomUtils.getViewPort();\n\n\t\t\t\t\tif (state) {\n\t\t\t\t\t\tself.layoutRect().y -= viewport.y;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.layoutRect().y += viewport.y;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tself.classes.toggle('fixed', state);\n\t\t\t\tself.state.set('fixed', state);\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Shows the current float panel.\n\t\t *\n\t\t * @method show\n\t\t * @return {tinymce.ui.FloatPanel} Current floatpanel instance.\n\t\t */\n\t\tshow: function() {\n\t\t\tvar self = this, i, state = self._super();\n\n\t\t\ti = visiblePanels.length;\n\t\t\twhile (i--) {\n\t\t\t\tif (visiblePanels[i] === self) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (i === -1) {\n\t\t\t\tvisiblePanels.push(self);\n\t\t\t}\n\n\t\t\treturn state;\n\t\t},\n\n\t\t/**\n\t\t * Hides the current float panel.\n\t\t *\n\t\t * @method hide\n\t\t * @return {tinymce.ui.FloatPanel} Current floatpanel instance.\n\t\t */\n\t\thide: function() {\n\t\t\tremoveVisiblePanel(this);\n\t\t\taddRemove(false, this);\n\n\t\t\treturn this._super();\n\t\t},\n\n\t\t/**\n\t\t * Hide all visible float panels with he autohide setting enabled. This is for\n\t\t * manually hiding floating menus or panels.\n\t\t *\n\t\t * @method hideAll\n\t\t */\n\t\thideAll: function() {\n\t\t\tFloatPanel.hideAll();\n\t\t},\n\n\t\t/**\n\t\t * Closes the float panel. This will remove the float panel from page and fire the close event.\n\t\t *\n\t\t * @method close\n\t\t */\n\t\tclose: function() {\n\t\t\tvar self = this;\n\n\t\t\tif (!self.fire('close').isDefaultPrevented()) {\n\t\t\t\tself.remove();\n\t\t\t\taddRemove(false, self);\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Removes the float panel from page.\n\t\t *\n\t\t * @method remove\n\t\t */\n\t\tremove: function() {\n\t\t\tremoveVisiblePanel(this);\n\t\t\tthis._super();\n\t\t},\n\n\t\tpostRender: function() {\n\t\t\tvar self = this;\n\n\t\t\tif (self.settings.bodyRole) {\n\t\t\t\tthis.getEl('body').setAttribute('role', self.settings.bodyRole);\n\t\t\t}\n\n\t\t\treturn self._super();\n\t\t}\n\t});\n\n\t/**\n\t * Hide all visible float panels with he autohide setting enabled. This is for\n\t * manually hiding floating menus or panels.\n\t *\n\t * @static\n\t * @method hideAll\n\t */\n\tFloatPanel.hideAll = function() {\n\t\tvar i = visiblePanels.length;\n\n\t\twhile (i--) {\n\t\t\tvar panel = visiblePanels[i];\n\n\t\t\tif (panel && panel.settings.autohide) {\n\t\t\t\tpanel.hide();\n\t\t\t\tvisiblePanels.splice(i, 1);\n\t\t\t}\n\t\t}\n\t};\n\n\tfunction removeVisiblePanel(panel) {\n\t\tvar i;\n\n\t\ti = visiblePanels.length;\n\t\twhile (i--) {\n\t\t\tif (visiblePanels[i] === panel) {\n\t\t\t\tvisiblePanels.splice(i, 1);\n\t\t\t}\n\t\t}\n\n\t\ti = zOrder.length;\n\t\twhile (i--) {\n\t\t\tif (zOrder[i] === panel) {\n\t\t\t\tzOrder.splice(i, 1);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn FloatPanel;\n});\n\n// Included from: js/tinymce/classes/ui/Window.js\n\n/**\n * Window.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a new window.\n *\n * @-x-less Window.less\n * @class tinymce.ui.Window\n * @extends tinymce.ui.FloatPanel\n */\ndefine(\"tinymce/ui/Window\", [\n\t\"tinymce/ui/FloatPanel\",\n\t\"tinymce/ui/Panel\",\n\t\"tinymce/ui/DomUtils\",\n\t\"tinymce/dom/DomQuery\",\n\t\"tinymce/ui/DragHelper\",\n\t\"tinymce/ui/BoxUtils\",\n\t\"tinymce/Env\",\n\t\"tinymce/util/Delay\"\n], function(FloatPanel, Panel, DomUtils, $, DragHelper, BoxUtils, Env, Delay) {\n\t\"use strict\";\n\n\tvar windows = [], oldMetaValue = '';\n\n\tfunction toggleFullScreenState(state) {\n\t\tvar noScaleMetaValue = 'width=device-width,initial-scale=1.0,user-scalable=0,minimum-scale=1.0,maximum-scale=1.0',\n\t\t\tviewport = $(\"meta[name=viewport]\")[0],\n\t\t\tcontentValue;\n\n\t\tif (Env.overrideViewPort === false) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!viewport) {\n\t\t\tviewport = document.createElement('meta');\n\t\t\tviewport.setAttribute('name', 'viewport');\n\t\t\tdocument.getElementsByTagName('head')[0].appendChild(viewport);\n\t\t}\n\n\t\tcontentValue = viewport.getAttribute('content');\n\t\tif (contentValue && typeof oldMetaValue != 'undefined') {\n\t\t\toldMetaValue = contentValue;\n\t\t}\n\n\t\tviewport.setAttribute('content', state ? noScaleMetaValue : oldMetaValue);\n\t}\n\n\tfunction toggleBodyFullScreenClasses(classPrefix, state) {\n\t\tif (checkFullscreenWindows() && state === false) {\n\t\t\t$([document.documentElement, document.body]).removeClass(classPrefix + 'fullscreen');\n\t\t}\n\t}\n\n\tfunction checkFullscreenWindows() {\n\t\tfor (var i = 0; i < windows.length; i++) {\n\t\t\tif (windows[i]._fullscreen) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tfunction handleWindowResize() {\n\t\tif (!Env.desktop) {\n\t\t\tvar lastSize = {\n\t\t\t\tw: window.innerWidth,\n\t\t\t\th: window.innerHeight\n\t\t\t};\n\n\t\t\tDelay.setInterval(function() {\n\t\t\t\tvar w = window.innerWidth,\n\t\t\t\t\th = window.innerHeight;\n\n\t\t\t\tif (lastSize.w != w || lastSize.h != h) {\n\t\t\t\t\tlastSize = {\n\t\t\t\t\t\tw: w,\n\t\t\t\t\t\th: h\n\t\t\t\t\t};\n\n\t\t\t\t\t$(window).trigger('resize');\n\t\t\t\t}\n\t\t\t}, 100);\n\t\t}\n\n\t\tfunction reposition() {\n\t\t\tvar i, rect = DomUtils.getWindowSize(), layoutRect;\n\n\t\t\tfor (i = 0; i < windows.length; i++) {\n\t\t\t\tlayoutRect = windows[i].layoutRect();\n\n\t\t\t\twindows[i].moveTo(\n\t\t\t\t\twindows[i].settings.x || Math.max(0, rect.w / 2 - layoutRect.w / 2),\n\t\t\t\t\twindows[i].settings.y || Math.max(0, rect.h / 2 - layoutRect.h / 2)\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\t$(window).on('resize', reposition);\n\t}\n\n\tvar Window = FloatPanel.extend({\n\t\tmodal: true,\n\n\t\tDefaults: {\n\t\t\tborder: 1,\n\t\t\tlayout: 'flex',\n\t\t\tcontainerCls: 'panel',\n\t\t\trole: 'dialog',\n\t\t\tcallbacks: {\n\t\t\t\tsubmit: function() {\n\t\t\t\t\tthis.fire('submit', {data: this.toJSON()});\n\t\t\t\t},\n\n\t\t\t\tclose: function() {\n\t\t\t\t\tthis.close();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Constructs a instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tself._super(settings);\n\n\t\t\tif (self.isRtl()) {\n\t\t\t\tself.classes.add('rtl');\n\t\t\t}\n\n\t\t\tself.classes.add('window');\n\t\t\tself.bodyClasses.add('window-body');\n\t\t\tself.state.set('fixed', true);\n\n\t\t\t// Create statusbar\n\t\t\tif (settings.buttons) {\n\t\t\t\tself.statusbar = new Panel({\n\t\t\t\t\tlayout: 'flex',\n\t\t\t\t\tborder: '1 0 0 0',\n\t\t\t\t\tspacing: 3,\n\t\t\t\t\tpadding: 10,\n\t\t\t\t\talign: 'center',\n\t\t\t\t\tpack: self.isRtl() ? 'start' : 'end',\n\t\t\t\t\tdefaults: {\n\t\t\t\t\t\ttype: 'button'\n\t\t\t\t\t},\n\t\t\t\t\titems: settings.buttons\n\t\t\t\t});\n\n\t\t\t\tself.statusbar.classes.add('foot');\n\t\t\t\tself.statusbar.parent(self);\n\t\t\t}\n\n\t\t\tself.on('click', function(e) {\n\t\t\t\tvar closeClass = self.classPrefix + 'close';\n\n\t\t\t\tif (DomUtils.hasClass(e.target, closeClass) || DomUtils.hasClass(e.target.parentNode, closeClass)) {\n\t\t\t\t\tself.close();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.on('cancel', function() {\n\t\t\t\tself.close();\n\t\t\t});\n\n\t\t\tself.aria('describedby', self.describedBy || self._id + '-none');\n\t\t\tself.aria('label', settings.title);\n\t\t\tself._fullscreen = false;\n\t\t},\n\n\t\t/**\n\t\t * Recalculates the positions of the controls in the current container.\n\t\t * This is invoked by the reflow method and shouldn't be called directly.\n\t\t *\n\t\t * @method recalc\n\t\t */\n\t\trecalc: function() {\n\t\t\tvar self = this, statusbar = self.statusbar, layoutRect, width, x, needsRecalc;\n\n\t\t\tif (self._fullscreen) {\n\t\t\t\tself.layoutRect(DomUtils.getWindowSize());\n\t\t\t\tself.layoutRect().contentH = self.layoutRect().innerH;\n\t\t\t}\n\n\t\t\tself._super();\n\n\t\t\tlayoutRect = self.layoutRect();\n\n\t\t\t// Resize window based on title width\n\t\t\tif (self.settings.title && !self._fullscreen) {\n\t\t\t\twidth = layoutRect.headerW;\n\t\t\t\tif (width > layoutRect.w) {\n\t\t\t\t\tx = layoutRect.x - Math.max(0, width / 2);\n\t\t\t\t\tself.layoutRect({w: width, x: x});\n\t\t\t\t\tneedsRecalc = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Resize window based on statusbar width\n\t\t\tif (statusbar) {\n\t\t\t\tstatusbar.layoutRect({w: self.layoutRect().innerW}).recalc();\n\n\t\t\t\twidth = statusbar.layoutRect().minW + layoutRect.deltaW;\n\t\t\t\tif (width > layoutRect.w) {\n\t\t\t\t\tx = layoutRect.x - Math.max(0, width - layoutRect.w);\n\t\t\t\t\tself.layoutRect({w: width, x: x});\n\t\t\t\t\tneedsRecalc = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Recalc body and disable auto resize\n\t\t\tif (needsRecalc) {\n\t\t\t\tself.recalc();\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Initializes the current controls layout rect.\n\t\t * This will be executed by the layout managers to determine the\n\t\t * default minWidth/minHeight etc.\n\t\t *\n\t\t * @method initLayoutRect\n\t\t * @return {Object} Layout rect instance.\n\t\t */\n\t\tinitLayoutRect: function() {\n\t\t\tvar self = this, layoutRect = self._super(), deltaH = 0, headEl;\n\n\t\t\t// Reserve vertical space for title\n\t\t\tif (self.settings.title && !self._fullscreen) {\n\t\t\t\theadEl = self.getEl('head');\n\n\t\t\t\tvar size = DomUtils.getSize(headEl);\n\n\t\t\t\tlayoutRect.headerW = size.width;\n\t\t\t\tlayoutRect.headerH = size.height;\n\n\t\t\t\tdeltaH += layoutRect.headerH;\n\t\t\t}\n\n\t\t\t// Reserve vertical space for statusbar\n\t\t\tif (self.statusbar) {\n\t\t\t\tdeltaH += self.statusbar.layoutRect().h;\n\t\t\t}\n\n\t\t\tlayoutRect.deltaH += deltaH;\n\t\t\tlayoutRect.minH += deltaH;\n\t\t\t//layoutRect.innerH -= deltaH;\n\t\t\tlayoutRect.h += deltaH;\n\n\t\t\tvar rect = DomUtils.getWindowSize();\n\n\t\t\tlayoutRect.x = self.settings.x || Math.max(0, rect.w / 2 - layoutRect.w / 2);\n\t\t\tlayoutRect.y = self.settings.y || Math.max(0, rect.h / 2 - layoutRect.h / 2);\n\n\t\t\treturn layoutRect;\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, layout = self._layout, id = self._id, prefix = self.classPrefix;\n\t\t\tvar settings = self.settings, headerHtml = '', footerHtml = '', html = settings.html;\n\n\t\t\tself.preRender();\n\t\t\tlayout.preRender(self);\n\n\t\t\tif (settings.title) {\n\t\t\t\theaderHtml = (\n\t\t\t\t\t'<div id=\"' + id + '-head\" class=\"' + prefix + 'window-head\">' +\n\t\t\t\t\t\t'<div id=\"' + id + '-title\" class=\"' + prefix + 'title\">' + self.encode(settings.title) + '</div>' +\n\t\t\t\t\t\t'<div id=\"' + id + '-dragh\" class=\"' + prefix + 'dragh\"></div>' +\n\t\t\t\t\t\t'<button type=\"button\" class=\"' + prefix + 'close\" aria-hidden=\"true\">' +\n\t\t\t\t\t\t\t'<i class=\"mce-ico mce-i-remove\"></i>' +\n\t\t\t\t\t\t'</button>' +\n\t\t\t\t\t'</div>'\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (settings.url) {\n\t\t\t\thtml = '<iframe src=\"' + settings.url + '\" tabindex=\"-1\"></iframe>';\n\t\t\t}\n\n\t\t\tif (typeof html == \"undefined\") {\n\t\t\t\thtml = layout.renderHtml(self);\n\t\t\t}\n\n\t\t\tif (self.statusbar) {\n\t\t\t\tfooterHtml = self.statusbar.renderHtml();\n\t\t\t}\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + id + '\" class=\"' + self.classes + '\" hidefocus=\"1\">' +\n\t\t\t\t\t'<div class=\"' + self.classPrefix + 'reset\" role=\"application\">' +\n\t\t\t\t\t\theaderHtml +\n\t\t\t\t\t\t'<div id=\"' + id + '-body\" class=\"' + self.bodyClasses + '\">' +\n\t\t\t\t\t\t\thtml +\n\t\t\t\t\t\t'</div>' +\n\t\t\t\t\t\tfooterHtml +\n\t\t\t\t\t'</div>' +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Switches the window fullscreen mode.\n\t\t *\n\t\t * @method fullscreen\n\t\t * @param {Boolean} state True/false state.\n\t\t * @return {tinymce.ui.Window} Current window instance.\n\t\t */\n\t\tfullscreen: function(state) {\n\t\t\tvar self = this, documentElement = document.documentElement, slowRendering, prefix = self.classPrefix, layoutRect;\n\n\t\t\tif (state != self._fullscreen) {\n\t\t\t\t$(window).on('resize', function() {\n\t\t\t\t\tvar time;\n\n\t\t\t\t\tif (self._fullscreen) {\n\t\t\t\t\t\t// Time the layout time if it's to slow use a timeout to not hog the CPU\n\t\t\t\t\t\tif (!slowRendering) {\n\t\t\t\t\t\t\ttime = new Date().getTime();\n\n\t\t\t\t\t\t\tvar rect = DomUtils.getWindowSize();\n\t\t\t\t\t\t\tself.moveTo(0, 0).resizeTo(rect.w, rect.h);\n\n\t\t\t\t\t\t\tif ((new Date().getTime()) - time > 50) {\n\t\t\t\t\t\t\t\tslowRendering = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (!self._timer) {\n\t\t\t\t\t\t\t\tself._timer = Delay.setTimeout(function() {\n\t\t\t\t\t\t\t\t\tvar rect = DomUtils.getWindowSize();\n\t\t\t\t\t\t\t\t\tself.moveTo(0, 0).resizeTo(rect.w, rect.h);\n\n\t\t\t\t\t\t\t\t\tself._timer = 0;\n\t\t\t\t\t\t\t\t}, 50);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tlayoutRect = self.layoutRect();\n\t\t\t\tself._fullscreen = state;\n\n\t\t\t\tif (!state) {\n\t\t\t\t\tself.borderBox = BoxUtils.parseBox(self.settings.border);\n\t\t\t\t\tself.getEl('head').style.display = '';\n\t\t\t\t\tlayoutRect.deltaH += layoutRect.headerH;\n\t\t\t\t\t$([documentElement, document.body]).removeClass(prefix + 'fullscreen');\n\t\t\t\t\tself.classes.remove('fullscreen');\n\t\t\t\t\tself.moveTo(self._initial.x, self._initial.y).resizeTo(self._initial.w, self._initial.h);\n\t\t\t\t} else {\n\t\t\t\t\tself._initial = {x: layoutRect.x, y: layoutRect.y, w: layoutRect.w, h: layoutRect.h};\n\n\t\t\t\t\tself.borderBox = BoxUtils.parseBox('0');\n\t\t\t\t\tself.getEl('head').style.display = 'none';\n\t\t\t\t\tlayoutRect.deltaH -= layoutRect.headerH + 2;\n\t\t\t\t\t$([documentElement, document.body]).addClass(prefix + 'fullscreen');\n\t\t\t\t\tself.classes.add('fullscreen');\n\n\t\t\t\t\tvar rect = DomUtils.getWindowSize();\n\t\t\t\t\tself.moveTo(0, 0).resizeTo(rect.w, rect.h);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn self.reflow();\n\t\t},\n\n\t\t/**\n\t\t * Called after the control has been rendered.\n\t\t *\n\t\t * @method postRender\n\t\t */\n\t\tpostRender: function() {\n\t\t\tvar self = this, startPos;\n\n\t\t\tsetTimeout(function() {\n\t\t\t\tself.classes.add('in');\n\t\t\t\tself.fire('open');\n\t\t\t}, 0);\n\n\t\t\tself._super();\n\n\t\t\tif (self.statusbar) {\n\t\t\t\tself.statusbar.postRender();\n\t\t\t}\n\n\t\t\tself.focus();\n\n\t\t\tthis.dragHelper = new DragHelper(self._id + '-dragh', {\n\t\t\t\tstart: function() {\n\t\t\t\t\tstartPos = {\n\t\t\t\t\t\tx: self.layoutRect().x,\n\t\t\t\t\t\ty: self.layoutRect().y\n\t\t\t\t\t};\n\t\t\t\t},\n\n\t\t\t\tdrag: function(e) {\n\t\t\t\t\tself.moveTo(startPos.x + e.deltaX, startPos.y + e.deltaY);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.on('submit', function(e) {\n\t\t\t\tif (!e.isDefaultPrevented()) {\n\t\t\t\t\tself.close();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\twindows.push(self);\n\t\t\ttoggleFullScreenState(true);\n\t\t},\n\n\t\t/**\n\t\t * Fires a submit event with the serialized form.\n\t\t *\n\t\t * @method submit\n\t\t * @return {Object} Event arguments object.\n\t\t */\n\t\tsubmit: function() {\n\t\t\treturn this.fire('submit', {data: this.toJSON()});\n\t\t},\n\n\t\t/**\n\t\t * Removes the current control from DOM and from UI collections.\n\t\t *\n\t\t * @method remove\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\tremove: function() {\n\t\t\tvar self = this, i;\n\n\t\t\tself.dragHelper.destroy();\n\t\t\tself._super();\n\n\t\t\tif (self.statusbar) {\n\t\t\t\tthis.statusbar.remove();\n\t\t\t}\n\n\t\t\ttoggleBodyFullScreenClasses(self.classPrefix, false);\n\n\t\t\ti = windows.length;\n\t\t\twhile (i--) {\n\t\t\t\tif (windows[i] === self) {\n\t\t\t\t\twindows.splice(i, 1);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ttoggleFullScreenState(windows.length > 0);\n\t\t},\n\n\t\t/**\n\t\t * Returns the contentWindow object of the iframe if it exists.\n\t\t *\n\t\t * @method getContentWindow\n\t\t * @return {Window} window object or null.\n\t\t */\n\t\tgetContentWindow: function() {\n\t\t\tvar ifr = this.getEl().getElementsByTagName('iframe')[0];\n\t\t\treturn ifr ? ifr.contentWindow : null;\n\t\t}\n\t});\n\n\thandleWindowResize();\n\n\treturn Window;\n});\n\n// Included from: js/tinymce/classes/ui/MessageBox.js\n\n/**\n * MessageBox.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class is used to create MessageBoxes like alerts/confirms etc.\n *\n * @class tinymce.ui.MessageBox\n * @extends tinymce.ui.FloatPanel\n */\ndefine(\"tinymce/ui/MessageBox\", [\n\t\"tinymce/ui/Window\"\n], function(Window) {\n\t\"use strict\";\n\n\tvar MessageBox = Window.extend({\n\t\t/**\n\t\t * Constructs a instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tsettings = {\n\t\t\t\tborder: 1,\n\t\t\t\tpadding: 20,\n\t\t\t\tlayout: 'flex',\n\t\t\t\tpack: \"center\",\n\t\t\t\talign: \"center\",\n\t\t\t\tcontainerCls: 'panel',\n\t\t\t\tautoScroll: true,\n\t\t\t\tbuttons: {type: \"button\", text: \"Ok\", action: \"ok\"},\n\t\t\t\titems: {\n\t\t\t\t\ttype: \"label\",\n\t\t\t\t\tmultiline: true,\n\t\t\t\t\tmaxWidth: 500,\n\t\t\t\t\tmaxHeight: 200\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis._super(settings);\n\t\t},\n\n\t\tStatics: {\n\t\t\t/**\n\t\t\t * Ok buttons constant.\n\t\t\t *\n\t\t\t * @static\n\t\t\t * @final\n\t\t\t * @field {Number} OK\n\t\t\t */\n\t\t\tOK: 1,\n\n\t\t\t/**\n\t\t\t * Ok/cancel buttons constant.\n\t\t\t *\n\t\t\t * @static\n\t\t\t * @final\n\t\t\t * @field {Number} OK_CANCEL\n\t\t\t */\n\t\t\tOK_CANCEL: 2,\n\n\t\t\t/**\n\t\t\t * yes/no buttons constant.\n\t\t\t *\n\t\t\t * @static\n\t\t\t * @final\n\t\t\t * @field {Number} YES_NO\n\t\t\t */\n\t\t\tYES_NO: 3,\n\n\t\t\t/**\n\t\t\t * yes/no/cancel buttons constant.\n\t\t\t *\n\t\t\t * @static\n\t\t\t * @final\n\t\t\t * @field {Number} YES_NO_CANCEL\n\t\t\t */\n\t\t\tYES_NO_CANCEL: 4,\n\n\t\t\t/**\n\t\t\t * Constructs a new message box and renders it to the body element.\n\t\t\t *\n\t\t\t * @static\n\t\t\t * @method msgBox\n\t\t\t * @param {Object} settings Name/value object with settings.\n\t\t\t */\n\t\t\tmsgBox: function(settings) {\n\t\t\t\tvar buttons, callback = settings.callback || function() {};\n\n\t\t\t\tfunction createButton(text, status, primary) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\ttype: \"button\",\n\t\t\t\t\t\ttext: text,\n\t\t\t\t\t\tsubtype: primary ? 'primary' : '',\n\t\t\t\t\t\tonClick: function(e) {\n\t\t\t\t\t\t\te.control.parents()[1].close();\n\t\t\t\t\t\t\tcallback(status);\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tswitch (settings.buttons) {\n\t\t\t\t\tcase MessageBox.OK_CANCEL:\n\t\t\t\t\t\tbuttons = [\n\t\t\t\t\t\t\tcreateButton('Ok', true, true),\n\t\t\t\t\t\t\tcreateButton('Cancel', false)\n\t\t\t\t\t\t];\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase MessageBox.YES_NO:\n\t\t\t\t\tcase MessageBox.YES_NO_CANCEL:\n\t\t\t\t\t\tbuttons = [\n\t\t\t\t\t\t\tcreateButton('Yes', 1, true),\n\t\t\t\t\t\t\tcreateButton('No', 0)\n\t\t\t\t\t\t];\n\n\t\t\t\t\t\tif (settings.buttons == MessageBox.YES_NO_CANCEL) {\n\t\t\t\t\t\t\tbuttons.push(createButton('Cancel', -1));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tbuttons = [\n\t\t\t\t\t\t\tcreateButton('Ok', true, true)\n\t\t\t\t\t\t];\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\treturn new Window({\n\t\t\t\t\tpadding: 20,\n\t\t\t\t\tx: settings.x,\n\t\t\t\t\ty: settings.y,\n\t\t\t\t\tminWidth: 300,\n\t\t\t\t\tminHeight: 100,\n\t\t\t\t\tlayout: \"flex\",\n\t\t\t\t\tpack: \"center\",\n\t\t\t\t\talign: \"center\",\n\t\t\t\t\tbuttons: buttons,\n\t\t\t\t\ttitle: settings.title,\n\t\t\t\t\trole: 'alertdialog',\n\t\t\t\t\titems: {\n\t\t\t\t\t\ttype: \"label\",\n\t\t\t\t\t\tmultiline: true,\n\t\t\t\t\t\tmaxWidth: 500,\n\t\t\t\t\t\tmaxHeight: 200,\n\t\t\t\t\t\ttext: settings.text\n\t\t\t\t\t},\n\t\t\t\t\tonPostRender: function() {\n\t\t\t\t\t\tthis.aria('describedby', this.items()[0]._id);\n\t\t\t\t\t},\n\t\t\t\t\tonClose: settings.onClose,\n\t\t\t\t\tonCancel: function() {\n\t\t\t\t\t\tcallback(false);\n\t\t\t\t\t}\n\t\t\t\t}).renderTo(document.body).reflow();\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Creates a new alert dialog.\n\t\t\t *\n\t\t\t * @method alert\n\t\t\t * @param {Object} settings Settings for the alert dialog.\n\t\t\t * @param {function} [callback] Callback to execute when the user makes a choice.\n\t\t\t */\n\t\t\talert: function(settings, callback) {\n\t\t\t\tif (typeof settings == \"string\") {\n\t\t\t\t\tsettings = {text: settings};\n\t\t\t\t}\n\n\t\t\t\tsettings.callback = callback;\n\t\t\t\treturn MessageBox.msgBox(settings);\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Creates a new confirm dialog.\n\t\t\t *\n\t\t\t * @method confirm\n\t\t\t * @param {Object} settings Settings for the confirm dialog.\n\t\t\t * @param {function} [callback] Callback to execute when the user makes a choice.\n\t\t\t */\n\t\t\tconfirm: function(settings, callback) {\n\t\t\t\tif (typeof settings == \"string\") {\n\t\t\t\t\tsettings = {text: settings};\n\t\t\t\t}\n\n\t\t\t\tsettings.callback = callback;\n\t\t\t\tsettings.buttons = MessageBox.OK_CANCEL;\n\n\t\t\t\treturn MessageBox.msgBox(settings);\n\t\t\t}\n\t\t}\n\t});\n\n\treturn MessageBox;\n});\n\n// Included from: js/tinymce/classes/WindowManager.js\n\n/**\n * WindowManager.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class handles the creation of native windows and dialogs. This class can be extended to provide for example inline dialogs.\n *\n * @class tinymce.WindowManager\n * @example\n * // Opens a new dialog with the file.htm file and the size 320x240\n * // It also adds a custom parameter this can be retrieved by using tinyMCEPopup.getWindowArg inside the dialog.\n * tinymce.activeEditor.windowManager.open({\n *    url: 'file.htm',\n *    width: 320,\n *    height: 240\n * }, {\n *    custom_param: 1\n * });\n *\n * // Displays an alert box using the active editors window manager instance\n * tinymce.activeEditor.windowManager.alert('Hello world!');\n *\n * // Displays an confirm box and an alert message will be displayed depending on what you choose in the confirm\n * tinymce.activeEditor.windowManager.confirm(\"Do you want to do something\", function(s) {\n *    if (s)\n *       tinymce.activeEditor.windowManager.alert(\"Ok\");\n *    else\n *       tinymce.activeEditor.windowManager.alert(\"Cancel\");\n * });\n */\ndefine(\"tinymce/WindowManager\", [\n\t\"tinymce/ui/Window\",\n\t\"tinymce/ui/MessageBox\"\n], function(Window, MessageBox) {\n\treturn function(editor) {\n\t\tvar self = this, windows = [];\n\n\t\tfunction getTopMostWindow() {\n\t\t\tif (windows.length) {\n\t\t\t\treturn windows[windows.length - 1];\n\t\t\t}\n\t\t}\n\n\t\tfunction fireOpenEvent(win) {\n\t\t\teditor.fire('OpenWindow', {\n\t\t\t\twin: win\n\t\t\t});\n\t\t}\n\n\t\tfunction fireCloseEvent(win) {\n\t\t\teditor.fire('CloseWindow', {\n\t\t\t\twin: win\n\t\t\t});\n\t\t}\n\n\t\tself.windows = windows;\n\n\t\teditor.on('remove', function() {\n\t\t\tvar i = windows.length;\n\n\t\t\twhile (i--) {\n\t\t\t\twindows[i].close();\n\t\t\t}\n\t\t});\n\n\t\t/**\n\t\t * Opens a new window.\n\t\t *\n\t\t * @method open\n\t\t * @param {Object} args Optional name/value settings collection contains things like width/height/url etc.\n\t\t * @param {Object} params Options like title, file, width, height etc.\n\t\t * @option {String} title Window title.\n\t\t * @option {String} file URL of the file to open in the window.\n\t\t * @option {Number} width Width in pixels.\n\t\t * @option {Number} height Height in pixels.\n\t\t * @option {Boolean} autoScroll Specifies whether the popup window can have scrollbars if required (i.e. content\n\t\t * larger than the popup size specified).\n\t\t */\n\t\tself.open = function(args, params) {\n\t\t\tvar win;\n\n\t\t\teditor.editorManager.setActive(editor);\n\n\t\t\targs.title = args.title || ' ';\n\n\t\t\t// Handle URL\n\t\t\targs.url = args.url || args.file; // Legacy\n\t\t\tif (args.url) {\n\t\t\t\targs.width = parseInt(args.width || 320, 10);\n\t\t\t\targs.height = parseInt(args.height || 240, 10);\n\t\t\t}\n\n\t\t\t// Handle body\n\t\t\tif (args.body) {\n\t\t\t\targs.items = {\n\t\t\t\t\tdefaults: args.defaults,\n\t\t\t\t\ttype: args.bodyType || 'form',\n\t\t\t\t\titems: args.body,\n\t\t\t\t\tdata: args.data,\n\t\t\t\t\tcallbacks: args.commands\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (!args.url && !args.buttons) {\n\t\t\t\targs.buttons = [\n\t\t\t\t\t{text: 'Ok', subtype: 'primary', onclick: function() {\n\t\t\t\t\t\twin.find('form')[0].submit();\n\t\t\t\t\t}},\n\n\t\t\t\t\t{text: 'Cancel', onclick: function() {\n\t\t\t\t\t\twin.close();\n\t\t\t\t\t}}\n\t\t\t\t];\n\t\t\t}\n\n\t\t\twin = new Window(args);\n\t\t\twindows.push(win);\n\n\t\t\twin.on('close', function() {\n\t\t\t\tvar i = windows.length;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tif (windows[i] === win) {\n\t\t\t\t\t\twindows.splice(i, 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!windows.length) {\n\t\t\t\t\teditor.focus();\n\t\t\t\t}\n\n\t\t\t\tfireCloseEvent(win);\n\t\t\t});\n\n\t\t\t// Handle data\n\t\t\tif (args.data) {\n\t\t\t\twin.on('postRender', function() {\n\t\t\t\t\tthis.find('*').each(function(ctrl) {\n\t\t\t\t\t\tvar name = ctrl.name();\n\n\t\t\t\t\t\tif (name in args.data) {\n\t\t\t\t\t\t\tctrl.value(args.data[name]);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// store args and parameters\n\t\t\twin.features = args || {};\n\t\t\twin.params = params || {};\n\n\t\t\t// Takes a snapshot in the FocusManager of the selection before focus is lost to dialog\n\t\t\tif (windows.length === 1) {\n\t\t\t\teditor.nodeChanged();\n\t\t\t}\n\n\t\t\twin = win.renderTo().reflow();\n\n\t\t\tfireOpenEvent(win);\n\n\t\t\treturn win;\n\t\t};\n\n\t\t/**\n\t\t * Creates a alert dialog. Please don't use the blocking behavior of this\n\t\t * native version use the callback method instead then it can be extended.\n\t\t *\n\t\t * @method alert\n\t\t * @param {String} message Text to display in the new alert dialog.\n\t\t * @param {function} callback Callback function to be executed after the user has selected ok.\n\t\t * @param {Object} scope Optional scope to execute the callback in.\n\t\t * @example\n\t\t * // Displays an alert box using the active editors window manager instance\n\t\t * tinymce.activeEditor.windowManager.alert('Hello world!');\n\t\t */\n\t\tself.alert = function(message, callback, scope) {\n\t\t\tvar win;\n\n\t\t\twin = MessageBox.alert(message, function() {\n\t\t\t\tif (callback) {\n\t\t\t\t\tcallback.call(scope || this);\n\t\t\t\t} else {\n\t\t\t\t\teditor.focus();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\twin.on('close', function() {\n\t\t\t\tfireCloseEvent(win);\n\t\t\t});\n\n\t\t\tfireOpenEvent(win);\n\t\t};\n\n\t\t/**\n\t\t * Creates a confirm dialog. Please don't use the blocking behavior of this\n\t\t * native version use the callback method instead then it can be extended.\n\t\t *\n\t\t * @method confirm\n\t\t * @param {String} message Text to display in the new confirm dialog.\n\t\t * @param {function} callback Callback function to be executed after the user has selected ok or cancel.\n\t\t * @param {Object} scope Optional scope to execute the callback in.\n\t\t * @example\n\t\t * // Displays an confirm box and an alert message will be displayed depending on what you choose in the confirm\n\t\t * tinymce.activeEditor.windowManager.confirm(\"Do you want to do something\", function(s) {\n\t\t *    if (s)\n\t\t *       tinymce.activeEditor.windowManager.alert(\"Ok\");\n\t\t *    else\n\t\t *       tinymce.activeEditor.windowManager.alert(\"Cancel\");\n\t\t * });\n\t\t */\n\t\tself.confirm = function(message, callback, scope) {\n\t\t\tvar win;\n\n\t\t\twin = MessageBox.confirm(message, function(state) {\n\t\t\t\tcallback.call(scope || this, state);\n\t\t\t});\n\n\t\t\twin.on('close', function() {\n\t\t\t\tfireCloseEvent(win);\n\t\t\t});\n\n\t\t\tfireOpenEvent(win);\n\t\t};\n\n\t\t/**\n\t\t * Closes the top most window.\n\t\t *\n\t\t * @method close\n\t\t */\n\t\tself.close = function() {\n\t\t\tif (getTopMostWindow()) {\n\t\t\t\tgetTopMostWindow().close();\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Returns the params of the last window open call. This can be used in iframe based\n\t\t * dialog to get params passed from the tinymce plugin.\n\t\t *\n\t\t * @example\n\t\t * var dialogArguments = top.tinymce.activeEditor.windowManager.getParams();\n\t\t *\n\t\t * @method getParams\n\t\t * @return {Object} Name/value object with parameters passed from windowManager.open call.\n\t\t */\n\t\tself.getParams = function() {\n\t\t\treturn getTopMostWindow() ? getTopMostWindow().params : null;\n\t\t};\n\n\t\t/**\n\t\t * Sets the params of the last opened window.\n\t\t *\n\t\t * @method setParams\n\t\t * @param {Object} params Params object to set for the last opened window.\n\t\t */\n\t\tself.setParams = function(params) {\n\t\t\tif (getTopMostWindow()) {\n\t\t\t\tgetTopMostWindow().params = params;\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Returns the currently opened window objects.\n\t\t *\n\t\t * @method getWindows\n\t\t * @return {Array} Array of the currently opened windows.\n\t\t */\n\t\tself.getWindows = function() {\n\t\t\treturn windows;\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/ui/Tooltip.js\n\n/**\n * Tooltip.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a tooltip instance.\n *\n * @-x-less ToolTip.less\n * @class tinymce.ui.ToolTip\n * @extends tinymce.ui.Control\n * @mixes tinymce.ui.Movable\n */\ndefine(\"tinymce/ui/Tooltip\", [\n\t\"tinymce/ui/Control\",\n\t\"tinymce/ui/Movable\"\n], function(Control, Movable) {\n\treturn Control.extend({\n\t\tMixins: [Movable],\n\n\t\tDefaults: {\n\t\t\tclasses: 'widget tooltip tooltip-n'\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, prefix = self.classPrefix;\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + self._id + '\" class=\"' + self.classes + '\" role=\"presentation\">' +\n\t\t\t\t\t'<div class=\"' + prefix + 'tooltip-arrow\"></div>' +\n\t\t\t\t\t'<div class=\"' + prefix + 'tooltip-inner\">' + self.encode(self.state.get('text')) + '</div>' +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\tbindStates: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.state.on('change:text', function(e) {\n\t\t\t\tself.getEl().lastChild.innerHTML = self.encode(e.value);\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t},\n\n\t\t/**\n\t\t * Repaints the control after a layout operation.\n\t\t *\n\t\t * @method repaint\n\t\t */\n\t\trepaint: function() {\n\t\t\tvar self = this, style, rect;\n\n\t\t\tstyle = self.getEl().style;\n\t\t\trect = self._layoutRect;\n\n\t\t\tstyle.left = rect.x + 'px';\n\t\t\tstyle.top = rect.y + 'px';\n\t\t\tstyle.zIndex = 0xFFFF + 0xFFFF;\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/Widget.js\n\n/**\n * Widget.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Widget base class a widget is a control that has a tooltip and some basic states.\n *\n * @class tinymce.ui.Widget\n * @extends tinymce.ui.Control\n */\ndefine(\"tinymce/ui/Widget\", [\n\t\"tinymce/ui/Control\",\n\t\"tinymce/ui/Tooltip\"\n], function(Control, Tooltip) {\n\t\"use strict\";\n\n\tvar tooltip;\n\n\tvar Widget = Control.extend({\n\t\t/**\n\t\t * Constructs a instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t * @setting {String} tooltip Tooltip text to display when hovering.\n\t\t * @setting {Boolean} autofocus True if the control should be focused when rendered.\n\t\t * @setting {String} text Text to display inside widget.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tself._super(settings);\n\t\t\tsettings = self.settings;\n\t\t\tself.canFocus = true;\n\n\t\t\tif (settings.tooltip && Widget.tooltips !== false) {\n\t\t\t\tself.on('mouseenter', function(e) {\n\t\t\t\t\tvar tooltip = self.tooltip().moveTo(-0xFFFF);\n\n\t\t\t\t\tif (e.control == self) {\n\t\t\t\t\t\tvar rel = tooltip.text(settings.tooltip).show().testMoveRel(self.getEl(), ['bc-tc', 'bc-tl', 'bc-tr']);\n\n\t\t\t\t\t\ttooltip.classes.toggle('tooltip-n', rel == 'bc-tc');\n\t\t\t\t\t\ttooltip.classes.toggle('tooltip-nw', rel == 'bc-tl');\n\t\t\t\t\t\ttooltip.classes.toggle('tooltip-ne', rel == 'bc-tr');\n\n\t\t\t\t\t\ttooltip.moveRel(self.getEl(), rel);\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttooltip.hide();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tself.on('mouseleave mousedown click', function() {\n\t\t\t\t\tself.tooltip().hide();\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tself.aria('label', settings.ariaLabel || settings.tooltip);\n\t\t},\n\n\t\t/**\n\t\t * Returns the current tooltip instance.\n\t\t *\n\t\t * @method tooltip\n\t\t * @return {tinymce.ui.Tooltip} Tooltip instance.\n\t\t */\n\t\ttooltip: function() {\n\t\t\tif (!tooltip) {\n\t\t\t\ttooltip = new Tooltip({type: 'tooltip'});\n\t\t\t\ttooltip.renderTo();\n\t\t\t}\n\n\t\t\treturn tooltip;\n\t\t},\n\n\t\t/**\n\t\t * Called after the control has been rendered.\n\t\t *\n\t\t * @method postRender\n\t\t */\n\t\tpostRender: function() {\n\t\t\tvar self = this, settings = self.settings;\n\n\t\t\tself._super();\n\n\t\t\tif (!self.parent() && (settings.width || settings.height)) {\n\t\t\t\tself.initLayoutRect();\n\t\t\t\tself.repaint();\n\t\t\t}\n\n\t\t\tif (settings.autofocus) {\n\t\t\t\tself.focus();\n\t\t\t}\n\t\t},\n\n\t\tbindStates: function() {\n\t\t\tvar self = this;\n\n\t\t\tfunction disable(state) {\n\t\t\t\tself.aria('disabled', state);\n\t\t\t\tself.classes.toggle('disabled', state);\n\t\t\t}\n\n\t\t\tfunction active(state) {\n\t\t\t\tself.aria('pressed', state);\n\t\t\t\tself.classes.toggle('active', state);\n\t\t\t}\n\n\t\t\tself.state.on('change:disabled', function(e) {\n\t\t\t\tdisable(e.value);\n\t\t\t});\n\n\t\t\tself.state.on('change:active', function(e) {\n\t\t\t\tactive(e.value);\n\t\t\t});\n\n\t\t\tif (self.state.get('disabled')) {\n\t\t\t\tdisable(true);\n\t\t\t}\n\n\t\t\tif (self.state.get('active')) {\n\t\t\t\tactive(true);\n\t\t\t}\n\n\t\t\treturn self._super();\n\t\t},\n\n\t\t/**\n\t\t * Removes the current control from DOM and from UI collections.\n\t\t *\n\t\t * @method remove\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\tremove: function() {\n\t\t\tthis._super();\n\n\t\t\tif (tooltip) {\n\t\t\t\ttooltip.remove();\n\t\t\t\ttooltip = null;\n\t\t\t}\n\t\t}\n\t});\n\n\treturn Widget;\n});\n\n// Included from: js/tinymce/classes/ui/Progress.js\n\n/**\n * Progress.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Progress control.\n *\n * @-x-less Progress.less\n * @class tinymce.ui.Progress\n * @extends tinymce.ui.Control\n */\ndefine(\"tinymce/ui/Progress\", [\n\t\"tinymce/ui/Widget\"\n], function(Widget) {\n\t\"use strict\";\n\n\treturn Widget.extend({\n\t\tDefaults: {\n\t\t\tvalue: 0\n\t\t},\n\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tself._super(settings);\n\t\t\tself.classes.add('progress');\n\n\t\t\tif (!self.settings.filter) {\n\t\t\t\tself.settings.filter = function(value) {\n\t\t\t\t\treturn Math.round(value);\n\t\t\t\t};\n\t\t\t}\n\t\t},\n\n\t\trenderHtml: function() {\n\t\t\tvar self = this, id = self._id, prefix = this.classPrefix;\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + id + '\" class=\"' + self.classes + '\">' +\n\t\t\t\t\t'<div class=\"' + prefix + 'bar-container\">' +\n\t\t\t\t\t\t'<div class=\"' + prefix + 'bar\"></div>' +\n\t\t\t\t\t'</div>' +\n\t\t\t\t\t'<div class=\"' + prefix + 'text\">0%</div>' +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\tpostRender: function() {\n\t\t\tvar self = this;\n\n\t\t\tself._super();\n\t\t\tself.value(self.settings.value);\n\n\t\t\treturn self;\n\t\t},\n\n\t\tbindStates: function() {\n\t\t\tvar self = this;\n\n\t\t\tfunction setValue(value) {\n\t\t\t\tvalue = self.settings.filter(value);\n\t\t\t\tself.getEl().lastChild.innerHTML = value + '%';\n\t\t\t\tself.getEl().firstChild.firstChild.style.width = value + '%';\n\t\t\t}\n\n\t\t\tself.state.on('change:value', function(e) {\n\t\t\t\tsetValue(e.value);\n\t\t\t});\n\n\t\t\tsetValue(self.state.get('value'));\n\n\t\t\treturn self._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/Notification.js\n\n/**\n * Notification.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a notification instance.\n *\n * @-x-less Notification.less\n * @class tinymce.ui.Notification\n * @extends tinymce.ui.Container\n * @mixes tinymce.ui.Movable\n */\ndefine(\"tinymce/ui/Notification\", [\n\t\"tinymce/ui/Control\",\n\t\"tinymce/ui/Movable\",\n\t\"tinymce/ui/Progress\",\n\t\"tinymce/util/Delay\"\n], function(Control, Movable, Progress, Delay) {\n\treturn Control.extend({\n\t\tMixins: [Movable],\n\n\t\tDefaults: {\n\t\t\tclasses: 'widget notification'\n\t\t},\n\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tself._super(settings);\n\n\t\t\tif (settings.text) {\n\t\t\t\tself.text(settings.text);\n\t\t\t}\n\n\t\t\tif (settings.icon) {\n\t\t\t\tself.icon = settings.icon;\n\t\t\t}\n\n\t\t\tif (settings.color) {\n\t\t\t\tself.color = settings.color;\n\t\t\t}\n\n\t\t\tif (settings.type) {\n\t\t\t\tself.classes.add('notification-' + settings.type);\n\t\t\t}\n\n\t\t\tif (settings.timeout && (settings.timeout < 0 || settings.timeout > 0) && !settings.closeButton) {\n\t\t\t\tself.closeButton = false;\n\t\t\t} else {\n\t\t\t\tself.classes.add('has-close');\n\t\t\t\tself.closeButton = true;\n\t\t\t}\n\n\t\t\tif (settings.progressBar) {\n\t\t\t\tself.progressBar = new Progress();\n\t\t\t}\n\n\t\t\tself.on('click', function(e) {\n\t\t\t\tif (e.target.className.indexOf(self.classPrefix + 'close') != -1) {\n\t\t\t\t\tself.close();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, prefix = self.classPrefix, icon = '', closeButton = '', progressBar = '', notificationStyle = '';\n\n\t\t\tif (self.icon) {\n\t\t\t\ticon = '<i class=\"' + prefix + 'ico' + ' ' + prefix + 'i-' + self.icon + '\"></i>';\n\t\t\t}\n\n\t\t\tif (self.color) {\n\t\t\t\tnotificationStyle = ' style=\"background-color: ' + self.color + '\"';\n\t\t\t}\n\n\t\t\tif (self.closeButton) {\n\t\t\t\tcloseButton = '<button type=\"button\" class=\"' + prefix + 'close\" aria-hidden=\"true\">\\u00d7</button>';\n\t\t\t}\n\n\t\t\tif (self.progressBar) {\n\t\t\t\tprogressBar = self.progressBar.renderHtml();\n\t\t\t}\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + self._id + '\" class=\"' + self.classes + '\"' + notificationStyle + ' role=\"presentation\">' +\n\t\t\t\t\ticon +\n\t\t\t\t\t'<div class=\"' + prefix + 'notification-inner\">' + self.state.get('text') + '</div>' +\n\t\t\t\t\tprogressBar +\n\t\t\t\t\tcloseButton +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\tpostRender: function() {\n\t\t\tvar self = this;\n\n\t\t\tDelay.setTimeout(function() {\n\t\t\t\tself.$el.addClass(self.classPrefix + 'in');\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t},\n\n\t\tbindStates: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.state.on('change:text', function(e) {\n\t\t\t\tself.getEl().childNodes[1].innerHTML = e.value;\n\t\t\t});\n\t\t\tif (self.progressBar) {\n\t\t\t\tself.progressBar.bindStates();\n\t\t\t}\n\t\t\treturn self._super();\n\t\t},\n\n\t\tclose: function() {\n\t\t\tvar self = this;\n\n\t\t\tif (!self.fire('close').isDefaultPrevented()) {\n\t\t\t\tself.remove();\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Repaints the control after a layout operation.\n\t\t *\n\t\t * @method repaint\n\t\t */\n\t\trepaint: function() {\n\t\t\tvar self = this, style, rect;\n\n\t\t\tstyle = self.getEl().style;\n\t\t\trect = self._layoutRect;\n\n\t\t\tstyle.left = rect.x + 'px';\n\t\t\tstyle.top = rect.y + 'px';\n\n\t\t\t// Hardcoded arbitrary z-value because we want the\n\t\t\t// notifications under the other windows\n\t\t\tstyle.zIndex = 0xFFFF - 1;\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/NotificationManager.js\n\n/**\n * NotificationManager.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class handles the creation of TinyMCE's notifications.\n *\n * @class tinymce.notificationManager\n * @example\n * // Opens a new notification of type \"error\" with text \"An error occurred.\"\n * tinymce.activeEditor.notificationManager.open({\n *    text: 'An error occurred.',\n *    type: 'error'\n * });\n */\ndefine(\"tinymce/NotificationManager\", [\n\t\"tinymce/ui/Notification\",\n\t\"tinymce/util/Delay\",\n\t\"tinymce/util/Tools\"\n], function(Notification, Delay, Tools) {\n\treturn function(editor) {\n\t\tvar self = this, notifications = [];\n\n\t\tfunction getLastNotification() {\n\t\t\tif (notifications.length) {\n\t\t\t\treturn notifications[notifications.length - 1];\n\t\t\t}\n\t\t}\n\n\t\tself.notifications = notifications;\n\n\t\tfunction resizeWindowEvent() {\n\t\t\tDelay.requestAnimationFrame(function() {\n\t\t\t\tprePositionNotifications();\n\t\t\t\tpositionNotifications();\n\t\t\t});\n\t\t}\n\n\t\t// Since the viewport will change based on the present notifications, we need to move them all to the\n\t\t// top left of the viewport to give an accurate size measurement so we can position them later.\n\t\tfunction prePositionNotifications() {\n\t\t\tfor (var i = 0; i < notifications.length; i++) {\n\t\t\t\tnotifications[i].moveTo(0, 0);\n\t\t\t}\n\t\t}\n\n\t\tfunction positionNotifications() {\n\t\t\tif (notifications.length > 0) {\n\t\t\t\tvar firstItem = notifications.slice(0, 1)[0];\n\t\t\t\tvar container = editor.inline ? editor.getElement() : editor.getContentAreaContainer();\n\t\t\t\tfirstItem.moveRel(container, 'tc-tc');\n\t\t\t\tif (notifications.length > 1) {\n\t\t\t\t\tfor (var i = 1; i < notifications.length; i++) {\n\t\t\t\t\t\tnotifications[i].moveRel(notifications[i - 1].getEl(), 'bc-tc');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\teditor.on('remove', function() {\n\t\t\tvar i = notifications.length;\n\n\t\t\twhile (i--) {\n\t\t\t\tnotifications[i].close();\n\t\t\t}\n\t\t});\n\n\t\teditor.on('ResizeEditor', positionNotifications);\n\t\teditor.on('ResizeWindow', resizeWindowEvent);\n\n\t\t/**\n\t\t * Opens a new notification.\n\t\t *\n\t\t * @method open\n\t\t * @param {Object} args Optional name/value settings collection contains things like timeout/color/message etc.\n\t\t */\n\t\tself.open = function(args) {\n\t\t\t// Never open notification if editor has been removed.\n\t\t\tif (editor.removed) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar notif;\n\n\t\t\teditor.editorManager.setActive(editor);\n\n\t\t\tvar duplicate = findDuplicateMessage(notifications, args);\n\n\t\t\tif (duplicate === null) {\n\t\t\t\tnotif = new Notification(args);\n\t\t\t\tnotifications.push(notif);\n\n\t\t\t\t//If we have a timeout value\n\t\t\t\tif (args.timeout > 0) {\n\t\t\t\t\t\tnotif.timer = setTimeout(function() {\n\t\t\t\t\t\t\tnotif.close();\n\t\t\t\t\t\t}, args.timeout);\n\t\t\t\t}\n\n\t\t\t\tnotif.on('close', function() {\n\t\t\t\t\tvar i = notifications.length;\n\n\t\t\t\t\tif (notif.timer) {\n\t\t\t\t\t\teditor.getWin().clearTimeout(notif.timer);\n\t\t\t\t\t}\n\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tif (notifications[i] === notif) {\n\t\t\t\t\t\t\tnotifications.splice(i, 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tpositionNotifications();\n\t\t\t\t});\n\n\t\t\t\tnotif.renderTo();\n\n\t\t\t\tpositionNotifications();\n\t\t\t} else {\n\t\t\t\tnotif = duplicate;\n\t\t\t}\n\n\t\t\treturn notif;\n\t\t};\n\n\t\t/**\n\t\t * Closes the top most notification.\n\t\t *\n\t\t * @method close\n\t\t */\n\t\tself.close = function() {\n\t\t\tif (getLastNotification()) {\n\t\t\t\tgetLastNotification().close();\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Returns the currently opened notification objects.\n\t\t *\n\t\t * @method getNotifications\n\t\t * @return {Array} Array of the currently opened notifications.\n\t\t */\n\t\tself.getNotifications = function() {\n\t\t\treturn notifications;\n\t\t};\n\n\t\teditor.on('SkinLoaded', function() {\n\t\t\tvar serviceMessage = editor.settings.service_message;\n\n\t\t\tif (serviceMessage) {\n\t\t\t\teditor.notificationManager.open({\n\t\t\t\t\ttext: serviceMessage,\n\t\t\t\t\ttype: 'warning',\n\t\t\t\t\ttimeout: 0,\n\t\t\t\t\ticon: ''\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\t/**\n\t\t * Finds any existing notification with the same properties as the new one.\n\t\t * Returns either the found notification or null.\n\t\t *\n\t\t * @param {Notification[]} notificationArray - Array of current notifications\n\t\t * @param {type: string, } newNotification - New notification object\n\t\t * @returns {?Notification}\n\t\t */\n\t\tfunction findDuplicateMessage(notificationArray, newNotification) {\n\t\t\tif (!isPlainTextNotification(newNotification)) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tvar filteredNotifications = Tools.grep(notificationArray, function (notification) {\n\t\t\t\treturn isSameNotification(newNotification, notification);\n\t\t\t});\n\n\t\t\treturn filteredNotifications.length === 0 ? null : filteredNotifications[0];\n\t\t}\n\n\t\t/**\n\t\t * Checks if the passed in args object has the same\n\t\t * type and text properties as the sent in notification.\n\t\t *\n\t\t * @param {type: string, text: string} a - New notification args object\n\t\t * @param {Notification} b - Old notification\n\t\t * @returns {boolean}\n\t\t */\n\t\tfunction isSameNotification(a, b) {\n\t\t\treturn a.type === b.settings.type && a.text === b.settings.text;\n\t\t}\n\n\t\t/**\n\t\t * Checks that the notification does not have a progressBar\n\t\t * or timeour property.\n\t\t *\n\t\t * @param {Notification} notification - Notification to check\n\t\t * @returns {boolean}\n\t\t */\n\t\tfunction isPlainTextNotification(notification) {\n\t\t\treturn !notification.progressBar && !notification.timeout;\n\t\t}\n\n\t\t//self.positionNotifications = positionNotifications;\n\t};\n});\n\n// Included from: js/tinymce/classes/dom/NodePath.js\n\n/**\n * NodePath.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Handles paths of nodes within an element.\n *\n * @private\n * @class tinymce.dom.NodePath\n */\ndefine(\"tinymce/dom/NodePath\", [\n\t\"tinymce/dom/DOMUtils\"\n], function(DOMUtils) {\n\tfunction create(rootNode, targetNode, normalized) {\n\t\tvar path = [];\n\n\t\tfor (; targetNode && targetNode != rootNode; targetNode = targetNode.parentNode) {\n\t\t\tpath.push(DOMUtils.nodeIndex(targetNode, normalized));\n\t\t}\n\n\t\treturn path;\n\t}\n\n\tfunction resolve(rootNode, path) {\n\t\tvar i, node, children;\n\n\t\tfor (node = rootNode, i = path.length - 1; i >= 0; i--) {\n\t\t\tchildren = node.childNodes;\n\n\t\t\tif (path[i] > children.length - 1) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tnode = children[path[i]];\n\t\t}\n\n\t\treturn node;\n\t}\n\n\treturn {\n\t\tcreate: create,\n\t\tresolve: resolve\n\t};\n});\n\n// Included from: js/tinymce/classes/util/Quirks.js\n\n/**\n * Quirks.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n *\n * @ignore-file\n */\n\n/**\n * This file includes fixes for various browser quirks it's made to make it easy to add/remove browser specific fixes.\n *\n * @private\n * @class tinymce.util.Quirks\n */\ndefine(\"tinymce/util/Quirks\", [\n\t\"tinymce/util/VK\",\n\t\"tinymce/dom/RangeUtils\",\n\t\"tinymce/dom/TreeWalker\",\n\t\"tinymce/dom/NodePath\",\n\t\"tinymce/html/Node\",\n\t\"tinymce/html/Entities\",\n\t\"tinymce/Env\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/util/Delay\",\n\t\"tinymce/caret/CaretContainer\",\n\t\"tinymce/caret/CaretPosition\",\n\t\"tinymce/caret/CaretWalker\"\n], function(VK, RangeUtils, TreeWalker, NodePath, Node, Entities, Env, Tools, Delay, CaretContainer, CaretPosition, CaretWalker) {\n\treturn function(editor) {\n\t\tvar each = Tools.each, $ = editor.$;\n\t\tvar BACKSPACE = VK.BACKSPACE, DELETE = VK.DELETE, dom = editor.dom, selection = editor.selection,\n\t\t\tsettings = editor.settings, parser = editor.parser, serializer = editor.serializer;\n\t\tvar isGecko = Env.gecko, isIE = Env.ie, isWebKit = Env.webkit;\n\t\tvar mceInternalUrlPrefix = 'data:text/mce-internal,';\n\t\tvar mceInternalDataType = isIE ? 'Text' : 'URL';\n\n\t\t/**\n\t\t * Executes a command with a specific state this can be to enable/disable browser editing features.\n\t\t */\n\t\tfunction setEditorCommandState(cmd, state) {\n\t\t\ttry {\n\t\t\t\teditor.getDoc().execCommand(cmd, false, state);\n\t\t\t} catch (ex) {\n\t\t\t\t// Ignore\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Returns current IE document mode.\n\t\t */\n\t\tfunction getDocumentMode() {\n\t\t\tvar documentMode = editor.getDoc().documentMode;\n\n\t\t\treturn documentMode ? documentMode : 6;\n\t\t}\n\n\t\t/**\n\t\t * Returns true/false if the event is prevented or not.\n\t\t *\n\t\t * @private\n\t\t * @param {Event} e Event object.\n\t\t * @return {Boolean} true/false if the event is prevented or not.\n\t\t */\n\t\tfunction isDefaultPrevented(e) {\n\t\t\treturn e.isDefaultPrevented();\n\t\t}\n\n\t\t/**\n\t\t * Sets Text/URL data on the event's dataTransfer object to a special data:text/mce-internal url.\n\t\t * This is to workaround the inability to set custom contentType on IE and Safari.\n\t\t * The editor's selected content is encoded into this url so drag and drop between editors will work.\n\t\t *\n\t\t * @private\n\t\t * @param {DragEvent} e Event object\n\t\t */\n\t\tfunction setMceInternalContent(e) {\n\t\t\tvar selectionHtml, internalContent;\n\n\t\t\tif (e.dataTransfer) {\n\t\t\t\tif (editor.selection.isCollapsed() && e.target.tagName == 'IMG') {\n\t\t\t\t\tselection.select(e.target);\n\t\t\t\t}\n\n\t\t\t\tselectionHtml = editor.selection.getContent();\n\n\t\t\t\t// Safari/IE doesn't support custom dataTransfer items so we can only use URL and Text\n\t\t\t\tif (selectionHtml.length > 0) {\n\t\t\t\t\tinternalContent = mceInternalUrlPrefix + escape(editor.id) + ',' + escape(selectionHtml);\n\t\t\t\t\te.dataTransfer.setData(mceInternalDataType, internalContent);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Gets content of special data:text/mce-internal url on the event's dataTransfer object.\n\t\t * This is to workaround the inability to set custom contentType on IE and Safari.\n\t\t * The editor's selected content is encoded into this url so drag and drop between editors will work.\n\t\t *\n\t\t * @private\n\t\t * @param {DragEvent} e Event object\n\t\t * @returns {String} mce-internal content\n\t\t */\n\t\tfunction getMceInternalContent(e) {\n\t\t\tvar internalContent;\n\n\t\t\tif (e.dataTransfer) {\n\t\t\t\tinternalContent = e.dataTransfer.getData(mceInternalDataType);\n\n\t\t\t\tif (internalContent && internalContent.indexOf(mceInternalUrlPrefix) >= 0) {\n\t\t\t\t\tinternalContent = internalContent.substr(mceInternalUrlPrefix.length).split(',');\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tid: unescape(internalContent[0]),\n\t\t\t\t\t\thtml: unescape(internalContent[1])\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn null;\n\t\t}\n\n\t\t/**\n\t\t * Inserts contents using the paste clipboard command if it's available if it isn't it will fallback\n\t\t * to the core command.\n\t\t *\n\t\t * @private\n\t\t * @param {String} content Content to insert at selection.\n\t\t */\n\t\tfunction insertClipboardContents(content) {\n\t\t\tif (editor.queryCommandSupported('mceInsertClipboardContent')) {\n\t\t\t\teditor.execCommand('mceInsertClipboardContent', false, {content: content});\n\t\t\t} else {\n\t\t\t\teditor.execCommand('mceInsertContent', false, content);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Fixes a WebKit bug when deleting contents using backspace or delete key.\n\t\t * WebKit will produce a span element if you delete across two block elements.\n\t\t *\n\t\t * Example:\n\t\t * <h1>a</h1><p>|b</p>\n\t\t *\n\t\t * Will produce this on backspace:\n\t\t * <h1>a<span style=\"<all runtime styles>\">b</span></p>\n\t\t *\n\t\t * This fixes the backspace to produce:\n\t\t * <h1>a|b</p>\n\t\t *\n\t\t * See bug: https://bugs.webkit.org/show_bug.cgi?id=45784\n\t\t *\n\t\t * This fixes the following delete scenarios:\n\t\t *  1. Delete by pressing backspace key.\n\t\t *  2. Delete by pressing delete key.\n\t\t *  3. Delete by pressing backspace key with ctrl/cmd (Word delete).\n\t\t *  4. Delete by pressing delete key with ctrl/cmd (Word delete).\n\t\t *  5. Delete by drag/dropping contents inside the editor.\n\t\t *  6. Delete by using Cut Ctrl+X/Cmd+X.\n\t\t *  7. Delete by selecting contents and writing a character.\n\t\t *\n\t\t * This code is a ugly hack since writing full custom delete logic for just this bug\n\t\t * fix seemed like a huge task. I hope we can remove this before the year 2030.\n\t\t */\n\t\tfunction cleanupStylesWhenDeleting() {\n\t\t\tvar doc = editor.getDoc(), dom = editor.dom, selection = editor.selection;\n\t\t\tvar MutationObserver = window.MutationObserver, olderWebKit, dragStartRng;\n\n\t\t\t// Add mini polyfill for older WebKits\n\t\t\t// TODO: Remove this when old Safari versions gets updated\n\t\t\tif (!MutationObserver) {\n\t\t\t\tolderWebKit = true;\n\n\t\t\t\tMutationObserver = function() {\n\t\t\t\t\tvar records = [], target;\n\n\t\t\t\t\tfunction nodeInsert(e) {\n\t\t\t\t\t\tvar target = e.relatedNode || e.target;\n\t\t\t\t\t\trecords.push({target: target, addedNodes: [target]});\n\t\t\t\t\t}\n\n\t\t\t\t\tfunction attrModified(e) {\n\t\t\t\t\t\tvar target = e.relatedNode || e.target;\n\t\t\t\t\t\trecords.push({target: target, attributeName: e.attrName});\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.observe = function(node) {\n\t\t\t\t\t\ttarget = node;\n\t\t\t\t\t\ttarget.addEventListener('DOMSubtreeModified', nodeInsert, false);\n\t\t\t\t\t\ttarget.addEventListener('DOMNodeInsertedIntoDocument', nodeInsert, false);\n\t\t\t\t\t\ttarget.addEventListener('DOMNodeInserted', nodeInsert, false);\n\t\t\t\t\t\ttarget.addEventListener('DOMAttrModified', attrModified, false);\n\t\t\t\t\t};\n\n\t\t\t\t\tthis.disconnect = function() {\n\t\t\t\t\t\ttarget.removeEventListener('DOMSubtreeModified', nodeInsert, false);\n\t\t\t\t\t\ttarget.removeEventListener('DOMNodeInsertedIntoDocument', nodeInsert, false);\n\t\t\t\t\t\ttarget.removeEventListener('DOMNodeInserted', nodeInsert, false);\n\t\t\t\t\t\ttarget.removeEventListener('DOMAttrModified', attrModified, false);\n\t\t\t\t\t};\n\n\t\t\t\t\tthis.takeRecords = function() {\n\t\t\t\t\t\treturn records;\n\t\t\t\t\t};\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tfunction isTrailingBr(node) {\n\t\t\t\tvar blockElements = dom.schema.getBlockElements(), rootNode = editor.getBody();\n\n\t\t\t\tif (node.nodeName != 'BR') {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tfor (; node != rootNode && !blockElements[node.nodeName]; node = node.parentNode) {\n\t\t\t\t\tif (node.nextSibling) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tfunction isSiblingsIgnoreWhiteSpace(node1, node2) {\n\t\t\t\tvar node;\n\n\t\t\t\tfor (node = node1.nextSibling; node && node != node2; node = node.nextSibling) {\n\t\t\t\t\tif (node.nodeType == 3 && $.trim(node.data).length === 0) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (node !== node2) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn node === node2;\n\t\t\t}\n\n\t\t\tfunction findCaretNode(node, forward, startNode) {\n\t\t\t\tvar walker, current, nonEmptyElements;\n\n\t\t\t\t// Protect against the possibility we are asked to find a caret node relative\n\t\t\t\t// to a node that is no longer in the DOM tree. In this case attempting to\n\t\t\t\t// select on any match leads to a scenario where selection is completely removed\n\t\t\t\t// from the editor. This scenario is met in real world at a minimum on\n\t\t\t\t// WebKit browsers when selecting all and Cmd-X cutting to delete content.\n\t\t\t\tif (!dom.isChildOf(node, editor.getBody())) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tnonEmptyElements = dom.schema.getNonEmptyElements();\n\n\t\t\t\twalker = new TreeWalker(startNode || node, node);\n\n\t\t\t\twhile ((current = walker[forward ? 'next' : 'prev']())) {\n\t\t\t\t\tif (nonEmptyElements[current.nodeName] && !isTrailingBr(current)) {\n\t\t\t\t\t\treturn current;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (current.nodeType == 3 && current.data.length > 0) {\n\t\t\t\t\t\treturn current;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction deleteRangeBetweenTextBlocks(rng) {\n\t\t\t\tvar startBlock, endBlock, caretNodeBefore, caretNodeAfter, textBlockElements;\n\n\t\t\t\tif (rng.collapsed) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tstartBlock = dom.getParent(RangeUtils.getNode(rng.startContainer, rng.startOffset), dom.isBlock);\n\t\t\t\tendBlock = dom.getParent(RangeUtils.getNode(rng.endContainer, rng.endOffset), dom.isBlock);\n\t\t\t\ttextBlockElements = editor.schema.getTextBlockElements();\n\n\t\t\t\tif (startBlock == endBlock) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!textBlockElements[startBlock.nodeName] || !textBlockElements[endBlock.nodeName]) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (dom.getContentEditable(startBlock) === \"false\" || dom.getContentEditable(endBlock) === \"false\") {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\trng.deleteContents();\n\n\t\t\t\tcaretNodeBefore = findCaretNode(startBlock, false);\n\t\t\t\tcaretNodeAfter = findCaretNode(endBlock, true);\n\n\t\t\t\tif (!dom.isEmpty(endBlock)) {\n\t\t\t\t\t$(startBlock).append(endBlock.childNodes);\n\t\t\t\t}\n\n\t\t\t\t$(endBlock).remove();\n\n\t\t\t\tif (caretNodeBefore) {\n\t\t\t\t\tif (caretNodeBefore.nodeType == 1) {\n\t\t\t\t\t\tif (caretNodeBefore.nodeName == \"BR\") {\n\t\t\t\t\t\t\trng.setStartBefore(caretNodeBefore);\n\t\t\t\t\t\t\trng.setEndBefore(caretNodeBefore);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trng.setStartAfter(caretNodeBefore);\n\t\t\t\t\t\t\trng.setEndAfter(caretNodeBefore);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\trng.setStart(caretNodeBefore, caretNodeBefore.data.length);\n\t\t\t\t\t\trng.setEnd(caretNodeBefore, caretNodeBefore.data.length);\n\t\t\t\t\t}\n\t\t\t\t} else if (caretNodeAfter) {\n\t\t\t\t\tif (caretNodeAfter.nodeType == 1) {\n\t\t\t\t\t\trng.setStartBefore(caretNodeAfter);\n\t\t\t\t\t\trng.setEndBefore(caretNodeAfter);\n\t\t\t\t\t} else {\n\t\t\t\t\t\trng.setStart(caretNodeAfter, 0);\n\t\t\t\t\t\trng.setEnd(caretNodeAfter, 0);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tselection.setRng(rng);\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tfunction expandBetweenBlocks(rng, isForward) {\n\t\t\t\tvar caretNode, targetCaretNode, textBlock, targetTextBlock, container, offset;\n\n\t\t\t\tif (!rng.collapsed) {\n\t\t\t\t\treturn rng;\n\t\t\t\t}\n\n\t\t\t\tcontainer = rng.startContainer;\n\t\t\t\toffset = rng.startOffset;\n\n\t\t\t\tif (container.nodeType == 3) {\n\t\t\t\t\tif (isForward) {\n\t\t\t\t\t\tif (offset < container.data.length) {\n\t\t\t\t\t\t\treturn rng;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (offset > 0) {\n\t\t\t\t\t\t\treturn rng;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tcaretNode = RangeUtils.getNode(container, offset);\n\t\t\t\ttextBlock = dom.getParent(caretNode, dom.isBlock);\n\t\t\t\ttargetCaretNode = findCaretNode(editor.getBody(), isForward, caretNode);\n\t\t\t\ttargetTextBlock = dom.getParent(targetCaretNode, dom.isBlock);\n\t\t\t\tvar isAfter = container.nodeType === 1 && offset > container.childNodes.length - 1;\n\n\t\t\t\tif (!caretNode || !targetCaretNode) {\n\t\t\t\t\treturn rng;\n\t\t\t\t}\n\n\t\t\t\tif (targetTextBlock && textBlock != targetTextBlock) {\n\t\t\t\t\tif (!isForward) {\n\t\t\t\t\t\tif (!isSiblingsIgnoreWhiteSpace(targetTextBlock, textBlock)) {\n\t\t\t\t\t\t\treturn rng;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (targetCaretNode.nodeType == 1) {\n\t\t\t\t\t\t\tif (targetCaretNode.nodeName == \"BR\") {\n\t\t\t\t\t\t\t\trng.setStartBefore(targetCaretNode);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\trng.setStartAfter(targetCaretNode);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trng.setStart(targetCaretNode, targetCaretNode.data.length);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (caretNode.nodeType == 1) {\n\t\t\t\t\t\t\tif (isAfter) {\n\t\t\t\t\t\t\t\trng.setEndAfter(caretNode);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\trng.setEndBefore(caretNode);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trng.setEndBefore(caretNode);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (!isSiblingsIgnoreWhiteSpace(textBlock, targetTextBlock)) {\n\t\t\t\t\t\t\treturn rng;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (caretNode.nodeType == 1) {\n\t\t\t\t\t\t\tif (caretNode.nodeName == \"BR\") {\n\t\t\t\t\t\t\t\trng.setStartBefore(caretNode);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\trng.setStartAfter(caretNode);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trng.setStart(caretNode, caretNode.data.length);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (targetCaretNode.nodeType == 1) {\n\t\t\t\t\t\t\trng.setEnd(targetCaretNode, 0);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trng.setEndBefore(targetCaretNode);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn rng;\n\t\t\t}\n\n\t\t\tfunction handleTextBlockMergeDelete(isForward) {\n\t\t\t\tvar rng = selection.getRng();\n\n\t\t\t\trng = expandBetweenBlocks(rng, isForward);\n\n\t\t\t\tif (deleteRangeBetweenTextBlocks(rng)) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * This retains the formatting if the last character is to be deleted.\n\t\t\t *\n\t\t\t * Backspace on this: <p><b><i>a|</i></b></p> would become <p>|</p> in WebKit.\n\t\t\t * With this patch: <p><b><i>|<br></i></b></p>\n\t\t\t */\n\t\t\tfunction handleLastBlockCharacterDelete(isForward, rng) {\n\t\t\t\tvar path, blockElm, newBlockElm, clonedBlockElm, sibling,\n\t\t\t\t\tcontainer, offset, br, currentFormatNodes;\n\n\t\t\t\tfunction cloneTextBlockWithFormats(blockElm, node) {\n\t\t\t\t\tcurrentFormatNodes = $(node).parents().filter(function(idx, node) {\n\t\t\t\t\t\treturn !!editor.schema.getTextInlineElements()[node.nodeName];\n\t\t\t\t\t});\n\n\t\t\t\t\tnewBlockElm = blockElm.cloneNode(false);\n\n\t\t\t\t\tcurrentFormatNodes = Tools.map(currentFormatNodes, function(formatNode) {\n\t\t\t\t\t\tformatNode = formatNode.cloneNode(false);\n\n\t\t\t\t\t\tif (newBlockElm.hasChildNodes()) {\n\t\t\t\t\t\t\tformatNode.appendChild(newBlockElm.firstChild);\n\t\t\t\t\t\t\tnewBlockElm.appendChild(formatNode);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tnewBlockElm.appendChild(formatNode);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnewBlockElm.appendChild(formatNode);\n\n\t\t\t\t\t\treturn formatNode;\n\t\t\t\t\t});\n\n\t\t\t\t\tif (currentFormatNodes.length) {\n\t\t\t\t\t\tbr = dom.create('br');\n\t\t\t\t\t\tcurrentFormatNodes[0].appendChild(br);\n\t\t\t\t\t\tdom.replace(newBlockElm, blockElm);\n\n\t\t\t\t\t\trng.setStartBefore(br);\n\t\t\t\t\t\trng.setEndBefore(br);\n\t\t\t\t\t\teditor.selection.setRng(rng);\n\n\t\t\t\t\t\treturn br;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tfunction isTextBlock(node) {\n\t\t\t\t\treturn node && editor.schema.getTextBlockElements()[node.tagName];\n\t\t\t\t}\n\n\t\t\t\tif (!rng.collapsed) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tcontainer = rng.startContainer;\n\t\t\t\toffset = rng.startOffset;\n\t\t\t\tblockElm = dom.getParent(container, dom.isBlock);\n\t\t\t\tif (!isTextBlock(blockElm)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (container.nodeType == 1) {\n\t\t\t\t\tcontainer = container.childNodes[offset];\n\t\t\t\t\tif (container && container.tagName != 'BR') {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (isForward) {\n\t\t\t\t\t\tsibling = blockElm.nextSibling;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsibling = blockElm.previousSibling;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (dom.isEmpty(blockElm) && isTextBlock(sibling) && dom.isEmpty(sibling)) {\n\t\t\t\t\t\tif (cloneTextBlockWithFormats(blockElm, container)) {\n\t\t\t\t\t\t\tdom.remove(sibling);\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if (container.nodeType == 3) {\n\t\t\t\t\tpath = NodePath.create(blockElm, container);\n\t\t\t\t\tclonedBlockElm = blockElm.cloneNode(true);\n\t\t\t\t\tcontainer = NodePath.resolve(clonedBlockElm, path);\n\n\t\t\t\t\tif (isForward) {\n\t\t\t\t\t\tif (offset >= container.data.length) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcontainer.deleteData(offset, 1);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (offset <= 0) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcontainer.deleteData(offset - 1, 1);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (dom.isEmpty(clonedBlockElm)) {\n\t\t\t\t\t\treturn cloneTextBlockWithFormats(blockElm, container);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction customDelete(isForward) {\n\t\t\t\tvar mutationObserver, rng, caretElement;\n\n\t\t\t\tif (handleTextBlockMergeDelete(isForward)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tTools.each(editor.getBody().getElementsByTagName('*'), function(elm) {\n\t\t\t\t\t// Mark existing spans\n\t\t\t\t\tif (elm.tagName == 'SPAN') {\n\t\t\t\t\t\telm.setAttribute('mce-data-marked', 1);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Make sure all elements has a data-mce-style attribute\n\t\t\t\t\tif (!elm.hasAttribute('data-mce-style') && elm.hasAttribute('style')) {\n\t\t\t\t\t\teditor.dom.setAttrib(elm, 'style', editor.dom.getAttrib(elm, 'style'));\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Observe added nodes and style attribute changes\n\t\t\t\tmutationObserver = new MutationObserver(function() {});\n\t\t\t\tmutationObserver.observe(editor.getDoc(), {\n\t\t\t\t\tchildList: true,\n\t\t\t\t\tattributes: true,\n\t\t\t\t\tsubtree: true,\n\t\t\t\t\tattributeFilter: ['style']\n\t\t\t\t});\n\n\t\t\t\teditor.getDoc().execCommand(isForward ? 'ForwardDelete' : 'Delete', false, null);\n\n\t\t\t\trng = editor.selection.getRng();\n\t\t\t\tcaretElement = rng.startContainer.parentNode;\n\n\t\t\t\tTools.each(mutationObserver.takeRecords(), function(record) {\n\t\t\t\t\tif (!dom.isChildOf(record.target, editor.getBody())) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Restore style attribute to previous value\n\t\t\t\t\tif (record.attributeName == \"style\") {\n\t\t\t\t\t\tvar oldValue = record.target.getAttribute('data-mce-style');\n\n\t\t\t\t\t\tif (oldValue) {\n\t\t\t\t\t\t\trecord.target.setAttribute(\"style\", oldValue);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trecord.target.removeAttribute(\"style\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Remove all spans that aren't marked and retain selection\n\t\t\t\t\tTools.each(record.addedNodes, function(node) {\n\t\t\t\t\t\tif (node.nodeName == \"SPAN\" && !node.getAttribute('mce-data-marked')) {\n\t\t\t\t\t\t\tvar offset, container;\n\n\t\t\t\t\t\t\tif (node == caretElement) {\n\t\t\t\t\t\t\t\toffset = rng.startOffset;\n\t\t\t\t\t\t\t\tcontainer = node.firstChild;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tdom.remove(node, true);\n\n\t\t\t\t\t\t\tif (container) {\n\t\t\t\t\t\t\t\trng.setStart(container, offset);\n\t\t\t\t\t\t\t\trng.setEnd(container, offset);\n\t\t\t\t\t\t\t\teditor.selection.setRng(rng);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\tmutationObserver.disconnect();\n\n\t\t\t\t// Remove any left over marks\n\t\t\t\tTools.each(editor.dom.select('span[mce-data-marked]'), function(span) {\n\t\t\t\t\tspan.removeAttribute('mce-data-marked');\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction transactCustomDelete(isForward) {\n\t\t\t\teditor.undoManager.transact(function () {\n\t\t\t\t\tcustomDelete(isForward);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\teditor.on('keydown', function(e) {\n\t\t\t\tvar isForward = e.keyCode == DELETE, isMetaOrCtrl = e.ctrlKey || e.metaKey;\n\n\t\t\t\tif (!isDefaultPrevented(e) && (isForward || e.keyCode == BACKSPACE)) {\n\t\t\t\t\tvar rng = editor.selection.getRng(), container = rng.startContainer, offset = rng.startOffset;\n\n\t\t\t\t\t// Shift+Delete is cut\n\t\t\t\t\tif (isForward && e.shiftKey) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (handleLastBlockCharacterDelete(isForward, rng)) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Ignore non meta delete in the where there is text before/after the caret\n\t\t\t\t\tif (!isMetaOrCtrl && rng.collapsed && container.nodeType == 3) {\n\t\t\t\t\t\tif (isForward ? offset < container.data.length : offset > 0) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\tif (isMetaOrCtrl) {\n\t\t\t\t\t\teditor.selection.getSel().modify(\"extend\", isForward ? \"forward\" : \"backward\", e.metaKey ? \"lineboundary\" : \"word\");\n\t\t\t\t\t}\n\n\t\t\t\t\tcustomDelete(isForward);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Handle case where text is deleted by typing over\n\t\t\teditor.on('keypress', function(e) {\n\t\t\t\tif (!isDefaultPrevented(e) && !selection.isCollapsed() && e.charCode > 31 && !VK.metaKeyPressed(e)) {\n\t\t\t\t\tvar rng, currentFormatNodes, fragmentNode, blockParent, caretNode, charText;\n\n\t\t\t\t\trng = editor.selection.getRng();\n\t\t\t\t\tcharText = String.fromCharCode(e.charCode);\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t// Keep track of current format nodes\n\t\t\t\t\tcurrentFormatNodes = $(rng.startContainer).parents().filter(function(idx, node) {\n\t\t\t\t\t\treturn !!editor.schema.getTextInlineElements()[node.nodeName];\n\t\t\t\t\t});\n\n\t\t\t\t\tcustomDelete(true);\n\n\t\t\t\t\t// Check if the browser removed them\n\t\t\t\t\tcurrentFormatNodes = currentFormatNodes.filter(function(idx, node) {\n\t\t\t\t\t\treturn !$.contains(editor.getBody(), node);\n\t\t\t\t\t});\n\n\t\t\t\t\t// Then re-add them\n\t\t\t\t\tif (currentFormatNodes.length) {\n\t\t\t\t\t\tfragmentNode = dom.createFragment();\n\n\t\t\t\t\t\tcurrentFormatNodes.each(function(idx, formatNode) {\n\t\t\t\t\t\t\tformatNode = formatNode.cloneNode(false);\n\n\t\t\t\t\t\t\tif (fragmentNode.hasChildNodes()) {\n\t\t\t\t\t\t\t\tformatNode.appendChild(fragmentNode.firstChild);\n\t\t\t\t\t\t\t\tfragmentNode.appendChild(formatNode);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tcaretNode = formatNode;\n\t\t\t\t\t\t\t\tfragmentNode.appendChild(formatNode);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tfragmentNode.appendChild(formatNode);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tcaretNode.appendChild(editor.getDoc().createTextNode(charText));\n\n\t\t\t\t\t\t// Prevent edge case where older WebKit would add an extra BR element\n\t\t\t\t\t\tblockParent = dom.getParent(rng.startContainer, dom.isBlock);\n\t\t\t\t\t\tif (dom.isEmpty(blockParent)) {\n\t\t\t\t\t\t\t$(blockParent).empty().append(fragmentNode);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trng.insertNode(fragmentNode);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\trng.setStart(caretNode.firstChild, 1);\n\t\t\t\t\t\trng.setEnd(caretNode.firstChild, 1);\n\t\t\t\t\t\teditor.selection.setRng(rng);\n\t\t\t\t\t} else {\n\t\t\t\t\t\teditor.selection.setContent(charText);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teditor.addCommand('Delete', function() {\n\t\t\t\tcustomDelete();\n\t\t\t});\n\n\t\t\teditor.addCommand('ForwardDelete', function() {\n\t\t\t\tcustomDelete(true);\n\t\t\t});\n\n\t\t\t// Older WebKits doesn't properly handle the clipboard so we can't add the rest\n\t\t\tif (olderWebKit) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\teditor.on('dragstart', function(e) {\n\t\t\t\tdragStartRng = selection.getRng();\n\t\t\t\tsetMceInternalContent(e);\n\t\t\t});\n\n\t\t\teditor.on('drop', function(e) {\n\t\t\t\tif (!isDefaultPrevented(e)) {\n\t\t\t\t\tvar internalContent = getMceInternalContent(e);\n\n\t\t\t\t\tif (internalContent) {\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\t// Safari has a weird issue where drag/dropping images sometimes\n\t\t\t\t\t\t// produces a green plus icon. When this happens the caretRangeFromPoint\n\t\t\t\t\t\t// will return \"null\" even though the x, y coordinate is correct.\n\t\t\t\t\t\t// But if we detach the insert from the drop event we will get a proper range\n\t\t\t\t\t\tDelay.setEditorTimeout(editor, function() {\n\t\t\t\t\t\t\tvar pointRng = RangeUtils.getCaretRangeFromPoint(e.x, e.y, doc);\n\n\t\t\t\t\t\t\tif (dragStartRng) {\n\t\t\t\t\t\t\t\tselection.setRng(dragStartRng);\n\t\t\t\t\t\t\t\tdragStartRng = null;\n\t\t\t\t\t\t\t\ttransactCustomDelete();\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tselection.setRng(pointRng);\n\t\t\t\t\t\t\tinsertClipboardContents(internalContent.html);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teditor.on('cut', function(e) {\n\t\t\t\tif (!isDefaultPrevented(e) && e.clipboardData && !editor.selection.isCollapsed()) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.clipboardData.clearData();\n\t\t\t\t\te.clipboardData.setData('text/html', editor.selection.getContent());\n\t\t\t\t\te.clipboardData.setData('text/plain', editor.selection.getContent({format: 'text'}));\n\n\t\t\t\t\t// Needed delay for https://code.google.com/p/chromium/issues/detail?id=363288#c3\n\t\t\t\t\t// Nested delete/forwardDelete not allowed on execCommand(\"cut\")\n\t\t\t\t\t// This is ugly but not sure how to work around it otherwise\n\t\t\t\t\tDelay.setEditorTimeout(editor, function() {\n\t\t\t\t\t\ttransactCustomDelete(true);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Makes sure that the editor body becomes empty when backspace or delete is pressed in empty editors.\n\t\t *\n\t\t * For example:\n\t\t * <p><b>|</b></p>\n\t\t *\n\t\t * Or:\n\t\t * <h1>|</h1>\n\t\t *\n\t\t * Or:\n\t\t * [<h1></h1>]\n\t\t */\n\t\tfunction emptyEditorWhenDeleting() {\n\t\t\tfunction serializeRng(rng) {\n\t\t\t\tvar body = dom.create(\"body\");\n\t\t\t\tvar contents = rng.cloneContents();\n\t\t\t\tbody.appendChild(contents);\n\t\t\t\treturn selection.serializer.serialize(body, {format: 'html'});\n\t\t\t}\n\n\t\t\tfunction allContentsSelected(rng) {\n\t\t\t\tif (!rng.setStart) {\n\t\t\t\t\tif (rng.item) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar bodyRng = rng.duplicate();\n\t\t\t\t\tbodyRng.moveToElementText(editor.getBody());\n\t\t\t\t\treturn RangeUtils.compareRanges(rng, bodyRng);\n\t\t\t\t}\n\n\t\t\t\tvar selection = serializeRng(rng);\n\n\t\t\t\tvar allRng = dom.createRng();\n\t\t\t\tallRng.selectNode(editor.getBody());\n\n\t\t\t\tvar allSelection = serializeRng(allRng);\n\t\t\t\treturn selection === allSelection;\n\t\t\t}\n\n\t\t\teditor.on('keydown', function(e) {\n\t\t\t\tvar keyCode = e.keyCode, isCollapsed, body;\n\n\t\t\t\t// Empty the editor if it's needed for example backspace at <p><b>|</b></p>\n\t\t\t\tif (!isDefaultPrevented(e) && (keyCode == DELETE || keyCode == BACKSPACE)) {\n\t\t\t\t\tisCollapsed = editor.selection.isCollapsed();\n\t\t\t\t\tbody = editor.getBody();\n\n\t\t\t\t\t// Selection is collapsed but the editor isn't empty\n\t\t\t\t\tif (isCollapsed && !dom.isEmpty(body)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Selection isn't collapsed but not all the contents is selected\n\t\t\t\t\tif (!isCollapsed && !allContentsSelected(editor.selection.getRng())) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Manually empty the editor\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\teditor.setContent('');\n\n\t\t\t\t\tif (body.firstChild && dom.isBlock(body.firstChild)) {\n\t\t\t\t\t\teditor.selection.setCursorLocation(body.firstChild, 0);\n\t\t\t\t\t} else {\n\t\t\t\t\t\teditor.selection.setCursorLocation(body, 0);\n\t\t\t\t\t}\n\n\t\t\t\t\teditor.nodeChanged();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * WebKit doesn't select all the nodes in the body when you press Ctrl+A.\n\t\t * IE selects more than the contents <body>[<p>a</p>]</body> instead of <body><p>[a]</p]</body> see bug #6438\n\t\t * This selects the whole body so that backspace/delete logic will delete everything\n\t\t */\n\t\tfunction selectAll() {\n\t\t\teditor.shortcuts.add('meta+a', null, 'SelectAll');\n\t\t}\n\n\t\t/**\n\t\t * WebKit has a weird issue where it some times fails to properly convert keypresses to input method keystrokes.\n\t\t * The IME on Mac doesn't initialize when it doesn't fire a proper focus event.\n\t\t *\n\t\t * This seems to happen when the user manages to click the documentElement element then the window doesn't get proper focus until\n\t\t * you enter a character into the editor.\n\t\t *\n\t\t * It also happens when the first focus in made to the body.\n\t\t *\n\t\t * See: https://bugs.webkit.org/show_bug.cgi?id=83566\n\t\t */\n\t\tfunction inputMethodFocus() {\n\t\t\tif (!editor.settings.content_editable) {\n\t\t\t\t// Case 1 IME doesn't initialize if you focus the document\n\t\t\t\t// Disabled since it was interferring with the cE=false logic\n\t\t\t\t// Also coultn't reproduce the issue on Safari 9\n\t\t\t\t/*dom.bind(editor.getDoc(), 'focusin', function() {\n\t\t\t\t\tselection.setRng(selection.getRng());\n\t\t\t\t});*/\n\n\t\t\t\t// Case 2 IME doesn't initialize if you click the documentElement it also doesn't properly fire the focusin event\n\t\t\t\t// Needs to be both down/up due to weird rendering bug on Chrome Windows\n\t\t\t\tdom.bind(editor.getDoc(), 'mousedown mouseup', function(e) {\n\t\t\t\t\tvar rng;\n\n\t\t\t\t\tif (e.target == editor.getDoc().documentElement) {\n\t\t\t\t\t\trng = selection.getRng();\n\t\t\t\t\t\teditor.getBody().focus();\n\n\t\t\t\t\t\tif (e.type == 'mousedown') {\n\t\t\t\t\t\t\tif (CaretContainer.isCaretContainer(rng.startContainer)) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Edge case for mousedown, drag select and mousedown again within selection on Chrome Windows to render caret\n\t\t\t\t\t\t\tselection.placeCaretAt(e.clientX, e.clientY);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tselection.setRng(rng);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Backspacing in FireFox/IE from a paragraph into a horizontal rule results in a floating text node because the\n\t\t * browser just deletes the paragraph - the browser fails to merge the text node with a horizontal rule so it is\n\t\t * left there. TinyMCE sees a floating text node and wraps it in a paragraph on the key up event (ForceBlocks.js\n\t\t * addRootBlocks), meaning the action does nothing. With this code, FireFox/IE matche the behaviour of other\n\t\t * browsers.\n\t\t *\n\t\t * It also fixes a bug on Firefox where it's impossible to delete HR elements.\n\t\t */\n\t\tfunction removeHrOnBackspace() {\n\t\t\teditor.on('keydown', function(e) {\n\t\t\t\tif (!isDefaultPrevented(e) && e.keyCode === BACKSPACE) {\n\t\t\t\t\t// Check if there is any HR elements this is faster since getRng on IE 7 & 8 is slow\n\t\t\t\t\tif (!editor.getBody().getElementsByTagName('hr').length) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (selection.isCollapsed() && selection.getRng(true).startOffset === 0) {\n\t\t\t\t\t\tvar node = selection.getNode();\n\t\t\t\t\t\tvar previousSibling = node.previousSibling;\n\n\t\t\t\t\t\tif (node.nodeName == 'HR') {\n\t\t\t\t\t\t\tdom.remove(node);\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (previousSibling && previousSibling.nodeName && previousSibling.nodeName.toLowerCase() === \"hr\") {\n\t\t\t\t\t\t\tdom.remove(previousSibling);\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Firefox 3.x has an issue where the body element won't get proper focus if you click out\n\t\t * side it's rectangle.\n\t\t */\n\t\tfunction focusBody() {\n\t\t\t// Fix for a focus bug in FF 3.x where the body element\n\t\t\t// wouldn't get proper focus if the user clicked on the HTML element\n\t\t\tif (!window.Range.prototype.getClientRects) { // Detect getClientRects got introduced in FF 4\n\t\t\t\teditor.on('mousedown', function(e) {\n\t\t\t\t\tif (!isDefaultPrevented(e) && e.target.nodeName === \"HTML\") {\n\t\t\t\t\t\tvar body = editor.getBody();\n\n\t\t\t\t\t\t// Blur the body it's focused but not correctly focused\n\t\t\t\t\t\tbody.blur();\n\n\t\t\t\t\t\t// Refocus the body after a little while\n\t\t\t\t\t\tDelay.setEditorTimeout(editor, function() {\n\t\t\t\t\t\t\tbody.focus();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * WebKit has a bug where it isn't possible to select image, hr or anchor elements\n\t\t * by clicking on them so we need to fake that.\n\t\t */\n\t\tfunction selectControlElements() {\n\t\t\teditor.on('click', function(e) {\n\t\t\t\tvar target = e.target;\n\n\t\t\t\t// Workaround for bug, http://bugs.webkit.org/show_bug.cgi?id=12250\n\t\t\t\t// WebKit can't even do simple things like selecting an image\n\t\t\t\t// Needs to be the setBaseAndExtend or it will fail to select floated images\n\t\t\t\tif (/^(IMG|HR)$/.test(target.nodeName) && dom.getContentEditableParent(target) !== \"false\") {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tselection.getSel().setBaseAndExtent(target, 0, target, 1);\n\t\t\t\t\teditor.nodeChanged();\n\t\t\t\t}\n\n\t\t\t\tif (target.nodeName == 'A' && dom.hasClass(target, 'mce-item-anchor')) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tselection.select(target);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Fixes a Gecko bug where the style attribute gets added to the wrong element when deleting between two block elements.\n\t\t *\n\t\t * Fixes do backspace/delete on this:\n\t\t * <p>bla[ck</p><p style=\"color:red\">r]ed</p>\n\t\t *\n\t\t * Would become:\n\t\t * <p>bla|ed</p>\n\t\t *\n\t\t * Instead of:\n\t\t * <p style=\"color:red\">bla|ed</p>\n\t\t */\n\t\tfunction removeStylesWhenDeletingAcrossBlockElements() {\n\t\t\tfunction getAttributeApplyFunction() {\n\t\t\t\tvar template = dom.getAttribs(selection.getStart().cloneNode(false));\n\n\t\t\t\treturn function() {\n\t\t\t\t\tvar target = selection.getStart();\n\n\t\t\t\t\tif (target !== editor.getBody()) {\n\t\t\t\t\t\tdom.setAttrib(target, \"style\", null);\n\n\t\t\t\t\t\teach(template, function(attr) {\n\t\t\t\t\t\t\ttarget.setAttributeNode(attr.cloneNode(true));\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tfunction isSelectionAcrossElements() {\n\t\t\t\treturn !selection.isCollapsed() &&\n\t\t\t\t\tdom.getParent(selection.getStart(), dom.isBlock) != dom.getParent(selection.getEnd(), dom.isBlock);\n\t\t\t}\n\n\t\t\teditor.on('keypress', function(e) {\n\t\t\t\tvar applyAttributes;\n\n\t\t\t\tif (!isDefaultPrevented(e) && (e.keyCode == 8 || e.keyCode == 46) && isSelectionAcrossElements()) {\n\t\t\t\t\tapplyAttributes = getAttributeApplyFunction();\n\t\t\t\t\teditor.getDoc().execCommand('delete', false, null);\n\t\t\t\t\tapplyAttributes();\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tdom.bind(editor.getDoc(), 'cut', function(e) {\n\t\t\t\tvar applyAttributes;\n\n\t\t\t\tif (!isDefaultPrevented(e) && isSelectionAcrossElements()) {\n\t\t\t\t\tapplyAttributes = getAttributeApplyFunction();\n\n\t\t\t\t\tDelay.setEditorTimeout(editor, function() {\n\t\t\t\t\t\tapplyAttributes();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Screen readers on IE needs to have the role application set on the body.\n\t\t */\n\t\tfunction ensureBodyHasRoleApplication() {\n\t\t\tdocument.body.setAttribute(\"role\", \"application\");\n\t\t}\n\n\t\t/**\n\t\t * Backspacing into a table behaves differently depending upon browser type.\n\t\t * Therefore, disable Backspace when cursor immediately follows a table.\n\t\t */\n\t\tfunction disableBackspaceIntoATable() {\n\t\t\teditor.on('keydown', function(e) {\n\t\t\t\tif (!isDefaultPrevented(e) && e.keyCode === BACKSPACE) {\n\t\t\t\t\tif (selection.isCollapsed() && selection.getRng(true).startOffset === 0) {\n\t\t\t\t\t\tvar previousSibling = selection.getNode().previousSibling;\n\t\t\t\t\t\tif (previousSibling && previousSibling.nodeName && previousSibling.nodeName.toLowerCase() === \"table\") {\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Old IE versions can't properly render BR elements in PRE tags white in contentEditable mode. So this\n\t\t * logic adds a \\n before the BR so that it will get rendered.\n\t\t */\n\t\tfunction addNewLinesBeforeBrInPre() {\n\t\t\t// IE8+ rendering mode does the right thing with BR in PRE\n\t\t\tif (getDocumentMode() > 7) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Enable display: none in area and add a specific class that hides all BR elements in PRE to\n\t\t\t// avoid the caret from getting stuck at the BR elements while pressing the right arrow key\n\t\t\tsetEditorCommandState('RespectVisibilityInDesign', true);\n\t\t\teditor.contentStyles.push('.mceHideBrInPre pre br {display: none}');\n\t\t\tdom.addClass(editor.getBody(), 'mceHideBrInPre');\n\n\t\t\t// Adds a \\n before all BR elements in PRE to get them visual\n\t\t\tparser.addNodeFilter('pre', function(nodes) {\n\t\t\t\tvar i = nodes.length, brNodes, j, brElm, sibling;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tbrNodes = nodes[i].getAll('br');\n\t\t\t\t\tj = brNodes.length;\n\t\t\t\t\twhile (j--) {\n\t\t\t\t\t\tbrElm = brNodes[j];\n\n\t\t\t\t\t\t// Add \\n before BR in PRE elements on older IE:s so the new lines get rendered\n\t\t\t\t\t\tsibling = brElm.prev;\n\t\t\t\t\t\tif (sibling && sibling.type === 3 && sibling.value.charAt(sibling.value - 1) != '\\n') {\n\t\t\t\t\t\t\tsibling.value += '\\n';\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tbrElm.parent.insert(new Node('#text', 3), brElm, true).value = '\\n';\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Removes any \\n before BR elements in PRE since other browsers and in contentEditable=false mode they will be visible\n\t\t\tserializer.addNodeFilter('pre', function(nodes) {\n\t\t\t\tvar i = nodes.length, brNodes, j, brElm, sibling;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tbrNodes = nodes[i].getAll('br');\n\t\t\t\t\tj = brNodes.length;\n\t\t\t\t\twhile (j--) {\n\t\t\t\t\t\tbrElm = brNodes[j];\n\t\t\t\t\t\tsibling = brElm.prev;\n\t\t\t\t\t\tif (sibling && sibling.type == 3) {\n\t\t\t\t\t\t\tsibling.value = sibling.value.replace(/\\r?\\n$/, '');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Moves style width/height to attribute width/height when the user resizes an image on IE.\n\t\t */\n\t\tfunction removePreSerializedStylesWhenSelectingControls() {\n\t\t\tdom.bind(editor.getBody(), 'mouseup', function() {\n\t\t\t\tvar value, node = selection.getNode();\n\n\t\t\t\t// Moved styles to attributes on IMG eements\n\t\t\t\tif (node.nodeName == 'IMG') {\n\t\t\t\t\t// Convert style width to width attribute\n\t\t\t\t\tif ((value = dom.getStyle(node, 'width'))) {\n\t\t\t\t\t\tdom.setAttrib(node, 'width', value.replace(/[^0-9%]+/g, ''));\n\t\t\t\t\t\tdom.setStyle(node, 'width', '');\n\t\t\t\t\t}\n\n\t\t\t\t\t// Convert style height to height attribute\n\t\t\t\t\tif ((value = dom.getStyle(node, 'height'))) {\n\t\t\t\t\t\tdom.setAttrib(node, 'height', value.replace(/[^0-9%]+/g, ''));\n\t\t\t\t\t\tdom.setStyle(node, 'height', '');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Removes a blockquote when backspace is pressed at the beginning of it.\n\t\t *\n\t\t * For example:\n\t\t * <blockquote><p>|x</p></blockquote>\n\t\t *\n\t\t * Becomes:\n\t\t * <p>|x</p>\n\t\t */\n\t\tfunction removeBlockQuoteOnBackSpace() {\n\t\t\t// Add block quote deletion handler\n\t\t\teditor.on('keydown', function(e) {\n\t\t\t\tvar rng, container, offset, root, parent;\n\n\t\t\t\tif (isDefaultPrevented(e) || e.keyCode != VK.BACKSPACE) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\trng = selection.getRng();\n\t\t\t\tcontainer = rng.startContainer;\n\t\t\t\toffset = rng.startOffset;\n\t\t\t\troot = dom.getRoot();\n\t\t\t\tparent = container;\n\n\t\t\t\tif (!rng.collapsed || offset !== 0) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\twhile (parent && parent.parentNode && parent.parentNode.firstChild == parent && parent.parentNode != root) {\n\t\t\t\t\tparent = parent.parentNode;\n\t\t\t\t}\n\n\t\t\t\t// Is the cursor at the beginning of a blockquote?\n\t\t\t\tif (parent.tagName === 'BLOCKQUOTE') {\n\t\t\t\t\t// Remove the blockquote\n\t\t\t\t\teditor.formatter.toggle('blockquote', null, parent);\n\n\t\t\t\t\t// Move the caret to the beginning of container\n\t\t\t\t\trng = dom.createRng();\n\t\t\t\t\trng.setStart(container, 0);\n\t\t\t\t\trng.setEnd(container, 0);\n\t\t\t\t\tselection.setRng(rng);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Sets various Gecko editing options on mouse down and before a execCommand to disable inline table editing that is broken etc.\n\t\t */\n\t\tfunction setGeckoEditingOptions() {\n\t\t\tfunction setOpts() {\n\t\t\t\trefreshContentEditable();\n\n\t\t\t\tsetEditorCommandState(\"StyleWithCSS\", false);\n\t\t\t\tsetEditorCommandState(\"enableInlineTableEditing\", false);\n\n\t\t\t\tif (!settings.object_resizing) {\n\t\t\t\t\tsetEditorCommandState(\"enableObjectResizing\", false);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!settings.readonly) {\n\t\t\t\teditor.on('BeforeExecCommand MouseDown', setOpts);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Fixes a gecko link bug, when a link is placed at the end of block elements there is\n\t\t * no way to move the caret behind the link. This fix adds a bogus br element after the link.\n\t\t *\n\t\t * For example this:\n\t\t * <p><b><a href=\"#\">x</a></b></p>\n\t\t *\n\t\t * Becomes this:\n\t\t * <p><b><a href=\"#\">x</a></b><br></p>\n\t\t */\n\t\tfunction addBrAfterLastLinks() {\n\t\t\tfunction fixLinks() {\n\t\t\t\teach(dom.select('a'), function(node) {\n\t\t\t\t\tvar parentNode = node.parentNode, root = dom.getRoot();\n\n\t\t\t\t\tif (parentNode.lastChild === node) {\n\t\t\t\t\t\twhile (parentNode && !dom.isBlock(parentNode)) {\n\t\t\t\t\t\t\tif (parentNode.parentNode.lastChild !== parentNode || parentNode === root) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tparentNode = parentNode.parentNode;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdom.add(parentNode, 'br', {'data-mce-bogus': 1});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\teditor.on('SetContent ExecCommand', function(e) {\n\t\t\t\tif (e.type == \"setcontent\" || e.command === 'mceInsertLink') {\n\t\t\t\t\tfixLinks();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * WebKit will produce DIV elements here and there by default. But since TinyMCE uses paragraphs by\n\t\t * default we want to change that behavior.\n\t\t */\n\t\tfunction setDefaultBlockType() {\n\t\t\tif (settings.forced_root_block) {\n\t\t\t\teditor.on('init', function() {\n\t\t\t\t\tsetEditorCommandState('DefaultParagraphSeparator', settings.forced_root_block);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Deletes the selected image on IE instead of navigating to previous page.\n\t\t */\n\t\tfunction deleteControlItemOnBackSpace() {\n\t\t\teditor.on('keydown', function(e) {\n\t\t\t\tvar rng;\n\n\t\t\t\tif (!isDefaultPrevented(e) && e.keyCode == BACKSPACE) {\n\t\t\t\t\trng = editor.getDoc().selection.createRange();\n\t\t\t\t\tif (rng && rng.item) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\teditor.undoManager.beforeChange();\n\t\t\t\t\t\tdom.remove(rng.item(0));\n\t\t\t\t\t\teditor.undoManager.add();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * IE10 doesn't properly render block elements with the right height until you add contents to them.\n\t\t * This fixes that by adding a padding-right to all empty text block elements.\n\t\t * See: https://connect.microsoft.com/IE/feedback/details/743881\n\t\t */\n\t\tfunction renderEmptyBlocksFix() {\n\t\t\tvar emptyBlocksCSS;\n\n\t\t\t// IE10+\n\t\t\tif (getDocumentMode() >= 10) {\n\t\t\t\temptyBlocksCSS = '';\n\t\t\t\teach('p div h1 h2 h3 h4 h5 h6'.split(' '), function(name, i) {\n\t\t\t\t\temptyBlocksCSS += (i > 0 ? ',' : '') + name + ':empty';\n\t\t\t\t});\n\n\t\t\t\teditor.contentStyles.push(emptyBlocksCSS + '{padding-right: 1px !important}');\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Old IE versions can't retain contents within noscript elements so this logic will store the contents\n\t\t * as a attribute and the insert that value as it's raw text when the DOM is serialized.\n\t\t */\n\t\tfunction keepNoScriptContents() {\n\t\t\tif (getDocumentMode() < 9) {\n\t\t\t\tparser.addNodeFilter('noscript', function(nodes) {\n\t\t\t\t\tvar i = nodes.length, node, textNode;\n\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tnode = nodes[i];\n\t\t\t\t\t\ttextNode = node.firstChild;\n\n\t\t\t\t\t\tif (textNode) {\n\t\t\t\t\t\t\tnode.attr('data-mce-innertext', textNode.value);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tserializer.addNodeFilter('noscript', function(nodes) {\n\t\t\t\t\tvar i = nodes.length, node, textNode, value;\n\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tnode = nodes[i];\n\t\t\t\t\t\ttextNode = nodes[i].firstChild;\n\n\t\t\t\t\t\tif (textNode) {\n\t\t\t\t\t\t\ttextNode.value = Entities.decode(textNode.value);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Old IE can't retain noscript value so an attribute is used to store it\n\t\t\t\t\t\t\tvalue = node.attributes.map['data-mce-innertext'];\n\t\t\t\t\t\t\tif (value) {\n\t\t\t\t\t\t\t\tnode.attr('data-mce-innertext', null);\n\t\t\t\t\t\t\t\ttextNode = new Node('#text', 3);\n\t\t\t\t\t\t\t\ttextNode.value = value;\n\t\t\t\t\t\t\t\ttextNode.raw = true;\n\t\t\t\t\t\t\t\tnode.append(textNode);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * IE has an issue where you can't select/move the caret by clicking outside the body if the document is in standards mode.\n\t\t */\n\t\tfunction fixCaretSelectionOfDocumentElementOnIe() {\n\t\t\tvar doc = dom.doc, body = doc.body, started, startRng, htmlElm;\n\n\t\t\t// Return range from point or null if it failed\n\t\t\tfunction rngFromPoint(x, y) {\n\t\t\t\tvar rng = body.createTextRange();\n\n\t\t\t\ttry {\n\t\t\t\t\trng.moveToPoint(x, y);\n\t\t\t\t} catch (ex) {\n\t\t\t\t\t// IE sometimes throws and exception, so lets just ignore it\n\t\t\t\t\trng = null;\n\t\t\t\t}\n\n\t\t\t\treturn rng;\n\t\t\t}\n\n\t\t\t// Fires while the selection is changing\n\t\t\tfunction selectionChange(e) {\n\t\t\t\tvar pointRng;\n\n\t\t\t\t// Check if the button is down or not\n\t\t\t\tif (e.button) {\n\t\t\t\t\t// Create range from mouse position\n\t\t\t\t\tpointRng = rngFromPoint(e.x, e.y);\n\n\t\t\t\t\tif (pointRng) {\n\t\t\t\t\t\t// Check if pointRange is before/after selection then change the endPoint\n\t\t\t\t\t\tif (pointRng.compareEndPoints('StartToStart', startRng) > 0) {\n\t\t\t\t\t\t\tpointRng.setEndPoint('StartToStart', startRng);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tpointRng.setEndPoint('EndToEnd', startRng);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tpointRng.select();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tendSelection();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Removes listeners\n\t\t\tfunction endSelection() {\n\t\t\t\tvar rng = doc.selection.createRange();\n\n\t\t\t\t// If the range is collapsed then use the last start range\n\t\t\t\tif (startRng && !rng.item && rng.compareEndPoints('StartToEnd', rng) === 0) {\n\t\t\t\t\tstartRng.select();\n\t\t\t\t}\n\n\t\t\t\tdom.unbind(doc, 'mouseup', endSelection);\n\t\t\t\tdom.unbind(doc, 'mousemove', selectionChange);\n\t\t\t\tstartRng = started = 0;\n\t\t\t}\n\n\t\t\t// Make HTML element unselectable since we are going to handle selection by hand\n\t\t\tdoc.documentElement.unselectable = true;\n\n\t\t\t// Detect when user selects outside BODY\n\t\t\tdom.bind(doc, 'mousedown contextmenu', function(e) {\n\t\t\t\tif (e.target.nodeName === 'HTML') {\n\t\t\t\t\tif (started) {\n\t\t\t\t\t\tendSelection();\n\t\t\t\t\t}\n\n\t\t\t\t\t// Detect vertical scrollbar, since IE will fire a mousedown on the scrollbar and have target set as HTML\n\t\t\t\t\thtmlElm = doc.documentElement;\n\t\t\t\t\tif (htmlElm.scrollHeight > htmlElm.clientHeight) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tstarted = 1;\n\t\t\t\t\t// Setup start position\n\t\t\t\t\tstartRng = rngFromPoint(e.x, e.y);\n\t\t\t\t\tif (startRng) {\n\t\t\t\t\t\t// Listen for selection change events\n\t\t\t\t\t\tdom.bind(doc, 'mouseup', endSelection);\n\t\t\t\t\t\tdom.bind(doc, 'mousemove', selectionChange);\n\n\t\t\t\t\t\tdom.getRoot().focus();\n\t\t\t\t\t\tstartRng.select();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Fixes selection issues where the caret can be placed between two inline elements like <b>a</b>|<b>b</b>\n\t\t * this fix will lean the caret right into the closest inline element.\n\t\t */\n\t\tfunction normalizeSelection() {\n\t\t\t// Normalize selection for example <b>a</b><i>|a</i> becomes <b>a|</b><i>a</i> except for Ctrl+A since it selects everything\n\t\t\teditor.on('keyup focusin mouseup', function(e) {\n\t\t\t\tif (e.keyCode != 65 || !VK.metaKeyPressed(e)) {\n\t\t\t\t\tselection.normalize();\n\t\t\t\t}\n\t\t\t}, true);\n\t\t}\n\n\t\t/**\n\t\t * Forces Gecko to render a broken image icon if it fails to load an image.\n\t\t */\n\t\tfunction showBrokenImageIcon() {\n\t\t\teditor.contentStyles.push(\n\t\t\t\t'img:-moz-broken {' +\n\t\t\t\t\t'-moz-force-broken-image-icon:1;' +\n\t\t\t\t\t'min-width:24px;' +\n\t\t\t\t\t'min-height:24px' +\n\t\t\t\t'}'\n\t\t\t);\n\t\t}\n\n\t\t/**\n\t\t * iOS has a bug where it's impossible to type if the document has a touchstart event\n\t\t * bound and the user touches the document while having the on screen keyboard visible.\n\t\t *\n\t\t * The touch event moves the focus to the parent document while having the caret inside the iframe\n\t\t * this fix moves the focus back into the iframe document.\n\t\t */\n\t\tfunction restoreFocusOnKeyDown() {\n\t\t\tif (!editor.inline) {\n\t\t\t\teditor.on('keydown', function() {\n\t\t\t\t\tif (document.activeElement == document.body) {\n\t\t\t\t\t\teditor.getWin().focus();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * IE 11 has an annoying issue where you can't move focus into the editor\n\t\t * by clicking on the white area HTML element. We used to be able to to fix this with\n\t\t * the fixCaretSelectionOfDocumentElementOnIe fix. But since M$ removed the selection\n\t\t * object it's not possible anymore. So we need to hack in a ungly CSS to force the\n\t\t * body to be at least 150px. If the user clicks the HTML element out side this 150px region\n\t\t * we simply move the focus into the first paragraph. Not ideal since you loose the\n\t\t * positioning of the caret but goot enough for most cases.\n\t\t */\n\t\tfunction bodyHeight() {\n\t\t\tif (!editor.inline) {\n\t\t\t\teditor.contentStyles.push('body {min-height: 150px}');\n\t\t\t\teditor.on('click', function(e) {\n\t\t\t\t\tvar rng;\n\n\t\t\t\t\tif (e.target.nodeName == 'HTML') {\n\t\t\t\t\t\t// Edge seems to only need focus if we set the range\n\t\t\t\t\t\t// the caret will become invisible and moved out of the iframe!!\n\t\t\t\t\t\tif (Env.ie > 11) {\n\t\t\t\t\t\t\teditor.getBody().focus();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Need to store away non collapsed ranges since the focus call will mess that up see #7382\n\t\t\t\t\t\trng = editor.selection.getRng();\n\t\t\t\t\t\teditor.getBody().focus();\n\t\t\t\t\t\teditor.selection.setRng(rng);\n\t\t\t\t\t\teditor.selection.normalize();\n\t\t\t\t\t\teditor.nodeChanged();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Firefox on Mac OS will move the browser back to the previous page if you press CMD+Left arrow.\n\t\t * You might then loose all your work so we need to block that behavior and replace it with our own.\n\t\t */\n\t\tfunction blockCmdArrowNavigation() {\n\t\t\tif (Env.mac) {\n\t\t\t\teditor.on('keydown', function(e) {\n\t\t\t\t\tif (VK.metaKeyPressed(e) && !e.shiftKey && (e.keyCode == 37 || e.keyCode == 39)) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\teditor.selection.getSel().modify('move', e.keyCode == 37 ? 'backward' : 'forward', 'lineboundary');\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Disables the autolinking in IE 9+ this is then re-enabled by the autolink plugin.\n\t\t */\n\t\tfunction disableAutoUrlDetect() {\n\t\t\tsetEditorCommandState(\"AutoUrlDetect\", false);\n\t\t}\n\n\t\t/**\n\t\t * iOS 7.1 introduced two new bugs:\n\t\t * 1) It's possible to open links within a contentEditable area by clicking on them.\n\t\t * 2) If you hold down the finger it will display the link/image touch callout menu.\n\t\t */\n\t\tfunction tapLinksAndImages() {\n\t\t\teditor.on('click', function(e) {\n\t\t\t\tvar elm = e.target;\n\n\t\t\t\tdo {\n\t\t\t\t\tif (elm.tagName === 'A') {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t} while ((elm = elm.parentNode));\n\t\t\t});\n\n\t\t\teditor.contentStyles.push('.mce-content-body {-webkit-touch-callout: none}');\n\t\t}\n\n\t\t/**\n\t\t * iOS Safari and possible other browsers have a bug where it won't fire\n\t\t * a click event when a contentEditable is focused. This function fakes click events\n\t\t * by using touchstart/touchend and measuring the time and distance travelled.\n\t\t */\n\t\t/*\n\t\tfunction touchClickEvent() {\n\t\t\teditor.on('touchstart', function(e) {\n\t\t\t\tvar elm, time, startTouch, changedTouches;\n\n\t\t\t\telm = e.target;\n\t\t\t\ttime = new Date().getTime();\n\t\t\t\tchangedTouches = e.changedTouches;\n\n\t\t\t\tif (!changedTouches || changedTouches.length > 1) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tstartTouch = changedTouches[0];\n\n\t\t\t\teditor.once('touchend', function(e) {\n\t\t\t\t\tvar endTouch = e.changedTouches[0], args;\n\n\t\t\t\t\tif (new Date().getTime() - time > 500) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (Math.abs(startTouch.clientX - endTouch.clientX) > 5) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (Math.abs(startTouch.clientY - endTouch.clientY) > 5) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\targs = {\n\t\t\t\t\t\ttarget: elm\n\t\t\t\t\t};\n\n\t\t\t\t\teach('pageX pageY clientX clientY screenX screenY'.split(' '), function(key) {\n\t\t\t\t\t\targs[key] = endTouch[key];\n\t\t\t\t\t});\n\n\t\t\t\t\targs = editor.fire('click', args);\n\n\t\t\t\t\tif (!args.isDefaultPrevented()) {\n\t\t\t\t\t\t// iOS WebKit can't place the caret properly once\n\t\t\t\t\t\t// you bind touch events so we need to do this manually\n\t\t\t\t\t\t// TODO: Expand to the closest word? Touble tap still works.\n\t\t\t\t\t\teditor.selection.placeCaretAt(endTouch.clientX, endTouch.clientY);\n\t\t\t\t\t\teditor.nodeChanged();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t\t*/\n\n\t\t/**\n\t\t * WebKit has a bug where it will allow forms to be submitted if they are inside a contentEditable element.\n\t\t * For example this: <form><button></form>\n\t\t */\n\t\tfunction blockFormSubmitInsideEditor() {\n\t\t\teditor.on('init', function() {\n\t\t\t\teditor.dom.bind(editor.getBody(), 'submit', function(e) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Sometimes WebKit/Blink generates BR elements with the Apple-interchange-newline class.\n\t\t *\n\t\t * Scenario:\n\t\t *  1) Create a table 2x2.\n\t\t *  2) Select and copy cells A2-B2.\n\t\t *  3) Paste and it will add BR element to table cell.\n\t\t */\n\t\tfunction removeAppleInterchangeBrs() {\n\t\t\tparser.addNodeFilter('br', function(nodes) {\n\t\t\t\tvar i = nodes.length;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tif (nodes[i].attr('class') == 'Apple-interchange-newline') {\n\t\t\t\t\t\tnodes[i].remove();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * IE cannot set custom contentType's on drag events, and also does not properly drag/drop between\n\t\t * editors. This uses a special data:text/mce-internal URL to pass data when drag/drop between editors.\n\t\t */\n\t\tfunction ieInternalDragAndDrop() {\n\t\t\teditor.on('dragstart', function(e) {\n\t\t\t\tsetMceInternalContent(e);\n\t\t\t});\n\n\t\t\teditor.on('drop', function(e) {\n\t\t\t\tif (!isDefaultPrevented(e)) {\n\t\t\t\t\tvar internalContent = getMceInternalContent(e);\n\n\t\t\t\t\tif (internalContent && internalContent.id != editor.id) {\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\tvar rng = RangeUtils.getCaretRangeFromPoint(e.x, e.y, editor.getDoc());\n\t\t\t\t\t\tselection.setRng(rng);\n\t\t\t\t\t\tinsertClipboardContents(internalContent.html);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfunction refreshContentEditable() {\n\t\t\t// No-op since Mozilla seems to have fixed the caret repaint issues\n\t\t}\n\n\t\tfunction isHidden() {\n\t\t\tvar sel;\n\n\t\t\tif (!isGecko) {\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\t// Weird, wheres that cursor selection?\n\t\t\tsel = editor.selection.getSel();\n\t\t\treturn (!sel || !sel.rangeCount || sel.rangeCount === 0);\n\t\t}\n\n\t\t/**\n\t\t * Properly empties the editor if all contents is selected and deleted this to\n\t\t * prevent empty paragraphs from being produced at beginning/end of contents.\n\t\t */\n\t\tfunction emptyEditorOnDeleteEverything() {\n\t\t\tfunction isEverythingSelected(editor) {\n\t\t\t\tvar caretWalker = new CaretWalker(editor.getBody());\n\t\t\t\tvar rng = editor.selection.getRng();\n\t\t\t\tvar startCaretPos = CaretPosition.fromRangeStart(rng);\n\t\t\t\tvar endCaretPos = CaretPosition.fromRangeEnd(rng);\n\n\t\t\t\treturn !editor.selection.isCollapsed() && !caretWalker.prev(startCaretPos) && !caretWalker.next(endCaretPos);\n\t\t\t}\n\n\t\t\t// Type over case delete and insert this won't cover typeover with a IME but at least it covers the common case\n\t\t\teditor.on('keypress', function (e) {\n\t\t\t\tif (!isDefaultPrevented(e) && !selection.isCollapsed() && e.charCode > 31 && !VK.metaKeyPressed(e)) {\n\t\t\t\t\tif (isEverythingSelected(editor)) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\teditor.setContent(String.fromCharCode(e.charCode));\n\t\t\t\t\t\teditor.selection.select(editor.getBody(), true);\n\t\t\t\t\t\teditor.selection.collapse(false);\n\t\t\t\t\t\teditor.nodeChanged();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teditor.on('keydown', function (e) {\n\t\t\t\tvar keyCode = e.keyCode;\n\n\t\t\t\tif (!isDefaultPrevented(e) && (keyCode == DELETE || keyCode == BACKSPACE)) {\n\t\t\t\t\tif (isEverythingSelected(editor)) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\teditor.setContent('');\n\t\t\t\t\t\teditor.nodeChanged();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// All browsers\n\t\tremoveBlockQuoteOnBackSpace();\n\t\temptyEditorWhenDeleting();\n\n\t\t// Windows phone will return a range like [body, 0] on mousedown so\n\t\t// it will always normalize to the wrong location\n\t\tif (!Env.windowsPhone) {\n\t\t\tnormalizeSelection();\n\t\t}\n\n\t\t// WebKit\n\t\tif (isWebKit) {\n\t\t\temptyEditorOnDeleteEverything();\n\t\t\tcleanupStylesWhenDeleting();\n\t\t\tinputMethodFocus();\n\t\t\tselectControlElements();\n\t\t\tsetDefaultBlockType();\n\t\t\tblockFormSubmitInsideEditor();\n\t\t\tdisableBackspaceIntoATable();\n\t\t\tremoveAppleInterchangeBrs();\n\n\t\t\t//touchClickEvent();\n\n\t\t\t// iOS\n\t\t\tif (Env.iOS) {\n\t\t\t\trestoreFocusOnKeyDown();\n\t\t\t\tbodyHeight();\n\t\t\t\ttapLinksAndImages();\n\t\t\t} else {\n\t\t\t\tselectAll();\n\t\t\t}\n\t\t}\n\n\t\t// IE\n\t\tif (isIE && Env.ie < 11) {\n\t\t\tremoveHrOnBackspace();\n\t\t\tensureBodyHasRoleApplication();\n\t\t\taddNewLinesBeforeBrInPre();\n\t\t\tremovePreSerializedStylesWhenSelectingControls();\n\t\t\tdeleteControlItemOnBackSpace();\n\t\t\trenderEmptyBlocksFix();\n\t\t\tkeepNoScriptContents();\n\t\t\tfixCaretSelectionOfDocumentElementOnIe();\n\t\t}\n\n\t\tif (Env.ie >= 11) {\n\t\t\tbodyHeight();\n\t\t\tdisableBackspaceIntoATable();\n\t\t}\n\n\t\tif (Env.ie) {\n\t\t\tselectAll();\n\t\t\tdisableAutoUrlDetect();\n\t\t\tieInternalDragAndDrop();\n\t\t}\n\n\t\t// Gecko\n\t\tif (isGecko) {\n\t\t\temptyEditorOnDeleteEverything();\n\t\t\tremoveHrOnBackspace();\n\t\t\tfocusBody();\n\t\t\tremoveStylesWhenDeletingAcrossBlockElements();\n\t\t\tsetGeckoEditingOptions();\n\t\t\taddBrAfterLastLinks();\n\t\t\tshowBrokenImageIcon();\n\t\t\tblockCmdArrowNavigation();\n\t\t\tdisableBackspaceIntoATable();\n\t\t}\n\n\t\treturn {\n\t\t\trefreshContentEditable: refreshContentEditable,\n\t\t\tisHidden: isHidden\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/EditorObservable.js\n\n/**\n * EditorObservable.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This mixin contains the event logic for the tinymce.Editor class.\n *\n * @mixin tinymce.EditorObservable\n * @extends tinymce.util.Observable\n */\ndefine(\"tinymce/EditorObservable\", [\n\t\"tinymce/util/Observable\",\n\t\"tinymce/dom/DOMUtils\",\n\t\"tinymce/util/Tools\"\n], function(Observable, DOMUtils, Tools) {\n\tvar DOM = DOMUtils.DOM, customEventRootDelegates;\n\n\t/**\n\t * Returns the event target so for the specified event. Some events fire\n\t * only on document, some fire on documentElement etc. This also handles the\n\t * custom event root setting where it returns that element instead of the body.\n\t *\n\t * @private\n\t * @param {tinymce.Editor} editor Editor instance to get event target from.\n\t * @param {String} eventName Name of the event for example \"click\".\n\t * @return {Element/Document} HTML Element or document target to bind on.\n\t */\n\tfunction getEventTarget(editor, eventName) {\n\t\tif (eventName == 'selectionchange') {\n\t\t\treturn editor.getDoc();\n\t\t}\n\n\t\t// Need to bind mousedown/mouseup etc to document not body in iframe mode\n\t\t// Since the user might click on the HTML element not the BODY\n\t\tif (!editor.inline && /^mouse|touch|click|contextmenu|drop|dragover|dragend/.test(eventName)) {\n\t\t\treturn editor.getDoc().documentElement;\n\t\t}\n\n\t\t// Bind to event root instead of body if it's defined\n\t\tif (editor.settings.event_root) {\n\t\t\tif (!editor.eventRoot) {\n\t\t\t\teditor.eventRoot = DOM.select(editor.settings.event_root)[0];\n\t\t\t}\n\n\t\t\treturn editor.eventRoot;\n\t\t}\n\n\t\treturn editor.getBody();\n\t}\n\n\t/**\n\t * Binds a event delegate for the specified name this delegate will fire\n\t * the event to the editor dispatcher.\n\t *\n\t * @private\n\t * @param {tinymce.Editor} editor Editor instance to get event target from.\n\t * @param {String} eventName Name of the event for example \"click\".\n\t */\n\tfunction bindEventDelegate(editor, eventName) {\n\t\tvar eventRootElm = getEventTarget(editor, eventName), delegate;\n\n\t\tfunction isListening(editor) {\n\t\t\treturn !editor.hidden && !editor.readonly;\n\t\t}\n\n\t\tif (!editor.delegates) {\n\t\t\teditor.delegates = {};\n\t\t}\n\n\t\tif (editor.delegates[eventName]) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (editor.settings.event_root) {\n\t\t\tif (!customEventRootDelegates) {\n\t\t\t\tcustomEventRootDelegates = {};\n\t\t\t\teditor.editorManager.on('removeEditor', function() {\n\t\t\t\t\tvar name;\n\n\t\t\t\t\tif (!editor.editorManager.activeEditor) {\n\t\t\t\t\t\tif (customEventRootDelegates) {\n\t\t\t\t\t\t\tfor (name in customEventRootDelegates) {\n\t\t\t\t\t\t\t\teditor.dom.unbind(getEventTarget(editor, name));\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tcustomEventRootDelegates = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (customEventRootDelegates[eventName]) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tdelegate = function(e) {\n\t\t\t\tvar target = e.target, editors = editor.editorManager.editors, i = editors.length;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tvar body = editors[i].getBody();\n\n\t\t\t\t\tif (body === target || DOM.isChildOf(target, body)) {\n\t\t\t\t\t\tif (isListening(editors[i])) {\n\t\t\t\t\t\t\teditors[i].fire(eventName, e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tcustomEventRootDelegates[eventName] = delegate;\n\t\t\tDOM.bind(eventRootElm, eventName, delegate);\n\t\t} else {\n\t\t\tdelegate = function(e) {\n\t\t\t\tif (isListening(editor)) {\n\t\t\t\t\teditor.fire(eventName, e);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tDOM.bind(eventRootElm, eventName, delegate);\n\t\t\teditor.delegates[eventName] = delegate;\n\t\t}\n\t}\n\n\tvar EditorObservable = {\n\t\t/**\n\t\t * Bind any pending event delegates. This gets executed after the target body/document is created.\n\t\t *\n\t\t * @private\n\t\t */\n\t\tbindPendingEventDelegates: function() {\n\t\t\tvar self = this;\n\n\t\t\tTools.each(self._pendingNativeEvents, function(name) {\n\t\t\t\tbindEventDelegate(self, name);\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Toggles a native event on/off this is called by the EventDispatcher when\n\t\t * the first native event handler is added and when the last native event handler is removed.\n\t\t *\n\t\t * @private\n\t\t */\n\t\ttoggleNativeEvent: function(name, state) {\n\t\t\tvar self = this;\n\n\t\t\t// Never bind focus/blur since the FocusManager fakes those\n\t\t\tif (name == \"focus\" || name == \"blur\") {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (state) {\n\t\t\t\tif (self.initialized) {\n\t\t\t\t\tbindEventDelegate(self, name);\n\t\t\t\t} else {\n\t\t\t\t\tif (!self._pendingNativeEvents) {\n\t\t\t\t\t\tself._pendingNativeEvents = [name];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself._pendingNativeEvents.push(name);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (self.initialized) {\n\t\t\t\tself.dom.unbind(getEventTarget(self, name), name, self.delegates[name]);\n\t\t\t\tdelete self.delegates[name];\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Unbinds all native event handlers that means delegates, custom events bound using the Events API etc.\n\t\t *\n\t\t * @private\n\t\t */\n\t\tunbindAllNativeEvents: function() {\n\t\t\tvar self = this, name;\n\n\t\t\tif (self.delegates) {\n\t\t\t\tfor (name in self.delegates) {\n\t\t\t\t\tself.dom.unbind(getEventTarget(self, name), name, self.delegates[name]);\n\t\t\t\t}\n\n\t\t\t\tdelete self.delegates;\n\t\t\t}\n\n\t\t\tif (!self.inline) {\n\t\t\t\tself.getBody().onload = null;\n\t\t\t\tself.dom.unbind(self.getWin());\n\t\t\t\tself.dom.unbind(self.getDoc());\n\t\t\t}\n\n\t\t\tself.dom.unbind(self.getBody());\n\t\t\tself.dom.unbind(self.getContainer());\n\t\t}\n\t};\n\n\tEditorObservable = Tools.extend({}, Observable, EditorObservable);\n\n\treturn EditorObservable;\n});\n\n// Included from: js/tinymce/classes/Mode.js\n\n/**\n * Mode.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Mode switcher logic.\n *\n * @private\n * @class tinymce.Mode\n */\ndefine(\"tinymce/Mode\", [], function() {\n\tfunction setEditorCommandState(editor, cmd, state) {\n\t\ttry {\n\t\t\teditor.getDoc().execCommand(cmd, false, state);\n\t\t} catch (ex) {\n\t\t\t// Ignore\n\t\t}\n\t}\n\n\tfunction clickBlocker(editor) {\n\t\tvar target, handler;\n\n\t\ttarget = editor.getBody();\n\n\t\thandler = function(e) {\n\t\t\tif (editor.dom.getParents(e.target, 'a').length > 0) {\n\t\t\t\te.preventDefault();\n\t\t\t}\n\t\t};\n\n\t\teditor.dom.bind(target, 'click', handler);\n\n\t\treturn {\n\t\t\tunbind: function() {\n\t\t\t\teditor.dom.unbind(target, 'click', handler);\n\t\t\t}\n\t\t};\n\t}\n\n\tfunction toggleReadOnly(editor, state) {\n\t\tif (editor._clickBlocker) {\n\t\t\teditor._clickBlocker.unbind();\n\t\t\teditor._clickBlocker = null;\n\t\t}\n\n\t\tif (state) {\n\t\t\teditor._clickBlocker = clickBlocker(editor);\n\t\t\teditor.selection.controlSelection.hideResizeRect();\n\t\t\teditor.readonly = true;\n\t\t\teditor.getBody().contentEditable = false;\n\t\t} else {\n\t\t\teditor.readonly = false;\n\t\t\teditor.getBody().contentEditable = true;\n\t\t\tsetEditorCommandState(editor, \"StyleWithCSS\", false);\n\t\t\tsetEditorCommandState(editor, \"enableInlineTableEditing\", false);\n\t\t\tsetEditorCommandState(editor, \"enableObjectResizing\", false);\n\t\t\teditor.focus();\n\t\t\teditor.nodeChanged();\n\t\t}\n\t}\n\n\tfunction setMode(editor, mode) {\n\t\tvar currentMode = editor.readonly ? 'readonly' : 'design';\n\n\t\tif (mode == currentMode) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (editor.initialized) {\n\t\t\ttoggleReadOnly(editor, mode == 'readonly');\n\t\t} else {\n\t\t\teditor.on('init', function() {\n\t\t\t\ttoggleReadOnly(editor, mode == 'readonly');\n\t\t\t});\n\t\t}\n\n\t\t// Event is NOT preventable\n\t\teditor.fire('SwitchMode', {mode: mode});\n\t}\n\n\treturn {\n\t\tsetMode: setMode\n\t};\n});\n\n// Included from: js/tinymce/classes/Shortcuts.js\n\n/**\n * Shortcuts.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Contains all logic for handling of keyboard shortcuts.\n *\n * @class tinymce.Shortcuts\n * @example\n * editor.shortcuts.add('ctrl+a', function() {});\n * editor.shortcuts.add('meta+a', function() {}); // \"meta\" maps to Command on Mac and Ctrl on PC\n * editor.shortcuts.add('ctrl+alt+a', function() {});\n * editor.shortcuts.add('access+a', function() {}); // \"access\" maps to ctrl+alt on Mac and shift+alt on PC\n */\ndefine(\"tinymce/Shortcuts\", [\n\t\"tinymce/util/Tools\",\n\t\"tinymce/Env\"\n], function(Tools, Env) {\n\tvar each = Tools.each, explode = Tools.explode;\n\n\tvar keyCodeLookup = {\n\t\t\"f9\": 120,\n\t\t\"f10\": 121,\n\t\t\"f11\": 122\n\t};\n\n\tvar modifierNames = Tools.makeMap('alt,ctrl,shift,meta,access');\n\n\treturn function(editor) {\n\t\tvar self = this, shortcuts = {}, pendingPatterns = [];\n\n\t\tfunction parseShortcut(pattern) {\n\t\t\tvar id, key, shortcut = {};\n\n\t\t\t// Parse modifiers and keys ctrl+alt+b for example\n\t\t\teach(explode(pattern, '+'), function(value) {\n\t\t\t\tif (value in modifierNames) {\n\t\t\t\t\tshortcut[value] = true;\n\t\t\t\t} else {\n\t\t\t\t\t// Allow numeric keycodes like ctrl+219 for ctrl+[\n\t\t\t\t\tif (/^[0-9]{2,}$/.test(value)) {\n\t\t\t\t\t\tshortcut.keyCode = parseInt(value, 10);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tshortcut.charCode = value.charCodeAt(0);\n\t\t\t\t\t\tshortcut.keyCode = keyCodeLookup[value] || value.toUpperCase().charCodeAt(0);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Generate unique id for modifier combination and set default state for unused modifiers\n\t\t\tid = [shortcut.keyCode];\n\t\t\tfor (key in modifierNames) {\n\t\t\t\tif (shortcut[key]) {\n\t\t\t\t\tid.push(key);\n\t\t\t\t} else {\n\t\t\t\t\tshortcut[key] = false;\n\t\t\t\t}\n\t\t\t}\n\t\t\tshortcut.id = id.join(',');\n\n\t\t\t// Handle special access modifier differently depending on Mac/Win\n\t\t\tif (shortcut.access) {\n\t\t\t\tshortcut.alt = true;\n\n\t\t\t\tif (Env.mac) {\n\t\t\t\t\tshortcut.ctrl = true;\n\t\t\t\t} else {\n\t\t\t\t\tshortcut.shift = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Handle special meta modifier differently depending on Mac/Win\n\t\t\tif (shortcut.meta) {\n\t\t\t\tif (Env.mac) {\n\t\t\t\t\tshortcut.meta = true;\n\t\t\t\t} else {\n\t\t\t\t\tshortcut.ctrl = true;\n\t\t\t\t\tshortcut.meta = false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn shortcut;\n\t\t}\n\n\t\tfunction createShortcut(pattern, desc, cmdFunc, scope) {\n\t\t\tvar shortcuts;\n\n\t\t\tshortcuts = Tools.map(explode(pattern, '>'), parseShortcut);\n\t\t\tshortcuts[shortcuts.length - 1] = Tools.extend(shortcuts[shortcuts.length - 1], {\n\t\t\t\tfunc: cmdFunc,\n\t\t\t\tscope: scope || editor\n\t\t\t});\n\n\t\t\treturn Tools.extend(shortcuts[0], {\n\t\t\t\tdesc: editor.translate(desc),\n\t\t\t\tsubpatterns: shortcuts.slice(1)\n\t\t\t});\n\t\t}\n\n\t\tfunction hasModifier(e) {\n\t\t\treturn e.altKey || e.ctrlKey || e.metaKey;\n\t\t}\n\n\t\tfunction isFunctionKey(e) {\n\t\t\treturn e.type === \"keydown\" && e.keyCode >= 112 && e.keyCode <= 123;\n\t\t}\n\n\t\tfunction matchShortcut(e, shortcut) {\n\t\t\tif (!shortcut) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (shortcut.ctrl != e.ctrlKey || shortcut.meta != e.metaKey) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (shortcut.alt != e.altKey || shortcut.shift != e.shiftKey) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (e.keyCode == shortcut.keyCode || (e.charCode && e.charCode == shortcut.charCode)) {\n\t\t\t\te.preventDefault();\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\tfunction executeShortcutAction(shortcut) {\n\t\t\treturn shortcut.func ? shortcut.func.call(shortcut.scope) : null;\n\t\t}\n\n\t\teditor.on('keyup keypress keydown', function(e) {\n\t\t\tif ((hasModifier(e) || isFunctionKey(e)) && !e.isDefaultPrevented()) {\n\t\t\t\teach(shortcuts, function(shortcut) {\n\t\t\t\t\tif (matchShortcut(e, shortcut)) {\n\t\t\t\t\t\tpendingPatterns = shortcut.subpatterns.slice(0);\n\n\t\t\t\t\t\tif (e.type == \"keydown\") {\n\t\t\t\t\t\t\texecuteShortcutAction(shortcut);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (matchShortcut(e, pendingPatterns[0])) {\n\t\t\t\t\tif (pendingPatterns.length === 1) {\n\t\t\t\t\t\tif (e.type == \"keydown\") {\n\t\t\t\t\t\t\texecuteShortcutAction(pendingPatterns[0]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tpendingPatterns.shift();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t/**\n\t\t * Adds a keyboard shortcut for some command or function.\n\t\t *\n\t\t * @method add\n\t\t * @param {String} pattern Shortcut pattern. Like for example: ctrl+alt+o.\n\t\t * @param {String} desc Text description for the command.\n\t\t * @param {String/Function} cmdFunc Command name string or function to execute when the key is pressed.\n\t\t * @param {Object} scope Optional scope to execute the function in.\n\t\t * @return {Boolean} true/false state if the shortcut was added or not.\n\t\t */\n\t\tself.add = function(pattern, desc, cmdFunc, scope) {\n\t\t\tvar cmd;\n\n\t\t\tcmd = cmdFunc;\n\n\t\t\tif (typeof cmdFunc === 'string') {\n\t\t\t\tcmdFunc = function() {\n\t\t\t\t\teditor.execCommand(cmd, false, null);\n\t\t\t\t};\n\t\t\t} else if (Tools.isArray(cmd)) {\n\t\t\t\tcmdFunc = function() {\n\t\t\t\t\teditor.execCommand(cmd[0], cmd[1], cmd[2]);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\teach(explode(Tools.trim(pattern.toLowerCase())), function(pattern) {\n\t\t\t\tvar shortcut = createShortcut(pattern, desc, cmdFunc, scope);\n\t\t\t\tshortcuts[shortcut.id] = shortcut;\n\t\t\t});\n\n\t\t\treturn true;\n\t\t};\n\n\t\t/**\n\t\t * Remove a keyboard shortcut by pattern.\n\t\t *\n\t\t * @method remove\n\t\t * @param {String} pattern Shortcut pattern. Like for example: ctrl+alt+o.\n\t\t * @return {Boolean} true/false state if the shortcut was removed or not.\n\t\t */\n\t\tself.remove = function(pattern) {\n\t\t\tvar shortcut = createShortcut(pattern);\n\n\t\t\tif (shortcuts[shortcut.id]) {\n\t\t\t\tdelete shortcuts[shortcut.id];\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/file/Uploader.js\n\n/**\n * Uploader.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Upload blobs or blob infos to the specified URL or handler.\n *\n * @private\n * @class tinymce.file.Uploader\n * @example\n * var uploader = new Uploader({\n *     url: '/upload.php',\n *     basePath: '/base/path',\n *     credentials: true,\n *     handler: function(data, success, failure) {\n *         ...\n *     }\n * });\n *\n * uploader.upload(blobInfos).then(function(result) {\n *     ...\n * });\n */\ndefine(\"tinymce/file/Uploader\", [\n\t\"tinymce/util/Promise\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/util/Fun\"\n], function(Promise, Tools, Fun) {\n\treturn function(uploadStatus, settings) {\n\t\tvar pendingPromises = {};\n\n\t\tfunction filename(blobInfo) {\n\t\t\tvar ext, extensions;\n\n\t\t\textensions = {\n\t\t\t\t'image/jpeg': 'jpg',\n\t\t\t\t'image/jpg': 'jpg',\n\t\t\t\t'image/gif': 'gif',\n\t\t\t\t'image/png': 'png'\n\t\t\t};\n\n\t\t\text = extensions[blobInfo.blob().type.toLowerCase()] || 'dat';\n\n\t\t\treturn blobInfo.filename() + '.' + ext;\n\t\t}\n\n\t\tfunction pathJoin(path1, path2) {\n\t\t\tif (path1) {\n\t\t\t\treturn path1.replace(/\\/$/, '') + '/' + path2.replace(/^\\//, '');\n\t\t\t}\n\n\t\t\treturn path2;\n\t\t}\n\n\t\tfunction blobInfoToData(blobInfo) {\n\t\t\treturn {\n\t\t\t\tid: blobInfo.id,\n\t\t\t\tblob: blobInfo.blob,\n\t\t\t\tbase64: blobInfo.base64,\n\t\t\t\tfilename: Fun.constant(filename(blobInfo))\n\t\t\t};\n\t\t}\n\n\t\tfunction defaultHandler(blobInfo, success, failure, progress) {\n\t\t\tvar xhr, formData;\n\n\t\t\txhr = new XMLHttpRequest();\n\t\t\txhr.open('POST', settings.url);\n\t\t\txhr.withCredentials = settings.credentials;\n\n\t\t\txhr.upload.onprogress = function(e) {\n\t\t\t\tprogress(e.loaded / e.total * 100);\n\t\t\t};\n\n\t\t\txhr.onerror = function() {\n\t\t\t\tfailure(\"Image upload failed due to a XHR Transport error. Code: \" + xhr.status);\n\t\t\t};\n\n\t\t\txhr.onload = function() {\n\t\t\t\tvar json;\n\n\t\t\t\tif (xhr.status != 200) {\n\t\t\t\t\tfailure(\"HTTP Error: \" + xhr.status);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tjson = JSON.parse(xhr.responseText);\n\n\t\t\t\tif (!json || typeof json.location != \"string\") {\n\t\t\t\t\tfailure(\"Invalid JSON: \" + xhr.responseText);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tsuccess(pathJoin(settings.basePath, json.location));\n\t\t\t};\n\n\t\t\tformData = new FormData();\n\t\t\tformData.append('file', blobInfo.blob(), blobInfo.filename());\n\n\t\t\txhr.send(formData);\n\t\t}\n\n\t\tfunction noUpload() {\n\t\t\treturn new Promise(function(resolve) {\n\t\t\t\tresolve([]);\n\t\t\t});\n\t\t}\n\n\t\tfunction handlerSuccess(blobInfo, url) {\n\t\t\treturn {\n\t\t\t\turl: url,\n\t\t\t\tblobInfo: blobInfo,\n\t\t\t\tstatus: true\n\t\t\t};\n\t\t}\n\n\t\tfunction handlerFailure(blobInfo, error) {\n\t\t\treturn {\n\t\t\t\turl: '',\n\t\t\t\tblobInfo: blobInfo,\n\t\t\t\tstatus: false,\n\t\t\t\terror: error\n\t\t\t};\n\t\t}\n\n\t\tfunction resolvePending(blobUri, result) {\n\t\t\tTools.each(pendingPromises[blobUri], function(resolve) {\n\t\t\t\tresolve(result);\n\t\t\t});\n\n\t\t\tdelete pendingPromises[blobUri];\n\t\t}\n\n\t\tfunction uploadBlobInfo(blobInfo, handler, openNotification) {\n\t\t\tuploadStatus.markPending(blobInfo.blobUri());\n\n\t\t\treturn new Promise(function(resolve) {\n\t\t\t\tvar notification, progress;\n\n\t\t\t\tvar noop = function() {\n\t\t\t\t};\n\n\t\t\t\ttry {\n\t\t\t\t\tvar closeNotification = function() {\n\t\t\t\t\t\tif (notification) {\n\t\t\t\t\t\t\tnotification.close();\n\t\t\t\t\t\t\tprogress = noop; // Once it's closed it's closed\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t\tvar success = function(url) {\n\t\t\t\t\t\tcloseNotification();\n\t\t\t\t\t\tuploadStatus.markUploaded(blobInfo.blobUri(), url);\n\t\t\t\t\t\tresolvePending(blobInfo.blobUri(), handlerSuccess(blobInfo, url));\n\t\t\t\t\t\tresolve(handlerSuccess(blobInfo, url));\n\t\t\t\t\t};\n\n\t\t\t\t\tvar failure = function() {\n\t\t\t\t\t\tcloseNotification();\n\t\t\t\t\t\tuploadStatus.removeFailed(blobInfo.blobUri());\n\t\t\t\t\t\tresolvePending(blobInfo.blobUri(), handlerFailure(blobInfo, failure));\n\t\t\t\t\t\tresolve(handlerFailure(blobInfo, failure));\n\t\t\t\t\t};\n\n\t\t\t\t\tprogress = function(percent) {\n\t\t\t\t\t\tif (percent < 0 || percent > 100) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!notification) {\n\t\t\t\t\t\t\tnotification = openNotification();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnotification.progressBar.value(percent);\n\t\t\t\t\t};\n\n\t\t\t\t\thandler(blobInfoToData(blobInfo), success, failure, progress);\n\t\t\t\t} catch (ex) {\n\t\t\t\t\tresolve(handlerFailure(blobInfo, ex.message));\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfunction isDefaultHandler(handler) {\n\t\t\treturn handler === defaultHandler;\n\t\t}\n\n\t\tfunction pendingUploadBlobInfo(blobInfo) {\n\t\t\tvar blobUri = blobInfo.blobUri();\n\n\t\t\treturn new Promise(function(resolve) {\n\t\t\t\tpendingPromises[blobUri] = pendingPromises[blobUri] || [];\n\t\t\t\tpendingPromises[blobUri].push(resolve);\n\t\t\t});\n\t\t}\n\n\t\tfunction uploadBlobs(blobInfos, openNotification) {\n\t\t\tblobInfos = Tools.grep(blobInfos, function(blobInfo) {\n\t\t\t\treturn !uploadStatus.isUploaded(blobInfo.blobUri());\n\t\t\t});\n\n\t\t\treturn Promise.all(Tools.map(blobInfos, function(blobInfo) {\n\t\t\t\treturn uploadStatus.isPending(blobInfo.blobUri()) ?\n\t\t\t\t\tpendingUploadBlobInfo(blobInfo) : uploadBlobInfo(blobInfo, settings.handler, openNotification);\n\t\t\t}));\n\t\t}\n\n\t\tfunction upload(blobInfos, openNotification) {\n\t\t\treturn (!settings.url && isDefaultHandler(settings.handler)) ? noUpload() : uploadBlobs(blobInfos, openNotification);\n\t\t}\n\n\t\tsettings = Tools.extend({\n\t\t\tcredentials: false,\n\t\t\t// We are adding a notify argument to this (at the moment, until it doesn't work)\n\t\t\thandler: defaultHandler\n\t\t}, settings);\n\n\t\treturn {\n\t\t\tupload: upload\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/file/Conversions.js\n\n/**\n * Conversions.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Converts blob/uris back and forth.\n *\n * @private\n * @class tinymce.file.Conversions\n */\ndefine(\"tinymce/file/Conversions\", [\n\t\"tinymce/util/Promise\"\n], function(Promise) {\n\tfunction blobUriToBlob(url) {\n\t\treturn new Promise(function(resolve) {\n\t\t\tvar xhr = new XMLHttpRequest();\n\n\t\t\txhr.open('GET', url, true);\n\t\t\txhr.responseType = 'blob';\n\n\t\t\txhr.onload = function() {\n\t\t\t\tif (this.status == 200) {\n\t\t\t\t\tresolve(this.response);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\txhr.send();\n\t\t});\n\t}\n\n\tfunction parseDataUri(uri) {\n\t\tvar type, matches;\n\n\t\turi = decodeURIComponent(uri).split(',');\n\n\t\tmatches = /data:([^;]+)/.exec(uri[0]);\n\t\tif (matches) {\n\t\t\ttype = matches[1];\n\t\t}\n\n\t\treturn {\n\t\t\ttype: type,\n\t\t\tdata: uri[1]\n\t\t};\n\t}\n\n\tfunction dataUriToBlob(uri) {\n\t\treturn new Promise(function(resolve) {\n\t\t\tvar str, arr, i;\n\n\t\t\turi = parseDataUri(uri);\n\n\t\t\t// Might throw error if data isn't proper base64\n\t\t\ttry {\n\t\t\t\tstr = atob(uri.data);\n\t\t\t} catch (e) {\n\t\t\t\tresolve(new Blob([]));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tarr = new Uint8Array(str.length);\n\n\t\t\tfor (i = 0; i < arr.length; i++) {\n\t\t\t\tarr[i] = str.charCodeAt(i);\n\t\t\t}\n\n\t\t\tresolve(new Blob([arr], {type: uri.type}));\n\t\t});\n\t}\n\n\tfunction uriToBlob(url) {\n\t\tif (url.indexOf('blob:') === 0) {\n\t\t\treturn blobUriToBlob(url);\n\t\t}\n\n\t\tif (url.indexOf('data:') === 0) {\n\t\t\treturn dataUriToBlob(url);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tfunction blobToDataUri(blob) {\n\t\treturn new Promise(function(resolve) {\n\t\t\tvar reader = new FileReader();\n\n\t\t\treader.onloadend = function() {\n\t\t\t\tresolve(reader.result);\n\t\t\t};\n\n\t\t\treader.readAsDataURL(blob);\n\t\t});\n\t}\n\n\treturn {\n\t\turiToBlob: uriToBlob,\n\t\tblobToDataUri: blobToDataUri,\n\t\tparseDataUri: parseDataUri\n\t};\n});\n\n// Included from: js/tinymce/classes/file/ImageScanner.js\n\n/**\n * ImageScanner.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Finds images with data uris or blob uris. If data uris are found it will convert them into blob uris.\n *\n * @private\n * @class tinymce.file.ImageScanner\n */\ndefine(\"tinymce/file/ImageScanner\", [\n\t\"tinymce/util/Promise\",\n\t\"tinymce/util/Arr\",\n\t\"tinymce/util/Fun\",\n\t\"tinymce/file/Conversions\",\n\t\"tinymce/Env\"\n], function(Promise, Arr, Fun, Conversions, Env) {\n\tvar count = 0;\n\n\treturn function(uploadStatus, blobCache) {\n\t\tvar cachedPromises = {};\n\n\t\tfunction findAll(elm, predicate) {\n\t\t\tvar images, promises;\n\n\t\t\tfunction imageToBlobInfo(img, resolve) {\n\t\t\t\tvar base64, blobInfo;\n\n\t\t\t\tif (img.src.indexOf('blob:') === 0) {\n\t\t\t\t\tblobInfo = blobCache.getByUri(img.src);\n\n\t\t\t\t\tif (blobInfo) {\n\t\t\t\t\t\tresolve({\n\t\t\t\t\t\t\timage: img,\n\t\t\t\t\t\t\tblobInfo: blobInfo\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tbase64 = Conversions.parseDataUri(img.src).data;\n\t\t\t\tblobInfo = blobCache.findFirst(function(cachedBlobInfo) {\n\t\t\t\t\treturn cachedBlobInfo.base64() === base64;\n\t\t\t\t});\n\n\t\t\t\tif (blobInfo) {\n\t\t\t\t\tresolve({\n\t\t\t\t\t\timage: img,\n\t\t\t\t\t\tblobInfo: blobInfo\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tConversions.uriToBlob(img.src).then(function(blob) {\n\t\t\t\t\t\tvar blobInfoId = 'blobid' + (count++),\n\t\t\t\t\t\t\tblobInfo = blobCache.create(blobInfoId, blob, base64);\n\n\t\t\t\t\t\tblobCache.add(blobInfo);\n\n\t\t\t\t\t\tresolve({\n\t\t\t\t\t\t\timage: img,\n\t\t\t\t\t\t\tblobInfo: blobInfo\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!predicate) {\n\t\t\t\tpredicate = Fun.constant(true);\n\t\t\t}\n\n\t\t\timages = Arr.filter(elm.getElementsByTagName('img'), function(img) {\n\t\t\t\tvar src = img.src;\n\n\t\t\t\tif (!Env.fileApi) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (img.hasAttribute('data-mce-bogus')) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (img.hasAttribute('data-mce-placeholder')) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (!src || src == Env.transparentSrc) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (src.indexOf('blob:') === 0) {\n\t\t\t\t\treturn !uploadStatus.isUploaded(src);\n\t\t\t\t}\n\n\t\t\t\tif (src.indexOf('data:') === 0) {\n\t\t\t\t\treturn predicate(img);\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t});\n\n\t\t\tpromises = Arr.map(images, function(img) {\n\t\t\t\tvar newPromise;\n\n\t\t\t\tif (cachedPromises[img.src]) {\n\t\t\t\t\t// Since the cached promise will return the cached image\n\t\t\t\t\t// We need to wrap it and resolve with the actual image\n\t\t\t\t\treturn new Promise(function(resolve) {\n\t\t\t\t\t\tcachedPromises[img.src].then(function(imageInfo) {\n\t\t\t\t\t\t\tresolve({\n\t\t\t\t\t\t\t\timage: img,\n\t\t\t\t\t\t\t\tblobInfo: imageInfo.blobInfo\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tnewPromise = new Promise(function(resolve) {\n\t\t\t\t\timageToBlobInfo(img, resolve);\n\t\t\t\t}).then(function(result) {\n\t\t\t\t\tdelete cachedPromises[result.image.src];\n\t\t\t\t\treturn result;\n\t\t\t\t})['catch'](function(error) {\n\t\t\t\t\tdelete cachedPromises[img.src];\n\t\t\t\t\treturn error;\n\t\t\t\t});\n\n\t\t\t\tcachedPromises[img.src] = newPromise;\n\n\t\t\t\treturn newPromise;\n\t\t\t});\n\n\t\t\treturn Promise.all(promises);\n\t\t}\n\n\t\treturn {\n\t\t\tfindAll: findAll\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/file/BlobCache.js\n\n/**\n * BlobCache.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Hold blob info objects where a blob has extra internal information.\n *\n * @private\n * @class tinymce.file.BlobCache\n */\ndefine(\"tinymce/file/BlobCache\", [\n\t\"tinymce/util/Arr\",\n\t\"tinymce/util/Fun\"\n], function(Arr, Fun) {\n\treturn function() {\n\t\tvar cache = [], constant = Fun.constant;\n\n\t\tfunction create(id, blob, base64, filename) {\n\t\t\treturn {\n\t\t\t\tid: constant(id),\n\t\t\t\tfilename: constant(filename || id),\n\t\t\t\tblob: constant(blob),\n\t\t\t\tbase64: constant(base64),\n\t\t\t\tblobUri: constant(URL.createObjectURL(blob))\n\t\t\t};\n\t\t}\n\n\t\tfunction add(blobInfo) {\n\t\t\tif (!get(blobInfo.id())) {\n\t\t\t\tcache.push(blobInfo);\n\t\t\t}\n\t\t}\n\n\t\tfunction get(id) {\n\t\t\treturn findFirst(function(cachedBlobInfo) {\n\t\t\t\treturn cachedBlobInfo.id() === id;\n\t\t\t});\n\t\t}\n\n\t\tfunction findFirst(predicate) {\n\t\t\treturn Arr.filter(cache, predicate)[0];\n\t\t}\n\n\t\tfunction getByUri(blobUri) {\n\t\t\treturn findFirst(function(blobInfo) {\n\t\t\t\treturn blobInfo.blobUri() == blobUri;\n\t\t\t});\n\t\t}\n\n\t\tfunction removeByUri(blobUri) {\n\t\t\tcache = Arr.filter(cache, function(blobInfo) {\n\t\t\t\tif (blobInfo.blobUri() === blobUri) {\n\t\t\t\t\tURL.revokeObjectURL(blobInfo.blobUri());\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t});\n\t\t}\n\n\t\tfunction destroy() {\n\t\t\tArr.each(cache, function(cachedBlobInfo) {\n\t\t\t\tURL.revokeObjectURL(cachedBlobInfo.blobUri());\n\t\t\t});\n\n\t\t\tcache = [];\n\t\t}\n\n\t\treturn {\n\t\t\tcreate: create,\n\t\t\tadd: add,\n\t\t\tget: get,\n\t\t\tgetByUri: getByUri,\n\t\t\tfindFirst: findFirst,\n\t\t\tremoveByUri: removeByUri,\n\t\t\tdestroy: destroy\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/file/UploadStatus.js\n\n/**\n * UploadStatus.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Holds the current status of a blob uri, if it's pending or uploaded and what the result urls was.\n *\n * @private\n * @class tinymce.file.UploadStatus\n */\ndefine(\"tinymce/file/UploadStatus\", [\n], function() {\n\treturn function() {\n\t\tvar PENDING = 1, UPLOADED = 2;\n\t\tvar blobUriStatuses = {};\n\n\t\tfunction createStatus(status, resultUri) {\n\t\t\treturn {\n\t\t\t\tstatus: status,\n\t\t\t\tresultUri: resultUri\n\t\t\t};\n\t\t}\n\n\t\tfunction hasBlobUri(blobUri) {\n\t\t\treturn blobUri in blobUriStatuses;\n\t\t}\n\n\t\tfunction getResultUri(blobUri) {\n\t\t\tvar result = blobUriStatuses[blobUri];\n\n\t\t\treturn result ? result.resultUri : null;\n\t\t}\n\n\t\tfunction isPending(blobUri) {\n\t\t\treturn hasBlobUri(blobUri) ? blobUriStatuses[blobUri].status === PENDING : false;\n\t\t}\n\n\t\tfunction isUploaded(blobUri) {\n\t\t\treturn hasBlobUri(blobUri) ? blobUriStatuses[blobUri].status === UPLOADED : false;\n\t\t}\n\n\t\tfunction markPending(blobUri) {\n\t\t\tblobUriStatuses[blobUri] = createStatus(PENDING, null);\n\t\t}\n\n\t\tfunction markUploaded(blobUri, resultUri) {\n\t\t\tblobUriStatuses[blobUri] = createStatus(UPLOADED, resultUri);\n\t\t}\n\n\t\tfunction removeFailed(blobUri) {\n\t\t\tdelete blobUriStatuses[blobUri];\n\t\t}\n\n\t\tfunction destroy() {\n\t\t\tblobUriStatuses = {};\n\t\t}\n\n\t\treturn {\n\t\t\thasBlobUri: hasBlobUri,\n\t\t\tgetResultUri: getResultUri,\n\t\t\tisPending: isPending,\n\t\t\tisUploaded: isUploaded,\n\t\t\tmarkPending: markPending,\n\t\t\tmarkUploaded: markUploaded,\n\t\t\tremoveFailed: removeFailed,\n\t\t\tdestroy: destroy\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/EditorUpload.js\n\n/**\n * EditorUpload.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Handles image uploads, updates undo stack and patches over various internal functions.\n *\n * @private\n * @class tinymce.EditorUpload\n */\ndefine(\"tinymce/EditorUpload\", [\n\t\"tinymce/util/Arr\",\n\t\"tinymce/file/Uploader\",\n\t\"tinymce/file/ImageScanner\",\n\t\"tinymce/file/BlobCache\",\n\t\"tinymce/file/UploadStatus\"\n], function(Arr, Uploader, ImageScanner, BlobCache, UploadStatus) {\n\treturn function(editor) {\n\t\tvar blobCache = new BlobCache(), uploader, imageScanner, settings = editor.settings;\n\t\tvar uploadStatus = new UploadStatus();\n\n\t\tfunction aliveGuard(callback) {\n\t\t\treturn function(result) {\n\t\t\t\tif (editor.selection) {\n\t\t\t\t\treturn callback(result);\n\t\t\t\t}\n\n\t\t\t\treturn [];\n\t\t\t};\n\t\t}\n\n\t\tfunction cacheInvalidator() {\n\t\t\treturn '?' + (new Date()).getTime();\n\t\t}\n\n\t\t// Replaces strings without regexps to avoid FF regexp to big issue\n\t\tfunction replaceString(content, search, replace) {\n\t\t\tvar index = 0;\n\n\t\t\tdo {\n\t\t\t\tindex = content.indexOf(search, index);\n\n\t\t\t\tif (index !== -1) {\n\t\t\t\t\tcontent = content.substring(0, index) + replace + content.substr(index + search.length);\n\t\t\t\t\tindex += replace.length - search.length + 1;\n\t\t\t\t}\n\t\t\t} while (index !== -1);\n\n\t\t\treturn content;\n\t\t}\n\n\t\tfunction replaceImageUrl(content, targetUrl, replacementUrl) {\n\t\t\tcontent = replaceString(content, 'src=\"' + targetUrl + '\"', 'src=\"' + replacementUrl + '\"');\n\t\t\tcontent = replaceString(content, 'data-mce-src=\"' + targetUrl + '\"', 'data-mce-src=\"' + replacementUrl + '\"');\n\n\t\t\treturn content;\n\t\t}\n\n\t\tfunction replaceUrlInUndoStack(targetUrl, replacementUrl) {\n\t\t\tArr.each(editor.undoManager.data, function(level) {\n\t\t\t\tif (level.type === 'fragmented') {\n\t\t\t\t\tlevel.fragments = Arr.map(level.fragments, function (fragment) {\n\t\t\t\t\t\treturn replaceImageUrl(fragment, targetUrl, replacementUrl);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tlevel.content = replaceImageUrl(level.content, targetUrl, replacementUrl);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfunction openNotification() {\n\t\t\treturn editor.notificationManager.open({\n\t\t\t\ttext: editor.translate('Image uploading...'),\n\t\t\t\ttype: 'info',\n\t\t\t\ttimeout: -1,\n\t\t\t\tprogressBar: true\n\t\t\t});\n\t\t}\n\n\t\tfunction replaceImageUri(image, resultUri) {\n\t\t\tblobCache.removeByUri(image.src);\n\t\t\treplaceUrlInUndoStack(image.src, resultUri);\n\n\t\t\teditor.$(image).attr({\n\t\t\t\tsrc: settings.images_reuse_filename ? resultUri + cacheInvalidator() : resultUri,\n\t\t\t\t'data-mce-src': editor.convertURL(resultUri, 'src')\n\t\t\t});\n\t\t}\n\n\t\tfunction uploadImages(callback) {\n\t\t\tif (!uploader) {\n\t\t\t\tuploader = new Uploader(uploadStatus, {\n\t\t\t\t\turl: settings.images_upload_url,\n\t\t\t\t\tbasePath: settings.images_upload_base_path,\n\t\t\t\t\tcredentials: settings.images_upload_credentials,\n\t\t\t\t\thandler: settings.images_upload_handler\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn scanForImages().then(aliveGuard(function(imageInfos) {\n\t\t\t\tvar blobInfos;\n\n\t\t\t\tblobInfos = Arr.map(imageInfos, function(imageInfo) {\n\t\t\t\t\treturn imageInfo.blobInfo;\n\t\t\t\t});\n\n\t\t\t\treturn uploader.upload(blobInfos, openNotification).then(aliveGuard(function(result) {\n\t\t\t\t\tresult = Arr.map(result, function(uploadInfo, index) {\n\t\t\t\t\t\tvar image = imageInfos[index].image;\n\n\t\t\t\t\t\tif (uploadInfo.status && editor.settings.images_replace_blob_uris !== false) {\n\t\t\t\t\t\t\treplaceImageUri(image, uploadInfo.url);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\telement: image,\n\t\t\t\t\t\t\tstatus: uploadInfo.status\n\t\t\t\t\t\t};\n\t\t\t\t\t});\n\n\t\t\t\t\tif (callback) {\n\t\t\t\t\t\tcallback(result);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn result;\n\t\t\t\t}));\n\t\t\t}));\n\t\t}\n\n\t\tfunction uploadImagesAuto(callback) {\n\t\t\tif (settings.automatic_uploads !== false) {\n\t\t\t\treturn uploadImages(callback);\n\t\t\t}\n\t\t}\n\n\t\tfunction isValidDataUriImage(imgElm) {\n\t\t\treturn settings.images_dataimg_filter ? settings.images_dataimg_filter(imgElm) : true;\n\t\t}\n\n\t\tfunction scanForImages() {\n\t\t\tif (!imageScanner) {\n\t\t\t\timageScanner = new ImageScanner(uploadStatus, blobCache);\n\t\t\t}\n\n\t\t\treturn imageScanner.findAll(editor.getBody(), isValidDataUriImage).then(aliveGuard(function(result) {\n\t\t\t\tArr.each(result, function(resultItem) {\n\t\t\t\t\treplaceUrlInUndoStack(resultItem.image.src, resultItem.blobInfo.blobUri());\n\t\t\t\t\tresultItem.image.src = resultItem.blobInfo.blobUri();\n\t\t\t\t\tresultItem.image.removeAttribute('data-mce-src');\n\t\t\t\t});\n\n\t\t\t\treturn result;\n\t\t\t}));\n\t\t}\n\n\t\tfunction destroy() {\n\t\t\tblobCache.destroy();\n\t\t\tuploadStatus.destroy();\n\t\t\timageScanner = uploader = null;\n\t\t}\n\n\t\tfunction replaceBlobUris(content) {\n\t\t\treturn content.replace(/src=\"(blob:[^\"]+)\"/g, function(match, blobUri) {\n\t\t\t\tvar resultUri = uploadStatus.getResultUri(blobUri);\n\n\t\t\t\tif (resultUri) {\n\t\t\t\t\treturn 'src=\"' + resultUri + '\"';\n\t\t\t\t}\n\n\t\t\t\tvar blobInfo = blobCache.getByUri(blobUri);\n\n\t\t\t\tif (!blobInfo) {\n\t\t\t\t\tblobInfo = Arr.reduce(editor.editorManager.editors, function(result, editor) {\n\t\t\t\t\t\treturn result || editor.editorUpload.blobCache.getByUri(blobUri);\n\t\t\t\t\t}, null);\n\t\t\t\t}\n\n\t\t\t\tif (blobInfo) {\n\t\t\t\t\treturn 'src=\"data:' + blobInfo.blob().type + ';base64,' + blobInfo.base64() + '\"';\n\t\t\t\t}\n\n\t\t\t\treturn match;\n\t\t\t});\n\t\t}\n\n\t\teditor.on('setContent', function() {\n\t\t\tif (editor.settings.automatic_uploads !== false) {\n\t\t\t\tuploadImagesAuto();\n\t\t\t} else {\n\t\t\t\tscanForImages();\n\t\t\t}\n\t\t});\n\n\t\teditor.on('RawSaveContent', function(e) {\n\t\t\te.content = replaceBlobUris(e.content);\n\t\t});\n\n\t\teditor.on('getContent', function(e) {\n\t\t\tif (e.source_view || e.format == 'raw') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\te.content = replaceBlobUris(e.content);\n\t\t});\n\n\t\teditor.on('PostRender', function() {\n\t\t\teditor.parser.addNodeFilter('img', function(images) {\n\t\t\t\tArr.each(images, function(img) {\n\t\t\t\t\tvar src = img.attr('src');\n\n\t\t\t\t\tif (blobCache.getByUri(src)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar resultUri = uploadStatus.getResultUri(src);\n\t\t\t\t\tif (resultUri) {\n\t\t\t\t\t\timg.attr('src', resultUri);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\treturn {\n\t\t\tblobCache: blobCache,\n\t\t\tuploadImages: uploadImages,\n\t\t\tuploadImagesAuto: uploadImagesAuto,\n\t\t\tscanForImages: scanForImages,\n\t\t\tdestroy: destroy\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/caret/FakeCaret.js\n\n/**\n * FakeCaret.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This module contains logic for rendering a fake visual caret.\n *\n * @private\n * @class tinymce.caret.FakeCaret\n */\ndefine(\"tinymce/caret/FakeCaret\", [\n\t\"tinymce/caret/CaretContainer\",\n\t\"tinymce/caret/CaretPosition\",\n\t\"tinymce/dom/NodeType\",\n\t\"tinymce/dom/RangeUtils\",\n\t\"tinymce/dom/DomQuery\",\n\t\"tinymce/geom/ClientRect\",\n\t\"tinymce/util/Delay\"\n], function(CaretContainer, CaretPosition, NodeType, RangeUtils, $, ClientRect, Delay) {\n\tvar isContentEditableFalse = NodeType.isContentEditableFalse;\n\n\treturn function(rootNode, isBlock) {\n\t\tvar cursorInterval, $lastVisualCaret, caretContainerNode;\n\n\t\tfunction getAbsoluteClientRect(node, before) {\n\t\t\tvar clientRect = ClientRect.collapse(node.getBoundingClientRect(), before),\n\t\t\t\tdocElm, scrollX, scrollY, margin, rootRect;\n\n\t\t\tif (rootNode.tagName == 'BODY') {\n\t\t\t\tdocElm = rootNode.ownerDocument.documentElement;\n\t\t\t\tscrollX = rootNode.scrollLeft || docElm.scrollLeft;\n\t\t\t\tscrollY = rootNode.scrollTop || docElm.scrollTop;\n\t\t\t} else {\n\t\t\t\trootRect = rootNode.getBoundingClientRect();\n\t\t\t\tscrollX = rootNode.scrollLeft - rootRect.left;\n\t\t\t\tscrollY = rootNode.scrollTop - rootRect.top;\n\t\t\t}\n\n\t\t\tclientRect.left += scrollX;\n\t\t\tclientRect.right += scrollX;\n\t\t\tclientRect.top += scrollY;\n\t\t\tclientRect.bottom += scrollY;\n\t\t\tclientRect.width = 1;\n\n\t\t\tmargin = node.offsetWidth - node.clientWidth;\n\n\t\t\tif (margin > 0) {\n\t\t\t\tif (before) {\n\t\t\t\t\tmargin *= -1;\n\t\t\t\t}\n\n\t\t\t\tclientRect.left += margin;\n\t\t\t\tclientRect.right += margin;\n\t\t\t}\n\n\t\t\treturn clientRect;\n\t\t}\n\n\t\tfunction trimInlineCaretContainers() {\n\t\t\tvar contentEditableFalseNodes, node, sibling, i, data;\n\n\t\t\tcontentEditableFalseNodes = $('*[contentEditable=false]', rootNode);\n\t\t\tfor (i = 0; i < contentEditableFalseNodes.length; i++) {\n\t\t\t\tnode = contentEditableFalseNodes[i];\n\n\t\t\t\tsibling = node.previousSibling;\n\t\t\t\tif (CaretContainer.endsWithCaretContainer(sibling)) {\n\t\t\t\t\tdata = sibling.data;\n\n\t\t\t\t\tif (data.length == 1) {\n\t\t\t\t\t\tsibling.parentNode.removeChild(sibling);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsibling.deleteData(data.length - 1, 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tsibling = node.nextSibling;\n\t\t\t\tif (CaretContainer.startsWithCaretContainer(sibling)) {\n\t\t\t\t\tdata = sibling.data;\n\n\t\t\t\t\tif (data.length == 1) {\n\t\t\t\t\t\tsibling.parentNode.removeChild(sibling);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsibling.deleteData(0, 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn null;\n\t\t}\n\n\t\tfunction show(before, node) {\n\t\t\tvar clientRect, rng;\n\n\t\t\thide();\n\n\t\t\tif (isBlock(node)) {\n\t\t\t\tcaretContainerNode = CaretContainer.insertBlock('p', node, before);\n\t\t\t\tclientRect = getAbsoluteClientRect(node, before);\n\t\t\t\t$(caretContainerNode).css('top', clientRect.top);\n\n\t\t\t\t$lastVisualCaret = $('<div class=\"mce-visual-caret\" data-mce-bogus=\"all\"></div>').css(clientRect).appendTo(rootNode);\n\n\t\t\t\tif (before) {\n\t\t\t\t\t$lastVisualCaret.addClass('mce-visual-caret-before');\n\t\t\t\t}\n\n\t\t\t\tstartBlink();\n\n\t\t\t\trng = node.ownerDocument.createRange();\n\t\t\t\trng.setStart(caretContainerNode, 0);\n\t\t\t\trng.setEnd(caretContainerNode, 0);\n\t\t\t} else {\n\t\t\t\tcaretContainerNode = CaretContainer.insertInline(node, before);\n\t\t\t\trng = node.ownerDocument.createRange();\n\n\t\t\t\tif (isContentEditableFalse(caretContainerNode.nextSibling)) {\n\t\t\t\t\trng.setStart(caretContainerNode, 0);\n\t\t\t\t\trng.setEnd(caretContainerNode, 0);\n\t\t\t\t} else {\n\t\t\t\t\trng.setStart(caretContainerNode, 1);\n\t\t\t\t\trng.setEnd(caretContainerNode, 1);\n\t\t\t\t}\n\n\t\t\t\treturn rng;\n\t\t\t}\n\n\t\t\treturn rng;\n\t\t}\n\n\t\tfunction hide() {\n\t\t\ttrimInlineCaretContainers();\n\n\t\t\tif (caretContainerNode) {\n\t\t\t\tCaretContainer.remove(caretContainerNode);\n\t\t\t\tcaretContainerNode = null;\n\t\t\t}\n\n\t\t\tif ($lastVisualCaret) {\n\t\t\t\t$lastVisualCaret.remove();\n\t\t\t\t$lastVisualCaret = null;\n\t\t\t}\n\n\t\t\tclearInterval(cursorInterval);\n\t\t}\n\n\t\tfunction startBlink() {\n\t\t\tcursorInterval = Delay.setInterval(function() {\n\t\t\t\t$('div.mce-visual-caret', rootNode).toggleClass('mce-visual-caret-hidden');\n\t\t\t}, 500);\n\t\t}\n\n\t\tfunction destroy() {\n\t\t\tDelay.clearInterval(cursorInterval);\n\t\t}\n\n\t\tfunction getCss() {\n\t\t\treturn (\n\t\t\t\t'.mce-visual-caret {' +\n\t\t\t\t\t'position: absolute;' +\n\t\t\t\t\t'background-color: black;' +\n\t\t\t\t\t'background-color: currentcolor;' +\n\t\t\t\t'}' +\n\t\t\t\t'.mce-visual-caret-hidden {' +\n\t\t\t\t\t'display: none;' +\n\t\t\t\t'}' +\n\t\t\t\t'*[data-mce-caret] {' +\n\t\t\t\t\t'position: absolute;' +\n\t\t\t\t\t'left: -1000px;' +\n\t\t\t\t\t'right: auto;' +\n\t\t\t\t\t'top: 0;' +\n\t\t\t\t\t'margin: 0;' +\n\t\t\t\t\t'padding: 0;' +\n\t\t\t\t'}'\n\t\t\t);\n\t\t}\n\n\t\treturn {\n\t\t\tshow: show,\n\t\t\thide: hide,\n\t\t\tgetCss: getCss,\n\t\t\tdestroy: destroy\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/dom/Dimensions.js\n\n/**\n * Dimensions.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This module measures nodes and returns client rects. The client rects has an\n * extra node property.\n *\n * @private\n * @class tinymce.dom.Dimensions\n */\ndefine(\"tinymce/dom/Dimensions\", [\n\t\"tinymce/util/Arr\",\n\t\"tinymce/dom/NodeType\",\n\t\"tinymce/geom/ClientRect\"\n], function(Arr, NodeType, ClientRect) {\n\n\tfunction getClientRects(node) {\n\t\tfunction toArrayWithNode(clientRects) {\n\t\t\treturn Arr.map(clientRects, function(clientRect) {\n\t\t\t\tclientRect = ClientRect.clone(clientRect);\n\t\t\t\tclientRect.node = node;\n\n\t\t\t\treturn clientRect;\n\t\t\t});\n\t\t}\n\n\t\tif (Arr.isArray(node)) {\n\t\t\treturn Arr.reduce(node, function(result, node) {\n\t\t\t\treturn result.concat(getClientRects(node));\n\t\t\t}, []);\n\t\t}\n\n\t\tif (NodeType.isElement(node)) {\n\t\t\treturn toArrayWithNode(node.getClientRects());\n\t\t}\n\n\t\tif (NodeType.isText(node)) {\n\t\t\tvar rng = node.ownerDocument.createRange();\n\n\t\t\trng.setStart(node, 0);\n\t\t\trng.setEnd(node, node.data.length);\n\n\t\t\treturn toArrayWithNode(rng.getClientRects());\n\t\t}\n\t}\n\n\treturn {\n\t\t/**\n\t\t * Returns the client rects for a specific node.\n\t\t *\n\t\t * @method getClientRects\n\t\t * @param {Array/DOMNode} node Node or array of nodes to get client rects on.\n\t\t * @param {Array} Array of client rects with a extra node property.\n\t\t */\n\t\tgetClientRects: getClientRects\n\t};\n});\n\n// Included from: js/tinymce/classes/caret/LineWalker.js\n\n/**\n * LineWalker.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This module lets you walk the document line by line\n * returing nodes and client rects for each line.\n *\n * @private\n * @class tinymce.caret.LineWalker\n */\ndefine(\"tinymce/caret/LineWalker\", [\n\t\"tinymce/util/Fun\",\n\t\"tinymce/util/Arr\",\n\t\"tinymce/dom/Dimensions\",\n\t\"tinymce/caret/CaretCandidate\",\n\t\"tinymce/caret/CaretUtils\",\n\t\"tinymce/caret/CaretWalker\",\n\t\"tinymce/caret/CaretPosition\",\n\t\"tinymce/geom/ClientRect\"\n], function(Fun, Arr, Dimensions, CaretCandidate, CaretUtils, CaretWalker, CaretPosition, ClientRect) {\n\tvar curry = Fun.curry;\n\n\tfunction findUntil(direction, rootNode, predicateFn, node) {\n\t\twhile ((node = CaretUtils.findNode(node, direction, CaretCandidate.isEditableCaretCandidate, rootNode))) {\n\t\t\tif (predicateFn(node)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction walkUntil(direction, isAboveFn, isBeflowFn, rootNode, predicateFn, caretPosition) {\n\t\tvar line = 0, node, result = [], targetClientRect;\n\n\t\tfunction add(node) {\n\t\t\tvar i, clientRect, clientRects;\n\n\t\t\tclientRects = Dimensions.getClientRects(node);\n\t\t\tif (direction == -1) {\n\t\t\t\tclientRects = clientRects.reverse();\n\t\t\t}\n\n\t\t\tfor (i = 0; i < clientRects.length; i++) {\n\t\t\t\tclientRect = clientRects[i];\n\t\t\t\tif (isBeflowFn(clientRect, targetClientRect)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (result.length > 0 && isAboveFn(clientRect, Arr.last(result))) {\n\t\t\t\t\tline++;\n\t\t\t\t}\n\n\t\t\t\tclientRect.line = line;\n\n\t\t\t\tif (predicateFn(clientRect)) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tresult.push(clientRect);\n\t\t\t}\n\t\t}\n\n\t\ttargetClientRect = Arr.last(caretPosition.getClientRects());\n\t\tif (!targetClientRect) {\n\t\t\treturn result;\n\t\t}\n\n\t\tnode = caretPosition.getNode();\n\t\tadd(node);\n\t\tfindUntil(direction, rootNode, add, node);\n\n\t\treturn result;\n\t}\n\n\tfunction aboveLineNumber(lineNumber, clientRect) {\n\t\treturn clientRect.line > lineNumber;\n\t}\n\n\tfunction isLine(lineNumber, clientRect) {\n\t\treturn clientRect.line === lineNumber;\n\t}\n\n\tvar upUntil = curry(walkUntil, -1, ClientRect.isAbove, ClientRect.isBelow);\n\tvar downUntil = curry(walkUntil, 1, ClientRect.isBelow, ClientRect.isAbove);\n\n\tfunction positionsUntil(direction, rootNode, predicateFn, node) {\n\t\tvar caretWalker = new CaretWalker(rootNode), walkFn, isBelowFn, isAboveFn,\n\t\t\tcaretPosition, result = [], line = 0, clientRect, targetClientRect;\n\n\t\tfunction getClientRect(caretPosition) {\n\t\t\tif (direction == 1) {\n\t\t\t\treturn Arr.last(caretPosition.getClientRects());\n\t\t\t}\n\n\t\t\treturn Arr.last(caretPosition.getClientRects());\n\t\t}\n\n\t\tif (direction == 1) {\n\t\t\twalkFn = caretWalker.next;\n\t\t\tisBelowFn = ClientRect.isBelow;\n\t\t\tisAboveFn = ClientRect.isAbove;\n\t\t\tcaretPosition = CaretPosition.after(node);\n\t\t} else {\n\t\t\twalkFn = caretWalker.prev;\n\t\t\tisBelowFn = ClientRect.isAbove;\n\t\t\tisAboveFn = ClientRect.isBelow;\n\t\t\tcaretPosition = CaretPosition.before(node);\n\t\t}\n\n\t\ttargetClientRect = getClientRect(caretPosition);\n\n\t\tdo {\n\t\t\tif (!caretPosition.isVisible()) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tclientRect = getClientRect(caretPosition);\n\n\t\t\tif (isAboveFn(clientRect, targetClientRect)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (result.length > 0 && isBelowFn(clientRect, Arr.last(result))) {\n\t\t\t\tline++;\n\t\t\t}\n\n\t\t\tclientRect = ClientRect.clone(clientRect);\n\t\t\tclientRect.position = caretPosition;\n\t\t\tclientRect.line = line;\n\n\t\t\tif (predicateFn(clientRect)) {\n\t\t\t\treturn result;\n\t\t\t}\n\n\t\t\tresult.push(clientRect);\n\t\t} while ((caretPosition = walkFn(caretPosition)));\n\n\t\treturn result;\n\t}\n\n\treturn {\n\t\tupUntil: upUntil,\n\t\tdownUntil: downUntil,\n\n\t\t/**\n\t\t * Find client rects with line and caret position until the predicate returns true.\n\t\t *\n\t\t * @method positionsUntil\n\t\t * @param {Number} direction Direction forward/backward 1/-1.\n\t\t * @param {DOMNode} rootNode Root node to walk within.\n\t\t * @param {function} predicateFn Gets the client rect as it's input.\n\t\t * @param {DOMNode} node Node to start walking from.\n\t\t * @return {Array} Array of client rects with line and position properties.\n\t\t */\n\t\tpositionsUntil: positionsUntil,\n\n\t\tisAboveLine: curry(aboveLineNumber),\n\t\tisLine: curry(isLine)\n\t};\n});\n\n// Included from: js/tinymce/classes/caret/LineUtils.js\n\n/**\n * LineUtils.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Utility functions for working with lines.\n *\n * @private\n * @class tinymce.caret.LineUtils\n */\ndefine(\"tinymce/caret/LineUtils\", [\n\t\"tinymce/util/Fun\",\n\t\"tinymce/util/Arr\",\n\t\"tinymce/dom/NodeType\",\n\t\"tinymce/dom/Dimensions\",\n\t\"tinymce/geom/ClientRect\",\n\t\"tinymce/caret/CaretUtils\",\n\t\"tinymce/caret/CaretCandidate\"\n], function(Fun, Arr, NodeType, Dimensions, ClientRect, CaretUtils, CaretCandidate) {\n\tvar isContentEditableFalse = NodeType.isContentEditableFalse,\n\t\tfindNode = CaretUtils.findNode,\n\t\tcurry = Fun.curry;\n\n\tfunction distanceToRectLeft(clientRect, clientX) {\n\t\treturn Math.abs(clientRect.left - clientX);\n\t}\n\n\tfunction distanceToRectRight(clientRect, clientX) {\n\t\treturn Math.abs(clientRect.right - clientX);\n\t}\n\n\tfunction findClosestClientRect(clientRects, clientX) {\n\t\tfunction isInside(clientX, clientRect) {\n\t\t\treturn clientX >= clientRect.left && clientX <= clientRect.right;\n\t\t}\n\n\t\treturn Arr.reduce(clientRects, function(oldClientRect, clientRect) {\n\t\t\tvar oldDistance, newDistance;\n\n\t\t\toldDistance = Math.min(distanceToRectLeft(oldClientRect, clientX), distanceToRectRight(oldClientRect, clientX));\n\t\t\tnewDistance = Math.min(distanceToRectLeft(clientRect, clientX), distanceToRectRight(clientRect, clientX));\n\n\t\t\tif (isInside(clientX, clientRect)) {\n\t\t\t\treturn clientRect;\n\t\t\t}\n\n\t\t\tif (isInside(clientX, oldClientRect)) {\n\t\t\t\treturn oldClientRect;\n\t\t\t}\n\n\t\t\t// cE=false has higher priority\n\t\t\tif (newDistance == oldDistance && isContentEditableFalse(clientRect.node)) {\n\t\t\t\treturn clientRect;\n\t\t\t}\n\n\t\t\tif (newDistance < oldDistance) {\n\t\t\t\treturn clientRect;\n\t\t\t}\n\n\t\t\treturn oldClientRect;\n\t\t});\n\t}\n\n\tfunction walkUntil(direction, rootNode, predicateFn, node) {\n\t\twhile ((node = findNode(node, direction, CaretCandidate.isEditableCaretCandidate, rootNode))) {\n\t\t\tif (predicateFn(node)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction findLineNodeRects(rootNode, targetNodeRect) {\n\t\tvar clientRects = [];\n\n\t\tfunction collect(checkPosFn, node) {\n\t\t\tvar lineRects;\n\n\t\t\tlineRects = Arr.filter(Dimensions.getClientRects(node), function(clientRect) {\n\t\t\t\treturn !checkPosFn(clientRect, targetNodeRect);\n\t\t\t});\n\n\t\t\tclientRects = clientRects.concat(lineRects);\n\n\t\t\treturn lineRects.length === 0;\n\t\t}\n\n\t\tclientRects.push(targetNodeRect);\n\t\twalkUntil(-1, rootNode, curry(collect, ClientRect.isAbove), targetNodeRect.node);\n\t\twalkUntil(1, rootNode, curry(collect, ClientRect.isBelow), targetNodeRect.node);\n\n\t\treturn clientRects;\n\t}\n\n\tfunction getContentEditableFalseChildren(rootNode) {\n\t\treturn Arr.filter(Arr.toArray(rootNode.getElementsByTagName('*')), isContentEditableFalse);\n\t}\n\n\tfunction caretInfo(clientRect, clientX) {\n\t\treturn {\n\t\t\tnode: clientRect.node,\n\t\t\tbefore: distanceToRectLeft(clientRect, clientX) < distanceToRectRight(clientRect, clientX)\n\t\t};\n\t}\n\n\tfunction closestCaret(rootNode, clientX, clientY) {\n\t\tvar contentEditableFalseNodeRects, closestNodeRect;\n\n\t\tcontentEditableFalseNodeRects = Dimensions.getClientRects(getContentEditableFalseChildren(rootNode));\n\t\tcontentEditableFalseNodeRects = Arr.filter(contentEditableFalseNodeRects, function(clientRect) {\n\t\t\treturn clientY >= clientRect.top && clientY <= clientRect.bottom;\n\t\t});\n\n\t\tclosestNodeRect = findClosestClientRect(contentEditableFalseNodeRects, clientX);\n\t\tif (closestNodeRect) {\n\t\t\tclosestNodeRect = findClosestClientRect(findLineNodeRects(rootNode, closestNodeRect), clientX);\n\t\t\tif (closestNodeRect && isContentEditableFalse(closestNodeRect.node)) {\n\t\t\t\treturn caretInfo(closestNodeRect, clientX);\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\treturn {\n\t\tfindClosestClientRect: findClosestClientRect,\n\t\tfindLineNodeRects: findLineNodeRects,\n\t\tclosestCaret: closestCaret\n\t};\n});\n\n// Included from: js/tinymce/classes/dom/MousePosition.js\n\n/**\n * MousePosition.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This module calculates an absolute coordinate inside the editor body for both local and global mouse events.\n *\n * @private\n * @class tinymce.dom.MousePosition\n */\ndefine(\"tinymce/dom/MousePosition\", [\n], function() {\n\tvar getAbsolutePosition = function (elm) {\n\t\tvar doc, docElem, win, clientRect;\n\n\t\tclientRect = elm.getBoundingClientRect();\n\t\tdoc = elm.ownerDocument;\n\t\tdocElem = doc.documentElement;\n\t\twin = doc.defaultView;\n\n\t\treturn {\n\t\t\ttop: clientRect.top + win.pageYOffset - docElem.clientTop,\n\t\t\tleft: clientRect.left + win.pageXOffset - docElem.clientLeft\n\t\t};\n\t};\n\n\tvar getBodyPosition = function (editor) {\n\t\treturn editor.inline ? getAbsolutePosition(editor.getBody()) : {left: 0, top: 0};\n\t};\n\n\tvar getScrollPosition = function (editor) {\n\t\tvar body = editor.getBody();\n\t\treturn editor.inline ? {left: body.scrollLeft, top: body.scrollTop} : {left: 0, top: 0};\n\t};\n\n\tvar getBodyScroll = function (editor) {\n\t\tvar body = editor.getBody(), docElm = editor.getDoc().documentElement;\n\t\tvar inlineScroll = {left: body.scrollLeft, top: body.scrollTop};\n\t\tvar iframeScroll = {left: body.scrollLeft || docElm.scrollLeft, top: body.scrollTop || docElm.scrollTop};\n\n\t\treturn editor.inline ? inlineScroll : iframeScroll;\n\t};\n\n\tvar getMousePosition = function (editor, event) {\n\t\tif (event.target.ownerDocument !== editor.getDoc()) {\n\t\t\tvar iframePosition = getAbsolutePosition(editor.getContentAreaContainer());\n\t\t\tvar scrollPosition = getBodyScroll(editor);\n\n\t\t\treturn {\n\t\t\t\tleft: event.pageX - iframePosition.left + scrollPosition.left,\n\t\t\t\ttop: event.pageY - iframePosition.top + scrollPosition.top\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\tleft: event.pageX,\n\t\t\ttop: event.pageY\n\t\t};\n\t};\n\n\tvar calculatePosition = function (bodyPosition, scrollPosition, mousePosition) {\n\t\treturn {\n\t\t\tpageX: (mousePosition.left - bodyPosition.left) + scrollPosition.left,\n\t\t\tpageY: (mousePosition.top - bodyPosition.top) + scrollPosition.top\n\t\t};\n\t};\n\n\tvar calc = function (editor, event) {\n\t\treturn calculatePosition(getBodyPosition(editor), getScrollPosition(editor), getMousePosition(editor, event));\n\t};\n\n\treturn {\n\t\tcalc: calc\n\t};\n});\n\n// Included from: js/tinymce/classes/DragDropOverrides.js\n\n/**\n * DragDropOverrides.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This module contains logic overriding the drag/drop logic of the editor.\n *\n * @private\n * @class tinymce.DragDropOverrides\n */\ndefine(\"tinymce/DragDropOverrides\", [\n\t\"tinymce/dom/NodeType\",\n\t\"tinymce/util/Arr\",\n\t\"tinymce/util/Fun\",\n\t\"tinymce/util/Delay\",\n\t\"tinymce/dom/DOMUtils\",\n\t\"tinymce/dom/MousePosition\"\n], function(\n\tNodeType, Arr, Fun, Delay, DOMUtils, MousePosition\n) {\n\tvar isContentEditableFalse = NodeType.isContentEditableFalse,\n\t\tisContentEditableTrue = NodeType.isContentEditableTrue;\n\n\tvar isDraggable = function (elm) {\n\t\treturn isContentEditableFalse(elm);\n\t};\n\n\tvar isValidDropTarget = function (editor, targetElement, dragElement) {\n\t\tif (targetElement === dragElement || editor.dom.isChildOf(targetElement, dragElement)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (isContentEditableFalse(targetElement)) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t};\n\n\tvar cloneElement = function (elm) {\n\t\tvar cloneElm = elm.cloneNode(true);\n\t\tcloneElm.removeAttribute('data-mce-selected');\n\t\treturn cloneElm;\n\t};\n\n\tvar createGhost = function (editor, elm, width, height) {\n\t\tvar clonedElm = elm.cloneNode(true);\n\n\t\teditor.dom.setStyles(clonedElm, {width: width, height: height});\n\t\teditor.dom.setAttrib(clonedElm, 'data-mce-selected', null);\n\n\t\tvar ghostElm = editor.dom.create('div', {\n\t\t\t'class': 'mce-drag-container',\n\t\t\t'data-mce-bogus': 'all',\n\t\t\tunselectable: 'on',\n\t\t\tcontenteditable: 'false'\n\t\t});\n\n\t\teditor.dom.setStyles(ghostElm, {\n\t\t\tposition: 'absolute',\n\t\t\topacity: 0.5,\n\t\t\toverflow: 'hidden',\n\t\t\tborder: 0,\n\t\t\tpadding: 0,\n\t\t\tmargin: 0,\n\t\t\twidth: width,\n\t\t\theight: height\n\t\t});\n\n\t\teditor.dom.setStyles(clonedElm, {\n\t\t\tmargin: 0,\n\t\t\tboxSizing: 'border-box'\n\t\t});\n\n\t\tghostElm.appendChild(clonedElm);\n\n\t\treturn ghostElm;\n\t};\n\n\tvar appendGhostToBody = function (ghostElm, bodyElm) {\n\t\tif (ghostElm.parentNode !== bodyElm) {\n\t\t\tbodyElm.appendChild(ghostElm);\n\t\t}\n\t};\n\n\tvar moveGhost = function (ghostElm, position, width, height, maxX, maxY) {\n\t\tvar overflowX = 0, overflowY = 0;\n\n\t\tghostElm.style.left = position.pageX + 'px';\n\t\tghostElm.style.top = position.pageY + 'px';\n\n\t\tif (position.pageX + width > maxX) {\n\t\t\toverflowX = (position.pageX + width) - maxX;\n\t\t}\n\n\t\tif (position.pageY + height > maxY) {\n\t\t\toverflowY = (position.pageY + height) - maxY;\n\t\t}\n\n\t\tghostElm.style.width = (width - overflowX) + 'px';\n\t\tghostElm.style.height = (height - overflowY) + 'px';\n\t};\n\n\tvar removeElement = function (elm) {\n\t\tif (elm && elm.parentNode) {\n\t\t\telm.parentNode.removeChild(elm);\n\t\t}\n\t};\n\n\tvar isLeftMouseButtonPressed = function (e) {\n\t\treturn e.button === 0;\n\t};\n\n\tvar hasDraggableElement = function (state) {\n\t\treturn state.element;\n\t};\n\n\tvar applyRelPos = function (state, position) {\n\t\treturn {\n\t\t\tpageX: position.pageX - state.relX,\n\t\t\tpageY: position.pageY + 5\n\t\t};\n\t};\n\n\tvar start = function (state, editor) {\n\t\treturn function (e) {\n\t\t\tif (isLeftMouseButtonPressed(e)) {\n\t\t\t\tvar ceElm = Arr.find(editor.dom.getParents(e.target), Fun.or(isContentEditableFalse, isContentEditableTrue));\n\n\t\t\t\tif (isDraggable(ceElm)) {\n\t\t\t\t\tvar elmPos = editor.dom.getPos(ceElm);\n\t\t\t\t\tvar bodyElm = editor.getBody();\n\t\t\t\t\tvar docElm = editor.getDoc().documentElement;\n\n\t\t\t\t\tstate.element = ceElm;\n\t\t\t\t\tstate.screenX = e.screenX;\n\t\t\t\t\tstate.screenY = e.screenY;\n\t\t\t\t\tstate.maxX = (editor.inline ? bodyElm.scrollWidth : docElm.offsetWidth) - 2;\n\t\t\t\t\tstate.maxY = (editor.inline ? bodyElm.scrollHeight : docElm.offsetHeight) - 2;\n\t\t\t\t\tstate.relX = e.pageX - elmPos.x;\n\t\t\t\t\tstate.relY = e.pageY - elmPos.y;\n\t\t\t\t\tstate.width = ceElm.offsetWidth;\n\t\t\t\t\tstate.height = ceElm.offsetHeight;\n\t\t\t\t\tstate.ghost = createGhost(editor, ceElm, state.width, state.height);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t};\n\n\tvar move = function (state, editor) {\n\t\t// Reduces laggy drag behavior on Gecko\n\t\tvar throttledPlaceCaretAt = Delay.throttle(function (clientX, clientY) {\n\t\t\teditor._selectionOverrides.hideFakeCaret();\n\t\t\teditor.selection.placeCaretAt(clientX, clientY);\n\t\t}, 0);\n\n\t\treturn function (e) {\n\t\t\tvar movement = Math.max(Math.abs(e.screenX - state.screenX), Math.abs(e.screenY - state.screenY));\n\n\t\t\tif (hasDraggableElement(state) && !state.dragging && movement > 10) {\n\t\t\t\tvar args = editor.fire('dragstart', {target: state.element});\n\t\t\t\tif (args.isDefaultPrevented()) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tstate.dragging = true;\n\t\t\t\teditor.focus();\n\t\t\t}\n\n\t\t\tif (state.dragging) {\n\t\t\t\tvar targetPos = applyRelPos(state, MousePosition.calc(editor, e));\n\n\t\t\t\tappendGhostToBody(state.ghost, editor.getBody());\n\t\t\t\tmoveGhost(state.ghost, targetPos, state.width, state.height, state.maxX, state.maxY);\n\n\t\t\t\tthrottledPlaceCaretAt(e.clientX, e.clientY);\n\t\t\t}\n\t\t};\n\t};\n\n\t// Returns the raw element instead of the fake cE=false element\n\tvar getRawTarget = function (selection) {\n\t\tvar rng = selection.getSel().getRangeAt(0);\n\t\tvar startContainer = rng.startContainer;\n\t\treturn startContainer.nodeType === 3 ? startContainer.parentNode : startContainer;\n\t};\n\n\tvar drop = function (state, editor) {\n\t\treturn function (e) {\n\t\t\tif (state.dragging) {\n\t\t\t\tif (isValidDropTarget(editor, getRawTarget(editor.selection), state.element)) {\n\t\t\t\t\tvar targetClone = cloneElement(state.element);\n\n\t\t\t\t\tvar args = editor.fire('drop', {\n\t\t\t\t\t\ttargetClone: targetClone,\n\t\t\t\t\t\tclientX: e.clientX,\n\t\t\t\t\t\tclientY: e.clientY\n\t\t\t\t\t});\n\n\t\t\t\t\tif (!args.isDefaultPrevented()) {\n\t\t\t\t\t\ttargetClone = args.targetClone;\n\n\t\t\t\t\t\teditor.undoManager.transact(function() {\n\t\t\t\t\t\t\tremoveElement(state.element);\n\t\t\t\t\t\t\teditor.insertContent(editor.dom.getOuterHTML(targetClone));\n\t\t\t\t\t\t\teditor._selectionOverrides.hideFakeCaret();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tremoveDragState(state);\n\t\t};\n\t};\n\n\tvar stop = function (state, editor) {\n\t\treturn function () {\n\t\t\tremoveDragState(state);\n\t\t\tif (state.dragging) {\n\t\t\t\teditor.fire('dragend');\n\t\t\t}\n\t\t};\n\t};\n\n\tvar removeDragState = function (state) {\n\t\tstate.dragging = false;\n\t\tstate.element = null;\n\t\tremoveElement(state.ghost);\n\t};\n\n\tvar bindFakeDragEvents = function (editor) {\n\t\tvar state = {}, pageDom, dragStartHandler, dragHandler, dropHandler, dragEndHandler, rootDocument;\n\n\t\tpageDom = DOMUtils.DOM;\n\t\trootDocument = document;\n\t\tdragStartHandler = start(state, editor);\n\t\tdragHandler = move(state, editor);\n\t\tdropHandler = drop(state, editor);\n\t\tdragEndHandler = stop(state, editor);\n\n\t\teditor.on('mousedown', dragStartHandler);\n\t\teditor.on('mousemove', dragHandler);\n\t\teditor.on('mouseup', dropHandler);\n\n\t\tpageDom.bind(rootDocument, 'mousemove', dragHandler);\n\t\tpageDom.bind(rootDocument, 'mouseup', dragEndHandler);\n\n\t\teditor.on('remove', function () {\n\t\t\tpageDom.unbind(rootDocument, 'mousemove', dragHandler);\n\t\t\tpageDom.unbind(rootDocument, 'mouseup', dragEndHandler);\n\t\t});\n\t};\n\n\tvar blockIeDrop = function (editor) {\n\t\teditor.on('drop', function(e) {\n\t\t\t// FF doesn't pass out clientX/clientY for drop since this is for IE we just use null instead\n\t\t\tvar realTarget = typeof e.clientX !== 'undefined' ? editor.getDoc().elementFromPoint(e.clientX, e.clientY) : null;\n\n\t\t\tif (isContentEditableFalse(realTarget) || isContentEditableFalse(editor.dom.getContentEditableParent(realTarget))) {\n\t\t\t\te.preventDefault();\n\t\t\t}\n\t\t});\n\t};\n\n\tvar init = function (editor) {\n\t\tbindFakeDragEvents(editor);\n\t\tblockIeDrop(editor);\n\t};\n\n\treturn {\n\t\tinit: init\n\t};\n});\n\n// Included from: js/tinymce/classes/SelectionOverrides.js\n\n/**\n * SelectionOverrides.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This module contains logic overriding the selection with keyboard/mouse\n * around contentEditable=false regions.\n *\n * @example\n * // Disable the default cE=false selection\n * tinymce.activeEditor.on('ShowCaret BeforeObjectSelected', function(e) {\n *     e.preventDefault();\n * });\n *\n * @private\n * @class tinymce.SelectionOverrides\n */\ndefine(\"tinymce/SelectionOverrides\", [\n\t\"tinymce/Env\",\n\t\"tinymce/caret/CaretWalker\",\n\t\"tinymce/caret/CaretPosition\",\n\t\"tinymce/caret/CaretContainer\",\n\t\"tinymce/caret/CaretUtils\",\n\t\"tinymce/caret/FakeCaret\",\n\t\"tinymce/caret/LineWalker\",\n\t\"tinymce/caret/LineUtils\",\n\t\"tinymce/dom/NodeType\",\n\t\"tinymce/dom/RangeUtils\",\n\t\"tinymce/geom/ClientRect\",\n\t\"tinymce/util/VK\",\n\t\"tinymce/util/Fun\",\n\t\"tinymce/util/Arr\",\n\t\"tinymce/util/Delay\",\n\t\"tinymce/DragDropOverrides\"\n], function(\n\tEnv, CaretWalker, CaretPosition, CaretContainer, CaretUtils, FakeCaret, LineWalker,\n\tLineUtils, NodeType, RangeUtils, ClientRect, VK, Fun, Arr, Delay, DragDropOverrides\n) {\n\tvar curry = Fun.curry,\n\t\tisContentEditableTrue = NodeType.isContentEditableTrue,\n\t\tisContentEditableFalse = NodeType.isContentEditableFalse,\n\t\tisElement = NodeType.isElement,\n\t\tisAfterContentEditableFalse = CaretUtils.isAfterContentEditableFalse,\n\t\tisBeforeContentEditableFalse = CaretUtils.isBeforeContentEditableFalse,\n\t\tgetSelectedNode = RangeUtils.getSelectedNode;\n\n\tfunction getVisualCaretPosition(walkFn, caretPosition) {\n\t\twhile ((caretPosition = walkFn(caretPosition))) {\n\t\t\tif (caretPosition.isVisible()) {\n\t\t\t\treturn caretPosition;\n\t\t\t}\n\t\t}\n\n\t\treturn caretPosition;\n\t}\n\n\tfunction SelectionOverrides(editor) {\n\t\tvar rootNode = editor.getBody(), caretWalker = new CaretWalker(rootNode);\n\t\tvar getNextVisualCaretPosition = curry(getVisualCaretPosition, caretWalker.next);\n\t\tvar getPrevVisualCaretPosition = curry(getVisualCaretPosition, caretWalker.prev),\n\t\t\tfakeCaret = new FakeCaret(editor.getBody(), isBlock),\n\t\t\trealSelectionId = 'sel-' + editor.dom.uniqueId(),\n\t\t\tselectedContentEditableNode, $ = editor.$;\n\n\t\tfunction isFakeSelectionElement(elm) {\n\t\t\treturn editor.dom.hasClass(elm, 'mce-offscreen-selection');\n\t\t}\n\n\t\tfunction getRealSelectionElement() {\n\t\t\tvar container = editor.dom.get(realSelectionId);\n\t\t\treturn container ? container.getElementsByTagName('*')[0] : container;\n\t\t}\n\n\t\tfunction isBlock(node) {\n\t\t\treturn editor.dom.isBlock(node);\n\t\t}\n\n\t\tfunction setRange(range) {\n\t\t\t//console.log('setRange', range);\n\t\t\tif (range) {\n\t\t\t\teditor.selection.setRng(range);\n\t\t\t}\n\t\t}\n\n\t\tfunction getRange() {\n\t\t\treturn editor.selection.getRng();\n\t\t}\n\n\t\tfunction scrollIntoView(node, alignToTop) {\n\t\t\teditor.selection.scrollIntoView(node, alignToTop);\n\t\t}\n\n\t\tfunction showCaret(direction, node, before) {\n\t\t\tvar e;\n\n\t\t\te = editor.fire('ShowCaret', {\n\t\t\t\ttarget: node,\n\t\t\t\tdirection: direction,\n\t\t\t\tbefore: before\n\t\t\t});\n\n\t\t\tif (e.isDefaultPrevented()) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tscrollIntoView(node, direction === -1);\n\n\t\t\treturn fakeCaret.show(before, node);\n\t\t}\n\n\t\tfunction selectNode(node) {\n\t\t\tvar e;\n\n\t\t\te = editor.fire('BeforeObjectSelected', {target: node});\n\t\t\tif (e.isDefaultPrevented()) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn getNodeRange(node);\n\t\t}\n\n\t\tfunction getNodeRange(node) {\n\t\t\tvar rng = node.ownerDocument.createRange();\n\n\t\t\trng.selectNode(node);\n\n\t\t\treturn rng;\n\t\t}\n\n\t\tfunction isMoveInsideSameBlock(fromCaretPosition, toCaretPosition) {\n\t\t\tvar inSameBlock = CaretUtils.isInSameBlock(fromCaretPosition, toCaretPosition);\n\n\t\t\t// Handle bogus BR <p>abc|<br></p>\n\t\t\tif (!inSameBlock && NodeType.isBr(fromCaretPosition.getNode())) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn inSameBlock;\n\t\t}\n\n\t\tfunction getNormalizedRangeEndPoint(direction, range) {\n\t\t\trange = CaretUtils.normalizeRange(direction, rootNode, range);\n\n\t\t\tif (direction == -1) {\n\t\t\t\treturn CaretPosition.fromRangeStart(range);\n\t\t\t}\n\n\t\t\treturn CaretPosition.fromRangeEnd(range);\n\t\t}\n\n\t\tfunction isRangeInCaretContainerBlock(range) {\n\t\t\treturn CaretContainer.isCaretContainerBlock(range.startContainer);\n\t\t}\n\n\t\tfunction moveToCeFalseHorizontally(direction, getNextPosFn, isBeforeContentEditableFalseFn, range) {\n\t\t\tvar node, caretPosition, peekCaretPosition, rangeIsInContainerBlock;\n\n\t\t\tif (!range.collapsed) {\n\t\t\t\tnode = getSelectedNode(range);\n\t\t\t\tif (isContentEditableFalse(node)) {\n\t\t\t\t\treturn showCaret(direction, node, direction == -1);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\trangeIsInContainerBlock = isRangeInCaretContainerBlock(range);\n\t\t\tcaretPosition = getNormalizedRangeEndPoint(direction, range);\n\n\t\t\tif (isBeforeContentEditableFalseFn(caretPosition)) {\n\t\t\t\treturn selectNode(caretPosition.getNode(direction == -1));\n\t\t\t}\n\n\t\t\tcaretPosition = getNextPosFn(caretPosition);\n\t\t\tif (!caretPosition) {\n\t\t\t\tif (rangeIsInContainerBlock) {\n\t\t\t\t\treturn range;\n\t\t\t\t}\n\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (isBeforeContentEditableFalseFn(caretPosition)) {\n\t\t\t\treturn showCaret(direction, caretPosition.getNode(direction == -1), direction == 1);\n\t\t\t}\n\n\t\t\t// Peek ahead for handling of ab|c<span cE=false> -> abc|<span cE=false>\n\t\t\tpeekCaretPosition = getNextPosFn(caretPosition);\n\t\t\tif (isBeforeContentEditableFalseFn(peekCaretPosition)) {\n\t\t\t\tif (isMoveInsideSameBlock(caretPosition, peekCaretPosition)) {\n\t\t\t\t\treturn showCaret(direction, peekCaretPosition.getNode(direction == -1), direction == 1);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (rangeIsInContainerBlock) {\n\t\t\t\treturn renderRangeCaret(caretPosition.toRange());\n\t\t\t}\n\n\t\t\treturn null;\n\t\t}\n\n\t\tfunction moveToCeFalseVertically(direction, walkerFn, range) {\n\t\t\tvar caretPosition, linePositions, nextLinePositions,\n\t\t\t\tclosestNextLineRect, caretClientRect, clientX,\n\t\t\t\tdist1, dist2, contentEditableFalseNode;\n\n\t\t\tcontentEditableFalseNode = getSelectedNode(range);\n\t\t\tcaretPosition = getNormalizedRangeEndPoint(direction, range);\n\t\t\tlinePositions = walkerFn(rootNode, LineWalker.isAboveLine(1), caretPosition);\n\t\t\tnextLinePositions = Arr.filter(linePositions, LineWalker.isLine(1));\n\t\t\tcaretClientRect = Arr.last(caretPosition.getClientRects());\n\n\t\t\tif (isBeforeContentEditableFalse(caretPosition)) {\n\t\t\t\tcontentEditableFalseNode = caretPosition.getNode();\n\t\t\t}\n\n\t\t\tif (isAfterContentEditableFalse(caretPosition)) {\n\t\t\t\tcontentEditableFalseNode = caretPosition.getNode(true);\n\t\t\t}\n\n\t\t\tif (!caretClientRect) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tclientX = caretClientRect.left;\n\n\t\t\tclosestNextLineRect = LineUtils.findClosestClientRect(nextLinePositions, clientX);\n\t\t\tif (closestNextLineRect) {\n\t\t\t\tif (isContentEditableFalse(closestNextLineRect.node)) {\n\t\t\t\t\tdist1 = Math.abs(clientX - closestNextLineRect.left);\n\t\t\t\t\tdist2 = Math.abs(clientX - closestNextLineRect.right);\n\n\t\t\t\t\treturn showCaret(direction, closestNextLineRect.node, dist1 < dist2);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (contentEditableFalseNode) {\n\t\t\t\tvar caretPositions = LineWalker.positionsUntil(direction, rootNode, LineWalker.isAboveLine(1), contentEditableFalseNode);\n\n\t\t\t\tclosestNextLineRect = LineUtils.findClosestClientRect(Arr.filter(caretPositions, LineWalker.isLine(1)), clientX);\n\t\t\t\tif (closestNextLineRect) {\n\t\t\t\t\treturn renderRangeCaret(closestNextLineRect.position.toRange());\n\t\t\t\t}\n\n\t\t\t\tclosestNextLineRect = Arr.last(Arr.filter(caretPositions, LineWalker.isLine(0)));\n\t\t\t\tif (closestNextLineRect) {\n\t\t\t\t\treturn renderRangeCaret(closestNextLineRect.position.toRange());\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction exitPreBlock(direction, range) {\n\t\t\tvar pre, caretPos, newBlock;\n\n\t\t\tfunction createTextBlock() {\n\t\t\t\tvar textBlock = editor.dom.create(editor.settings.forced_root_block);\n\n\t\t\t\tif (!Env.ie || Env.ie >= 11) {\n\t\t\t\t\ttextBlock.innerHTML = '<br data-mce-bogus=\"1\">';\n\t\t\t\t}\n\n\t\t\t\treturn textBlock;\n\t\t\t}\n\n\t\t\tif (range.collapsed && editor.settings.forced_root_block) {\n\t\t\t\tpre = editor.dom.getParent(range.startContainer, 'PRE');\n\t\t\t\tif (!pre) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (direction == 1) {\n\t\t\t\t\tcaretPos = getNextVisualCaretPosition(CaretPosition.fromRangeStart(range));\n\t\t\t\t} else {\n\t\t\t\t\tcaretPos = getPrevVisualCaretPosition(CaretPosition.fromRangeStart(range));\n\t\t\t\t}\n\n\t\t\t\tif (!caretPos) {\n\t\t\t\t\tnewBlock = createTextBlock();\n\n\t\t\t\t\tif (direction == 1) {\n\t\t\t\t\t\teditor.$(pre).after(newBlock);\n\t\t\t\t\t} else {\n\t\t\t\t\t\teditor.$(pre).before(newBlock);\n\t\t\t\t\t}\n\n\t\t\t\t\teditor.selection.select(newBlock, true);\n\t\t\t\t\teditor.selection.collapse();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction moveH(direction, getNextPosFn, isBeforeContentEditableFalseFn, range) {\n\t\t\tvar newRange;\n\n\t\t\tnewRange = moveToCeFalseHorizontally(direction, getNextPosFn, isBeforeContentEditableFalseFn, range);\n\t\t\tif (newRange) {\n\t\t\t\treturn newRange;\n\t\t\t}\n\n\t\t\tnewRange = exitPreBlock(direction, range);\n\t\t\tif (newRange) {\n\t\t\t\treturn newRange;\n\t\t\t}\n\n\t\t\treturn null;\n\t\t}\n\n\t\tfunction moveV(direction, walkerFn, range) {\n\t\t\tvar newRange;\n\n\t\t\tnewRange = moveToCeFalseVertically(direction, walkerFn, range);\n\t\t\tif (newRange) {\n\t\t\t\treturn newRange;\n\t\t\t}\n\n\t\t\tnewRange = exitPreBlock(direction, range);\n\t\t\tif (newRange) {\n\t\t\t\treturn newRange;\n\t\t\t}\n\n\t\t\treturn null;\n\t\t}\n\n\t\tfunction getBlockCaretContainer() {\n\t\t\treturn $('*[data-mce-caret]')[0];\n\t\t}\n\n\t\tfunction showBlockCaretContainer(blockCaretContainer) {\n\t\t\tif (blockCaretContainer.hasAttribute('data-mce-caret')) {\n\t\t\t\tCaretContainer.showCaretContainerBlock(blockCaretContainer);\n\t\t\t\tsetRange(getRange()); // Removes control rect on IE\n\t\t\t\tscrollIntoView(blockCaretContainer[0]);\n\t\t\t}\n\t\t}\n\n\t\tfunction renderCaretAtRange(range) {\n\t\t\tvar caretPosition, ceRoot;\n\n\t\t\trange = CaretUtils.normalizeRange(1, rootNode, range);\n\t\t\tcaretPosition = CaretPosition.fromRangeStart(range);\n\n\t\t\tif (isContentEditableFalse(caretPosition.getNode())) {\n\t\t\t\treturn showCaret(1, caretPosition.getNode(), !caretPosition.isAtEnd());\n\t\t\t}\n\n\t\t\tif (isContentEditableFalse(caretPosition.getNode(true))) {\n\t\t\t\treturn showCaret(1, caretPosition.getNode(true), false);\n\t\t\t}\n\n\t\t\t// TODO: Should render caret before/after depending on where you click on the page forces after now\n\t\t\tceRoot = editor.dom.getParent(caretPosition.getNode(), Fun.or(isContentEditableFalse, isContentEditableTrue));\n\t\t\tif (isContentEditableFalse(ceRoot)) {\n\t\t\t\treturn showCaret(1, ceRoot, false);\n\t\t\t}\n\n\t\t\treturn null;\n\t\t}\n\n\t\tfunction renderRangeCaret(range) {\n\t\t\tvar caretRange;\n\n\t\t\tif (!range || !range.collapsed) {\n\t\t\t\treturn range;\n\t\t\t}\n\n\t\t\tcaretRange = renderCaretAtRange(range);\n\t\t\tif (caretRange) {\n\t\t\t\treturn caretRange;\n\t\t\t}\n\n\t\t\treturn range;\n\t\t}\n\n\t\tfunction deleteContentEditableNode(node) {\n\t\t\tvar nextCaretPosition, prevCaretPosition, prevCeFalseElm, nextElement;\n\n\t\t\tif (!isContentEditableFalse(node)) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (isContentEditableFalse(node.previousSibling)) {\n\t\t\t\tprevCeFalseElm = node.previousSibling;\n\t\t\t}\n\n\t\t\tprevCaretPosition = getPrevVisualCaretPosition(CaretPosition.before(node));\n\t\t\tif (!prevCaretPosition) {\n\t\t\t\tnextCaretPosition = getNextVisualCaretPosition(CaretPosition.after(node));\n\t\t\t}\n\n\t\t\tif (nextCaretPosition && isElement(nextCaretPosition.getNode())) {\n\t\t\t\tnextElement = nextCaretPosition.getNode();\n\t\t\t}\n\n\t\t\tCaretContainer.remove(node.previousSibling);\n\t\t\tCaretContainer.remove(node.nextSibling);\n\t\t\teditor.dom.remove(node);\n\n\t\t\tif (editor.dom.isEmpty(editor.getBody())) {\n\t\t\t\teditor.setContent('');\n\t\t\t\teditor.focus();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (prevCeFalseElm) {\n\t\t\t\treturn CaretPosition.after(prevCeFalseElm).toRange();\n\t\t\t}\n\n\t\t\tif (nextElement) {\n\t\t\t\treturn CaretPosition.before(nextElement).toRange();\n\t\t\t}\n\n\t\t\tif (prevCaretPosition) {\n\t\t\t\treturn prevCaretPosition.toRange();\n\t\t\t}\n\n\t\t\tif (nextCaretPosition) {\n\t\t\t\treturn nextCaretPosition.toRange();\n\t\t\t}\n\n\t\t\treturn null;\n\t\t}\n\n\t\tfunction isTextBlock(node) {\n\t\t\tvar textBlocks = editor.schema.getTextBlockElements();\n\t\t\treturn node.nodeName in textBlocks;\n\t\t}\n\n\t\tfunction isEmpty(elm) {\n\t\t\treturn editor.dom.isEmpty(elm);\n\t\t}\n\n\t\tfunction mergeTextBlocks(direction, fromCaretPosition, toCaretPosition) {\n\t\t\tvar dom = editor.dom, fromBlock, toBlock, node, ceTarget;\n\n\t\t\tfromBlock = dom.getParent(fromCaretPosition.getNode(), dom.isBlock);\n\t\t\ttoBlock = dom.getParent(toCaretPosition.getNode(), dom.isBlock);\n\n\t\t\tif (direction === -1) {\n\t\t\t\tceTarget = toCaretPosition.getNode(true);\n\t\t\t\tif (isAfterContentEditableFalse(toCaretPosition) && isBlock(ceTarget)) {\n\t\t\t\t\tif (isTextBlock(fromBlock)) {\n\t\t\t\t\t\tif (isEmpty(fromBlock)) {\n\t\t\t\t\t\t\tdom.remove(fromBlock);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn CaretPosition.after(ceTarget).toRange();\n\t\t\t\t\t}\n\n\t\t\t\t\treturn deleteContentEditableNode(toCaretPosition.getNode(true));\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tceTarget = fromCaretPosition.getNode();\n\t\t\t\tif (isBeforeContentEditableFalse(fromCaretPosition) && isBlock(ceTarget)) {\n\t\t\t\t\tif (isTextBlock(toBlock)) {\n\t\t\t\t\t\tif (isEmpty(toBlock)) {\n\t\t\t\t\t\t\tdom.remove(toBlock);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn CaretPosition.before(ceTarget).toRange();\n\t\t\t\t\t}\n\n\t\t\t\t\treturn deleteContentEditableNode(fromCaretPosition.getNode());\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Verify that both blocks are text blocks\n\t\t\tif (fromBlock === toBlock || !isTextBlock(fromBlock) || !isTextBlock(toBlock)) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\twhile ((node = fromBlock.firstChild)) {\n\t\t\t\ttoBlock.appendChild(node);\n\t\t\t}\n\n\t\t\teditor.dom.remove(fromBlock);\n\n\t\t\treturn toCaretPosition.toRange();\n\t\t}\n\n\t\tfunction backspaceDelete(direction, beforeFn, afterFn, range) {\n\t\t\tvar node, caretPosition, peekCaretPosition, newCaretPosition;\n\n\t\t\tif (!range.collapsed) {\n\t\t\t\tnode = getSelectedNode(range);\n\t\t\t\tif (isContentEditableFalse(node)) {\n\t\t\t\t\treturn renderRangeCaret(deleteContentEditableNode(node));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcaretPosition = getNormalizedRangeEndPoint(direction, range);\n\n\t\t\tif (afterFn(caretPosition) && CaretContainer.isCaretContainerBlock(range.startContainer)) {\n\t\t\t\tnewCaretPosition = direction == -1 ? caretWalker.prev(caretPosition) : caretWalker.next(caretPosition);\n\t\t\t\treturn newCaretPosition ? renderRangeCaret(newCaretPosition.toRange()) : range;\n\t\t\t}\n\n\t\t\tif (beforeFn(caretPosition)) {\n\t\t\t\treturn renderRangeCaret(deleteContentEditableNode(caretPosition.getNode(direction == -1)));\n\t\t\t}\n\n\t\t\tpeekCaretPosition = direction == -1 ? caretWalker.prev(caretPosition) : caretWalker.next(caretPosition);\n\t\t\tif (beforeFn(peekCaretPosition)) {\n\t\t\t\tif (direction === -1) {\n\t\t\t\t\treturn mergeTextBlocks(direction, caretPosition, peekCaretPosition);\n\t\t\t\t}\n\n\t\t\t\treturn mergeTextBlocks(direction, peekCaretPosition, caretPosition);\n\t\t\t}\n\t\t}\n\n\t\tfunction registerEvents() {\n\t\t\tvar right = curry(moveH, 1, getNextVisualCaretPosition, isBeforeContentEditableFalse);\n\t\t\tvar left = curry(moveH, -1, getPrevVisualCaretPosition, isAfterContentEditableFalse);\n\t\t\tvar deleteForward = curry(backspaceDelete, 1, isBeforeContentEditableFalse, isAfterContentEditableFalse);\n\t\t\tvar backspace = curry(backspaceDelete, -1, isAfterContentEditableFalse, isBeforeContentEditableFalse);\n\t\t\tvar up = curry(moveV, -1, LineWalker.upUntil);\n\t\t\tvar down = curry(moveV, 1, LineWalker.downUntil);\n\n\t\t\tfunction override(evt, moveFn) {\n\t\t\t\tvar range = moveFn(getRange());\n\n\t\t\t\tif (range && !evt.isDefaultPrevented()) {\n\t\t\t\t\tevt.preventDefault();\n\t\t\t\t\tsetRange(range);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction getContentEditableRoot(node) {\n\t\t\t\tvar root = editor.getBody();\n\n\t\t\t\twhile (node && node != root) {\n\t\t\t\t\tif (isContentEditableTrue(node) || isContentEditableFalse(node)) {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t}\n\n\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t}\n\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tfunction isXYWithinRange(clientX, clientY, range) {\n\t\t\t\tif (range.collapsed) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\treturn Arr.reduce(range.getClientRects(), function(state, rect) {\n\t\t\t\t\treturn state || ClientRect.containsXY(rect, clientX, clientY);\n\t\t\t\t}, false);\n\t\t\t}\n\n\t\t\t// Some browsers (Chrome) lets you place the caret after a cE=false\n\t\t\t// Make sure we render the caret container in this case\n\t\t\teditor.on('mouseup', function() {\n\t\t\t\tvar range = getRange();\n\n\t\t\t\tif (range.collapsed) {\n\t\t\t\t\tsetRange(renderCaretAtRange(range));\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teditor.on('click', function(e) {\n\t\t\t\tvar contentEditableRoot;\n\n\t\t\t\tcontentEditableRoot\t= getContentEditableRoot(e.target);\n\t\t\t\tif (contentEditableRoot) {\n\t\t\t\t\t// Prevent clicks on links in a cE=false element\n\t\t\t\t\tif (isContentEditableFalse(contentEditableRoot)) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\teditor.focus();\n\t\t\t\t\t}\n\n\t\t\t\t\t// Removes fake selection if a cE=true is clicked within a cE=false like the toc title\n\t\t\t\t\tif (isContentEditableTrue(contentEditableRoot)) {\n\t\t\t\t\t\tif (editor.dom.isChildOf(contentEditableRoot, editor.selection.getNode())) {\n\t\t\t\t\t\t\tremoveContentEditableSelection();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teditor.on('blur NewBlock', function () {\n\t\t\t\tremoveContentEditableSelection();\n\t\t\t\thideFakeCaret();\n\t\t\t});\n\n\t\t\tfunction handleTouchSelect(editor) {\n\t\t\t\tvar moved = false;\n\n\t\t\t\teditor.on('touchstart', function () {\n\t\t\t\t\tmoved = false;\n\t\t\t\t});\n\n\t\t\t\teditor.on('touchmove', function () {\n\t\t\t\t\tmoved = true;\n\t\t\t\t});\n\n\t\t\t\teditor.on('touchend', function (e) {\n\t\t\t\t\tvar contentEditableRoot\t= getContentEditableRoot(e.target);\n\n\t\t\t\t\tif (isContentEditableFalse(contentEditableRoot)) {\n\t\t\t\t\t\tif (!moved) {\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\tsetContentEditableSelection(selectNode(contentEditableRoot));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tvar hasNormalCaretPosition = function (elm) {\n\t\t\t\tvar caretWalker = new CaretWalker(elm);\n\n\t\t\t\tif (!elm.firstChild) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tvar startPos = CaretPosition.before(elm.firstChild);\n\t\t\t\tvar newPos = caretWalker.next(startPos);\n\n\t\t\t\treturn newPos && !isBeforeContentEditableFalse(newPos) && !isAfterContentEditableFalse(newPos);\n\t\t\t};\n\n\t\t\tvar isInSameBlock = function (node1, node2) {\n\t\t\t\tvar block1 = editor.dom.getParent(node1, editor.dom.isBlock);\n\t\t\t\tvar block2 = editor.dom.getParent(node2, editor.dom.isBlock);\n\t\t\t\treturn block1 === block2;\n\t\t\t};\n\n\t\t\tvar isContentKey = function (e) {\n\t\t\t\tif (e.keyCode >= 112 && e.keyCode <= 123) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t};\n\n\t\t\t// Checks if the target node is in a block and if that block has a caret position better than the\n\t\t\t// suggested caretNode this is to prevent the caret from being sucked in towards a cE=false block if\n\t\t\t// they are adjacent on the vertical axis\n\t\t\tvar hasBetterMouseTarget = function (targetNode, caretNode) {\n\t\t\t\tvar targetBlock = editor.dom.getParent(targetNode, editor.dom.isBlock);\n\t\t\t\tvar caretBlock = editor.dom.getParent(caretNode, editor.dom.isBlock);\n\n\t\t\t\treturn targetBlock && !isInSameBlock(targetBlock, caretBlock) && hasNormalCaretPosition(targetBlock);\n\t\t\t};\n\n\t\t\thandleTouchSelect(editor);\n\n\t\t\teditor.on('mousedown', function(e) {\n\t\t\t\tvar contentEditableRoot;\n\n\t\t\t\tcontentEditableRoot\t= getContentEditableRoot(e.target);\n\t\t\t\tif (contentEditableRoot) {\n\t\t\t\t\tif (isContentEditableFalse(contentEditableRoot)) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tsetContentEditableSelection(selectNode(contentEditableRoot));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (!isXYWithinRange(e.clientX, e.clientY, editor.selection.getRng())) {\n\t\t\t\t\t\t\teditor.selection.placeCaretAt(e.clientX, e.clientY);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// Remove needs to be called here since the mousedown might alter the selection without calling selection.setRng\n\t\t\t\t\t// and therefore not fire the AfterSetSelectionRange event.\n\t\t\t\t\tremoveContentEditableSelection();\n\t\t\t\t\thideFakeCaret();\n\n\t\t\t\t\tvar caretInfo = LineUtils.closestCaret(rootNode, e.clientX, e.clientY);\n\t\t\t\t\tif (caretInfo) {\n\t\t\t\t\t\tif (!hasBetterMouseTarget(e.target, caretInfo.node)) {\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\teditor.getBody().focus();\n\t\t\t\t\t\t\tsetRange(showCaret(1, caretInfo.node, caretInfo.before));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teditor.on('keydown', function(e) {\n\t\t\t\tif (VK.modifierPressed(e)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tswitch (e.keyCode) {\n\t\t\t\t\tcase VK.RIGHT:\n\t\t\t\t\t\toverride(e, right);\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase VK.DOWN:\n\t\t\t\t\t\toverride(e, down);\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase VK.LEFT:\n\t\t\t\t\t\toverride(e, left);\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase VK.UP:\n\t\t\t\t\t\toverride(e, up);\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase VK.DELETE:\n\t\t\t\t\t\toverride(e, deleteForward);\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase VK.BACKSPACE:\n\t\t\t\t\t\toverride(e, backspace);\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tif (isContentEditableFalse(editor.selection.getNode()) && isContentKey(e)) {\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tfunction paddEmptyContentEditableArea() {\n\t\t\t\tvar br, ceRoot = getContentEditableRoot(editor.selection.getNode());\n\n\t\t\t\tif (isContentEditableTrue(ceRoot) && isBlock(ceRoot) && editor.dom.isEmpty(ceRoot)) {\n\t\t\t\t\tbr = editor.dom.create('br', {\"data-mce-bogus\": \"1\"});\n\t\t\t\t\teditor.$(ceRoot).empty().append(br);\n\t\t\t\t\teditor.selection.setRng(CaretPosition.before(br).toRange());\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction handleBlockContainer(e) {\n\t\t\t\tvar blockCaretContainer = getBlockCaretContainer();\n\n\t\t\t\tif (!blockCaretContainer) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (e.type == 'compositionstart') {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tshowBlockCaretContainer(blockCaretContainer);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (CaretContainer.hasContent(blockCaretContainer)) {\n\t\t\t\t\tshowBlockCaretContainer(blockCaretContainer);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction handleEmptyBackspaceDelete(e) {\n\t\t\t\tvar prevent;\n\n\t\t\t\tswitch (e.keyCode) {\n\t\t\t\t\tcase VK.DELETE:\n\t\t\t\t\t\tprevent = paddEmptyContentEditableArea();\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase VK.BACKSPACE:\n\t\t\t\t\t\tprevent = paddEmptyContentEditableArea();\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (prevent) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Must be added to \"top\" since undoManager needs to be executed after\n\t\t\teditor.on('keyup compositionstart', function(e) {\n\t\t\t\thandleBlockContainer(e);\n\t\t\t\thandleEmptyBackspaceDelete(e);\n\t\t\t}, true);\n\n\t\t\teditor.on('cut', function() {\n\t\t\t\tvar node = editor.selection.getNode();\n\n\t\t\t\tif (isContentEditableFalse(node)) {\n\t\t\t\t\tDelay.setEditorTimeout(editor, function() {\n\t\t\t\t\t\tsetRange(renderRangeCaret(deleteContentEditableNode(node)));\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teditor.on('getSelectionRange', function(e) {\n\t\t\t\tvar rng = e.range;\n\n\t\t\t\tif (selectedContentEditableNode) {\n\t\t\t\t\tif (!selectedContentEditableNode.parentNode) {\n\t\t\t\t\t\tselectedContentEditableNode = null;\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\trng = rng.cloneRange();\n\t\t\t\t\trng.selectNode(selectedContentEditableNode);\n\t\t\t\t\te.range = rng;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teditor.on('setSelectionRange', function(e) {\n\t\t\t\tvar rng;\n\n\t\t\t\trng = setContentEditableSelection(e.range);\n\t\t\t\tif (rng) {\n\t\t\t\t\te.range = rng;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teditor.on('AfterSetSelectionRange', function(e) {\n\t\t\t\tvar rng = e.range;\n\n\t\t\t\tif (!isRangeInCaretContainer(rng)) {\n\t\t\t\t\thideFakeCaret();\n\t\t\t\t}\n\n\t\t\t\tif (!isFakeSelectionElement(rng.startContainer.parentNode)) {\n\t\t\t\t\tremoveContentEditableSelection();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teditor.on('focus', function() {\n\t\t\t\t// Make sure we have a proper fake caret on focus\n\t\t\t\tDelay.setEditorTimeout(editor, function() {\n\t\t\t\t\teditor.selection.setRng(renderRangeCaret(editor.selection.getRng()));\n\t\t\t\t}, 0);\n\t\t\t});\n\n\t\t\teditor.on('copy', function (e) {\n\t\t\t\tvar clipboardData = e.clipboardData;\n\n\t\t\t\t// Make sure we get proper html/text for the fake cE=false selection\n\t\t\t\t// Doesn't work at all on Edge since it doesn't have proper clipboardData support\n\t\t\t\tif (!e.isDefaultPrevented() && e.clipboardData && !Env.ie) {\n\t\t\t\t\tvar realSelectionElement = getRealSelectionElement();\n\t\t\t\t\tif (realSelectionElement) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tclipboardData.clearData();\n\t\t\t\t\t\tclipboardData.setData('text/html', realSelectionElement.outerHTML);\n\t\t\t\t\t\tclipboardData.setData('text/plain', realSelectionElement.outerText);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tDragDropOverrides.init(editor);\n\t\t}\n\n\t\tfunction addCss() {\n\t\t\tvar styles = editor.contentStyles, rootClass = '.mce-content-body';\n\n\t\t\tstyles.push(fakeCaret.getCss());\n\t\t\tstyles.push(\n\t\t\t\trootClass + ' .mce-offscreen-selection {' +\n\t\t\t\t\t'position: absolute;' +\n\t\t\t\t\t'left: -9999999999px;' +\n\t\t\t\t\t'max-width: 1000000px;' +\n\t\t\t\t'}' +\n\t\t\t\trootClass + ' *[contentEditable=false] {' +\n\t\t\t\t\t'cursor: default;' +\n\t\t\t\t'}' +\n\t\t\t\trootClass + ' *[contentEditable=true] {' +\n\t\t\t\t\t'cursor: text;' +\n\t\t\t\t'}'\n\t\t\t);\n\t\t}\n\n\t\tfunction isRangeInCaretContainer(rng) {\n\t\t\treturn CaretContainer.isCaretContainer(rng.startContainer) || CaretContainer.isCaretContainer(rng.endContainer);\n\t\t}\n\n\t\tfunction setContentEditableSelection(range) {\n\t\t\tvar node, $ = editor.$, dom = editor.dom, $realSelectionContainer, sel,\n\t\t\t\tstartContainer, startOffset, endOffset, e, caretPosition, targetClone, origTargetClone;\n\n\t\t\tif (!range) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (range.collapsed) {\n\t\t\t\tif (!isRangeInCaretContainer(range)) {\n\t\t\t\t\tcaretPosition = getNormalizedRangeEndPoint(1, range);\n\n\t\t\t\t\tif (isContentEditableFalse(caretPosition.getNode())) {\n\t\t\t\t\t\treturn showCaret(1, caretPosition.getNode(), !caretPosition.isAtEnd());\n\t\t\t\t\t}\n\n\t\t\t\t\tif (isContentEditableFalse(caretPosition.getNode(true))) {\n\t\t\t\t\t\treturn showCaret(1, caretPosition.getNode(true), false);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tstartContainer = range.startContainer;\n\t\t\tstartOffset = range.startOffset;\n\t\t\tendOffset = range.endOffset;\n\n\t\t\t// Normalizes <span cE=false>[</span>] to [<span cE=false></span>]\n\t\t\tif (startContainer.nodeType == 3 && startOffset == 0 && isContentEditableFalse(startContainer.parentNode)) {\n\t\t\t\tstartContainer = startContainer.parentNode;\n\t\t\t\tstartOffset = dom.nodeIndex(startContainer);\n\t\t\t\tstartContainer = startContainer.parentNode;\n\t\t\t}\n\n\t\t\tif (startContainer.nodeType != 1) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (endOffset == startOffset + 1) {\n\t\t\t\tnode = startContainer.childNodes[startOffset];\n\t\t\t}\n\n\t\t\tif (!isContentEditableFalse(node)) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\ttargetClone = origTargetClone = node.cloneNode(true);\n\t\t\te = editor.fire('ObjectSelected', {target: node, targetClone: targetClone});\n\t\t\tif (e.isDefaultPrevented()) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\ttargetClone = e.targetClone;\n\t\t\t$realSelectionContainer = $('#' + realSelectionId);\n\t\t\tif ($realSelectionContainer.length === 0) {\n\t\t\t\t$realSelectionContainer = $(\n\t\t\t\t\t'<div data-mce-bogus=\"all\" class=\"mce-offscreen-selection\"></div>'\n\t\t\t\t).attr('id', realSelectionId);\n\n\t\t\t\t$realSelectionContainer.appendTo(editor.getBody());\n\t\t\t}\n\n\t\t\trange = editor.dom.createRng();\n\n\t\t\t// WHY is IE making things so hard! Copy on <i contentEditable=\"false\">x</i> produces: <em>x</em>\n\t\t\t// This is a ridiculous hack where we place the selection from a block over the inline element\n\t\t\t// so that just the inline element is copied as is and not converted.\n\t\t\tif (targetClone === origTargetClone && Env.ie) {\n\t\t\t\t$realSelectionContainer.empty().append('<p style=\"font-size: 0\" data-mce-bogus=\"all\">\\u00a0</p>').append(targetClone);\n\t\t\t\trange.setStartAfter($realSelectionContainer[0].firstChild.firstChild);\n\t\t\t\trange.setEndAfter(targetClone);\n\t\t\t} else {\n\t\t\t\t$realSelectionContainer.empty().append('\\u00a0').append(targetClone).append('\\u00a0');\n\t\t\t\trange.setStart($realSelectionContainer[0].firstChild, 1);\n\t\t\t\trange.setEnd($realSelectionContainer[0].lastChild, 0);\n\t\t\t}\n\n\t\t\t$realSelectionContainer.css({\n\t\t\t\ttop: dom.getPos(node, editor.getBody()).y\n\t\t\t});\n\n\t\t\t$realSelectionContainer[0].focus();\n\t\t\tsel = editor.selection.getSel();\n\t\t\tsel.removeAllRanges();\n\t\t\tsel.addRange(range);\n\n\t\t\teditor.$('*[data-mce-selected]').removeAttr('data-mce-selected');\n\t\t\tnode.setAttribute('data-mce-selected', 1);\n\t\t\tselectedContentEditableNode = node;\n\n\t\t\treturn range;\n\t\t}\n\n\t\tfunction removeContentEditableSelection() {\n\t\t\tif (selectedContentEditableNode) {\n\t\t\t\tselectedContentEditableNode.removeAttribute('data-mce-selected');\n\t\t\t\teditor.$('#' + realSelectionId).remove();\n\t\t\t\tselectedContentEditableNode = null;\n\t\t\t}\n\t\t}\n\n\t\tfunction destroy() {\n\t\t\tfakeCaret.destroy();\n\t\t\tselectedContentEditableNode = null;\n\t\t}\n\n\t\tfunction hideFakeCaret() {\n\t\t\tfakeCaret.hide();\n\t\t}\n\n\t\tif (Env.ceFalse) {\n\t\t\tregisterEvents();\n\t\t\taddCss();\n\t\t}\n\n\t\treturn {\n\t\t\tshowBlockCaretContainer: showBlockCaretContainer,\n\t\t\thideFakeCaret: hideFakeCaret,\n\t\t\tdestroy: destroy\n\t\t};\n\t}\n\n\treturn SelectionOverrides;\n});\n\n// Included from: js/tinymce/classes/util/Uuid.js\n\n/**\n * Uuid.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Generates unique ids.\n *\n * @class tinymce.util.Uuid\n * @private\n */\ndefine(\"tinymce/util/Uuid\", [\n], function() {\n\tvar count = 0;\n\n\tvar seed = function () {\n\t\tvar rnd = function () {\n\t\t\treturn Math.round(Math.random() * 0xFFFFFFFF).toString(36);\n\t\t};\n\n\t\tvar now = new Date().getTime();\n\t\treturn 's' + now.toString(36) + rnd() + rnd() + rnd();\n\t};\n\n\tvar uuid = function (prefix) {\n\t\treturn prefix + (count++) + seed();\n\t};\n\n\treturn {\n\t\tuuid: uuid\n\t};\n});\n\n// Included from: js/tinymce/classes/ui/Sidebar.js\n\n/**\n * Sidebar.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This module handle sidebar instances for the editor.\n *\n * @class tinymce.ui.Sidebar\n * @private\n */\ndefine(\"tinymce/ui/Sidebar\", [\n], function(\n) {\n\tvar add = function (editor, name, settings) {\n\t\tvar sidebars = editor.sidebars ? editor.sidebars : [];\n\t\tsidebars.push({name: name, settings: settings});\n\t\teditor.sidebars = sidebars;\n\t};\n\n\treturn {\n\t\tadd: add\n\t};\n});\n\n// Included from: js/tinymce/classes/Editor.js\n\n/**\n * Editor.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/*jshint scripturl:true */\n\n/**\n * Include the base event class documentation.\n *\n * @include ../../../tools/docs/tinymce.Event.js\n */\n\n/**\n * This class contains the core logic for a TinyMCE editor.\n *\n * @class tinymce.Editor\n * @mixes tinymce.util.Observable\n * @example\n * // Add a class to all paragraphs in the editor.\n * tinymce.activeEditor.dom.addClass(tinymce.activeEditor.dom.select('p'), 'someclass');\n *\n * // Gets the current editors selection as text\n * tinymce.activeEditor.selection.getContent({format: 'text'});\n *\n * // Creates a new editor instance\n * var ed = new tinymce.Editor('textareaid', {\n *     some_setting: 1\n * }, tinymce.EditorManager);\n *\n * // Select each item the user clicks on\n * ed.on('click', function(e) {\n *     ed.selection.select(e.target);\n * });\n *\n * ed.render();\n */\ndefine(\"tinymce/Editor\", [\n\t\"tinymce/dom/DOMUtils\",\n\t\"tinymce/dom/DomQuery\",\n\t\"tinymce/AddOnManager\",\n\t\"tinymce/NodeChange\",\n\t\"tinymce/html/Node\",\n\t\"tinymce/dom/Serializer\",\n\t\"tinymce/html/Serializer\",\n\t\"tinymce/dom/Selection\",\n\t\"tinymce/Formatter\",\n\t\"tinymce/UndoManager\",\n\t\"tinymce/EnterKey\",\n\t\"tinymce/ForceBlocks\",\n\t\"tinymce/EditorCommands\",\n\t\"tinymce/util/URI\",\n\t\"tinymce/dom/ScriptLoader\",\n\t\"tinymce/dom/EventUtils\",\n\t\"tinymce/WindowManager\",\n\t\"tinymce/NotificationManager\",\n\t\"tinymce/html/Schema\",\n\t\"tinymce/html/DomParser\",\n\t\"tinymce/util/Quirks\",\n\t\"tinymce/Env\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/util/Delay\",\n\t\"tinymce/EditorObservable\",\n\t\"tinymce/Mode\",\n\t\"tinymce/Shortcuts\",\n\t\"tinymce/EditorUpload\",\n\t\"tinymce/SelectionOverrides\",\n\t\"tinymce/util/Uuid\",\n\t\"tinymce/ui/Sidebar\"\n], function(\n\tDOMUtils, DomQuery, AddOnManager, NodeChange, Node, DomSerializer, Serializer,\n\tSelection, Formatter, UndoManager, EnterKey, ForceBlocks, EditorCommands,\n\tURI, ScriptLoader, EventUtils, WindowManager, NotificationManager,\n\tSchema, DomParser, Quirks, Env, Tools, Delay, EditorObservable, Mode, Shortcuts, EditorUpload,\n\tSelectionOverrides, Uuid, Sidebar\n) {\n\t// Shorten these names\n\tvar DOM = DOMUtils.DOM, ThemeManager = AddOnManager.ThemeManager, PluginManager = AddOnManager.PluginManager;\n\tvar extend = Tools.extend, each = Tools.each, explode = Tools.explode;\n\tvar inArray = Tools.inArray, trim = Tools.trim, resolve = Tools.resolve;\n\tvar Event = EventUtils.Event;\n\tvar isGecko = Env.gecko, ie = Env.ie;\n\n\t/**\n\t * Include documentation for all the events.\n\t *\n\t * @include ../../../tools/docs/tinymce.Editor.js\n\t */\n\n\t/**\n\t * Constructs a editor instance by id.\n\t *\n\t * @constructor\n\t * @method Editor\n\t * @param {String} id Unique id for the editor.\n\t * @param {Object} settings Settings for the editor.\n\t * @param {tinymce.EditorManager} editorManager EditorManager instance.\n\t */\n\tfunction Editor(id, settings, editorManager) {\n\t\tvar self = this, documentBaseUrl, baseUri, defaultSettings;\n\n\t\tdocumentBaseUrl = self.documentBaseUrl = editorManager.documentBaseURL;\n\t\tbaseUri = editorManager.baseURI;\n\t\tdefaultSettings = editorManager.defaultSettings;\n\n\t\t/**\n\t\t * Name/value collection with editor settings.\n\t\t *\n\t\t * @property settings\n\t\t * @type Object\n\t\t * @example\n\t\t * // Get the value of the theme setting\n\t\t * tinymce.activeEditor.windowManager.alert(\"You are using the \" + tinymce.activeEditor.settings.theme + \" theme\");\n\t\t */\n\t\tsettings = extend({\n\t\t\tid: id,\n\t\t\ttheme: 'modern',\n\t\t\tdelta_width: 0,\n\t\t\tdelta_height: 0,\n\t\t\tpopup_css: '',\n\t\t\tplugins: '',\n\t\t\tdocument_base_url: documentBaseUrl,\n\t\t\tadd_form_submit_trigger: true,\n\t\t\tsubmit_patch: true,\n\t\t\tadd_unload_trigger: true,\n\t\t\tconvert_urls: true,\n\t\t\trelative_urls: true,\n\t\t\tremove_script_host: true,\n\t\t\tobject_resizing: true,\n\t\t\tdoctype: '<!DOCTYPE html>',\n\t\t\tvisual: true,\n\t\t\tfont_size_style_values: 'xx-small,x-small,small,medium,large,x-large,xx-large',\n\n\t\t\t// See: http://www.w3.org/TR/CSS2/fonts.html#propdef-font-size\n\t\t\tfont_size_legacy_values: 'xx-small,small,medium,large,x-large,xx-large,300%',\n\t\t\tforced_root_block: 'p',\n\t\t\thidden_input: true,\n\t\t\tpadd_empty_editor: true,\n\t\t\trender_ui: true,\n\t\t\tindentation: '30px',\n\t\t\tinline_styles: true,\n\t\t\tconvert_fonts_to_spans: true,\n\t\t\tindent: 'simple',\n\t\t\tindent_before: 'p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,' +\n\t\t\t\t'tfoot,tbody,tr,section,article,hgroup,aside,figure,figcaption,option,optgroup,datalist',\n\t\t\tindent_after: 'p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,' +\n\t\t\t\t'tfoot,tbody,tr,section,article,hgroup,aside,figure,figcaption,option,optgroup,datalist',\n\t\t\tvalidate: true,\n\t\t\tentity_encoding: 'named',\n\t\t\turl_converter: self.convertURL,\n\t\t\turl_converter_scope: self,\n\t\t\tie7_compat: true\n\t\t}, defaultSettings, settings);\n\n\t\t// Merge external_plugins\n\t\tif (defaultSettings && defaultSettings.external_plugins && settings.external_plugins) {\n\t\t\tsettings.external_plugins = extend({}, defaultSettings.external_plugins, settings.external_plugins);\n\t\t}\n\n\t\tself.settings = settings;\n\t\tAddOnManager.language = settings.language || 'en';\n\t\tAddOnManager.languageLoad = settings.language_load;\n\t\tAddOnManager.baseURL = editorManager.baseURL;\n\n\t\t/**\n\t\t * Editor instance id, normally the same as the div/textarea that was replaced.\n\t\t *\n\t\t * @property id\n\t\t * @type String\n\t\t */\n\t\tself.id = settings.id = id;\n\n\t\t/**\n\t\t * State to force the editor to return false on a isDirty call.\n\t\t *\n\t\t * @property isNotDirty\n\t\t * @type Boolean\n\t\t * @deprecated Use editor.setDirty instead.\n\t\t */\n\t\tself.setDirty(false);\n\n\t\t/**\n\t\t * Name/Value object containing plugin instances.\n\t\t *\n\t\t * @property plugins\n\t\t * @type Object\n\t\t * @example\n\t\t * // Execute a method inside a plugin directly\n\t\t * tinymce.activeEditor.plugins.someplugin.someMethod();\n\t\t */\n\t\tself.plugins = {};\n\n\t\t/**\n\t\t * URI object to document configured for the TinyMCE instance.\n\t\t *\n\t\t * @property documentBaseURI\n\t\t * @type tinymce.util.URI\n\t\t * @example\n\t\t * // Get relative URL from the location of document_base_url\n\t\t * tinymce.activeEditor.documentBaseURI.toRelative('/somedir/somefile.htm');\n\t\t *\n\t\t * // Get absolute URL from the location of document_base_url\n\t\t * tinymce.activeEditor.documentBaseURI.toAbsolute('somefile.htm');\n\t\t */\n\t\tself.documentBaseURI = new URI(settings.document_base_url || documentBaseUrl, {\n\t\t\tbase_uri: baseUri\n\t\t});\n\n\t\t/**\n\t\t * URI object to current document that holds the TinyMCE editor instance.\n\t\t *\n\t\t * @property baseURI\n\t\t * @type tinymce.util.URI\n\t\t * @example\n\t\t * // Get relative URL from the location of the API\n\t\t * tinymce.activeEditor.baseURI.toRelative('/somedir/somefile.htm');\n\t\t *\n\t\t * // Get absolute URL from the location of the API\n\t\t * tinymce.activeEditor.baseURI.toAbsolute('somefile.htm');\n\t\t */\n\t\tself.baseURI = baseUri;\n\n\t\t/**\n\t\t * Array with CSS files to load into the iframe.\n\t\t *\n\t\t * @property contentCSS\n\t\t * @type Array\n\t\t */\n\t\tself.contentCSS = [];\n\n\t\t/**\n\t\t * Array of CSS styles to add to head of document when the editor loads.\n\t\t *\n\t\t * @property contentStyles\n\t\t * @type Array\n\t\t */\n\t\tself.contentStyles = [];\n\n\t\t// Creates all events like onClick, onSetContent etc see Editor.Events.js for the actual logic\n\t\tself.shortcuts = new Shortcuts(self);\n\t\tself.loadedCSS = {};\n\t\tself.editorCommands = new EditorCommands(self);\n\t\tself.suffix = editorManager.suffix;\n\t\tself.editorManager = editorManager;\n\t\tself.inline = settings.inline;\n\t\tself.settings.content_editable = self.inline;\n\n\t\tif (settings.cache_suffix) {\n\t\t\tEnv.cacheSuffix = settings.cache_suffix.replace(/^[\\?\\&]+/, '');\n\t\t}\n\n\t\tif (settings.override_viewport === false) {\n\t\t\tEnv.overrideViewPort = false;\n\t\t}\n\n\t\t// Call setup\n\t\teditorManager.fire('SetupEditor', self);\n\t\tself.execCallback('setup', self);\n\n\t\t/**\n\t\t * Dom query instance with default scope to the editor document and default element is the body of the editor.\n\t\t *\n\t\t * @property $\n\t\t * @type tinymce.dom.DomQuery\n\t\t * @example\n\t\t * tinymce.activeEditor.$('p').css('color', 'red');\n\t\t * tinymce.activeEditor.$().append('<p>new</p>');\n\t\t */\n\t\tself.$ = DomQuery.overrideDefaults(function() {\n\t\t\treturn {\n\t\t\t\tcontext: self.inline ? self.getBody() : self.getDoc(),\n\t\t\t\telement: self.getBody()\n\t\t\t};\n\t\t});\n\t}\n\n\tEditor.prototype = {\n\t\t/**\n\t\t * Renders the editor/adds it to the page.\n\t\t *\n\t\t * @method render\n\t\t */\n\t\trender: function() {\n\t\t\tvar self = this, settings = self.settings, id = self.id, suffix = self.suffix;\n\n\t\t\tfunction readyHandler() {\n\t\t\t\tDOM.unbind(window, 'ready', readyHandler);\n\t\t\t\tself.render();\n\t\t\t}\n\n\t\t\t// Page is not loaded yet, wait for it\n\t\t\tif (!Event.domLoaded) {\n\t\t\t\tDOM.bind(window, 'ready', readyHandler);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Element not found, then skip initialization\n\t\t\tif (!self.getElement()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// No editable support old iOS versions etc\n\t\t\tif (!Env.contentEditable) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Hide target element early to prevent content flashing\n\t\t\tif (!settings.inline) {\n\t\t\t\tself.orgVisibility = self.getElement().style.visibility;\n\t\t\t\tself.getElement().style.visibility = 'hidden';\n\t\t\t} else {\n\t\t\t\tself.inline = true;\n\t\t\t}\n\n\t\t\tvar form = self.getElement().form || DOM.getParent(id, 'form');\n\t\t\tif (form) {\n\t\t\t\tself.formElement = form;\n\n\t\t\t\t// Add hidden input for non input elements inside form elements\n\t\t\t\tif (settings.hidden_input && !/TEXTAREA|INPUT/i.test(self.getElement().nodeName)) {\n\t\t\t\t\tDOM.insertAfter(DOM.create('input', {type: 'hidden', name: id}), id);\n\t\t\t\t\tself.hasHiddenInput = true;\n\t\t\t\t}\n\n\t\t\t\t// Pass submit/reset from form to editor instance\n\t\t\t\tself.formEventDelegate = function(e) {\n\t\t\t\t\tself.fire(e.type, e);\n\t\t\t\t};\n\n\t\t\t\tDOM.bind(form, 'submit reset', self.formEventDelegate);\n\n\t\t\t\t// Reset contents in editor when the form is reset\n\t\t\t\tself.on('reset', function() {\n\t\t\t\t\tself.setContent(self.startContent, {format: 'raw'});\n\t\t\t\t});\n\n\t\t\t\t// Check page uses id=\"submit\" or name=\"submit\" for it's submit button\n\t\t\t\tif (settings.submit_patch && !form.submit.nodeType && !form.submit.length && !form._mceOldSubmit) {\n\t\t\t\t\tform._mceOldSubmit = form.submit;\n\t\t\t\t\tform.submit = function() {\n\t\t\t\t\t\tself.editorManager.triggerSave();\n\t\t\t\t\t\tself.setDirty(false);\n\n\t\t\t\t\t\treturn form._mceOldSubmit(form);\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Window manager reference, use this to open new windows and dialogs.\n\t\t\t *\n\t\t\t * @property windowManager\n\t\t\t * @type tinymce.WindowManager\n\t\t\t * @example\n\t\t\t * // Shows an alert message\n\t\t\t * tinymce.activeEditor.windowManager.alert('Hello world!');\n\t\t\t *\n\t\t\t * // Opens a new dialog with the file.htm file and the size 320x240\n\t\t\t * // It also adds a custom parameter this can be retrieved by using tinyMCEPopup.getWindowArg inside the dialog.\n\t\t\t * tinymce.activeEditor.windowManager.open({\n\t\t\t *    url: 'file.htm',\n\t\t\t *    width: 320,\n\t\t\t *    height: 240\n\t\t\t * }, {\n\t\t\t *    custom_param: 1\n\t\t\t * });\n\t\t\t */\n\t\t\tself.windowManager = new WindowManager(self);\n\n\t\t\t/**\n\t\t\t * Notification manager reference, use this to open new windows and dialogs.\n\t\t\t *\n\t\t\t * @property notificationManager\n\t\t\t * @type tinymce.NotificationManager\n\t\t\t * @example\n\t\t\t * // Shows a notification info message.\n\t\t\t * tinymce.activeEditor.notificationManager.open({text: 'Hello world!', type: 'info'});\n\t\t\t */\n\t\t\tself.notificationManager = new NotificationManager(self);\n\n\t\t\tif (settings.encoding == 'xml') {\n\t\t\t\tself.on('GetContent', function(e) {\n\t\t\t\t\tif (e.save) {\n\t\t\t\t\t\te.content = DOM.encode(e.content);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (settings.add_form_submit_trigger) {\n\t\t\t\tself.on('submit', function() {\n\t\t\t\t\tif (self.initialized) {\n\t\t\t\t\t\tself.save();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (settings.add_unload_trigger) {\n\t\t\t\tself._beforeUnload = function() {\n\t\t\t\t\tif (self.initialized && !self.destroyed && !self.isHidden()) {\n\t\t\t\t\t\tself.save({format: 'raw', no_events: true, set_dirty: false});\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tself.editorManager.on('BeforeUnload', self._beforeUnload);\n\t\t\t}\n\n\t\t\t// Load scripts\n\t\t\tfunction loadScripts() {\n\t\t\t\tvar scriptLoader = ScriptLoader.ScriptLoader;\n\n\t\t\t\tif (settings.language && settings.language != 'en' && !settings.language_url) {\n\t\t\t\t\tsettings.language_url = self.editorManager.baseURL + '/langs/' + settings.language + '.js';\n\t\t\t\t}\n\n\t\t\t\tif (settings.language_url) {\n\t\t\t\t\tscriptLoader.add(settings.language_url);\n\t\t\t\t}\n\n\t\t\t\tif (settings.theme && typeof settings.theme != \"function\" &&\n\t\t\t\t\tsettings.theme.charAt(0) != '-' && !ThemeManager.urls[settings.theme]) {\n\t\t\t\t\tvar themeUrl = settings.theme_url;\n\n\t\t\t\t\tif (themeUrl) {\n\t\t\t\t\t\tthemeUrl = self.documentBaseURI.toAbsolute(themeUrl);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthemeUrl = 'themes/' + settings.theme + '/theme' + suffix + '.js';\n\t\t\t\t\t}\n\n\t\t\t\t\tThemeManager.load(settings.theme, themeUrl);\n\t\t\t\t}\n\n\t\t\t\tif (Tools.isArray(settings.plugins)) {\n\t\t\t\t\tsettings.plugins = settings.plugins.join(' ');\n\t\t\t\t}\n\n\t\t\t\teach(settings.external_plugins, function(url, name) {\n\t\t\t\t\tPluginManager.load(name, url);\n\t\t\t\t\tsettings.plugins += ' ' + name;\n\t\t\t\t});\n\n\t\t\t\teach(settings.plugins.split(/[ ,]/), function(plugin) {\n\t\t\t\t\tplugin = trim(plugin);\n\n\t\t\t\t\tif (plugin && !PluginManager.urls[plugin]) {\n\t\t\t\t\t\tif (plugin.charAt(0) == '-') {\n\t\t\t\t\t\t\tplugin = plugin.substr(1, plugin.length);\n\n\t\t\t\t\t\t\tvar dependencies = PluginManager.dependencies(plugin);\n\n\t\t\t\t\t\t\teach(dependencies, function(dep) {\n\t\t\t\t\t\t\t\tvar defaultSettings = {\n\t\t\t\t\t\t\t\t\tprefix: 'plugins/',\n\t\t\t\t\t\t\t\t\tresource: dep,\n\t\t\t\t\t\t\t\t\tsuffix: '/plugin' + suffix + '.js'\n\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\tdep = PluginManager.createUrl(defaultSettings, dep);\n\t\t\t\t\t\t\t\tPluginManager.load(dep.resource, dep);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tPluginManager.load(plugin, {\n\t\t\t\t\t\t\t\tprefix: 'plugins/',\n\t\t\t\t\t\t\t\tresource: plugin,\n\t\t\t\t\t\t\t\tsuffix: '/plugin' + suffix + '.js'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tscriptLoader.loadQueue(function() {\n\t\t\t\t\tif (!self.removed) {\n\t\t\t\t\t\tself.init();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tself.editorManager.add(self);\n\t\t\tloadScripts();\n\t\t},\n\n\t\t/**\n\t\t * Initializes the editor this will be called automatically when\n\t\t * all plugins/themes and language packs are loaded by the rendered method.\n\t\t * This method will setup the iframe and create the theme and plugin instances.\n\t\t *\n\t\t * @method init\n\t\t */\n\t\tinit: function() {\n\t\t\tvar self = this, settings = self.settings, elm = self.getElement();\n\t\t\tvar w, h, minHeight, n, o, Theme, url, bodyId, bodyClass, re, i, initializedPlugins = [];\n\n\t\t\tself.rtl = settings.rtl_ui || self.editorManager.i18n.rtl;\n\t\t\tself.editorManager.i18n.setCode(settings.language);\n\t\t\tsettings.aria_label = settings.aria_label || DOM.getAttrib(elm, 'aria-label', self.getLang('aria.rich_text_area'));\n\n\t\t\tself.fire('ScriptsLoaded');\n\n\t\t\t/**\n\t\t\t * Reference to the theme instance that was used to generate the UI.\n\t\t\t *\n\t\t\t * @property theme\n\t\t\t * @type tinymce.Theme\n\t\t\t * @example\n\t\t\t * // Executes a method on the theme directly\n\t\t\t * tinymce.activeEditor.theme.someMethod();\n\t\t\t */\n\t\t\tif (settings.theme) {\n\t\t\t\tif (typeof settings.theme != \"function\") {\n\t\t\t\t\tsettings.theme = settings.theme.replace(/-/, '');\n\t\t\t\t\tTheme = ThemeManager.get(settings.theme);\n\t\t\t\t\tself.theme = new Theme(self, ThemeManager.urls[settings.theme]);\n\n\t\t\t\t\tif (self.theme.init) {\n\t\t\t\t\t\tself.theme.init(self, ThemeManager.urls[settings.theme] || self.documentBaseUrl.replace(/\\/$/, ''), self.$);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tself.theme = settings.theme;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction initPlugin(plugin) {\n\t\t\t\tvar Plugin = PluginManager.get(plugin), pluginUrl, pluginInstance;\n\n\t\t\t\tpluginUrl = PluginManager.urls[plugin] || self.documentBaseUrl.replace(/\\/$/, '');\n\t\t\t\tplugin = trim(plugin);\n\t\t\t\tif (Plugin && inArray(initializedPlugins, plugin) === -1) {\n\t\t\t\t\teach(PluginManager.dependencies(plugin), function(dep) {\n\t\t\t\t\t\tinitPlugin(dep);\n\t\t\t\t\t});\n\n\t\t\t\t\tif (self.plugins[plugin]) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tpluginInstance = new Plugin(self, pluginUrl, self.$);\n\n\t\t\t\t\tself.plugins[plugin] = pluginInstance;\n\n\t\t\t\t\tif (pluginInstance.init) {\n\t\t\t\t\t\tpluginInstance.init(self, pluginUrl);\n\t\t\t\t\t\tinitializedPlugins.push(plugin);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Create all plugins\n\t\t\teach(settings.plugins.replace(/\\-/g, '').split(/[ ,]/), initPlugin);\n\n\t\t\t// Measure box\n\t\t\tif (settings.render_ui && self.theme) {\n\t\t\t\tself.orgDisplay = elm.style.display;\n\n\t\t\t\tif (typeof settings.theme != \"function\") {\n\t\t\t\t\tw = settings.width || elm.style.width || elm.offsetWidth;\n\t\t\t\t\th = settings.height || elm.style.height || elm.offsetHeight;\n\t\t\t\t\tminHeight = settings.min_height || 100;\n\t\t\t\t\tre = /^[0-9\\.]+(|px)$/i;\n\n\t\t\t\t\tif (re.test('' + w)) {\n\t\t\t\t\t\tw = Math.max(parseInt(w, 10), 100);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (re.test('' + h)) {\n\t\t\t\t\t\th = Math.max(parseInt(h, 10), minHeight);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Render UI\n\t\t\t\t\to = self.theme.renderUI({\n\t\t\t\t\t\ttargetNode: elm,\n\t\t\t\t\t\twidth: w,\n\t\t\t\t\t\theight: h,\n\t\t\t\t\t\tdeltaWidth: settings.delta_width,\n\t\t\t\t\t\tdeltaHeight: settings.delta_height\n\t\t\t\t\t});\n\n\t\t\t\t\t// Resize editor\n\t\t\t\t\tif (!settings.content_editable) {\n\t\t\t\t\t\th = (o.iframeHeight || h) + (typeof h == 'number' ? (o.deltaHeight || 0) : '');\n\t\t\t\t\t\tif (h < minHeight) {\n\t\t\t\t\t\t\th = minHeight;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\to = settings.theme(self, elm);\n\n\t\t\t\t\tif (o.editorContainer.nodeType) {\n\t\t\t\t\t\to.editorContainer.id = o.editorContainer.id || self.id + \"_parent\";\n\t\t\t\t\t}\n\n\t\t\t\t\tif (o.iframeContainer.nodeType) {\n\t\t\t\t\t\to.iframeContainer.id = o.iframeContainer.id || self.id + \"_iframecontainer\";\n\t\t\t\t\t}\n\n\t\t\t\t\t// Use specified iframe height or the targets offsetHeight\n\t\t\t\t\th = o.iframeHeight || elm.offsetHeight;\n\t\t\t\t}\n\n\t\t\t\tself.editorContainer = o.editorContainer;\n\t\t\t}\n\n\t\t\t// Load specified content CSS last\n\t\t\tif (settings.content_css) {\n\t\t\t\teach(explode(settings.content_css), function(u) {\n\t\t\t\t\tself.contentCSS.push(self.documentBaseURI.toAbsolute(u));\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Load specified content CSS last\n\t\t\tif (settings.content_style) {\n\t\t\t\tself.contentStyles.push(settings.content_style);\n\t\t\t}\n\n\t\t\t// Content editable mode ends here\n\t\t\tif (settings.content_editable) {\n\t\t\t\telm = n = o = null; // Fix IE leak\n\t\t\t\treturn self.initContentBody();\n\t\t\t}\n\n\t\t\tself.iframeHTML = settings.doctype + '<html><head>';\n\n\t\t\t// We only need to override paths if we have to\n\t\t\t// IE has a bug where it remove site absolute urls to relative ones if this is specified\n\t\t\tif (settings.document_base_url != self.documentBaseUrl) {\n\t\t\t\tself.iframeHTML += '<base href=\"' + self.documentBaseURI.getURI() + '\" />';\n\t\t\t}\n\n\t\t\t// IE8 doesn't support carets behind images setting ie7_compat would force IE8+ to run in IE7 compat mode.\n\t\t\tif (!Env.caretAfter && settings.ie7_compat) {\n\t\t\t\tself.iframeHTML += '<meta http-equiv=\"X-UA-Compatible\" content=\"IE=7\" />';\n\t\t\t}\n\n\t\t\tself.iframeHTML += '<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />';\n\n\t\t\t// Load the CSS by injecting them into the HTML this will reduce \"flicker\"\n\t\t\t// However we can't do that on Chrome since # will scroll to the editor for some odd reason see #2427\n\t\t\tif (!/#$/.test(document.location.href)) {\n\t\t\t\tfor (i = 0; i < self.contentCSS.length; i++) {\n\t\t\t\t\tvar cssUrl = self.contentCSS[i];\n\t\t\t\t\tself.iframeHTML += (\n\t\t\t\t\t\t'<link type=\"text/css\" ' +\n\t\t\t\t\t\t\t'rel=\"stylesheet\" ' +\n\t\t\t\t\t\t\t'href=\"' + Tools._addCacheSuffix(cssUrl) + '\" />'\n\t\t\t\t\t);\n\t\t\t\t\tself.loadedCSS[cssUrl] = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tbodyId = settings.body_id || 'tinymce';\n\t\t\tif (bodyId.indexOf('=') != -1) {\n\t\t\t\tbodyId = self.getParam('body_id', '', 'hash');\n\t\t\t\tbodyId = bodyId[self.id] || bodyId;\n\t\t\t}\n\n\t\t\tbodyClass = settings.body_class || '';\n\t\t\tif (bodyClass.indexOf('=') != -1) {\n\t\t\t\tbodyClass = self.getParam('body_class', '', 'hash');\n\t\t\t\tbodyClass = bodyClass[self.id] || '';\n\t\t\t}\n\n\t\t\tif (settings.content_security_policy) {\n\t\t\t\tself.iframeHTML += '<meta http-equiv=\"Content-Security-Policy\" content=\"' + settings.content_security_policy + '\" />';\n\t\t\t}\n\n\t\t\tself.iframeHTML += '</head><body id=\"' + bodyId +\n\t\t\t\t'\" class=\"mce-content-body ' + bodyClass +\n\t\t\t\t'\" data-id=\"' + self.id + '\"><br></body></html>';\n\n\t\t\t/*eslint no-script-url:0 */\n\t\t\tvar domainRelaxUrl = 'javascript:(function(){' +\n\t\t\t\t'document.open();document.domain=\"' + document.domain + '\";' +\n\t\t\t\t'var ed = window.parent.tinymce.get(\"' + self.id + '\");document.write(ed.iframeHTML);' +\n\t\t\t\t'document.close();ed.initContentBody(true);})()';\n\n\t\t\t// Domain relaxing is required since the user has messed around with document.domain\n\t\t\tif (document.domain != location.hostname) {\n\t\t\t\t// Edge seems to be able to handle domain relaxing\n\t\t\t\tif (Env.ie && Env.ie < 12) {\n\t\t\t\t\turl = domainRelaxUrl;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Create iframe\n\t\t\t// TODO: ACC add the appropriate description on this.\n\t\t\tvar ifr = DOM.create('iframe', {\n\t\t\t\tid: self.id + \"_ifr\",\n\t\t\t\t//src: url || 'javascript:\"\"', // Workaround for HTTPS warning in IE6/7\n\t\t\t\tframeBorder: '0',\n\t\t\t\tallowTransparency: \"true\",\n\t\t\t\ttitle: self.editorManager.translate(\n\t\t\t\t\t\t\"Rich Text Area. Press ALT-F9 for menu. \" +\n\t\t\t\t\t\t\"Press ALT-F10 for toolbar. Press ALT-0 for help\"\n\t\t\t\t),\n\t\t\t\tstyle: {\n\t\t\t\t\twidth: '100%',\n\t\t\t\t\theight: h,\n\t\t\t\t\tdisplay: 'block' // Important for Gecko to render the iframe correctly\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tifr.onload = function() {\n\t\t\t\tifr.onload = null;\n\t\t\t\tself.fire(\"load\");\n\t\t\t};\n\n\t\t\tDOM.setAttrib(ifr, \"src\", url || 'javascript:\"\"');\n\n\t\t\tself.contentAreaContainer = o.iframeContainer;\n\t\t\tself.iframeElement = ifr;\n\n\t\t\tn = DOM.add(o.iframeContainer, ifr);\n\n\t\t\t// Try accessing the document this will fail on IE when document.domain is set to the same as location.hostname\n\t\t\t// Then we have to force domain relaxing using the domainRelaxUrl approach very ugly!!\n\t\t\tif (ie) {\n\t\t\t\ttry {\n\t\t\t\t\tself.getDoc();\n\t\t\t\t} catch (e) {\n\t\t\t\t\tn.src = url = domainRelaxUrl;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (o.editorContainer) {\n\t\t\t\tDOM.get(o.editorContainer).style.display = self.orgDisplay;\n\t\t\t\tself.hidden = DOM.isHidden(o.editorContainer);\n\t\t\t}\n\n\t\t\tself.getElement().style.display = 'none';\n\t\t\tDOM.setAttrib(self.id, 'aria-hidden', true);\n\n\t\t\tif (!url) {\n\t\t\t\tself.initContentBody();\n\t\t\t}\n\n\t\t\telm = n = o = null; // Cleanup\n\t\t},\n\n\t\t/**\n\t\t * This method get called by the init method once the iframe is loaded.\n\t\t * It will fill the iframe with contents, sets up DOM and selection objects for the iframe.\n\t\t *\n\t\t * @method initContentBody\n\t\t * @private\n\t\t */\n\t\tinitContentBody: function(skipWrite) {\n\t\t\tvar self = this, settings = self.settings, targetElm = self.getElement(), doc = self.getDoc(), body, contentCssText;\n\n\t\t\t// Restore visibility on target element\n\t\t\tif (!settings.inline) {\n\t\t\t\tself.getElement().style.visibility = self.orgVisibility;\n\t\t\t}\n\n\t\t\t// Setup iframe body\n\t\t\tif (!skipWrite && !settings.content_editable) {\n\t\t\t\tdoc.open();\n\t\t\t\tdoc.write(self.iframeHTML);\n\t\t\t\tdoc.close();\n\t\t\t}\n\n\t\t\tif (settings.content_editable) {\n\t\t\t\tself.on('remove', function() {\n\t\t\t\t\tvar bodyEl = this.getBody();\n\n\t\t\t\t\tDOM.removeClass(bodyEl, 'mce-content-body');\n\t\t\t\t\tDOM.removeClass(bodyEl, 'mce-edit-focus');\n\t\t\t\t\tDOM.setAttrib(bodyEl, 'contentEditable', null);\n\t\t\t\t});\n\n\t\t\t\tDOM.addClass(targetElm, 'mce-content-body');\n\t\t\t\tself.contentDocument = doc = settings.content_document || document;\n\t\t\t\tself.contentWindow = settings.content_window || window;\n\t\t\t\tself.bodyElement = targetElm;\n\n\t\t\t\t// Prevent leak in IE\n\t\t\t\tsettings.content_document = settings.content_window = null;\n\n\t\t\t\t// TODO: Fix this\n\t\t\t\tsettings.root_name = targetElm.nodeName.toLowerCase();\n\t\t\t}\n\n\t\t\t// It will not steal focus while setting contentEditable\n\t\t\tbody = self.getBody();\n\t\t\tbody.disabled = true;\n\t\t\tself.readonly = settings.readonly;\n\n\t\t\tif (!self.readonly) {\n\t\t\t\tif (self.inline && DOM.getStyle(body, 'position', true) == 'static') {\n\t\t\t\t\tbody.style.position = 'relative';\n\t\t\t\t}\n\n\t\t\t\tbody.contentEditable = self.getParam('content_editable_state', true);\n\t\t\t}\n\n\t\t\tbody.disabled = false;\n\n\t\t\tself.editorUpload = new EditorUpload(self);\n\n\t\t\t/**\n\t\t\t * Schema instance, enables you to validate elements and its children.\n\t\t\t *\n\t\t\t * @property schema\n\t\t\t * @type tinymce.html.Schema\n\t\t\t */\n\t\t\tself.schema = new Schema(settings);\n\n\t\t\t/**\n\t\t\t * DOM instance for the editor.\n\t\t\t *\n\t\t\t * @property dom\n\t\t\t * @type tinymce.dom.DOMUtils\n\t\t\t * @example\n\t\t\t * // Adds a class to all paragraphs within the editor\n\t\t\t * tinymce.activeEditor.dom.addClass(tinymce.activeEditor.dom.select('p'), 'someclass');\n\t\t\t */\n\t\t\tself.dom = new DOMUtils(doc, {\n\t\t\t\tkeep_values: true,\n\t\t\t\turl_converter: self.convertURL,\n\t\t\t\turl_converter_scope: self,\n\t\t\t\thex_colors: settings.force_hex_style_colors,\n\t\t\t\tclass_filter: settings.class_filter,\n\t\t\t\tupdate_styles: true,\n\t\t\t\troot_element: self.inline ? self.getBody() : null,\n\t\t\t\tcollect: settings.content_editable,\n\t\t\t\tschema: self.schema,\n\t\t\t\tonSetAttrib: function(e) {\n\t\t\t\t\tself.fire('SetAttrib', e);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t/**\n\t\t\t * HTML parser will be used when contents is inserted into the editor.\n\t\t\t *\n\t\t\t * @property parser\n\t\t\t * @type tinymce.html.DomParser\n\t\t\t */\n\t\t\tself.parser = new DomParser(settings, self.schema);\n\n\t\t\t// Convert src and href into data-mce-src, data-mce-href and data-mce-style\n\t\t\tself.parser.addAttributeFilter('src,href,style,tabindex', function(nodes, name) {\n\t\t\t\tvar i = nodes.length, node, dom = self.dom, value, internalName;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tnode = nodes[i];\n\t\t\t\t\tvalue = node.attr(name);\n\t\t\t\t\tinternalName = 'data-mce-' + name;\n\n\t\t\t\t\t// Add internal attribute if we need to we don't on a refresh of the document\n\t\t\t\t\tif (!node.attributes.map[internalName]) {\n\t\t\t\t\t\t// Don't duplicate these since they won't get modified by any browser\n\t\t\t\t\t\tif (value.indexOf('data:') === 0 || value.indexOf('blob:') === 0) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (name === \"style\") {\n\t\t\t\t\t\t\tvalue = dom.serializeStyle(dom.parseStyle(value), node.name);\n\n\t\t\t\t\t\t\tif (!value.length) {\n\t\t\t\t\t\t\t\tvalue = null;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tnode.attr(internalName, value);\n\t\t\t\t\t\t\tnode.attr(name, value);\n\t\t\t\t\t\t} else if (name === \"tabindex\") {\n\t\t\t\t\t\t\tnode.attr(internalName, value);\n\t\t\t\t\t\t\tnode.attr(name, null);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tnode.attr(internalName, self.convertURL(value, name, node.name));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Keep scripts from executing\n\t\t\tself.parser.addNodeFilter('script', function(nodes) {\n\t\t\t\tvar i = nodes.length, node, type;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tnode = nodes[i];\n\t\t\t\t\ttype = node.attr('type') || 'no/type';\n\t\t\t\t\tif (type.indexOf('mce-') !== 0) {\n\t\t\t\t\t\tnode.attr('type', 'mce-' + type);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.parser.addNodeFilter('#cdata', function(nodes) {\n\t\t\t\tvar i = nodes.length, node;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tnode = nodes[i];\n\t\t\t\t\tnode.type = 8;\n\t\t\t\t\tnode.name = '#comment';\n\t\t\t\t\tnode.value = '[CDATA[' + node.value + ']]';\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.parser.addNodeFilter('p,h1,h2,h3,h4,h5,h6,div', function(nodes) {\n\t\t\t\tvar i = nodes.length, node, nonEmptyElements = self.schema.getNonEmptyElements();\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tnode = nodes[i];\n\n\t\t\t\t\tif (node.isEmpty(nonEmptyElements)) {\n\t\t\t\t\t\tnode.append(new Node('br', 1)).shortEnded = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t/**\n\t\t\t * DOM serializer for the editor. Will be used when contents is extracted from the editor.\n\t\t\t *\n\t\t\t * @property serializer\n\t\t\t * @type tinymce.dom.Serializer\n\t\t\t * @example\n\t\t\t * // Serializes the first paragraph in the editor into a string\n\t\t\t * tinymce.activeEditor.serializer.serialize(tinymce.activeEditor.dom.select('p')[0]);\n\t\t\t */\n\t\t\tself.serializer = new DomSerializer(settings, self);\n\n\t\t\t/**\n\t\t\t * Selection instance for the editor.\n\t\t\t *\n\t\t\t * @property selection\n\t\t\t * @type tinymce.dom.Selection\n\t\t\t * @example\n\t\t\t * // Sets some contents to the current selection in the editor\n\t\t\t * tinymce.activeEditor.selection.setContent('Some contents');\n\t\t\t *\n\t\t\t * // Gets the current selection\n\t\t\t * alert(tinymce.activeEditor.selection.getContent());\n\t\t\t *\n\t\t\t * // Selects the first paragraph found\n\t\t\t * tinymce.activeEditor.selection.select(tinymce.activeEditor.dom.select('p')[0]);\n\t\t\t */\n\t\t\tself.selection = new Selection(self.dom, self.getWin(), self.serializer, self);\n\n\t\t\t/**\n\t\t\t * Formatter instance.\n\t\t\t *\n\t\t\t * @property formatter\n\t\t\t * @type tinymce.Formatter\n\t\t\t */\n\t\t\tself.formatter = new Formatter(self);\n\n\t\t\t/**\n\t\t\t * Undo manager instance, responsible for handling undo levels.\n\t\t\t *\n\t\t\t * @property undoManager\n\t\t\t * @type tinymce.UndoManager\n\t\t\t * @example\n\t\t\t * // Undoes the last modification to the editor\n\t\t\t * tinymce.activeEditor.undoManager.undo();\n\t\t\t */\n\t\t\tself.undoManager = new UndoManager(self);\n\n\t\t\tself.forceBlocks = new ForceBlocks(self);\n\t\t\tself.enterKey = new EnterKey(self);\n\t\t\tself._nodeChangeDispatcher = new NodeChange(self);\n\t\t\tself._selectionOverrides = new SelectionOverrides(self);\n\n\t\t\tself.fire('PreInit');\n\n\t\t\tif (!settings.browser_spellcheck && !settings.gecko_spellcheck) {\n\t\t\t\tdoc.body.spellcheck = false; // Gecko\n\t\t\t\tDOM.setAttrib(body, \"spellcheck\", \"false\");\n\t\t\t}\n\n\t\t\tself.quirks = new Quirks(self);\n\t\t\tself.fire('PostRender');\n\n\t\t\tif (settings.directionality) {\n\t\t\t\tbody.dir = settings.directionality;\n\t\t\t}\n\n\t\t\tif (settings.nowrap) {\n\t\t\t\tbody.style.whiteSpace = \"nowrap\";\n\t\t\t}\n\n\t\t\tif (settings.protect) {\n\t\t\t\tself.on('BeforeSetContent', function(e) {\n\t\t\t\t\teach(settings.protect, function(pattern) {\n\t\t\t\t\t\te.content = e.content.replace(pattern, function(str) {\n\t\t\t\t\t\t\treturn '<!--mce:protected ' + escape(str) + '-->';\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tself.on('SetContent', function() {\n\t\t\t\tself.addVisual(self.getBody());\n\t\t\t});\n\n\t\t\t// Remove empty contents\n\t\t\tif (settings.padd_empty_editor) {\n\t\t\t\tself.on('PostProcess', function(e) {\n\t\t\t\t\te.content = e.content.replace(/^(<p[^>]*>(&nbsp;|&#160;|\\s|\\u00a0|)<\\/p>[\\r\\n]*|<br \\/>[\\r\\n]*)$/, '');\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tself.load({initial: true, format: 'html'});\n\t\t\tself.startContent = self.getContent({format: 'raw'});\n\n\t\t\t/**\n\t\t\t * Is set to true after the editor instance has been initialized\n\t\t\t *\n\t\t\t * @property initialized\n\t\t\t * @type Boolean\n\t\t\t * @example\n\t\t\t * function isEditorInitialized(editor) {\n\t\t\t *     return editor && editor.initialized;\n\t\t\t * }\n\t\t\t */\n\t\t\tself.initialized = true;\n\t\t\tself.bindPendingEventDelegates();\n\n\t\t\tself.fire('init');\n\t\t\tself.focus(true);\n\t\t\tself.nodeChanged({initial: true});\n\t\t\tself.execCallback('init_instance_callback', self);\n\n\t\t\tself.on('compositionstart compositionend', function(e) {\n\t\t\t\tself.composing = e.type === 'compositionstart';\n\t\t\t});\n\n\t\t\t// Add editor specific CSS styles\n\t\t\tif (self.contentStyles.length > 0) {\n\t\t\t\tcontentCssText = '';\n\n\t\t\t\teach(self.contentStyles, function(style) {\n\t\t\t\t\tcontentCssText += style + \"\\r\\n\";\n\t\t\t\t});\n\n\t\t\t\tself.dom.addStyle(contentCssText);\n\t\t\t}\n\n\t\t\t// Load specified content CSS last\n\t\t\teach(self.contentCSS, function(cssUrl) {\n\t\t\t\tif (!self.loadedCSS[cssUrl]) {\n\t\t\t\t\tself.dom.loadCSS(cssUrl);\n\t\t\t\t\tself.loadedCSS[cssUrl] = true;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Handle auto focus\n\t\t\tif (settings.auto_focus) {\n\t\t\t\tDelay.setEditorTimeout(self, function() {\n\t\t\t\t\tvar editor;\n\n\t\t\t\t\tif (settings.auto_focus === true) {\n\t\t\t\t\t\teditor = self;\n\t\t\t\t\t} else {\n\t\t\t\t\t\teditor = self.editorManager.get(settings.auto_focus);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!editor.destroyed) {\n\t\t\t\t\t\teditor.focus();\n\t\t\t\t\t}\n\t\t\t\t}, 100);\n\t\t\t}\n\n\t\t\t// Clean up references for IE\n\t\t\ttargetElm = doc = body = null;\n\t\t},\n\n\t\t/**\n\t\t * Focuses/activates the editor. This will set this editor as the activeEditor in the tinymce collection\n\t\t * it will also place DOM focus inside the editor.\n\t\t *\n\t\t * @method focus\n\t\t * @param {Boolean} skipFocus Skip DOM focus. Just set is as the active editor.\n\t\t */\n\t\tfocus: function(skipFocus) {\n\t\t\tvar self = this, selection = self.selection, contentEditable = self.settings.content_editable, rng;\n\t\t\tvar controlElm, doc = self.getDoc(), body = self.getBody(), contentEditableHost;\n\n\t\t\tfunction getContentEditableHost(node) {\n\t\t\t\treturn self.dom.getParent(node, function(node) {\n\t\t\t\t\treturn self.dom.getContentEditable(node) === \"true\";\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (!skipFocus) {\n\t\t\t\t// Get selected control element\n\t\t\t\trng = selection.getRng();\n\t\t\t\tif (rng.item) {\n\t\t\t\t\tcontrolElm = rng.item(0);\n\t\t\t\t}\n\n\t\t\t\tself.quirks.refreshContentEditable();\n\n\t\t\t\t// Move focus to contentEditable=true child if needed\n\t\t\t\tcontentEditableHost = getContentEditableHost(selection.getNode());\n\t\t\t\tif (self.$.contains(body, contentEditableHost)) {\n\t\t\t\t\tcontentEditableHost.focus();\n\t\t\t\t\tselection.normalize();\n\t\t\t\t\tself.editorManager.setActive(self);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Focus the window iframe\n\t\t\t\tif (!contentEditable) {\n\t\t\t\t\t// WebKit needs this call to fire focusin event properly see #5948\n\t\t\t\t\t// But Opera pre Blink engine will produce an empty selection so skip Opera\n\t\t\t\t\tif (!Env.opera) {\n\t\t\t\t\t\tself.getBody().focus();\n\t\t\t\t\t}\n\n\t\t\t\t\tself.getWin().focus();\n\t\t\t\t}\n\n\t\t\t\t// Focus the body as well since it's contentEditable\n\t\t\t\tif (isGecko || contentEditable) {\n\t\t\t\t\t// Check for setActive since it doesn't scroll to the element\n\t\t\t\t\tif (body.setActive) {\n\t\t\t\t\t\t// IE 11 sometimes throws \"Invalid function\" then fallback to focus\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tbody.setActive();\n\t\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t\tbody.focus();\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbody.focus();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (contentEditable) {\n\t\t\t\t\t\tselection.normalize();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Restore selected control element\n\t\t\t\t// This is needed when for example an image is selected within a\n\t\t\t\t// layer a call to focus will then remove the control selection\n\t\t\t\tif (controlElm && controlElm.ownerDocument == doc) {\n\t\t\t\t\trng = doc.body.createControlRange();\n\t\t\t\t\trng.addElement(controlElm);\n\t\t\t\t\trng.select();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tself.editorManager.setActive(self);\n\t\t},\n\n\t\t/**\n\t\t * Executes a legacy callback. This method is useful to call old 2.x option callbacks.\n\t\t * There new event model is a better way to add callback so this method might be removed in the future.\n\t\t *\n\t\t * @method execCallback\n\t\t * @param {String} name Name of the callback to execute.\n\t\t * @return {Object} Return value passed from callback function.\n\t\t */\n\t\texecCallback: function(name) {\n\t\t\tvar self = this, callback = self.settings[name], scope;\n\n\t\t\tif (!callback) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Look through lookup\n\t\t\tif (self.callbackLookup && (scope = self.callbackLookup[name])) {\n\t\t\t\tcallback = scope.func;\n\t\t\t\tscope = scope.scope;\n\t\t\t}\n\n\t\t\tif (typeof callback === 'string') {\n\t\t\t\tscope = callback.replace(/\\.\\w+$/, '');\n\t\t\t\tscope = scope ? resolve(scope) : 0;\n\t\t\t\tcallback = resolve(callback);\n\t\t\t\tself.callbackLookup = self.callbackLookup || {};\n\t\t\t\tself.callbackLookup[name] = {func: callback, scope: scope};\n\t\t\t}\n\n\t\t\treturn callback.apply(scope || self, Array.prototype.slice.call(arguments, 1));\n\t\t},\n\n\t\t/**\n\t\t * Translates the specified string by replacing variables with language pack items it will also check if there is\n\t\t * a key matching the input.\n\t\t *\n\t\t * @method translate\n\t\t * @param {String} text String to translate by the language pack data.\n\t\t * @return {String} Translated string.\n\t\t */\n\t\ttranslate: function(text) {\n\t\t\tvar lang = this.settings.language || 'en', i18n = this.editorManager.i18n;\n\n\t\t\tif (!text) {\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\ttext = i18n.data[lang + '.' + text] || text.replace(/\\{\\#([^\\}]+)\\}/g, function(a, b) {\n\t\t\t\treturn i18n.data[lang + '.' + b] || '{#' + b + '}';\n\t\t\t});\n\n\t\t\treturn this.editorManager.translate(text);\n\t\t},\n\n\t\t/**\n\t\t * Returns a language pack item by name/key.\n\t\t *\n\t\t * @method getLang\n\t\t * @param {String} name Name/key to get from the language pack.\n\t\t * @param {String} defaultVal Optional default value to retrieve.\n\t\t */\n\t\tgetLang: function(name, defaultVal) {\n\t\t\treturn (\n\t\t\t\tthis.editorManager.i18n.data[(this.settings.language || 'en') + '.' + name] ||\n\t\t\t\t(defaultVal !== undefined ? defaultVal : '{#' + name + '}')\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Returns a configuration parameter by name.\n\t\t *\n\t\t * @method getParam\n\t\t * @param {String} name Configruation parameter to retrieve.\n\t\t * @param {String} defaultVal Optional default value to return.\n\t\t * @param {String} type Optional type parameter.\n\t\t * @return {String} Configuration parameter value or default value.\n\t\t * @example\n\t\t * // Returns a specific config value from the currently active editor\n\t\t * var someval = tinymce.activeEditor.getParam('myvalue');\n\t\t *\n\t\t * // Returns a specific config value from a specific editor instance by id\n\t\t * var someval2 = tinymce.get('my_editor').getParam('myvalue');\n\t\t */\n\t\tgetParam: function(name, defaultVal, type) {\n\t\t\tvar value = name in this.settings ? this.settings[name] : defaultVal, output;\n\n\t\t\tif (type === 'hash') {\n\t\t\t\toutput = {};\n\n\t\t\t\tif (typeof value === 'string') {\n\t\t\t\t\teach(value.indexOf('=') > 0 ? value.split(/[;,](?![^=;,]*(?:[;,]|$))/) : value.split(','), function(value) {\n\t\t\t\t\t\tvalue = value.split('=');\n\n\t\t\t\t\t\tif (value.length > 1) {\n\t\t\t\t\t\t\toutput[trim(value[0])] = trim(value[1]);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\toutput[trim(value[0])] = trim(value);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\toutput = value;\n\t\t\t\t}\n\n\t\t\t\treturn output;\n\t\t\t}\n\n\t\t\treturn value;\n\t\t},\n\n\t\t/**\n\t\t * Dispatches out a onNodeChange event to all observers. This method should be called when you\n\t\t * need to update the UI states or element path etc.\n\t\t *\n\t\t * @method nodeChanged\n\t\t * @param {Object} args Optional args to pass to NodeChange event handlers.\n\t\t */\n\t\tnodeChanged: function(args) {\n\t\t\tthis._nodeChangeDispatcher.nodeChanged(args);\n\t\t},\n\n\t\t/**\n\t\t * Adds a button that later gets created by the theme in the editors toolbars.\n\t\t *\n\t\t * @method addButton\n\t\t * @param {String} name Button name to add.\n\t\t * @param {Object} settings Settings object with title, cmd etc.\n\t\t * @example\n\t\t * // Adds a custom button to the editor that inserts contents when clicked\n\t\t * tinymce.init({\n\t\t *    ...\n\t\t *\n\t\t *    toolbar: 'example'\n\t\t *\n\t\t *    setup: function(ed) {\n\t\t *       ed.addButton('example', {\n\t\t *          title: 'My title',\n\t\t *          image: '../js/tinymce/plugins/example/img/example.gif',\n\t\t *          onclick: function() {\n\t\t *             ed.insertContent('Hello world!!');\n\t\t *          }\n\t\t *       });\n\t\t *    }\n\t\t * });\n\t\t */\n\t\taddButton: function(name, settings) {\n\t\t\tvar self = this;\n\n\t\t\tif (settings.cmd) {\n\t\t\t\tsettings.onclick = function() {\n\t\t\t\t\tself.execCommand(settings.cmd);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (!settings.text && !settings.icon) {\n\t\t\t\tsettings.icon = name;\n\t\t\t}\n\n\t\t\tself.buttons = self.buttons || {};\n\t\t\tsettings.tooltip = settings.tooltip || settings.title;\n\t\t\tself.buttons[name] = settings;\n\t\t},\n\n\t\t/**\n\t\t * Adds a sidebar for the editor instance.\n\t\t *\n\t\t * @method addSidebar\n\t\t * @param {String} name Sidebar name to add.\n\t\t * @param {Object} settings Settings object with icon, onshow etc.\n\t\t * @example\n\t\t * // Adds a custom sidebar that when clicked logs the panel element\n\t\t * tinymce.init({\n\t\t *    ...\n\t\t *    setup: function(ed) {\n\t\t *       ed.addSidebar('example', {\n\t\t *          tooltip: 'My sidebar',\n\t\t *          icon: 'my-side-bar',\n\t\t *          onshow: function(api) {\n\t\t *             console.log(api.element());\n\t\t *          }\n\t\t *       });\n\t\t *    }\n\t\t * });\n\t\t */\n\t\taddSidebar: function (name, settings) {\n\t\t\treturn Sidebar.add(this, name, settings);\n\t\t},\n\n\t\t/**\n\t\t * Adds a menu item to be used in the menus of the theme. There might be multiple instances\n\t\t * of this menu item for example it might be used in the main menus of the theme but also in\n\t\t * the context menu so make sure that it's self contained and supports multiple instances.\n\t\t *\n\t\t * @method addMenuItem\n\t\t * @param {String} name Menu item name to add.\n\t\t * @param {Object} settings Settings object with title, cmd etc.\n\t\t * @example\n\t\t * // Adds a custom menu item to the editor that inserts contents when clicked\n\t\t * // The context option allows you to add the menu item to an existing default menu\n\t\t * tinymce.init({\n\t\t *    ...\n\t\t *\n\t\t *    setup: function(ed) {\n\t\t *       ed.addMenuItem('example', {\n\t\t *          text: 'My menu item',\n\t\t *          context: 'tools',\n\t\t *          onclick: function() {\n\t\t *             ed.insertContent('Hello world!!');\n\t\t *          }\n\t\t *       });\n\t\t *    }\n\t\t * });\n\t\t */\n\t\taddMenuItem: function(name, settings) {\n\t\t\tvar self = this;\n\n\t\t\tif (settings.cmd) {\n\t\t\t\tsettings.onclick = function() {\n\t\t\t\t\tself.execCommand(settings.cmd);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tself.menuItems = self.menuItems || {};\n\t\t\tself.menuItems[name] = settings;\n\t\t},\n\n\t\t/**\n\t\t * Adds a contextual toolbar to be rendered when the selector matches.\n\t\t *\n\t\t * @method addContextToolbar\n\t\t * @param {function/string} predicate Predicate that needs to return true if provided strings get converted into CSS predicates.\n\t\t * @param {String/Array} items String or array with items to add to the context toolbar.\n\t\t */\n\t\taddContextToolbar: function(predicate, items) {\n\t\t\tvar self = this, selector;\n\n\t\t\tself.contextToolbars = self.contextToolbars || [];\n\n\t\t\t// Convert selector to predicate\n\t\t\tif (typeof predicate == \"string\") {\n\t\t\t\tselector = predicate;\n\t\t\t\tpredicate = function(elm) {\n\t\t\t\t\treturn self.dom.is(elm, selector);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tself.contextToolbars.push({\n\t\t\t\tid: Uuid.uuid('mcet'),\n\t\t\t\tpredicate: predicate,\n\t\t\t\titems: items\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Adds a custom command to the editor, you can also override existing commands with this method.\n\t\t * The command that you add can be executed with execCommand.\n\t\t *\n\t\t * @method addCommand\n\t\t * @param {String} name Command name to add/override.\n\t\t * @param {addCommandCallback} callback Function to execute when the command occurs.\n\t\t * @param {Object} scope Optional scope to execute the function in.\n\t\t * @example\n\t\t * // Adds a custom command that later can be executed using execCommand\n\t\t * tinymce.init({\n\t\t *    ...\n\t\t *\n\t\t *    setup: function(ed) {\n\t\t *       // Register example command\n\t\t *       ed.addCommand('mycommand', function(ui, v) {\n\t\t *          ed.windowManager.alert('Hello world!! Selection: ' + ed.selection.getContent({format: 'text'}));\n\t\t *       });\n\t\t *    }\n\t\t * });\n\t\t */\n\t\taddCommand: function(name, callback, scope) {\n\t\t\t/**\n\t\t\t * Callback function that gets called when a command is executed.\n\t\t\t *\n\t\t\t * @callback addCommandCallback\n\t\t\t * @param {Boolean} ui Display UI state true/false.\n\t\t\t * @param {Object} value Optional value for command.\n\t\t\t * @return {Boolean} True/false state if the command was handled or not.\n\t\t\t */\n\t\t\tthis.editorCommands.addCommand(name, callback, scope);\n\t\t},\n\n\t\t/**\n\t\t * Adds a custom query state command to the editor, you can also override existing commands with this method.\n\t\t * The command that you add can be executed with queryCommandState function.\n\t\t *\n\t\t * @method addQueryStateHandler\n\t\t * @param {String} name Command name to add/override.\n\t\t * @param {addQueryStateHandlerCallback} callback Function to execute when the command state retrieval occurs.\n\t\t * @param {Object} scope Optional scope to execute the function in.\n\t\t */\n\t\taddQueryStateHandler: function(name, callback, scope) {\n\t\t\t/**\n\t\t\t * Callback function that gets called when a queryCommandState is executed.\n\t\t\t *\n\t\t\t * @callback addQueryStateHandlerCallback\n\t\t\t * @return {Boolean} True/false state if the command is enabled or not like is it bold.\n\t\t\t */\n\t\t\tthis.editorCommands.addQueryStateHandler(name, callback, scope);\n\t\t},\n\n\t\t/**\n\t\t * Adds a custom query value command to the editor, you can also override existing commands with this method.\n\t\t * The command that you add can be executed with queryCommandValue function.\n\t\t *\n\t\t * @method addQueryValueHandler\n\t\t * @param {String} name Command name to add/override.\n\t\t * @param {addQueryValueHandlerCallback} callback Function to execute when the command value retrieval occurs.\n\t\t * @param {Object} scope Optional scope to execute the function in.\n\t\t */\n\t\taddQueryValueHandler: function(name, callback, scope) {\n\t\t\t/**\n\t\t\t * Callback function that gets called when a queryCommandValue is executed.\n\t\t\t *\n\t\t\t * @callback addQueryValueHandlerCallback\n\t\t\t * @return {Object} Value of the command or undefined.\n\t\t\t */\n\t\t\tthis.editorCommands.addQueryValueHandler(name, callback, scope);\n\t\t},\n\n\t\t/**\n\t\t * Adds a keyboard shortcut for some command or function.\n\t\t *\n\t\t * @method addShortcut\n\t\t * @param {String} pattern Shortcut pattern. Like for example: ctrl+alt+o.\n\t\t * @param {String} desc Text description for the command.\n\t\t * @param {String/Function} cmdFunc Command name string or function to execute when the key is pressed.\n\t\t * @param {Object} sc Optional scope to execute the function in.\n\t\t * @return {Boolean} true/false state if the shortcut was added or not.\n\t\t */\n\t\taddShortcut: function(pattern, desc, cmdFunc, scope) {\n\t\t\tthis.shortcuts.add(pattern, desc, cmdFunc, scope);\n\t\t},\n\n\t\t/**\n\t\t * Executes a command on the current instance. These commands can be TinyMCE internal commands prefixed with \"mce\" or\n\t\t * they can be build in browser commands such as \"Bold\". A compleate list of browser commands is available on MSDN or Mozilla.org.\n\t\t * This function will dispatch the execCommand function on each plugin, theme or the execcommand_callback option if none of these\n\t\t * return true it will handle the command as a internal browser command.\n\t\t *\n\t\t * @method execCommand\n\t\t * @param {String} cmd Command name to execute, for example mceLink or Bold.\n\t\t * @param {Boolean} ui True/false state if a UI (dialog) should be presented or not.\n\t\t * @param {mixed} value Optional command value, this can be anything.\n\t\t * @param {Object} args Optional arguments object.\n\t\t */\n\t\texecCommand: function(cmd, ui, value, args) {\n\t\t\treturn this.editorCommands.execCommand(cmd, ui, value, args);\n\t\t},\n\n\t\t/**\n\t\t * Returns a command specific state, for example if bold is enabled or not.\n\t\t *\n\t\t * @method queryCommandState\n\t\t * @param {string} cmd Command to query state from.\n\t\t * @return {Boolean} Command specific state, for example if bold is enabled or not.\n\t\t */\n\t\tqueryCommandState: function(cmd) {\n\t\t\treturn this.editorCommands.queryCommandState(cmd);\n\t\t},\n\n\t\t/**\n\t\t * Returns a command specific value, for example the current font size.\n\t\t *\n\t\t * @method queryCommandValue\n\t\t * @param {string} cmd Command to query value from.\n\t\t * @return {Object} Command specific value, for example the current font size.\n\t\t */\n\t\tqueryCommandValue: function(cmd) {\n\t\t\treturn this.editorCommands.queryCommandValue(cmd);\n\t\t},\n\n\t\t/**\n\t\t * Returns true/false if the command is supported or not.\n\t\t *\n\t\t * @method queryCommandSupported\n\t\t * @param {String} cmd Command that we check support for.\n\t\t * @return {Boolean} true/false if the command is supported or not.\n\t\t */\n\t\tqueryCommandSupported: function(cmd) {\n\t\t\treturn this.editorCommands.queryCommandSupported(cmd);\n\t\t},\n\n\t\t/**\n\t\t * Shows the editor and hides any textarea/div that the editor is supposed to replace.\n\t\t *\n\t\t * @method show\n\t\t */\n\t\tshow: function() {\n\t\t\tvar self = this;\n\n\t\t\tif (self.hidden) {\n\t\t\t\tself.hidden = false;\n\n\t\t\t\tif (self.inline) {\n\t\t\t\t\tself.getBody().contentEditable = true;\n\t\t\t\t} else {\n\t\t\t\t\tDOM.show(self.getContainer());\n\t\t\t\t\tDOM.hide(self.id);\n\t\t\t\t}\n\n\t\t\t\tself.load();\n\t\t\t\tself.fire('show');\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Hides the editor and shows any textarea/div that the editor is supposed to replace.\n\t\t *\n\t\t * @method hide\n\t\t */\n\t\thide: function() {\n\t\t\tvar self = this, doc = self.getDoc();\n\n\t\t\tif (!self.hidden) {\n\t\t\t\t// Fixed bug where IE has a blinking cursor left from the editor\n\t\t\t\tif (ie && doc && !self.inline) {\n\t\t\t\t\tdoc.execCommand('SelectAll');\n\t\t\t\t}\n\n\t\t\t\t// We must save before we hide so Safari doesn't crash\n\t\t\t\tself.save();\n\n\t\t\t\tif (self.inline) {\n\t\t\t\t\tself.getBody().contentEditable = false;\n\n\t\t\t\t\t// Make sure the editor gets blurred\n\t\t\t\t\tif (self == self.editorManager.focusedEditor) {\n\t\t\t\t\t\tself.editorManager.focusedEditor = null;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tDOM.hide(self.getContainer());\n\t\t\t\t\tDOM.setStyle(self.id, 'display', self.orgDisplay);\n\t\t\t\t}\n\n\t\t\t\tself.hidden = true;\n\t\t\t\tself.fire('hide');\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Returns true/false if the editor is hidden or not.\n\t\t *\n\t\t * @method isHidden\n\t\t * @return {Boolean} True/false if the editor is hidden or not.\n\t\t */\n\t\tisHidden: function() {\n\t\t\treturn !!this.hidden;\n\t\t},\n\n\t\t/**\n\t\t * Sets the progress state, this will display a throbber/progess for the editor.\n\t\t * This is ideal for asynchronous operations like an AJAX save call.\n\t\t *\n\t\t * @method setProgressState\n\t\t * @param {Boolean} state Boolean state if the progress should be shown or hidden.\n\t\t * @param {Number} time Optional time to wait before the progress gets shown.\n\t\t * @return {Boolean} Same as the input state.\n\t\t * @example\n\t\t * // Show progress for the active editor\n\t\t * tinymce.activeEditor.setProgressState(true);\n\t\t *\n\t\t * // Hide progress for the active editor\n\t\t * tinymce.activeEditor.setProgressState(false);\n\t\t *\n\t\t * // Show progress after 3 seconds\n\t\t * tinymce.activeEditor.setProgressState(true, 3000);\n\t\t */\n\t\tsetProgressState: function(state, time) {\n\t\t\tthis.fire('ProgressState', {state: state, time: time});\n\t\t},\n\n\t\t/**\n\t\t * Loads contents from the textarea or div element that got converted into an editor instance.\n\t\t * This method will move the contents from that textarea or div into the editor by using setContent\n\t\t * so all events etc that method has will get dispatched as well.\n\t\t *\n\t\t * @method load\n\t\t * @param {Object} args Optional content object, this gets passed around through the whole load process.\n\t\t * @return {String} HTML string that got set into the editor.\n\t\t */\n\t\tload: function(args) {\n\t\t\tvar self = this, elm = self.getElement(), html;\n\n\t\t\tif (elm) {\n\t\t\t\targs = args || {};\n\t\t\t\targs.load = true;\n\n\t\t\t\thtml = self.setContent(elm.value !== undefined ? elm.value : elm.innerHTML, args);\n\t\t\t\targs.element = elm;\n\n\t\t\t\tif (!args.no_events) {\n\t\t\t\t\tself.fire('LoadContent', args);\n\t\t\t\t}\n\n\t\t\t\targs.element = elm = null;\n\n\t\t\t\treturn html;\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Saves the contents from a editor out to the textarea or div element that got converted into an editor instance.\n\t\t * This method will move the HTML contents from the editor into that textarea or div by getContent\n\t\t * so all events etc that method has will get dispatched as well.\n\t\t *\n\t\t * @method save\n\t\t * @param {Object} args Optional content object, this gets passed around through the whole save process.\n\t\t * @return {String} HTML string that got set into the textarea/div.\n\t\t */\n\t\tsave: function(args) {\n\t\t\tvar self = this, elm = self.getElement(), html, form;\n\n\t\t\tif (!elm || !self.initialized) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\targs = args || {};\n\t\t\targs.save = true;\n\n\t\t\targs.element = elm;\n\t\t\thtml = args.content = self.getContent(args);\n\n\t\t\tif (!args.no_events) {\n\t\t\t\tself.fire('SaveContent', args);\n\t\t\t}\n\n\t\t\t// Always run this internal event\n\t\t\tif (args.format == 'raw') {\n\t\t\t\tself.fire('RawSaveContent', args);\n\t\t\t}\n\n\t\t\thtml = args.content;\n\n\t\t\tif (!/TEXTAREA|INPUT/i.test(elm.nodeName)) {\n\t\t\t\t// Update DIV element when not in inline mode\n\t\t\t\tif (!self.inline) {\n\t\t\t\t\telm.innerHTML = html;\n\t\t\t\t}\n\n\t\t\t\t// Update hidden form element\n\t\t\t\tif ((form = DOM.getParent(self.id, 'form'))) {\n\t\t\t\t\teach(form.elements, function(elm) {\n\t\t\t\t\t\tif (elm.name == self.id) {\n\t\t\t\t\t\t\telm.value = html;\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\telm.value = html;\n\t\t\t}\n\n\t\t\targs.element = elm = null;\n\n\t\t\tif (args.set_dirty !== false) {\n\t\t\t\tself.setDirty(false);\n\t\t\t}\n\n\t\t\treturn html;\n\t\t},\n\n\t\t/**\n\t\t * Sets the specified content to the editor instance, this will cleanup the content before it gets set using\n\t\t * the different cleanup rules options.\n\t\t *\n\t\t * @method setContent\n\t\t * @param {String} content Content to set to editor, normally HTML contents but can be other formats as well.\n\t\t * @param {Object} args Optional content object, this gets passed around through the whole set process.\n\t\t * @return {String} HTML string that got set into the editor.\n\t\t * @example\n\t\t * // Sets the HTML contents of the activeEditor editor\n\t\t * tinymce.activeEditor.setContent('<span>some</span> html');\n\t\t *\n\t\t * // Sets the raw contents of the activeEditor editor\n\t\t * tinymce.activeEditor.setContent('<span>some</span> html', {format: 'raw'});\n\t\t *\n\t\t * // Sets the content of a specific editor (my_editor in this example)\n\t\t * tinymce.get('my_editor').setContent(data);\n\t\t *\n\t\t * // Sets the bbcode contents of the activeEditor editor if the bbcode plugin was added\n\t\t * tinymce.activeEditor.setContent('[b]some[/b] html', {format: 'bbcode'});\n\t\t */\n\t\tsetContent: function(content, args) {\n\t\t\tvar self = this, body = self.getBody(), forcedRootBlockName, padd;\n\n\t\t\t// Setup args object\n\t\t\targs = args || {};\n\t\t\targs.format = args.format || 'html';\n\t\t\targs.set = true;\n\t\t\targs.content = content;\n\n\t\t\t// Do preprocessing\n\t\t\tif (!args.no_events) {\n\t\t\t\tself.fire('BeforeSetContent', args);\n\t\t\t}\n\n\t\t\tcontent = args.content;\n\n\t\t\t// Padd empty content in Gecko and Safari. Commands will otherwise fail on the content\n\t\t\t// It will also be impossible to place the caret in the editor unless there is a BR element present\n\t\t\tif (content.length === 0 || /^\\s+$/.test(content)) {\n\t\t\t\tpadd = ie && ie < 11 ? '' : '<br data-mce-bogus=\"1\">';\n\n\t\t\t\t// Todo: There is a lot more root elements that need special padding\n\t\t\t\t// so separate this and add all of them at some point.\n\t\t\t\tif (body.nodeName == 'TABLE') {\n\t\t\t\t\tcontent = '<tr><td>' + padd + '</td></tr>';\n\t\t\t\t} else if (/^(UL|OL)$/.test(body.nodeName)) {\n\t\t\t\t\tcontent = '<li>' + padd + '</li>';\n\t\t\t\t}\n\n\t\t\t\tforcedRootBlockName = self.settings.forced_root_block;\n\n\t\t\t\t// Check if forcedRootBlock is configured and that the block is a valid child of the body\n\t\t\t\tif (forcedRootBlockName && self.schema.isValidChild(body.nodeName.toLowerCase(), forcedRootBlockName.toLowerCase())) {\n\t\t\t\t\t// Padd with bogus BR elements on modern browsers and IE 7 and 8 since they don't render empty P tags properly\n\t\t\t\t\tcontent = padd;\n\t\t\t\t\tcontent = self.dom.createHTML(forcedRootBlockName, self.settings.forced_root_block_attrs, content);\n\t\t\t\t} else if (!ie && !content) {\n\t\t\t\t\t// We need to add a BR when forced_root_block is disabled on non IE browsers to place the caret\n\t\t\t\t\tcontent = '<br data-mce-bogus=\"1\">';\n\t\t\t\t}\n\n\t\t\t\tself.dom.setHTML(body, content);\n\n\t\t\t\tself.fire('SetContent', args);\n\t\t\t} else {\n\t\t\t\t// Parse and serialize the html\n\t\t\t\tif (args.format !== 'raw') {\n\t\t\t\t\tcontent = new Serializer({\n\t\t\t\t\t\tvalidate: self.validate\n\t\t\t\t\t}, self.schema).serialize(\n\t\t\t\t\t\tself.parser.parse(content, {isRootContent: true})\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\t// Set the new cleaned contents to the editor\n\t\t\t\targs.content = trim(content);\n\t\t\t\tself.dom.setHTML(body, args.content);\n\n\t\t\t\t// Do post processing\n\t\t\t\tif (!args.no_events) {\n\t\t\t\t\tself.fire('SetContent', args);\n\t\t\t\t}\n\n\t\t\t\t// Don't normalize selection if the focused element isn't the body in\n\t\t\t\t// content editable mode since it will steal focus otherwise\n\t\t\t\t/*if (!self.settings.content_editable || document.activeElement === self.getBody()) {\n\t\t\t\t\tself.selection.normalize();\n\t\t\t\t}*/\n\t\t\t}\n\n\t\t\treturn args.content;\n\t\t},\n\n\t\t/**\n\t\t * Gets the content from the editor instance, this will cleanup the content before it gets returned using\n\t\t * the different cleanup rules options.\n\t\t *\n\t\t * @method getContent\n\t\t * @param {Object} args Optional content object, this gets passed around through the whole get process.\n\t\t * @return {String} Cleaned content string, normally HTML contents.\n\t\t * @example\n\t\t * // Get the HTML contents of the currently active editor\n\t\t * console.debug(tinymce.activeEditor.getContent());\n\t\t *\n\t\t * // Get the raw contents of the currently active editor\n\t\t * tinymce.activeEditor.getContent({format: 'raw'});\n\t\t *\n\t\t * // Get content of a specific editor:\n\t\t * tinymce.get('content id').getContent()\n\t\t */\n\t\tgetContent: function(args) {\n\t\t\tvar self = this, content, body = self.getBody();\n\n\t\t\t// Setup args object\n\t\t\targs = args || {};\n\t\t\targs.format = args.format || 'html';\n\t\t\targs.get = true;\n\t\t\targs.getInner = true;\n\n\t\t\t// Do preprocessing\n\t\t\tif (!args.no_events) {\n\t\t\t\tself.fire('BeforeGetContent', args);\n\t\t\t}\n\n\t\t\t// Get raw contents or by default the cleaned contents\n\t\t\tif (args.format == 'raw') {\n\t\t\t\tcontent = self.serializer.getTrimmedContent();\n\t\t\t} else if (args.format == 'text') {\n\t\t\t\tcontent = body.innerText || body.textContent;\n\t\t\t} else {\n\t\t\t\tcontent = self.serializer.serialize(body, args);\n\t\t\t}\n\n\t\t\t// Trim whitespace in beginning/end of HTML\n\t\t\tif (args.format != 'text') {\n\t\t\t\targs.content = trim(content);\n\t\t\t} else {\n\t\t\t\targs.content = content;\n\t\t\t}\n\n\t\t\t// Do post processing\n\t\t\tif (!args.no_events) {\n\t\t\t\tself.fire('GetContent', args);\n\t\t\t}\n\n\t\t\treturn args.content;\n\t\t},\n\n\t\t/**\n\t\t * Inserts content at caret position.\n\t\t *\n\t\t * @method insertContent\n\t\t * @param {String} content Content to insert.\n\t\t * @param {Object} args Optional args to pass to insert call.\n\t\t */\n\t\tinsertContent: function(content, args) {\n\t\t\tif (args) {\n\t\t\t\tcontent = extend({content: content}, args);\n\t\t\t}\n\n\t\t\tthis.execCommand('mceInsertContent', false, content);\n\t\t},\n\n\t\t/**\n\t\t * Returns true/false if the editor is dirty or not. It will get dirty if the user has made modifications to the contents.\n\t\t *\n\t\t * The dirty state is automatically set to true if you do modifications to the content in other\n\t\t * words when new undo levels is created or if you undo/redo to update the contents of the editor. It will also be set\n\t\t * to false if you call editor.save().\n\t\t *\n\t\t * @method isDirty\n\t\t * @return {Boolean} True/false if the editor is dirty or not. It will get dirty if the user has made modifications to the contents.\n\t\t * @example\n\t\t * if (tinymce.activeEditor.isDirty())\n\t\t *     alert(\"You must save your contents.\");\n\t\t */\n\t\tisDirty: function() {\n\t\t\treturn !this.isNotDirty;\n\t\t},\n\n\t\t/**\n\t\t * Explicitly sets the dirty state. This will fire the dirty event if the editor dirty state is changed from false to true\n\t\t * by invoking this method.\n\t\t *\n\t\t * @method setDirty\n\t\t * @param {Boolean} state True/false if the editor is considered dirty.\n\t\t * @example\n\t\t * function ajaxSave() {\n\t\t *     var editor = tinymce.get('elm1');\n\t\t *\n\t\t *     // Save contents using some XHR call\n\t\t *     alert(editor.getContent());\n\t\t *\n\t\t *     editor.setDirty(false); // Force not dirty state\n\t\t * }\n\t\t */\n\t\tsetDirty: function(state) {\n\t\t\tvar oldState = !this.isNotDirty;\n\n\t\t\tthis.isNotDirty = !state;\n\n\t\t\tif (state && state != oldState) {\n\t\t\t\tthis.fire('dirty');\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Sets the editor mode. Mode can be for example \"design\", \"code\" or \"readonly\".\n\t\t *\n\t\t * @method setMode\n\t\t * @param {String} mode Mode to set the editor in.\n\t\t */\n\t\tsetMode: function(mode) {\n\t\t\tMode.setMode(this, mode);\n\t\t},\n\n\t\t/**\n\t\t * Returns the editors container element. The container element wrappes in\n\t\t * all the elements added to the page for the editor. Such as UI, iframe etc.\n\t\t *\n\t\t * @method getContainer\n\t\t * @return {Element} HTML DOM element for the editor container.\n\t\t */\n\t\tgetContainer: function() {\n\t\t\tvar self = this;\n\n\t\t\tif (!self.container) {\n\t\t\t\tself.container = DOM.get(self.editorContainer || self.id + '_parent');\n\t\t\t}\n\n\t\t\treturn self.container;\n\t\t},\n\n\t\t/**\n\t\t * Returns the editors content area container element. The this element is the one who\n\t\t * holds the iframe or the editable element.\n\t\t *\n\t\t * @method getContentAreaContainer\n\t\t * @return {Element} HTML DOM element for the editor area container.\n\t\t */\n\t\tgetContentAreaContainer: function() {\n\t\t\treturn this.contentAreaContainer;\n\t\t},\n\n\t\t/**\n\t\t * Returns the target element/textarea that got replaced with a TinyMCE editor instance.\n\t\t *\n\t\t * @method getElement\n\t\t * @return {Element} HTML DOM element for the replaced element.\n\t\t */\n\t\tgetElement: function() {\n\t\t\tif (!this.targetElm) {\n\t\t\t\tthis.targetElm = DOM.get(this.id);\n\t\t\t}\n\n\t\t\treturn this.targetElm;\n\t\t},\n\n\t\t/**\n\t\t * Returns the iframes window object.\n\t\t *\n\t\t * @method getWin\n\t\t * @return {Window} Iframe DOM window object.\n\t\t */\n\t\tgetWin: function() {\n\t\t\tvar self = this, elm;\n\n\t\t\tif (!self.contentWindow) {\n\t\t\t\telm = self.iframeElement;\n\n\t\t\t\tif (elm) {\n\t\t\t\t\tself.contentWindow = elm.contentWindow;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn self.contentWindow;\n\t\t},\n\n\t\t/**\n\t\t * Returns the iframes document object.\n\t\t *\n\t\t * @method getDoc\n\t\t * @return {Document} Iframe DOM document object.\n\t\t */\n\t\tgetDoc: function() {\n\t\t\tvar self = this, win;\n\n\t\t\tif (!self.contentDocument) {\n\t\t\t\twin = self.getWin();\n\n\t\t\t\tif (win) {\n\t\t\t\t\tself.contentDocument = win.document;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn self.contentDocument;\n\t\t},\n\n\t\t/**\n\t\t * Returns the root element of the editable area.\n\t\t * For a non-inline iframe-based editor, returns the iframe's body element.\n\t\t *\n\t\t * @method getBody\n\t\t * @return {Element} The root element of the editable area.\n\t\t */\n\t\tgetBody: function() {\n\t\t\tvar doc = this.getDoc();\n\t\t\treturn this.bodyElement || (doc ? doc.body : null);\n\t\t},\n\n\t\t/**\n\t\t * URL converter function this gets executed each time a user adds an img, a or\n\t\t * any other element that has a URL in it. This will be called both by the DOM and HTML\n\t\t * manipulation functions.\n\t\t *\n\t\t * @method convertURL\n\t\t * @param {string} url URL to convert.\n\t\t * @param {string} name Attribute name src, href etc.\n\t\t * @param {string/HTMLElement} elm Tag name or HTML DOM element depending on HTML or DOM insert.\n\t\t * @return {string} Converted URL string.\n\t\t */\n\t\tconvertURL: function(url, name, elm) {\n\t\t\tvar self = this, settings = self.settings;\n\n\t\t\t// Use callback instead\n\t\t\tif (settings.urlconverter_callback) {\n\t\t\t\treturn self.execCallback('urlconverter_callback', url, elm, true, name);\n\t\t\t}\n\n\t\t\t// Don't convert link href since thats the CSS files that gets loaded into the editor also skip local file URLs\n\t\t\tif (!settings.convert_urls || (elm && elm.nodeName == 'LINK') || url.indexOf('file:') === 0 || url.length === 0) {\n\t\t\t\treturn url;\n\t\t\t}\n\n\t\t\t// Convert to relative\n\t\t\tif (settings.relative_urls) {\n\t\t\t\treturn self.documentBaseURI.toRelative(url);\n\t\t\t}\n\n\t\t\t// Convert to absolute\n\t\t\turl = self.documentBaseURI.toAbsolute(url, settings.remove_script_host);\n\n\t\t\treturn url;\n\t\t},\n\n\t\t/**\n\t\t * Adds visual aid for tables, anchors etc so they can be more easily edited inside the editor.\n\t\t *\n\t\t * @method addVisual\n\t\t * @param {Element} elm Optional root element to loop though to find tables etc that needs the visual aid.\n\t\t */\n\t\taddVisual: function(elm) {\n\t\t\tvar self = this, settings = self.settings, dom = self.dom, cls;\n\n\t\t\telm = elm || self.getBody();\n\n\t\t\tif (self.hasVisual === undefined) {\n\t\t\t\tself.hasVisual = settings.visual;\n\t\t\t}\n\n\t\t\teach(dom.select('table,a', elm), function(elm) {\n\t\t\t\tvar value;\n\n\t\t\t\tswitch (elm.nodeName) {\n\t\t\t\t\tcase 'TABLE':\n\t\t\t\t\t\tcls = settings.visual_table_class || 'mce-item-table';\n\t\t\t\t\t\tvalue = dom.getAttrib(elm, 'border');\n\n\t\t\t\t\t\tif ((!value || value == '0') && self.hasVisual) {\n\t\t\t\t\t\t\tdom.addClass(elm, cls);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdom.removeClass(elm, cls);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\tcase 'A':\n\t\t\t\t\t\tif (!dom.getAttrib(elm, 'href', false)) {\n\t\t\t\t\t\t\tvalue = dom.getAttrib(elm, 'name') || elm.id;\n\t\t\t\t\t\t\tcls = settings.visual_anchor_class || 'mce-item-anchor';\n\n\t\t\t\t\t\t\tif (value && self.hasVisual) {\n\t\t\t\t\t\t\t\tdom.addClass(elm, cls);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tdom.removeClass(elm, cls);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.fire('VisualAid', {element: elm, hasVisual: self.hasVisual});\n\t\t},\n\n\t\t/**\n\t\t * Removes the editor from the dom and tinymce collection.\n\t\t *\n\t\t * @method remove\n\t\t */\n\t\tremove: function() {\n\t\t\tvar self = this;\n\n\t\t\tif (!self.removed) {\n\t\t\t\tself.save();\n\t\t\t\tself.removed = 1;\n\t\t\t\tself.unbindAllNativeEvents();\n\n\t\t\t\t// Remove any hidden input\n\t\t\t\tif (self.hasHiddenInput) {\n\t\t\t\t\tDOM.remove(self.getElement().nextSibling);\n\t\t\t\t}\n\n\t\t\t\tif (!self.inline) {\n\t\t\t\t\t// IE 9 has a bug where the selection stops working if you place the\n\t\t\t\t\t// caret inside the editor then remove the iframe\n\t\t\t\t\tif (ie && ie < 10) {\n\t\t\t\t\t\tself.getDoc().execCommand('SelectAll', false, null);\n\t\t\t\t\t}\n\n\t\t\t\t\tDOM.setStyle(self.id, 'display', self.orgDisplay);\n\t\t\t\t\tself.getBody().onload = null; // Prevent #6816\n\t\t\t\t}\n\n\t\t\t\tself.fire('remove');\n\n\t\t\t\tself.editorManager.remove(self);\n\t\t\t\tDOM.remove(self.getContainer());\n\t\t\t\tself._selectionOverrides.destroy();\n\t\t\t\tself.editorUpload.destroy();\n\t\t\t\tself.destroy();\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Destroys the editor instance by removing all events, element references or other resources\n\t\t * that could leak memory. This method will be called automatically when the page is unloaded\n\t\t * but you can also call it directly if you know what you are doing.\n\t\t *\n\t\t * @method destroy\n\t\t * @param {Boolean} automatic Optional state if the destroy is an automatic destroy or user called one.\n\t\t */\n\t\tdestroy: function(automatic) {\n\t\t\tvar self = this, form;\n\n\t\t\t// One time is enough\n\t\t\tif (self.destroyed) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// If user manually calls destroy and not remove\n\t\t\t// Users seems to have logic that calls destroy instead of remove\n\t\t\tif (!automatic && !self.removed) {\n\t\t\t\tself.remove();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!automatic) {\n\t\t\t\tself.editorManager.off('beforeunload', self._beforeUnload);\n\n\t\t\t\t// Manual destroy\n\t\t\t\tif (self.theme && self.theme.destroy) {\n\t\t\t\t\tself.theme.destroy();\n\t\t\t\t}\n\n\t\t\t\t// Destroy controls, selection and dom\n\t\t\t\tself.selection.destroy();\n\t\t\t\tself.dom.destroy();\n\t\t\t}\n\n\t\t\tform = self.formElement;\n\t\t\tif (form) {\n\t\t\t\tif (form._mceOldSubmit) {\n\t\t\t\t\tform.submit = form._mceOldSubmit;\n\t\t\t\t\tform._mceOldSubmit = null;\n\t\t\t\t}\n\n\t\t\t\tDOM.unbind(form, 'submit reset', self.formEventDelegate);\n\t\t\t}\n\n\t\t\tself.contentAreaContainer = self.formElement = self.container = self.editorContainer = null;\n\t\t\tself.bodyElement = self.contentDocument = self.contentWindow = null;\n\t\t\tself.iframeElement = self.targetElm = null;\n\n\t\t\tif (self.selection) {\n\t\t\t\tself.selection = self.selection.win = self.selection.dom = self.selection.dom.doc = null;\n\t\t\t}\n\n\t\t\tself.destroyed = 1;\n\t\t},\n\n\t\t/**\n\t\t * Uploads all data uri/blob uri images in the editor contents to server.\n\t\t *\n\t\t * @method uploadImages\n\t\t * @param {function} callback Optional callback with images and status for each image.\n\t\t * @return {tinymce.util.Promise} Promise instance.\n\t\t */\n\t\tuploadImages: function(callback) {\n\t\t\treturn this.editorUpload.uploadImages(callback);\n\t\t},\n\n\t\t// Internal functions\n\n\t\t_scanForImages: function() {\n\t\t\treturn this.editorUpload.scanForImages();\n\t\t}\n\t};\n\n\textend(Editor.prototype, EditorObservable);\n\n\treturn Editor;\n});\n\n// Included from: js/tinymce/classes/util/I18n.js\n\n/**\n * I18n.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * I18n class that handles translation of TinyMCE UI.\n * Uses po style with csharp style parameters.\n *\n * @class tinymce.util.I18n\n */\ndefine(\"tinymce/util/I18n\", [\n\t\"tinymce/util/Tools\"\n], function(Tools) {\n\t\"use strict\";\n\n\tvar data = {}, code = \"en\";\n\n\treturn {\n\t\t/**\n\t\t * Sets the current language code.\n\t\t *\n\t\t * @method setCode\n\t\t * @param {String} newCode Current language code.\n\t\t */\n\t\tsetCode: function(newCode) {\n\t\t\tif (newCode) {\n\t\t\t\tcode = newCode;\n\t\t\t\tthis.rtl = this.data[newCode] ? this.data[newCode]._dir === 'rtl' : false;\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Returns the current language code.\n\t\t *\n\t\t * @method getCode\n\t\t * @return {String} Current language code.\n\t\t */\n\t\tgetCode: function() {\n\t\t\treturn code;\n\t\t},\n\n\t\t/**\n\t\t * Property gets set to true if a RTL language pack was loaded.\n\t\t *\n\t\t * @property rtl\n\t\t * @type Boolean\n\t\t */\n\t\trtl: false,\n\n\t\t/**\n\t\t * Adds translations for a specific language code.\n\t\t *\n\t\t * @method add\n\t\t * @param {String} code Language code like sv_SE.\n\t\t * @param {Array} items Name/value array with English en_US to sv_SE.\n\t\t */\n\t\tadd: function(code, items) {\n\t\t\tvar langData = data[code];\n\n\t\t\tif (!langData) {\n\t\t\t\tdata[code] = langData = {};\n\t\t\t}\n\n\t\t\tfor (var name in items) {\n\t\t\t\tlangData[name] = items[name];\n\t\t\t}\n\n\t\t\tthis.setCode(code);\n\t\t},\n\n\t\t/**\n\t\t * Translates the specified text.\n\t\t *\n\t\t * It has a few formats:\n\t\t * I18n.translate(\"Text\");\n\t\t * I18n.translate([\"Text {0}/{1}\", 0, 1]);\n\t\t * I18n.translate({raw: \"Raw string\"});\n\t\t *\n\t\t * @method translate\n\t\t * @param {String/Object/Array} text Text to translate.\n\t\t * @return {String} String that got translated.\n\t\t */\n\t\ttranslate: function(text) {\n\t\t\tvar langData = data[code] || {};\n\n\t\t\t/**\n\t\t\t * number - string\n\t\t\t * null, undefined and empty string - empty string\n\t\t\t * array - comma-delimited string\n\t\t\t * object - in [object Object]\n\t\t\t * function - in [object Function]\n\t\t\t *\n\t\t\t * @param obj\n\t\t\t * @returns {string}\n\t\t\t */\n\t\t\tfunction toString(obj) {\n\t\t\t\tif (Tools.is(obj, 'function')) {\n\t\t\t\t\treturn Object.prototype.toString.call(obj);\n\t\t\t\t}\n\t\t\t\treturn !isEmpty(obj) ? '' + obj : '';\n\t\t\t}\n\n\t\t\tfunction isEmpty(text) {\n\t\t\t\treturn text === '' || text === null || Tools.is(text, 'undefined');\n\t\t\t}\n\n\t\t\tfunction getLangData(text) {\n\t\t\t\t// make sure we work on a string and return a string\n\t\t\t\ttext = toString(text);\n\t\t\t\treturn Tools.hasOwn(langData, text) ? toString(langData[text]) : text;\n\t\t\t}\n\n\n\t\t\tif (isEmpty(text)) {\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\tif (Tools.is(text, 'object') && Tools.hasOwn(text, 'raw')) {\n\t\t\t\treturn toString(text.raw);\n\t\t\t}\n\n\t\t\tif (Tools.is(text, 'array')) {\n\t\t\t\tvar values = text.slice(1);\n\t\t\t\ttext = getLangData(text[0]).replace(/\\{([0-9]+)\\}/g, function($1, $2) {\n\t\t\t\t\treturn Tools.hasOwn(values, $2) ? toString(values[$2]) : $1;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn getLangData(text).replace(/{context:\\w+}$/, '');\n\t\t},\n\n\t\tdata: data\n\t};\n});\n\n// Included from: js/tinymce/classes/FocusManager.js\n\n/**\n * FocusManager.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class manages the focus/blur state of the editor. This class is needed since some\n * browsers fire false focus/blur states when the selection is moved to a UI dialog or similar.\n *\n * This class will fire two events focus and blur on the editor instances that got affected.\n * It will also handle the restore of selection when the focus is lost and returned.\n *\n * @class tinymce.FocusManager\n */\ndefine(\"tinymce/FocusManager\", [\n\t\"tinymce/dom/DOMUtils\",\n\t\"tinymce/util/Delay\",\n\t\"tinymce/Env\"\n], function(DOMUtils, Delay, Env) {\n\tvar selectionChangeHandler, documentFocusInHandler, documentMouseUpHandler, DOM = DOMUtils.DOM;\n\n\t/**\n\t * Constructs a new focus manager instance.\n\t *\n\t * @constructor FocusManager\n\t * @param {tinymce.EditorManager} editorManager Editor manager instance to handle focus for.\n\t */\n\tfunction FocusManager(editorManager) {\n\t\tfunction getActiveElement() {\n\t\t\ttry {\n\t\t\t\treturn document.activeElement;\n\t\t\t} catch (ex) {\n\t\t\t\t// IE sometimes fails to get the activeElement when resizing table\n\t\t\t\t// TODO: Investigate this\n\t\t\t\treturn document.body;\n\t\t\t}\n\t\t}\n\n\t\t// We can't store a real range on IE 11 since it gets mutated so we need to use a bookmark object\n\t\t// TODO: Move this to a separate range utils class since it's it's logic is present in Selection as well.\n\t\tfunction createBookmark(dom, rng) {\n\t\t\tif (rng && rng.startContainer) {\n\t\t\t\t// Verify that the range is within the root of the editor\n\t\t\t\tif (!dom.isChildOf(rng.startContainer, dom.getRoot()) || !dom.isChildOf(rng.endContainer, dom.getRoot())) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\tstartContainer: rng.startContainer,\n\t\t\t\t\tstartOffset: rng.startOffset,\n\t\t\t\t\tendContainer: rng.endContainer,\n\t\t\t\t\tendOffset: rng.endOffset\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn rng;\n\t\t}\n\n\t\tfunction bookmarkToRng(editor, bookmark) {\n\t\t\tvar rng;\n\n\t\t\tif (bookmark.startContainer) {\n\t\t\t\trng = editor.getDoc().createRange();\n\t\t\t\trng.setStart(bookmark.startContainer, bookmark.startOffset);\n\t\t\t\trng.setEnd(bookmark.endContainer, bookmark.endOffset);\n\t\t\t} else {\n\t\t\t\trng = bookmark;\n\t\t\t}\n\n\t\t\treturn rng;\n\t\t}\n\n\t\tfunction isUIElement(elm) {\n\t\t\treturn !!DOM.getParent(elm, FocusManager.isEditorUIElement);\n\t\t}\n\n\t\tfunction registerEvents(e) {\n\t\t\tvar editor = e.editor;\n\n\t\t\teditor.on('init', function() {\n\t\t\t\t// Gecko/WebKit has ghost selections in iframes and IE only has one selection per browser tab\n\t\t\t\tif (editor.inline || Env.ie) {\n\t\t\t\t\t// Use the onbeforedeactivate event when available since it works better see #7023\n\t\t\t\t\tif (\"onbeforedeactivate\" in document && Env.ie < 9) {\n\t\t\t\t\t\teditor.dom.bind(editor.getBody(), 'beforedeactivate', function(e) {\n\t\t\t\t\t\t\tif (e.target != editor.getBody()) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\teditor.lastRng = editor.selection.getRng();\n\t\t\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t\t\t// IE throws \"Unexcpected call to method or property access\" some times so lets ignore it\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// On other browsers take snapshot on nodechange in inline mode since they have Ghost selections for iframes\n\t\t\t\t\t\teditor.on('nodechange mouseup keyup', function(e) {\n\t\t\t\t\t\t\tvar node = getActiveElement();\n\n\t\t\t\t\t\t\t// Only act on manual nodechanges\n\t\t\t\t\t\t\tif (e.type == 'nodechange' && e.selectionChange) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// IE 11 reports active element as iframe not body of iframe\n\t\t\t\t\t\t\tif (node && node.id == editor.id + '_ifr') {\n\t\t\t\t\t\t\t\tnode = editor.getBody();\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (editor.dom.isChildOf(node, editor.getBody())) {\n\t\t\t\t\t\t\t\teditor.lastRng = editor.selection.getRng();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\t// Handles the issue with WebKit not retaining selection within inline document\n\t\t\t\t\t// If the user releases the mouse out side the body since a mouse up event wont occur on the body\n\t\t\t\t\tif (Env.webkit && !selectionChangeHandler) {\n\t\t\t\t\t\tselectionChangeHandler = function() {\n\t\t\t\t\t\t\tvar activeEditor = editorManager.activeEditor;\n\n\t\t\t\t\t\t\tif (activeEditor && activeEditor.selection) {\n\t\t\t\t\t\t\t\tvar rng = activeEditor.selection.getRng();\n\n\t\t\t\t\t\t\t\t// Store when it's non collapsed\n\t\t\t\t\t\t\t\tif (rng && !rng.collapsed) {\n\t\t\t\t\t\t\t\t\teditor.lastRng = rng;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tDOM.bind(document, 'selectionchange', selectionChangeHandler);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teditor.on('setcontent', function() {\n\t\t\t\teditor.lastRng = null;\n\t\t\t});\n\n\t\t\t// Remove last selection bookmark on mousedown see #6305\n\t\t\teditor.on('mousedown', function() {\n\t\t\t\teditor.selection.lastFocusBookmark = null;\n\t\t\t});\n\n\t\t\teditor.on('focusin', function() {\n\t\t\t\tvar focusedEditor = editorManager.focusedEditor, lastRng;\n\n\t\t\t\tif (editor.selection.lastFocusBookmark) {\n\t\t\t\t\tlastRng = bookmarkToRng(editor, editor.selection.lastFocusBookmark);\n\t\t\t\t\teditor.selection.lastFocusBookmark = null;\n\t\t\t\t\teditor.selection.setRng(lastRng);\n\t\t\t\t}\n\n\t\t\t\tif (focusedEditor != editor) {\n\t\t\t\t\tif (focusedEditor) {\n\t\t\t\t\t\tfocusedEditor.fire('blur', {focusedEditor: editor});\n\t\t\t\t\t}\n\n\t\t\t\t\teditorManager.setActive(editor);\n\t\t\t\t\teditorManager.focusedEditor = editor;\n\t\t\t\t\teditor.fire('focus', {blurredEditor: focusedEditor});\n\t\t\t\t\teditor.focus(true);\n\t\t\t\t}\n\n\t\t\t\teditor.lastRng = null;\n\t\t\t});\n\n\t\t\teditor.on('focusout', function() {\n\t\t\t\tDelay.setEditorTimeout(editor, function() {\n\t\t\t\t\tvar focusedEditor = editorManager.focusedEditor;\n\n\t\t\t\t\t// Still the same editor the blur was outside any editor UI\n\t\t\t\t\tif (!isUIElement(getActiveElement()) && focusedEditor == editor) {\n\t\t\t\t\t\teditor.fire('blur', {focusedEditor: null});\n\t\t\t\t\t\teditorManager.focusedEditor = null;\n\n\t\t\t\t\t\t// Make sure selection is valid could be invalid if the editor is blured and removed before the timeout occurs\n\t\t\t\t\t\tif (editor.selection) {\n\t\t\t\t\t\t\teditor.selection.lastFocusBookmark = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\t// Check if focus is moved to an element outside the active editor by checking if the target node\n\t\t\t// isn't within the body of the activeEditor nor a UI element such as a dialog child control\n\t\t\tif (!documentFocusInHandler) {\n\t\t\t\tdocumentFocusInHandler = function(e) {\n\t\t\t\t\tvar activeEditor = editorManager.activeEditor, target;\n\n\t\t\t\t\ttarget = e.target;\n\n\t\t\t\t\tif (activeEditor && target.ownerDocument == document) {\n\t\t\t\t\t\t// Check to make sure we have a valid selection don't update the bookmark if it's\n\t\t\t\t\t\t// a focusin to the body of the editor see #7025\n\t\t\t\t\t\tif (activeEditor.selection && target != activeEditor.getBody()) {\n\t\t\t\t\t\t\tactiveEditor.selection.lastFocusBookmark = createBookmark(activeEditor.dom, activeEditor.lastRng);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Fire a blur event if the element isn't a UI element\n\t\t\t\t\t\tif (target != document.body && !isUIElement(target) && editorManager.focusedEditor == activeEditor) {\n\t\t\t\t\t\t\tactiveEditor.fire('blur', {focusedEditor: null});\n\t\t\t\t\t\t\teditorManager.focusedEditor = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tDOM.bind(document, 'focusin', documentFocusInHandler);\n\t\t\t}\n\n\t\t\t// Handle edge case when user starts the selection inside the editor and releases\n\t\t\t// the mouse outside the editor producing a new selection. This weird workaround is needed since\n\t\t\t// Gecko doesn't have the \"selectionchange\" event we need to do this. Fixes: #6843\n\t\t\tif (editor.inline && !documentMouseUpHandler) {\n\t\t\t\tdocumentMouseUpHandler = function(e) {\n\t\t\t\t\tvar activeEditor = editorManager.activeEditor, dom = activeEditor.dom;\n\n\t\t\t\t\tif (activeEditor.inline && dom && !dom.isChildOf(e.target, activeEditor.getBody())) {\n\t\t\t\t\t\tvar rng = activeEditor.selection.getRng();\n\n\t\t\t\t\t\tif (!rng.collapsed) {\n\t\t\t\t\t\t\tactiveEditor.lastRng = rng;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tDOM.bind(document, 'mouseup', documentMouseUpHandler);\n\t\t\t}\n\t\t}\n\n\t\tfunction unregisterDocumentEvents(e) {\n\t\t\tif (editorManager.focusedEditor == e.editor) {\n\t\t\t\teditorManager.focusedEditor = null;\n\t\t\t}\n\n\t\t\tif (!editorManager.activeEditor) {\n\t\t\t\tDOM.unbind(document, 'selectionchange', selectionChangeHandler);\n\t\t\t\tDOM.unbind(document, 'focusin', documentFocusInHandler);\n\t\t\t\tDOM.unbind(document, 'mouseup', documentMouseUpHandler);\n\t\t\t\tselectionChangeHandler = documentFocusInHandler = documentMouseUpHandler = null;\n\t\t\t}\n\t\t}\n\n\t\teditorManager.on('AddEditor', registerEvents);\n\t\teditorManager.on('RemoveEditor', unregisterDocumentEvents);\n\t}\n\n\t/**\n\t * Returns true if the specified element is part of the UI for example an button or text input.\n\t *\n\t * @method isEditorUIElement\n\t * @param  {Element} elm Element to check if it's part of the UI or not.\n\t * @return {Boolean} True/false state if the element is part of the UI or not.\n\t */\n\tFocusManager.isEditorUIElement = function(elm) {\n\t\t// Needs to be converted to string since svg can have focus: #6776\n\t\treturn elm.className.toString().indexOf('mce-') !== -1;\n\t};\n\n\treturn FocusManager;\n});\n\n// Included from: js/tinymce/classes/EditorManager.js\n\n/**\n * EditorManager.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class used as a factory for manager for tinymce.Editor instances.\n *\n * @example\n * tinymce.EditorManager.init({});\n *\n * @class tinymce.EditorManager\n * @mixes tinymce.util.Observable\n * @static\n */\ndefine(\"tinymce/EditorManager\", [\n\t\"tinymce/Editor\",\n\t\"tinymce/dom/DomQuery\",\n\t\"tinymce/dom/DOMUtils\",\n\t\"tinymce/util/URI\",\n\t\"tinymce/Env\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/util/Promise\",\n\t\"tinymce/util/Observable\",\n\t\"tinymce/util/I18n\",\n\t\"tinymce/FocusManager\",\n\t\"tinymce/AddOnManager\"\n], function(Editor, $, DOMUtils, URI, Env, Tools, Promise, Observable, I18n, FocusManager, AddOnManager) {\n\tvar DOM = DOMUtils.DOM;\n\tvar explode = Tools.explode, each = Tools.each, extend = Tools.extend;\n\tvar instanceCounter = 0, beforeUnloadDelegate, EditorManager, boundGlobalEvents = false;\n\n\tfunction globalEventDelegate(e) {\n\t\teach(EditorManager.editors, function(editor) {\n\t\t\tif (e.type === 'scroll') {\n\t\t\t\teditor.fire('ScrollWindow', e);\n\t\t\t} else {\n\t\t\t\teditor.fire('ResizeWindow', e);\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction toggleGlobalEvents(editors, state) {\n\t\tif (state !== boundGlobalEvents) {\n\t\t\tif (state) {\n\t\t\t\t$(window).on('resize scroll', globalEventDelegate);\n\t\t\t} else {\n\t\t\t\t$(window).off('resize scroll', globalEventDelegate);\n\t\t\t}\n\n\t\t\tboundGlobalEvents = state;\n\t\t}\n\t}\n\n\tfunction removeEditorFromList(editor) {\n\t\tvar editors = EditorManager.editors, removedFromList;\n\n\t\tdelete editors[editor.id];\n\n\t\tfor (var i = 0; i < editors.length; i++) {\n\t\t\tif (editors[i] == editor) {\n\t\t\t\teditors.splice(i, 1);\n\t\t\t\tremovedFromList = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\t// Select another editor since the active one was removed\n\t\tif (EditorManager.activeEditor == editor) {\n\t\t\tEditorManager.activeEditor = editors[0];\n\t\t}\n\n\t\t// Clear focusedEditor if necessary, so that we don't try to blur the destroyed editor\n\t\tif (EditorManager.focusedEditor == editor) {\n\t\t\tEditorManager.focusedEditor = null;\n\t\t}\n\n\t\treturn removedFromList;\n\t}\n\n\tfunction purgeDestroyedEditor(editor) {\n\t\t// User has manually destroyed the editor lets clean up the mess\n\t\tif (editor && editor.initialized && !(editor.getContainer() || editor.getBody()).parentNode) {\n\t\t\tremoveEditorFromList(editor);\n\t\t\teditor.unbindAllNativeEvents();\n\t\t\teditor.destroy(true);\n\t\t\teditor.removed = true;\n\t\t\teditor = null;\n\t\t}\n\n\t\treturn editor;\n\t}\n\n\tEditorManager = {\n\t\t/**\n\t\t * Dom query instance.\n\t\t *\n\t\t * @property $\n\t\t * @type tinymce.dom.DomQuery\n\t\t */\n\t\t$: $,\n\n\t\t/**\n\t\t * Major version of TinyMCE build.\n\t\t *\n\t\t * @property majorVersion\n\t\t * @type String\n\t\t */\n\t\tmajorVersion: '4',\n\n\t\t/**\n\t\t * Minor version of TinyMCE build.\n\t\t *\n\t\t * @property minorVersion\n\t\t * @type String\n\t\t */\n\t\tminorVersion: '5.1',\n\n\t\t/**\n\t\t * Release date of TinyMCE build.\n\t\t *\n\t\t * @property releaseDate\n\t\t * @type String\n\t\t */\n\t\treleaseDate: '2016-12-07',\n\n\t\t/**\n\t\t * Collection of editor instances.\n\t\t *\n\t\t * @property editors\n\t\t * @type Object\n\t\t * @example\n\t\t * for (edId in tinymce.editors)\n\t\t *     tinymce.editors[edId].save();\n\t\t */\n\t\teditors: [],\n\n\t\t/**\n\t\t * Collection of language pack data.\n\t\t *\n\t\t * @property i18n\n\t\t * @type Object\n\t\t */\n\t\ti18n: I18n,\n\n\t\t/**\n\t\t * Currently active editor instance.\n\t\t *\n\t\t * @property activeEditor\n\t\t * @type tinymce.Editor\n\t\t * @example\n\t\t * tinyMCE.activeEditor.selection.getContent();\n\t\t * tinymce.EditorManager.activeEditor.selection.getContent();\n\t\t */\n\t\tactiveEditor: null,\n\n\t\tsetup: function() {\n\t\t\tvar self = this, baseURL, documentBaseURL, suffix = \"\", preInit, src;\n\n\t\t\t// Get base URL for the current document\n\t\t\tdocumentBaseURL = URI.getDocumentBaseUrl(document.location);\n\n\t\t\t// Check if the URL is a document based format like: http://site/dir/file and file:///\n\t\t\t// leave other formats like applewebdata://... intact\n\t\t\tif (/^[^:]+:\\/\\/\\/?[^\\/]+\\//.test(documentBaseURL)) {\n\t\t\t\tdocumentBaseURL = documentBaseURL.replace(/[\\?#].*$/, '').replace(/[\\/\\\\][^\\/]+$/, '');\n\n\t\t\t\tif (!/[\\/\\\\]$/.test(documentBaseURL)) {\n\t\t\t\t\tdocumentBaseURL += '/';\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// If tinymce is defined and has a base use that or use the old tinyMCEPreInit\n\t\t\tpreInit = window.tinymce || window.tinyMCEPreInit;\n\t\t\tif (preInit) {\n\t\t\t\tbaseURL = preInit.base || preInit.baseURL;\n\t\t\t\tsuffix = preInit.suffix;\n\t\t\t} else {\n\t\t\t\t// Get base where the tinymce script is located\n\t\t\t\tvar scripts = document.getElementsByTagName('script');\n\t\t\t\tfor (var i = 0; i < scripts.length; i++) {\n\t\t\t\t\tsrc = scripts[i].src;\n\n\t\t\t\t\t// Script types supported:\n\t\t\t\t\t// tinymce.js tinymce.min.js tinymce.dev.js\n\t\t\t\t\t// tinymce.jquery.js tinymce.jquery.min.js tinymce.jquery.dev.js\n\t\t\t\t\t// tinymce.full.js tinymce.full.min.js tinymce.full.dev.js\n\t\t\t\t\tvar srcScript = src.substring(src.lastIndexOf('/'));\n\t\t\t\t\tif (/tinymce(\\.full|\\.jquery|)(\\.min|\\.dev|)\\.js/.test(src)) {\n\t\t\t\t\t\tif (srcScript.indexOf('.min') != -1) {\n\t\t\t\t\t\t\tsuffix = '.min';\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbaseURL = src.substring(0, src.lastIndexOf('/'));\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// We didn't find any baseURL by looking at the script elements\n\t\t\t\t// Try to use the document.currentScript as a fallback\n\t\t\t\tif (!baseURL && document.currentScript) {\n\t\t\t\t\tsrc = document.currentScript.src;\n\n\t\t\t\t\tif (src.indexOf('.min') != -1) {\n\t\t\t\t\t\tsuffix = '.min';\n\t\t\t\t\t}\n\n\t\t\t\t\tbaseURL = src.substring(0, src.lastIndexOf('/'));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Base URL where the root directory if TinyMCE is located.\n\t\t\t *\n\t\t\t * @property baseURL\n\t\t\t * @type String\n\t\t\t */\n\t\t\tself.baseURL = new URI(documentBaseURL).toAbsolute(baseURL);\n\n\t\t\t/**\n\t\t\t * Document base URL where the current document is located.\n\t\t\t *\n\t\t\t * @property documentBaseURL\n\t\t\t * @type String\n\t\t\t */\n\t\t\tself.documentBaseURL = documentBaseURL;\n\n\t\t\t/**\n\t\t\t * Absolute baseURI for the installation path of TinyMCE.\n\t\t\t *\n\t\t\t * @property baseURI\n\t\t\t * @type tinymce.util.URI\n\t\t\t */\n\t\t\tself.baseURI = new URI(self.baseURL);\n\n\t\t\t/**\n\t\t\t * Current suffix to add to each plugin/theme that gets loaded for example \".min\".\n\t\t\t *\n\t\t\t * @property suffix\n\t\t\t * @type String\n\t\t\t */\n\t\t\tself.suffix = suffix;\n\n\t\t\tself.focusManager = new FocusManager(self);\n\t\t},\n\n\t\t/**\n\t\t * Overrides the default settings for editor instances.\n\t\t *\n\t\t * @method overrideDefaults\n\t\t * @param {Object} defaultSettings Defaults settings object.\n\t\t */\n\t\toverrideDefaults: function(defaultSettings) {\n\t\t\tvar baseUrl, suffix;\n\n\t\t\tbaseUrl = defaultSettings.base_url;\n\t\t\tif (baseUrl) {\n\t\t\t\tthis.baseURL = new URI(this.documentBaseURL).toAbsolute(baseUrl.replace(/\\/+$/, ''));\n\t\t\t\tthis.baseURI = new URI(this.baseURL);\n\t\t\t}\n\n\t\t\tsuffix = defaultSettings.suffix;\n\t\t\tif (defaultSettings.suffix) {\n\t\t\t\tthis.suffix = suffix;\n\t\t\t}\n\n\t\t\tthis.defaultSettings = defaultSettings;\n\n\t\t\tvar pluginBaseUrls = defaultSettings.plugin_base_urls;\n\t\t\tfor (var name in pluginBaseUrls) {\n\t\t\t\tAddOnManager.PluginManager.urls[name] = pluginBaseUrls[name];\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Initializes a set of editors. This method will create editors based on various settings.\n\t\t *\n\t\t * @method init\n\t\t * @param {Object} settings Settings object to be passed to each editor instance.\n\t\t * @return {tinymce.util.Promise} Promise that gets resolved with an array of editors when all editor instances are initialized.\n\t\t * @example\n\t\t * // Initializes a editor using the longer method\n\t\t * tinymce.EditorManager.init({\n\t\t *    some_settings : 'some value'\n\t\t * });\n\t\t *\n\t\t * // Initializes a editor instance using the shorter version and with a promise\n\t\t * tinymce.init({\n\t\t *    some_settings : 'some value'\n\t\t * }).then(function(editors) {\n\t\t *    ...\n\t\t * });\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this, result, invalidInlineTargets;\n\n\t\t\tinvalidInlineTargets = Tools.makeMap(\n\t\t\t\t'area base basefont br col frame hr img input isindex link meta param embed source wbr track ' +\n\t\t\t\t'colgroup option tbody tfoot thead tr script noscript style textarea video audio iframe object menu',\n\t\t\t\t' '\n\t\t\t);\n\n\t\t\tfunction isInvalidInlineTarget(settings, elm) {\n\t\t\t\treturn settings.inline && elm.tagName.toLowerCase() in invalidInlineTargets;\n\t\t\t}\n\n\t\t\tfunction report(msg, elm) {\n\t\t\t\t// Log in a non test environment\n\t\t\t\tif (window.console && !window.test) {\n\t\t\t\t\twindow.console.log(msg, elm);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction createId(elm) {\n\t\t\t\tvar id = elm.id;\n\n\t\t\t\t// Use element id, or unique name or generate a unique id\n\t\t\t\tif (!id) {\n\t\t\t\t\tid = elm.name;\n\n\t\t\t\t\tif (id && !DOM.get(id)) {\n\t\t\t\t\t\tid = elm.name;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Generate unique name\n\t\t\t\t\t\tid = DOM.uniqueId();\n\t\t\t\t\t}\n\n\t\t\t\t\telm.setAttribute('id', id);\n\t\t\t\t}\n\n\t\t\t\treturn id;\n\t\t\t}\n\n\t\t\tfunction execCallback(name) {\n\t\t\t\tvar callback = settings[name];\n\n\t\t\t\tif (!callback) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\treturn callback.apply(self, Array.prototype.slice.call(arguments, 2));\n\t\t\t}\n\n\t\t\tfunction hasClass(elm, className) {\n\t\t\t\treturn className.constructor === RegExp ? className.test(elm.className) : DOM.hasClass(elm, className);\n\t\t\t}\n\n\t\t\tfunction findTargets(settings) {\n\t\t\t\tvar l, targets = [];\n\n\t\t\t\tif (settings.types) {\n\t\t\t\t\teach(settings.types, function(type) {\n\t\t\t\t\t\ttargets = targets.concat(DOM.select(type.selector));\n\t\t\t\t\t});\n\n\t\t\t\t\treturn targets;\n\t\t\t\t} else if (settings.selector) {\n\t\t\t\t\treturn DOM.select(settings.selector);\n\t\t\t\t} else if (settings.target) {\n\t\t\t\t\treturn [settings.target];\n\t\t\t\t}\n\n\t\t\t\t// Fallback to old setting\n\t\t\t\tswitch (settings.mode) {\n\t\t\t\t\tcase \"exact\":\n\t\t\t\t\t\tl = settings.elements || '';\n\n\t\t\t\t\t\tif (l.length > 0) {\n\t\t\t\t\t\t\teach(explode(l), function(id) {\n\t\t\t\t\t\t\t\tvar elm;\n\n\t\t\t\t\t\t\t\tif ((elm = DOM.get(id))) {\n\t\t\t\t\t\t\t\t\ttargets.push(elm);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\teach(document.forms, function(f) {\n\t\t\t\t\t\t\t\t\t\teach(f.elements, function(e) {\n\t\t\t\t\t\t\t\t\t\t\tif (e.name === id) {\n\t\t\t\t\t\t\t\t\t\t\t\tid = 'mce_editor_' + instanceCounter++;\n\t\t\t\t\t\t\t\t\t\t\t\tDOM.setAttrib(e, 'id', id);\n\t\t\t\t\t\t\t\t\t\t\t\ttargets.push(e);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase \"textareas\":\n\t\t\t\t\tcase \"specific_textareas\":\n\t\t\t\t\t\teach(DOM.select('textarea'), function(elm) {\n\t\t\t\t\t\t\tif (settings.editor_deselector && hasClass(elm, settings.editor_deselector)) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (!settings.editor_selector || hasClass(elm, settings.editor_selector)) {\n\t\t\t\t\t\t\t\ttargets.push(elm);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\treturn targets;\n\t\t\t}\n\n\t\t\tvar provideResults = function(editors) {\n\t\t\t\tresult = editors;\n\t\t\t};\n\n\t\t\tfunction initEditors() {\n\t\t\t\tvar initCount = 0, editors = [], targets;\n\n\t\t\t\tfunction createEditor(id, settings, targetElm) {\n\t\t\t\t\tvar editor = new Editor(id, settings, self);\n\n\t\t\t\t\teditors.push(editor);\n\n\t\t\t\t\teditor.on('init', function() {\n\t\t\t\t\t\tif (++initCount === targets.length) {\n\t\t\t\t\t\t\tprovideResults(editors);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\teditor.targetElm = editor.targetElm || targetElm;\n\t\t\t\t\teditor.render();\n\t\t\t\t}\n\n\t\t\t\tDOM.unbind(window, 'ready', initEditors);\n\t\t\t\texecCallback('onpageload');\n\n\t\t\t\ttargets = $.unique(findTargets(settings));\n\n\t\t\t\t// TODO: Deprecate this one\n\t\t\t\tif (settings.types) {\n\t\t\t\t\teach(settings.types, function(type) {\n\t\t\t\t\t\tTools.each(targets, function(elm) {\n\t\t\t\t\t\t\tif (DOM.is(elm, type.selector)) {\n\t\t\t\t\t\t\t\tcreateEditor(createId(elm), extend({}, settings, type), elm);\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tTools.each(targets, function(elm) {\n\t\t\t\t\tpurgeDestroyedEditor(self.get(elm.id));\n\t\t\t\t});\n\n\t\t\t\ttargets = Tools.grep(targets, function(elm) {\n\t\t\t\t\treturn !self.get(elm.id);\n\t\t\t\t});\n\n\t\t\t\teach(targets, function(elm) {\n\t\t\t\t\tif (isInvalidInlineTarget(settings, elm)) {\n\t\t\t\t\t\treport('Could not initialize inline editor on invalid inline target element', elm);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcreateEditor(createId(elm), settings, elm);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tself.settings = settings;\n\t\t\tDOM.bind(window, 'ready', initEditors);\n\n\t\t\treturn new Promise(function(resolve) {\n\t\t\t\tif (result) {\n\t\t\t\t\tresolve(result);\n\t\t\t\t} else {\n\t\t\t\t\tprovideResults = function(editors) {\n\t\t\t\t\t\tresolve(editors);\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Returns a editor instance by id.\n\t\t *\n\t\t * @method get\n\t\t * @param {String/Number} id Editor instance id or index to return.\n\t\t * @return {tinymce.Editor} Editor instance to return.\n\t\t * @example\n\t\t * // Adds an onclick event to an editor by id (shorter version)\n\t\t * tinymce.get('mytextbox').on('click', function(e) {\n\t\t *    ed.windowManager.alert('Hello world!');\n\t\t * });\n\t\t *\n\t\t * // Adds an onclick event to an editor by id (longer version)\n\t\t * tinymce.EditorManager.get('mytextbox').on('click', function(e) {\n\t\t *    ed.windowManager.alert('Hello world!');\n\t\t * });\n\t\t */\n\t\tget: function(id) {\n\t\t\tif (!arguments.length) {\n\t\t\t\treturn this.editors;\n\t\t\t}\n\n\t\t\treturn id in this.editors ? this.editors[id] : null;\n\t\t},\n\n\t\t/**\n\t\t * Adds an editor instance to the editor collection. This will also set it as the active editor.\n\t\t *\n\t\t * @method add\n\t\t * @param {tinymce.Editor} editor Editor instance to add to the collection.\n\t\t * @return {tinymce.Editor} The same instance that got passed in.\n\t\t */\n\t\tadd: function(editor) {\n\t\t\tvar self = this, editors = self.editors;\n\n\t\t\t// Add named and index editor instance\n\t\t\teditors[editor.id] = editor;\n\t\t\teditors.push(editor);\n\n\t\t\ttoggleGlobalEvents(editors, true);\n\n\t\t\t// Doesn't call setActive method since we don't want\n\t\t\t// to fire a bunch of activate/deactivate calls while initializing\n\t\t\tself.activeEditor = editor;\n\n\t\t\tself.fire('AddEditor', {editor: editor});\n\n\t\t\tif (!beforeUnloadDelegate) {\n\t\t\t\tbeforeUnloadDelegate = function() {\n\t\t\t\t\tself.fire('BeforeUnload');\n\t\t\t\t};\n\n\t\t\t\tDOM.bind(window, 'beforeunload', beforeUnloadDelegate);\n\t\t\t}\n\n\t\t\treturn editor;\n\t\t},\n\n\t\t/**\n\t\t * Creates an editor instance and adds it to the EditorManager collection.\n\t\t *\n\t\t * @method createEditor\n\t\t * @param {String} id Instance id to use for editor.\n\t\t * @param {Object} settings Editor instance settings.\n\t\t * @return {tinymce.Editor} Editor instance that got created.\n\t\t */\n\t\tcreateEditor: function(id, settings) {\n\t\t\treturn this.add(new Editor(id, settings, this));\n\t\t},\n\n\t\t/**\n\t\t * Removes a editor or editors form page.\n\t\t *\n\t\t * @example\n\t\t * // Remove all editors bound to divs\n\t\t * tinymce.remove('div');\n\t\t *\n\t\t * // Remove all editors bound to textareas\n\t\t * tinymce.remove('textarea');\n\t\t *\n\t\t * // Remove all editors\n\t\t * tinymce.remove();\n\t\t *\n\t\t * // Remove specific instance by id\n\t\t * tinymce.remove('#id');\n\t\t *\n\t\t * @method remove\n\t\t * @param {tinymce.Editor/String/Object} [selector] CSS selector or editor instance to remove.\n\t\t * @return {tinymce.Editor} The editor that got passed in will be return if it was found otherwise null.\n\t\t */\n\t\tremove: function(selector) {\n\t\t\tvar self = this, i, editors = self.editors, editor;\n\n\t\t\t// Remove all editors\n\t\t\tif (!selector) {\n\t\t\t\tfor (i = editors.length - 1; i >= 0; i--) {\n\t\t\t\t\tself.remove(editors[i]);\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Remove editors by selector\n\t\t\tif (typeof selector == \"string\") {\n\t\t\t\tselector = selector.selector || selector;\n\n\t\t\t\teach(DOM.select(selector), function(elm) {\n\t\t\t\t\teditor = editors[elm.id];\n\n\t\t\t\t\tif (editor) {\n\t\t\t\t\t\tself.remove(editor);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Remove specific editor\n\t\t\teditor = selector;\n\n\t\t\t// Not in the collection\n\t\t\tif (!editors[editor.id]) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (removeEditorFromList(editor)) {\n\t\t\t\tself.fire('RemoveEditor', {editor: editor});\n\t\t\t}\n\n\t\t\tif (!editors.length) {\n\t\t\t\tDOM.unbind(window, 'beforeunload', beforeUnloadDelegate);\n\t\t\t}\n\n\t\t\teditor.remove();\n\n\t\t\ttoggleGlobalEvents(editors, editors.length > 0);\n\n\t\t\treturn editor;\n\t\t},\n\n\t\t/**\n\t\t * Executes a specific command on the currently active editor.\n\t\t *\n\t\t * @method execCommand\n\t\t * @param {String} cmd Command to perform for example Bold.\n\t\t * @param {Boolean} ui Optional boolean state if a UI should be presented for the command or not.\n\t\t * @param {String} value Optional value parameter like for example an URL to a link.\n\t\t * @return {Boolean} true/false if the command was executed or not.\n\t\t */\n\t\texecCommand: function(cmd, ui, value) {\n\t\t\tvar self = this, editor = self.get(value);\n\n\t\t\t// Manager commands\n\t\t\tswitch (cmd) {\n\t\t\t\tcase \"mceAddEditor\":\n\t\t\t\t\tif (!self.get(value)) {\n\t\t\t\t\t\tnew Editor(value, self.settings, self).render();\n\t\t\t\t\t}\n\n\t\t\t\t\treturn true;\n\n\t\t\t\tcase \"mceRemoveEditor\":\n\t\t\t\t\tif (editor) {\n\t\t\t\t\t\teditor.remove();\n\t\t\t\t\t}\n\n\t\t\t\t\treturn true;\n\n\t\t\t\tcase 'mceToggleEditor':\n\t\t\t\t\tif (!editor) {\n\t\t\t\t\t\tself.execCommand('mceAddEditor', 0, value);\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (editor.isHidden()) {\n\t\t\t\t\t\teditor.show();\n\t\t\t\t\t} else {\n\t\t\t\t\t\teditor.hide();\n\t\t\t\t\t}\n\n\t\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t// Run command on active editor\n\t\t\tif (self.activeEditor) {\n\t\t\t\treturn self.activeEditor.execCommand(cmd, ui, value);\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\n\t\t/**\n\t\t * Calls the save method on all editor instances in the collection. This can be useful when a form is to be submitted.\n\t\t *\n\t\t * @method triggerSave\n\t\t * @example\n\t\t * // Saves all contents\n\t\t * tinyMCE.triggerSave();\n\t\t */\n\t\ttriggerSave: function() {\n\t\t\teach(this.editors, function(editor) {\n\t\t\t\teditor.save();\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Adds a language pack, this gets called by the loaded language files like en.js.\n\t\t *\n\t\t * @method addI18n\n\t\t * @param {String} code Optional language code.\n\t\t * @param {Object} items Name/value object with translations.\n\t\t */\n\t\taddI18n: function(code, items) {\n\t\t\tI18n.add(code, items);\n\t\t},\n\n\t\t/**\n\t\t * Translates the specified string using the language pack items.\n\t\t *\n\t\t * @method translate\n\t\t * @param {String/Array/Object} text String to translate\n\t\t * @return {String} Translated string.\n\t\t */\n\t\ttranslate: function(text) {\n\t\t\treturn I18n.translate(text);\n\t\t},\n\n\t\t/**\n\t\t * Sets the active editor instance and fires the deactivate/activate events.\n\t\t *\n\t\t * @method setActive\n\t\t * @param {tinymce.Editor} editor Editor instance to set as the active instance.\n\t\t */\n\t\tsetActive: function(editor) {\n\t\t\tvar activeEditor = this.activeEditor;\n\n\t\t\tif (this.activeEditor != editor) {\n\t\t\t\tif (activeEditor) {\n\t\t\t\t\tactiveEditor.fire('deactivate', {relatedTarget: editor});\n\t\t\t\t}\n\n\t\t\t\teditor.fire('activate', {relatedTarget: activeEditor});\n\t\t\t}\n\n\t\t\tthis.activeEditor = editor;\n\t\t}\n\t};\n\n\textend(EditorManager, Observable);\n\n\tEditorManager.setup();\n\n\t// Export EditorManager as tinymce/tinymce in global namespace\n\twindow.tinymce = window.tinyMCE = EditorManager;\n\n\treturn EditorManager;\n});\n\n// Included from: js/tinymce/classes/LegacyInput.js\n\n/**\n * LegacyInput.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Converts legacy input to modern HTML.\n *\n * @class tinymce.LegacyInput\n * @private\n */\ndefine(\"tinymce/LegacyInput\", [\n\t\"tinymce/EditorManager\",\n\t\"tinymce/util/Tools\"\n], function(EditorManager, Tools) {\n\tvar each = Tools.each, explode = Tools.explode;\n\n\tEditorManager.on('AddEditor', function(e) {\n\t\tvar editor = e.editor;\n\n\t\teditor.on('preInit', function() {\n\t\t\tvar filters, fontSizes, dom, settings = editor.settings;\n\n\t\t\tfunction replaceWithSpan(node, styles) {\n\t\t\t\teach(styles, function(value, name) {\n\t\t\t\t\tif (value) {\n\t\t\t\t\t\tdom.setStyle(node, name, value);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tdom.rename(node, 'span');\n\t\t\t}\n\n\t\t\tfunction convert(e) {\n\t\t\t\tdom = editor.dom;\n\n\t\t\t\tif (settings.convert_fonts_to_spans) {\n\t\t\t\t\teach(dom.select('font,u,strike', e.node), function(node) {\n\t\t\t\t\t\tfilters[node.nodeName.toLowerCase()](dom, node);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (settings.inline_styles) {\n\t\t\t\tfontSizes = explode(settings.font_size_legacy_values);\n\n\t\t\t\tfilters = {\n\t\t\t\t\tfont: function(dom, node) {\n\t\t\t\t\t\treplaceWithSpan(node, {\n\t\t\t\t\t\t\tbackgroundColor: node.style.backgroundColor,\n\t\t\t\t\t\t\tcolor: node.color,\n\t\t\t\t\t\t\tfontFamily: node.face,\n\t\t\t\t\t\t\tfontSize: fontSizes[parseInt(node.size, 10) - 1]\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\n\t\t\t\t\tu: function(dom, node) {\n\t\t\t\t\t\t// HTML5 allows U element\n\t\t\t\t\t\tif (editor.settings.schema === \"html4\") {\n\t\t\t\t\t\t\treplaceWithSpan(node, {\n\t\t\t\t\t\t\t\ttextDecoration: 'underline'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\n\t\t\t\t\tstrike: function(dom, node) {\n\t\t\t\t\t\treplaceWithSpan(node, {\n\t\t\t\t\t\t\ttextDecoration: 'line-through'\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\teditor.on('PreProcess SetContent', convert);\n\t\t\t}\n\t\t});\n\t});\n});\n\n// Included from: js/tinymce/classes/util/XHR.js\n\n/**\n * XHR.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class enables you to send XMLHTTPRequests cross browser.\n * @class tinymce.util.XHR\n * @mixes tinymce.util.Observable\n * @static\n * @example\n * // Sends a low level Ajax request\n * tinymce.util.XHR.send({\n *    url: 'someurl',\n *    success: function(text) {\n *       console.debug(text);\n *    }\n * });\n *\n * // Add custom header to XHR request\n * tinymce.util.XHR.on('beforeSend', function(e) {\n *     e.xhr.setRequestHeader('X-Requested-With', 'Something');\n * });\n */\ndefine(\"tinymce/util/XHR\", [\n\t\"tinymce/util/Observable\",\n\t\"tinymce/util/Tools\"\n], function(Observable, Tools) {\n\tvar XHR = {\n\t\t/**\n\t\t * Sends a XMLHTTPRequest.\n\t\t * Consult the Wiki for details on what settings this method takes.\n\t\t *\n\t\t * @method send\n\t\t * @param {Object} settings Object will target URL, callbacks and other info needed to make the request.\n\t\t */\n\t\tsend: function(settings) {\n\t\t\tvar xhr, count = 0;\n\n\t\t\tfunction ready() {\n\t\t\t\tif (!settings.async || xhr.readyState == 4 || count++ > 10000) {\n\t\t\t\t\tif (settings.success && count < 10000 && xhr.status == 200) {\n\t\t\t\t\t\tsettings.success.call(settings.success_scope, '' + xhr.responseText, xhr, settings);\n\t\t\t\t\t} else if (settings.error) {\n\t\t\t\t\t\tsettings.error.call(settings.error_scope, count > 10000 ? 'TIMED_OUT' : 'GENERAL', xhr, settings);\n\t\t\t\t\t}\n\n\t\t\t\t\txhr = null;\n\t\t\t\t} else {\n\t\t\t\t\tsetTimeout(ready, 10);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Default settings\n\t\t\tsettings.scope = settings.scope || this;\n\t\t\tsettings.success_scope = settings.success_scope || settings.scope;\n\t\t\tsettings.error_scope = settings.error_scope || settings.scope;\n\t\t\tsettings.async = settings.async === false ? false : true;\n\t\t\tsettings.data = settings.data || '';\n\n\t\t\tXHR.fire('beforeInitialize', {settings: settings});\n\n\t\t\txhr = new XMLHttpRequest();\n\n\t\t\tif (xhr) {\n\t\t\t\tif (xhr.overrideMimeType) {\n\t\t\t\t\txhr.overrideMimeType(settings.content_type);\n\t\t\t\t}\n\n\t\t\t\txhr.open(settings.type || (settings.data ? 'POST' : 'GET'), settings.url, settings.async);\n\n\t\t\t\tif (settings.crossDomain) {\n\t\t\t\t\txhr.withCredentials = true;\n\t\t\t\t}\n\n\t\t\t\tif (settings.content_type) {\n\t\t\t\t\txhr.setRequestHeader('Content-Type', settings.content_type);\n\t\t\t\t}\n\n\t\t\t\tif (settings.requestheaders) {\n\t\t\t\t\tTools.each(settings.requestheaders, function(header) {\n\t\t\t\t\t\txhr.setRequestHeader(header.key, header.value);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\txhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n\n\t\t\t\txhr = XHR.fire('beforeSend', {xhr: xhr, settings: settings}).xhr;\n\t\t\t\txhr.send(settings.data);\n\n\t\t\t\t// Syncronous request\n\t\t\t\tif (!settings.async) {\n\t\t\t\t\treturn ready();\n\t\t\t\t}\n\n\t\t\t\t// Wait for response, onReadyStateChange can not be used since it leaks memory in IE\n\t\t\t\tsetTimeout(ready, 10);\n\t\t\t}\n\t\t}\n\t};\n\n\tTools.extend(XHR, Observable);\n\n\treturn XHR;\n});\n\n// Included from: js/tinymce/classes/util/JSON.js\n\n/**\n * JSON.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * JSON parser and serializer class.\n *\n * @class tinymce.util.JSON\n * @static\n * @example\n * // JSON parse a string into an object\n * var obj = tinymce.util.JSON.parse(somestring);\n *\n * // JSON serialize a object into an string\n * var str = tinymce.util.JSON.serialize(obj);\n */\ndefine(\"tinymce/util/JSON\", [], function() {\n\tfunction serialize(o, quote) {\n\t\tvar i, v, t, name;\n\n\t\tquote = quote || '\"';\n\n\t\tif (o === null) {\n\t\t\treturn 'null';\n\t\t}\n\n\t\tt = typeof o;\n\n\t\tif (t == 'string') {\n\t\t\tv = '\\bb\\tt\\nn\\ff\\rr\\\"\"\\'\\'\\\\\\\\';\n\n\t\t\t/*eslint no-control-regex:0 */\n\t\t\treturn quote + o.replace(/([\\u0080-\\uFFFF\\x00-\\x1f\\\"\\'\\\\])/g, function(a, b) {\n\t\t\t\t// Make sure single quotes never get encoded inside double quotes for JSON compatibility\n\t\t\t\tif (quote === '\"' && a === \"'\") {\n\t\t\t\t\treturn a;\n\t\t\t\t}\n\n\t\t\t\ti = v.indexOf(b);\n\n\t\t\t\tif (i + 1) {\n\t\t\t\t\treturn '\\\\' + v.charAt(i + 1);\n\t\t\t\t}\n\n\t\t\t\ta = b.charCodeAt().toString(16);\n\n\t\t\t\treturn '\\\\u' + '0000'.substring(a.length) + a;\n\t\t\t}) + quote;\n\t\t}\n\n\t\tif (t == 'object') {\n\t\t\tif (o.hasOwnProperty && Object.prototype.toString.call(o) === '[object Array]') {\n\t\t\t\tfor (i = 0, v = '['; i < o.length; i++) {\n\t\t\t\t\tv += (i > 0 ? ',' : '') + serialize(o[i], quote);\n\t\t\t\t}\n\n\t\t\t\treturn v + ']';\n\t\t\t}\n\n\t\t\tv = '{';\n\n\t\t\tfor (name in o) {\n\t\t\t\tif (o.hasOwnProperty(name)) {\n\t\t\t\t\tv += typeof o[name] != 'function' ? (v.length > 1 ? ',' + quote : quote) + name +\n\t\t\t\t\t\tquote + ':' + serialize(o[name], quote) : '';\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn v + '}';\n\t\t}\n\n\t\treturn '' + o;\n\t}\n\n\treturn {\n\t\t/**\n\t\t * Serializes the specified object as a JSON string.\n\t\t *\n\t\t * @method serialize\n\t\t * @param {Object} obj Object to serialize as a JSON string.\n\t\t * @param {String} quote Optional quote string defaults to \".\n\t\t * @return {string} JSON string serialized from input.\n\t\t */\n\t\tserialize: serialize,\n\n\t\t/**\n\t\t * Unserializes/parses the specified JSON string into a object.\n\t\t *\n\t\t * @method parse\n\t\t * @param {string} s JSON String to parse into a JavaScript object.\n\t\t * @return {Object} Object from input JSON string or undefined if it failed.\n\t\t */\n\t\tparse: function(text) {\n\t\t\ttry {\n\t\t\t\t// Trick uglify JS\n\t\t\t\treturn window[String.fromCharCode(101) + 'val']('(' + text + ')');\n\t\t\t} catch (ex) {\n\t\t\t\t// Ignore\n\t\t\t}\n\t\t}\n\n\t\t/**#@-*/\n\t};\n});\n\n// Included from: js/tinymce/classes/util/JSONRequest.js\n\n/**\n * JSONRequest.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class enables you to use JSON-RPC to call backend methods.\n *\n * @class tinymce.util.JSONRequest\n * @example\n * var json = new tinymce.util.JSONRequest({\n *     url: 'somebackend.php'\n * });\n *\n * // Send RPC call 1\n * json.send({\n *     method: 'someMethod1',\n *     params: ['a', 'b'],\n *     success: function(result) {\n *         console.dir(result);\n *     }\n * });\n *\n * // Send RPC call 2\n * json.send({\n *     method: 'someMethod2',\n *     params: ['a', 'b'],\n *     success: function(result) {\n *         console.dir(result);\n *     }\n * });\n */\ndefine(\"tinymce/util/JSONRequest\", [\n\t\"tinymce/util/JSON\",\n\t\"tinymce/util/XHR\",\n\t\"tinymce/util/Tools\"\n], function(JSON, XHR, Tools) {\n\tvar extend = Tools.extend;\n\n\tfunction JSONRequest(settings) {\n\t\tthis.settings = extend({}, settings);\n\t\tthis.count = 0;\n\t}\n\n\t/**\n\t * Simple helper function to send a JSON-RPC request without the need to initialize an object.\n\t * Consult the Wiki API documentation for more details on what you can pass to this function.\n\t *\n\t * @method sendRPC\n\t * @static\n\t * @param {Object} o Call object where there are three field id, method and params this object should also contain callbacks etc.\n\t */\n\tJSONRequest.sendRPC = function(o) {\n\t\treturn new JSONRequest().send(o);\n\t};\n\n\tJSONRequest.prototype = {\n\t\t/**\n\t\t * Sends a JSON-RPC call. Consult the Wiki API documentation for more details on what you can pass to this function.\n\t\t *\n\t\t * @method send\n\t\t * @param {Object} args Call object where there are three field id, method and params this object should also contain callbacks etc.\n\t\t */\n\t\tsend: function(args) {\n\t\t\tvar ecb = args.error, scb = args.success;\n\n\t\t\targs = extend(this.settings, args);\n\n\t\t\targs.success = function(c, x) {\n\t\t\t\tc = JSON.parse(c);\n\n\t\t\t\tif (typeof c == 'undefined') {\n\t\t\t\t\tc = {\n\t\t\t\t\t\terror: 'JSON Parse error.'\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tif (c.error) {\n\t\t\t\t\tecb.call(args.error_scope || args.scope, c.error, x);\n\t\t\t\t} else {\n\t\t\t\t\tscb.call(args.success_scope || args.scope, c.result);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\targs.error = function(ty, x) {\n\t\t\t\tif (ecb) {\n\t\t\t\t\tecb.call(args.error_scope || args.scope, ty, x);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\targs.data = JSON.serialize({\n\t\t\t\tid: args.id || 'c' + (this.count++),\n\t\t\t\tmethod: args.method,\n\t\t\t\tparams: args.params\n\t\t\t});\n\n\t\t\t// JSON content type for Ruby on rails. Bug: #1883287\n\t\t\targs.content_type = 'application/json';\n\n\t\t\tXHR.send(args);\n\t\t}\n\t};\n\n\treturn JSONRequest;\n});\n\n// Included from: js/tinymce/classes/util/JSONP.js\n\n/**\n * JSONP.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\ndefine(\"tinymce/util/JSONP\", [\n\t\"tinymce/dom/DOMUtils\"\n], function(DOMUtils) {\n\treturn {\n\t\tcallbacks: {},\n\t\tcount: 0,\n\n\t\tsend: function(settings) {\n\t\t\tvar self = this, dom = DOMUtils.DOM, count = settings.count !== undefined ? settings.count : self.count;\n\t\t\tvar id = 'tinymce_jsonp_' + count;\n\n\t\t\tself.callbacks[count] = function(json) {\n\t\t\t\tdom.remove(id);\n\t\t\t\tdelete self.callbacks[count];\n\n\t\t\t\tsettings.callback(json);\n\t\t\t};\n\n\t\t\tdom.add(dom.doc.body, 'script', {\n\t\t\t\tid: id,\n\t\t\t\tsrc: settings.url,\n\t\t\t\ttype: 'text/javascript'\n\t\t\t});\n\n\t\t\tself.count++;\n\t\t}\n\t};\n});\n\n// Included from: js/tinymce/classes/util/LocalStorage.js\n\n/**\n * LocalStorage.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class will simulate LocalStorage on IE 7 and return the native version on modern browsers.\n * Storage is done using userData on IE 7 and a special serialization format. The format is designed\n * to be as small as possible by making sure that the keys and values doesn't need to be encoded. This\n * makes it possible to store for example HTML data.\n *\n * Storage format for userData:\n * <base 32 key length>,<key string>,<base 32 value length>,<value>,...\n *\n * For example this data key1=value1,key2=value2 would be:\n * 4,key1,6,value1,4,key2,6,value2\n *\n * @class tinymce.util.LocalStorage\n * @static\n * @version 4.0\n * @example\n * tinymce.util.LocalStorage.setItem('key', 'value');\n * var value = tinymce.util.LocalStorage.getItem('key');\n */\ndefine(\"tinymce/util/LocalStorage\", [], function() {\n\tvar LocalStorage, storageElm, items, keys, userDataKey, hasOldIEDataSupport;\n\n\t// Check for native support\n\ttry {\n\t\tif (window.localStorage) {\n\t\t\treturn localStorage;\n\t\t}\n\t} catch (ex) {\n\t\t// Ignore\n\t}\n\n\tuserDataKey = \"tinymce\";\n\tstorageElm = document.documentElement;\n\thasOldIEDataSupport = !!storageElm.addBehavior;\n\n\tif (hasOldIEDataSupport) {\n\t\tstorageElm.addBehavior('#default#userData');\n\t}\n\n\t/**\n\t * Gets the keys names and updates LocalStorage.length property. Since IE7 doesn't have any getters/setters.\n\t */\n\tfunction updateKeys() {\n\t\tkeys = [];\n\n\t\tfor (var key in items) {\n\t\t\tkeys.push(key);\n\t\t}\n\n\t\tLocalStorage.length = keys.length;\n\t}\n\n\t/**\n\t * Loads the userData string and parses it into the items structure.\n\t */\n\tfunction load() {\n\t\tvar key, data, value, pos = 0;\n\n\t\titems = {};\n\n\t\t// localStorage can be disabled on WebKit/Gecko so make a dummy storage\n\t\tif (!hasOldIEDataSupport) {\n\t\t\treturn;\n\t\t}\n\n\t\tfunction next(end) {\n\t\t\tvar value, nextPos;\n\n\t\t\tnextPos = end !== undefined ? pos + end : data.indexOf(',', pos);\n\t\t\tif (nextPos === -1 || nextPos > data.length) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tvalue = data.substring(pos, nextPos);\n\t\t\tpos = nextPos + 1;\n\n\t\t\treturn value;\n\t\t}\n\n\t\tstorageElm.load(userDataKey);\n\t\tdata = storageElm.getAttribute(userDataKey) || '';\n\n\t\tdo {\n\t\t\tvar offset = next();\n\t\t\tif (offset === null) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tkey = next(parseInt(offset, 32) || 0);\n\t\t\tif (key !== null) {\n\t\t\t\toffset = next();\n\t\t\t\tif (offset === null) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tvalue = next(parseInt(offset, 32) || 0);\n\n\t\t\t\tif (key) {\n\t\t\t\t\titems[key] = value;\n\t\t\t\t}\n\t\t\t}\n\t\t} while (key !== null);\n\n\t\tupdateKeys();\n\t}\n\n\t/**\n\t * Saves the items structure into a the userData format.\n\t */\n\tfunction save() {\n\t\tvar value, data = '';\n\n\t\t// localStorage can be disabled on WebKit/Gecko so make a dummy storage\n\t\tif (!hasOldIEDataSupport) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor (var key in items) {\n\t\t\tvalue = items[key];\n\t\t\tdata += (data ? ',' : '') + key.length.toString(32) + ',' + key + ',' + value.length.toString(32) + ',' + value;\n\t\t}\n\n\t\tstorageElm.setAttribute(userDataKey, data);\n\n\t\ttry {\n\t\t\tstorageElm.save(userDataKey);\n\t\t} catch (ex) {\n\t\t\t// Ignore disk full\n\t\t}\n\n\t\tupdateKeys();\n\t}\n\n\tLocalStorage = {\n\t\t/**\n\t\t * Length of the number of items in storage.\n\t\t *\n\t\t * @property length\n\t\t * @type Number\n\t\t * @return {Number} Number of items in storage.\n\t\t */\n\t\t//length:0,\n\n\t\t/**\n\t\t * Returns the key name by index.\n\t\t *\n\t\t * @method key\n\t\t * @param {Number} index Index of key to return.\n\t\t * @return {String} Key value or null if it wasn't found.\n\t\t */\n\t\tkey: function(index) {\n\t\t\treturn keys[index];\n\t\t},\n\n\t\t/**\n\t\t * Returns the value if the specified key or null if it wasn't found.\n\t\t *\n\t\t * @method getItem\n\t\t * @param {String} key Key of item to retrieve.\n\t\t * @return {String} Value of the specified item or null if it wasn't found.\n\t\t */\n\t\tgetItem: function(key) {\n\t\t\treturn key in items ? items[key] : null;\n\t\t},\n\n\t\t/**\n\t\t * Sets the value of the specified item by it's key.\n\t\t *\n\t\t * @method setItem\n\t\t * @param {String} key Key of the item to set.\n\t\t * @param {String} value Value of the item to set.\n\t\t */\n\t\tsetItem: function(key, value) {\n\t\t\titems[key] = \"\" + value;\n\t\t\tsave();\n\t\t},\n\n\t\t/**\n\t\t * Removes the specified item by key.\n\t\t *\n\t\t * @method removeItem\n\t\t * @param {String} key Key of item to remove.\n\t\t */\n\t\tremoveItem: function(key) {\n\t\t\tdelete items[key];\n\t\t\tsave();\n\t\t},\n\n\t\t/**\n\t\t * Removes all items.\n\t\t *\n\t\t * @method clear\n\t\t */\n\t\tclear: function() {\n\t\t\titems = {};\n\t\t\tsave();\n\t\t}\n\t};\n\n\tload();\n\n\treturn LocalStorage;\n});\n\n// Included from: js/tinymce/classes/Compat.js\n\n/**\n * Compat.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * TinyMCE core class.\n *\n * @static\n * @class tinymce\n * @borrow-members tinymce.EditorManager\n * @borrow-members tinymce.util.Tools\n */\ndefine(\"tinymce/Compat\", [\n\t\"tinymce/dom/DOMUtils\",\n\t\"tinymce/dom/EventUtils\",\n\t\"tinymce/dom/ScriptLoader\",\n\t\"tinymce/AddOnManager\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/Env\"\n], function(DOMUtils, EventUtils, ScriptLoader, AddOnManager, Tools, Env) {\n\tvar tinymce = window.tinymce;\n\n\t/**\n\t * @property {tinymce.dom.DOMUtils} DOM Global DOM instance.\n\t * @property {tinymce.dom.ScriptLoader} ScriptLoader Global ScriptLoader instance.\n\t * @property {tinymce.AddOnManager} PluginManager Global PluginManager instance.\n\t * @property {tinymce.AddOnManager} ThemeManager Global ThemeManager instance.\n\t */\n\ttinymce.DOM = DOMUtils.DOM;\n\ttinymce.ScriptLoader = ScriptLoader.ScriptLoader;\n\ttinymce.PluginManager = AddOnManager.PluginManager;\n\ttinymce.ThemeManager = AddOnManager.ThemeManager;\n\n\ttinymce.dom = tinymce.dom || {};\n\ttinymce.dom.Event = EventUtils.Event;\n\n\tTools.each(\n\t\t'trim isArray is toArray makeMap each map grep inArray extend create walk createNS resolve explode _addCacheSuffix'.split(' '),\n\t\tfunction(key) {\n\t\t\ttinymce[key] = Tools[key];\n\t\t}\n\t);\n\n\tTools.each('isOpera isWebKit isIE isGecko isMac'.split(' '), function(name) {\n\t\ttinymce[name] = Env[name.substr(2).toLowerCase()];\n\t});\n\n\treturn {};\n});\n\n// Describe the different namespaces\n\n/**\n * Root level namespace this contains classes directly related to the TinyMCE editor.\n *\n * @namespace tinymce\n */\n\n/**\n * Contains classes for handling the browsers DOM.\n *\n * @namespace tinymce.dom\n */\n\n/**\n * Contains html parser and serializer logic.\n *\n * @namespace tinymce.html\n */\n\n/**\n * Contains the different UI types such as buttons, listboxes etc.\n *\n * @namespace tinymce.ui\n */\n\n/**\n * Contains various utility classes such as json parser, cookies etc.\n *\n * @namespace tinymce.util\n */\n\n/**\n * Contains modules to handle data binding.\n *\n * @namespace tinymce.data\n */\n\n// Included from: js/tinymce/classes/ui/Layout.js\n\n/**\n * Layout.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Base layout manager class.\n *\n * @class tinymce.ui.Layout\n */\ndefine(\"tinymce/ui/Layout\", [\n\t\"tinymce/util/Class\",\n\t\"tinymce/util/Tools\"\n], function(Class, Tools) {\n\t\"use strict\";\n\n\treturn Class.extend({\n\t\tDefaults: {\n\t\t\tfirstControlClass: 'first',\n\t\t\tlastControlClass: 'last'\n\t\t},\n\n\t\t/**\n\t\t * Constructs a layout instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tthis.settings = Tools.extend({}, this.Defaults, settings);\n\t\t},\n\n\t\t/**\n\t\t * This method gets invoked before the layout renders the controls.\n\t\t *\n\t\t * @method preRender\n\t\t * @param {tinymce.ui.Container} container Container instance to preRender.\n\t\t */\n\t\tpreRender: function(container) {\n\t\t\tcontainer.bodyClasses.add(this.settings.containerClass);\n\t\t},\n\n\t\t/**\n\t\t * Applies layout classes to the container.\n\t\t *\n\t\t * @private\n\t\t */\n\t\tapplyClasses: function(items) {\n\t\t\tvar self = this, settings = self.settings, firstClass, lastClass, firstItem, lastItem;\n\n\t\t\tfirstClass = settings.firstControlClass;\n\t\t\tlastClass = settings.lastControlClass;\n\n\t\t\titems.each(function(item) {\n\t\t\t\titem.classes.remove(firstClass).remove(lastClass).add(settings.controlClass);\n\n\t\t\t\tif (item.visible()) {\n\t\t\t\t\tif (!firstItem) {\n\t\t\t\t\t\tfirstItem = item;\n\t\t\t\t\t}\n\n\t\t\t\t\tlastItem = item;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (firstItem) {\n\t\t\t\tfirstItem.classes.add(firstClass);\n\t\t\t}\n\n\t\t\tif (lastItem) {\n\t\t\t\tlastItem.classes.add(lastClass);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Renders the specified container and any layout specific HTML.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @param {tinymce.ui.Container} container Container to render HTML for.\n\t\t */\n\t\trenderHtml: function(container) {\n\t\t\tvar self = this, html = '';\n\n\t\t\tself.applyClasses(container.items());\n\n\t\t\tcontainer.items().each(function(item) {\n\t\t\t\thtml += item.renderHtml();\n\t\t\t});\n\n\t\t\treturn html;\n\t\t},\n\n\t\t/**\n\t\t * Recalculates the positions of the controls in the specified container.\n\t\t *\n\t\t * @method recalc\n\t\t * @param {tinymce.ui.Container} container Container instance to recalc.\n\t\t */\n\t\trecalc: function() {\n\t\t},\n\n\t\t/**\n\t\t * This method gets invoked after the layout renders the controls.\n\t\t *\n\t\t * @method postRender\n\t\t * @param {tinymce.ui.Container} container Container instance to postRender.\n\t\t */\n\t\tpostRender: function() {\n\t\t},\n\n\t\tisNative: function() {\n\t\t\treturn false;\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/AbsoluteLayout.js\n\n/**\n * AbsoluteLayout.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * LayoutManager for absolute positioning. This layout manager is more of\n * a base class for other layouts but can be created and used directly.\n *\n * @-x-less AbsoluteLayout.less\n * @class tinymce.ui.AbsoluteLayout\n * @extends tinymce.ui.Layout\n */\ndefine(\"tinymce/ui/AbsoluteLayout\", [\n\t\"tinymce/ui/Layout\"\n], function(Layout) {\n\t\"use strict\";\n\n\treturn Layout.extend({\n\t\tDefaults: {\n\t\t\tcontainerClass: 'abs-layout',\n\t\t\tcontrolClass: 'abs-layout-item'\n\t\t},\n\n\t\t/**\n\t\t * Recalculates the positions of the controls in the specified container.\n\t\t *\n\t\t * @method recalc\n\t\t * @param {tinymce.ui.Container} container Container instance to recalc.\n\t\t */\n\t\trecalc: function(container) {\n\t\t\tcontainer.items().filter(':visible').each(function(ctrl) {\n\t\t\t\tvar settings = ctrl.settings;\n\n\t\t\t\tctrl.layoutRect({\n\t\t\t\t\tx: settings.x,\n\t\t\t\t\ty: settings.y,\n\t\t\t\t\tw: settings.w,\n\t\t\t\t\th: settings.h\n\t\t\t\t});\n\n\t\t\t\tif (ctrl.recalc) {\n\t\t\t\t\tctrl.recalc();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Renders the specified container and any layout specific HTML.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @param {tinymce.ui.Container} container Container to render HTML for.\n\t\t */\n\t\trenderHtml: function(container) {\n\t\t\treturn '<div id=\"' + container._id + '-absend\" class=\"' + container.classPrefix + 'abs-end\"></div>' + this._super(container);\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/Button.js\n\n/**\n * Button.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class is used to create buttons. You can create them directly or through the Factory.\n *\n * @example\n * // Create and render a button to the body element\n * tinymce.ui.Factory.create({\n *     type: 'button',\n *     text: 'My button'\n * }).renderTo(document.body);\n *\n * @-x-less Button.less\n * @class tinymce.ui.Button\n * @extends tinymce.ui.Widget\n */\ndefine(\"tinymce/ui/Button\", [\n\t\"tinymce/ui/Widget\"\n], function(Widget) {\n\t\"use strict\";\n\n\treturn Widget.extend({\n\t\tDefaults: {\n\t\t\tclasses: \"widget btn\",\n\t\t\trole: \"button\"\n\t\t},\n\n\t\t/**\n\t\t * Constructs a new button instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t * @setting {String} size Size of the button small|medium|large.\n\t\t * @setting {String} image Image to use for icon.\n\t\t * @setting {String} icon Icon to use for button.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this, size;\n\n\t\t\tself._super(settings);\n\t\t\tsettings = self.settings;\n\n\t\t\tsize = self.settings.size;\n\n\t\t\tself.on('click mousedown', function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t});\n\n\t\t\tself.on('touchstart', function(e) {\n\t\t\t\tself.fire('click', e);\n\t\t\t\te.preventDefault();\n\t\t\t});\n\n\t\t\tif (settings.subtype) {\n\t\t\t\tself.classes.add(settings.subtype);\n\t\t\t}\n\n\t\t\tif (size) {\n\t\t\t\tself.classes.add('btn-' + size);\n\t\t\t}\n\n\t\t\tif (settings.icon) {\n\t\t\t\tself.icon(settings.icon);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Sets/gets the current button icon.\n\t\t *\n\t\t * @method icon\n\t\t * @param {String} [icon] New icon identifier.\n\t\t * @return {String|tinymce.ui.MenuButton} Current icon or current MenuButton instance.\n\t\t */\n\t\ticon: function(icon) {\n\t\t\tif (!arguments.length) {\n\t\t\t\treturn this.state.get('icon');\n\t\t\t}\n\n\t\t\tthis.state.set('icon', icon);\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Repaints the button for example after it's been resizes by a layout engine.\n\t\t *\n\t\t * @method repaint\n\t\t */\n\t\trepaint: function() {\n\t\t\tvar btnElm = this.getEl().firstChild,\n\t\t\t\tbtnStyle;\n\n\t\t\tif (btnElm) {\n\t\t\t\tbtnStyle = btnElm.style;\n\t\t\t\tbtnStyle.width = btnStyle.height = \"100%\";\n\t\t\t}\n\n\t\t\tthis._super();\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, id = self._id, prefix = self.classPrefix;\n\t\t\tvar icon = self.state.get('icon'), image, text = self.state.get('text'), textHtml = '';\n\n\t\t\timage = self.settings.image;\n\t\t\tif (image) {\n\t\t\t\ticon = 'none';\n\n\t\t\t\t// Support for [high dpi, low dpi] image sources\n\t\t\t\tif (typeof image != \"string\") {\n\t\t\t\t\timage = window.getSelection ? image[0] : image[1];\n\t\t\t\t}\n\n\t\t\t\timage = ' style=\"background-image: url(\\'' + image + '\\')\"';\n\t\t\t} else {\n\t\t\t\timage = '';\n\t\t\t}\n\n\t\t\tif (text) {\n\t\t\t\tself.classes.add('btn-has-text');\n\t\t\t\ttextHtml = '<span class=\"' + prefix + 'txt\">' + self.encode(text) + '</span>';\n\t\t\t}\n\n\t\t\ticon = icon ? prefix + 'ico ' + prefix + 'i-' + icon : '';\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + id + '\" class=\"' + self.classes + '\" tabindex=\"-1\" aria-labelledby=\"' + id + '\">' +\n\t\t\t\t\t'<button role=\"presentation\" type=\"button\" tabindex=\"-1\">' +\n\t\t\t\t\t\t(icon ? '<i class=\"' + icon + '\"' + image + '></i>' : '') +\n\t\t\t\t\t\ttextHtml +\n\t\t\t\t\t'</button>' +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\tbindStates: function() {\n\t\t\tvar self = this, $ = self.$, textCls = self.classPrefix + 'txt';\n\n\t\t\tfunction setButtonText(text) {\n\t\t\t\tvar $span = $('span.' + textCls, self.getEl());\n\n\t\t\t\tif (text) {\n\t\t\t\t\tif (!$span[0]) {\n\t\t\t\t\t\t$('button:first', self.getEl()).append('<span class=\"' + textCls + '\"></span>');\n\t\t\t\t\t\t$span = $('span.' + textCls, self.getEl());\n\t\t\t\t\t}\n\n\t\t\t\t\t$span.html(self.encode(text));\n\t\t\t\t} else {\n\t\t\t\t\t$span.remove();\n\t\t\t\t}\n\n\t\t\t\tself.classes.toggle('btn-has-text', !!text);\n\t\t\t}\n\n\t\t\tself.state.on('change:text', function(e) {\n\t\t\t\tsetButtonText(e.value);\n\t\t\t});\n\n\t\t\tself.state.on('change:icon', function(e) {\n\t\t\t\tvar icon = e.value, prefix = self.classPrefix;\n\n\t\t\t\tself.settings.icon = icon;\n\t\t\t\ticon = icon ? prefix + 'ico ' + prefix + 'i-' + self.settings.icon : '';\n\n\t\t\t\tvar btnElm = self.getEl().firstChild, iconElm = btnElm.getElementsByTagName('i')[0];\n\n\t\t\t\tif (icon) {\n\t\t\t\t\tif (!iconElm || iconElm != btnElm.firstChild) {\n\t\t\t\t\t\ticonElm = document.createElement('i');\n\t\t\t\t\t\tbtnElm.insertBefore(iconElm, btnElm.firstChild);\n\t\t\t\t\t}\n\n\t\t\t\t\ticonElm.className = icon;\n\t\t\t\t} else if (iconElm) {\n\t\t\t\t\tbtnElm.removeChild(iconElm);\n\t\t\t\t}\n\n\t\t\t\tsetButtonText(self.state.get('text'));\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/ButtonGroup.js\n\n/**\n * ButtonGroup.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This control enables you to put multiple buttons into a group. This is\n * useful when you want to combine similar toolbar buttons into a group.\n *\n * @example\n * // Create and render a buttongroup with two buttons to the body element\n * tinymce.ui.Factory.create({\n *     type: 'buttongroup',\n *     items: [\n *         {text: 'Button A'},\n *         {text: 'Button B'}\n *     ]\n * }).renderTo(document.body);\n *\n * @-x-less ButtonGroup.less\n * @class tinymce.ui.ButtonGroup\n * @extends tinymce.ui.Container\n */\ndefine(\"tinymce/ui/ButtonGroup\", [\n\t\"tinymce/ui/Container\"\n], function(Container) {\n\t\"use strict\";\n\n\treturn Container.extend({\n\t\tDefaults: {\n\t\t\tdefaultType: 'button',\n\t\t\trole: 'group'\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, layout = self._layout;\n\n\t\t\tself.classes.add('btn-group');\n\t\t\tself.preRender();\n\t\t\tlayout.preRender(self);\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + self._id + '\" class=\"' + self.classes + '\">' +\n\t\t\t\t\t'<div id=\"' + self._id + '-body\">' +\n\t\t\t\t\t\t(self.settings.html || '') + layout.renderHtml(self) +\n\t\t\t\t\t'</div>' +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/Checkbox.js\n\n/**\n * Checkbox.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This control creates a custom checkbox.\n *\n * @example\n * // Create and render a checkbox to the body element\n * tinymce.ui.Factory.create({\n *     type: 'checkbox',\n *     checked: true,\n *     text: 'My checkbox'\n * }).renderTo(document.body);\n *\n * @-x-less Checkbox.less\n * @class tinymce.ui.Checkbox\n * @extends tinymce.ui.Widget\n */\ndefine(\"tinymce/ui/Checkbox\", [\n\t\"tinymce/ui/Widget\"\n], function(Widget) {\n\t\"use strict\";\n\n\treturn Widget.extend({\n\t\tDefaults: {\n\t\t\tclasses: \"checkbox\",\n\t\t\trole: \"checkbox\",\n\t\t\tchecked: false\n\t\t},\n\n\t\t/**\n\t\t * Constructs a new Checkbox instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t * @setting {Boolean} checked True if the checkbox should be checked by default.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tself._super(settings);\n\n\t\t\tself.on('click mousedown', function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t});\n\n\t\t\tself.on('click', function(e) {\n\t\t\t\te.preventDefault();\n\n\t\t\t\tif (!self.disabled()) {\n\t\t\t\t\tself.checked(!self.checked());\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.checked(self.settings.checked);\n\t\t},\n\n\t\t/**\n\t\t * Getter/setter function for the checked state.\n\t\t *\n\t\t * @method checked\n\t\t * @param {Boolean} [state] State to be set.\n\t\t * @return {Boolean|tinymce.ui.Checkbox} True/false or checkbox if it's a set operation.\n\t\t */\n\t\tchecked: function(state) {\n\t\t\tif (!arguments.length) {\n\t\t\t\treturn this.state.get('checked');\n\t\t\t}\n\n\t\t\tthis.state.set('checked', state);\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Getter/setter function for the value state.\n\t\t *\n\t\t * @method value\n\t\t * @param {Boolean} [state] State to be set.\n\t\t * @return {Boolean|tinymce.ui.Checkbox} True/false or checkbox if it's a set operation.\n\t\t */\n\t\tvalue: function(state) {\n\t\t\tif (!arguments.length) {\n\t\t\t\treturn this.checked();\n\t\t\t}\n\n\t\t\treturn this.checked(state);\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, id = self._id, prefix = self.classPrefix;\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + id + '\" class=\"' + self.classes + '\" unselectable=\"on\" aria-labelledby=\"' + id + '-al\" tabindex=\"-1\">' +\n\t\t\t\t\t'<i class=\"' + prefix + 'ico ' + prefix + 'i-checkbox\"></i>' +\n\t\t\t\t\t'<span id=\"' + id + '-al\" class=\"' + prefix + 'label\">' + self.encode(self.state.get('text')) + '</span>' +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\tbindStates: function() {\n\t\t\tvar self = this;\n\n\t\t\tfunction checked(state) {\n\t\t\t\tself.classes.toggle(\"checked\", state);\n\t\t\t\tself.aria('checked', state);\n\t\t\t}\n\n\t\t\tself.state.on('change:text', function(e) {\n\t\t\t\tself.getEl('al').firstChild.data = self.translate(e.value);\n\t\t\t});\n\n\t\t\tself.state.on('change:checked change:value', function(e) {\n\t\t\t\tself.fire('change');\n\t\t\t\tchecked(e.value);\n\t\t\t});\n\n\t\t\tself.state.on('change:icon', function(e) {\n\t\t\t\tvar icon = e.value, prefix = self.classPrefix;\n\n\t\t\t\tif (typeof icon == 'undefined') {\n\t\t\t\t\treturn self.settings.icon;\n\t\t\t\t}\n\n\t\t\t\tself.settings.icon = icon;\n\t\t\t\ticon = icon ? prefix + 'ico ' + prefix + 'i-' + self.settings.icon : '';\n\n\t\t\t\tvar btnElm = self.getEl().firstChild, iconElm = btnElm.getElementsByTagName('i')[0];\n\n\t\t\t\tif (icon) {\n\t\t\t\t\tif (!iconElm || iconElm != btnElm.firstChild) {\n\t\t\t\t\t\ticonElm = document.createElement('i');\n\t\t\t\t\t\tbtnElm.insertBefore(iconElm, btnElm.firstChild);\n\t\t\t\t\t}\n\n\t\t\t\t\ticonElm.className = icon;\n\t\t\t\t} else if (iconElm) {\n\t\t\t\t\tbtnElm.removeChild(iconElm);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (self.state.get('checked')) {\n\t\t\t\tchecked(true);\n\t\t\t}\n\n\t\t\treturn self._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/ComboBox.js\n\n/**\n * ComboBox.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class creates a combobox control. Select box that you select a value from or\n * type a value into.\n *\n * @-x-less ComboBox.less\n * @class tinymce.ui.ComboBox\n * @extends tinymce.ui.Widget\n */\ndefine(\"tinymce/ui/ComboBox\", [\n\t\"tinymce/ui/Widget\",\n\t\"tinymce/ui/Factory\",\n\t\"tinymce/ui/DomUtils\",\n\t\"tinymce/dom/DomQuery\",\n\t\"tinymce/util/VK\",\n\t\"tinymce/util/Tools\"\n], function(Widget, Factory, DomUtils, $, VK, Tools) {\n\t\"use strict\";\n\n\treturn Widget.extend({\n\t\t/**\n\t\t * Constructs a new control instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t * @setting {String} placeholder Placeholder text to display.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tself._super(settings);\n\t\t\tsettings = self.settings;\n\n\t\t\tself.classes.add('combobox');\n\t\t\tself.subinput = true;\n\t\t\tself.ariaTarget = 'inp'; // TODO: Figure out a better way\n\n\t\t\tsettings.menu = settings.menu || settings.values;\n\n\t\t\tif (settings.menu) {\n\t\t\t\tsettings.icon = 'caret';\n\t\t\t}\n\n\t\t\tself.on('click', function(e) {\n\t\t\t\tvar elm = e.target, root = self.getEl();\n\n\t\t\t\tif (!$.contains(root, elm) && elm != root) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\twhile (elm && elm != root) {\n\t\t\t\t\tif (elm.id && elm.id.indexOf('-open') != -1) {\n\t\t\t\t\t\tself.fire('action');\n\n\t\t\t\t\t\tif (settings.menu) {\n\t\t\t\t\t\t\tself.showMenu();\n\n\t\t\t\t\t\t\tif (e.aria) {\n\t\t\t\t\t\t\t\tself.menu.items()[0].focus();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\telm = elm.parentNode;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// TODO: Rework this\n\t\t\tself.on('keydown', function(e) {\n\t\t\t\tvar rootControl;\n\n\t\t\t\tif (e.keyCode == 13 && e.target.nodeName === 'INPUT') {\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t// Find root control that we can do toJSON on\n\t\t\t\t\tself.parents().reverse().each(function(ctrl) {\n\t\t\t\t\t\tif (ctrl.toJSON) {\n\t\t\t\t\t\t\trootControl = ctrl;\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\t// Fire event on current text box with the serialized data of the whole form\n\t\t\t\t\tself.fire('submit', {data: rootControl.toJSON()});\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.on('keyup', function(e) {\n\t\t\t\tif (e.target.nodeName == \"INPUT\") {\n\t\t\t\t\tvar oldValue = self.state.get('value');\n\t\t\t\t\tvar newValue = e.target.value;\n\n\t\t\t\t\tif (newValue !== oldValue) {\n\t\t\t\t\t\tself.state.set('value', newValue);\n\t\t\t\t\t\tself.fire('autocomplete', e);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.on('mouseover', function(e) {\n\t\t\t\tvar tooltip = self.tooltip().moveTo(-0xFFFF);\n\n\t\t\t\tif (self.statusLevel() && e.target.className.indexOf(self.classPrefix + 'status') !== -1) {\n\t\t\t\t\tvar statusMessage = self.statusMessage() || 'Ok';\n\t\t\t\t\tvar rel = tooltip.text(statusMessage).show().testMoveRel(e.target, ['bc-tc', 'bc-tl', 'bc-tr']);\n\n\t\t\t\t\ttooltip.classes.toggle('tooltip-n', rel == 'bc-tc');\n\t\t\t\t\ttooltip.classes.toggle('tooltip-nw', rel == 'bc-tl');\n\t\t\t\t\ttooltip.classes.toggle('tooltip-ne', rel == 'bc-tr');\n\n\t\t\t\t\ttooltip.moveRel(e.target, rel);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\tstatusLevel: function (value) {\n\t\t\tif (arguments.length > 0) {\n\t\t\t\tthis.state.set('statusLevel', value);\n\t\t\t}\n\n\t\t\treturn this.state.get('statusLevel');\n\t\t},\n\n\t\tstatusMessage: function (value) {\n\t\t\tif (arguments.length > 0) {\n\t\t\t\tthis.state.set('statusMessage', value);\n\t\t\t}\n\n\t\t\treturn this.state.get('statusMessage');\n\t\t},\n\n\t\tshowMenu: function() {\n\t\t\tvar self = this, settings = self.settings, menu;\n\n\t\t\tif (!self.menu) {\n\t\t\t\tmenu = settings.menu || [];\n\n\t\t\t\t// Is menu array then auto constuct menu control\n\t\t\t\tif (menu.length) {\n\t\t\t\t\tmenu = {\n\t\t\t\t\t\ttype: 'menu',\n\t\t\t\t\t\titems: menu\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\tmenu.type = menu.type || 'menu';\n\t\t\t\t}\n\n\t\t\t\tself.menu = Factory.create(menu).parent(self).renderTo(self.getContainerElm());\n\t\t\t\tself.fire('createmenu');\n\t\t\t\tself.menu.reflow();\n\t\t\t\tself.menu.on('cancel', function(e) {\n\t\t\t\t\tif (e.control === self.menu) {\n\t\t\t\t\t\tself.focus();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tself.menu.on('show hide', function(e) {\n\t\t\t\t\te.control.items().each(function(ctrl) {\n\t\t\t\t\t\tctrl.active(ctrl.value() == self.value());\n\t\t\t\t\t});\n\t\t\t\t}).fire('show');\n\n\t\t\t\tself.menu.on('select', function(e) {\n\t\t\t\t\tself.value(e.control.value());\n\t\t\t\t});\n\n\t\t\t\tself.on('focusin', function(e) {\n\t\t\t\t\tif (e.target.tagName.toUpperCase() == 'INPUT') {\n\t\t\t\t\t\tself.menu.hide();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tself.aria('expanded', true);\n\t\t\t}\n\n\t\t\tself.menu.show();\n\t\t\tself.menu.layoutRect({w: self.layoutRect().w});\n\t\t\tself.menu.moveRel(self.getEl(), self.isRtl() ? ['br-tr', 'tr-br'] : ['bl-tl', 'tl-bl']);\n\t\t},\n\n\t\t/**\n\t\t * Focuses the input area of the control.\n\t\t *\n\t\t * @method focus\n\t\t */\n\t\tfocus: function() {\n\t\t\tthis.getEl('inp').focus();\n\t\t},\n\n\t\t/**\n\t\t * Repaints the control after a layout operation.\n\t\t *\n\t\t * @method repaint\n\t\t */\n\t\trepaint: function() {\n\t\t\tvar self = this, elm = self.getEl(), openElm = self.getEl('open'), rect = self.layoutRect();\n\t\t\tvar width, lineHeight, innerPadding = 0, inputElm = elm.firstChild;\n\n\t\t\tif (self.statusLevel() && self.statusLevel() !== 'none') {\n\t\t\t\tinnerPadding = (\n\t\t\t\t\tparseInt(DomUtils.getRuntimeStyle(inputElm, 'padding-right'), 10) -\n\t\t\t\t\tparseInt(DomUtils.getRuntimeStyle(inputElm, 'padding-left'), 10)\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (openElm) {\n\t\t\t\twidth = rect.w - DomUtils.getSize(openElm).width - 10;\n\t\t\t} else {\n\t\t\t\twidth = rect.w - 10;\n\t\t\t}\n\n\t\t\t// Detect old IE 7+8 add lineHeight to align caret vertically in the middle\n\t\t\tvar doc = document;\n\t\t\tif (doc.all && (!doc.documentMode || doc.documentMode <= 8)) {\n\t\t\t\tlineHeight = (self.layoutRect().h - 2) + 'px';\n\t\t\t}\n\n\t\t\t$(inputElm).css({\n\t\t\t\twidth: width - innerPadding,\n\t\t\t\tlineHeight: lineHeight\n\t\t\t});\n\n\t\t\tself._super();\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Post render method. Called after the control has been rendered to the target.\n\t\t *\n\t\t * @method postRender\n\t\t * @return {tinymce.ui.ComboBox} Current combobox instance.\n\t\t */\n\t\tpostRender: function() {\n\t\t\tvar self = this;\n\n\t\t\t$(this.getEl('inp')).on('change', function(e) {\n\t\t\t\tself.state.set('value', e.target.value);\n\t\t\t\tself.fire('change', e);\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, id = self._id, settings = self.settings, prefix = self.classPrefix;\n\t\t\tvar value = self.state.get('value') || '';\n\t\t\tvar icon, text, openBtnHtml = '', extraAttrs = '', statusHtml = '';\n\n\t\t\tif (\"spellcheck\" in settings) {\n\t\t\t\textraAttrs += ' spellcheck=\"' + settings.spellcheck + '\"';\n\t\t\t}\n\n\t\t\tif (settings.maxLength) {\n\t\t\t\textraAttrs += ' maxlength=\"' + settings.maxLength + '\"';\n\t\t\t}\n\n\t\t\tif (settings.size) {\n\t\t\t\textraAttrs += ' size=\"' + settings.size + '\"';\n\t\t\t}\n\n\t\t\tif (settings.subtype) {\n\t\t\t\textraAttrs += ' type=\"' + settings.subtype + '\"';\n\t\t\t}\n\n\t\t\tstatusHtml = '<i id=\"' + id + '-status\" class=\"mce-status mce-ico\" style=\"display: none\"></i>';\n\n\t\t\tif (self.disabled()) {\n\t\t\t\textraAttrs += ' disabled=\"disabled\"';\n\t\t\t}\n\n\t\t\ticon = settings.icon;\n\t\t\tif (icon && icon != 'caret') {\n\t\t\t\ticon = prefix + 'ico ' + prefix + 'i-' + settings.icon;\n\t\t\t}\n\n\t\t\ttext = self.state.get('text');\n\n\t\t\tif (icon || text) {\n\t\t\t\topenBtnHtml = (\n\t\t\t\t\t'<div id=\"' + id + '-open\" class=\"' + prefix + 'btn ' + prefix + 'open\" tabIndex=\"-1\" role=\"button\">' +\n\t\t\t\t\t\t'<button id=\"' + id + '-action\" type=\"button\" hidefocus=\"1\" tabindex=\"-1\">' +\n\t\t\t\t\t\t\t(icon != 'caret' ? '<i class=\"' + icon + '\"></i>' : '<i class=\"' + prefix + 'caret\"></i>') +\n\t\t\t\t\t\t\t(text ? (icon ? ' ' : '') + text : '') +\n\t\t\t\t\t\t'</button>' +\n\t\t\t\t\t'</div>'\n\t\t\t\t);\n\n\t\t\t\tself.classes.add('has-open');\n\t\t\t}\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + id + '\" class=\"' + self.classes + '\">' +\n\t\t\t\t\t'<input id=\"' + id + '-inp\" class=\"' + prefix + 'textbox\" value=\"' +\n\t\t\t\t\tself.encode(value, false) + '\" hidefocus=\"1\"' + extraAttrs + ' placeholder=\"' +\n\t\t\t\t\tself.encode(settings.placeholder) + '\" />' +\n\t\t\t\t\tstatusHtml +\n\t\t\t\t\topenBtnHtml +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\tvalue: function(value) {\n\t\t\tif (arguments.length) {\n\t\t\t\tthis.state.set('value', value);\n\t\t\t\treturn this;\n\t\t\t}\n\n\t\t\t// Make sure the real state is in sync\n\t\t\tif (this.state.get('rendered')) {\n\t\t\t\tthis.state.set('value', this.getEl('inp').value);\n\t\t\t}\n\n\t\t\treturn this.state.get('value');\n\t\t},\n\n\t\tshowAutoComplete: function (items, term) {\n\t\t\tvar self = this;\n\n\t\t\tif (items.length === 0) {\n\t\t\t\tself.hideMenu();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar insert = function (value, title) {\n\t\t\t\treturn function () {\n\t\t\t\t\tself.fire('selectitem', {\n\t\t\t\t\t\ttitle: title,\n\t\t\t\t\t\tvalue: value\n\t\t\t\t\t});\n\t\t\t\t};\n\t\t\t};\n\n\t\t\tif (self.menu) {\n\t\t\t\tself.menu.items().remove();\n\t\t\t} else {\n\t\t\t\tself.menu = Factory.create({\n\t\t\t\t\ttype: 'menu',\n\t\t\t\t\tclasses: 'combobox-menu',\n\t\t\t\t\tlayout: 'flow'\n\t\t\t\t}).parent(self).renderTo();\n\t\t\t}\n\n\t\t\tTools.each(items, function (item) {\n\t\t\t\tself.menu.add({\n\t\t\t\t\ttext: item.title,\n\t\t\t\t\turl: item.previewUrl,\n\t\t\t\t\tmatch: term,\n\t\t\t\t\tclasses: 'menu-item-ellipsis',\n\t\t\t\t\tonclick: insert(item.value, item.title)\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tself.menu.renderNew();\n\t\t\tself.hideMenu();\n\n\t\t\tself.menu.on('cancel', function(e) {\n\t\t\t\tif (e.control.parent() === self.menu) {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tself.focus();\n\t\t\t\t\tself.hideMenu();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.menu.on('select', function() {\n\t\t\t\tself.focus();\n\t\t\t});\n\n\t\t\tvar maxW = self.layoutRect().w;\n\t\t\tself.menu.layoutRect({w: maxW, minW: 0, maxW: maxW});\n\t\t\tself.menu.reflow();\n\t\t\tself.menu.show();\n\t\t\tself.menu.moveRel(self.getEl(), self.isRtl() ? ['br-tr', 'tr-br'] : ['bl-tl', 'tl-bl']);\n\t\t},\n\n\t\thideMenu: function() {\n\t\t\tif (this.menu) {\n\t\t\t\tthis.menu.hide();\n\t\t\t}\n\t\t},\n\n\t\tbindStates: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.state.on('change:value', function(e) {\n\t\t\t\tif (self.getEl('inp').value != e.value) {\n\t\t\t\t\tself.getEl('inp').value = e.value;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.state.on('change:disabled', function(e) {\n\t\t\t\tself.getEl('inp').disabled = e.value;\n\t\t\t});\n\n\t\t\tself.state.on('change:statusLevel', function(e) {\n\t\t\t\tvar statusIconElm = self.getEl('status');\n\t\t\t\tvar prefix = self.classPrefix, value = e.value;\n\n\t\t\t\tDomUtils.css(statusIconElm, 'display', value === 'none' ? 'none' : '');\n\t\t\t\tDomUtils.toggleClass(statusIconElm, prefix + 'i-checkmark', value === 'ok');\n\t\t\t\tDomUtils.toggleClass(statusIconElm, prefix + 'i-warning', value === 'warn');\n\t\t\t\tDomUtils.toggleClass(statusIconElm, prefix + 'i-error', value === 'error');\n\t\t\t\tself.classes.toggle('has-status', value !== 'none');\n\t\t\t\tself.repaint();\n\t\t\t});\n\n\t\t\tDomUtils.on(self.getEl('status'), 'mouseleave', function () {\n\t\t\t\tself.tooltip().hide();\n\t\t\t});\n\n\t\t\tself.on('cancel', function (e) {\n\t\t\t\tif (self.menu && self.menu.visible()) {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tself.hideMenu();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tvar focusIdx = function (idx, menu) {\n\t\t\t\tif (menu && menu.items().length > 0) {\n\t\t\t\t\tmenu.items().eq(idx)[0].focus();\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tself.on('keydown', function (e) {\n\t\t\t\tvar keyCode = e.keyCode;\n\n\t\t\t\tif (e.target.nodeName === 'INPUT') {\n\t\t\t\t\tif (keyCode === VK.DOWN) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tself.fire('autocomplete');\n\t\t\t\t\t\tfocusIdx(0, self.menu);\n\t\t\t\t\t} else if (keyCode === VK.UP) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tfocusIdx(-1, self.menu);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t},\n\n\t\tremove: function() {\n\t\t\t$(this.getEl('inp')).off();\n\n\t\t\tif (this.menu) {\n\t\t\t\tthis.menu.remove();\n\t\t\t}\n\n\t\t\tthis._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/ColorBox.js\n\n/**\n * ColorBox.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This widget lets you enter colors and browse for colors by pressing the color button. It also displays\n * a preview of the current color.\n *\n * @-x-less ColorBox.less\n * @class tinymce.ui.ColorBox\n * @extends tinymce.ui.ComboBox\n */\ndefine(\"tinymce/ui/ColorBox\", [\n\t\"tinymce/ui/ComboBox\"\n], function(ComboBox) {\n\t\"use strict\";\n\n\treturn ComboBox.extend({\n\t\t/**\n\t\t * Constructs a new control instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tsettings.spellcheck = false;\n\n\t\t\tif (settings.onaction) {\n\t\t\t\tsettings.icon = 'none';\n\t\t\t}\n\n\t\t\tself._super(settings);\n\n\t\t\tself.classes.add('colorbox');\n\t\t\tself.on('change keyup postrender', function() {\n\t\t\t\tself.repaintColor(self.value());\n\t\t\t});\n\t\t},\n\n\t\trepaintColor: function(value) {\n\t\t\tvar openElm = this.getEl('open');\n\t\t\tvar elm = openElm ? openElm.getElementsByTagName('i')[0] : null;\n\n\t\t\tif (elm) {\n\t\t\t\ttry {\n\t\t\t\t\telm.style.background = value;\n\t\t\t\t} catch (ex) {\n\t\t\t\t\t// Ignore\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tbindStates: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.state.on('change:value', function(e) {\n\t\t\t\tif (self.state.get('rendered')) {\n\t\t\t\t\tself.repaintColor(e.value);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/PanelButton.js\n\n/**\n * PanelButton.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a new panel button.\n *\n * @class tinymce.ui.PanelButton\n * @extends tinymce.ui.Button\n */\ndefine(\"tinymce/ui/PanelButton\", [\n\t\"tinymce/ui/Button\",\n\t\"tinymce/ui/FloatPanel\"\n], function(Button, FloatPanel) {\n\t\"use strict\";\n\n\treturn Button.extend({\n\t\t/**\n\t\t * Shows the panel for the button.\n\t\t *\n\t\t * @method showPanel\n\t\t */\n\t\tshowPanel: function() {\n\t\t\tvar self = this, settings = self.settings;\n\n\t\t\tself.active(true);\n\n\t\t\tif (!self.panel) {\n\t\t\t\tvar panelSettings = settings.panel;\n\n\t\t\t\t// Wrap panel in grid layout if type if specified\n\t\t\t\t// This makes it possible to add forms or other containers directly in the panel option\n\t\t\t\tif (panelSettings.type) {\n\t\t\t\t\tpanelSettings = {\n\t\t\t\t\t\tlayout: 'grid',\n\t\t\t\t\t\titems: panelSettings\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tpanelSettings.role = panelSettings.role || 'dialog';\n\t\t\t\tpanelSettings.popover = true;\n\t\t\t\tpanelSettings.autohide = true;\n\t\t\t\tpanelSettings.ariaRoot = true;\n\n\t\t\t\tself.panel = new FloatPanel(panelSettings).on('hide', function() {\n\t\t\t\t\tself.active(false);\n\t\t\t\t}).on('cancel', function(e) {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tself.focus();\n\t\t\t\t\tself.hidePanel();\n\t\t\t\t}).parent(self).renderTo(self.getContainerElm());\n\n\t\t\t\tself.panel.fire('show');\n\t\t\t\tself.panel.reflow();\n\t\t\t} else {\n\t\t\t\tself.panel.show();\n\t\t\t}\n\n\t\t\tself.panel.moveRel(self.getEl(), settings.popoverAlign || (self.isRtl() ? ['bc-tr', 'bc-tc'] : ['bc-tl', 'bc-tc']));\n\t\t},\n\n\t\t/**\n\t\t * Hides the panel for the button.\n\t\t *\n\t\t * @method hidePanel\n\t\t */\n\t\thidePanel: function() {\n\t\t\tvar self = this;\n\n\t\t\tif (self.panel) {\n\t\t\t\tself.panel.hide();\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Called after the control has been rendered.\n\t\t *\n\t\t * @method postRender\n\t\t */\n\t\tpostRender: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.aria('haspopup', true);\n\n\t\t\tself.on('click', function(e) {\n\t\t\t\tif (e.control === self) {\n\t\t\t\t\tif (self.panel && self.panel.visible()) {\n\t\t\t\t\t\tself.hidePanel();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.showPanel();\n\t\t\t\t\t\tself.panel.focus(!!e.aria);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t},\n\n\t\tremove: function() {\n\t\t\tif (this.panel) {\n\t\t\t\tthis.panel.remove();\n\t\t\t\tthis.panel = null;\n\t\t\t}\n\n\t\t\treturn this._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/ColorButton.js\n\n/**\n * ColorButton.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class creates a color button control. This is a split button in which the main\n * button has a visual representation of the currently selected color. When clicked\n * the caret button displays a color picker, allowing the user to select a new color.\n *\n * @-x-less ColorButton.less\n * @class tinymce.ui.ColorButton\n * @extends tinymce.ui.PanelButton\n */\ndefine(\"tinymce/ui/ColorButton\", [\n\t\"tinymce/ui/PanelButton\",\n\t\"tinymce/dom/DOMUtils\"\n], function(PanelButton, DomUtils) {\n\t\"use strict\";\n\n\tvar DOM = DomUtils.DOM;\n\n\treturn PanelButton.extend({\n\t\t/**\n\t\t * Constructs a new ColorButton instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tthis._super(settings);\n\t\t\tthis.classes.add('colorbutton');\n\t\t},\n\n\t\t/**\n\t\t * Getter/setter for the current color.\n\t\t *\n\t\t * @method color\n\t\t * @param {String} [color] Color to set.\n\t\t * @return {String|tinymce.ui.ColorButton} Current color or current instance.\n\t\t */\n\t\tcolor: function(color) {\n\t\t\tif (color) {\n\t\t\t\tthis._color = color;\n\t\t\t\tthis.getEl('preview').style.backgroundColor = color;\n\t\t\t\treturn this;\n\t\t\t}\n\n\t\t\treturn this._color;\n\t\t},\n\n\t\t/**\n\t\t * Resets the current color.\n\t\t *\n\t\t * @method resetColor\n\t\t * @return {tinymce.ui.ColorButton} Current instance.\n\t\t */\n\t\tresetColor: function() {\n\t\t\tthis._color = null;\n\t\t\tthis.getEl('preview').style.backgroundColor = null;\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, id = self._id, prefix = self.classPrefix, text = self.state.get('text');\n\t\t\tvar icon = self.settings.icon ? prefix + 'ico ' + prefix + 'i-' + self.settings.icon : '';\n\t\t\tvar image = self.settings.image ? ' style=\"background-image: url(\\'' + self.settings.image + '\\')\"' : '',\n\t\t\t\ttextHtml = '';\n\n\t\t\tif (text) {\n\t\t\t\tself.classes.add('btn-has-text');\n\t\t\t\ttextHtml = '<span class=\"' + prefix + 'txt\">' + self.encode(text) + '</span>';\n\t\t\t}\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + id + '\" class=\"' + self.classes + '\" role=\"button\" tabindex=\"-1\" aria-haspopup=\"true\">' +\n\t\t\t\t\t'<button role=\"presentation\" hidefocus=\"1\" type=\"button\" tabindex=\"-1\">' +\n\t\t\t\t\t\t(icon ? '<i class=\"' + icon + '\"' + image + '></i>' : '') +\n\t\t\t\t\t\t'<span id=\"' + id + '-preview\" class=\"' + prefix + 'preview\"></span>' +\n\t\t\t\t\t\ttextHtml +\n\t\t\t\t\t'</button>' +\n\t\t\t\t\t'<button type=\"button\" class=\"' + prefix + 'open\" hidefocus=\"1\" tabindex=\"-1\">' +\n\t\t\t\t\t\t' <i class=\"' + prefix + 'caret\"></i>' +\n\t\t\t\t\t'</button>' +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Called after the control has been rendered.\n\t\t *\n\t\t * @method postRender\n\t\t */\n\t\tpostRender: function() {\n\t\t\tvar self = this, onClickHandler = self.settings.onclick;\n\n\t\t\tself.on('click', function(e) {\n\t\t\t\tif (e.aria && e.aria.key == 'down') {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (e.control == self && !DOM.getParent(e.target, '.' + self.classPrefix + 'open')) {\n\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\tonClickHandler.call(self, e);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tdelete self.settings.onclick;\n\n\t\t\treturn self._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/util/Color.js\n\n/**\n * Color.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class lets you parse/serialize colors and convert rgb/hsb.\n *\n * @class tinymce.util.Color\n * @example\n * var white = new tinymce.util.Color({r: 255, g: 255, b: 255});\n * var red = new tinymce.util.Color('#FF0000');\n *\n * console.log(white.toHex(), red.toHsv());\n */\ndefine(\"tinymce/util/Color\", [], function() {\n\tvar min = Math.min, max = Math.max, round = Math.round;\n\n\t/**\n\t * Constructs a new color instance.\n\t *\n\t * @constructor\n\t * @method Color\n\t * @param {String} value Optional initial value to parse.\n\t */\n\tfunction Color(value) {\n\t\tvar self = this, r = 0, g = 0, b = 0;\n\n\t\tfunction rgb2hsv(r, g, b) {\n\t\t\tvar h, s, v, d, minRGB, maxRGB;\n\n\t\t\th = 0;\n\t\t\ts = 0;\n\t\t\tv = 0;\n\t\t\tr = r / 255;\n\t\t\tg = g / 255;\n\t\t\tb = b / 255;\n\n\t\t\tminRGB = min(r, min(g, b));\n\t\t\tmaxRGB = max(r, max(g, b));\n\n\t\t\tif (minRGB == maxRGB) {\n\t\t\t\tv = minRGB;\n\n\t\t\t\treturn {\n\t\t\t\t\th: 0,\n\t\t\t\t\ts: 0,\n\t\t\t\t\tv: v * 100\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t/*eslint no-nested-ternary:0 */\n\t\t\td = (r == minRGB) ? g - b : ((b == minRGB) ? r - g : b - r);\n\t\t\th = (r == minRGB) ? 3 : ((b == minRGB) ? 1 : 5);\n\t\t\th = 60 * (h - d / (maxRGB - minRGB));\n\t\t\ts = (maxRGB - minRGB) / maxRGB;\n\t\t\tv = maxRGB;\n\n\t\t\treturn {\n\t\t\t\th: round(h),\n\t\t\t\ts: round(s * 100),\n\t\t\t\tv: round(v * 100)\n\t\t\t};\n\t\t}\n\n\t\tfunction hsvToRgb(hue, saturation, brightness) {\n\t\t\tvar side, chroma, x, match;\n\n\t\t\thue = (parseInt(hue, 10) || 0) % 360;\n\t\t\tsaturation = parseInt(saturation, 10) / 100;\n\t\t\tbrightness = parseInt(brightness, 10) / 100;\n\t\t\tsaturation = max(0, min(saturation, 1));\n\t\t\tbrightness = max(0, min(brightness, 1));\n\n\t\t\tif (saturation === 0) {\n\t\t\t\tr = g = b = round(255 * brightness);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tside = hue / 60;\n\t\t\tchroma = brightness * saturation;\n\t\t\tx = chroma * (1 - Math.abs(side % 2 - 1));\n\t\t\tmatch = brightness - chroma;\n\n\t\t\tswitch (Math.floor(side)) {\n\t\t\t\tcase 0:\n\t\t\t\t\tr = chroma;\n\t\t\t\t\tg = x;\n\t\t\t\t\tb = 0;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 1:\n\t\t\t\t\tr = x;\n\t\t\t\t\tg = chroma;\n\t\t\t\t\tb = 0;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 2:\n\t\t\t\t\tr = 0;\n\t\t\t\t\tg = chroma;\n\t\t\t\t\tb = x;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 3:\n\t\t\t\t\tr = 0;\n\t\t\t\t\tg = x;\n\t\t\t\t\tb = chroma;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 4:\n\t\t\t\t\tr = x;\n\t\t\t\t\tg = 0;\n\t\t\t\t\tb = chroma;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 5:\n\t\t\t\t\tr = chroma;\n\t\t\t\t\tg = 0;\n\t\t\t\t\tb = x;\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tr = g = b = 0;\n\t\t\t}\n\n\t\t\tr = round(255 * (r + match));\n\t\t\tg = round(255 * (g + match));\n\t\t\tb = round(255 * (b + match));\n\t\t}\n\n\t\t/**\n\t\t * Returns the hex string of the current color. For example: #ff00ff\n\t\t *\n\t\t * @method toHex\n\t\t * @return {String} Hex string of current color.\n\t\t */\n\t\tfunction toHex() {\n\t\t\tfunction hex(val) {\n\t\t\t\tval = parseInt(val, 10).toString(16);\n\n\t\t\t\treturn val.length > 1 ? val : '0' + val;\n\t\t\t}\n\n\t\t\treturn '#' + hex(r) + hex(g) + hex(b);\n\t\t}\n\n\t\t/**\n\t\t * Returns the r, g, b values of the color. Each channel has a range from 0-255.\n\t\t *\n\t\t * @method toRgb\n\t\t * @return {Object} Object with r, g, b fields.\n\t\t */\n\t\tfunction toRgb() {\n\t\t\treturn {\n\t\t\t\tr: r,\n\t\t\t\tg: g,\n\t\t\t\tb: b\n\t\t\t};\n\t\t}\n\n\t\t/**\n\t\t * Returns the h, s, v values of the color. Ranges: h=0-360, s=0-100, v=0-100.\n\t\t *\n\t\t * @method toHsv\n\t\t * @return {Object} Object with h, s, v fields.\n\t\t */\n\t\tfunction toHsv() {\n\t\t\treturn rgb2hsv(r, g, b);\n\t\t}\n\n\t\t/**\n\t\t * Parses the specified value and populates the color instance.\n\t\t *\n\t\t * Supported format examples:\n\t\t *  * rbg(255,0,0)\n\t\t *  * #ff0000\n\t\t *  * #fff\n\t\t *  * {r: 255, g: 0, b: 0}\n\t\t *  * {h: 360, s: 100, v: 100}\n\t\t *\n\t\t * @method parse\n\t\t * @param {Object/String} value Color value to parse.\n\t\t * @return {tinymce.util.Color} Current color instance.\n\t\t */\n\t\tfunction parse(value) {\n\t\t\tvar matches;\n\n\t\t\tif (typeof value == 'object') {\n\t\t\t\tif (\"r\" in value) {\n\t\t\t\t\tr = value.r;\n\t\t\t\t\tg = value.g;\n\t\t\t\t\tb = value.b;\n\t\t\t\t} else if (\"v\" in value) {\n\t\t\t\t\thsvToRgb(value.h, value.s, value.v);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif ((matches = /rgb\\s*\\(\\s*([0-9]+)\\s*,\\s*([0-9]+)\\s*,\\s*([0-9]+)[^\\)]*\\)/gi.exec(value))) {\n\t\t\t\t\tr = parseInt(matches[1], 10);\n\t\t\t\t\tg = parseInt(matches[2], 10);\n\t\t\t\t\tb = parseInt(matches[3], 10);\n\t\t\t\t} else if ((matches = /#([0-F]{2})([0-F]{2})([0-F]{2})/gi.exec(value))) {\n\t\t\t\t\tr = parseInt(matches[1], 16);\n\t\t\t\t\tg = parseInt(matches[2], 16);\n\t\t\t\t\tb = parseInt(matches[3], 16);\n\t\t\t\t} else if ((matches = /#([0-F])([0-F])([0-F])/gi.exec(value))) {\n\t\t\t\t\tr = parseInt(matches[1] + matches[1], 16);\n\t\t\t\t\tg = parseInt(matches[2] + matches[2], 16);\n\t\t\t\t\tb = parseInt(matches[3] + matches[3], 16);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tr = r < 0 ? 0 : (r > 255 ? 255 : r);\n\t\t\tg = g < 0 ? 0 : (g > 255 ? 255 : g);\n\t\t\tb = b < 0 ? 0 : (b > 255 ? 255 : b);\n\n\t\t\treturn self;\n\t\t}\n\n\t\tif (value) {\n\t\t\tparse(value);\n\t\t}\n\n\t\tself.toRgb = toRgb;\n\t\tself.toHsv = toHsv;\n\t\tself.toHex = toHex;\n\t\tself.parse = parse;\n\t}\n\n\treturn Color;\n});\n\n// Included from: js/tinymce/classes/ui/ColorPicker.js\n\n/**\n * ColorPicker.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Color picker widget lets you select colors.\n *\n * @-x-less ColorPicker.less\n * @class tinymce.ui.ColorPicker\n * @extends tinymce.ui.Widget\n */\ndefine(\"tinymce/ui/ColorPicker\", [\n\t\"tinymce/ui/Widget\",\n\t\"tinymce/ui/DragHelper\",\n\t\"tinymce/ui/DomUtils\",\n\t\"tinymce/util/Color\"\n], function(Widget, DragHelper, DomUtils, Color) {\n\t\"use strict\";\n\n\treturn Widget.extend({\n\t\tDefaults: {\n\t\t\tclasses: \"widget colorpicker\"\n\t\t},\n\n\t\t/**\n\t\t * Constructs a new colorpicker instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t * @setting {String} color Initial color value.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tthis._super(settings);\n\t\t},\n\n\t\tpostRender: function() {\n\t\t\tvar self = this, color = self.color(), hsv, hueRootElm, huePointElm, svRootElm, svPointElm;\n\n\t\t\thueRootElm = self.getEl('h');\n\t\t\thuePointElm = self.getEl('hp');\n\t\t\tsvRootElm = self.getEl('sv');\n\t\t\tsvPointElm = self.getEl('svp');\n\n\t\t\tfunction getPos(elm, event) {\n\t\t\t\tvar pos = DomUtils.getPos(elm), x, y;\n\n\t\t\t\tx = event.pageX - pos.x;\n\t\t\t\ty = event.pageY - pos.y;\n\n\t\t\t\tx = Math.max(0, Math.min(x / elm.clientWidth, 1));\n\t\t\t\ty = Math.max(0, Math.min(y / elm.clientHeight, 1));\n\n\t\t\t\treturn {\n\t\t\t\t\tx: x,\n\t\t\t\t\ty: y\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tfunction updateColor(hsv, hueUpdate) {\n\t\t\t\tvar hue = (360 - hsv.h) / 360;\n\n\t\t\t\tDomUtils.css(huePointElm, {\n\t\t\t\t\ttop: (hue * 100) + '%'\n\t\t\t\t});\n\n\t\t\t\tif (!hueUpdate) {\n\t\t\t\t\tDomUtils.css(svPointElm, {\n\t\t\t\t\t\tleft: hsv.s + '%',\n\t\t\t\t\t\ttop: (100 - hsv.v) + '%'\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tsvRootElm.style.background = new Color({s: 100, v: 100, h: hsv.h}).toHex();\n\t\t\t\tself.color().parse({s: hsv.s, v: hsv.v, h: hsv.h});\n\t\t\t}\n\n\t\t\tfunction updateSaturationAndValue(e) {\n\t\t\t\tvar pos;\n\n\t\t\t\tpos = getPos(svRootElm, e);\n\t\t\t\thsv.s = pos.x * 100;\n\t\t\t\thsv.v = (1 - pos.y) * 100;\n\n\t\t\t\tupdateColor(hsv);\n\t\t\t\tself.fire('change');\n\t\t\t}\n\n\t\t\tfunction updateHue(e) {\n\t\t\t\tvar pos;\n\n\t\t\t\tpos = getPos(hueRootElm, e);\n\t\t\t\thsv = color.toHsv();\n\t\t\t\thsv.h = (1 - pos.y) * 360;\n\t\t\t\tupdateColor(hsv, true);\n\t\t\t\tself.fire('change');\n\t\t\t}\n\n\t\t\tself._repaint = function() {\n\t\t\t\thsv = color.toHsv();\n\t\t\t\tupdateColor(hsv);\n\t\t\t};\n\n\t\t\tself._super();\n\n\t\t\tself._svdraghelper = new DragHelper(self._id + '-sv', {\n\t\t\t\tstart: updateSaturationAndValue,\n\t\t\t\tdrag: updateSaturationAndValue\n\t\t\t});\n\n\t\t\tself._hdraghelper = new DragHelper(self._id + '-h', {\n\t\t\t\tstart: updateHue,\n\t\t\t\tdrag: updateHue\n\t\t\t});\n\n\t\t\tself._repaint();\n\t\t},\n\n\t\trgb: function() {\n\t\t\treturn this.color().toRgb();\n\t\t},\n\n\t\tvalue: function(value) {\n\t\t\tvar self = this;\n\n\t\t\tif (arguments.length) {\n\t\t\t\tself.color().parse(value);\n\n\t\t\t\tif (self._rendered) {\n\t\t\t\t\tself._repaint();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn self.color().toHex();\n\t\t\t}\n\t\t},\n\n\t\tcolor: function() {\n\t\t\tif (!this._color) {\n\t\t\t\tthis._color = new Color();\n\t\t\t}\n\n\t\t\treturn this._color;\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, id = self._id, prefix = self.classPrefix, hueHtml;\n\t\t\tvar stops = '#ff0000,#ff0080,#ff00ff,#8000ff,#0000ff,#0080ff,#00ffff,#00ff80,#00ff00,#80ff00,#ffff00,#ff8000,#ff0000';\n\n\t\t\tfunction getOldIeFallbackHtml() {\n\t\t\t\tvar i, l, html = '', gradientPrefix, stopsList;\n\n\t\t\t\tgradientPrefix = 'filter:progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr=';\n\t\t\t\tstopsList = stops.split(',');\n\t\t\t\tfor (i = 0, l = stopsList.length - 1; i < l; i++) {\n\t\t\t\t\thtml += (\n\t\t\t\t\t\t'<div class=\"' + prefix + 'colorpicker-h-chunk\" style=\"' +\n\t\t\t\t\t\t\t'height:' + (100 / l) + '%;' +\n\t\t\t\t\t\t\tgradientPrefix + stopsList[i] + ',endColorstr=' + stopsList[i + 1] + ');' +\n\t\t\t\t\t\t\t'-ms-' + gradientPrefix + stopsList[i] + ',endColorstr=' + stopsList[i + 1] + ')' +\n\t\t\t\t\t\t'\"></div>'\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\treturn html;\n\t\t\t}\n\n\t\t\tvar gradientCssText = (\n\t\t\t\t'background: -ms-linear-gradient(top,' + stops + ');' +\n\t\t\t\t'background: linear-gradient(to bottom,' + stops + ');'\n\t\t\t);\n\n\t\t\thueHtml = (\n\t\t\t\t'<div id=\"' + id + '-h\" class=\"' + prefix + 'colorpicker-h\" style=\"' + gradientCssText + '\">' +\n\t\t\t\t\tgetOldIeFallbackHtml() +\n\t\t\t\t\t'<div id=\"' + id + '-hp\" class=\"' + prefix + 'colorpicker-h-marker\"></div>' +\n\t\t\t\t'</div>'\n\t\t\t);\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + id + '\" class=\"' + self.classes + '\">' +\n\t\t\t\t\t'<div id=\"' + id + '-sv\" class=\"' + prefix + 'colorpicker-sv\">' +\n\t\t\t\t\t\t'<div class=\"' + prefix + 'colorpicker-overlay1\">' +\n\t\t\t\t\t\t\t'<div class=\"' + prefix + 'colorpicker-overlay2\">' +\n\t\t\t\t\t\t\t\t'<div id=\"' + id + '-svp\" class=\"' + prefix + 'colorpicker-selector1\">' +\n\t\t\t\t\t\t\t\t\t'<div class=\"' + prefix + 'colorpicker-selector2\"></div>' +\n\t\t\t\t\t\t\t\t'</div>' +\n\t\t\t\t\t\t\t'</div>' +\n\t\t\t\t\t\t'</div>' +\n\t\t\t\t\t'</div>' +\n\t\t\t\t\thueHtml +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/Path.js\n\n/**\n * Path.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a new path control.\n *\n * @-x-less Path.less\n * @class tinymce.ui.Path\n * @extends tinymce.ui.Widget\n */\ndefine(\"tinymce/ui/Path\", [\n\t\"tinymce/ui/Widget\"\n], function(Widget) {\n\t\"use strict\";\n\n\treturn Widget.extend({\n\t\t/**\n\t\t * Constructs a instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t * @setting {String} delimiter Delimiter to display between row in path.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tif (!settings.delimiter) {\n\t\t\t\tsettings.delimiter = '\\u00BB';\n\t\t\t}\n\n\t\t\tself._super(settings);\n\t\t\tself.classes.add('path');\n\t\t\tself.canFocus = true;\n\n\t\t\tself.on('click', function(e) {\n\t\t\t\tvar index, target = e.target;\n\n\t\t\t\tif ((index = target.getAttribute('data-index'))) {\n\t\t\t\t\tself.fire('select', {value: self.row()[index], index: index});\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.row(self.settings.row);\n\t\t},\n\n\t\t/**\n\t\t * Focuses the current control.\n\t\t *\n\t\t * @method focus\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\tfocus: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.getEl().firstChild.focus();\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Sets/gets the data to be used for the path.\n\t\t *\n\t\t * @method row\n\t\t * @param {Array} row Array with row name is rendered to path.\n\t\t */\n\t\trow: function(row) {\n\t\t\tif (!arguments.length) {\n\t\t\t\treturn this.state.get('row');\n\t\t\t}\n\n\t\t\tthis.state.set('row', row);\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this;\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + self._id + '\" class=\"' + self.classes + '\">' +\n\t\t\t\t\tself._getDataPathHtml(self.state.get('row')) +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\tbindStates: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.state.on('change:row', function(e) {\n\t\t\t\tself.innerHtml(self._getDataPathHtml(e.value));\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t},\n\n\t\t_getDataPathHtml: function(data) {\n\t\t\tvar self = this, parts = data || [], i, l, html = '', prefix = self.classPrefix;\n\n\t\t\tfor (i = 0, l = parts.length; i < l; i++) {\n\t\t\t\thtml += (\n\t\t\t\t\t(i > 0 ? '<div class=\"' + prefix + 'divider\" aria-hidden=\"true\"> ' + self.settings.delimiter + ' </div>' : '') +\n\t\t\t\t\t'<div role=\"button\" class=\"' + prefix + 'path-item' + (i == l - 1 ? ' ' + prefix + 'last' : '') + '\" data-index=\"' +\n\t\t\t\t\ti + '\" tabindex=\"-1\" id=\"' + self._id + '-' + i + '\" aria-level=\"' + (i + 1) + '\">' + parts[i].name + '</div>'\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (!html) {\n\t\t\t\thtml = '<div class=\"' + prefix + 'path-item\">\\u00a0</div>';\n\t\t\t}\n\n\t\t\treturn html;\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/ElementPath.js\n\n/**\n * ElementPath.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This control creates an path for the current selections parent elements in TinyMCE.\n *\n * @class tinymce.ui.ElementPath\n * @extends tinymce.ui.Path\n */\ndefine(\"tinymce/ui/ElementPath\", [\n\t\"tinymce/ui/Path\"\n], function(Path) {\n\treturn Path.extend({\n\t\t/**\n\t\t * Post render method. Called after the control has been rendered to the target.\n\t\t *\n\t\t * @method postRender\n\t\t * @return {tinymce.ui.ElementPath} Current combobox instance.\n\t\t */\n\t\tpostRender: function() {\n\t\t\tvar self = this, editor = self.settings.editor;\n\n\t\t\tfunction isHidden(elm) {\n\t\t\t\tif (elm.nodeType === 1) {\n\t\t\t\t\tif (elm.nodeName == \"BR\" || !!elm.getAttribute('data-mce-bogus')) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (elm.getAttribute('data-mce-type') === 'bookmark') {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (editor.settings.elementpath !== false) {\n\t\t\t\tself.on('select', function(e) {\n\t\t\t\t\teditor.focus();\n\t\t\t\t\teditor.selection.select(this.row()[e.index].element);\n\t\t\t\t\teditor.nodeChanged();\n\t\t\t\t});\n\n\t\t\t\teditor.on('nodeChange', function(e) {\n\t\t\t\t\tvar outParents = [], parents = e.parents, i = parents.length;\n\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tif (parents[i].nodeType == 1 && !isHidden(parents[i])) {\n\t\t\t\t\t\t\tvar args = editor.fire('ResolveName', {\n\t\t\t\t\t\t\t\tname: parents[i].nodeName.toLowerCase(),\n\t\t\t\t\t\t\t\ttarget: parents[i]\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tif (!args.isDefaultPrevented()) {\n\t\t\t\t\t\t\t\toutParents.push({name: args.name, element: parents[i]});\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (args.isPropagationStopped()) {\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tself.row(outParents);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn self._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/FormItem.js\n\n/**\n * FormItem.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class is a container created by the form element with\n * a label and control item.\n *\n * @class tinymce.ui.FormItem\n * @extends tinymce.ui.Container\n * @setting {String} label Label to display for the form item.\n */\ndefine(\"tinymce/ui/FormItem\", [\n\t\"tinymce/ui/Container\"\n], function(Container) {\n\t\"use strict\";\n\n\treturn Container.extend({\n\t\tDefaults: {\n\t\t\tlayout: 'flex',\n\t\t\talign: 'center',\n\t\t\tdefaults: {\n\t\t\t\tflex: 1\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, layout = self._layout, prefix = self.classPrefix;\n\n\t\t\tself.classes.add('formitem');\n\t\t\tlayout.preRender(self);\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + self._id + '\" class=\"' + self.classes + '\" hidefocus=\"1\" tabindex=\"-1\">' +\n\t\t\t\t\t(self.settings.title ? ('<div id=\"' + self._id + '-title\" class=\"' + prefix + 'title\">' +\n\t\t\t\t\t\tself.settings.title + '</div>') : '') +\n\t\t\t\t\t'<div id=\"' + self._id + '-body\" class=\"' + self.bodyClasses + '\">' +\n\t\t\t\t\t\t(self.settings.html || '') + layout.renderHtml(self) +\n\t\t\t\t\t'</div>' +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/Form.js\n\n/**\n * Form.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class creates a form container. A form container has the ability\n * to automatically wrap items in tinymce.ui.FormItem instances.\n *\n * Each FormItem instance is a container for the label and the item.\n *\n * @example\n * tinymce.ui.Factory.create({\n *     type: 'form',\n *     items: [\n *         {type: 'textbox', label: 'My text box'}\n *     ]\n * }).renderTo(document.body);\n *\n * @class tinymce.ui.Form\n * @extends tinymce.ui.Container\n */\ndefine(\"tinymce/ui/Form\", [\n\t\"tinymce/ui/Container\",\n\t\"tinymce/ui/FormItem\",\n\t\"tinymce/util/Tools\"\n], function(Container, FormItem, Tools) {\n\t\"use strict\";\n\n\treturn Container.extend({\n\t\tDefaults: {\n\t\t\tcontainerCls: 'form',\n\t\t\tlayout: 'flex',\n\t\t\tdirection: 'column',\n\t\t\talign: 'stretch',\n\t\t\tflex: 1,\n\t\t\tpadding: 20,\n\t\t\tlabelGap: 30,\n\t\t\tspacing: 10,\n\t\t\tcallbacks: {\n\t\t\t\tsubmit: function() {\n\t\t\t\t\tthis.submit();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * This method gets invoked before the control is rendered.\n\t\t *\n\t\t * @method preRender\n\t\t */\n\t\tpreRender: function() {\n\t\t\tvar self = this, items = self.items();\n\n\t\t\tif (!self.settings.formItemDefaults) {\n\t\t\t\tself.settings.formItemDefaults = {\n\t\t\t\t\tlayout: 'flex',\n\t\t\t\t\tautoResize: \"overflow\",\n\t\t\t\t\tdefaults: {flex: 1}\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t// Wrap any labeled items in FormItems\n\t\t\titems.each(function(ctrl) {\n\t\t\t\tvar formItem, label = ctrl.settings.label;\n\n\t\t\t\tif (label) {\n\t\t\t\t\tformItem = new FormItem(Tools.extend({\n\t\t\t\t\t\titems: {\n\t\t\t\t\t\t\ttype: 'label',\n\t\t\t\t\t\t\tid: ctrl._id + '-l',\n\t\t\t\t\t\t\ttext: label,\n\t\t\t\t\t\t\tflex: 0,\n\t\t\t\t\t\t\tforId: ctrl._id,\n\t\t\t\t\t\t\tdisabled: ctrl.disabled()\n\t\t\t\t\t\t}\n\t\t\t\t\t}, self.settings.formItemDefaults));\n\n\t\t\t\t\tformItem.type = 'formitem';\n\t\t\t\t\tctrl.aria('labelledby', ctrl._id + '-l');\n\n\t\t\t\t\tif (typeof ctrl.settings.flex == \"undefined\") {\n\t\t\t\t\t\tctrl.settings.flex = 1;\n\t\t\t\t\t}\n\n\t\t\t\t\tself.replace(ctrl, formItem);\n\t\t\t\t\tformItem.add(ctrl);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Fires a submit event with the serialized form.\n\t\t *\n\t\t * @method submit\n\t\t * @return {Object} Event arguments object.\n\t\t */\n\t\tsubmit: function() {\n\t\t\treturn this.fire('submit', {data: this.toJSON()});\n\t\t},\n\n\t\t/**\n\t\t * Post render method. Called after the control has been rendered to the target.\n\t\t *\n\t\t * @method postRender\n\t\t * @return {tinymce.ui.ComboBox} Current combobox instance.\n\t\t */\n\t\tpostRender: function() {\n\t\t\tvar self = this;\n\n\t\t\tself._super();\n\t\t\tself.fromJSON(self.settings.data);\n\t\t},\n\n\t\tbindStates: function() {\n\t\t\tvar self = this;\n\n\t\t\tself._super();\n\n\t\t\tfunction recalcLabels() {\n\t\t\t\tvar maxLabelWidth = 0, labels = [], i, labelGap, items;\n\n\t\t\t\tif (self.settings.labelGapCalc === false) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (self.settings.labelGapCalc == \"children\") {\n\t\t\t\t\titems = self.find('formitem');\n\t\t\t\t} else {\n\t\t\t\t\titems = self.items();\n\t\t\t\t}\n\n\t\t\t\titems.filter('formitem').each(function(item) {\n\t\t\t\t\tvar labelCtrl = item.items()[0], labelWidth = labelCtrl.getEl().clientWidth;\n\n\t\t\t\t\tmaxLabelWidth = labelWidth > maxLabelWidth ? labelWidth : maxLabelWidth;\n\t\t\t\t\tlabels.push(labelCtrl);\n\t\t\t\t});\n\n\t\t\t\tlabelGap = self.settings.labelGap || 0;\n\n\t\t\t\ti = labels.length;\n\t\t\t\twhile (i--) {\n\t\t\t\t\tlabels[i].settings.minWidth = maxLabelWidth + labelGap;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tself.on('show', recalcLabels);\n\t\t\trecalcLabels();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/FieldSet.js\n\n/**\n * FieldSet.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class creates fieldset containers.\n *\n * @-x-less FieldSet.less\n * @class tinymce.ui.FieldSet\n * @extends tinymce.ui.Form\n */\ndefine(\"tinymce/ui/FieldSet\", [\n\t\"tinymce/ui/Form\"\n], function(Form) {\n\t\"use strict\";\n\n\treturn Form.extend({\n\t\tDefaults: {\n\t\t\tcontainerCls: 'fieldset',\n\t\t\tlayout: 'flex',\n\t\t\tdirection: 'column',\n\t\t\talign: 'stretch',\n\t\t\tflex: 1,\n\t\t\tpadding: \"25 15 5 15\",\n\t\t\tlabelGap: 30,\n\t\t\tspacing: 10,\n\t\t\tborder: 1\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, layout = self._layout, prefix = self.classPrefix;\n\n\t\t\tself.preRender();\n\t\t\tlayout.preRender(self);\n\n\t\t\treturn (\n\t\t\t\t'<fieldset id=\"' + self._id + '\" class=\"' + self.classes + '\" hidefocus=\"1\" tabindex=\"-1\">' +\n\t\t\t\t\t(self.settings.title ? ('<legend id=\"' + self._id + '-title\" class=\"' + prefix + 'fieldset-title\">' +\n\t\t\t\t\t\tself.settings.title + '</legend>') : '') +\n\t\t\t\t\t'<div id=\"' + self._id + '-body\" class=\"' + self.bodyClasses + '\">' +\n\t\t\t\t\t\t(self.settings.html || '') + layout.renderHtml(self) +\n\t\t\t\t\t'</div>' +\n\t\t\t\t'</fieldset>'\n\t\t\t);\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/content/LinkTargets.js\n\n/**\n * LinkTargets.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This module is enables you to get anything that you can link to in a element.\n *\n * @private\n * @class tinymce.content.LinkTargets\n */\ndefine('tinymce/content/LinkTargets', [\n\t'tinymce/dom/DOMUtils',\n\t'tinymce/util/Fun',\n\t'tinymce/util/Arr',\n\t'tinymce/util/Uuid',\n\t'tinymce/util/Tools',\n\t'tinymce/dom/NodeType'\n], function(\n\tDOMUtils,\n\tFun,\n\tArr,\n\tUuid,\n\tTools,\n\tNodeType\n) {\n\tvar trim = Tools.trim;\n\n\tvar create = function (type, title, url, level, attach) {\n\t\treturn {\n\t\t\ttype: type,\n\t\t\ttitle: title,\n\t\t\turl: url,\n\t\t\tlevel: level,\n\t\t\tattach: attach\n\t\t};\n\t};\n\n\tvar isChildOfContentEditableTrue = function (node) {\n\t\twhile ((node = node.parentNode)) {\n\t\t\tvar value = node.contentEditable;\n\t\t\tif (value && value !== 'inherit') {\n\t\t\t\treturn NodeType.isContentEditableTrue(node);\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t};\n\n\tvar select = function (selector, root) {\n\t\treturn DOMUtils.DOM.select(selector, root);\n\t};\n\n\tvar getElementText = function (elm) {\n\t\treturn elm.innerText || elm.textContent;\n\t};\n\n\tvar getOrGenerateId = function (elm) {\n\t\treturn elm.id ? elm.id : Uuid.uuid('h');\n\t};\n\n\tvar isAnchor = function (elm) {\n\t\treturn elm && elm.nodeName === 'A' && (elm.id || elm.name);\n\t};\n\n\tvar isValidAnchor = function (elm) {\n\t\treturn isAnchor(elm) && isEditable(elm);\n\t};\n\n\tvar isHeader = function (elm) {\n\t\treturn elm && /^(H[1-6])$/.test(elm.nodeName);\n\t};\n\n\tvar isEditable = function (elm) {\n\t\treturn isChildOfContentEditableTrue(elm) && !NodeType.isContentEditableFalse(elm);\n\t};\n\n\tvar isValidHeader = function (elm) {\n\t\treturn isHeader(elm) && isEditable(elm);\n\t};\n\n\tvar getLevel = function (elm) {\n\t\treturn isHeader(elm) ? parseInt(elm.nodeName.substr(1), 10) : 0;\n\t};\n\n\tvar headerTarget = function (elm) {\n\t\tvar headerId = getOrGenerateId(elm);\n\n\t\tvar attach = function () {\n\t\t\telm.id = headerId;\n\t\t};\n\n\t\treturn create('header', getElementText(elm), '#' + headerId, getLevel(elm), attach);\n\t};\n\n\tvar anchorTarget = function (elm) {\n\t\tvar anchorId = elm.id || elm.name;\n\t\tvar anchorText = getElementText(elm);\n\n\t\treturn create('anchor', anchorText ? anchorText : '#' + anchorId, '#' + anchorId, 0, Fun.noop);\n\t};\n\n\tvar getHeaderTargets = function (elms) {\n\t\treturn Arr.map(Arr.filter(elms, isValidHeader), headerTarget);\n\t};\n\n\tvar getAnchorTargets = function (elms) {\n\t\treturn Arr.map(Arr.filter(elms, isValidAnchor), anchorTarget);\n\t};\n\n\tvar getTargetElements = function (elm) {\n\t\tvar elms = select('h1,h2,h3,h4,h5,h6,a:not([href])', elm);\n\t\treturn elms;\n\t};\n\n\tvar hasTitle = function (target) {\n\t\treturn trim(target.title).length > 0;\n\t};\n\n\tvar find = function (elm) {\n\t\tvar elms = getTargetElements(elm);\n\t\treturn Arr.filter(getHeaderTargets(elms).concat(getAnchorTargets(elms)), hasTitle);\n\t};\n\n\treturn {\n\t\tfind: find\n\t};\n});\n\n// Included from: js/tinymce/classes/ui/FilePicker.js\n\n/**\n * FilePicker.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/*global tinymce:true */\n\n/**\n * This class creates a file picker control.\n *\n * @class tinymce.ui.FilePicker\n * @extends tinymce.ui.ComboBox\n */\ndefine(\"tinymce/ui/FilePicker\", [\n\t\"tinymce/ui/ComboBox\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/util/Arr\",\n\t\"tinymce/util/Fun\",\n\t\"tinymce/util/VK\",\n\t\"tinymce/content/LinkTargets\"\n], function(ComboBox, Tools, Arr, Fun, VK, LinkTargets) {\n\t\"use strict\";\n\n\tvar history = {};\n\tvar HISTORY_LENGTH = 5;\n\n\tvar toMenuItem = function (target) {\n\t\treturn {\n\t\t\ttitle: target.title,\n\t\t\tvalue: {\n\t\t\t\ttitle: {raw: target.title},\n\t\t\t\turl: target.url,\n\t\t\t\tattach: target.attach\n\t\t\t}\n\t\t};\n\t};\n\n\tvar toMenuItems = function (targets) {\n\t\treturn Tools.map(targets, toMenuItem);\n\t};\n\n\tvar staticMenuItem = function (title, url) {\n\t\treturn {\n\t\t\ttitle: title,\n\t\t\tvalue: {\n\t\t\t\ttitle: title,\n\t\t\t\turl: url,\n\t\t\t\tattach: Fun.noop\n\t\t\t}\n\t\t};\n\t};\n\n\tvar isUniqueUrl = function (url, targets) {\n\t\tvar foundTarget = Arr.find(targets, function (target) {\n\t\t\treturn target.url === url;\n\t\t});\n\n\t\treturn !foundTarget;\n\t};\n\n\tvar getSetting = function (editorSettings, name, defaultValue) {\n\t\tvar value = name in editorSettings ? editorSettings[name] : defaultValue;\n\t\treturn value === false ? null : value;\n\t};\n\n\tvar createMenuItems = function (term, targets, fileType, editorSettings) {\n\t\tvar separator = {title: '-'};\n\n\t\tvar fromHistoryMenuItems = function (history) {\n\t\t\tvar uniqueHistory = Arr.filter(history[fileType], function (url) {\n\t\t\t\treturn isUniqueUrl(url, targets);\n\t\t\t});\n\n\t\t\treturn Tools.map(uniqueHistory, function (url) {\n\t\t\t\treturn {\n\t\t\t\t\ttitle: url,\n\t\t\t\t\tvalue: {\n\t\t\t\t\t\ttitle: url,\n\t\t\t\t\t\turl: url,\n\t\t\t\t\t\tattach: Fun.noop\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t});\n\t\t};\n\n\t\tvar fromMenuItems = function (type) {\n\t\t\tvar filteredTargets = Arr.filter(targets, function (target) {\n\t\t\t\treturn target.type == type;\n\t\t\t});\n\n\t\t\treturn toMenuItems(filteredTargets);\n\t\t};\n\n\t\tvar anchorMenuItems = function () {\n\t\t\tvar anchorMenuItems = fromMenuItems('anchor');\n\t\t\tvar topAnchor = getSetting(editorSettings, 'anchor_top', '#top');\n\t\t\tvar bottomAchor = getSetting(editorSettings, 'anchor_bottom', '#bottom');\n\n\t\t\tif (topAnchor !== null) {\n\t\t\t\tanchorMenuItems.unshift(staticMenuItem('<top>', topAnchor));\n\t\t\t}\n\n\t\t\tif (bottomAchor !== null) {\n\t\t\t\tanchorMenuItems.push(staticMenuItem('<bottom>', bottomAchor));\n\t\t\t}\n\n\t\t\treturn anchorMenuItems;\n\t\t};\n\n\t\tvar join = function (items) {\n\t\t\treturn Arr.reduce(items, function (a, b) {\n\t\t\t\tvar bothEmpty = a.length === 0 || b.length === 0;\n\t\t\t\treturn bothEmpty ? a.concat(b) : a.concat(separator, b);\n\t\t\t}, []);\n\t\t};\n\n\t\tif (editorSettings.typeahead_urls === false) {\n\t\t\treturn [];\n\t\t}\n\n\t\treturn fileType === 'file' ? join([\n\t\t\tfilterByQuery(term, fromHistoryMenuItems(history)),\n\t\t\tfilterByQuery(term, fromMenuItems('header')),\n\t\t\tfilterByQuery(term, anchorMenuItems())\n\t\t]) : filterByQuery(term, fromHistoryMenuItems(history));\n\t};\n\n\tvar addToHistory = function (url, fileType) {\n\t\tvar items = history[fileType];\n\n\t\tif (!/^https?/.test(url)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (items) {\n\t\t\tif (Arr.indexOf(items, url) === -1) {\n\t\t\t\thistory[fileType] = items.slice(0, HISTORY_LENGTH).concat(url);\n\t\t\t}\n\t\t} else {\n\t\t\thistory[fileType] = [url];\n\t\t}\n\t};\n\n\tvar filterByQuery = function (term, menuItems) {\n\t\tvar lowerCaseTerm = term.toLowerCase();\n\t\tvar result = Tools.grep(menuItems, function (item) {\n\t\t\treturn item.title.toLowerCase().indexOf(lowerCaseTerm) !== -1;\n\t\t});\n\n\t\treturn result.length === 1 && result[0].title === term ? [] : result;\n\t};\n\n\tvar getTitle = function (linkDetails) {\n\t\tvar title = linkDetails.title;\n\t\treturn title.raw ? title.raw : title;\n\t};\n\n\tvar setupAutoCompleteHandler = function (ctrl, editorSettings, bodyElm, fileType) {\n\t\tvar autocomplete = function (term) {\n\t\t\tvar linkTargets = LinkTargets.find(bodyElm);\n\t\t\tvar menuItems = createMenuItems(term, linkTargets, fileType, editorSettings);\n\t\t\tctrl.showAutoComplete(menuItems, term);\n\t\t};\n\n\t\tctrl.on('autocomplete', function () {\n\t\t\tautocomplete(ctrl.value());\n\t\t});\n\n\t\tctrl.on('selectitem', function (e) {\n\t\t\tvar linkDetails = e.value;\n\n\t\t\tctrl.value(linkDetails.url);\n\t\t\tvar title = getTitle(linkDetails);\n\n\t\t\tif (fileType === 'image') {\n\t\t\t\tctrl.fire('change', {meta: {alt: title, attach: linkDetails.attach}});\n\t\t\t} else {\n\t\t\t\tctrl.fire('change', {meta: {text: title, attach: linkDetails.attach}});\n\t\t\t}\n\n\t\t\tctrl.focus();\n\t\t});\n\n\t\tctrl.on('click', function (e) {\n\t\t\tif (ctrl.value().length === 0 && e.target.nodeName === 'INPUT') {\n\t\t\t\tautocomplete('');\n\t\t\t}\n\t\t});\n\n\t\tctrl.on('PostRender', function () {\n\t\t\tctrl.getRoot().on('submit', function (e) {\n\t\t\t\tif (!e.isDefaultPrevented()) {\n\t\t\t\t\taddToHistory(ctrl.value(), fileType);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t};\n\n\tvar statusToUiState = function (result) {\n\t\tvar status = result.status, message = result.message;\n\n\t\tif (status === 'valid') {\n\t\t\treturn {status: 'ok', message: message};\n\t\t} else if (status === 'unknown') {\n\t\t\treturn {status: 'warn', message: message};\n\t\t} else if (status === 'invalid') {\n\t\t\treturn {status: 'warn', message: message};\n\t\t} else {\n\t\t\treturn {status: 'none', message: ''};\n\t\t}\n\t};\n\n\tvar setupLinkValidatorHandler = function (ctrl, editorSettings, fileType) {\n\t\tvar validatorHandler = editorSettings.filepicker_validator_handler;\n\t\tif (validatorHandler) {\n\t\t\tvar validateUrl = function (url) {\n\t\t\t\tif (url.length === 0) {\n\t\t\t\t\tctrl.statusLevel('none');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvalidatorHandler({\n\t\t\t\t\turl: url,\n\t\t\t\t\ttype: fileType\n\t\t\t\t}, function (result) {\n\t\t\t\t\tvar uiState = statusToUiState(result);\n\n\t\t\t\t\tctrl.statusMessage(uiState.message);\n\t\t\t\t\tctrl.statusLevel(uiState.status);\n\t\t\t\t});\n\t\t\t};\n\n\t\t\tctrl.state.on('change:value', function (e) {\n\t\t\t\tvalidateUrl(e.value);\n\t\t\t});\n\t\t}\n\t};\n\n\treturn ComboBox.extend({\n\t\t/**\n\t\t * Constructs a new control instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this, editor = tinymce.activeEditor, editorSettings = editor.settings;\n\t\t\tvar actionCallback, fileBrowserCallback, fileBrowserCallbackTypes;\n\t\t\tvar fileType = settings.filetype;\n\n\t\t\tsettings.spellcheck = false;\n\n\t\t\tfileBrowserCallbackTypes = editorSettings.file_picker_types || editorSettings.file_browser_callback_types;\n\t\t\tif (fileBrowserCallbackTypes) {\n\t\t\t\tfileBrowserCallbackTypes = Tools.makeMap(fileBrowserCallbackTypes, /[, ]/);\n\t\t\t}\n\n\t\t\tif (!fileBrowserCallbackTypes || fileBrowserCallbackTypes[fileType]) {\n\t\t\t\tfileBrowserCallback = editorSettings.file_picker_callback;\n\t\t\t\tif (fileBrowserCallback && (!fileBrowserCallbackTypes || fileBrowserCallbackTypes[fileType])) {\n\t\t\t\t\tactionCallback = function() {\n\t\t\t\t\t\tvar meta = self.fire('beforecall').meta;\n\n\t\t\t\t\t\tmeta = Tools.extend({filetype: fileType}, meta);\n\n\t\t\t\t\t\t// file_picker_callback(callback, currentValue, metaData)\n\t\t\t\t\t\tfileBrowserCallback.call(\n\t\t\t\t\t\t\teditor,\n\t\t\t\t\t\t\tfunction(value, meta) {\n\t\t\t\t\t\t\t\tself.value(value).fire('change', {meta: meta});\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tself.value(),\n\t\t\t\t\t\t\tmeta\n\t\t\t\t\t\t);\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\t// Legacy callback: file_picker_callback(id, currentValue, filetype, window)\n\t\t\t\t\tfileBrowserCallback = editorSettings.file_browser_callback;\n\t\t\t\t\tif (fileBrowserCallback && (!fileBrowserCallbackTypes || fileBrowserCallbackTypes[fileType])) {\n\t\t\t\t\t\tactionCallback = function() {\n\t\t\t\t\t\t\tfileBrowserCallback(\n\t\t\t\t\t\t\t\tself.getEl('inp').id,\n\t\t\t\t\t\t\t\tself.value(),\n\t\t\t\t\t\t\t\tfileType,\n\t\t\t\t\t\t\t\twindow\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (actionCallback) {\n\t\t\t\tsettings.icon = 'browse';\n\t\t\t\tsettings.onaction = actionCallback;\n\t\t\t}\n\n\t\t\tself._super(settings);\n\n\t\t\tsetupAutoCompleteHandler(self, editorSettings, editor.getBody(), fileType);\n\t\t\tsetupLinkValidatorHandler(self, editorSettings, fileType);\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/FitLayout.js\n\n/**\n * FitLayout.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This layout manager will resize the control to be the size of it's parent container.\n * In other words width: 100% and height: 100%.\n *\n * @-x-less FitLayout.less\n * @class tinymce.ui.FitLayout\n * @extends tinymce.ui.AbsoluteLayout\n */\ndefine(\"tinymce/ui/FitLayout\", [\n\t\"tinymce/ui/AbsoluteLayout\"\n], function(AbsoluteLayout) {\n\t\"use strict\";\n\n\treturn AbsoluteLayout.extend({\n\t\t/**\n\t\t * Recalculates the positions of the controls in the specified container.\n\t\t *\n\t\t * @method recalc\n\t\t * @param {tinymce.ui.Container} container Container instance to recalc.\n\t\t */\n\t\trecalc: function(container) {\n\t\t\tvar contLayoutRect = container.layoutRect(), paddingBox = container.paddingBox;\n\n\t\t\tcontainer.items().filter(':visible').each(function(ctrl) {\n\t\t\t\tctrl.layoutRect({\n\t\t\t\t\tx: paddingBox.left,\n\t\t\t\t\ty: paddingBox.top,\n\t\t\t\t\tw: contLayoutRect.innerW - paddingBox.right - paddingBox.left,\n\t\t\t\t\th: contLayoutRect.innerH - paddingBox.top - paddingBox.bottom\n\t\t\t\t});\n\n\t\t\t\tif (ctrl.recalc) {\n\t\t\t\t\tctrl.recalc();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/FlexLayout.js\n\n/**\n * FlexLayout.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This layout manager works similar to the CSS flex box.\n *\n * @setting {String} direction row|row-reverse|column|column-reverse\n * @setting {Number} flex A positive-number to flex by.\n * @setting {String} align start|end|center|stretch\n * @setting {String} pack start|end|justify\n *\n * @class tinymce.ui.FlexLayout\n * @extends tinymce.ui.AbsoluteLayout\n */\ndefine(\"tinymce/ui/FlexLayout\", [\n\t\"tinymce/ui/AbsoluteLayout\"\n], function(AbsoluteLayout) {\n\t\"use strict\";\n\n\treturn AbsoluteLayout.extend({\n\t\t/**\n\t\t * Recalculates the positions of the controls in the specified container.\n\t\t *\n\t\t * @method recalc\n\t\t * @param {tinymce.ui.Container} container Container instance to recalc.\n\t\t */\n\t\trecalc: function(container) {\n\t\t\t// A ton of variables, needs to be in the same scope for performance\n\t\t\tvar i, l, items, contLayoutRect, contPaddingBox, contSettings, align, pack, spacing, totalFlex, availableSpace, direction;\n\t\t\tvar ctrl, ctrlLayoutRect, ctrlSettings, flex, maxSizeItems = [], size, maxSize, ratio, rect, pos, maxAlignEndPos;\n\t\t\tvar sizeName, minSizeName, posName, maxSizeName, beforeName, innerSizeName, deltaSizeName, contentSizeName;\n\t\t\tvar alignAxisName, alignInnerSizeName, alignSizeName, alignMinSizeName, alignBeforeName, alignAfterName;\n\t\t\tvar alignDeltaSizeName, alignContentSizeName;\n\t\t\tvar max = Math.max, min = Math.min;\n\n\t\t\t// Get container items, properties and settings\n\t\t\titems = container.items().filter(':visible');\n\t\t\tcontLayoutRect = container.layoutRect();\n\t\t\tcontPaddingBox = container.paddingBox;\n\t\t\tcontSettings = container.settings;\n\t\t\tdirection = container.isRtl() ? (contSettings.direction || 'row-reversed') : contSettings.direction;\n\t\t\talign = contSettings.align;\n\t\t\tpack = container.isRtl() ? (contSettings.pack || 'end') : contSettings.pack;\n\t\t\tspacing = contSettings.spacing || 0;\n\n\t\t\tif (direction == \"row-reversed\" || direction == \"column-reverse\") {\n\t\t\t\titems = items.set(items.toArray().reverse());\n\t\t\t\tdirection = direction.split('-')[0];\n\t\t\t}\n\n\t\t\t// Setup axis variable name for row/column direction since the calculations is the same\n\t\t\tif (direction == \"column\") {\n\t\t\t\tposName = \"y\";\n\t\t\t\tsizeName = \"h\";\n\t\t\t\tminSizeName = \"minH\";\n\t\t\t\tmaxSizeName = \"maxH\";\n\t\t\t\tinnerSizeName = \"innerH\";\n\t\t\t\tbeforeName = 'top';\n\t\t\t\tdeltaSizeName = \"deltaH\";\n\t\t\t\tcontentSizeName = \"contentH\";\n\n\t\t\t\talignBeforeName = \"left\";\n\t\t\t\talignSizeName = \"w\";\n\t\t\t\talignAxisName = \"x\";\n\t\t\t\talignInnerSizeName = \"innerW\";\n\t\t\t\talignMinSizeName = \"minW\";\n\t\t\t\talignAfterName = \"right\";\n\t\t\t\talignDeltaSizeName = \"deltaW\";\n\t\t\t\talignContentSizeName = \"contentW\";\n\t\t\t} else {\n\t\t\t\tposName = \"x\";\n\t\t\t\tsizeName = \"w\";\n\t\t\t\tminSizeName = \"minW\";\n\t\t\t\tmaxSizeName = \"maxW\";\n\t\t\t\tinnerSizeName = \"innerW\";\n\t\t\t\tbeforeName = 'left';\n\t\t\t\tdeltaSizeName = \"deltaW\";\n\t\t\t\tcontentSizeName = \"contentW\";\n\n\t\t\t\talignBeforeName = \"top\";\n\t\t\t\talignSizeName = \"h\";\n\t\t\t\talignAxisName = \"y\";\n\t\t\t\talignInnerSizeName = \"innerH\";\n\t\t\t\talignMinSizeName = \"minH\";\n\t\t\t\talignAfterName = \"bottom\";\n\t\t\t\talignDeltaSizeName = \"deltaH\";\n\t\t\t\talignContentSizeName = \"contentH\";\n\t\t\t}\n\n\t\t\t// Figure out total flex, availableSpace and collect any max size elements\n\t\t\tavailableSpace = contLayoutRect[innerSizeName] - contPaddingBox[beforeName] - contPaddingBox[beforeName];\n\t\t\tmaxAlignEndPos = totalFlex = 0;\n\t\t\tfor (i = 0, l = items.length; i < l; i++) {\n\t\t\t\tctrl = items[i];\n\t\t\t\tctrlLayoutRect = ctrl.layoutRect();\n\t\t\t\tctrlSettings = ctrl.settings;\n\t\t\t\tflex = ctrlSettings.flex;\n\t\t\t\tavailableSpace -= (i < l - 1 ? spacing : 0);\n\n\t\t\t\tif (flex > 0) {\n\t\t\t\t\ttotalFlex += flex;\n\n\t\t\t\t\t// Flexed item has a max size then we need to check if we will hit that size\n\t\t\t\t\tif (ctrlLayoutRect[maxSizeName]) {\n\t\t\t\t\t\tmaxSizeItems.push(ctrl);\n\t\t\t\t\t}\n\n\t\t\t\t\tctrlLayoutRect.flex = flex;\n\t\t\t\t}\n\n\t\t\t\tavailableSpace -= ctrlLayoutRect[minSizeName];\n\n\t\t\t\t// Calculate the align end position to be used to check for overflow/underflow\n\t\t\t\tsize = contPaddingBox[alignBeforeName] + ctrlLayoutRect[alignMinSizeName] + contPaddingBox[alignAfterName];\n\t\t\t\tif (size > maxAlignEndPos) {\n\t\t\t\t\tmaxAlignEndPos = size;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Calculate minW/minH\n\t\t\trect = {};\n\t\t\tif (availableSpace < 0) {\n\t\t\t\trect[minSizeName] = contLayoutRect[minSizeName] - availableSpace + contLayoutRect[deltaSizeName];\n\t\t\t} else {\n\t\t\t\trect[minSizeName] = contLayoutRect[innerSizeName] - availableSpace + contLayoutRect[deltaSizeName];\n\t\t\t}\n\n\t\t\trect[alignMinSizeName] = maxAlignEndPos + contLayoutRect[alignDeltaSizeName];\n\n\t\t\trect[contentSizeName] = contLayoutRect[innerSizeName] - availableSpace;\n\t\t\trect[alignContentSizeName] = maxAlignEndPos;\n\t\t\trect.minW = min(rect.minW, contLayoutRect.maxW);\n\t\t\trect.minH = min(rect.minH, contLayoutRect.maxH);\n\t\t\trect.minW = max(rect.minW, contLayoutRect.startMinWidth);\n\t\t\trect.minH = max(rect.minH, contLayoutRect.startMinHeight);\n\n\t\t\t// Resize container container if minSize was changed\n\t\t\tif (contLayoutRect.autoResize && (rect.minW != contLayoutRect.minW || rect.minH != contLayoutRect.minH)) {\n\t\t\t\trect.w = rect.minW;\n\t\t\t\trect.h = rect.minH;\n\n\t\t\t\tcontainer.layoutRect(rect);\n\t\t\t\tthis.recalc(container);\n\n\t\t\t\t// Forced recalc for example if items are hidden/shown\n\t\t\t\tif (container._lastRect === null) {\n\t\t\t\t\tvar parentCtrl = container.parent();\n\t\t\t\t\tif (parentCtrl) {\n\t\t\t\t\t\tparentCtrl._lastRect = null;\n\t\t\t\t\t\tparentCtrl.recalc();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Handle max size elements, check if they will become to wide with current options\n\t\t\tratio = availableSpace / totalFlex;\n\t\t\tfor (i = 0, l = maxSizeItems.length; i < l; i++) {\n\t\t\t\tctrl = maxSizeItems[i];\n\t\t\t\tctrlLayoutRect = ctrl.layoutRect();\n\t\t\t\tmaxSize = ctrlLayoutRect[maxSizeName];\n\t\t\t\tsize = ctrlLayoutRect[minSizeName] + ctrlLayoutRect.flex * ratio;\n\n\t\t\t\tif (size > maxSize) {\n\t\t\t\t\tavailableSpace -= (ctrlLayoutRect[maxSizeName] - ctrlLayoutRect[minSizeName]);\n\t\t\t\t\ttotalFlex -= ctrlLayoutRect.flex;\n\t\t\t\t\tctrlLayoutRect.flex = 0;\n\t\t\t\t\tctrlLayoutRect.maxFlexSize = maxSize;\n\t\t\t\t} else {\n\t\t\t\t\tctrlLayoutRect.maxFlexSize = 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Setup new ratio, target layout rect, start position\n\t\t\tratio = availableSpace / totalFlex;\n\t\t\tpos = contPaddingBox[beforeName];\n\t\t\trect = {};\n\n\t\t\t// Handle pack setting moves the start position to end, center\n\t\t\tif (totalFlex === 0) {\n\t\t\t\tif (pack == \"end\") {\n\t\t\t\t\tpos = availableSpace + contPaddingBox[beforeName];\n\t\t\t\t} else if (pack == \"center\") {\n\t\t\t\t\tpos = Math.round(\n\t\t\t\t\t\t(contLayoutRect[innerSizeName] / 2) - ((contLayoutRect[innerSizeName] - availableSpace) / 2)\n\t\t\t\t\t) + contPaddingBox[beforeName];\n\n\t\t\t\t\tif (pos < 0) {\n\t\t\t\t\t\tpos = contPaddingBox[beforeName];\n\t\t\t\t\t}\n\t\t\t\t} else if (pack == \"justify\") {\n\t\t\t\t\tpos = contPaddingBox[beforeName];\n\t\t\t\t\tspacing = Math.floor(availableSpace / (items.length - 1));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Default aligning (start) the other ones needs to be calculated while doing the layout\n\t\t\trect[alignAxisName] = contPaddingBox[alignBeforeName];\n\n\t\t\t// Start laying out controls\n\t\t\tfor (i = 0, l = items.length; i < l; i++) {\n\t\t\t\tctrl = items[i];\n\t\t\t\tctrlLayoutRect = ctrl.layoutRect();\n\t\t\t\tsize = ctrlLayoutRect.maxFlexSize || ctrlLayoutRect[minSizeName];\n\n\t\t\t\t// Align the control on the other axis\n\t\t\t\tif (align === \"center\") {\n\t\t\t\t\trect[alignAxisName] = Math.round((contLayoutRect[alignInnerSizeName] / 2) - (ctrlLayoutRect[alignSizeName] / 2));\n\t\t\t\t} else if (align === \"stretch\") {\n\t\t\t\t\trect[alignSizeName] = max(\n\t\t\t\t\t\tctrlLayoutRect[alignMinSizeName] || 0,\n\t\t\t\t\t\tcontLayoutRect[alignInnerSizeName] - contPaddingBox[alignBeforeName] - contPaddingBox[alignAfterName]\n\t\t\t\t\t);\n\t\t\t\t\trect[alignAxisName] = contPaddingBox[alignBeforeName];\n\t\t\t\t} else if (align === \"end\") {\n\t\t\t\t\trect[alignAxisName] = contLayoutRect[alignInnerSizeName] - ctrlLayoutRect[alignSizeName] - contPaddingBox.top;\n\t\t\t\t}\n\n\t\t\t\t// Calculate new size based on flex\n\t\t\t\tif (ctrlLayoutRect.flex > 0) {\n\t\t\t\t\tsize += ctrlLayoutRect.flex * ratio;\n\t\t\t\t}\n\n\t\t\t\trect[sizeName] = size;\n\t\t\t\trect[posName] = pos;\n\t\t\t\tctrl.layoutRect(rect);\n\n\t\t\t\t// Recalculate containers\n\t\t\t\tif (ctrl.recalc) {\n\t\t\t\t\tctrl.recalc();\n\t\t\t\t}\n\n\t\t\t\t// Move x/y position\n\t\t\t\tpos += size + spacing;\n\t\t\t}\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/FlowLayout.js\n\n/**\n * FlowLayout.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This layout manager will place the controls by using the browsers native layout.\n *\n * @-x-less FlowLayout.less\n * @class tinymce.ui.FlowLayout\n * @extends tinymce.ui.Layout\n */\ndefine(\"tinymce/ui/FlowLayout\", [\n\t\"tinymce/ui/Layout\"\n], function(Layout) {\n\treturn Layout.extend({\n\t\tDefaults: {\n\t\t\tcontainerClass: 'flow-layout',\n\t\t\tcontrolClass: 'flow-layout-item',\n\t\t\tendClass: 'break'\n\t\t},\n\n\t\t/**\n\t\t * Recalculates the positions of the controls in the specified container.\n\t\t *\n\t\t * @method recalc\n\t\t * @param {tinymce.ui.Container} container Container instance to recalc.\n\t\t */\n\t\trecalc: function(container) {\n\t\t\tcontainer.items().filter(':visible').each(function(ctrl) {\n\t\t\t\tif (ctrl.recalc) {\n\t\t\t\t\tctrl.recalc();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\tisNative: function() {\n\t\t\treturn true;\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/FormatControls.js\n\n/**\n * FormatControls.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Internal class containing all TinyMCE specific control types such as\n * format listboxes, fontlist boxes, toolbar buttons etc.\n *\n * @class tinymce.ui.FormatControls\n */\ndefine(\"tinymce/ui/FormatControls\", [\n\t\"tinymce/ui/Control\",\n\t\"tinymce/ui/Widget\",\n\t\"tinymce/ui/FloatPanel\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/util/Arr\",\n\t\"tinymce/dom/DOMUtils\",\n\t\"tinymce/EditorManager\",\n\t\"tinymce/Env\"\n], function(Control, Widget, FloatPanel, Tools, Arr, DOMUtils, EditorManager, Env) {\n\tvar each = Tools.each;\n\n\tvar flatten = function (ar) {\n\t\treturn Arr.reduce(ar, function (result, item) {\n\t\t\treturn result.concat(item);\n\t\t}, []);\n\t};\n\n\tEditorManager.on('AddEditor', function(e) {\n\t\tvar editor = e.editor;\n\n\t\tsetupRtlMode(editor);\n\t\tregisterControls(editor);\n\t\tsetupContainer(editor);\n\t});\n\n\tControl.translate = function(text) {\n\t\treturn EditorManager.translate(text);\n\t};\n\n\tWidget.tooltips = !Env.iOS;\n\n\tfunction setupContainer(editor) {\n\t\tif (editor.settings.ui_container) {\n\t\t\tEnv.container = DOMUtils.DOM.select(editor.settings.ui_container)[0];\n\t\t}\n\t}\n\n\tfunction setupRtlMode(editor) {\n\t\teditor.on('ScriptsLoaded', function () {\n\t\t\tif (editor.rtl) {\n\t\t\t\tControl.rtl = true;\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction registerControls(editor) {\n\t\tvar formatMenu;\n\n\t\tfunction createListBoxChangeHandler(items, formatName) {\n\t\t\treturn function() {\n\t\t\t\tvar self = this;\n\n\t\t\t\teditor.on('nodeChange', function(e) {\n\t\t\t\t\tvar formatter = editor.formatter;\n\t\t\t\t\tvar value = null;\n\n\t\t\t\t\teach(e.parents, function(node) {\n\t\t\t\t\t\teach(items, function(item) {\n\t\t\t\t\t\t\tif (formatName) {\n\t\t\t\t\t\t\t\tif (formatter.matchNode(node, formatName, {value: item.value})) {\n\t\t\t\t\t\t\t\t\tvalue = item.value;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (formatter.matchNode(node, item.value)) {\n\t\t\t\t\t\t\t\t\tvalue = item.value;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (value) {\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif (value) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tself.value(value);\n\t\t\t\t});\n\t\t\t};\n\t\t}\n\n\t\tfunction createFormats(formats) {\n\t\t\tformats = formats.replace(/;$/, '').split(';');\n\n\t\t\tvar i = formats.length;\n\t\t\twhile (i--) {\n\t\t\t\tformats[i] = formats[i].split('=');\n\t\t\t}\n\n\t\t\treturn formats;\n\t\t}\n\n\t\tfunction createFormatMenu() {\n\t\t\tvar count = 0, newFormats = [];\n\n\t\t\tvar defaultStyleFormats = [\n\t\t\t\t{title: 'Headings', items: [\n\t\t\t\t\t{title: 'Heading 1', format: 'h1'},\n\t\t\t\t\t{title: 'Heading 2', format: 'h2'},\n\t\t\t\t\t{title: 'Heading 3', format: 'h3'},\n\t\t\t\t\t{title: 'Heading 4', format: 'h4'},\n\t\t\t\t\t{title: 'Heading 5', format: 'h5'},\n\t\t\t\t\t{title: 'Heading 6', format: 'h6'}\n\t\t\t\t]},\n\n\t\t\t\t{title: 'Inline', items: [\n\t\t\t\t\t{title: 'Bold', icon: 'bold', format: 'bold'},\n\t\t\t\t\t{title: 'Italic', icon: 'italic', format: 'italic'},\n\t\t\t\t\t{title: 'Underline', icon: 'underline', format: 'underline'},\n\t\t\t\t\t{title: 'Strikethrough', icon: 'strikethrough', format: 'strikethrough'},\n\t\t\t\t\t{title: 'Superscript', icon: 'superscript', format: 'superscript'},\n\t\t\t\t\t{title: 'Subscript', icon: 'subscript', format: 'subscript'},\n\t\t\t\t\t{title: 'Code', icon: 'code', format: 'code'}\n\t\t\t\t]},\n\n\t\t\t\t{title: 'Blocks', items: [\n\t\t\t\t\t{title: 'Paragraph', format: 'p'},\n\t\t\t\t\t{title: 'Blockquote', format: 'blockquote'},\n\t\t\t\t\t{title: 'Div', format: 'div'},\n\t\t\t\t\t{title: 'Pre', format: 'pre'}\n\t\t\t\t]},\n\n\t\t\t\t{title: 'Alignment', items: [\n\t\t\t\t\t{title: 'Left', icon: 'alignleft', format: 'alignleft'},\n\t\t\t\t\t{title: 'Center', icon: 'aligncenter', format: 'aligncenter'},\n\t\t\t\t\t{title: 'Right', icon: 'alignright', format: 'alignright'},\n\t\t\t\t\t{title: 'Justify', icon: 'alignjustify', format: 'alignjustify'}\n\t\t\t\t]}\n\t\t\t];\n\n\t\t\tfunction createMenu(formats) {\n\t\t\t\tvar menu = [];\n\n\t\t\t\tif (!formats) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\teach(formats, function(format) {\n\t\t\t\t\tvar menuItem = {\n\t\t\t\t\t\ttext: format.title,\n\t\t\t\t\t\ticon: format.icon\n\t\t\t\t\t};\n\n\t\t\t\t\tif (format.items) {\n\t\t\t\t\t\tmenuItem.menu = createMenu(format.items);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar formatName = format.format || \"custom\" + count++;\n\n\t\t\t\t\t\tif (!format.format) {\n\t\t\t\t\t\t\tformat.name = formatName;\n\t\t\t\t\t\t\tnewFormats.push(format);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tmenuItem.format = formatName;\n\t\t\t\t\t\tmenuItem.cmd = format.cmd;\n\t\t\t\t\t}\n\n\t\t\t\t\tmenu.push(menuItem);\n\t\t\t\t});\n\n\t\t\t\treturn menu;\n\t\t\t}\n\n\t\t\tfunction createStylesMenu() {\n\t\t\t\tvar menu;\n\n\t\t\t\tif (editor.settings.style_formats_merge) {\n\t\t\t\t\tif (editor.settings.style_formats) {\n\t\t\t\t\t\tmenu = createMenu(defaultStyleFormats.concat(editor.settings.style_formats));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tmenu = createMenu(defaultStyleFormats);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tmenu = createMenu(editor.settings.style_formats || defaultStyleFormats);\n\t\t\t\t}\n\n\t\t\t\treturn menu;\n\t\t\t}\n\n\t\t\teditor.on('init', function() {\n\t\t\t\teach(newFormats, function(format) {\n\t\t\t\t\teditor.formatter.register(format.name, format);\n\t\t\t\t});\n\t\t\t});\n\n\t\t\treturn {\n\t\t\t\ttype: 'menu',\n\t\t\t\titems: createStylesMenu(),\n\t\t\t\tonPostRender: function(e) {\n\t\t\t\t\teditor.fire('renderFormatsMenu', {control: e.control});\n\t\t\t\t},\n\t\t\t\titemDefaults: {\n\t\t\t\t\tpreview: true,\n\n\t\t\t\t\ttextStyle: function() {\n\t\t\t\t\t\tif (this.settings.format) {\n\t\t\t\t\t\t\treturn editor.formatter.getCssText(this.settings.format);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\n\t\t\t\t\tonPostRender: function() {\n\t\t\t\t\t\tvar self = this;\n\n\t\t\t\t\t\tself.parent().on('show', function() {\n\t\t\t\t\t\t\tvar formatName, command;\n\n\t\t\t\t\t\t\tformatName = self.settings.format;\n\t\t\t\t\t\t\tif (formatName) {\n\t\t\t\t\t\t\t\tself.disabled(!editor.formatter.canApply(formatName));\n\t\t\t\t\t\t\t\tself.active(editor.formatter.match(formatName));\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tcommand = self.settings.cmd;\n\t\t\t\t\t\t\tif (command) {\n\t\t\t\t\t\t\t\tself.active(editor.queryCommandState(command));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\n\t\t\t\t\tonclick: function() {\n\t\t\t\t\t\tif (this.settings.format) {\n\t\t\t\t\t\t\ttoggleFormat(this.settings.format);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this.settings.cmd) {\n\t\t\t\t\t\t\teditor.execCommand(this.settings.cmd);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\tformatMenu = createFormatMenu();\n\n\t\tfunction initOnPostRender(name) {\n\t\t\treturn function() {\n\t\t\t\tvar self = this;\n\n\t\t\t\t// TODO: Fix this\n\t\t\t\tif (editor.formatter) {\n\t\t\t\t\teditor.formatter.formatChanged(name, function(state) {\n\t\t\t\t\t\tself.active(state);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\teditor.on('init', function() {\n\t\t\t\t\t\teditor.formatter.formatChanged(name, function(state) {\n\t\t\t\t\t\t\tself.active(state);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\t// Simple format controls <control/format>:<UI text>\n\t\teach({\n\t\t\tbold: 'Bold',\n\t\t\titalic: 'Italic',\n\t\t\tunderline: 'Underline',\n\t\t\tstrikethrough: 'Strikethrough',\n\t\t\tsubscript: 'Subscript',\n\t\t\tsuperscript: 'Superscript'\n\t\t}, function(text, name) {\n\t\t\teditor.addButton(name, {\n\t\t\t\ttooltip: text,\n\t\t\t\tonPostRender: initOnPostRender(name),\n\t\t\t\tonclick: function() {\n\t\t\t\t\ttoggleFormat(name);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\t// Simple command controls <control>:[<UI text>,<Command>]\n\t\teach({\n\t\t\toutdent: ['Decrease indent', 'Outdent'],\n\t\t\tindent: ['Increase indent', 'Indent'],\n\t\t\tcut: ['Cut', 'Cut'],\n\t\t\tcopy: ['Copy', 'Copy'],\n\t\t\tpaste: ['Paste', 'Paste'],\n\t\t\thelp: ['Help', 'mceHelp'],\n\t\t\tselectall: ['Select all', 'SelectAll'],\n\t\t\tremoveformat: ['Clear formatting', 'RemoveFormat'],\n\t\t\tvisualaid: ['Visual aids', 'mceToggleVisualAid'],\n\t\t\tnewdocument: ['New document', 'mceNewDocument']\n\t\t}, function(item, name) {\n\t\t\teditor.addButton(name, {\n\t\t\t\ttooltip: item[0],\n\t\t\t\tcmd: item[1]\n\t\t\t});\n\t\t});\n\n\t\t// Simple command controls with format state\n\t\teach({\n\t\t\tblockquote: ['Blockquote', 'mceBlockQuote'],\n\t\t\tsubscript: ['Subscript', 'Subscript'],\n\t\t\tsuperscript: ['Superscript', 'Superscript'],\n\t\t\talignleft: ['Align left', 'JustifyLeft'],\n\t\t\taligncenter: ['Align center', 'JustifyCenter'],\n\t\t\talignright: ['Align right', 'JustifyRight'],\n\t\t\talignjustify: ['Justify', 'JustifyFull'],\n\t\t\talignnone: ['No alignment', 'JustifyNone']\n\t\t}, function(item, name) {\n\t\t\teditor.addButton(name, {\n\t\t\t\ttooltip: item[0],\n\t\t\t\tcmd: item[1],\n\t\t\t\tonPostRender: initOnPostRender(name)\n\t\t\t});\n\t\t});\n\n\t\tfunction toggleUndoRedoState(type) {\n\t\t\treturn function() {\n\t\t\t\tvar self = this;\n\n\t\t\t\ttype = type == 'redo' ? 'hasRedo' : 'hasUndo';\n\n\t\t\t\tfunction checkState() {\n\t\t\t\t\treturn editor.undoManager ? editor.undoManager[type]() : false;\n\t\t\t\t}\n\n\t\t\t\tself.disabled(!checkState());\n\t\t\t\teditor.on('Undo Redo AddUndo TypingUndo ClearUndos SwitchMode', function() {\n\t\t\t\t\tself.disabled(editor.readonly || !checkState());\n\t\t\t\t});\n\t\t\t};\n\t\t}\n\n\t\tfunction toggleVisualAidState() {\n\t\t\tvar self = this;\n\n\t\t\teditor.on('VisualAid', function(e) {\n\t\t\t\tself.active(e.hasVisual);\n\t\t\t});\n\n\t\t\tself.active(editor.hasVisual);\n\t\t}\n\n\t\tvar trimMenuItems = function (menuItems) {\n\t\t\tvar outputMenuItems = menuItems;\n\n\t\t\tif (outputMenuItems.length > 0 && outputMenuItems[0].text === '-') {\n\t\t\t\toutputMenuItems = outputMenuItems.slice(1);\n\t\t\t}\n\n\t\t\tif (outputMenuItems.length > 0 && outputMenuItems[outputMenuItems.length - 1].text === '-') {\n\t\t\t\toutputMenuItems = outputMenuItems.slice(0, outputMenuItems.length - 1);\n\t\t\t}\n\n\t\t\treturn outputMenuItems;\n\t\t};\n\n\t\tvar createCustomMenuItems = function (names) {\n\t\t\tvar items, nameList;\n\n\t\t\tif (typeof names === 'string') {\n\t\t\t\tnameList = names.split(' ');\n\t\t\t} else if (Tools.isArray(names)) {\n\t\t\t\treturn flatten(Tools.map(names, createCustomMenuItems));\n\t\t\t}\n\n\t\t\titems = Tools.grep(nameList, function (name) {\n\t\t\t\treturn name === '|' || name in editor.menuItems;\n\t\t\t});\n\n\t\t\treturn Tools.map(items, function (name) {\n\t\t\t\treturn name === '|' ? {text: '-'} : editor.menuItems[name];\n\t\t\t});\n\t\t};\n\n\t\tvar createContextMenuItems = function (context) {\n\t\t\tvar outputMenuItems = [{text: '-'}];\n\t\t\tvar menuItems = Tools.grep(editor.menuItems, function (menuItem) {\n\t\t\t\treturn menuItem.context === context;\n\t\t\t});\n\n\t\t\tTools.each(menuItems, function (menuItem) {\n\t\t\t\tif (menuItem.separator == 'before') {\n\t\t\t\t\toutputMenuItems.push({text: '|'});\n\t\t\t\t}\n\n\t\t\t\tif (menuItem.prependToContext) {\n\t\t\t\t\toutputMenuItems.unshift(menuItem);\n\t\t\t\t} else {\n\t\t\t\t\toutputMenuItems.push(menuItem);\n\t\t\t\t}\n\n\t\t\t\tif (menuItem.separator == 'after') {\n\t\t\t\t\toutputMenuItems.push({text: '|'});\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn outputMenuItems;\n\t\t};\n\n\t\tvar createInsertMenu = function (editorSettings) {\n\t\t\tif (editorSettings.insert_button_items) {\n\t\t\t\treturn trimMenuItems(createCustomMenuItems(editorSettings.insert_button_items));\n\t\t\t} else {\n\t\t\t\treturn trimMenuItems(createContextMenuItems('insert'));\n\t\t\t}\n\t\t};\n\n\t\teditor.addButton('undo', {\n\t\t\ttooltip: 'Undo',\n\t\t\tonPostRender: toggleUndoRedoState('undo'),\n\t\t\tcmd: 'undo'\n\t\t});\n\n\t\teditor.addButton('redo', {\n\t\t\ttooltip: 'Redo',\n\t\t\tonPostRender: toggleUndoRedoState('redo'),\n\t\t\tcmd: 'redo'\n\t\t});\n\n\t\teditor.addMenuItem('newdocument', {\n\t\t\ttext: 'New document',\n\t\t\ticon: 'newdocument',\n\t\t\tcmd: 'mceNewDocument'\n\t\t});\n\n\t\teditor.addMenuItem('undo', {\n\t\t\ttext: 'Undo',\n\t\t\ticon: 'undo',\n\t\t\tshortcut: 'Meta+Z',\n\t\t\tonPostRender: toggleUndoRedoState('undo'),\n\t\t\tcmd: 'undo'\n\t\t});\n\n\t\teditor.addMenuItem('redo', {\n\t\t\ttext: 'Redo',\n\t\t\ticon: 'redo',\n\t\t\tshortcut: 'Meta+Y',\n\t\t\tonPostRender: toggleUndoRedoState('redo'),\n\t\t\tcmd: 'redo'\n\t\t});\n\n\t\teditor.addMenuItem('visualaid', {\n\t\t\ttext: 'Visual aids',\n\t\t\tselectable: true,\n\t\t\tonPostRender: toggleVisualAidState,\n\t\t\tcmd: 'mceToggleVisualAid'\n\t\t});\n\n\t\teditor.addButton('remove', {\n\t\t\ttooltip: 'Remove',\n\t\t\ticon: 'remove',\n\t\t\tcmd: 'Delete'\n\t\t});\n\n\t\teditor.addButton('insert', {\n\t\t\ttype: 'menubutton',\n\t\t\ticon: 'insert',\n\t\t\tmenu: [],\n\t\t\toncreatemenu: function () {\n\t\t\t\tthis.menu.add(createInsertMenu(editor.settings));\n\t\t\t\tthis.menu.renderNew();\n\t\t\t}\n\t\t});\n\n\t\teach({\n\t\t\tcut: ['Cut', 'Cut', 'Meta+X'],\n\t\t\tcopy: ['Copy', 'Copy', 'Meta+C'],\n\t\t\tpaste: ['Paste', 'Paste', 'Meta+V'],\n\t\t\tselectall: ['Select all', 'SelectAll', 'Meta+A'],\n\t\t\tbold: ['Bold', 'Bold', 'Meta+B'],\n\t\t\titalic: ['Italic', 'Italic', 'Meta+I'],\n\t\t\tunderline: ['Underline', 'Underline'],\n\t\t\tstrikethrough: ['Strikethrough', 'Strikethrough'],\n\t\t\tsubscript: ['Subscript', 'Subscript'],\n\t\t\tsuperscript: ['Superscript', 'Superscript'],\n\t\t\tremoveformat: ['Clear formatting', 'RemoveFormat']\n\t\t}, function(item, name) {\n\t\t\teditor.addMenuItem(name, {\n\t\t\t\ttext: item[0],\n\t\t\t\ticon: name,\n\t\t\t\tshortcut: item[2],\n\t\t\t\tcmd: item[1]\n\t\t\t});\n\t\t});\n\n\t\teditor.on('mousedown', function() {\n\t\t\tFloatPanel.hideAll();\n\t\t});\n\n\t\tfunction toggleFormat(fmt) {\n\t\t\tif (fmt.control) {\n\t\t\t\tfmt = fmt.control.value();\n\t\t\t}\n\n\t\t\tif (fmt) {\n\t\t\t\teditor.execCommand('mceToggleFormat', false, fmt);\n\t\t\t}\n\t\t}\n\n\t\tfunction hideMenuObjects(menu) {\n\t\t\tvar count = menu.length;\n\n\t\t\tTools.each(menu, function (item) {\n\t\t\t\tif (item.menu) {\n\t\t\t\t\titem.hidden = hideMenuObjects(item.menu) === 0;\n\t\t\t\t}\n\n\t\t\t\tvar formatName = item.format;\n\t\t\t\tif (formatName) {\n\t\t\t\t\titem.hidden = !editor.formatter.canApply(formatName);\n\t\t\t\t}\n\n\t\t\t\tif (item.hidden) {\n\t\t\t\t\tcount--;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn count;\n\t\t}\n\n\t\tfunction hideFormatMenuItems(menu) {\n\t\t\tvar count = menu.items().length;\n\n\t\t\tmenu.items().each(function (item) {\n\t\t\t\tif (item.menu) {\n\t\t\t\t\titem.visible(hideFormatMenuItems(item.menu) > 0);\n\t\t\t\t}\n\n\t\t\t\tif (!item.menu && item.settings.menu) {\n\t\t\t\t\titem.visible(hideMenuObjects(item.settings.menu) > 0);\n\t\t\t\t}\n\n\t\t\t\tvar formatName = item.settings.format;\n\t\t\t\tif (formatName) {\n\t\t\t\t\titem.visible(editor.formatter.canApply(formatName));\n\t\t\t\t}\n\n\t\t\t\tif (!item.visible()) {\n\t\t\t\t\tcount--;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn count;\n\t\t}\n\n\t\teditor.addButton('styleselect', {\n\t\t\ttype: 'menubutton',\n\t\t\ttext: 'Formats',\n\t\t\tmenu: formatMenu,\n\t\t\tonShowMenu: function () {\n\t\t\t\tif (editor.settings.style_formats_autohide) {\n\t\t\t\t\thideFormatMenuItems(this.menu);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\teditor.addButton('formatselect', function() {\n\t\t\tvar items = [], blocks = createFormats(editor.settings.block_formats ||\n\t\t\t\t'Paragraph=p;' +\n\t\t\t\t'Heading 1=h1;' +\n\t\t\t\t'Heading 2=h2;' +\n\t\t\t\t'Heading 3=h3;' +\n\t\t\t\t'Heading 4=h4;' +\n\t\t\t\t'Heading 5=h5;' +\n\t\t\t\t'Heading 6=h6;' +\n\t\t\t\t'Preformatted=pre'\n\t\t\t);\n\n\t\t\teach(blocks, function(block) {\n\t\t\t\titems.push({\n\t\t\t\t\ttext: block[0],\n\t\t\t\t\tvalue: block[1],\n\t\t\t\t\ttextStyle: function() {\n\t\t\t\t\t\treturn editor.formatter.getCssText(block[1]);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\treturn {\n\t\t\t\ttype: 'listbox',\n\t\t\t\ttext: blocks[0][0],\n\t\t\t\tvalues: items,\n\t\t\t\tfixedWidth: true,\n\t\t\t\tonselect: toggleFormat,\n\t\t\t\tonPostRender: createListBoxChangeHandler(items)\n\t\t\t};\n\t\t});\n\n\t\teditor.addButton('fontselect', function() {\n\t\t\tvar defaultFontsFormats =\n\t\t\t\t'Andale Mono=andale mono,monospace;' +\n\t\t\t\t'Arial=arial,helvetica,sans-serif;' +\n\t\t\t\t'Arial Black=arial black,sans-serif;' +\n\t\t\t\t'Book Antiqua=book antiqua,palatino,serif;' +\n\t\t\t\t'Comic Sans MS=comic sans ms,sans-serif;' +\n\t\t\t\t'Courier New=courier new,courier,monospace;' +\n\t\t\t\t'Georgia=georgia,palatino,serif;' +\n\t\t\t\t'Helvetica=helvetica,arial,sans-serif;' +\n\t\t\t\t'Impact=impact,sans-serif;' +\n\t\t\t\t'Symbol=symbol;' +\n\t\t\t\t'Tahoma=tahoma,arial,helvetica,sans-serif;' +\n\t\t\t\t'Terminal=terminal,monaco,monospace;' +\n\t\t\t\t'Times New Roman=times new roman,times,serif;' +\n\t\t\t\t'Trebuchet MS=trebuchet ms,geneva,sans-serif;' +\n\t\t\t\t'Verdana=verdana,geneva,sans-serif;' +\n\t\t\t\t'Webdings=webdings;' +\n\t\t\t\t'Wingdings=wingdings,zapf dingbats';\n\n\t\t\tvar items = [], fonts = createFormats(editor.settings.font_formats || defaultFontsFormats);\n\n\t\t\teach(fonts, function(font) {\n\t\t\t\titems.push({\n\t\t\t\t\ttext: {raw: font[0]},\n\t\t\t\t\tvalue: font[1],\n\t\t\t\t\ttextStyle: font[1].indexOf('dings') == -1 ? 'font-family:' + font[1] : ''\n\t\t\t\t});\n\t\t\t});\n\n\t\t\treturn {\n\t\t\t\ttype: 'listbox',\n\t\t\t\ttext: 'Font Family',\n\t\t\t\ttooltip: 'Font Family',\n\t\t\t\tvalues: items,\n\t\t\t\tfixedWidth: true,\n\t\t\t\tonPostRender: createListBoxChangeHandler(items, 'fontname'),\n\t\t\t\tonselect: function(e) {\n\t\t\t\t\tif (e.control.settings.value) {\n\t\t\t\t\t\teditor.execCommand('FontName', false, e.control.settings.value);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t});\n\n\t\teditor.addButton('fontsizeselect', function() {\n\t\t\tvar items = [], defaultFontsizeFormats = '8pt 10pt 12pt 14pt 18pt 24pt 36pt';\n\t\t\tvar fontsize_formats = editor.settings.fontsize_formats || defaultFontsizeFormats;\n\n\t\t\teach(fontsize_formats.split(' '), function(item) {\n\t\t\t\tvar text = item, value = item;\n\t\t\t\t// Allow text=value font sizes.\n\t\t\t\tvar values = item.split('=');\n\t\t\t\tif (values.length > 1) {\n\t\t\t\t\ttext = values[0];\n\t\t\t\t\tvalue = values[1];\n\t\t\t\t}\n\t\t\t\titems.push({text: text, value: value});\n\t\t\t});\n\n\t\t\treturn {\n\t\t\t\ttype: 'listbox',\n\t\t\t\ttext: 'Font Sizes',\n\t\t\t\ttooltip: 'Font Sizes',\n\t\t\t\tvalues: items,\n\t\t\t\tfixedWidth: true,\n\t\t\t\tonPostRender: createListBoxChangeHandler(items, 'fontsize'),\n\t\t\t\tonclick: function(e) {\n\t\t\t\t\tif (e.control.settings.value) {\n\t\t\t\t\t\teditor.execCommand('FontSize', false, e.control.settings.value);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t});\n\n\t\teditor.addMenuItem('formats', {\n\t\t\ttext: 'Formats',\n\t\t\tmenu: formatMenu\n\t\t});\n\t}\n});\n\n// Included from: js/tinymce/classes/ui/GridLayout.js\n\n/**\n * GridLayout.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This layout manager places controls in a grid.\n *\n * @setting {Number} spacing Spacing between controls.\n * @setting {Number} spacingH Horizontal spacing between controls.\n * @setting {Number} spacingV Vertical spacing between controls.\n * @setting {Number} columns Number of columns to use.\n * @setting {String/Array} alignH start|end|center|stretch or array of values for each column.\n * @setting {String/Array} alignV start|end|center|stretch or array of values for each column.\n * @setting {String} pack start|end\n *\n * @class tinymce.ui.GridLayout\n * @extends tinymce.ui.AbsoluteLayout\n */\ndefine(\"tinymce/ui/GridLayout\", [\n\t\"tinymce/ui/AbsoluteLayout\"\n], function(AbsoluteLayout) {\n\t\"use strict\";\n\n\treturn AbsoluteLayout.extend({\n\t\t/**\n\t\t * Recalculates the positions of the controls in the specified container.\n\t\t *\n\t\t * @method recalc\n\t\t * @param {tinymce.ui.Container} container Container instance to recalc.\n\t\t */\n\t\trecalc: function(container) {\n\t\t\tvar settings, rows, cols, items, contLayoutRect, width, height, rect,\n\t\t\t\tctrlLayoutRect, ctrl, x, y, posX, posY, ctrlSettings, contPaddingBox, align, spacingH, spacingV, alignH, alignV, maxX, maxY,\n\t\t\t\tcolWidths = [], rowHeights = [], ctrlMinWidth, ctrlMinHeight, availableWidth, availableHeight, reverseRows, idx;\n\n\t\t\t// Get layout settings\n\t\t\tsettings = container.settings;\n\t\t\titems = container.items().filter(':visible');\n\t\t\tcontLayoutRect = container.layoutRect();\n\t\t\tcols = settings.columns || Math.ceil(Math.sqrt(items.length));\n\t\t\trows = Math.ceil(items.length / cols);\n\t\t\tspacingH = settings.spacingH || settings.spacing || 0;\n\t\t\tspacingV = settings.spacingV || settings.spacing || 0;\n\t\t\talignH = settings.alignH || settings.align;\n\t\t\talignV = settings.alignV || settings.align;\n\t\t\tcontPaddingBox = container.paddingBox;\n\t\t\treverseRows = 'reverseRows' in settings ? settings.reverseRows : container.isRtl();\n\n\t\t\tif (alignH && typeof alignH == \"string\") {\n\t\t\t\talignH = [alignH];\n\t\t\t}\n\n\t\t\tif (alignV && typeof alignV == \"string\") {\n\t\t\t\talignV = [alignV];\n\t\t\t}\n\n\t\t\t// Zero padd columnWidths\n\t\t\tfor (x = 0; x < cols; x++) {\n\t\t\t\tcolWidths.push(0);\n\t\t\t}\n\n\t\t\t// Zero padd rowHeights\n\t\t\tfor (y = 0; y < rows; y++) {\n\t\t\t\trowHeights.push(0);\n\t\t\t}\n\n\t\t\t// Calculate columnWidths and rowHeights\n\t\t\tfor (y = 0; y < rows; y++) {\n\t\t\t\tfor (x = 0; x < cols; x++) {\n\t\t\t\t\tctrl = items[y * cols + x];\n\n\t\t\t\t\t// Out of bounds\n\t\t\t\t\tif (!ctrl) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tctrlLayoutRect = ctrl.layoutRect();\n\t\t\t\t\tctrlMinWidth = ctrlLayoutRect.minW;\n\t\t\t\t\tctrlMinHeight = ctrlLayoutRect.minH;\n\n\t\t\t\t\tcolWidths[x] = ctrlMinWidth > colWidths[x] ? ctrlMinWidth : colWidths[x];\n\t\t\t\t\trowHeights[y] = ctrlMinHeight > rowHeights[y] ? ctrlMinHeight : rowHeights[y];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Calculate maxX\n\t\t\tavailableWidth = contLayoutRect.innerW - contPaddingBox.left - contPaddingBox.right;\n\t\t\tfor (maxX = 0, x = 0; x < cols; x++) {\n\t\t\t\tmaxX += colWidths[x] + (x > 0 ? spacingH : 0);\n\t\t\t\tavailableWidth -= (x > 0 ? spacingH : 0) + colWidths[x];\n\t\t\t}\n\n\t\t\t// Calculate maxY\n\t\t\tavailableHeight = contLayoutRect.innerH - contPaddingBox.top - contPaddingBox.bottom;\n\t\t\tfor (maxY = 0, y = 0; y < rows; y++) {\n\t\t\t\tmaxY += rowHeights[y] + (y > 0 ? spacingV : 0);\n\t\t\t\tavailableHeight -= (y > 0 ? spacingV : 0) + rowHeights[y];\n\t\t\t}\n\n\t\t\tmaxX += contPaddingBox.left + contPaddingBox.right;\n\t\t\tmaxY += contPaddingBox.top + contPaddingBox.bottom;\n\n\t\t\t// Calculate minW/minH\n\t\t\trect = {};\n\t\t\trect.minW = maxX + (contLayoutRect.w - contLayoutRect.innerW);\n\t\t\trect.minH = maxY + (contLayoutRect.h - contLayoutRect.innerH);\n\n\t\t\trect.contentW = rect.minW - contLayoutRect.deltaW;\n\t\t\trect.contentH = rect.minH - contLayoutRect.deltaH;\n\t\t\trect.minW = Math.min(rect.minW, contLayoutRect.maxW);\n\t\t\trect.minH = Math.min(rect.minH, contLayoutRect.maxH);\n\t\t\trect.minW = Math.max(rect.minW, contLayoutRect.startMinWidth);\n\t\t\trect.minH = Math.max(rect.minH, contLayoutRect.startMinHeight);\n\n\t\t\t// Resize container container if minSize was changed\n\t\t\tif (contLayoutRect.autoResize && (rect.minW != contLayoutRect.minW || rect.minH != contLayoutRect.minH)) {\n\t\t\t\trect.w = rect.minW;\n\t\t\t\trect.h = rect.minH;\n\n\t\t\t\tcontainer.layoutRect(rect);\n\t\t\t\tthis.recalc(container);\n\n\t\t\t\t// Forced recalc for example if items are hidden/shown\n\t\t\t\tif (container._lastRect === null) {\n\t\t\t\t\tvar parentCtrl = container.parent();\n\t\t\t\t\tif (parentCtrl) {\n\t\t\t\t\t\tparentCtrl._lastRect = null;\n\t\t\t\t\t\tparentCtrl.recalc();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Update contentW/contentH so absEnd moves correctly\n\t\t\tif (contLayoutRect.autoResize) {\n\t\t\t\trect = container.layoutRect(rect);\n\t\t\t\trect.contentW = rect.minW - contLayoutRect.deltaW;\n\t\t\t\trect.contentH = rect.minH - contLayoutRect.deltaH;\n\t\t\t}\n\n\t\t\tvar flexV;\n\n\t\t\tif (settings.packV == 'start') {\n\t\t\t\tflexV = 0;\n\t\t\t} else {\n\t\t\t\tflexV = availableHeight > 0 ? Math.floor(availableHeight / rows) : 0;\n\t\t\t}\n\n\t\t\t// Calculate totalFlex\n\t\t\tvar totalFlex = 0;\n\t\t\tvar flexWidths = settings.flexWidths;\n\t\t\tif (flexWidths) {\n\t\t\t\tfor (x = 0; x < flexWidths.length; x++) {\n\t\t\t\t\ttotalFlex += flexWidths[x];\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\ttotalFlex = cols;\n\t\t\t}\n\n\t\t\t// Calculate new column widths based on flex values\n\t\t\tvar ratio = availableWidth / totalFlex;\n\t\t\tfor (x = 0; x < cols; x++) {\n\t\t\t\tcolWidths[x] += flexWidths ? flexWidths[x] * ratio : ratio;\n\t\t\t}\n\n\t\t\t// Move/resize controls\n\t\t\tposY = contPaddingBox.top;\n\t\t\tfor (y = 0; y < rows; y++) {\n\t\t\t\tposX = contPaddingBox.left;\n\t\t\t\theight = rowHeights[y] + flexV;\n\n\t\t\t\tfor (x = 0; x < cols; x++) {\n\t\t\t\t\tif (reverseRows) {\n\t\t\t\t\t\tidx = y * cols + cols - 1 - x;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tidx = y * cols + x;\n\t\t\t\t\t}\n\n\t\t\t\t\tctrl = items[idx];\n\n\t\t\t\t\t// No more controls to render then break\n\t\t\t\t\tif (!ctrl) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Get control settings and calculate x, y\n\t\t\t\t\tctrlSettings = ctrl.settings;\n\t\t\t\t\tctrlLayoutRect = ctrl.layoutRect();\n\t\t\t\t\twidth = Math.max(colWidths[x], ctrlLayoutRect.startMinWidth);\n\t\t\t\t\tctrlLayoutRect.x = posX;\n\t\t\t\t\tctrlLayoutRect.y = posY;\n\n\t\t\t\t\t// Align control horizontal\n\t\t\t\t\talign = ctrlSettings.alignH || (alignH ? (alignH[x] || alignH[0]) : null);\n\t\t\t\t\tif (align == \"center\") {\n\t\t\t\t\t\tctrlLayoutRect.x = posX + (width / 2) - (ctrlLayoutRect.w / 2);\n\t\t\t\t\t} else if (align == \"right\") {\n\t\t\t\t\t\tctrlLayoutRect.x = posX + width - ctrlLayoutRect.w;\n\t\t\t\t\t} else if (align == \"stretch\") {\n\t\t\t\t\t\tctrlLayoutRect.w = width;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Align control vertical\n\t\t\t\t\talign = ctrlSettings.alignV || (alignV ? (alignV[x] || alignV[0]) : null);\n\t\t\t\t\tif (align == \"center\") {\n\t\t\t\t\t\tctrlLayoutRect.y = posY + (height / 2) - (ctrlLayoutRect.h / 2);\n\t\t\t\t\t} else if (align == \"bottom\") {\n\t\t\t\t\t\tctrlLayoutRect.y = posY + height - ctrlLayoutRect.h;\n\t\t\t\t\t} else if (align == \"stretch\") {\n\t\t\t\t\t\tctrlLayoutRect.h = height;\n\t\t\t\t\t}\n\n\t\t\t\t\tctrl.layoutRect(ctrlLayoutRect);\n\n\t\t\t\t\tposX += width + spacingH;\n\n\t\t\t\t\tif (ctrl.recalc) {\n\t\t\t\t\t\tctrl.recalc();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tposY += height + spacingV;\n\t\t\t}\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/Iframe.js\n\n/**\n * Iframe.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/*jshint scripturl:true */\n\n/**\n * This class creates an iframe.\n *\n * @setting {String} url Url to open in the iframe.\n *\n * @-x-less Iframe.less\n * @class tinymce.ui.Iframe\n * @extends tinymce.ui.Widget\n */\ndefine(\"tinymce/ui/Iframe\", [\n\t\"tinymce/ui/Widget\",\n\t\"tinymce/util/Delay\"\n], function(Widget, Delay) {\n\t\"use strict\";\n\n\treturn Widget.extend({\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.classes.add('iframe');\n\t\t\tself.canFocus = false;\n\n\t\t\t/*eslint no-script-url:0 */\n\t\t\treturn (\n\t\t\t\t'<iframe id=\"' + self._id + '\" class=\"' + self.classes + '\" tabindex=\"-1\" src=\"' +\n\t\t\t\t(self.settings.url || \"javascript:''\") + '\" frameborder=\"0\"></iframe>'\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Setter for the iframe source.\n\t\t *\n\t\t * @method src\n\t\t * @param {String} src Source URL for iframe.\n\t\t */\n\t\tsrc: function(src) {\n\t\t\tthis.getEl().src = src;\n\t\t},\n\n\t\t/**\n\t\t * Inner HTML for the iframe.\n\t\t *\n\t\t * @method html\n\t\t * @param {String} html HTML string to set as HTML inside the iframe.\n\t\t * @param {function} callback Optional callback to execute when the iframe body is filled with contents.\n\t\t * @return {tinymce.ui.Iframe} Current iframe control.\n\t\t */\n\t\thtml: function(html, callback) {\n\t\t\tvar self = this, body = this.getEl().contentWindow.document.body;\n\n\t\t\t// Wait for iframe to initialize IE 10 takes time\n\t\t\tif (!body) {\n\t\t\t\tDelay.setTimeout(function() {\n\t\t\t\t\tself.html(html);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tbody.innerHTML = html;\n\n\t\t\t\tif (callback) {\n\t\t\t\t\tcallback();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn this;\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/InfoBox.js\n\n/**\n * InfoBox.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * ....\n *\n * @-x-less InfoBox.less\n * @class tinymce.ui.InfoBox\n * @extends tinymce.ui.Widget\n */\ndefine(\"tinymce/ui/InfoBox\", [\n\t\"tinymce/ui/Widget\"\n], function(Widget) {\n\t\"use strict\";\n\n\treturn Widget.extend({\n\t\t/**\n\t\t * Constructs a instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t * @setting {Boolean} multiline Multiline label.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tself._super(settings);\n\t\t\tself.classes.add('widget').add('infobox');\n\t\t\tself.canFocus = false;\n\t\t},\n\n\t\tseverity: function(level) {\n\t\t\tthis.classes.remove('error');\n\t\t\tthis.classes.remove('warning');\n\t\t\tthis.classes.remove('success');\n\t\t\tthis.classes.add(level);\n\t\t},\n\n\t\thelp: function(state) {\n\t\t\tthis.state.set('help', state);\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, prefix = self.classPrefix;\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + self._id + '\" class=\"' + self.classes + '\">' +\n\t\t\t\t\t'<div id=\"' + self._id + '-body\">' +\n\t\t\t\t\t\tself.encode(self.state.get('text')) +\n\t\t\t\t\t\t'<button role=\"button\" tabindex=\"-1\">' +\n\t\t\t\t\t\t\t'<i class=\"' + prefix + 'ico ' + prefix + 'i-help\"></i>' +\n\t\t\t\t\t\t'</button>' +\n\t\t\t\t\t'</div>' +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\tbindStates: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.state.on('change:text', function(e) {\n\t\t\t\tself.getEl('body').firstChild.data = self.encode(e.value);\n\n\t\t\t\tif (self.state.get('rendered')) {\n\t\t\t\t\tself.updateLayoutRect();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.state.on('change:help', function(e) {\n\t\t\t\tself.classes.toggle('has-help', e.value);\n\n\t\t\t\tif (self.state.get('rendered')) {\n\t\t\t\t\tself.updateLayoutRect();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/Label.js\n\n/**\n * Label.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class creates a label element. A label is a simple text control\n * that can be bound to other controls.\n *\n * @-x-less Label.less\n * @class tinymce.ui.Label\n * @extends tinymce.ui.Widget\n */\ndefine(\"tinymce/ui/Label\", [\n\t\"tinymce/ui/Widget\",\n\t\"tinymce/ui/DomUtils\"\n], function(Widget, DomUtils) {\n\t\"use strict\";\n\n\treturn Widget.extend({\n\t\t/**\n\t\t * Constructs a instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t * @setting {Boolean} multiline Multiline label.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tself._super(settings);\n\t\t\tself.classes.add('widget').add('label');\n\t\t\tself.canFocus = false;\n\n\t\t\tif (settings.multiline) {\n\t\t\t\tself.classes.add('autoscroll');\n\t\t\t}\n\n\t\t\tif (settings.strong) {\n\t\t\t\tself.classes.add('strong');\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Initializes the current controls layout rect.\n\t\t * This will be executed by the layout managers to determine the\n\t\t * default minWidth/minHeight etc.\n\t\t *\n\t\t * @method initLayoutRect\n\t\t * @return {Object} Layout rect instance.\n\t\t */\n\t\tinitLayoutRect: function() {\n\t\t\tvar self = this, layoutRect = self._super();\n\n\t\t\tif (self.settings.multiline) {\n\t\t\t\tvar size = DomUtils.getSize(self.getEl());\n\n\t\t\t\t// Check if the text fits within maxW if not then try word wrapping it\n\t\t\t\tif (size.width > layoutRect.maxW) {\n\t\t\t\t\tlayoutRect.minW = layoutRect.maxW;\n\t\t\t\t\tself.classes.add('multiline');\n\t\t\t\t}\n\n\t\t\t\tself.getEl().style.width = layoutRect.minW + 'px';\n\t\t\t\tlayoutRect.startMinH = layoutRect.h = layoutRect.minH = Math.min(layoutRect.maxH, DomUtils.getSize(self.getEl()).height);\n\t\t\t}\n\n\t\t\treturn layoutRect;\n\t\t},\n\n\t\t/**\n\t\t * Repaints the control after a layout operation.\n\t\t *\n\t\t * @method repaint\n\t\t */\n\t\trepaint: function() {\n\t\t\tvar self = this;\n\n\t\t\tif (!self.settings.multiline) {\n\t\t\t\tself.getEl().style.lineHeight = self.layoutRect().h + 'px';\n\t\t\t}\n\n\t\t\treturn self._super();\n\t\t},\n\n\t\tseverity: function(level) {\n\t\t\tthis.classes.remove('error');\n\t\t\tthis.classes.remove('warning');\n\t\t\tthis.classes.remove('success');\n\t\t\tthis.classes.add(level);\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, targetCtrl, forName, forId = self.settings.forId;\n\n\t\t\tif (!forId && (forName = self.settings.forName)) {\n\t\t\t\ttargetCtrl = self.getRoot().find('#' + forName)[0];\n\n\t\t\t\tif (targetCtrl) {\n\t\t\t\t\tforId = targetCtrl._id;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (forId) {\n\t\t\t\treturn (\n\t\t\t\t\t'<label id=\"' + self._id + '\" class=\"' + self.classes + '\"' + (forId ? ' for=\"' + forId + '\"' : '') + '>' +\n\t\t\t\t\t\tself.encode(self.state.get('text')) +\n\t\t\t\t\t'</label>'\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn (\n\t\t\t\t'<span id=\"' + self._id + '\" class=\"' + self.classes + '\">' +\n\t\t\t\t\tself.encode(self.state.get('text')) +\n\t\t\t\t'</span>'\n\t\t\t);\n\t\t},\n\n\t\tbindStates: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.state.on('change:text', function(e) {\n\t\t\t\tself.innerHtml(self.encode(e.value));\n\n\t\t\t\tif (self.state.get('rendered')) {\n\t\t\t\t\tself.updateLayoutRect();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/Toolbar.js\n\n/**\n * Toolbar.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a new toolbar.\n *\n * @class tinymce.ui.Toolbar\n * @extends tinymce.ui.Container\n */\ndefine(\"tinymce/ui/Toolbar\", [\n\t\"tinymce/ui/Container\"\n], function(Container) {\n\t\"use strict\";\n\n\treturn Container.extend({\n\t\tDefaults: {\n\t\t\trole: 'toolbar',\n\t\t\tlayout: 'flow'\n\t\t},\n\n\t\t/**\n\t\t * Constructs a instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tself._super(settings);\n\t\t\tself.classes.add('toolbar');\n\t\t},\n\n\t\t/**\n\t\t * Called after the control has been rendered.\n\t\t *\n\t\t * @method postRender\n\t\t */\n\t\tpostRender: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.items().each(function(ctrl) {\n\t\t\t\tctrl.classes.add('toolbar-item');\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/MenuBar.js\n\n/**\n * MenuBar.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a new menubar.\n *\n * @-x-less MenuBar.less\n * @class tinymce.ui.MenuBar\n * @extends tinymce.ui.Container\n */\ndefine(\"tinymce/ui/MenuBar\", [\n\t\"tinymce/ui/Toolbar\"\n], function(Toolbar) {\n\t\"use strict\";\n\n\treturn Toolbar.extend({\n\t\tDefaults: {\n\t\t\trole: 'menubar',\n\t\t\tcontainerCls: 'menubar',\n\t\t\tariaRoot: true,\n\t\t\tdefaults: {\n\t\t\t\ttype: 'menubutton'\n\t\t\t}\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/MenuButton.js\n\n/**\n * MenuButton.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a new menu button.\n *\n * @-x-less MenuButton.less\n * @class tinymce.ui.MenuButton\n * @extends tinymce.ui.Button\n */\ndefine(\"tinymce/ui/MenuButton\", [\n\t\"tinymce/ui/Button\",\n\t\"tinymce/ui/Factory\",\n\t\"tinymce/ui/MenuBar\"\n], function(Button, Factory, MenuBar) {\n\t\"use strict\";\n\n\t// TODO: Maybe add as some global function\n\tfunction isChildOf(node, parent) {\n\t\twhile (node) {\n\t\t\tif (parent === node) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tnode = node.parentNode;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tvar MenuButton = Button.extend({\n\t\t/**\n\t\t * Constructs a instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tself._renderOpen = true;\n\n\t\t\tself._super(settings);\n\t\t\tsettings = self.settings;\n\n\t\t\tself.classes.add('menubtn');\n\n\t\t\tif (settings.fixedWidth) {\n\t\t\t\tself.classes.add('fixed-width');\n\t\t\t}\n\n\t\t\tself.aria('haspopup', true);\n\n\t\t\tself.state.set('menu', settings.menu || self.render());\n\t\t},\n\n\t\t/**\n\t\t * Shows the menu for the button.\n\t\t *\n\t\t * @method showMenu\n\t\t */\n\t\tshowMenu: function() {\n\t\t\tvar self = this, menu;\n\n\t\t\tif (self.menu && self.menu.visible()) {\n\t\t\t\treturn self.hideMenu();\n\t\t\t}\n\n\t\t\tif (!self.menu) {\n\t\t\t\tmenu = self.state.get('menu') || [];\n\n\t\t\t\t// Is menu array then auto constuct menu control\n\t\t\t\tif (menu.length) {\n\t\t\t\t\tmenu = {\n\t\t\t\t\t\ttype: 'menu',\n\t\t\t\t\t\titems: menu\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\tmenu.type = menu.type || 'menu';\n\t\t\t\t}\n\n\t\t\t\tif (!menu.renderTo) {\n\t\t\t\t\tself.menu = Factory.create(menu).parent(self).renderTo();\n\t\t\t\t} else {\n\t\t\t\t\tself.menu = menu.parent(self).show().renderTo();\n\t\t\t\t}\n\n\t\t\t\tself.fire('createmenu');\n\t\t\t\tself.menu.reflow();\n\t\t\t\tself.menu.on('cancel', function(e) {\n\t\t\t\t\tif (e.control.parent() === self.menu) {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\tself.focus();\n\t\t\t\t\t\tself.hideMenu();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Move focus to button when a menu item is selected/clicked\n\t\t\t\tself.menu.on('select', function() {\n\t\t\t\t\tself.focus();\n\t\t\t\t});\n\n\t\t\t\tself.menu.on('show hide', function(e) {\n\t\t\t\t\tif (e.control == self.menu) {\n\t\t\t\t\t\tself.activeMenu(e.type == 'show');\n\t\t\t\t\t}\n\n\t\t\t\t\tself.aria('expanded', e.type == 'show');\n\t\t\t\t}).fire('show');\n\t\t\t}\n\n\t\t\tself.menu.show();\n\t\t\tself.menu.layoutRect({w: self.layoutRect().w});\n\t\t\tself.menu.moveRel(self.getEl(), self.isRtl() ? ['br-tr', 'tr-br'] : ['bl-tl', 'tl-bl']);\n\t\t\tself.fire('showmenu');\n\t\t},\n\n\t\t/**\n\t\t * Hides the menu for the button.\n\t\t *\n\t\t * @method hideMenu\n\t\t */\n\t\thideMenu: function() {\n\t\t\tvar self = this;\n\n\t\t\tif (self.menu) {\n\t\t\t\tself.menu.items().each(function(item) {\n\t\t\t\t\tif (item.hideMenu) {\n\t\t\t\t\t\titem.hideMenu();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tself.menu.hide();\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Sets the active menu state.\n\t\t *\n\t\t * @private\n\t\t */\n\t\tactiveMenu: function(state) {\n\t\t\tthis.classes.toggle('active', state);\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, id = self._id, prefix = self.classPrefix;\n\t\t\tvar icon = self.settings.icon, image, text = self.state.get('text'),\n\t\t\t\ttextHtml = '';\n\n\t\t\timage = self.settings.image;\n\t\t\tif (image) {\n\t\t\t\ticon = 'none';\n\n\t\t\t\t// Support for [high dpi, low dpi] image sources\n\t\t\t\tif (typeof image != \"string\") {\n\t\t\t\t\timage = window.getSelection ? image[0] : image[1];\n\t\t\t\t}\n\n\t\t\t\timage = ' style=\"background-image: url(\\'' + image + '\\')\"';\n\t\t\t} else {\n\t\t\t\timage = '';\n\t\t\t}\n\n\t\t\tif (text) {\n\t\t\t\tself.classes.add('btn-has-text');\n\t\t\t\ttextHtml = '<span class=\"' + prefix + 'txt\">' + self.encode(text) + '</span>';\n\t\t\t}\n\n\t\t\ticon = self.settings.icon ? prefix + 'ico ' + prefix + 'i-' + icon : '';\n\n\t\t\tself.aria('role', self.parent() instanceof MenuBar ? 'menuitem' : 'button');\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + id + '\" class=\"' + self.classes + '\" tabindex=\"-1\" aria-labelledby=\"' + id + '\">' +\n\t\t\t\t\t'<button id=\"' + id + '-open\" role=\"presentation\" type=\"button\" tabindex=\"-1\">' +\n\t\t\t\t\t\t(icon ? '<i class=\"' + icon + '\"' + image + '></i>' : '') +\n\t\t\t\t\t\ttextHtml +\n\t\t\t\t\t\t' <i class=\"' + prefix + 'caret\"></i>' +\n\t\t\t\t\t'</button>' +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Gets invoked after the control has been rendered.\n\t\t *\n\t\t * @method postRender\n\t\t */\n\t\tpostRender: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.on('click', function(e) {\n\t\t\t\tif (e.control === self && isChildOf(e.target, self.getEl())) {\n\t\t\t\t\tself.showMenu();\n\n\t\t\t\t\tif (e.aria) {\n\t\t\t\t\t\tself.menu.items().filter(':visible')[0].focus();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.on('mouseenter', function(e) {\n\t\t\t\tvar overCtrl = e.control, parent = self.parent(), hasVisibleSiblingMenu;\n\n\t\t\t\tif (overCtrl && parent && overCtrl instanceof MenuButton && overCtrl.parent() == parent) {\n\t\t\t\t\tparent.items().filter('MenuButton').each(function(ctrl) {\n\t\t\t\t\t\tif (ctrl.hideMenu && ctrl != overCtrl) {\n\t\t\t\t\t\t\tif (ctrl.menu && ctrl.menu.visible()) {\n\t\t\t\t\t\t\t\thasVisibleSiblingMenu = true;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tctrl.hideMenu();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tif (hasVisibleSiblingMenu) {\n\t\t\t\t\t\toverCtrl.focus(); // Fix for: #5887\n\t\t\t\t\t\toverCtrl.showMenu();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t},\n\n\t\tbindStates: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.state.on('change:menu', function() {\n\t\t\t\tif (self.menu) {\n\t\t\t\t\tself.menu.remove();\n\t\t\t\t}\n\n\t\t\t\tself.menu = null;\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t},\n\n\t\t/**\n\t\t * Removes the control and it's menus.\n\t\t *\n\t\t * @method remove\n\t\t */\n\t\tremove: function() {\n\t\t\tthis._super();\n\n\t\t\tif (this.menu) {\n\t\t\t\tthis.menu.remove();\n\t\t\t}\n\t\t}\n\t});\n\n\treturn MenuButton;\n});\n\n// Included from: js/tinymce/classes/ui/MenuItem.js\n\n/**\n * MenuItem.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a new menu item.\n *\n * @-x-less MenuItem.less\n * @class tinymce.ui.MenuItem\n * @extends tinymce.ui.Control\n */\ndefine(\"tinymce/ui/MenuItem\", [\n\t\"tinymce/ui/Widget\",\n\t\"tinymce/ui/Factory\",\n\t\"tinymce/Env\",\n\t\"tinymce/util/Delay\"\n], function(Widget, Factory, Env, Delay) {\n\t\"use strict\";\n\n\treturn Widget.extend({\n\t\tDefaults: {\n\t\t\tborder: 0,\n\t\t\trole: 'menuitem'\n\t\t},\n\n\t\t/**\n\t\t * Constructs a instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t * @setting {Boolean} selectable Selectable menu.\n\t\t * @setting {Array} menu Submenu array with items.\n\t\t * @setting {String} shortcut Shortcut to display for menu item. Example: Ctrl+X\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this, text;\n\n\t\t\tself._super(settings);\n\n\t\t\tsettings = self.settings;\n\n\t\t\tself.classes.add('menu-item');\n\n\t\t\tif (settings.menu) {\n\t\t\t\tself.classes.add('menu-item-expand');\n\t\t\t}\n\n\t\t\tif (settings.preview) {\n\t\t\t\tself.classes.add('menu-item-preview');\n\t\t\t}\n\n\t\t\ttext = self.state.get('text');\n\t\t\tif (text === '-' || text === '|') {\n\t\t\t\tself.classes.add('menu-item-sep');\n\t\t\t\tself.aria('role', 'separator');\n\t\t\t\tself.state.set('text', '-');\n\t\t\t}\n\n\t\t\tif (settings.selectable) {\n\t\t\t\tself.aria('role', 'menuitemcheckbox');\n\t\t\t\tself.classes.add('menu-item-checkbox');\n\t\t\t\tsettings.icon = 'selected';\n\t\t\t}\n\n\t\t\tif (!settings.preview && !settings.selectable) {\n\t\t\t\tself.classes.add('menu-item-normal');\n\t\t\t}\n\n\t\t\tself.on('mousedown', function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t});\n\n\t\t\tif (settings.menu && !settings.ariaHideMenu) {\n\t\t\t\tself.aria('haspopup', true);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Returns true/false if the menuitem has sub menu.\n\t\t *\n\t\t * @method hasMenus\n\t\t * @return {Boolean} True/false state if it has submenu.\n\t\t */\n\t\thasMenus: function() {\n\t\t\treturn !!this.settings.menu;\n\t\t},\n\n\t\t/**\n\t\t * Shows the menu for the menu item.\n\t\t *\n\t\t * @method showMenu\n\t\t */\n\t\tshowMenu: function() {\n\t\t\tvar self = this, settings = self.settings, menu, parent = self.parent();\n\n\t\t\tparent.items().each(function(ctrl) {\n\t\t\t\tif (ctrl !== self) {\n\t\t\t\t\tctrl.hideMenu();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (settings.menu) {\n\t\t\t\tmenu = self.menu;\n\n\t\t\t\tif (!menu) {\n\t\t\t\t\tmenu = settings.menu;\n\n\t\t\t\t\t// Is menu array then auto constuct menu control\n\t\t\t\t\tif (menu.length) {\n\t\t\t\t\t\tmenu = {\n\t\t\t\t\t\t\ttype: 'menu',\n\t\t\t\t\t\t\titems: menu\n\t\t\t\t\t\t};\n\t\t\t\t\t} else {\n\t\t\t\t\t\tmenu.type = menu.type || 'menu';\n\t\t\t\t\t}\n\n\t\t\t\t\tif (parent.settings.itemDefaults) {\n\t\t\t\t\t\tmenu.itemDefaults = parent.settings.itemDefaults;\n\t\t\t\t\t}\n\n\t\t\t\t\tmenu = self.menu = Factory.create(menu).parent(self).renderTo();\n\t\t\t\t\tmenu.reflow();\n\t\t\t\t\tmenu.on('cancel', function(e) {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\tself.focus();\n\t\t\t\t\t\tmenu.hide();\n\t\t\t\t\t});\n\t\t\t\t\tmenu.on('show hide', function(e) {\n\t\t\t\t\t\tif (e.control.items) {\n\t\t\t\t\t\t\te.control.items().each(function(ctrl) {\n\t\t\t\t\t\t\t\tctrl.active(ctrl.settings.selected);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}).fire('show');\n\n\t\t\t\t\tmenu.on('hide', function(e) {\n\t\t\t\t\t\tif (e.control === menu) {\n\t\t\t\t\t\t\tself.classes.remove('selected');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tmenu.submenu = true;\n\t\t\t\t} else {\n\t\t\t\t\tmenu.show();\n\t\t\t\t}\n\n\t\t\t\tmenu._parentMenu = parent;\n\n\t\t\t\tmenu.classes.add('menu-sub');\n\n\t\t\t\tvar rel = menu.testMoveRel(\n\t\t\t\t\tself.getEl(),\n\t\t\t\t\tself.isRtl() ? ['tl-tr', 'bl-br', 'tr-tl', 'br-bl'] : ['tr-tl', 'br-bl', 'tl-tr', 'bl-br']\n\t\t\t\t);\n\n\t\t\t\tmenu.moveRel(self.getEl(), rel);\n\t\t\t\tmenu.rel = rel;\n\n\t\t\t\trel = 'menu-sub-' + rel;\n\t\t\t\tmenu.classes.remove(menu._lastRel).add(rel);\n\t\t\t\tmenu._lastRel = rel;\n\n\t\t\t\tself.classes.add('selected');\n\t\t\t\tself.aria('expanded', true);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Hides the menu for the menu item.\n\t\t *\n\t\t * @method hideMenu\n\t\t */\n\t\thideMenu: function() {\n\t\t\tvar self = this;\n\n\t\t\tif (self.menu) {\n\t\t\t\tself.menu.items().each(function(item) {\n\t\t\t\t\tif (item.hideMenu) {\n\t\t\t\t\t\titem.hideMenu();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tself.menu.hide();\n\t\t\t\tself.aria('expanded', false);\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, id = self._id, settings = self.settings, prefix = self.classPrefix, text = self.state.get('text');\n\t\t\tvar icon = self.settings.icon, image = '', shortcut = settings.shortcut;\n\t\t\tvar url = self.encode(settings.url), iconHtml = '';\n\n\t\t\t// Converts shortcut format to Mac/PC variants\n\t\t\tfunction convertShortcut(shortcut) {\n\t\t\t\tvar i, value, replace = {};\n\n\t\t\t\tif (Env.mac) {\n\t\t\t\t\treplace = {\n\t\t\t\t\t\talt: '&#x2325;',\n\t\t\t\t\t\tctrl: '&#x2318;',\n\t\t\t\t\t\tshift: '&#x21E7;',\n\t\t\t\t\t\tmeta: '&#x2318;'\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\treplace = {\n\t\t\t\t\t\tmeta: 'Ctrl'\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tshortcut = shortcut.split('+');\n\n\t\t\t\tfor (i = 0; i < shortcut.length; i++) {\n\t\t\t\t\tvalue = replace[shortcut[i].toLowerCase()];\n\n\t\t\t\t\tif (value) {\n\t\t\t\t\t\tshortcut[i] = value;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn shortcut.join('+');\n\t\t\t}\n\n\t\t\tfunction escapeRegExp(str) {\n\t\t\t\treturn str.replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\");\n\t\t\t}\n\n\t\t\tfunction markMatches(text) {\n\t\t\t\tvar match = settings.match || '';\n\n\t\t\t\treturn match ? text.replace(new RegExp(escapeRegExp(match), 'gi'), function (match) {\n\t\t\t\t\treturn '!mce~match[' + match + ']mce~match!';\n\t\t\t\t}) : text;\n\t\t\t}\n\n\t\t\tfunction boldMatches(text) {\n\t\t\t\treturn text.\n\t\t\t\t\treplace(new RegExp(escapeRegExp('!mce~match['), 'g'), '<b>').\n\t\t\t\t\treplace(new RegExp(escapeRegExp(']mce~match!'), 'g'), '</b>');\n\t\t\t}\n\n\t\t\tif (icon) {\n\t\t\t\tself.parent().classes.add('menu-has-icons');\n\t\t\t}\n\n\t\t\tif (settings.image) {\n\t\t\t\timage = ' style=\"background-image: url(\\'' + settings.image + '\\')\"';\n\t\t\t}\n\n\t\t\tif (shortcut) {\n\t\t\t\tshortcut = convertShortcut(shortcut);\n\t\t\t}\n\n\t\t\ticon = prefix + 'ico ' + prefix + 'i-' + (self.settings.icon || 'none');\n\t\t\ticonHtml = (text !== '-' ? '<i class=\"' + icon + '\"' + image + '></i>\\u00a0' : '');\n\n\t\t\ttext = boldMatches(self.encode(markMatches(text)));\n\t\t\turl = boldMatches(self.encode(markMatches(url)));\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + id + '\" class=\"' + self.classes + '\" tabindex=\"-1\">' +\n\t\t\t\t\ticonHtml +\n\t\t\t\t\t(text !== '-' ? '<span id=\"' + id + '-text\" class=\"' + prefix + 'text\">' + text + '</span>' : '') +\n\t\t\t\t\t(shortcut ? '<div id=\"' + id + '-shortcut\" class=\"' + prefix + 'menu-shortcut\">' + shortcut + '</div>' : '') +\n\t\t\t\t\t(settings.menu ? '<div class=\"' + prefix + 'caret\"></div>' : '') +\n\t\t\t\t\t(url ? '<div class=\"' + prefix + 'menu-item-link\">' + url + '</div>' : '') +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Gets invoked after the control has been rendered.\n\t\t *\n\t\t * @method postRender\n\t\t */\n\t\tpostRender: function() {\n\t\t\tvar self = this, settings = self.settings;\n\n\t\t\tvar textStyle = settings.textStyle;\n\t\t\tif (typeof textStyle == \"function\") {\n\t\t\t\ttextStyle = textStyle.call(this);\n\t\t\t}\n\n\t\t\tif (textStyle) {\n\t\t\t\tvar textElm = self.getEl('text');\n\t\t\t\tif (textElm) {\n\t\t\t\t\ttextElm.setAttribute('style', textStyle);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tself.on('mouseenter click', function(e) {\n\t\t\t\tif (e.control === self) {\n\t\t\t\t\tif (!settings.menu && e.type === 'click') {\n\t\t\t\t\t\tself.fire('select');\n\n\t\t\t\t\t\t// Edge will crash if you stress it see #2660\n\t\t\t\t\t\tDelay.requestAnimationFrame(function() {\n\t\t\t\t\t\t\tself.parent().hideAll();\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.showMenu();\n\n\t\t\t\t\t\tif (e.aria) {\n\t\t\t\t\t\t\tself.menu.focus(true);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself._super();\n\n\t\t\treturn self;\n\t\t},\n\n\t\thover: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.parent().items().each(function(ctrl) {\n\t\t\t\tctrl.classes.remove('selected');\n\t\t\t});\n\n\t\t\tself.classes.toggle('selected', true);\n\n\t\t\treturn self;\n\t\t},\n\n\t\tactive: function(state) {\n\t\t\tif (typeof state != \"undefined\") {\n\t\t\t\tthis.aria('checked', state);\n\t\t\t}\n\n\t\t\treturn this._super(state);\n\t\t},\n\n\t\t/**\n\t\t * Removes the control and it's menus.\n\t\t *\n\t\t * @method remove\n\t\t */\n\t\tremove: function() {\n\t\t\tthis._super();\n\n\t\t\tif (this.menu) {\n\t\t\t\tthis.menu.remove();\n\t\t\t}\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/Throbber.js\n\n/**\n * Throbber.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class enables you to display a Throbber for any element.\n *\n * @-x-less Throbber.less\n * @class tinymce.ui.Throbber\n */\ndefine(\"tinymce/ui/Throbber\", [\n\t\"tinymce/dom/DomQuery\",\n\t\"tinymce/ui/Control\",\n\t\"tinymce/util/Delay\"\n], function($, Control, Delay) {\n\t\"use strict\";\n\n\t/**\n\t * Constructs a new throbber.\n\t *\n\t * @constructor\n\t * @param {Element} elm DOM Html element to display throbber in.\n\t * @param {Boolean} inline Optional true/false state if the throbber should be appended to end of element for infinite scroll.\n\t */\n\treturn function(elm, inline) {\n\t\tvar self = this, state, classPrefix = Control.classPrefix, timer;\n\n\t\t/**\n\t\t * Shows the throbber.\n\t\t *\n\t\t * @method show\n\t\t * @param {Number} [time] Time to wait before showing.\n\t\t * @param {function} [callback] Optional callback to execute when the throbber is shown.\n\t\t * @return {tinymce.ui.Throbber} Current throbber instance.\n\t\t */\n\t\tself.show = function(time, callback) {\n\t\t\tfunction render() {\n\t\t\t\t\tif (state) {\n\t\t\t\t\t\t$(elm).append(\n\t\t\t\t\t\t\t'<div class=\"' + classPrefix + 'throbber' + (inline ? ' ' + classPrefix + 'throbber-inline' : '') + '\"></div>'\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tif (callback) {\n\t\t\t\t\t\t\tcallback();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t}\n\n\t\t\tself.hide();\n\n\t\t\tstate = true;\n\n\t\t\tif (time) {\n\t\t\t\ttimer = Delay.setTimeout(render, time);\n\t\t\t} else {\n\t\t\t\trender();\n\t\t\t}\n\n\t\t\treturn self;\n\t\t};\n\n\t\t/**\n\t\t * Hides the throbber.\n\t\t *\n\t\t * @method hide\n\t\t * @return {tinymce.ui.Throbber} Current throbber instance.\n\t\t */\n\t\tself.hide = function() {\n\t\t\tvar child = elm.lastChild;\n\n\t\t\tDelay.clearTimeout(timer);\n\n\t\t\tif (child && child.className.indexOf('throbber') != -1) {\n\t\t\t\tchild.parentNode.removeChild(child);\n\t\t\t}\n\n\t\t\tstate = false;\n\n\t\t\treturn self;\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/ui/Menu.js\n\n/**\n * Menu.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a new menu.\n *\n * @-x-less Menu.less\n * @class tinymce.ui.Menu\n * @extends tinymce.ui.FloatPanel\n */\ndefine(\"tinymce/ui/Menu\", [\n\t\"tinymce/ui/FloatPanel\",\n\t\"tinymce/ui/MenuItem\",\n\t\"tinymce/ui/Throbber\",\n\t\"tinymce/util/Tools\"\n], function(FloatPanel, MenuItem, Throbber, Tools) {\n\t\"use strict\";\n\n\treturn FloatPanel.extend({\n\t\tDefaults: {\n\t\t\tdefaultType: 'menuitem',\n\t\t\tborder: 1,\n\t\t\tlayout: 'stack',\n\t\t\trole: 'application',\n\t\t\tbodyRole: 'menu',\n\t\t\tariaRoot: true\n\t\t},\n\n\t\t/**\n\t\t * Constructs a instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tsettings.autohide = true;\n\t\t\tsettings.constrainToViewport = true;\n\n\t\t\tif (typeof settings.items === 'function') {\n\t\t\t\tsettings.itemsFactory = settings.items;\n\t\t\t\tsettings.items = [];\n\t\t\t}\n\n\t\t\tif (settings.itemDefaults) {\n\t\t\t\tvar items = settings.items, i = items.length;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\titems[i] = Tools.extend({}, settings.itemDefaults, items[i]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tself._super(settings);\n\t\t\tself.classes.add('menu');\n\t\t},\n\n\t\t/**\n\t\t * Repaints the control after a layout operation.\n\t\t *\n\t\t * @method repaint\n\t\t */\n\t\trepaint: function() {\n\t\t\tthis.classes.toggle('menu-align', true);\n\n\t\t\tthis._super();\n\n\t\t\tthis.getEl().style.height = '';\n\t\t\tthis.getEl('body').style.height = '';\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Hides/closes the menu.\n\t\t *\n\t\t * @method cancel\n\t\t */\n\t\tcancel: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.hideAll();\n\t\t\tself.fire('select');\n\t\t},\n\n\t\t/**\n\t\t * Loads new items from the factory items function.\n\t\t *\n\t\t * @method load\n\t\t */\n\t\tload: function() {\n\t\t\tvar self = this, time, factory;\n\n\t\t\tfunction hideThrobber() {\n\t\t\t\tif (self.throbber) {\n\t\t\t\t\tself.throbber.hide();\n\t\t\t\t\tself.throbber = null;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfactory = self.settings.itemsFactory;\n\t\t\tif (!factory) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!self.throbber) {\n\t\t\t\tself.throbber = new Throbber(self.getEl('body'), true);\n\n\t\t\t\tif (self.items().length === 0) {\n\t\t\t\t\tself.throbber.show();\n\t\t\t\t\tself.fire('loading');\n\t\t\t\t} else {\n\t\t\t\t\tself.throbber.show(100, function() {\n\t\t\t\t\t\tself.items().remove();\n\t\t\t\t\t\tself.fire('loading');\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tself.on('hide close', hideThrobber);\n\t\t\t}\n\n\t\t\tself.requestTime = time = new Date().getTime();\n\n\t\t\tself.settings.itemsFactory(function(items) {\n\t\t\t\tif (items.length === 0) {\n\t\t\t\t\tself.hide();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (self.requestTime !== time) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tself.getEl().style.width = '';\n\t\t\t\tself.getEl('body').style.width = '';\n\n\t\t\t\thideThrobber();\n\t\t\t\tself.items().remove();\n\t\t\t\tself.getEl('body').innerHTML = '';\n\n\t\t\t\tself.add(items);\n\t\t\t\tself.renderNew();\n\t\t\t\tself.fire('loaded');\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Hide menu and all sub menus.\n\t\t *\n\t\t * @method hideAll\n\t\t */\n\t\thideAll: function() {\n\t\t\tvar self = this;\n\n\t\t\tthis.find('menuitem').exec('hideMenu');\n\n\t\t\treturn self._super();\n\t\t},\n\n\t\t/**\n\t\t * Invoked before the menu is rendered.\n\t\t *\n\t\t * @method preRender\n\t\t */\n\t\tpreRender: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.items().each(function(ctrl) {\n\t\t\t\tvar settings = ctrl.settings;\n\n\t\t\t\tif (settings.icon || settings.image || settings.selectable) {\n\t\t\t\t\tself._hasIcons = true;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (self.settings.itemsFactory) {\n\t\t\t\tself.on('postrender', function() {\n\t\t\t\t\tif (self.settings.itemsFactory) {\n\t\t\t\t\t\tself.load();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn self._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/ListBox.js\n\n/**\n * ListBox.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a new list box control.\n *\n * @-x-less ListBox.less\n * @class tinymce.ui.ListBox\n * @extends tinymce.ui.MenuButton\n */\ndefine(\"tinymce/ui/ListBox\", [\n\t\"tinymce/ui/MenuButton\",\n\t\"tinymce/ui/Menu\"\n], function(MenuButton, Menu) {\n\t\"use strict\";\n\n\treturn MenuButton.extend({\n\t\t/**\n\t\t * Constructs a instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t * @setting {Array} values Array with values to add to list box.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this, values, selected, selectedText, lastItemCtrl;\n\n\t\t\tfunction setSelected(menuValues) {\n\t\t\t\t// Try to find a selected value\n\t\t\t\tfor (var i = 0; i < menuValues.length; i++) {\n\t\t\t\t\tselected = menuValues[i].selected || settings.value === menuValues[i].value;\n\n\t\t\t\t\tif (selected) {\n\t\t\t\t\t\tselectedText = selectedText || menuValues[i].text;\n\t\t\t\t\t\tself.state.set('value', menuValues[i].value);\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\t// If the value has a submenu, try to find the selected values in that menu\n\t\t\t\t\tif (menuValues[i].menu) {\n\t\t\t\t\t\tif (setSelected(menuValues[i].menu)) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tself._super(settings);\n\t\t\tsettings = self.settings;\n\n\t\t\tself._values = values = settings.values;\n\t\t\tif (values) {\n\t\t\t\tif (typeof settings.value != \"undefined\") {\n\t\t\t\t\tsetSelected(values);\n\t\t\t\t}\n\n\t\t\t\t// Default with first item\n\t\t\t\tif (!selected && values.length > 0) {\n\t\t\t\t\tselectedText = values[0].text;\n\t\t\t\t\tself.state.set('value', values[0].value);\n\t\t\t\t}\n\n\t\t\t\tself.state.set('menu', values);\n\t\t\t}\n\n\t\t\tself.state.set('text', settings.text || selectedText);\n\n\t\t\tself.classes.add('listbox');\n\n\t\t\tself.on('select', function(e) {\n\t\t\t\tvar ctrl = e.control;\n\n\t\t\t\tif (lastItemCtrl) {\n\t\t\t\t\te.lastControl = lastItemCtrl;\n\t\t\t\t}\n\n\t\t\t\tif (settings.multiple) {\n\t\t\t\t\tctrl.active(!ctrl.active());\n\t\t\t\t} else {\n\t\t\t\t\tself.value(e.control.value());\n\t\t\t\t}\n\n\t\t\t\tlastItemCtrl = ctrl;\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Getter/setter function for the control value.\n\t\t *\n\t\t * @method value\n\t\t * @param {String} [value] Value to be set.\n\t\t * @return {Boolean/tinymce.ui.ListBox} Value or self if it's a set operation.\n\t\t */\n\t\tbindStates: function() {\n\t\t\tvar self = this;\n\n\t\t\tfunction activateMenuItemsByValue(menu, value) {\n\t\t\t\tif (menu instanceof Menu) {\n\t\t\t\t\tmenu.items().each(function(ctrl) {\n\t\t\t\t\t\tif (!ctrl.hasMenus()) {\n\t\t\t\t\t\t\tctrl.active(ctrl.value() === value);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction getSelectedItem(menuValues, value) {\n\t\t\t\tvar selectedItem;\n\n\t\t\t\tif (!menuValues) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tfor (var i = 0; i < menuValues.length; i++) {\n\t\t\t\t\tif (menuValues[i].value === value) {\n\t\t\t\t\t\treturn menuValues[i];\n\t\t\t\t\t}\n\n\t\t\t\t\tif (menuValues[i].menu) {\n\t\t\t\t\t\tselectedItem = getSelectedItem(menuValues[i].menu, value);\n\t\t\t\t\t\tif (selectedItem) {\n\t\t\t\t\t\t\treturn selectedItem;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tself.on('show', function(e) {\n\t\t\t\tactivateMenuItemsByValue(e.control, self.value());\n\t\t\t});\n\n\t\t\tself.state.on('change:value', function(e) {\n\t\t\t\tvar selectedItem = getSelectedItem(self.state.get('menu'), e.value);\n\n\t\t\t\tif (selectedItem) {\n\t\t\t\t\tself.text(selectedItem.text);\n\t\t\t\t} else {\n\t\t\t\t\tself.text(self.settings.text);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/Radio.js\n\n/**\n * Radio.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a new radio button.\n *\n * @-x-less Radio.less\n * @class tinymce.ui.Radio\n * @extends tinymce.ui.Checkbox\n */\ndefine(\"tinymce/ui/Radio\", [\n\t\"tinymce/ui/Checkbox\"\n], function(Checkbox) {\n\t\"use strict\";\n\n\treturn Checkbox.extend({\n\t\tDefaults: {\n\t\t\tclasses: \"radio\",\n\t\t\trole: \"radio\"\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/ResizeHandle.js\n\n/**\n * ResizeHandle.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Renders a resize handle that fires ResizeStart, Resize and ResizeEnd events.\n *\n * @-x-less ResizeHandle.less\n * @class tinymce.ui.ResizeHandle\n * @extends tinymce.ui.Widget\n */\ndefine(\"tinymce/ui/ResizeHandle\", [\n\t\"tinymce/ui/Widget\",\n\t\"tinymce/ui/DragHelper\"\n], function(Widget, DragHelper) {\n\t\"use strict\";\n\n\treturn Widget.extend({\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, prefix = self.classPrefix;\n\n\t\t\tself.classes.add('resizehandle');\n\n\t\t\tif (self.settings.direction == \"both\") {\n\t\t\t\tself.classes.add('resizehandle-both');\n\t\t\t}\n\n\t\t\tself.canFocus = false;\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + self._id + '\" class=\"' + self.classes + '\">' +\n\t\t\t\t\t'<i class=\"' + prefix + 'ico ' + prefix + 'i-resize\"></i>' +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Called after the control has been rendered.\n\t\t *\n\t\t * @method postRender\n\t\t */\n\t\tpostRender: function() {\n\t\t\tvar self = this;\n\n\t\t\tself._super();\n\n\t\t\tself.resizeDragHelper = new DragHelper(this._id, {\n\t\t\t\tstart: function() {\n\t\t\t\t\tself.fire('ResizeStart');\n\t\t\t\t},\n\n\t\t\t\tdrag: function(e) {\n\t\t\t\t\tif (self.settings.direction != \"both\") {\n\t\t\t\t\t\te.deltaX = 0;\n\t\t\t\t\t}\n\n\t\t\t\t\tself.fire('Resize', e);\n\t\t\t\t},\n\n\t\t\t\tstop: function() {\n\t\t\t\t\tself.fire('ResizeEnd');\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\tremove: function() {\n\t\t\tif (this.resizeDragHelper) {\n\t\t\t\tthis.resizeDragHelper.destroy();\n\t\t\t}\n\n\t\t\treturn this._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/SelectBox.js\n\n/**\n * SelectBox.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a new select box control.\n *\n * @-x-less SelectBox.less\n * @class tinymce.ui.SelectBox\n * @extends tinymce.ui.Widget\n */\ndefine(\"tinymce/ui/SelectBox\", [\n\t\"tinymce/ui/Widget\"\n], function(Widget) {\n\t\"use strict\";\n\n\tfunction createOptions(options) {\n\t\tvar strOptions = '';\n\t\tif (options) {\n\t\t\tfor (var i = 0; i < options.length; i++) {\n\t\t\t\tstrOptions += '<option value=\"' + options[i] + '\">' + options[i] + '</option>';\n\t\t\t}\n\t\t}\n\t\treturn strOptions;\n\t}\n\n\treturn Widget.extend({\n\t\tDefaults: {\n\t\t\tclasses: \"selectbox\",\n\t\t\trole: \"selectbox\",\n\t\t\toptions: []\n\t\t},\n\t\t/**\n\t\t * Constructs a instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t * @setting {Array} options Array with options to add to the select box.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tself._super(settings);\n\n\t\t\tif (self.settings.size) {\n\t\t\t\tself.size = self.settings.size;\n\t\t\t}\n\n\t\t\tif (self.settings.options) {\n\t\t\t\tself._options = self.settings.options;\n\t\t\t}\n\n\t\t\tself.on('keydown', function(e) {\n\t\t\t\tvar rootControl;\n\n\t\t\t\tif (e.keyCode == 13) {\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t// Find root control that we can do toJSON on\n\t\t\t\t\tself.parents().reverse().each(function(ctrl) {\n\t\t\t\t\t\tif (ctrl.toJSON) {\n\t\t\t\t\t\t\trootControl = ctrl;\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\t// Fire event on current text box with the serialized data of the whole form\n\t\t\t\t\tself.fire('submit', {data: rootControl.toJSON()});\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Getter/setter function for the options state.\n\t\t *\n\t\t * @method options\n\t\t * @param {Array} [state] State to be set.\n\t\t * @return {Array|tinymce.ui.SelectBox} Array of string options.\n\t\t */\n\t\toptions: function(state) {\n\t\t\tif (!arguments.length) {\n\t\t\t\treturn this.state.get('options');\n\t\t\t}\n\n\t\t\tthis.state.set('options', state);\n\n\t\t\treturn this;\n\t\t},\n\n\t\trenderHtml: function() {\n\t\t\tvar self = this, options, size = '';\n\n\t\t\toptions = createOptions(self._options);\n\n\t\t\tif (self.size) {\n\t\t\t\tsize = ' size = \"' + self.size + '\"';\n\t\t\t}\n\n\t\t\treturn (\n\t\t\t\t'<select id=\"' + self._id + '\" class=\"' + self.classes + '\"' + size + '>' +\n\t\t\t\t\toptions +\n\t\t\t\t'</select>'\n\t\t\t);\n\t\t},\n\n\t\tbindStates: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.state.on('change:options', function(e) {\n\t\t\t\tself.getEl().innerHTML = createOptions(e.value);\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/Slider.js\n\n/**\n * Slider.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Slider control.\n *\n * @-x-less Slider.less\n * @class tinymce.ui.Slider\n * @extends tinymce.ui.Widget\n */\ndefine(\"tinymce/ui/Slider\", [\n\t\"tinymce/ui/Widget\",\n\t\"tinymce/ui/DragHelper\",\n\t\"tinymce/ui/DomUtils\"\n], function(Widget, DragHelper, DomUtils) {\n\t\"use strict\";\n\n\tfunction constrain(value, minVal, maxVal) {\n\t\tif (value < minVal) {\n\t\t\tvalue = minVal;\n\t\t}\n\n\t\tif (value > maxVal) {\n\t\t\tvalue = maxVal;\n\t\t}\n\n\t\treturn value;\n\t}\n\n\tfunction setAriaProp(el, name, value) {\n\t\tel.setAttribute('aria-' + name, value);\n\t}\n\n\tfunction updateSliderHandle(ctrl, value) {\n\t\tvar maxHandlePos, shortSizeName, sizeName, stylePosName, styleValue, handleEl;\n\n\t\tif (ctrl.settings.orientation == \"v\") {\n\t\t\tstylePosName = \"top\";\n\t\t\tsizeName = \"height\";\n\t\t\tshortSizeName = \"h\";\n\t\t} else {\n\t\t\tstylePosName = \"left\";\n\t\t\tsizeName = \"width\";\n\t\t\tshortSizeName = \"w\";\n\t\t}\n\n\t\thandleEl = ctrl.getEl('handle');\n\t\tmaxHandlePos = (ctrl.layoutRect()[shortSizeName] || 100) - DomUtils.getSize(handleEl)[sizeName];\n\n\t\tstyleValue = (maxHandlePos * ((value - ctrl._minValue) / (ctrl._maxValue - ctrl._minValue))) + 'px';\n\t\thandleEl.style[stylePosName] = styleValue;\n\t\thandleEl.style.height = ctrl.layoutRect().h + 'px';\n\n\t\tsetAriaProp(handleEl, 'valuenow', value);\n\t\tsetAriaProp(handleEl, 'valuetext', '' + ctrl.settings.previewFilter(value));\n\t\tsetAriaProp(handleEl, 'valuemin', ctrl._minValue);\n\t\tsetAriaProp(handleEl, 'valuemax', ctrl._maxValue);\n\t}\n\n\treturn Widget.extend({\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tif (!settings.previewFilter) {\n\t\t\t\tsettings.previewFilter = function(value) {\n\t\t\t\t\treturn Math.round(value * 100) / 100.0;\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tself._super(settings);\n\t\t\tself.classes.add('slider');\n\n\t\t\tif (settings.orientation == \"v\") {\n\t\t\t\tself.classes.add('vertical');\n\t\t\t}\n\n\t\t\tself._minValue = settings.minValue || 0;\n\t\t\tself._maxValue = settings.maxValue || 100;\n\t\t\tself._initValue = self.state.get('value');\n\t\t},\n\n\t\trenderHtml: function() {\n\t\t\tvar self = this, id = self._id, prefix = self.classPrefix;\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + id + '\" class=\"' + self.classes + '\">' +\n\t\t\t\t\t'<div id=\"' + id + '-handle\" class=\"' + prefix + 'slider-handle\" role=\"slider\" tabindex=\"-1\"></div>' +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\treset: function() {\n\t\t\tthis.value(this._initValue).repaint();\n\t\t},\n\n\t\tpostRender: function() {\n\t\t\tvar self = this, minValue, maxValue, screenCordName,\n\t\t\t\t\tstylePosName, sizeName, shortSizeName;\n\n\t\t\tfunction toFraction(min, max, val) {\n\t\t\t\treturn (val + min) / (max - min);\n\t\t\t}\n\n\t\t\tfunction fromFraction(min, max, val) {\n\t\t\t\treturn (val * (max - min)) - min;\n\t\t\t}\n\n\t\t\tfunction handleKeyboard(minValue, maxValue) {\n\t\t\t\tfunction alter(delta) {\n\t\t\t\t\tvar value;\n\n\t\t\t\t\tvalue = self.value();\n\t\t\t\t\tvalue = fromFraction(minValue, maxValue, toFraction(minValue, maxValue, value) + (delta * 0.05));\n\t\t\t\t\tvalue = constrain(value, minValue, maxValue);\n\n\t\t\t\t\tself.value(value);\n\n\t\t\t\t\tself.fire('dragstart', {value: value});\n\t\t\t\t\tself.fire('drag', {value: value});\n\t\t\t\t\tself.fire('dragend', {value: value});\n\t\t\t\t}\n\n\t\t\t\tself.on('keydown', function(e) {\n\t\t\t\t\tswitch (e.keyCode) {\n\t\t\t\t\t\tcase 37:\n\t\t\t\t\t\tcase 38:\n\t\t\t\t\t\t\talter(-1);\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 39:\n\t\t\t\t\t\tcase 40:\n\t\t\t\t\t\t\talter(1);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction handleDrag(minValue, maxValue, handleEl) {\n\t\t\t\tvar startPos, startHandlePos, maxHandlePos, handlePos, value;\n\n\t\t\t\tself._dragHelper = new DragHelper(self._id, {\n\t\t\t\t\thandle: self._id + \"-handle\",\n\n\t\t\t\t\tstart: function(e) {\n\t\t\t\t\t\tstartPos = e[screenCordName];\n\t\t\t\t\t\tstartHandlePos = parseInt(self.getEl('handle').style[stylePosName], 10);\n\t\t\t\t\t\tmaxHandlePos = (self.layoutRect()[shortSizeName] || 100) - DomUtils.getSize(handleEl)[sizeName];\n\t\t\t\t\t\tself.fire('dragstart', {value: value});\n\t\t\t\t\t},\n\n\t\t\t\t\tdrag: function(e) {\n\t\t\t\t\t\tvar delta = e[screenCordName] - startPos;\n\n\t\t\t\t\t\thandlePos = constrain(startHandlePos + delta, 0, maxHandlePos);\n\t\t\t\t\t\thandleEl.style[stylePosName] = handlePos + 'px';\n\n\t\t\t\t\t\tvalue = minValue + (handlePos / maxHandlePos) * (maxValue - minValue);\n\t\t\t\t\t\tself.value(value);\n\n\t\t\t\t\t\tself.tooltip().text('' + self.settings.previewFilter(value)).show().moveRel(handleEl, 'bc tc');\n\n\t\t\t\t\t\tself.fire('drag', {value: value});\n\t\t\t\t\t},\n\n\t\t\t\t\tstop: function() {\n\t\t\t\t\t\tself.tooltip().hide();\n\t\t\t\t\t\tself.fire('dragend', {value: value});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tminValue = self._minValue;\n\t\t\tmaxValue = self._maxValue;\n\n\t\t\tif (self.settings.orientation == \"v\") {\n\t\t\t\tscreenCordName = \"screenY\";\n\t\t\t\tstylePosName = \"top\";\n\t\t\t\tsizeName = \"height\";\n\t\t\t\tshortSizeName = \"h\";\n\t\t\t} else {\n\t\t\t\tscreenCordName = \"screenX\";\n\t\t\t\tstylePosName = \"left\";\n\t\t\t\tsizeName = \"width\";\n\t\t\t\tshortSizeName = \"w\";\n\t\t\t}\n\n\t\t\tself._super();\n\n\t\t\thandleKeyboard(minValue, maxValue, self.getEl('handle'));\n\t\t\thandleDrag(minValue, maxValue, self.getEl('handle'));\n\t\t},\n\n\t\trepaint: function() {\n\t\t\tthis._super();\n\t\t\tupdateSliderHandle(this, this.value());\n\t\t},\n\n\t\tbindStates: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.state.on('change:value', function(e) {\n\t\t\t\tupdateSliderHandle(self, e.value);\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/Spacer.js\n\n/**\n * Spacer.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a spacer. This control is used in flex layouts for example.\n *\n * @-x-less Spacer.less\n * @class tinymce.ui.Spacer\n * @extends tinymce.ui.Widget\n */\ndefine(\"tinymce/ui/Spacer\", [\n\t\"tinymce/ui/Widget\"\n], function(Widget) {\n\t\"use strict\";\n\n\treturn Widget.extend({\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.classes.add('spacer');\n\t\t\tself.canFocus = false;\n\n\t\t\treturn '<div id=\"' + self._id + '\" class=\"' + self.classes + '\"></div>';\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/SplitButton.js\n\n/**\n * SplitButton.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a split button.\n *\n * @-x-less SplitButton.less\n * @class tinymce.ui.SplitButton\n * @extends tinymce.ui.Button\n */\ndefine(\"tinymce/ui/SplitButton\", [\n\t\"tinymce/ui/MenuButton\",\n\t\"tinymce/ui/DomUtils\",\n\t\"tinymce/dom/DomQuery\"\n], function(MenuButton, DomUtils, $) {\n\treturn MenuButton.extend({\n\t\tDefaults: {\n\t\t\tclasses: \"widget btn splitbtn\",\n\t\t\trole: \"button\"\n\t\t},\n\n\t\t/**\n\t\t * Repaints the control after a layout operation.\n\t\t *\n\t\t * @method repaint\n\t\t */\n\t\trepaint: function() {\n\t\t\tvar self = this, elm = self.getEl(), rect = self.layoutRect(), mainButtonElm, menuButtonElm;\n\n\t\t\tself._super();\n\n\t\t\tmainButtonElm = elm.firstChild;\n\t\t\tmenuButtonElm = elm.lastChild;\n\n\t\t\t$(mainButtonElm).css({\n\t\t\t\twidth: rect.w - DomUtils.getSize(menuButtonElm).width,\n\t\t\t\theight: rect.h - 2\n\t\t\t});\n\n\t\t\t$(menuButtonElm).css({\n\t\t\t\theight: rect.h - 2\n\t\t\t});\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Sets the active menu state.\n\t\t *\n\t\t * @private\n\t\t */\n\t\tactiveMenu: function(state) {\n\t\t\tvar self = this;\n\n\t\t\t$(self.getEl().lastChild).toggleClass(self.classPrefix + 'active', state);\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, id = self._id, prefix = self.classPrefix, image;\n\t\t\tvar icon = self.state.get('icon'), text = self.state.get('text'),\n\t\t\t\ttextHtml = '';\n\n\t\t\timage = self.settings.image;\n\t\t\tif (image) {\n\t\t\t\ticon = 'none';\n\n\t\t\t\t// Support for [high dpi, low dpi] image sources\n\t\t\t\tif (typeof image != \"string\") {\n\t\t\t\t\timage = window.getSelection ? image[0] : image[1];\n\t\t\t\t}\n\n\t\t\t\timage = ' style=\"background-image: url(\\'' + image + '\\')\"';\n\t\t\t} else {\n\t\t\t\timage = '';\n\t\t\t}\n\n\t\t\ticon = self.settings.icon ? prefix + 'ico ' + prefix + 'i-' + icon : '';\n\n\t\t\tif (text) {\n\t\t\t\tself.classes.add('btn-has-text');\n\t\t\t\ttextHtml = '<span class=\"' + prefix + 'txt\">' + self.encode(text) + '</span>';\n\t\t\t}\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + id + '\" class=\"' + self.classes + '\" role=\"button\" tabindex=\"-1\">' +\n\t\t\t\t\t'<button type=\"button\" hidefocus=\"1\" tabindex=\"-1\">' +\n\t\t\t\t\t\t(icon ? '<i class=\"' + icon + '\"' + image + '></i>' : '') +\n\t\t\t\t\t\ttextHtml +\n\t\t\t\t\t'</button>' +\n\t\t\t\t\t'<button type=\"button\" class=\"' + prefix + 'open\" hidefocus=\"1\" tabindex=\"-1\">' +\n\t\t\t\t\t\t//(icon ? '<i class=\"' + icon + '\"></i>' : '') +\n\t\t\t\t\t\t(self._menuBtnText ? (icon ? '\\u00a0' : '') + self._menuBtnText : '') +\n\t\t\t\t\t\t' <i class=\"' + prefix + 'caret\"></i>' +\n\t\t\t\t\t'</button>' +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Called after the control has been rendered.\n\t\t *\n\t\t * @method postRender\n\t\t */\n\t\tpostRender: function() {\n\t\t\tvar self = this, onClickHandler = self.settings.onclick;\n\n\t\t\tself.on('click', function(e) {\n\t\t\t\tvar node = e.target;\n\n\t\t\t\tif (e.control == this) {\n\t\t\t\t\t// Find clicks that is on the main button\n\t\t\t\t\twhile (node) {\n\t\t\t\t\t\tif ((e.aria && e.aria.key != 'down') || (node.nodeName == 'BUTTON' && node.className.indexOf('open') == -1)) {\n\t\t\t\t\t\t\te.stopImmediatePropagation();\n\n\t\t\t\t\t\t\tif (onClickHandler) {\n\t\t\t\t\t\t\t\tonClickHandler.call(this, e);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tdelete self.settings.onclick;\n\n\t\t\treturn self._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/StackLayout.js\n\n/**\n * StackLayout.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This layout uses the browsers layout when the items are blocks.\n *\n * @-x-less StackLayout.less\n * @class tinymce.ui.StackLayout\n * @extends tinymce.ui.FlowLayout\n */\ndefine(\"tinymce/ui/StackLayout\", [\n\t\"tinymce/ui/FlowLayout\"\n], function(FlowLayout) {\n\t\"use strict\";\n\n\treturn FlowLayout.extend({\n\t\tDefaults: {\n\t\t\tcontainerClass: 'stack-layout',\n\t\t\tcontrolClass: 'stack-layout-item',\n\t\t\tendClass: 'break'\n\t\t},\n\n\t\tisNative: function() {\n\t\t\treturn true;\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/TabPanel.js\n\n/**\n * TabPanel.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a tab panel control.\n *\n * @-x-less TabPanel.less\n * @class tinymce.ui.TabPanel\n * @extends tinymce.ui.Panel\n *\n * @setting {Number} activeTab Active tab index.\n */\ndefine(\"tinymce/ui/TabPanel\", [\n\t\"tinymce/ui/Panel\",\n\t\"tinymce/dom/DomQuery\",\n\t\"tinymce/ui/DomUtils\"\n], function(Panel, $, DomUtils) {\n\t\"use strict\";\n\n\treturn Panel.extend({\n\t\tDefaults: {\n\t\t\tlayout: 'absolute',\n\t\t\tdefaults: {\n\t\t\t\ttype: 'panel'\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Activates the specified tab by index.\n\t\t *\n\t\t * @method activateTab\n\t\t * @param {Number} idx Index of the tab to activate.\n\t\t */\n\t\tactivateTab: function(idx) {\n\t\t\tvar activeTabElm;\n\n\t\t\tif (this.activeTabId) {\n\t\t\t\tactiveTabElm = this.getEl(this.activeTabId);\n\t\t\t\t$(activeTabElm).removeClass(this.classPrefix + 'active');\n\t\t\t\tactiveTabElm.setAttribute('aria-selected', \"false\");\n\t\t\t}\n\n\t\t\tthis.activeTabId = 't' + idx;\n\n\t\t\tactiveTabElm = this.getEl('t' + idx);\n\t\t\tactiveTabElm.setAttribute('aria-selected', \"true\");\n\t\t\t$(activeTabElm).addClass(this.classPrefix + 'active');\n\n\t\t\tthis.items()[idx].show().fire('showtab');\n\t\t\tthis.reflow();\n\n\t\t\tthis.items().each(function(item, i) {\n\t\t\t\tif (idx != i) {\n\t\t\t\t\titem.hide();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, layout = self._layout, tabsHtml = '', prefix = self.classPrefix;\n\n\t\t\tself.preRender();\n\t\t\tlayout.preRender(self);\n\n\t\t\tself.items().each(function(ctrl, i) {\n\t\t\t\tvar id = self._id + '-t' + i;\n\n\t\t\t\tctrl.aria('role', 'tabpanel');\n\t\t\t\tctrl.aria('labelledby', id);\n\n\t\t\t\ttabsHtml += (\n\t\t\t\t\t'<div id=\"' + id + '\" class=\"' + prefix + 'tab\" ' +\n\t\t\t\t\t\t'unselectable=\"on\" role=\"tab\" aria-controls=\"' + ctrl._id + '\" aria-selected=\"false\" tabIndex=\"-1\">' +\n\t\t\t\t\t\tself.encode(ctrl.settings.title) +\n\t\t\t\t\t'</div>'\n\t\t\t\t);\n\t\t\t});\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + self._id + '\" class=\"' + self.classes + '\" hidefocus=\"1\" tabindex=\"-1\">' +\n\t\t\t\t\t'<div id=\"' + self._id + '-head\" class=\"' + prefix + 'tabs\" role=\"tablist\">' +\n\t\t\t\t\t\ttabsHtml +\n\t\t\t\t\t'</div>' +\n\t\t\t\t\t'<div id=\"' + self._id + '-body\" class=\"' + self.bodyClasses + '\">' +\n\t\t\t\t\t\tlayout.renderHtml(self) +\n\t\t\t\t\t'</div>' +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Called after the control has been rendered.\n\t\t *\n\t\t * @method postRender\n\t\t */\n\t\tpostRender: function() {\n\t\t\tvar self = this;\n\n\t\t\tself._super();\n\n\t\t\tself.settings.activeTab = self.settings.activeTab || 0;\n\t\t\tself.activateTab(self.settings.activeTab);\n\n\t\t\tthis.on('click', function(e) {\n\t\t\t\tvar targetParent = e.target.parentNode;\n\n\t\t\t\tif (targetParent && targetParent.id == self._id + '-head') {\n\t\t\t\t\tvar i = targetParent.childNodes.length;\n\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tif (targetParent.childNodes[i] == e.target) {\n\t\t\t\t\t\t\tself.activateTab(i);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Initializes the current controls layout rect.\n\t\t * This will be executed by the layout managers to determine the\n\t\t * default minWidth/minHeight etc.\n\t\t *\n\t\t * @method initLayoutRect\n\t\t * @return {Object} Layout rect instance.\n\t\t */\n\t\tinitLayoutRect: function() {\n\t\t\tvar self = this, rect, minW, minH;\n\n\t\t\tminW = DomUtils.getSize(self.getEl('head')).width;\n\t\t\tminW = minW < 0 ? 0 : minW;\n\t\t\tminH = 0;\n\n\t\t\tself.items().each(function(item) {\n\t\t\t\tminW = Math.max(minW, item.layoutRect().minW);\n\t\t\t\tminH = Math.max(minH, item.layoutRect().minH);\n\t\t\t});\n\n\t\t\tself.items().each(function(ctrl) {\n\t\t\t\tctrl.settings.x = 0;\n\t\t\t\tctrl.settings.y = 0;\n\t\t\t\tctrl.settings.w = minW;\n\t\t\t\tctrl.settings.h = minH;\n\n\t\t\t\tctrl.layoutRect({\n\t\t\t\t\tx: 0,\n\t\t\t\t\ty: 0,\n\t\t\t\t\tw: minW,\n\t\t\t\t\th: minH\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tvar headH = DomUtils.getSize(self.getEl('head')).height;\n\n\t\t\tself.settings.minWidth = minW;\n\t\t\tself.settings.minHeight = minH + headH;\n\n\t\t\trect = self._super();\n\t\t\trect.deltaH += headH;\n\t\t\trect.innerH = rect.h - rect.deltaH;\n\n\t\t\treturn rect;\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/TextBox.js\n\n/**\n * TextBox.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a new textbox.\n *\n * @-x-less TextBox.less\n * @class tinymce.ui.TextBox\n * @extends tinymce.ui.Widget\n */\ndefine(\"tinymce/ui/TextBox\", [\n\t\"tinymce/ui/Widget\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/ui/DomUtils\"\n], function(Widget, Tools, DomUtils) {\n\treturn Widget.extend({\n\t\t/**\n\t\t * Constructs a instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t * @setting {Boolean} multiline True if the textbox is a multiline control.\n\t\t * @setting {Number} maxLength Max length for the textbox.\n\t\t * @setting {Number} size Size of the textbox in characters.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tself._super(settings);\n\n\t\t\tself.classes.add('textbox');\n\n\t\t\tif (settings.multiline) {\n\t\t\t\tself.classes.add('multiline');\n\t\t\t} else {\n\t\t\t\tself.on('keydown', function(e) {\n\t\t\t\t\tvar rootControl;\n\n\t\t\t\t\tif (e.keyCode == 13) {\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\t// Find root control that we can do toJSON on\n\t\t\t\t\t\tself.parents().reverse().each(function(ctrl) {\n\t\t\t\t\t\t\tif (ctrl.toJSON) {\n\t\t\t\t\t\t\t\trootControl = ctrl;\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// Fire event on current text box with the serialized data of the whole form\n\t\t\t\t\t\tself.fire('submit', {data: rootControl.toJSON()});\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tself.on('keyup', function(e) {\n\t\t\t\t\tself.state.set('value', e.target.value);\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Repaints the control after a layout operation.\n\t\t *\n\t\t * @method repaint\n\t\t */\n\t\trepaint: function() {\n\t\t\tvar self = this, style, rect, borderBox, borderW, borderH = 0, lastRepaintRect;\n\n\t\t\tstyle = self.getEl().style;\n\t\t\trect = self._layoutRect;\n\t\t\tlastRepaintRect = self._lastRepaintRect || {};\n\n\t\t\t// Detect old IE 7+8 add lineHeight to align caret vertically in the middle\n\t\t\tvar doc = document;\n\t\t\tif (!self.settings.multiline && doc.all && (!doc.documentMode || doc.documentMode <= 8)) {\n\t\t\t\tstyle.lineHeight = (rect.h - borderH) + 'px';\n\t\t\t}\n\n\t\t\tborderBox = self.borderBox;\n\t\t\tborderW = borderBox.left + borderBox.right + 8;\n\t\t\tborderH = borderBox.top + borderBox.bottom + (self.settings.multiline ? 8 : 0);\n\n\t\t\tif (rect.x !== lastRepaintRect.x) {\n\t\t\t\tstyle.left = rect.x + 'px';\n\t\t\t\tlastRepaintRect.x = rect.x;\n\t\t\t}\n\n\t\t\tif (rect.y !== lastRepaintRect.y) {\n\t\t\t\tstyle.top = rect.y + 'px';\n\t\t\t\tlastRepaintRect.y = rect.y;\n\t\t\t}\n\n\t\t\tif (rect.w !== lastRepaintRect.w) {\n\t\t\t\tstyle.width = (rect.w - borderW) + 'px';\n\t\t\t\tlastRepaintRect.w = rect.w;\n\t\t\t}\n\n\t\t\tif (rect.h !== lastRepaintRect.h) {\n\t\t\t\tstyle.height = (rect.h - borderH) + 'px';\n\t\t\t\tlastRepaintRect.h = rect.h;\n\t\t\t}\n\n\t\t\tself._lastRepaintRect = lastRepaintRect;\n\t\t\tself.fire('repaint', {}, false);\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, settings = self.settings, attrs, elm;\n\n\t\t\tattrs = {\n\t\t\t\tid: self._id,\n\t\t\t\thidefocus: '1'\n\t\t\t};\n\n\t\t\tTools.each([\n\t\t\t\t'rows',\t'spellcheck',\t'maxLength', 'size', 'readonly', 'min',\n\t\t\t\t'max', 'step', 'list', 'pattern', 'placeholder', 'required', 'multiple'\n\t\t\t], function(name) {\n\t\t\t\tattrs[name] = settings[name];\n\t\t\t});\n\n\t\t\tif (self.disabled()) {\n\t\t\t\tattrs.disabled = 'disabled';\n\t\t\t}\n\n\t\t\tif (settings.subtype) {\n\t\t\t\tattrs.type = settings.subtype;\n\t\t\t}\n\n\t\t\telm = DomUtils.create(settings.multiline ? 'textarea' : 'input', attrs);\n\t\t\telm.value = self.state.get('value');\n\t\t\telm.className = self.classes;\n\n\t\t\treturn elm.outerHTML;\n\t\t},\n\n\t\tvalue: function(value) {\n\t\t\tif (arguments.length) {\n\t\t\t\tthis.state.set('value', value);\n\t\t\t\treturn this;\n\t\t\t}\n\n\t\t\t// Make sure the real state is in sync\n\t\t\tif (this.state.get('rendered')) {\n\t\t\t\tthis.state.set('value', this.getEl().value);\n\t\t\t}\n\n\t\t\treturn this.state.get('value');\n\t\t},\n\n\t\t/**\n\t\t * Called after the control has been rendered.\n\t\t *\n\t\t * @method postRender\n\t\t */\n\t\tpostRender: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.getEl().value = self.state.get('value');\n\t\t\tself._super();\n\n\t\t\tself.$el.on('change', function(e) {\n\t\t\t\tself.state.set('value', e.target.value);\n\t\t\t\tself.fire('change', e);\n\t\t\t});\n\t\t},\n\n\t\tbindStates: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.state.on('change:value', function(e) {\n\t\t\t\tif (self.getEl().value != e.value) {\n\t\t\t\t\tself.getEl().value = e.value;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.state.on('change:disabled', function(e) {\n\t\t\t\tself.getEl().disabled = e.value;\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t},\n\n\t\tremove: function() {\n\t\t\tthis.$el.off();\n\t\t\tthis._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/Register.js\n\n/**\n * Register.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This registers tinymce in common module loaders.\n *\n * @private\n * @class tinymce.Register\n */\ndefine(\"tinymce/Register\", [\n], function() {\n\t/*eslint consistent-this: 0 */\n\tvar context = this || window;\n\n\tvar tinymce = function() {\n\t\treturn context.tinymce;\n\t};\n\n\tif (typeof context.define === \"function\") {\n\t\t// Bolt\n\t\tif (!context.define.amd) {\n\t\t\tcontext.define(\"ephox/tinymce\", [], tinymce);\n\t\t}\n\t}\n\n\tif (true) {\n\t\t/* global module */\n\t\tmodule.exports = window.tinymce;\n\t}\n\n\treturn {};\n});\n\nexpose([\"tinymce/geom/Rect\",\"tinymce/util/Promise\",\"tinymce/util/Delay\",\"tinymce/Env\",\"tinymce/dom/EventUtils\",\"tinymce/dom/Sizzle\",\"tinymce/util/Tools\",\"tinymce/dom/DomQuery\",\"tinymce/html/Styles\",\"tinymce/dom/TreeWalker\",\"tinymce/html/Entities\",\"tinymce/dom/DOMUtils\",\"tinymce/dom/ScriptLoader\",\"tinymce/AddOnManager\",\"tinymce/dom/RangeUtils\",\"tinymce/html/Node\",\"tinymce/html/Schema\",\"tinymce/html/SaxParser\",\"tinymce/html/DomParser\",\"tinymce/html/Writer\",\"tinymce/html/Serializer\",\"tinymce/dom/Serializer\",\"tinymce/util/VK\",\"tinymce/dom/ControlSelection\",\"tinymce/dom/BookmarkManager\",\"tinymce/dom/Selection\",\"tinymce/Formatter\",\"tinymce/UndoManager\",\"tinymce/EditorCommands\",\"tinymce/util/URI\",\"tinymce/util/Class\",\"tinymce/util/EventDispatcher\",\"tinymce/util/Observable\",\"tinymce/ui/Selector\",\"tinymce/ui/Collection\",\"tinymce/ui/ReflowQueue\",\"tinymce/ui/Control\",\"tinymce/ui/Factory\",\"tinymce/ui/KeyboardNavigation\",\"tinymce/ui/Container\",\"tinymce/ui/DragHelper\",\"tinymce/ui/Scrollable\",\"tinymce/ui/Panel\",\"tinymce/ui/Movable\",\"tinymce/ui/Resizable\",\"tinymce/ui/FloatPanel\",\"tinymce/ui/Window\",\"tinymce/ui/MessageBox\",\"tinymce/WindowManager\",\"tinymce/ui/Tooltip\",\"tinymce/ui/Widget\",\"tinymce/ui/Progress\",\"tinymce/ui/Notification\",\"tinymce/NotificationManager\",\"tinymce/EditorObservable\",\"tinymce/Shortcuts\",\"tinymce/Editor\",\"tinymce/util/I18n\",\"tinymce/FocusManager\",\"tinymce/EditorManager\",\"tinymce/util/XHR\",\"tinymce/util/JSON\",\"tinymce/util/JSONRequest\",\"tinymce/util/JSONP\",\"tinymce/util/LocalStorage\",\"tinymce/Compat\",\"tinymce/ui/Layout\",\"tinymce/ui/AbsoluteLayout\",\"tinymce/ui/Button\",\"tinymce/ui/ButtonGroup\",\"tinymce/ui/Checkbox\",\"tinymce/ui/ComboBox\",\"tinymce/ui/ColorBox\",\"tinymce/ui/PanelButton\",\"tinymce/ui/ColorButton\",\"tinymce/util/Color\",\"tinymce/ui/ColorPicker\",\"tinymce/ui/Path\",\"tinymce/ui/ElementPath\",\"tinymce/ui/FormItem\",\"tinymce/ui/Form\",\"tinymce/ui/FieldSet\",\"tinymce/ui/FilePicker\",\"tinymce/ui/FitLayout\",\"tinymce/ui/FlexLayout\",\"tinymce/ui/FlowLayout\",\"tinymce/ui/FormatControls\",\"tinymce/ui/GridLayout\",\"tinymce/ui/Iframe\",\"tinymce/ui/InfoBox\",\"tinymce/ui/Label\",\"tinymce/ui/Toolbar\",\"tinymce/ui/MenuBar\",\"tinymce/ui/MenuButton\",\"tinymce/ui/MenuItem\",\"tinymce/ui/Throbber\",\"tinymce/ui/Menu\",\"tinymce/ui/ListBox\",\"tinymce/ui/Radio\",\"tinymce/ui/ResizeHandle\",\"tinymce/ui/SelectBox\",\"tinymce/ui/Slider\",\"tinymce/ui/Spacer\",\"tinymce/ui/SplitButton\",\"tinymce/ui/StackLayout\",\"tinymce/ui/TabPanel\",\"tinymce/ui/TextBox\"]);\n})(window);\n\n/*** EXPORTS FROM exports-loader ***/\nmodule.exports = window.tinymce;\n}.call(window));\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(126).setImmediate))//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTc4LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vfi90aW55bWNlL3RpbnltY2UuanM/N2VlYyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKioqIElNUE9SVFMgRlJPTSBpbXBvcnRzLWxvYWRlciAqKiovXG4oZnVuY3Rpb24oKSB7XG5cbi8vIDQuNS4xICgyMDE2LTEyLTA3KVxuXG4vKipcbiAqIENvbXBpbGVkIGlubGluZSB2ZXJzaW9uLiAoTGlicmFyeSBtb2RlKVxuICovXG5cbi8qanNoaW50IHNtYXJ0dGFiczp0cnVlLCB1bmRlZjp0cnVlLCBsYXRlZGVmOnRydWUsIGN1cmx5OnRydWUsIGJpdHdpc2U6dHJ1ZSwgY2FtZWxjYXNlOnRydWUgKi9cbi8qZ2xvYmFscyAkY29kZSAqL1xuXG4oZnVuY3Rpb24oZXhwb3J0cywgdW5kZWZpbmVkKSB7XG5cdFwidXNlIHN0cmljdFwiO1xuXG5cdHZhciBtb2R1bGVzID0ge307XG5cblx0ZnVuY3Rpb24gcmVxdWlyZShpZHMsIGNhbGxiYWNrKSB7XG5cdFx0dmFyIG1vZHVsZSwgZGVmcyA9IFtdO1xuXG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBpZHMubGVuZ3RoOyArK2kpIHtcblx0XHRcdG1vZHVsZSA9IG1vZHVsZXNbaWRzW2ldXSB8fCByZXNvbHZlKGlkc1tpXSk7XG5cdFx0XHRpZiAoIW1vZHVsZSkge1xuXHRcdFx0XHR0aHJvdyAnbW9kdWxlIGRlZmluaXRpb24gZGVwZW5kZWN5IG5vdCBmb3VuZDogJyArIGlkc1tpXTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmcy5wdXNoKG1vZHVsZSk7XG5cdFx0fVxuXG5cdFx0Y2FsbGJhY2suYXBwbHkobnVsbCwgZGVmcyk7XG5cdH1cblxuXHRmdW5jdGlvbiBkZWZpbmUoaWQsIGRlcGVuZGVuY2llcywgZGVmaW5pdGlvbikge1xuXHRcdGlmICh0eXBlb2YgaWQgIT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0aHJvdyAnaW52YWxpZCBtb2R1bGUgZGVmaW5pdGlvbiwgbW9kdWxlIGlkIG11c3QgYmUgZGVmaW5lZCBhbmQgYmUgYSBzdHJpbmcnO1xuXHRcdH1cblxuXHRcdGlmIChkZXBlbmRlbmNpZXMgPT09IHVuZGVmaW5lZCkge1xuXHRcdFx0dGhyb3cgJ2ludmFsaWQgbW9kdWxlIGRlZmluaXRpb24sIGRlcGVuZGVuY2llcyBtdXN0IGJlIHNwZWNpZmllZCc7XG5cdFx0fVxuXG5cdFx0aWYgKGRlZmluaXRpb24gPT09IHVuZGVmaW5lZCkge1xuXHRcdFx0dGhyb3cgJ2ludmFsaWQgbW9kdWxlIGRlZmluaXRpb24sIGRlZmluaXRpb24gZnVuY3Rpb24gbXVzdCBiZSBzcGVjaWZpZWQnO1xuXHRcdH1cblxuXHRcdHJlcXVpcmUoZGVwZW5kZW5jaWVzLCBmdW5jdGlvbigpIHtcblx0XHRcdG1vZHVsZXNbaWRdID0gZGVmaW5pdGlvbi5hcHBseShudWxsLCBhcmd1bWVudHMpO1xuXHRcdH0pO1xuXHR9XG5cblx0ZnVuY3Rpb24gZGVmaW5lZChpZCkge1xuXHRcdHJldHVybiAhIW1vZHVsZXNbaWRdO1xuXHR9XG5cblx0ZnVuY3Rpb24gcmVzb2x2ZShpZCkge1xuXHRcdHZhciB0YXJnZXQgPSBleHBvcnRzO1xuXHRcdHZhciBmcmFnbWVudHMgPSBpZC5zcGxpdCgvWy5cXC9dLyk7XG5cblx0XHRmb3IgKHZhciBmaSA9IDA7IGZpIDwgZnJhZ21lbnRzLmxlbmd0aDsgKytmaSkge1xuXHRcdFx0aWYgKCF0YXJnZXRbZnJhZ21lbnRzW2ZpXV0pIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHR0YXJnZXQgPSB0YXJnZXRbZnJhZ21lbnRzW2ZpXV07XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRhcmdldDtcblx0fVxuXG5cdGZ1bmN0aW9uIGV4cG9zZShpZHMpIHtcblx0XHR2YXIgaSwgdGFyZ2V0LCBpZCwgZnJhZ21lbnRzLCBwcml2YXRlTW9kdWxlcztcblxuXHRcdGZvciAoaSA9IDA7IGkgPCBpZHMubGVuZ3RoOyBpKyspIHtcblx0XHRcdHRhcmdldCA9IGV4cG9ydHM7XG5cdFx0XHRpZCA9IGlkc1tpXTtcblx0XHRcdGZyYWdtZW50cyA9IGlkLnNwbGl0KC9bLlxcL10vKTtcblxuXHRcdFx0Zm9yICh2YXIgZmkgPSAwOyBmaSA8IGZyYWdtZW50cy5sZW5ndGggLSAxOyArK2ZpKSB7XG5cdFx0XHRcdGlmICh0YXJnZXRbZnJhZ21lbnRzW2ZpXV0gPT09IHVuZGVmaW5lZCkge1xuXHRcdFx0XHRcdHRhcmdldFtmcmFnbWVudHNbZmldXSA9IHt9O1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0dGFyZ2V0ID0gdGFyZ2V0W2ZyYWdtZW50c1tmaV1dO1xuXHRcdFx0fVxuXG5cdFx0XHR0YXJnZXRbZnJhZ21lbnRzW2ZyYWdtZW50cy5sZW5ndGggLSAxXV0gPSBtb2R1bGVzW2lkXTtcblx0XHR9XG5cblx0XHQvLyBFeHBvc2UgcHJpdmF0ZSBtb2R1bGVzIGZvciB1bml0IHRlc3RzXG5cdFx0aWYgKGV4cG9ydHMuQU1ETENfVEVTVFMpIHtcblx0XHRcdHByaXZhdGVNb2R1bGVzID0gZXhwb3J0cy5wcml2YXRlTW9kdWxlcyB8fCB7fTtcblxuXHRcdFx0Zm9yIChpZCBpbiBtb2R1bGVzKSB7XG5cdFx0XHRcdHByaXZhdGVNb2R1bGVzW2lkXSA9IG1vZHVsZXNbaWRdO1xuXHRcdFx0fVxuXG5cdFx0XHRmb3IgKGkgPSAwOyBpIDwgaWRzLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRcdGRlbGV0ZSBwcml2YXRlTW9kdWxlc1tpZHNbaV1dO1xuXHRcdFx0fVxuXG5cdFx0XHRleHBvcnRzLnByaXZhdGVNb2R1bGVzID0gcHJpdmF0ZU1vZHVsZXM7XG5cdFx0fVxuXHR9XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy9nZW9tL1JlY3QuanNcblxuLyoqXG4gKiBSZWN0LmpzXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgTEdQTCBMaWNlbnNlLlxuICogQ29weXJpZ2h0IChjKSAxOTk5LTIwMTUgRXBob3ggQ29ycC4gQWxsIHJpZ2h0cyByZXNlcnZlZFxuICpcbiAqIExpY2Vuc2U6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vbGljZW5zZVxuICogQ29udHJpYnV0aW5nOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2NvbnRyaWJ1dGluZ1xuICovXG5cbi8qKlxuICogQ29udGFpbnMgdmFyaW91cyB0b29scyBmb3IgcmVjdC9wb3NpdGlvbiBjYWxjdWxhdGlvbi5cbiAqXG4gKiBAY2xhc3MgdGlueW1jZS5nZW9tLlJlY3RcbiAqL1xuZGVmaW5lKFwidGlueW1jZS9nZW9tL1JlY3RcIiwgW1xuXSwgZnVuY3Rpb24oKSB7XG5cdFwidXNlIHN0cmljdFwiO1xuXG5cdHZhciBtaW4gPSBNYXRoLm1pbiwgbWF4ID0gTWF0aC5tYXgsIHJvdW5kID0gTWF0aC5yb3VuZDtcblxuXHQvKipcblx0ICogUmV0dXJucyB0aGUgcmVjdCBwb3NpdGlvbmVkIGJhc2VkIG9uIHRoZSByZWxhdGl2ZSBwb3NpdGlvbiBuYW1lXG5cdCAqIHRvIHRoZSB0YXJnZXQgcmVjdC5cblx0ICpcblx0ICogQG1ldGhvZCByZWxhdGl2ZVBvc2l0aW9uXG5cdCAqIEBwYXJhbSB7UmVjdH0gcmVjdCBTb3VyY2UgcmVjdCB0byBtb2RpZnkgaW50byBhIG5ldyByZWN0LlxuXHQgKiBAcGFyYW0ge1JlY3R9IHRhcmdldFJlY3QgUmVjdCB0byBtb3ZlIHJlbGF0aXZlIHRvIGJhc2VkIG9uIHRoZSByZWwgb3B0aW9uLlxuXHQgKiBAcGFyYW0ge1N0cmluZ30gcmVsIFJlbGF0aXZlIHBvc2l0aW9uLiBGb3IgZXhhbXBsZTogdHItYmwuXG5cdCAqL1xuXHRmdW5jdGlvbiByZWxhdGl2ZVBvc2l0aW9uKHJlY3QsIHRhcmdldFJlY3QsIHJlbCkge1xuXHRcdHZhciB4LCB5LCB3LCBoLCB0YXJnZXRXLCB0YXJnZXRIO1xuXG5cdFx0eCA9IHRhcmdldFJlY3QueDtcblx0XHR5ID0gdGFyZ2V0UmVjdC55O1xuXHRcdHcgPSByZWN0Lnc7XG5cdFx0aCA9IHJlY3QuaDtcblx0XHR0YXJnZXRXID0gdGFyZ2V0UmVjdC53O1xuXHRcdHRhcmdldEggPSB0YXJnZXRSZWN0Lmg7XG5cblx0XHRyZWwgPSAocmVsIHx8ICcnKS5zcGxpdCgnJyk7XG5cblx0XHRpZiAocmVsWzBdID09PSAnYicpIHtcblx0XHRcdHkgKz0gdGFyZ2V0SDtcblx0XHR9XG5cblx0XHRpZiAocmVsWzFdID09PSAncicpIHtcblx0XHRcdHggKz0gdGFyZ2V0Vztcblx0XHR9XG5cblx0XHRpZiAocmVsWzBdID09PSAnYycpIHtcblx0XHRcdHkgKz0gcm91bmQodGFyZ2V0SCAvIDIpO1xuXHRcdH1cblxuXHRcdGlmIChyZWxbMV0gPT09ICdjJykge1xuXHRcdFx0eCArPSByb3VuZCh0YXJnZXRXIC8gMik7XG5cdFx0fVxuXG5cdFx0aWYgKHJlbFszXSA9PT0gJ2InKSB7XG5cdFx0XHR5IC09IGg7XG5cdFx0fVxuXG5cdFx0aWYgKHJlbFs0XSA9PT0gJ3InKSB7XG5cdFx0XHR4IC09IHc7XG5cdFx0fVxuXG5cdFx0aWYgKHJlbFszXSA9PT0gJ2MnKSB7XG5cdFx0XHR5IC09IHJvdW5kKGggLyAyKTtcblx0XHR9XG5cblx0XHRpZiAocmVsWzRdID09PSAnYycpIHtcblx0XHRcdHggLT0gcm91bmQodyAvIDIpO1xuXHRcdH1cblxuXHRcdHJldHVybiBjcmVhdGUoeCwgeSwgdywgaCk7XG5cdH1cblxuXHQvKipcblx0ICogVGVzdHMgdmFyaW91cyBwb3NpdGlvbnMgdG8gZ2V0IHRoZSBtb3N0IHN1aXRhYmxlIG9uZS5cblx0ICpcblx0ICogQG1ldGhvZCBmaW5kQmVzdFJlbGF0aXZlUG9zaXRpb25cblx0ICogQHBhcmFtIHtSZWN0fSByZWN0IFJlY3QgdG8gdXNlIGFzIHNvdXJjZS5cblx0ICogQHBhcmFtIHtSZWN0fSB0YXJnZXRSZWN0IFJlY3QgdG8gbW92ZSByZWxhdGl2ZSB0by5cblx0ICogQHBhcmFtIHtSZWN0fSBjb25zdHJhaW5SZWN0IFJlY3QgdG8gY29uc3RyYWluIHdpdGhpbi5cblx0ICogQHBhcmFtIHtBcnJheX0gcmVscyBBcnJheSBvZiByZWxhdGl2ZSBwb3NpdGlvbnMgdG8gdGVzdCBhZ2FpbnN0LlxuXHQgKi9cblx0ZnVuY3Rpb24gZmluZEJlc3RSZWxhdGl2ZVBvc2l0aW9uKHJlY3QsIHRhcmdldFJlY3QsIGNvbnN0cmFpblJlY3QsIHJlbHMpIHtcblx0XHR2YXIgcG9zLCBpO1xuXG5cdFx0Zm9yIChpID0gMDsgaSA8IHJlbHMubGVuZ3RoOyBpKyspIHtcblx0XHRcdHBvcyA9IHJlbGF0aXZlUG9zaXRpb24ocmVjdCwgdGFyZ2V0UmVjdCwgcmVsc1tpXSk7XG5cblx0XHRcdGlmIChwb3MueCA+PSBjb25zdHJhaW5SZWN0LnggJiYgcG9zLnggKyBwb3MudyA8PSBjb25zdHJhaW5SZWN0LncgKyBjb25zdHJhaW5SZWN0LnggJiZcblx0XHRcdFx0cG9zLnkgPj0gY29uc3RyYWluUmVjdC55ICYmIHBvcy55ICsgcG9zLmggPD0gY29uc3RyYWluUmVjdC5oICsgY29uc3RyYWluUmVjdC55KSB7XG5cdFx0XHRcdHJldHVybiByZWxzW2ldO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiBudWxsO1xuXHR9XG5cblx0LyoqXG5cdCAqIEluZmxhdGVzIHRoZSByZWN0IGluIGFsbCBkaXJlY3Rpb25zLlxuXHQgKlxuXHQgKiBAbWV0aG9kIGluZmxhdGVcblx0ICogQHBhcmFtIHtSZWN0fSByZWN0IFJlY3QgdG8gZXhwYW5kLlxuXHQgKiBAcGFyYW0ge051bWJlcn0gdyBSZWxhdGl2ZSB3aWR0aCB0byBleHBhbmQgYnkuXG5cdCAqIEBwYXJhbSB7TnVtYmVyfSBoIFJlbGF0aXZlIGhlaWdodCB0byBleHBhbmQgYnkuXG5cdCAqIEByZXR1cm4ge1JlY3R9IE5ldyBleHBhbmRlZCByZWN0LlxuXHQgKi9cblx0ZnVuY3Rpb24gaW5mbGF0ZShyZWN0LCB3LCBoKSB7XG5cdFx0cmV0dXJuIGNyZWF0ZShyZWN0LnggLSB3LCByZWN0LnkgLSBoLCByZWN0LncgKyB3ICogMiwgcmVjdC5oICsgaCAqIDIpO1xuXHR9XG5cblx0LyoqXG5cdCAqIFJldHVybnMgdGhlIGludGVyc2VjdGlvbiBvZiB0aGUgc3BlY2lmaWVkIHJlY3RhbmdsZXMuXG5cdCAqXG5cdCAqIEBtZXRob2QgaW50ZXJzZWN0XG5cdCAqIEBwYXJhbSB7UmVjdH0gcmVjdCBUaGUgZmlyc3QgcmVjdGFuZ2xlIHRvIGNvbXBhcmUuXG5cdCAqIEBwYXJhbSB7UmVjdH0gY3JvcFJlY3QgVGhlIHNlY29uZCByZWN0YW5nbGUgdG8gY29tcGFyZS5cblx0ICogQHJldHVybiB7UmVjdH0gVGhlIGludGVyc2VjdGlvbiBvZiB0aGUgdHdvIHJlY3RhbmdsZXMgb3IgbnVsbCBpZiB0aGV5IGRvbid0IGludGVyc2VjdC5cblx0ICovXG5cdGZ1bmN0aW9uIGludGVyc2VjdChyZWN0LCBjcm9wUmVjdCkge1xuXHRcdHZhciB4MSwgeTEsIHgyLCB5MjtcblxuXHRcdHgxID0gbWF4KHJlY3QueCwgY3JvcFJlY3QueCk7XG5cdFx0eTEgPSBtYXgocmVjdC55LCBjcm9wUmVjdC55KTtcblx0XHR4MiA9IG1pbihyZWN0LnggKyByZWN0LncsIGNyb3BSZWN0LnggKyBjcm9wUmVjdC53KTtcblx0XHR5MiA9IG1pbihyZWN0LnkgKyByZWN0LmgsIGNyb3BSZWN0LnkgKyBjcm9wUmVjdC5oKTtcblxuXHRcdGlmICh4MiAtIHgxIDwgMCB8fCB5MiAtIHkxIDwgMCkge1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGNyZWF0ZSh4MSwgeTEsIHgyIC0geDEsIHkyIC0geTEpO1xuXHR9XG5cblx0LyoqXG5cdCAqIFJldHVybnMgYSByZWN0IGNsYW1wZWQgd2l0aGluIHRoZSBzcGVjaWZpZWQgY2xhbXAgcmVjdC4gVGhpcyBmb3JjZXMgdGhlXG5cdCAqIHJlY3QgdG8gYmUgaW5zaWRlIHRoZSBjbGFtcCByZWN0LlxuXHQgKlxuXHQgKiBAbWV0aG9kIGNsYW1wXG5cdCAqIEBwYXJhbSB7UmVjdH0gcmVjdCBSZWN0YW5nbGUgdG8gZm9yY2Ugd2l0aGluIGNsYW1wIHJlY3QuXG5cdCAqIEBwYXJhbSB7UmVjdH0gY2xhbXBSZWN0IFJlY3RhYmxlIHRvIGZvcmNlIHdpdGhpbi5cblx0ICogQHBhcmFtIHtCb29sZWFufSBmaXhlZFNpemUgVHJ1ZS9mYWxzZSBpZiBzaXplIHNob3VsZCBiZSBmaXhlZC5cblx0ICogQHJldHVybiB7UmVjdH0gQ2xhbXBlZCByZWN0LlxuXHQgKi9cblx0ZnVuY3Rpb24gY2xhbXAocmVjdCwgY2xhbXBSZWN0LCBmaXhlZFNpemUpIHtcblx0XHR2YXIgdW5kZXJmbG93WDEsIHVuZGVyZmxvd1kxLCBvdmVyZmxvd1gyLCBvdmVyZmxvd1kyLFxuXHRcdFx0eDEsIHkxLCB4MiwgeTIsIGN4MiwgY3kyO1xuXG5cdFx0eDEgPSByZWN0Lng7XG5cdFx0eTEgPSByZWN0Lnk7XG5cdFx0eDIgPSByZWN0LnggKyByZWN0Lnc7XG5cdFx0eTIgPSByZWN0LnkgKyByZWN0Lmg7XG5cdFx0Y3gyID0gY2xhbXBSZWN0LnggKyBjbGFtcFJlY3Qudztcblx0XHRjeTIgPSBjbGFtcFJlY3QueSArIGNsYW1wUmVjdC5oO1xuXG5cdFx0dW5kZXJmbG93WDEgPSBtYXgoMCwgY2xhbXBSZWN0LnggLSB4MSk7XG5cdFx0dW5kZXJmbG93WTEgPSBtYXgoMCwgY2xhbXBSZWN0LnkgLSB5MSk7XG5cdFx0b3ZlcmZsb3dYMiA9IG1heCgwLCB4MiAtIGN4Mik7XG5cdFx0b3ZlcmZsb3dZMiA9IG1heCgwLCB5MiAtIGN5Mik7XG5cblx0XHR4MSArPSB1bmRlcmZsb3dYMTtcblx0XHR5MSArPSB1bmRlcmZsb3dZMTtcblxuXHRcdGlmIChmaXhlZFNpemUpIHtcblx0XHRcdHgyICs9IHVuZGVyZmxvd1gxO1xuXHRcdFx0eTIgKz0gdW5kZXJmbG93WTE7XG5cdFx0XHR4MSAtPSBvdmVyZmxvd1gyO1xuXHRcdFx0eTEgLT0gb3ZlcmZsb3dZMjtcblx0XHR9XG5cblx0XHR4MiAtPSBvdmVyZmxvd1gyO1xuXHRcdHkyIC09IG92ZXJmbG93WTI7XG5cblx0XHRyZXR1cm4gY3JlYXRlKHgxLCB5MSwgeDIgLSB4MSwgeTIgLSB5MSk7XG5cdH1cblxuXHQvKipcblx0ICogQ3JlYXRlcyBhIG5ldyByZWN0YW5nbGUgb2JqZWN0LlxuXHQgKlxuXHQgKiBAbWV0aG9kIGNyZWF0ZVxuXHQgKiBAcGFyYW0ge051bWJlcn0geCBSZWN0YW5nbGUgeCBsb2NhdGlvbi5cblx0ICogQHBhcmFtIHtOdW1iZXJ9IHkgUmVjdGFuZ2xlIHkgbG9jYXRpb24uXG5cdCAqIEBwYXJhbSB7TnVtYmVyfSB3IFJlY3RhbmdsZSB3aWR0aC5cblx0ICogQHBhcmFtIHtOdW1iZXJ9IGggUmVjdGFuZ2xlIGhlaWdodC5cblx0ICogQHJldHVybiB7UmVjdH0gTmV3IHJlY3RhbmdsZSBvYmplY3QuXG5cdCAqL1xuXHRmdW5jdGlvbiBjcmVhdGUoeCwgeSwgdywgaCkge1xuXHRcdHJldHVybiB7eDogeCwgeTogeSwgdzogdywgaDogaH07XG5cdH1cblxuXHQvKipcblx0ICogQ3JlYXRlcyBhIG5ldyByZWN0YW5nbGUgb2JqZWN0IGZvcm0gYSBjbGllbnRSZWN0cyBvYmplY3QuXG5cdCAqXG5cdCAqIEBtZXRob2QgZnJvbUNsaWVudFJlY3Rcblx0ICogQHBhcmFtIHtDbGllbnRSZWN0fSBjbGllbnRSZWN0IERPTSBDbGllbnRSZWN0IG9iamVjdC5cblx0ICogQHJldHVybiB7UmVjdH0gTmV3IHJlY3RhbmdsZSBvYmplY3QuXG5cdCAqL1xuXHRmdW5jdGlvbiBmcm9tQ2xpZW50UmVjdChjbGllbnRSZWN0KSB7XG5cdFx0cmV0dXJuIGNyZWF0ZShjbGllbnRSZWN0LmxlZnQsIGNsaWVudFJlY3QudG9wLCBjbGllbnRSZWN0LndpZHRoLCBjbGllbnRSZWN0LmhlaWdodCk7XG5cdH1cblxuXHRyZXR1cm4ge1xuXHRcdGluZmxhdGU6IGluZmxhdGUsXG5cdFx0cmVsYXRpdmVQb3NpdGlvbjogcmVsYXRpdmVQb3NpdGlvbixcblx0XHRmaW5kQmVzdFJlbGF0aXZlUG9zaXRpb246IGZpbmRCZXN0UmVsYXRpdmVQb3NpdGlvbixcblx0XHRpbnRlcnNlY3Q6IGludGVyc2VjdCxcblx0XHRjbGFtcDogY2xhbXAsXG5cdFx0Y3JlYXRlOiBjcmVhdGUsXG5cdFx0ZnJvbUNsaWVudFJlY3Q6IGZyb21DbGllbnRSZWN0XG5cdH07XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL3V0aWwvUHJvbWlzZS5qc1xuXG4vKipcbiAqIFByb21pc2UuanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogUHJvbWlzZSBwb2x5ZmlsbCB1bmRlciBNSVQgbGljZW5zZTogaHR0cHM6Ly9naXRodWIuY29tL3RheWxvcmhha2VzL3Byb21pc2UtcG9seWZpbGxcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKiBlc2xpbnQtZGlzYWJsZSAqL1xuLyoganNoaW50IGlnbm9yZTpzdGFydCAqL1xuXG4vKipcbiAqIE1vZGlmZWQgdG8gYmUgYSBmZWF0dXJlIGZpbGwgYW5kIHdyYXBwZWQgYXMgdGlueW1jZSBtb2R1bGUuXG4gKi9cbmRlZmluZShcInRpbnltY2UvdXRpbC9Qcm9taXNlXCIsIFtdLCBmdW5jdGlvbigpIHtcblx0aWYgKHdpbmRvdy5Qcm9taXNlKSB7XG5cdFx0cmV0dXJuIHdpbmRvdy5Qcm9taXNlO1xuXHR9XG5cblx0Ly8gVXNlIHBvbHlmaWxsIGZvciBzZXRJbW1lZGlhdGUgZm9yIHBlcmZvcm1hbmNlIGdhaW5zXG5cdHZhciBhc2FwID0gUHJvbWlzZS5pbW1lZGlhdGVGbiB8fCAodHlwZW9mIHNldEltbWVkaWF0ZSA9PT0gJ2Z1bmN0aW9uJyAmJiBzZXRJbW1lZGlhdGUpIHx8XG5cdFx0ZnVuY3Rpb24oZm4pIHsgc2V0VGltZW91dChmbiwgMSk7IH07XG5cblx0Ly8gUG9seWZpbGwgZm9yIEZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kXG5cdGZ1bmN0aW9uIGJpbmQoZm4sIHRoaXNBcmcpIHtcblx0XHRyZXR1cm4gZnVuY3Rpb24oKSB7XG5cdFx0XHRmbi5hcHBseSh0aGlzQXJnLCBhcmd1bWVudHMpO1xuXHRcdH07XG5cdH1cblxuXHR2YXIgaXNBcnJheSA9IEFycmF5LmlzQXJyYXkgfHwgZnVuY3Rpb24odmFsdWUpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2YWx1ZSkgPT09IFwiW29iamVjdCBBcnJheV1cIjsgfTtcblxuXHRmdW5jdGlvbiBQcm9taXNlKGZuKSB7XG5cdFx0aWYgKHR5cGVvZiB0aGlzICE9PSAnb2JqZWN0JykgdGhyb3cgbmV3IFR5cGVFcnJvcignUHJvbWlzZXMgbXVzdCBiZSBjb25zdHJ1Y3RlZCB2aWEgbmV3Jyk7XG5cdFx0aWYgKHR5cGVvZiBmbiAhPT0gJ2Z1bmN0aW9uJykgdGhyb3cgbmV3IFR5cGVFcnJvcignbm90IGEgZnVuY3Rpb24nKTtcblx0XHR0aGlzLl9zdGF0ZSA9IG51bGw7XG5cdFx0dGhpcy5fdmFsdWUgPSBudWxsO1xuXHRcdHRoaXMuX2RlZmVycmVkcyA9IFtdO1xuXG5cdFx0ZG9SZXNvbHZlKGZuLCBiaW5kKHJlc29sdmUsIHRoaXMpLCBiaW5kKHJlamVjdCwgdGhpcykpO1xuXHR9XG5cblx0ZnVuY3Rpb24gaGFuZGxlKGRlZmVycmVkKSB7XG5cdFx0dmFyIG1lID0gdGhpcztcblx0XHRpZiAodGhpcy5fc3RhdGUgPT09IG51bGwpIHtcblx0XHRcdHRoaXMuX2RlZmVycmVkcy5wdXNoKGRlZmVycmVkKTtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cdFx0YXNhcChmdW5jdGlvbigpIHtcblx0XHRcdHZhciBjYiA9IG1lLl9zdGF0ZSA/IGRlZmVycmVkLm9uRnVsZmlsbGVkIDogZGVmZXJyZWQub25SZWplY3RlZDtcblx0XHRcdGlmIChjYiA9PT0gbnVsbCkge1xuXHRcdFx0XHQobWUuX3N0YXRlID8gZGVmZXJyZWQucmVzb2x2ZSA6IGRlZmVycmVkLnJlamVjdCkobWUuX3ZhbHVlKTtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXHRcdFx0dmFyIHJldDtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJldCA9IGNiKG1lLl92YWx1ZSk7XG5cdFx0XHR9XG5cdFx0XHRjYXRjaCAoZSkge1xuXHRcdFx0XHRkZWZlcnJlZC5yZWplY3QoZSk7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblx0XHRcdGRlZmVycmVkLnJlc29sdmUocmV0KTtcblx0XHR9KTtcblx0fVxuXG5cdGZ1bmN0aW9uIHJlc29sdmUobmV3VmFsdWUpIHtcblx0XHR0cnkgeyAvL1Byb21pc2UgUmVzb2x1dGlvbiBQcm9jZWR1cmU6IGh0dHBzOi8vZ2l0aHViLmNvbS9wcm9taXNlcy1hcGx1cy9wcm9taXNlcy1zcGVjI3RoZS1wcm9taXNlLXJlc29sdXRpb24tcHJvY2VkdXJlXG5cdFx0XHRpZiAobmV3VmFsdWUgPT09IHRoaXMpIHRocm93IG5ldyBUeXBlRXJyb3IoJ0EgcHJvbWlzZSBjYW5ub3QgYmUgcmVzb2x2ZWQgd2l0aCBpdHNlbGYuJyk7XG5cdFx0XHRpZiAobmV3VmFsdWUgJiYgKHR5cGVvZiBuZXdWYWx1ZSA9PT0gJ29iamVjdCcgfHwgdHlwZW9mIG5ld1ZhbHVlID09PSAnZnVuY3Rpb24nKSkge1xuXHRcdFx0XHR2YXIgdGhlbiA9IG5ld1ZhbHVlLnRoZW47XG5cdFx0XHRcdGlmICh0eXBlb2YgdGhlbiA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdGRvUmVzb2x2ZShiaW5kKHRoZW4sIG5ld1ZhbHVlKSwgYmluZChyZXNvbHZlLCB0aGlzKSwgYmluZChyZWplY3QsIHRoaXMpKTtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdHRoaXMuX3N0YXRlID0gdHJ1ZTtcblx0XHRcdHRoaXMuX3ZhbHVlID0gbmV3VmFsdWU7XG5cdFx0XHRmaW5hbGUuY2FsbCh0aGlzKTtcblx0XHR9IGNhdGNoIChlKSB7IHJlamVjdC5jYWxsKHRoaXMsIGUpOyB9XG5cdH1cblxuXHRmdW5jdGlvbiByZWplY3QobmV3VmFsdWUpIHtcblx0XHR0aGlzLl9zdGF0ZSA9IGZhbHNlO1xuXHRcdHRoaXMuX3ZhbHVlID0gbmV3VmFsdWU7XG5cdFx0ZmluYWxlLmNhbGwodGhpcyk7XG5cdH1cblxuXHRmdW5jdGlvbiBmaW5hbGUoKSB7XG5cdFx0Zm9yICh2YXIgaSA9IDAsIGxlbiA9IHRoaXMuX2RlZmVycmVkcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuXHRcdFx0aGFuZGxlLmNhbGwodGhpcywgdGhpcy5fZGVmZXJyZWRzW2ldKTtcblx0XHR9XG5cdFx0dGhpcy5fZGVmZXJyZWRzID0gbnVsbDtcblx0fVxuXG5cdGZ1bmN0aW9uIEhhbmRsZXIob25GdWxmaWxsZWQsIG9uUmVqZWN0ZWQsIHJlc29sdmUsIHJlamVjdCl7XG5cdFx0dGhpcy5vbkZ1bGZpbGxlZCA9IHR5cGVvZiBvbkZ1bGZpbGxlZCA9PT0gJ2Z1bmN0aW9uJyA/IG9uRnVsZmlsbGVkIDogbnVsbDtcblx0XHR0aGlzLm9uUmVqZWN0ZWQgPSB0eXBlb2Ygb25SZWplY3RlZCA9PT0gJ2Z1bmN0aW9uJyA/IG9uUmVqZWN0ZWQgOiBudWxsO1xuXHRcdHRoaXMucmVzb2x2ZSA9IHJlc29sdmU7XG5cdFx0dGhpcy5yZWplY3QgPSByZWplY3Q7XG5cdH1cblxuXHQvKipcblx0ICogVGFrZSBhIHBvdGVudGlhbGx5IG1pc2JlaGF2aW5nIHJlc29sdmVyIGZ1bmN0aW9uIGFuZCBtYWtlIHN1cmVcblx0ICogb25GdWxmaWxsZWQgYW5kIG9uUmVqZWN0ZWQgYXJlIG9ubHkgY2FsbGVkIG9uY2UuXG5cdCAqXG5cdCAqIE1ha2VzIG5vIGd1YXJhbnRlZXMgYWJvdXQgYXN5bmNocm9ueS5cblx0ICovXG5cdGZ1bmN0aW9uIGRvUmVzb2x2ZShmbiwgb25GdWxmaWxsZWQsIG9uUmVqZWN0ZWQpIHtcblx0XHR2YXIgZG9uZSA9IGZhbHNlO1xuXHRcdHRyeSB7XG5cdFx0XHRmbihmdW5jdGlvbiAodmFsdWUpIHtcblx0XHRcdFx0aWYgKGRvbmUpIHJldHVybjtcblx0XHRcdFx0ZG9uZSA9IHRydWU7XG5cdFx0XHRcdG9uRnVsZmlsbGVkKHZhbHVlKTtcblx0XHRcdH0sIGZ1bmN0aW9uIChyZWFzb24pIHtcblx0XHRcdFx0aWYgKGRvbmUpIHJldHVybjtcblx0XHRcdFx0ZG9uZSA9IHRydWU7XG5cdFx0XHRcdG9uUmVqZWN0ZWQocmVhc29uKTtcblx0XHRcdH0pO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRpZiAoZG9uZSkgcmV0dXJuO1xuXHRcdFx0ZG9uZSA9IHRydWU7XG5cdFx0XHRvblJlamVjdGVkKGV4KTtcblx0XHR9XG5cdH1cblxuXHRQcm9taXNlLnByb3RvdHlwZVsnY2F0Y2gnXSA9IGZ1bmN0aW9uIChvblJlamVjdGVkKSB7XG5cdFx0cmV0dXJuIHRoaXMudGhlbihudWxsLCBvblJlamVjdGVkKTtcblx0fTtcblxuXHRQcm9taXNlLnByb3RvdHlwZS50aGVuID0gZnVuY3Rpb24ob25GdWxmaWxsZWQsIG9uUmVqZWN0ZWQpIHtcblx0XHR2YXIgbWUgPSB0aGlzO1xuXHRcdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcblx0XHRcdGhhbmRsZS5jYWxsKG1lLCBuZXcgSGFuZGxlcihvbkZ1bGZpbGxlZCwgb25SZWplY3RlZCwgcmVzb2x2ZSwgcmVqZWN0KSk7XG5cdFx0fSk7XG5cdH07XG5cblx0UHJvbWlzZS5hbGwgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMubGVuZ3RoID09PSAxICYmIGlzQXJyYXkoYXJndW1lbnRzWzBdKSA/IGFyZ3VtZW50c1swXSA6IGFyZ3VtZW50cyk7XG5cblx0XHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuXHRcdFx0aWYgKGFyZ3MubGVuZ3RoID09PSAwKSByZXR1cm4gcmVzb2x2ZShbXSk7XG5cdFx0XHR2YXIgcmVtYWluaW5nID0gYXJncy5sZW5ndGg7XG5cdFx0XHRmdW5jdGlvbiByZXMoaSwgdmFsKSB7XG5cdFx0XHRcdHRyeSB7XG5cdFx0XHRcdFx0aWYgKHZhbCAmJiAodHlwZW9mIHZhbCA9PT0gJ29iamVjdCcgfHwgdHlwZW9mIHZhbCA9PT0gJ2Z1bmN0aW9uJykpIHtcblx0XHRcdFx0XHRcdHZhciB0aGVuID0gdmFsLnRoZW47XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mIHRoZW4gPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0dGhlbi5jYWxsKHZhbCwgZnVuY3Rpb24gKHZhbCkgeyByZXMoaSwgdmFsKTsgfSwgcmVqZWN0KTtcblx0XHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRhcmdzW2ldID0gdmFsO1xuXHRcdFx0XHRcdGlmICgtLXJlbWFpbmluZyA9PT0gMCkge1xuXHRcdFx0XHRcdFx0cmVzb2x2ZShhcmdzKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdFx0cmVqZWN0KGV4KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBhcmdzLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRcdHJlcyhpLCBhcmdzW2ldKTtcblx0XHRcdH1cblx0XHR9KTtcblx0fTtcblxuXHRQcm9taXNlLnJlc29sdmUgPSBmdW5jdGlvbiAodmFsdWUpIHtcblx0XHRpZiAodmFsdWUgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZS5jb25zdHJ1Y3RvciA9PT0gUHJvbWlzZSkge1xuXHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdH1cblxuXHRcdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkge1xuXHRcdFx0cmVzb2x2ZSh2YWx1ZSk7XG5cdFx0fSk7XG5cdH07XG5cblx0UHJvbWlzZS5yZWplY3QgPSBmdW5jdGlvbiAodmFsdWUpIHtcblx0XHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuXHRcdFx0cmVqZWN0KHZhbHVlKTtcblx0XHR9KTtcblx0fTtcblxuXHRQcm9taXNlLnJhY2UgPSBmdW5jdGlvbiAodmFsdWVzKSB7XG5cdFx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcblx0XHRcdGZvcih2YXIgaSA9IDAsIGxlbiA9IHZhbHVlcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuXHRcdFx0XHR2YWx1ZXNbaV0udGhlbihyZXNvbHZlLCByZWplY3QpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9O1xuXG5cdHJldHVybiBQcm9taXNlO1xufSk7XG5cbi8qIGpzaGludCBpZ25vcmU6ZW5kICovXG4vKiBlc2xpbnQtZW5hYmxlICovXG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy91dGlsL0RlbGF5LmpzXG5cbi8qKlxuICogRGVsYXkuanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBVdGlsaXR5IGNsYXNzIGZvciB3b3JraW5nIHdpdGggZGVsYXllZCBhY3Rpb25zIGxpa2Ugc2V0VGltZW91dC5cbiAqXG4gKiBAY2xhc3MgdGlueW1jZS51dGlsLkRlbGF5XG4gKi9cbmRlZmluZShcInRpbnltY2UvdXRpbC9EZWxheVwiLCBbXG5cdFwidGlueW1jZS91dGlsL1Byb21pc2VcIlxuXSwgZnVuY3Rpb24oUHJvbWlzZSkge1xuXHR2YXIgcmVxdWVzdEFuaW1hdGlvbkZyYW1lUHJvbWlzZTtcblxuXHRmdW5jdGlvbiByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoY2FsbGJhY2ssIGVsZW1lbnQpIHtcblx0XHR2YXIgaSwgcmVxdWVzdEFuaW1hdGlvbkZyYW1lRnVuYyA9IHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUsIHZlbmRvcnMgPSBbJ21zJywgJ21veicsICd3ZWJraXQnXTtcblxuXHRcdGZ1bmN0aW9uIGZlYXR1cmVmaWxsKGNhbGxiYWNrKSB7XG5cdFx0XHR3aW5kb3cuc2V0VGltZW91dChjYWxsYmFjaywgMCk7XG5cdFx0fVxuXG5cdFx0Zm9yIChpID0gMDsgaSA8IHZlbmRvcnMubGVuZ3RoICYmICFyZXF1ZXN0QW5pbWF0aW9uRnJhbWVGdW5jOyBpKyspIHtcblx0XHRcdHJlcXVlc3RBbmltYXRpb25GcmFtZUZ1bmMgPSB3aW5kb3dbdmVuZG9yc1tpXSArICdSZXF1ZXN0QW5pbWF0aW9uRnJhbWUnXTtcblx0XHR9XG5cblx0XHRpZiAoIXJlcXVlc3RBbmltYXRpb25GcmFtZUZ1bmMpIHtcblx0XHRcdHJlcXVlc3RBbmltYXRpb25GcmFtZUZ1bmMgPSBmZWF0dXJlZmlsbDtcblx0XHR9XG5cblx0XHRyZXF1ZXN0QW5pbWF0aW9uRnJhbWVGdW5jKGNhbGxiYWNrLCBlbGVtZW50KTtcblx0fVxuXG5cdGZ1bmN0aW9uIHdyYXBwZWRTZXRUaW1lb3V0KGNhbGxiYWNrLCB0aW1lKSB7XG5cdFx0aWYgKHR5cGVvZiB0aW1lICE9ICdudW1iZXInKSB7XG5cdFx0XHR0aW1lID0gMDtcblx0XHR9XG5cblx0XHRyZXR1cm4gc2V0VGltZW91dChjYWxsYmFjaywgdGltZSk7XG5cdH1cblxuXHRmdW5jdGlvbiB3cmFwcGVkU2V0SW50ZXJ2YWwoY2FsbGJhY2ssIHRpbWUpIHtcblx0XHRpZiAodHlwZW9mIHRpbWUgIT0gJ251bWJlcicpIHtcblx0XHRcdHRpbWUgPSAxOyAvLyBJRSA4IG5lZWRzIGl0IHRvIGJlID4gMFxuXHRcdH1cblxuXHRcdHJldHVybiBzZXRJbnRlcnZhbChjYWxsYmFjaywgdGltZSk7XG5cdH1cblxuXHRmdW5jdGlvbiB3cmFwcGVkQ2xlYXJUaW1lb3V0KGlkKSB7XG5cdFx0cmV0dXJuIGNsZWFyVGltZW91dChpZCk7XG5cdH1cblxuXHRmdW5jdGlvbiB3cmFwcGVkQ2xlYXJJbnRlcnZhbChpZCkge1xuXHRcdHJldHVybiBjbGVhckludGVydmFsKGlkKTtcblx0fVxuXG5cdGZ1bmN0aW9uIGRlYm91bmNlKGNhbGxiYWNrLCB0aW1lKSB7XG5cdFx0dmFyIHRpbWVyLCBmdW5jO1xuXG5cdFx0ZnVuYyA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIGFyZ3MgPSBhcmd1bWVudHM7XG5cblx0XHRcdGNsZWFyVGltZW91dCh0aW1lcik7XG5cblx0XHRcdHRpbWVyID0gd3JhcHBlZFNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG5cdFx0XHRcdGNhbGxiYWNrLmFwcGx5KHRoaXMsIGFyZ3MpO1xuXHRcdFx0fSwgdGltZSk7XG5cdFx0fTtcblxuXHRcdGZ1bmMuc3RvcCA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0Y2xlYXJUaW1lb3V0KHRpbWVyKTtcblx0XHR9O1xuXG5cdFx0cmV0dXJuIGZ1bmM7XG5cdH1cblxuXHRyZXR1cm4ge1xuXHRcdC8qKlxuXHRcdCAqIFJlcXVlc3RzIGFuIGFuaW1hdGlvbiBmcmFtZSBhbmQgZmFsbGJhY2tzIHRvIGEgdGltZW91dCBvbiBvbGRlciBicm93c2Vycy5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgcmVxdWVzdEFuaW1hdGlvbkZyYW1lXG5cdFx0ICogQHBhcmFtIHtmdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgdG8gZXhlY3V0ZSB3aGVuIGEgbmV3IGZyYW1lIGlzIGF2YWlsYWJsZS5cblx0XHQgKiBAcGFyYW0ge0RPTUVsZW1lbnR9IGVsZW1lbnQgT3B0aW9uYWwgZWxlbWVudCB0byBzY29wZSBpdCB0by5cblx0XHQgKi9cblx0XHRyZXF1ZXN0QW5pbWF0aW9uRnJhbWU6IGZ1bmN0aW9uKGNhbGxiYWNrLCBlbGVtZW50KSB7XG5cdFx0XHRpZiAocmVxdWVzdEFuaW1hdGlvbkZyYW1lUHJvbWlzZSkge1xuXHRcdFx0XHRyZXF1ZXN0QW5pbWF0aW9uRnJhbWVQcm9taXNlLnRoZW4oY2FsbGJhY2spO1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdHJlcXVlc3RBbmltYXRpb25GcmFtZVByb21pc2UgPSBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlKSB7XG5cdFx0XHRcdGlmICghZWxlbWVudCkge1xuXHRcdFx0XHRcdGVsZW1lbnQgPSBkb2N1bWVudC5ib2R5O1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmVxdWVzdEFuaW1hdGlvbkZyYW1lKHJlc29sdmUsIGVsZW1lbnQpO1xuXHRcdFx0fSkudGhlbihjYWxsYmFjayk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFNldHMgYSB0aW1lciBpbiBtcyBhbmQgZXhlY3V0ZXMgdGhlIHNwZWNpZmllZCBjYWxsYmFjayB3aGVuIHRoZSB0aW1lciBydW5zIG91dC5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2Qgc2V0VGltZW91dFxuXHRcdCAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIHRvIGV4ZWN1dGUgd2hlbiB0aW1lciBydW5zIG91dC5cblx0XHQgKiBAcGFyYW0ge051bWJlcn0gdGltZSBPcHRpb25hbCB0aW1lIHRvIHdhaXQgYmVmb3JlIHRoZSBjYWxsYmFjayBpcyBleGVjdXRlZCwgZGVmYXVsdHMgdG8gMC5cblx0XHQgKiBAcmV0dXJuIHtOdW1iZXJ9IFRpbWVvdXQgaWQgbnVtYmVyLlxuXHRcdCAqL1xuXHRcdHNldFRpbWVvdXQ6IHdyYXBwZWRTZXRUaW1lb3V0LFxuXG5cdFx0LyoqXG5cdFx0ICogU2V0cyBhbiBpbnRlcnZhbCB0aW1lciBpbiBtcyBhbmQgZXhlY3V0ZXMgdGhlIHNwZWNpZmllZCBjYWxsYmFjayBhdCBldmVyeSBpbnRlcnZhbCBvZiB0aGF0IHRpbWUuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHNldEludGVydmFsXG5cdFx0ICogQHBhcmFtIHtmdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgdG8gZXhlY3V0ZSB3aGVuIGludGVydmFsIHRpbWUgcnVucyBvdXQuXG5cdFx0ICogQHBhcmFtIHtOdW1iZXJ9IHRpbWUgT3B0aW9uYWwgdGltZSB0byB3YWl0IGJlZm9yZSB0aGUgY2FsbGJhY2sgaXMgZXhlY3V0ZWQsIGRlZmF1bHRzIHRvIDAuXG5cdFx0ICogQHJldHVybiB7TnVtYmVyfSBUaW1lb3V0IGlkIG51bWJlci5cblx0XHQgKi9cblx0XHRzZXRJbnRlcnZhbDogd3JhcHBlZFNldEludGVydmFsLFxuXG5cdFx0LyoqXG5cdFx0ICogU2V0cyBhbiBlZGl0b3IgdGltZW91dCBpdCdzIHNpbWlsYXIgdG8gc2V0VGltZW91dCBleGNlcHQgdGhhdCBpdCBjaGVja3MgaWYgdGhlIGVkaXRvciBpbnN0YW5jZSBpc1xuXHRcdCAqIHN0aWxsIGFsaXZlIHdoZW4gdGhlIGNhbGxiYWNrIGdldHMgZXhlY3V0ZWQuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHNldEVkaXRvclRpbWVvdXRcblx0XHQgKiBAcGFyYW0ge3RpbnltY2UuRWRpdG9yfSBlZGl0b3IgRWRpdG9yIGluc3RhbmNlIHRvIGNoZWNrIHRoZSByZW1vdmVkIHN0YXRlIG9uLlxuXHRcdCAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIHRvIGV4ZWN1dGUgd2hlbiB0aW1lciBydW5zIG91dC5cblx0XHQgKiBAcGFyYW0ge051bWJlcn0gdGltZSBPcHRpb25hbCB0aW1lIHRvIHdhaXQgYmVmb3JlIHRoZSBjYWxsYmFjayBpcyBleGVjdXRlZCwgZGVmYXVsdHMgdG8gMC5cblx0XHQgKiBAcmV0dXJuIHtOdW1iZXJ9IFRpbWVvdXQgaWQgbnVtYmVyLlxuXHRcdCAqL1xuXHRcdHNldEVkaXRvclRpbWVvdXQ6IGZ1bmN0aW9uKGVkaXRvciwgY2FsbGJhY2ssIHRpbWUpIHtcblx0XHRcdHJldHVybiB3cmFwcGVkU2V0VGltZW91dChmdW5jdGlvbigpIHtcblx0XHRcdFx0aWYgKCFlZGl0b3IucmVtb3ZlZCkge1xuXHRcdFx0XHRcdGNhbGxiYWNrKCk7XG5cdFx0XHRcdH1cblx0XHRcdH0sIHRpbWUpO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBTZXRzIGFuIGludGVydmFsIHRpbWVyIGl0J3Mgc2ltaWxhciB0byBzZXRJbnRlcnZhbCBleGNlcHQgdGhhdCBpdCBjaGVja3MgaWYgdGhlIGVkaXRvciBpbnN0YW5jZSBpc1xuXHRcdCAqIHN0aWxsIGFsaXZlIHdoZW4gdGhlIGNhbGxiYWNrIGdldHMgZXhlY3V0ZWQuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHNldEVkaXRvckludGVydmFsXG5cdFx0ICogQHBhcmFtIHtmdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgdG8gZXhlY3V0ZSB3aGVuIGludGVydmFsIHRpbWUgcnVucyBvdXQuXG5cdFx0ICogQHBhcmFtIHtOdW1iZXJ9IHRpbWUgT3B0aW9uYWwgdGltZSB0byB3YWl0IGJlZm9yZSB0aGUgY2FsbGJhY2sgaXMgZXhlY3V0ZWQsIGRlZmF1bHRzIHRvIDAuXG5cdFx0ICogQHJldHVybiB7TnVtYmVyfSBUaW1lb3V0IGlkIG51bWJlci5cblx0XHQgKi9cblx0XHRzZXRFZGl0b3JJbnRlcnZhbDogZnVuY3Rpb24oZWRpdG9yLCBjYWxsYmFjaywgdGltZSkge1xuXHRcdFx0dmFyIHRpbWVyO1xuXG5cdFx0XHR0aW1lciA9IHdyYXBwZWRTZXRJbnRlcnZhbChmdW5jdGlvbigpIHtcblx0XHRcdFx0aWYgKCFlZGl0b3IucmVtb3ZlZCkge1xuXHRcdFx0XHRcdGNhbGxiYWNrKCk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y2xlYXJJbnRlcnZhbCh0aW1lcik7XG5cdFx0XHRcdH1cblx0XHRcdH0sIHRpbWUpO1xuXG5cdFx0XHRyZXR1cm4gdGltZXI7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIENyZWF0ZXMgZGVib3VuY2VkIGNhbGxiYWNrIGZ1bmN0aW9uIHRoYXQgb25seSBnZXRzIGV4ZWN1dGVkIG9uY2Ugd2l0aGluIHRoZSBzcGVjaWZpZWQgdGltZS5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgZGVib3VuY2Vcblx0XHQgKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayB0byBleGVjdXRlIHdoZW4gdGltZXIgZmluaXNoZXMuXG5cdFx0ICogQHBhcmFtIHtOdW1iZXJ9IHRpbWUgT3B0aW9uYWwgdGltZSB0byB3YWl0IGJlZm9yZSB0aGUgY2FsbGJhY2sgaXMgZXhlY3V0ZWQsIGRlZmF1bHRzIHRvIDAuXG5cdFx0ICogQHJldHVybiB7RnVuY3Rpb259IGRlYm91bmNlZCBmdW5jdGlvbiBjYWxsYmFjay5cblx0XHQgKi9cblx0XHRkZWJvdW5jZTogZGVib3VuY2UsXG5cblx0XHQvLyBUaHJvdHRsZSBuZWVkcyB0byBiZSBkZWJvdW5jZSBkdWUgdG8gYmFja3dhcmRzIGNvbXBhdGliaWxpdHkuXG5cdFx0dGhyb3R0bGU6IGRlYm91bmNlLFxuXG5cdFx0LyoqXG5cdFx0ICogQ2xlYXJzIGFuIGludGVydmFsIHRpbWVyIHNvIGl0IHdvbid0IGV4ZWN1dGUuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGNsZWFySW50ZXJ2YWxcblx0XHQgKiBAcGFyYW0ge051bWJlcn0gSW50ZXJ2YWwgdGltZXIgaWQgbnVtYmVyLlxuXHRcdCAqL1xuXHRcdGNsZWFySW50ZXJ2YWw6IHdyYXBwZWRDbGVhckludGVydmFsLFxuXG5cdFx0LyoqXG5cdFx0ICogQ2xlYXJzIGFuIHRpbWVvdXQgdGltZXIgc28gaXQgd29uJ3QgZXhlY3V0ZS5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgY2xlYXJUaW1lb3V0XG5cdFx0ICogQHBhcmFtIHtOdW1iZXJ9IFRpbWVvdXQgdGltZXIgaWQgbnVtYmVyLlxuXHRcdCAqL1xuXHRcdGNsZWFyVGltZW91dDogd3JhcHBlZENsZWFyVGltZW91dFxuXHR9O1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy9FbnYuanNcblxuLyoqXG4gKiBFbnYuanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBUaGlzIGNsYXNzIGNvbnRhaW5zIHZhcmlvdXMgZW52aXJvbm1lbnQgY29uc3RhbnRzIGxpa2UgYnJvd3NlciB2ZXJzaW9ucyBldGMuXG4gKiBOb3JtYWxseSB5b3UgZG9uJ3Qgd2FudCB0byBzbmlmZiBzcGVjaWZpYyBicm93c2VyIHZlcnNpb25zIGJ1dCBzb21ldGltZXMgeW91IGhhdmVcbiAqIHRvIHdoZW4gaXQncyBpbXBvc3NpYmxlIHRvIGZlYXR1cmUgZGV0ZWN0LiBTbyB1c2UgdGhpcyB3aXRoIGNhcmUuXG4gKlxuICogQGNsYXNzIHRpbnltY2UuRW52XG4gKiBAc3RhdGljXG4gKi9cbmRlZmluZShcInRpbnltY2UvRW52XCIsIFtdLCBmdW5jdGlvbigpIHtcblx0dmFyIG5hdiA9IG5hdmlnYXRvciwgdXNlckFnZW50ID0gbmF2LnVzZXJBZ2VudDtcblx0dmFyIG9wZXJhLCB3ZWJraXQsIGllLCBpZTExLCBpZTEyLCBnZWNrbywgbWFjLCBpRGV2aWNlLCBhbmRyb2lkLCBmaWxlQXBpLCBwaG9uZSwgdGFibGV0LCB3aW5kb3dzUGhvbmU7XG5cblx0ZnVuY3Rpb24gbWF0Y2hNZWRpYVF1ZXJ5KHF1ZXJ5KSB7XG5cdFx0cmV0dXJuIFwibWF0Y2hNZWRpYVwiIGluIHdpbmRvdyA/IG1hdGNoTWVkaWEocXVlcnkpLm1hdGNoZXMgOiBmYWxzZTtcblx0fVxuXG5cdG9wZXJhID0gd2luZG93Lm9wZXJhICYmIHdpbmRvdy5vcGVyYS5idWlsZE51bWJlcjtcblx0YW5kcm9pZCA9IC9BbmRyb2lkLy50ZXN0KHVzZXJBZ2VudCk7XG5cdHdlYmtpdCA9IC9XZWJLaXQvLnRlc3QodXNlckFnZW50KTtcblx0aWUgPSAhd2Via2l0ICYmICFvcGVyYSAmJiAoL01TSUUvZ2kpLnRlc3QodXNlckFnZW50KSAmJiAoL0V4cGxvcmVyL2dpKS50ZXN0KG5hdi5hcHBOYW1lKTtcblx0aWUgPSBpZSAmJiAvTVNJRSAoXFx3KylcXC4vLmV4ZWModXNlckFnZW50KVsxXTtcblx0aWUxMSA9IHVzZXJBZ2VudC5pbmRleE9mKCdUcmlkZW50LycpICE9IC0xICYmICh1c2VyQWdlbnQuaW5kZXhPZigncnY6JykgIT0gLTEgfHwgbmF2LmFwcE5hbWUuaW5kZXhPZignTmV0c2NhcGUnKSAhPSAtMSkgPyAxMSA6IGZhbHNlO1xuXHRpZTEyID0gKHVzZXJBZ2VudC5pbmRleE9mKCdFZGdlLycpICE9IC0xICYmICFpZSAmJiAhaWUxMSkgPyAxMiA6IGZhbHNlO1xuXHRpZSA9IGllIHx8IGllMTEgfHwgaWUxMjtcblx0Z2Vja28gPSAhd2Via2l0ICYmICFpZTExICYmIC9HZWNrby8udGVzdCh1c2VyQWdlbnQpO1xuXHRtYWMgPSB1c2VyQWdlbnQuaW5kZXhPZignTWFjJykgIT0gLTE7XG5cdGlEZXZpY2UgPSAvKGlQYWR8aVBob25lKS8udGVzdCh1c2VyQWdlbnQpO1xuXHRmaWxlQXBpID0gXCJGb3JtRGF0YVwiIGluIHdpbmRvdyAmJiBcIkZpbGVSZWFkZXJcIiBpbiB3aW5kb3cgJiYgXCJVUkxcIiBpbiB3aW5kb3cgJiYgISFVUkwuY3JlYXRlT2JqZWN0VVJMO1xuXHRwaG9uZSA9IG1hdGNoTWVkaWFRdWVyeShcIm9ubHkgc2NyZWVuIGFuZCAobWF4LWRldmljZS13aWR0aDogNDgwcHgpXCIpICYmIChhbmRyb2lkIHx8IGlEZXZpY2UpO1xuXHR0YWJsZXQgPSBtYXRjaE1lZGlhUXVlcnkoXCJvbmx5IHNjcmVlbiBhbmQgKG1pbi13aWR0aDogODAwcHgpXCIpICYmIChhbmRyb2lkIHx8IGlEZXZpY2UpO1xuXHR3aW5kb3dzUGhvbmUgPSB1c2VyQWdlbnQuaW5kZXhPZignV2luZG93cyBQaG9uZScpICE9IC0xO1xuXG5cdGlmIChpZTEyKSB7XG5cdFx0d2Via2l0ID0gZmFsc2U7XG5cdH1cblxuXHQvLyBJcyBhIGlQYWQvaVBob25lIGFuZCBub3Qgb24gaU9TNSBzbmlmZiB0aGUgV2ViS2l0IHZlcnNpb24gc2luY2Ugb2xkZXIgaU9TIFdlYktpdCB2ZXJzaW9uc1xuXHQvLyBzYXlzIGl0IGhhcyBjb250ZW50RWRpdGFibGUgc3VwcG9ydCBidXQgdGhlcmUgaXMgbm8gdmlzaWJsZSBjYXJldC5cblx0dmFyIGNvbnRlbnRFZGl0YWJsZSA9ICFpRGV2aWNlIHx8IGZpbGVBcGkgfHwgdXNlckFnZW50Lm1hdGNoKC9BcHBsZVdlYktpdFxcLyhcXGQqKS8pWzFdID49IDUzNDtcblxuXHRyZXR1cm4ge1xuXHRcdC8qKlxuXHRcdCAqIENvbnN0YW50IHRoYXQgaXMgdHJ1ZSBpZiB0aGUgYnJvd3NlciBpcyBPcGVyYS5cblx0XHQgKlxuXHRcdCAqIEBwcm9wZXJ0eSBvcGVyYVxuXHRcdCAqIEB0eXBlIEJvb2xlYW5cblx0XHQgKiBAZmluYWxcblx0XHQgKi9cblx0XHRvcGVyYTogb3BlcmEsXG5cblx0XHQvKipcblx0XHQgKiBDb25zdGFudCB0aGF0IGlzIHRydWUgaWYgdGhlIGJyb3dzZXIgaXMgV2ViS2l0IChTYWZhcmkvQ2hyb21lKS5cblx0XHQgKlxuXHRcdCAqIEBwcm9wZXJ0eSB3ZWJLaXRcblx0XHQgKiBAdHlwZSBCb29sZWFuXG5cdFx0ICogQGZpbmFsXG5cdFx0ICovXG5cdFx0d2Via2l0OiB3ZWJraXQsXG5cblx0XHQvKipcblx0XHQgKiBDb25zdGFudCB0aGF0IGlzIG1vcmUgdGhhbiB6ZXJvIGlmIHRoZSBicm93c2VyIGlzIElFLlxuXHRcdCAqXG5cdFx0ICogQHByb3BlcnR5IGllXG5cdFx0ICogQHR5cGUgQm9vbGVhblxuXHRcdCAqIEBmaW5hbFxuXHRcdCAqL1xuXHRcdGllOiBpZSxcblxuXHRcdC8qKlxuXHRcdCAqIENvbnN0YW50IHRoYXQgaXMgdHJ1ZSBpZiB0aGUgYnJvd3NlciBpcyBHZWNrby5cblx0XHQgKlxuXHRcdCAqIEBwcm9wZXJ0eSBnZWNrb1xuXHRcdCAqIEB0eXBlIEJvb2xlYW5cblx0XHQgKiBAZmluYWxcblx0XHQgKi9cblx0XHRnZWNrbzogZ2Vja28sXG5cblx0XHQvKipcblx0XHQgKiBDb25zdGFudCB0aGF0IGlzIHRydWUgaWYgdGhlIG9zIGlzIE1hYyBPUy5cblx0XHQgKlxuXHRcdCAqIEBwcm9wZXJ0eSBtYWNcblx0XHQgKiBAdHlwZSBCb29sZWFuXG5cdFx0ICogQGZpbmFsXG5cdFx0ICovXG5cdFx0bWFjOiBtYWMsXG5cblx0XHQvKipcblx0XHQgKiBDb25zdGFudCB0aGF0IGlzIHRydWUgaWYgdGhlIG9zIGlzIGlPUy5cblx0XHQgKlxuXHRcdCAqIEBwcm9wZXJ0eSBpT1Ncblx0XHQgKiBAdHlwZSBCb29sZWFuXG5cdFx0ICogQGZpbmFsXG5cdFx0ICovXG5cdFx0aU9TOiBpRGV2aWNlLFxuXG5cdFx0LyoqXG5cdFx0ICogQ29uc3RhbnQgdGhhdCBpcyB0cnVlIGlmIHRoZSBvcyBpcyBhbmRyb2lkLlxuXHRcdCAqXG5cdFx0ICogQHByb3BlcnR5IGFuZHJvaWRcblx0XHQgKiBAdHlwZSBCb29sZWFuXG5cdFx0ICogQGZpbmFsXG5cdFx0ICovXG5cdFx0YW5kcm9pZDogYW5kcm9pZCxcblxuXHRcdC8qKlxuXHRcdCAqIENvbnN0YW50IHRoYXQgaXMgdHJ1ZSBpZiB0aGUgYnJvd3NlciBzdXBwb3J0cyBlZGl0aW5nLlxuXHRcdCAqXG5cdFx0ICogQHByb3BlcnR5IGNvbnRlbnRFZGl0YWJsZVxuXHRcdCAqIEB0eXBlIEJvb2xlYW5cblx0XHQgKiBAZmluYWxcblx0XHQgKi9cblx0XHRjb250ZW50RWRpdGFibGU6IGNvbnRlbnRFZGl0YWJsZSxcblxuXHRcdC8qKlxuXHRcdCAqIFRyYW5zcGFyZW50IGltYWdlIGRhdGEgdXJsLlxuXHRcdCAqXG5cdFx0ICogQHByb3BlcnR5IHRyYW5zcGFyZW50U3JjXG5cdFx0ICogQHR5cGUgQm9vbGVhblxuXHRcdCAqIEBmaW5hbFxuXHRcdCAqL1xuXHRcdHRyYW5zcGFyZW50U3JjOiBcImRhdGE6aW1hZ2UvZ2lmO2Jhc2U2NCxSMGxHT0RsaEFRQUJBSUFBQUFBQUFQLy8veUg1QkFFQUFBQUFMQUFBQUFBQkFBRUFBQUlCUkFBN1wiLFxuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyB0cnVlL2ZhbHNlIGlmIHRoZSBicm93c2VyIGNhbiBvciBjYW4ndCBwbGFjZSB0aGUgY2FyZXQgYWZ0ZXIgYSBpbmxpbmUgYmxvY2sgbGlrZSBhbiBpbWFnZS5cblx0XHQgKlxuXHRcdCAqIEBwcm9wZXJ0eSBub0NhcmV0QWZ0ZXJcblx0XHQgKiBAdHlwZSBCb29sZWFuXG5cdFx0ICogQGZpbmFsXG5cdFx0ICovXG5cdFx0Y2FyZXRBZnRlcjogaWUgIT0gOCxcblxuXHRcdC8qKlxuXHRcdCAqIENvbnN0YW50IHRoYXQgaXMgdHJ1ZSBpZiB0aGUgYnJvd3NlciBzdXBwb3J0cyBuYXRpdmUgRE9NIFJhbmdlcy4gSUUgOSsuXG5cdFx0ICpcblx0XHQgKiBAcHJvcGVydHkgcmFuZ2Vcblx0XHQgKiBAdHlwZSBCb29sZWFuXG5cdFx0ICovXG5cdFx0cmFuZ2U6IHdpbmRvdy5nZXRTZWxlY3Rpb24gJiYgXCJSYW5nZVwiIGluIHdpbmRvdyxcblxuXHRcdC8qKlxuXHRcdCAqIFJldHVybnMgdGhlIElFIGRvY3VtZW50IG1vZGUgZm9yIG5vbiBJRSBicm93c2VycyB0aGlzIHdpbGwgZmFrZSBJRSAxMC5cblx0XHQgKlxuXHRcdCAqIEBwcm9wZXJ0eSBkb2N1bWVudE1vZGVcblx0XHQgKiBAdHlwZSBOdW1iZXJcblx0XHQgKi9cblx0XHRkb2N1bWVudE1vZGU6IGllICYmICFpZTEyID8gKGRvY3VtZW50LmRvY3VtZW50TW9kZSB8fCA3KSA6IDEwLFxuXG5cdFx0LyoqXG5cdFx0ICogQ29uc3RhbnQgdGhhdCBpcyB0cnVlIGlmIHRoZSBicm93c2VyIGhhcyBhIG1vZGVybiBmaWxlIGFwaS5cblx0XHQgKlxuXHRcdCAqIEBwcm9wZXJ0eSBmaWxlQXBpXG5cdFx0ICogQHR5cGUgQm9vbGVhblxuXHRcdCAqL1xuXHRcdGZpbGVBcGk6IGZpbGVBcGksXG5cblx0XHQvKipcblx0XHQgKiBDb25zdGFudCB0aGF0IGlzIHRydWUgaWYgdGhlIGJyb3dzZXIgc3VwcG9ydHMgY29udGVudEVkaXRhYmxlPWZhbHNlIHJlZ2lvbnMuXG5cdFx0ICpcblx0XHQgKiBAcHJvcGVydHkgY2VGYWxzZVxuXHRcdCAqIEB0eXBlIEJvb2xlYW5cblx0XHQgKi9cblx0XHRjZUZhbHNlOiAoaWUgPT09IGZhbHNlIHx8IGllID4gOCksXG5cblx0XHQvKipcblx0XHQgKiBDb25zdGFudCBpZiBDU1AgbW9kZSBpcyBwb3NzaWJsZSBvciBub3QuIE1lYW5pbmcgd2UgY2FuJ3QgdXNlIHNjcmlwdCB1cmxzIGZvciB0aGUgaWZyYW1lLlxuXHRcdCAqL1xuXHRcdGNhbkhhdmVDU1A6IChpZSA9PT0gZmFsc2UgfHwgaWUgPiAxMSksXG5cblx0XHRkZXNrdG9wOiAhcGhvbmUgJiYgIXRhYmxldCxcblx0XHR3aW5kb3dzUGhvbmU6IHdpbmRvd3NQaG9uZVxuXHR9O1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy9kb20vRXZlbnRVdGlscy5qc1xuXG4vKipcbiAqIEV2ZW50VXRpbHMuanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLypqc2hpbnQgbG9vcGZ1bmM6dHJ1ZSovXG4vKmVzbGludCBuby1sb29wLWZ1bmM6MCAqL1xuXG4vKipcbiAqIFRoaXMgY2xhc3Mgd3JhcHMgdGhlIGJyb3dzZXJzIG5hdGl2ZSBldmVudCBsb2dpYyB3aXRoIG1vcmUgY29udmVuaWVudCBtZXRob2RzLlxuICpcbiAqIEBjbGFzcyB0aW55bWNlLmRvbS5FdmVudFV0aWxzXG4gKi9cbmRlZmluZShcInRpbnltY2UvZG9tL0V2ZW50VXRpbHNcIiwgW1xuXHRcInRpbnltY2UvdXRpbC9EZWxheVwiLFxuXHRcInRpbnltY2UvRW52XCJcbl0sIGZ1bmN0aW9uKERlbGF5LCBFbnYpIHtcblx0XCJ1c2Ugc3RyaWN0XCI7XG5cblx0dmFyIGV2ZW50RXhwYW5kb1ByZWZpeCA9IFwibWNlLWRhdGEtXCI7XG5cdHZhciBtb3VzZUV2ZW50UmUgPSAvXig/Om1vdXNlfGNvbnRleHRtZW51KXxjbGljay87XG5cdHZhciBkZXByZWNhdGVkID0ge1xuXHRcdGtleUxvY2F0aW9uOiAxLCBsYXllclg6IDEsIGxheWVyWTogMSwgcmV0dXJuVmFsdWU6IDEsXG5cdFx0d2Via2l0TW92ZW1lbnRYOiAxLCB3ZWJraXRNb3ZlbWVudFk6IDEsIGtleUlkZW50aWZpZXI6IDFcblx0fTtcblxuXHQvKipcblx0ICogQmluZHMgYSBuYXRpdmUgZXZlbnQgdG8gYSBjYWxsYmFjayBvbiB0aGUgc3BlaWZpZWQgdGFyZ2V0LlxuXHQgKi9cblx0ZnVuY3Rpb24gYWRkRXZlbnQodGFyZ2V0LCBuYW1lLCBjYWxsYmFjaywgY2FwdHVyZSkge1xuXHRcdGlmICh0YXJnZXQuYWRkRXZlbnRMaXN0ZW5lcikge1xuXHRcdFx0dGFyZ2V0LmFkZEV2ZW50TGlzdGVuZXIobmFtZSwgY2FsbGJhY2ssIGNhcHR1cmUgfHwgZmFsc2UpO1xuXHRcdH0gZWxzZSBpZiAodGFyZ2V0LmF0dGFjaEV2ZW50KSB7XG5cdFx0XHR0YXJnZXQuYXR0YWNoRXZlbnQoJ29uJyArIG5hbWUsIGNhbGxiYWNrKTtcblx0XHR9XG5cdH1cblxuXHQvKipcblx0ICogVW5iaW5kcyBhIG5hdGl2ZSBldmVudCBjYWxsYmFjayBvbiB0aGUgc3BlY2lmaWVkIHRhcmdldC5cblx0ICovXG5cdGZ1bmN0aW9uIHJlbW92ZUV2ZW50KHRhcmdldCwgbmFtZSwgY2FsbGJhY2ssIGNhcHR1cmUpIHtcblx0XHRpZiAodGFyZ2V0LnJlbW92ZUV2ZW50TGlzdGVuZXIpIHtcblx0XHRcdHRhcmdldC5yZW1vdmVFdmVudExpc3RlbmVyKG5hbWUsIGNhbGxiYWNrLCBjYXB0dXJlIHx8IGZhbHNlKTtcblx0XHR9IGVsc2UgaWYgKHRhcmdldC5kZXRhY2hFdmVudCkge1xuXHRcdFx0dGFyZ2V0LmRldGFjaEV2ZW50KCdvbicgKyBuYW1lLCBjYWxsYmFjayk7XG5cdFx0fVxuXHR9XG5cblx0LyoqXG5cdCAqIEdldHMgdGhlIGV2ZW50IHRhcmdldCBiYXNlZCBvbiBzaGFkb3cgZG9tIHByb3BlcnRpZXMgbGlrZSBwYXRoIGFuZCBkZWVwUGF0aC5cblx0ICovXG5cdGZ1bmN0aW9uIGdldFRhcmdldEZyb21TaGFkb3dEb20oZXZlbnQsIGRlZmF1bHRUYXJnZXQpIHtcblx0XHR2YXIgcGF0aCwgdGFyZ2V0ID0gZGVmYXVsdFRhcmdldDtcblxuXHRcdC8vIFdoZW4gdGFyZ2V0IGVsZW1lbnQgaXMgaW5zaWRlIFNoYWRvdyBET00gd2UgbmVlZCB0byB0YWtlIGZpcnN0IGVsZW1lbnQgZnJvbSBwYXRoXG5cdFx0Ly8gb3RoZXJ3aXNlIHdlJ2xsIGdldCBTaGFkb3cgUm9vdCBwYXJlbnQsIG5vdCBhY3R1YWwgdGFyZ2V0IGVsZW1lbnRcblxuXHRcdC8vIE5vcm1hbGl6ZSB0YXJnZXQgZm9yIFdlYkNvbXBvbmVudHMgdjAgaW1wbGVtZW50YXRpb24gKGluIENocm9tZSlcblx0XHRwYXRoID0gZXZlbnQucGF0aDtcblx0XHRpZiAocGF0aCAmJiBwYXRoLmxlbmd0aCA+IDApIHtcblx0XHRcdHRhcmdldCA9IHBhdGhbMF07XG5cdFx0fVxuXG5cdFx0Ly8gTm9ybWFsaXplIHRhcmdldCBmb3IgV2ViQ29tcG9uZW50cyB2MSBpbXBsZW1lbnRhdGlvbiAoc3RhbmRhcmQpXG5cdFx0aWYgKGV2ZW50LmRlZXBQYXRoKSB7XG5cdFx0XHRwYXRoID0gZXZlbnQuZGVlcFBhdGgoKTtcblx0XHRcdGlmIChwYXRoICYmIHBhdGgubGVuZ3RoID4gMCkge1xuXHRcdFx0XHR0YXJnZXQgPSBwYXRoWzBdO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiB0YXJnZXQ7XG5cdH1cblxuXHQvKipcblx0ICogTm9ybWFsaXplcyBhIG5hdGl2ZSBldmVudCBvYmplY3Qgb3IganVzdCBhZGRzIHRoZSBldmVudCBzcGVjaWZpYyBtZXRob2RzIG9uIGEgY3VzdG9tIGV2ZW50LlxuXHQgKi9cblx0ZnVuY3Rpb24gZml4KG9yaWdpbmFsRXZlbnQsIGRhdGEpIHtcblx0XHR2YXIgbmFtZSwgZXZlbnQgPSBkYXRhIHx8IHt9LCB1bmRlZjtcblxuXHRcdC8vIER1bW15IGZ1bmN0aW9uIHRoYXQgZ2V0cyByZXBsYWNlZCBvbiB0aGUgZGVsZWdhdGlvbiBzdGF0ZSBmdW5jdGlvbnNcblx0XHRmdW5jdGlvbiByZXR1cm5GYWxzZSgpIHtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cblx0XHQvLyBEdW1teSBmdW5jdGlvbiB0aGF0IGdldHMgcmVwbGFjZWQgb24gdGhlIGRlbGVnYXRpb24gc3RhdGUgZnVuY3Rpb25zXG5cdFx0ZnVuY3Rpb24gcmV0dXJuVHJ1ZSgpIHtcblx0XHRcdHJldHVybiB0cnVlO1xuXHRcdH1cblxuXHRcdC8vIENvcHkgYWxsIHByb3BlcnRpZXMgZnJvbSB0aGUgb3JpZ2luYWwgZXZlbnRcblx0XHRmb3IgKG5hbWUgaW4gb3JpZ2luYWxFdmVudCkge1xuXHRcdFx0Ly8gbGF5ZXJYL2xheWVyWSBpcyBkZXByZWNhdGVkIGluIENocm9tZSBhbmQgcHJvZHVjZXMgYSB3YXJuaW5nXG5cdFx0XHRpZiAoIWRlcHJlY2F0ZWRbbmFtZV0pIHtcblx0XHRcdFx0ZXZlbnRbbmFtZV0gPSBvcmlnaW5hbEV2ZW50W25hbWVdO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8vIE5vcm1hbGl6ZSB0YXJnZXQgSUUgdXNlcyBzcmNFbGVtZW50XG5cdFx0aWYgKCFldmVudC50YXJnZXQpIHtcblx0XHRcdGV2ZW50LnRhcmdldCA9IGV2ZW50LnNyY0VsZW1lbnQgfHwgZG9jdW1lbnQ7XG5cdFx0fVxuXG5cdFx0Ly8gRXhwZXJpbWVudGFsIHNoYWRvdyBkb20gc3VwcG9ydFxuXHRcdGlmIChFbnYuZXhwZXJpbWVudGFsU2hhZG93RG9tKSB7XG5cdFx0XHRldmVudC50YXJnZXQgPSBnZXRUYXJnZXRGcm9tU2hhZG93RG9tKG9yaWdpbmFsRXZlbnQsIGV2ZW50LnRhcmdldCk7XG5cdFx0fVxuXG5cdFx0Ly8gQ2FsY3VsYXRlIHBhZ2VYL1kgaWYgbWlzc2luZyBhbmQgY2xpZW50WC9ZIGF2YWlsYWJsZVxuXHRcdGlmIChvcmlnaW5hbEV2ZW50ICYmIG1vdXNlRXZlbnRSZS50ZXN0KG9yaWdpbmFsRXZlbnQudHlwZSkgJiYgb3JpZ2luYWxFdmVudC5wYWdlWCA9PT0gdW5kZWYgJiYgb3JpZ2luYWxFdmVudC5jbGllbnRYICE9PSB1bmRlZikge1xuXHRcdFx0dmFyIGV2ZW50RG9jID0gZXZlbnQudGFyZ2V0Lm93bmVyRG9jdW1lbnQgfHwgZG9jdW1lbnQ7XG5cdFx0XHR2YXIgZG9jID0gZXZlbnREb2MuZG9jdW1lbnRFbGVtZW50O1xuXHRcdFx0dmFyIGJvZHkgPSBldmVudERvYy5ib2R5O1xuXG5cdFx0XHRldmVudC5wYWdlWCA9IG9yaWdpbmFsRXZlbnQuY2xpZW50WCArIChkb2MgJiYgZG9jLnNjcm9sbExlZnQgfHwgYm9keSAmJiBib2R5LnNjcm9sbExlZnQgfHwgMCkgLVxuXHRcdFx0XHQoZG9jICYmIGRvYy5jbGllbnRMZWZ0IHx8IGJvZHkgJiYgYm9keS5jbGllbnRMZWZ0IHx8IDApO1xuXG5cdFx0XHRldmVudC5wYWdlWSA9IG9yaWdpbmFsRXZlbnQuY2xpZW50WSArIChkb2MgJiYgZG9jLnNjcm9sbFRvcCB8fCBib2R5ICYmIGJvZHkuc2Nyb2xsVG9wIHx8IDApIC1cblx0XHRcdFx0KGRvYyAmJiBkb2MuY2xpZW50VG9wIHx8IGJvZHkgJiYgYm9keS5jbGllbnRUb3AgfHwgMCk7XG5cdFx0fVxuXG5cdFx0Ly8gQWRkIHByZXZlbnREZWZhdWx0IG1ldGhvZFxuXHRcdGV2ZW50LnByZXZlbnREZWZhdWx0ID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRldmVudC5pc0RlZmF1bHRQcmV2ZW50ZWQgPSByZXR1cm5UcnVlO1xuXG5cdFx0XHQvLyBFeGVjdXRlIHByZXZlbnREZWZhdWx0IG9uIHRoZSBvcmlnaW5hbCBldmVudCBvYmplY3Rcblx0XHRcdGlmIChvcmlnaW5hbEV2ZW50KSB7XG5cdFx0XHRcdGlmIChvcmlnaW5hbEV2ZW50LnByZXZlbnREZWZhdWx0KSB7XG5cdFx0XHRcdFx0b3JpZ2luYWxFdmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9yaWdpbmFsRXZlbnQucmV0dXJuVmFsdWUgPSBmYWxzZTsgLy8gSUVcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH07XG5cblx0XHQvLyBBZGQgc3RvcFByb3BhZ2F0aW9uXG5cdFx0ZXZlbnQuc3RvcFByb3BhZ2F0aW9uID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRldmVudC5pc1Byb3BhZ2F0aW9uU3RvcHBlZCA9IHJldHVyblRydWU7XG5cblx0XHRcdC8vIEV4ZWN1dGUgc3RvcFByb3BhZ2F0aW9uIG9uIHRoZSBvcmlnaW5hbCBldmVudCBvYmplY3Rcblx0XHRcdGlmIChvcmlnaW5hbEV2ZW50KSB7XG5cdFx0XHRcdGlmIChvcmlnaW5hbEV2ZW50LnN0b3BQcm9wYWdhdGlvbikge1xuXHRcdFx0XHRcdG9yaWdpbmFsRXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b3JpZ2luYWxFdmVudC5jYW5jZWxCdWJibGUgPSB0cnVlOyAvLyBJRVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fTtcblxuXHRcdC8vIEFkZCBzdG9wSW1tZWRpYXRlUHJvcGFnYXRpb25cblx0XHRldmVudC5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24gPSBmdW5jdGlvbigpIHtcblx0XHRcdGV2ZW50LmlzSW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkID0gcmV0dXJuVHJ1ZTtcblx0XHRcdGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdH07XG5cblx0XHQvLyBBZGQgZXZlbnQgZGVsZWdhdGlvbiBzdGF0ZXNcblx0XHRpZiAoIWV2ZW50LmlzRGVmYXVsdFByZXZlbnRlZCkge1xuXHRcdFx0ZXZlbnQuaXNEZWZhdWx0UHJldmVudGVkID0gcmV0dXJuRmFsc2U7XG5cdFx0XHRldmVudC5pc1Byb3BhZ2F0aW9uU3RvcHBlZCA9IHJldHVybkZhbHNlO1xuXHRcdFx0ZXZlbnQuaXNJbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQgPSByZXR1cm5GYWxzZTtcblx0XHR9XG5cblx0XHQvLyBBZGQgbWlzc2luZyBtZXRhS2V5IGZvciBJRSA4XG5cdFx0aWYgKHR5cGVvZiBldmVudC5tZXRhS2V5ID09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRldmVudC5tZXRhS2V5ID0gZmFsc2U7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGV2ZW50O1xuXHR9XG5cblx0LyoqXG5cdCAqIEJpbmQgYSBET01Db250ZW50TG9hZGVkIGV2ZW50IGFjcm9zcyBicm93c2VycyBhbmQgZXhlY3V0ZXMgdGhlIGNhbGxiYWNrIG9uY2UgdGhlIHBhZ2UgRE9NIGlzIGluaXRpYWxpemVkLlxuXHQgKiBJdCB3aWxsIGFsc28gc2V0L2NoZWNrIHRoZSBkb21Mb2FkZWQgc3RhdGUgb2YgdGhlIGV2ZW50X3V0aWxzIGluc3RhbmNlIHNvIHJlYWR5IGlzbid0IGNhbGxlZCBtdWx0aXBsZSB0aW1lcy5cblx0ICovXG5cdGZ1bmN0aW9uIGJpbmRPblJlYWR5KHdpbiwgY2FsbGJhY2ssIGV2ZW50VXRpbHMpIHtcblx0XHR2YXIgZG9jID0gd2luLmRvY3VtZW50LCBldmVudCA9IHt0eXBlOiAncmVhZHknfTtcblxuXHRcdGlmIChldmVudFV0aWxzLmRvbUxvYWRlZCkge1xuXHRcdFx0Y2FsbGJhY2soZXZlbnQpO1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblxuXHRcdC8vIEdldHMgY2FsbGVkIHdoZW4gdGhlIERPTSBpcyByZWFkeVxuXHRcdGZ1bmN0aW9uIHJlYWR5SGFuZGxlcigpIHtcblx0XHRcdGlmICghZXZlbnRVdGlscy5kb21Mb2FkZWQpIHtcblx0XHRcdFx0ZXZlbnRVdGlscy5kb21Mb2FkZWQgPSB0cnVlO1xuXHRcdFx0XHRjYWxsYmFjayhldmVudCk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gd2FpdEZvckRvbUxvYWRlZCgpIHtcblx0XHRcdC8vIENoZWNrIGNvbXBsZXRlIG9yIGludGVyYWN0aXZlIHN0YXRlIGlmIHRoZXJlIGlzIGEgYm9keVxuXHRcdFx0Ly8gZWxlbWVudCBvbiBzb21lIGlmcmFtZXMgSUUgOCB3aWxsIHByb2R1Y2UgYSBudWxsIGJvZHlcblx0XHRcdGlmIChkb2MucmVhZHlTdGF0ZSA9PT0gXCJjb21wbGV0ZVwiIHx8IChkb2MucmVhZHlTdGF0ZSA9PT0gXCJpbnRlcmFjdGl2ZVwiICYmIGRvYy5ib2R5KSkge1xuXHRcdFx0XHRyZW1vdmVFdmVudChkb2MsIFwicmVhZHlzdGF0ZWNoYW5nZVwiLCB3YWl0Rm9yRG9tTG9hZGVkKTtcblx0XHRcdFx0cmVhZHlIYW5kbGVyKCk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gdHJ5U2Nyb2xsKCkge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0Ly8gSWYgSUUgaXMgdXNlZCwgdXNlIHRoZSB0cmljayBieSBEaWVnbyBQZXJpbmkgbGljZW5zZWQgdW5kZXIgTUlUIGJ5IHJlcXVlc3QgdG8gdGhlIGF1dGhvci5cblx0XHRcdFx0Ly8gaHR0cDovL2phdmFzY3JpcHQubndib3guY29tL0lFQ29udGVudExvYWRlZC9cblx0XHRcdFx0ZG9jLmRvY3VtZW50RWxlbWVudC5kb1Njcm9sbChcImxlZnRcIik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHREZWxheS5zZXRUaW1lb3V0KHRyeVNjcm9sbCk7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0cmVhZHlIYW5kbGVyKCk7XG5cdFx0fVxuXG5cdFx0Ly8gVXNlIFczQyBtZXRob2Rcblx0XHRpZiAoZG9jLmFkZEV2ZW50TGlzdGVuZXIpIHtcblx0XHRcdGlmIChkb2MucmVhZHlTdGF0ZSA9PT0gXCJjb21wbGV0ZVwiKSB7XG5cdFx0XHRcdHJlYWR5SGFuZGxlcigpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0YWRkRXZlbnQod2luLCAnRE9NQ29udGVudExvYWRlZCcsIHJlYWR5SGFuZGxlcik7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdC8vIFVzZSBJRSBtZXRob2Rcblx0XHRcdGFkZEV2ZW50KGRvYywgXCJyZWFkeXN0YXRlY2hhbmdlXCIsIHdhaXRGb3JEb21Mb2FkZWQpO1xuXG5cdFx0XHQvLyBXYWl0IHVudGlsIHdlIGNhbiBzY3JvbGwsIHdoZW4gd2UgY2FuIHRoZSBET00gaXMgaW5pdGlhbGl6ZWRcblx0XHRcdGlmIChkb2MuZG9jdW1lbnRFbGVtZW50LmRvU2Nyb2xsICYmIHdpbi5zZWxmID09PSB3aW4udG9wKSB7XG5cdFx0XHRcdHRyeVNjcm9sbCgpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8vIEZhbGxiYWNrIGlmIGFueSBvZiB0aGUgYWJvdmUgbWV0aG9kcyBzaG91bGQgZmFpbCBmb3Igc29tZSBvZGQgcmVhc29uXG5cdFx0YWRkRXZlbnQod2luLCAnbG9hZCcsIHJlYWR5SGFuZGxlcik7XG5cdH1cblxuXHQvKipcblx0ICogVGhpcyBjbGFzcyBlbmFibGVzIHlvdSB0byBiaW5kL3VuYmluZCBuYXRpdmUgZXZlbnRzIHRvIGVsZW1lbnRzIGFuZCBub3JtYWxpemUgaXQncyBiZWhhdmlvciBhY3Jvc3MgYnJvd3NlcnMuXG5cdCAqL1xuXHRmdW5jdGlvbiBFdmVudFV0aWxzKCkge1xuXHRcdHZhciBzZWxmID0gdGhpcywgZXZlbnRzID0ge30sIGNvdW50LCBleHBhbmRvLCBoYXNGb2N1c0luLCBoYXNNb3VzZUVudGVyTGVhdmUsIG1vdXNlRW50ZXJMZWF2ZTtcblxuXHRcdGV4cGFuZG8gPSBldmVudEV4cGFuZG9QcmVmaXggKyAoK25ldyBEYXRlKCkpLnRvU3RyaW5nKDMyKTtcblx0XHRoYXNNb3VzZUVudGVyTGVhdmUgPSBcIm9ubW91c2VlbnRlclwiIGluIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDtcblx0XHRoYXNGb2N1c0luID0gXCJvbmZvY3VzaW5cIiBpbiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7XG5cdFx0bW91c2VFbnRlckxlYXZlID0ge21vdXNlZW50ZXI6ICdtb3VzZW92ZXInLCBtb3VzZWxlYXZlOiAnbW91c2VvdXQnfTtcblx0XHRjb3VudCA9IDE7XG5cblx0XHQvLyBTdGF0ZSBpZiB0aGUgRE9NQ29udGVudExvYWRlZCB3YXMgZXhlY3V0ZWQgb3Igbm90XG5cdFx0c2VsZi5kb21Mb2FkZWQgPSBmYWxzZTtcblx0XHRzZWxmLmV2ZW50cyA9IGV2ZW50cztcblxuXHRcdC8qKlxuXHRcdCAqIEV4ZWN1dGVzIGFsbCBldmVudCBoYW5kbGVyIGNhbGxiYWNrcyBmb3IgYSBzcGVjaWZpYyBldmVudC5cblx0XHQgKlxuXHRcdCAqIEBwcml2YXRlXG5cdFx0ICogQHBhcmFtIHtFdmVudH0gZXZ0IEV2ZW50IG9iamVjdC5cblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gaWQgRXhwYW5kbyBpZCB2YWx1ZSB0byBsb29rIGZvci5cblx0XHQgKi9cblx0XHRmdW5jdGlvbiBleGVjdXRlSGFuZGxlcnMoZXZ0LCBpZCkge1xuXHRcdFx0dmFyIGNhbGxiYWNrTGlzdCwgaSwgbCwgY2FsbGJhY2ssIGNvbnRhaW5lciA9IGV2ZW50c1tpZF07XG5cblx0XHRcdGNhbGxiYWNrTGlzdCA9IGNvbnRhaW5lciAmJiBjb250YWluZXJbZXZ0LnR5cGVdO1xuXHRcdFx0aWYgKGNhbGxiYWNrTGlzdCkge1xuXHRcdFx0XHRmb3IgKGkgPSAwLCBsID0gY2FsbGJhY2tMaXN0Lmxlbmd0aDsgaSA8IGw7IGkrKykge1xuXHRcdFx0XHRcdGNhbGxiYWNrID0gY2FsbGJhY2tMaXN0W2ldO1xuXG5cdFx0XHRcdFx0Ly8gQ2hlY2sgaWYgY2FsbGJhY2sgZXhpc3RzIG1pZ2h0IGJlIHJlbW92ZWQgaWYgYSB1bmJpbmQgaXMgY2FsbGVkIGluc2lkZSB0aGUgY2FsbGJhY2tcblx0XHRcdFx0XHRpZiAoY2FsbGJhY2sgJiYgY2FsbGJhY2suZnVuYy5jYWxsKGNhbGxiYWNrLnNjb3BlLCBldnQpID09PSBmYWxzZSkge1xuXHRcdFx0XHRcdFx0ZXZ0LnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Ly8gU2hvdWxkIHdlIHN0b3AgcHJvcGFnYXRpb24gdG8gaW1tZWRpYXRlIGxpc3RlbmVyc1xuXHRcdFx0XHRcdGlmIChldnQuaXNJbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQoKSkge1xuXHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8qKlxuXHRcdCAqIEJpbmRzIGEgY2FsbGJhY2sgdG8gYW4gZXZlbnQgb24gdGhlIHNwZWNpZmllZCB0YXJnZXQuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGJpbmRcblx0XHQgKiBAcGFyYW0ge09iamVjdH0gdGFyZ2V0IFRhcmdldCBub2RlL3dpbmRvdyBvciBjdXN0b20gb2JqZWN0LlxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lcyBOYW1lIG9mIHRoZSBldmVudCB0byBiaW5kLlxuXHRcdCAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGV4ZWN1dGUgd2hlbiB0aGUgZXZlbnQgb2NjdXJzLlxuXHRcdCAqIEBwYXJhbSB7T2JqZWN0fSBzY29wZSBTY29wZSB0byBjYWxsIHRoZSBjYWxsYmFjayBmdW5jdGlvbiBvbiwgZGVmYXVsdHMgdG8gdGFyZ2V0LlxuXHRcdCAqIEByZXR1cm4ge2Z1bmN0aW9ufSBDYWxsYmFjayBmdW5jdGlvbiB0aGF0IGdvdCBib3VuZC5cblx0XHQgKi9cblx0XHRzZWxmLmJpbmQgPSBmdW5jdGlvbih0YXJnZXQsIG5hbWVzLCBjYWxsYmFjaywgc2NvcGUpIHtcblx0XHRcdHZhciBpZCwgY2FsbGJhY2tMaXN0LCBpLCBuYW1lLCBmYWtlTmFtZSwgbmF0aXZlSGFuZGxlciwgY2FwdHVyZSwgd2luID0gd2luZG93O1xuXG5cdFx0XHQvLyBOYXRpdmUgZXZlbnQgaGFuZGxlciBmdW5jdGlvbiBwYXRjaGVzIHRoZSBldmVudCBhbmQgZXhlY3V0ZXMgdGhlIGNhbGxiYWNrcyBmb3IgdGhlIGV4cGFuZG9cblx0XHRcdGZ1bmN0aW9uIGRlZmF1bHROYXRpdmVIYW5kbGVyKGV2dCkge1xuXHRcdFx0XHRleGVjdXRlSGFuZGxlcnMoZml4KGV2dCB8fCB3aW4uZXZlbnQpLCBpZCk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIERvbid0IGJpbmQgdG8gdGV4dCBub2RlcyBvciBjb21tZW50c1xuXHRcdFx0aWYgKCF0YXJnZXQgfHwgdGFyZ2V0Lm5vZGVUeXBlID09PSAzIHx8IHRhcmdldC5ub2RlVHlwZSA9PT0gOCkge1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdC8vIENyZWF0ZSBvciBnZXQgZXZlbnRzIGlkIGZvciB0aGUgdGFyZ2V0XG5cdFx0XHRpZiAoIXRhcmdldFtleHBhbmRvXSkge1xuXHRcdFx0XHRpZCA9IGNvdW50Kys7XG5cdFx0XHRcdHRhcmdldFtleHBhbmRvXSA9IGlkO1xuXHRcdFx0XHRldmVudHNbaWRdID0ge307XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRpZCA9IHRhcmdldFtleHBhbmRvXTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gU2V0dXAgdGhlIHNwZWNpZmllZCBzY29wZSBvciB1c2UgdGhlIHRhcmdldCBhcyBhIGRlZmF1bHRcblx0XHRcdHNjb3BlID0gc2NvcGUgfHwgdGFyZ2V0O1xuXG5cdFx0XHQvLyBTcGxpdCBuYW1lcyBhbmQgYmluZCBlYWNoIGV2ZW50LCBlbmFibGVzIHlvdSB0byBiaW5kIG11bHRpcGxlIGV2ZW50cyB3aXRoIG9uZSBjYWxsXG5cdFx0XHRuYW1lcyA9IG5hbWVzLnNwbGl0KCcgJyk7XG5cdFx0XHRpID0gbmFtZXMubGVuZ3RoO1xuXHRcdFx0d2hpbGUgKGktLSkge1xuXHRcdFx0XHRuYW1lID0gbmFtZXNbaV07XG5cdFx0XHRcdG5hdGl2ZUhhbmRsZXIgPSBkZWZhdWx0TmF0aXZlSGFuZGxlcjtcblx0XHRcdFx0ZmFrZU5hbWUgPSBjYXB0dXJlID0gZmFsc2U7XG5cblx0XHRcdFx0Ly8gVXNlIHJlYWR5IGluc3RlYWQgb2YgRE9NQ29udGVudExvYWRlZFxuXHRcdFx0XHRpZiAobmFtZSA9PT0gXCJET01Db250ZW50TG9hZGVkXCIpIHtcblx0XHRcdFx0XHRuYW1lID0gXCJyZWFkeVwiO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gRE9NIGlzIGFscmVhZHkgcmVhZHlcblx0XHRcdFx0aWYgKHNlbGYuZG9tTG9hZGVkICYmIG5hbWUgPT09IFwicmVhZHlcIiAmJiB0YXJnZXQucmVhZHlTdGF0ZSA9PSAnY29tcGxldGUnKSB7XG5cdFx0XHRcdFx0Y2FsbGJhY2suY2FsbChzY29wZSwgZml4KHt0eXBlOiBuYW1lfSkpO1xuXHRcdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gSGFuZGxlIG1vdXNlZW50ZXIvbW91c2VsZWF2ZXJcblx0XHRcdFx0aWYgKCFoYXNNb3VzZUVudGVyTGVhdmUpIHtcblx0XHRcdFx0XHRmYWtlTmFtZSA9IG1vdXNlRW50ZXJMZWF2ZVtuYW1lXTtcblxuXHRcdFx0XHRcdGlmIChmYWtlTmFtZSkge1xuXHRcdFx0XHRcdFx0bmF0aXZlSGFuZGxlciA9IGZ1bmN0aW9uKGV2dCkge1xuXHRcdFx0XHRcdFx0XHR2YXIgY3VycmVudCwgcmVsYXRlZDtcblxuXHRcdFx0XHRcdFx0XHRjdXJyZW50ID0gZXZ0LmN1cnJlbnRUYXJnZXQ7XG5cdFx0XHRcdFx0XHRcdHJlbGF0ZWQgPSBldnQucmVsYXRlZFRhcmdldDtcblxuXHRcdFx0XHRcdFx0XHQvLyBDaGVjayBpZiByZWxhdGVkIGlzIGluc2lkZSB0aGUgY3VycmVudCB0YXJnZXQgaWYgaXQncyBub3QgdGhlbiB0aGUgZXZlbnQgc2hvdWxkXG5cdFx0XHRcdFx0XHRcdC8vIGJlIGlnbm9yZWQgc2luY2UgaXQncyBhIG1vdXNlb3Zlci9tb3VzZW91dCBpbnNpZGUgdGhlIGVsZW1lbnRcblx0XHRcdFx0XHRcdFx0aWYgKHJlbGF0ZWQgJiYgY3VycmVudC5jb250YWlucykge1xuXHRcdFx0XHRcdFx0XHRcdC8vIFVzZSBjb250YWlucyBmb3IgcGVyZm9ybWFuY2Vcblx0XHRcdFx0XHRcdFx0XHRyZWxhdGVkID0gY3VycmVudC5jb250YWlucyhyZWxhdGVkKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHR3aGlsZSAocmVsYXRlZCAmJiByZWxhdGVkICE9PSBjdXJyZW50KSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZWxhdGVkID0gcmVsYXRlZC5wYXJlbnROb2RlO1xuXHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdC8vIEZpcmUgZmFrZSBldmVudFxuXHRcdFx0XHRcdFx0XHRpZiAoIXJlbGF0ZWQpIHtcblx0XHRcdFx0XHRcdFx0XHRldnQgPSBmaXgoZXZ0IHx8IHdpbi5ldmVudCk7XG5cdFx0XHRcdFx0XHRcdFx0ZXZ0LnR5cGUgPSBldnQudHlwZSA9PT0gJ21vdXNlb3V0JyA/ICdtb3VzZWxlYXZlJyA6ICdtb3VzZWVudGVyJztcblx0XHRcdFx0XHRcdFx0XHRldnQudGFyZ2V0ID0gY3VycmVudDtcblx0XHRcdFx0XHRcdFx0XHRleGVjdXRlSGFuZGxlcnMoZXZ0LCBpZCk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH07XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gRmFrZSBidWJibGluZyBvZiBmb2N1c2luL2ZvY3Vzb3V0XG5cdFx0XHRcdGlmICghaGFzRm9jdXNJbiAmJiAobmFtZSA9PT0gXCJmb2N1c2luXCIgfHwgbmFtZSA9PT0gXCJmb2N1c291dFwiKSkge1xuXHRcdFx0XHRcdGNhcHR1cmUgPSB0cnVlO1xuXHRcdFx0XHRcdGZha2VOYW1lID0gbmFtZSA9PT0gXCJmb2N1c2luXCIgPyBcImZvY3VzXCIgOiBcImJsdXJcIjtcblx0XHRcdFx0XHRuYXRpdmVIYW5kbGVyID0gZnVuY3Rpb24oZXZ0KSB7XG5cdFx0XHRcdFx0XHRldnQgPSBmaXgoZXZ0IHx8IHdpbi5ldmVudCk7XG5cdFx0XHRcdFx0XHRldnQudHlwZSA9IGV2dC50eXBlID09PSAnZm9jdXMnID8gJ2ZvY3VzaW4nIDogJ2ZvY3Vzb3V0Jztcblx0XHRcdFx0XHRcdGV4ZWN1dGVIYW5kbGVycyhldnQsIGlkKTtcblx0XHRcdFx0XHR9O1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gU2V0dXAgY2FsbGJhY2sgbGlzdCBhbmQgYmluZCBuYXRpdmUgZXZlbnRcblx0XHRcdFx0Y2FsbGJhY2tMaXN0ID0gZXZlbnRzW2lkXVtuYW1lXTtcblx0XHRcdFx0aWYgKCFjYWxsYmFja0xpc3QpIHtcblx0XHRcdFx0XHRldmVudHNbaWRdW25hbWVdID0gY2FsbGJhY2tMaXN0ID0gW3tmdW5jOiBjYWxsYmFjaywgc2NvcGU6IHNjb3BlfV07XG5cdFx0XHRcdFx0Y2FsbGJhY2tMaXN0LmZha2VOYW1lID0gZmFrZU5hbWU7XG5cdFx0XHRcdFx0Y2FsbGJhY2tMaXN0LmNhcHR1cmUgPSBjYXB0dXJlO1xuXHRcdFx0XHRcdC8vY2FsbGJhY2tMaXN0LmNhbGxiYWNrID0gY2FsbGJhY2s7XG5cblx0XHRcdFx0XHQvLyBBZGQgdGhlIG5hdGl2ZUhhbmRsZXIgdG8gdGhlIGNhbGxiYWNrIGxpc3Qgc28gdGhhdCB3ZSBjYW4gbGF0ZXIgdW5iaW5kIGl0XG5cdFx0XHRcdFx0Y2FsbGJhY2tMaXN0Lm5hdGl2ZUhhbmRsZXIgPSBuYXRpdmVIYW5kbGVyO1xuXG5cdFx0XHRcdFx0Ly8gQ2hlY2sgaWYgdGhlIHRhcmdldCBoYXMgbmF0aXZlIGV2ZW50cyBzdXBwb3J0XG5cblx0XHRcdFx0XHRpZiAobmFtZSA9PT0gXCJyZWFkeVwiKSB7XG5cdFx0XHRcdFx0XHRiaW5kT25SZWFkeSh0YXJnZXQsIG5hdGl2ZUhhbmRsZXIsIHNlbGYpO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRhZGRFdmVudCh0YXJnZXQsIGZha2VOYW1lIHx8IG5hbWUsIG5hdGl2ZUhhbmRsZXIsIGNhcHR1cmUpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRpZiAobmFtZSA9PT0gXCJyZWFkeVwiICYmIHNlbGYuZG9tTG9hZGVkKSB7XG5cdFx0XHRcdFx0XHRjYWxsYmFjayh7dHlwZTogbmFtZX0pO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHQvLyBJZiBpdCBhbHJlYWR5IGhhcyBhbiBuYXRpdmUgaGFuZGxlciB0aGVuIGp1c3QgcHVzaCB0aGUgY2FsbGJhY2tcblx0XHRcdFx0XHRcdGNhbGxiYWNrTGlzdC5wdXNoKHtmdW5jOiBjYWxsYmFjaywgc2NvcGU6IHNjb3BlfSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHRhcmdldCA9IGNhbGxiYWNrTGlzdCA9IDA7IC8vIENsZWFuIG1lbW9yeSBmb3IgSUVcblxuXHRcdFx0cmV0dXJuIGNhbGxiYWNrO1xuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBVbmJpbmRzIHRoZSBzcGVjaWZpZWQgZXZlbnQgYnkgbmFtZSwgbmFtZSBhbmQgY2FsbGJhY2sgb3IgYWxsIGV2ZW50cyBvbiB0aGUgdGFyZ2V0LlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCB1bmJpbmRcblx0XHQgKiBAcGFyYW0ge09iamVjdH0gdGFyZ2V0IFRhcmdldCBub2RlL3dpbmRvdyBvciBjdXN0b20gb2JqZWN0LlxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lcyBPcHRpb25hbCBldmVudCBuYW1lIHRvIHVuYmluZC5cblx0XHQgKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFjayBPcHRpb25hbCBjYWxsYmFjayBmdW5jdGlvbiB0byB1bmJpbmQuXG5cdFx0ICogQHJldHVybiB7RXZlbnRVdGlsc30gRXZlbnQgdXRpbHMgaW5zdGFuY2UuXG5cdFx0ICovXG5cdFx0c2VsZi51bmJpbmQgPSBmdW5jdGlvbih0YXJnZXQsIG5hbWVzLCBjYWxsYmFjaykge1xuXHRcdFx0dmFyIGlkLCBjYWxsYmFja0xpc3QsIGksIGNpLCBuYW1lLCBldmVudE1hcDtcblxuXHRcdFx0Ly8gRG9uJ3QgYmluZCB0byB0ZXh0IG5vZGVzIG9yIGNvbW1lbnRzXG5cdFx0XHRpZiAoIXRhcmdldCB8fCB0YXJnZXQubm9kZVR5cGUgPT09IDMgfHwgdGFyZ2V0Lm5vZGVUeXBlID09PSA4KSB7XG5cdFx0XHRcdHJldHVybiBzZWxmO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBVbmJpbmQgZXZlbnQgb3IgZXZlbnRzIGlmIHRoZSB0YXJnZXQgaGFzIHRoZSBleHBhbmRvXG5cdFx0XHRpZCA9IHRhcmdldFtleHBhbmRvXTtcblx0XHRcdGlmIChpZCkge1xuXHRcdFx0XHRldmVudE1hcCA9IGV2ZW50c1tpZF07XG5cblx0XHRcdFx0Ly8gU3BlY2lmaWMgY2FsbGJhY2tcblx0XHRcdFx0aWYgKG5hbWVzKSB7XG5cdFx0XHRcdFx0bmFtZXMgPSBuYW1lcy5zcGxpdCgnICcpO1xuXHRcdFx0XHRcdGkgPSBuYW1lcy5sZW5ndGg7XG5cdFx0XHRcdFx0d2hpbGUgKGktLSkge1xuXHRcdFx0XHRcdFx0bmFtZSA9IG5hbWVzW2ldO1xuXHRcdFx0XHRcdFx0Y2FsbGJhY2tMaXN0ID0gZXZlbnRNYXBbbmFtZV07XG5cblx0XHRcdFx0XHRcdC8vIFVuYmluZCB0aGUgZXZlbnQgaWYgaXQgZXhpc3RzIGluIHRoZSBtYXBcblx0XHRcdFx0XHRcdGlmIChjYWxsYmFja0xpc3QpIHtcblx0XHRcdFx0XHRcdFx0Ly8gUmVtb3ZlIHNwZWNpZmllZCBjYWxsYmFja1xuXHRcdFx0XHRcdFx0XHRpZiAoY2FsbGJhY2spIHtcblx0XHRcdFx0XHRcdFx0XHRjaSA9IGNhbGxiYWNrTGlzdC5sZW5ndGg7XG5cdFx0XHRcdFx0XHRcdFx0d2hpbGUgKGNpLS0pIHtcblx0XHRcdFx0XHRcdFx0XHRcdGlmIChjYWxsYmFja0xpc3RbY2ldLmZ1bmMgPT09IGNhbGxiYWNrKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdHZhciBuYXRpdmVIYW5kbGVyID0gY2FsbGJhY2tMaXN0Lm5hdGl2ZUhhbmRsZXI7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdHZhciBmYWtlTmFtZSA9IGNhbGxiYWNrTGlzdC5mYWtlTmFtZSwgY2FwdHVyZSA9IGNhbGxiYWNrTGlzdC5jYXB0dXJlO1xuXG5cdFx0XHRcdFx0XHRcdFx0XHRcdC8vIENsb25lIGNhbGxiYWNrTGlzdCBzaW5jZSB1bmJpbmQgaW5zaWRlIGEgY2FsbGJhY2sgd291bGQgb3RoZXJ3aXNlIGJyZWFrIHRoZSBoYW5kbGVycyBsb29wXG5cdFx0XHRcdFx0XHRcdFx0XHRcdGNhbGxiYWNrTGlzdCA9IGNhbGxiYWNrTGlzdC5zbGljZSgwLCBjaSkuY29uY2F0KGNhbGxiYWNrTGlzdC5zbGljZShjaSArIDEpKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0Y2FsbGJhY2tMaXN0Lm5hdGl2ZUhhbmRsZXIgPSBuYXRpdmVIYW5kbGVyO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRjYWxsYmFja0xpc3QuZmFrZU5hbWUgPSBmYWtlTmFtZTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0Y2FsbGJhY2tMaXN0LmNhcHR1cmUgPSBjYXB0dXJlO1xuXG5cdFx0XHRcdFx0XHRcdFx0XHRcdGV2ZW50TWFwW25hbWVdID0gY2FsbGJhY2tMaXN0O1xuXHRcdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdC8vIFJlbW92ZSBhbGwgY2FsbGJhY2tzIGlmIHRoZXJlIGlzbid0IGEgc3BlY2lmaWVkIGNhbGxiYWNrIG9yIHRoZXJlIGlzIG5vIGNhbGxiYWNrcyBsZWZ0XG5cdFx0XHRcdFx0XHRcdGlmICghY2FsbGJhY2sgfHwgY2FsbGJhY2tMaXN0Lmxlbmd0aCA9PT0gMCkge1xuXHRcdFx0XHRcdFx0XHRcdGRlbGV0ZSBldmVudE1hcFtuYW1lXTtcblx0XHRcdFx0XHRcdFx0XHRyZW1vdmVFdmVudCh0YXJnZXQsIGNhbGxiYWNrTGlzdC5mYWtlTmFtZSB8fCBuYW1lLCBjYWxsYmFja0xpc3QubmF0aXZlSGFuZGxlciwgY2FsbGJhY2tMaXN0LmNhcHR1cmUpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdC8vIEFsbCBldmVudHMgZm9yIGEgc3BlY2lmaWMgZWxlbWVudFxuXHRcdFx0XHRcdGZvciAobmFtZSBpbiBldmVudE1hcCkge1xuXHRcdFx0XHRcdFx0Y2FsbGJhY2tMaXN0ID0gZXZlbnRNYXBbbmFtZV07XG5cdFx0XHRcdFx0XHRyZW1vdmVFdmVudCh0YXJnZXQsIGNhbGxiYWNrTGlzdC5mYWtlTmFtZSB8fCBuYW1lLCBjYWxsYmFja0xpc3QubmF0aXZlSGFuZGxlciwgY2FsbGJhY2tMaXN0LmNhcHR1cmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGV2ZW50TWFwID0ge307XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBDaGVjayBpZiBvYmplY3QgaXMgZW1wdHksIGlmIGl0IGlzbid0IHRoZW4gd2Ugd29uJ3QgcmVtb3ZlIHRoZSBleHBhbmRvIG1hcFxuXHRcdFx0XHRmb3IgKG5hbWUgaW4gZXZlbnRNYXApIHtcblx0XHRcdFx0XHRyZXR1cm4gc2VsZjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIERlbGV0ZSBldmVudCBvYmplY3Rcblx0XHRcdFx0ZGVsZXRlIGV2ZW50c1tpZF07XG5cblx0XHRcdFx0Ly8gUmVtb3ZlIGV4cGFuZG8gZnJvbSB0YXJnZXRcblx0XHRcdFx0dHJ5IHtcblx0XHRcdFx0XHQvLyBJRSB3aWxsIGZhaWwgaGVyZSBzaW5jZSBpdCBjYW4ndCBkZWxldGUgcHJvcGVydGllcyBmcm9tIHdpbmRvd1xuXHRcdFx0XHRcdGRlbGV0ZSB0YXJnZXRbZXhwYW5kb107XG5cdFx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdFx0Ly8gSUUgd2lsbCBzZXQgaXQgdG8gbnVsbFxuXHRcdFx0XHRcdHRhcmdldFtleHBhbmRvXSA9IG51bGw7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHNlbGY7XG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIEZpcmVzIHRoZSBzcGVjaWZpZWQgZXZlbnQgb24gdGhlIHNwZWNpZmllZCB0YXJnZXQuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGZpcmVcblx0XHQgKiBAcGFyYW0ge09iamVjdH0gdGFyZ2V0IFRhcmdldCBub2RlL3dpbmRvdyBvciBjdXN0b20gb2JqZWN0LlxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIEV2ZW50IG5hbWUgdG8gZmlyZS5cblx0XHQgKiBAcGFyYW0ge09iamVjdH0gYXJncyBPcHRpb25hbCBhcmd1bWVudHMgdG8gc2VuZCB0byB0aGUgb2JzZXJ2ZXJzLlxuXHRcdCAqIEByZXR1cm4ge0V2ZW50VXRpbHN9IEV2ZW50IHV0aWxzIGluc3RhbmNlLlxuXHRcdCAqL1xuXHRcdHNlbGYuZmlyZSA9IGZ1bmN0aW9uKHRhcmdldCwgbmFtZSwgYXJncykge1xuXHRcdFx0dmFyIGlkO1xuXG5cdFx0XHQvLyBEb24ndCBiaW5kIHRvIHRleHQgbm9kZXMgb3IgY29tbWVudHNcblx0XHRcdGlmICghdGFyZ2V0IHx8IHRhcmdldC5ub2RlVHlwZSA9PT0gMyB8fCB0YXJnZXQubm9kZVR5cGUgPT09IDgpIHtcblx0XHRcdFx0cmV0dXJuIHNlbGY7XG5cdFx0XHR9XG5cblx0XHRcdC8vIEJ1aWxkIGV2ZW50IG9iamVjdCBieSBwYXRjaGluZyB0aGUgYXJnc1xuXHRcdFx0YXJncyA9IGZpeChudWxsLCBhcmdzKTtcblx0XHRcdGFyZ3MudHlwZSA9IG5hbWU7XG5cdFx0XHRhcmdzLnRhcmdldCA9IHRhcmdldDtcblxuXHRcdFx0ZG8ge1xuXHRcdFx0XHQvLyBGb3VuZCBhbiBleHBhbmRvIHRoYXQgbWVhbnMgdGhlcmUgaXMgbGlzdGVuZXJzIHRvIGV4ZWN1dGVcblx0XHRcdFx0aWQgPSB0YXJnZXRbZXhwYW5kb107XG5cdFx0XHRcdGlmIChpZCkge1xuXHRcdFx0XHRcdGV4ZWN1dGVIYW5kbGVycyhhcmdzLCBpZCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBXYWxrIHVwIHRoZSBET01cblx0XHRcdFx0dGFyZ2V0ID0gdGFyZ2V0LnBhcmVudE5vZGUgfHwgdGFyZ2V0Lm93bmVyRG9jdW1lbnQgfHwgdGFyZ2V0LmRlZmF1bHRWaWV3IHx8IHRhcmdldC5wYXJlbnRXaW5kb3c7XG5cdFx0XHR9IHdoaWxlICh0YXJnZXQgJiYgIWFyZ3MuaXNQcm9wYWdhdGlvblN0b3BwZWQoKSk7XG5cblx0XHRcdHJldHVybiBzZWxmO1xuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBSZW1vdmVzIGFsbCBib3VuZCBldmVudCBsaXN0ZW5lcnMgZm9yIHRoZSBzcGVjaWZpZWQgdGFyZ2V0LiBUaGlzIHdpbGwgYWxzbyByZW1vdmUgYW55IGJvdW5kXG5cdFx0ICogbGlzdGVuZXJzIHRvIGNoaWxkIG5vZGVzIHdpdGhpbiB0aGF0IHRhcmdldC5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgY2xlYW5cblx0XHQgKiBAcGFyYW0ge09iamVjdH0gdGFyZ2V0IFRhcmdldCBub2RlL3dpbmRvdyBvYmplY3QuXG5cdFx0ICogQHJldHVybiB7RXZlbnRVdGlsc30gRXZlbnQgdXRpbHMgaW5zdGFuY2UuXG5cdFx0ICovXG5cdFx0c2VsZi5jbGVhbiA9IGZ1bmN0aW9uKHRhcmdldCkge1xuXHRcdFx0dmFyIGksIGNoaWxkcmVuLCB1bmJpbmQgPSBzZWxmLnVuYmluZDtcblxuXHRcdFx0Ly8gRG9uJ3QgYmluZCB0byB0ZXh0IG5vZGVzIG9yIGNvbW1lbnRzXG5cdFx0XHRpZiAoIXRhcmdldCB8fCB0YXJnZXQubm9kZVR5cGUgPT09IDMgfHwgdGFyZ2V0Lm5vZGVUeXBlID09PSA4KSB7XG5cdFx0XHRcdHJldHVybiBzZWxmO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBVbmJpbmQgYW55IGVsZW1lbnQgb24gdGhlIHNwZWNpZmllZCB0YXJnZXRcblx0XHRcdGlmICh0YXJnZXRbZXhwYW5kb10pIHtcblx0XHRcdFx0dW5iaW5kKHRhcmdldCk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIFRhcmdldCBkb2Vzbid0IGhhdmUgZ2V0RWxlbWVudHNCeVRhZ05hbWUgaXQncyBwcm9iYWJseSBhIHdpbmRvdyBvYmplY3QgdGhlbiB1c2UgaXQncyBkb2N1bWVudCB0byBmaW5kIHRoZSBjaGlsZHJlblxuXHRcdFx0aWYgKCF0YXJnZXQuZ2V0RWxlbWVudHNCeVRhZ05hbWUpIHtcblx0XHRcdFx0dGFyZ2V0ID0gdGFyZ2V0LmRvY3VtZW50O1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBSZW1vdmUgZXZlbnRzIGZyb20gZWFjaCBjaGlsZCBlbGVtZW50XG5cdFx0XHRpZiAodGFyZ2V0ICYmIHRhcmdldC5nZXRFbGVtZW50c0J5VGFnTmFtZSkge1xuXHRcdFx0XHR1bmJpbmQodGFyZ2V0KTtcblxuXHRcdFx0XHRjaGlsZHJlbiA9IHRhcmdldC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnKicpO1xuXHRcdFx0XHRpID0gY2hpbGRyZW4ubGVuZ3RoO1xuXHRcdFx0XHR3aGlsZSAoaS0tKSB7XG5cdFx0XHRcdFx0dGFyZ2V0ID0gY2hpbGRyZW5baV07XG5cblx0XHRcdFx0XHRpZiAodGFyZ2V0W2V4cGFuZG9dKSB7XG5cdFx0XHRcdFx0XHR1bmJpbmQodGFyZ2V0KTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHNlbGY7XG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIERlc3Ryb3lzIHRoZSBldmVudCBvYmplY3QuIENhbGwgdGhpcyBvbiBJRSB0byByZW1vdmUgbWVtb3J5IGxlYWtzLlxuXHRcdCAqL1xuXHRcdHNlbGYuZGVzdHJveSA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0ZXZlbnRzID0ge307XG5cdFx0fTtcblxuXHRcdC8vIExlZ2FjeSBmdW5jdGlvbiBmb3IgY2FuY2VsaW5nIGV2ZW50c1xuXHRcdHNlbGYuY2FuY2VsID0gZnVuY3Rpb24oZSkge1xuXHRcdFx0aWYgKGUpIHtcblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fTtcblx0fVxuXG5cdEV2ZW50VXRpbHMuRXZlbnQgPSBuZXcgRXZlbnRVdGlscygpO1xuXHRFdmVudFV0aWxzLkV2ZW50LmJpbmQod2luZG93LCAncmVhZHknLCBmdW5jdGlvbigpIHt9KTtcblxuXHRyZXR1cm4gRXZlbnRVdGlscztcbn0pO1xuXG4vLyBJbmNsdWRlZCBmcm9tOiBqcy90aW55bWNlL2NsYXNzZXMvZG9tL1NpenpsZS5qc1xuXG4vKipcbiAqIFNpenpsZS5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE1IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqXG4gKiBAaWdub3JlLWZpbGVcbiAqL1xuXG4vKmpzaGludCBiaXR3aXNlOmZhbHNlLCBleHByOnRydWUsIG5vZW1wdHk6ZmFsc2UsIHN1Yjp0cnVlLCBlcW51bGw6dHJ1ZSwgbGF0ZWRlZjpmYWxzZSwgbWF4bGVuOjI1NSAqL1xuLyplc2xpbnQtZGlzYWJsZSAqL1xuXG4vKipcbiAqIFNpenpsZSBDU1MgU2VsZWN0b3IgRW5naW5lIHZAVkVSU0lPTlxuICogaHR0cDovL3NpenpsZWpzLmNvbS9cbiAqXG4gKiBDb3B5cmlnaHQgMjAwOCwgMjAxNCBqUXVlcnkgRm91bmRhdGlvbiwgSW5jLiBhbmQgb3RoZXIgY29udHJpYnV0b3JzXG4gKiBSZWxlYXNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2VcbiAqIGh0dHA6Ly9qcXVlcnkub3JnL2xpY2Vuc2VcbiAqXG4gKiBEYXRlOiBAREFURVxuICovXG5kZWZpbmUoXCJ0aW55bWNlL2RvbS9TaXp6bGVcIiwgW10sIGZ1bmN0aW9uKCkge1xudmFyIGksXG5cdHN1cHBvcnQsXG5cdEV4cHIsXG5cdGdldFRleHQsXG5cdGlzWE1MLFxuXHR0b2tlbml6ZSxcblx0Y29tcGlsZSxcblx0c2VsZWN0LFxuXHRvdXRlcm1vc3RDb250ZXh0LFxuXHRzb3J0SW5wdXQsXG5cdGhhc0R1cGxpY2F0ZSxcblxuXHQvLyBMb2NhbCBkb2N1bWVudCB2YXJzXG5cdHNldERvY3VtZW50LFxuXHRkb2N1bWVudCxcblx0ZG9jRWxlbSxcblx0ZG9jdW1lbnRJc0hUTUwsXG5cdHJidWdneVFTQSxcblx0cmJ1Z2d5TWF0Y2hlcyxcblx0bWF0Y2hlcyxcblx0Y29udGFpbnMsXG5cblx0Ly8gSW5zdGFuY2Utc3BlY2lmaWMgZGF0YVxuXHRleHBhbmRvID0gXCJzaXp6bGVcIiArIC0obmV3IERhdGUoKSksXG5cdHByZWZlcnJlZERvYyA9IHdpbmRvdy5kb2N1bWVudCxcblx0ZGlycnVucyA9IDAsXG5cdGRvbmUgPSAwLFxuXHRjbGFzc0NhY2hlID0gY3JlYXRlQ2FjaGUoKSxcblx0dG9rZW5DYWNoZSA9IGNyZWF0ZUNhY2hlKCksXG5cdGNvbXBpbGVyQ2FjaGUgPSBjcmVhdGVDYWNoZSgpLFxuXHRzb3J0T3JkZXIgPSBmdW5jdGlvbiggYSwgYiApIHtcblx0XHRpZiAoIGEgPT09IGIgKSB7XG5cdFx0XHRoYXNEdXBsaWNhdGUgPSB0cnVlO1xuXHRcdH1cblx0XHRyZXR1cm4gMDtcblx0fSxcblxuXHQvLyBHZW5lcmFsLXB1cnBvc2UgY29uc3RhbnRzXG5cdHN0cnVuZGVmaW5lZCA9IHR5cGVvZiB1bmRlZmluZWQsXG5cdE1BWF9ORUdBVElWRSA9IDEgPDwgMzEsXG5cblx0Ly8gSW5zdGFuY2UgbWV0aG9kc1xuXHRoYXNPd24gPSAoe30pLmhhc093blByb3BlcnR5LFxuXHRhcnIgPSBbXSxcblx0cG9wID0gYXJyLnBvcCxcblx0cHVzaF9uYXRpdmUgPSBhcnIucHVzaCxcblx0cHVzaCA9IGFyci5wdXNoLFxuXHRzbGljZSA9IGFyci5zbGljZSxcblx0Ly8gVXNlIGEgc3RyaXBwZWQtZG93biBpbmRleE9mIGlmIHdlIGNhbid0IHVzZSBhIG5hdGl2ZSBvbmVcblx0aW5kZXhPZiA9IGFyci5pbmRleE9mIHx8IGZ1bmN0aW9uKCBlbGVtICkge1xuXHRcdHZhciBpID0gMCxcblx0XHRcdGxlbiA9IHRoaXMubGVuZ3RoO1xuXHRcdGZvciAoIDsgaSA8IGxlbjsgaSsrICkge1xuXHRcdFx0aWYgKCB0aGlzW2ldID09PSBlbGVtICkge1xuXHRcdFx0XHRyZXR1cm4gaTtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIC0xO1xuXHR9LFxuXG5cdGJvb2xlYW5zID0gXCJjaGVja2VkfHNlbGVjdGVkfGFzeW5jfGF1dG9mb2N1c3xhdXRvcGxheXxjb250cm9sc3xkZWZlcnxkaXNhYmxlZHxoaWRkZW58aXNtYXB8bG9vcHxtdWx0aXBsZXxvcGVufHJlYWRvbmx5fHJlcXVpcmVkfHNjb3BlZFwiLFxuXG5cdC8vIFJlZ3VsYXIgZXhwcmVzc2lvbnNcblxuXHQvLyBodHRwOi8vd3d3LnczLm9yZy9UUi9jc3MzLXNlbGVjdG9ycy8jd2hpdGVzcGFjZVxuXHR3aGl0ZXNwYWNlID0gXCJbXFxcXHgyMFxcXFx0XFxcXHJcXFxcblxcXFxmXVwiLFxuXG5cdC8vIGh0dHA6Ly93d3cudzMub3JnL1RSL0NTUzIxL3N5bmRhdGEuaHRtbCN2YWx1ZS1kZWYtaWRlbnRpZmllclxuXHRpZGVudGlmaWVyID0gXCIoPzpcXFxcXFxcXC58W1xcXFx3LV18W15cXFxceDAwLVxcXFx4YTBdKStcIixcblxuXHQvLyBBdHRyaWJ1dGUgc2VsZWN0b3JzOiBodHRwOi8vd3d3LnczLm9yZy9UUi9zZWxlY3RvcnMvI2F0dHJpYnV0ZS1zZWxlY3RvcnNcblx0YXR0cmlidXRlcyA9IFwiXFxcXFtcIiArIHdoaXRlc3BhY2UgKyBcIiooXCIgKyBpZGVudGlmaWVyICsgXCIpKD86XCIgKyB3aGl0ZXNwYWNlICtcblx0XHQvLyBPcGVyYXRvciAoY2FwdHVyZSAyKVxuXHRcdFwiKihbKl4kfCF+XT89KVwiICsgd2hpdGVzcGFjZSArXG5cdFx0Ly8gXCJBdHRyaWJ1dGUgdmFsdWVzIG11c3QgYmUgQ1NTIGlkZW50aWZpZXJzIFtjYXB0dXJlIDVdIG9yIHN0cmluZ3MgW2NhcHR1cmUgMyBvciBjYXB0dXJlIDRdXCJcblx0XHRcIiooPzonKCg/OlxcXFxcXFxcLnxbXlxcXFxcXFxcJ10pKiknfFxcXCIoKD86XFxcXFxcXFwufFteXFxcXFxcXFxcXFwiXSkqKVxcXCJ8KFwiICsgaWRlbnRpZmllciArIFwiKSl8KVwiICsgd2hpdGVzcGFjZSArXG5cdFx0XCIqXFxcXF1cIixcblxuXHRwc2V1ZG9zID0gXCI6KFwiICsgaWRlbnRpZmllciArIFwiKSg/OlxcXFwoKFwiICtcblx0XHQvLyBUbyByZWR1Y2UgdGhlIG51bWJlciBvZiBzZWxlY3RvcnMgbmVlZGluZyB0b2tlbml6ZSBpbiB0aGUgcHJlRmlsdGVyLCBwcmVmZXIgYXJndW1lbnRzOlxuXHRcdC8vIDEuIHF1b3RlZCAoY2FwdHVyZSAzOyBjYXB0dXJlIDQgb3IgY2FwdHVyZSA1KVxuXHRcdFwiKCcoKD86XFxcXFxcXFwufFteXFxcXFxcXFwnXSkqKSd8XFxcIigoPzpcXFxcXFxcXC58W15cXFxcXFxcXFxcXCJdKSopXFxcIil8XCIgK1xuXHRcdC8vIDIuIHNpbXBsZSAoY2FwdHVyZSA2KVxuXHRcdFwiKCg/OlxcXFxcXFxcLnxbXlxcXFxcXFxcKClbXFxcXF1dfFwiICsgYXR0cmlidXRlcyArIFwiKSopfFwiICtcblx0XHQvLyAzLiBhbnl0aGluZyBlbHNlIChjYXB0dXJlIDIpXG5cdFx0XCIuKlwiICtcblx0XHRcIilcXFxcKXwpXCIsXG5cblx0Ly8gTGVhZGluZyBhbmQgbm9uLWVzY2FwZWQgdHJhaWxpbmcgd2hpdGVzcGFjZSwgY2FwdHVyaW5nIHNvbWUgbm9uLXdoaXRlc3BhY2UgY2hhcmFjdGVycyBwcmVjZWRpbmcgdGhlIGxhdHRlclxuXHRydHJpbSA9IG5ldyBSZWdFeHAoIFwiXlwiICsgd2hpdGVzcGFjZSArIFwiK3woKD86XnxbXlxcXFxcXFxcXSkoPzpcXFxcXFxcXC4pKilcIiArIHdoaXRlc3BhY2UgKyBcIiskXCIsIFwiZ1wiICksXG5cblx0cmNvbW1hID0gbmV3IFJlZ0V4cCggXCJeXCIgKyB3aGl0ZXNwYWNlICsgXCIqLFwiICsgd2hpdGVzcGFjZSArIFwiKlwiICksXG5cdHJjb21iaW5hdG9ycyA9IG5ldyBSZWdFeHAoIFwiXlwiICsgd2hpdGVzcGFjZSArIFwiKihbPit+XXxcIiArIHdoaXRlc3BhY2UgKyBcIilcIiArIHdoaXRlc3BhY2UgKyBcIipcIiApLFxuXG5cdHJhdHRyaWJ1dGVRdW90ZXMgPSBuZXcgUmVnRXhwKCBcIj1cIiArIHdoaXRlc3BhY2UgKyBcIiooW15cXFxcXSdcXFwiXSo/KVwiICsgd2hpdGVzcGFjZSArIFwiKlxcXFxdXCIsIFwiZ1wiICksXG5cblx0cnBzZXVkbyA9IG5ldyBSZWdFeHAoIHBzZXVkb3MgKSxcblx0cmlkZW50aWZpZXIgPSBuZXcgUmVnRXhwKCBcIl5cIiArIGlkZW50aWZpZXIgKyBcIiRcIiApLFxuXG5cdG1hdGNoRXhwciA9IHtcblx0XHRcIklEXCI6IG5ldyBSZWdFeHAoIFwiXiMoXCIgKyBpZGVudGlmaWVyICsgXCIpXCIgKSxcblx0XHRcIkNMQVNTXCI6IG5ldyBSZWdFeHAoIFwiXlxcXFwuKFwiICsgaWRlbnRpZmllciArIFwiKVwiICksXG5cdFx0XCJUQUdcIjogbmV3IFJlZ0V4cCggXCJeKFwiICsgaWRlbnRpZmllciArIFwifFsqXSlcIiApLFxuXHRcdFwiQVRUUlwiOiBuZXcgUmVnRXhwKCBcIl5cIiArIGF0dHJpYnV0ZXMgKSxcblx0XHRcIlBTRVVET1wiOiBuZXcgUmVnRXhwKCBcIl5cIiArIHBzZXVkb3MgKSxcblx0XHRcIkNISUxEXCI6IG5ldyBSZWdFeHAoIFwiXjoob25seXxmaXJzdHxsYXN0fG50aHxudGgtbGFzdCktKGNoaWxkfG9mLXR5cGUpKD86XFxcXChcIiArIHdoaXRlc3BhY2UgK1xuXHRcdFx0XCIqKGV2ZW58b2RkfCgoWystXXwpKFxcXFxkKilufClcIiArIHdoaXRlc3BhY2UgKyBcIiooPzooWystXXwpXCIgKyB3aGl0ZXNwYWNlICtcblx0XHRcdFwiKihcXFxcZCspfCkpXCIgKyB3aGl0ZXNwYWNlICsgXCIqXFxcXCl8KVwiLCBcImlcIiApLFxuXHRcdFwiYm9vbFwiOiBuZXcgUmVnRXhwKCBcIl4oPzpcIiArIGJvb2xlYW5zICsgXCIpJFwiLCBcImlcIiApLFxuXHRcdC8vIEZvciB1c2UgaW4gbGlicmFyaWVzIGltcGxlbWVudGluZyAuaXMoKVxuXHRcdC8vIFdlIHVzZSB0aGlzIGZvciBQT1MgbWF0Y2hpbmcgaW4gYHNlbGVjdGBcblx0XHRcIm5lZWRzQ29udGV4dFwiOiBuZXcgUmVnRXhwKCBcIl5cIiArIHdoaXRlc3BhY2UgKyBcIipbPit+XXw6KGV2ZW58b2RkfGVxfGd0fGx0fG50aHxmaXJzdHxsYXN0KSg/OlxcXFwoXCIgK1xuXHRcdFx0d2hpdGVzcGFjZSArIFwiKigoPzotXFxcXGQpP1xcXFxkKilcIiArIHdoaXRlc3BhY2UgKyBcIipcXFxcKXwpKD89W14tXXwkKVwiLCBcImlcIiApXG5cdH0sXG5cblx0cmlucHV0cyA9IC9eKD86aW5wdXR8c2VsZWN0fHRleHRhcmVhfGJ1dHRvbikkL2ksXG5cdHJoZWFkZXIgPSAvXmhcXGQkL2ksXG5cblx0cm5hdGl2ZSA9IC9eW157XStcXHtcXHMqXFxbbmF0aXZlIFxcdy8sXG5cblx0Ly8gRWFzaWx5LXBhcnNlYWJsZS9yZXRyaWV2YWJsZSBJRCBvciBUQUcgb3IgQ0xBU1Mgc2VsZWN0b3JzXG5cdHJxdWlja0V4cHIgPSAvXig/OiMoW1xcdy1dKyl8KFxcdyspfFxcLihbXFx3LV0rKSkkLyxcblxuXHRyc2libGluZyA9IC9bK35dLyxcblx0cmVzY2FwZSA9IC8nfFxcXFwvZyxcblxuXHQvLyBDU1MgZXNjYXBlcyBodHRwOi8vd3d3LnczLm9yZy9UUi9DU1MyMS9zeW5kYXRhLmh0bWwjZXNjYXBlZC1jaGFyYWN0ZXJzXG5cdHJ1bmVzY2FwZSA9IG5ldyBSZWdFeHAoIFwiXFxcXFxcXFwoW1xcXFxkYS1mXXsxLDZ9XCIgKyB3aGl0ZXNwYWNlICsgXCI/fChcIiArIHdoaXRlc3BhY2UgKyBcIil8LilcIiwgXCJpZ1wiICksXG5cdGZ1bmVzY2FwZSA9IGZ1bmN0aW9uKCBfLCBlc2NhcGVkLCBlc2NhcGVkV2hpdGVzcGFjZSApIHtcblx0XHR2YXIgaGlnaCA9IFwiMHhcIiArIGVzY2FwZWQgLSAweDEwMDAwO1xuXHRcdC8vIE5hTiBtZWFucyBub24tY29kZXBvaW50XG5cdFx0Ly8gU3VwcG9ydDogRmlyZWZveDwyNFxuXHRcdC8vIFdvcmthcm91bmQgZXJyb25lb3VzIG51bWVyaWMgaW50ZXJwcmV0YXRpb24gb2YgK1wiMHhcIlxuXHRcdHJldHVybiBoaWdoICE9PSBoaWdoIHx8IGVzY2FwZWRXaGl0ZXNwYWNlID9cblx0XHRcdGVzY2FwZWQgOlxuXHRcdFx0aGlnaCA8IDAgP1xuXHRcdFx0XHQvLyBCTVAgY29kZXBvaW50XG5cdFx0XHRcdFN0cmluZy5mcm9tQ2hhckNvZGUoIGhpZ2ggKyAweDEwMDAwICkgOlxuXHRcdFx0XHQvLyBTdXBwbGVtZW50YWwgUGxhbmUgY29kZXBvaW50IChzdXJyb2dhdGUgcGFpcilcblx0XHRcdFx0U3RyaW5nLmZyb21DaGFyQ29kZSggaGlnaCA+PiAxMCB8IDB4RDgwMCwgaGlnaCAmIDB4M0ZGIHwgMHhEQzAwICk7XG5cdH07XG5cbi8vIE9wdGltaXplIGZvciBwdXNoLmFwcGx5KCBfLCBOb2RlTGlzdCApXG50cnkge1xuXHRwdXNoLmFwcGx5KFxuXHRcdChhcnIgPSBzbGljZS5jYWxsKCBwcmVmZXJyZWREb2MuY2hpbGROb2RlcyApKSxcblx0XHRwcmVmZXJyZWREb2MuY2hpbGROb2Rlc1xuXHQpO1xuXHQvLyBTdXBwb3J0OiBBbmRyb2lkPDQuMFxuXHQvLyBEZXRlY3Qgc2lsZW50bHkgZmFpbGluZyBwdXNoLmFwcGx5XG5cdGFyclsgcHJlZmVycmVkRG9jLmNoaWxkTm9kZXMubGVuZ3RoIF0ubm9kZVR5cGU7XG59IGNhdGNoICggZSApIHtcblx0cHVzaCA9IHsgYXBwbHk6IGFyci5sZW5ndGggP1xuXG5cdFx0Ly8gTGV2ZXJhZ2Ugc2xpY2UgaWYgcG9zc2libGVcblx0XHRmdW5jdGlvbiggdGFyZ2V0LCBlbHMgKSB7XG5cdFx0XHRwdXNoX25hdGl2ZS5hcHBseSggdGFyZ2V0LCBzbGljZS5jYWxsKGVscykgKTtcblx0XHR9IDpcblxuXHRcdC8vIFN1cHBvcnQ6IElFPDlcblx0XHQvLyBPdGhlcndpc2UgYXBwZW5kIGRpcmVjdGx5XG5cdFx0ZnVuY3Rpb24oIHRhcmdldCwgZWxzICkge1xuXHRcdFx0dmFyIGogPSB0YXJnZXQubGVuZ3RoLFxuXHRcdFx0XHRpID0gMDtcblx0XHRcdC8vIENhbid0IHRydXN0IE5vZGVMaXN0Lmxlbmd0aFxuXHRcdFx0d2hpbGUgKCAodGFyZ2V0W2orK10gPSBlbHNbaSsrXSkgKSB7fVxuXHRcdFx0dGFyZ2V0Lmxlbmd0aCA9IGogLSAxO1xuXHRcdH1cblx0fTtcbn1cblxuZnVuY3Rpb24gU2l6emxlKCBzZWxlY3RvciwgY29udGV4dCwgcmVzdWx0cywgc2VlZCApIHtcblx0dmFyIG1hdGNoLCBlbGVtLCBtLCBub2RlVHlwZSxcblx0XHQvLyBRU0EgdmFyc1xuXHRcdGksIGdyb3Vwcywgb2xkLCBuaWQsIG5ld0NvbnRleHQsIG5ld1NlbGVjdG9yO1xuXG5cdGlmICggKCBjb250ZXh0ID8gY29udGV4dC5vd25lckRvY3VtZW50IHx8IGNvbnRleHQgOiBwcmVmZXJyZWREb2MgKSAhPT0gZG9jdW1lbnQgKSB7XG5cdFx0c2V0RG9jdW1lbnQoIGNvbnRleHQgKTtcblx0fVxuXG5cdGNvbnRleHQgPSBjb250ZXh0IHx8IGRvY3VtZW50O1xuXHRyZXN1bHRzID0gcmVzdWx0cyB8fCBbXTtcblxuXHRpZiAoICFzZWxlY3RvciB8fCB0eXBlb2Ygc2VsZWN0b3IgIT09IFwic3RyaW5nXCIgKSB7XG5cdFx0cmV0dXJuIHJlc3VsdHM7XG5cdH1cblxuXHRpZiAoIChub2RlVHlwZSA9IGNvbnRleHQubm9kZVR5cGUpICE9PSAxICYmIG5vZGVUeXBlICE9PSA5ICkge1xuXHRcdHJldHVybiBbXTtcblx0fVxuXG5cdGlmICggZG9jdW1lbnRJc0hUTUwgJiYgIXNlZWQgKSB7XG5cblx0XHQvLyBTaG9ydGN1dHNcblx0XHRpZiAoIChtYXRjaCA9IHJxdWlja0V4cHIuZXhlYyggc2VsZWN0b3IgKSkgKSB7XG5cdFx0XHQvLyBTcGVlZC11cDogU2l6emxlKFwiI0lEXCIpXG5cdFx0XHRpZiAoIChtID0gbWF0Y2hbMV0pICkge1xuXHRcdFx0XHRpZiAoIG5vZGVUeXBlID09PSA5ICkge1xuXHRcdFx0XHRcdGVsZW0gPSBjb250ZXh0LmdldEVsZW1lbnRCeUlkKCBtICk7XG5cdFx0XHRcdFx0Ly8gQ2hlY2sgcGFyZW50Tm9kZSB0byBjYXRjaCB3aGVuIEJsYWNrYmVycnkgNC42IHJldHVybnNcblx0XHRcdFx0XHQvLyBub2RlcyB0aGF0IGFyZSBubyBsb25nZXIgaW4gdGhlIGRvY3VtZW50IChqUXVlcnkgIzY5NjMpXG5cdFx0XHRcdFx0aWYgKCBlbGVtICYmIGVsZW0ucGFyZW50Tm9kZSApIHtcblx0XHRcdFx0XHRcdC8vIEhhbmRsZSB0aGUgY2FzZSB3aGVyZSBJRSwgT3BlcmEsIGFuZCBXZWJraXQgcmV0dXJuIGl0ZW1zXG5cdFx0XHRcdFx0XHQvLyBieSBuYW1lIGluc3RlYWQgb2YgSURcblx0XHRcdFx0XHRcdGlmICggZWxlbS5pZCA9PT0gbSApIHtcblx0XHRcdFx0XHRcdFx0cmVzdWx0cy5wdXNoKCBlbGVtICk7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXN1bHRzO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmVzdWx0cztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Ly8gQ29udGV4dCBpcyBub3QgYSBkb2N1bWVudFxuXHRcdFx0XHRcdGlmICggY29udGV4dC5vd25lckRvY3VtZW50ICYmIChlbGVtID0gY29udGV4dC5vd25lckRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCBtICkpICYmXG5cdFx0XHRcdFx0XHRjb250YWlucyggY29udGV4dCwgZWxlbSApICYmIGVsZW0uaWQgPT09IG0gKSB7XG5cdFx0XHRcdFx0XHRyZXN1bHRzLnB1c2goIGVsZW0gKTtcblx0XHRcdFx0XHRcdHJldHVybiByZXN1bHRzO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHQvLyBTcGVlZC11cDogU2l6emxlKFwiVEFHXCIpXG5cdFx0XHR9IGVsc2UgaWYgKCBtYXRjaFsyXSApIHtcblx0XHRcdFx0cHVzaC5hcHBseSggcmVzdWx0cywgY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSggc2VsZWN0b3IgKSApO1xuXHRcdFx0XHRyZXR1cm4gcmVzdWx0cztcblxuXHRcdFx0Ly8gU3BlZWQtdXA6IFNpenpsZShcIi5DTEFTU1wiKVxuXHRcdFx0fSBlbHNlIGlmICggKG0gPSBtYXRjaFszXSkgJiYgc3VwcG9ydC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lICkge1xuXHRcdFx0XHRwdXNoLmFwcGx5KCByZXN1bHRzLCBjb250ZXh0LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoIG0gKSApO1xuXHRcdFx0XHRyZXR1cm4gcmVzdWx0cztcblx0XHRcdH1cblx0XHR9XG5cblx0XHQvLyBRU0EgcGF0aFxuXHRcdGlmICggc3VwcG9ydC5xc2EgJiYgKCFyYnVnZ3lRU0EgfHwgIXJidWdneVFTQS50ZXN0KCBzZWxlY3RvciApKSApIHtcblx0XHRcdG5pZCA9IG9sZCA9IGV4cGFuZG87XG5cdFx0XHRuZXdDb250ZXh0ID0gY29udGV4dDtcblx0XHRcdG5ld1NlbGVjdG9yID0gbm9kZVR5cGUgPT09IDkgJiYgc2VsZWN0b3I7XG5cblx0XHRcdC8vIHFTQSB3b3JrcyBzdHJhbmdlbHkgb24gRWxlbWVudC1yb290ZWQgcXVlcmllc1xuXHRcdFx0Ly8gV2UgY2FuIHdvcmsgYXJvdW5kIHRoaXMgYnkgc3BlY2lmeWluZyBhbiBleHRyYSBJRCBvbiB0aGUgcm9vdFxuXHRcdFx0Ly8gYW5kIHdvcmtpbmcgdXAgZnJvbSB0aGVyZSAoVGhhbmtzIHRvIEFuZHJldyBEdXBvbnQgZm9yIHRoZSB0ZWNobmlxdWUpXG5cdFx0XHQvLyBJRSA4IGRvZXNuJ3Qgd29yayBvbiBvYmplY3QgZWxlbWVudHNcblx0XHRcdGlmICggbm9kZVR5cGUgPT09IDEgJiYgY29udGV4dC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpICE9PSBcIm9iamVjdFwiICkge1xuXHRcdFx0XHRncm91cHMgPSB0b2tlbml6ZSggc2VsZWN0b3IgKTtcblxuXHRcdFx0XHRpZiAoIChvbGQgPSBjb250ZXh0LmdldEF0dHJpYnV0ZShcImlkXCIpKSApIHtcblx0XHRcdFx0XHRuaWQgPSBvbGQucmVwbGFjZSggcmVzY2FwZSwgXCJcXFxcJCZcIiApO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvbnRleHQuc2V0QXR0cmlidXRlKCBcImlkXCIsIG5pZCApO1xuXHRcdFx0XHR9XG5cdFx0XHRcdG5pZCA9IFwiW2lkPSdcIiArIG5pZCArIFwiJ10gXCI7XG5cblx0XHRcdFx0aSA9IGdyb3Vwcy5sZW5ndGg7XG5cdFx0XHRcdHdoaWxlICggaS0tICkge1xuXHRcdFx0XHRcdGdyb3Vwc1tpXSA9IG5pZCArIHRvU2VsZWN0b3IoIGdyb3Vwc1tpXSApO1xuXHRcdFx0XHR9XG5cdFx0XHRcdG5ld0NvbnRleHQgPSByc2libGluZy50ZXN0KCBzZWxlY3RvciApICYmIHRlc3RDb250ZXh0KCBjb250ZXh0LnBhcmVudE5vZGUgKSB8fCBjb250ZXh0O1xuXHRcdFx0XHRuZXdTZWxlY3RvciA9IGdyb3Vwcy5qb2luKFwiLFwiKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKCBuZXdTZWxlY3RvciApIHtcblx0XHRcdFx0dHJ5IHtcblx0XHRcdFx0XHRwdXNoLmFwcGx5KCByZXN1bHRzLFxuXHRcdFx0XHRcdFx0bmV3Q29udGV4dC5xdWVyeVNlbGVjdG9yQWxsKCBuZXdTZWxlY3RvciApXG5cdFx0XHRcdFx0KTtcblx0XHRcdFx0XHRyZXR1cm4gcmVzdWx0cztcblx0XHRcdFx0fSBjYXRjaChxc2FFcnJvcikge1xuXHRcdFx0XHR9IGZpbmFsbHkge1xuXHRcdFx0XHRcdGlmICggIW9sZCApIHtcblx0XHRcdFx0XHRcdGNvbnRleHQucmVtb3ZlQXR0cmlidXRlKFwiaWRcIik7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0Ly8gQWxsIG90aGVyc1xuXHRyZXR1cm4gc2VsZWN0KCBzZWxlY3Rvci5yZXBsYWNlKCBydHJpbSwgXCIkMVwiICksIGNvbnRleHQsIHJlc3VsdHMsIHNlZWQgKTtcbn1cblxuLyoqXG4gKiBDcmVhdGUga2V5LXZhbHVlIGNhY2hlcyBvZiBsaW1pdGVkIHNpemVcbiAqIEByZXR1cm5zIHtGdW5jdGlvbihzdHJpbmcsIE9iamVjdCl9IFJldHVybnMgdGhlIE9iamVjdCBkYXRhIGFmdGVyIHN0b3JpbmcgaXQgb24gaXRzZWxmIHdpdGhcbiAqXHRwcm9wZXJ0eSBuYW1lIHRoZSAoc3BhY2Utc3VmZml4ZWQpIHN0cmluZyBhbmQgKGlmIHRoZSBjYWNoZSBpcyBsYXJnZXIgdGhhbiBFeHByLmNhY2hlTGVuZ3RoKVxuICpcdGRlbGV0aW5nIHRoZSBvbGRlc3QgZW50cnlcbiAqL1xuZnVuY3Rpb24gY3JlYXRlQ2FjaGUoKSB7XG5cdHZhciBrZXlzID0gW107XG5cblx0ZnVuY3Rpb24gY2FjaGUoIGtleSwgdmFsdWUgKSB7XG5cdFx0Ly8gVXNlIChrZXkgKyBcIiBcIikgdG8gYXZvaWQgY29sbGlzaW9uIHdpdGggbmF0aXZlIHByb3RvdHlwZSBwcm9wZXJ0aWVzIChzZWUgSXNzdWUgIzE1Nylcblx0XHRpZiAoIGtleXMucHVzaCgga2V5ICsgXCIgXCIgKSA+IEV4cHIuY2FjaGVMZW5ndGggKSB7XG5cdFx0XHQvLyBPbmx5IGtlZXAgdGhlIG1vc3QgcmVjZW50IGVudHJpZXNcblx0XHRcdGRlbGV0ZSBjYWNoZVsga2V5cy5zaGlmdCgpIF07XG5cdFx0fVxuXHRcdHJldHVybiAoY2FjaGVbIGtleSArIFwiIFwiIF0gPSB2YWx1ZSk7XG5cdH1cblx0cmV0dXJuIGNhY2hlO1xufVxuXG4vKipcbiAqIE1hcmsgYSBmdW5jdGlvbiBmb3Igc3BlY2lhbCB1c2UgYnkgU2l6emxlXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbiBUaGUgZnVuY3Rpb24gdG8gbWFya1xuICovXG5mdW5jdGlvbiBtYXJrRnVuY3Rpb24oIGZuICkge1xuXHRmblsgZXhwYW5kbyBdID0gdHJ1ZTtcblx0cmV0dXJuIGZuO1xufVxuXG4vKipcbiAqIFN1cHBvcnQgdGVzdGluZyB1c2luZyBhbiBlbGVtZW50XG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbiBQYXNzZWQgdGhlIGNyZWF0ZWQgZGl2IGFuZCBleHBlY3RzIGEgYm9vbGVhbiByZXN1bHRcbiAqL1xuZnVuY3Rpb24gYXNzZXJ0KCBmbiApIHtcblx0dmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cblx0dHJ5IHtcblx0XHRyZXR1cm4gISFmbiggZGl2ICk7XG5cdH0gY2F0Y2ggKGUpIHtcblx0XHRyZXR1cm4gZmFsc2U7XG5cdH0gZmluYWxseSB7XG5cdFx0Ly8gUmVtb3ZlIGZyb20gaXRzIHBhcmVudCBieSBkZWZhdWx0XG5cdFx0aWYgKCBkaXYucGFyZW50Tm9kZSApIHtcblx0XHRcdGRpdi5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKCBkaXYgKTtcblx0XHR9XG5cdFx0Ly8gcmVsZWFzZSBtZW1vcnkgaW4gSUVcblx0XHRkaXYgPSBudWxsO1xuXHR9XG59XG5cbi8qKlxuICogQWRkcyB0aGUgc2FtZSBoYW5kbGVyIGZvciBhbGwgb2YgdGhlIHNwZWNpZmllZCBhdHRyc1xuICogQHBhcmFtIHtTdHJpbmd9IGF0dHJzIFBpcGUtc2VwYXJhdGVkIGxpc3Qgb2YgYXR0cmlidXRlc1xuICogQHBhcmFtIHtGdW5jdGlvbn0gaGFuZGxlciBUaGUgbWV0aG9kIHRoYXQgd2lsbCBiZSBhcHBsaWVkXG4gKi9cbmZ1bmN0aW9uIGFkZEhhbmRsZSggYXR0cnMsIGhhbmRsZXIgKSB7XG5cdHZhciBhcnIgPSBhdHRycy5zcGxpdChcInxcIiksXG5cdFx0aSA9IGF0dHJzLmxlbmd0aDtcblxuXHR3aGlsZSAoIGktLSApIHtcblx0XHRFeHByLmF0dHJIYW5kbGVbIGFycltpXSBdID0gaGFuZGxlcjtcblx0fVxufVxuXG4vKipcbiAqIENoZWNrcyBkb2N1bWVudCBvcmRlciBvZiB0d28gc2libGluZ3NcbiAqIEBwYXJhbSB7RWxlbWVudH0gYVxuICogQHBhcmFtIHtFbGVtZW50fSBiXG4gKiBAcmV0dXJucyB7TnVtYmVyfSBSZXR1cm5zIGxlc3MgdGhhbiAwIGlmIGEgcHJlY2VkZXMgYiwgZ3JlYXRlciB0aGFuIDAgaWYgYSBmb2xsb3dzIGJcbiAqL1xuZnVuY3Rpb24gc2libGluZ0NoZWNrKCBhLCBiICkge1xuXHR2YXIgY3VyID0gYiAmJiBhLFxuXHRcdGRpZmYgPSBjdXIgJiYgYS5ub2RlVHlwZSA9PT0gMSAmJiBiLm5vZGVUeXBlID09PSAxICYmXG5cdFx0XHQoIH5iLnNvdXJjZUluZGV4IHx8IE1BWF9ORUdBVElWRSApIC1cblx0XHRcdCggfmEuc291cmNlSW5kZXggfHwgTUFYX05FR0FUSVZFICk7XG5cblx0Ly8gVXNlIElFIHNvdXJjZUluZGV4IGlmIGF2YWlsYWJsZSBvbiBib3RoIG5vZGVzXG5cdGlmICggZGlmZiApIHtcblx0XHRyZXR1cm4gZGlmZjtcblx0fVxuXG5cdC8vIENoZWNrIGlmIGIgZm9sbG93cyBhXG5cdGlmICggY3VyICkge1xuXHRcdHdoaWxlICggKGN1ciA9IGN1ci5uZXh0U2libGluZykgKSB7XG5cdFx0XHRpZiAoIGN1ciA9PT0gYiApIHtcblx0XHRcdFx0cmV0dXJuIC0xO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdHJldHVybiBhID8gMSA6IC0xO1xufVxuXG4vKipcbiAqIFJldHVybnMgYSBmdW5jdGlvbiB0byB1c2UgaW4gcHNldWRvcyBmb3IgaW5wdXQgdHlwZXNcbiAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlXG4gKi9cbmZ1bmN0aW9uIGNyZWF0ZUlucHV0UHNldWRvKCB0eXBlICkge1xuXHRyZXR1cm4gZnVuY3Rpb24oIGVsZW0gKSB7XG5cdFx0dmFyIG5hbWUgPSBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7XG5cdFx0cmV0dXJuIG5hbWUgPT09IFwiaW5wdXRcIiAmJiBlbGVtLnR5cGUgPT09IHR5cGU7XG5cdH07XG59XG5cbi8qKlxuICogUmV0dXJucyBhIGZ1bmN0aW9uIHRvIHVzZSBpbiBwc2V1ZG9zIGZvciBidXR0b25zXG4gKiBAcGFyYW0ge1N0cmluZ30gdHlwZVxuICovXG5mdW5jdGlvbiBjcmVhdGVCdXR0b25Qc2V1ZG8oIHR5cGUgKSB7XG5cdHJldHVybiBmdW5jdGlvbiggZWxlbSApIHtcblx0XHR2YXIgbmFtZSA9IGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtcblx0XHRyZXR1cm4gKG5hbWUgPT09IFwiaW5wdXRcIiB8fCBuYW1lID09PSBcImJ1dHRvblwiKSAmJiBlbGVtLnR5cGUgPT09IHR5cGU7XG5cdH07XG59XG5cbi8qKlxuICogUmV0dXJucyBhIGZ1bmN0aW9uIHRvIHVzZSBpbiBwc2V1ZG9zIGZvciBwb3NpdGlvbmFsc1xuICogQHBhcmFtIHtGdW5jdGlvbn0gZm5cbiAqL1xuZnVuY3Rpb24gY3JlYXRlUG9zaXRpb25hbFBzZXVkbyggZm4gKSB7XG5cdHJldHVybiBtYXJrRnVuY3Rpb24oZnVuY3Rpb24oIGFyZ3VtZW50ICkge1xuXHRcdGFyZ3VtZW50ID0gK2FyZ3VtZW50O1xuXHRcdHJldHVybiBtYXJrRnVuY3Rpb24oZnVuY3Rpb24oIHNlZWQsIG1hdGNoZXMgKSB7XG5cdFx0XHR2YXIgaixcblx0XHRcdFx0bWF0Y2hJbmRleGVzID0gZm4oIFtdLCBzZWVkLmxlbmd0aCwgYXJndW1lbnQgKSxcblx0XHRcdFx0aSA9IG1hdGNoSW5kZXhlcy5sZW5ndGg7XG5cblx0XHRcdC8vIE1hdGNoIGVsZW1lbnRzIGZvdW5kIGF0IHRoZSBzcGVjaWZpZWQgaW5kZXhlc1xuXHRcdFx0d2hpbGUgKCBpLS0gKSB7XG5cdFx0XHRcdGlmICggc2VlZFsgKGogPSBtYXRjaEluZGV4ZXNbaV0pIF0gKSB7XG5cdFx0XHRcdFx0c2VlZFtqXSA9ICEobWF0Y2hlc1tqXSA9IHNlZWRbal0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH0pO1xufVxuXG4vKipcbiAqIENoZWNrcyBhIG5vZGUgZm9yIHZhbGlkaXR5IGFzIGEgU2l6emxlIGNvbnRleHRcbiAqIEBwYXJhbSB7RWxlbWVudHxPYmplY3Q9fSBjb250ZXh0XG4gKiBAcmV0dXJucyB7RWxlbWVudHxPYmplY3R8Qm9vbGVhbn0gVGhlIGlucHV0IG5vZGUgaWYgYWNjZXB0YWJsZSwgb3RoZXJ3aXNlIGEgZmFsc3kgdmFsdWVcbiAqL1xuZnVuY3Rpb24gdGVzdENvbnRleHQoIGNvbnRleHQgKSB7XG5cdHJldHVybiBjb250ZXh0ICYmIHR5cGVvZiBjb250ZXh0LmdldEVsZW1lbnRzQnlUYWdOYW1lICE9PSBzdHJ1bmRlZmluZWQgJiYgY29udGV4dDtcbn1cblxuLy8gRXhwb3NlIHN1cHBvcnQgdmFycyBmb3IgY29udmVuaWVuY2VcbnN1cHBvcnQgPSBTaXp6bGUuc3VwcG9ydCA9IHt9O1xuXG4vKipcbiAqIERldGVjdHMgWE1MIG5vZGVzXG4gKiBAcGFyYW0ge0VsZW1lbnR8T2JqZWN0fSBlbGVtIEFuIGVsZW1lbnQgb3IgYSBkb2N1bWVudFxuICogQHJldHVybnMge0Jvb2xlYW59IFRydWUgaWZmIGVsZW0gaXMgYSBub24tSFRNTCBYTUwgbm9kZVxuICovXG5pc1hNTCA9IFNpenpsZS5pc1hNTCA9IGZ1bmN0aW9uKCBlbGVtICkge1xuXHQvLyBkb2N1bWVudEVsZW1lbnQgaXMgdmVyaWZpZWQgZm9yIGNhc2VzIHdoZXJlIGl0IGRvZXNuJ3QgeWV0IGV4aXN0XG5cdC8vIChzdWNoIGFzIGxvYWRpbmcgaWZyYW1lcyBpbiBJRSAtICM0ODMzKVxuXHR2YXIgZG9jdW1lbnRFbGVtZW50ID0gZWxlbSAmJiAoZWxlbS5vd25lckRvY3VtZW50IHx8IGVsZW0pLmRvY3VtZW50RWxlbWVudDtcblx0cmV0dXJuIGRvY3VtZW50RWxlbWVudCA/IGRvY3VtZW50RWxlbWVudC5ub2RlTmFtZSAhPT0gXCJIVE1MXCIgOiBmYWxzZTtcbn07XG5cbi8qKlxuICogU2V0cyBkb2N1bWVudC1yZWxhdGVkIHZhcmlhYmxlcyBvbmNlIGJhc2VkIG9uIHRoZSBjdXJyZW50IGRvY3VtZW50XG4gKiBAcGFyYW0ge0VsZW1lbnR8T2JqZWN0fSBbZG9jXSBBbiBlbGVtZW50IG9yIGRvY3VtZW50IG9iamVjdCB0byB1c2UgdG8gc2V0IHRoZSBkb2N1bWVudFxuICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgY3VycmVudCBkb2N1bWVudFxuICovXG5zZXREb2N1bWVudCA9IFNpenpsZS5zZXREb2N1bWVudCA9IGZ1bmN0aW9uKCBub2RlICkge1xuXHR2YXIgaGFzQ29tcGFyZSxcblx0XHRkb2MgPSBub2RlID8gbm9kZS5vd25lckRvY3VtZW50IHx8IG5vZGUgOiBwcmVmZXJyZWREb2MsXG5cdFx0cGFyZW50ID0gZG9jLmRlZmF1bHRWaWV3O1xuXG5cdGZ1bmN0aW9uIGdldFRvcCh3aW4pIHtcblx0XHQvLyBFZGdlIHRocm93cyBhIGxvdmVseSBPYmplY3QgZXhwZWN0ZWQgaWYgeW91IHRyeSB0byBnZXQgdG9wIG9uIGEgZGV0YWNoZWQgcmVmZXJlbmNlIHNlZSAjMjY0MlxuXHRcdHRyeSB7XG5cdFx0XHRyZXR1cm4gd2luLnRvcDtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0Ly8gSWdub3JlXG5cdFx0fVxuXG5cdFx0cmV0dXJuIG51bGw7XG5cdH1cblxuXHQvLyBJZiBubyBkb2N1bWVudCBhbmQgZG9jdW1lbnRFbGVtZW50IGlzIGF2YWlsYWJsZSwgcmV0dXJuXG5cdGlmICggZG9jID09PSBkb2N1bWVudCB8fCBkb2Mubm9kZVR5cGUgIT09IDkgfHwgIWRvYy5kb2N1bWVudEVsZW1lbnQgKSB7XG5cdFx0cmV0dXJuIGRvY3VtZW50O1xuXHR9XG5cblx0Ly8gU2V0IG91ciBkb2N1bWVudFxuXHRkb2N1bWVudCA9IGRvYztcblx0ZG9jRWxlbSA9IGRvYy5kb2N1bWVudEVsZW1lbnQ7XG5cblx0Ly8gU3VwcG9ydCB0ZXN0c1xuXHRkb2N1bWVudElzSFRNTCA9ICFpc1hNTCggZG9jICk7XG5cblx0Ly8gU3VwcG9ydDogSUU+OFxuXHQvLyBJZiBpZnJhbWUgZG9jdW1lbnQgaXMgYXNzaWduZWQgdG8gXCJkb2N1bWVudFwiIHZhcmlhYmxlIGFuZCBpZiBpZnJhbWUgaGFzIGJlZW4gcmVsb2FkZWQsXG5cdC8vIElFIHdpbGwgdGhyb3cgXCJwZXJtaXNzaW9uIGRlbmllZFwiIGVycm9yIHdoZW4gYWNjZXNzaW5nIFwiZG9jdW1lbnRcIiB2YXJpYWJsZSwgc2VlIGpRdWVyeSAjMTM5MzZcblx0Ly8gSUU2LTggZG8gbm90IHN1cHBvcnQgdGhlIGRlZmF1bHRWaWV3IHByb3BlcnR5IHNvIHBhcmVudCB3aWxsIGJlIHVuZGVmaW5lZFxuXHRpZiAoIHBhcmVudCAmJiBwYXJlbnQgIT09IGdldFRvcChwYXJlbnQpICkge1xuXHRcdC8vIElFMTEgZG9lcyBub3QgaGF2ZSBhdHRhY2hFdmVudCwgc28gYWxsIG11c3Qgc3VmZmVyXG5cdFx0aWYgKCBwYXJlbnQuYWRkRXZlbnRMaXN0ZW5lciApIHtcblx0XHRcdHBhcmVudC5hZGRFdmVudExpc3RlbmVyKCBcInVubG9hZFwiLCBmdW5jdGlvbigpIHtcblx0XHRcdFx0c2V0RG9jdW1lbnQoKTtcblx0XHRcdH0sIGZhbHNlICk7XG5cdFx0fSBlbHNlIGlmICggcGFyZW50LmF0dGFjaEV2ZW50ICkge1xuXHRcdFx0cGFyZW50LmF0dGFjaEV2ZW50KCBcIm9udW5sb2FkXCIsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRzZXREb2N1bWVudCgpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXHR9XG5cblx0LyogQXR0cmlidXRlc1xuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cblx0Ly8gU3VwcG9ydDogSUU8OFxuXHQvLyBWZXJpZnkgdGhhdCBnZXRBdHRyaWJ1dGUgcmVhbGx5IHJldHVybnMgYXR0cmlidXRlcyBhbmQgbm90IHByb3BlcnRpZXMgKGV4Y2VwdGluZyBJRTggYm9vbGVhbnMpXG5cdHN1cHBvcnQuYXR0cmlidXRlcyA9IGFzc2VydChmdW5jdGlvbiggZGl2ICkge1xuXHRcdGRpdi5jbGFzc05hbWUgPSBcImlcIjtcblx0XHRyZXR1cm4gIWRpdi5nZXRBdHRyaWJ1dGUoXCJjbGFzc05hbWVcIik7XG5cdH0pO1xuXG5cdC8qIGdldEVsZW1lbnQocylCeSpcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5cdC8vIENoZWNrIGlmIGdldEVsZW1lbnRzQnlUYWdOYW1lKFwiKlwiKSByZXR1cm5zIG9ubHkgZWxlbWVudHNcblx0c3VwcG9ydC5nZXRFbGVtZW50c0J5VGFnTmFtZSA9IGFzc2VydChmdW5jdGlvbiggZGl2ICkge1xuXHRcdGRpdi5hcHBlbmRDaGlsZCggZG9jLmNyZWF0ZUNvbW1lbnQoXCJcIikgKTtcblx0XHRyZXR1cm4gIWRpdi5nZXRFbGVtZW50c0J5VGFnTmFtZShcIipcIikubGVuZ3RoO1xuXHR9KTtcblxuXHQvLyBTdXBwb3J0OiBJRTw5XG5cdHN1cHBvcnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSA9IHJuYXRpdmUudGVzdCggZG9jLmdldEVsZW1lbnRzQnlDbGFzc05hbWUgKTtcblxuXHQvLyBTdXBwb3J0OiBJRTwxMFxuXHQvLyBDaGVjayBpZiBnZXRFbGVtZW50QnlJZCByZXR1cm5zIGVsZW1lbnRzIGJ5IG5hbWVcblx0Ly8gVGhlIGJyb2tlbiBnZXRFbGVtZW50QnlJZCBtZXRob2RzIGRvbid0IHBpY2sgdXAgcHJvZ3JhbWF0aWNhbGx5LXNldCBuYW1lcyxcblx0Ly8gc28gdXNlIGEgcm91bmRhYm91dCBnZXRFbGVtZW50c0J5TmFtZSB0ZXN0XG5cdHN1cHBvcnQuZ2V0QnlJZCA9IGFzc2VydChmdW5jdGlvbiggZGl2ICkge1xuXHRcdGRvY0VsZW0uYXBwZW5kQ2hpbGQoIGRpdiApLmlkID0gZXhwYW5kbztcblx0XHRyZXR1cm4gIWRvYy5nZXRFbGVtZW50c0J5TmFtZSB8fCAhZG9jLmdldEVsZW1lbnRzQnlOYW1lKCBleHBhbmRvICkubGVuZ3RoO1xuXHR9KTtcblxuXHQvLyBJRCBmaW5kIGFuZCBmaWx0ZXJcblx0aWYgKCBzdXBwb3J0LmdldEJ5SWQgKSB7XG5cdFx0RXhwci5maW5kW1wiSURcIl0gPSBmdW5jdGlvbiggaWQsIGNvbnRleHQgKSB7XG5cdFx0XHRpZiAoIHR5cGVvZiBjb250ZXh0LmdldEVsZW1lbnRCeUlkICE9PSBzdHJ1bmRlZmluZWQgJiYgZG9jdW1lbnRJc0hUTUwgKSB7XG5cdFx0XHRcdHZhciBtID0gY29udGV4dC5nZXRFbGVtZW50QnlJZCggaWQgKTtcblx0XHRcdFx0Ly8gQ2hlY2sgcGFyZW50Tm9kZSB0byBjYXRjaCB3aGVuIEJsYWNrYmVycnkgNC42IHJldHVybnNcblx0XHRcdFx0Ly8gbm9kZXMgdGhhdCBhcmUgbm8gbG9uZ2VyIGluIHRoZSBkb2N1bWVudCAjNjk2M1xuXHRcdFx0XHRyZXR1cm4gbSAmJiBtLnBhcmVudE5vZGUgPyBbIG0gXSA6IFtdO1xuXHRcdFx0fVxuXHRcdH07XG5cdFx0RXhwci5maWx0ZXJbXCJJRFwiXSA9IGZ1bmN0aW9uKCBpZCApIHtcblx0XHRcdHZhciBhdHRySWQgPSBpZC5yZXBsYWNlKCBydW5lc2NhcGUsIGZ1bmVzY2FwZSApO1xuXHRcdFx0cmV0dXJuIGZ1bmN0aW9uKCBlbGVtICkge1xuXHRcdFx0XHRyZXR1cm4gZWxlbS5nZXRBdHRyaWJ1dGUoXCJpZFwiKSA9PT0gYXR0cklkO1xuXHRcdFx0fTtcblx0XHR9O1xuXHR9IGVsc2Uge1xuXHRcdC8vIFN1cHBvcnQ6IElFNi83XG5cdFx0Ly8gZ2V0RWxlbWVudEJ5SWQgaXMgbm90IHJlbGlhYmxlIGFzIGEgZmluZCBzaG9ydGN1dFxuXHRcdGRlbGV0ZSBFeHByLmZpbmRbXCJJRFwiXTtcblxuXHRcdEV4cHIuZmlsdGVyW1wiSURcIl0gPSAgZnVuY3Rpb24oIGlkICkge1xuXHRcdFx0dmFyIGF0dHJJZCA9IGlkLnJlcGxhY2UoIHJ1bmVzY2FwZSwgZnVuZXNjYXBlICk7XG5cdFx0XHRyZXR1cm4gZnVuY3Rpb24oIGVsZW0gKSB7XG5cdFx0XHRcdHZhciBub2RlID0gdHlwZW9mIGVsZW0uZ2V0QXR0cmlidXRlTm9kZSAhPT0gc3RydW5kZWZpbmVkICYmIGVsZW0uZ2V0QXR0cmlidXRlTm9kZShcImlkXCIpO1xuXHRcdFx0XHRyZXR1cm4gbm9kZSAmJiBub2RlLnZhbHVlID09PSBhdHRySWQ7XG5cdFx0XHR9O1xuXHRcdH07XG5cdH1cblxuXHQvLyBUYWdcblx0RXhwci5maW5kW1wiVEFHXCJdID0gc3VwcG9ydC5nZXRFbGVtZW50c0J5VGFnTmFtZSA/XG5cdFx0ZnVuY3Rpb24oIHRhZywgY29udGV4dCApIHtcblx0XHRcdGlmICggdHlwZW9mIGNvbnRleHQuZ2V0RWxlbWVudHNCeVRhZ05hbWUgIT09IHN0cnVuZGVmaW5lZCApIHtcblx0XHRcdFx0cmV0dXJuIGNvbnRleHQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoIHRhZyApO1xuXHRcdFx0fVxuXHRcdH0gOlxuXHRcdGZ1bmN0aW9uKCB0YWcsIGNvbnRleHQgKSB7XG5cdFx0XHR2YXIgZWxlbSxcblx0XHRcdFx0dG1wID0gW10sXG5cdFx0XHRcdGkgPSAwLFxuXHRcdFx0XHRyZXN1bHRzID0gY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSggdGFnICk7XG5cblx0XHRcdC8vIEZpbHRlciBvdXQgcG9zc2libGUgY29tbWVudHNcblx0XHRcdGlmICggdGFnID09PSBcIipcIiApIHtcblx0XHRcdFx0d2hpbGUgKCAoZWxlbSA9IHJlc3VsdHNbaSsrXSkgKSB7XG5cdFx0XHRcdFx0aWYgKCBlbGVtLm5vZGVUeXBlID09PSAxICkge1xuXHRcdFx0XHRcdFx0dG1wLnB1c2goIGVsZW0gKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gdG1wO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJlc3VsdHM7XG5cdFx0fTtcblxuXHQvLyBDbGFzc1xuXHRFeHByLmZpbmRbXCJDTEFTU1wiXSA9IHN1cHBvcnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSAmJiBmdW5jdGlvbiggY2xhc3NOYW1lLCBjb250ZXh0ICkge1xuXHRcdGlmICggZG9jdW1lbnRJc0hUTUwgKSB7XG5cdFx0XHRyZXR1cm4gY29udGV4dC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCBjbGFzc05hbWUgKTtcblx0XHR9XG5cdH07XG5cblx0LyogUVNBL21hdGNoZXNTZWxlY3RvclxuXHQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cblx0Ly8gUVNBIGFuZCBtYXRjaGVzU2VsZWN0b3Igc3VwcG9ydFxuXG5cdC8vIG1hdGNoZXNTZWxlY3Rvcig6YWN0aXZlKSByZXBvcnRzIGZhbHNlIHdoZW4gdHJ1ZSAoSUU5L09wZXJhIDExLjUpXG5cdHJidWdneU1hdGNoZXMgPSBbXTtcblxuXHQvLyBxU2EoOmZvY3VzKSByZXBvcnRzIGZhbHNlIHdoZW4gdHJ1ZSAoQ2hyb21lIDIxKVxuXHQvLyBXZSBhbGxvdyB0aGlzIGJlY2F1c2Ugb2YgYSBidWcgaW4gSUU4LzkgdGhhdCB0aHJvd3MgYW4gZXJyb3Jcblx0Ly8gd2hlbmV2ZXIgYGRvY3VtZW50LmFjdGl2ZUVsZW1lbnRgIGlzIGFjY2Vzc2VkIG9uIGFuIGlmcmFtZVxuXHQvLyBTbywgd2UgYWxsb3cgOmZvY3VzIHRvIHBhc3MgdGhyb3VnaCBRU0EgYWxsIHRoZSB0aW1lIHRvIGF2b2lkIHRoZSBJRSBlcnJvclxuXHQvLyBTZWUgaHR0cDovL2J1Z3MuanF1ZXJ5LmNvbS90aWNrZXQvMTMzNzhcblx0cmJ1Z2d5UVNBID0gW107XG5cblx0aWYgKCAoc3VwcG9ydC5xc2EgPSBybmF0aXZlLnRlc3QoIGRvYy5xdWVyeVNlbGVjdG9yQWxsICkpICkge1xuXHRcdC8vIEJ1aWxkIFFTQSByZWdleFxuXHRcdC8vIFJlZ2V4IHN0cmF0ZWd5IGFkb3B0ZWQgZnJvbSBEaWVnbyBQZXJpbmlcblx0XHRhc3NlcnQoZnVuY3Rpb24oIGRpdiApIHtcblx0XHRcdC8vIFNlbGVjdCBpcyBzZXQgdG8gZW1wdHkgc3RyaW5nIG9uIHB1cnBvc2Vcblx0XHRcdC8vIFRoaXMgaXMgdG8gdGVzdCBJRSdzIHRyZWF0bWVudCBvZiBub3QgZXhwbGljaXRseVxuXHRcdFx0Ly8gc2V0dGluZyBhIGJvb2xlYW4gY29udGVudCBhdHRyaWJ1dGUsXG5cdFx0XHQvLyBzaW5jZSBpdHMgcHJlc2VuY2Ugc2hvdWxkIGJlIGVub3VnaFxuXHRcdFx0Ly8gaHR0cDovL2J1Z3MuanF1ZXJ5LmNvbS90aWNrZXQvMTIzNTlcblx0XHRcdGRpdi5pbm5lckhUTUwgPSBcIjxzZWxlY3QgbXNhbGxvd2NhcHR1cmU9Jyc+PG9wdGlvbiBzZWxlY3RlZD0nJz48L29wdGlvbj48L3NlbGVjdD5cIjtcblxuXHRcdFx0Ly8gU3VwcG9ydDogSUU4LCBPcGVyYSAxMS0xMi4xNlxuXHRcdFx0Ly8gTm90aGluZyBzaG91bGQgYmUgc2VsZWN0ZWQgd2hlbiBlbXB0eSBzdHJpbmdzIGZvbGxvdyBePSBvciAkPSBvciAqPVxuXHRcdFx0Ly8gVGhlIHRlc3QgYXR0cmlidXRlIG11c3QgYmUgdW5rbm93biBpbiBPcGVyYSBidXQgXCJzYWZlXCIgZm9yIFdpblJUXG5cdFx0XHQvLyBodHRwOi8vbXNkbi5taWNyb3NvZnQuY29tL2VuLXVzL2xpYnJhcnkvaWUvaGg0NjUzODguYXNweCNhdHRyaWJ1dGVfc2VjdGlvblxuXHRcdFx0aWYgKCBkaXYucXVlcnlTZWxlY3RvckFsbChcIlttc2FsbG93Y2FwdHVyZV49JyddXCIpLmxlbmd0aCApIHtcblx0XHRcdFx0cmJ1Z2d5UVNBLnB1c2goIFwiWypeJF09XCIgKyB3aGl0ZXNwYWNlICsgXCIqKD86Jyd8XFxcIlxcXCIpXCIgKTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gU3VwcG9ydDogSUU4XG5cdFx0XHQvLyBCb29sZWFuIGF0dHJpYnV0ZXMgYW5kIFwidmFsdWVcIiBhcmUgbm90IHRyZWF0ZWQgY29ycmVjdGx5XG5cdFx0XHRpZiAoICFkaXYucXVlcnlTZWxlY3RvckFsbChcIltzZWxlY3RlZF1cIikubGVuZ3RoICkge1xuXHRcdFx0XHRyYnVnZ3lRU0EucHVzaCggXCJcXFxcW1wiICsgd2hpdGVzcGFjZSArIFwiKig/OnZhbHVlfFwiICsgYm9vbGVhbnMgKyBcIilcIiApO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBXZWJraXQvT3BlcmEgLSA6Y2hlY2tlZCBzaG91bGQgcmV0dXJuIHNlbGVjdGVkIG9wdGlvbiBlbGVtZW50c1xuXHRcdFx0Ly8gaHR0cDovL3d3dy53My5vcmcvVFIvMjAxMS9SRUMtY3NzMy1zZWxlY3RvcnMtMjAxMTA5MjkvI2NoZWNrZWRcblx0XHRcdC8vIElFOCB0aHJvd3MgZXJyb3IgaGVyZSBhbmQgd2lsbCBub3Qgc2VlIGxhdGVyIHRlc3RzXG5cdFx0XHRpZiAoICFkaXYucXVlcnlTZWxlY3RvckFsbChcIjpjaGVja2VkXCIpLmxlbmd0aCApIHtcblx0XHRcdFx0cmJ1Z2d5UVNBLnB1c2goXCI6Y2hlY2tlZFwiKTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGFzc2VydChmdW5jdGlvbiggZGl2ICkge1xuXHRcdFx0Ly8gU3VwcG9ydDogV2luZG93cyA4IE5hdGl2ZSBBcHBzXG5cdFx0XHQvLyBUaGUgdHlwZSBhbmQgbmFtZSBhdHRyaWJ1dGVzIGFyZSByZXN0cmljdGVkIGR1cmluZyAuaW5uZXJIVE1MIGFzc2lnbm1lbnRcblx0XHRcdHZhciBpbnB1dCA9IGRvYy5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIik7XG5cdFx0XHRpbnB1dC5zZXRBdHRyaWJ1dGUoIFwidHlwZVwiLCBcImhpZGRlblwiICk7XG5cdFx0XHRkaXYuYXBwZW5kQ2hpbGQoIGlucHV0ICkuc2V0QXR0cmlidXRlKCBcIm5hbWVcIiwgXCJEXCIgKTtcblxuXHRcdFx0Ly8gU3VwcG9ydDogSUU4XG5cdFx0XHQvLyBFbmZvcmNlIGNhc2Utc2Vuc2l0aXZpdHkgb2YgbmFtZSBhdHRyaWJ1dGVcblx0XHRcdGlmICggZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoXCJbbmFtZT1kXVwiKS5sZW5ndGggKSB7XG5cdFx0XHRcdHJidWdneVFTQS5wdXNoKCBcIm5hbWVcIiArIHdoaXRlc3BhY2UgKyBcIipbKl4kfCF+XT89XCIgKTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gRkYgMy41IC0gOmVuYWJsZWQvOmRpc2FibGVkIGFuZCBoaWRkZW4gZWxlbWVudHMgKGhpZGRlbiBlbGVtZW50cyBhcmUgc3RpbGwgZW5hYmxlZClcblx0XHRcdC8vIElFOCB0aHJvd3MgZXJyb3IgaGVyZSBhbmQgd2lsbCBub3Qgc2VlIGxhdGVyIHRlc3RzXG5cdFx0XHRpZiAoICFkaXYucXVlcnlTZWxlY3RvckFsbChcIjplbmFibGVkXCIpLmxlbmd0aCApIHtcblx0XHRcdFx0cmJ1Z2d5UVNBLnB1c2goIFwiOmVuYWJsZWRcIiwgXCI6ZGlzYWJsZWRcIiApO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBPcGVyYSAxMC0xMSBkb2VzIG5vdCB0aHJvdyBvbiBwb3N0LWNvbW1hIGludmFsaWQgcHNldWRvc1xuXHRcdFx0ZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoXCIqLDp4XCIpO1xuXHRcdFx0cmJ1Z2d5UVNBLnB1c2goXCIsLio6XCIpO1xuXHRcdH0pO1xuXHR9XG5cblx0aWYgKCAoc3VwcG9ydC5tYXRjaGVzU2VsZWN0b3IgPSBybmF0aXZlLnRlc3QoIChtYXRjaGVzID0gZG9jRWxlbS5tYXRjaGVzIHx8XG5cdFx0ZG9jRWxlbS53ZWJraXRNYXRjaGVzU2VsZWN0b3IgfHxcblx0XHRkb2NFbGVtLm1vek1hdGNoZXNTZWxlY3RvciB8fFxuXHRcdGRvY0VsZW0ub01hdGNoZXNTZWxlY3RvciB8fFxuXHRcdGRvY0VsZW0ubXNNYXRjaGVzU2VsZWN0b3IpICkpICkge1xuXG5cdFx0YXNzZXJ0KGZ1bmN0aW9uKCBkaXYgKSB7XG5cdFx0XHQvLyBDaGVjayB0byBzZWUgaWYgaXQncyBwb3NzaWJsZSB0byBkbyBtYXRjaGVzU2VsZWN0b3Jcblx0XHRcdC8vIG9uIGEgZGlzY29ubmVjdGVkIG5vZGUgKElFIDkpXG5cdFx0XHRzdXBwb3J0LmRpc2Nvbm5lY3RlZE1hdGNoID0gbWF0Y2hlcy5jYWxsKCBkaXYsIFwiZGl2XCIgKTtcblxuXHRcdFx0Ly8gVGhpcyBzaG91bGQgZmFpbCB3aXRoIGFuIGV4Y2VwdGlvblxuXHRcdFx0Ly8gR2Vja28gZG9lcyBub3QgZXJyb3IsIHJldHVybnMgZmFsc2UgaW5zdGVhZFxuXHRcdFx0bWF0Y2hlcy5jYWxsKCBkaXYsIFwiW3MhPScnXTp4XCIgKTtcblx0XHRcdHJidWdneU1hdGNoZXMucHVzaCggXCIhPVwiLCBwc2V1ZG9zICk7XG5cdFx0fSk7XG5cdH1cblxuXHRyYnVnZ3lRU0EgPSByYnVnZ3lRU0EubGVuZ3RoICYmIG5ldyBSZWdFeHAoIHJidWdneVFTQS5qb2luKFwifFwiKSApO1xuXHRyYnVnZ3lNYXRjaGVzID0gcmJ1Z2d5TWF0Y2hlcy5sZW5ndGggJiYgbmV3IFJlZ0V4cCggcmJ1Z2d5TWF0Y2hlcy5qb2luKFwifFwiKSApO1xuXG5cdC8qIENvbnRhaW5zXG5cdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblx0aGFzQ29tcGFyZSA9IHJuYXRpdmUudGVzdCggZG9jRWxlbS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiApO1xuXG5cdC8vIEVsZW1lbnQgY29udGFpbnMgYW5vdGhlclxuXHQvLyBQdXJwb3NlZnVsbHkgZG9lcyBub3QgaW1wbGVtZW50IGluY2x1c2l2ZSBkZXNjZW5kZW50XG5cdC8vIEFzIGluLCBhbiBlbGVtZW50IGRvZXMgbm90IGNvbnRhaW4gaXRzZWxmXG5cdGNvbnRhaW5zID0gaGFzQ29tcGFyZSB8fCBybmF0aXZlLnRlc3QoIGRvY0VsZW0uY29udGFpbnMgKSA/XG5cdFx0ZnVuY3Rpb24oIGEsIGIgKSB7XG5cdFx0XHR2YXIgYWRvd24gPSBhLm5vZGVUeXBlID09PSA5ID8gYS5kb2N1bWVudEVsZW1lbnQgOiBhLFxuXHRcdFx0XHRidXAgPSBiICYmIGIucGFyZW50Tm9kZTtcblx0XHRcdHJldHVybiBhID09PSBidXAgfHwgISEoIGJ1cCAmJiBidXAubm9kZVR5cGUgPT09IDEgJiYgKFxuXHRcdFx0XHRhZG93bi5jb250YWlucyA/XG5cdFx0XHRcdFx0YWRvd24uY29udGFpbnMoIGJ1cCApIDpcblx0XHRcdFx0XHRhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uICYmIGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24oIGJ1cCApICYgMTZcblx0XHRcdCkpO1xuXHRcdH0gOlxuXHRcdGZ1bmN0aW9uKCBhLCBiICkge1xuXHRcdFx0aWYgKCBiICkge1xuXHRcdFx0XHR3aGlsZSAoIChiID0gYi5wYXJlbnROb2RlKSApIHtcblx0XHRcdFx0XHRpZiAoIGIgPT09IGEgKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9O1xuXG5cdC8qIFNvcnRpbmdcblx0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5cdC8vIERvY3VtZW50IG9yZGVyIHNvcnRpbmdcblx0c29ydE9yZGVyID0gaGFzQ29tcGFyZSA/XG5cdGZ1bmN0aW9uKCBhLCBiICkge1xuXG5cdFx0Ly8gRmxhZyBmb3IgZHVwbGljYXRlIHJlbW92YWxcblx0XHRpZiAoIGEgPT09IGIgKSB7XG5cdFx0XHRoYXNEdXBsaWNhdGUgPSB0cnVlO1xuXHRcdFx0cmV0dXJuIDA7XG5cdFx0fVxuXG5cdFx0Ly8gU29ydCBvbiBtZXRob2QgZXhpc3RlbmNlIGlmIG9ubHkgb25lIGlucHV0IGhhcyBjb21wYXJlRG9jdW1lbnRQb3NpdGlvblxuXHRcdHZhciBjb21wYXJlID0gIWEuY29tcGFyZURvY3VtZW50UG9zaXRpb24gLSAhYi5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbjtcblx0XHRpZiAoIGNvbXBhcmUgKSB7XG5cdFx0XHRyZXR1cm4gY29tcGFyZTtcblx0XHR9XG5cblx0XHQvLyBDYWxjdWxhdGUgcG9zaXRpb24gaWYgYm90aCBpbnB1dHMgYmVsb25nIHRvIHRoZSBzYW1lIGRvY3VtZW50XG5cdFx0Y29tcGFyZSA9ICggYS5vd25lckRvY3VtZW50IHx8IGEgKSA9PT0gKCBiLm93bmVyRG9jdW1lbnQgfHwgYiApID9cblx0XHRcdGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24oIGIgKSA6XG5cblx0XHRcdC8vIE90aGVyd2lzZSB3ZSBrbm93IHRoZXkgYXJlIGRpc2Nvbm5lY3RlZFxuXHRcdFx0MTtcblxuXHRcdC8vIERpc2Nvbm5lY3RlZCBub2Rlc1xuXHRcdGlmICggY29tcGFyZSAmIDEgfHxcblx0XHRcdCghc3VwcG9ydC5zb3J0RGV0YWNoZWQgJiYgYi5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiggYSApID09PSBjb21wYXJlKSApIHtcblxuXHRcdFx0Ly8gQ2hvb3NlIHRoZSBmaXJzdCBlbGVtZW50IHRoYXQgaXMgcmVsYXRlZCB0byBvdXIgcHJlZmVycmVkIGRvY3VtZW50XG5cdFx0XHRpZiAoIGEgPT09IGRvYyB8fCBhLm93bmVyRG9jdW1lbnQgPT09IHByZWZlcnJlZERvYyAmJiBjb250YWlucyhwcmVmZXJyZWREb2MsIGEpICkge1xuXHRcdFx0XHRyZXR1cm4gLTE7XG5cdFx0XHR9XG5cdFx0XHRpZiAoIGIgPT09IGRvYyB8fCBiLm93bmVyRG9jdW1lbnQgPT09IHByZWZlcnJlZERvYyAmJiBjb250YWlucyhwcmVmZXJyZWREb2MsIGIpICkge1xuXHRcdFx0XHRyZXR1cm4gMTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gTWFpbnRhaW4gb3JpZ2luYWwgb3JkZXJcblx0XHRcdHJldHVybiBzb3J0SW5wdXQgP1xuXHRcdFx0XHQoIGluZGV4T2YuY2FsbCggc29ydElucHV0LCBhICkgLSBpbmRleE9mLmNhbGwoIHNvcnRJbnB1dCwgYiApICkgOlxuXHRcdFx0XHQwO1xuXHRcdH1cblxuXHRcdHJldHVybiBjb21wYXJlICYgNCA/IC0xIDogMTtcblx0fSA6XG5cdGZ1bmN0aW9uKCBhLCBiICkge1xuXHRcdC8vIEV4aXQgZWFybHkgaWYgdGhlIG5vZGVzIGFyZSBpZGVudGljYWxcblx0XHRpZiAoIGEgPT09IGIgKSB7XG5cdFx0XHRoYXNEdXBsaWNhdGUgPSB0cnVlO1xuXHRcdFx0cmV0dXJuIDA7XG5cdFx0fVxuXG5cdFx0dmFyIGN1cixcblx0XHRcdGkgPSAwLFxuXHRcdFx0YXVwID0gYS5wYXJlbnROb2RlLFxuXHRcdFx0YnVwID0gYi5wYXJlbnROb2RlLFxuXHRcdFx0YXAgPSBbIGEgXSxcblx0XHRcdGJwID0gWyBiIF07XG5cblx0XHQvLyBQYXJlbnRsZXNzIG5vZGVzIGFyZSBlaXRoZXIgZG9jdW1lbnRzIG9yIGRpc2Nvbm5lY3RlZFxuXHRcdGlmICggIWF1cCB8fCAhYnVwICkge1xuXHRcdFx0cmV0dXJuIGEgPT09IGRvYyA/IC0xIDpcblx0XHRcdFx0YiA9PT0gZG9jID8gMSA6XG5cdFx0XHRcdGF1cCA/IC0xIDpcblx0XHRcdFx0YnVwID8gMSA6XG5cdFx0XHRcdHNvcnRJbnB1dCA/XG5cdFx0XHRcdCggaW5kZXhPZi5jYWxsKCBzb3J0SW5wdXQsIGEgKSAtIGluZGV4T2YuY2FsbCggc29ydElucHV0LCBiICkgKSA6XG5cdFx0XHRcdDA7XG5cblx0XHQvLyBJZiB0aGUgbm9kZXMgYXJlIHNpYmxpbmdzLCB3ZSBjYW4gZG8gYSBxdWljayBjaGVja1xuXHRcdH0gZWxzZSBpZiAoIGF1cCA9PT0gYnVwICkge1xuXHRcdFx0cmV0dXJuIHNpYmxpbmdDaGVjayggYSwgYiApO1xuXHRcdH1cblxuXHRcdC8vIE90aGVyd2lzZSB3ZSBuZWVkIGZ1bGwgbGlzdHMgb2YgdGhlaXIgYW5jZXN0b3JzIGZvciBjb21wYXJpc29uXG5cdFx0Y3VyID0gYTtcblx0XHR3aGlsZSAoIChjdXIgPSBjdXIucGFyZW50Tm9kZSkgKSB7XG5cdFx0XHRhcC51bnNoaWZ0KCBjdXIgKTtcblx0XHR9XG5cdFx0Y3VyID0gYjtcblx0XHR3aGlsZSAoIChjdXIgPSBjdXIucGFyZW50Tm9kZSkgKSB7XG5cdFx0XHRicC51bnNoaWZ0KCBjdXIgKTtcblx0XHR9XG5cblx0XHQvLyBXYWxrIGRvd24gdGhlIHRyZWUgbG9va2luZyBmb3IgYSBkaXNjcmVwYW5jeVxuXHRcdHdoaWxlICggYXBbaV0gPT09IGJwW2ldICkge1xuXHRcdFx0aSsrO1xuXHRcdH1cblxuXHRcdHJldHVybiBpID9cblx0XHRcdC8vIERvIGEgc2libGluZyBjaGVjayBpZiB0aGUgbm9kZXMgaGF2ZSBhIGNvbW1vbiBhbmNlc3RvclxuXHRcdFx0c2libGluZ0NoZWNrKCBhcFtpXSwgYnBbaV0gKSA6XG5cblx0XHRcdC8vIE90aGVyd2lzZSBub2RlcyBpbiBvdXIgZG9jdW1lbnQgc29ydCBmaXJzdFxuXHRcdFx0YXBbaV0gPT09IHByZWZlcnJlZERvYyA/IC0xIDpcblx0XHRcdGJwW2ldID09PSBwcmVmZXJyZWREb2MgPyAxIDpcblx0XHRcdDA7XG5cdH07XG5cblx0cmV0dXJuIGRvYztcbn07XG5cblNpenpsZS5tYXRjaGVzID0gZnVuY3Rpb24oIGV4cHIsIGVsZW1lbnRzICkge1xuXHRyZXR1cm4gU2l6emxlKCBleHByLCBudWxsLCBudWxsLCBlbGVtZW50cyApO1xufTtcblxuU2l6emxlLm1hdGNoZXNTZWxlY3RvciA9IGZ1bmN0aW9uKCBlbGVtLCBleHByICkge1xuXHQvLyBTZXQgZG9jdW1lbnQgdmFycyBpZiBuZWVkZWRcblx0aWYgKCAoIGVsZW0ub3duZXJEb2N1bWVudCB8fCBlbGVtICkgIT09IGRvY3VtZW50ICkge1xuXHRcdHNldERvY3VtZW50KCBlbGVtICk7XG5cdH1cblxuXHQvLyBNYWtlIHN1cmUgdGhhdCBhdHRyaWJ1dGUgc2VsZWN0b3JzIGFyZSBxdW90ZWRcblx0ZXhwciA9IGV4cHIucmVwbGFjZSggcmF0dHJpYnV0ZVF1b3RlcywgXCI9JyQxJ11cIiApO1xuXG5cdGlmICggc3VwcG9ydC5tYXRjaGVzU2VsZWN0b3IgJiYgZG9jdW1lbnRJc0hUTUwgJiZcblx0XHQoICFyYnVnZ3lNYXRjaGVzIHx8ICFyYnVnZ3lNYXRjaGVzLnRlc3QoIGV4cHIgKSApICYmXG5cdFx0KCAhcmJ1Z2d5UVNBICAgICB8fCAhcmJ1Z2d5UVNBLnRlc3QoIGV4cHIgKSApICkge1xuXG5cdFx0dHJ5IHtcblx0XHRcdHZhciByZXQgPSBtYXRjaGVzLmNhbGwoIGVsZW0sIGV4cHIgKTtcblxuXHRcdFx0Ly8gSUUgOSdzIG1hdGNoZXNTZWxlY3RvciByZXR1cm5zIGZhbHNlIG9uIGRpc2Nvbm5lY3RlZCBub2Rlc1xuXHRcdFx0aWYgKCByZXQgfHwgc3VwcG9ydC5kaXNjb25uZWN0ZWRNYXRjaCB8fFxuXHRcdFx0XHRcdC8vIEFzIHdlbGwsIGRpc2Nvbm5lY3RlZCBub2RlcyBhcmUgc2FpZCB0byBiZSBpbiBhIGRvY3VtZW50XG5cdFx0XHRcdFx0Ly8gZnJhZ21lbnQgaW4gSUUgOVxuXHRcdFx0XHRcdGVsZW0uZG9jdW1lbnQgJiYgZWxlbS5kb2N1bWVudC5ub2RlVHlwZSAhPT0gMTEgKSB7XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9XG5cdFx0fSBjYXRjaChlKSB7fVxuXHR9XG5cblx0cmV0dXJuIFNpenpsZSggZXhwciwgZG9jdW1lbnQsIG51bGwsIFsgZWxlbSBdICkubGVuZ3RoID4gMDtcbn07XG5cblNpenpsZS5jb250YWlucyA9IGZ1bmN0aW9uKCBjb250ZXh0LCBlbGVtICkge1xuXHQvLyBTZXQgZG9jdW1lbnQgdmFycyBpZiBuZWVkZWRcblx0aWYgKCAoIGNvbnRleHQub3duZXJEb2N1bWVudCB8fCBjb250ZXh0ICkgIT09IGRvY3VtZW50ICkge1xuXHRcdHNldERvY3VtZW50KCBjb250ZXh0ICk7XG5cdH1cblx0cmV0dXJuIGNvbnRhaW5zKCBjb250ZXh0LCBlbGVtICk7XG59O1xuXG5TaXp6bGUuYXR0ciA9IGZ1bmN0aW9uKCBlbGVtLCBuYW1lICkge1xuXHQvLyBTZXQgZG9jdW1lbnQgdmFycyBpZiBuZWVkZWRcblx0aWYgKCAoIGVsZW0ub3duZXJEb2N1bWVudCB8fCBlbGVtICkgIT09IGRvY3VtZW50ICkge1xuXHRcdHNldERvY3VtZW50KCBlbGVtICk7XG5cdH1cblxuXHR2YXIgZm4gPSBFeHByLmF0dHJIYW5kbGVbIG5hbWUudG9Mb3dlckNhc2UoKSBdLFxuXHRcdC8vIERvbid0IGdldCBmb29sZWQgYnkgT2JqZWN0LnByb3RvdHlwZSBwcm9wZXJ0aWVzIChqUXVlcnkgIzEzODA3KVxuXHRcdHZhbCA9IGZuICYmIGhhc093bi5jYWxsKCBFeHByLmF0dHJIYW5kbGUsIG5hbWUudG9Mb3dlckNhc2UoKSApID9cblx0XHRcdGZuKCBlbGVtLCBuYW1lLCAhZG9jdW1lbnRJc0hUTUwgKSA6XG5cdFx0XHR1bmRlZmluZWQ7XG5cblx0cmV0dXJuIHZhbCAhPT0gdW5kZWZpbmVkID9cblx0XHR2YWwgOlxuXHRcdHN1cHBvcnQuYXR0cmlidXRlcyB8fCAhZG9jdW1lbnRJc0hUTUwgP1xuXHRcdFx0ZWxlbS5nZXRBdHRyaWJ1dGUoIG5hbWUgKSA6XG5cdFx0XHQodmFsID0gZWxlbS5nZXRBdHRyaWJ1dGVOb2RlKG5hbWUpKSAmJiB2YWwuc3BlY2lmaWVkID9cblx0XHRcdFx0dmFsLnZhbHVlIDpcblx0XHRcdFx0bnVsbDtcbn07XG5cblNpenpsZS5lcnJvciA9IGZ1bmN0aW9uKCBtc2cgKSB7XG5cdHRocm93IG5ldyBFcnJvciggXCJTeW50YXggZXJyb3IsIHVucmVjb2duaXplZCBleHByZXNzaW9uOiBcIiArIG1zZyApO1xufTtcblxuLyoqXG4gKiBEb2N1bWVudCBzb3J0aW5nIGFuZCByZW1vdmluZyBkdXBsaWNhdGVzXG4gKiBAcGFyYW0ge0FycmF5TGlrZX0gcmVzdWx0c1xuICovXG5TaXp6bGUudW5pcXVlU29ydCA9IGZ1bmN0aW9uKCByZXN1bHRzICkge1xuXHR2YXIgZWxlbSxcblx0XHRkdXBsaWNhdGVzID0gW10sXG5cdFx0aiA9IDAsXG5cdFx0aSA9IDA7XG5cblx0Ly8gVW5sZXNzIHdlICprbm93KiB3ZSBjYW4gZGV0ZWN0IGR1cGxpY2F0ZXMsIGFzc3VtZSB0aGVpciBwcmVzZW5jZVxuXHRoYXNEdXBsaWNhdGUgPSAhc3VwcG9ydC5kZXRlY3REdXBsaWNhdGVzO1xuXHRzb3J0SW5wdXQgPSAhc3VwcG9ydC5zb3J0U3RhYmxlICYmIHJlc3VsdHMuc2xpY2UoIDAgKTtcblx0cmVzdWx0cy5zb3J0KCBzb3J0T3JkZXIgKTtcblxuXHRpZiAoIGhhc0R1cGxpY2F0ZSApIHtcblx0XHR3aGlsZSAoIChlbGVtID0gcmVzdWx0c1tpKytdKSApIHtcblx0XHRcdGlmICggZWxlbSA9PT0gcmVzdWx0c1sgaSBdICkge1xuXHRcdFx0XHRqID0gZHVwbGljYXRlcy5wdXNoKCBpICk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHdoaWxlICggai0tICkge1xuXHRcdFx0cmVzdWx0cy5zcGxpY2UoIGR1cGxpY2F0ZXNbIGogXSwgMSApO1xuXHRcdH1cblx0fVxuXG5cdC8vIENsZWFyIGlucHV0IGFmdGVyIHNvcnRpbmcgdG8gcmVsZWFzZSBvYmplY3RzXG5cdC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vanF1ZXJ5L3NpenpsZS9wdWxsLzIyNVxuXHRzb3J0SW5wdXQgPSBudWxsO1xuXG5cdHJldHVybiByZXN1bHRzO1xufTtcblxuLyoqXG4gKiBVdGlsaXR5IGZ1bmN0aW9uIGZvciByZXRyaWV2aW5nIHRoZSB0ZXh0IHZhbHVlIG9mIGFuIGFycmF5IG9mIERPTSBub2Rlc1xuICogQHBhcmFtIHtBcnJheXxFbGVtZW50fSBlbGVtXG4gKi9cbmdldFRleHQgPSBTaXp6bGUuZ2V0VGV4dCA9IGZ1bmN0aW9uKCBlbGVtICkge1xuXHR2YXIgbm9kZSxcblx0XHRyZXQgPSBcIlwiLFxuXHRcdGkgPSAwLFxuXHRcdG5vZGVUeXBlID0gZWxlbS5ub2RlVHlwZTtcblxuXHRpZiAoICFub2RlVHlwZSApIHtcblx0XHQvLyBJZiBubyBub2RlVHlwZSwgdGhpcyBpcyBleHBlY3RlZCB0byBiZSBhbiBhcnJheVxuXHRcdHdoaWxlICggKG5vZGUgPSBlbGVtW2krK10pICkge1xuXHRcdFx0Ly8gRG8gbm90IHRyYXZlcnNlIGNvbW1lbnQgbm9kZXNcblx0XHRcdHJldCArPSBnZXRUZXh0KCBub2RlICk7XG5cdFx0fVxuXHR9IGVsc2UgaWYgKCBub2RlVHlwZSA9PT0gMSB8fCBub2RlVHlwZSA9PT0gOSB8fCBub2RlVHlwZSA9PT0gMTEgKSB7XG5cdFx0Ly8gVXNlIHRleHRDb250ZW50IGZvciBlbGVtZW50c1xuXHRcdC8vIGlubmVyVGV4dCB1c2FnZSByZW1vdmVkIGZvciBjb25zaXN0ZW5jeSBvZiBuZXcgbGluZXMgKGpRdWVyeSAjMTExNTMpXG5cdFx0aWYgKCB0eXBlb2YgZWxlbS50ZXh0Q29udGVudCA9PT0gXCJzdHJpbmdcIiApIHtcblx0XHRcdHJldHVybiBlbGVtLnRleHRDb250ZW50O1xuXHRcdH0gZWxzZSB7XG5cdFx0XHQvLyBUcmF2ZXJzZSBpdHMgY2hpbGRyZW5cblx0XHRcdGZvciAoIGVsZW0gPSBlbGVtLmZpcnN0Q2hpbGQ7IGVsZW07IGVsZW0gPSBlbGVtLm5leHRTaWJsaW5nICkge1xuXHRcdFx0XHRyZXQgKz0gZ2V0VGV4dCggZWxlbSApO1xuXHRcdFx0fVxuXHRcdH1cblx0fSBlbHNlIGlmICggbm9kZVR5cGUgPT09IDMgfHwgbm9kZVR5cGUgPT09IDQgKSB7XG5cdFx0cmV0dXJuIGVsZW0ubm9kZVZhbHVlO1xuXHR9XG5cdC8vIERvIG5vdCBpbmNsdWRlIGNvbW1lbnQgb3IgcHJvY2Vzc2luZyBpbnN0cnVjdGlvbiBub2Rlc1xuXG5cdHJldHVybiByZXQ7XG59O1xuXG5FeHByID0gU2l6emxlLnNlbGVjdG9ycyA9IHtcblxuXHQvLyBDYW4gYmUgYWRqdXN0ZWQgYnkgdGhlIHVzZXJcblx0Y2FjaGVMZW5ndGg6IDUwLFxuXG5cdGNyZWF0ZVBzZXVkbzogbWFya0Z1bmN0aW9uLFxuXG5cdG1hdGNoOiBtYXRjaEV4cHIsXG5cblx0YXR0ckhhbmRsZToge30sXG5cblx0ZmluZDoge30sXG5cblx0cmVsYXRpdmU6IHtcblx0XHRcIj5cIjogeyBkaXI6IFwicGFyZW50Tm9kZVwiLCBmaXJzdDogdHJ1ZSB9LFxuXHRcdFwiIFwiOiB7IGRpcjogXCJwYXJlbnROb2RlXCIgfSxcblx0XHRcIitcIjogeyBkaXI6IFwicHJldmlvdXNTaWJsaW5nXCIsIGZpcnN0OiB0cnVlIH0sXG5cdFx0XCJ+XCI6IHsgZGlyOiBcInByZXZpb3VzU2libGluZ1wiIH1cblx0fSxcblxuXHRwcmVGaWx0ZXI6IHtcblx0XHRcIkFUVFJcIjogZnVuY3Rpb24oIG1hdGNoICkge1xuXHRcdFx0bWF0Y2hbMV0gPSBtYXRjaFsxXS5yZXBsYWNlKCBydW5lc2NhcGUsIGZ1bmVzY2FwZSApO1xuXG5cdFx0XHQvLyBNb3ZlIHRoZSBnaXZlbiB2YWx1ZSB0byBtYXRjaFszXSB3aGV0aGVyIHF1b3RlZCBvciB1bnF1b3RlZFxuXHRcdFx0bWF0Y2hbM10gPSAoIG1hdGNoWzNdIHx8IG1hdGNoWzRdIHx8IG1hdGNoWzVdIHx8IFwiXCIgKS5yZXBsYWNlKCBydW5lc2NhcGUsIGZ1bmVzY2FwZSApO1xuXG5cdFx0XHRpZiAoIG1hdGNoWzJdID09PSBcIn49XCIgKSB7XG5cdFx0XHRcdG1hdGNoWzNdID0gXCIgXCIgKyBtYXRjaFszXSArIFwiIFwiO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbWF0Y2guc2xpY2UoIDAsIDQgKTtcblx0XHR9LFxuXG5cdFx0XCJDSElMRFwiOiBmdW5jdGlvbiggbWF0Y2ggKSB7XG5cdFx0XHQvKiBtYXRjaGVzIGZyb20gbWF0Y2hFeHByW1wiQ0hJTERcIl1cblx0XHRcdFx0MSB0eXBlIChvbmx5fG50aHwuLi4pXG5cdFx0XHRcdDIgd2hhdCAoY2hpbGR8b2YtdHlwZSlcblx0XHRcdFx0MyBhcmd1bWVudCAoZXZlbnxvZGR8XFxkKnxcXGQqbihbKy1dXFxkKyk/fC4uLilcblx0XHRcdFx0NCB4bi1jb21wb25lbnQgb2YgeG4reSBhcmd1bWVudCAoWystXT9cXGQqbnwpXG5cdFx0XHRcdDUgc2lnbiBvZiB4bi1jb21wb25lbnRcblx0XHRcdFx0NiB4IG9mIHhuLWNvbXBvbmVudFxuXHRcdFx0XHQ3IHNpZ24gb2YgeS1jb21wb25lbnRcblx0XHRcdFx0OCB5IG9mIHktY29tcG9uZW50XG5cdFx0XHQqL1xuXHRcdFx0bWF0Y2hbMV0gPSBtYXRjaFsxXS50b0xvd2VyQ2FzZSgpO1xuXG5cdFx0XHRpZiAoIG1hdGNoWzFdLnNsaWNlKCAwLCAzICkgPT09IFwibnRoXCIgKSB7XG5cdFx0XHRcdC8vIG50aC0qIHJlcXVpcmVzIGFyZ3VtZW50XG5cdFx0XHRcdGlmICggIW1hdGNoWzNdICkge1xuXHRcdFx0XHRcdFNpenpsZS5lcnJvciggbWF0Y2hbMF0gKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIG51bWVyaWMgeCBhbmQgeSBwYXJhbWV0ZXJzIGZvciBFeHByLmZpbHRlci5DSElMRFxuXHRcdFx0XHQvLyByZW1lbWJlciB0aGF0IGZhbHNlL3RydWUgY2FzdCByZXNwZWN0aXZlbHkgdG8gMC8xXG5cdFx0XHRcdG1hdGNoWzRdID0gKyggbWF0Y2hbNF0gPyBtYXRjaFs1XSArIChtYXRjaFs2XSB8fCAxKSA6IDIgKiAoIG1hdGNoWzNdID09PSBcImV2ZW5cIiB8fCBtYXRjaFszXSA9PT0gXCJvZGRcIiApICk7XG5cdFx0XHRcdG1hdGNoWzVdID0gKyggKCBtYXRjaFs3XSArIG1hdGNoWzhdICkgfHwgbWF0Y2hbM10gPT09IFwib2RkXCIgKTtcblxuXHRcdFx0Ly8gb3RoZXIgdHlwZXMgcHJvaGliaXQgYXJndW1lbnRzXG5cdFx0XHR9IGVsc2UgaWYgKCBtYXRjaFszXSApIHtcblx0XHRcdFx0U2l6emxlLmVycm9yKCBtYXRjaFswXSApO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbWF0Y2g7XG5cdFx0fSxcblxuXHRcdFwiUFNFVURPXCI6IGZ1bmN0aW9uKCBtYXRjaCApIHtcblx0XHRcdHZhciBleGNlc3MsXG5cdFx0XHRcdHVucXVvdGVkID0gIW1hdGNoWzZdICYmIG1hdGNoWzJdO1xuXG5cdFx0XHRpZiAoIG1hdGNoRXhwcltcIkNISUxEXCJdLnRlc3QoIG1hdGNoWzBdICkgKSB7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBBY2NlcHQgcXVvdGVkIGFyZ3VtZW50cyBhcy1pc1xuXHRcdFx0aWYgKCBtYXRjaFszXSApIHtcblx0XHRcdFx0bWF0Y2hbMl0gPSBtYXRjaFs0XSB8fCBtYXRjaFs1XSB8fCBcIlwiO1xuXG5cdFx0XHQvLyBTdHJpcCBleGNlc3MgY2hhcmFjdGVycyBmcm9tIHVucXVvdGVkIGFyZ3VtZW50c1xuXHRcdFx0fSBlbHNlIGlmICggdW5xdW90ZWQgJiYgcnBzZXVkby50ZXN0KCB1bnF1b3RlZCApICYmXG5cdFx0XHRcdC8vIEdldCBleGNlc3MgZnJvbSB0b2tlbml6ZSAocmVjdXJzaXZlbHkpXG5cdFx0XHRcdChleGNlc3MgPSB0b2tlbml6ZSggdW5xdW90ZWQsIHRydWUgKSkgJiZcblx0XHRcdFx0Ly8gYWR2YW5jZSB0byB0aGUgbmV4dCBjbG9zaW5nIHBhcmVudGhlc2lzXG5cdFx0XHRcdChleGNlc3MgPSB1bnF1b3RlZC5pbmRleE9mKCBcIilcIiwgdW5xdW90ZWQubGVuZ3RoIC0gZXhjZXNzICkgLSB1bnF1b3RlZC5sZW5ndGgpICkge1xuXG5cdFx0XHRcdC8vIGV4Y2VzcyBpcyBhIG5lZ2F0aXZlIGluZGV4XG5cdFx0XHRcdG1hdGNoWzBdID0gbWF0Y2hbMF0uc2xpY2UoIDAsIGV4Y2VzcyApO1xuXHRcdFx0XHRtYXRjaFsyXSA9IHVucXVvdGVkLnNsaWNlKCAwLCBleGNlc3MgKTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gUmV0dXJuIG9ubHkgY2FwdHVyZXMgbmVlZGVkIGJ5IHRoZSBwc2V1ZG8gZmlsdGVyIG1ldGhvZCAodHlwZSBhbmQgYXJndW1lbnQpXG5cdFx0XHRyZXR1cm4gbWF0Y2guc2xpY2UoIDAsIDMgKTtcblx0XHR9XG5cdH0sXG5cblx0ZmlsdGVyOiB7XG5cblx0XHRcIlRBR1wiOiBmdW5jdGlvbiggbm9kZU5hbWVTZWxlY3RvciApIHtcblx0XHRcdHZhciBub2RlTmFtZSA9IG5vZGVOYW1lU2VsZWN0b3IucmVwbGFjZSggcnVuZXNjYXBlLCBmdW5lc2NhcGUgKS50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0cmV0dXJuIG5vZGVOYW1lU2VsZWN0b3IgPT09IFwiKlwiID9cblx0XHRcdFx0ZnVuY3Rpb24oKSB7IHJldHVybiB0cnVlOyB9IDpcblx0XHRcdFx0ZnVuY3Rpb24oIGVsZW0gKSB7XG5cdFx0XHRcdFx0cmV0dXJuIGVsZW0ubm9kZU5hbWUgJiYgZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSBub2RlTmFtZTtcblx0XHRcdFx0fTtcblx0XHR9LFxuXG5cdFx0XCJDTEFTU1wiOiBmdW5jdGlvbiggY2xhc3NOYW1lICkge1xuXHRcdFx0dmFyIHBhdHRlcm4gPSBjbGFzc0NhY2hlWyBjbGFzc05hbWUgKyBcIiBcIiBdO1xuXG5cdFx0XHRyZXR1cm4gcGF0dGVybiB8fFxuXHRcdFx0XHQocGF0dGVybiA9IG5ldyBSZWdFeHAoIFwiKF58XCIgKyB3aGl0ZXNwYWNlICsgXCIpXCIgKyBjbGFzc05hbWUgKyBcIihcIiArIHdoaXRlc3BhY2UgKyBcInwkKVwiICkpICYmXG5cdFx0XHRcdGNsYXNzQ2FjaGUoIGNsYXNzTmFtZSwgZnVuY3Rpb24oIGVsZW0gKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHBhdHRlcm4udGVzdCggdHlwZW9mIGVsZW0uY2xhc3NOYW1lID09PSBcInN0cmluZ1wiICYmIGVsZW0uY2xhc3NOYW1lIHx8IHR5cGVvZiBlbGVtLmdldEF0dHJpYnV0ZSAhPT0gc3RydW5kZWZpbmVkICYmIGVsZW0uZ2V0QXR0cmlidXRlKFwiY2xhc3NcIikgfHwgXCJcIiApO1xuXHRcdFx0XHR9KTtcblx0XHR9LFxuXG5cdFx0XCJBVFRSXCI6IGZ1bmN0aW9uKCBuYW1lLCBvcGVyYXRvciwgY2hlY2sgKSB7XG5cdFx0XHRyZXR1cm4gZnVuY3Rpb24oIGVsZW0gKSB7XG5cdFx0XHRcdHZhciByZXN1bHQgPSBTaXp6bGUuYXR0ciggZWxlbSwgbmFtZSApO1xuXG5cdFx0XHRcdGlmICggcmVzdWx0ID09IG51bGwgKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG9wZXJhdG9yID09PSBcIiE9XCI7XG5cdFx0XHRcdH1cblx0XHRcdFx0aWYgKCAhb3BlcmF0b3IgKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXN1bHQgKz0gXCJcIjtcblxuXHRcdFx0XHRyZXR1cm4gb3BlcmF0b3IgPT09IFwiPVwiID8gcmVzdWx0ID09PSBjaGVjayA6XG5cdFx0XHRcdFx0b3BlcmF0b3IgPT09IFwiIT1cIiA/IHJlc3VsdCAhPT0gY2hlY2sgOlxuXHRcdFx0XHRcdG9wZXJhdG9yID09PSBcIl49XCIgPyBjaGVjayAmJiByZXN1bHQuaW5kZXhPZiggY2hlY2sgKSA9PT0gMCA6XG5cdFx0XHRcdFx0b3BlcmF0b3IgPT09IFwiKj1cIiA/IGNoZWNrICYmIHJlc3VsdC5pbmRleE9mKCBjaGVjayApID4gLTEgOlxuXHRcdFx0XHRcdG9wZXJhdG9yID09PSBcIiQ9XCIgPyBjaGVjayAmJiByZXN1bHQuc2xpY2UoIC1jaGVjay5sZW5ndGggKSA9PT0gY2hlY2sgOlxuXHRcdFx0XHRcdG9wZXJhdG9yID09PSBcIn49XCIgPyAoIFwiIFwiICsgcmVzdWx0ICsgXCIgXCIgKS5pbmRleE9mKCBjaGVjayApID4gLTEgOlxuXHRcdFx0XHRcdG9wZXJhdG9yID09PSBcInw9XCIgPyByZXN1bHQgPT09IGNoZWNrIHx8IHJlc3VsdC5zbGljZSggMCwgY2hlY2subGVuZ3RoICsgMSApID09PSBjaGVjayArIFwiLVwiIDpcblx0XHRcdFx0XHRmYWxzZTtcblx0XHRcdH07XG5cdFx0fSxcblxuXHRcdFwiQ0hJTERcIjogZnVuY3Rpb24oIHR5cGUsIHdoYXQsIGFyZ3VtZW50LCBmaXJzdCwgbGFzdCApIHtcblx0XHRcdHZhciBzaW1wbGUgPSB0eXBlLnNsaWNlKCAwLCAzICkgIT09IFwibnRoXCIsXG5cdFx0XHRcdGZvcndhcmQgPSB0eXBlLnNsaWNlKCAtNCApICE9PSBcImxhc3RcIixcblx0XHRcdFx0b2ZUeXBlID0gd2hhdCA9PT0gXCJvZi10eXBlXCI7XG5cblx0XHRcdHJldHVybiBmaXJzdCA9PT0gMSAmJiBsYXN0ID09PSAwID9cblxuXHRcdFx0XHQvLyBTaG9ydGN1dCBmb3IgOm50aC0qKG4pXG5cdFx0XHRcdGZ1bmN0aW9uKCBlbGVtICkge1xuXHRcdFx0XHRcdHJldHVybiAhIWVsZW0ucGFyZW50Tm9kZTtcblx0XHRcdFx0fSA6XG5cblx0XHRcdFx0ZnVuY3Rpb24oIGVsZW0sIGNvbnRleHQsIHhtbCApIHtcblx0XHRcdFx0XHR2YXIgY2FjaGUsIG91dGVyQ2FjaGUsIG5vZGUsIGRpZmYsIG5vZGVJbmRleCwgc3RhcnQsXG5cdFx0XHRcdFx0XHRkaXIgPSBzaW1wbGUgIT09IGZvcndhcmQgPyBcIm5leHRTaWJsaW5nXCIgOiBcInByZXZpb3VzU2libGluZ1wiLFxuXHRcdFx0XHRcdFx0cGFyZW50ID0gZWxlbS5wYXJlbnROb2RlLFxuXHRcdFx0XHRcdFx0bmFtZSA9IG9mVHlwZSAmJiBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCksXG5cdFx0XHRcdFx0XHR1c2VDYWNoZSA9ICF4bWwgJiYgIW9mVHlwZTtcblxuXHRcdFx0XHRcdGlmICggcGFyZW50ICkge1xuXG5cdFx0XHRcdFx0XHQvLyA6KGZpcnN0fGxhc3R8b25seSktKGNoaWxkfG9mLXR5cGUpXG5cdFx0XHRcdFx0XHRpZiAoIHNpbXBsZSApIHtcblx0XHRcdFx0XHRcdFx0d2hpbGUgKCBkaXIgKSB7XG5cdFx0XHRcdFx0XHRcdFx0bm9kZSA9IGVsZW07XG5cdFx0XHRcdFx0XHRcdFx0d2hpbGUgKCAobm9kZSA9IG5vZGVbIGRpciBdKSApIHtcblx0XHRcdFx0XHRcdFx0XHRcdGlmICggb2ZUeXBlID8gbm9kZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSBuYW1lIDogbm9kZS5ub2RlVHlwZSA9PT0gMSApIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHQvLyBSZXZlcnNlIGRpcmVjdGlvbiBmb3IgOm9ubHktKiAoaWYgd2UgaGF2ZW4ndCB5ZXQgZG9uZSBzbylcblx0XHRcdFx0XHRcdFx0XHRzdGFydCA9IGRpciA9IHR5cGUgPT09IFwib25seVwiICYmICFzdGFydCAmJiBcIm5leHRTaWJsaW5nXCI7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHN0YXJ0ID0gWyBmb3J3YXJkID8gcGFyZW50LmZpcnN0Q2hpbGQgOiBwYXJlbnQubGFzdENoaWxkIF07XG5cblx0XHRcdFx0XHRcdC8vIG5vbi14bWwgOm50aC1jaGlsZCguLi4pIHN0b3JlcyBjYWNoZSBkYXRhIG9uIGBwYXJlbnRgXG5cdFx0XHRcdFx0XHRpZiAoIGZvcndhcmQgJiYgdXNlQ2FjaGUgKSB7XG5cdFx0XHRcdFx0XHRcdC8vIFNlZWsgYGVsZW1gIGZyb20gYSBwcmV2aW91c2x5LWNhY2hlZCBpbmRleFxuXHRcdFx0XHRcdFx0XHRvdXRlckNhY2hlID0gcGFyZW50WyBleHBhbmRvIF0gfHwgKHBhcmVudFsgZXhwYW5kbyBdID0ge30pO1xuXHRcdFx0XHRcdFx0XHRjYWNoZSA9IG91dGVyQ2FjaGVbIHR5cGUgXSB8fCBbXTtcblx0XHRcdFx0XHRcdFx0bm9kZUluZGV4ID0gY2FjaGVbMF0gPT09IGRpcnJ1bnMgJiYgY2FjaGVbMV07XG5cdFx0XHRcdFx0XHRcdGRpZmYgPSBjYWNoZVswXSA9PT0gZGlycnVucyAmJiBjYWNoZVsyXTtcblx0XHRcdFx0XHRcdFx0bm9kZSA9IG5vZGVJbmRleCAmJiBwYXJlbnQuY2hpbGROb2Rlc1sgbm9kZUluZGV4IF07XG5cblx0XHRcdFx0XHRcdFx0d2hpbGUgKCAobm9kZSA9ICsrbm9kZUluZGV4ICYmIG5vZGUgJiYgbm9kZVsgZGlyIF0gfHxcblxuXHRcdFx0XHRcdFx0XHRcdC8vIEZhbGxiYWNrIHRvIHNlZWtpbmcgYGVsZW1gIGZyb20gdGhlIHN0YXJ0XG5cdFx0XHRcdFx0XHRcdFx0KGRpZmYgPSBub2RlSW5kZXggPSAwKSB8fCBzdGFydC5wb3AoKSkgKSB7XG5cblx0XHRcdFx0XHRcdFx0XHQvLyBXaGVuIGZvdW5kLCBjYWNoZSBpbmRleGVzIG9uIGBwYXJlbnRgIGFuZCBicmVha1xuXHRcdFx0XHRcdFx0XHRcdGlmICggbm9kZS5ub2RlVHlwZSA9PT0gMSAmJiArK2RpZmYgJiYgbm9kZSA9PT0gZWxlbSApIHtcblx0XHRcdFx0XHRcdFx0XHRcdG91dGVyQ2FjaGVbIHR5cGUgXSA9IFsgZGlycnVucywgbm9kZUluZGV4LCBkaWZmIF07XG5cdFx0XHRcdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0Ly8gVXNlIHByZXZpb3VzbHktY2FjaGVkIGVsZW1lbnQgaW5kZXggaWYgYXZhaWxhYmxlXG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKCB1c2VDYWNoZSAmJiAoY2FjaGUgPSAoZWxlbVsgZXhwYW5kbyBdIHx8IChlbGVtWyBleHBhbmRvIF0gPSB7fSkpWyB0eXBlIF0pICYmIGNhY2hlWzBdID09PSBkaXJydW5zICkge1xuXHRcdFx0XHRcdFx0XHRkaWZmID0gY2FjaGVbMV07XG5cblx0XHRcdFx0XHRcdC8vIHhtbCA6bnRoLWNoaWxkKC4uLikgb3IgOm50aC1sYXN0LWNoaWxkKC4uLikgb3IgOm50aCgtbGFzdCk/LW9mLXR5cGUoLi4uKVxuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0Ly8gVXNlIHRoZSBzYW1lIGxvb3AgYXMgYWJvdmUgdG8gc2VlayBgZWxlbWAgZnJvbSB0aGUgc3RhcnRcblx0XHRcdFx0XHRcdFx0d2hpbGUgKCAobm9kZSA9ICsrbm9kZUluZGV4ICYmIG5vZGUgJiYgbm9kZVsgZGlyIF0gfHxcblx0XHRcdFx0XHRcdFx0XHQoZGlmZiA9IG5vZGVJbmRleCA9IDApIHx8IHN0YXJ0LnBvcCgpKSApIHtcblxuXHRcdFx0XHRcdFx0XHRcdGlmICggKCBvZlR5cGUgPyBub2RlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IG5hbWUgOiBub2RlLm5vZGVUeXBlID09PSAxICkgJiYgKytkaWZmICkge1xuXHRcdFx0XHRcdFx0XHRcdFx0Ly8gQ2FjaGUgdGhlIGluZGV4IG9mIGVhY2ggZW5jb3VudGVyZWQgZWxlbWVudFxuXHRcdFx0XHRcdFx0XHRcdFx0aWYgKCB1c2VDYWNoZSApIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0KG5vZGVbIGV4cGFuZG8gXSB8fCAobm9kZVsgZXhwYW5kbyBdID0ge30pKVsgdHlwZSBdID0gWyBkaXJydW5zLCBkaWZmIF07XG5cdFx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRcdGlmICggbm9kZSA9PT0gZWxlbSApIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdC8vIEluY29ycG9yYXRlIHRoZSBvZmZzZXQsIHRoZW4gY2hlY2sgYWdhaW5zdCBjeWNsZSBzaXplXG5cdFx0XHRcdFx0XHRkaWZmIC09IGxhc3Q7XG5cdFx0XHRcdFx0XHRyZXR1cm4gZGlmZiA9PT0gZmlyc3QgfHwgKCBkaWZmICUgZmlyc3QgPT09IDAgJiYgZGlmZiAvIGZpcnN0ID49IDAgKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH07XG5cdFx0fSxcblxuXHRcdFwiUFNFVURPXCI6IGZ1bmN0aW9uKCBwc2V1ZG8sIGFyZ3VtZW50ICkge1xuXHRcdFx0Ly8gcHNldWRvLWNsYXNzIG5hbWVzIGFyZSBjYXNlLWluc2Vuc2l0aXZlXG5cdFx0XHQvLyBodHRwOi8vd3d3LnczLm9yZy9UUi9zZWxlY3RvcnMvI3BzZXVkby1jbGFzc2VzXG5cdFx0XHQvLyBQcmlvcml0aXplIGJ5IGNhc2Ugc2Vuc2l0aXZpdHkgaW4gY2FzZSBjdXN0b20gcHNldWRvcyBhcmUgYWRkZWQgd2l0aCB1cHBlcmNhc2UgbGV0dGVyc1xuXHRcdFx0Ly8gUmVtZW1iZXIgdGhhdCBzZXRGaWx0ZXJzIGluaGVyaXRzIGZyb20gcHNldWRvc1xuXHRcdFx0dmFyIGFyZ3MsXG5cdFx0XHRcdGZuID0gRXhwci5wc2V1ZG9zWyBwc2V1ZG8gXSB8fCBFeHByLnNldEZpbHRlcnNbIHBzZXVkby50b0xvd2VyQ2FzZSgpIF0gfHxcblx0XHRcdFx0XHRTaXp6bGUuZXJyb3IoIFwidW5zdXBwb3J0ZWQgcHNldWRvOiBcIiArIHBzZXVkbyApO1xuXG5cdFx0XHQvLyBUaGUgdXNlciBtYXkgdXNlIGNyZWF0ZVBzZXVkbyB0byBpbmRpY2F0ZSB0aGF0XG5cdFx0XHQvLyBhcmd1bWVudHMgYXJlIG5lZWRlZCB0byBjcmVhdGUgdGhlIGZpbHRlciBmdW5jdGlvblxuXHRcdFx0Ly8ganVzdCBhcyBTaXp6bGUgZG9lc1xuXHRcdFx0aWYgKCBmblsgZXhwYW5kbyBdICkge1xuXHRcdFx0XHRyZXR1cm4gZm4oIGFyZ3VtZW50ICk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIEJ1dCBtYWludGFpbiBzdXBwb3J0IGZvciBvbGQgc2lnbmF0dXJlc1xuXHRcdFx0aWYgKCBmbi5sZW5ndGggPiAxICkge1xuXHRcdFx0XHRhcmdzID0gWyBwc2V1ZG8sIHBzZXVkbywgXCJcIiwgYXJndW1lbnQgXTtcblx0XHRcdFx0cmV0dXJuIEV4cHIuc2V0RmlsdGVycy5oYXNPd25Qcm9wZXJ0eSggcHNldWRvLnRvTG93ZXJDYXNlKCkgKSA/XG5cdFx0XHRcdFx0bWFya0Z1bmN0aW9uKGZ1bmN0aW9uKCBzZWVkLCBtYXRjaGVzICkge1xuXHRcdFx0XHRcdFx0dmFyIGlkeCxcblx0XHRcdFx0XHRcdFx0bWF0Y2hlZCA9IGZuKCBzZWVkLCBhcmd1bWVudCApLFxuXHRcdFx0XHRcdFx0XHRpID0gbWF0Y2hlZC5sZW5ndGg7XG5cdFx0XHRcdFx0XHR3aGlsZSAoIGktLSApIHtcblx0XHRcdFx0XHRcdFx0aWR4ID0gaW5kZXhPZi5jYWxsKCBzZWVkLCBtYXRjaGVkW2ldICk7XG5cdFx0XHRcdFx0XHRcdHNlZWRbIGlkeCBdID0gISggbWF0Y2hlc1sgaWR4IF0gPSBtYXRjaGVkW2ldICk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSkgOlxuXHRcdFx0XHRcdGZ1bmN0aW9uKCBlbGVtICkge1xuXHRcdFx0XHRcdFx0cmV0dXJuIGZuKCBlbGVtLCAwLCBhcmdzICk7XG5cdFx0XHRcdFx0fTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIGZuO1xuXHRcdH1cblx0fSxcblxuXHRwc2V1ZG9zOiB7XG5cdFx0Ly8gUG90ZW50aWFsbHkgY29tcGxleCBwc2V1ZG9zXG5cdFx0XCJub3RcIjogbWFya0Z1bmN0aW9uKGZ1bmN0aW9uKCBzZWxlY3RvciApIHtcblx0XHRcdC8vIFRyaW0gdGhlIHNlbGVjdG9yIHBhc3NlZCB0byBjb21waWxlXG5cdFx0XHQvLyB0byBhdm9pZCB0cmVhdGluZyBsZWFkaW5nIGFuZCB0cmFpbGluZ1xuXHRcdFx0Ly8gc3BhY2VzIGFzIGNvbWJpbmF0b3JzXG5cdFx0XHR2YXIgaW5wdXQgPSBbXSxcblx0XHRcdFx0cmVzdWx0cyA9IFtdLFxuXHRcdFx0XHRtYXRjaGVyID0gY29tcGlsZSggc2VsZWN0b3IucmVwbGFjZSggcnRyaW0sIFwiJDFcIiApICk7XG5cblx0XHRcdHJldHVybiBtYXRjaGVyWyBleHBhbmRvIF0gP1xuXHRcdFx0XHRtYXJrRnVuY3Rpb24oZnVuY3Rpb24oIHNlZWQsIG1hdGNoZXMsIGNvbnRleHQsIHhtbCApIHtcblx0XHRcdFx0XHR2YXIgZWxlbSxcblx0XHRcdFx0XHRcdHVubWF0Y2hlZCA9IG1hdGNoZXIoIHNlZWQsIG51bGwsIHhtbCwgW10gKSxcblx0XHRcdFx0XHRcdGkgPSBzZWVkLmxlbmd0aDtcblxuXHRcdFx0XHRcdC8vIE1hdGNoIGVsZW1lbnRzIHVubWF0Y2hlZCBieSBgbWF0Y2hlcmBcblx0XHRcdFx0XHR3aGlsZSAoIGktLSApIHtcblx0XHRcdFx0XHRcdGlmICggKGVsZW0gPSB1bm1hdGNoZWRbaV0pICkge1xuXHRcdFx0XHRcdFx0XHRzZWVkW2ldID0gIShtYXRjaGVzW2ldID0gZWxlbSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KSA6XG5cdFx0XHRcdGZ1bmN0aW9uKCBlbGVtLCBjb250ZXh0LCB4bWwgKSB7XG5cdFx0XHRcdFx0aW5wdXRbMF0gPSBlbGVtO1xuXHRcdFx0XHRcdG1hdGNoZXIoIGlucHV0LCBudWxsLCB4bWwsIHJlc3VsdHMgKTtcblx0XHRcdFx0XHRyZXR1cm4gIXJlc3VsdHMucG9wKCk7XG5cdFx0XHRcdH07XG5cdFx0fSksXG5cblx0XHRcImhhc1wiOiBtYXJrRnVuY3Rpb24oZnVuY3Rpb24oIHNlbGVjdG9yICkge1xuXHRcdFx0cmV0dXJuIGZ1bmN0aW9uKCBlbGVtICkge1xuXHRcdFx0XHRyZXR1cm4gU2l6emxlKCBzZWxlY3RvciwgZWxlbSApLmxlbmd0aCA+IDA7XG5cdFx0XHR9O1xuXHRcdH0pLFxuXG5cdFx0XCJjb250YWluc1wiOiBtYXJrRnVuY3Rpb24oZnVuY3Rpb24oIHRleHQgKSB7XG5cdFx0XHR0ZXh0ID0gdGV4dC5yZXBsYWNlKCBydW5lc2NhcGUsIGZ1bmVzY2FwZSApO1xuXHRcdFx0cmV0dXJuIGZ1bmN0aW9uKCBlbGVtICkge1xuXHRcdFx0XHRyZXR1cm4gKCBlbGVtLnRleHRDb250ZW50IHx8IGVsZW0uaW5uZXJUZXh0IHx8IGdldFRleHQoIGVsZW0gKSApLmluZGV4T2YoIHRleHQgKSA+IC0xO1xuXHRcdFx0fTtcblx0XHR9KSxcblxuXHRcdC8vIFwiV2hldGhlciBhbiBlbGVtZW50IGlzIHJlcHJlc2VudGVkIGJ5IGEgOmxhbmcoKSBzZWxlY3RvclxuXHRcdC8vIGlzIGJhc2VkIHNvbGVseSBvbiB0aGUgZWxlbWVudCdzIGxhbmd1YWdlIHZhbHVlXG5cdFx0Ly8gYmVpbmcgZXF1YWwgdG8gdGhlIGlkZW50aWZpZXIgQyxcblx0XHQvLyBvciBiZWdpbm5pbmcgd2l0aCB0aGUgaWRlbnRpZmllciBDIGltbWVkaWF0ZWx5IGZvbGxvd2VkIGJ5IFwiLVwiLlxuXHRcdC8vIFRoZSBtYXRjaGluZyBvZiBDIGFnYWluc3QgdGhlIGVsZW1lbnQncyBsYW5ndWFnZSB2YWx1ZSBpcyBwZXJmb3JtZWQgY2FzZS1pbnNlbnNpdGl2ZWx5LlxuXHRcdC8vIFRoZSBpZGVudGlmaWVyIEMgZG9lcyBub3QgaGF2ZSB0byBiZSBhIHZhbGlkIGxhbmd1YWdlIG5hbWUuXCJcblx0XHQvLyBodHRwOi8vd3d3LnczLm9yZy9UUi9zZWxlY3RvcnMvI2xhbmctcHNldWRvXG5cdFx0XCJsYW5nXCI6IG1hcmtGdW5jdGlvbiggZnVuY3Rpb24oIGxhbmcgKSB7XG5cdFx0XHQvLyBsYW5nIHZhbHVlIG11c3QgYmUgYSB2YWxpZCBpZGVudGlmaWVyXG5cdFx0XHRpZiAoICFyaWRlbnRpZmllci50ZXN0KGxhbmcgfHwgXCJcIikgKSB7XG5cdFx0XHRcdFNpenpsZS5lcnJvciggXCJ1bnN1cHBvcnRlZCBsYW5nOiBcIiArIGxhbmcgKTtcblx0XHRcdH1cblx0XHRcdGxhbmcgPSBsYW5nLnJlcGxhY2UoIHJ1bmVzY2FwZSwgZnVuZXNjYXBlICkudG9Mb3dlckNhc2UoKTtcblx0XHRcdHJldHVybiBmdW5jdGlvbiggZWxlbSApIHtcblx0XHRcdFx0dmFyIGVsZW1MYW5nO1xuXHRcdFx0XHRkbyB7XG5cdFx0XHRcdFx0aWYgKCAoZWxlbUxhbmcgPSBkb2N1bWVudElzSFRNTCA/XG5cdFx0XHRcdFx0XHRlbGVtLmxhbmcgOlxuXHRcdFx0XHRcdFx0ZWxlbS5nZXRBdHRyaWJ1dGUoXCJ4bWw6bGFuZ1wiKSB8fCBlbGVtLmdldEF0dHJpYnV0ZShcImxhbmdcIikpICkge1xuXG5cdFx0XHRcdFx0XHRlbGVtTGFuZyA9IGVsZW1MYW5nLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdFx0XHRyZXR1cm4gZWxlbUxhbmcgPT09IGxhbmcgfHwgZWxlbUxhbmcuaW5kZXhPZiggbGFuZyArIFwiLVwiICkgPT09IDA7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IHdoaWxlICggKGVsZW0gPSBlbGVtLnBhcmVudE5vZGUpICYmIGVsZW0ubm9kZVR5cGUgPT09IDEgKTtcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0fTtcblx0XHR9KSxcblxuXHRcdC8vIE1pc2NlbGxhbmVvdXNcblx0XHRcInRhcmdldFwiOiBmdW5jdGlvbiggZWxlbSApIHtcblx0XHRcdHZhciBoYXNoID0gd2luZG93LmxvY2F0aW9uICYmIHdpbmRvdy5sb2NhdGlvbi5oYXNoO1xuXHRcdFx0cmV0dXJuIGhhc2ggJiYgaGFzaC5zbGljZSggMSApID09PSBlbGVtLmlkO1xuXHRcdH0sXG5cblx0XHRcInJvb3RcIjogZnVuY3Rpb24oIGVsZW0gKSB7XG5cdFx0XHRyZXR1cm4gZWxlbSA9PT0gZG9jRWxlbTtcblx0XHR9LFxuXG5cdFx0XCJmb2N1c1wiOiBmdW5jdGlvbiggZWxlbSApIHtcblx0XHRcdHJldHVybiBlbGVtID09PSBkb2N1bWVudC5hY3RpdmVFbGVtZW50ICYmICghZG9jdW1lbnQuaGFzRm9jdXMgfHwgZG9jdW1lbnQuaGFzRm9jdXMoKSkgJiYgISEoZWxlbS50eXBlIHx8IGVsZW0uaHJlZiB8fCB+ZWxlbS50YWJJbmRleCk7XG5cdFx0fSxcblxuXHRcdC8vIEJvb2xlYW4gcHJvcGVydGllc1xuXHRcdFwiZW5hYmxlZFwiOiBmdW5jdGlvbiggZWxlbSApIHtcblx0XHRcdHJldHVybiBlbGVtLmRpc2FibGVkID09PSBmYWxzZTtcblx0XHR9LFxuXG5cdFx0XCJkaXNhYmxlZFwiOiBmdW5jdGlvbiggZWxlbSApIHtcblx0XHRcdHJldHVybiBlbGVtLmRpc2FibGVkID09PSB0cnVlO1xuXHRcdH0sXG5cblx0XHRcImNoZWNrZWRcIjogZnVuY3Rpb24oIGVsZW0gKSB7XG5cdFx0XHQvLyBJbiBDU1MzLCA6Y2hlY2tlZCBzaG91bGQgcmV0dXJuIGJvdGggY2hlY2tlZCBhbmQgc2VsZWN0ZWQgZWxlbWVudHNcblx0XHRcdC8vIGh0dHA6Ly93d3cudzMub3JnL1RSLzIwMTEvUkVDLWNzczMtc2VsZWN0b3JzLTIwMTEwOTI5LyNjaGVja2VkXG5cdFx0XHR2YXIgbm9kZU5hbWUgPSBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRyZXR1cm4gKG5vZGVOYW1lID09PSBcImlucHV0XCIgJiYgISFlbGVtLmNoZWNrZWQpIHx8IChub2RlTmFtZSA9PT0gXCJvcHRpb25cIiAmJiAhIWVsZW0uc2VsZWN0ZWQpO1xuXHRcdH0sXG5cblx0XHRcInNlbGVjdGVkXCI6IGZ1bmN0aW9uKCBlbGVtICkge1xuXHRcdFx0Ly8gQWNjZXNzaW5nIHRoaXMgcHJvcGVydHkgbWFrZXMgc2VsZWN0ZWQtYnktZGVmYXVsdFxuXHRcdFx0Ly8gb3B0aW9ucyBpbiBTYWZhcmkgd29yayBwcm9wZXJseVxuXHRcdFx0aWYgKCBlbGVtLnBhcmVudE5vZGUgKSB7XG5cdFx0XHRcdGVsZW0ucGFyZW50Tm9kZS5zZWxlY3RlZEluZGV4O1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gZWxlbS5zZWxlY3RlZCA9PT0gdHJ1ZTtcblx0XHR9LFxuXG5cdFx0Ly8gQ29udGVudHNcblx0XHRcImVtcHR5XCI6IGZ1bmN0aW9uKCBlbGVtICkge1xuXHRcdFx0Ly8gaHR0cDovL3d3dy53My5vcmcvVFIvc2VsZWN0b3JzLyNlbXB0eS1wc2V1ZG9cblx0XHRcdC8vIDplbXB0eSBpcyBuZWdhdGVkIGJ5IGVsZW1lbnQgKDEpIG9yIGNvbnRlbnQgbm9kZXMgKHRleHQ6IDM7IGNkYXRhOiA0OyBlbnRpdHkgcmVmOiA1KSxcblx0XHRcdC8vICAgYnV0IG5vdCBieSBvdGhlcnMgKGNvbW1lbnQ6IDg7IHByb2Nlc3NpbmcgaW5zdHJ1Y3Rpb246IDc7IGV0Yy4pXG5cdFx0XHQvLyBub2RlVHlwZSA8IDYgd29ya3MgYmVjYXVzZSBhdHRyaWJ1dGVzICgyKSBkbyBub3QgYXBwZWFyIGFzIGNoaWxkcmVuXG5cdFx0XHRmb3IgKCBlbGVtID0gZWxlbS5maXJzdENoaWxkOyBlbGVtOyBlbGVtID0gZWxlbS5uZXh0U2libGluZyApIHtcblx0XHRcdFx0aWYgKCBlbGVtLm5vZGVUeXBlIDwgNiApIHtcblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdHJldHVybiB0cnVlO1xuXHRcdH0sXG5cblx0XHRcInBhcmVudFwiOiBmdW5jdGlvbiggZWxlbSApIHtcblx0XHRcdHJldHVybiAhRXhwci5wc2V1ZG9zW1wiZW1wdHlcIl0oIGVsZW0gKTtcblx0XHR9LFxuXG5cdFx0Ly8gRWxlbWVudC9pbnB1dCB0eXBlc1xuXHRcdFwiaGVhZGVyXCI6IGZ1bmN0aW9uKCBlbGVtICkge1xuXHRcdFx0cmV0dXJuIHJoZWFkZXIudGVzdCggZWxlbS5ub2RlTmFtZSApO1xuXHRcdH0sXG5cblx0XHRcImlucHV0XCI6IGZ1bmN0aW9uKCBlbGVtICkge1xuXHRcdFx0cmV0dXJuIHJpbnB1dHMudGVzdCggZWxlbS5ub2RlTmFtZSApO1xuXHRcdH0sXG5cblx0XHRcImJ1dHRvblwiOiBmdW5jdGlvbiggZWxlbSApIHtcblx0XHRcdHZhciBuYW1lID0gZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0cmV0dXJuIG5hbWUgPT09IFwiaW5wdXRcIiAmJiBlbGVtLnR5cGUgPT09IFwiYnV0dG9uXCIgfHwgbmFtZSA9PT0gXCJidXR0b25cIjtcblx0XHR9LFxuXG5cdFx0XCJ0ZXh0XCI6IGZ1bmN0aW9uKCBlbGVtICkge1xuXHRcdFx0dmFyIGF0dHI7XG5cdFx0XHRyZXR1cm4gZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSBcImlucHV0XCIgJiZcblx0XHRcdFx0ZWxlbS50eXBlID09PSBcInRleHRcIiAmJlxuXG5cdFx0XHRcdC8vIFN1cHBvcnQ6IElFPDhcblx0XHRcdFx0Ly8gTmV3IEhUTUw1IGF0dHJpYnV0ZSB2YWx1ZXMgKGUuZy4sIFwic2VhcmNoXCIpIGFwcGVhciB3aXRoIGVsZW0udHlwZSA9PT0gXCJ0ZXh0XCJcblx0XHRcdFx0KCAoYXR0ciA9IGVsZW0uZ2V0QXR0cmlidXRlKFwidHlwZVwiKSkgPT0gbnVsbCB8fCBhdHRyLnRvTG93ZXJDYXNlKCkgPT09IFwidGV4dFwiICk7XG5cdFx0fSxcblxuXHRcdC8vIFBvc2l0aW9uLWluLWNvbGxlY3Rpb25cblx0XHRcImZpcnN0XCI6IGNyZWF0ZVBvc2l0aW9uYWxQc2V1ZG8oZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gWyAwIF07XG5cdFx0fSksXG5cblx0XHRcImxhc3RcIjogY3JlYXRlUG9zaXRpb25hbFBzZXVkbyhmdW5jdGlvbiggbWF0Y2hJbmRleGVzLCBsZW5ndGggKSB7XG5cdFx0XHRyZXR1cm4gWyBsZW5ndGggLSAxIF07XG5cdFx0fSksXG5cblx0XHRcImVxXCI6IGNyZWF0ZVBvc2l0aW9uYWxQc2V1ZG8oZnVuY3Rpb24oIG1hdGNoSW5kZXhlcywgbGVuZ3RoLCBhcmd1bWVudCApIHtcblx0XHRcdHJldHVybiBbIGFyZ3VtZW50IDwgMCA/IGFyZ3VtZW50ICsgbGVuZ3RoIDogYXJndW1lbnQgXTtcblx0XHR9KSxcblxuXHRcdFwiZXZlblwiOiBjcmVhdGVQb3NpdGlvbmFsUHNldWRvKGZ1bmN0aW9uKCBtYXRjaEluZGV4ZXMsIGxlbmd0aCApIHtcblx0XHRcdHZhciBpID0gMDtcblx0XHRcdGZvciAoIDsgaSA8IGxlbmd0aDsgaSArPSAyICkge1xuXHRcdFx0XHRtYXRjaEluZGV4ZXMucHVzaCggaSApO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIG1hdGNoSW5kZXhlcztcblx0XHR9KSxcblxuXHRcdFwib2RkXCI6IGNyZWF0ZVBvc2l0aW9uYWxQc2V1ZG8oZnVuY3Rpb24oIG1hdGNoSW5kZXhlcywgbGVuZ3RoICkge1xuXHRcdFx0dmFyIGkgPSAxO1xuXHRcdFx0Zm9yICggOyBpIDwgbGVuZ3RoOyBpICs9IDIgKSB7XG5cdFx0XHRcdG1hdGNoSW5kZXhlcy5wdXNoKCBpICk7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gbWF0Y2hJbmRleGVzO1xuXHRcdH0pLFxuXG5cdFx0XCJsdFwiOiBjcmVhdGVQb3NpdGlvbmFsUHNldWRvKGZ1bmN0aW9uKCBtYXRjaEluZGV4ZXMsIGxlbmd0aCwgYXJndW1lbnQgKSB7XG5cdFx0XHR2YXIgaSA9IGFyZ3VtZW50IDwgMCA/IGFyZ3VtZW50ICsgbGVuZ3RoIDogYXJndW1lbnQ7XG5cdFx0XHRmb3IgKCA7IC0taSA+PSAwOyApIHtcblx0XHRcdFx0bWF0Y2hJbmRleGVzLnB1c2goIGkgKTtcblx0XHRcdH1cblx0XHRcdHJldHVybiBtYXRjaEluZGV4ZXM7XG5cdFx0fSksXG5cblx0XHRcImd0XCI6IGNyZWF0ZVBvc2l0aW9uYWxQc2V1ZG8oZnVuY3Rpb24oIG1hdGNoSW5kZXhlcywgbGVuZ3RoLCBhcmd1bWVudCApIHtcblx0XHRcdHZhciBpID0gYXJndW1lbnQgPCAwID8gYXJndW1lbnQgKyBsZW5ndGggOiBhcmd1bWVudDtcblx0XHRcdGZvciAoIDsgKytpIDwgbGVuZ3RoOyApIHtcblx0XHRcdFx0bWF0Y2hJbmRleGVzLnB1c2goIGkgKTtcblx0XHRcdH1cblx0XHRcdHJldHVybiBtYXRjaEluZGV4ZXM7XG5cdFx0fSlcblx0fVxufTtcblxuRXhwci5wc2V1ZG9zW1wibnRoXCJdID0gRXhwci5wc2V1ZG9zW1wiZXFcIl07XG5cbi8vIEFkZCBidXR0b24vaW5wdXQgdHlwZSBwc2V1ZG9zXG5mb3IgKCBpIGluIHsgcmFkaW86IHRydWUsIGNoZWNrYm94OiB0cnVlLCBmaWxlOiB0cnVlLCBwYXNzd29yZDogdHJ1ZSwgaW1hZ2U6IHRydWUgfSApIHtcblx0RXhwci5wc2V1ZG9zWyBpIF0gPSBjcmVhdGVJbnB1dFBzZXVkbyggaSApO1xufVxuZm9yICggaSBpbiB7IHN1Ym1pdDogdHJ1ZSwgcmVzZXQ6IHRydWUgfSApIHtcblx0RXhwci5wc2V1ZG9zWyBpIF0gPSBjcmVhdGVCdXR0b25Qc2V1ZG8oIGkgKTtcbn1cblxuLy8gRWFzeSBBUEkgZm9yIGNyZWF0aW5nIG5ldyBzZXRGaWx0ZXJzXG5mdW5jdGlvbiBzZXRGaWx0ZXJzKCkge31cbnNldEZpbHRlcnMucHJvdG90eXBlID0gRXhwci5maWx0ZXJzID0gRXhwci5wc2V1ZG9zO1xuRXhwci5zZXRGaWx0ZXJzID0gbmV3IHNldEZpbHRlcnMoKTtcblxudG9rZW5pemUgPSBTaXp6bGUudG9rZW5pemUgPSBmdW5jdGlvbiggc2VsZWN0b3IsIHBhcnNlT25seSApIHtcblx0dmFyIG1hdGNoZWQsIG1hdGNoLCB0b2tlbnMsIHR5cGUsXG5cdFx0c29GYXIsIGdyb3VwcywgcHJlRmlsdGVycyxcblx0XHRjYWNoZWQgPSB0b2tlbkNhY2hlWyBzZWxlY3RvciArIFwiIFwiIF07XG5cblx0aWYgKCBjYWNoZWQgKSB7XG5cdFx0cmV0dXJuIHBhcnNlT25seSA/IDAgOiBjYWNoZWQuc2xpY2UoIDAgKTtcblx0fVxuXG5cdHNvRmFyID0gc2VsZWN0b3I7XG5cdGdyb3VwcyA9IFtdO1xuXHRwcmVGaWx0ZXJzID0gRXhwci5wcmVGaWx0ZXI7XG5cblx0d2hpbGUgKCBzb0ZhciApIHtcblxuXHRcdC8vIENvbW1hIGFuZCBmaXJzdCBydW5cblx0XHRpZiAoICFtYXRjaGVkIHx8IChtYXRjaCA9IHJjb21tYS5leGVjKCBzb0ZhciApKSApIHtcblx0XHRcdGlmICggbWF0Y2ggKSB7XG5cdFx0XHRcdC8vIERvbid0IGNvbnN1bWUgdHJhaWxpbmcgY29tbWFzIGFzIHZhbGlkXG5cdFx0XHRcdHNvRmFyID0gc29GYXIuc2xpY2UoIG1hdGNoWzBdLmxlbmd0aCApIHx8IHNvRmFyO1xuXHRcdFx0fVxuXHRcdFx0Z3JvdXBzLnB1c2goICh0b2tlbnMgPSBbXSkgKTtcblx0XHR9XG5cblx0XHRtYXRjaGVkID0gZmFsc2U7XG5cblx0XHQvLyBDb21iaW5hdG9yc1xuXHRcdGlmICggKG1hdGNoID0gcmNvbWJpbmF0b3JzLmV4ZWMoIHNvRmFyICkpICkge1xuXHRcdFx0bWF0Y2hlZCA9IG1hdGNoLnNoaWZ0KCk7XG5cdFx0XHR0b2tlbnMucHVzaCh7XG5cdFx0XHRcdHZhbHVlOiBtYXRjaGVkLFxuXHRcdFx0XHQvLyBDYXN0IGRlc2NlbmRhbnQgY29tYmluYXRvcnMgdG8gc3BhY2Vcblx0XHRcdFx0dHlwZTogbWF0Y2hbMF0ucmVwbGFjZSggcnRyaW0sIFwiIFwiIClcblx0XHRcdH0pO1xuXHRcdFx0c29GYXIgPSBzb0Zhci5zbGljZSggbWF0Y2hlZC5sZW5ndGggKTtcblx0XHR9XG5cblx0XHQvLyBGaWx0ZXJzXG5cdFx0Zm9yICggdHlwZSBpbiBFeHByLmZpbHRlciApIHtcblx0XHRcdGlmICggKG1hdGNoID0gbWF0Y2hFeHByWyB0eXBlIF0uZXhlYyggc29GYXIgKSkgJiYgKCFwcmVGaWx0ZXJzWyB0eXBlIF0gfHxcblx0XHRcdFx0KG1hdGNoID0gcHJlRmlsdGVyc1sgdHlwZSBdKCBtYXRjaCApKSkgKSB7XG5cdFx0XHRcdG1hdGNoZWQgPSBtYXRjaC5zaGlmdCgpO1xuXHRcdFx0XHR0b2tlbnMucHVzaCh7XG5cdFx0XHRcdFx0dmFsdWU6IG1hdGNoZWQsXG5cdFx0XHRcdFx0dHlwZTogdHlwZSxcblx0XHRcdFx0XHRtYXRjaGVzOiBtYXRjaFxuXHRcdFx0XHR9KTtcblx0XHRcdFx0c29GYXIgPSBzb0Zhci5zbGljZSggbWF0Y2hlZC5sZW5ndGggKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoICFtYXRjaGVkICkge1xuXHRcdFx0YnJlYWs7XG5cdFx0fVxuXHR9XG5cblx0Ly8gUmV0dXJuIHRoZSBsZW5ndGggb2YgdGhlIGludmFsaWQgZXhjZXNzXG5cdC8vIGlmIHdlJ3JlIGp1c3QgcGFyc2luZ1xuXHQvLyBPdGhlcndpc2UsIHRocm93IGFuIGVycm9yIG9yIHJldHVybiB0b2tlbnNcblx0cmV0dXJuIHBhcnNlT25seSA/XG5cdFx0c29GYXIubGVuZ3RoIDpcblx0XHRzb0ZhciA/XG5cdFx0XHRTaXp6bGUuZXJyb3IoIHNlbGVjdG9yICkgOlxuXHRcdFx0Ly8gQ2FjaGUgdGhlIHRva2Vuc1xuXHRcdFx0dG9rZW5DYWNoZSggc2VsZWN0b3IsIGdyb3VwcyApLnNsaWNlKCAwICk7XG59O1xuXG5mdW5jdGlvbiB0b1NlbGVjdG9yKCB0b2tlbnMgKSB7XG5cdHZhciBpID0gMCxcblx0XHRsZW4gPSB0b2tlbnMubGVuZ3RoLFxuXHRcdHNlbGVjdG9yID0gXCJcIjtcblx0Zm9yICggOyBpIDwgbGVuOyBpKysgKSB7XG5cdFx0c2VsZWN0b3IgKz0gdG9rZW5zW2ldLnZhbHVlO1xuXHR9XG5cdHJldHVybiBzZWxlY3Rvcjtcbn1cblxuZnVuY3Rpb24gYWRkQ29tYmluYXRvciggbWF0Y2hlciwgY29tYmluYXRvciwgYmFzZSApIHtcblx0dmFyIGRpciA9IGNvbWJpbmF0b3IuZGlyLFxuXHRcdGNoZWNrTm9uRWxlbWVudHMgPSBiYXNlICYmIGRpciA9PT0gXCJwYXJlbnROb2RlXCIsXG5cdFx0ZG9uZU5hbWUgPSBkb25lKys7XG5cblx0cmV0dXJuIGNvbWJpbmF0b3IuZmlyc3QgP1xuXHRcdC8vIENoZWNrIGFnYWluc3QgY2xvc2VzdCBhbmNlc3Rvci9wcmVjZWRpbmcgZWxlbWVudFxuXHRcdGZ1bmN0aW9uKCBlbGVtLCBjb250ZXh0LCB4bWwgKSB7XG5cdFx0XHR3aGlsZSAoIChlbGVtID0gZWxlbVsgZGlyIF0pICkge1xuXHRcdFx0XHRpZiAoIGVsZW0ubm9kZVR5cGUgPT09IDEgfHwgY2hlY2tOb25FbGVtZW50cyApIHtcblx0XHRcdFx0XHRyZXR1cm4gbWF0Y2hlciggZWxlbSwgY29udGV4dCwgeG1sICk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9IDpcblxuXHRcdC8vIENoZWNrIGFnYWluc3QgYWxsIGFuY2VzdG9yL3ByZWNlZGluZyBlbGVtZW50c1xuXHRcdGZ1bmN0aW9uKCBlbGVtLCBjb250ZXh0LCB4bWwgKSB7XG5cdFx0XHR2YXIgb2xkQ2FjaGUsIG91dGVyQ2FjaGUsXG5cdFx0XHRcdG5ld0NhY2hlID0gWyBkaXJydW5zLCBkb25lTmFtZSBdO1xuXG5cdFx0XHQvLyBXZSBjYW4ndCBzZXQgYXJiaXRyYXJ5IGRhdGEgb24gWE1MIG5vZGVzLCBzbyB0aGV5IGRvbid0IGJlbmVmaXQgZnJvbSBkaXIgY2FjaGluZ1xuXHRcdFx0aWYgKCB4bWwgKSB7XG5cdFx0XHRcdHdoaWxlICggKGVsZW0gPSBlbGVtWyBkaXIgXSkgKSB7XG5cdFx0XHRcdFx0aWYgKCBlbGVtLm5vZGVUeXBlID09PSAxIHx8IGNoZWNrTm9uRWxlbWVudHMgKSB7XG5cdFx0XHRcdFx0XHRpZiAoIG1hdGNoZXIoIGVsZW0sIGNvbnRleHQsIHhtbCApICkge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHdoaWxlICggKGVsZW0gPSBlbGVtWyBkaXIgXSkgKSB7XG5cdFx0XHRcdFx0aWYgKCBlbGVtLm5vZGVUeXBlID09PSAxIHx8IGNoZWNrTm9uRWxlbWVudHMgKSB7XG5cdFx0XHRcdFx0XHRvdXRlckNhY2hlID0gZWxlbVsgZXhwYW5kbyBdIHx8IChlbGVtWyBleHBhbmRvIF0gPSB7fSk7XG5cdFx0XHRcdFx0XHRpZiAoIChvbGRDYWNoZSA9IG91dGVyQ2FjaGVbIGRpciBdKSAmJlxuXHRcdFx0XHRcdFx0XHRvbGRDYWNoZVsgMCBdID09PSBkaXJydW5zICYmIG9sZENhY2hlWyAxIF0gPT09IGRvbmVOYW1lICkge1xuXG5cdFx0XHRcdFx0XHRcdC8vIEFzc2lnbiB0byBuZXdDYWNoZSBzbyByZXN1bHRzIGJhY2stcHJvcGFnYXRlIHRvIHByZXZpb3VzIGVsZW1lbnRzXG5cdFx0XHRcdFx0XHRcdHJldHVybiAobmV3Q2FjaGVbIDIgXSA9IG9sZENhY2hlWyAyIF0pO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0Ly8gUmV1c2UgbmV3Y2FjaGUgc28gcmVzdWx0cyBiYWNrLXByb3BhZ2F0ZSB0byBwcmV2aW91cyBlbGVtZW50c1xuXHRcdFx0XHRcdFx0XHRvdXRlckNhY2hlWyBkaXIgXSA9IG5ld0NhY2hlO1xuXG5cdFx0XHRcdFx0XHRcdC8vIEEgbWF0Y2ggbWVhbnMgd2UncmUgZG9uZTsgYSBmYWlsIG1lYW5zIHdlIGhhdmUgdG8ga2VlcCBjaGVja2luZ1xuXHRcdFx0XHRcdFx0XHRpZiAoIChuZXdDYWNoZVsgMiBdID0gbWF0Y2hlciggZWxlbSwgY29udGV4dCwgeG1sICkpICkge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fTtcbn1cblxuZnVuY3Rpb24gZWxlbWVudE1hdGNoZXIoIG1hdGNoZXJzICkge1xuXHRyZXR1cm4gbWF0Y2hlcnMubGVuZ3RoID4gMSA/XG5cdFx0ZnVuY3Rpb24oIGVsZW0sIGNvbnRleHQsIHhtbCApIHtcblx0XHRcdHZhciBpID0gbWF0Y2hlcnMubGVuZ3RoO1xuXHRcdFx0d2hpbGUgKCBpLS0gKSB7XG5cdFx0XHRcdGlmICggIW1hdGNoZXJzW2ldKCBlbGVtLCBjb250ZXh0LCB4bWwgKSApIHtcblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdHJldHVybiB0cnVlO1xuXHRcdH0gOlxuXHRcdG1hdGNoZXJzWzBdO1xufVxuXG5mdW5jdGlvbiBtdWx0aXBsZUNvbnRleHRzKCBzZWxlY3RvciwgY29udGV4dHMsIHJlc3VsdHMgKSB7XG5cdHZhciBpID0gMCxcblx0XHRsZW4gPSBjb250ZXh0cy5sZW5ndGg7XG5cdGZvciAoIDsgaSA8IGxlbjsgaSsrICkge1xuXHRcdFNpenpsZSggc2VsZWN0b3IsIGNvbnRleHRzW2ldLCByZXN1bHRzICk7XG5cdH1cblx0cmV0dXJuIHJlc3VsdHM7XG59XG5cbmZ1bmN0aW9uIGNvbmRlbnNlKCB1bm1hdGNoZWQsIG1hcCwgZmlsdGVyLCBjb250ZXh0LCB4bWwgKSB7XG5cdHZhciBlbGVtLFxuXHRcdG5ld1VubWF0Y2hlZCA9IFtdLFxuXHRcdGkgPSAwLFxuXHRcdGxlbiA9IHVubWF0Y2hlZC5sZW5ndGgsXG5cdFx0bWFwcGVkID0gbWFwICE9IG51bGw7XG5cblx0Zm9yICggOyBpIDwgbGVuOyBpKysgKSB7XG5cdFx0aWYgKCAoZWxlbSA9IHVubWF0Y2hlZFtpXSkgKSB7XG5cdFx0XHRpZiAoICFmaWx0ZXIgfHwgZmlsdGVyKCBlbGVtLCBjb250ZXh0LCB4bWwgKSApIHtcblx0XHRcdFx0bmV3VW5tYXRjaGVkLnB1c2goIGVsZW0gKTtcblx0XHRcdFx0aWYgKCBtYXBwZWQgKSB7XG5cdFx0XHRcdFx0bWFwLnB1c2goIGkgKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdHJldHVybiBuZXdVbm1hdGNoZWQ7XG59XG5cbmZ1bmN0aW9uIHNldE1hdGNoZXIoIHByZUZpbHRlciwgc2VsZWN0b3IsIG1hdGNoZXIsIHBvc3RGaWx0ZXIsIHBvc3RGaW5kZXIsIHBvc3RTZWxlY3RvciApIHtcblx0aWYgKCBwb3N0RmlsdGVyICYmICFwb3N0RmlsdGVyWyBleHBhbmRvIF0gKSB7XG5cdFx0cG9zdEZpbHRlciA9IHNldE1hdGNoZXIoIHBvc3RGaWx0ZXIgKTtcblx0fVxuXHRpZiAoIHBvc3RGaW5kZXIgJiYgIXBvc3RGaW5kZXJbIGV4cGFuZG8gXSApIHtcblx0XHRwb3N0RmluZGVyID0gc2V0TWF0Y2hlciggcG9zdEZpbmRlciwgcG9zdFNlbGVjdG9yICk7XG5cdH1cblx0cmV0dXJuIG1hcmtGdW5jdGlvbihmdW5jdGlvbiggc2VlZCwgcmVzdWx0cywgY29udGV4dCwgeG1sICkge1xuXHRcdHZhciB0ZW1wLCBpLCBlbGVtLFxuXHRcdFx0cHJlTWFwID0gW10sXG5cdFx0XHRwb3N0TWFwID0gW10sXG5cdFx0XHRwcmVleGlzdGluZyA9IHJlc3VsdHMubGVuZ3RoLFxuXG5cdFx0XHQvLyBHZXQgaW5pdGlhbCBlbGVtZW50cyBmcm9tIHNlZWQgb3IgY29udGV4dFxuXHRcdFx0ZWxlbXMgPSBzZWVkIHx8IG11bHRpcGxlQ29udGV4dHMoIHNlbGVjdG9yIHx8IFwiKlwiLCBjb250ZXh0Lm5vZGVUeXBlID8gWyBjb250ZXh0IF0gOiBjb250ZXh0LCBbXSApLFxuXG5cdFx0XHQvLyBQcmVmaWx0ZXIgdG8gZ2V0IG1hdGNoZXIgaW5wdXQsIHByZXNlcnZpbmcgYSBtYXAgZm9yIHNlZWQtcmVzdWx0cyBzeW5jaHJvbml6YXRpb25cblx0XHRcdG1hdGNoZXJJbiA9IHByZUZpbHRlciAmJiAoIHNlZWQgfHwgIXNlbGVjdG9yICkgP1xuXHRcdFx0XHRjb25kZW5zZSggZWxlbXMsIHByZU1hcCwgcHJlRmlsdGVyLCBjb250ZXh0LCB4bWwgKSA6XG5cdFx0XHRcdGVsZW1zLFxuXG5cdFx0XHRtYXRjaGVyT3V0ID0gbWF0Y2hlciA/XG5cdFx0XHRcdC8vIElmIHdlIGhhdmUgYSBwb3N0RmluZGVyLCBvciBmaWx0ZXJlZCBzZWVkLCBvciBub24tc2VlZCBwb3N0RmlsdGVyIG9yIHByZWV4aXN0aW5nIHJlc3VsdHMsXG5cdFx0XHRcdHBvc3RGaW5kZXIgfHwgKCBzZWVkID8gcHJlRmlsdGVyIDogcHJlZXhpc3RpbmcgfHwgcG9zdEZpbHRlciApID9cblxuXHRcdFx0XHRcdC8vIC4uLmludGVybWVkaWF0ZSBwcm9jZXNzaW5nIGlzIG5lY2Vzc2FyeVxuXHRcdFx0XHRcdFtdIDpcblxuXHRcdFx0XHRcdC8vIC4uLm90aGVyd2lzZSB1c2UgcmVzdWx0cyBkaXJlY3RseVxuXHRcdFx0XHRcdHJlc3VsdHMgOlxuXHRcdFx0XHRtYXRjaGVySW47XG5cblx0XHQvLyBGaW5kIHByaW1hcnkgbWF0Y2hlc1xuXHRcdGlmICggbWF0Y2hlciApIHtcblx0XHRcdG1hdGNoZXIoIG1hdGNoZXJJbiwgbWF0Y2hlck91dCwgY29udGV4dCwgeG1sICk7XG5cdFx0fVxuXG5cdFx0Ly8gQXBwbHkgcG9zdEZpbHRlclxuXHRcdGlmICggcG9zdEZpbHRlciApIHtcblx0XHRcdHRlbXAgPSBjb25kZW5zZSggbWF0Y2hlck91dCwgcG9zdE1hcCApO1xuXHRcdFx0cG9zdEZpbHRlciggdGVtcCwgW10sIGNvbnRleHQsIHhtbCApO1xuXG5cdFx0XHQvLyBVbi1tYXRjaCBmYWlsaW5nIGVsZW1lbnRzIGJ5IG1vdmluZyB0aGVtIGJhY2sgdG8gbWF0Y2hlckluXG5cdFx0XHRpID0gdGVtcC5sZW5ndGg7XG5cdFx0XHR3aGlsZSAoIGktLSApIHtcblx0XHRcdFx0aWYgKCAoZWxlbSA9IHRlbXBbaV0pICkge1xuXHRcdFx0XHRcdG1hdGNoZXJPdXRbIHBvc3RNYXBbaV0gXSA9ICEobWF0Y2hlckluWyBwb3N0TWFwW2ldIF0gPSBlbGVtKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICggc2VlZCApIHtcblx0XHRcdGlmICggcG9zdEZpbmRlciB8fCBwcmVGaWx0ZXIgKSB7XG5cdFx0XHRcdGlmICggcG9zdEZpbmRlciApIHtcblx0XHRcdFx0XHQvLyBHZXQgdGhlIGZpbmFsIG1hdGNoZXJPdXQgYnkgY29uZGVuc2luZyB0aGlzIGludGVybWVkaWF0ZSBpbnRvIHBvc3RGaW5kZXIgY29udGV4dHNcblx0XHRcdFx0XHR0ZW1wID0gW107XG5cdFx0XHRcdFx0aSA9IG1hdGNoZXJPdXQubGVuZ3RoO1xuXHRcdFx0XHRcdHdoaWxlICggaS0tICkge1xuXHRcdFx0XHRcdFx0aWYgKCAoZWxlbSA9IG1hdGNoZXJPdXRbaV0pICkge1xuXHRcdFx0XHRcdFx0XHQvLyBSZXN0b3JlIG1hdGNoZXJJbiBzaW5jZSBlbGVtIGlzIG5vdCB5ZXQgYSBmaW5hbCBtYXRjaFxuXHRcdFx0XHRcdFx0XHR0ZW1wLnB1c2goIChtYXRjaGVySW5baV0gPSBlbGVtKSApO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRwb3N0RmluZGVyKCBudWxsLCAobWF0Y2hlck91dCA9IFtdKSwgdGVtcCwgeG1sICk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBNb3ZlIG1hdGNoZWQgZWxlbWVudHMgZnJvbSBzZWVkIHRvIHJlc3VsdHMgdG8ga2VlcCB0aGVtIHN5bmNocm9uaXplZFxuXHRcdFx0XHRpID0gbWF0Y2hlck91dC5sZW5ndGg7XG5cdFx0XHRcdHdoaWxlICggaS0tICkge1xuXHRcdFx0XHRcdGlmICggKGVsZW0gPSBtYXRjaGVyT3V0W2ldKSAmJlxuXHRcdFx0XHRcdFx0KHRlbXAgPSBwb3N0RmluZGVyID8gaW5kZXhPZi5jYWxsKCBzZWVkLCBlbGVtICkgOiBwcmVNYXBbaV0pID4gLTEgKSB7XG5cblx0XHRcdFx0XHRcdHNlZWRbdGVtcF0gPSAhKHJlc3VsdHNbdGVtcF0gPSBlbGVtKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdC8vIEFkZCBlbGVtZW50cyB0byByZXN1bHRzLCB0aHJvdWdoIHBvc3RGaW5kZXIgaWYgZGVmaW5lZFxuXHRcdH0gZWxzZSB7XG5cdFx0XHRtYXRjaGVyT3V0ID0gY29uZGVuc2UoXG5cdFx0XHRcdG1hdGNoZXJPdXQgPT09IHJlc3VsdHMgP1xuXHRcdFx0XHRcdG1hdGNoZXJPdXQuc3BsaWNlKCBwcmVleGlzdGluZywgbWF0Y2hlck91dC5sZW5ndGggKSA6XG5cdFx0XHRcdFx0bWF0Y2hlck91dFxuXHRcdFx0KTtcblx0XHRcdGlmICggcG9zdEZpbmRlciApIHtcblx0XHRcdFx0cG9zdEZpbmRlciggbnVsbCwgcmVzdWx0cywgbWF0Y2hlck91dCwgeG1sICk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRwdXNoLmFwcGx5KCByZXN1bHRzLCBtYXRjaGVyT3V0ICk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9KTtcbn1cblxuZnVuY3Rpb24gbWF0Y2hlckZyb21Ub2tlbnMoIHRva2VucyApIHtcblx0dmFyIGNoZWNrQ29udGV4dCwgbWF0Y2hlciwgaixcblx0XHRsZW4gPSB0b2tlbnMubGVuZ3RoLFxuXHRcdGxlYWRpbmdSZWxhdGl2ZSA9IEV4cHIucmVsYXRpdmVbIHRva2Vuc1swXS50eXBlIF0sXG5cdFx0aW1wbGljaXRSZWxhdGl2ZSA9IGxlYWRpbmdSZWxhdGl2ZSB8fCBFeHByLnJlbGF0aXZlW1wiIFwiXSxcblx0XHRpID0gbGVhZGluZ1JlbGF0aXZlID8gMSA6IDAsXG5cblx0XHQvLyBUaGUgZm91bmRhdGlvbmFsIG1hdGNoZXIgZW5zdXJlcyB0aGF0IGVsZW1lbnRzIGFyZSByZWFjaGFibGUgZnJvbSB0b3AtbGV2ZWwgY29udGV4dChzKVxuXHRcdG1hdGNoQ29udGV4dCA9IGFkZENvbWJpbmF0b3IoIGZ1bmN0aW9uKCBlbGVtICkge1xuXHRcdFx0cmV0dXJuIGVsZW0gPT09IGNoZWNrQ29udGV4dDtcblx0XHR9LCBpbXBsaWNpdFJlbGF0aXZlLCB0cnVlICksXG5cdFx0bWF0Y2hBbnlDb250ZXh0ID0gYWRkQ29tYmluYXRvciggZnVuY3Rpb24oIGVsZW0gKSB7XG5cdFx0XHRyZXR1cm4gaW5kZXhPZi5jYWxsKCBjaGVja0NvbnRleHQsIGVsZW0gKSA+IC0xO1xuXHRcdH0sIGltcGxpY2l0UmVsYXRpdmUsIHRydWUgKSxcblx0XHRtYXRjaGVycyA9IFsgZnVuY3Rpb24oIGVsZW0sIGNvbnRleHQsIHhtbCApIHtcblx0XHRcdHJldHVybiAoICFsZWFkaW5nUmVsYXRpdmUgJiYgKCB4bWwgfHwgY29udGV4dCAhPT0gb3V0ZXJtb3N0Q29udGV4dCApICkgfHwgKFxuXHRcdFx0XHQoY2hlY2tDb250ZXh0ID0gY29udGV4dCkubm9kZVR5cGUgP1xuXHRcdFx0XHRcdG1hdGNoQ29udGV4dCggZWxlbSwgY29udGV4dCwgeG1sICkgOlxuXHRcdFx0XHRcdG1hdGNoQW55Q29udGV4dCggZWxlbSwgY29udGV4dCwgeG1sICkgKTtcblx0XHR9IF07XG5cblx0Zm9yICggOyBpIDwgbGVuOyBpKysgKSB7XG5cdFx0aWYgKCAobWF0Y2hlciA9IEV4cHIucmVsYXRpdmVbIHRva2Vuc1tpXS50eXBlIF0pICkge1xuXHRcdFx0bWF0Y2hlcnMgPSBbIGFkZENvbWJpbmF0b3IoZWxlbWVudE1hdGNoZXIoIG1hdGNoZXJzICksIG1hdGNoZXIpIF07XG5cdFx0fSBlbHNlIHtcblx0XHRcdG1hdGNoZXIgPSBFeHByLmZpbHRlclsgdG9rZW5zW2ldLnR5cGUgXS5hcHBseSggbnVsbCwgdG9rZW5zW2ldLm1hdGNoZXMgKTtcblxuXHRcdFx0Ly8gUmV0dXJuIHNwZWNpYWwgdXBvbiBzZWVpbmcgYSBwb3NpdGlvbmFsIG1hdGNoZXJcblx0XHRcdGlmICggbWF0Y2hlclsgZXhwYW5kbyBdICkge1xuXHRcdFx0XHQvLyBGaW5kIHRoZSBuZXh0IHJlbGF0aXZlIG9wZXJhdG9yIChpZiBhbnkpIGZvciBwcm9wZXIgaGFuZGxpbmdcblx0XHRcdFx0aiA9ICsraTtcblx0XHRcdFx0Zm9yICggOyBqIDwgbGVuOyBqKysgKSB7XG5cdFx0XHRcdFx0aWYgKCBFeHByLnJlbGF0aXZlWyB0b2tlbnNbal0udHlwZSBdICkge1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiBzZXRNYXRjaGVyKFxuXHRcdFx0XHRcdGkgPiAxICYmIGVsZW1lbnRNYXRjaGVyKCBtYXRjaGVycyApLFxuXHRcdFx0XHRcdGkgPiAxICYmIHRvU2VsZWN0b3IoXG5cdFx0XHRcdFx0XHQvLyBJZiB0aGUgcHJlY2VkaW5nIHRva2VuIHdhcyBhIGRlc2NlbmRhbnQgY29tYmluYXRvciwgaW5zZXJ0IGFuIGltcGxpY2l0IGFueS1lbGVtZW50IGAqYFxuXHRcdFx0XHRcdFx0dG9rZW5zLnNsaWNlKCAwLCBpIC0gMSApLmNvbmNhdCh7IHZhbHVlOiB0b2tlbnNbIGkgLSAyIF0udHlwZSA9PT0gXCIgXCIgPyBcIipcIiA6IFwiXCIgfSlcblx0XHRcdFx0XHQpLnJlcGxhY2UoIHJ0cmltLCBcIiQxXCIgKSxcblx0XHRcdFx0XHRtYXRjaGVyLFxuXHRcdFx0XHRcdGkgPCBqICYmIG1hdGNoZXJGcm9tVG9rZW5zKCB0b2tlbnMuc2xpY2UoIGksIGogKSApLFxuXHRcdFx0XHRcdGogPCBsZW4gJiYgbWF0Y2hlckZyb21Ub2tlbnMoICh0b2tlbnMgPSB0b2tlbnMuc2xpY2UoIGogKSkgKSxcblx0XHRcdFx0XHRqIDwgbGVuICYmIHRvU2VsZWN0b3IoIHRva2VucyApXG5cdFx0XHRcdCk7XG5cdFx0XHR9XG5cdFx0XHRtYXRjaGVycy5wdXNoKCBtYXRjaGVyICk7XG5cdFx0fVxuXHR9XG5cblx0cmV0dXJuIGVsZW1lbnRNYXRjaGVyKCBtYXRjaGVycyApO1xufVxuXG5mdW5jdGlvbiBtYXRjaGVyRnJvbUdyb3VwTWF0Y2hlcnMoIGVsZW1lbnRNYXRjaGVycywgc2V0TWF0Y2hlcnMgKSB7XG5cdHZhciBieVNldCA9IHNldE1hdGNoZXJzLmxlbmd0aCA+IDAsXG5cdFx0YnlFbGVtZW50ID0gZWxlbWVudE1hdGNoZXJzLmxlbmd0aCA+IDAsXG5cdFx0c3VwZXJNYXRjaGVyID0gZnVuY3Rpb24oIHNlZWQsIGNvbnRleHQsIHhtbCwgcmVzdWx0cywgb3V0ZXJtb3N0ICkge1xuXHRcdFx0dmFyIGVsZW0sIGosIG1hdGNoZXIsXG5cdFx0XHRcdG1hdGNoZWRDb3VudCA9IDAsXG5cdFx0XHRcdGkgPSBcIjBcIixcblx0XHRcdFx0dW5tYXRjaGVkID0gc2VlZCAmJiBbXSxcblx0XHRcdFx0c2V0TWF0Y2hlZCA9IFtdLFxuXHRcdFx0XHRjb250ZXh0QmFja3VwID0gb3V0ZXJtb3N0Q29udGV4dCxcblx0XHRcdFx0Ly8gV2UgbXVzdCBhbHdheXMgaGF2ZSBlaXRoZXIgc2VlZCBlbGVtZW50cyBvciBvdXRlcm1vc3QgY29udGV4dFxuXHRcdFx0XHRlbGVtcyA9IHNlZWQgfHwgYnlFbGVtZW50ICYmIEV4cHIuZmluZFtcIlRBR1wiXSggXCIqXCIsIG91dGVybW9zdCApLFxuXHRcdFx0XHQvLyBVc2UgaW50ZWdlciBkaXJydW5zIGlmZiB0aGlzIGlzIHRoZSBvdXRlcm1vc3QgbWF0Y2hlclxuXHRcdFx0XHRkaXJydW5zVW5pcXVlID0gKGRpcnJ1bnMgKz0gY29udGV4dEJhY2t1cCA9PSBudWxsID8gMSA6IE1hdGgucmFuZG9tKCkgfHwgMC4xKSxcblx0XHRcdFx0bGVuID0gZWxlbXMubGVuZ3RoO1xuXG5cdFx0XHRpZiAoIG91dGVybW9zdCApIHtcblx0XHRcdFx0b3V0ZXJtb3N0Q29udGV4dCA9IGNvbnRleHQgIT09IGRvY3VtZW50ICYmIGNvbnRleHQ7XG5cdFx0XHR9XG5cblx0XHRcdC8vIEFkZCBlbGVtZW50cyBwYXNzaW5nIGVsZW1lbnRNYXRjaGVycyBkaXJlY3RseSB0byByZXN1bHRzXG5cdFx0XHQvLyBLZWVwIGBpYCBhIHN0cmluZyBpZiB0aGVyZSBhcmUgbm8gZWxlbWVudHMgc28gYG1hdGNoZWRDb3VudGAgd2lsbCBiZSBcIjAwXCIgYmVsb3dcblx0XHRcdC8vIFN1cHBvcnQ6IElFPDksIFNhZmFyaVxuXHRcdFx0Ly8gVG9sZXJhdGUgTm9kZUxpc3QgcHJvcGVydGllcyAoSUU6IFwibGVuZ3RoXCI7IFNhZmFyaTogPG51bWJlcj4pIG1hdGNoaW5nIGVsZW1lbnRzIGJ5IGlkXG5cdFx0XHRmb3IgKCA7IGkgIT09IGxlbiAmJiAoZWxlbSA9IGVsZW1zW2ldKSAhPSBudWxsOyBpKysgKSB7XG5cdFx0XHRcdGlmICggYnlFbGVtZW50ICYmIGVsZW0gKSB7XG5cdFx0XHRcdFx0aiA9IDA7XG5cdFx0XHRcdFx0d2hpbGUgKCAobWF0Y2hlciA9IGVsZW1lbnRNYXRjaGVyc1tqKytdKSApIHtcblx0XHRcdFx0XHRcdGlmICggbWF0Y2hlciggZWxlbSwgY29udGV4dCwgeG1sICkgKSB7XG5cdFx0XHRcdFx0XHRcdHJlc3VsdHMucHVzaCggZWxlbSApO1xuXHRcdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKCBvdXRlcm1vc3QgKSB7XG5cdFx0XHRcdFx0XHRkaXJydW5zID0gZGlycnVuc1VuaXF1ZTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBUcmFjayB1bm1hdGNoZWQgZWxlbWVudHMgZm9yIHNldCBmaWx0ZXJzXG5cdFx0XHRcdGlmICggYnlTZXQgKSB7XG5cdFx0XHRcdFx0Ly8gVGhleSB3aWxsIGhhdmUgZ29uZSB0aHJvdWdoIGFsbCBwb3NzaWJsZSBtYXRjaGVyc1xuXHRcdFx0XHRcdGlmICggKGVsZW0gPSAhbWF0Y2hlciAmJiBlbGVtKSApIHtcblx0XHRcdFx0XHRcdG1hdGNoZWRDb3VudC0tO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdC8vIExlbmd0aGVuIHRoZSBhcnJheSBmb3IgZXZlcnkgZWxlbWVudCwgbWF0Y2hlZCBvciBub3Rcblx0XHRcdFx0XHRpZiAoIHNlZWQgKSB7XG5cdFx0XHRcdFx0XHR1bm1hdGNoZWQucHVzaCggZWxlbSApO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHQvLyBBcHBseSBzZXQgZmlsdGVycyB0byB1bm1hdGNoZWQgZWxlbWVudHNcblx0XHRcdG1hdGNoZWRDb3VudCArPSBpO1xuXHRcdFx0aWYgKCBieVNldCAmJiBpICE9PSBtYXRjaGVkQ291bnQgKSB7XG5cdFx0XHRcdGogPSAwO1xuXHRcdFx0XHR3aGlsZSAoIChtYXRjaGVyID0gc2V0TWF0Y2hlcnNbaisrXSkgKSB7XG5cdFx0XHRcdFx0bWF0Y2hlciggdW5tYXRjaGVkLCBzZXRNYXRjaGVkLCBjb250ZXh0LCB4bWwgKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICggc2VlZCApIHtcblx0XHRcdFx0XHQvLyBSZWludGVncmF0ZSBlbGVtZW50IG1hdGNoZXMgdG8gZWxpbWluYXRlIHRoZSBuZWVkIGZvciBzb3J0aW5nXG5cdFx0XHRcdFx0aWYgKCBtYXRjaGVkQ291bnQgPiAwICkge1xuXHRcdFx0XHRcdFx0d2hpbGUgKCBpLS0gKSB7XG5cdFx0XHRcdFx0XHRcdGlmICggISh1bm1hdGNoZWRbaV0gfHwgc2V0TWF0Y2hlZFtpXSkgKSB7XG5cdFx0XHRcdFx0XHRcdFx0c2V0TWF0Y2hlZFtpXSA9IHBvcC5jYWxsKCByZXN1bHRzICk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHQvLyBEaXNjYXJkIGluZGV4IHBsYWNlaG9sZGVyIHZhbHVlcyB0byBnZXQgb25seSBhY3R1YWwgbWF0Y2hlc1xuXHRcdFx0XHRcdHNldE1hdGNoZWQgPSBjb25kZW5zZSggc2V0TWF0Y2hlZCApO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gQWRkIG1hdGNoZXMgdG8gcmVzdWx0c1xuXHRcdFx0XHRwdXNoLmFwcGx5KCByZXN1bHRzLCBzZXRNYXRjaGVkICk7XG5cblx0XHRcdFx0Ly8gU2VlZGxlc3Mgc2V0IG1hdGNoZXMgc3VjY2VlZGluZyBtdWx0aXBsZSBzdWNjZXNzZnVsIG1hdGNoZXJzIHN0aXB1bGF0ZSBzb3J0aW5nXG5cdFx0XHRcdGlmICggb3V0ZXJtb3N0ICYmICFzZWVkICYmIHNldE1hdGNoZWQubGVuZ3RoID4gMCAmJlxuXHRcdFx0XHRcdCggbWF0Y2hlZENvdW50ICsgc2V0TWF0Y2hlcnMubGVuZ3RoICkgPiAxICkge1xuXG5cdFx0XHRcdFx0U2l6emxlLnVuaXF1ZVNvcnQoIHJlc3VsdHMgKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHQvLyBPdmVycmlkZSBtYW5pcHVsYXRpb24gb2YgZ2xvYmFscyBieSBuZXN0ZWQgbWF0Y2hlcnNcblx0XHRcdGlmICggb3V0ZXJtb3N0ICkge1xuXHRcdFx0XHRkaXJydW5zID0gZGlycnVuc1VuaXF1ZTtcblx0XHRcdFx0b3V0ZXJtb3N0Q29udGV4dCA9IGNvbnRleHRCYWNrdXA7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiB1bm1hdGNoZWQ7XG5cdFx0fTtcblxuXHRyZXR1cm4gYnlTZXQgP1xuXHRcdG1hcmtGdW5jdGlvbiggc3VwZXJNYXRjaGVyICkgOlxuXHRcdHN1cGVyTWF0Y2hlcjtcbn1cblxuY29tcGlsZSA9IFNpenpsZS5jb21waWxlID0gZnVuY3Rpb24oIHNlbGVjdG9yLCBtYXRjaCAvKiBJbnRlcm5hbCBVc2UgT25seSAqLyApIHtcblx0dmFyIGksXG5cdFx0c2V0TWF0Y2hlcnMgPSBbXSxcblx0XHRlbGVtZW50TWF0Y2hlcnMgPSBbXSxcblx0XHRjYWNoZWQgPSBjb21waWxlckNhY2hlWyBzZWxlY3RvciArIFwiIFwiIF07XG5cblx0aWYgKCAhY2FjaGVkICkge1xuXHRcdC8vIEdlbmVyYXRlIGEgZnVuY3Rpb24gb2YgcmVjdXJzaXZlIGZ1bmN0aW9ucyB0aGF0IGNhbiBiZSB1c2VkIHRvIGNoZWNrIGVhY2ggZWxlbWVudFxuXHRcdGlmICggIW1hdGNoICkge1xuXHRcdFx0bWF0Y2ggPSB0b2tlbml6ZSggc2VsZWN0b3IgKTtcblx0XHR9XG5cdFx0aSA9IG1hdGNoLmxlbmd0aDtcblx0XHR3aGlsZSAoIGktLSApIHtcblx0XHRcdGNhY2hlZCA9IG1hdGNoZXJGcm9tVG9rZW5zKCBtYXRjaFtpXSApO1xuXHRcdFx0aWYgKCBjYWNoZWRbIGV4cGFuZG8gXSApIHtcblx0XHRcdFx0c2V0TWF0Y2hlcnMucHVzaCggY2FjaGVkICk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRlbGVtZW50TWF0Y2hlcnMucHVzaCggY2FjaGVkICk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0Ly8gQ2FjaGUgdGhlIGNvbXBpbGVkIGZ1bmN0aW9uXG5cdFx0Y2FjaGVkID0gY29tcGlsZXJDYWNoZSggc2VsZWN0b3IsIG1hdGNoZXJGcm9tR3JvdXBNYXRjaGVycyggZWxlbWVudE1hdGNoZXJzLCBzZXRNYXRjaGVycyApICk7XG5cblx0XHQvLyBTYXZlIHNlbGVjdG9yIGFuZCB0b2tlbml6YXRpb25cblx0XHRjYWNoZWQuc2VsZWN0b3IgPSBzZWxlY3Rvcjtcblx0fVxuXHRyZXR1cm4gY2FjaGVkO1xufTtcblxuLyoqXG4gKiBBIGxvdy1sZXZlbCBzZWxlY3Rpb24gZnVuY3Rpb24gdGhhdCB3b3JrcyB3aXRoIFNpenpsZSdzIGNvbXBpbGVkXG4gKiAgc2VsZWN0b3IgZnVuY3Rpb25zXG4gKiBAcGFyYW0ge1N0cmluZ3xGdW5jdGlvbn0gc2VsZWN0b3IgQSBzZWxlY3RvciBvciBhIHByZS1jb21waWxlZFxuICogIHNlbGVjdG9yIGZ1bmN0aW9uIGJ1aWx0IHdpdGggU2l6emxlLmNvbXBpbGVcbiAqIEBwYXJhbSB7RWxlbWVudH0gY29udGV4dFxuICogQHBhcmFtIHtBcnJheX0gW3Jlc3VsdHNdXG4gKiBAcGFyYW0ge0FycmF5fSBbc2VlZF0gQSBzZXQgb2YgZWxlbWVudHMgdG8gbWF0Y2ggYWdhaW5zdFxuICovXG5zZWxlY3QgPSBTaXp6bGUuc2VsZWN0ID0gZnVuY3Rpb24oIHNlbGVjdG9yLCBjb250ZXh0LCByZXN1bHRzLCBzZWVkICkge1xuXHR2YXIgaSwgdG9rZW5zLCB0b2tlbiwgdHlwZSwgZmluZCxcblx0XHRjb21waWxlZCA9IHR5cGVvZiBzZWxlY3RvciA9PT0gXCJmdW5jdGlvblwiICYmIHNlbGVjdG9yLFxuXHRcdG1hdGNoID0gIXNlZWQgJiYgdG9rZW5pemUoIChzZWxlY3RvciA9IGNvbXBpbGVkLnNlbGVjdG9yIHx8IHNlbGVjdG9yKSApO1xuXG5cdHJlc3VsdHMgPSByZXN1bHRzIHx8IFtdO1xuXG5cdC8vIFRyeSB0byBtaW5pbWl6ZSBvcGVyYXRpb25zIGlmIHRoZXJlIGlzIG5vIHNlZWQgYW5kIG9ubHkgb25lIGdyb3VwXG5cdGlmICggbWF0Y2gubGVuZ3RoID09PSAxICkge1xuXG5cdFx0Ly8gVGFrZSBhIHNob3J0Y3V0IGFuZCBzZXQgdGhlIGNvbnRleHQgaWYgdGhlIHJvb3Qgc2VsZWN0b3IgaXMgYW4gSURcblx0XHR0b2tlbnMgPSBtYXRjaFswXSA9IG1hdGNoWzBdLnNsaWNlKCAwICk7XG5cdFx0aWYgKCB0b2tlbnMubGVuZ3RoID4gMiAmJiAodG9rZW4gPSB0b2tlbnNbMF0pLnR5cGUgPT09IFwiSURcIiAmJlxuXHRcdFx0XHRzdXBwb3J0LmdldEJ5SWQgJiYgY29udGV4dC5ub2RlVHlwZSA9PT0gOSAmJiBkb2N1bWVudElzSFRNTCAmJlxuXHRcdFx0XHRFeHByLnJlbGF0aXZlWyB0b2tlbnNbMV0udHlwZSBdICkge1xuXG5cdFx0XHRjb250ZXh0ID0gKCBFeHByLmZpbmRbXCJJRFwiXSggdG9rZW4ubWF0Y2hlc1swXS5yZXBsYWNlKHJ1bmVzY2FwZSwgZnVuZXNjYXBlKSwgY29udGV4dCApIHx8IFtdIClbMF07XG5cdFx0XHRpZiAoICFjb250ZXh0ICkge1xuXHRcdFx0XHRyZXR1cm4gcmVzdWx0cztcblxuXHRcdFx0Ly8gUHJlY29tcGlsZWQgbWF0Y2hlcnMgd2lsbCBzdGlsbCB2ZXJpZnkgYW5jZXN0cnksIHNvIHN0ZXAgdXAgYSBsZXZlbFxuXHRcdFx0fSBlbHNlIGlmICggY29tcGlsZWQgKSB7XG5cdFx0XHRcdGNvbnRleHQgPSBjb250ZXh0LnBhcmVudE5vZGU7XG5cdFx0XHR9XG5cblx0XHRcdHNlbGVjdG9yID0gc2VsZWN0b3Iuc2xpY2UoIHRva2Vucy5zaGlmdCgpLnZhbHVlLmxlbmd0aCApO1xuXHRcdH1cblxuXHRcdC8vIEZldGNoIGEgc2VlZCBzZXQgZm9yIHJpZ2h0LXRvLWxlZnQgbWF0Y2hpbmdcblx0XHRpID0gbWF0Y2hFeHByW1wibmVlZHNDb250ZXh0XCJdLnRlc3QoIHNlbGVjdG9yICkgPyAwIDogdG9rZW5zLmxlbmd0aDtcblx0XHR3aGlsZSAoIGktLSApIHtcblx0XHRcdHRva2VuID0gdG9rZW5zW2ldO1xuXG5cdFx0XHQvLyBBYm9ydCBpZiB3ZSBoaXQgYSBjb21iaW5hdG9yXG5cdFx0XHRpZiAoIEV4cHIucmVsYXRpdmVbICh0eXBlID0gdG9rZW4udHlwZSkgXSApIHtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHR9XG5cdFx0XHRpZiAoIChmaW5kID0gRXhwci5maW5kWyB0eXBlIF0pICkge1xuXHRcdFx0XHQvLyBTZWFyY2gsIGV4cGFuZGluZyBjb250ZXh0IGZvciBsZWFkaW5nIHNpYmxpbmcgY29tYmluYXRvcnNcblx0XHRcdFx0aWYgKCAoc2VlZCA9IGZpbmQoXG5cdFx0XHRcdFx0dG9rZW4ubWF0Y2hlc1swXS5yZXBsYWNlKCBydW5lc2NhcGUsIGZ1bmVzY2FwZSApLFxuXHRcdFx0XHRcdHJzaWJsaW5nLnRlc3QoIHRva2Vuc1swXS50eXBlICkgJiYgdGVzdENvbnRleHQoIGNvbnRleHQucGFyZW50Tm9kZSApIHx8IGNvbnRleHRcblx0XHRcdFx0KSkgKSB7XG5cblx0XHRcdFx0XHQvLyBJZiBzZWVkIGlzIGVtcHR5IG9yIG5vIHRva2VucyByZW1haW4sIHdlIGNhbiByZXR1cm4gZWFybHlcblx0XHRcdFx0XHR0b2tlbnMuc3BsaWNlKCBpLCAxICk7XG5cdFx0XHRcdFx0c2VsZWN0b3IgPSBzZWVkLmxlbmd0aCAmJiB0b1NlbGVjdG9yKCB0b2tlbnMgKTtcblx0XHRcdFx0XHRpZiAoICFzZWxlY3RvciApIHtcblx0XHRcdFx0XHRcdHB1c2guYXBwbHkoIHJlc3VsdHMsIHNlZWQgKTtcblx0XHRcdFx0XHRcdHJldHVybiByZXN1bHRzO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0Ly8gQ29tcGlsZSBhbmQgZXhlY3V0ZSBhIGZpbHRlcmluZyBmdW5jdGlvbiBpZiBvbmUgaXMgbm90IHByb3ZpZGVkXG5cdC8vIFByb3ZpZGUgYG1hdGNoYCB0byBhdm9pZCByZXRva2VuaXphdGlvbiBpZiB3ZSBtb2RpZmllZCB0aGUgc2VsZWN0b3IgYWJvdmVcblx0KCBjb21waWxlZCB8fCBjb21waWxlKCBzZWxlY3RvciwgbWF0Y2ggKSApKFxuXHRcdHNlZWQsXG5cdFx0Y29udGV4dCxcblx0XHQhZG9jdW1lbnRJc0hUTUwsXG5cdFx0cmVzdWx0cyxcblx0XHRyc2libGluZy50ZXN0KCBzZWxlY3RvciApICYmIHRlc3RDb250ZXh0KCBjb250ZXh0LnBhcmVudE5vZGUgKSB8fCBjb250ZXh0XG5cdCk7XG5cdHJldHVybiByZXN1bHRzO1xufTtcblxuLy8gT25lLXRpbWUgYXNzaWdubWVudHNcblxuLy8gU29ydCBzdGFiaWxpdHlcbnN1cHBvcnQuc29ydFN0YWJsZSA9IGV4cGFuZG8uc3BsaXQoXCJcIikuc29ydCggc29ydE9yZGVyICkuam9pbihcIlwiKSA9PT0gZXhwYW5kbztcblxuLy8gU3VwcG9ydDogQ2hyb21lIDE0LTM1K1xuLy8gQWx3YXlzIGFzc3VtZSBkdXBsaWNhdGVzIGlmIHRoZXkgYXJlbid0IHBhc3NlZCB0byB0aGUgY29tcGFyaXNvbiBmdW5jdGlvblxuc3VwcG9ydC5kZXRlY3REdXBsaWNhdGVzID0gISFoYXNEdXBsaWNhdGU7XG5cbi8vIEluaXRpYWxpemUgYWdhaW5zdCB0aGUgZGVmYXVsdCBkb2N1bWVudFxuc2V0RG9jdW1lbnQoKTtcblxuLy8gU3VwcG9ydDogV2Via2l0PDUzNy4zMiAtIFNhZmFyaSA2LjAuMy9DaHJvbWUgMjUgKGZpeGVkIGluIENocm9tZSAyNylcbi8vIERldGFjaGVkIG5vZGVzIGNvbmZvdW5kaW5nbHkgZm9sbG93ICplYWNoIG90aGVyKlxuc3VwcG9ydC5zb3J0RGV0YWNoZWQgPSBhc3NlcnQoZnVuY3Rpb24oIGRpdjEgKSB7XG5cdC8vIFNob3VsZCByZXR1cm4gMSwgYnV0IHJldHVybnMgNCAoZm9sbG93aW5nKVxuXHRyZXR1cm4gZGl2MS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiggZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKSApICYgMTtcbn0pO1xuXG4vLyBTdXBwb3J0OiBJRTw4XG4vLyBQcmV2ZW50IGF0dHJpYnV0ZS9wcm9wZXJ0eSBcImludGVycG9sYXRpb25cIlxuLy8gaHR0cDovL21zZG4ubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L21zNTM2NDI5JTI4VlMuODUlMjkuYXNweFxuaWYgKCAhYXNzZXJ0KGZ1bmN0aW9uKCBkaXYgKSB7XG5cdGRpdi5pbm5lckhUTUwgPSBcIjxhIGhyZWY9JyMnPjwvYT5cIjtcblx0cmV0dXJuIGRpdi5maXJzdENoaWxkLmdldEF0dHJpYnV0ZShcImhyZWZcIikgPT09IFwiI1wiIDtcbn0pICkge1xuXHRhZGRIYW5kbGUoIFwidHlwZXxocmVmfGhlaWdodHx3aWR0aFwiLCBmdW5jdGlvbiggZWxlbSwgbmFtZSwgaXNYTUwgKSB7XG5cdFx0aWYgKCAhaXNYTUwgKSB7XG5cdFx0XHRyZXR1cm4gZWxlbS5nZXRBdHRyaWJ1dGUoIG5hbWUsIG5hbWUudG9Mb3dlckNhc2UoKSA9PT0gXCJ0eXBlXCIgPyAxIDogMiApO1xuXHRcdH1cblx0fSk7XG59XG5cbi8vIFN1cHBvcnQ6IElFPDlcbi8vIFVzZSBkZWZhdWx0VmFsdWUgaW4gcGxhY2Ugb2YgZ2V0QXR0cmlidXRlKFwidmFsdWVcIilcbmlmICggIXN1cHBvcnQuYXR0cmlidXRlcyB8fCAhYXNzZXJ0KGZ1bmN0aW9uKCBkaXYgKSB7XG5cdGRpdi5pbm5lckhUTUwgPSBcIjxpbnB1dC8+XCI7XG5cdGRpdi5maXJzdENoaWxkLnNldEF0dHJpYnV0ZSggXCJ2YWx1ZVwiLCBcIlwiICk7XG5cdHJldHVybiBkaXYuZmlyc3RDaGlsZC5nZXRBdHRyaWJ1dGUoIFwidmFsdWVcIiApID09PSBcIlwiO1xufSkgKSB7XG5cdGFkZEhhbmRsZSggXCJ2YWx1ZVwiLCBmdW5jdGlvbiggZWxlbSwgbmFtZSwgaXNYTUwgKSB7XG5cdFx0aWYgKCAhaXNYTUwgJiYgZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSBcImlucHV0XCIgKSB7XG5cdFx0XHRyZXR1cm4gZWxlbS5kZWZhdWx0VmFsdWU7XG5cdFx0fVxuXHR9KTtcbn1cblxuLy8gU3VwcG9ydDogSUU8OVxuLy8gVXNlIGdldEF0dHJpYnV0ZU5vZGUgdG8gZmV0Y2ggYm9vbGVhbnMgd2hlbiBnZXRBdHRyaWJ1dGUgbGllc1xuaWYgKCAhYXNzZXJ0KGZ1bmN0aW9uKCBkaXYgKSB7XG5cdHJldHVybiBkaXYuZ2V0QXR0cmlidXRlKFwiZGlzYWJsZWRcIikgPT0gbnVsbDtcbn0pICkge1xuXHRhZGRIYW5kbGUoIGJvb2xlYW5zLCBmdW5jdGlvbiggZWxlbSwgbmFtZSwgaXNYTUwgKSB7XG5cdFx0dmFyIHZhbDtcblx0XHRpZiAoICFpc1hNTCApIHtcblx0XHRcdHJldHVybiBlbGVtWyBuYW1lIF0gPT09IHRydWUgPyBuYW1lLnRvTG93ZXJDYXNlKCkgOlxuXHRcdFx0XHRcdCh2YWwgPSBlbGVtLmdldEF0dHJpYnV0ZU5vZGUoIG5hbWUgKSkgJiYgdmFsLnNwZWNpZmllZCA/XG5cdFx0XHRcdFx0dmFsLnZhbHVlIDpcblx0XHRcdFx0bnVsbDtcblx0XHR9XG5cdH0pO1xufVxuXG4vLyBFWFBPU0VcbnJldHVybiBTaXp6bGU7XG59KTtcblxuLyplc2xpbnQtZW5hYmxlICovXG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy91dGlsL0Fyci5qc1xuXG4vKipcbiAqIEFyci5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE1IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKipcbiAqIEFycmF5IHV0aWxpdHkgY2xhc3MuXG4gKlxuICogQHByaXZhdGVcbiAqIEBjbGFzcyB0aW55bWNlLnV0aWwuQXJyXG4gKi9cbmRlZmluZShcInRpbnltY2UvdXRpbC9BcnJcIiwgW10sIGZ1bmN0aW9uKCkge1xuXHR2YXIgaXNBcnJheSA9IEFycmF5LmlzQXJyYXkgfHwgZnVuY3Rpb24ob2JqKSB7XG5cdFx0cmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvYmopID09PSBcIltvYmplY3QgQXJyYXldXCI7XG5cdH07XG5cblx0ZnVuY3Rpb24gdG9BcnJheShvYmopIHtcblx0XHR2YXIgYXJyYXkgPSBvYmosIGksIGw7XG5cblx0XHRpZiAoIWlzQXJyYXkob2JqKSkge1xuXHRcdFx0YXJyYXkgPSBbXTtcblx0XHRcdGZvciAoaSA9IDAsIGwgPSBvYmoubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG5cdFx0XHRcdGFycmF5W2ldID0gb2JqW2ldO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiBhcnJheTtcblx0fVxuXG5cdGZ1bmN0aW9uIGVhY2gobywgY2IsIHMpIHtcblx0XHR2YXIgbiwgbDtcblxuXHRcdGlmICghbykge1xuXHRcdFx0cmV0dXJuIDA7XG5cdFx0fVxuXG5cdFx0cyA9IHMgfHwgbztcblxuXHRcdGlmIChvLmxlbmd0aCAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHQvLyBJbmRleGVkIGFycmF5cywgbmVlZGVkIGZvciBTYWZhcmlcblx0XHRcdGZvciAobiA9IDAsIGwgPSBvLmxlbmd0aDsgbiA8IGw7IG4rKykge1xuXHRcdFx0XHRpZiAoY2IuY2FsbChzLCBvW25dLCBuLCBvKSA9PT0gZmFsc2UpIHtcblx0XHRcdFx0XHRyZXR1cm4gMDtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQvLyBIYXNodGFibGVzXG5cdFx0XHRmb3IgKG4gaW4gbykge1xuXHRcdFx0XHRpZiAoby5oYXNPd25Qcm9wZXJ0eShuKSkge1xuXHRcdFx0XHRcdGlmIChjYi5jYWxsKHMsIG9bbl0sIG4sIG8pID09PSBmYWxzZSkge1xuXHRcdFx0XHRcdFx0cmV0dXJuIDA7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV0dXJuIDE7XG5cdH1cblxuXHRmdW5jdGlvbiBtYXAoYXJyYXksIGNhbGxiYWNrKSB7XG5cdFx0dmFyIG91dCA9IFtdO1xuXG5cdFx0ZWFjaChhcnJheSwgZnVuY3Rpb24oaXRlbSwgaW5kZXgpIHtcblx0XHRcdG91dC5wdXNoKGNhbGxiYWNrKGl0ZW0sIGluZGV4LCBhcnJheSkpO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIG91dDtcblx0fVxuXG5cdGZ1bmN0aW9uIGZpbHRlcihhLCBmKSB7XG5cdFx0dmFyIG8gPSBbXTtcblxuXHRcdGVhY2goYSwgZnVuY3Rpb24odiwgaW5kZXgpIHtcblx0XHRcdGlmICghZiB8fCBmKHYsIGluZGV4LCBhKSkge1xuXHRcdFx0XHRvLnB1c2godik7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gbztcblx0fVxuXG5cdGZ1bmN0aW9uIGluZGV4T2YoYSwgdikge1xuXHRcdHZhciBpLCBsO1xuXG5cdFx0aWYgKGEpIHtcblx0XHRcdGZvciAoaSA9IDAsIGwgPSBhLmxlbmd0aDsgaSA8IGw7IGkrKykge1xuXHRcdFx0XHRpZiAoYVtpXSA9PT0gdikge1xuXHRcdFx0XHRcdHJldHVybiBpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV0dXJuIC0xO1xuXHR9XG5cblx0ZnVuY3Rpb24gcmVkdWNlKGNvbGxlY3Rpb24sIGl0ZXJhdGVlLCBhY2N1bXVsYXRvciwgdGhpc0FyZykge1xuXHRcdHZhciBpID0gMDtcblxuXHRcdGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMykge1xuXHRcdFx0YWNjdW11bGF0b3IgPSBjb2xsZWN0aW9uWzBdO1xuXHRcdH1cblxuXHRcdGZvciAoOyBpIDwgY29sbGVjdGlvbi5sZW5ndGg7IGkrKykge1xuXHRcdFx0YWNjdW11bGF0b3IgPSBpdGVyYXRlZS5jYWxsKHRoaXNBcmcsIGFjY3VtdWxhdG9yLCBjb2xsZWN0aW9uW2ldLCBpKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gYWNjdW11bGF0b3I7XG5cdH1cblxuXHRmdW5jdGlvbiBmaW5kSW5kZXgoYXJyYXksIHByZWRpY2F0ZSwgdGhpc0FyZykge1xuXHRcdHZhciBpLCBsO1xuXG5cdFx0Zm9yIChpID0gMCwgbCA9IGFycmF5Lmxlbmd0aDsgaSA8IGw7IGkrKykge1xuXHRcdFx0aWYgKHByZWRpY2F0ZS5jYWxsKHRoaXNBcmcsIGFycmF5W2ldLCBpLCBhcnJheSkpIHtcblx0XHRcdFx0cmV0dXJuIGk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV0dXJuIC0xO1xuXHR9XG5cblx0ZnVuY3Rpb24gZmluZChhcnJheSwgcHJlZGljYXRlLCB0aGlzQXJnKSB7XG5cdFx0dmFyIGlkeCA9IGZpbmRJbmRleChhcnJheSwgcHJlZGljYXRlLCB0aGlzQXJnKTtcblxuXHRcdGlmIChpZHggIT09IC0xKSB7XG5cdFx0XHRyZXR1cm4gYXJyYXlbaWR4XTtcblx0XHR9XG5cblx0XHRyZXR1cm4gdW5kZWZpbmVkO1xuXHR9XG5cblx0ZnVuY3Rpb24gbGFzdChjb2xsZWN0aW9uKSB7XG5cdFx0cmV0dXJuIGNvbGxlY3Rpb25bY29sbGVjdGlvbi5sZW5ndGggLSAxXTtcblx0fVxuXG5cdHJldHVybiB7XG5cdFx0aXNBcnJheTogaXNBcnJheSxcblx0XHR0b0FycmF5OiB0b0FycmF5LFxuXHRcdGVhY2g6IGVhY2gsXG5cdFx0bWFwOiBtYXAsXG5cdFx0ZmlsdGVyOiBmaWx0ZXIsXG5cdFx0aW5kZXhPZjogaW5kZXhPZixcblx0XHRyZWR1Y2U6IHJlZHVjZSxcblx0XHRmaW5kSW5kZXg6IGZpbmRJbmRleCxcblx0XHRmaW5kOiBmaW5kLFxuXHRcdGxhc3Q6IGxhc3Rcblx0fTtcbn0pO1xuXG4vLyBJbmNsdWRlZCBmcm9tOiBqcy90aW55bWNlL2NsYXNzZXMvdXRpbC9Ub29scy5qc1xuXG4vKipcbiAqIFRvb2xzLmpzXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgTEdQTCBMaWNlbnNlLlxuICogQ29weXJpZ2h0IChjKSAxOTk5LTIwMTUgRXBob3ggQ29ycC4gQWxsIHJpZ2h0cyByZXNlcnZlZFxuICpcbiAqIExpY2Vuc2U6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vbGljZW5zZVxuICogQ29udHJpYnV0aW5nOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2NvbnRyaWJ1dGluZ1xuICovXG5cbi8qKlxuICogVGhpcyBjbGFzcyBjb250YWlucyB2YXJpb3VzIHV0bGl0eSBmdW5jdGlvbnMuIFRoZXNlIGFyZSBhbHNvIGV4cG9zZWRcbiAqIGRpcmVjdGx5IG9uIHRoZSB0aW55bWNlIG5hbWVzcGFjZS5cbiAqXG4gKiBAY2xhc3MgdGlueW1jZS51dGlsLlRvb2xzXG4gKi9cbmRlZmluZShcInRpbnltY2UvdXRpbC9Ub29sc1wiLCBbXG5cdFwidGlueW1jZS9FbnZcIixcblx0XCJ0aW55bWNlL3V0aWwvQXJyXCJcbl0sIGZ1bmN0aW9uKEVudiwgQXJyKSB7XG5cdC8qKlxuXHQgKiBSZW1vdmVzIHdoaXRlc3BhY2UgZnJvbSB0aGUgYmVnaW5uaW5nIGFuZCBlbmQgb2YgYSBzdHJpbmcuXG5cdCAqXG5cdCAqIEBtZXRob2QgdHJpbVxuXHQgKiBAcGFyYW0ge1N0cmluZ30gcyBTdHJpbmcgdG8gcmVtb3ZlIHdoaXRlc3BhY2UgZnJvbS5cblx0ICogQHJldHVybiB7U3RyaW5nfSBOZXcgc3RyaW5nIHdpdGggcmVtb3ZlZCB3aGl0ZXNwYWNlLlxuXHQgKi9cblx0dmFyIHdoaXRlU3BhY2VSZWdFeHAgPSAvXlxccyp8XFxzKiQvZztcblxuXHRmdW5jdGlvbiB0cmltKHN0cikge1xuXHRcdHJldHVybiAoc3RyID09PSBudWxsIHx8IHN0ciA9PT0gdW5kZWZpbmVkKSA/ICcnIDogKFwiXCIgKyBzdHIpLnJlcGxhY2Uod2hpdGVTcGFjZVJlZ0V4cCwgJycpO1xuXHR9XG5cblx0LyoqXG5cdCAqIENoZWNrcyBpZiBhIG9iamVjdCBpcyBvZiBhIHNwZWNpZmljIHR5cGUgZm9yIGV4YW1wbGUgYW4gYXJyYXkuXG5cdCAqXG5cdCAqIEBtZXRob2QgaXNcblx0ICogQHBhcmFtIHtPYmplY3R9IG9iaiBPYmplY3QgdG8gY2hlY2sgdHlwZSBvZi5cblx0ICogQHBhcmFtIHtzdHJpbmd9IHR5cGUgT3B0aW9uYWwgdHlwZSB0byBjaGVjayBmb3IuXG5cdCAqIEByZXR1cm4ge0Jvb2xlYW59IHRydWUvZmFsc2UgaWYgdGhlIG9iamVjdCBpcyBvZiB0aGUgc3BlY2lmaWVkIHR5cGUuXG5cdCAqL1xuXHRmdW5jdGlvbiBpcyhvYmosIHR5cGUpIHtcblx0XHRpZiAoIXR5cGUpIHtcblx0XHRcdHJldHVybiBvYmogIT09IHVuZGVmaW5lZDtcblx0XHR9XG5cblx0XHRpZiAodHlwZSA9PSAnYXJyYXknICYmIEFyci5pc0FycmF5KG9iaikpIHtcblx0XHRcdHJldHVybiB0cnVlO1xuXHRcdH1cblxuXHRcdHJldHVybiB0eXBlb2Ygb2JqID09IHR5cGU7XG5cdH1cblxuXHQvKipcblx0ICogTWFrZXMgYSBuYW1lL29iamVjdCBtYXAgb3V0IG9mIGFuIGFycmF5IHdpdGggbmFtZXMuXG5cdCAqXG5cdCAqIEBtZXRob2QgbWFrZU1hcFxuXHQgKiBAcGFyYW0ge0FycmF5L1N0cmluZ30gaXRlbXMgSXRlbXMgdG8gbWFrZSBtYXAgb3V0IG9mLlxuXHQgKiBAcGFyYW0ge1N0cmluZ30gZGVsaW0gT3B0aW9uYWwgZGVsaW1pdGVyIHRvIHNwbGl0IHN0cmluZyBieS5cblx0ICogQHBhcmFtIHtPYmplY3R9IG1hcCBPcHRpb25hbCBtYXAgdG8gYWRkIGl0ZW1zIHRvLlxuXHQgKiBAcmV0dXJuIHtPYmplY3R9IE5hbWUvdmFsdWUgbWFwIG9mIGl0ZW1zLlxuXHQgKi9cblx0ZnVuY3Rpb24gbWFrZU1hcChpdGVtcywgZGVsaW0sIG1hcCkge1xuXHRcdHZhciBpO1xuXG5cdFx0aXRlbXMgPSBpdGVtcyB8fCBbXTtcblx0XHRkZWxpbSA9IGRlbGltIHx8ICcsJztcblxuXHRcdGlmICh0eXBlb2YgaXRlbXMgPT0gXCJzdHJpbmdcIikge1xuXHRcdFx0aXRlbXMgPSBpdGVtcy5zcGxpdChkZWxpbSk7XG5cdFx0fVxuXG5cdFx0bWFwID0gbWFwIHx8IHt9O1xuXG5cdFx0aSA9IGl0ZW1zLmxlbmd0aDtcblx0XHR3aGlsZSAoaS0tKSB7XG5cdFx0XHRtYXBbaXRlbXNbaV1dID0ge307XG5cdFx0fVxuXG5cdFx0cmV0dXJuIG1hcDtcblx0fVxuXG5cdC8qKlxuXHQgKiBKYXZhU2NyaXB0IGRvZXMgbm90IHByb3RlY3QgaGFzT3duUHJvcGVydHkgbWV0aG9kLCBzbyBpdCBpcyBwb3NzaWJsZSB0byBvdmVyd3JpdGUgaXQuIFRoaXMgaXNcblx0ICogb2JqZWN0IGluZGVwZW5kZW50IHZlcnNpb24uXG5cdCAqXG5cdCAqIEBwYXJhbSB7T2JqZWN0fSBvYmpcblx0ICogQHBhcmFtIHtTdHJpbmd9IHByb3Bcblx0ICogQHJldHVybnMge0Jvb2xlYW59XG5cdCAqL1xuXHRmdW5jdGlvbiBoYXNPd25Qcm9wZXJ0eShvYmosIHByb3ApIHtcblx0XHRyZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCk7XG5cdH1cblxuXHQvKipcblx0ICogQ3JlYXRlcyBhIGNsYXNzLCBzdWJjbGFzcyBvciBzdGF0aWMgc2luZ2xldG9uLlxuXHQgKiBNb3JlIGRldGFpbHMgb24gdGhpcyBtZXRob2QgY2FuIGJlIGZvdW5kIGluIHRoZSBXaWtpLlxuXHQgKlxuXHQgKiBAbWV0aG9kIGNyZWF0ZVxuXHQgKiBAcGFyYW0ge1N0cmluZ30gcyBDbGFzcyBuYW1lLCBpbmhlcml0YW5jZSBhbmQgcHJlZml4LlxuXHQgKiBAcGFyYW0ge09iamVjdH0gcCBDb2xsZWN0aW9uIG9mIG1ldGhvZHMgdG8gYWRkIHRvIHRoZSBjbGFzcy5cblx0ICogQHBhcmFtIHtPYmplY3R9IHJvb3QgT3B0aW9uYWwgcm9vdCBvYmplY3QgZGVmYXVsdHMgdG8gdGhlIGdsb2JhbCB3aW5kb3cgb2JqZWN0LlxuXHQgKiBAZXhhbXBsZVxuXHQgKiAvLyBDcmVhdGVzIGEgYmFzaWMgY2xhc3Ncblx0ICogdGlueW1jZS5jcmVhdGUoJ3RpbnltY2Uuc29tZXBhY2thZ2UuU29tZUNsYXNzJywge1xuXHQgKiAgICAgU29tZUNsYXNzOiBmdW5jdGlvbigpIHtcblx0ICogICAgICAgICAvLyBDbGFzcyBjb25zdHJ1Y3RvclxuXHQgKiAgICAgfSxcblx0ICpcblx0ICogICAgIG1ldGhvZDogZnVuY3Rpb24oKSB7XG5cdCAqICAgICAgICAgLy8gU29tZSBtZXRob2Rcblx0ICogICAgIH1cblx0ICogfSk7XG5cdCAqXG5cdCAqIC8vIENyZWF0ZXMgYSBiYXNpYyBzdWJjbGFzcyBjbGFzc1xuXHQgKiB0aW55bWNlLmNyZWF0ZSgndGlueW1jZS5zb21lcGFja2FnZS5Tb21lU3ViQ2xhc3M6dGlueW1jZS5zb21lcGFja2FnZS5Tb21lQ2xhc3MnLCB7XG5cdCAqICAgICBTb21lU3ViQ2xhc3M6IGZ1bmN0aW9uKCkge1xuXHQgKiAgICAgICAgIC8vIENsYXNzIGNvbnN0cnVjdG9yXG5cdCAqICAgICAgICAgdGhpcy5wYXJlbnQoKTsgLy8gQ2FsbCBwYXJlbnQgY29uc3RydWN0b3Jcblx0ICogICAgIH0sXG5cdCAqXG5cdCAqICAgICBtZXRob2Q6IGZ1bmN0aW9uKCkge1xuXHQgKiAgICAgICAgIC8vIFNvbWUgbWV0aG9kXG5cdCAqICAgICAgICAgdGhpcy5wYXJlbnQoKTsgLy8gQ2FsbCBwYXJlbnQgbWV0aG9kXG5cdCAqICAgICB9LFxuXHQgKlxuXHQgKiAgICAgJ3N0YXRpYyc6IHtcblx0ICogICAgICAgICBzdGF0aWNNZXRob2Q6IGZ1bmN0aW9uKCkge1xuXHQgKiAgICAgICAgICAgICAvLyBTdGF0aWMgbWV0aG9kXG5cdCAqICAgICAgICAgfVxuXHQgKiAgICAgfVxuXHQgKiB9KTtcblx0ICpcblx0ICogLy8gQ3JlYXRlcyBhIHNpbmdsZXRvbi9zdGF0aWMgY2xhc3Ncblx0ICogdGlueW1jZS5jcmVhdGUoJ3N0YXRpYyB0aW55bWNlLnNvbWVwYWNrYWdlLlNvbWVTaW5nbGV0b25DbGFzcycsIHtcblx0ICogICAgIG1ldGhvZDogZnVuY3Rpb24oKSB7XG5cdCAqICAgICAgICAgLy8gU29tZSBtZXRob2Rcblx0ICogICAgIH1cblx0ICogfSk7XG5cdCAqL1xuXHRmdW5jdGlvbiBjcmVhdGUocywgcCwgcm9vdCkge1xuXHRcdHZhciBzZWxmID0gdGhpcywgc3AsIG5zLCBjbiwgc2NuLCBjLCBkZSA9IDA7XG5cblx0XHQvLyBQYXJzZSA6IDxwcmVmaXg+IDxjbGFzcz46PHN1cGVyIGNsYXNzPlxuXHRcdHMgPSAvXigoc3RhdGljKSApPyhbXFx3Ll0rKSg6KFtcXHcuXSspKT8vLmV4ZWMocyk7XG5cdFx0Y24gPSBzWzNdLm1hdGNoKC8oXnxcXC4pKFxcdyspJC9pKVsyXTsgLy8gQ2xhc3MgbmFtZVxuXG5cdFx0Ly8gQ3JlYXRlIG5hbWVzcGFjZSBmb3IgbmV3IGNsYXNzXG5cdFx0bnMgPSBzZWxmLmNyZWF0ZU5TKHNbM10ucmVwbGFjZSgvXFwuXFx3KyQvLCAnJyksIHJvb3QpO1xuXG5cdFx0Ly8gQ2xhc3MgYWxyZWFkeSBleGlzdHNcblx0XHRpZiAobnNbY25dKSB7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXG5cdFx0Ly8gTWFrZSBwdXJlIHN0YXRpYyBjbGFzc1xuXHRcdGlmIChzWzJdID09ICdzdGF0aWMnKSB7XG5cdFx0XHRuc1tjbl0gPSBwO1xuXG5cdFx0XHRpZiAodGhpcy5vbkNyZWF0ZSkge1xuXHRcdFx0XHR0aGlzLm9uQ3JlYXRlKHNbMl0sIHNbM10sIG5zW2NuXSk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHQvLyBDcmVhdGUgZGVmYXVsdCBjb25zdHJ1Y3RvclxuXHRcdGlmICghcFtjbl0pIHtcblx0XHRcdHBbY25dID0gZnVuY3Rpb24oKSB7fTtcblx0XHRcdGRlID0gMTtcblx0XHR9XG5cblx0XHQvLyBBZGQgY29uc3RydWN0b3IgYW5kIG1ldGhvZHNcblx0XHRuc1tjbl0gPSBwW2NuXTtcblx0XHRzZWxmLmV4dGVuZChuc1tjbl0ucHJvdG90eXBlLCBwKTtcblxuXHRcdC8vIEV4dGVuZFxuXHRcdGlmIChzWzVdKSB7XG5cdFx0XHRzcCA9IHNlbGYucmVzb2x2ZShzWzVdKS5wcm90b3R5cGU7XG5cdFx0XHRzY24gPSBzWzVdLm1hdGNoKC9cXC4oXFx3KykkL2kpWzFdOyAvLyBDbGFzcyBuYW1lXG5cblx0XHRcdC8vIEV4dGVuZCBjb25zdHJ1Y3RvclxuXHRcdFx0YyA9IG5zW2NuXTtcblx0XHRcdGlmIChkZSkge1xuXHRcdFx0XHQvLyBBZGQgcGFzc3Rocm91Z2ggY29uc3RydWN0b3Jcblx0XHRcdFx0bnNbY25dID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHNwW3Njbl0uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcblx0XHRcdFx0fTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdC8vIEFkZCBpbmhlcml0IGNvbnN0cnVjdG9yXG5cdFx0XHRcdG5zW2NuXSA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdHRoaXMucGFyZW50ID0gc3Bbc2NuXTtcblx0XHRcdFx0XHRyZXR1cm4gYy5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuXHRcdFx0XHR9O1xuXHRcdFx0fVxuXHRcdFx0bnNbY25dLnByb3RvdHlwZVtjbl0gPSBuc1tjbl07XG5cblx0XHRcdC8vIEFkZCBzdXBlciBtZXRob2RzXG5cdFx0XHRzZWxmLmVhY2goc3AsIGZ1bmN0aW9uKGYsIG4pIHtcblx0XHRcdFx0bnNbY25dLnByb3RvdHlwZVtuXSA9IHNwW25dO1xuXHRcdFx0fSk7XG5cblx0XHRcdC8vIEFkZCBvdmVycmlkZGVuIG1ldGhvZHNcblx0XHRcdHNlbGYuZWFjaChwLCBmdW5jdGlvbihmLCBuKSB7XG5cdFx0XHRcdC8vIEV4dGVuZCBtZXRob2RzIGlmIG5lZWRlZFxuXHRcdFx0XHRpZiAoc3Bbbl0pIHtcblx0XHRcdFx0XHRuc1tjbl0ucHJvdG90eXBlW25dID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0XHR0aGlzLnBhcmVudCA9IHNwW25dO1xuXHRcdFx0XHRcdFx0cmV0dXJuIGYuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcblx0XHRcdFx0XHR9O1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGlmIChuICE9IGNuKSB7XG5cdFx0XHRcdFx0XHRuc1tjbl0ucHJvdG90eXBlW25dID0gZjtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdC8vIEFkZCBzdGF0aWMgbWV0aG9kc1xuXHRcdC8qanNoaW50IHN1Yjp0cnVlKi9cblx0XHQvKmVzbGludCBkb3Qtbm90YXRpb246MCovXG5cdFx0c2VsZi5lYWNoKHBbJ3N0YXRpYyddLCBmdW5jdGlvbihmLCBuKSB7XG5cdFx0XHRuc1tjbl1bbl0gPSBmO1xuXHRcdH0pO1xuXHR9XG5cblx0ZnVuY3Rpb24gZXh0ZW5kKG9iaiwgZXh0KSB7XG5cdFx0dmFyIGksIGwsIG5hbWUsIGFyZ3MgPSBhcmd1bWVudHMsIHZhbHVlO1xuXG5cdFx0Zm9yIChpID0gMSwgbCA9IGFyZ3MubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG5cdFx0XHRleHQgPSBhcmdzW2ldO1xuXHRcdFx0Zm9yIChuYW1lIGluIGV4dCkge1xuXHRcdFx0XHRpZiAoZXh0Lmhhc093blByb3BlcnR5KG5hbWUpKSB7XG5cdFx0XHRcdFx0dmFsdWUgPSBleHRbbmFtZV07XG5cblx0XHRcdFx0XHRpZiAodmFsdWUgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0XHRcdFx0b2JqW25hbWVdID0gdmFsdWU7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV0dXJuIG9iajtcblx0fVxuXG5cdC8qKlxuXHQgKiBFeGVjdXRlZCB0aGUgc3BlY2lmaWVkIGZ1bmN0aW9uIGZvciBlYWNoIGl0ZW0gaW4gYSBvYmplY3QgdHJlZS5cblx0ICpcblx0ICogQG1ldGhvZCB3YWxrXG5cdCAqIEBwYXJhbSB7T2JqZWN0fSBvIE9iamVjdCB0cmVlIHRvIHdhbGsgdGhvdWdoLlxuXHQgKiBAcGFyYW0ge2Z1bmN0aW9ufSBmIEZ1bmN0aW9uIHRvIGNhbGwgZm9yIGVhY2ggaXRlbS5cblx0ICogQHBhcmFtIHtTdHJpbmd9IG4gT3B0aW9uYWwgbmFtZSBvZiBjb2xsZWN0aW9uIGluc2lkZSB0aGUgb2JqZWN0cyB0byB3YWxrIGZvciBleGFtcGxlIGNoaWxkTm9kZXMuXG5cdCAqIEBwYXJhbSB7U3RyaW5nfSBzIE9wdGlvbmFsIHNjb3BlIHRvIGV4ZWN1dGUgdGhlIGZ1bmN0aW9uIGluLlxuXHQgKi9cblx0ZnVuY3Rpb24gd2FsayhvLCBmLCBuLCBzKSB7XG5cdFx0cyA9IHMgfHwgdGhpcztcblxuXHRcdGlmIChvKSB7XG5cdFx0XHRpZiAobikge1xuXHRcdFx0XHRvID0gb1tuXTtcblx0XHRcdH1cblxuXHRcdFx0QXJyLmVhY2gobywgZnVuY3Rpb24obywgaSkge1xuXHRcdFx0XHRpZiAoZi5jYWxsKHMsIG8sIGksIG4pID09PSBmYWxzZSkge1xuXHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHdhbGsobywgZiwgbiwgcyk7XG5cdFx0XHR9KTtcblx0XHR9XG5cdH1cblxuXHQvKipcblx0ICogQ3JlYXRlcyBhIG5hbWVzcGFjZSBvbiBhIHNwZWNpZmljIG9iamVjdC5cblx0ICpcblx0ICogQG1ldGhvZCBjcmVhdGVOU1xuXHQgKiBAcGFyYW0ge1N0cmluZ30gbiBOYW1lc3BhY2UgdG8gY3JlYXRlIGZvciBleGFtcGxlIGEuYi5jLmQuXG5cdCAqIEBwYXJhbSB7T2JqZWN0fSBvIE9wdGlvbmFsIG9iamVjdCB0byBhZGQgbmFtZXNwYWNlIHRvLCBkZWZhdWx0cyB0byB3aW5kb3cuXG5cdCAqIEByZXR1cm4ge09iamVjdH0gTmV3IG5hbWVzcGFjZSBvYmplY3QgdGhlIGxhc3QgaXRlbSBpbiBwYXRoLlxuXHQgKiBAZXhhbXBsZVxuXHQgKiAvLyBDcmVhdGUgc29tZSBuYW1lc3BhY2Vcblx0ICogdGlueW1jZS5jcmVhdGVOUygndGlueW1jZS5zb21lcGFja2FnZS5zdWJwYWNrYWdlJyk7XG5cdCAqXG5cdCAqIC8vIEFkZCBhIHNpbmdsZXRvblxuXHQgKiB2YXIgdGlueW1jZS5zb21lcGFja2FnZS5zdWJwYWNrYWdlLlNvbWVTaW5nbGV0b24gPSB7XG5cdCAqICAgICBtZXRob2Q6IGZ1bmN0aW9uKCkge1xuXHQgKiAgICAgICAgIC8vIFNvbWUgbWV0aG9kXG5cdCAqICAgICB9XG5cdCAqIH07XG5cdCAqL1xuXHRmdW5jdGlvbiBjcmVhdGVOUyhuLCBvKSB7XG5cdFx0dmFyIGksIHY7XG5cblx0XHRvID0gbyB8fCB3aW5kb3c7XG5cblx0XHRuID0gbi5zcGxpdCgnLicpO1xuXHRcdGZvciAoaSA9IDA7IGkgPCBuLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHR2ID0gbltpXTtcblxuXHRcdFx0aWYgKCFvW3ZdKSB7XG5cdFx0XHRcdG9bdl0gPSB7fTtcblx0XHRcdH1cblxuXHRcdFx0byA9IG9bdl07XG5cdFx0fVxuXG5cdFx0cmV0dXJuIG87XG5cdH1cblxuXHQvKipcblx0ICogUmVzb2x2ZXMgYSBzdHJpbmcgYW5kIHJldHVybnMgdGhlIG9iamVjdCBmcm9tIGEgc3BlY2lmaWMgc3RydWN0dXJlLlxuXHQgKlxuXHQgKiBAbWV0aG9kIHJlc29sdmVcblx0ICogQHBhcmFtIHtTdHJpbmd9IG4gUGF0aCB0byByZXNvbHZlIGZvciBleGFtcGxlIGEuYi5jLmQuXG5cdCAqIEBwYXJhbSB7T2JqZWN0fSBvIE9wdGlvbmFsIG9iamVjdCB0byBzZWFyY2ggdGhvdWdoLCBkZWZhdWx0cyB0byB3aW5kb3cuXG5cdCAqIEByZXR1cm4ge09iamVjdH0gTGFzdCBvYmplY3QgaW4gcGF0aCBvciBudWxsIGlmIGl0IGNvdWxkbid0IGJlIHJlc29sdmVkLlxuXHQgKiBAZXhhbXBsZVxuXHQgKiAvLyBSZXNvbHZlIGEgcGF0aCBpbnRvIGFuIG9iamVjdCByZWZlcmVuY2Vcblx0ICogdmFyIG9iaiA9IHRpbnltY2UucmVzb2x2ZSgnYS5iLmMuZCcpO1xuXHQgKi9cblx0ZnVuY3Rpb24gcmVzb2x2ZShuLCBvKSB7XG5cdFx0dmFyIGksIGw7XG5cblx0XHRvID0gbyB8fCB3aW5kb3c7XG5cblx0XHRuID0gbi5zcGxpdCgnLicpO1xuXHRcdGZvciAoaSA9IDAsIGwgPSBuLmxlbmd0aDsgaSA8IGw7IGkrKykge1xuXHRcdFx0byA9IG9bbltpXV07XG5cblx0XHRcdGlmICghbykge1xuXHRcdFx0XHRicmVhaztcblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gbztcblx0fVxuXG5cdC8qKlxuXHQgKiBTcGxpdHMgYSBzdHJpbmcgYnV0IHJlbW92ZXMgdGhlIHdoaXRlc3BhY2UgYmVmb3JlIGFuZCBhZnRlciBlYWNoIHZhbHVlLlxuXHQgKlxuXHQgKiBAbWV0aG9kIGV4cGxvZGVcblx0ICogQHBhcmFtIHtzdHJpbmd9IHMgU3RyaW5nIHRvIHNwbGl0LlxuXHQgKiBAcGFyYW0ge3N0cmluZ30gZCBEZWxpbWl0ZXIgdG8gc3BsaXQgYnkuXG5cdCAqIEBleGFtcGxlXG5cdCAqIC8vIFNwbGl0IGEgc3RyaW5nIGludG8gYW4gYXJyYXkgd2l0aCBhLGIsY1xuXHQgKiB2YXIgYXJyID0gdGlueW1jZS5leHBsb2RlKCdhLCBiLCAgIGMnKTtcblx0ICovXG5cdGZ1bmN0aW9uIGV4cGxvZGUocywgZCkge1xuXHRcdGlmICghcyB8fCBpcyhzLCAnYXJyYXknKSkge1xuXHRcdFx0cmV0dXJuIHM7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIEFyci5tYXAocy5zcGxpdChkIHx8ICcsJyksIHRyaW0pO1xuXHR9XG5cblx0ZnVuY3Rpb24gX2FkZENhY2hlU3VmZml4KHVybCkge1xuXHRcdHZhciBjYWNoZVN1ZmZpeCA9IEVudi5jYWNoZVN1ZmZpeDtcblxuXHRcdGlmIChjYWNoZVN1ZmZpeCkge1xuXHRcdFx0dXJsICs9ICh1cmwuaW5kZXhPZignPycpID09PSAtMSA/ICc/JyA6ICcmJykgKyBjYWNoZVN1ZmZpeDtcblx0XHR9XG5cblx0XHRyZXR1cm4gdXJsO1xuXHR9XG5cblx0cmV0dXJuIHtcblx0XHR0cmltOiB0cmltLFxuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyB0cnVlL2ZhbHNlIGlmIHRoZSBvYmplY3QgaXMgYW4gYXJyYXkgb3Igbm90LlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBpc0FycmF5XG5cdFx0ICogQHBhcmFtIHtPYmplY3R9IG9iaiBPYmplY3QgdG8gY2hlY2suXG5cdFx0ICogQHJldHVybiB7Ym9vbGVhbn0gdHJ1ZS9mYWxzZSBzdGF0ZSBpZiB0aGUgb2JqZWN0IGlzIGFuIGFycmF5IG9yIG5vdC5cblx0XHQgKi9cblx0XHRpc0FycmF5OiBBcnIuaXNBcnJheSxcblxuXHRcdGlzOiBpcyxcblxuXHRcdC8qKlxuXHRcdCAqIENvbnZlcnRzIHRoZSBzcGVjaWZpZWQgb2JqZWN0IGludG8gYSByZWFsIEphdmFTY3JpcHQgYXJyYXkuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHRvQXJyYXlcblx0XHQgKiBAcGFyYW0ge09iamVjdH0gb2JqIE9iamVjdCB0byBjb252ZXJ0IGludG8gYXJyYXkuXG5cdFx0ICogQHJldHVybiB7QXJyYXl9IEFycmF5IG9iamVjdCBiYXNlZCBpbiBpbnB1dC5cblx0XHQgKi9cblx0XHR0b0FycmF5OiBBcnIudG9BcnJheSxcblx0XHRtYWtlTWFwOiBtYWtlTWFwLFxuXG5cdFx0LyoqXG5cdFx0ICogUGVyZm9ybXMgYW4gaXRlcmF0aW9uIG9mIGFsbCBpdGVtcyBpbiBhIGNvbGxlY3Rpb24gc3VjaCBhcyBhbiBvYmplY3Qgb3IgYXJyYXkuIFRoaXMgbWV0aG9kIHdpbGwgZXhlY3VyZSB0aGVcblx0XHQgKiBjYWxsYmFjayBmdW5jdGlvbiBmb3IgZWFjaCBpdGVtIGluIHRoZSBjb2xsZWN0aW9uLCBpZiB0aGUgY2FsbGJhY2sgcmV0dXJucyBmYWxzZSB0aGUgaXRlcmF0aW9uIHdpbGwgdGVybWluYXRlLlxuXHRcdCAqIFRoZSBjYWxsYmFjayBoYXMgdGhlIGZvbGxvd2luZyBmb3JtYXQ6IGNiKHZhbHVlLCBrZXlfb3JfaW5kZXgpLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBlYWNoXG5cdFx0ICogQHBhcmFtIHtPYmplY3R9IG8gQ29sbGVjdGlvbiB0byBpdGVyYXRlLlxuXHRcdCAqIEBwYXJhbSB7ZnVuY3Rpb259IGNiIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGV4ZWN1dGUgZm9yIGVhY2ggaXRlbS5cblx0XHQgKiBAcGFyYW0ge09iamVjdH0gcyBPcHRpb25hbCBzY29wZSB0byBleGVjdXRlIHRoZSBjYWxsYmFjayBpbi5cblx0XHQgKiBAZXhhbXBsZVxuXHRcdCAqIC8vIEl0ZXJhdGUgYW4gYXJyYXlcblx0XHQgKiB0aW55bWNlLmVhY2goWzEsMiwzXSwgZnVuY3Rpb24odiwgaSkge1xuXHRcdCAqICAgICBjb25zb2xlLmRlYnVnKFwiVmFsdWU6IFwiICsgdiArIFwiLCBJbmRleDogXCIgKyBpKTtcblx0XHQgKiB9KTtcblx0XHQgKlxuXHRcdCAqIC8vIEl0ZXJhdGUgYW4gb2JqZWN0XG5cdFx0ICogdGlueW1jZS5lYWNoKHthOiAxLCBiOiAyLCBjOiAzXSwgZnVuY3Rpb24odiwgaykge1xuXHRcdCAqICAgICBjb25zb2xlLmRlYnVnKFwiVmFsdWU6IFwiICsgdiArIFwiLCBLZXk6IFwiICsgayk7XG5cdFx0ICogfSk7XG5cdFx0ICovXG5cdFx0ZWFjaDogQXJyLmVhY2gsXG5cblx0XHQvKipcblx0XHQgKiBDcmVhdGVzIGEgbmV3IGFycmF5IGJ5IHRoZSByZXR1cm4gdmFsdWUgb2YgZWFjaCBpdGVyYXRpb24gZnVuY3Rpb24gY2FsbC4gVGhpcyBlbmFibGVzIHlvdSB0byBjb252ZXJ0XG5cdFx0ICogb25lIGFycmF5IGxpc3QgaW50byBhbm90aGVyLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBtYXBcblx0XHQgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBBcnJheSBvZiBpdGVtcyB0byBpdGVyYXRlLlxuXHRcdCAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrIEZ1bmN0aW9uIHRvIGNhbGwgZm9yIGVhY2ggaXRlbS4gSXQncyByZXR1cm4gdmFsdWUgd2lsbCBiZSB0aGUgbmV3IHZhbHVlLlxuXHRcdCAqIEByZXR1cm4ge0FycmF5fSBBcnJheSB3aXRoIG5ldyB2YWx1ZXMgYmFzZWQgb24gZnVuY3Rpb24gcmV0dXJuIHZhbHVlcy5cblx0XHQgKi9cblx0XHRtYXA6IEFyci5tYXAsXG5cblx0XHQvKipcblx0XHQgKiBGaWx0ZXJzIG91dCBpdGVtcyBmcm9tIHRoZSBpbnB1dCBhcnJheSBieSBjYWxsaW5nIHRoZSBzcGVjaWZpZWQgZnVuY3Rpb24gZm9yIGVhY2ggaXRlbS5cblx0XHQgKiBJZiB0aGUgZnVuY3Rpb24gcmV0dXJucyBmYWxzZSB0aGUgaXRlbSB3aWxsIGJlIGV4Y2x1ZGVkIGlmIGl0IHJldHVybnMgdHJ1ZSBpdCB3aWxsIGJlIGluY2x1ZGVkLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBncmVwXG5cdFx0ICogQHBhcmFtIHtBcnJheX0gYSBBcnJheSBvZiBpdGVtcyB0byBsb29wIHRob3VnaC5cblx0XHQgKiBAcGFyYW0ge2Z1bmN0aW9ufSBmIEZ1bmN0aW9uIHRvIGNhbGwgZm9yIGVhY2ggaXRlbS4gSW5jbHVkZS9leGNsdWRlIGRlcGVuZHMgb24gaXQncyByZXR1cm4gdmFsdWUuXG5cdFx0ICogQHJldHVybiB7QXJyYXl9IE5ldyBhcnJheSB3aXRoIHZhbHVlcyBpbXBvcnRlZCBhbmQgZmlsdGVyZWQgYmFzZWQgaW4gaW5wdXQuXG5cdFx0ICogQGV4YW1wbGVcblx0XHQgKiAvLyBGaWx0ZXIgb3V0IHNvbWUgaXRlbXMsIHRoaXMgd2lsbCByZXR1cm4gYW4gYXJyYXkgd2l0aCA0IGFuZCA1XG5cdFx0ICogdmFyIGl0ZW1zID0gdGlueW1jZS5ncmVwKFsxLDIsMyw0LDVdLCBmdW5jdGlvbih2KSB7cmV0dXJuIHYgPiAzO30pO1xuXHRcdCAqL1xuXHRcdGdyZXA6IEFyci5maWx0ZXIsXG5cblx0XHQvKipcblx0XHQgKiBSZXR1cm5zIGFuIGluZGV4IG9mIHRoZSBpdGVtIG9yIC0xIGlmIGl0ZW0gaXMgbm90IHByZXNlbnQgaW4gdGhlIGFycmF5LlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBpbkFycmF5XG5cdFx0ICogQHBhcmFtIHthbnl9IGl0ZW0gSXRlbSB0byBzZWFyY2ggZm9yLlxuXHRcdCAqIEBwYXJhbSB7QXJyYXl9IGFyciBBcnJheSB0byBzZWFyY2ggaW4uXG5cdFx0ICogQHJldHVybiB7TnVtYmVyfSBpbmRleCBvZiB0aGUgaXRlbSBvciAtMSBpZiBpdGVtIHdhcyBub3QgZm91bmQuXG5cdFx0ICovXG5cdFx0aW5BcnJheTogQXJyLmluZGV4T2YsXG5cblx0XHRoYXNPd246IGhhc093blByb3BlcnR5LFxuXG5cdFx0ZXh0ZW5kOiBleHRlbmQsXG5cdFx0Y3JlYXRlOiBjcmVhdGUsXG5cdFx0d2Fsazogd2Fsayxcblx0XHRjcmVhdGVOUzogY3JlYXRlTlMsXG5cdFx0cmVzb2x2ZTogcmVzb2x2ZSxcblx0XHRleHBsb2RlOiBleHBsb2RlLFxuXHRcdF9hZGRDYWNoZVN1ZmZpeDogX2FkZENhY2hlU3VmZml4XG5cdH07XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL2RvbS9Eb21RdWVyeS5qc1xuXG4vKipcbiAqIERvbVF1ZXJ5LmpzXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgTEdQTCBMaWNlbnNlLlxuICogQ29weXJpZ2h0IChjKSAxOTk5LTIwMTUgRXBob3ggQ29ycC4gQWxsIHJpZ2h0cyByZXNlcnZlZFxuICpcbiAqIExpY2Vuc2U6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vbGljZW5zZVxuICogQ29udHJpYnV0aW5nOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2NvbnRyaWJ1dGluZ1xuICovXG5cbi8qKlxuICogVGhpcyBjbGFzcyBtaW1pY3MgbW9zdCBvZiB0aGUgalF1ZXJ5IEFQSTpcbiAqXG4gKiBUaGlzIGlzIHdoYXRzIGN1cnJlbnRseSBpbXBsZW1lbnRlZDpcbiAqIC0gVXRpbGl0eSBmdW5jdGlvbnNcbiAqIC0gRE9NIHRyYXZlcnNpYWxcbiAqIC0gRE9NIG1hbmlwdWxhdGlvblxuICogLSBFdmVudCBiaW5kaW5nXG4gKlxuICogVGhpcyBpcyBub3QgY3VycmVudGx5IGltcGxlbWVudGVkOlxuICogLSBEaW1lbnNpb25cbiAqIC0gQWpheFxuICogLSBBbmltYXRpb25cbiAqIC0gQWR2YW5jZWQgY2hhaW5pbmdcbiAqXG4gKiBAZXhhbXBsZVxuICogdmFyICQgPSB0aW55bWNlLmRvbS5Eb21RdWVyeTtcbiAqICQoJ3AnKS5hdHRyKCdhdHRyJywgJ3ZhbHVlJykuYWRkQ2xhc3MoJ2NsYXNzJyk7XG4gKlxuICogQGNsYXNzIHRpbnltY2UuZG9tLkRvbVF1ZXJ5XG4gKi9cbmRlZmluZShcInRpbnltY2UvZG9tL0RvbVF1ZXJ5XCIsIFtcblx0XCJ0aW55bWNlL2RvbS9FdmVudFV0aWxzXCIsXG5cdFwidGlueW1jZS9kb20vU2l6emxlXCIsXG5cdFwidGlueW1jZS91dGlsL1Rvb2xzXCIsXG5cdFwidGlueW1jZS9FbnZcIlxuXSwgZnVuY3Rpb24oRXZlbnRVdGlscywgU2l6emxlLCBUb29scywgRW52KSB7XG5cdHZhciBkb2MgPSBkb2N1bWVudCwgcHVzaCA9IEFycmF5LnByb3RvdHlwZS5wdXNoLCBzbGljZSA9IEFycmF5LnByb3RvdHlwZS5zbGljZTtcblx0dmFyIHJxdWlja0V4cHIgPSAvXig/OlteIzxdKig8W1xcd1xcV10rPilbXj5dKiR8IyhbXFx3XFwtXSopJCkvO1xuXHR2YXIgRXZlbnQgPSBFdmVudFV0aWxzLkV2ZW50LCB1bmRlZjtcblx0dmFyIHNraXBVbmlxdWVzID0gVG9vbHMubWFrZU1hcCgnY2hpbGRyZW4sY29udGVudHMsbmV4dCxwcmV2Jyk7XG5cblx0ZnVuY3Rpb24gaXNEZWZpbmVkKG9iaikge1xuXHRcdHJldHVybiB0eXBlb2Ygb2JqICE9PSAndW5kZWZpbmVkJztcblx0fVxuXG5cdGZ1bmN0aW9uIGlzU3RyaW5nKG9iaikge1xuXHRcdHJldHVybiB0eXBlb2Ygb2JqID09PSAnc3RyaW5nJztcblx0fVxuXG5cdGZ1bmN0aW9uIGlzV2luZG93KG9iaikge1xuXHRcdHJldHVybiBvYmogJiYgb2JqID09IG9iai53aW5kb3c7XG5cdH1cblxuXHRmdW5jdGlvbiBjcmVhdGVGcmFnbWVudChodG1sLCBmcmFnRG9jKSB7XG5cdFx0dmFyIGZyYWcsIG5vZGUsIGNvbnRhaW5lcjtcblxuXHRcdGZyYWdEb2MgPSBmcmFnRG9jIHx8IGRvYztcblx0XHRjb250YWluZXIgPSBmcmFnRG9jLmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuXHRcdGZyYWcgPSBmcmFnRG9jLmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcblx0XHRjb250YWluZXIuaW5uZXJIVE1MID0gaHRtbDtcblxuXHRcdHdoaWxlICgobm9kZSA9IGNvbnRhaW5lci5maXJzdENoaWxkKSkge1xuXHRcdFx0ZnJhZy5hcHBlbmRDaGlsZChub2RlKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gZnJhZztcblx0fVxuXG5cdGZ1bmN0aW9uIGRvbU1hbmlwdWxhdGUodGFyZ2V0Tm9kZXMsIHNvdXJjZUl0ZW0sIGNhbGxiYWNrLCByZXZlcnNlKSB7XG5cdFx0dmFyIGk7XG5cblx0XHRpZiAoaXNTdHJpbmcoc291cmNlSXRlbSkpIHtcblx0XHRcdHNvdXJjZUl0ZW0gPSBjcmVhdGVGcmFnbWVudChzb3VyY2VJdGVtLCBnZXRFbGVtZW50RG9jdW1lbnQodGFyZ2V0Tm9kZXNbMF0pKTtcblx0XHR9IGVsc2UgaWYgKHNvdXJjZUl0ZW0ubGVuZ3RoICYmICFzb3VyY2VJdGVtLm5vZGVUeXBlKSB7XG5cdFx0XHRzb3VyY2VJdGVtID0gRG9tUXVlcnkubWFrZUFycmF5KHNvdXJjZUl0ZW0pO1xuXG5cdFx0XHRpZiAocmV2ZXJzZSkge1xuXHRcdFx0XHRmb3IgKGkgPSBzb3VyY2VJdGVtLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG5cdFx0XHRcdFx0ZG9tTWFuaXB1bGF0ZSh0YXJnZXROb2Rlcywgc291cmNlSXRlbVtpXSwgY2FsbGJhY2ssIHJldmVyc2UpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRmb3IgKGkgPSAwOyBpIDwgc291cmNlSXRlbS5sZW5ndGg7IGkrKykge1xuXHRcdFx0XHRcdGRvbU1hbmlwdWxhdGUodGFyZ2V0Tm9kZXMsIHNvdXJjZUl0ZW1baV0sIGNhbGxiYWNrLCByZXZlcnNlKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gdGFyZ2V0Tm9kZXM7XG5cdFx0fVxuXG5cdFx0aWYgKHNvdXJjZUl0ZW0ubm9kZVR5cGUpIHtcblx0XHRcdGkgPSB0YXJnZXROb2Rlcy5sZW5ndGg7XG5cdFx0XHR3aGlsZSAoaS0tKSB7XG5cdFx0XHRcdGNhbGxiYWNrLmNhbGwodGFyZ2V0Tm9kZXNbaV0sIHNvdXJjZUl0ZW0pO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiB0YXJnZXROb2Rlcztcblx0fVxuXG5cdGZ1bmN0aW9uIGhhc0NsYXNzKG5vZGUsIGNsYXNzTmFtZSkge1xuXHRcdHJldHVybiBub2RlICYmIGNsYXNzTmFtZSAmJiAoJyAnICsgbm9kZS5jbGFzc05hbWUgKyAnICcpLmluZGV4T2YoJyAnICsgY2xhc3NOYW1lICsgJyAnKSAhPT0gLTE7XG5cdH1cblxuXHRmdW5jdGlvbiB3cmFwKGVsZW1lbnRzLCB3cmFwcGVyLCBhbGwpIHtcblx0XHR2YXIgbGFzdFBhcmVudCwgbmV3V3JhcHBlcjtcblxuXHRcdHdyYXBwZXIgPSBEb21RdWVyeSh3cmFwcGVyKVswXTtcblxuXHRcdGVsZW1lbnRzLmVhY2goZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdGlmICghYWxsIHx8IGxhc3RQYXJlbnQgIT0gc2VsZi5wYXJlbnROb2RlKSB7XG5cdFx0XHRcdGxhc3RQYXJlbnQgPSBzZWxmLnBhcmVudE5vZGU7XG5cdFx0XHRcdG5ld1dyYXBwZXIgPSB3cmFwcGVyLmNsb25lTm9kZShmYWxzZSk7XG5cdFx0XHRcdHNlbGYucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUobmV3V3JhcHBlciwgc2VsZik7XG5cdFx0XHRcdG5ld1dyYXBwZXIuYXBwZW5kQ2hpbGQoc2VsZik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRuZXdXcmFwcGVyLmFwcGVuZENoaWxkKHNlbGYpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIGVsZW1lbnRzO1xuXHR9XG5cblx0dmFyIG51bWVyaWNDc3NNYXAgPSBUb29scy5tYWtlTWFwKCdmaWxsT3BhY2l0eSBmb250V2VpZ2h0IGxpbmVIZWlnaHQgb3BhY2l0eSBvcnBoYW5zIHdpZG93cyB6SW5kZXggem9vbScsICcgJyk7XG5cdHZhciBib29sZWFuTWFwID0gVG9vbHMubWFrZU1hcCgnY2hlY2tlZCBjb21wYWN0IGRlY2xhcmUgZGVmZXIgZGlzYWJsZWQgaXNtYXAgbXVsdGlwbGUgbm9ocmVmIG5vc2hhZGUgbm93cmFwIHJlYWRvbmx5IHNlbGVjdGVkJywgJyAnKTtcblx0dmFyIHByb3BGaXggPSB7XG5cdFx0J2Zvcic6ICdodG1sRm9yJyxcblx0XHQnY2xhc3MnOiAnY2xhc3NOYW1lJyxcblx0XHQncmVhZG9ubHknOiAncmVhZE9ubHknXG5cdH07XG5cdHZhciBjc3NGaXggPSB7XG5cdFx0J2Zsb2F0JzogJ2Nzc0Zsb2F0J1xuXHR9O1xuXG5cdHZhciBhdHRySG9va3MgPSB7fSwgY3NzSG9va3MgPSB7fTtcblxuXHRmdW5jdGlvbiBEb21RdWVyeShzZWxlY3RvciwgY29udGV4dCkge1xuXHRcdC8qZXNsaW50IG5ldy1jYXA6MCAqL1xuXHRcdHJldHVybiBuZXcgRG9tUXVlcnkuZm4uaW5pdChzZWxlY3RvciwgY29udGV4dCk7XG5cdH1cblxuXHRmdW5jdGlvbiBpbkFycmF5KGl0ZW0sIGFycmF5KSB7XG5cdFx0dmFyIGk7XG5cblx0XHRpZiAoYXJyYXkuaW5kZXhPZikge1xuXHRcdFx0cmV0dXJuIGFycmF5LmluZGV4T2YoaXRlbSk7XG5cdFx0fVxuXG5cdFx0aSA9IGFycmF5Lmxlbmd0aDtcblx0XHR3aGlsZSAoaS0tKSB7XG5cdFx0XHRpZiAoYXJyYXlbaV0gPT09IGl0ZW0pIHtcblx0XHRcdFx0cmV0dXJuIGk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV0dXJuIC0xO1xuXHR9XG5cblx0dmFyIHdoaXRlU3BhY2VSZWdFeHAgPSAvXlxccyp8XFxzKiQvZztcblxuXHRmdW5jdGlvbiB0cmltKHN0cikge1xuXHRcdHJldHVybiAoc3RyID09PSBudWxsIHx8IHN0ciA9PT0gdW5kZWYpID8gJycgOiAoXCJcIiArIHN0cikucmVwbGFjZSh3aGl0ZVNwYWNlUmVnRXhwLCAnJyk7XG5cdH1cblxuXHRmdW5jdGlvbiBlYWNoKG9iaiwgY2FsbGJhY2spIHtcblx0XHR2YXIgbGVuZ3RoLCBrZXksIGksIHVuZGVmLCB2YWx1ZTtcblxuXHRcdGlmIChvYmopIHtcblx0XHRcdGxlbmd0aCA9IG9iai5sZW5ndGg7XG5cblx0XHRcdGlmIChsZW5ndGggPT09IHVuZGVmKSB7XG5cdFx0XHRcdC8vIExvb3Agb2JqZWN0IGl0ZW1zXG5cdFx0XHRcdGZvciAoa2V5IGluIG9iaikge1xuXHRcdFx0XHRcdGlmIChvYmouaGFzT3duUHJvcGVydHkoa2V5KSkge1xuXHRcdFx0XHRcdFx0dmFsdWUgPSBvYmpba2V5XTtcblx0XHRcdFx0XHRcdGlmIChjYWxsYmFjay5jYWxsKHZhbHVlLCBrZXksIHZhbHVlKSA9PT0gZmFsc2UpIHtcblx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQvLyBMb29wIGFycmF5IGl0ZW1zXG5cdFx0XHRcdGZvciAoaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuXHRcdFx0XHRcdHZhbHVlID0gb2JqW2ldO1xuXHRcdFx0XHRcdGlmIChjYWxsYmFjay5jYWxsKHZhbHVlLCBpLCB2YWx1ZSkgPT09IGZhbHNlKSB7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gb2JqO1xuXHR9XG5cblx0ZnVuY3Rpb24gZ3JlcChhcnJheSwgY2FsbGJhY2spIHtcblx0XHR2YXIgb3V0ID0gW107XG5cblx0XHRlYWNoKGFycmF5LCBmdW5jdGlvbihpLCBpdGVtKSB7XG5cdFx0XHRpZiAoY2FsbGJhY2soaXRlbSwgaSkpIHtcblx0XHRcdFx0b3V0LnB1c2goaXRlbSk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gb3V0O1xuXHR9XG5cblx0ZnVuY3Rpb24gZ2V0RWxlbWVudERvY3VtZW50KGVsZW1lbnQpIHtcblx0XHRpZiAoIWVsZW1lbnQpIHtcblx0XHRcdHJldHVybiBkb2M7XG5cdFx0fVxuXG5cdFx0aWYgKGVsZW1lbnQubm9kZVR5cGUgPT0gOSkge1xuXHRcdFx0cmV0dXJuIGVsZW1lbnQ7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGVsZW1lbnQub3duZXJEb2N1bWVudDtcblx0fVxuXG5cdERvbVF1ZXJ5LmZuID0gRG9tUXVlcnkucHJvdG90eXBlID0ge1xuXHRcdGNvbnN0cnVjdG9yOiBEb21RdWVyeSxcblxuXHRcdC8qKlxuXHRcdCAqIFNlbGVjdG9yIGZvciB0aGUgY3VycmVudCBzZXQuXG5cdFx0ICpcblx0XHQgKiBAcHJvcGVydHkgc2VsZWN0b3Jcblx0XHQgKiBAdHlwZSBTdHJpbmdcblx0XHQgKi9cblx0XHRzZWxlY3RvcjogXCJcIixcblxuXHRcdC8qKlxuXHRcdCAqIENvbnRleHQgdXNlZCB0byBjcmVhdGUgdGhlIHNldC5cblx0XHQgKlxuXHRcdCAqIEBwcm9wZXJ0eSBjb250ZXh0XG5cdFx0ICogQHR5cGUgRWxlbWVudFxuXHRcdCAqL1xuXHRcdGNvbnRleHQ6IG51bGwsXG5cblx0XHQvKipcblx0XHQgKiBOdW1iZXIgb2YgaXRlbXMgaW4gdGhlIGN1cnJlbnQgc2V0LlxuXHRcdCAqXG5cdFx0ICogQHByb3BlcnR5IGxlbmd0aFxuXHRcdCAqIEB0eXBlIE51bWJlclxuXHRcdCAqL1xuXHRcdGxlbmd0aDogMCxcblxuXHRcdC8qKlxuXHRcdCAqIENvbnN0cnVjdHMgYSBuZXcgRG9tUXVlcnkgaW5zdGFuY2Ugd2l0aCB0aGUgc3BlY2lmaWVkIHNlbGVjdG9yIG9yIGNvbnRleHQuXG5cdFx0ICpcblx0XHQgKiBAY29uc3RydWN0b3Jcblx0XHQgKiBAbWV0aG9kIGluaXRcblx0XHQgKiBAcGFyYW0ge1N0cmluZy9BcnJheS9Eb21RdWVyeX0gc2VsZWN0b3IgT3B0aW9uYWwgQ1NTIHNlbGVjdG9yL0FycmF5IG9yIGFycmF5IGxpa2Ugb2JqZWN0IG9yIEhUTUwgc3RyaW5nLlxuXHRcdCAqIEBwYXJhbSB7RG9jdW1lbnQvRWxlbWVudH0gY29udGV4dCBPcHRpb25hbCBjb250ZXh0IHRvIHNlYXJjaCBpbi5cblx0XHQgKi9cblx0XHRpbml0OiBmdW5jdGlvbihzZWxlY3RvciwgY29udGV4dCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLCBtYXRjaCwgbm9kZTtcblxuXHRcdFx0aWYgKCFzZWxlY3Rvcikge1xuXHRcdFx0XHRyZXR1cm4gc2VsZjtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHNlbGVjdG9yLm5vZGVUeXBlKSB7XG5cdFx0XHRcdHNlbGYuY29udGV4dCA9IHNlbGZbMF0gPSBzZWxlY3Rvcjtcblx0XHRcdFx0c2VsZi5sZW5ndGggPSAxO1xuXG5cdFx0XHRcdHJldHVybiBzZWxmO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoY29udGV4dCAmJiBjb250ZXh0Lm5vZGVUeXBlKSB7XG5cdFx0XHRcdHNlbGYuY29udGV4dCA9IGNvbnRleHQ7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRpZiAoY29udGV4dCkge1xuXHRcdFx0XHRcdHJldHVybiBEb21RdWVyeShzZWxlY3RvcikuYXR0cihjb250ZXh0KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHNlbGYuY29udGV4dCA9IGNvbnRleHQgPSBkb2N1bWVudDtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGlzU3RyaW5nKHNlbGVjdG9yKSkge1xuXHRcdFx0XHRzZWxmLnNlbGVjdG9yID0gc2VsZWN0b3I7XG5cblx0XHRcdFx0aWYgKHNlbGVjdG9yLmNoYXJBdCgwKSA9PT0gXCI8XCIgJiYgc2VsZWN0b3IuY2hhckF0KHNlbGVjdG9yLmxlbmd0aCAtIDEpID09PSBcIj5cIiAmJiBzZWxlY3Rvci5sZW5ndGggPj0gMykge1xuXHRcdFx0XHRcdG1hdGNoID0gW251bGwsIHNlbGVjdG9yLCBudWxsXTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRtYXRjaCA9IHJxdWlja0V4cHIuZXhlYyhzZWxlY3Rvcik7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAobWF0Y2gpIHtcblx0XHRcdFx0XHRpZiAobWF0Y2hbMV0pIHtcblx0XHRcdFx0XHRcdG5vZGUgPSBjcmVhdGVGcmFnbWVudChzZWxlY3RvciwgZ2V0RWxlbWVudERvY3VtZW50KGNvbnRleHQpKS5maXJzdENoaWxkO1xuXG5cdFx0XHRcdFx0XHR3aGlsZSAobm9kZSkge1xuXHRcdFx0XHRcdFx0XHRwdXNoLmNhbGwoc2VsZiwgbm9kZSk7XG5cdFx0XHRcdFx0XHRcdG5vZGUgPSBub2RlLm5leHRTaWJsaW5nO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRub2RlID0gZ2V0RWxlbWVudERvY3VtZW50KGNvbnRleHQpLmdldEVsZW1lbnRCeUlkKG1hdGNoWzJdKTtcblxuXHRcdFx0XHRcdFx0aWYgKCFub2RlKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiBzZWxmO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRpZiAobm9kZS5pZCAhPT0gbWF0Y2hbMl0pIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHNlbGYuZmluZChzZWxlY3Rvcik7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHNlbGYubGVuZ3RoID0gMTtcblx0XHRcdFx0XHRcdHNlbGZbMF0gPSBub2RlO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRyZXR1cm4gRG9tUXVlcnkoY29udGV4dCkuZmluZChzZWxlY3Rvcik7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuYWRkKHNlbGVjdG9yLCBmYWxzZSk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBzZWxmO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBDb252ZXJ0cyB0aGUgY3VycmVudCBzZXQgdG8gYW4gYXJyYXkuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHRvQXJyYXlcblx0XHQgKiBAcmV0dXJuIHtBcnJheX0gQXJyYXkgb2YgYWxsIG5vZGVzIGluIHNldC5cblx0XHQgKi9cblx0XHR0b0FycmF5OiBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiBUb29scy50b0FycmF5KHRoaXMpO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBBZGRzIG5ldyBub2RlcyB0byB0aGUgc2V0LlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBhZGRcblx0XHQgKiBAcGFyYW0ge0FycmF5L3RpbnltY2UuZG9tLkRvbVF1ZXJ5fSBpdGVtcyBBcnJheSBvZiBhbGwgbm9kZXMgdG8gYWRkIHRvIHNldC5cblx0XHQgKiBAcGFyYW0ge0Jvb2xlYW59IHNvcnQgT3B0aW9uYWwgc29ydCBmbGFnIHRoYXQgZW5hYmxlcyBzb3J0aW5nIG9mIGVsZW1lbnRzLlxuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UuZG9tLkRvbVF1ZXJ5fSBOZXcgaW5zdGFuY2Ugd2l0aCBub2RlcyBhZGRlZC5cblx0XHQgKi9cblx0XHRhZGQ6IGZ1bmN0aW9uKGl0ZW1zLCBzb3J0KSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIG5vZGVzLCBpO1xuXG5cdFx0XHRpZiAoaXNTdHJpbmcoaXRlbXMpKSB7XG5cdFx0XHRcdHJldHVybiBzZWxmLmFkZChEb21RdWVyeShpdGVtcykpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoc29ydCAhPT0gZmFsc2UpIHtcblx0XHRcdFx0bm9kZXMgPSBEb21RdWVyeS51bmlxdWUoc2VsZi50b0FycmF5KCkuY29uY2F0KERvbVF1ZXJ5Lm1ha2VBcnJheShpdGVtcykpKTtcblx0XHRcdFx0c2VsZi5sZW5ndGggPSBub2Rlcy5sZW5ndGg7XG5cdFx0XHRcdGZvciAoaSA9IDA7IGkgPCBub2Rlcy5sZW5ndGg7IGkrKykge1xuXHRcdFx0XHRcdHNlbGZbaV0gPSBub2Rlc1tpXTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0cHVzaC5hcHBseShzZWxmLCBEb21RdWVyeS5tYWtlQXJyYXkoaXRlbXMpKTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHNlbGY7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFNldHMvZ2V0cyBhdHRyaWJ1dGVzIG9uIHRoZSBlbGVtZW50cyBpbiB0aGUgY3VycmVudCBzZXQuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGF0dHJcblx0XHQgKiBAcGFyYW0ge1N0cmluZy9PYmplY3R9IG5hbWUgTmFtZSBvZiBhdHRyaWJ1dGUgdG8gZ2V0IG9yIGFuIG9iamVjdCB3aXRoIGF0dHJpYnV0ZXMgdG8gc2V0LlxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSB2YWx1ZSBPcHRpb25hbCB2YWx1ZSB0byBzZXQuXG5cdFx0ICogQHJldHVybiB7dGlueW1jZS5kb20uRG9tUXVlcnkvU3RyaW5nfSBDdXJyZW50IHNldCBvciB0aGUgc3BlY2lmaWVkIGF0dHJpYnV0ZSB3aGVuIG9ubHkgdGhlIG5hbWUgaXMgc3BlY2lmaWVkLlxuXHRcdCAqL1xuXHRcdGF0dHI6IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIGhvb2s7XG5cblx0XHRcdGlmICh0eXBlb2YgbmFtZSA9PT0gXCJvYmplY3RcIikge1xuXHRcdFx0XHRlYWNoKG5hbWUsIGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7XG5cdFx0XHRcdFx0c2VsZi5hdHRyKG5hbWUsIHZhbHVlKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKGlzRGVmaW5lZCh2YWx1ZSkpIHtcblx0XHRcdFx0dGhpcy5lYWNoKGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdHZhciBob29rO1xuXG5cdFx0XHRcdFx0aWYgKHRoaXMubm9kZVR5cGUgPT09IDEpIHtcblx0XHRcdFx0XHRcdGhvb2sgPSBhdHRySG9va3NbbmFtZV07XG5cdFx0XHRcdFx0XHRpZiAoaG9vayAmJiBob29rLnNldCkge1xuXHRcdFx0XHRcdFx0XHRob29rLnNldCh0aGlzLCB2YWx1ZSk7XG5cdFx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0aWYgKHZhbHVlID09PSBudWxsKSB7XG5cdFx0XHRcdFx0XHRcdHRoaXMucmVtb3ZlQXR0cmlidXRlKG5hbWUsIDIpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0dGhpcy5zZXRBdHRyaWJ1dGUobmFtZSwgdmFsdWUsIDIpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRpZiAoc2VsZlswXSAmJiBzZWxmWzBdLm5vZGVUeXBlID09PSAxKSB7XG5cdFx0XHRcdFx0aG9vayA9IGF0dHJIb29rc1tuYW1lXTtcblx0XHRcdFx0XHRpZiAoaG9vayAmJiBob29rLmdldCkge1xuXHRcdFx0XHRcdFx0cmV0dXJuIGhvb2suZ2V0KHNlbGZbMF0sIG5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmIChib29sZWFuTWFwW25hbWVdKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gc2VsZi5wcm9wKG5hbWUpID8gbmFtZSA6IHVuZGVmO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHZhbHVlID0gc2VsZlswXS5nZXRBdHRyaWJ1dGUobmFtZSwgMik7XG5cblx0XHRcdFx0XHRpZiAodmFsdWUgPT09IG51bGwpIHtcblx0XHRcdFx0XHRcdHZhbHVlID0gdW5kZWY7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gc2VsZjtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmVtb3ZlcyBhdHRyaWJ1dHNlIG9uIHRoZSBlbGVtZW50cyBpbiB0aGUgY3VycmVudCBzZXQuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHJlbW92ZUF0dHJcblx0XHQgKiBAcGFyYW0ge1N0cmluZy9PYmplY3R9IG5hbWUgTmFtZSBvZiBhdHRyaWJ1dGUgdG8gcmVtb3ZlLlxuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UuZG9tLkRvbVF1ZXJ5L1N0cmluZ30gQ3VycmVudCBzZXQuXG5cdFx0ICovXG5cdFx0cmVtb3ZlQXR0cjogZnVuY3Rpb24obmFtZSkge1xuXHRcdFx0cmV0dXJuIHRoaXMuYXR0cihuYW1lLCBudWxsKTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogU2V0cy9nZXRzIHByb3BlcnRpZXMgb24gdGhlIGVsZW1lbnRzIGluIHRoZSBjdXJyZW50IHNldC5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgYXR0clxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nL09iamVjdH0gbmFtZSBOYW1lIG9mIHByb3BlcnR5IHRvIGdldCBvciBhbiBvYmplY3Qgd2l0aCBwcm9wZXJ0aWVzIHRvIHNldC5cblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gdmFsdWUgT3B0aW9uYWwgdmFsdWUgdG8gc2V0LlxuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UuZG9tLkRvbVF1ZXJ5L1N0cmluZ30gQ3VycmVudCBzZXQgb3IgdGhlIHNwZWNpZmllZCBwcm9wZXJ0eSB3aGVuIG9ubHkgdGhlIG5hbWUgaXMgc3BlY2lmaWVkLlxuXHRcdCAqL1xuXHRcdHByb3A6IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdG5hbWUgPSBwcm9wRml4W25hbWVdIHx8IG5hbWU7XG5cblx0XHRcdGlmICh0eXBlb2YgbmFtZSA9PT0gXCJvYmplY3RcIikge1xuXHRcdFx0XHRlYWNoKG5hbWUsIGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7XG5cdFx0XHRcdFx0c2VsZi5wcm9wKG5hbWUsIHZhbHVlKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKGlzRGVmaW5lZCh2YWx1ZSkpIHtcblx0XHRcdFx0dGhpcy5lYWNoKGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdGlmICh0aGlzLm5vZGVUeXBlID09IDEpIHtcblx0XHRcdFx0XHRcdHRoaXNbbmFtZV0gPSB2YWx1ZTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0aWYgKHNlbGZbMF0gJiYgc2VsZlswXS5ub2RlVHlwZSAmJiBuYW1lIGluIHNlbGZbMF0pIHtcblx0XHRcdFx0XHRyZXR1cm4gc2VsZlswXVtuYW1lXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHNlbGY7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFNldHMvZ2V0cyBzdHlsZXMgb24gdGhlIGVsZW1lbnRzIGluIHRoZSBjdXJyZW50IHNldC5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgY3NzXG5cdFx0ICogQHBhcmFtIHtTdHJpbmcvT2JqZWN0fSBuYW1lIE5hbWUgb2Ygc3R5bGUgdG8gZ2V0IG9yIGFuIG9iamVjdCB3aXRoIHN0eWxlcyB0byBzZXQuXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IHZhbHVlIE9wdGlvbmFsIHZhbHVlIHRvIHNldC5cblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLmRvbS5Eb21RdWVyeS9TdHJpbmd9IEN1cnJlbnQgc2V0IG9yIHRoZSBzcGVjaWZpZWQgc3R5bGUgd2hlbiBvbmx5IHRoZSBuYW1lIGlzIHNwZWNpZmllZC5cblx0XHQgKi9cblx0XHRjc3M6IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIGVsbSwgaG9vaztcblxuXHRcdFx0ZnVuY3Rpb24gY2FtZWwobmFtZSkge1xuXHRcdFx0XHRyZXR1cm4gbmFtZS5yZXBsYWNlKC8tKFxcRCkvZywgZnVuY3Rpb24oYSwgYikge1xuXHRcdFx0XHRcdHJldHVybiBiLnRvVXBwZXJDYXNlKCk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRmdW5jdGlvbiBkYXNoZWQobmFtZSkge1xuXHRcdFx0XHRyZXR1cm4gbmFtZS5yZXBsYWNlKC9bQS1aXS9nLCBmdW5jdGlvbihhKSB7XG5cdFx0XHRcdFx0cmV0dXJuICctJyArIGE7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mIG5hbWUgPT09IFwib2JqZWN0XCIpIHtcblx0XHRcdFx0ZWFjaChuYW1lLCBmdW5jdGlvbihuYW1lLCB2YWx1ZSkge1xuXHRcdFx0XHRcdHNlbGYuY3NzKG5hbWUsIHZhbHVlKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRpZiAoaXNEZWZpbmVkKHZhbHVlKSkge1xuXHRcdFx0XHRcdG5hbWUgPSBjYW1lbChuYW1lKTtcblxuXHRcdFx0XHRcdC8vIERlZmF1bHQgcHggc3VmZml4IG9uIHRoZXNlXG5cdFx0XHRcdFx0aWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicgJiYgIW51bWVyaWNDc3NNYXBbbmFtZV0pIHtcblx0XHRcdFx0XHRcdHZhbHVlICs9ICdweCc7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0c2VsZi5lYWNoKGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdFx0dmFyIHN0eWxlID0gdGhpcy5zdHlsZTtcblxuXHRcdFx0XHRcdFx0aG9vayA9IGNzc0hvb2tzW25hbWVdO1xuXHRcdFx0XHRcdFx0aWYgKGhvb2sgJiYgaG9vay5zZXQpIHtcblx0XHRcdFx0XHRcdFx0aG9vay5zZXQodGhpcywgdmFsdWUpO1xuXHRcdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHRyeSB7XG5cdFx0XHRcdFx0XHRcdHRoaXMuc3R5bGVbY3NzRml4W25hbWVdIHx8IG5hbWVdID0gdmFsdWU7XG5cdFx0XHRcdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRcdFx0XHQvLyBJZ25vcmVcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0aWYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSAnJykge1xuXHRcdFx0XHRcdFx0XHRpZiAoc3R5bGUucmVtb3ZlUHJvcGVydHkpIHtcblx0XHRcdFx0XHRcdFx0XHRzdHlsZS5yZW1vdmVQcm9wZXJ0eShkYXNoZWQobmFtZSkpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRcdHN0eWxlLnJlbW92ZUF0dHJpYnV0ZShuYW1lKTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGVsbSA9IHNlbGZbMF07XG5cblx0XHRcdFx0XHRob29rID0gY3NzSG9va3NbbmFtZV07XG5cdFx0XHRcdFx0aWYgKGhvb2sgJiYgaG9vay5nZXQpIHtcblx0XHRcdFx0XHRcdHJldHVybiBob29rLmdldChlbG0pO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmIChlbG0ub3duZXJEb2N1bWVudC5kZWZhdWx0Vmlldykge1xuXHRcdFx0XHRcdFx0dHJ5IHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIGVsbS5vd25lckRvY3VtZW50LmRlZmF1bHRWaWV3LmdldENvbXB1dGVkU3R5bGUoZWxtLCBudWxsKS5nZXRQcm9wZXJ0eVZhbHVlKGRhc2hlZChuYW1lKSk7XG5cdFx0XHRcdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gdW5kZWY7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSBlbHNlIGlmIChlbG0uY3VycmVudFN0eWxlKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gZWxtLmN1cnJlbnRTdHlsZVtjYW1lbChuYW1lKV07XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBzZWxmO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZW1vdmVzIGFsbCBub2RlcyBpbiBzZXQgZnJvbSB0aGUgZG9jdW1lbnQuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHJlbW92ZVxuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UuZG9tLkRvbVF1ZXJ5fSBDdXJyZW50IHNldCB3aXRoIHRoZSByZW1vdmVkIG5vZGVzLlxuXHRcdCAqL1xuXHRcdHJlbW92ZTogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIG5vZGUsIGkgPSB0aGlzLmxlbmd0aDtcblxuXHRcdFx0d2hpbGUgKGktLSkge1xuXHRcdFx0XHRub2RlID0gc2VsZltpXTtcblx0XHRcdFx0RXZlbnQuY2xlYW4obm9kZSk7XG5cblx0XHRcdFx0aWYgKG5vZGUucGFyZW50Tm9kZSkge1xuXHRcdFx0XHRcdG5vZGUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChub2RlKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogRW1wdGllcyBhbGwgZWxlbWVudHMgaW4gc2V0LlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBlbXB0eVxuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UuZG9tLkRvbVF1ZXJ5fSBDdXJyZW50IHNldCB3aXRoIHRoZSBlbXB0eSBub2Rlcy5cblx0XHQgKi9cblx0XHRlbXB0eTogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIG5vZGUsIGkgPSB0aGlzLmxlbmd0aDtcblxuXHRcdFx0d2hpbGUgKGktLSkge1xuXHRcdFx0XHRub2RlID0gc2VsZltpXTtcblx0XHRcdFx0d2hpbGUgKG5vZGUuZmlyc3RDaGlsZCkge1xuXHRcdFx0XHRcdG5vZGUucmVtb3ZlQ2hpbGQobm9kZS5maXJzdENoaWxkKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogU2V0cyBvciBnZXRzIHRoZSBIVE1MIG9mIHRoZSBjdXJyZW50IHNldCBvciBmaXJzdCBzZXQgbm9kZS5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgaHRtbFxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSB2YWx1ZSBPcHRpb25hbCBpbm5lckhUTUwgdmFsdWUgdG8gc2V0IG9uIGVhY2ggZWxlbWVudC5cblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLmRvbS5Eb21RdWVyeS9TdHJpbmd9IEN1cnJlbnQgc2V0IG9yIHRoZSBpbm5lckhUTUwgb2YgdGhlIGZpcnN0IGVsZW1lbnQuXG5cdFx0ICovXG5cdFx0aHRtbDogZnVuY3Rpb24odmFsdWUpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgaTtcblxuXHRcdFx0aWYgKGlzRGVmaW5lZCh2YWx1ZSkpIHtcblx0XHRcdFx0aSA9IHNlbGYubGVuZ3RoO1xuXG5cdFx0XHRcdHRyeSB7XG5cdFx0XHRcdFx0d2hpbGUgKGktLSkge1xuXHRcdFx0XHRcdFx0c2VsZltpXS5pbm5lckhUTUwgPSB2YWx1ZTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdFx0Ly8gV29ya2Fyb3VuZCBmb3IgXCJVbmtub3duIHJ1bnRpbWUgZXJyb3JcIiB3aGVuIERJViBpcyBhZGRlZCB0byBQIG9uIElFXG5cdFx0XHRcdFx0RG9tUXVlcnkoc2VsZltpXSkuZW1wdHkoKS5hcHBlbmQodmFsdWUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHNlbGY7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBzZWxmWzBdID8gc2VsZlswXS5pbm5lckhUTUwgOiAnJztcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogU2V0cyBvciBnZXRzIHRoZSB0ZXh0IG9mIHRoZSBjdXJyZW50IHNldCBvciBmaXJzdCBzZXQgbm9kZS5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgdGV4dFxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSB2YWx1ZSBPcHRpb25hbCBpbm5lclRleHQgdmFsdWUgdG8gc2V0IG9uIGVhY2ggZWxlbWVudC5cblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLmRvbS5Eb21RdWVyeS9TdHJpbmd9IEN1cnJlbnQgc2V0IG9yIHRoZSBpbm5lclRleHQgb2YgdGhlIGZpcnN0IGVsZW1lbnQuXG5cdFx0ICovXG5cdFx0dGV4dDogZnVuY3Rpb24odmFsdWUpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgaTtcblxuXHRcdFx0aWYgKGlzRGVmaW5lZCh2YWx1ZSkpIHtcblx0XHRcdFx0aSA9IHNlbGYubGVuZ3RoO1xuXHRcdFx0XHR3aGlsZSAoaS0tKSB7XG5cdFx0XHRcdFx0aWYgKFwiaW5uZXJUZXh0XCIgaW4gc2VsZltpXSkge1xuXHRcdFx0XHRcdFx0c2VsZltpXS5pbm5lclRleHQgPSB2YWx1ZTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0c2VsZlswXS50ZXh0Q29udGVudCA9IHZhbHVlO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBzZWxmO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gc2VsZlswXSA/IChzZWxmWzBdLmlubmVyVGV4dCB8fCBzZWxmWzBdLnRleHRDb250ZW50KSA6ICcnO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBBcHBlbmRzIHRoZSBzcGVjaWZpZWQgbm9kZS9odG1sIG9yIG5vZGUgc2V0IHRvIHRoZSBjdXJyZW50IHNldCBub2Rlcy5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgYXBwZW5kXG5cdFx0ICogQHBhcmFtIHtTdHJpbmcvRWxlbWVudC9BcnJheS90aW55bWNlLmRvbS5Eb21RdWVyeX0gY29udGVudCBDb250ZW50IHRvIGFwcGVuZCB0byBlYWNoIGVsZW1lbnQgaW4gc2V0LlxuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UuZG9tLkRvbVF1ZXJ5fSBDdXJyZW50IHNldC5cblx0XHQgKi9cblx0XHRhcHBlbmQ6IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIGRvbU1hbmlwdWxhdGUodGhpcywgYXJndW1lbnRzLCBmdW5jdGlvbihub2RlKSB7XG5cdFx0XHRcdC8vIEVpdGhlciBlbGVtZW50IG9yIFNoYWRvdyBSb290XG5cdFx0XHRcdGlmICh0aGlzLm5vZGVUeXBlID09PSAxIHx8ICh0aGlzLmhvc3QgJiYgdGhpcy5ob3N0Lm5vZGVUeXBlID09PSAxKSkge1xuXHRcdFx0XHRcdHRoaXMuYXBwZW5kQ2hpbGQobm9kZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBQcmVwZW5kcyB0aGUgc3BlY2lmaWVkIG5vZGUvaHRtbCBvciBub2RlIHNldCB0byB0aGUgY3VycmVudCBzZXQgbm9kZXMuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHByZXBlbmRcblx0XHQgKiBAcGFyYW0ge1N0cmluZy9FbGVtZW50L0FycmF5L3RpbnltY2UuZG9tLkRvbVF1ZXJ5fSBjb250ZW50IENvbnRlbnQgdG8gcHJlcGVuZCB0byBlYWNoIGVsZW1lbnQgaW4gc2V0LlxuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UuZG9tLkRvbVF1ZXJ5fSBDdXJyZW50IHNldC5cblx0XHQgKi9cblx0XHRwcmVwZW5kOiBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiBkb21NYW5pcHVsYXRlKHRoaXMsIGFyZ3VtZW50cywgZnVuY3Rpb24obm9kZSkge1xuXHRcdFx0XHQvLyBFaXRoZXIgZWxlbWVudCBvciBTaGFkb3cgUm9vdFxuXHRcdFx0XHRpZiAodGhpcy5ub2RlVHlwZSA9PT0gMSB8fCAodGhpcy5ob3N0ICYmIHRoaXMuaG9zdC5ub2RlVHlwZSA9PT0gMSkpIHtcblx0XHRcdFx0XHR0aGlzLmluc2VydEJlZm9yZShub2RlLCB0aGlzLmZpcnN0Q2hpbGQpO1xuXHRcdFx0XHR9XG5cdFx0XHR9LCB0cnVlKTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogQWRkcyB0aGUgc3BlY2lmaWVkIGVsZW1lbnRzIGJlZm9yZSBjdXJyZW50IHNldCBub2Rlcy5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgYmVmb3JlXG5cdFx0ICogQHBhcmFtIHtTdHJpbmcvRWxlbWVudC9BcnJheS90aW55bWNlLmRvbS5Eb21RdWVyeX0gY29udGVudCBDb250ZW50IHRvIGFkZCBiZWZvcmUgdG8gZWFjaCBlbGVtZW50IGluIHNldC5cblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLmRvbS5Eb21RdWVyeX0gQ3VycmVudCBzZXQuXG5cdFx0ICovXG5cdFx0YmVmb3JlOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0aWYgKHNlbGZbMF0gJiYgc2VsZlswXS5wYXJlbnROb2RlKSB7XG5cdFx0XHRcdHJldHVybiBkb21NYW5pcHVsYXRlKHNlbGYsIGFyZ3VtZW50cywgZnVuY3Rpb24obm9kZSkge1xuXHRcdFx0XHRcdHRoaXMucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUobm9kZSwgdGhpcyk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gc2VsZjtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogQWRkcyB0aGUgc3BlY2lmaWVkIGVsZW1lbnRzIGFmdGVyIGN1cnJlbnQgc2V0IG5vZGVzLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBhZnRlclxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nL0VsZW1lbnQvQXJyYXkvdGlueW1jZS5kb20uRG9tUXVlcnl9IGNvbnRlbnQgQ29udGVudCB0byBhZGQgYWZ0ZXIgdG8gZWFjaCBlbGVtZW50IGluIHNldC5cblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLmRvbS5Eb21RdWVyeX0gQ3VycmVudCBzZXQuXG5cdFx0ICovXG5cdFx0YWZ0ZXI6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHRpZiAoc2VsZlswXSAmJiBzZWxmWzBdLnBhcmVudE5vZGUpIHtcblx0XHRcdFx0cmV0dXJuIGRvbU1hbmlwdWxhdGUoc2VsZiwgYXJndW1lbnRzLCBmdW5jdGlvbihub2RlKSB7XG5cdFx0XHRcdFx0dGhpcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShub2RlLCB0aGlzLm5leHRTaWJsaW5nKTtcblx0XHRcdFx0fSwgdHJ1ZSk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBzZWxmO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBBcHBlbmRzIHRoZSBzcGVjaWZpZWQgc2V0IG5vZGVzIHRvIHRoZSBzcGVjaWZpZWQgc2VsZWN0b3IvaW5zdGFuY2UuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGFwcGVuZFRvXG5cdFx0ICogQHBhcmFtIHtTdHJpbmcvRWxlbWVudC9BcnJheS90aW55bWNlLmRvbS5Eb21RdWVyeX0gdmFsIEl0ZW0gdG8gYXBwZW5kIHRoZSBjdXJyZW50IHNldCB0by5cblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLmRvbS5Eb21RdWVyeX0gQ3VycmVudCBzZXQgd2l0aCB0aGUgYXBwZW5kZWQgbm9kZXMuXG5cdFx0ICovXG5cdFx0YXBwZW5kVG86IGZ1bmN0aW9uKHZhbCkge1xuXHRcdFx0RG9tUXVlcnkodmFsKS5hcHBlbmQodGhpcyk7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBQcmVwZW5kcyB0aGUgc3BlY2lmaWVkIHNldCBub2RlcyB0byB0aGUgc3BlY2lmaWVkIHNlbGVjdG9yL2luc3RhbmNlLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBwcmVwZW5kVG9cblx0XHQgKiBAcGFyYW0ge1N0cmluZy9FbGVtZW50L0FycmF5L3RpbnltY2UuZG9tLkRvbVF1ZXJ5fSB2YWwgSXRlbSB0byBwcmVwZW5kIHRoZSBjdXJyZW50IHNldCB0by5cblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLmRvbS5Eb21RdWVyeX0gQ3VycmVudCBzZXQgd2l0aCB0aGUgcHJlcGVuZGVkIG5vZGVzLlxuXHRcdCAqL1xuXHRcdHByZXBlbmRUbzogZnVuY3Rpb24odmFsKSB7XG5cdFx0XHREb21RdWVyeSh2YWwpLnByZXBlbmQodGhpcyk7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZXBsYWNlcyB0aGUgbm9kZXMgaW4gc2V0IHdpdGggdGhlIHNwZWNpZmllZCBjb250ZW50LlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCByZXBsYWNlV2l0aFxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nL0VsZW1lbnQvQXJyYXkvdGlueW1jZS5kb20uRG9tUXVlcnl9IGNvbnRlbnQgQ29udGVudCB0byByZXBsYWNlIG5vZGVzIHdpdGguXG5cdFx0ICogQHJldHVybiB7dGlueW1jZS5kb20uRG9tUXVlcnl9IFNldCB3aXRoIHJlcGxhY2VkIG5vZGVzLlxuXHRcdCAqL1xuXHRcdHJlcGxhY2VXaXRoOiBmdW5jdGlvbihjb250ZW50KSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5iZWZvcmUoY29udGVudCkucmVtb3ZlKCk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFdyYXBzIGFsbCBlbGVtZW50cyBpbiBzZXQgd2l0aCB0aGUgc3BlY2lmaWVkIHdyYXBwZXIuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHdyYXBcblx0XHQgKiBAcGFyYW0ge1N0cmluZy9FbGVtZW50L0FycmF5L3RpbnltY2UuZG9tLkRvbVF1ZXJ5fSBjb250ZW50IENvbnRlbnQgdG8gd3JhcCBub2RlcyB3aXRoLlxuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UuZG9tLkRvbVF1ZXJ5fSBTZXQgd2l0aCB3cmFwcGVkIG5vZGVzLlxuXHRcdCAqL1xuXHRcdHdyYXA6IGZ1bmN0aW9uKGNvbnRlbnQpIHtcblx0XHRcdHJldHVybiB3cmFwKHRoaXMsIGNvbnRlbnQpO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBXcmFwcyBhbGwgbm9kZXMgaW4gc2V0IHdpdGggdGhlIHNwZWNpZmllZCB3cmFwcGVyLiBJZiB0aGUgbm9kZXMgYXJlIHNpYmxpbmdzIGFsbCBvZiB0aGVtXG5cdFx0ICogd2lsbCBiZSB3cmFwcGVkIGluIHRoZSBzYW1lIHdyYXBwZXIuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHdyYXBBbGxcblx0XHQgKiBAcGFyYW0ge1N0cmluZy9FbGVtZW50L0FycmF5L3RpbnltY2UuZG9tLkRvbVF1ZXJ5fSBjb250ZW50IENvbnRlbnQgdG8gd3JhcCBub2RlcyB3aXRoLlxuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UuZG9tLkRvbVF1ZXJ5fSBTZXQgd2l0aCB3cmFwcGVkIG5vZGVzLlxuXHRcdCAqL1xuXHRcdHdyYXBBbGw6IGZ1bmN0aW9uKGNvbnRlbnQpIHtcblx0XHRcdHJldHVybiB3cmFwKHRoaXMsIGNvbnRlbnQsIHRydWUpO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBXcmFwcyBhbGwgZWxlbWVudHMgaW5uZXIgY29udGVudHMgaW4gc2V0IHdpdGggdGhlIHNwZWNpZmllZCB3cmFwcGVyLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCB3cmFwSW5uZXJcblx0XHQgKiBAcGFyYW0ge1N0cmluZy9FbGVtZW50L0FycmF5L3RpbnltY2UuZG9tLkRvbVF1ZXJ5fSBjb250ZW50IENvbnRlbnQgdG8gd3JhcCBub2RlcyB3aXRoLlxuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UuZG9tLkRvbVF1ZXJ5fSBTZXQgd2l0aCB3cmFwcGVkIG5vZGVzLlxuXHRcdCAqL1xuXHRcdHdyYXBJbm5lcjogZnVuY3Rpb24oY29udGVudCkge1xuXHRcdFx0dGhpcy5lYWNoKGZ1bmN0aW9uKCkge1xuXHRcdFx0XHREb21RdWVyeSh0aGlzKS5jb250ZW50cygpLndyYXBBbGwoY29udGVudCk7XG5cdFx0XHR9KTtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFVud3JhcHMgYWxsIGVsZW1lbnRzIGJ5IHJlbW92aW5nIHRoZSBwYXJlbnQgZWxlbWVudCBvZiBlYWNoIGl0ZW0gaW4gc2V0LlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCB1bndyYXBcblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLmRvbS5Eb21RdWVyeX0gU2V0IHdpdGggdW53cmFwcGVkIG5vZGVzLlxuXHRcdCAqL1xuXHRcdHVud3JhcDogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5wYXJlbnQoKS5lYWNoKGZ1bmN0aW9uKCkge1xuXHRcdFx0XHREb21RdWVyeSh0aGlzKS5yZXBsYWNlV2l0aCh0aGlzLmNoaWxkTm9kZXMpO1xuXHRcdFx0fSk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIENsb25lcyBhbGwgbm9kZXMgaW4gc2V0LlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBjbG9uZVxuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UuZG9tLkRvbVF1ZXJ5fSBTZXQgd2l0aCBjbG9uZWQgbm9kZXMuXG5cdFx0ICovXG5cdFx0Y2xvbmU6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHJlc3VsdCA9IFtdO1xuXG5cdFx0XHR0aGlzLmVhY2goZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHJlc3VsdC5wdXNoKHRoaXMuY2xvbmVOb2RlKHRydWUpKTtcblx0XHRcdH0pO1xuXG5cdFx0XHRyZXR1cm4gRG9tUXVlcnkocmVzdWx0KTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogQWRkcyB0aGUgc3BlY2lmaWVkIGNsYXNzIG5hbWUgdG8gdGhlIGN1cnJlbnQgc2V0IGVsZW1lbnRzLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBhZGRDbGFzc1xuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBjbGFzc05hbWUgQ2xhc3MgbmFtZSB0byBhZGQuXG5cdFx0ICogQHJldHVybiB7dGlueW1jZS5kb20uRG9tUXVlcnl9IEN1cnJlbnQgc2V0LlxuXHRcdCAqL1xuXHRcdGFkZENsYXNzOiBmdW5jdGlvbihjbGFzc05hbWUpIHtcblx0XHRcdHJldHVybiB0aGlzLnRvZ2dsZUNsYXNzKGNsYXNzTmFtZSwgdHJ1ZSk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFJlbW92ZXMgdGhlIHNwZWNpZmllZCBjbGFzcyBuYW1lIHRvIHRoZSBjdXJyZW50IHNldCBlbGVtZW50cy5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgcmVtb3ZlQ2xhc3Ncblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gY2xhc3NOYW1lIENsYXNzIG5hbWUgdG8gcmVtb3ZlLlxuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UuZG9tLkRvbVF1ZXJ5fSBDdXJyZW50IHNldC5cblx0XHQgKi9cblx0XHRyZW1vdmVDbGFzczogZnVuY3Rpb24oY2xhc3NOYW1lKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy50b2dnbGVDbGFzcyhjbGFzc05hbWUsIGZhbHNlKTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogVG9nZ2xlcyB0aGUgc3BlY2lmaWVkIGNsYXNzIG5hbWUgb24gdGhlIGN1cnJlbnQgc2V0IGVsZW1lbnRzLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCB0b2dnbGVDbGFzc1xuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBjbGFzc05hbWUgQ2xhc3MgbmFtZSB0byBhZGQvcmVtb3ZlLlxuXHRcdCAqIEBwYXJhbSB7Qm9vbGVhbn0gc3RhdGUgT3B0aW9uYWwgc3RhdGUgdG8gdG9nZ2xlIG9uL29mZi5cblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLmRvbS5Eb21RdWVyeX0gQ3VycmVudCBzZXQuXG5cdFx0ICovXG5cdFx0dG9nZ2xlQ2xhc3M6IGZ1bmN0aW9uKGNsYXNzTmFtZSwgc3RhdGUpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0Ly8gRnVuY3Rpb25zIGFyZSBub3Qgc3VwcG9ydGVkXG5cdFx0XHRpZiAodHlwZW9mIGNsYXNzTmFtZSAhPSAnc3RyaW5nJykge1xuXHRcdFx0XHRyZXR1cm4gc2VsZjtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGNsYXNzTmFtZS5pbmRleE9mKCcgJykgIT09IC0xKSB7XG5cdFx0XHRcdGVhY2goY2xhc3NOYW1lLnNwbGl0KCcgJyksIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdHNlbGYudG9nZ2xlQ2xhc3ModGhpcywgc3RhdGUpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHNlbGYuZWFjaChmdW5jdGlvbihpbmRleCwgbm9kZSkge1xuXHRcdFx0XHRcdHZhciBleGlzdGluZ0NsYXNzTmFtZSwgY2xhc3NTdGF0ZTtcblxuXHRcdFx0XHRcdGNsYXNzU3RhdGUgPSBoYXNDbGFzcyhub2RlLCBjbGFzc05hbWUpO1xuXHRcdFx0XHRcdGlmIChjbGFzc1N0YXRlICE9PSBzdGF0ZSkge1xuXHRcdFx0XHRcdFx0ZXhpc3RpbmdDbGFzc05hbWUgPSBub2RlLmNsYXNzTmFtZTtcblxuXHRcdFx0XHRcdFx0aWYgKGNsYXNzU3RhdGUpIHtcblx0XHRcdFx0XHRcdFx0bm9kZS5jbGFzc05hbWUgPSB0cmltKChcIiBcIiArIGV4aXN0aW5nQ2xhc3NOYW1lICsgXCIgXCIpLnJlcGxhY2UoJyAnICsgY2xhc3NOYW1lICsgJyAnLCAnICcpKTtcblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdG5vZGUuY2xhc3NOYW1lICs9IGV4aXN0aW5nQ2xhc3NOYW1lID8gJyAnICsgY2xhc3NOYW1lIDogY2xhc3NOYW1lO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBzZWxmO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZXR1cm5zIHRydWUvZmFsc2UgaWYgdGhlIGZpcnN0IGl0ZW0gaW4gc2V0IGhhcyB0aGUgc3BlY2lmaWVkIGNsYXNzLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBoYXNDbGFzc1xuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBjbGFzc05hbWUgQ2xhc3MgbmFtZSB0byBjaGVjayBmb3IuXG5cdFx0ICogQHJldHVybiB7Qm9vbGVhbn0gVHJ1ZS9mYWxzZSBpZiB0aGUgc2V0IGhhcyB0aGUgc3BlY2lmaWVkIGNsYXNzLlxuXHRcdCAqL1xuXHRcdGhhc0NsYXNzOiBmdW5jdGlvbihjbGFzc05hbWUpIHtcblx0XHRcdHJldHVybiBoYXNDbGFzcyh0aGlzWzBdLCBjbGFzc05hbWUpO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBFeGVjdXRlcyB0aGUgY2FsbGJhY2sgZnVuY3Rpb24gZm9yIGVhY2ggaXRlbSBEb21RdWVyeSBjb2xsZWN0aW9uLiBJZiB5b3UgcmV0dXJuIGZhbHNlIGluIHRoZVxuXHRcdCAqIGNhbGxiYWNrIGl0IHdpbGwgYnJlYWsgdGhlIGxvb3AuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGVhY2hcblx0XHQgKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBleGVjdXRlIGZvciBlYWNoIGl0ZW0uXG5cdFx0ICogQHJldHVybiB7dGlueW1jZS5kb20uRG9tUXVlcnl9IEN1cnJlbnQgc2V0LlxuXHRcdCAqL1xuXHRcdGVhY2g6IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG5cdFx0XHRyZXR1cm4gZWFjaCh0aGlzLCBjYWxsYmFjayk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIEJpbmRzIGFuIGV2ZW50IHdpdGggY2FsbGJhY2sgZnVuY3Rpb24gdG8gdGhlIGVsZW1lbnRzIGluIHNldC5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2Qgb25cblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSBOYW1lIG9mIHRoZSBldmVudCB0byBiaW5kLlxuXHRcdCAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGV4ZWN1dGUgd2hlbiB0aGUgZXZlbnQgb2NjdXJzLlxuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UuZG9tLkRvbVF1ZXJ5fSBDdXJyZW50IHNldC5cblx0XHQgKi9cblx0XHRvbjogZnVuY3Rpb24obmFtZSwgY2FsbGJhY2spIHtcblx0XHRcdHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7XG5cdFx0XHRcdEV2ZW50LmJpbmQodGhpcywgbmFtZSwgY2FsbGJhY2spO1xuXHRcdFx0fSk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFVuYmluZHMgYW4gZXZlbnQgd2l0aCBjYWxsYmFjayBmdW5jdGlvbiB0byB0aGUgZWxlbWVudHMgaW4gc2V0LlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBvZmZcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSBPcHRpb25hbCBuYW1lIG9mIHRoZSBldmVudCB0byBiaW5kLlxuXHRcdCAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrIE9wdGlvbmFsIGNhbGxiYWNrIGZ1bmN0aW9uIHRvIGV4ZWN1dGUgd2hlbiB0aGUgZXZlbnQgb2NjdXJzLlxuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UuZG9tLkRvbVF1ZXJ5fSBDdXJyZW50IHNldC5cblx0XHQgKi9cblx0XHRvZmY6IGZ1bmN0aW9uKG5hbWUsIGNhbGxiYWNrKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRFdmVudC51bmJpbmQodGhpcywgbmFtZSwgY2FsbGJhY2spO1xuXHRcdFx0fSk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFRyaWdnZXJzIHRoZSBzcGVjaWZpZWQgZXZlbnQgYnkgbmFtZSBvciBldmVudCBvYmplY3QuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHRyaWdnZXJcblx0XHQgKiBAcGFyYW0ge1N0cmluZy9PYmplY3R9IG5hbWUgTmFtZSBvZiB0aGUgZXZlbnQgdG8gdHJpZ2dlciBvciBldmVudCBvYmplY3QuXG5cdFx0ICogQHJldHVybiB7dGlueW1jZS5kb20uRG9tUXVlcnl9IEN1cnJlbnQgc2V0LlxuXHRcdCAqL1xuXHRcdHRyaWdnZXI6IGZ1bmN0aW9uKG5hbWUpIHtcblx0XHRcdHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YgbmFtZSA9PSAnb2JqZWN0Jykge1xuXHRcdFx0XHRcdEV2ZW50LmZpcmUodGhpcywgbmFtZS50eXBlLCBuYW1lKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRFdmVudC5maXJlKHRoaXMsIG5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogU2hvd3MgYWxsIGVsZW1lbnRzIGluIHNldC5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2Qgc2hvd1xuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UuZG9tLkRvbVF1ZXJ5fSBDdXJyZW50IHNldC5cblx0XHQgKi9cblx0XHRzaG93OiBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiB0aGlzLmNzcygnZGlzcGxheScsICcnKTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogSGlkZXMgYWxsIGVsZW1lbnRzIGluIHNldC5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgaGlkZVxuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UuZG9tLkRvbVF1ZXJ5fSBDdXJyZW50IHNldC5cblx0XHQgKi9cblx0XHRoaWRlOiBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiB0aGlzLmNzcygnZGlzcGxheScsICdub25lJyk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFNsaWNlcyB0aGUgY3VycmVudCBzZXQuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHNsaWNlXG5cdFx0ICogQHBhcmFtIHtOdW1iZXJ9IHN0YXJ0IFN0YXJ0IGluZGV4IHRvIHNsaWNlIGF0LlxuXHRcdCAqIEBwYXJhbSB7TnVtYmVyfSBlbmQgT3B0aW9uYWwgZW5kIGluZGV4IHRvIGVuZCBzbGljZSBhdC5cblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLmRvbS5Eb21RdWVyeX0gU2xpY2VkIHNldC5cblx0XHQgKi9cblx0XHRzbGljZTogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gbmV3IERvbVF1ZXJ5KHNsaWNlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBNYWtlcyB0aGUgc2V0IGVxdWFsIHRvIHRoZSBzcGVjaWZpZWQgaW5kZXguXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGVxXG5cdFx0ICogQHBhcmFtIHtOdW1iZXJ9IGluZGV4IEluZGV4IHRvIHNldCBpdCBlcXVhbCB0by5cblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLmRvbS5Eb21RdWVyeX0gU2luZ2xlIGl0ZW0gc2V0LlxuXHRcdCAqL1xuXHRcdGVxOiBmdW5jdGlvbihpbmRleCkge1xuXHRcdFx0cmV0dXJuIGluZGV4ID09PSAtMSA/IHRoaXMuc2xpY2UoaW5kZXgpIDogdGhpcy5zbGljZShpbmRleCwgK2luZGV4ICsgMSk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIE1ha2VzIHRoZSBzZXQgZXF1YWwgdG8gZmlyc3QgZWxlbWVudCBpbiBzZXQuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGZpcnN0XG5cdFx0ICogQHJldHVybiB7dGlueW1jZS5kb20uRG9tUXVlcnl9IFNpbmdsZSBpdGVtIHNldC5cblx0XHQgKi9cblx0XHRmaXJzdDogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5lcSgwKTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogTWFrZXMgdGhlIHNldCBlcXVhbCB0byBsYXN0IGVsZW1lbnQgaW4gc2V0LlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBsYXN0XG5cdFx0ICogQHJldHVybiB7dGlueW1jZS5kb20uRG9tUXVlcnl9IFNpbmdsZSBpdGVtIHNldC5cblx0XHQgKi9cblx0XHRsYXN0OiBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiB0aGlzLmVxKC0xKTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogRmluZHMgZWxlbWVudHMgYnkgdGhlIHNwZWNpZmllZCBzZWxlY3RvciBmb3IgZWFjaCBlbGVtZW50IGluIHNldC5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgZmluZFxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBzZWxlY3RvciBTZWxlY3RvciB0byBmaW5kIGVsZW1lbnRzIGJ5LlxuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UuZG9tLkRvbVF1ZXJ5fSBTZXQgd2l0aCBtYXRjaGVzIGVsZW1lbnRzLlxuXHRcdCAqL1xuXHRcdGZpbmQ6IGZ1bmN0aW9uKHNlbGVjdG9yKSB7XG5cdFx0XHR2YXIgaSwgbCwgcmV0ID0gW107XG5cblx0XHRcdGZvciAoaSA9IDAsIGwgPSB0aGlzLmxlbmd0aDsgaSA8IGw7IGkrKykge1xuXHRcdFx0XHREb21RdWVyeS5maW5kKHNlbGVjdG9yLCB0aGlzW2ldLCByZXQpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gRG9tUXVlcnkocmV0KTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogRmlsdGVycyB0aGUgY3VycmVudCBzZXQgd2l0aCB0aGUgc3BlY2lmaWVkIHNlbGVjdG9yLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBmaWx0ZXJcblx0XHQgKiBAcGFyYW0ge1N0cmluZy9mdW5jdGlvbn0gc2VsZWN0b3IgU2VsZWN0b3IgdG8gZmlsdGVyIGVsZW1lbnRzIGJ5LlxuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UuZG9tLkRvbVF1ZXJ5fSBTZXQgd2l0aCBmaWx0ZXJlZCBlbGVtZW50cy5cblx0XHQgKi9cblx0XHRmaWx0ZXI6IGZ1bmN0aW9uKHNlbGVjdG9yKSB7XG5cdFx0XHRpZiAodHlwZW9mIHNlbGVjdG9yID09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0dXJuIERvbVF1ZXJ5KGdyZXAodGhpcy50b0FycmF5KCksIGZ1bmN0aW9uKGl0ZW0sIGkpIHtcblx0XHRcdFx0XHRyZXR1cm4gc2VsZWN0b3IoaSwgaXRlbSk7XG5cdFx0XHRcdH0pKTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIERvbVF1ZXJ5KERvbVF1ZXJ5LmZpbHRlcihzZWxlY3RvciwgdGhpcy50b0FycmF5KCkpKTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogR2V0cyB0aGUgY3VycmVudCBub2RlIG9yIGFueSBwYXJlbnQgbWF0Y2hpbmcgdGhlIHNwZWNpZmllZCBzZWxlY3Rvci5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgY2xvc2VzdFxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nL0VsZW1lbnQvdGlueW1jZS5kb20uRG9tUXVlcnl9IHNlbGVjdG9yIFNlbGVjdG9yIG9yIGVsZW1lbnQgdG8gZmluZC5cblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLmRvbS5Eb21RdWVyeX0gU2V0IHdpdGggY2xvc2VzdCBlbGVtZW50cy5cblx0XHQgKi9cblx0XHRjbG9zZXN0OiBmdW5jdGlvbihzZWxlY3Rvcikge1xuXHRcdFx0dmFyIHJlc3VsdCA9IFtdO1xuXG5cdFx0XHRpZiAoc2VsZWN0b3IgaW5zdGFuY2VvZiBEb21RdWVyeSkge1xuXHRcdFx0XHRzZWxlY3RvciA9IHNlbGVjdG9yWzBdO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLmVhY2goZnVuY3Rpb24oaSwgbm9kZSkge1xuXHRcdFx0XHR3aGlsZSAobm9kZSkge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Ygc2VsZWN0b3IgPT0gJ3N0cmluZycgJiYgRG9tUXVlcnkobm9kZSkuaXMoc2VsZWN0b3IpKSB7XG5cdFx0XHRcdFx0XHRyZXN1bHQucHVzaChub2RlKTtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAobm9kZSA9PSBzZWxlY3Rvcikge1xuXHRcdFx0XHRcdFx0cmVzdWx0LnB1c2gobm9kZSk7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRub2RlID0gbm9kZS5wYXJlbnROb2RlO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0cmV0dXJuIERvbVF1ZXJ5KHJlc3VsdCk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFJldHVybnMgdGhlIG9mZnNldCBvZiB0aGUgZmlyc3QgZWxlbWVudCBpbiBzZXQgb3Igc2V0cyB0aGUgdG9wL2xlZnQgY3NzIHByb3BlcnRpZXMgb2YgYWxsIGVsZW1lbnRzIGluIHNldC5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2Qgb2Zmc2V0XG5cdFx0ICogQHBhcmFtIHtPYmplY3R9IG9mZnNldCBPcHRpb25hbCBvZmZzZXQgb2JqZWN0IHRvIHNldCBvbiBlYWNoIGl0ZW0uXG5cdFx0ICogQHJldHVybiB7T2JqZWN0L3RpbnltY2UuZG9tLkRvbVF1ZXJ5fSBSZXR1cm5zIHRoZSBmaXJzdCBlbGVtZW50IG9mZnNldCBvciB0aGUgY3VycmVudCBzZXQgaWYgeW91IHNwZWNpZmllZCBhbiBvZmZzZXQuXG5cdFx0ICovXG5cdFx0b2Zmc2V0OiBmdW5jdGlvbihvZmZzZXQpIHtcblx0XHRcdHZhciBlbG0sIGRvYywgZG9jRWxtO1xuXHRcdFx0dmFyIHggPSAwLCB5ID0gMCwgcG9zO1xuXG5cdFx0XHRpZiAoIW9mZnNldCkge1xuXHRcdFx0XHRlbG0gPSB0aGlzWzBdO1xuXG5cdFx0XHRcdGlmIChlbG0pIHtcblx0XHRcdFx0XHRkb2MgPSBlbG0ub3duZXJEb2N1bWVudDtcblx0XHRcdFx0XHRkb2NFbG0gPSBkb2MuZG9jdW1lbnRFbGVtZW50O1xuXG5cdFx0XHRcdFx0aWYgKGVsbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QpIHtcblx0XHRcdFx0XHRcdHBvcyA9IGVsbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblx0XHRcdFx0XHRcdHggPSBwb3MubGVmdCArIChkb2NFbG0uc2Nyb2xsTGVmdCB8fCBkb2MuYm9keS5zY3JvbGxMZWZ0KSAtIGRvY0VsbS5jbGllbnRMZWZ0O1xuXHRcdFx0XHRcdFx0eSA9IHBvcy50b3AgKyAoZG9jRWxtLnNjcm9sbFRvcCB8fCBkb2MuYm9keS5zY3JvbGxUb3ApIC0gZG9jRWxtLmNsaWVudFRvcDtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4ge1xuXHRcdFx0XHRcdGxlZnQ6IHgsXG5cdFx0XHRcdFx0dG9wOiB5XG5cdFx0XHRcdH07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiB0aGlzLmNzcyhvZmZzZXQpO1xuXHRcdH0sXG5cblx0XHRwdXNoOiBwdXNoLFxuXHRcdHNvcnQ6IFtdLnNvcnQsXG5cdFx0c3BsaWNlOiBbXS5zcGxpY2Vcblx0fTtcblxuXHQvLyBTdGF0aWMgbWVtYmVyc1xuXHRUb29scy5leHRlbmQoRG9tUXVlcnksIHtcblx0XHQvKipcblx0XHQgKiBFeHRlbmRzIHRoZSBzcGVjaWZpZWQgb2JqZWN0IHdpdGggb25lIG9yIG1vcmUgb2JqZWN0cy5cblx0XHQgKlxuXHRcdCAqIEBzdGF0aWNcblx0XHQgKiBAbWV0aG9kIGV4dGVuZFxuXHRcdCAqIEBwYXJhbSB7T2JqZWN0fSB0YXJnZXQgVGFyZ2V0IG9iamVjdCB0byBleHRlbmQgd2l0aCBuZXcgaXRlbXMuXG5cdFx0ICogQHBhcmFtIHtPYmplY3QuLn0gb2JqZWN0IE9iamVjdCB0byBleHRlbmQgdGhlIHRhcmdldCB3aXRoLlxuXHRcdCAqIEByZXR1cm4ge09iamVjdH0gRXh0ZW5kZWQgaW5wdXQgb2JqZWN0LlxuXHRcdCAqL1xuXHRcdGV4dGVuZDogVG9vbHMuZXh0ZW5kLFxuXG5cdFx0LyoqXG5cdFx0ICogQ3JlYXRlcyBhbiBhcnJheSBvdXQgb2YgYW4gYXJyYXkgbGlrZSBvYmplY3QuXG5cdFx0ICpcblx0XHQgKiBAc3RhdGljXG5cdFx0ICogQG1ldGhvZCBtYWtlQXJyYXlcblx0XHQgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IE9iamVjdCB0byBjb252ZXJ0IHRvIGFycmF5LlxuXHRcdCAqIEByZXR1cm4ge0FycmF5fSBBcnJheSBwcm9kdWNlZCBmcm9tIG9iamVjdC5cblx0XHQgKi9cblx0XHRtYWtlQXJyYXk6IGZ1bmN0aW9uKG9iamVjdCkge1xuXHRcdFx0aWYgKGlzV2luZG93KG9iamVjdCkgfHwgb2JqZWN0Lm5vZGVUeXBlKSB7XG5cdFx0XHRcdHJldHVybiBbb2JqZWN0XTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIFRvb2xzLnRvQXJyYXkob2JqZWN0KTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyB0aGUgaW5kZXggb2YgdGhlIHNwZWNpZmllZCBpdGVtIGluc2lkZSB0aGUgYXJyYXkuXG5cdFx0ICpcblx0XHQgKiBAc3RhdGljXG5cdFx0ICogQG1ldGhvZCBpbkFycmF5XG5cdFx0ICogQHBhcmFtIHtPYmplY3R9IGl0ZW0gSXRlbSB0byBsb29rIGZvci5cblx0XHQgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBBcnJheSB0byBsb29rIGZvciBpdGVtIGluLlxuXHRcdCAqIEByZXR1cm4ge051bWJlcn0gSW5kZXggb2YgdGhlIGl0ZW0gb3IgLTEuXG5cdFx0ICovXG5cdFx0aW5BcnJheTogaW5BcnJheSxcblxuXHRcdC8qKlxuXHRcdCAqIFJldHVybnMgdHJ1ZS9mYWxzZSBpZiB0aGUgc3BlY2lmaWVkIG9iamVjdCBpcyBhbiBhcnJheSBvciBub3QuXG5cdFx0ICpcblx0XHQgKiBAc3RhdGljXG5cdFx0ICogQG1ldGhvZCBpc0FycmF5XG5cdFx0ICogQHBhcmFtIHtPYmplY3R9IGFycmF5IE9iamVjdCB0byBjaGVjayBpZiBpdCdzIGFuIGFycmF5IG9yIG5vdC5cblx0XHQgKiBAcmV0dXJuIHtCb29sZWFufSBUcnVlL2ZhbHNlIGlmIHRoZSBvYmplY3QgaXMgYW4gYXJyYXkuXG5cdFx0ICovXG5cdFx0aXNBcnJheTogVG9vbHMuaXNBcnJheSxcblxuXHRcdC8qKlxuXHRcdCAqIEV4ZWN1dGVzIHRoZSBjYWxsYmFjayBmdW5jdGlvbiBmb3IgZWFjaCBpdGVtIGluIGFycmF5L29iamVjdC4gSWYgeW91IHJldHVybiBmYWxzZSBpbiB0aGVcblx0XHQgKiBjYWxsYmFjayBpdCB3aWxsIGJyZWFrIHRoZSBsb29wLlxuXHRcdCAqXG5cdFx0ICogQHN0YXRpY1xuXHRcdCAqIEBtZXRob2QgZWFjaFxuXHRcdCAqIEBwYXJhbSB7T2JqZWN0fSBvYmogT2JqZWN0IHRvIGl0ZXJhdGUuXG5cdFx0ICogQHBhcmFtIHtmdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gZXhlY3V0ZSBmb3IgZWFjaCBpdGVtLlxuXHRcdCAqL1xuXHRcdGVhY2g6IGVhY2gsXG5cblx0XHQvKipcblx0XHQgKiBSZW1vdmVzIHdoaXRlc3BhY2UgZnJvbSB0aGUgYmVnaW5uaW5nIGFuZCBlbmQgb2YgYSBzdHJpbmcuXG5cdFx0ICpcblx0XHQgKiBAc3RhdGljXG5cdFx0ICogQG1ldGhvZCB0cmltXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IHN0ciBTdHJpbmcgdG8gcmVtb3ZlIHdoaXRlc3BhY2UgZnJvbS5cblx0XHQgKiBAcmV0dXJuIHtTdHJpbmd9IE5ldyBzdHJpbmcgd2l0aCByZW1vdmVkIHdoaXRlc3BhY2UuXG5cdFx0ICovXG5cdFx0dHJpbTogdHJpbSxcblxuXHRcdC8qKlxuXHRcdCAqIEZpbHRlcnMgb3V0IGl0ZW1zIGZyb20gdGhlIGlucHV0IGFycmF5IGJ5IGNhbGxpbmcgdGhlIHNwZWNpZmllZCBmdW5jdGlvbiBmb3IgZWFjaCBpdGVtLlxuXHRcdCAqIElmIHRoZSBmdW5jdGlvbiByZXR1cm5zIGZhbHNlIHRoZSBpdGVtIHdpbGwgYmUgZXhjbHVkZWQgaWYgaXQgcmV0dXJucyB0cnVlIGl0IHdpbGwgYmUgaW5jbHVkZWQuXG5cdFx0ICpcblx0XHQgKiBAc3RhdGljXG5cdFx0ICogQG1ldGhvZCBncmVwXG5cdFx0ICogQHBhcmFtIHtBcnJheX0gYXJyYXkgQXJyYXkgb2YgaXRlbXMgdG8gbG9vcCB0aG91Z2guXG5cdFx0ICogQHBhcmFtIHtmdW5jdGlvbn0gY2FsbGJhY2sgRnVuY3Rpb24gdG8gY2FsbCBmb3IgZWFjaCBpdGVtLiBJbmNsdWRlL2V4Y2x1ZGUgZGVwZW5kcyBvbiBpdCdzIHJldHVybiB2YWx1ZS5cblx0XHQgKiBAcmV0dXJuIHtBcnJheX0gTmV3IGFycmF5IHdpdGggdmFsdWVzIGltcG9ydGVkIGFuZCBmaWx0ZXJlZCBiYXNlZCBpbiBpbnB1dC5cblx0XHQgKiBAZXhhbXBsZVxuXHRcdCAqIC8vIEZpbHRlciBvdXQgc29tZSBpdGVtcywgdGhpcyB3aWxsIHJldHVybiBhbiBhcnJheSB3aXRoIDQgYW5kIDVcblx0XHQgKiB2YXIgaXRlbXMgPSBEb21RdWVyeS5ncmVwKFsxLCAyLCAzLCA0LCA1XSwgZnVuY3Rpb24odikge3JldHVybiB2ID4gMzt9KTtcblx0XHQgKi9cblx0XHRncmVwOiBncmVwLFxuXG5cdFx0Ly8gU2l6emxlXG5cdFx0ZmluZDogU2l6emxlLFxuXHRcdGV4cHI6IFNpenpsZS5zZWxlY3RvcnMsXG5cdFx0dW5pcXVlOiBTaXp6bGUudW5pcXVlU29ydCxcblx0XHR0ZXh0OiBTaXp6bGUuZ2V0VGV4dCxcblx0XHRjb250YWluczogU2l6emxlLmNvbnRhaW5zLFxuXHRcdGZpbHRlcjogZnVuY3Rpb24oZXhwciwgZWxlbXMsIG5vdCkge1xuXHRcdFx0dmFyIGkgPSBlbGVtcy5sZW5ndGg7XG5cblx0XHRcdGlmIChub3QpIHtcblx0XHRcdFx0ZXhwciA9IFwiOm5vdChcIiArIGV4cHIgKyBcIilcIjtcblx0XHRcdH1cblxuXHRcdFx0d2hpbGUgKGktLSkge1xuXHRcdFx0XHRpZiAoZWxlbXNbaV0ubm9kZVR5cGUgIT0gMSkge1xuXHRcdFx0XHRcdGVsZW1zLnNwbGljZShpLCAxKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAoZWxlbXMubGVuZ3RoID09PSAxKSB7XG5cdFx0XHRcdGVsZW1zID0gRG9tUXVlcnkuZmluZC5tYXRjaGVzU2VsZWN0b3IoZWxlbXNbMF0sIGV4cHIpID8gW2VsZW1zWzBdXSA6IFtdO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0ZWxlbXMgPSBEb21RdWVyeS5maW5kLm1hdGNoZXMoZXhwciwgZWxlbXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gZWxlbXM7XG5cdFx0fVxuXHR9KTtcblxuXHRmdW5jdGlvbiBkaXIoZWwsIHByb3AsIHVudGlsKSB7XG5cdFx0dmFyIG1hdGNoZWQgPSBbXSwgY3VyID0gZWxbcHJvcF07XG5cblx0XHRpZiAodHlwZW9mIHVudGlsICE9ICdzdHJpbmcnICYmIHVudGlsIGluc3RhbmNlb2YgRG9tUXVlcnkpIHtcblx0XHRcdHVudGlsID0gdW50aWxbMF07XG5cdFx0fVxuXG5cdFx0d2hpbGUgKGN1ciAmJiBjdXIubm9kZVR5cGUgIT09IDkpIHtcblx0XHRcdGlmICh1bnRpbCAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRcdGlmIChjdXIgPT09IHVudGlsKSB7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mIHVudGlsID09ICdzdHJpbmcnICYmIERvbVF1ZXJ5KGN1cikuaXModW50aWwpKSB7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKGN1ci5ub2RlVHlwZSA9PT0gMSkge1xuXHRcdFx0XHRtYXRjaGVkLnB1c2goY3VyKTtcblx0XHRcdH1cblxuXHRcdFx0Y3VyID0gY3VyW3Byb3BdO1xuXHRcdH1cblxuXHRcdHJldHVybiBtYXRjaGVkO1xuXHR9XG5cblx0ZnVuY3Rpb24gc2libGluZyhub2RlLCBzaWJsaW5nTmFtZSwgbm9kZVR5cGUsIHVudGlsKSB7XG5cdFx0dmFyIHJlc3VsdCA9IFtdO1xuXG5cdFx0aWYgKHVudGlsIGluc3RhbmNlb2YgRG9tUXVlcnkpIHtcblx0XHRcdHVudGlsID0gdW50aWxbMF07XG5cdFx0fVxuXG5cdFx0Zm9yICg7IG5vZGU7IG5vZGUgPSBub2RlW3NpYmxpbmdOYW1lXSkge1xuXHRcdFx0aWYgKG5vZGVUeXBlICYmIG5vZGUubm9kZVR5cGUgIT09IG5vZGVUeXBlKSB7XG5cdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAodW50aWwgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0XHRpZiAobm9kZSA9PT0gdW50aWwpIHtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2YgdW50aWwgPT0gJ3N0cmluZycgJiYgRG9tUXVlcnkobm9kZSkuaXModW50aWwpKSB7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0cmVzdWx0LnB1c2gobm9kZSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJlc3VsdDtcblx0fVxuXG5cdGZ1bmN0aW9uIGZpcnN0U2libGluZyhub2RlLCBzaWJsaW5nTmFtZSwgbm9kZVR5cGUpIHtcblx0XHRmb3IgKG5vZGUgPSBub2RlW3NpYmxpbmdOYW1lXTsgbm9kZTsgbm9kZSA9IG5vZGVbc2libGluZ05hbWVdKSB7XG5cdFx0XHRpZiAobm9kZS5ub2RlVHlwZSA9PSBub2RlVHlwZSkge1xuXHRcdFx0XHRyZXR1cm4gbm9kZTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gbnVsbDtcblx0fVxuXG5cdGVhY2goe1xuXHRcdC8qKlxuXHRcdCAqIFJldHVybnMgYSBuZXcgY29sbGVjdGlvbiB3aXRoIHRoZSBwYXJlbnQgb2YgZWFjaCBpdGVtIGluIGN1cnJlbnQgY29sbGVjdGlvbiBtYXRjaGluZyB0aGUgb3B0aW9uYWwgc2VsZWN0b3IuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHBhcmVudFxuXHRcdCAqIEBwYXJhbSB7RWxlbWVudC90aW55bWNlLmRvbS5Eb21RdWVyeX0gbm9kZSBOb2RlIHRvIG1hdGNoIHBhcmVudHMgYWdhaW5zdC5cblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLmRvbS5Eb21RdWVyeX0gTmV3IERvbVF1ZXJ5IGluc3RhbmNlIHdpdGggYWxsIG1hdGNoaW5nIHBhcmVudHMuXG5cdFx0ICovXG5cdFx0cGFyZW50OiBmdW5jdGlvbihub2RlKSB7XG5cdFx0XHR2YXIgcGFyZW50ID0gbm9kZS5wYXJlbnROb2RlO1xuXG5cdFx0XHRyZXR1cm4gcGFyZW50ICYmIHBhcmVudC5ub2RlVHlwZSAhPT0gMTEgPyBwYXJlbnQgOiBudWxsO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZXR1cm5zIGEgbmV3IGNvbGxlY3Rpb24gd2l0aCB0aGUgYWxsIHRoZSBwYXJlbnRzIG9mIGVhY2ggaXRlbSBpbiBjdXJyZW50IGNvbGxlY3Rpb24gbWF0Y2hpbmcgdGhlIG9wdGlvbmFsIHNlbGVjdG9yLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBwYXJlbnRzXG5cdFx0ICogQHBhcmFtIHtFbGVtZW50L3RpbnltY2UuZG9tLkRvbVF1ZXJ5fSBub2RlIE5vZGUgdG8gbWF0Y2ggcGFyZW50cyBhZ2FpbnN0LlxuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UuZG9tLkRvbVF1ZXJ5fSBOZXcgRG9tUXVlcnkgaW5zdGFuY2Ugd2l0aCBhbGwgbWF0Y2hpbmcgcGFyZW50cy5cblx0XHQgKi9cblx0XHRwYXJlbnRzOiBmdW5jdGlvbihub2RlKSB7XG5cdFx0XHRyZXR1cm4gZGlyKG5vZGUsIFwicGFyZW50Tm9kZVwiKTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyBhIG5ldyBjb2xsZWN0aW9uIHdpdGggbmV4dCBzaWJsaW5nIG9mIGVhY2ggaXRlbSBpbiBjdXJyZW50IGNvbGxlY3Rpb24gbWF0Y2hpbmcgdGhlIG9wdGlvbmFsIHNlbGVjdG9yLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBuZXh0XG5cdFx0ICogQHBhcmFtIHtFbGVtZW50L3RpbnltY2UuZG9tLkRvbVF1ZXJ5fSBub2RlIE5vZGUgdG8gbWF0Y2ggdGhlIG5leHQgZWxlbWVudCBhZ2FpbnN0LlxuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UuZG9tLkRvbVF1ZXJ5fSBOZXcgRG9tUXVlcnkgaW5zdGFuY2Ugd2l0aCBhbGwgbWF0Y2hpbmcgZWxlbWVudHMuXG5cdFx0ICovXG5cdFx0bmV4dDogZnVuY3Rpb24obm9kZSkge1xuXHRcdFx0cmV0dXJuIGZpcnN0U2libGluZyhub2RlLCAnbmV4dFNpYmxpbmcnLCAxKTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyBhIG5ldyBjb2xsZWN0aW9uIHdpdGggcHJldmlvdXMgc2libGluZyBvZiBlYWNoIGl0ZW0gaW4gY3VycmVudCBjb2xsZWN0aW9uIG1hdGNoaW5nIHRoZSBvcHRpb25hbCBzZWxlY3Rvci5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgcHJldlxuXHRcdCAqIEBwYXJhbSB7RWxlbWVudC90aW55bWNlLmRvbS5Eb21RdWVyeX0gbm9kZSBOb2RlIHRvIG1hdGNoIHRoZSBwcmV2aW91cyBlbGVtZW50IGFnYWluc3QuXG5cdFx0ICogQHJldHVybiB7dGlueW1jZS5kb20uRG9tUXVlcnl9IE5ldyBEb21RdWVyeSBpbnN0YW5jZSB3aXRoIGFsbCBtYXRjaGluZyBlbGVtZW50cy5cblx0XHQgKi9cblx0XHRwcmV2OiBmdW5jdGlvbihub2RlKSB7XG5cdFx0XHRyZXR1cm4gZmlyc3RTaWJsaW5nKG5vZGUsICdwcmV2aW91c1NpYmxpbmcnLCAxKTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyBhbGwgY2hpbGQgZWxlbWVudHMgbWF0Y2hpbmcgdGhlIG9wdGlvbmFsIHNlbGVjdG9yLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBjaGlsZHJlblxuXHRcdCAqIEBwYXJhbSB7RWxlbWVudC90aW55bWNlLmRvbS5Eb21RdWVyeX0gbm9kZSBOb2RlIHRvIG1hdGNoIHRoZSBlbGVtZW50cyBhZ2FpbnN0LlxuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UuZG9tLkRvbVF1ZXJ5fSBOZXcgRG9tUXVlcnkgaW5zdGFuY2Ugd2l0aCBhbGwgbWF0Y2hpbmcgZWxlbWVudHMuXG5cdFx0ICovXG5cdFx0Y2hpbGRyZW46IGZ1bmN0aW9uKG5vZGUpIHtcblx0XHRcdHJldHVybiBzaWJsaW5nKG5vZGUuZmlyc3RDaGlsZCwgJ25leHRTaWJsaW5nJywgMSk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFJldHVybnMgYWxsIGNoaWxkIG5vZGVzIG1hdGNoaW5nIHRoZSBvcHRpb25hbCBzZWxlY3Rvci5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgY29udGVudHNcblx0XHQgKiBAcGFyYW0ge0VsZW1lbnQvdGlueW1jZS5kb20uRG9tUXVlcnl9IG5vZGUgTm9kZSB0byBnZXQgdGhlIGNvbnRlbnRzIG9mLlxuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UuZG9tLkRvbVF1ZXJ5fSBOZXcgRG9tUXVlcnkgaW5zdGFuY2Ugd2l0aCBhbGwgbWF0Y2hpbmcgZWxlbWVudHMuXG5cdFx0ICovXG5cdFx0Y29udGVudHM6IGZ1bmN0aW9uKG5vZGUpIHtcblx0XHRcdHJldHVybiBUb29scy50b0FycmF5KChub2RlLm5vZGVOYW1lID09PSBcImlmcmFtZVwiID8gbm9kZS5jb250ZW50RG9jdW1lbnQgfHwgbm9kZS5jb250ZW50V2luZG93LmRvY3VtZW50IDogbm9kZSkuY2hpbGROb2Rlcyk7XG5cdFx0fVxuXHR9LCBmdW5jdGlvbihuYW1lLCBmbikge1xuXHRcdERvbVF1ZXJ5LmZuW25hbWVdID0gZnVuY3Rpb24oc2VsZWN0b3IpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgcmVzdWx0ID0gW107XG5cblx0XHRcdHNlbGYuZWFjaChmdW5jdGlvbigpIHtcblx0XHRcdFx0dmFyIG5vZGVzID0gZm4uY2FsbChyZXN1bHQsIHRoaXMsIHNlbGVjdG9yLCByZXN1bHQpO1xuXG5cdFx0XHRcdGlmIChub2Rlcykge1xuXHRcdFx0XHRcdGlmIChEb21RdWVyeS5pc0FycmF5KG5vZGVzKSkge1xuXHRcdFx0XHRcdFx0cmVzdWx0LnB1c2guYXBwbHkocmVzdWx0LCBub2Rlcyk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdHJlc3VsdC5wdXNoKG5vZGVzKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHQvLyBJZiB0cmF2ZXJzaW5nIG9uIG11bHRpcGxlIGVsZW1lbnRzIHdlIG1pZ2h0IGdldCB0aGUgc2FtZSBlbGVtZW50cyB0d2ljZVxuXHRcdFx0aWYgKHRoaXMubGVuZ3RoID4gMSkge1xuXHRcdFx0XHRpZiAoIXNraXBVbmlxdWVzW25hbWVdKSB7XG5cdFx0XHRcdFx0cmVzdWx0ID0gRG9tUXVlcnkudW5pcXVlKHJlc3VsdCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAobmFtZS5pbmRleE9mKCdwYXJlbnRzJykgPT09IDApIHtcblx0XHRcdFx0XHRyZXN1bHQgPSByZXN1bHQucmV2ZXJzZSgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHJlc3VsdCA9IERvbVF1ZXJ5KHJlc3VsdCk7XG5cblx0XHRcdGlmIChzZWxlY3Rvcikge1xuXHRcdFx0XHRyZXR1cm4gcmVzdWx0LmZpbHRlcihzZWxlY3Rvcik7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiByZXN1bHQ7XG5cdFx0fTtcblx0fSk7XG5cblx0ZWFjaCh7XG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyBhIG5ldyBjb2xsZWN0aW9uIHdpdGggdGhlIGFsbCB0aGUgcGFyZW50cyB1bnRpbCB0aGUgbWF0Y2hpbmcgc2VsZWN0b3IvZWxlbWVudFxuXHRcdCAqIG9mIGVhY2ggaXRlbSBpbiBjdXJyZW50IGNvbGxlY3Rpb24gbWF0Y2hpbmcgdGhlIG9wdGlvbmFsIHNlbGVjdG9yLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBwYXJlbnRzVW50aWxcblx0XHQgKiBAcGFyYW0ge0VsZW1lbnQvdGlueW1jZS5kb20uRG9tUXVlcnl9IG5vZGUgTm9kZSB0byBmaW5kIHBhcmVudCBvZi5cblx0XHQgKiBAcGFyYW0ge1N0cmluZy9FbGVtZW50L3RpbnltY2UuZG9tLkRvbVF1ZXJ5fSB1bnRpbCBVbnRpbCB0aGUgbWF0Y2hpbmcgc2VsZWN0b3Igb3IgZWxlbWVudC5cblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLmRvbS5Eb21RdWVyeX0gTmV3IERvbVF1ZXJ5IGluc3RhbmNlIHdpdGggYWxsIG1hdGNoaW5nIHBhcmVudHMuXG5cdFx0ICovXG5cdFx0cGFyZW50c1VudGlsOiBmdW5jdGlvbihub2RlLCB1bnRpbCkge1xuXHRcdFx0cmV0dXJuIGRpcihub2RlLCBcInBhcmVudE5vZGVcIiwgdW50aWwpO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZXR1cm5zIGEgbmV3IGNvbGxlY3Rpb24gd2l0aCBhbGwgbmV4dCBzaWJsaW5ncyBvZiBlYWNoIGl0ZW0gaW4gY3VycmVudCBjb2xsZWN0aW9uIG1hdGNoaW5nIHRoZSBvcHRpb25hbCBzZWxlY3Rvci5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgbmV4dFVudGlsXG5cdFx0ICogQHBhcmFtIHtFbGVtZW50L3RpbnltY2UuZG9tLkRvbVF1ZXJ5fSBub2RlIE5vZGUgdG8gZmluZCBuZXh0IHNpYmxpbmdzIG9uLlxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nL0VsZW1lbnQvdGlueW1jZS5kb20uRG9tUXVlcnl9IHVudGlsIFVudGlsIHRoZSBtYXRjaGluZyBzZWxlY3RvciBvciBlbGVtZW50LlxuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UuZG9tLkRvbVF1ZXJ5fSBOZXcgRG9tUXVlcnkgaW5zdGFuY2Ugd2l0aCBhbGwgbWF0Y2hpbmcgZWxlbWVudHMuXG5cdFx0ICovXG5cdFx0bmV4dFVudGlsOiBmdW5jdGlvbihub2RlLCB1bnRpbCkge1xuXHRcdFx0cmV0dXJuIHNpYmxpbmcobm9kZSwgJ25leHRTaWJsaW5nJywgMSwgdW50aWwpLnNsaWNlKDEpO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZXR1cm5zIGEgbmV3IGNvbGxlY3Rpb24gd2l0aCBhbGwgcHJldmlvdXMgc2libGluZ3Mgb2YgZWFjaCBpdGVtIGluIGN1cnJlbnQgY29sbGVjdGlvbiBtYXRjaGluZyB0aGUgb3B0aW9uYWwgc2VsZWN0b3IuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHByZXZVbnRpbFxuXHRcdCAqIEBwYXJhbSB7RWxlbWVudC90aW55bWNlLmRvbS5Eb21RdWVyeX0gbm9kZSBOb2RlIHRvIGZpbmQgcHJldmlvdXMgc2libGluZ3Mgb24uXG5cdFx0ICogQHBhcmFtIHtTdHJpbmcvRWxlbWVudC90aW55bWNlLmRvbS5Eb21RdWVyeX0gdW50aWwgVW50aWwgdGhlIG1hdGNoaW5nIHNlbGVjdG9yIG9yIGVsZW1lbnQuXG5cdFx0ICogQHJldHVybiB7dGlueW1jZS5kb20uRG9tUXVlcnl9IE5ldyBEb21RdWVyeSBpbnN0YW5jZSB3aXRoIGFsbCBtYXRjaGluZyBlbGVtZW50cy5cblx0XHQgKi9cblx0XHRwcmV2VW50aWw6IGZ1bmN0aW9uKG5vZGUsIHVudGlsKSB7XG5cdFx0XHRyZXR1cm4gc2libGluZyhub2RlLCAncHJldmlvdXNTaWJsaW5nJywgMSwgdW50aWwpLnNsaWNlKDEpO1xuXHRcdH1cblx0fSwgZnVuY3Rpb24obmFtZSwgZm4pIHtcblx0XHREb21RdWVyeS5mbltuYW1lXSA9IGZ1bmN0aW9uKHNlbGVjdG9yLCBmaWx0ZXIpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgcmVzdWx0ID0gW107XG5cblx0XHRcdHNlbGYuZWFjaChmdW5jdGlvbigpIHtcblx0XHRcdFx0dmFyIG5vZGVzID0gZm4uY2FsbChyZXN1bHQsIHRoaXMsIHNlbGVjdG9yLCByZXN1bHQpO1xuXG5cdFx0XHRcdGlmIChub2Rlcykge1xuXHRcdFx0XHRcdGlmIChEb21RdWVyeS5pc0FycmF5KG5vZGVzKSkge1xuXHRcdFx0XHRcdFx0cmVzdWx0LnB1c2guYXBwbHkocmVzdWx0LCBub2Rlcyk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdHJlc3VsdC5wdXNoKG5vZGVzKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHQvLyBJZiB0cmF2ZXJzaW5nIG9uIG11bHRpcGxlIGVsZW1lbnRzIHdlIG1pZ2h0IGdldCB0aGUgc2FtZSBlbGVtZW50cyB0d2ljZVxuXHRcdFx0aWYgKHRoaXMubGVuZ3RoID4gMSkge1xuXHRcdFx0XHRyZXN1bHQgPSBEb21RdWVyeS51bmlxdWUocmVzdWx0KTtcblxuXHRcdFx0XHRpZiAobmFtZS5pbmRleE9mKCdwYXJlbnRzJykgPT09IDAgfHwgbmFtZSA9PT0gJ3ByZXZVbnRpbCcpIHtcblx0XHRcdFx0XHRyZXN1bHQgPSByZXN1bHQucmV2ZXJzZSgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHJlc3VsdCA9IERvbVF1ZXJ5KHJlc3VsdCk7XG5cblx0XHRcdGlmIChmaWx0ZXIpIHtcblx0XHRcdFx0cmV0dXJuIHJlc3VsdC5maWx0ZXIoZmlsdGVyKTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHJlc3VsdDtcblx0XHR9O1xuXHR9KTtcblxuXHQvKipcblx0ICogUmV0dXJucyB0cnVlL2ZhbHNlIGlmIHRoZSBjdXJyZW50IHNldCBpdGVtcyBtYXRjaGVzIHRoZSBzZWxlY3Rvci5cblx0ICpcblx0ICogQG1ldGhvZCBpc1xuXHQgKiBAcGFyYW0ge1N0cmluZ30gc2VsZWN0b3IgU2VsZWN0b3IgdG8gbWF0Y2ggdGhlIGVsZW1lbnRzIGFnYWluc3QuXG5cdCAqIEByZXR1cm4ge0Jvb2xlYW59IFRydWUvZmFsc2UgaWYgdGhlIGN1cnJlbnQgc2V0IG1hdGNoZXMgdGhlIHNlbGVjdG9yLlxuXHQgKi9cblx0RG9tUXVlcnkuZm4uaXMgPSBmdW5jdGlvbihzZWxlY3Rvcikge1xuXHRcdHJldHVybiAhIXNlbGVjdG9yICYmIHRoaXMuZmlsdGVyKHNlbGVjdG9yKS5sZW5ndGggPiAwO1xuXHR9O1xuXG5cdERvbVF1ZXJ5LmZuLmluaXQucHJvdG90eXBlID0gRG9tUXVlcnkuZm47XG5cblx0RG9tUXVlcnkub3ZlcnJpZGVEZWZhdWx0cyA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG5cdFx0dmFyIGRlZmF1bHRzO1xuXG5cdFx0ZnVuY3Rpb24gc3ViKHNlbGVjdG9yLCBjb250ZXh0KSB7XG5cdFx0XHRkZWZhdWx0cyA9IGRlZmF1bHRzIHx8IGNhbGxiYWNrKCk7XG5cblx0XHRcdGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAwKSB7XG5cdFx0XHRcdHNlbGVjdG9yID0gZGVmYXVsdHMuZWxlbWVudDtcblx0XHRcdH1cblxuXHRcdFx0aWYgKCFjb250ZXh0KSB7XG5cdFx0XHRcdGNvbnRleHQgPSBkZWZhdWx0cy5jb250ZXh0O1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbmV3IHN1Yi5mbi5pbml0KHNlbGVjdG9yLCBjb250ZXh0KTtcblx0XHR9XG5cblx0XHREb21RdWVyeS5leHRlbmQoc3ViLCB0aGlzKTtcblxuXHRcdHJldHVybiBzdWI7XG5cdH07XG5cblx0ZnVuY3Rpb24gYXBwZW5kSG9va3ModGFyZ2V0SG9va3MsIHByb3AsIGhvb2tzKSB7XG5cdFx0ZWFjaChob29rcywgZnVuY3Rpb24obmFtZSwgZnVuYykge1xuXHRcdFx0dGFyZ2V0SG9va3NbbmFtZV0gPSB0YXJnZXRIb29rc1tuYW1lXSB8fCB7fTtcblx0XHRcdHRhcmdldEhvb2tzW25hbWVdW3Byb3BdID0gZnVuYztcblx0XHR9KTtcblx0fVxuXG5cdGlmIChFbnYuaWUgJiYgRW52LmllIDwgOCkge1xuXHRcdGFwcGVuZEhvb2tzKGF0dHJIb29rcywgJ2dldCcsIHtcblx0XHRcdG1heGxlbmd0aDogZnVuY3Rpb24oZWxtKSB7XG5cdFx0XHRcdHZhciB2YWx1ZSA9IGVsbS5tYXhMZW5ndGg7XG5cblx0XHRcdFx0aWYgKHZhbHVlID09PSAweDdmZmZmZmZmKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHVuZGVmO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0fSxcblxuXHRcdFx0c2l6ZTogZnVuY3Rpb24oZWxtKSB7XG5cdFx0XHRcdHZhciB2YWx1ZSA9IGVsbS5zaXplO1xuXG5cdFx0XHRcdGlmICh2YWx1ZSA9PT0gMjApIHtcblx0XHRcdFx0XHRyZXR1cm4gdW5kZWY7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHR9LFxuXG5cdFx0XHQnY2xhc3MnOiBmdW5jdGlvbihlbG0pIHtcblx0XHRcdFx0cmV0dXJuIGVsbS5jbGFzc05hbWU7XG5cdFx0XHR9LFxuXG5cdFx0XHRzdHlsZTogZnVuY3Rpb24oZWxtKSB7XG5cdFx0XHRcdHZhciB2YWx1ZSA9IGVsbS5zdHlsZS5jc3NUZXh0O1xuXG5cdFx0XHRcdGlmICh2YWx1ZS5sZW5ndGggPT09IDApIHtcblx0XHRcdFx0XHRyZXR1cm4gdW5kZWY7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRhcHBlbmRIb29rcyhhdHRySG9va3MsICdzZXQnLCB7XG5cdFx0XHQnY2xhc3MnOiBmdW5jdGlvbihlbG0sIHZhbHVlKSB7XG5cdFx0XHRcdGVsbS5jbGFzc05hbWUgPSB2YWx1ZTtcblx0XHRcdH0sXG5cblx0XHRcdHN0eWxlOiBmdW5jdGlvbihlbG0sIHZhbHVlKSB7XG5cdFx0XHRcdGVsbS5zdHlsZS5jc3NUZXh0ID0gdmFsdWU7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cblxuXHRpZiAoRW52LmllICYmIEVudi5pZSA8IDkpIHtcblx0XHQvKmpzaGludCBzdWI6dHJ1ZSAqL1xuXHRcdC8qZXNsaW50IGRvdC1ub3RhdGlvbjogMCovXG5cdFx0Y3NzRml4WydmbG9hdCddID0gJ3N0eWxlRmxvYXQnO1xuXG5cdFx0YXBwZW5kSG9va3MoY3NzSG9va3MsICdzZXQnLCB7XG5cdFx0XHRvcGFjaXR5OiBmdW5jdGlvbihlbG0sIHZhbHVlKSB7XG5cdFx0XHRcdHZhciBzdHlsZSA9IGVsbS5zdHlsZTtcblxuXHRcdFx0XHRpZiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09ICcnKSB7XG5cdFx0XHRcdFx0c3R5bGUucmVtb3ZlQXR0cmlidXRlKCdmaWx0ZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRzdHlsZS56b29tID0gMTtcblx0XHRcdFx0XHRzdHlsZS5maWx0ZXIgPSAnYWxwaGEob3BhY2l0eT0nICsgKHZhbHVlICogMTAwKSArICcpJztcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cblx0RG9tUXVlcnkuYXR0ckhvb2tzID0gYXR0ckhvb2tzO1xuXHREb21RdWVyeS5jc3NIb29rcyA9IGNzc0hvb2tzO1xuXG5cdHJldHVybiBEb21RdWVyeTtcbn0pO1xuXG4vLyBJbmNsdWRlZCBmcm9tOiBqcy90aW55bWNlL2NsYXNzZXMvaHRtbC9TdHlsZXMuanNcblxuLyoqXG4gKiBTdHlsZXMuanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBUaGlzIGNsYXNzIGlzIHVzZWQgdG8gcGFyc2UgQ1NTIHN0eWxlcyBpdCBhbHNvIGNvbXByZXNzZXMgc3R5bGVzIHRvIHJlZHVjZSB0aGUgb3V0cHV0IHNpemUuXG4gKlxuICogQGV4YW1wbGVcbiAqIHZhciBTdHlsZXMgPSBuZXcgdGlueW1jZS5odG1sLlN0eWxlcyh7XG4gKiAgICB1cmxfY29udmVydGVyOiBmdW5jdGlvbih1cmwpIHtcbiAqICAgICAgIHJldHVybiB1cmw7XG4gKiAgICB9XG4gKiB9KTtcbiAqXG4gKiBzdHlsZXMgPSBTdHlsZXMucGFyc2UoJ2JvcmRlcjogMXB4IHNvbGlkIHJlZCcpO1xuICogc3R5bGVzLmNvbG9yID0gJ3JlZCc7XG4gKlxuICogY29uc29sZS5sb2cobmV3IHRpbnltY2UuaHRtbC5TdHlsZVNlcmlhbGl6ZXIoKS5zZXJpYWxpemUoc3R5bGVzKSk7XG4gKlxuICogQGNsYXNzIHRpbnltY2UuaHRtbC5TdHlsZXNcbiAqIEB2ZXJzaW9uIDMuNFxuICovXG5kZWZpbmUoXCJ0aW55bWNlL2h0bWwvU3R5bGVzXCIsIFtdLCBmdW5jdGlvbigpIHtcblx0cmV0dXJuIGZ1bmN0aW9uKHNldHRpbmdzLCBzY2hlbWEpIHtcblx0XHQvKmpzaGludCBtYXhsZW46MjU1ICovXG5cdFx0Lyplc2xpbnQgbWF4LWxlbjowICovXG5cdFx0dmFyIHJnYlJlZ0V4cCA9IC9yZ2JcXHMqXFwoXFxzKihbMC05XSspXFxzKixcXHMqKFswLTldKylcXHMqLFxccyooWzAtOV0rKVxccypcXCkvZ2ksXG5cdFx0XHR1cmxPclN0clJlZ0V4cCA9IC8oPzp1cmwoPzooPzpcXChcXHMqXFxcIihbXlxcXCJdKylcXFwiXFxzKlxcKSl8KD86XFwoXFxzKlxcJyhbXlxcJ10rKVxcJ1xccypcXCkpfCg/OlxcKFxccyooW14pXFxzXSspXFxzKlxcKSkpKXwoPzpcXCcoW15cXCddKylcXCcpfCg/OlxcXCIoW15cXFwiXSspXFxcIikvZ2ksXG5cdFx0XHRzdHlsZVJlZ0V4cCA9IC9cXHMqKFteOl0rKTpcXHMqKFteO10rKTs/L2csXG5cdFx0XHR0cmltUmlnaHRSZWdFeHAgPSAvXFxzKyQvLFxuXHRcdFx0aSwgZW5jb2RpbmdMb29rdXAgPSB7fSwgZW5jb2RpbmdJdGVtcywgdmFsaWRTdHlsZXMsIGludmFsaWRTdHlsZXMsIGludmlzaWJsZUNoYXIgPSAnXFx1RkVGRic7XG5cblx0XHRzZXR0aW5ncyA9IHNldHRpbmdzIHx8IHt9O1xuXG5cdFx0aWYgKHNjaGVtYSkge1xuXHRcdFx0dmFsaWRTdHlsZXMgPSBzY2hlbWEuZ2V0VmFsaWRTdHlsZXMoKTtcblx0XHRcdGludmFsaWRTdHlsZXMgPSBzY2hlbWEuZ2V0SW52YWxpZFN0eWxlcygpO1xuXHRcdH1cblxuXHRcdGVuY29kaW5nSXRlbXMgPSAoJ1xcXFxcIiBcXFxcXFwnIFxcXFw7IFxcXFw6IDsgOiAnICsgaW52aXNpYmxlQ2hhcikuc3BsaXQoJyAnKTtcblx0XHRmb3IgKGkgPSAwOyBpIDwgZW5jb2RpbmdJdGVtcy5sZW5ndGg7IGkrKykge1xuXHRcdFx0ZW5jb2RpbmdMb29rdXBbZW5jb2RpbmdJdGVtc1tpXV0gPSBpbnZpc2libGVDaGFyICsgaTtcblx0XHRcdGVuY29kaW5nTG9va3VwW2ludmlzaWJsZUNoYXIgKyBpXSA9IGVuY29kaW5nSXRlbXNbaV07XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gdG9IZXgobWF0Y2gsIHIsIGcsIGIpIHtcblx0XHRcdGZ1bmN0aW9uIGhleCh2YWwpIHtcblx0XHRcdFx0dmFsID0gcGFyc2VJbnQodmFsLCAxMCkudG9TdHJpbmcoMTYpO1xuXG5cdFx0XHRcdHJldHVybiB2YWwubGVuZ3RoID4gMSA/IHZhbCA6ICcwJyArIHZhbDsgLy8gMCAtPiAwMFxuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gJyMnICsgaGV4KHIpICsgaGV4KGcpICsgaGV4KGIpO1xuXHRcdH1cblxuXHRcdHJldHVybiB7XG5cdFx0XHQvKipcblx0XHRcdCAqIFBhcnNlcyB0aGUgc3BlY2lmaWVkIFJHQiBjb2xvciB2YWx1ZSBhbmQgcmV0dXJucyBhIGhleCB2ZXJzaW9uIG9mIHRoYXQgY29sb3IuXG5cdFx0XHQgKlxuXHRcdFx0ICogQG1ldGhvZCB0b0hleFxuXHRcdFx0ICogQHBhcmFtIHtTdHJpbmd9IGNvbG9yIFJHQiBzdHJpbmcgdmFsdWUgbGlrZSByZ2IoMSwyLDMpXG5cdFx0XHQgKiBAcmV0dXJuIHtTdHJpbmd9IEhleCB2ZXJzaW9uIG9mIHRoYXQgUkdCIHZhbHVlIGxpa2UgI0ZGMDBGRi5cblx0XHRcdCAqL1xuXHRcdFx0dG9IZXg6IGZ1bmN0aW9uKGNvbG9yKSB7XG5cdFx0XHRcdHJldHVybiBjb2xvci5yZXBsYWNlKHJnYlJlZ0V4cCwgdG9IZXgpO1xuXHRcdFx0fSxcblxuXHRcdFx0LyoqXG5cdFx0XHQgKiBQYXJzZXMgdGhlIHNwZWNpZmllZCBzdHlsZSB2YWx1ZSBpbnRvIGFuIG9iamVjdCBjb2xsZWN0aW9uLiBUaGlzIHBhcnNlciB3aWxsIGFsc29cblx0XHRcdCAqIG1lcmdlIGFuZCByZW1vdmUgYW55IHJlZHVuZGFudCBpdGVtcyB0aGF0IGJyb3dzZXJzIG1pZ2h0IGhhdmUgYWRkZWQuIEl0IHdpbGwgYWxzbyBjb252ZXJ0IG5vbiBoZXhcblx0XHRcdCAqIGNvbG9ycyB0byBoZXggdmFsdWVzLiBVcmxzIGluc2lkZSB0aGUgc3R5bGVzIHdpbGwgYWxzbyBiZSBjb252ZXJ0ZWQgdG8gYWJzb2x1dGUvcmVsYXRpdmUgYmFzZWQgb24gc2V0dGluZ3MuXG5cdFx0XHQgKlxuXHRcdFx0ICogQG1ldGhvZCBwYXJzZVxuXHRcdFx0ICogQHBhcmFtIHtTdHJpbmd9IGNzcyBTdHlsZSB2YWx1ZSB0byBwYXJzZSBmb3IgZXhhbXBsZTogYm9yZGVyOjFweCBzb2xpZCByZWQ7LlxuXHRcdFx0ICogQHJldHVybiB7T2JqZWN0fSBPYmplY3QgcmVwcmVzZW50YXRpb24gb2YgdGhhdCBzdHlsZSBsaWtlIHtib3JkZXI6ICcxcHggc29saWQgcmVkJ31cblx0XHRcdCAqL1xuXHRcdFx0cGFyc2U6IGZ1bmN0aW9uKGNzcykge1xuXHRcdFx0XHR2YXIgc3R5bGVzID0ge30sIG1hdGNoZXMsIG5hbWUsIHZhbHVlLCBpc0VuY29kZWQsIHVybENvbnZlcnRlciA9IHNldHRpbmdzLnVybF9jb252ZXJ0ZXI7XG5cdFx0XHRcdHZhciB1cmxDb252ZXJ0ZXJTY29wZSA9IHNldHRpbmdzLnVybF9jb252ZXJ0ZXJfc2NvcGUgfHwgdGhpcztcblxuXHRcdFx0XHRmdW5jdGlvbiBjb21wcmVzcyhwcmVmaXgsIHN1ZmZpeCwgbm9Kb2luKSB7XG5cdFx0XHRcdFx0dmFyIHRvcCwgcmlnaHQsIGJvdHRvbSwgbGVmdDtcblxuXHRcdFx0XHRcdHRvcCA9IHN0eWxlc1twcmVmaXggKyAnLXRvcCcgKyBzdWZmaXhdO1xuXHRcdFx0XHRcdGlmICghdG9wKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmlnaHQgPSBzdHlsZXNbcHJlZml4ICsgJy1yaWdodCcgKyBzdWZmaXhdO1xuXHRcdFx0XHRcdGlmICghcmlnaHQpIHtcblx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRib3R0b20gPSBzdHlsZXNbcHJlZml4ICsgJy1ib3R0b20nICsgc3VmZml4XTtcblx0XHRcdFx0XHRpZiAoIWJvdHRvbSkge1xuXHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGxlZnQgPSBzdHlsZXNbcHJlZml4ICsgJy1sZWZ0JyArIHN1ZmZpeF07XG5cdFx0XHRcdFx0aWYgKCFsZWZ0KSB7XG5cdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0dmFyIGJveCA9IFt0b3AsIHJpZ2h0LCBib3R0b20sIGxlZnRdO1xuXHRcdFx0XHRcdGkgPSBib3gubGVuZ3RoIC0gMTtcblx0XHRcdFx0XHR3aGlsZSAoaS0tKSB7XG5cdFx0XHRcdFx0XHRpZiAoYm94W2ldICE9PSBib3hbaSArIDFdKSB7XG5cdFx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmIChpID4gLTEgJiYgbm9Kb2luKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0c3R5bGVzW3ByZWZpeCArIHN1ZmZpeF0gPSBpID09IC0xID8gYm94WzBdIDogYm94LmpvaW4oJyAnKTtcblx0XHRcdFx0XHRkZWxldGUgc3R5bGVzW3ByZWZpeCArICctdG9wJyArIHN1ZmZpeF07XG5cdFx0XHRcdFx0ZGVsZXRlIHN0eWxlc1twcmVmaXggKyAnLXJpZ2h0JyArIHN1ZmZpeF07XG5cdFx0XHRcdFx0ZGVsZXRlIHN0eWxlc1twcmVmaXggKyAnLWJvdHRvbScgKyBzdWZmaXhdO1xuXHRcdFx0XHRcdGRlbGV0ZSBzdHlsZXNbcHJlZml4ICsgJy1sZWZ0JyArIHN1ZmZpeF07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvKipcblx0XHRcdFx0ICogQ2hlY2tzIGlmIHRoZSBzcGVjaWZpYyBzdHlsZSBjYW4gYmUgY29tcHJlc3NlZCBpbiBvdGhlciB3b3JkcyBpZiBhbGwgYm9yZGVyLXdpZHRoIGFyZSBlcXVhbC5cblx0XHRcdFx0ICovXG5cdFx0XHRcdGZ1bmN0aW9uIGNhbkNvbXByZXNzKGtleSkge1xuXHRcdFx0XHRcdHZhciB2YWx1ZSA9IHN0eWxlc1trZXldLCBpO1xuXG5cdFx0XHRcdFx0aWYgKCF2YWx1ZSkge1xuXHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHZhbHVlID0gdmFsdWUuc3BsaXQoJyAnKTtcblx0XHRcdFx0XHRpID0gdmFsdWUubGVuZ3RoO1xuXHRcdFx0XHRcdHdoaWxlIChpLS0pIHtcblx0XHRcdFx0XHRcdGlmICh2YWx1ZVtpXSAhPT0gdmFsdWVbMF0pIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHN0eWxlc1trZXldID0gdmFsdWVbMF07XG5cblx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8qKlxuXHRcdFx0XHQgKiBDb21wcmVzc2VzIG11bHRpcGxlIHN0eWxlcyBpbnRvIG9uZSBzdHlsZS5cblx0XHRcdFx0ICovXG5cdFx0XHRcdGZ1bmN0aW9uIGNvbXByZXNzMih0YXJnZXQsIGEsIGIsIGMpIHtcblx0XHRcdFx0XHRpZiAoIWNhbkNvbXByZXNzKGEpKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKCFjYW5Db21wcmVzcyhiKSkge1xuXHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICghY2FuQ29tcHJlc3MoYykpIHtcblx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHQvLyBDb21wcmVzc1xuXHRcdFx0XHRcdHN0eWxlc1t0YXJnZXRdID0gc3R5bGVzW2FdICsgJyAnICsgc3R5bGVzW2JdICsgJyAnICsgc3R5bGVzW2NdO1xuXHRcdFx0XHRcdGRlbGV0ZSBzdHlsZXNbYV07XG5cdFx0XHRcdFx0ZGVsZXRlIHN0eWxlc1tiXTtcblx0XHRcdFx0XHRkZWxldGUgc3R5bGVzW2NdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gRW5jb2RlcyB0aGUgc3BlY2lmaWVkIHN0cmluZyBieSByZXBsYWNpbmcgYWxsIFxcXCIgXFwnIDsgOiB3aXRoIF88bnVtPlxuXHRcdFx0XHRmdW5jdGlvbiBlbmNvZGUoc3RyKSB7XG5cdFx0XHRcdFx0aXNFbmNvZGVkID0gdHJ1ZTtcblxuXHRcdFx0XHRcdHJldHVybiBlbmNvZGluZ0xvb2t1cFtzdHJdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gRGVjb2RlcyB0aGUgc3BlY2lmaWVkIHN0cmluZyBieSByZXBsYWNpbmcgYWxsIF88bnVtPiB3aXRoIGl0J3Mgb3JpZ2luYWwgdmFsdWUgXFxcIiBcXCcgZXRjXG5cdFx0XHRcdC8vIEl0IHdpbGwgYWxzbyBkZWNvZGUgdGhlIFxcXCIgXFwnIGlmIGtlZXBfc2xhc2hlcyBpcyBzZXQgdG8gZmFsZSBvciBvbWl0dGVkXG5cdFx0XHRcdGZ1bmN0aW9uIGRlY29kZShzdHIsIGtlZXBfc2xhc2hlcykge1xuXHRcdFx0XHRcdGlmIChpc0VuY29kZWQpIHtcblx0XHRcdFx0XHRcdHN0ciA9IHN0ci5yZXBsYWNlKC9cXHVGRUZGWzAtOV0vZywgZnVuY3Rpb24oc3RyKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiBlbmNvZGluZ0xvb2t1cFtzdHJdO1xuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKCFrZWVwX3NsYXNoZXMpIHtcblx0XHRcdFx0XHRcdHN0ciA9IHN0ci5yZXBsYWNlKC9cXFxcKFtcXCdcXFwiOzpdKS9nLCBcIiQxXCIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBzdHI7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRmdW5jdGlvbiBkZWNvZGVTaW5nbGVIZXhTZXF1ZW5jZShlc2NTZXEpIHtcblx0XHRcdFx0XHRyZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZShwYXJzZUludChlc2NTZXEuc2xpY2UoMSksIDE2KSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRmdW5jdGlvbiBkZWNvZGVIZXhTZXF1ZW5jZXModmFsdWUpIHtcblx0XHRcdFx0XHRyZXR1cm4gdmFsdWUucmVwbGFjZSgvXFxcXFswLTlhLWZdKy9naSwgZGVjb2RlU2luZ2xlSGV4U2VxdWVuY2UpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0ZnVuY3Rpb24gcHJvY2Vzc1VybChtYXRjaCwgdXJsLCB1cmwyLCB1cmwzLCBzdHIsIHN0cjIpIHtcblx0XHRcdFx0XHRzdHIgPSBzdHIgfHwgc3RyMjtcblxuXHRcdFx0XHRcdGlmIChzdHIpIHtcblx0XHRcdFx0XHRcdHN0ciA9IGRlY29kZShzdHIpO1xuXG5cdFx0XHRcdFx0XHQvLyBGb3JjZSBzdHJpbmdzIGludG8gc2luZ2xlIHF1b3RlIGZvcm1hdFxuXHRcdFx0XHRcdFx0cmV0dXJuIFwiJ1wiICsgc3RyLnJlcGxhY2UoL1xcJy9nLCBcIlxcXFwnXCIpICsgXCInXCI7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0dXJsID0gZGVjb2RlKHVybCB8fCB1cmwyIHx8IHVybDMpO1xuXG5cdFx0XHRcdFx0aWYgKCFzZXR0aW5ncy5hbGxvd19zY3JpcHRfdXJscykge1xuXHRcdFx0XHRcdFx0dmFyIHNjcmlwdFVybCA9IHVybC5yZXBsYWNlKC9bXFxzXFxyXFxuXSsvZywgJycpO1xuXG5cdFx0XHRcdFx0XHRpZiAoLyhqYXZhfHZiKXNjcmlwdDovaS50ZXN0KHNjcmlwdFVybCkpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIFwiXCI7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGlmICghc2V0dGluZ3MuYWxsb3dfc3ZnX2RhdGFfdXJscyAmJiAvXmRhdGE6aW1hZ2VcXC9zdmcvaS50ZXN0KHNjcmlwdFVybCkpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIFwiXCI7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Ly8gQ29udmVydCB0aGUgVVJMIHRvIHJlbGF0aXZlL2Fic29sdXRlIGRlcGVuZGluZyBvbiBjb25maWdcblx0XHRcdFx0XHRpZiAodXJsQ29udmVydGVyKSB7XG5cdFx0XHRcdFx0XHR1cmwgPSB1cmxDb252ZXJ0ZXIuY2FsbCh1cmxDb252ZXJ0ZXJTY29wZSwgdXJsLCAnc3R5bGUnKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHQvLyBPdXRwdXQgbmV3IFVSTCBmb3JtYXRcblx0XHRcdFx0XHRyZXR1cm4gXCJ1cmwoJ1wiICsgdXJsLnJlcGxhY2UoL1xcJy9nLCBcIlxcXFwnXCIpICsgXCInKVwiO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKGNzcykge1xuXHRcdFx0XHRcdGNzcyA9IGNzcy5yZXBsYWNlKC9bXFx1MDAwMC1cXHUwMDFGXS9nLCAnJyk7XG5cblx0XHRcdFx0XHQvLyBFbmNvZGUgXFxcIiBcXCcgJSBhbmQgOyBhbmQgOiBpbnNpZGUgc3RyaW5ncyBzbyB0aGV5IGRvbid0IGludGVyZmVyZSB3aXRoIHRoZSBzdHlsZSBwYXJzaW5nXG5cdFx0XHRcdFx0Y3NzID0gY3NzLnJlcGxhY2UoL1xcXFxbXFxcIlxcJzs6XFx1RkVGRl0vZywgZW5jb2RlKS5yZXBsYWNlKC9cXFwiW15cXFwiXStcXFwifFxcJ1teXFwnXStcXCcvZywgZnVuY3Rpb24oc3RyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gc3RyLnJlcGxhY2UoL1s7Ol0vZywgZW5jb2RlKTtcblx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdC8vIFBhcnNlIHN0eWxlc1xuXHRcdFx0XHRcdHdoaWxlICgobWF0Y2hlcyA9IHN0eWxlUmVnRXhwLmV4ZWMoY3NzKSkpIHtcblx0XHRcdFx0XHRcdHN0eWxlUmVnRXhwLmxhc3RJbmRleCA9IG1hdGNoZXMuaW5kZXggKyBtYXRjaGVzWzBdLmxlbmd0aDtcblx0XHRcdFx0XHRcdG5hbWUgPSBtYXRjaGVzWzFdLnJlcGxhY2UodHJpbVJpZ2h0UmVnRXhwLCAnJykudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0XHRcdHZhbHVlID0gbWF0Y2hlc1syXS5yZXBsYWNlKHRyaW1SaWdodFJlZ0V4cCwgJycpO1xuXG5cdFx0XHRcdFx0XHRpZiAobmFtZSAmJiB2YWx1ZSkge1xuXHRcdFx0XHRcdFx0XHQvLyBEZWNvZGUgZXNjYXBlZCBzZXF1ZW5jZXMgbGlrZSBcXDY1IC0+IGVcblx0XHRcdFx0XHRcdFx0bmFtZSA9IGRlY29kZUhleFNlcXVlbmNlcyhuYW1lKTtcblx0XHRcdFx0XHRcdFx0dmFsdWUgPSBkZWNvZGVIZXhTZXF1ZW5jZXModmFsdWUpO1xuXG5cdFx0XHRcdFx0XHRcdC8vIFNraXAgcHJvcGVydGllcyB3aXRoIGRvdWJsZSBxdW90ZXMgYW5kIHNlcXVlbmNlcyBsaWtlIFxcXCIgXFwnIGluIHRoZWlyIG5hbWVzXG5cdFx0XHRcdFx0XHRcdC8vIFNlZSAnbVhTUyBBdHRhY2tzOiBBdHRhY2tpbmcgd2VsbC1zZWN1cmVkIFdlYi1BcHBsaWNhdGlvbnMgYnkgdXNpbmcgaW5uZXJIVE1MIE11dGF0aW9ucydcblx0XHRcdFx0XHRcdFx0Ly8gaHR0cHM6Ly9jdXJlNTMuZGUvZnAxNzAucGRmXG5cdFx0XHRcdFx0XHRcdGlmIChuYW1lLmluZGV4T2YoaW52aXNpYmxlQ2hhcikgIT09IC0xIHx8IG5hbWUuaW5kZXhPZignXCInKSAhPT0gLTEpIHtcblx0XHRcdFx0XHRcdFx0XHRjb250aW51ZTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdC8vIERvbid0IGFsbG93IGJlaGF2aW9yIG5hbWUgb3IgZXhwcmVzc2lvbi9jb21tZW50cyB3aXRoaW4gdGhlIHZhbHVlc1xuXHRcdFx0XHRcdFx0XHRpZiAoIXNldHRpbmdzLmFsbG93X3NjcmlwdF91cmxzICYmIChuYW1lID09IFwiYmVoYXZpb3JcIiB8fCAvZXhwcmVzc2lvblxccypcXCh8XFwvXFwqfFxcKlxcLy8udGVzdCh2YWx1ZSkpKSB7XG5cdFx0XHRcdFx0XHRcdFx0Y29udGludWU7XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHQvLyBPcGVyYSB3aWxsIHByb2R1Y2UgNzAwIGluc3RlYWQgb2YgYm9sZCBpbiB0aGVpciBzdHlsZSB2YWx1ZXNcblx0XHRcdFx0XHRcdFx0aWYgKG5hbWUgPT09ICdmb250LXdlaWdodCcgJiYgdmFsdWUgPT09ICc3MDAnKSB7XG5cdFx0XHRcdFx0XHRcdFx0dmFsdWUgPSAnYm9sZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAobmFtZSA9PT0gJ2NvbG9yJyB8fCBuYW1lID09PSAnYmFja2dyb3VuZC1jb2xvcicpIHsgLy8gTG93ZXJjYXNlIGNvbG9ycyBsaWtlIFJFRFxuXHRcdFx0XHRcdFx0XHRcdHZhbHVlID0gdmFsdWUudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdC8vIENvbnZlcnQgUkdCIGNvbG9ycyB0byBIRVhcblx0XHRcdFx0XHRcdFx0dmFsdWUgPSB2YWx1ZS5yZXBsYWNlKHJnYlJlZ0V4cCwgdG9IZXgpO1xuXG5cdFx0XHRcdFx0XHRcdC8vIENvbnZlcnQgVVJMcyBhbmQgZm9yY2UgdGhlbSBpbnRvIHVybCgndmFsdWUnKSBmb3JtYXRcblx0XHRcdFx0XHRcdFx0dmFsdWUgPSB2YWx1ZS5yZXBsYWNlKHVybE9yU3RyUmVnRXhwLCBwcm9jZXNzVXJsKTtcblx0XHRcdFx0XHRcdFx0c3R5bGVzW25hbWVdID0gaXNFbmNvZGVkID8gZGVjb2RlKHZhbHVlLCB0cnVlKSA6IHZhbHVlO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHQvLyBDb21wcmVzcyB0aGUgc3R5bGVzIHRvIHJlZHVjZSBpdCdzIHNpemUgZm9yIGV4YW1wbGUgSUUgd2lsbCBleHBhbmQgc3R5bGVzXG5cdFx0XHRcdFx0Y29tcHJlc3MoXCJib3JkZXJcIiwgXCJcIiwgdHJ1ZSk7XG5cdFx0XHRcdFx0Y29tcHJlc3MoXCJib3JkZXJcIiwgXCItd2lkdGhcIik7XG5cdFx0XHRcdFx0Y29tcHJlc3MoXCJib3JkZXJcIiwgXCItY29sb3JcIik7XG5cdFx0XHRcdFx0Y29tcHJlc3MoXCJib3JkZXJcIiwgXCItc3R5bGVcIik7XG5cdFx0XHRcdFx0Y29tcHJlc3MoXCJwYWRkaW5nXCIsIFwiXCIpO1xuXHRcdFx0XHRcdGNvbXByZXNzKFwibWFyZ2luXCIsIFwiXCIpO1xuXHRcdFx0XHRcdGNvbXByZXNzMignYm9yZGVyJywgJ2JvcmRlci13aWR0aCcsICdib3JkZXItc3R5bGUnLCAnYm9yZGVyLWNvbG9yJyk7XG5cblx0XHRcdFx0XHQvLyBSZW1vdmUgcG9pbnRsZXNzIGJvcmRlciwgSUUgcHJvZHVjZXMgdGhlc2Vcblx0XHRcdFx0XHRpZiAoc3R5bGVzLmJvcmRlciA9PT0gJ21lZGl1bSBub25lJykge1xuXHRcdFx0XHRcdFx0ZGVsZXRlIHN0eWxlcy5ib3JkZXI7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Ly8gSUUgMTEgd2lsbCBwcm9kdWNlIGEgYm9yZGVyLWltYWdlOiBub25lIHdoZW4gZ2V0dGluZyB0aGUgc3R5bGUgYXR0cmlidXRlIGZyb20gPHAgc3R5bGU9XCJib3JkZXI6IDFweCBzb2xpZCByZWRcIj48L3A+XG5cdFx0XHRcdFx0Ly8gU28gbGV0IHVzIGFzc3VtZSBpdCBzaG91bGRuJ3QgYmUgdGhlcmVcblx0XHRcdFx0XHRpZiAoc3R5bGVzWydib3JkZXItaW1hZ2UnXSA9PT0gJ25vbmUnKSB7XG5cdFx0XHRcdFx0XHRkZWxldGUgc3R5bGVzWydib3JkZXItaW1hZ2UnXTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gc3R5bGVzO1xuXHRcdFx0fSxcblxuXHRcdFx0LyoqXG5cdFx0XHQgKiBTZXJpYWxpemVzIHRoZSBzcGVjaWZpZWQgc3R5bGUgb2JqZWN0IGludG8gYSBzdHJpbmcuXG5cdFx0XHQgKlxuXHRcdFx0ICogQG1ldGhvZCBzZXJpYWxpemVcblx0XHRcdCAqIEBwYXJhbSB7T2JqZWN0fSBzdHlsZXMgT2JqZWN0IHRvIHNlcmlhbGl6ZSBhcyBzdHJpbmcgZm9yIGV4YW1wbGU6IHtib3JkZXI6ICcxcHggc29saWQgcmVkJ31cblx0XHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBlbGVtZW50TmFtZSBPcHRpb25hbCBlbGVtZW50IG5hbWUsIGlmIHNwZWNpZmllZCBvbmx5IHRoZSBzdHlsZXMgdGhhdCBtYXRjaGVzIHRoZSBzY2hlbWEgd2lsbCBiZSBzZXJpYWxpemVkLlxuXHRcdFx0ICogQHJldHVybiB7U3RyaW5nfSBTdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIHN0eWxlIG9iamVjdCBmb3IgZXhhbXBsZTogYm9yZGVyOiAxcHggc29saWQgcmVkLlxuXHRcdFx0ICovXG5cdFx0XHRzZXJpYWxpemU6IGZ1bmN0aW9uKHN0eWxlcywgZWxlbWVudE5hbWUpIHtcblx0XHRcdFx0dmFyIGNzcyA9ICcnLCBuYW1lLCB2YWx1ZTtcblxuXHRcdFx0XHRmdW5jdGlvbiBzZXJpYWxpemVTdHlsZXMobmFtZSkge1xuXHRcdFx0XHRcdHZhciBzdHlsZUxpc3QsIGksIGwsIHZhbHVlO1xuXG5cdFx0XHRcdFx0c3R5bGVMaXN0ID0gdmFsaWRTdHlsZXNbbmFtZV07XG5cdFx0XHRcdFx0aWYgKHN0eWxlTGlzdCkge1xuXHRcdFx0XHRcdFx0Zm9yIChpID0gMCwgbCA9IHN0eWxlTGlzdC5sZW5ndGg7IGkgPCBsOyBpKyspIHtcblx0XHRcdFx0XHRcdFx0bmFtZSA9IHN0eWxlTGlzdFtpXTtcblx0XHRcdFx0XHRcdFx0dmFsdWUgPSBzdHlsZXNbbmFtZV07XG5cblx0XHRcdFx0XHRcdFx0aWYgKHZhbHVlKSB7XG5cdFx0XHRcdFx0XHRcdFx0Y3NzICs9IChjc3MubGVuZ3RoID4gMCA/ICcgJyA6ICcnKSArIG5hbWUgKyAnOiAnICsgdmFsdWUgKyAnOyc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRmdW5jdGlvbiBpc1ZhbGlkKG5hbWUsIGVsZW1lbnROYW1lKSB7XG5cdFx0XHRcdFx0dmFyIHN0eWxlTWFwO1xuXG5cdFx0XHRcdFx0c3R5bGVNYXAgPSBpbnZhbGlkU3R5bGVzWycqJ107XG5cdFx0XHRcdFx0aWYgKHN0eWxlTWFwICYmIHN0eWxlTWFwW25hbWVdKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0c3R5bGVNYXAgPSBpbnZhbGlkU3R5bGVzW2VsZW1lbnROYW1lXTtcblx0XHRcdFx0XHRpZiAoc3R5bGVNYXAgJiYgc3R5bGVNYXBbbmFtZV0pIHtcblx0XHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIFNlcmlhbGl6ZSBzdHlsZXMgYWNjb3JkaW5nIHRvIHNjaGVtYVxuXHRcdFx0XHRpZiAoZWxlbWVudE5hbWUgJiYgdmFsaWRTdHlsZXMpIHtcblx0XHRcdFx0XHQvLyBTZXJpYWxpemUgZ2xvYmFsIHN0eWxlcyBhbmQgZWxlbWVudCBzcGVjaWZpYyBzdHlsZXNcblx0XHRcdFx0XHRzZXJpYWxpemVTdHlsZXMoJyonKTtcblx0XHRcdFx0XHRzZXJpYWxpemVTdHlsZXMoZWxlbWVudE5hbWUpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdC8vIE91dHB1dCB0aGUgc3R5bGVzIGluIHRoZSBvcmRlciB0aGV5IGFyZSBpbnNpZGUgdGhlIG9iamVjdFxuXHRcdFx0XHRcdGZvciAobmFtZSBpbiBzdHlsZXMpIHtcblx0XHRcdFx0XHRcdHZhbHVlID0gc3R5bGVzW25hbWVdO1xuXG5cdFx0XHRcdFx0XHRpZiAodmFsdWUgJiYgKCFpbnZhbGlkU3R5bGVzIHx8IGlzVmFsaWQobmFtZSwgZWxlbWVudE5hbWUpKSkge1xuXHRcdFx0XHRcdFx0XHRjc3MgKz0gKGNzcy5sZW5ndGggPiAwID8gJyAnIDogJycpICsgbmFtZSArICc6ICcgKyB2YWx1ZSArICc7Jztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gY3NzO1xuXHRcdFx0fVxuXHRcdH07XG5cdH07XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL2RvbS9UcmVlV2Fsa2VyLmpzXG5cbi8qKlxuICogVHJlZVdhbGtlci5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE1IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKipcbiAqIFRyZWVXYWxrZXIgY2xhc3MgZW5hYmxlcyB5b3UgdG8gd2FsayB0aGUgRE9NIGluIGEgbGluZWFyIG1hbm5lci5cbiAqXG4gKiBAY2xhc3MgdGlueW1jZS5kb20uVHJlZVdhbGtlclxuICogQGV4YW1wbGVcbiAqIHZhciB3YWxrZXIgPSBuZXcgdGlueW1jZS5kb20uVHJlZVdhbGtlcihzdGFydE5vZGUpO1xuICpcbiAqIGRvIHtcbiAqICAgICBjb25zb2xlLmxvZyh3YWxrZXIuY3VycmVudCgpKTtcbiAqIH0gd2hpbGUgKHdhbGtlci5uZXh0KCkpO1xuICovXG5kZWZpbmUoXCJ0aW55bWNlL2RvbS9UcmVlV2Fsa2VyXCIsIFtdLCBmdW5jdGlvbigpIHtcblx0LyoqXG5cdCAqIENvbnN0cnVjdHMgYSBuZXcgVHJlZVdhbGtlciBpbnN0YW5jZS5cblx0ICpcblx0ICogQGNvbnN0cnVjdG9yXG5cdCAqIEBtZXRob2QgVHJlZVdhbGtlclxuXHQgKiBAcGFyYW0ge05vZGV9IHN0YXJ0Tm9kZSBOb2RlIHRvIHN0YXJ0IHdhbGtpbmcgZnJvbS5cblx0ICogQHBhcmFtIHtub2RlfSByb290Tm9kZSBPcHRpb25hbCByb290IG5vZGUgdG8gbmV2ZXIgd2FsayBvdXQgb2YuXG5cdCAqL1xuXHRyZXR1cm4gZnVuY3Rpb24oc3RhcnROb2RlLCByb290Tm9kZSkge1xuXHRcdHZhciBub2RlID0gc3RhcnROb2RlO1xuXG5cdFx0ZnVuY3Rpb24gZmluZFNpYmxpbmcobm9kZSwgc3RhcnROYW1lLCBzaWJsaW5nTmFtZSwgc2hhbGxvdykge1xuXHRcdFx0dmFyIHNpYmxpbmcsIHBhcmVudDtcblxuXHRcdFx0aWYgKG5vZGUpIHtcblx0XHRcdFx0Ly8gV2FsayBpbnRvIG5vZGVzIGlmIGl0IGhhcyBhIHN0YXJ0XG5cdFx0XHRcdGlmICghc2hhbGxvdyAmJiBub2RlW3N0YXJ0TmFtZV0pIHtcblx0XHRcdFx0XHRyZXR1cm4gbm9kZVtzdGFydE5hbWVdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gUmV0dXJuIHRoZSBzaWJsaW5nIGlmIGl0IGhhcyBvbmVcblx0XHRcdFx0aWYgKG5vZGUgIT0gcm9vdE5vZGUpIHtcblx0XHRcdFx0XHRzaWJsaW5nID0gbm9kZVtzaWJsaW5nTmFtZV07XG5cdFx0XHRcdFx0aWYgKHNpYmxpbmcpIHtcblx0XHRcdFx0XHRcdHJldHVybiBzaWJsaW5nO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdC8vIFdhbGsgdXAgdGhlIHBhcmVudHMgdG8gbG9vayBmb3Igc2libGluZ3Ncblx0XHRcdFx0XHRmb3IgKHBhcmVudCA9IG5vZGUucGFyZW50Tm9kZTsgcGFyZW50ICYmIHBhcmVudCAhPSByb290Tm9kZTsgcGFyZW50ID0gcGFyZW50LnBhcmVudE5vZGUpIHtcblx0XHRcdFx0XHRcdHNpYmxpbmcgPSBwYXJlbnRbc2libGluZ05hbWVdO1xuXHRcdFx0XHRcdFx0aWYgKHNpYmxpbmcpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHNpYmxpbmc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gZmluZFByZXZpb3VzTm9kZShub2RlLCBzdGFydE5hbWUsIHNpYmxpbmdOYW1lLCBzaGFsbG93KSB7XG5cdFx0XHR2YXIgc2libGluZywgcGFyZW50LCBjaGlsZDtcblxuXHRcdFx0aWYgKG5vZGUpIHtcblx0XHRcdFx0c2libGluZyA9IG5vZGVbc2libGluZ05hbWVdO1xuXHRcdFx0XHRpZiAocm9vdE5vZGUgJiYgc2libGluZyA9PT0gcm9vdE5vZGUpIHtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoc2libGluZykge1xuXHRcdFx0XHRcdGlmICghc2hhbGxvdykge1xuXHRcdFx0XHRcdFx0Ly8gV2FsayB1cCB0aGUgcGFyZW50cyB0byBsb29rIGZvciBzaWJsaW5nc1xuXHRcdFx0XHRcdFx0Zm9yIChjaGlsZCA9IHNpYmxpbmdbc3RhcnROYW1lXTsgY2hpbGQ7IGNoaWxkID0gY2hpbGRbc3RhcnROYW1lXSkge1xuXHRcdFx0XHRcdFx0XHRpZiAoIWNoaWxkW3N0YXJ0TmFtZV0pIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gY2hpbGQ7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gc2libGluZztcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHBhcmVudCA9IG5vZGUucGFyZW50Tm9kZTtcblx0XHRcdFx0aWYgKHBhcmVudCAmJiBwYXJlbnQgIT09IHJvb3ROb2RlKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHBhcmVudDtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8qKlxuXHRcdCAqIFJldHVybnMgdGhlIGN1cnJlbnQgbm9kZS5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgY3VycmVudFxuXHRcdCAqIEByZXR1cm4ge05vZGV9IEN1cnJlbnQgbm9kZSB3aGVyZSB0aGUgd2Fsa2VyIGlzLlxuXHRcdCAqL1xuXHRcdHRoaXMuY3VycmVudCA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIG5vZGU7XG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIFdhbGtzIHRvIHRoZSBuZXh0IG5vZGUgaW4gdHJlZS5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgbmV4dFxuXHRcdCAqIEByZXR1cm4ge05vZGV9IEN1cnJlbnQgbm9kZSB3aGVyZSB0aGUgd2Fsa2VyIGlzIGFmdGVyIG1vdmluZyB0byB0aGUgbmV4dCBub2RlLlxuXHRcdCAqL1xuXHRcdHRoaXMubmV4dCA9IGZ1bmN0aW9uKHNoYWxsb3cpIHtcblx0XHRcdG5vZGUgPSBmaW5kU2libGluZyhub2RlLCAnZmlyc3RDaGlsZCcsICduZXh0U2libGluZycsIHNoYWxsb3cpO1xuXHRcdFx0cmV0dXJuIG5vZGU7XG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIFdhbGtzIHRvIHRoZSBwcmV2aW91cyBub2RlIGluIHRyZWUuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHByZXZcblx0XHQgKiBAcmV0dXJuIHtOb2RlfSBDdXJyZW50IG5vZGUgd2hlcmUgdGhlIHdhbGtlciBpcyBhZnRlciBtb3ZpbmcgdG8gdGhlIHByZXZpb3VzIG5vZGUuXG5cdFx0ICovXG5cdFx0dGhpcy5wcmV2ID0gZnVuY3Rpb24oc2hhbGxvdykge1xuXHRcdFx0bm9kZSA9IGZpbmRTaWJsaW5nKG5vZGUsICdsYXN0Q2hpbGQnLCAncHJldmlvdXNTaWJsaW5nJywgc2hhbGxvdyk7XG5cdFx0XHRyZXR1cm4gbm9kZTtcblx0XHR9O1xuXG5cdFx0dGhpcy5wcmV2MiA9IGZ1bmN0aW9uKHNoYWxsb3cpIHtcblx0XHRcdG5vZGUgPSBmaW5kUHJldmlvdXNOb2RlKG5vZGUsICdsYXN0Q2hpbGQnLCAncHJldmlvdXNTaWJsaW5nJywgc2hhbGxvdyk7XG5cdFx0XHRyZXR1cm4gbm9kZTtcblx0XHR9O1xuXHR9O1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy9kb20vUmFuZ2UuanNcblxuLyoqXG4gKiBSYW5nZS5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE1IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKipcbiAqIE9sZCBJRSBSYW5nZS5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQGNsYXNzIHRpbnltY2UuZG9tLlJhbmdlXG4gKi9cbmRlZmluZShcInRpbnltY2UvZG9tL1JhbmdlXCIsIFtcblx0XCJ0aW55bWNlL3V0aWwvVG9vbHNcIlxuXSwgZnVuY3Rpb24oVG9vbHMpIHtcblx0Ly8gUmFuZ2UgY29uc3RydWN0b3Jcblx0ZnVuY3Rpb24gUmFuZ2UoZG9tKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0ZG9jID0gZG9tLmRvYyxcblx0XHRcdEVYVFJBQ1QgPSAwLFxuXHRcdFx0Q0xPTkUgPSAxLFxuXHRcdFx0REVMRVRFID0gMixcblx0XHRcdFRSVUUgPSB0cnVlLFxuXHRcdFx0RkFMU0UgPSBmYWxzZSxcblx0XHRcdFNUQVJUX09GRlNFVCA9ICdzdGFydE9mZnNldCcsXG5cdFx0XHRTVEFSVF9DT05UQUlORVIgPSAnc3RhcnRDb250YWluZXInLFxuXHRcdFx0RU5EX0NPTlRBSU5FUiA9ICdlbmRDb250YWluZXInLFxuXHRcdFx0RU5EX09GRlNFVCA9ICdlbmRPZmZzZXQnLFxuXHRcdFx0ZXh0ZW5kID0gVG9vbHMuZXh0ZW5kLFxuXHRcdFx0bm9kZUluZGV4ID0gZG9tLm5vZGVJbmRleDtcblxuXHRcdGZ1bmN0aW9uIGNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKSB7XG5cdFx0XHRyZXR1cm4gZG9jLmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcblx0XHR9XG5cblx0XHRmdW5jdGlvbiBzZXRTdGFydChuLCBvKSB7XG5cdFx0XHRfc2V0RW5kUG9pbnQoVFJVRSwgbiwgbyk7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gc2V0RW5kKG4sIG8pIHtcblx0XHRcdF9zZXRFbmRQb2ludChGQUxTRSwgbiwgbyk7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gc2V0U3RhcnRCZWZvcmUobikge1xuXHRcdFx0c2V0U3RhcnQobi5wYXJlbnROb2RlLCBub2RlSW5kZXgobikpO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIHNldFN0YXJ0QWZ0ZXIobikge1xuXHRcdFx0c2V0U3RhcnQobi5wYXJlbnROb2RlLCBub2RlSW5kZXgobikgKyAxKTtcblx0XHR9XG5cblx0XHRmdW5jdGlvbiBzZXRFbmRCZWZvcmUobikge1xuXHRcdFx0c2V0RW5kKG4ucGFyZW50Tm9kZSwgbm9kZUluZGV4KG4pKTtcblx0XHR9XG5cblx0XHRmdW5jdGlvbiBzZXRFbmRBZnRlcihuKSB7XG5cdFx0XHRzZXRFbmQobi5wYXJlbnROb2RlLCBub2RlSW5kZXgobikgKyAxKTtcblx0XHR9XG5cblx0XHRmdW5jdGlvbiBjb2xsYXBzZSh0cykge1xuXHRcdFx0aWYgKHRzKSB7XG5cdFx0XHRcdHNlbGZbRU5EX0NPTlRBSU5FUl0gPSBzZWxmW1NUQVJUX0NPTlRBSU5FUl07XG5cdFx0XHRcdHNlbGZbRU5EX09GRlNFVF0gPSBzZWxmW1NUQVJUX09GRlNFVF07XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRzZWxmW1NUQVJUX0NPTlRBSU5FUl0gPSBzZWxmW0VORF9DT05UQUlORVJdO1xuXHRcdFx0XHRzZWxmW1NUQVJUX09GRlNFVF0gPSBzZWxmW0VORF9PRkZTRVRdO1xuXHRcdFx0fVxuXG5cdFx0XHRzZWxmLmNvbGxhcHNlZCA9IFRSVUU7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gc2VsZWN0Tm9kZShuKSB7XG5cdFx0XHRzZXRTdGFydEJlZm9yZShuKTtcblx0XHRcdHNldEVuZEFmdGVyKG4pO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIHNlbGVjdE5vZGVDb250ZW50cyhuKSB7XG5cdFx0XHRzZXRTdGFydChuLCAwKTtcblx0XHRcdHNldEVuZChuLCBuLm5vZGVUeXBlID09PSAxID8gbi5jaGlsZE5vZGVzLmxlbmd0aCA6IG4ubm9kZVZhbHVlLmxlbmd0aCk7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gY29tcGFyZUJvdW5kYXJ5UG9pbnRzKGgsIHIpIHtcblx0XHRcdHZhciBzYyA9IHNlbGZbU1RBUlRfQ09OVEFJTkVSXSwgc28gPSBzZWxmW1NUQVJUX09GRlNFVF0sIGVjID0gc2VsZltFTkRfQ09OVEFJTkVSXSwgZW8gPSBzZWxmW0VORF9PRkZTRVRdLFxuXHRcdFx0cnNjID0gci5zdGFydENvbnRhaW5lciwgcnNvID0gci5zdGFydE9mZnNldCwgcmVjID0gci5lbmRDb250YWluZXIsIHJlbyA9IHIuZW5kT2Zmc2V0O1xuXG5cdFx0XHQvLyBDaGVjayBTVEFSVF9UT19TVEFSVFxuXHRcdFx0aWYgKGggPT09IDApIHtcblx0XHRcdFx0cmV0dXJuIF9jb21wYXJlQm91bmRhcnlQb2ludHMoc2MsIHNvLCByc2MsIHJzbyk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIENoZWNrIFNUQVJUX1RPX0VORFxuXHRcdFx0aWYgKGggPT09IDEpIHtcblx0XHRcdFx0cmV0dXJuIF9jb21wYXJlQm91bmRhcnlQb2ludHMoZWMsIGVvLCByc2MsIHJzbyk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIENoZWNrIEVORF9UT19FTkRcblx0XHRcdGlmIChoID09PSAyKSB7XG5cdFx0XHRcdHJldHVybiBfY29tcGFyZUJvdW5kYXJ5UG9pbnRzKGVjLCBlbywgcmVjLCByZW8pO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBDaGVjayBFTkRfVE9fU1RBUlRcblx0XHRcdGlmIChoID09PSAzKSB7XG5cdFx0XHRcdHJldHVybiBfY29tcGFyZUJvdW5kYXJ5UG9pbnRzKHNjLCBzbywgcmVjLCByZW8pO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIGRlbGV0ZUNvbnRlbnRzKCkge1xuXHRcdFx0X3RyYXZlcnNlKERFTEVURSk7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gZXh0cmFjdENvbnRlbnRzKCkge1xuXHRcdFx0cmV0dXJuIF90cmF2ZXJzZShFWFRSQUNUKTtcblx0XHR9XG5cblx0XHRmdW5jdGlvbiBjbG9uZUNvbnRlbnRzKCkge1xuXHRcdFx0cmV0dXJuIF90cmF2ZXJzZShDTE9ORSk7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gaW5zZXJ0Tm9kZShuKSB7XG5cdFx0XHR2YXIgc3RhcnRDb250YWluZXIgPSB0aGlzW1NUQVJUX0NPTlRBSU5FUl0sXG5cdFx0XHRcdHN0YXJ0T2Zmc2V0ID0gdGhpc1tTVEFSVF9PRkZTRVRdLCBubiwgbztcblxuXHRcdFx0Ly8gTm9kZSBpcyBURVhUX05PREUgb3IgQ0RBVEFcblx0XHRcdGlmICgoc3RhcnRDb250YWluZXIubm9kZVR5cGUgPT09IDMgfHwgc3RhcnRDb250YWluZXIubm9kZVR5cGUgPT09IDQpICYmIHN0YXJ0Q29udGFpbmVyLm5vZGVWYWx1ZSkge1xuXHRcdFx0XHRpZiAoIXN0YXJ0T2Zmc2V0KSB7XG5cdFx0XHRcdFx0Ly8gQXQgdGhlIHN0YXJ0IG9mIHRleHRcblx0XHRcdFx0XHRzdGFydENvbnRhaW5lci5wYXJlbnROb2RlLmluc2VydEJlZm9yZShuLCBzdGFydENvbnRhaW5lcik7XG5cdFx0XHRcdH0gZWxzZSBpZiAoc3RhcnRPZmZzZXQgPj0gc3RhcnRDb250YWluZXIubm9kZVZhbHVlLmxlbmd0aCkge1xuXHRcdFx0XHRcdC8vIEF0IHRoZSBlbmQgb2YgdGV4dFxuXHRcdFx0XHRcdGRvbS5pbnNlcnRBZnRlcihuLCBzdGFydENvbnRhaW5lcik7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Ly8gTWlkZGxlLCBuZWVkIHRvIHNwbGl0XG5cdFx0XHRcdFx0bm4gPSBzdGFydENvbnRhaW5lci5zcGxpdFRleHQoc3RhcnRPZmZzZXQpO1xuXHRcdFx0XHRcdHN0YXJ0Q29udGFpbmVyLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKG4sIG5uKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Ly8gSW5zZXJ0IGVsZW1lbnQgbm9kZVxuXHRcdFx0XHRpZiAoc3RhcnRDb250YWluZXIuY2hpbGROb2Rlcy5sZW5ndGggPiAwKSB7XG5cdFx0XHRcdFx0byA9IHN0YXJ0Q29udGFpbmVyLmNoaWxkTm9kZXNbc3RhcnRPZmZzZXRdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKG8pIHtcblx0XHRcdFx0XHRzdGFydENvbnRhaW5lci5pbnNlcnRCZWZvcmUobiwgbyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0aWYgKHN0YXJ0Q29udGFpbmVyLm5vZGVUeXBlID09IDMpIHtcblx0XHRcdFx0XHRcdGRvbS5pbnNlcnRBZnRlcihuLCBzdGFydENvbnRhaW5lcik7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdHN0YXJ0Q29udGFpbmVyLmFwcGVuZENoaWxkKG4pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIHN1cnJvdW5kQ29udGVudHMobikge1xuXHRcdFx0dmFyIGYgPSBzZWxmLmV4dHJhY3RDb250ZW50cygpO1xuXG5cdFx0XHRzZWxmLmluc2VydE5vZGUobik7XG5cdFx0XHRuLmFwcGVuZENoaWxkKGYpO1xuXHRcdFx0c2VsZi5zZWxlY3ROb2RlKG4pO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIGNsb25lUmFuZ2UoKSB7XG5cdFx0XHRyZXR1cm4gZXh0ZW5kKG5ldyBSYW5nZShkb20pLCB7XG5cdFx0XHRcdHN0YXJ0Q29udGFpbmVyOiBzZWxmW1NUQVJUX0NPTlRBSU5FUl0sXG5cdFx0XHRcdHN0YXJ0T2Zmc2V0OiBzZWxmW1NUQVJUX09GRlNFVF0sXG5cdFx0XHRcdGVuZENvbnRhaW5lcjogc2VsZltFTkRfQ09OVEFJTkVSXSxcblx0XHRcdFx0ZW5kT2Zmc2V0OiBzZWxmW0VORF9PRkZTRVRdLFxuXHRcdFx0XHRjb2xsYXBzZWQ6IHNlbGYuY29sbGFwc2VkLFxuXHRcdFx0XHRjb21tb25BbmNlc3RvckNvbnRhaW5lcjogc2VsZi5jb21tb25BbmNlc3RvckNvbnRhaW5lclxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0Ly8gUHJpdmF0ZSBtZXRob2RzXG5cblx0XHRmdW5jdGlvbiBfZ2V0U2VsZWN0ZWROb2RlKGNvbnRhaW5lciwgb2Zmc2V0KSB7XG5cdFx0XHR2YXIgY2hpbGQ7XG5cblx0XHRcdC8vIFRFWFRfTk9ERVxuXHRcdFx0aWYgKGNvbnRhaW5lci5ub2RlVHlwZSA9PSAzKSB7XG5cdFx0XHRcdHJldHVybiBjb250YWluZXI7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChvZmZzZXQgPCAwKSB7XG5cdFx0XHRcdHJldHVybiBjb250YWluZXI7XG5cdFx0XHR9XG5cblx0XHRcdGNoaWxkID0gY29udGFpbmVyLmZpcnN0Q2hpbGQ7XG5cdFx0XHR3aGlsZSAoY2hpbGQgJiYgb2Zmc2V0ID4gMCkge1xuXHRcdFx0XHQtLW9mZnNldDtcblx0XHRcdFx0Y2hpbGQgPSBjaGlsZC5uZXh0U2libGluZztcblx0XHRcdH1cblxuXHRcdFx0aWYgKGNoaWxkKSB7XG5cdFx0XHRcdHJldHVybiBjaGlsZDtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIGNvbnRhaW5lcjtcblx0XHR9XG5cblx0XHRmdW5jdGlvbiBfaXNDb2xsYXBzZWQoKSB7XG5cdFx0XHRyZXR1cm4gKHNlbGZbU1RBUlRfQ09OVEFJTkVSXSA9PSBzZWxmW0VORF9DT05UQUlORVJdICYmIHNlbGZbU1RBUlRfT0ZGU0VUXSA9PSBzZWxmW0VORF9PRkZTRVRdKTtcblx0XHR9XG5cblx0XHRmdW5jdGlvbiBfY29tcGFyZUJvdW5kYXJ5UG9pbnRzKGNvbnRhaW5lckEsIG9mZnNldEEsIGNvbnRhaW5lckIsIG9mZnNldEIpIHtcblx0XHRcdHZhciBjLCBvZmZzZXRDLCBuLCBjbW5Sb290LCBjaGlsZEEsIGNoaWxkQjtcblxuXHRcdFx0Ly8gSW4gdGhlIGZpcnN0IGNhc2UgdGhlIGJvdW5kYXJ5LXBvaW50cyBoYXZlIHRoZSBzYW1lIGNvbnRhaW5lci4gQSBpcyBiZWZvcmUgQlxuXHRcdFx0Ly8gaWYgaXRzIG9mZnNldCBpcyBsZXNzIHRoYW4gdGhlIG9mZnNldCBvZiBCLCBBIGlzIGVxdWFsIHRvIEIgaWYgaXRzIG9mZnNldCBpc1xuXHRcdFx0Ly8gZXF1YWwgdG8gdGhlIG9mZnNldCBvZiBCLCBhbmQgQSBpcyBhZnRlciBCIGlmIGl0cyBvZmZzZXQgaXMgZ3JlYXRlciB0aGFuIHRoZVxuXHRcdFx0Ly8gb2Zmc2V0IG9mIEIuXG5cdFx0XHRpZiAoY29udGFpbmVyQSA9PSBjb250YWluZXJCKSB7XG5cdFx0XHRcdGlmIChvZmZzZXRBID09IG9mZnNldEIpIHtcblx0XHRcdFx0XHRyZXR1cm4gMDsgLy8gZXF1YWxcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChvZmZzZXRBIDwgb2Zmc2V0Qikge1xuXHRcdFx0XHRcdHJldHVybiAtMTsgLy8gYmVmb3JlXG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gMTsgLy8gYWZ0ZXJcblx0XHRcdH1cblxuXHRcdFx0Ly8gSW4gdGhlIHNlY29uZCBjYXNlIGEgY2hpbGQgbm9kZSBDIG9mIHRoZSBjb250YWluZXIgb2YgQSBpcyBhbiBhbmNlc3RvclxuXHRcdFx0Ly8gY29udGFpbmVyIG9mIEIuIEluIHRoaXMgY2FzZSwgQSBpcyBiZWZvcmUgQiBpZiB0aGUgb2Zmc2V0IG9mIEEgaXMgbGVzcyB0aGFuIG9yXG5cdFx0XHQvLyBlcXVhbCB0byB0aGUgaW5kZXggb2YgdGhlIGNoaWxkIG5vZGUgQyBhbmQgQSBpcyBhZnRlciBCIG90aGVyd2lzZS5cblx0XHRcdGMgPSBjb250YWluZXJCO1xuXHRcdFx0d2hpbGUgKGMgJiYgYy5wYXJlbnROb2RlICE9IGNvbnRhaW5lckEpIHtcblx0XHRcdFx0YyA9IGMucGFyZW50Tm9kZTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGMpIHtcblx0XHRcdFx0b2Zmc2V0QyA9IDA7XG5cdFx0XHRcdG4gPSBjb250YWluZXJBLmZpcnN0Q2hpbGQ7XG5cblx0XHRcdFx0d2hpbGUgKG4gIT0gYyAmJiBvZmZzZXRDIDwgb2Zmc2V0QSkge1xuXHRcdFx0XHRcdG9mZnNldEMrKztcblx0XHRcdFx0XHRuID0gbi5uZXh0U2libGluZztcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChvZmZzZXRBIDw9IG9mZnNldEMpIHtcblx0XHRcdFx0XHRyZXR1cm4gLTE7IC8vIGJlZm9yZVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIDE7IC8vIGFmdGVyXG5cdFx0XHR9XG5cblx0XHRcdC8vIEluIHRoZSB0aGlyZCBjYXNlIGEgY2hpbGQgbm9kZSBDIG9mIHRoZSBjb250YWluZXIgb2YgQiBpcyBhbiBhbmNlc3RvciBjb250YWluZXJcblx0XHRcdC8vIG9mIEEuIEluIHRoaXMgY2FzZSwgQSBpcyBiZWZvcmUgQiBpZiB0aGUgaW5kZXggb2YgdGhlIGNoaWxkIG5vZGUgQyBpcyBsZXNzIHRoYW5cblx0XHRcdC8vIHRoZSBvZmZzZXQgb2YgQiBhbmQgQSBpcyBhZnRlciBCIG90aGVyd2lzZS5cblx0XHRcdGMgPSBjb250YWluZXJBO1xuXHRcdFx0d2hpbGUgKGMgJiYgYy5wYXJlbnROb2RlICE9IGNvbnRhaW5lckIpIHtcblx0XHRcdFx0YyA9IGMucGFyZW50Tm9kZTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGMpIHtcblx0XHRcdFx0b2Zmc2V0QyA9IDA7XG5cdFx0XHRcdG4gPSBjb250YWluZXJCLmZpcnN0Q2hpbGQ7XG5cblx0XHRcdFx0d2hpbGUgKG4gIT0gYyAmJiBvZmZzZXRDIDwgb2Zmc2V0Qikge1xuXHRcdFx0XHRcdG9mZnNldEMrKztcblx0XHRcdFx0XHRuID0gbi5uZXh0U2libGluZztcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChvZmZzZXRDIDwgb2Zmc2V0Qikge1xuXHRcdFx0XHRcdHJldHVybiAtMTsgLy8gYmVmb3JlXG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gMTsgLy8gYWZ0ZXJcblx0XHRcdH1cblxuXHRcdFx0Ly8gSW4gdGhlIGZvdXJ0aCBjYXNlLCBub25lIG9mIHRocmVlIG90aGVyIGNhc2VzIGhvbGQ6IHRoZSBjb250YWluZXJzIG9mIEEgYW5kIEJcblx0XHRcdC8vIGFyZSBzaWJsaW5ncyBvciBkZXNjZW5kYW50cyBvZiBzaWJsaW5nIG5vZGVzLiBJbiB0aGlzIGNhc2UsIEEgaXMgYmVmb3JlIEIgaWZcblx0XHRcdC8vIHRoZSBjb250YWluZXIgb2YgQSBpcyBiZWZvcmUgdGhlIGNvbnRhaW5lciBvZiBCIGluIGEgcHJlLW9yZGVyIHRyYXZlcnNhbCBvZiB0aGVcblx0XHRcdC8vIFJhbmdlcycgY29udGV4dCB0cmVlIGFuZCBBIGlzIGFmdGVyIEIgb3RoZXJ3aXNlLlxuXHRcdFx0Y21uUm9vdCA9IGRvbS5maW5kQ29tbW9uQW5jZXN0b3IoY29udGFpbmVyQSwgY29udGFpbmVyQik7XG5cdFx0XHRjaGlsZEEgPSBjb250YWluZXJBO1xuXG5cdFx0XHR3aGlsZSAoY2hpbGRBICYmIGNoaWxkQS5wYXJlbnROb2RlICE9IGNtblJvb3QpIHtcblx0XHRcdFx0Y2hpbGRBID0gY2hpbGRBLnBhcmVudE5vZGU7XG5cdFx0XHR9XG5cblx0XHRcdGlmICghY2hpbGRBKSB7XG5cdFx0XHRcdGNoaWxkQSA9IGNtblJvb3Q7XG5cdFx0XHR9XG5cblx0XHRcdGNoaWxkQiA9IGNvbnRhaW5lckI7XG5cdFx0XHR3aGlsZSAoY2hpbGRCICYmIGNoaWxkQi5wYXJlbnROb2RlICE9IGNtblJvb3QpIHtcblx0XHRcdFx0Y2hpbGRCID0gY2hpbGRCLnBhcmVudE5vZGU7XG5cdFx0XHR9XG5cblx0XHRcdGlmICghY2hpbGRCKSB7XG5cdFx0XHRcdGNoaWxkQiA9IGNtblJvb3Q7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChjaGlsZEEgPT0gY2hpbGRCKSB7XG5cdFx0XHRcdHJldHVybiAwOyAvLyBlcXVhbFxuXHRcdFx0fVxuXG5cdFx0XHRuID0gY21uUm9vdC5maXJzdENoaWxkO1xuXHRcdFx0d2hpbGUgKG4pIHtcblx0XHRcdFx0aWYgKG4gPT0gY2hpbGRBKSB7XG5cdFx0XHRcdFx0cmV0dXJuIC0xOyAvLyBiZWZvcmVcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChuID09IGNoaWxkQikge1xuXHRcdFx0XHRcdHJldHVybiAxOyAvLyBhZnRlclxuXHRcdFx0XHR9XG5cblx0XHRcdFx0biA9IG4ubmV4dFNpYmxpbmc7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gX3NldEVuZFBvaW50KHN0LCBuLCBvKSB7XG5cdFx0XHR2YXIgZWMsIHNjO1xuXG5cdFx0XHRpZiAoc3QpIHtcblx0XHRcdFx0c2VsZltTVEFSVF9DT05UQUlORVJdID0gbjtcblx0XHRcdFx0c2VsZltTVEFSVF9PRkZTRVRdID0gbztcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHNlbGZbRU5EX0NPTlRBSU5FUl0gPSBuO1xuXHRcdFx0XHRzZWxmW0VORF9PRkZTRVRdID0gbztcblx0XHRcdH1cblxuXHRcdFx0Ly8gSWYgb25lIGJvdW5kYXJ5LXBvaW50IG9mIGEgUmFuZ2UgaXMgc2V0IHRvIGhhdmUgYSByb290IGNvbnRhaW5lclxuXHRcdFx0Ly8gb3RoZXIgdGhhbiB0aGUgY3VycmVudCBvbmUgZm9yIHRoZSBSYW5nZSwgdGhlIFJhbmdlIGlzIGNvbGxhcHNlZCB0b1xuXHRcdFx0Ly8gdGhlIG5ldyBwb3NpdGlvbi4gVGhpcyBlbmZvcmNlcyB0aGUgcmVzdHJpY3Rpb24gdGhhdCBib3RoIGJvdW5kYXJ5LVxuXHRcdFx0Ly8gcG9pbnRzIG9mIGEgUmFuZ2UgbXVzdCBoYXZlIHRoZSBzYW1lIHJvb3QgY29udGFpbmVyLlxuXHRcdFx0ZWMgPSBzZWxmW0VORF9DT05UQUlORVJdO1xuXHRcdFx0d2hpbGUgKGVjLnBhcmVudE5vZGUpIHtcblx0XHRcdFx0ZWMgPSBlYy5wYXJlbnROb2RlO1xuXHRcdFx0fVxuXG5cdFx0XHRzYyA9IHNlbGZbU1RBUlRfQ09OVEFJTkVSXTtcblx0XHRcdHdoaWxlIChzYy5wYXJlbnROb2RlKSB7XG5cdFx0XHRcdHNjID0gc2MucGFyZW50Tm9kZTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHNjID09IGVjKSB7XG5cdFx0XHRcdC8vIFRoZSBzdGFydCBwb3NpdGlvbiBvZiBhIFJhbmdlIGlzIGd1YXJhbnRlZWQgdG8gbmV2ZXIgYmUgYWZ0ZXIgdGhlXG5cdFx0XHRcdC8vIGVuZCBwb3NpdGlvbi4gVG8gZW5mb3JjZSB0aGlzIHJlc3RyaWN0aW9uLCBpZiB0aGUgc3RhcnQgaXMgc2V0IHRvXG5cdFx0XHRcdC8vIGJlIGF0IGEgcG9zaXRpb24gYWZ0ZXIgdGhlIGVuZCwgdGhlIFJhbmdlIGlzIGNvbGxhcHNlZCB0byB0aGF0XG5cdFx0XHRcdC8vIHBvc2l0aW9uLlxuXHRcdFx0XHRpZiAoX2NvbXBhcmVCb3VuZGFyeVBvaW50cyhzZWxmW1NUQVJUX0NPTlRBSU5FUl0sIHNlbGZbU1RBUlRfT0ZGU0VUXSwgc2VsZltFTkRfQ09OVEFJTkVSXSwgc2VsZltFTkRfT0ZGU0VUXSkgPiAwKSB7XG5cdFx0XHRcdFx0c2VsZi5jb2xsYXBzZShzdCk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHNlbGYuY29sbGFwc2Uoc3QpO1xuXHRcdFx0fVxuXG5cdFx0XHRzZWxmLmNvbGxhcHNlZCA9IF9pc0NvbGxhcHNlZCgpO1xuXHRcdFx0c2VsZi5jb21tb25BbmNlc3RvckNvbnRhaW5lciA9IGRvbS5maW5kQ29tbW9uQW5jZXN0b3Ioc2VsZltTVEFSVF9DT05UQUlORVJdLCBzZWxmW0VORF9DT05UQUlORVJdKTtcblx0XHR9XG5cblx0XHRmdW5jdGlvbiBfdHJhdmVyc2UoaG93KSB7XG5cdFx0XHR2YXIgYywgZW5kQ29udGFpbmVyRGVwdGggPSAwLCBzdGFydENvbnRhaW5lckRlcHRoID0gMCwgcCwgZGVwdGhEaWZmLCBzdGFydE5vZGUsIGVuZE5vZGUsIHNwLCBlcDtcblxuXHRcdFx0aWYgKHNlbGZbU1RBUlRfQ09OVEFJTkVSXSA9PSBzZWxmW0VORF9DT05UQUlORVJdKSB7XG5cdFx0XHRcdHJldHVybiBfdHJhdmVyc2VTYW1lQ29udGFpbmVyKGhvdyk7XG5cdFx0XHR9XG5cblx0XHRcdGZvciAoYyA9IHNlbGZbRU5EX0NPTlRBSU5FUl0sIHAgPSBjLnBhcmVudE5vZGU7IHA7IGMgPSBwLCBwID0gcC5wYXJlbnROb2RlKSB7XG5cdFx0XHRcdGlmIChwID09IHNlbGZbU1RBUlRfQ09OVEFJTkVSXSkge1xuXHRcdFx0XHRcdHJldHVybiBfdHJhdmVyc2VDb21tb25TdGFydENvbnRhaW5lcihjLCBob3cpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0KytlbmRDb250YWluZXJEZXB0aDtcblx0XHRcdH1cblxuXHRcdFx0Zm9yIChjID0gc2VsZltTVEFSVF9DT05UQUlORVJdLCBwID0gYy5wYXJlbnROb2RlOyBwOyBjID0gcCwgcCA9IHAucGFyZW50Tm9kZSkge1xuXHRcdFx0XHRpZiAocCA9PSBzZWxmW0VORF9DT05UQUlORVJdKSB7XG5cdFx0XHRcdFx0cmV0dXJuIF90cmF2ZXJzZUNvbW1vbkVuZENvbnRhaW5lcihjLCBob3cpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0KytzdGFydENvbnRhaW5lckRlcHRoO1xuXHRcdFx0fVxuXG5cdFx0XHRkZXB0aERpZmYgPSBzdGFydENvbnRhaW5lckRlcHRoIC0gZW5kQ29udGFpbmVyRGVwdGg7XG5cblx0XHRcdHN0YXJ0Tm9kZSA9IHNlbGZbU1RBUlRfQ09OVEFJTkVSXTtcblx0XHRcdHdoaWxlIChkZXB0aERpZmYgPiAwKSB7XG5cdFx0XHRcdHN0YXJ0Tm9kZSA9IHN0YXJ0Tm9kZS5wYXJlbnROb2RlO1xuXHRcdFx0XHRkZXB0aERpZmYtLTtcblx0XHRcdH1cblxuXHRcdFx0ZW5kTm9kZSA9IHNlbGZbRU5EX0NPTlRBSU5FUl07XG5cdFx0XHR3aGlsZSAoZGVwdGhEaWZmIDwgMCkge1xuXHRcdFx0XHRlbmROb2RlID0gZW5kTm9kZS5wYXJlbnROb2RlO1xuXHRcdFx0XHRkZXB0aERpZmYrKztcblx0XHRcdH1cblxuXHRcdFx0Ly8gYXNjZW5kIHRoZSBhbmNlc3RvciBoaWVyYXJjaHkgdW50aWwgd2UgaGF2ZSBhIGNvbW1vbiBwYXJlbnQuXG5cdFx0XHRmb3IgKHNwID0gc3RhcnROb2RlLnBhcmVudE5vZGUsIGVwID0gZW5kTm9kZS5wYXJlbnROb2RlOyBzcCAhPSBlcDsgc3AgPSBzcC5wYXJlbnROb2RlLCBlcCA9IGVwLnBhcmVudE5vZGUpIHtcblx0XHRcdFx0c3RhcnROb2RlID0gc3A7XG5cdFx0XHRcdGVuZE5vZGUgPSBlcDtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIF90cmF2ZXJzZUNvbW1vbkFuY2VzdG9ycyhzdGFydE5vZGUsIGVuZE5vZGUsIGhvdyk7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gX3RyYXZlcnNlU2FtZUNvbnRhaW5lcihob3cpIHtcblx0XHRcdHZhciBmcmFnLCBzLCBzdWIsIG4sIGNudCwgc2libGluZywgeGZlck5vZGUsIHN0YXJ0LCBsZW47XG5cblx0XHRcdGlmIChob3cgIT0gREVMRVRFKSB7XG5cdFx0XHRcdGZyYWcgPSBjcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIElmIHNlbGVjdGlvbiBpcyBlbXB0eSwganVzdCByZXR1cm4gdGhlIGZyYWdtZW50XG5cdFx0XHRpZiAoc2VsZltTVEFSVF9PRkZTRVRdID09IHNlbGZbRU5EX09GRlNFVF0pIHtcblx0XHRcdFx0cmV0dXJuIGZyYWc7XG5cdFx0XHR9XG5cblx0XHRcdC8vIFRleHQgbm9kZSBuZWVkcyBzcGVjaWFsIGNhc2UgaGFuZGxpbmdcblx0XHRcdGlmIChzZWxmW1NUQVJUX0NPTlRBSU5FUl0ubm9kZVR5cGUgPT0gMykgeyAvLyBURVhUX05PREVcblx0XHRcdFx0Ly8gZ2V0IHRoZSBzdWJzdHJpbmdcblx0XHRcdFx0cyA9IHNlbGZbU1RBUlRfQ09OVEFJTkVSXS5ub2RlVmFsdWU7XG5cdFx0XHRcdHN1YiA9IHMuc3Vic3RyaW5nKHNlbGZbU1RBUlRfT0ZGU0VUXSwgc2VsZltFTkRfT0ZGU0VUXSk7XG5cblx0XHRcdFx0Ly8gc2V0IHRoZSBvcmlnaW5hbCB0ZXh0IG5vZGUgdG8gaXRzIG5ldyB2YWx1ZVxuXHRcdFx0XHRpZiAoaG93ICE9IENMT05FKSB7XG5cdFx0XHRcdFx0biA9IHNlbGZbU1RBUlRfQ09OVEFJTkVSXTtcblx0XHRcdFx0XHRzdGFydCA9IHNlbGZbU1RBUlRfT0ZGU0VUXTtcblx0XHRcdFx0XHRsZW4gPSBzZWxmW0VORF9PRkZTRVRdIC0gc2VsZltTVEFSVF9PRkZTRVRdO1xuXG5cdFx0XHRcdFx0aWYgKHN0YXJ0ID09PSAwICYmIGxlbiA+PSBuLm5vZGVWYWx1ZS5sZW5ndGggLSAxKSB7XG5cdFx0XHRcdFx0XHRuLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobik7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdG4uZGVsZXRlRGF0YShzdGFydCwgbGVuKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHQvLyBOb3RoaW5nIGlzIHBhcnRpYWxseSBzZWxlY3RlZCwgc28gY29sbGFwc2UgdG8gc3RhcnQgcG9pbnRcblx0XHRcdFx0XHRzZWxmLmNvbGxhcHNlKFRSVUUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKGhvdyA9PSBERUxFVEUpIHtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoc3ViLmxlbmd0aCA+IDApIHtcblx0XHRcdFx0XHRmcmFnLmFwcGVuZENoaWxkKGRvYy5jcmVhdGVUZXh0Tm9kZShzdWIpKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBmcmFnO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBDb3B5IG5vZGVzIGJldHdlZW4gdGhlIHN0YXJ0L2VuZCBvZmZzZXRzLlxuXHRcdFx0biA9IF9nZXRTZWxlY3RlZE5vZGUoc2VsZltTVEFSVF9DT05UQUlORVJdLCBzZWxmW1NUQVJUX09GRlNFVF0pO1xuXHRcdFx0Y250ID0gc2VsZltFTkRfT0ZGU0VUXSAtIHNlbGZbU1RBUlRfT0ZGU0VUXTtcblxuXHRcdFx0d2hpbGUgKG4gJiYgY250ID4gMCkge1xuXHRcdFx0XHRzaWJsaW5nID0gbi5uZXh0U2libGluZztcblx0XHRcdFx0eGZlck5vZGUgPSBfdHJhdmVyc2VGdWxseVNlbGVjdGVkKG4sIGhvdyk7XG5cblx0XHRcdFx0aWYgKGZyYWcpIHtcblx0XHRcdFx0XHRmcmFnLmFwcGVuZENoaWxkKHhmZXJOb2RlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC0tY250O1xuXHRcdFx0XHRuID0gc2libGluZztcblx0XHRcdH1cblxuXHRcdFx0Ly8gTm90aGluZyBpcyBwYXJ0aWFsbHkgc2VsZWN0ZWQsIHNvIGNvbGxhcHNlIHRvIHN0YXJ0IHBvaW50XG5cdFx0XHRpZiAoaG93ICE9IENMT05FKSB7XG5cdFx0XHRcdHNlbGYuY29sbGFwc2UoVFJVRSk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBmcmFnO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIF90cmF2ZXJzZUNvbW1vblN0YXJ0Q29udGFpbmVyKGVuZEFuY2VzdG9yLCBob3cpIHtcblx0XHRcdHZhciBmcmFnLCBuLCBlbmRJZHgsIGNudCwgc2libGluZywgeGZlck5vZGU7XG5cblx0XHRcdGlmIChob3cgIT0gREVMRVRFKSB7XG5cdFx0XHRcdGZyYWcgPSBjcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG5cdFx0XHR9XG5cblx0XHRcdG4gPSBfdHJhdmVyc2VSaWdodEJvdW5kYXJ5KGVuZEFuY2VzdG9yLCBob3cpO1xuXG5cdFx0XHRpZiAoZnJhZykge1xuXHRcdFx0XHRmcmFnLmFwcGVuZENoaWxkKG4pO1xuXHRcdFx0fVxuXG5cdFx0XHRlbmRJZHggPSBub2RlSW5kZXgoZW5kQW5jZXN0b3IpO1xuXHRcdFx0Y250ID0gZW5kSWR4IC0gc2VsZltTVEFSVF9PRkZTRVRdO1xuXG5cdFx0XHRpZiAoY250IDw9IDApIHtcblx0XHRcdFx0Ly8gQ29sbGFwc2UgdG8ganVzdCBiZWZvcmUgdGhlIGVuZEFuY2VzdG9yLCB3aGljaFxuXHRcdFx0XHQvLyBpcyBwYXJ0aWFsbHkgc2VsZWN0ZWQuXG5cdFx0XHRcdGlmIChob3cgIT0gQ0xPTkUpIHtcblx0XHRcdFx0XHRzZWxmLnNldEVuZEJlZm9yZShlbmRBbmNlc3Rvcik7XG5cdFx0XHRcdFx0c2VsZi5jb2xsYXBzZShGQUxTRSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gZnJhZztcblx0XHRcdH1cblxuXHRcdFx0biA9IGVuZEFuY2VzdG9yLnByZXZpb3VzU2libGluZztcblx0XHRcdHdoaWxlIChjbnQgPiAwKSB7XG5cdFx0XHRcdHNpYmxpbmcgPSBuLnByZXZpb3VzU2libGluZztcblx0XHRcdFx0eGZlck5vZGUgPSBfdHJhdmVyc2VGdWxseVNlbGVjdGVkKG4sIGhvdyk7XG5cblx0XHRcdFx0aWYgKGZyYWcpIHtcblx0XHRcdFx0XHRmcmFnLmluc2VydEJlZm9yZSh4ZmVyTm9kZSwgZnJhZy5maXJzdENoaWxkKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC0tY250O1xuXHRcdFx0XHRuID0gc2libGluZztcblx0XHRcdH1cblxuXHRcdFx0Ly8gQ29sbGFwc2UgdG8ganVzdCBiZWZvcmUgdGhlIGVuZEFuY2VzdG9yLCB3aGljaFxuXHRcdFx0Ly8gaXMgcGFydGlhbGx5IHNlbGVjdGVkLlxuXHRcdFx0aWYgKGhvdyAhPSBDTE9ORSkge1xuXHRcdFx0XHRzZWxmLnNldEVuZEJlZm9yZShlbmRBbmNlc3Rvcik7XG5cdFx0XHRcdHNlbGYuY29sbGFwc2UoRkFMU0UpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gZnJhZztcblx0XHR9XG5cblx0XHRmdW5jdGlvbiBfdHJhdmVyc2VDb21tb25FbmRDb250YWluZXIoc3RhcnRBbmNlc3RvciwgaG93KSB7XG5cdFx0XHR2YXIgZnJhZywgc3RhcnRJZHgsIG4sIGNudCwgc2libGluZywgeGZlck5vZGU7XG5cblx0XHRcdGlmIChob3cgIT0gREVMRVRFKSB7XG5cdFx0XHRcdGZyYWcgPSBjcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG5cdFx0XHR9XG5cblx0XHRcdG4gPSBfdHJhdmVyc2VMZWZ0Qm91bmRhcnkoc3RhcnRBbmNlc3RvciwgaG93KTtcblx0XHRcdGlmIChmcmFnKSB7XG5cdFx0XHRcdGZyYWcuYXBwZW5kQ2hpbGQobik7XG5cdFx0XHR9XG5cblx0XHRcdHN0YXJ0SWR4ID0gbm9kZUluZGV4KHN0YXJ0QW5jZXN0b3IpO1xuXHRcdFx0KytzdGFydElkeDsgLy8gQmVjYXVzZSB3ZSBhbHJlYWR5IHRyYXZlcnNlZCBpdFxuXG5cdFx0XHRjbnQgPSBzZWxmW0VORF9PRkZTRVRdIC0gc3RhcnRJZHg7XG5cdFx0XHRuID0gc3RhcnRBbmNlc3Rvci5uZXh0U2libGluZztcblx0XHRcdHdoaWxlIChuICYmIGNudCA+IDApIHtcblx0XHRcdFx0c2libGluZyA9IG4ubmV4dFNpYmxpbmc7XG5cdFx0XHRcdHhmZXJOb2RlID0gX3RyYXZlcnNlRnVsbHlTZWxlY3RlZChuLCBob3cpO1xuXG5cdFx0XHRcdGlmIChmcmFnKSB7XG5cdFx0XHRcdFx0ZnJhZy5hcHBlbmRDaGlsZCh4ZmVyTm9kZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQtLWNudDtcblx0XHRcdFx0biA9IHNpYmxpbmc7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChob3cgIT0gQ0xPTkUpIHtcblx0XHRcdFx0c2VsZi5zZXRTdGFydEFmdGVyKHN0YXJ0QW5jZXN0b3IpO1xuXHRcdFx0XHRzZWxmLmNvbGxhcHNlKFRSVUUpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gZnJhZztcblx0XHR9XG5cblx0XHRmdW5jdGlvbiBfdHJhdmVyc2VDb21tb25BbmNlc3RvcnMoc3RhcnRBbmNlc3RvciwgZW5kQW5jZXN0b3IsIGhvdykge1xuXHRcdFx0dmFyIG4sIGZyYWcsIHN0YXJ0T2Zmc2V0LCBlbmRPZmZzZXQsIGNudCwgc2libGluZywgbmV4dFNpYmxpbmc7XG5cblx0XHRcdGlmIChob3cgIT0gREVMRVRFKSB7XG5cdFx0XHRcdGZyYWcgPSBjcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG5cdFx0XHR9XG5cblx0XHRcdG4gPSBfdHJhdmVyc2VMZWZ0Qm91bmRhcnkoc3RhcnRBbmNlc3RvciwgaG93KTtcblx0XHRcdGlmIChmcmFnKSB7XG5cdFx0XHRcdGZyYWcuYXBwZW5kQ2hpbGQobik7XG5cdFx0XHR9XG5cblx0XHRcdHN0YXJ0T2Zmc2V0ID0gbm9kZUluZGV4KHN0YXJ0QW5jZXN0b3IpO1xuXHRcdFx0ZW5kT2Zmc2V0ID0gbm9kZUluZGV4KGVuZEFuY2VzdG9yKTtcblx0XHRcdCsrc3RhcnRPZmZzZXQ7XG5cblx0XHRcdGNudCA9IGVuZE9mZnNldCAtIHN0YXJ0T2Zmc2V0O1xuXHRcdFx0c2libGluZyA9IHN0YXJ0QW5jZXN0b3IubmV4dFNpYmxpbmc7XG5cblx0XHRcdHdoaWxlIChjbnQgPiAwKSB7XG5cdFx0XHRcdG5leHRTaWJsaW5nID0gc2libGluZy5uZXh0U2libGluZztcblx0XHRcdFx0biA9IF90cmF2ZXJzZUZ1bGx5U2VsZWN0ZWQoc2libGluZywgaG93KTtcblxuXHRcdFx0XHRpZiAoZnJhZykge1xuXHRcdFx0XHRcdGZyYWcuYXBwZW5kQ2hpbGQobik7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRzaWJsaW5nID0gbmV4dFNpYmxpbmc7XG5cdFx0XHRcdC0tY250O1xuXHRcdFx0fVxuXG5cdFx0XHRuID0gX3RyYXZlcnNlUmlnaHRCb3VuZGFyeShlbmRBbmNlc3RvciwgaG93KTtcblxuXHRcdFx0aWYgKGZyYWcpIHtcblx0XHRcdFx0ZnJhZy5hcHBlbmRDaGlsZChuKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGhvdyAhPSBDTE9ORSkge1xuXHRcdFx0XHRzZWxmLnNldFN0YXJ0QWZ0ZXIoc3RhcnRBbmNlc3Rvcik7XG5cdFx0XHRcdHNlbGYuY29sbGFwc2UoVFJVRSk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBmcmFnO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIF90cmF2ZXJzZVJpZ2h0Qm91bmRhcnkocm9vdCwgaG93KSB7XG5cdFx0XHR2YXIgbmV4dCA9IF9nZXRTZWxlY3RlZE5vZGUoc2VsZltFTkRfQ09OVEFJTkVSXSwgc2VsZltFTkRfT0ZGU0VUXSAtIDEpLCBwYXJlbnQsIGNsb25lZFBhcmVudDtcblx0XHRcdHZhciBwcmV2U2libGluZywgY2xvbmVkQ2hpbGQsIGNsb25lZEdyYW5kUGFyZW50LCBpc0Z1bGx5U2VsZWN0ZWQgPSBuZXh0ICE9IHNlbGZbRU5EX0NPTlRBSU5FUl07XG5cblx0XHRcdGlmIChuZXh0ID09IHJvb3QpIHtcblx0XHRcdFx0cmV0dXJuIF90cmF2ZXJzZU5vZGUobmV4dCwgaXNGdWxseVNlbGVjdGVkLCBGQUxTRSwgaG93KTtcblx0XHRcdH1cblxuXHRcdFx0cGFyZW50ID0gbmV4dC5wYXJlbnROb2RlO1xuXHRcdFx0Y2xvbmVkUGFyZW50ID0gX3RyYXZlcnNlTm9kZShwYXJlbnQsIEZBTFNFLCBGQUxTRSwgaG93KTtcblxuXHRcdFx0d2hpbGUgKHBhcmVudCkge1xuXHRcdFx0XHR3aGlsZSAobmV4dCkge1xuXHRcdFx0XHRcdHByZXZTaWJsaW5nID0gbmV4dC5wcmV2aW91c1NpYmxpbmc7XG5cdFx0XHRcdFx0Y2xvbmVkQ2hpbGQgPSBfdHJhdmVyc2VOb2RlKG5leHQsIGlzRnVsbHlTZWxlY3RlZCwgRkFMU0UsIGhvdyk7XG5cblx0XHRcdFx0XHRpZiAoaG93ICE9IERFTEVURSkge1xuXHRcdFx0XHRcdFx0Y2xvbmVkUGFyZW50Lmluc2VydEJlZm9yZShjbG9uZWRDaGlsZCwgY2xvbmVkUGFyZW50LmZpcnN0Q2hpbGQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlzRnVsbHlTZWxlY3RlZCA9IFRSVUU7XG5cdFx0XHRcdFx0bmV4dCA9IHByZXZTaWJsaW5nO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHBhcmVudCA9PSByb290KSB7XG5cdFx0XHRcdFx0cmV0dXJuIGNsb25lZFBhcmVudDtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdG5leHQgPSBwYXJlbnQucHJldmlvdXNTaWJsaW5nO1xuXHRcdFx0XHRwYXJlbnQgPSBwYXJlbnQucGFyZW50Tm9kZTtcblxuXHRcdFx0XHRjbG9uZWRHcmFuZFBhcmVudCA9IF90cmF2ZXJzZU5vZGUocGFyZW50LCBGQUxTRSwgRkFMU0UsIGhvdyk7XG5cblx0XHRcdFx0aWYgKGhvdyAhPSBERUxFVEUpIHtcblx0XHRcdFx0XHRjbG9uZWRHcmFuZFBhcmVudC5hcHBlbmRDaGlsZChjbG9uZWRQYXJlbnQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Y2xvbmVkUGFyZW50ID0gY2xvbmVkR3JhbmRQYXJlbnQ7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gX3RyYXZlcnNlTGVmdEJvdW5kYXJ5KHJvb3QsIGhvdykge1xuXHRcdFx0dmFyIG5leHQgPSBfZ2V0U2VsZWN0ZWROb2RlKHNlbGZbU1RBUlRfQ09OVEFJTkVSXSwgc2VsZltTVEFSVF9PRkZTRVRdKSwgaXNGdWxseVNlbGVjdGVkID0gbmV4dCAhPSBzZWxmW1NUQVJUX0NPTlRBSU5FUl07XG5cdFx0XHR2YXIgcGFyZW50LCBjbG9uZWRQYXJlbnQsIG5leHRTaWJsaW5nLCBjbG9uZWRDaGlsZCwgY2xvbmVkR3JhbmRQYXJlbnQ7XG5cblx0XHRcdGlmIChuZXh0ID09IHJvb3QpIHtcblx0XHRcdFx0cmV0dXJuIF90cmF2ZXJzZU5vZGUobmV4dCwgaXNGdWxseVNlbGVjdGVkLCBUUlVFLCBob3cpO1xuXHRcdFx0fVxuXG5cdFx0XHRwYXJlbnQgPSBuZXh0LnBhcmVudE5vZGU7XG5cdFx0XHRjbG9uZWRQYXJlbnQgPSBfdHJhdmVyc2VOb2RlKHBhcmVudCwgRkFMU0UsIFRSVUUsIGhvdyk7XG5cblx0XHRcdHdoaWxlIChwYXJlbnQpIHtcblx0XHRcdFx0d2hpbGUgKG5leHQpIHtcblx0XHRcdFx0XHRuZXh0U2libGluZyA9IG5leHQubmV4dFNpYmxpbmc7XG5cdFx0XHRcdFx0Y2xvbmVkQ2hpbGQgPSBfdHJhdmVyc2VOb2RlKG5leHQsIGlzRnVsbHlTZWxlY3RlZCwgVFJVRSwgaG93KTtcblxuXHRcdFx0XHRcdGlmIChob3cgIT0gREVMRVRFKSB7XG5cdFx0XHRcdFx0XHRjbG9uZWRQYXJlbnQuYXBwZW5kQ2hpbGQoY2xvbmVkQ2hpbGQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlzRnVsbHlTZWxlY3RlZCA9IFRSVUU7XG5cdFx0XHRcdFx0bmV4dCA9IG5leHRTaWJsaW5nO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHBhcmVudCA9PSByb290KSB7XG5cdFx0XHRcdFx0cmV0dXJuIGNsb25lZFBhcmVudDtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdG5leHQgPSBwYXJlbnQubmV4dFNpYmxpbmc7XG5cdFx0XHRcdHBhcmVudCA9IHBhcmVudC5wYXJlbnROb2RlO1xuXG5cdFx0XHRcdGNsb25lZEdyYW5kUGFyZW50ID0gX3RyYXZlcnNlTm9kZShwYXJlbnQsIEZBTFNFLCBUUlVFLCBob3cpO1xuXG5cdFx0XHRcdGlmIChob3cgIT0gREVMRVRFKSB7XG5cdFx0XHRcdFx0Y2xvbmVkR3JhbmRQYXJlbnQuYXBwZW5kQ2hpbGQoY2xvbmVkUGFyZW50KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGNsb25lZFBhcmVudCA9IGNsb25lZEdyYW5kUGFyZW50O1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIF90cmF2ZXJzZU5vZGUobiwgaXNGdWxseVNlbGVjdGVkLCBpc0xlZnQsIGhvdykge1xuXHRcdFx0dmFyIHR4dFZhbHVlLCBuZXdOb2RlVmFsdWUsIG9sZE5vZGVWYWx1ZSwgb2Zmc2V0LCBuZXdOb2RlO1xuXG5cdFx0XHRpZiAoaXNGdWxseVNlbGVjdGVkKSB7XG5cdFx0XHRcdHJldHVybiBfdHJhdmVyc2VGdWxseVNlbGVjdGVkKG4sIGhvdyk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIFRFWFRfTk9ERVxuXHRcdFx0aWYgKG4ubm9kZVR5cGUgPT0gMykge1xuXHRcdFx0XHR0eHRWYWx1ZSA9IG4ubm9kZVZhbHVlO1xuXG5cdFx0XHRcdGlmIChpc0xlZnQpIHtcblx0XHRcdFx0XHRvZmZzZXQgPSBzZWxmW1NUQVJUX09GRlNFVF07XG5cdFx0XHRcdFx0bmV3Tm9kZVZhbHVlID0gdHh0VmFsdWUuc3Vic3RyaW5nKG9mZnNldCk7XG5cdFx0XHRcdFx0b2xkTm9kZVZhbHVlID0gdHh0VmFsdWUuc3Vic3RyaW5nKDAsIG9mZnNldCk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2Zmc2V0ID0gc2VsZltFTkRfT0ZGU0VUXTtcblx0XHRcdFx0XHRuZXdOb2RlVmFsdWUgPSB0eHRWYWx1ZS5zdWJzdHJpbmcoMCwgb2Zmc2V0KTtcblx0XHRcdFx0XHRvbGROb2RlVmFsdWUgPSB0eHRWYWx1ZS5zdWJzdHJpbmcob2Zmc2V0KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChob3cgIT0gQ0xPTkUpIHtcblx0XHRcdFx0XHRuLm5vZGVWYWx1ZSA9IG9sZE5vZGVWYWx1ZTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChob3cgPT0gREVMRVRFKSB7XG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0bmV3Tm9kZSA9IGRvbS5jbG9uZShuLCBGQUxTRSk7XG5cdFx0XHRcdG5ld05vZGUubm9kZVZhbHVlID0gbmV3Tm9kZVZhbHVlO1xuXG5cdFx0XHRcdHJldHVybiBuZXdOb2RlO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoaG93ID09IERFTEVURSkge1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBkb20uY2xvbmUobiwgRkFMU0UpO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIF90cmF2ZXJzZUZ1bGx5U2VsZWN0ZWQobiwgaG93KSB7XG5cdFx0XHRpZiAoaG93ICE9IERFTEVURSkge1xuXHRcdFx0XHRyZXR1cm4gaG93ID09IENMT05FID8gZG9tLmNsb25lKG4sIFRSVUUpIDogbjtcblx0XHRcdH1cblxuXHRcdFx0bi5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG4pO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIHRvU3RyaW5nSUUoKSB7XG5cdFx0XHRyZXR1cm4gZG9tLmNyZWF0ZSgnYm9keScsIG51bGwsIGNsb25lQ29udGVudHMoKSkub3V0ZXJUZXh0O1xuXHRcdH1cblxuXHRcdGV4dGVuZChzZWxmLCB7XG5cdFx0XHQvLyBJbml0aWFsIHN0YXRlc1xuXHRcdFx0c3RhcnRDb250YWluZXI6IGRvYyxcblx0XHRcdHN0YXJ0T2Zmc2V0OiAwLFxuXHRcdFx0ZW5kQ29udGFpbmVyOiBkb2MsXG5cdFx0XHRlbmRPZmZzZXQ6IDAsXG5cdFx0XHRjb2xsYXBzZWQ6IFRSVUUsXG5cdFx0XHRjb21tb25BbmNlc3RvckNvbnRhaW5lcjogZG9jLFxuXG5cdFx0XHQvLyBSYW5nZSBjb25zdGFudHNcblx0XHRcdFNUQVJUX1RPX1NUQVJUOiAwLFxuXHRcdFx0U1RBUlRfVE9fRU5EOiAxLFxuXHRcdFx0RU5EX1RPX0VORDogMixcblx0XHRcdEVORF9UT19TVEFSVDogMyxcblxuXHRcdFx0Ly8gUHVibGljIG1ldGhvZHNcblx0XHRcdHNldFN0YXJ0OiBzZXRTdGFydCxcblx0XHRcdHNldEVuZDogc2V0RW5kLFxuXHRcdFx0c2V0U3RhcnRCZWZvcmU6IHNldFN0YXJ0QmVmb3JlLFxuXHRcdFx0c2V0U3RhcnRBZnRlcjogc2V0U3RhcnRBZnRlcixcblx0XHRcdHNldEVuZEJlZm9yZTogc2V0RW5kQmVmb3JlLFxuXHRcdFx0c2V0RW5kQWZ0ZXI6IHNldEVuZEFmdGVyLFxuXHRcdFx0Y29sbGFwc2U6IGNvbGxhcHNlLFxuXHRcdFx0c2VsZWN0Tm9kZTogc2VsZWN0Tm9kZSxcblx0XHRcdHNlbGVjdE5vZGVDb250ZW50czogc2VsZWN0Tm9kZUNvbnRlbnRzLFxuXHRcdFx0Y29tcGFyZUJvdW5kYXJ5UG9pbnRzOiBjb21wYXJlQm91bmRhcnlQb2ludHMsXG5cdFx0XHRkZWxldGVDb250ZW50czogZGVsZXRlQ29udGVudHMsXG5cdFx0XHRleHRyYWN0Q29udGVudHM6IGV4dHJhY3RDb250ZW50cyxcblx0XHRcdGNsb25lQ29udGVudHM6IGNsb25lQ29udGVudHMsXG5cdFx0XHRpbnNlcnROb2RlOiBpbnNlcnROb2RlLFxuXHRcdFx0c3Vycm91bmRDb250ZW50czogc3Vycm91bmRDb250ZW50cyxcblx0XHRcdGNsb25lUmFuZ2U6IGNsb25lUmFuZ2UsXG5cdFx0XHR0b1N0cmluZ0lFOiB0b1N0cmluZ0lFXG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gc2VsZjtcblx0fVxuXG5cdC8vIE9sZGVyIElFIHZlcnNpb25zIGRvZXNuJ3QgbGV0IHlvdSBvdmVycmlkZSB0b1N0cmluZyBieSBpdCdzIGNvbnN0cnVjdG9yIHNvIHdlIGhhdmUgdG8gc3RpY2sgaXQgaW4gdGhlIHByb3RvdHlwZVxuXHRSYW5nZS5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbigpIHtcblx0XHRyZXR1cm4gdGhpcy50b1N0cmluZ0lFKCk7XG5cdH07XG5cblx0cmV0dXJuIFJhbmdlO1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy9odG1sL0VudGl0aWVzLmpzXG5cbi8qKlxuICogRW50aXRpZXMuanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLypqc2hpbnQgYml0d2lzZTpmYWxzZSAqL1xuLyplc2xpbnQgbm8tYml0d2lzZTowICovXG5cbi8qKlxuICogRW50aXR5IGVuY29kZXIgY2xhc3MuXG4gKlxuICogQGNsYXNzIHRpbnltY2UuaHRtbC5FbnRpdGllc1xuICogQHN0YXRpY1xuICogQHZlcnNpb24gMy40XG4gKi9cbmRlZmluZShcInRpbnltY2UvaHRtbC9FbnRpdGllc1wiLCBbXG5cdFwidGlueW1jZS91dGlsL1Rvb2xzXCJcbl0sIGZ1bmN0aW9uKFRvb2xzKSB7XG5cdHZhciBtYWtlTWFwID0gVG9vbHMubWFrZU1hcDtcblxuXHR2YXIgbmFtZWRFbnRpdGllcywgYmFzZUVudGl0aWVzLCByZXZlcnNlRW50aXRpZXMsXG5cdFx0YXR0cnNDaGFyc1JlZ0V4cCA9IC9bJjw+XFxcIlxcdTAwNjBcXHUwMDdFLVxcdUQ3RkZcXHVFMDAwLVxcdUZGRUZdfFtcXHVEODAwLVxcdURCRkZdW1xcdURDMDAtXFx1REZGRl0vZyxcblx0XHR0ZXh0Q2hhcnNSZWdFeHAgPSAvWzw+JlxcdTAwN0UtXFx1RDdGRlxcdUUwMDAtXFx1RkZFRl18W1xcdUQ4MDAtXFx1REJGRl1bXFx1REMwMC1cXHVERkZGXS9nLFxuXHRcdHJhd0NoYXJzUmVnRXhwID0gL1s8PiZcXFwiXFwnXS9nLFxuXHRcdGVudGl0eVJlZ0V4cCA9IC8mIyhbYS16MC05XSspOz98JihbYS16MC05XSspOy9naSxcblx0XHRhc2NpaU1hcCA9IHtcblx0XHRcdDEyODogXCJcXHUyMEFDXCIsIDEzMDogXCJcXHUyMDFBXCIsIDEzMTogXCJcXHUwMTkyXCIsIDEzMjogXCJcXHUyMDFFXCIsIDEzMzogXCJcXHUyMDI2XCIsIDEzNDogXCJcXHUyMDIwXCIsXG5cdFx0XHQxMzU6IFwiXFx1MjAyMVwiLCAxMzY6IFwiXFx1MDJDNlwiLCAxMzc6IFwiXFx1MjAzMFwiLCAxMzg6IFwiXFx1MDE2MFwiLCAxMzk6IFwiXFx1MjAzOVwiLCAxNDA6IFwiXFx1MDE1MlwiLFxuXHRcdFx0MTQyOiBcIlxcdTAxN0RcIiwgMTQ1OiBcIlxcdTIwMThcIiwgMTQ2OiBcIlxcdTIwMTlcIiwgMTQ3OiBcIlxcdTIwMUNcIiwgMTQ4OiBcIlxcdTIwMURcIiwgMTQ5OiBcIlxcdTIwMjJcIixcblx0XHRcdDE1MDogXCJcXHUyMDEzXCIsIDE1MTogXCJcXHUyMDE0XCIsIDE1MjogXCJcXHUwMkRDXCIsIDE1MzogXCJcXHUyMTIyXCIsIDE1NDogXCJcXHUwMTYxXCIsIDE1NTogXCJcXHUyMDNBXCIsXG5cdFx0XHQxNTY6IFwiXFx1MDE1M1wiLCAxNTg6IFwiXFx1MDE3RVwiLCAxNTk6IFwiXFx1MDE3OFwiXG5cdFx0fTtcblxuXHQvLyBSYXcgZW50aXRpZXNcblx0YmFzZUVudGl0aWVzID0ge1xuXHRcdCdcXFwiJzogJyZxdW90OycsIC8vIE5lZWRzIHRvIGJlIGVzY2FwZWQgc2luY2UgdGhlIFlVSSBjb21wcmVzc29yIHdvdWxkIG90aGVyd2lzZSBicmVhayB0aGUgY29kZVxuXHRcdFwiJ1wiOiAnJiMzOTsnLFxuXHRcdCc8JzogJyZsdDsnLFxuXHRcdCc+JzogJyZndDsnLFxuXHRcdCcmJzogJyZhbXA7Jyxcblx0XHQnXFx1MDA2MCc6ICcmIzk2Oydcblx0fTtcblxuXHQvLyBSZXZlcnNlIGxvb2t1cCB0YWJsZSBmb3IgcmF3IGVudGl0aWVzXG5cdHJldmVyc2VFbnRpdGllcyA9IHtcblx0XHQnJmx0Oyc6ICc8Jyxcblx0XHQnJmd0Oyc6ICc+Jyxcblx0XHQnJmFtcDsnOiAnJicsXG5cdFx0JyZxdW90Oyc6ICdcIicsXG5cdFx0JyZhcG9zOyc6IFwiJ1wiXG5cdH07XG5cblx0Ly8gRGVjb2RlcyB0ZXh0IGJ5IHVzaW5nIHRoZSBicm93c2VyXG5cdGZ1bmN0aW9uIG5hdGl2ZURlY29kZSh0ZXh0KSB7XG5cdFx0dmFyIGVsbTtcblxuXHRcdGVsbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cdFx0ZWxtLmlubmVySFRNTCA9IHRleHQ7XG5cblx0XHRyZXR1cm4gZWxtLnRleHRDb250ZW50IHx8IGVsbS5pbm5lclRleHQgfHwgdGV4dDtcblx0fVxuXG5cdC8vIEJ1aWxkIGEgdHdvIHdheSBsb29rdXAgdGFibGUgZm9yIHRoZSBlbnRpdGllc1xuXHRmdW5jdGlvbiBidWlsZEVudGl0aWVzTG9va3VwKGl0ZW1zLCByYWRpeCkge1xuXHRcdHZhciBpLCBjaHIsIGVudGl0eSwgbG9va3VwID0ge307XG5cblx0XHRpZiAoaXRlbXMpIHtcblx0XHRcdGl0ZW1zID0gaXRlbXMuc3BsaXQoJywnKTtcblx0XHRcdHJhZGl4ID0gcmFkaXggfHwgMTA7XG5cblx0XHRcdC8vIEJ1aWxkIGVudGl0aWVzIGxvb2t1cCB0YWJsZVxuXHRcdFx0Zm9yIChpID0gMDsgaSA8IGl0ZW1zLmxlbmd0aDsgaSArPSAyKSB7XG5cdFx0XHRcdGNociA9IFN0cmluZy5mcm9tQ2hhckNvZGUocGFyc2VJbnQoaXRlbXNbaV0sIHJhZGl4KSk7XG5cblx0XHRcdFx0Ly8gT25seSBhZGQgbm9uIGJhc2UgZW50aXRpZXNcblx0XHRcdFx0aWYgKCFiYXNlRW50aXRpZXNbY2hyXSkge1xuXHRcdFx0XHRcdGVudGl0eSA9ICcmJyArIGl0ZW1zW2kgKyAxXSArICc7Jztcblx0XHRcdFx0XHRsb29rdXBbY2hyXSA9IGVudGl0eTtcblx0XHRcdFx0XHRsb29rdXBbZW50aXR5XSA9IGNocjtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbG9va3VwO1xuXHRcdH1cblx0fVxuXG5cdC8vIFVucGFjayBlbnRpdGllcyBsb29rdXAgd2hlcmUgdGhlIG51bWJlcnMgYXJlIGluIHJhZGl4IDMyIHRvIHJlZHVjZSB0aGUgc2l6ZVxuXHRuYW1lZEVudGl0aWVzID0gYnVpbGRFbnRpdGllc0xvb2t1cChcblx0XHQnNTAsbmJzcCw1MSxpZXhjbCw1MixjZW50LDUzLHBvdW5kLDU0LGN1cnJlbiw1NSx5ZW4sNTYsYnJ2YmFyLDU3LHNlY3QsNTgsdW1sLDU5LGNvcHksJyArXG5cdFx0JzVhLG9yZGYsNWIsbGFxdW8sNWMsbm90LDVkLHNoeSw1ZSxyZWcsNWYsbWFjciw1ZyxkZWcsNWgscGx1c21uLDVpLHN1cDIsNWosc3VwMyw1ayxhY3V0ZSwnICtcblx0XHQnNWwsbWljcm8sNW0scGFyYSw1bixtaWRkb3QsNW8sY2VkaWwsNXAsc3VwMSw1cSxvcmRtLDVyLHJhcXVvLDVzLGZyYWMxNCw1dCxmcmFjMTIsNXUsZnJhYzM0LCcgK1xuXHRcdCc1dixpcXVlc3QsNjAsQWdyYXZlLDYxLEFhY3V0ZSw2MixBY2lyYyw2MyxBdGlsZGUsNjQsQXVtbCw2NSxBcmluZyw2NixBRWxpZyw2NyxDY2VkaWwsJyArXG5cdFx0JzY4LEVncmF2ZSw2OSxFYWN1dGUsNmEsRWNpcmMsNmIsRXVtbCw2YyxJZ3JhdmUsNmQsSWFjdXRlLDZlLEljaXJjLDZmLEl1bWwsNmcsRVRILDZoLE50aWxkZSwnICtcblx0XHQnNmksT2dyYXZlLDZqLE9hY3V0ZSw2ayxPY2lyYyw2bCxPdGlsZGUsNm0sT3VtbCw2bix0aW1lcyw2byxPc2xhc2gsNnAsVWdyYXZlLDZxLFVhY3V0ZSwnICtcblx0XHQnNnIsVWNpcmMsNnMsVXVtbCw2dCxZYWN1dGUsNnUsVEhPUk4sNnYsc3psaWcsNzAsYWdyYXZlLDcxLGFhY3V0ZSw3MixhY2lyYyw3MyxhdGlsZGUsNzQsYXVtbCwnICtcblx0XHQnNzUsYXJpbmcsNzYsYWVsaWcsNzcsY2NlZGlsLDc4LGVncmF2ZSw3OSxlYWN1dGUsN2EsZWNpcmMsN2IsZXVtbCw3YyxpZ3JhdmUsN2QsaWFjdXRlLDdlLGljaXJjLCcgK1xuXHRcdCc3ZixpdW1sLDdnLGV0aCw3aCxudGlsZGUsN2ksb2dyYXZlLDdqLG9hY3V0ZSw3ayxvY2lyYyw3bCxvdGlsZGUsN20sb3VtbCw3bixkaXZpZGUsN28sb3NsYXNoLCcgK1xuXHRcdCc3cCx1Z3JhdmUsN3EsdWFjdXRlLDdyLHVjaXJjLDdzLHV1bWwsN3QseWFjdXRlLDd1LHRob3JuLDd2LHl1bWwsY2ksZm5vZixzaCxBbHBoYSxzaSxCZXRhLCcgK1xuXHRcdCdzaixHYW1tYSxzayxEZWx0YSxzbCxFcHNpbG9uLHNtLFpldGEsc24sRXRhLHNvLFRoZXRhLHNwLElvdGEsc3EsS2FwcGEsc3IsTGFtYmRhLHNzLE11LCcgK1xuXHRcdCdzdCxOdSxzdSxYaSxzdixPbWljcm9uLHQwLFBpLHQxLFJobyx0MyxTaWdtYSx0NCxUYXUsdDUsVXBzaWxvbix0NixQaGksdDcsQ2hpLHQ4LFBzaSwnICtcblx0XHQndDksT21lZ2EsdGgsYWxwaGEsdGksYmV0YSx0aixnYW1tYSx0ayxkZWx0YSx0bCxlcHNpbG9uLHRtLHpldGEsdG4sZXRhLHRvLHRoZXRhLHRwLGlvdGEsJyArXG5cdFx0J3RxLGthcHBhLHRyLGxhbWJkYSx0cyxtdSx0dCxudSx0dSx4aSx0dixvbWljcm9uLHUwLHBpLHUxLHJobyx1MixzaWdtYWYsdTMsc2lnbWEsdTQsdGF1LCcgK1xuXHRcdCd1NSx1cHNpbG9uLHU2LHBoaSx1NyxjaGksdTgscHNpLHU5LG9tZWdhLHVoLHRoZXRhc3ltLHVpLHVwc2loLHVtLHBpdiw4MTIsYnVsbCw4MTYsaGVsbGlwLCcgK1xuXHRcdCc4MWkscHJpbWUsODFqLFByaW1lLDgxdSxvbGluZSw4MjQsZnJhc2wsODhvLHdlaWVycCw4OGgsaW1hZ2UsODhzLHJlYWwsODkyLHRyYWRlLDg5bCxhbGVmc3ltLCcgK1xuXHRcdCc4Y2csbGFyciw4Y2gsdWFyciw4Y2kscmFyciw4Y2osZGFyciw4Y2ssaGFyciw4ZGwsY3JhcnIsOGVnLGxBcnIsOGVoLHVBcnIsOGVpLHJBcnIsOGVqLGRBcnIsJyArXG5cdFx0JzhlayxoQXJyLDhnMCxmb3JhbGwsOGcyLHBhcnQsOGczLGV4aXN0LDhnNSxlbXB0eSw4ZzcsbmFibGEsOGc4LGlzaW4sOGc5LG5vdGluLDhnYixuaSw4Z2YscHJvZCwnICtcblx0XHQnOGdoLHN1bSw4Z2ksbWludXMsOGduLGxvd2FzdCw4Z3EscmFkaWMsOGd0LHByb3AsOGd1LGluZmluLDhoMCxhbmcsOGg3LGFuZCw4aDgsb3IsOGg5LGNhcCw4aGEsY3VwLCcgK1xuXHRcdCc4aGIsaW50LDhoayx0aGVyZTQsOGhzLHNpbSw4aTUsY29uZyw4aTgsYXN5bXAsOGowLG5lLDhqMSxlcXVpdiw4ajQsbGUsOGo1LGdlLDhrMixzdWIsOGszLHN1cCw4azQsJyArXG5cdFx0J25zdWIsOGs2LHN1YmUsOGs3LHN1cGUsOGtsLG9wbHVzLDhrbixvdGltZXMsOGw1LHBlcnAsOG01LHNkb3QsOG84LGxjZWlsLDhvOSxyY2VpbCw4b2EsbGZsb29yLDhvYiwnICtcblx0XHQncmZsb29yLDhwOSxsYW5nLDhwYSxyYW5nLDllYSxsb3osOWowLHNwYWRlcyw5ajMsY2x1YnMsOWo1LGhlYXJ0cyw5ajYsZGlhbXMsYWksT0VsaWcsYWosb2VsaWcsYjAsJyArXG5cdFx0J1NjYXJvbixiMSxzY2Fyb24sYm8sWXVtbCxtNixjaXJjLG1zLHRpbGRlLDgwMixlbnNwLDgwMyxlbXNwLDgwOSx0aGluc3AsODBjLHp3bmosODBkLHp3aiw4MGUsbHJtLCcgK1xuXHRcdCc4MGYscmxtLDgwaixuZGFzaCw4MGssbWRhc2gsODBvLGxzcXVvLDgwcCxyc3F1byw4MHEsc2JxdW8sODBzLGxkcXVvLDgwdCxyZHF1byw4MHUsYmRxdW8sODEwLGRhZ2dlciwnICtcblx0XHQnODExLERhZ2dlciw4MWcscGVybWlsLDgxcCxsc2FxdW8sODFxLHJzYXF1byw4NWMsZXVybycsIDMyKTtcblxuXHR2YXIgRW50aXRpZXMgPSB7XG5cdFx0LyoqXG5cdFx0ICogRW5jb2RlcyB0aGUgc3BlY2lmaWVkIHN0cmluZyB1c2luZyByYXcgZW50aXRpZXMuIFRoaXMgbWVhbnMgb25seSB0aGUgcmVxdWlyZWQgWE1MIGJhc2UgZW50aXRpZXMgd2lsbCBiZSBlbmNvZGVkLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBlbmNvZGVSYXdcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gdGV4dCBUZXh0IHRvIGVuY29kZS5cblx0XHQgKiBAcGFyYW0ge0Jvb2xlYW59IGF0dHIgT3B0aW9uYWwgZmxhZyB0byBzcGVjaWZ5IGlmIHRoZSB0ZXh0IGlzIGF0dHJpYnV0ZSBjb250ZW50cy5cblx0XHQgKiBAcmV0dXJuIHtTdHJpbmd9IEVudGl0eSBlbmNvZGVkIHRleHQuXG5cdFx0ICovXG5cdFx0ZW5jb2RlUmF3OiBmdW5jdGlvbih0ZXh0LCBhdHRyKSB7XG5cdFx0XHRyZXR1cm4gdGV4dC5yZXBsYWNlKGF0dHIgPyBhdHRyc0NoYXJzUmVnRXhwIDogdGV4dENoYXJzUmVnRXhwLCBmdW5jdGlvbihjaHIpIHtcblx0XHRcdFx0cmV0dXJuIGJhc2VFbnRpdGllc1tjaHJdIHx8IGNocjtcblx0XHRcdH0pO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBFbmNvZGVkIHRoZSBzcGVjaWZpZWQgdGV4dCB3aXRoIGJvdGggdGhlIGF0dHJpYnV0ZXMgYW5kIHRleHQgZW50aXRpZXMuIFRoaXMgZnVuY3Rpb24gd2lsbCBwcm9kdWNlIGxhcmdlciB0ZXh0IGNvbnRlbnRzXG5cdFx0ICogc2luY2UgaXQgZG9lc24ndCBrbm93IGlmIHRoZSBjb250ZXh0IGlzIHdpdGhpbiBhIGF0dHJpYnV0ZSBvciB0ZXh0IG5vZGUuIFRoaXMgd2FzIGFkZGVkIGZvciBjb21wYXRpYmlsaXR5XG5cdFx0ICogYW5kIGlzIGV4cG9zZWQgYXMgdGhlIERPTVV0aWxzLmVuY29kZSBmdW5jdGlvbi5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgZW5jb2RlQWxsUmF3XG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IHRleHQgVGV4dCB0byBlbmNvZGUuXG5cdFx0ICogQHJldHVybiB7U3RyaW5nfSBFbnRpdHkgZW5jb2RlZCB0ZXh0LlxuXHRcdCAqL1xuXHRcdGVuY29kZUFsbFJhdzogZnVuY3Rpb24odGV4dCkge1xuXHRcdFx0cmV0dXJuICgnJyArIHRleHQpLnJlcGxhY2UocmF3Q2hhcnNSZWdFeHAsIGZ1bmN0aW9uKGNocikge1xuXHRcdFx0XHRyZXR1cm4gYmFzZUVudGl0aWVzW2Nocl0gfHwgY2hyO1xuXHRcdFx0fSk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIEVuY29kZXMgdGhlIHNwZWNpZmllZCBzdHJpbmcgdXNpbmcgbnVtZXJpYyBlbnRpdGllcy4gVGhlIGNvcmUgZW50aXRpZXMgd2lsbCBiZVxuXHRcdCAqIGVuY29kZWQgYXMgbmFtZWQgb25lcyBidXQgYWxsIG5vbiBsb3dlciBhc2NpaSBjaGFyYWN0ZXJzIHdpbGwgYmUgZW5jb2RlZCBpbnRvIG51bWVyaWMgZW50aXRpZXMuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGVuY29kZU51bWVyaWNcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gdGV4dCBUZXh0IHRvIGVuY29kZS5cblx0XHQgKiBAcGFyYW0ge0Jvb2xlYW59IGF0dHIgT3B0aW9uYWwgZmxhZyB0byBzcGVjaWZ5IGlmIHRoZSB0ZXh0IGlzIGF0dHJpYnV0ZSBjb250ZW50cy5cblx0XHQgKiBAcmV0dXJuIHtTdHJpbmd9IEVudGl0eSBlbmNvZGVkIHRleHQuXG5cdFx0ICovXG5cdFx0ZW5jb2RlTnVtZXJpYzogZnVuY3Rpb24odGV4dCwgYXR0cikge1xuXHRcdFx0cmV0dXJuIHRleHQucmVwbGFjZShhdHRyID8gYXR0cnNDaGFyc1JlZ0V4cCA6IHRleHRDaGFyc1JlZ0V4cCwgZnVuY3Rpb24oY2hyKSB7XG5cdFx0XHRcdC8vIE11bHRpIGJ5dGUgc2VxdWVuY2UgY29udmVydCBpdCB0byBhIHNpbmdsZSBlbnRpdHlcblx0XHRcdFx0aWYgKGNoci5sZW5ndGggPiAxKSB7XG5cdFx0XHRcdFx0cmV0dXJuICcmIycgKyAoKChjaHIuY2hhckNvZGVBdCgwKSAtIDB4RDgwMCkgKiAweDQwMCkgKyAoY2hyLmNoYXJDb2RlQXQoMSkgLSAweERDMDApICsgMHgxMDAwMCkgKyAnOyc7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gYmFzZUVudGl0aWVzW2Nocl0gfHwgJyYjJyArIGNoci5jaGFyQ29kZUF0KDApICsgJzsnO1xuXHRcdFx0fSk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIEVuY29kZXMgdGhlIHNwZWNpZmllZCBzdHJpbmcgdXNpbmcgbmFtZWQgZW50aXRpZXMuIFRoZSBjb3JlIGVudGl0aWVzIHdpbGwgYmUgZW5jb2RlZFxuXHRcdCAqIGFzIG5hbWVkIG9uZXMgYnV0IGFsbCBub24gbG93ZXIgYXNjaWkgY2hhcmFjdGVycyB3aWxsIGJlIGVuY29kZWQgaW50byBuYW1lZCBlbnRpdGllcy5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgZW5jb2RlTmFtZWRcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gdGV4dCBUZXh0IHRvIGVuY29kZS5cblx0XHQgKiBAcGFyYW0ge0Jvb2xlYW59IGF0dHIgT3B0aW9uYWwgZmxhZyB0byBzcGVjaWZ5IGlmIHRoZSB0ZXh0IGlzIGF0dHJpYnV0ZSBjb250ZW50cy5cblx0XHQgKiBAcGFyYW0ge09iamVjdH0gZW50aXRpZXMgT3B0aW9uYWwgcGFyYW1ldGVyIHdpdGggZW50aXRpZXMgdG8gdXNlLlxuXHRcdCAqIEByZXR1cm4ge1N0cmluZ30gRW50aXR5IGVuY29kZWQgdGV4dC5cblx0XHQgKi9cblx0XHRlbmNvZGVOYW1lZDogZnVuY3Rpb24odGV4dCwgYXR0ciwgZW50aXRpZXMpIHtcblx0XHRcdGVudGl0aWVzID0gZW50aXRpZXMgfHwgbmFtZWRFbnRpdGllcztcblxuXHRcdFx0cmV0dXJuIHRleHQucmVwbGFjZShhdHRyID8gYXR0cnNDaGFyc1JlZ0V4cCA6IHRleHRDaGFyc1JlZ0V4cCwgZnVuY3Rpb24oY2hyKSB7XG5cdFx0XHRcdHJldHVybiBiYXNlRW50aXRpZXNbY2hyXSB8fCBlbnRpdGllc1tjaHJdIHx8IGNocjtcblx0XHRcdH0pO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZXR1cm5zIGFuIGVuY29kZSBmdW5jdGlvbiBiYXNlZCBvbiB0aGUgbmFtZShzKSBhbmQgaXQncyBvcHRpb25hbCBlbnRpdGllcy5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgZ2V0RW5jb2RlRnVuY1xuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIENvbW1hIHNlcGFyYXRlZCBsaXN0IG9mIGVuY29kZXJzIGZvciBleGFtcGxlIG5hbWVkLG51bWVyaWMuXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IGVudGl0aWVzIE9wdGlvbmFsIHBhcmFtZXRlciB3aXRoIGVudGl0aWVzIHRvIHVzZSBpbnN0ZWFkIG9mIHRoZSBidWlsdCBpbiBzZXQuXG5cdFx0ICogQHJldHVybiB7ZnVuY3Rpb259IEVuY29kZSBmdW5jdGlvbiB0byBiZSB1c2VkLlxuXHRcdCAqL1xuXHRcdGdldEVuY29kZUZ1bmM6IGZ1bmN0aW9uKG5hbWUsIGVudGl0aWVzKSB7XG5cdFx0XHRlbnRpdGllcyA9IGJ1aWxkRW50aXRpZXNMb29rdXAoZW50aXRpZXMpIHx8IG5hbWVkRW50aXRpZXM7XG5cblx0XHRcdGZ1bmN0aW9uIGVuY29kZU5hbWVkQW5kTnVtZXJpYyh0ZXh0LCBhdHRyKSB7XG5cdFx0XHRcdHJldHVybiB0ZXh0LnJlcGxhY2UoYXR0ciA/IGF0dHJzQ2hhcnNSZWdFeHAgOiB0ZXh0Q2hhcnNSZWdFeHAsIGZ1bmN0aW9uKGNocikge1xuXHRcdFx0XHRcdHJldHVybiBiYXNlRW50aXRpZXNbY2hyXSB8fCBlbnRpdGllc1tjaHJdIHx8ICcmIycgKyBjaHIuY2hhckNvZGVBdCgwKSArICc7JyB8fCBjaHI7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRmdW5jdGlvbiBlbmNvZGVDdXN0b21OYW1lZCh0ZXh0LCBhdHRyKSB7XG5cdFx0XHRcdHJldHVybiBFbnRpdGllcy5lbmNvZGVOYW1lZCh0ZXh0LCBhdHRyLCBlbnRpdGllcyk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIFJlcGxhY2UgKyB3aXRoICwgdG8gYmUgY29tcGF0aWJsZSB3aXRoIHByZXZpb3VzIFRpbnlNQ0UgdmVyc2lvbnNcblx0XHRcdG5hbWUgPSBtYWtlTWFwKG5hbWUucmVwbGFjZSgvXFwrL2csICcsJykpO1xuXG5cdFx0XHQvLyBOYW1lZCBhbmQgbnVtZXJpYyBlbmNvZGVyXG5cdFx0XHRpZiAobmFtZS5uYW1lZCAmJiBuYW1lLm51bWVyaWMpIHtcblx0XHRcdFx0cmV0dXJuIGVuY29kZU5hbWVkQW5kTnVtZXJpYztcblx0XHRcdH1cblxuXHRcdFx0Ly8gTmFtZWQgZW5jb2RlclxuXHRcdFx0aWYgKG5hbWUubmFtZWQpIHtcblx0XHRcdFx0Ly8gQ3VzdG9tIG5hbWVzXG5cdFx0XHRcdGlmIChlbnRpdGllcykge1xuXHRcdFx0XHRcdHJldHVybiBlbmNvZGVDdXN0b21OYW1lZDtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBFbnRpdGllcy5lbmNvZGVOYW1lZDtcblx0XHRcdH1cblxuXHRcdFx0Ly8gTnVtZXJpY1xuXHRcdFx0aWYgKG5hbWUubnVtZXJpYykge1xuXHRcdFx0XHRyZXR1cm4gRW50aXRpZXMuZW5jb2RlTnVtZXJpYztcblx0XHRcdH1cblxuXHRcdFx0Ly8gUmF3IGVuY29kZXJcblx0XHRcdHJldHVybiBFbnRpdGllcy5lbmNvZGVSYXc7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIERlY29kZXMgdGhlIHNwZWNpZmllZCBzdHJpbmcsIHRoaXMgd2lsbCByZXBsYWNlIGVudGl0aWVzIHdpdGggcmF3IFVURiBjaGFyYWN0ZXJzLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBkZWNvZGVcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gdGV4dCBUZXh0IHRvIGVudGl0eSBkZWNvZGUuXG5cdFx0ICogQHJldHVybiB7U3RyaW5nfSBFbnRpdHkgZGVjb2RlZCBzdHJpbmcuXG5cdFx0ICovXG5cdFx0ZGVjb2RlOiBmdW5jdGlvbih0ZXh0KSB7XG5cdFx0XHRyZXR1cm4gdGV4dC5yZXBsYWNlKGVudGl0eVJlZ0V4cCwgZnVuY3Rpb24oYWxsLCBudW1lcmljKSB7XG5cdFx0XHRcdGlmIChudW1lcmljKSB7XG5cdFx0XHRcdFx0aWYgKG51bWVyaWMuY2hhckF0KDApLnRvTG93ZXJDYXNlKCkgPT09ICd4Jykge1xuXHRcdFx0XHRcdFx0bnVtZXJpYyA9IHBhcnNlSW50KG51bWVyaWMuc3Vic3RyKDEpLCAxNik7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdG51bWVyaWMgPSBwYXJzZUludChudW1lcmljLCAxMCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Ly8gU3VwcG9ydCB1cHBlciBVVEZcblx0XHRcdFx0XHRpZiAobnVtZXJpYyA+IDB4RkZGRikge1xuXHRcdFx0XHRcdFx0bnVtZXJpYyAtPSAweDEwMDAwO1xuXG5cdFx0XHRcdFx0XHRyZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZSgweEQ4MDAgKyAobnVtZXJpYyA+PiAxMCksIDB4REMwMCArIChudW1lcmljICYgMHgzRkYpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gYXNjaWlNYXBbbnVtZXJpY10gfHwgU3RyaW5nLmZyb21DaGFyQ29kZShudW1lcmljKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByZXZlcnNlRW50aXRpZXNbYWxsXSB8fCBuYW1lZEVudGl0aWVzW2FsbF0gfHwgbmF0aXZlRGVjb2RlKGFsbCk7XG5cdFx0XHR9KTtcblx0XHR9XG5cdH07XG5cblx0cmV0dXJuIEVudGl0aWVzO1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy9kb20vU3R5bGVTaGVldExvYWRlci5qc1xuXG4vKipcbiAqIFN0eWxlU2hlZXRMb2FkZXIuanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBUaGlzIGNsYXNzIGhhbmRsZXMgbG9hZGluZyBvZiBleHRlcm5hbCBzdHlsZXNoZWV0cyBhbmQgZmlyZXMgZXZlbnRzIHdoZW4gdGhlc2UgYXJlIGxvYWRlZC5cbiAqXG4gKiBAY2xhc3MgdGlueW1jZS5kb20uU3R5bGVTaGVldExvYWRlclxuICogQHByaXZhdGVcbiAqL1xuZGVmaW5lKFwidGlueW1jZS9kb20vU3R5bGVTaGVldExvYWRlclwiLCBbXG5cdFwidGlueW1jZS91dGlsL1Rvb2xzXCIsXG5cdFwidGlueW1jZS91dGlsL0RlbGF5XCJcbl0sIGZ1bmN0aW9uKFRvb2xzLCBEZWxheSkge1xuXHRcInVzZSBzdHJpY3RcIjtcblxuXHRyZXR1cm4gZnVuY3Rpb24oZG9jdW1lbnQsIHNldHRpbmdzKSB7XG5cdFx0dmFyIGlkQ291bnQgPSAwLCBsb2FkZWRTdGF0ZXMgPSB7fSwgbWF4TG9hZFRpbWU7XG5cblx0XHRzZXR0aW5ncyA9IHNldHRpbmdzIHx8IHt9O1xuXHRcdG1heExvYWRUaW1lID0gc2V0dGluZ3MubWF4TG9hZFRpbWUgfHwgNTAwMDtcblxuXHRcdGZ1bmN0aW9uIGFwcGVuZFRvSGVhZChub2RlKSB7XG5cdFx0XHRkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaGVhZCcpWzBdLmFwcGVuZENoaWxkKG5vZGUpO1xuXHRcdH1cblxuXHRcdC8qKlxuXHRcdCAqIExvYWRzIHRoZSBzcGVjaWZpZWQgY3NzIHN0eWxlIHNoZWV0IGZpbGUgYW5kIGNhbGwgdGhlIGxvYWRlZENhbGxiYWNrIG9uY2UgaXQncyBmaW5pc2hlZCBsb2FkaW5nLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBsb2FkXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IHVybCBVcmwgdG8gYmUgbG9hZGVkLlxuXHRcdCAqIEBwYXJhbSB7RnVuY3Rpb259IGxvYWRlZENhbGxiYWNrIENhbGxiYWNrIHRvIGJlIGV4ZWN1dGVkIHdoZW4gbG9hZGVkLlxuXHRcdCAqIEBwYXJhbSB7RnVuY3Rpb259IGVycm9yQ2FsbGJhY2sgQ2FsbGJhY2sgdG8gYmUgZXhlY3V0ZWQgd2hlbiBmYWlsZWQgbG9hZGluZy5cblx0XHQgKi9cblx0XHRmdW5jdGlvbiBsb2FkKHVybCwgbG9hZGVkQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHtcblx0XHRcdHZhciBsaW5rLCBzdHlsZSwgc3RhcnRUaW1lLCBzdGF0ZTtcblxuXHRcdFx0ZnVuY3Rpb24gcGFzc2VkKCkge1xuXHRcdFx0XHR2YXIgY2FsbGJhY2tzID0gc3RhdGUucGFzc2VkLCBpID0gY2FsbGJhY2tzLmxlbmd0aDtcblxuXHRcdFx0XHR3aGlsZSAoaS0tKSB7XG5cdFx0XHRcdFx0Y2FsbGJhY2tzW2ldKCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRzdGF0ZS5zdGF0dXMgPSAyO1xuXHRcdFx0XHRzdGF0ZS5wYXNzZWQgPSBbXTtcblx0XHRcdFx0c3RhdGUuZmFpbGVkID0gW107XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIGZhaWxlZCgpIHtcblx0XHRcdFx0dmFyIGNhbGxiYWNrcyA9IHN0YXRlLmZhaWxlZCwgaSA9IGNhbGxiYWNrcy5sZW5ndGg7XG5cblx0XHRcdFx0d2hpbGUgKGktLSkge1xuXHRcdFx0XHRcdGNhbGxiYWNrc1tpXSgpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0c3RhdGUuc3RhdHVzID0gMztcblx0XHRcdFx0c3RhdGUucGFzc2VkID0gW107XG5cdFx0XHRcdHN0YXRlLmZhaWxlZCA9IFtdO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBTbmlmZnMgZm9yIG9sZGVyIFdlYktpdCB2ZXJzaW9ucyB0aGF0IGhhdmUgdGhlIGxpbmsub25sb2FkIGJ1dCBhIGJyb2tlbiBvbmVcblx0XHRcdGZ1bmN0aW9uIGlzT2xkV2ViS2l0KCkge1xuXHRcdFx0XHR2YXIgd2ViS2l0Q2h1bmtzID0gbmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaCgvV2ViS2l0XFwvKFxcZCopLyk7XG5cdFx0XHRcdHJldHVybiAhISh3ZWJLaXRDaHVua3MgJiYgd2ViS2l0Q2h1bmtzWzFdIDwgNTM2KTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gQ2FsbHMgdGhlIHdhaXRDYWxsYmFjayB1bnRpbCB0aGUgdGVzdCByZXR1cm5zIHRydWUgb3IgdGhlIHRpbWVvdXQgb2NjdXJzXG5cdFx0XHRmdW5jdGlvbiB3YWl0KHRlc3RDYWxsYmFjaywgd2FpdENhbGxiYWNrKSB7XG5cdFx0XHRcdGlmICghdGVzdENhbGxiYWNrKCkpIHtcblx0XHRcdFx0XHQvLyBXYWl0IGZvciB0aW1lb3V0XG5cdFx0XHRcdFx0aWYgKChuZXcgRGF0ZSgpLmdldFRpbWUoKSkgLSBzdGFydFRpbWUgPCBtYXhMb2FkVGltZSkge1xuXHRcdFx0XHRcdFx0RGVsYXkuc2V0VGltZW91dCh3YWl0Q2FsbGJhY2spO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRmYWlsZWQoKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0Ly8gV29ya2Fyb3VuZCBmb3IgV2ViS2l0IHRoYXQgZG9lc24ndCBwcm9wZXJseSBzdXBwb3J0IHRoZSBvbmxvYWQgZXZlbnQgZm9yIGxpbmsgZWxlbWVudHNcblx0XHRcdC8vIE9yIFdlYktpdCB0aGF0IGZpcmVzIHRoZSBvbmxvYWQgZXZlbnQgYmVmb3JlIHRoZSBTdHlsZVNoZWV0IGlzIGFkZGVkIHRvIHRoZSBkb2N1bWVudFxuXHRcdFx0ZnVuY3Rpb24gd2FpdEZvcldlYktpdExpbmtMb2FkZWQoKSB7XG5cdFx0XHRcdHdhaXQoZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0dmFyIHN0eWxlU2hlZXRzID0gZG9jdW1lbnQuc3R5bGVTaGVldHMsIHN0eWxlU2hlZXQsIGkgPSBzdHlsZVNoZWV0cy5sZW5ndGgsIG93bmVyO1xuXG5cdFx0XHRcdFx0d2hpbGUgKGktLSkge1xuXHRcdFx0XHRcdFx0c3R5bGVTaGVldCA9IHN0eWxlU2hlZXRzW2ldO1xuXHRcdFx0XHRcdFx0b3duZXIgPSBzdHlsZVNoZWV0Lm93bmVyTm9kZSA/IHN0eWxlU2hlZXQub3duZXJOb2RlIDogc3R5bGVTaGVldC5vd25pbmdFbGVtZW50O1xuXHRcdFx0XHRcdFx0aWYgKG93bmVyICYmIG93bmVyLmlkID09PSBsaW5rLmlkKSB7XG5cdFx0XHRcdFx0XHRcdHBhc3NlZCgpO1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0sIHdhaXRGb3JXZWJLaXRMaW5rTG9hZGVkKTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gV29ya2Fyb3VuZCBmb3Igb2xkZXIgR2Vja29zIHRoYXQgZG9lc24ndCBoYXZlIGFueSBvbmxvYWQgZXZlbnQgZm9yIFN0eWxlU2hlZXRzXG5cdFx0XHRmdW5jdGlvbiB3YWl0Rm9yR2Vja29MaW5rTG9hZGVkKCkge1xuXHRcdFx0XHR3YWl0KGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdHRyeSB7XG5cdFx0XHRcdFx0XHQvLyBBY2Nlc3NpbmcgdGhlIGNzc1J1bGVzIHdpbGwgdGhyb3cgYW4gZXhjZXB0aW9uIHVudGlsIHRoZSBDU1MgZmlsZSBpcyBsb2FkZWRcblx0XHRcdFx0XHRcdHZhciBjc3NSdWxlcyA9IHN0eWxlLnNoZWV0LmNzc1J1bGVzO1xuXHRcdFx0XHRcdFx0cGFzc2VkKCk7XG5cdFx0XHRcdFx0XHRyZXR1cm4gISFjc3NSdWxlcztcblx0XHRcdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRcdFx0Ly8gSWdub3JlXG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9LCB3YWl0Rm9yR2Vja29MaW5rTG9hZGVkKTtcblx0XHRcdH1cblxuXHRcdFx0dXJsID0gVG9vbHMuX2FkZENhY2hlU3VmZml4KHVybCk7XG5cblx0XHRcdGlmICghbG9hZGVkU3RhdGVzW3VybF0pIHtcblx0XHRcdFx0c3RhdGUgPSB7XG5cdFx0XHRcdFx0cGFzc2VkOiBbXSxcblx0XHRcdFx0XHRmYWlsZWQ6IFtdXG5cdFx0XHRcdH07XG5cblx0XHRcdFx0bG9hZGVkU3RhdGVzW3VybF0gPSBzdGF0ZTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHN0YXRlID0gbG9hZGVkU3RhdGVzW3VybF07XG5cdFx0XHR9XG5cblx0XHRcdGlmIChsb2FkZWRDYWxsYmFjaykge1xuXHRcdFx0XHRzdGF0ZS5wYXNzZWQucHVzaChsb2FkZWRDYWxsYmFjayk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChlcnJvckNhbGxiYWNrKSB7XG5cdFx0XHRcdHN0YXRlLmZhaWxlZC5wdXNoKGVycm9yQ2FsbGJhY2spO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBJcyBsb2FkaW5nIHdhaXQgZm9yIGl0IHRvIHBhc3Ncblx0XHRcdGlmIChzdGF0ZS5zdGF0dXMgPT0gMSkge1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdC8vIEhhcyBmaW5pc2hlZCBsb2FkaW5nIGFuZCB3YXMgc3VjY2Vzc1xuXHRcdFx0aWYgKHN0YXRlLnN0YXR1cyA9PSAyKSB7XG5cdFx0XHRcdHBhc3NlZCgpO1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdC8vIEhhcyBmaW5pc2hlZCBsb2FkaW5nIGFuZCB3YXMgYSBmYWlsdXJlXG5cdFx0XHRpZiAoc3RhdGUuc3RhdHVzID09IDMpIHtcblx0XHRcdFx0ZmFpbGVkKCk7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0Ly8gU3RhcnQgbG9hZGluZ1xuXHRcdFx0c3RhdGUuc3RhdHVzID0gMTtcblx0XHRcdGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaW5rJyk7XG5cdFx0XHRsaW5rLnJlbCA9ICdzdHlsZXNoZWV0Jztcblx0XHRcdGxpbmsudHlwZSA9ICd0ZXh0L2Nzcyc7XG5cdFx0XHRsaW5rLmlkID0gJ3UnICsgKGlkQ291bnQrKyk7XG5cdFx0XHRsaW5rLmFzeW5jID0gZmFsc2U7XG5cdFx0XHRsaW5rLmRlZmVyID0gZmFsc2U7XG5cdFx0XHRzdGFydFRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcblxuXHRcdFx0Ly8gRmVhdHVyZSBkZXRlY3Qgb25sb2FkIG9uIGxpbmsgZWxlbWVudCBhbmQgc25pZmYgb2xkZXIgd2Via2l0cyBzaW5jZSBpdCBoYXMgYW4gYnJva2VuIG9ubG9hZCBldmVudFxuXHRcdFx0aWYgKFwib25sb2FkXCIgaW4gbGluayAmJiAhaXNPbGRXZWJLaXQoKSkge1xuXHRcdFx0XHRsaW5rLm9ubG9hZCA9IHdhaXRGb3JXZWJLaXRMaW5rTG9hZGVkO1xuXHRcdFx0XHRsaW5rLm9uZXJyb3IgPSBmYWlsZWQ7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQvLyBTbmlmZiBmb3Igb2xkIEZpcmVmb3ggdGhhdCBkb2Vzbid0IHN1cHBvcnQgdGhlIG9ubG9hZCBldmVudCBvbiBsaW5rIGVsZW1lbnRzXG5cdFx0XHRcdC8vIFRPRE86IFJlbW92ZSB0aGlzIGluIHRoZSBmdXR1cmUgd2hlbiBldmVyeW9uZSB1c2VzIG1vZGVybiBicm93c2Vyc1xuXHRcdFx0XHRpZiAobmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKFwiRmlyZWZveFwiKSA+IDApIHtcblx0XHRcdFx0XHRzdHlsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3N0eWxlJyk7XG5cdFx0XHRcdFx0c3R5bGUudGV4dENvbnRlbnQgPSAnQGltcG9ydCBcIicgKyB1cmwgKyAnXCInO1xuXHRcdFx0XHRcdHdhaXRGb3JHZWNrb0xpbmtMb2FkZWQoKTtcblx0XHRcdFx0XHRhcHBlbmRUb0hlYWQoc3R5bGUpO1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIFVzZSB0aGUgaWQgb3duZXIgb24gb2xkZXIgd2Via2l0c1xuXHRcdFx0XHR3YWl0Rm9yV2ViS2l0TGlua0xvYWRlZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRhcHBlbmRUb0hlYWQobGluayk7XG5cdFx0XHRsaW5rLmhyZWYgPSB1cmw7XG5cdFx0fVxuXG5cdFx0dGhpcy5sb2FkID0gbG9hZDtcblx0fTtcbn0pO1xuXG4vLyBJbmNsdWRlZCBmcm9tOiBqcy90aW55bWNlL2NsYXNzZXMvZG9tL0RPTVV0aWxzLmpzXG5cbi8qKlxuICogRE9NVXRpbHMuanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBVdGlsaXR5IGNsYXNzIGZvciB2YXJpb3VzIERPTSBtYW5pcHVsYXRpb24gYW5kIHJldHJpZXZhbCBmdW5jdGlvbnMuXG4gKlxuICogQGNsYXNzIHRpbnltY2UuZG9tLkRPTVV0aWxzXG4gKiBAZXhhbXBsZVxuICogLy8gQWRkIGEgY2xhc3MgdG8gYW4gZWxlbWVudCBieSBpZCBpbiB0aGUgcGFnZVxuICogdGlueW1jZS5ET00uYWRkQ2xhc3MoJ3NvbWVpZCcsICdzb21lY2xhc3MnKTtcbiAqXG4gKiAvLyBBZGQgYSBjbGFzcyB0byBhbiBlbGVtZW50IGJ5IGlkIGluc2lkZSB0aGUgZWRpdG9yXG4gKiB0aW55bWNlLmFjdGl2ZUVkaXRvci5kb20uYWRkQ2xhc3MoJ3NvbWVpZCcsICdzb21lY2xhc3MnKTtcbiAqL1xuZGVmaW5lKFwidGlueW1jZS9kb20vRE9NVXRpbHNcIiwgW1xuXHRcInRpbnltY2UvZG9tL1NpenpsZVwiLFxuXHRcInRpbnltY2UvZG9tL0RvbVF1ZXJ5XCIsXG5cdFwidGlueW1jZS9odG1sL1N0eWxlc1wiLFxuXHRcInRpbnltY2UvZG9tL0V2ZW50VXRpbHNcIixcblx0XCJ0aW55bWNlL2RvbS9UcmVlV2Fsa2VyXCIsXG5cdFwidGlueW1jZS9kb20vUmFuZ2VcIixcblx0XCJ0aW55bWNlL2h0bWwvRW50aXRpZXNcIixcblx0XCJ0aW55bWNlL0VudlwiLFxuXHRcInRpbnltY2UvdXRpbC9Ub29sc1wiLFxuXHRcInRpbnltY2UvZG9tL1N0eWxlU2hlZXRMb2FkZXJcIlxuXSwgZnVuY3Rpb24oU2l6emxlLCAkLCBTdHlsZXMsIEV2ZW50VXRpbHMsIFRyZWVXYWxrZXIsIFJhbmdlLCBFbnRpdGllcywgRW52LCBUb29scywgU3R5bGVTaGVldExvYWRlcikge1xuXHQvLyBTaG9ydGVuIG5hbWVzXG5cdHZhciBlYWNoID0gVG9vbHMuZWFjaCwgaXMgPSBUb29scy5pcywgZ3JlcCA9IFRvb2xzLmdyZXAsIHRyaW0gPSBUb29scy50cmltO1xuXHR2YXIgaXNJRSA9IEVudi5pZTtcblx0dmFyIHNpbXBsZVNlbGVjdG9yUmUgPSAvXihbYS16MC05XSw/KSskL2k7XG5cdHZhciB3aGl0ZVNwYWNlUmVnRXhwID0gL15bIFxcdFxcclxcbl0qJC87XG5cblx0ZnVuY3Rpb24gc2V0dXBBdHRySG9va3MoZG9tVXRpbHMsIHNldHRpbmdzKSB7XG5cdFx0dmFyIGF0dHJIb29rcyA9IHt9LCBrZWVwVmFsdWVzID0gc2V0dGluZ3Mua2VlcF92YWx1ZXMsIGtlZXBVcmxIb29rO1xuXG5cdFx0a2VlcFVybEhvb2sgPSB7XG5cdFx0XHRzZXQ6IGZ1bmN0aW9uKCRlbG0sIHZhbHVlLCBuYW1lKSB7XG5cdFx0XHRcdGlmIChzZXR0aW5ncy51cmxfY29udmVydGVyKSB7XG5cdFx0XHRcdFx0dmFsdWUgPSBzZXR0aW5ncy51cmxfY29udmVydGVyLmNhbGwoc2V0dGluZ3MudXJsX2NvbnZlcnRlcl9zY29wZSB8fCBkb21VdGlscywgdmFsdWUsIG5hbWUsICRlbG1bMF0pO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0JGVsbS5hdHRyKCdkYXRhLW1jZS0nICsgbmFtZSwgdmFsdWUpLmF0dHIobmFtZSwgdmFsdWUpO1xuXHRcdFx0fSxcblxuXHRcdFx0Z2V0OiBmdW5jdGlvbigkZWxtLCBuYW1lKSB7XG5cdFx0XHRcdHJldHVybiAkZWxtLmF0dHIoJ2RhdGEtbWNlLScgKyBuYW1lKSB8fCAkZWxtLmF0dHIobmFtZSk7XG5cdFx0XHR9XG5cdFx0fTtcblxuXHRcdGF0dHJIb29rcyA9IHtcblx0XHRcdHN0eWxlOiB7XG5cdFx0XHRcdHNldDogZnVuY3Rpb24oJGVsbSwgdmFsdWUpIHtcblx0XHRcdFx0XHRpZiAodmFsdWUgIT09IG51bGwgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0Jykge1xuXHRcdFx0XHRcdFx0JGVsbS5jc3ModmFsdWUpO1xuXHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmIChrZWVwVmFsdWVzKSB7XG5cdFx0XHRcdFx0XHQkZWxtLmF0dHIoJ2RhdGEtbWNlLXN0eWxlJywgdmFsdWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdCRlbG0uYXR0cignc3R5bGUnLCB2YWx1ZSk7XG5cdFx0XHRcdH0sXG5cblx0XHRcdFx0Z2V0OiBmdW5jdGlvbigkZWxtKSB7XG5cdFx0XHRcdFx0dmFyIHZhbHVlID0gJGVsbS5hdHRyKCdkYXRhLW1jZS1zdHlsZScpIHx8ICRlbG0uYXR0cignc3R5bGUnKTtcblxuXHRcdFx0XHRcdHZhbHVlID0gZG9tVXRpbHMuc2VyaWFsaXplU3R5bGUoZG9tVXRpbHMucGFyc2VTdHlsZSh2YWx1ZSksICRlbG1bMF0ubm9kZU5hbWUpO1xuXG5cdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fTtcblxuXHRcdGlmIChrZWVwVmFsdWVzKSB7XG5cdFx0XHRhdHRySG9va3MuaHJlZiA9IGF0dHJIb29rcy5zcmMgPSBrZWVwVXJsSG9vaztcblx0XHR9XG5cblx0XHRyZXR1cm4gYXR0ckhvb2tzO1xuXHR9XG5cblx0ZnVuY3Rpb24gdXBkYXRlSW50ZXJuYWxTdHlsZUF0dHIoZG9tVXRpbHMsICRlbG0pIHtcblx0XHR2YXIgdmFsdWUgPSAkZWxtLmF0dHIoJ3N0eWxlJyk7XG5cblx0XHR2YWx1ZSA9IGRvbVV0aWxzLnNlcmlhbGl6ZVN0eWxlKGRvbVV0aWxzLnBhcnNlU3R5bGUodmFsdWUpLCAkZWxtWzBdLm5vZGVOYW1lKTtcblxuXHRcdGlmICghdmFsdWUpIHtcblx0XHRcdHZhbHVlID0gbnVsbDtcblx0XHR9XG5cblx0XHQkZWxtLmF0dHIoJ2RhdGEtbWNlLXN0eWxlJywgdmFsdWUpO1xuXHR9XG5cblx0ZnVuY3Rpb24gbm9kZUluZGV4KG5vZGUsIG5vcm1hbGl6ZWQpIHtcblx0XHR2YXIgaWR4ID0gMCwgbGFzdE5vZGVUeXBlLCBub2RlVHlwZTtcblxuXHRcdGlmIChub2RlKSB7XG5cdFx0XHRmb3IgKGxhc3ROb2RlVHlwZSA9IG5vZGUubm9kZVR5cGUsIG5vZGUgPSBub2RlLnByZXZpb3VzU2libGluZzsgbm9kZTsgbm9kZSA9IG5vZGUucHJldmlvdXNTaWJsaW5nKSB7XG5cdFx0XHRcdG5vZGVUeXBlID0gbm9kZS5ub2RlVHlwZTtcblxuXHRcdFx0XHQvLyBOb3JtYWxpemUgdGV4dCBub2Rlc1xuXHRcdFx0XHRpZiAobm9ybWFsaXplZCAmJiBub2RlVHlwZSA9PSAzKSB7XG5cdFx0XHRcdFx0aWYgKG5vZGVUeXBlID09IGxhc3ROb2RlVHlwZSB8fCAhbm9kZS5ub2RlVmFsdWUubGVuZ3RoKSB7XG5cdFx0XHRcdFx0XHRjb250aW51ZTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdFx0aWR4Kys7XG5cdFx0XHRcdGxhc3ROb2RlVHlwZSA9IG5vZGVUeXBlO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiBpZHg7XG5cdH1cblxuXHQvKipcblx0ICogQ29uc3RydWN0cyBhIG5ldyBET01VdGlscyBpbnN0YW5jZS4gQ29uc3VsdCB0aGUgV2lraSBmb3IgbW9yZSBkZXRhaWxzIG9uIHNldHRpbmdzIGV0YyBmb3IgdGhpcyBjbGFzcy5cblx0ICpcblx0ICogQGNvbnN0cnVjdG9yXG5cdCAqIEBtZXRob2QgRE9NVXRpbHNcblx0ICogQHBhcmFtIHtEb2N1bWVudH0gZG9jIERvY3VtZW50IHJlZmVyZW5jZSB0byBiaW5kIHRoZSB1dGlsaXR5IGNsYXNzIHRvLlxuXHQgKiBAcGFyYW0ge3NldHRpbmdzfSBzZXR0aW5ncyBPcHRpb25hbCBzZXR0aW5ncyBjb2xsZWN0aW9uLlxuXHQgKi9cblx0ZnVuY3Rpb24gRE9NVXRpbHMoZG9jLCBzZXR0aW5ncykge1xuXHRcdHZhciBzZWxmID0gdGhpcywgYmxvY2tFbGVtZW50c01hcDtcblxuXHRcdHNlbGYuZG9jID0gZG9jO1xuXHRcdHNlbGYud2luID0gd2luZG93O1xuXHRcdHNlbGYuZmlsZXMgPSB7fTtcblx0XHRzZWxmLmNvdW50ZXIgPSAwO1xuXHRcdHNlbGYuc3RkTW9kZSA9ICFpc0lFIHx8IGRvYy5kb2N1bWVudE1vZGUgPj0gODtcblx0XHRzZWxmLmJveE1vZGVsID0gIWlzSUUgfHwgZG9jLmNvbXBhdE1vZGUgPT0gXCJDU1MxQ29tcGF0XCIgfHwgc2VsZi5zdGRNb2RlO1xuXHRcdHNlbGYuc3R5bGVTaGVldExvYWRlciA9IG5ldyBTdHlsZVNoZWV0TG9hZGVyKGRvYyk7XG5cdFx0c2VsZi5ib3VuZEV2ZW50cyA9IFtdO1xuXHRcdHNlbGYuc2V0dGluZ3MgPSBzZXR0aW5ncyA9IHNldHRpbmdzIHx8IHt9O1xuXHRcdHNlbGYuc2NoZW1hID0gc2V0dGluZ3Muc2NoZW1hO1xuXHRcdHNlbGYuc3R5bGVzID0gbmV3IFN0eWxlcyh7XG5cdFx0XHR1cmxfY29udmVydGVyOiBzZXR0aW5ncy51cmxfY29udmVydGVyLFxuXHRcdFx0dXJsX2NvbnZlcnRlcl9zY29wZTogc2V0dGluZ3MudXJsX2NvbnZlcnRlcl9zY29wZVxuXHRcdH0sIHNldHRpbmdzLnNjaGVtYSk7XG5cblx0XHRzZWxmLmZpeERvYyhkb2MpO1xuXHRcdHNlbGYuZXZlbnRzID0gc2V0dGluZ3Mub3duRXZlbnRzID8gbmV3IEV2ZW50VXRpbHMoc2V0dGluZ3MucHJveHkpIDogRXZlbnRVdGlscy5FdmVudDtcblx0XHRzZWxmLmF0dHJIb29rcyA9IHNldHVwQXR0ckhvb2tzKHNlbGYsIHNldHRpbmdzKTtcblx0XHRibG9ja0VsZW1lbnRzTWFwID0gc2V0dGluZ3Muc2NoZW1hID8gc2V0dGluZ3Muc2NoZW1hLmdldEJsb2NrRWxlbWVudHMoKSA6IHt9O1xuXHRcdHNlbGYuJCA9ICQub3ZlcnJpZGVEZWZhdWx0cyhmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiB7XG5cdFx0XHRcdGNvbnRleHQ6IGRvYyxcblx0XHRcdFx0ZWxlbWVudDogc2VsZi5nZXRSb290KClcblx0XHRcdH07XG5cdFx0fSk7XG5cblx0XHQvKipcblx0XHQgKiBSZXR1cm5zIHRydWUvZmFsc2UgaWYgdGhlIHNwZWNpZmllZCBlbGVtZW50IGlzIGEgYmxvY2sgZWxlbWVudCBvciBub3QuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGlzQmxvY2tcblx0XHQgKiBAcGFyYW0ge05vZGUvU3RyaW5nfSBub2RlIEVsZW1lbnQvTm9kZSB0byBjaGVjay5cblx0XHQgKiBAcmV0dXJuIHtCb29sZWFufSBUcnVlL0ZhbHNlIHN0YXRlIGlmIHRoZSBub2RlIGlzIGEgYmxvY2sgZWxlbWVudCBvciBub3QuXG5cdFx0ICovXG5cdFx0c2VsZi5pc0Jsb2NrID0gZnVuY3Rpb24obm9kZSkge1xuXHRcdFx0Ly8gRml4IGZvciAjNTQ0NlxuXHRcdFx0aWYgKCFub2RlKSB7XG5cdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gVGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgaW4gbW9kdWxlIHBhdHRlcm4gc3R5bGUgc2luY2UgaXQgbWlnaHQgYmUgZXhlY3V0ZWQgd2l0aCB0aGUgd3JvbmcgdGhpcyBzY29wZVxuXHRcdFx0dmFyIHR5cGUgPSBub2RlLm5vZGVUeXBlO1xuXG5cdFx0XHQvLyBJZiBpdCdzIGEgbm9kZSB0aGVuIGNoZWNrIHRoZSB0eXBlIGFuZCB1c2UgdGhlIG5vZGVOYW1lXG5cdFx0XHRpZiAodHlwZSkge1xuXHRcdFx0XHRyZXR1cm4gISEodHlwZSA9PT0gMSAmJiBibG9ja0VsZW1lbnRzTWFwW25vZGUubm9kZU5hbWVdKTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuICEhYmxvY2tFbGVtZW50c01hcFtub2RlXTtcblx0XHR9O1xuXHR9XG5cblx0RE9NVXRpbHMucHJvdG90eXBlID0ge1xuXHRcdCQkOiBmdW5jdGlvbihlbG0pIHtcblx0XHRcdGlmICh0eXBlb2YgZWxtID09ICdzdHJpbmcnKSB7XG5cdFx0XHRcdGVsbSA9IHRoaXMuZ2V0KGVsbSk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiB0aGlzLiQoZWxtKTtcblx0XHR9LFxuXG5cdFx0cm9vdDogbnVsbCxcblxuXHRcdGZpeERvYzogZnVuY3Rpb24oZG9jKSB7XG5cdFx0XHR2YXIgc2V0dGluZ3MgPSB0aGlzLnNldHRpbmdzLCBuYW1lO1xuXG5cdFx0XHRpZiAoaXNJRSAmJiBzZXR0aW5ncy5zY2hlbWEpIHtcblx0XHRcdFx0Ly8gQWRkIG1pc3NpbmcgSFRNTCA0LzUgZWxlbWVudHMgdG8gSUVcblx0XHRcdFx0KCdhYmJyIGFydGljbGUgYXNpZGUgYXVkaW8gY2FudmFzICcgK1xuXHRcdFx0XHQnZGV0YWlscyBmaWdjYXB0aW9uIGZpZ3VyZSBmb290ZXIgJyArXG5cdFx0XHRcdCdoZWFkZXIgaGdyb3VwIG1hcmsgbWVudSBtZXRlciBuYXYgJyArXG5cdFx0XHRcdCdvdXRwdXQgcHJvZ3Jlc3Mgc2VjdGlvbiBzdW1tYXJ5ICcgK1xuXHRcdFx0XHQndGltZSB2aWRlbycpLnJlcGxhY2UoL1xcdysvZywgZnVuY3Rpb24obmFtZSkge1xuXHRcdFx0XHRcdGRvYy5jcmVhdGVFbGVtZW50KG5hbWUpO1xuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHQvLyBDcmVhdGUgYWxsIGN1c3RvbSBlbGVtZW50c1xuXHRcdFx0XHRmb3IgKG5hbWUgaW4gc2V0dGluZ3Muc2NoZW1hLmdldEN1c3RvbUVsZW1lbnRzKCkpIHtcblx0XHRcdFx0XHRkb2MuY3JlYXRlRWxlbWVudChuYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHRjbG9uZTogZnVuY3Rpb24obm9kZSwgZGVlcCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLCBjbG9uZSwgZG9jO1xuXG5cdFx0XHQvLyBUT0RPOiBBZGQgZmVhdHVyZSBkZXRlY3Rpb24gaGVyZSBpbiB0aGUgZnV0dXJlXG5cdFx0XHRpZiAoIWlzSUUgfHwgbm9kZS5ub2RlVHlwZSAhPT0gMSB8fCBkZWVwKSB7XG5cdFx0XHRcdHJldHVybiBub2RlLmNsb25lTm9kZShkZWVwKTtcblx0XHRcdH1cblxuXHRcdFx0ZG9jID0gc2VsZi5kb2M7XG5cblx0XHRcdC8vIE1ha2UgYSBIVE1MNSBzYWZlIHNoYWxsb3cgY29weVxuXHRcdFx0aWYgKCFkZWVwKSB7XG5cdFx0XHRcdGNsb25lID0gZG9jLmNyZWF0ZUVsZW1lbnQobm9kZS5ub2RlTmFtZSk7XG5cblx0XHRcdFx0Ly8gQ29weSBhdHRyaWJzXG5cdFx0XHRcdGVhY2goc2VsZi5nZXRBdHRyaWJzKG5vZGUpLCBmdW5jdGlvbihhdHRyKSB7XG5cdFx0XHRcdFx0c2VsZi5zZXRBdHRyaWIoY2xvbmUsIGF0dHIubm9kZU5hbWUsIHNlbGYuZ2V0QXR0cmliKG5vZGUsIGF0dHIubm9kZU5hbWUpKTtcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0cmV0dXJuIGNsb25lO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gY2xvbmUuZmlyc3RDaGlsZDtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyB0aGUgcm9vdCBub2RlIG9mIHRoZSBkb2N1bWVudC4gVGhpcyBpcyBub3JtYWxseSB0aGUgYm9keSBidXQgbWlnaHQgYmUgYSBESVYuIFBhcmVudHMgbGlrZSBnZXRQYXJlbnQgd2lsbCBub3Rcblx0XHQgKiBnbyBhYm92ZSB0aGUgcG9pbnQgb2YgdGhpcyByb290IG5vZGUuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGdldFJvb3Rcblx0XHQgKiBAcmV0dXJuIHtFbGVtZW50fSBSb290IGVsZW1lbnQgZm9yIHRoZSB1dGlsaXR5IGNsYXNzLlxuXHRcdCAqL1xuXHRcdGdldFJvb3Q6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHRyZXR1cm4gc2VsZi5zZXR0aW5ncy5yb290X2VsZW1lbnQgfHwgc2VsZi5kb2MuYm9keTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyB0aGUgdmlld3BvcnQgb2YgdGhlIHdpbmRvdy5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgZ2V0Vmlld1BvcnRcblx0XHQgKiBAcGFyYW0ge1dpbmRvd30gd2luIE9wdGlvbmFsIHdpbmRvdyB0byBnZXQgdmlld3BvcnQgb2YuXG5cdFx0ICogQHJldHVybiB7T2JqZWN0fSBWaWV3cG9ydCBvYmplY3Qgd2l0aCBmaWVsZHMgeCwgeSwgdyBhbmQgaC5cblx0XHQgKi9cblx0XHRnZXRWaWV3UG9ydDogZnVuY3Rpb24od2luKSB7XG5cdFx0XHR2YXIgZG9jLCByb290RWxtO1xuXG5cdFx0XHR3aW4gPSAhd2luID8gdGhpcy53aW4gOiB3aW47XG5cdFx0XHRkb2MgPSB3aW4uZG9jdW1lbnQ7XG5cdFx0XHRyb290RWxtID0gdGhpcy5ib3hNb2RlbCA/IGRvYy5kb2N1bWVudEVsZW1lbnQgOiBkb2MuYm9keTtcblxuXHRcdFx0Ly8gUmV0dXJucyB2aWV3cG9ydCBzaXplIGV4Y2x1ZGluZyBzY3JvbGxiYXJzXG5cdFx0XHRyZXR1cm4ge1xuXHRcdFx0XHR4OiB3aW4ucGFnZVhPZmZzZXQgfHwgcm9vdEVsbS5zY3JvbGxMZWZ0LFxuXHRcdFx0XHR5OiB3aW4ucGFnZVlPZmZzZXQgfHwgcm9vdEVsbS5zY3JvbGxUb3AsXG5cdFx0XHRcdHc6IHdpbi5pbm5lcldpZHRoIHx8IHJvb3RFbG0uY2xpZW50V2lkdGgsXG5cdFx0XHRcdGg6IHdpbi5pbm5lckhlaWdodCB8fCByb290RWxtLmNsaWVudEhlaWdodFxuXHRcdFx0fTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyB0aGUgcmVjdGFuZ2xlIGZvciBhIHNwZWNpZmljIGVsZW1lbnQuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGdldFJlY3Rcblx0XHQgKiBAcGFyYW0ge0VsZW1lbnQvU3RyaW5nfSBlbG0gRWxlbWVudCBvYmplY3Qgb3IgZWxlbWVudCBJRCB0byBnZXQgcmVjdGFuZ2xlIGZyb20uXG5cdFx0ICogQHJldHVybiB7b2JqZWN0fSBSZWN0YW5nbGUgZm9yIHNwZWNpZmllZCBlbGVtZW50IG9iamVjdCB3aXRoIHgsIHksIHcsIGggZmllbGRzLlxuXHRcdCAqL1xuXHRcdGdldFJlY3Q6IGZ1bmN0aW9uKGVsbSkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLCBwb3MsIHNpemU7XG5cblx0XHRcdGVsbSA9IHNlbGYuZ2V0KGVsbSk7XG5cdFx0XHRwb3MgPSBzZWxmLmdldFBvcyhlbG0pO1xuXHRcdFx0c2l6ZSA9IHNlbGYuZ2V0U2l6ZShlbG0pO1xuXG5cdFx0XHRyZXR1cm4ge1xuXHRcdFx0XHR4OiBwb3MueCwgeTogcG9zLnksXG5cdFx0XHRcdHc6IHNpemUudywgaDogc2l6ZS5oXG5cdFx0XHR9O1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZXR1cm5zIHRoZSBzaXplIGRpbWVuc2lvbnMgb2YgdGhlIHNwZWNpZmllZCBlbGVtZW50LlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBnZXRTaXplXG5cdFx0ICogQHBhcmFtIHtFbGVtZW50L1N0cmluZ30gZWxtIEVsZW1lbnQgb2JqZWN0IG9yIGVsZW1lbnQgSUQgdG8gZ2V0IHJlY3RhbmdsZSBmcm9tLlxuXHRcdCAqIEByZXR1cm4ge29iamVjdH0gUmVjdGFuZ2xlIGZvciBzcGVjaWZpZWQgZWxlbWVudCBvYmplY3Qgd2l0aCB3LCBoIGZpZWxkcy5cblx0XHQgKi9cblx0XHRnZXRTaXplOiBmdW5jdGlvbihlbG0pIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgdywgaDtcblxuXHRcdFx0ZWxtID0gc2VsZi5nZXQoZWxtKTtcblx0XHRcdHcgPSBzZWxmLmdldFN0eWxlKGVsbSwgJ3dpZHRoJyk7XG5cdFx0XHRoID0gc2VsZi5nZXRTdHlsZShlbG0sICdoZWlnaHQnKTtcblxuXHRcdFx0Ly8gTm9uIHBpeGVsIHZhbHVlLCB0aGVuIGZvcmNlIG9mZnNldC9jbGllbnRXaWR0aFxuXHRcdFx0aWYgKHcuaW5kZXhPZigncHgnKSA9PT0gLTEpIHtcblx0XHRcdFx0dyA9IDA7XG5cdFx0XHR9XG5cblx0XHRcdC8vIE5vbiBwaXhlbCB2YWx1ZSwgdGhlbiBmb3JjZSBvZmZzZXQvY2xpZW50V2lkdGhcblx0XHRcdGlmIChoLmluZGV4T2YoJ3B4JykgPT09IC0xKSB7XG5cdFx0XHRcdGggPSAwO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4ge1xuXHRcdFx0XHR3OiBwYXJzZUludCh3LCAxMCkgfHwgZWxtLm9mZnNldFdpZHRoIHx8IGVsbS5jbGllbnRXaWR0aCxcblx0XHRcdFx0aDogcGFyc2VJbnQoaCwgMTApIHx8IGVsbS5vZmZzZXRIZWlnaHQgfHwgZWxtLmNsaWVudEhlaWdodFxuXHRcdFx0fTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyBhIG5vZGUgYnkgdGhlIHNwZWNpZmllZCBzZWxlY3RvciBmdW5jdGlvbi4gVGhpcyBmdW5jdGlvbiB3aWxsXG5cdFx0ICogbG9vcCB0aHJvdWdoIGFsbCBwYXJlbnQgbm9kZXMgYW5kIGNhbGwgdGhlIHNwZWNpZmllZCBmdW5jdGlvbiBmb3IgZWFjaCBub2RlLlxuXHRcdCAqIElmIHRoZSBmdW5jdGlvbiB0aGVuIHJldHVybnMgdHJ1ZSBpbmRpY2F0aW5nIHRoYXQgaXQgaGFzIGZvdW5kIHdoYXQgaXQgd2FzIGxvb2tpbmcgZm9yLCB0aGUgbG9vcCBleGVjdXRpb24gd2lsbCB0aGVuIGVuZFxuXHRcdCAqIGFuZCB0aGUgbm9kZSBpdCBmb3VuZCB3aWxsIGJlIHJldHVybmVkLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBnZXRQYXJlbnRcblx0XHQgKiBAcGFyYW0ge05vZGUvU3RyaW5nfSBub2RlIERPTSBub2RlIHRvIHNlYXJjaCBwYXJlbnRzIG9uIG9yIElEIHN0cmluZy5cblx0XHQgKiBAcGFyYW0ge2Z1bmN0aW9ufSBzZWxlY3RvciBTZWxlY3Rpb24gZnVuY3Rpb24gb3IgQ1NTIHNlbGVjdG9yIHRvIGV4ZWN1dGUgb24gZWFjaCBub2RlLlxuXHRcdCAqIEBwYXJhbSB7Tm9kZX0gcm9vdCBPcHRpb25hbCByb290IGVsZW1lbnQsIG5ldmVyIGdvIGJlbG93IHRoaXMgcG9pbnQuXG5cdFx0ICogQHJldHVybiB7Tm9kZX0gRE9NIE5vZGUgb3IgbnVsbCBpZiBpdCB3YXNuJ3QgZm91bmQuXG5cdFx0ICovXG5cdFx0Z2V0UGFyZW50OiBmdW5jdGlvbihub2RlLCBzZWxlY3Rvciwgcm9vdCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuZ2V0UGFyZW50cyhub2RlLCBzZWxlY3Rvciwgcm9vdCwgZmFsc2UpO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZXR1cm5zIGEgbm9kZSBsaXN0IG9mIGFsbCBwYXJlbnRzIG1hdGNoaW5nIHRoZSBzcGVjaWZpZWQgc2VsZWN0b3IgZnVuY3Rpb24gb3IgcGF0dGVybi5cblx0XHQgKiBJZiB0aGUgZnVuY3Rpb24gdGhlbiByZXR1cm5zIHRydWUgaW5kaWNhdGluZyB0aGF0IGl0IGhhcyBmb3VuZCB3aGF0IGl0IHdhcyBsb29raW5nIGZvciBhbmQgdGhhdCBub2RlIHdpbGwgYmUgY29sbGVjdGVkLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBnZXRQYXJlbnRzXG5cdFx0ICogQHBhcmFtIHtOb2RlL1N0cmluZ30gbm9kZSBET00gbm9kZSB0byBzZWFyY2ggcGFyZW50cyBvbiBvciBJRCBzdHJpbmcuXG5cdFx0ICogQHBhcmFtIHtmdW5jdGlvbn0gc2VsZWN0b3IgU2VsZWN0aW9uIGZ1bmN0aW9uIHRvIGV4ZWN1dGUgb24gZWFjaCBub2RlIG9yIENTUyBwYXR0ZXJuLlxuXHRcdCAqIEBwYXJhbSB7Tm9kZX0gcm9vdCBPcHRpb25hbCByb290IGVsZW1lbnQsIG5ldmVyIGdvIGJlbG93IHRoaXMgcG9pbnQuXG5cdFx0ICogQHJldHVybiB7QXJyYXl9IEFycmF5IG9mIG5vZGVzIG9yIG51bGwgaWYgaXQgd2Fzbid0IGZvdW5kLlxuXHRcdCAqL1xuXHRcdGdldFBhcmVudHM6IGZ1bmN0aW9uKG5vZGUsIHNlbGVjdG9yLCByb290LCBjb2xsZWN0KSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIHNlbGVjdG9yVmFsLCByZXN1bHQgPSBbXTtcblxuXHRcdFx0bm9kZSA9IHNlbGYuZ2V0KG5vZGUpO1xuXHRcdFx0Y29sbGVjdCA9IGNvbGxlY3QgPT09IHVuZGVmaW5lZDtcblxuXHRcdFx0Ly8gRGVmYXVsdCByb290IG9uIGlubGluZSBtb2RlXG5cdFx0XHRyb290ID0gcm9vdCB8fCAoc2VsZi5nZXRSb290KCkubm9kZU5hbWUgIT0gJ0JPRFknID8gc2VsZi5nZXRSb290KCkucGFyZW50Tm9kZSA6IG51bGwpO1xuXG5cdFx0XHQvLyBXcmFwIG5vZGUgbmFtZSBhcyBmdW5jXG5cdFx0XHRpZiAoaXMoc2VsZWN0b3IsICdzdHJpbmcnKSkge1xuXHRcdFx0XHRzZWxlY3RvclZhbCA9IHNlbGVjdG9yO1xuXG5cdFx0XHRcdGlmIChzZWxlY3RvciA9PT0gJyonKSB7XG5cdFx0XHRcdFx0c2VsZWN0b3IgPSBmdW5jdGlvbihub2RlKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gbm9kZS5ub2RlVHlwZSA9PSAxO1xuXHRcdFx0XHRcdH07XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0c2VsZWN0b3IgPSBmdW5jdGlvbihub2RlKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gc2VsZi5pcyhub2RlLCBzZWxlY3RvclZhbCk7XG5cdFx0XHRcdFx0fTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHR3aGlsZSAobm9kZSkge1xuXHRcdFx0XHRpZiAobm9kZSA9PSByb290IHx8ICFub2RlLm5vZGVUeXBlIHx8IG5vZGUubm9kZVR5cGUgPT09IDkpIHtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICghc2VsZWN0b3IgfHwgc2VsZWN0b3Iobm9kZSkpIHtcblx0XHRcdFx0XHRpZiAoY29sbGVjdCkge1xuXHRcdFx0XHRcdFx0cmVzdWx0LnB1c2gobm9kZSk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdHJldHVybiBub2RlO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdG5vZGUgPSBub2RlLnBhcmVudE5vZGU7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBjb2xsZWN0ID8gcmVzdWx0IDogbnVsbDtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyB0aGUgc3BlY2lmaWVkIGVsZW1lbnQgYnkgSUQgb3IgdGhlIGlucHV0IGVsZW1lbnQgaWYgaXQgaXNuJ3QgYSBzdHJpbmcuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGdldFxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nL0VsZW1lbnR9IG4gRWxlbWVudCBpZCB0byBsb29rIGZvciBvciBlbGVtZW50IHRvIGp1c3QgcGFzcyB0aG91Z2guXG5cdFx0ICogQHJldHVybiB7RWxlbWVudH0gRWxlbWVudCBtYXRjaGluZyB0aGUgc3BlY2lmaWVkIGlkIG9yIG51bGwgaWYgaXQgd2Fzbid0IGZvdW5kLlxuXHRcdCAqL1xuXHRcdGdldDogZnVuY3Rpb24oZWxtKSB7XG5cdFx0XHR2YXIgbmFtZTtcblxuXHRcdFx0aWYgKGVsbSAmJiB0aGlzLmRvYyAmJiB0eXBlb2YgZWxtID09ICdzdHJpbmcnKSB7XG5cdFx0XHRcdG5hbWUgPSBlbG07XG5cdFx0XHRcdGVsbSA9IHRoaXMuZG9jLmdldEVsZW1lbnRCeUlkKGVsbSk7XG5cblx0XHRcdFx0Ly8gSUUgYW5kIE9wZXJhIHJldHVybnMgbWV0YSBlbGVtZW50cyB3aGVuIHRoZXkgbWF0Y2ggdGhlIHNwZWNpZmllZCBpbnB1dCBJRCwgYnV0IGdldEVsZW1lbnRzQnlOYW1lIHNlZW1zIHRvIGRvIHRoZSB0cmlja1xuXHRcdFx0XHRpZiAoZWxtICYmIGVsbS5pZCAhPT0gbmFtZSkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLmRvYy5nZXRFbGVtZW50c0J5TmFtZShuYW1lKVsxXTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gZWxtO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZXR1cm5zIHRoZSBuZXh0IG5vZGUgdGhhdCBtYXRjaGVzIHNlbGVjdG9yIG9yIGZ1bmN0aW9uXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGdldE5leHRcblx0XHQgKiBAcGFyYW0ge05vZGV9IG5vZGUgTm9kZSB0byBmaW5kIHNpYmxpbmdzIGZyb20uXG5cdFx0ICogQHBhcmFtIHtTdHJpbmcvZnVuY3Rpb259IHNlbGVjdG9yIFNlbGVjdG9yIENTUyBleHByZXNzaW9uIG9yIGZ1bmN0aW9uLlxuXHRcdCAqIEByZXR1cm4ge05vZGV9IE5leHQgbm9kZSBpdGVtIG1hdGNoaW5nIHRoZSBzZWxlY3RvciBvciBudWxsIGlmIGl0IHdhc24ndCBmb3VuZC5cblx0XHQgKi9cblx0XHRnZXROZXh0OiBmdW5jdGlvbihub2RlLCBzZWxlY3Rvcikge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2ZpbmRTaWIobm9kZSwgc2VsZWN0b3IsICduZXh0U2libGluZycpO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZXR1cm5zIHRoZSBwcmV2aW91cyBub2RlIHRoYXQgbWF0Y2hlcyBzZWxlY3RvciBvciBmdW5jdGlvblxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBnZXRQcmV2XG5cdFx0ICogQHBhcmFtIHtOb2RlfSBub2RlIE5vZGUgdG8gZmluZCBzaWJsaW5ncyBmcm9tLlxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nL2Z1bmN0aW9ufSBzZWxlY3RvciBTZWxlY3RvciBDU1MgZXhwcmVzc2lvbiBvciBmdW5jdGlvbi5cblx0XHQgKiBAcmV0dXJuIHtOb2RlfSBQcmV2aW91cyBub2RlIGl0ZW0gbWF0Y2hpbmcgdGhlIHNlbGVjdG9yIG9yIG51bGwgaWYgaXQgd2Fzbid0IGZvdW5kLlxuXHRcdCAqL1xuXHRcdGdldFByZXY6IGZ1bmN0aW9uKG5vZGUsIHNlbGVjdG9yKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZmluZFNpYihub2RlLCBzZWxlY3RvciwgJ3ByZXZpb3VzU2libGluZycpO1xuXHRcdH0sXG5cblx0XHQvLyAjaWZuZGVmIGpxdWVyeVxuXG5cdFx0LyoqXG5cdFx0ICogU2VsZWN0cyBzcGVjaWZpYyBlbGVtZW50cyBieSBhIENTUyBsZXZlbCAzIHBhdHRlcm4uIEZvciBleGFtcGxlIFwiZGl2I2ExIHAudGVzdFwiLlxuXHRcdCAqIFRoaXMgZnVuY3Rpb24gaXMgb3B0aW1pemVkIGZvciB0aGUgbW9zdCBjb21tb24gcGF0dGVybnMgbmVlZGVkIGluIFRpbnlNQ0UgYnV0IGl0IGFsc28gcGVyZm9ybXMgd2VsbCBlbm91Z2hcblx0XHQgKiBvbiBtb3JlIGNvbXBsZXggcGF0dGVybnMuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHNlbGVjdFxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBzZWxlY3RvciBDU1MgbGV2ZWwgMyBwYXR0ZXJuIHRvIHNlbGVjdC9maW5kIGVsZW1lbnRzIGJ5LlxuXHRcdCAqIEBwYXJhbSB7T2JqZWN0fSBzY29wZSBPcHRpb25hbCByb290IGVsZW1lbnQvc2NvcGUgZWxlbWVudCB0byBzZWFyY2ggaW4uXG5cdFx0ICogQHJldHVybiB7QXJyYXl9IEFycmF5IHdpdGggYWxsIG1hdGNoZWQgZWxlbWVudHMuXG5cdFx0ICogQGV4YW1wbGVcblx0XHQgKiAvLyBBZGRzIGEgY2xhc3MgdG8gYWxsIHBhcmFncmFwaHMgaW4gdGhlIGN1cnJlbnRseSBhY3RpdmUgZWRpdG9yXG5cdFx0ICogdGlueW1jZS5hY3RpdmVFZGl0b3IuZG9tLmFkZENsYXNzKHRpbnltY2UuYWN0aXZlRWRpdG9yLmRvbS5zZWxlY3QoJ3AnKSwgJ3NvbWVjbGFzcycpO1xuXHRcdCAqXG5cdFx0ICogLy8gQWRkcyBhIGNsYXNzIHRvIGFsbCBzcGFucyB0aGF0IGhhdmUgdGhlIHRlc3QgY2xhc3MgaW4gdGhlIGN1cnJlbnRseSBhY3RpdmUgZWRpdG9yXG5cdFx0ICogdGlueW1jZS5hY3RpdmVFZGl0b3IuZG9tLmFkZENsYXNzKHRpbnltY2UuYWN0aXZlRWRpdG9yLmRvbS5zZWxlY3QoJ3NwYW4udGVzdCcpLCAnc29tZWNsYXNzJylcblx0XHQgKi9cblx0XHRzZWxlY3Q6IGZ1bmN0aW9uKHNlbGVjdG9yLCBzY29wZSkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHQvKmVzbGludCBuZXctY2FwOjAgKi9cblx0XHRcdHJldHVybiBTaXp6bGUoc2VsZWN0b3IsIHNlbGYuZ2V0KHNjb3BlKSB8fCBzZWxmLnNldHRpbmdzLnJvb3RfZWxlbWVudCB8fCBzZWxmLmRvYywgW10pO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZXR1cm5zIHRydWUvZmFsc2UgaWYgdGhlIHNwZWNpZmllZCBlbGVtZW50IG1hdGNoZXMgdGhlIHNwZWNpZmllZCBjc3MgcGF0dGVybi5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgaXNcblx0XHQgKiBAcGFyYW0ge05vZGUvTm9kZUxpc3R9IGVsbSBET00gbm9kZSB0byBtYXRjaCBvciBhbiBhcnJheSBvZiBub2RlcyB0byBtYXRjaC5cblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gc2VsZWN0b3IgQ1NTIHBhdHRlcm4gdG8gbWF0Y2ggdGhlIGVsZW1lbnQgYWdhaW5zdC5cblx0XHQgKi9cblx0XHRpczogZnVuY3Rpb24oZWxtLCBzZWxlY3Rvcikge1xuXHRcdFx0dmFyIGk7XG5cblx0XHRcdC8vIElmIGl0IGlzbid0IGFuIGFycmF5IHRoZW4gdHJ5IHRvIGRvIHNvbWUgc2ltcGxlIHNlbGVjdG9ycyBpbnN0ZWFkIG9mIFNpenpsZSBmb3IgdG8gYm9vc3QgcGVyZm9ybWFuY2Vcblx0XHRcdGlmIChlbG0ubGVuZ3RoID09PSB1bmRlZmluZWQpIHtcblx0XHRcdFx0Ly8gU2ltcGxlIGFsbCBzZWxlY3RvclxuXHRcdFx0XHRpZiAoc2VsZWN0b3IgPT09ICcqJykge1xuXHRcdFx0XHRcdHJldHVybiBlbG0ubm9kZVR5cGUgPT0gMTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIFNpbXBsZSBzZWxlY3RvciBqdXN0IGVsZW1lbnRzXG5cdFx0XHRcdGlmIChzaW1wbGVTZWxlY3RvclJlLnRlc3Qoc2VsZWN0b3IpKSB7XG5cdFx0XHRcdFx0c2VsZWN0b3IgPSBzZWxlY3Rvci50b0xvd2VyQ2FzZSgpLnNwbGl0KC8sLyk7XG5cdFx0XHRcdFx0ZWxtID0gZWxtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7XG5cblx0XHRcdFx0XHRmb3IgKGkgPSBzZWxlY3Rvci5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuXHRcdFx0XHRcdFx0aWYgKHNlbGVjdG9yW2ldID09IGVsbSkge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0Ly8gSXMgbm9uIGVsZW1lbnRcblx0XHRcdGlmIChlbG0ubm9kZVR5cGUgJiYgZWxtLm5vZGVUeXBlICE9IDEpIHtcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0fVxuXG5cdFx0XHR2YXIgZWxtcyA9IGVsbS5ub2RlVHlwZSA/IFtlbG1dIDogZWxtO1xuXG5cdFx0XHQvKmVzbGludCBuZXctY2FwOjAgKi9cblx0XHRcdHJldHVybiBTaXp6bGUoc2VsZWN0b3IsIGVsbXNbMF0ub3duZXJEb2N1bWVudCB8fCBlbG1zWzBdLCBudWxsLCBlbG1zKS5sZW5ndGggPiAwO1xuXHRcdH0sXG5cblx0XHQvLyAjZW5kaWZcblxuXHRcdC8qKlxuXHRcdCAqIEFkZHMgdGhlIHNwZWNpZmllZCBlbGVtZW50IHRvIGFub3RoZXIgZWxlbWVudCBvciBlbGVtZW50cy5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgYWRkXG5cdFx0ICogQHBhcmFtIHtTdHJpbmcvRWxlbWVudC9BcnJheX0gcGFyZW50RWxtIEVsZW1lbnQgaWQgc3RyaW5nLCBET00gbm9kZSBlbGVtZW50IG9yIGFycmF5IG9mIGlkcyBvciBlbGVtZW50cyB0byBhZGQgdG8uXG5cdFx0ICogQHBhcmFtIHtTdHJpbmcvRWxlbWVudH0gbmFtZSBOYW1lIG9mIG5ldyBlbGVtZW50IHRvIGFkZCBvciBleGlzdGluZyBlbGVtZW50IHRvIGFkZC5cblx0XHQgKiBAcGFyYW0ge09iamVjdH0gYXR0cnMgT3B0aW9uYWwgb2JqZWN0IGNvbGxlY3Rpb24gd2l0aCBhcmd1bWVudHMgdG8gYWRkIHRvIHRoZSBuZXcgZWxlbWVudChzKS5cblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gaHRtbCBPcHRpb25hbCBpbm5lciBIVE1MIGNvbnRlbnRzIHRvIGFkZCBmb3IgZWFjaCBlbGVtZW50LlxuXHRcdCAqIEBwYXJhbSB7Qm9vbGVhbn0gY3JlYXRlIE9wdGlvbmFsIGZsYWcgaWYgdGhlIGVsZW1lbnQgc2hvdWxkIGJlIGNyZWF0ZWQgb3IgYWRkZWQuXG5cdFx0ICogQHJldHVybiB7RWxlbWVudC9BcnJheX0gRWxlbWVudCB0aGF0IGdvdCBjcmVhdGVkLCBvciBhbiBhcnJheSBvZiBjcmVhdGVkIGVsZW1lbnRzIGlmIG11bHRpcGxlIGlucHV0IGVsZW1lbnRzXG5cdFx0ICogd2VyZSBwYXNzZWQgaW4uXG5cdFx0ICogQGV4YW1wbGVcblx0XHQgKiAvLyBBZGRzIGEgbmV3IHBhcmFncmFwaCB0byB0aGUgZW5kIG9mIHRoZSBhY3RpdmUgZWRpdG9yXG5cdFx0ICogdGlueW1jZS5hY3RpdmVFZGl0b3IuZG9tLmFkZCh0aW55bWNlLmFjdGl2ZUVkaXRvci5nZXRCb2R5KCksICdwJywge3RpdGxlOiAnbXkgdGl0bGUnfSwgJ1NvbWUgY29udGVudCcpO1xuXHRcdCAqL1xuXHRcdGFkZDogZnVuY3Rpb24ocGFyZW50RWxtLCBuYW1lLCBhdHRycywgaHRtbCwgY3JlYXRlKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdHJldHVybiB0aGlzLnJ1bihwYXJlbnRFbG0sIGZ1bmN0aW9uKHBhcmVudEVsbSkge1xuXHRcdFx0XHR2YXIgbmV3RWxtO1xuXG5cdFx0XHRcdG5ld0VsbSA9IGlzKG5hbWUsICdzdHJpbmcnKSA/IHNlbGYuZG9jLmNyZWF0ZUVsZW1lbnQobmFtZSkgOiBuYW1lO1xuXHRcdFx0XHRzZWxmLnNldEF0dHJpYnMobmV3RWxtLCBhdHRycyk7XG5cblx0XHRcdFx0aWYgKGh0bWwpIHtcblx0XHRcdFx0XHRpZiAoaHRtbC5ub2RlVHlwZSkge1xuXHRcdFx0XHRcdFx0bmV3RWxtLmFwcGVuZENoaWxkKGh0bWwpO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRzZWxmLnNldEhUTUwobmV3RWxtLCBodG1sKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gIWNyZWF0ZSA/IHBhcmVudEVsbS5hcHBlbmRDaGlsZChuZXdFbG0pIDogbmV3RWxtO1xuXHRcdFx0fSk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIENyZWF0ZXMgYSBuZXcgZWxlbWVudC5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgY3JlYXRlXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IG5hbWUgTmFtZSBvZiBuZXcgZWxlbWVudC5cblx0XHQgKiBAcGFyYW0ge09iamVjdH0gYXR0cnMgT3B0aW9uYWwgb2JqZWN0IG5hbWUvdmFsdWUgY29sbGVjdGlvbiB3aXRoIGVsZW1lbnQgYXR0cmlidXRlcy5cblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gaHRtbCBPcHRpb25hbCBIVE1MIHN0cmluZyB0byBzZXQgYXMgaW5uZXIgSFRNTCBvZiB0aGUgZWxlbWVudC5cblx0XHQgKiBAcmV0dXJuIHtFbGVtZW50fSBIVE1MIERPTSBub2RlIGVsZW1lbnQgdGhhdCBnb3QgY3JlYXRlZC5cblx0XHQgKiBAZXhhbXBsZVxuXHRcdCAqIC8vIEFkZHMgYW4gZWxlbWVudCB3aGVyZSB0aGUgY2FyZXQvc2VsZWN0aW9uIGlzIGluIHRoZSBhY3RpdmUgZWRpdG9yXG5cdFx0ICogdmFyIGVsID0gdGlueW1jZS5hY3RpdmVFZGl0b3IuZG9tLmNyZWF0ZSgnZGl2Jywge2lkOiAndGVzdCcsICdjbGFzcyc6ICdteWNsYXNzJ30sICdzb21lIGNvbnRlbnQnKTtcblx0XHQgKiB0aW55bWNlLmFjdGl2ZUVkaXRvci5zZWxlY3Rpb24uc2V0Tm9kZShlbCk7XG5cdFx0ICovXG5cdFx0Y3JlYXRlOiBmdW5jdGlvbihuYW1lLCBhdHRycywgaHRtbCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuYWRkKHRoaXMuZG9jLmNyZWF0ZUVsZW1lbnQobmFtZSksIG5hbWUsIGF0dHJzLCBodG1sLCAxKTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogQ3JlYXRlcyBIVE1MIHN0cmluZyBmb3IgZWxlbWVudC4gVGhlIGVsZW1lbnQgd2lsbCBiZSBjbG9zZWQgdW5sZXNzIGFuIGVtcHR5IGlubmVyIEhUTUwgc3RyaW5nIGlzIHBhc3NlZCBpbi5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgY3JlYXRlSFRNTFxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIE5hbWUgb2YgbmV3IGVsZW1lbnQuXG5cdFx0ICogQHBhcmFtIHtPYmplY3R9IGF0dHJzIE9wdGlvbmFsIG9iamVjdCBuYW1lL3ZhbHVlIGNvbGxlY3Rpb24gd2l0aCBlbGVtZW50IGF0dHJpYnV0ZXMuXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IGh0bWwgT3B0aW9uYWwgSFRNTCBzdHJpbmcgdG8gc2V0IGFzIGlubmVyIEhUTUwgb2YgdGhlIGVsZW1lbnQuXG5cdFx0ICogQHJldHVybiB7U3RyaW5nfSBTdHJpbmcgd2l0aCBuZXcgSFRNTCBlbGVtZW50LCBmb3IgZXhhbXBsZTogPGEgaHJlZj1cIiNcIj50ZXN0PC9hPi5cblx0XHQgKiBAZXhhbXBsZVxuXHRcdCAqIC8vIENyZWF0ZXMgYSBodG1sIGNodW5rIGFuZCBpbnNlcnRzIGl0IGF0IHRoZSBjdXJyZW50IHNlbGVjdGlvbi9jYXJldCBsb2NhdGlvblxuXHRcdCAqIHRpbnltY2UuYWN0aXZlRWRpdG9yLnNlbGVjdGlvbi5zZXRDb250ZW50KHRpbnltY2UuYWN0aXZlRWRpdG9yLmRvbS5jcmVhdGVIVE1MKCdhJywge2hyZWY6ICd0ZXN0Lmh0bWwnfSwgJ3NvbWUgbGluZScpKTtcblx0XHQgKi9cblx0XHRjcmVhdGVIVE1MOiBmdW5jdGlvbihuYW1lLCBhdHRycywgaHRtbCkge1xuXHRcdFx0dmFyIG91dEh0bWwgPSAnJywga2V5O1xuXG5cdFx0XHRvdXRIdG1sICs9ICc8JyArIG5hbWU7XG5cblx0XHRcdGZvciAoa2V5IGluIGF0dHJzKSB7XG5cdFx0XHRcdGlmIChhdHRycy5oYXNPd25Qcm9wZXJ0eShrZXkpICYmIGF0dHJzW2tleV0gIT09IG51bGwgJiYgdHlwZW9mIGF0dHJzW2tleV0gIT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRvdXRIdG1sICs9ICcgJyArIGtleSArICc9XCInICsgdGhpcy5lbmNvZGUoYXR0cnNba2V5XSkgKyAnXCInO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdC8vIEEgY2FsbCB0byB0aW55bWNlLmlzIGRvZXNuJ3Qgd29yayBmb3Igc29tZSBvZGQgcmVhc29uIG9uIElFOSBwb3NzaWJsZSBidWcgaW5zaWRlIHRoZWlyIEpTIHJ1bnRpbWVcblx0XHRcdGlmICh0eXBlb2YgaHRtbCAhPSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0XHRcdHJldHVybiBvdXRIdG1sICsgJz4nICsgaHRtbCArICc8LycgKyBuYW1lICsgJz4nO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gb3V0SHRtbCArICcgLz4nO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBDcmVhdGVzIGEgZG9jdW1lbnQgZnJhZ21lbnQgb3V0IG9mIHRoZSBzcGVjaWZpZWQgSFRNTCBzdHJpbmcuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGNyZWF0ZUZyYWdtZW50XG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IGh0bWwgSHRtbCBzdHJpbmcgdG8gY3JlYXRlIGZyYWdtZW50IGZyb20uXG5cdFx0ICogQHJldHVybiB7RG9jdW1lbnRGcmFnbWVudH0gRG9jdW1lbnQgZnJhZ21lbnQgbm9kZS5cblx0XHQgKi9cblx0XHRjcmVhdGVGcmFnbWVudDogZnVuY3Rpb24oaHRtbCkge1xuXHRcdFx0dmFyIGZyYWcsIG5vZGUsIGRvYyA9IHRoaXMuZG9jLCBjb250YWluZXI7XG5cblx0XHRcdGNvbnRhaW5lciA9IGRvYy5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXHRcdFx0ZnJhZyA9IGRvYy5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG5cblx0XHRcdGlmIChodG1sKSB7XG5cdFx0XHRcdGNvbnRhaW5lci5pbm5lckhUTUwgPSBodG1sO1xuXHRcdFx0fVxuXG5cdFx0XHR3aGlsZSAoKG5vZGUgPSBjb250YWluZXIuZmlyc3RDaGlsZCkpIHtcblx0XHRcdFx0ZnJhZy5hcHBlbmRDaGlsZChub2RlKTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIGZyYWc7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFJlbW92ZXMvZGVsZXRlcyB0aGUgc3BlY2lmaWVkIGVsZW1lbnQocykgZnJvbSB0aGUgRE9NLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCByZW1vdmVcblx0XHQgKiBAcGFyYW0ge1N0cmluZy9FbGVtZW50L0FycmF5fSBub2RlIElEIG9mIGVsZW1lbnQgb3IgRE9NIGVsZW1lbnQgb2JqZWN0IG9yIGFycmF5IGNvbnRhaW5pbmcgbXVsdGlwbGUgZWxlbWVudHMvaWRzLlxuXHRcdCAqIEBwYXJhbSB7Qm9vbGVhbn0ga2VlcENoaWxkcmVuIE9wdGlvbmFsIHN0YXRlIHRvIGtlZXAgY2hpbGRyZW4gb3Igbm90LiBJZiBzZXQgdG8gdHJ1ZSBhbGwgY2hpbGRyZW4gd2lsbCBiZVxuXHRcdCAqIHBsYWNlZCBhdCB0aGUgbG9jYXRpb24gb2YgdGhlIHJlbW92ZWQgZWxlbWVudC5cblx0XHQgKiBAcmV0dXJuIHtFbGVtZW50L0FycmF5fSBIVE1MIERPTSBlbGVtZW50IHRoYXQgZ290IHJlbW92ZWQsIG9yIGFuIGFycmF5IG9mIHJlbW92ZWQgZWxlbWVudHMgaWYgbXVsdGlwbGUgaW5wdXQgZWxlbWVudHNcblx0XHQgKiB3ZXJlIHBhc3NlZCBpbi5cblx0XHQgKiBAZXhhbXBsZVxuXHRcdCAqIC8vIFJlbW92ZXMgYWxsIHBhcmFncmFwaHMgaW4gdGhlIGFjdGl2ZSBlZGl0b3Jcblx0XHQgKiB0aW55bWNlLmFjdGl2ZUVkaXRvci5kb20ucmVtb3ZlKHRpbnltY2UuYWN0aXZlRWRpdG9yLmRvbS5zZWxlY3QoJ3AnKSk7XG5cdFx0ICpcblx0XHQgKiAvLyBSZW1vdmVzIGFuIGVsZW1lbnQgYnkgaWQgaW4gdGhlIGRvY3VtZW50XG5cdFx0ICogdGlueW1jZS5ET00ucmVtb3ZlKCdteWRpdicpO1xuXHRcdCAqL1xuXHRcdHJlbW92ZTogZnVuY3Rpb24obm9kZSwga2VlcENoaWxkcmVuKSB7XG5cdFx0XHRub2RlID0gdGhpcy4kJChub2RlKTtcblxuXHRcdFx0aWYgKGtlZXBDaGlsZHJlbikge1xuXHRcdFx0XHRub2RlLmVhY2goZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0dmFyIGNoaWxkO1xuXG5cdFx0XHRcdFx0d2hpbGUgKChjaGlsZCA9IHRoaXMuZmlyc3RDaGlsZCkpIHtcblx0XHRcdFx0XHRcdGlmIChjaGlsZC5ub2RlVHlwZSA9PSAzICYmIGNoaWxkLmRhdGEubGVuZ3RoID09PSAwKSB7XG5cdFx0XHRcdFx0XHRcdHRoaXMucmVtb3ZlQ2hpbGQoY2hpbGQpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0dGhpcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShjaGlsZCwgdGhpcyk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KS5yZW1vdmUoKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdG5vZGUucmVtb3ZlKCk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBub2RlLmxlbmd0aCA+IDEgPyBub2RlLnRvQXJyYXkoKSA6IG5vZGVbMF07XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFNldHMgdGhlIENTUyBzdHlsZSB2YWx1ZSBvbiBhIEhUTUwgZWxlbWVudC4gVGhlIG5hbWUgY2FuIGJlIGEgY2FtZWxjYXNlIHN0cmluZ1xuXHRcdCAqIG9yIHRoZSBDU1Mgc3R5bGUgbmFtZSBsaWtlIGJhY2tncm91bmQtY29sb3IuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHNldFN0eWxlXG5cdFx0ICogQHBhcmFtIHtTdHJpbmcvRWxlbWVudC9BcnJheX0gZWxtIEhUTUwgZWxlbWVudC9BcnJheSBvZiBlbGVtZW50cyB0byBzZXQgQ1NTIHN0eWxlIHZhbHVlIG9uLlxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIE5hbWUgb2YgdGhlIHN0eWxlIHZhbHVlIHRvIHNldC5cblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gdmFsdWUgVmFsdWUgdG8gc2V0IG9uIHRoZSBzdHlsZS5cblx0XHQgKiBAZXhhbXBsZVxuXHRcdCAqIC8vIFNldHMgYSBzdHlsZSB2YWx1ZSBvbiBhbGwgcGFyYWdyYXBocyBpbiB0aGUgY3VycmVudGx5IGFjdGl2ZSBlZGl0b3Jcblx0XHQgKiB0aW55bWNlLmFjdGl2ZUVkaXRvci5kb20uc2V0U3R5bGUodGlueW1jZS5hY3RpdmVFZGl0b3IuZG9tLnNlbGVjdCgncCcpLCAnYmFja2dyb3VuZC1jb2xvcicsICdyZWQnKTtcblx0XHQgKlxuXHRcdCAqIC8vIFNldHMgYSBzdHlsZSB2YWx1ZSB0byBhbiBlbGVtZW50IGJ5IGlkIGluIHRoZSBjdXJyZW50IGRvY3VtZW50XG5cdFx0ICogdGlueW1jZS5ET00uc2V0U3R5bGUoJ215ZGl2JywgJ2JhY2tncm91bmQtY29sb3InLCAncmVkJyk7XG5cdFx0ICovXG5cdFx0c2V0U3R5bGU6IGZ1bmN0aW9uKGVsbSwgbmFtZSwgdmFsdWUpIHtcblx0XHRcdGVsbSA9IHRoaXMuJCQoZWxtKS5jc3MobmFtZSwgdmFsdWUpO1xuXG5cdFx0XHRpZiAodGhpcy5zZXR0aW5ncy51cGRhdGVfc3R5bGVzKSB7XG5cdFx0XHRcdHVwZGF0ZUludGVybmFsU3R5bGVBdHRyKHRoaXMsIGVsbSk7XG5cdFx0XHR9XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFJldHVybnMgdGhlIGN1cnJlbnQgc3R5bGUgb3IgcnVudGltZS9jb21wdXRlZCB2YWx1ZSBvZiBhbiBlbGVtZW50LlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBnZXRTdHlsZVxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nL0VsZW1lbnR9IGVsbSBIVE1MIGVsZW1lbnQgb3IgZWxlbWVudCBpZCBzdHJpbmcgdG8gZ2V0IHN0eWxlIGZyb20uXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IG5hbWUgU3R5bGUgbmFtZSB0byByZXR1cm4uXG5cdFx0ICogQHBhcmFtIHtCb29sZWFufSBjb21wdXRlZCBDb21wdXRlZCBzdHlsZS5cblx0XHQgKiBAcmV0dXJuIHtTdHJpbmd9IEN1cnJlbnQgc3R5bGUgb3IgY29tcHV0ZWQgc3R5bGUgdmFsdWUgb2YgYW4gZWxlbWVudC5cblx0XHQgKi9cblx0XHRnZXRTdHlsZTogZnVuY3Rpb24oZWxtLCBuYW1lLCBjb21wdXRlZCkge1xuXHRcdFx0ZWxtID0gdGhpcy4kJChlbG0pO1xuXG5cdFx0XHRpZiAoY29tcHV0ZWQpIHtcblx0XHRcdFx0cmV0dXJuIGVsbS5jc3MobmFtZSk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIENhbWVsY2FzZSBpdCwgaWYgbmVlZGVkXG5cdFx0XHRuYW1lID0gbmFtZS5yZXBsYWNlKC8tKFxcRCkvZywgZnVuY3Rpb24oYSwgYikge1xuXHRcdFx0XHRyZXR1cm4gYi50b1VwcGVyQ2FzZSgpO1xuXHRcdFx0fSk7XG5cblx0XHRcdGlmIChuYW1lID09ICdmbG9hdCcpIHtcblx0XHRcdFx0bmFtZSA9IEVudi5pZSAmJiBFbnYuaWUgPCAxMiA/ICdzdHlsZUZsb2F0JyA6ICdjc3NGbG9hdCc7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBlbG1bMF0gJiYgZWxtWzBdLnN0eWxlID8gZWxtWzBdLnN0eWxlW25hbWVdIDogdW5kZWZpbmVkO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBTZXRzIG11bHRpcGxlIHN0eWxlcyBvbiB0aGUgc3BlY2lmaWVkIGVsZW1lbnQocykuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHNldFN0eWxlc1xuXHRcdCAqIEBwYXJhbSB7RWxlbWVudC9TdHJpbmcvQXJyYXl9IGVsbSBET00gZWxlbWVudCwgZWxlbWVudCBpZCBzdHJpbmcgb3IgYXJyYXkgb2YgZWxlbWVudHMvaWRzIHRvIHNldCBzdHlsZXMgb24uXG5cdFx0ICogQHBhcmFtIHtPYmplY3R9IHN0eWxlcyBOYW1lL1ZhbHVlIGNvbGxlY3Rpb24gb2Ygc3R5bGUgaXRlbXMgdG8gYWRkIHRvIHRoZSBlbGVtZW50KHMpLlxuXHRcdCAqIEBleGFtcGxlXG5cdFx0ICogLy8gU2V0cyBzdHlsZXMgb24gYWxsIHBhcmFncmFwaHMgaW4gdGhlIGN1cnJlbnRseSBhY3RpdmUgZWRpdG9yXG5cdFx0ICogdGlueW1jZS5hY3RpdmVFZGl0b3IuZG9tLnNldFN0eWxlcyh0aW55bWNlLmFjdGl2ZUVkaXRvci5kb20uc2VsZWN0KCdwJyksIHsnYmFja2dyb3VuZC1jb2xvcic6ICdyZWQnLCAnY29sb3InOiAnZ3JlZW4nfSk7XG5cdFx0ICpcblx0XHQgKiAvLyBTZXRzIHN0eWxlcyB0byBhbiBlbGVtZW50IGJ5IGlkIGluIHRoZSBjdXJyZW50IGRvY3VtZW50XG5cdFx0ICogdGlueW1jZS5ET00uc2V0U3R5bGVzKCdteWRpdicsIHsnYmFja2dyb3VuZC1jb2xvcic6ICdyZWQnLCAnY29sb3InOiAnZ3JlZW4nfSk7XG5cdFx0ICovXG5cdFx0c2V0U3R5bGVzOiBmdW5jdGlvbihlbG0sIHN0eWxlcykge1xuXHRcdFx0ZWxtID0gdGhpcy4kJChlbG0pLmNzcyhzdHlsZXMpO1xuXG5cdFx0XHRpZiAodGhpcy5zZXR0aW5ncy51cGRhdGVfc3R5bGVzKSB7XG5cdFx0XHRcdHVwZGF0ZUludGVybmFsU3R5bGVBdHRyKHRoaXMsIGVsbSk7XG5cdFx0XHR9XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFJlbW92ZXMgYWxsIGF0dHJpYnV0ZXMgZnJvbSBhbiBlbGVtZW50IG9yIGVsZW1lbnRzLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCByZW1vdmVBbGxBdHRyaWJzXG5cdFx0ICogQHBhcmFtIHtFbGVtZW50L1N0cmluZy9BcnJheX0gZSBET00gZWxlbWVudCwgZWxlbWVudCBpZCBzdHJpbmcgb3IgYXJyYXkgb2YgZWxlbWVudHMvaWRzIHRvIHJlbW92ZSBhdHRyaWJ1dGVzIGZyb20uXG5cdFx0ICovXG5cdFx0cmVtb3ZlQWxsQXR0cmliczogZnVuY3Rpb24oZSkge1xuXHRcdFx0cmV0dXJuIHRoaXMucnVuKGUsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0dmFyIGksIGF0dHJzID0gZS5hdHRyaWJ1dGVzO1xuXHRcdFx0XHRmb3IgKGkgPSBhdHRycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuXHRcdFx0XHRcdGUucmVtb3ZlQXR0cmlidXRlTm9kZShhdHRycy5pdGVtKGkpKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFNldHMgdGhlIHNwZWNpZmllZCBhdHRyaWJ1dGUgb2YgYW4gZWxlbWVudCBvciBlbGVtZW50cy5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2Qgc2V0QXR0cmliXG5cdFx0ICogQHBhcmFtIHtFbGVtZW50L1N0cmluZy9BcnJheX0gZWxtIERPTSBlbGVtZW50LCBlbGVtZW50IGlkIHN0cmluZyBvciBhcnJheSBvZiBlbGVtZW50cy9pZHMgdG8gc2V0IGF0dHJpYnV0ZSBvbi5cblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSBOYW1lIG9mIGF0dHJpYnV0ZSB0byBzZXQuXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IHZhbHVlIFZhbHVlIHRvIHNldCBvbiB0aGUgYXR0cmlidXRlIC0gaWYgdGhpcyB2YWx1ZSBpcyBmYWxzeSBsaWtlIG51bGwsIDAgb3IgJycgaXQgd2lsbCByZW1vdmVcblx0XHQgKiB0aGUgYXR0cmlidXRlIGluc3RlYWQuXG5cdFx0ICogQGV4YW1wbGVcblx0XHQgKiAvLyBTZXRzIGNsYXNzIGF0dHJpYnV0ZSBvbiBhbGwgcGFyYWdyYXBocyBpbiB0aGUgYWN0aXZlIGVkaXRvclxuXHRcdCAqIHRpbnltY2UuYWN0aXZlRWRpdG9yLmRvbS5zZXRBdHRyaWIodGlueW1jZS5hY3RpdmVFZGl0b3IuZG9tLnNlbGVjdCgncCcpLCAnY2xhc3MnLCAnbXljbGFzcycpO1xuXHRcdCAqXG5cdFx0ICogLy8gU2V0cyBjbGFzcyBhdHRyaWJ1dGUgb24gYSBzcGVjaWZpYyBlbGVtZW50IGluIHRoZSBjdXJyZW50IHBhZ2Vcblx0XHQgKiB0aW55bWNlLmRvbS5zZXRBdHRyaWIoJ215ZGl2JywgJ2NsYXNzJywgJ215Y2xhc3MnKTtcblx0XHQgKi9cblx0XHRzZXRBdHRyaWI6IGZ1bmN0aW9uKGVsbSwgbmFtZSwgdmFsdWUpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgb3JpZ2luYWxWYWx1ZSwgaG9vaywgc2V0dGluZ3MgPSBzZWxmLnNldHRpbmdzO1xuXG5cdFx0XHRpZiAodmFsdWUgPT09ICcnKSB7XG5cdFx0XHRcdHZhbHVlID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdFx0ZWxtID0gc2VsZi4kJChlbG0pO1xuXHRcdFx0b3JpZ2luYWxWYWx1ZSA9IGVsbS5hdHRyKG5hbWUpO1xuXG5cdFx0XHRpZiAoIWVsbS5sZW5ndGgpIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHRob29rID0gc2VsZi5hdHRySG9va3NbbmFtZV07XG5cdFx0XHRpZiAoaG9vayAmJiBob29rLnNldCkge1xuXHRcdFx0XHRob29rLnNldChlbG0sIHZhbHVlLCBuYW1lKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGVsbS5hdHRyKG5hbWUsIHZhbHVlKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKG9yaWdpbmFsVmFsdWUgIT0gdmFsdWUgJiYgc2V0dGluZ3Mub25TZXRBdHRyaWIpIHtcblx0XHRcdFx0c2V0dGluZ3Mub25TZXRBdHRyaWIoe1xuXHRcdFx0XHRcdGF0dHJFbG06IGVsbSxcblx0XHRcdFx0XHRhdHRyTmFtZTogbmFtZSxcblx0XHRcdFx0XHRhdHRyVmFsdWU6IHZhbHVlXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBTZXRzIHR3byBvciBtb3JlIHNwZWNpZmllZCBhdHRyaWJ1dGVzIG9mIGFuIGVsZW1lbnQgb3IgZWxlbWVudHMuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHNldEF0dHJpYnNcblx0XHQgKiBAcGFyYW0ge0VsZW1lbnQvU3RyaW5nL0FycmF5fSBlbG0gRE9NIGVsZW1lbnQsIGVsZW1lbnQgaWQgc3RyaW5nIG9yIGFycmF5IG9mIGVsZW1lbnRzL2lkcyB0byBzZXQgYXR0cmlidXRlcyBvbi5cblx0XHQgKiBAcGFyYW0ge09iamVjdH0gYXR0cnMgTmFtZS9WYWx1ZSBjb2xsZWN0aW9uIG9mIGF0dHJpYnV0ZSBpdGVtcyB0byBhZGQgdG8gdGhlIGVsZW1lbnQocykuXG5cdFx0ICogQGV4YW1wbGVcblx0XHQgKiAvLyBTZXRzIGNsYXNzIGFuZCB0aXRsZSBhdHRyaWJ1dGVzIG9uIGFsbCBwYXJhZ3JhcGhzIGluIHRoZSBhY3RpdmUgZWRpdG9yXG5cdFx0ICogdGlueW1jZS5hY3RpdmVFZGl0b3IuZG9tLnNldEF0dHJpYnModGlueW1jZS5hY3RpdmVFZGl0b3IuZG9tLnNlbGVjdCgncCcpLCB7J2NsYXNzJzogJ215Y2xhc3MnLCB0aXRsZTogJ3NvbWUgdGl0bGUnfSk7XG5cdFx0ICpcblx0XHQgKiAvLyBTZXRzIGNsYXNzIGFuZCB0aXRsZSBhdHRyaWJ1dGVzIG9uIGEgc3BlY2lmaWMgZWxlbWVudCBpbiB0aGUgY3VycmVudCBwYWdlXG5cdFx0ICogdGlueW1jZS5ET00uc2V0QXR0cmlicygnbXlkaXYnLCB7J2NsYXNzJzogJ215Y2xhc3MnLCB0aXRsZTogJ3NvbWUgdGl0bGUnfSk7XG5cdFx0ICovXG5cdFx0c2V0QXR0cmliczogZnVuY3Rpb24oZWxtLCBhdHRycykge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHRzZWxmLiQkKGVsbSkuZWFjaChmdW5jdGlvbihpLCBub2RlKSB7XG5cdFx0XHRcdGVhY2goYXR0cnMsIGZ1bmN0aW9uKHZhbHVlLCBuYW1lKSB7XG5cdFx0XHRcdFx0c2VsZi5zZXRBdHRyaWIobm9kZSwgbmFtZSwgdmFsdWUpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH0pO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZXR1cm5zIHRoZSBzcGVjaWZpZWQgYXR0cmlidXRlIGJ5IG5hbWUuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGdldEF0dHJpYlxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nL0VsZW1lbnR9IGVsbSBFbGVtZW50IHN0cmluZyBpZCBvciBET00gZWxlbWVudCB0byBnZXQgYXR0cmlidXRlIGZyb20uXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IG5hbWUgTmFtZSBvZiBhdHRyaWJ1dGUgdG8gZ2V0LlxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBkZWZhdWx0VmFsIE9wdGlvbmFsIGRlZmF1bHQgdmFsdWUgdG8gcmV0dXJuIGlmIHRoZSBhdHRyaWJ1dGUgZGlkbid0IGV4aXN0LlxuXHRcdCAqIEByZXR1cm4ge1N0cmluZ30gQXR0cmlidXRlIHZhbHVlIHN0cmluZywgZGVmYXVsdCB2YWx1ZSBvciBudWxsIGlmIHRoZSBhdHRyaWJ1dGUgd2Fzbid0IGZvdW5kLlxuXHRcdCAqL1xuXHRcdGdldEF0dHJpYjogZnVuY3Rpb24oZWxtLCBuYW1lLCBkZWZhdWx0VmFsKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIGhvb2ssIHZhbHVlO1xuXG5cdFx0XHRlbG0gPSBzZWxmLiQkKGVsbSk7XG5cblx0XHRcdGlmIChlbG0ubGVuZ3RoKSB7XG5cdFx0XHRcdGhvb2sgPSBzZWxmLmF0dHJIb29rc1tuYW1lXTtcblxuXHRcdFx0XHRpZiAoaG9vayAmJiBob29rLmdldCkge1xuXHRcdFx0XHRcdHZhbHVlID0gaG9vay5nZXQoZWxtLCBuYW1lKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR2YWx1ZSA9IGVsbS5hdHRyKG5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YgdmFsdWUgPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dmFsdWUgPSBkZWZhdWx0VmFsIHx8ICcnO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFJldHVybnMgdGhlIGFic29sdXRlIHgsIHkgcG9zaXRpb24gb2YgYSBub2RlLiBUaGUgcG9zaXRpb24gd2lsbCBiZSByZXR1cm5lZCBpbiBhbiBvYmplY3Qgd2l0aCB4LCB5IGZpZWxkcy5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgZ2V0UG9zXG5cdFx0ICogQHBhcmFtIHtFbGVtZW50L1N0cmluZ30gZWxtIEhUTUwgZWxlbWVudCBvciBlbGVtZW50IGlkIHRvIGdldCB4LCB5IHBvc2l0aW9uIGZyb20uXG5cdFx0ICogQHBhcmFtIHtFbGVtZW50fSByb290RWxtIE9wdGlvbmFsIHJvb3QgZWxlbWVudCB0byBzdG9wIGNhbGN1bGF0aW9ucyBhdC5cblx0XHQgKiBAcmV0dXJuIHtvYmplY3R9IEFic29sdXRlIHBvc2l0aW9uIG9mIHRoZSBzcGVjaWZpZWQgZWxlbWVudCBvYmplY3Qgd2l0aCB4LCB5IGZpZWxkcy5cblx0XHQgKi9cblx0XHRnZXRQb3M6IGZ1bmN0aW9uKGVsbSwgcm9vdEVsbSkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLCB4ID0gMCwgeSA9IDAsIG9mZnNldFBhcmVudCwgZG9jID0gc2VsZi5kb2MsIGJvZHkgPSBkb2MuYm9keSwgcG9zO1xuXG5cdFx0XHRlbG0gPSBzZWxmLmdldChlbG0pO1xuXHRcdFx0cm9vdEVsbSA9IHJvb3RFbG0gfHwgYm9keTtcblxuXHRcdFx0aWYgKGVsbSkge1xuXHRcdFx0XHQvLyBVc2UgZ2V0Qm91bmRpbmdDbGllbnRSZWN0IGlmIGl0IGV4aXN0cyBzaW5jZSBpdCdzIGZhc3RlciB0aGFuIGxvb3Bpbmcgb2Zmc2V0IG5vZGVzXG5cdFx0XHRcdC8vIEZhbGxiYWNrIHRvIG9mZnNldFBhcmVudCBjYWxjdWxhdGlvbnMgaWYgdGhlIGJvZHkgaXNuJ3Qgc3RhdGljIGJldHRlciBzaW5jZSBpdCBzdG9wcyBhdCB0aGUgYm9keSByb290XG5cdFx0XHRcdGlmIChyb290RWxtID09PSBib2R5ICYmIGVsbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QgJiYgJChib2R5KS5jc3MoJ3Bvc2l0aW9uJykgPT09ICdzdGF0aWMnKSB7XG5cdFx0XHRcdFx0cG9zID0gZWxtLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuXHRcdFx0XHRcdHJvb3RFbG0gPSBzZWxmLmJveE1vZGVsID8gZG9jLmRvY3VtZW50RWxlbWVudCA6IGJvZHk7XG5cblx0XHRcdFx0XHQvLyBBZGQgc2Nyb2xsIG9mZnNldHMgZnJvbSBkb2N1bWVudEVsZW1lbnQgb3IgYm9keSBzaW5jZSBJRSB3aXRoIHRoZSB3cm9uZyBib3ggbW9kZWwgd2lsbCB1c2UgZC5ib2R5IGFuZCBzbyBkbyBXZWJLaXRcblx0XHRcdFx0XHQvLyBBbHNvIHJlbW92ZSB0aGUgYm9keS9kb2N1bWVudGVsZW1lbnQgY2xpZW50VG9wL2NsaWVudExlZnQgb24gSUUgNiwgNyBzaW5jZSB0aGV5IG9mZnNldCB0aGUgcG9zaXRpb25cblx0XHRcdFx0XHR4ID0gcG9zLmxlZnQgKyAoZG9jLmRvY3VtZW50RWxlbWVudC5zY3JvbGxMZWZ0IHx8IGJvZHkuc2Nyb2xsTGVmdCkgLSByb290RWxtLmNsaWVudExlZnQ7XG5cdFx0XHRcdFx0eSA9IHBvcy50b3AgKyAoZG9jLmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3AgfHwgYm9keS5zY3JvbGxUb3ApIC0gcm9vdEVsbS5jbGllbnRUb3A7XG5cblx0XHRcdFx0XHRyZXR1cm4ge3g6IHgsIHk6IHl9O1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0b2Zmc2V0UGFyZW50ID0gZWxtO1xuXHRcdFx0XHR3aGlsZSAob2Zmc2V0UGFyZW50ICYmIG9mZnNldFBhcmVudCAhPSByb290RWxtICYmIG9mZnNldFBhcmVudC5ub2RlVHlwZSkge1xuXHRcdFx0XHRcdHggKz0gb2Zmc2V0UGFyZW50Lm9mZnNldExlZnQgfHwgMDtcblx0XHRcdFx0XHR5ICs9IG9mZnNldFBhcmVudC5vZmZzZXRUb3AgfHwgMDtcblx0XHRcdFx0XHRvZmZzZXRQYXJlbnQgPSBvZmZzZXRQYXJlbnQub2Zmc2V0UGFyZW50O1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0b2Zmc2V0UGFyZW50ID0gZWxtLnBhcmVudE5vZGU7XG5cdFx0XHRcdHdoaWxlIChvZmZzZXRQYXJlbnQgJiYgb2Zmc2V0UGFyZW50ICE9IHJvb3RFbG0gJiYgb2Zmc2V0UGFyZW50Lm5vZGVUeXBlKSB7XG5cdFx0XHRcdFx0eCAtPSBvZmZzZXRQYXJlbnQuc2Nyb2xsTGVmdCB8fCAwO1xuXHRcdFx0XHRcdHkgLT0gb2Zmc2V0UGFyZW50LnNjcm9sbFRvcCB8fCAwO1xuXHRcdFx0XHRcdG9mZnNldFBhcmVudCA9IG9mZnNldFBhcmVudC5wYXJlbnROb2RlO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiB7eDogeCwgeTogeX07XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFBhcnNlcyB0aGUgc3BlY2lmaWVkIHN0eWxlIHZhbHVlIGludG8gYW4gb2JqZWN0IGNvbGxlY3Rpb24uIFRoaXMgcGFyc2VyIHdpbGwgYWxzb1xuXHRcdCAqIG1lcmdlIGFuZCByZW1vdmUgYW55IHJlZHVuZGFudCBpdGVtcyB0aGF0IGJyb3dzZXJzIG1pZ2h0IGhhdmUgYWRkZWQuIEl0IHdpbGwgYWxzbyBjb252ZXJ0IG5vbi1oZXhcblx0XHQgKiBjb2xvcnMgdG8gaGV4IHZhbHVlcy4gVXJscyBpbnNpZGUgdGhlIHN0eWxlcyB3aWxsIGFsc28gYmUgY29udmVydGVkIHRvIGFic29sdXRlL3JlbGF0aXZlIGJhc2VkIG9uIHNldHRpbmdzLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBwYXJzZVN0eWxlXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IGNzc1RleHQgU3R5bGUgdmFsdWUgdG8gcGFyc2UsIGZvciBleGFtcGxlOiBib3JkZXI6MXB4IHNvbGlkIHJlZDsuXG5cdFx0ICogQHJldHVybiB7T2JqZWN0fSBPYmplY3QgcmVwcmVzZW50YXRpb24gb2YgdGhhdCBzdHlsZSwgZm9yIGV4YW1wbGU6IHtib3JkZXI6ICcxcHggc29saWQgcmVkJ31cblx0XHQgKi9cblx0XHRwYXJzZVN0eWxlOiBmdW5jdGlvbihjc3NUZXh0KSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5zdHlsZXMucGFyc2UoY3NzVGV4dCk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFNlcmlhbGl6ZXMgdGhlIHNwZWNpZmllZCBzdHlsZSBvYmplY3QgaW50byBhIHN0cmluZy5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2Qgc2VyaWFsaXplU3R5bGVcblx0XHQgKiBAcGFyYW0ge09iamVjdH0gc3R5bGVzIE9iamVjdCB0byBzZXJpYWxpemUgYXMgc3RyaW5nLCBmb3IgZXhhbXBsZToge2JvcmRlcjogJzFweCBzb2xpZCByZWQnfVxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIE9wdGlvbmFsIGVsZW1lbnQgbmFtZS5cblx0XHQgKiBAcmV0dXJuIHtTdHJpbmd9IFN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0aGUgc3R5bGUgb2JqZWN0LCBmb3IgZXhhbXBsZTogYm9yZGVyOiAxcHggc29saWQgcmVkLlxuXHRcdCAqL1xuXHRcdHNlcmlhbGl6ZVN0eWxlOiBmdW5jdGlvbihzdHlsZXMsIG5hbWUpIHtcblx0XHRcdHJldHVybiB0aGlzLnN0eWxlcy5zZXJpYWxpemUoc3R5bGVzLCBuYW1lKTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogQWRkcyBhIHN0eWxlIGVsZW1lbnQgYXQgdGhlIHRvcCBvZiB0aGUgZG9jdW1lbnQgd2l0aCB0aGUgc3BlY2lmaWVkIGNzc1RleHQgY29udGVudC5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgYWRkU3R5bGVcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gY3NzVGV4dCBDU1MgVGV4dCBzdHlsZSB0byBhZGQgdG8gdG9wIG9mIGhlYWQgb2YgZG9jdW1lbnQuXG5cdFx0ICovXG5cdFx0YWRkU3R5bGU6IGZ1bmN0aW9uKGNzc1RleHQpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgZG9jID0gc2VsZi5kb2MsIGhlYWQsIHN0eWxlRWxtO1xuXG5cdFx0XHQvLyBQcmV2ZW50IGlubGluZSBmcm9tIGxvYWRpbmcgdGhlIHNhbWUgc3R5bGVzIHR3aWNlXG5cdFx0XHRpZiAoc2VsZiAhPT0gRE9NVXRpbHMuRE9NICYmIGRvYyA9PT0gZG9jdW1lbnQpIHtcblx0XHRcdFx0dmFyIGFkZGVkU3R5bGVzID0gRE9NVXRpbHMuRE9NLmFkZGVkU3R5bGVzO1xuXG5cdFx0XHRcdGFkZGVkU3R5bGVzID0gYWRkZWRTdHlsZXMgfHwgW107XG5cdFx0XHRcdGlmIChhZGRlZFN0eWxlc1tjc3NUZXh0XSkge1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGFkZGVkU3R5bGVzW2Nzc1RleHRdID0gdHJ1ZTtcblx0XHRcdFx0RE9NVXRpbHMuRE9NLmFkZGVkU3R5bGVzID0gYWRkZWRTdHlsZXM7XG5cdFx0XHR9XG5cblx0XHRcdC8vIENyZWF0ZSBzdHlsZSBlbGVtZW50IGlmIG5lZWRlZFxuXHRcdFx0c3R5bGVFbG0gPSBkb2MuZ2V0RWxlbWVudEJ5SWQoJ21jZURlZmF1bHRTdHlsZXMnKTtcblx0XHRcdGlmICghc3R5bGVFbG0pIHtcblx0XHRcdFx0c3R5bGVFbG0gPSBkb2MuY3JlYXRlRWxlbWVudCgnc3R5bGUnKTtcblx0XHRcdFx0c3R5bGVFbG0uaWQgPSAnbWNlRGVmYXVsdFN0eWxlcyc7XG5cdFx0XHRcdHN0eWxlRWxtLnR5cGUgPSAndGV4dC9jc3MnO1xuXG5cdFx0XHRcdGhlYWQgPSBkb2MuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2hlYWQnKVswXTtcblx0XHRcdFx0aWYgKGhlYWQuZmlyc3RDaGlsZCkge1xuXHRcdFx0XHRcdGhlYWQuaW5zZXJ0QmVmb3JlKHN0eWxlRWxtLCBoZWFkLmZpcnN0Q2hpbGQpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGhlYWQuYXBwZW5kQ2hpbGQoc3R5bGVFbG0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdC8vIEFwcGVuZCBzdHlsZSBkYXRhIHRvIG9sZCBvciBuZXcgc3R5bGUgZWxlbWVudFxuXHRcdFx0aWYgKHN0eWxlRWxtLnN0eWxlU2hlZXQpIHtcblx0XHRcdFx0c3R5bGVFbG0uc3R5bGVTaGVldC5jc3NUZXh0ICs9IGNzc1RleHQ7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRzdHlsZUVsbS5hcHBlbmRDaGlsZChkb2MuY3JlYXRlVGV4dE5vZGUoY3NzVGV4dCkpO1xuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBJbXBvcnRzL2xvYWRzIHRoZSBzcGVjaWZpZWQgQ1NTIGZpbGUgaW50byB0aGUgZG9jdW1lbnQgYm91bmQgdG8gdGhlIGNsYXNzLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBsb2FkQ1NTXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IHVybCBVUkwgdG8gQ1NTIGZpbGUgdG8gbG9hZC5cblx0XHQgKiBAZXhhbXBsZVxuXHRcdCAqIC8vIExvYWRzIGEgQ1NTIGZpbGUgZHluYW1pY2FsbHkgaW50byB0aGUgY3VycmVudCBkb2N1bWVudFxuXHRcdCAqIHRpbnltY2UuRE9NLmxvYWRDU1MoJ3NvbWVwYXRoL3NvbWUuY3NzJyk7XG5cdFx0ICpcblx0XHQgKiAvLyBMb2FkcyBhIENTUyBmaWxlIGludG8gdGhlIGN1cnJlbnRseSBhY3RpdmUgZWRpdG9yIGluc3RhbmNlXG5cdFx0ICogdGlueW1jZS5hY3RpdmVFZGl0b3IuZG9tLmxvYWRDU1MoJ3NvbWVwYXRoL3NvbWUuY3NzJyk7XG5cdFx0ICpcblx0XHQgKiAvLyBMb2FkcyBhIENTUyBmaWxlIGludG8gYW4gZWRpdG9yIGluc3RhbmNlIGJ5IGlkXG5cdFx0ICogdGlueW1jZS5nZXQoJ3NvbWVpZCcpLmRvbS5sb2FkQ1NTKCdzb21lcGF0aC9zb21lLmNzcycpO1xuXHRcdCAqXG5cdFx0ICogLy8gTG9hZHMgbXVsdGlwbGUgQ1NTIGZpbGVzIGludG8gdGhlIGN1cnJlbnQgZG9jdW1lbnRcblx0XHQgKiB0aW55bWNlLkRPTS5sb2FkQ1NTKCdzb21lcGF0aC9zb21lLmNzcyxzb21lcGF0aC9zb21lb3RoZXIuY3NzJyk7XG5cdFx0ICovXG5cdFx0bG9hZENTUzogZnVuY3Rpb24odXJsKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIGRvYyA9IHNlbGYuZG9jLCBoZWFkO1xuXG5cdFx0XHQvLyBQcmV2ZW50IGlubGluZSBmcm9tIGxvYWRpbmcgdGhlIHNhbWUgQ1NTIGZpbGUgdHdpY2Vcblx0XHRcdGlmIChzZWxmICE9PSBET01VdGlscy5ET00gJiYgZG9jID09PSBkb2N1bWVudCkge1xuXHRcdFx0XHRET01VdGlscy5ET00ubG9hZENTUyh1cmwpO1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdGlmICghdXJsKSB7XG5cdFx0XHRcdHVybCA9ICcnO1xuXHRcdFx0fVxuXG5cdFx0XHRoZWFkID0gZG9jLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdoZWFkJylbMF07XG5cblx0XHRcdGVhY2godXJsLnNwbGl0KCcsJyksIGZ1bmN0aW9uKHVybCkge1xuXHRcdFx0XHR2YXIgbGluaztcblxuXHRcdFx0XHR1cmwgPSBUb29scy5fYWRkQ2FjaGVTdWZmaXgodXJsKTtcblxuXHRcdFx0XHRpZiAoc2VsZi5maWxlc1t1cmxdKSB7XG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0c2VsZi5maWxlc1t1cmxdID0gdHJ1ZTtcblx0XHRcdFx0bGluayA9IHNlbGYuY3JlYXRlKCdsaW5rJywge3JlbDogJ3N0eWxlc2hlZXQnLCBocmVmOiB1cmx9KTtcblxuXHRcdFx0XHQvLyBJRSA4IGhhcyBhIGJ1ZyB3aGVyZSBkeW5hbWljYWxseSBsb2FkaW5nIHN0eWxlc2hlZXRzIHdvdWxkIHByb2R1Y2UgYSAxIGl0ZW0gcmVtYWluaW5nIGJ1Z1xuXHRcdFx0XHQvLyBUaGlzIGZpeCBzZWVtcyB0byByZXNvbHZlIHRoYXQgaXNzdWUgYnkgcmVjYWxjaW5nIHRoZSBkb2N1bWVudCBvbmNlIGEgc3R5bGVzaGVldCBmaW5pc2hlcyBsb2FkaW5nXG5cdFx0XHRcdC8vIEl0J3MgdWdseSBidXQgaXQgc2VlbXMgdG8gd29yayBmaW5lLlxuXHRcdFx0XHRpZiAoaXNJRSAmJiBkb2MuZG9jdW1lbnRNb2RlICYmIGRvYy5yZWNhbGMpIHtcblx0XHRcdFx0XHRsaW5rLm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdFx0aWYgKGRvYy5yZWNhbGMpIHtcblx0XHRcdFx0XHRcdFx0ZG9jLnJlY2FsYygpO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRsaW5rLm9ubG9hZCA9IG51bGw7XG5cdFx0XHRcdFx0fTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGhlYWQuYXBwZW5kQ2hpbGQobGluayk7XG5cdFx0XHR9KTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogQWRkcyBhIGNsYXNzIHRvIHRoZSBzcGVjaWZpZWQgZWxlbWVudCBvciBlbGVtZW50cy5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgYWRkQ2xhc3Ncblx0XHQgKiBAcGFyYW0ge1N0cmluZy9FbGVtZW50L0FycmF5fSBlbG0gRWxlbWVudCBJRCBzdHJpbmcgb3IgRE9NIGVsZW1lbnQgb3IgYXJyYXkgd2l0aCBlbGVtZW50cyBvciBJRHMuXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IGNscyBDbGFzcyBuYW1lIHRvIGFkZCB0byBlYWNoIGVsZW1lbnQuXG5cdFx0ICogQHJldHVybiB7U3RyaW5nL0FycmF5fSBTdHJpbmcgd2l0aCBuZXcgY2xhc3MgdmFsdWUgb3IgYXJyYXkgd2l0aCBuZXcgY2xhc3MgdmFsdWVzIGZvciBhbGwgZWxlbWVudHMuXG5cdFx0ICogQGV4YW1wbGVcblx0XHQgKiAvLyBBZGRzIGEgY2xhc3MgdG8gYWxsIHBhcmFncmFwaHMgaW4gdGhlIGFjdGl2ZSBlZGl0b3Jcblx0XHQgKiB0aW55bWNlLmFjdGl2ZUVkaXRvci5kb20uYWRkQ2xhc3ModGlueW1jZS5hY3RpdmVFZGl0b3IuZG9tLnNlbGVjdCgncCcpLCAnbXljbGFzcycpO1xuXHRcdCAqXG5cdFx0ICogLy8gQWRkcyBhIGNsYXNzIHRvIGEgc3BlY2lmaWMgZWxlbWVudCBpbiB0aGUgY3VycmVudCBwYWdlXG5cdFx0ICogdGlueW1jZS5ET00uYWRkQ2xhc3MoJ215ZGl2JywgJ215Y2xhc3MnKTtcblx0XHQgKi9cblx0XHRhZGRDbGFzczogZnVuY3Rpb24oZWxtLCBjbHMpIHtcblx0XHRcdHRoaXMuJCQoZWxtKS5hZGRDbGFzcyhjbHMpO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZW1vdmVzIGEgY2xhc3MgZnJvbSB0aGUgc3BlY2lmaWVkIGVsZW1lbnQgb3IgZWxlbWVudHMuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHJlbW92ZUNsYXNzXG5cdFx0ICogQHBhcmFtIHtTdHJpbmcvRWxlbWVudC9BcnJheX0gZWxtIEVsZW1lbnQgSUQgc3RyaW5nIG9yIERPTSBlbGVtZW50IG9yIGFycmF5IHdpdGggZWxlbWVudHMgb3IgSURzLlxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBjbHMgQ2xhc3MgbmFtZSB0byByZW1vdmUgZnJvbSBlYWNoIGVsZW1lbnQuXG5cdFx0ICogQHJldHVybiB7U3RyaW5nL0FycmF5fSBTdHJpbmcgb2YgcmVtYWluaW5nIGNsYXNzIG5hbWUocyksIG9yIGFuIGFycmF5IG9mIHN0cmluZ3MgaWYgbXVsdGlwbGUgaW5wdXQgZWxlbWVudHNcblx0XHQgKiB3ZXJlIHBhc3NlZCBpbi5cblx0XHQgKiBAZXhhbXBsZVxuXHRcdCAqIC8vIFJlbW92ZXMgYSBjbGFzcyBmcm9tIGFsbCBwYXJhZ3JhcGhzIGluIHRoZSBhY3RpdmUgZWRpdG9yXG5cdFx0ICogdGlueW1jZS5hY3RpdmVFZGl0b3IuZG9tLnJlbW92ZUNsYXNzKHRpbnltY2UuYWN0aXZlRWRpdG9yLmRvbS5zZWxlY3QoJ3AnKSwgJ215Y2xhc3MnKTtcblx0XHQgKlxuXHRcdCAqIC8vIFJlbW92ZXMgYSBjbGFzcyBmcm9tIGEgc3BlY2lmaWMgZWxlbWVudCBpbiB0aGUgY3VycmVudCBwYWdlXG5cdFx0ICogdGlueW1jZS5ET00ucmVtb3ZlQ2xhc3MoJ215ZGl2JywgJ215Y2xhc3MnKTtcblx0XHQgKi9cblx0XHRyZW1vdmVDbGFzczogZnVuY3Rpb24oZWxtLCBjbHMpIHtcblx0XHRcdHRoaXMudG9nZ2xlQ2xhc3MoZWxtLCBjbHMsIGZhbHNlKTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyB0cnVlIGlmIHRoZSBzcGVjaWZpZWQgZWxlbWVudCBoYXMgdGhlIHNwZWNpZmllZCBjbGFzcy5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgaGFzQ2xhc3Ncblx0XHQgKiBAcGFyYW0ge1N0cmluZy9FbGVtZW50fSBlbG0gSFRNTCBlbGVtZW50IG9yIGVsZW1lbnQgaWQgc3RyaW5nIHRvIGNoZWNrIENTUyBjbGFzcyBvbi5cblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gY2xzIENTUyBjbGFzcyB0byBjaGVjayBmb3IuXG5cdFx0ICogQHJldHVybiB7Qm9vbGVhbn0gdHJ1ZS9mYWxzZSBpZiB0aGUgc3BlY2lmaWVkIGVsZW1lbnQgaGFzIHRoZSBzcGVjaWZpZWQgY2xhc3MuXG5cdFx0ICovXG5cdFx0aGFzQ2xhc3M6IGZ1bmN0aW9uKGVsbSwgY2xzKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy4kJChlbG0pLmhhc0NsYXNzKGNscyk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFRvZ2dsZXMgdGhlIHNwZWNpZmllZCBjbGFzcyBvbi9vZmYuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHRvZ2dsZUNsYXNzXG5cdFx0ICogQHBhcmFtIHtFbGVtZW50fSBlbG0gRWxlbWVudCB0byB0b2dnbGUgY2xhc3Mgb24uXG5cdFx0ICogQHBhcmFtIHtbdHlwZV19IGNscyBDbGFzcyB0byB0b2dnbGUgb24vb2ZmLlxuXHRcdCAqIEBwYXJhbSB7W3R5cGVdfSBzdGF0ZSBPcHRpb25hbCBzdGF0ZSB0byBzZXQuXG5cdFx0ICovXG5cdFx0dG9nZ2xlQ2xhc3M6IGZ1bmN0aW9uKGVsbSwgY2xzLCBzdGF0ZSkge1xuXHRcdFx0dGhpcy4kJChlbG0pLnRvZ2dsZUNsYXNzKGNscywgc3RhdGUpLmVhY2goZnVuY3Rpb24oKSB7XG5cdFx0XHRcdGlmICh0aGlzLmNsYXNzTmFtZSA9PT0gJycpIHtcblx0XHRcdFx0XHQkKHRoaXMpLmF0dHIoJ2NsYXNzJywgbnVsbCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBTaG93cyB0aGUgc3BlY2lmaWVkIGVsZW1lbnQocykgYnkgSUQgYnkgc2V0dGluZyB0aGUgXCJkaXNwbGF5XCIgc3R5bGUuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHNob3dcblx0XHQgKiBAcGFyYW0ge1N0cmluZy9FbGVtZW50L0FycmF5fSBlbG0gSUQgb2YgRE9NIGVsZW1lbnQgb3IgRE9NIGVsZW1lbnQgb3IgYXJyYXkgd2l0aCBlbGVtZW50cyBvciBJRHMgdG8gc2hvdy5cblx0XHQgKi9cblx0XHRzaG93OiBmdW5jdGlvbihlbG0pIHtcblx0XHRcdHRoaXMuJCQoZWxtKS5zaG93KCk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIEhpZGVzIHRoZSBzcGVjaWZpZWQgZWxlbWVudChzKSBieSBJRCBieSBzZXR0aW5nIHRoZSBcImRpc3BsYXlcIiBzdHlsZS5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgaGlkZVxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nL0VsZW1lbnQvQXJyYXl9IGVsbSBJRCBvZiBET00gZWxlbWVudCBvciBET00gZWxlbWVudCBvciBhcnJheSB3aXRoIGVsZW1lbnRzIG9yIElEcyB0byBoaWRlLlxuXHRcdCAqIEBleGFtcGxlXG5cdFx0ICogLy8gSGlkZXMgYW4gZWxlbWVudCBieSBpZCBpbiB0aGUgZG9jdW1lbnRcblx0XHQgKiB0aW55bWNlLkRPTS5oaWRlKCdteWlkJyk7XG5cdFx0ICovXG5cdFx0aGlkZTogZnVuY3Rpb24oZWxtKSB7XG5cdFx0XHR0aGlzLiQkKGVsbSkuaGlkZSgpO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZXR1cm5zIHRydWUvZmFsc2UgaWYgdGhlIGVsZW1lbnQgaXMgaGlkZGVuIG9yIG5vdCBieSBjaGVja2luZyB0aGUgXCJkaXNwbGF5XCIgc3R5bGUuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGlzSGlkZGVuXG5cdFx0ICogQHBhcmFtIHtTdHJpbmcvRWxlbWVudH0gZWxtIElkIG9yIGVsZW1lbnQgdG8gY2hlY2sgZGlzcGxheSBzdGF0ZSBvbi5cblx0XHQgKiBAcmV0dXJuIHtCb29sZWFufSB0cnVlL2ZhbHNlIGlmIHRoZSBlbGVtZW50IGlzIGhpZGRlbiBvciBub3QuXG5cdFx0ICovXG5cdFx0aXNIaWRkZW46IGZ1bmN0aW9uKGVsbSkge1xuXHRcdFx0cmV0dXJuIHRoaXMuJCQoZWxtKS5jc3MoJ2Rpc3BsYXknKSA9PSAnbm9uZSc7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFJldHVybnMgYSB1bmlxdWUgaWQuIFRoaXMgY2FuIGJlIHVzZWZ1bCB3aGVuIGdlbmVyYXRpbmcgZWxlbWVudHMgb24gdGhlIGZseS5cblx0XHQgKiBUaGlzIG1ldGhvZCB3aWxsIG5vdCBjaGVjayBpZiB0aGUgZWxlbWVudCBhbHJlYWR5IGV4aXN0cy5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgdW5pcXVlSWRcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gcHJlZml4IE9wdGlvbmFsIHByZWZpeCB0byBhZGQgaW4gZnJvbnQgb2YgYWxsIGlkcyAtIGRlZmF1bHRzIHRvIFwibWNlX1wiLlxuXHRcdCAqIEByZXR1cm4ge1N0cmluZ30gVW5pcXVlIGlkLlxuXHRcdCAqL1xuXHRcdHVuaXF1ZUlkOiBmdW5jdGlvbihwcmVmaXgpIHtcblx0XHRcdHJldHVybiAoIXByZWZpeCA/ICdtY2VfJyA6IHByZWZpeCkgKyAodGhpcy5jb3VudGVyKyspO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBTZXRzIHRoZSBzcGVjaWZpZWQgSFRNTCBjb250ZW50IGluc2lkZSB0aGUgZWxlbWVudCBvciBlbGVtZW50cy4gVGhlIEhUTUwgd2lsbCBmaXJzdCBiZSBwcm9jZXNzZWQuIFRoaXMgbWVhbnNcblx0XHQgKiBVUkxzIHdpbGwgZ2V0IGNvbnZlcnRlZCwgaGV4IGNvbG9yIHZhbHVlcyBmaXhlZCBldGMuIENoZWNrIHByb2Nlc3NIVE1MIGZvciBkZXRhaWxzLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBzZXRIVE1MXG5cdFx0ICogQHBhcmFtIHtFbGVtZW50L1N0cmluZy9BcnJheX0gZWxtIERPTSBlbGVtZW50LCBlbGVtZW50IGlkIHN0cmluZyBvciBhcnJheSBvZiBlbGVtZW50cy9pZHMgdG8gc2V0IEhUTUwgaW5zaWRlIG9mLlxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBodG1sIEhUTUwgY29udGVudCB0byBzZXQgYXMgaW5uZXIgSFRNTCBvZiB0aGUgZWxlbWVudC5cblx0XHQgKiBAZXhhbXBsZVxuXHRcdCAqIC8vIFNldHMgdGhlIGlubmVyIEhUTUwgb2YgYWxsIHBhcmFncmFwaHMgaW4gdGhlIGFjdGl2ZSBlZGl0b3Jcblx0XHQgKiB0aW55bWNlLmFjdGl2ZUVkaXRvci5kb20uc2V0SFRNTCh0aW55bWNlLmFjdGl2ZUVkaXRvci5kb20uc2VsZWN0KCdwJyksICdzb21lIGlubmVyIGh0bWwnKTtcblx0XHQgKlxuXHRcdCAqIC8vIFNldHMgdGhlIGlubmVyIEhUTUwgb2YgYW4gZWxlbWVudCBieSBpZCBpbiB0aGUgZG9jdW1lbnRcblx0XHQgKiB0aW55bWNlLkRPTS5zZXRIVE1MKCdteWRpdicsICdzb21lIGlubmVyIGh0bWwnKTtcblx0XHQgKi9cblx0XHRzZXRIVE1MOiBmdW5jdGlvbihlbG0sIGh0bWwpIHtcblx0XHRcdGVsbSA9IHRoaXMuJCQoZWxtKTtcblxuXHRcdFx0aWYgKGlzSUUpIHtcblx0XHRcdFx0ZWxtLmVhY2goZnVuY3Rpb24oaSwgdGFyZ2V0KSB7XG5cdFx0XHRcdFx0aWYgKHRhcmdldC5jYW5IYXZlSFRNTCA9PT0gZmFsc2UpIHtcblx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHQvLyBSZW1vdmUgYWxsIGNoaWxkIG5vZGVzLCBJRSBrZWVwcyBlbXB0eSB0ZXh0IG5vZGVzIGluIERPTVxuXHRcdFx0XHRcdHdoaWxlICh0YXJnZXQuZmlyc3RDaGlsZCkge1xuXHRcdFx0XHRcdFx0dGFyZ2V0LnJlbW92ZUNoaWxkKHRhcmdldC5maXJzdENoaWxkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHR0cnkge1xuXHRcdFx0XHRcdFx0Ly8gSUUgd2lsbCByZW1vdmUgY29tbWVudHMgZnJvbSB0aGUgYmVnaW5uaW5nXG5cdFx0XHRcdFx0XHQvLyB1bmxlc3MgeW91IHBhZGQgdGhlIGNvbnRlbnRzIHdpdGggc29tZXRoaW5nXG5cdFx0XHRcdFx0XHR0YXJnZXQuaW5uZXJIVE1MID0gJzxicj4nICsgaHRtbDtcblx0XHRcdFx0XHRcdHRhcmdldC5yZW1vdmVDaGlsZCh0YXJnZXQuZmlyc3RDaGlsZCk7XG5cdFx0XHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0XHRcdC8vIElFIHNvbWV0aW1lcyBwcm9kdWNlcyBhbiB1bmtub3duIHJ1bnRpbWUgZXJyb3Igb24gaW5uZXJIVE1MIGlmIGl0J3MgYSBkaXYgaW5zaWRlIGEgcFxuXHRcdFx0XHRcdFx0JCgnPGRpdj48L2Rpdj4nKS5odG1sKCc8YnI+JyArIGh0bWwpLmNvbnRlbnRzKCkuc2xpY2UoMSkuYXBwZW5kVG8odGFyZ2V0KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gaHRtbDtcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRlbG0uaHRtbChodG1sKTtcblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyB0aGUgb3V0ZXIgSFRNTCBvZiBhbiBlbGVtZW50LlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBnZXRPdXRlckhUTUxcblx0XHQgKiBAcGFyYW0ge1N0cmluZy9FbGVtZW50fSBlbG0gRWxlbWVudCBJRCBvciBlbGVtZW50IG9iamVjdCB0byBnZXQgb3V0ZXIgSFRNTCBmcm9tLlxuXHRcdCAqIEByZXR1cm4ge1N0cmluZ30gT3V0ZXIgSFRNTCBzdHJpbmcuXG5cdFx0ICogQGV4YW1wbGVcblx0XHQgKiB0aW55bWNlLkRPTS5nZXRPdXRlckhUTUwoZWRpdG9yRWxlbWVudCk7XG5cdFx0ICogdGlueW1jZS5hY3RpdmVFZGl0b3IuZ2V0T3V0ZXJIVE1MKHRpbnltY2UuYWN0aXZlRWRpdG9yLmdldEJvZHkoKSk7XG5cdFx0ICovXG5cdFx0Z2V0T3V0ZXJIVE1MOiBmdW5jdGlvbihlbG0pIHtcblx0XHRcdGVsbSA9IHRoaXMuZ2V0KGVsbSk7XG5cblx0XHRcdC8vIE9sZGVyIEZGIGRvZXNuJ3QgaGF2ZSBvdXRlckhUTUwgMy42IGlzIHN0aWxsIHVzZWQgYnkgc29tZSBvcmdhaXphdGlvbnNcblx0XHRcdHJldHVybiBlbG0ubm9kZVR5cGUgPT0gMSAmJiBcIm91dGVySFRNTFwiIGluIGVsbSA/IGVsbS5vdXRlckhUTUwgOiAkKCc8ZGl2PjwvZGl2PicpLmFwcGVuZCgkKGVsbSkuY2xvbmUoKSkuaHRtbCgpO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBTZXRzIHRoZSBzcGVjaWZpZWQgb3V0ZXIgSFRNTCBvbiBhbiBlbGVtZW50IG9yIGVsZW1lbnRzLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBzZXRPdXRlckhUTUxcblx0XHQgKiBAcGFyYW0ge0VsZW1lbnQvU3RyaW5nL0FycmF5fSBlbG0gRE9NIGVsZW1lbnQsIGVsZW1lbnQgaWQgc3RyaW5nIG9yIGFycmF5IG9mIGVsZW1lbnRzL2lkcyB0byBzZXQgb3V0ZXIgSFRNTCBvbi5cblx0XHQgKiBAcGFyYW0ge09iamVjdH0gaHRtbCBIVE1MIGNvZGUgdG8gc2V0IGFzIG91dGVyIHZhbHVlIGZvciB0aGUgZWxlbWVudC5cblx0XHQgKiBAZXhhbXBsZVxuXHRcdCAqIC8vIFNldHMgdGhlIG91dGVyIEhUTUwgb2YgYWxsIHBhcmFncmFwaHMgaW4gdGhlIGFjdGl2ZSBlZGl0b3Jcblx0XHQgKiB0aW55bWNlLmFjdGl2ZUVkaXRvci5kb20uc2V0T3V0ZXJIVE1MKHRpbnltY2UuYWN0aXZlRWRpdG9yLmRvbS5zZWxlY3QoJ3AnKSwgJzxkaXY+c29tZSBodG1sPC9kaXY+Jyk7XG5cdFx0ICpcblx0XHQgKiAvLyBTZXRzIHRoZSBvdXRlciBIVE1MIG9mIGFuIGVsZW1lbnQgYnkgaWQgaW4gdGhlIGRvY3VtZW50XG5cdFx0ICogdGlueW1jZS5ET00uc2V0T3V0ZXJIVE1MKCdteWRpdicsICc8ZGl2PnNvbWUgaHRtbDwvZGl2PicpO1xuXHRcdCAqL1xuXHRcdHNldE91dGVySFRNTDogZnVuY3Rpb24oZWxtLCBodG1sKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdHNlbGYuJCQoZWxtKS5lYWNoKGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0cnkge1xuXHRcdFx0XHRcdC8vIE9sZGVyIEZGIGRvZXNuJ3QgaGF2ZSBvdXRlckhUTUwgMy42IGlzIHN0aWxsIHVzZWQgYnkgc29tZSBvcmdhbml6YXRpb25zXG5cdFx0XHRcdFx0aWYgKFwib3V0ZXJIVE1MXCIgaW4gdGhpcykge1xuXHRcdFx0XHRcdFx0dGhpcy5vdXRlckhUTUwgPSBodG1sO1xuXHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0XHQvLyBJZ25vcmVcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIE91dGVySFRNTCBmb3IgSUUgaXQgc29tZXRpbWVzIHByb2R1Y2VzIGFuIFwidW5rbm93biBydW50aW1lIGVycm9yXCJcblx0XHRcdFx0c2VsZi5yZW1vdmUoJCh0aGlzKS5odG1sKGh0bWwpLCB0cnVlKTtcblx0XHRcdH0pO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBFbnRpdHkgZGVjb2RlcyBhIHN0cmluZy4gVGhpcyBtZXRob2QgZGVjb2RlcyBhbnkgSFRNTCBlbnRpdGllcywgc3VjaCBhcyAmYXJpbmc7LlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBkZWNvZGVcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gcyBTdHJpbmcgdG8gZGVjb2RlIGVudGl0aWVzIG9uLlxuXHRcdCAqIEByZXR1cm4ge1N0cmluZ30gRW50aXR5IGRlY29kZWQgc3RyaW5nLlxuXHRcdCAqL1xuXHRcdGRlY29kZTogRW50aXRpZXMuZGVjb2RlLFxuXG5cdFx0LyoqXG5cdFx0ICogRW50aXR5IGVuY29kZXMgYSBzdHJpbmcuIFRoaXMgbWV0aG9kIGVuY29kZXMgdGhlIG1vc3QgY29tbW9uIGVudGl0aWVzLCBzdWNoIGFzIDw+XCImLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBlbmNvZGVcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gdGV4dCBTdHJpbmcgdG8gZW5jb2RlIHdpdGggZW50aXRpZXMuXG5cdFx0ICogQHJldHVybiB7U3RyaW5nfSBFbnRpdHkgZW5jb2RlZCBzdHJpbmcuXG5cdFx0ICovXG5cdFx0ZW5jb2RlOiBFbnRpdGllcy5lbmNvZGVBbGxSYXcsXG5cblx0XHQvKipcblx0XHQgKiBJbnNlcnRzIGFuIGVsZW1lbnQgYWZ0ZXIgdGhlIHJlZmVyZW5jZSBlbGVtZW50LlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBpbnNlcnRBZnRlclxuXHRcdCAqIEBwYXJhbSB7RWxlbWVudH0gbm9kZSBFbGVtZW50IHRvIGluc2VydCBhZnRlciB0aGUgcmVmZXJlbmNlLlxuXHRcdCAqIEBwYXJhbSB7RWxlbWVudC9TdHJpbmcvQXJyYXl9IHJlZmVyZW5jZU5vZGUgUmVmZXJlbmNlIGVsZW1lbnQsIGVsZW1lbnQgaWQgb3IgYXJyYXkgb2YgZWxlbWVudHMgdG8gaW5zZXJ0IGFmdGVyLlxuXHRcdCAqIEByZXR1cm4ge0VsZW1lbnQvQXJyYXl9IEVsZW1lbnQgdGhhdCBnb3QgYWRkZWQgb3IgYW4gYXJyYXkgd2l0aCBlbGVtZW50cy5cblx0XHQgKi9cblx0XHRpbnNlcnRBZnRlcjogZnVuY3Rpb24obm9kZSwgcmVmZXJlbmNlTm9kZSkge1xuXHRcdFx0cmVmZXJlbmNlTm9kZSA9IHRoaXMuZ2V0KHJlZmVyZW5jZU5vZGUpO1xuXG5cdFx0XHRyZXR1cm4gdGhpcy5ydW4obm9kZSwgZnVuY3Rpb24obm9kZSkge1xuXHRcdFx0XHR2YXIgcGFyZW50LCBuZXh0U2libGluZztcblxuXHRcdFx0XHRwYXJlbnQgPSByZWZlcmVuY2VOb2RlLnBhcmVudE5vZGU7XG5cdFx0XHRcdG5leHRTaWJsaW5nID0gcmVmZXJlbmNlTm9kZS5uZXh0U2libGluZztcblxuXHRcdFx0XHRpZiAobmV4dFNpYmxpbmcpIHtcblx0XHRcdFx0XHRwYXJlbnQuaW5zZXJ0QmVmb3JlKG5vZGUsIG5leHRTaWJsaW5nKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRwYXJlbnQuYXBwZW5kQ2hpbGQobm9kZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbm9kZTtcblx0XHRcdH0pO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZXBsYWNlcyB0aGUgc3BlY2lmaWVkIGVsZW1lbnQgb3IgZWxlbWVudHMgd2l0aCB0aGUgbmV3IGVsZW1lbnQgc3BlY2lmaWVkLiBUaGUgbmV3IGVsZW1lbnQgd2lsbFxuXHRcdCAqIGJlIGNsb25lZCBpZiBtdWx0aXBsZSBpbnB1dCBlbGVtZW50cyBhcmUgcGFzc2VkIGluLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCByZXBsYWNlXG5cdFx0ICogQHBhcmFtIHtFbGVtZW50fSBuZXdFbG0gTmV3IGVsZW1lbnQgdG8gcmVwbGFjZSBvbGQgb25lcyB3aXRoLlxuXHRcdCAqIEBwYXJhbSB7RWxlbWVudC9TdHJpbmcvQXJyYXl9IG9sZEVsbSBFbGVtZW50IERPTSBub2RlLCBlbGVtZW50IGlkIG9yIGFycmF5IG9mIGVsZW1lbnRzIG9yIGlkcyB0byByZXBsYWNlLlxuXHRcdCAqIEBwYXJhbSB7Qm9vbGVhbn0ga2VlcENoaWxkcmVuIE9wdGlvbmFsIGtlZXAgY2hpbGRyZW4gc3RhdGUsIGlmIHNldCB0byB0cnVlIGNoaWxkIG5vZGVzIGZyb20gdGhlIG9sZCBvYmplY3Qgd2lsbCBiZSBhZGRlZFxuXHRcdCAqIHRvIG5ldyBvbmVzLlxuXHRcdCAqL1xuXHRcdHJlcGxhY2U6IGZ1bmN0aW9uKG5ld0VsbSwgb2xkRWxtLCBrZWVwQ2hpbGRyZW4pIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0cmV0dXJuIHNlbGYucnVuKG9sZEVsbSwgZnVuY3Rpb24ob2xkRWxtKSB7XG5cdFx0XHRcdGlmIChpcyhvbGRFbG0sICdhcnJheScpKSB7XG5cdFx0XHRcdFx0bmV3RWxtID0gbmV3RWxtLmNsb25lTm9kZSh0cnVlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChrZWVwQ2hpbGRyZW4pIHtcblx0XHRcdFx0XHRlYWNoKGdyZXAob2xkRWxtLmNoaWxkTm9kZXMpLCBmdW5jdGlvbihub2RlKSB7XG5cdFx0XHRcdFx0XHRuZXdFbG0uYXBwZW5kQ2hpbGQobm9kZSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gb2xkRWxtLnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKG5ld0VsbSwgb2xkRWxtKTtcblx0XHRcdH0pO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZW5hbWVzIHRoZSBzcGVjaWZpZWQgZWxlbWVudCBhbmQga2VlcHMgaXRzIGF0dHJpYnV0ZXMgYW5kIGNoaWxkcmVuLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCByZW5hbWVcblx0XHQgKiBAcGFyYW0ge0VsZW1lbnR9IGVsbSBFbGVtZW50IHRvIHJlbmFtZS5cblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSBOYW1lIG9mIHRoZSBuZXcgZWxlbWVudC5cblx0XHQgKiBAcmV0dXJuIHtFbGVtZW50fSBOZXcgZWxlbWVudCBvciB0aGUgb2xkIGVsZW1lbnQgaWYgaXQgbmVlZGVkIHJlbmFtaW5nLlxuXHRcdCAqL1xuXHRcdHJlbmFtZTogZnVuY3Rpb24oZWxtLCBuYW1lKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIG5ld0VsbTtcblxuXHRcdFx0aWYgKGVsbS5ub2RlTmFtZSAhPSBuYW1lLnRvVXBwZXJDYXNlKCkpIHtcblx0XHRcdFx0Ly8gUmVuYW1lIGJsb2NrIGVsZW1lbnRcblx0XHRcdFx0bmV3RWxtID0gc2VsZi5jcmVhdGUobmFtZSk7XG5cblx0XHRcdFx0Ly8gQ29weSBhdHRyaWJzIHRvIG5ldyBibG9ja1xuXHRcdFx0XHRlYWNoKHNlbGYuZ2V0QXR0cmlicyhlbG0pLCBmdW5jdGlvbihhdHRyTm9kZSkge1xuXHRcdFx0XHRcdHNlbGYuc2V0QXR0cmliKG5ld0VsbSwgYXR0ck5vZGUubm9kZU5hbWUsIHNlbGYuZ2V0QXR0cmliKGVsbSwgYXR0ck5vZGUubm9kZU5hbWUpKTtcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0Ly8gUmVwbGFjZSBibG9ja1xuXHRcdFx0XHRzZWxmLnJlcGxhY2UobmV3RWxtLCBlbG0sIDEpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbmV3RWxtIHx8IGVsbTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogRmluZCB0aGUgY29tbW9uIGFuY2VzdG9yIG9mIHR3byBlbGVtZW50cy4gVGhpcyBpcyBhIHNob3J0ZXIgbWV0aG9kIHRoYW4gdXNpbmcgdGhlIERPTSBSYW5nZSBsb2dpYy5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgZmluZENvbW1vbkFuY2VzdG9yXG5cdFx0ICogQHBhcmFtIHtFbGVtZW50fSBhIEVsZW1lbnQgdG8gZmluZCBjb21tb24gYW5jZXN0b3Igb2YuXG5cdFx0ICogQHBhcmFtIHtFbGVtZW50fSBiIEVsZW1lbnQgdG8gZmluZCBjb21tb24gYW5jZXN0b3Igb2YuXG5cdFx0ICogQHJldHVybiB7RWxlbWVudH0gQ29tbW9uIGFuY2VzdG9yIGVsZW1lbnQgb2YgdGhlIHR3byBpbnB1dCBlbGVtZW50cy5cblx0XHQgKi9cblx0XHRmaW5kQ29tbW9uQW5jZXN0b3I6IGZ1bmN0aW9uKGEsIGIpIHtcblx0XHRcdHZhciBwcyA9IGEsIHBlO1xuXG5cdFx0XHR3aGlsZSAocHMpIHtcblx0XHRcdFx0cGUgPSBiO1xuXG5cdFx0XHRcdHdoaWxlIChwZSAmJiBwcyAhPSBwZSkge1xuXHRcdFx0XHRcdHBlID0gcGUucGFyZW50Tm9kZTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChwcyA9PSBwZSkge1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cHMgPSBwcy5wYXJlbnROb2RlO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoIXBzICYmIGEub3duZXJEb2N1bWVudCkge1xuXHRcdFx0XHRyZXR1cm4gYS5vd25lckRvY3VtZW50LmRvY3VtZW50RWxlbWVudDtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHBzO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBQYXJzZXMgdGhlIHNwZWNpZmllZCBSR0IgY29sb3IgdmFsdWUgYW5kIHJldHVybnMgYSBoZXggdmVyc2lvbiBvZiB0aGF0IGNvbG9yLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCB0b0hleFxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSByZ2JWYWwgUkdCIHN0cmluZyB2YWx1ZSBsaWtlIHJnYigxLDIsMylcblx0XHQgKiBAcmV0dXJuIHtTdHJpbmd9IEhleCB2ZXJzaW9uIG9mIHRoYXQgUkdCIHZhbHVlIGxpa2UgI0ZGMDBGRi5cblx0XHQgKi9cblx0XHR0b0hleDogZnVuY3Rpb24ocmdiVmFsKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5zdHlsZXMudG9IZXgoVG9vbHMudHJpbShyZ2JWYWwpKTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogRXhlY3V0ZXMgdGhlIHNwZWNpZmllZCBmdW5jdGlvbiBvbiB0aGUgZWxlbWVudCBieSBpZCBvciBkb20gZWxlbWVudCBub2RlIG9yIGFycmF5IG9mIGVsZW1lbnRzL2lkLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBydW5cblx0XHQgKiBAcGFyYW0ge1N0cmluZy9FbGVtZW50L0FycmF5fSBlbG0gSUQgb3IgRE9NIGVsZW1lbnQgb2JqZWN0IG9yIGFycmF5IHdpdGggaWRzIG9yIGVsZW1lbnRzLlxuXHRcdCAqIEBwYXJhbSB7ZnVuY3Rpb259IGZ1bmMgRnVuY3Rpb24gdG8gZXhlY3V0ZSBmb3IgZWFjaCBpdGVtLlxuXHRcdCAqIEBwYXJhbSB7T2JqZWN0fSBzY29wZSBPcHRpb25hbCBzY29wZSB0byBleGVjdXRlIHRoZSBmdW5jdGlvbiBpbi5cblx0XHQgKiBAcmV0dXJuIHtPYmplY3QvQXJyYXl9IFNpbmdsZSBvYmplY3QsIG9yIGFuIGFycmF5IG9mIG9iamVjdHMgaWYgbXVsdGlwbGUgaW5wdXQgZWxlbWVudHMgd2VyZSBwYXNzZWQgaW4uXG5cdFx0ICovXG5cdFx0cnVuOiBmdW5jdGlvbihlbG0sIGZ1bmMsIHNjb3BlKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIHJlc3VsdDtcblxuXHRcdFx0aWYgKHR5cGVvZiBlbG0gPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRcdGVsbSA9IHNlbGYuZ2V0KGVsbSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmICghZWxtKSB7XG5cdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdH1cblxuXHRcdFx0c2NvcGUgPSBzY29wZSB8fCB0aGlzO1xuXHRcdFx0aWYgKCFlbG0ubm9kZVR5cGUgJiYgKGVsbS5sZW5ndGggfHwgZWxtLmxlbmd0aCA9PT0gMCkpIHtcblx0XHRcdFx0cmVzdWx0ID0gW107XG5cblx0XHRcdFx0ZWFjaChlbG0sIGZ1bmN0aW9uKGVsbSwgaSkge1xuXHRcdFx0XHRcdGlmIChlbG0pIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YgZWxtID09ICdzdHJpbmcnKSB7XG5cdFx0XHRcdFx0XHRcdGVsbSA9IHNlbGYuZ2V0KGVsbSk7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJlc3VsdC5wdXNoKGZ1bmMuY2FsbChzY29wZSwgZWxtLCBpKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHRyZXR1cm4gcmVzdWx0O1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gZnVuYy5jYWxsKHNjb3BlLCBlbG0pO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZXR1cm5zIGEgTm9kZUxpc3Qgd2l0aCBhdHRyaWJ1dGVzIGZvciB0aGUgZWxlbWVudC5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgZ2V0QXR0cmlic1xuXHRcdCAqIEBwYXJhbSB7SFRNTEVsZW1lbnQvc3RyaW5nfSBlbG0gRWxlbWVudCBub2RlIG9yIHN0cmluZyBpZCB0byBnZXQgYXR0cmlidXRlcyBmcm9tLlxuXHRcdCAqIEByZXR1cm4ge05vZGVMaXN0fSBOb2RlTGlzdCB3aXRoIGF0dHJpYnV0ZXMuXG5cdFx0ICovXG5cdFx0Z2V0QXR0cmliczogZnVuY3Rpb24oZWxtKSB7XG5cdFx0XHR2YXIgYXR0cnM7XG5cblx0XHRcdGVsbSA9IHRoaXMuZ2V0KGVsbSk7XG5cblx0XHRcdGlmICghZWxtKSB7XG5cdFx0XHRcdHJldHVybiBbXTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGlzSUUpIHtcblx0XHRcdFx0YXR0cnMgPSBbXTtcblxuXHRcdFx0XHQvLyBPYmplY3Qgd2lsbCB0aHJvdyBleGNlcHRpb24gaW4gSUVcblx0XHRcdFx0aWYgKGVsbS5ub2RlTmFtZSA9PSAnT0JKRUNUJykge1xuXHRcdFx0XHRcdHJldHVybiBlbG0uYXR0cmlidXRlcztcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIElFIGRvZXNuJ3Qga2VlcCB0aGUgc2VsZWN0ZWQgYXR0cmlidXRlIGlmIHlvdSBjbG9uZSBvcHRpb24gZWxlbWVudHNcblx0XHRcdFx0aWYgKGVsbS5ub2RlTmFtZSA9PT0gJ09QVElPTicgJiYgdGhpcy5nZXRBdHRyaWIoZWxtLCAnc2VsZWN0ZWQnKSkge1xuXHRcdFx0XHRcdGF0dHJzLnB1c2goe3NwZWNpZmllZDogMSwgbm9kZU5hbWU6ICdzZWxlY3RlZCd9KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIEl0J3MgY3JhenkgdGhhdCB0aGlzIGlzIGZhc3RlciBpbiBJRSBidXQgaXQncyBiZWNhdXNlIGl0IHJldHVybnMgYWxsIGF0dHJpYnV0ZXMgYWxsIHRoZSB0aW1lXG5cdFx0XHRcdHZhciBhdHRyUmVnRXhwID0gLzxcXC8/W1xcdzpcXC1dKyA/fD1bXFxcIl1bXlxcXCJdK1xcXCJ8PVxcJ1teXFwnXStcXCd8PVtcXHdcXC1dK3w+L2dpO1xuXHRcdFx0XHRlbG0uY2xvbmVOb2RlKGZhbHNlKS5vdXRlckhUTUwucmVwbGFjZShhdHRyUmVnRXhwLCAnJykucmVwbGFjZSgvW1xcdzpcXC1dKy9naSwgZnVuY3Rpb24oYSkge1xuXHRcdFx0XHRcdGF0dHJzLnB1c2goe3NwZWNpZmllZDogMSwgbm9kZU5hbWU6IGF9KTtcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0cmV0dXJuIGF0dHJzO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gZWxtLmF0dHJpYnV0ZXM7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFJldHVybnMgdHJ1ZS9mYWxzZSBpZiB0aGUgc3BlY2lmaWVkIG5vZGUgaXMgdG8gYmUgY29uc2lkZXJlZCBlbXB0eSBvciBub3QuXG5cdFx0ICpcblx0XHQgKiBAZXhhbXBsZVxuXHRcdCAqIHRpbnltY2UuRE9NLmlzRW1wdHkobm9kZSwge2ltZzogdHJ1ZX0pO1xuXHRcdCAqIEBtZXRob2QgaXNFbXB0eVxuXHRcdCAqIEBwYXJhbSB7T2JqZWN0fSBlbGVtZW50cyBPcHRpb25hbCBuYW1lL3ZhbHVlIG9iamVjdCB3aXRoIGVsZW1lbnRzIHRoYXQgYXJlIGF1dG9tYXRpY2FsbHkgdHJlYXRlZCBhcyBub24tZW1wdHkgZWxlbWVudHMuXG5cdFx0ICogQHJldHVybiB7Qm9vbGVhbn0gdHJ1ZS9mYWxzZSBpZiB0aGUgbm9kZSBpcyBlbXB0eSBvciBub3QuXG5cdFx0ICovXG5cdFx0aXNFbXB0eTogZnVuY3Rpb24obm9kZSwgZWxlbWVudHMpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgaSwgYXR0cmlidXRlcywgdHlwZSwgd2Fsa2VyLCBuYW1lLCBickNvdW50ID0gMDtcblxuXHRcdFx0bm9kZSA9IG5vZGUuZmlyc3RDaGlsZDtcblx0XHRcdGlmIChub2RlKSB7XG5cdFx0XHRcdHdhbGtlciA9IG5ldyBUcmVlV2Fsa2VyKG5vZGUsIG5vZGUucGFyZW50Tm9kZSk7XG5cdFx0XHRcdGVsZW1lbnRzID0gZWxlbWVudHMgfHwgKHNlbGYuc2NoZW1hID8gc2VsZi5zY2hlbWEuZ2V0Tm9uRW1wdHlFbGVtZW50cygpIDogbnVsbCk7XG5cblx0XHRcdFx0ZG8ge1xuXHRcdFx0XHRcdHR5cGUgPSBub2RlLm5vZGVUeXBlO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGUgPT09IDEpIHtcblx0XHRcdFx0XHRcdC8vIElnbm9yZSBib2d1cyBlbGVtZW50c1xuXHRcdFx0XHRcdFx0dmFyIGJvZ3VzVmFsID0gbm9kZS5nZXRBdHRyaWJ1dGUoJ2RhdGEtbWNlLWJvZ3VzJyk7XG5cdFx0XHRcdFx0XHRpZiAoYm9ndXNWYWwpIHtcblx0XHRcdFx0XHRcdFx0bm9kZSA9IHdhbGtlci5uZXh0KGJvZ3VzVmFsID09PSAnYWxsJyk7XG5cdFx0XHRcdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHQvLyBLZWVwIGVtcHR5IGVsZW1lbnRzIGxpa2UgPGltZyAvPlxuXHRcdFx0XHRcdFx0bmFtZSA9IG5vZGUubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0XHRcdGlmIChlbGVtZW50cyAmJiBlbGVtZW50c1tuYW1lXSkge1xuXHRcdFx0XHRcdFx0XHQvLyBJZ25vcmUgc2luZ2xlIEJSIGVsZW1lbnRzIGluIGJsb2NrcyBsaWtlIDxwPjxiciAvPjwvcD4gb3IgPHA+PHNwYW4+PGJyIC8+PC9zcGFuPjwvcD5cblx0XHRcdFx0XHRcdFx0aWYgKG5hbWUgPT09ICdicicpIHtcblx0XHRcdFx0XHRcdFx0XHRickNvdW50Kys7XG5cdFx0XHRcdFx0XHRcdFx0bm9kZSA9IHdhbGtlci5uZXh0KCk7XG5cdFx0XHRcdFx0XHRcdFx0Y29udGludWU7XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdC8vIEtlZXAgZWxlbWVudHMgd2l0aCBkYXRhLWJvb2ttYXJrIGF0dHJpYnV0ZXMgb3IgbmFtZSBhdHRyaWJ1dGUgbGlrZSA8YSBuYW1lPVwiMVwiPjwvYT5cblx0XHRcdFx0XHRcdGF0dHJpYnV0ZXMgPSBzZWxmLmdldEF0dHJpYnMobm9kZSk7XG5cdFx0XHRcdFx0XHRpID0gYXR0cmlidXRlcy5sZW5ndGg7XG5cdFx0XHRcdFx0XHR3aGlsZSAoaS0tKSB7XG5cdFx0XHRcdFx0XHRcdG5hbWUgPSBhdHRyaWJ1dGVzW2ldLm5vZGVOYW1lO1xuXHRcdFx0XHRcdFx0XHRpZiAobmFtZSA9PT0gXCJuYW1lXCIgfHwgbmFtZSA9PT0gJ2RhdGEtbWNlLWJvb2ttYXJrJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdC8vIEtlZXAgY29tbWVudCBub2Rlc1xuXHRcdFx0XHRcdGlmICh0eXBlID09IDgpIHtcblx0XHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHQvLyBLZWVwIG5vbiB3aGl0ZXNwYWNlIHRleHQgbm9kZXNcblx0XHRcdFx0XHRpZiAoKHR5cGUgPT09IDMgJiYgIXdoaXRlU3BhY2VSZWdFeHAudGVzdChub2RlLm5vZGVWYWx1ZSkpKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0bm9kZSA9IHdhbGtlci5uZXh0KCk7XG5cdFx0XHRcdH0gd2hpbGUgKG5vZGUpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gYnJDb3VudCA8PSAxO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBDcmVhdGVzIGEgbmV3IERPTSBSYW5nZSBvYmplY3QuIFRoaXMgd2lsbCB1c2UgdGhlIG5hdGl2ZSBET00gUmFuZ2UgQVBJIGlmIGl0J3Ncblx0XHQgKiBhdmFpbGFibGUuIElmIGl0J3Mgbm90LCBpdCB3aWxsIGZhbGwgYmFjayB0byB0aGUgY3VzdG9tIFRpbnlNQ0UgaW1wbGVtZW50YXRpb24uXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGNyZWF0ZVJuZ1xuXHRcdCAqIEByZXR1cm4ge0RPTVJhbmdlfSBET00gUmFuZ2Ugb2JqZWN0LlxuXHRcdCAqIEBleGFtcGxlXG5cdFx0ICogdmFyIHJuZyA9IHRpbnltY2UuRE9NLmNyZWF0ZVJuZygpO1xuXHRcdCAqIGFsZXJ0KHJuZy5zdGFydENvbnRhaW5lciArIFwiLFwiICsgcm5nLnN0YXJ0T2Zmc2V0KTtcblx0XHQgKi9cblx0XHRjcmVhdGVSbmc6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIGRvYyA9IHRoaXMuZG9jO1xuXG5cdFx0XHRyZXR1cm4gZG9jLmNyZWF0ZVJhbmdlID8gZG9jLmNyZWF0ZVJhbmdlKCkgOiBuZXcgUmFuZ2UodGhpcyk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFJldHVybnMgdGhlIGluZGV4IG9mIHRoZSBzcGVjaWZpZWQgbm9kZSB3aXRoaW4gaXRzIHBhcmVudC5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2Qgbm9kZUluZGV4XG5cdFx0ICogQHBhcmFtIHtOb2RlfSBub2RlIE5vZGUgdG8gbG9vayBmb3IuXG5cdFx0ICogQHBhcmFtIHtib29sZWFufSBub3JtYWxpemVkIE9wdGlvbmFsIHRydWUvZmFsc2Ugc3RhdGUgaWYgdGhlIGluZGV4IGlzIHdoYXQgaXQgd291bGQgYmUgYWZ0ZXIgYSBub3JtYWxpemF0aW9uLlxuXHRcdCAqIEByZXR1cm4ge051bWJlcn0gSW5kZXggb2YgdGhlIHNwZWNpZmllZCBub2RlLlxuXHRcdCAqL1xuXHRcdG5vZGVJbmRleDogbm9kZUluZGV4LFxuXG5cdFx0LyoqXG5cdFx0ICogU3BsaXRzIGFuIGVsZW1lbnQgaW50byB0d28gbmV3IGVsZW1lbnRzIGFuZCBwbGFjZXMgdGhlIHNwZWNpZmllZCBzcGxpdFxuXHRcdCAqIGVsZW1lbnQgb3IgZWxlbWVudHMgYmV0d2VlbiB0aGUgbmV3IG9uZXMuIEZvciBleGFtcGxlIHNwbGl0dGluZyB0aGUgcGFyYWdyYXBoIGF0IHRoZSBib2xkIGVsZW1lbnQgaW5cblx0XHQgKiB0aGlzIGV4YW1wbGUgPHA+YWJjPGI+YWJjPC9iPjEyMzwvcD4gd291bGQgcHJvZHVjZSA8cD5hYmM8L3A+PGI+YWJjPC9iPjxwPjEyMzwvcD4uXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHNwbGl0XG5cdFx0ICogQHBhcmFtIHtFbGVtZW50fSBwYXJlbnRFbG0gUGFyZW50IGVsZW1lbnQgdG8gc3BsaXQuXG5cdFx0ICogQHBhcmFtIHtFbGVtZW50fSBzcGxpdEVsbSBFbGVtZW50IHRvIHNwbGl0IGF0LlxuXHRcdCAqIEBwYXJhbSB7RWxlbWVudH0gcmVwbGFjZW1lbnRFbG0gT3B0aW9uYWwgcmVwbGFjZW1lbnQgZWxlbWVudCB0byByZXBsYWNlIHRoZSBzcGxpdCBlbGVtZW50IHdpdGguXG5cdFx0ICogQHJldHVybiB7RWxlbWVudH0gUmV0dXJucyB0aGUgc3BsaXQgZWxlbWVudCBvciB0aGUgcmVwbGFjZW1lbnQgZWxlbWVudCBpZiB0aGF0IGlzIHNwZWNpZmllZC5cblx0XHQgKi9cblx0XHRzcGxpdDogZnVuY3Rpb24ocGFyZW50RWxtLCBzcGxpdEVsbSwgcmVwbGFjZW1lbnRFbG0pIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgciA9IHNlbGYuY3JlYXRlUm5nKCksIGJlZiwgYWZ0LCBwYTtcblxuXHRcdFx0Ly8gVzNDIHZhbGlkIGJyb3dzZXJzIHRlbmQgdG8gbGVhdmUgZW1wdHkgbm9kZXMgdG8gdGhlIGxlZnQvcmlnaHQgc2lkZSBvZiB0aGUgY29udGVudHMgLSB0aGlzIG1ha2VzIHNlbnNlXG5cdFx0XHQvLyBidXQgd2UgZG9uJ3Qgd2FudCB0aGF0IGluIG91ciBjb2RlIHNpbmNlIGl0IHNlcnZlcyBubyBwdXJwb3NlIGZvciB0aGUgZW5kIHVzZXJcblx0XHRcdC8vIEZvciBleGFtcGxlIHNwbGl0dGluZyB0aGlzIGh0bWwgYXQgdGhlIGJvbGQgZWxlbWVudDpcblx0XHRcdC8vICAgPHA+dGV4dCAxPHNwYW4+PGI+Q0hPUDwvYj48L3NwYW4+dGV4dCAyPC9wPlxuXHRcdFx0Ly8gd291bGQgcHJvZHVjZTpcblx0XHRcdC8vICAgPHA+dGV4dCAxPHNwYW4+PC9zcGFuPjwvcD48Yj5DSE9QPC9iPjxwPjxzcGFuPjwvc3Bhbj50ZXh0IDI8L3A+XG5cdFx0XHQvLyB0aGlzIGZ1bmN0aW9uIHdpbGwgdGhlbiB0cmltIG9mZiBlbXB0eSBlZGdlcyBhbmQgcHJvZHVjZTpcblx0XHRcdC8vICAgPHA+dGV4dCAxPC9wPjxiPkNIT1A8L2I+PHA+dGV4dCAyPC9wPlxuXHRcdFx0ZnVuY3Rpb24gdHJpbU5vZGUobm9kZSkge1xuXHRcdFx0XHR2YXIgaSwgY2hpbGRyZW4gPSBub2RlLmNoaWxkTm9kZXMsIHR5cGUgPSBub2RlLm5vZGVUeXBlO1xuXG5cdFx0XHRcdGZ1bmN0aW9uIHN1cnJvdW5kZWRCeVNwYW5zKG5vZGUpIHtcblx0XHRcdFx0XHR2YXIgcHJldmlvdXNJc1NwYW4gPSBub2RlLnByZXZpb3VzU2libGluZyAmJiBub2RlLnByZXZpb3VzU2libGluZy5ub2RlTmFtZSA9PSAnU1BBTic7XG5cdFx0XHRcdFx0dmFyIG5leHRJc1NwYW4gPSBub2RlLm5leHRTaWJsaW5nICYmIG5vZGUubmV4dFNpYmxpbmcubm9kZU5hbWUgPT0gJ1NQQU4nO1xuXHRcdFx0XHRcdHJldHVybiBwcmV2aW91c0lzU3BhbiAmJiBuZXh0SXNTcGFuO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHR5cGUgPT0gMSAmJiBub2RlLmdldEF0dHJpYnV0ZSgnZGF0YS1tY2UtdHlwZScpID09ICdib29rbWFyaycpIHtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRmb3IgKGkgPSBjaGlsZHJlbi5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuXHRcdFx0XHRcdHRyaW1Ob2RlKGNoaWxkcmVuW2ldKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlICE9IDkpIHtcblx0XHRcdFx0XHQvLyBLZWVwIG5vbiB3aGl0ZXNwYWNlIHRleHQgbm9kZXNcblx0XHRcdFx0XHRpZiAodHlwZSA9PSAzICYmIG5vZGUubm9kZVZhbHVlLmxlbmd0aCA+IDApIHtcblx0XHRcdFx0XHRcdC8vIElmIHBhcmVudCBlbGVtZW50IGlzbid0IGEgYmxvY2sgb3IgdGhlcmUgaXNuJ3QgYW55IHVzZWZ1bCBjb250ZW50cyBmb3IgZXhhbXBsZSBcIjxwPiAgIDwvcD5cIlxuXHRcdFx0XHRcdFx0Ly8gQWxzbyBrZWVwIHRleHQgbm9kZXMgd2l0aCBvbmx5IHNwYWNlcyBpZiBzdXJyb3VuZGVkIGJ5IHNwYW5zLlxuXHRcdFx0XHRcdFx0Ly8gZWcuIFwiPHA+PHNwYW4+YTwvc3Bhbj4gPHNwYW4+Yjwvc3Bhbj48L3A+XCIgc2hvdWxkIGtlZXAgc3BhY2UgYmV0d2VlbiBhIGFuZCBiXG5cdFx0XHRcdFx0XHR2YXIgdHJpbW1lZExlbmd0aCA9IHRyaW0obm9kZS5ub2RlVmFsdWUpLmxlbmd0aDtcblx0XHRcdFx0XHRcdGlmICghc2VsZi5pc0Jsb2NrKG5vZGUucGFyZW50Tm9kZSkgfHwgdHJpbW1lZExlbmd0aCA+IDAgfHwgdHJpbW1lZExlbmd0aCA9PT0gMCAmJiBzdXJyb3VuZGVkQnlTcGFucyhub2RlKSkge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlID09IDEpIHtcblx0XHRcdFx0XHRcdC8vIElmIHRoZSBvbmx5IGNoaWxkIGlzIGEgYm9va21hcmsgdGhlbiBtb3ZlIGl0IHVwXG5cdFx0XHRcdFx0XHRjaGlsZHJlbiA9IG5vZGUuY2hpbGROb2RlcztcblxuXHRcdFx0XHRcdFx0Ly8gVE9ETyBmaXggdGhpcyBjb21wbGV4IGlmXG5cdFx0XHRcdFx0XHRpZiAoY2hpbGRyZW4ubGVuZ3RoID09IDEgJiYgY2hpbGRyZW5bMF0gJiYgY2hpbGRyZW5bMF0ubm9kZVR5cGUgPT0gMSAmJlxuXHRcdFx0XHRcdFx0XHRjaGlsZHJlblswXS5nZXRBdHRyaWJ1dGUoJ2RhdGEtbWNlLXR5cGUnKSA9PSAnYm9va21hcmsnKSB7XG5cdFx0XHRcdFx0XHRcdG5vZGUucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoY2hpbGRyZW5bMF0sIG5vZGUpO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHQvLyBLZWVwIG5vbiBlbXB0eSBlbGVtZW50cyBvciBpbWcsIGhyIGV0Y1xuXHRcdFx0XHRcdFx0aWYgKGNoaWxkcmVuLmxlbmd0aCB8fCAvXihicnxocnxpbnB1dHxpbWcpJC9pLnRlc3Qobm9kZS5ub2RlTmFtZSkpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHNlbGYucmVtb3ZlKG5vZGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG5vZGU7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChwYXJlbnRFbG0gJiYgc3BsaXRFbG0pIHtcblx0XHRcdFx0Ly8gR2V0IGJlZm9yZSBjaHVua1xuXHRcdFx0XHRyLnNldFN0YXJ0KHBhcmVudEVsbS5wYXJlbnROb2RlLCBzZWxmLm5vZGVJbmRleChwYXJlbnRFbG0pKTtcblx0XHRcdFx0ci5zZXRFbmQoc3BsaXRFbG0ucGFyZW50Tm9kZSwgc2VsZi5ub2RlSW5kZXgoc3BsaXRFbG0pKTtcblx0XHRcdFx0YmVmID0gci5leHRyYWN0Q29udGVudHMoKTtcblxuXHRcdFx0XHQvLyBHZXQgYWZ0ZXIgY2h1bmtcblx0XHRcdFx0ciA9IHNlbGYuY3JlYXRlUm5nKCk7XG5cdFx0XHRcdHIuc2V0U3RhcnQoc3BsaXRFbG0ucGFyZW50Tm9kZSwgc2VsZi5ub2RlSW5kZXgoc3BsaXRFbG0pICsgMSk7XG5cdFx0XHRcdHIuc2V0RW5kKHBhcmVudEVsbS5wYXJlbnROb2RlLCBzZWxmLm5vZGVJbmRleChwYXJlbnRFbG0pICsgMSk7XG5cdFx0XHRcdGFmdCA9IHIuZXh0cmFjdENvbnRlbnRzKCk7XG5cblx0XHRcdFx0Ly8gSW5zZXJ0IGJlZm9yZSBjaHVua1xuXHRcdFx0XHRwYSA9IHBhcmVudEVsbS5wYXJlbnROb2RlO1xuXHRcdFx0XHRwYS5pbnNlcnRCZWZvcmUodHJpbU5vZGUoYmVmKSwgcGFyZW50RWxtKTtcblxuXHRcdFx0XHQvLyBJbnNlcnQgbWlkZGxlIGNodW5rXG5cdFx0XHRcdGlmIChyZXBsYWNlbWVudEVsbSkge1xuXHRcdFx0XHRcdHBhLmluc2VydEJlZm9yZShyZXBsYWNlbWVudEVsbSwgcGFyZW50RWxtKTtcblx0XHRcdFx0XHQvL3BhLnJlcGxhY2VDaGlsZChyZXBsYWNlbWVudEVsbSwgc3BsaXRFbG0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHBhLmluc2VydEJlZm9yZShzcGxpdEVsbSwgcGFyZW50RWxtKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIEluc2VydCBhZnRlciBjaHVua1xuXHRcdFx0XHRwYS5pbnNlcnRCZWZvcmUodHJpbU5vZGUoYWZ0KSwgcGFyZW50RWxtKTtcblx0XHRcdFx0c2VsZi5yZW1vdmUocGFyZW50RWxtKTtcblxuXHRcdFx0XHRyZXR1cm4gcmVwbGFjZW1lbnRFbG0gfHwgc3BsaXRFbG07XG5cdFx0XHR9XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIEFkZHMgYW4gZXZlbnQgaGFuZGxlciB0byB0aGUgc3BlY2lmaWVkIG9iamVjdC5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgYmluZFxuXHRcdCAqIEBwYXJhbSB7RWxlbWVudC9Eb2N1bWVudC9XaW5kb3cvQXJyYXl9IHRhcmdldCBUYXJnZXQgZWxlbWVudCB0byBiaW5kIGV2ZW50cyB0by5cblx0XHQgKiBoYW5kbGVyIHRvIG9yIGFuIGFycmF5IG9mIGVsZW1lbnRzL2lkcy9kb2N1bWVudHMuXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IG5hbWUgTmFtZSBvZiBldmVudCBoYW5kbGVyIHRvIGFkZCwgZm9yIGV4YW1wbGU6IGNsaWNrLlxuXHRcdCAqIEBwYXJhbSB7ZnVuY3Rpb259IGZ1bmMgRnVuY3Rpb24gdG8gZXhlY3V0ZSB3aGVuIHRoZSBldmVudCBvY2N1cnMuXG5cdFx0ICogQHBhcmFtIHtPYmplY3R9IHNjb3BlIE9wdGlvbmFsIHNjb3BlIHRvIGV4ZWN1dGUgdGhlIGZ1bmN0aW9uIGluLlxuXHRcdCAqIEByZXR1cm4ge2Z1bmN0aW9ufSBGdW5jdGlvbiBjYWxsYmFjayBoYW5kbGVyIHRoZSBzYW1lIGFzIHRoZSBvbmUgcGFzc2VkIGluLlxuXHRcdCAqL1xuXHRcdGJpbmQ6IGZ1bmN0aW9uKHRhcmdldCwgbmFtZSwgZnVuYywgc2NvcGUpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0aWYgKFRvb2xzLmlzQXJyYXkodGFyZ2V0KSkge1xuXHRcdFx0XHR2YXIgaSA9IHRhcmdldC5sZW5ndGg7XG5cblx0XHRcdFx0d2hpbGUgKGktLSkge1xuXHRcdFx0XHRcdHRhcmdldFtpXSA9IHNlbGYuYmluZCh0YXJnZXRbaV0sIG5hbWUsIGZ1bmMsIHNjb3BlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiB0YXJnZXQ7XG5cdFx0XHR9XG5cblx0XHRcdC8vIENvbGxlY3QgYWxsIHdpbmRvdy9kb2N1bWVudCBldmVudHMgYm91bmQgYnkgZWRpdG9yIGluc3RhbmNlXG5cdFx0XHRpZiAoc2VsZi5zZXR0aW5ncy5jb2xsZWN0ICYmICh0YXJnZXQgPT09IHNlbGYuZG9jIHx8IHRhcmdldCA9PT0gc2VsZi53aW4pKSB7XG5cdFx0XHRcdHNlbGYuYm91bmRFdmVudHMucHVzaChbdGFyZ2V0LCBuYW1lLCBmdW5jLCBzY29wZV0pO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gc2VsZi5ldmVudHMuYmluZCh0YXJnZXQsIG5hbWUsIGZ1bmMsIHNjb3BlIHx8IHNlbGYpO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZW1vdmVzIHRoZSBzcGVjaWZpZWQgZXZlbnQgaGFuZGxlciBieSBuYW1lIGFuZCBmdW5jdGlvbiBmcm9tIGFuIGVsZW1lbnQgb3IgY29sbGVjdGlvbiBvZiBlbGVtZW50cy5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgdW5iaW5kXG5cdFx0ICogQHBhcmFtIHtFbGVtZW50L0RvY3VtZW50L1dpbmRvdy9BcnJheX0gdGFyZ2V0IFRhcmdldCBlbGVtZW50IHRvIHVuYmluZCBldmVudHMgb24uXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IG5hbWUgRXZlbnQgaGFuZGxlciBuYW1lLCBmb3IgZXhhbXBsZTogXCJjbGlja1wiXG5cdFx0ICogQHBhcmFtIHtmdW5jdGlvbn0gZnVuYyBGdW5jdGlvbiB0byByZW1vdmUuXG5cdFx0ICogQHJldHVybiB7Ym9vbC9BcnJheX0gQm9vbCBzdGF0ZSBvZiB0cnVlIGlmIHRoZSBoYW5kbGVyIHdhcyByZW1vdmVkLCBvciBhbiBhcnJheSBvZiBzdGF0ZXMgaWYgbXVsdGlwbGUgaW5wdXQgZWxlbWVudHNcblx0XHQgKiB3ZXJlIHBhc3NlZCBpbi5cblx0XHQgKi9cblx0XHR1bmJpbmQ6IGZ1bmN0aW9uKHRhcmdldCwgbmFtZSwgZnVuYykge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLCBpO1xuXG5cdFx0XHRpZiAoVG9vbHMuaXNBcnJheSh0YXJnZXQpKSB7XG5cdFx0XHRcdGkgPSB0YXJnZXQubGVuZ3RoO1xuXG5cdFx0XHRcdHdoaWxlIChpLS0pIHtcblx0XHRcdFx0XHR0YXJnZXRbaV0gPSBzZWxmLnVuYmluZCh0YXJnZXRbaV0sIG5hbWUsIGZ1bmMpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHRhcmdldDtcblx0XHRcdH1cblxuXHRcdFx0Ly8gUmVtb3ZlIGFueSBib3VuZCBldmVudHMgbWF0Y2hpbmcgdGhlIGlucHV0XG5cdFx0XHRpZiAoc2VsZi5ib3VuZEV2ZW50cyAmJiAodGFyZ2V0ID09PSBzZWxmLmRvYyB8fCB0YXJnZXQgPT09IHNlbGYud2luKSkge1xuXHRcdFx0XHRpID0gc2VsZi5ib3VuZEV2ZW50cy5sZW5ndGg7XG5cblx0XHRcdFx0d2hpbGUgKGktLSkge1xuXHRcdFx0XHRcdHZhciBpdGVtID0gc2VsZi5ib3VuZEV2ZW50c1tpXTtcblxuXHRcdFx0XHRcdGlmICh0YXJnZXQgPT0gaXRlbVswXSAmJiAoIW5hbWUgfHwgbmFtZSA9PSBpdGVtWzFdKSAmJiAoIWZ1bmMgfHwgZnVuYyA9PSBpdGVtWzJdKSkge1xuXHRcdFx0XHRcdFx0dGhpcy5ldmVudHMudW5iaW5kKGl0ZW1bMF0sIGl0ZW1bMV0sIGl0ZW1bMl0pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gdGhpcy5ldmVudHMudW5iaW5kKHRhcmdldCwgbmFtZSwgZnVuYyk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIEZpcmVzIHRoZSBzcGVjaWZpZWQgZXZlbnQgbmFtZSB3aXRoIG9iamVjdCBvbiB0YXJnZXQuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGZpcmVcblx0XHQgKiBAcGFyYW0ge05vZGUvRG9jdW1lbnQvV2luZG93fSB0YXJnZXQgVGFyZ2V0IGVsZW1lbnQgb3Igb2JqZWN0IHRvIGZpcmUgZXZlbnQgb24uXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IG5hbWUgTmFtZSBvZiB0aGUgZXZlbnQgdG8gZmlyZS5cblx0XHQgKiBAcGFyYW0ge09iamVjdH0gZXZ0IEV2ZW50IG9iamVjdCB0byBzZW5kLlxuXHRcdCAqIEByZXR1cm4ge0V2ZW50fSBFdmVudCBvYmplY3QuXG5cdFx0ICovXG5cdFx0ZmlyZTogZnVuY3Rpb24odGFyZ2V0LCBuYW1lLCBldnQpIHtcblx0XHRcdHJldHVybiB0aGlzLmV2ZW50cy5maXJlKHRhcmdldCwgbmFtZSwgZXZ0KTtcblx0XHR9LFxuXG5cdFx0Ly8gUmV0dXJucyB0aGUgY29udGVudCBlZGl0YWJsZSBzdGF0ZSBvZiBhIG5vZGVcblx0XHRnZXRDb250ZW50RWRpdGFibGU6IGZ1bmN0aW9uKG5vZGUpIHtcblx0XHRcdHZhciBjb250ZW50RWRpdGFibGU7XG5cblx0XHRcdC8vIENoZWNrIHR5cGVcblx0XHRcdGlmICghbm9kZSB8fCBub2RlLm5vZGVUeXBlICE9IDEpIHtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cblx0XHRcdC8vIENoZWNrIGZvciBmYWtlIGNvbnRlbnQgZWRpdGFibGVcblx0XHRcdGNvbnRlbnRFZGl0YWJsZSA9IG5vZGUuZ2V0QXR0cmlidXRlKFwiZGF0YS1tY2UtY29udGVudGVkaXRhYmxlXCIpO1xuXHRcdFx0aWYgKGNvbnRlbnRFZGl0YWJsZSAmJiBjb250ZW50RWRpdGFibGUgIT09IFwiaW5oZXJpdFwiKSB7XG5cdFx0XHRcdHJldHVybiBjb250ZW50RWRpdGFibGU7XG5cdFx0XHR9XG5cblx0XHRcdC8vIENoZWNrIGZvciByZWFsIGNvbnRlbnQgZWRpdGFibGVcblx0XHRcdHJldHVybiBub2RlLmNvbnRlbnRFZGl0YWJsZSAhPT0gXCJpbmhlcml0XCIgPyBub2RlLmNvbnRlbnRFZGl0YWJsZSA6IG51bGw7XG5cdFx0fSxcblxuXHRcdGdldENvbnRlbnRFZGl0YWJsZVBhcmVudDogZnVuY3Rpb24obm9kZSkge1xuXHRcdFx0dmFyIHJvb3QgPSB0aGlzLmdldFJvb3QoKSwgc3RhdGUgPSBudWxsO1xuXG5cdFx0XHRmb3IgKDsgbm9kZSAmJiBub2RlICE9PSByb290OyBub2RlID0gbm9kZS5wYXJlbnROb2RlKSB7XG5cdFx0XHRcdHN0YXRlID0gdGhpcy5nZXRDb250ZW50RWRpdGFibGUobm9kZSk7XG5cblx0XHRcdFx0aWYgKHN0YXRlICE9PSBudWxsKSB7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHN0YXRlO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBEZXN0cm95cyBhbGwgaW50ZXJuYWwgcmVmZXJlbmNlcyB0byB0aGUgRE9NIHRvIHNvbHZlIElFIGxlYWsgaXNzdWVzLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBkZXN0cm95XG5cdFx0ICovXG5cdFx0ZGVzdHJveTogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdC8vIFVuYmluZCBhbGwgZXZlbnRzIGJvdW5kIHRvIHdpbmRvdy9kb2N1bWVudCBieSBlZGl0b3IgaW5zdGFuY2Vcblx0XHRcdGlmIChzZWxmLmJvdW5kRXZlbnRzKSB7XG5cdFx0XHRcdHZhciBpID0gc2VsZi5ib3VuZEV2ZW50cy5sZW5ndGg7XG5cblx0XHRcdFx0d2hpbGUgKGktLSkge1xuXHRcdFx0XHRcdHZhciBpdGVtID0gc2VsZi5ib3VuZEV2ZW50c1tpXTtcblx0XHRcdFx0XHR0aGlzLmV2ZW50cy51bmJpbmQoaXRlbVswXSwgaXRlbVsxXSwgaXRlbVsyXSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRzZWxmLmJvdW5kRXZlbnRzID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdFx0Ly8gUmVzdG9yZSBzaXp6bGUgZG9jdW1lbnQgdG8gd2luZG93LmRvY3VtZW50XG5cdFx0XHQvLyBTaW5jZSB0aGUgY3VycmVudCBkb2N1bWVudCBtaWdodCBiZSByZW1vdmVkIHByb2R1Y2luZyBcIlBlcm1pc3Npb24gZGVuaWVkXCIgb24gSUUgc2VlICM2MzI1XG5cdFx0XHRpZiAoU2l6emxlLnNldERvY3VtZW50KSB7XG5cdFx0XHRcdFNpenpsZS5zZXREb2N1bWVudCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRzZWxmLndpbiA9IHNlbGYuZG9jID0gc2VsZi5yb290ID0gc2VsZi5ldmVudHMgPSBzZWxmLmZyYWcgPSBudWxsO1xuXHRcdH0sXG5cblx0XHRpc0NoaWxkT2Y6IGZ1bmN0aW9uKG5vZGUsIHBhcmVudCkge1xuXHRcdFx0d2hpbGUgKG5vZGUpIHtcblx0XHRcdFx0aWYgKHBhcmVudCA9PT0gbm9kZSkge1xuXHRcdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0bm9kZSA9IG5vZGUucGFyZW50Tm9kZTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH0sXG5cblx0XHQvLyAjaWZkZWYgZGVidWdcblxuXHRcdGR1bXBSbmc6IGZ1bmN0aW9uKHIpIHtcblx0XHRcdHJldHVybiAoXG5cdFx0XHRcdCdzdGFydENvbnRhaW5lcjogJyArIHIuc3RhcnRDb250YWluZXIubm9kZU5hbWUgK1xuXHRcdFx0XHQnLCBzdGFydE9mZnNldDogJyArIHIuc3RhcnRPZmZzZXQgK1xuXHRcdFx0XHQnLCBlbmRDb250YWluZXI6ICcgKyByLmVuZENvbnRhaW5lci5ub2RlTmFtZSArXG5cdFx0XHRcdCcsIGVuZE9mZnNldDogJyArIHIuZW5kT2Zmc2V0XG5cdFx0XHQpO1xuXHRcdH0sXG5cblx0XHQvLyAjZW5kaWZcblxuXHRcdF9maW5kU2liOiBmdW5jdGlvbihub2RlLCBzZWxlY3RvciwgbmFtZSkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLCBmdW5jID0gc2VsZWN0b3I7XG5cblx0XHRcdGlmIChub2RlKSB7XG5cdFx0XHRcdC8vIElmIGV4cHJlc3Npb24gbWFrZSBhIGZ1bmN0aW9uIG9mIGl0IHVzaW5nIGlzXG5cdFx0XHRcdGlmICh0eXBlb2YgZnVuYyA9PSAnc3RyaW5nJykge1xuXHRcdFx0XHRcdGZ1bmMgPSBmdW5jdGlvbihub2RlKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gc2VsZi5pcyhub2RlLCBzZWxlY3Rvcik7XG5cdFx0XHRcdFx0fTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIExvb3AgYWxsIHNpYmxpbmdzXG5cdFx0XHRcdGZvciAobm9kZSA9IG5vZGVbbmFtZV07IG5vZGU7IG5vZGUgPSBub2RlW25hbWVdKSB7XG5cdFx0XHRcdFx0aWYgKGZ1bmMobm9kZSkpIHtcblx0XHRcdFx0XHRcdHJldHVybiBub2RlO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cdH07XG5cblx0LyoqXG5cdCAqIEluc3RhbmNlIG9mIERPTVV0aWxzIGZvciB0aGUgY3VycmVudCBkb2N1bWVudC5cblx0ICpcblx0ICogQHN0YXRpY1xuXHQgKiBAcHJvcGVydHkgRE9NXG5cdCAqIEB0eXBlIHRpbnltY2UuZG9tLkRPTVV0aWxzXG5cdCAqIEBleGFtcGxlXG5cdCAqIC8vIEV4YW1wbGUgb2YgaG93IHRvIGFkZCBhIGNsYXNzIHRvIHNvbWUgZWxlbWVudCBieSBpZFxuXHQgKiB0aW55bWNlLkRPTS5hZGRDbGFzcygnc29tZWlkJywgJ3NvbWVjbGFzcycpO1xuXHQgKi9cblx0RE9NVXRpbHMuRE9NID0gbmV3IERPTVV0aWxzKGRvY3VtZW50KTtcblx0RE9NVXRpbHMubm9kZUluZGV4ID0gbm9kZUluZGV4O1xuXG5cdHJldHVybiBET01VdGlscztcbn0pO1xuXG4vLyBJbmNsdWRlZCBmcm9tOiBqcy90aW55bWNlL2NsYXNzZXMvZG9tL1NjcmlwdExvYWRlci5qc1xuXG4vKipcbiAqIFNjcmlwdExvYWRlci5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE1IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKmdsb2JhbHMgY29uc29sZSovXG5cbi8qKlxuICogVGhpcyBjbGFzcyBoYW5kbGVzIGFzeW5jaHJvbm91cy9zeW5jaHJvbm91cyBsb2FkaW5nIG9mIEphdmFTY3JpcHQgZmlsZXMgaXQgd2lsbCBleGVjdXRlIGNhbGxiYWNrc1xuICogd2hlbiB2YXJpb3VzIGl0ZW1zIGdldHMgbG9hZGVkLiBUaGlzIGNsYXNzIGlzIHVzZWZ1bCB0byBsb2FkIGV4dGVybmFsIEphdmFTY3JpcHQgZmlsZXMuXG4gKlxuICogQGNsYXNzIHRpbnltY2UuZG9tLlNjcmlwdExvYWRlclxuICogQGV4YW1wbGVcbiAqIC8vIExvYWQgYSBzY3JpcHQgZnJvbSBhIHNwZWNpZmljIFVSTCB1c2luZyB0aGUgZ2xvYmFsIHNjcmlwdCBsb2FkZXJcbiAqIHRpbnltY2UuU2NyaXB0TG9hZGVyLmxvYWQoJ3NvbWVzY3JpcHQuanMnKTtcbiAqXG4gKiAvLyBMb2FkIGEgc2NyaXB0IHVzaW5nIGEgdW5pcXVlIGluc3RhbmNlIG9mIHRoZSBzY3JpcHQgbG9hZGVyXG4gKiB2YXIgc2NyaXB0TG9hZGVyID0gbmV3IHRpbnltY2UuZG9tLlNjcmlwdExvYWRlcigpO1xuICpcbiAqIHNjcmlwdExvYWRlci5sb2FkKCdzb21lc2NyaXB0LmpzJyk7XG4gKlxuICogLy8gTG9hZCBtdWx0aXBsZSBzY3JpcHRzXG4gKiB2YXIgc2NyaXB0TG9hZGVyID0gbmV3IHRpbnltY2UuZG9tLlNjcmlwdExvYWRlcigpO1xuICpcbiAqIHNjcmlwdExvYWRlci5hZGQoJ3NvbWVzY3JpcHQxLmpzJyk7XG4gKiBzY3JpcHRMb2FkZXIuYWRkKCdzb21lc2NyaXB0Mi5qcycpO1xuICogc2NyaXB0TG9hZGVyLmFkZCgnc29tZXNjcmlwdDMuanMnKTtcbiAqXG4gKiBzY3JpcHRMb2FkZXIubG9hZFF1ZXVlKGZ1bmN0aW9uKCkge1xuICogICAgYWxlcnQoJ0FsbCBzY3JpcHRzIGFyZSBub3cgbG9hZGVkLicpO1xuICogfSk7XG4gKi9cbmRlZmluZShcInRpbnltY2UvZG9tL1NjcmlwdExvYWRlclwiLCBbXG5cdFwidGlueW1jZS9kb20vRE9NVXRpbHNcIixcblx0XCJ0aW55bWNlL3V0aWwvVG9vbHNcIlxuXSwgZnVuY3Rpb24oRE9NVXRpbHMsIFRvb2xzKSB7XG5cdHZhciBET00gPSBET01VdGlscy5ET007XG5cdHZhciBlYWNoID0gVG9vbHMuZWFjaCwgZ3JlcCA9IFRvb2xzLmdyZXA7XG5cblx0ZnVuY3Rpb24gU2NyaXB0TG9hZGVyKCkge1xuXHRcdHZhciBRVUVVRUQgPSAwLFxuXHRcdFx0TE9BRElORyA9IDEsXG5cdFx0XHRMT0FERUQgPSAyLFxuXHRcdFx0c3RhdGVzID0ge30sXG5cdFx0XHRxdWV1ZSA9IFtdLFxuXHRcdFx0c2NyaXB0TG9hZGVkQ2FsbGJhY2tzID0ge30sXG5cdFx0XHRxdWV1ZUxvYWRlZENhbGxiYWNrcyA9IFtdLFxuXHRcdFx0bG9hZGluZyA9IDAsXG5cdFx0XHR1bmRlZjtcblxuXHRcdC8qKlxuXHRcdCAqIExvYWRzIGEgc3BlY2lmaWMgc2NyaXB0IGRpcmVjdGx5IHdpdGhvdXQgYWRkaW5nIGl0IHRvIHRoZSBsb2FkIHF1ZXVlLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBsb2FkXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IHVybCBBYnNvbHV0ZSBVUkwgdG8gc2NyaXB0IHRvIGFkZC5cblx0XHQgKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFjayBPcHRpb25hbCBjYWxsYmFjayBmdW5jdGlvbiB0byBleGVjdXRlIG9uZXMgdGhpcyBzY3JpcHQgZ2V0cyBsb2FkZWQuXG5cdFx0ICovXG5cdFx0ZnVuY3Rpb24gbG9hZFNjcmlwdCh1cmwsIGNhbGxiYWNrKSB7XG5cdFx0XHR2YXIgZG9tID0gRE9NLCBlbG0sIGlkO1xuXG5cdFx0XHQvLyBFeGVjdXRlIGNhbGxiYWNrIHdoZW4gc2NyaXB0IGlzIGxvYWRlZFxuXHRcdFx0ZnVuY3Rpb24gZG9uZSgpIHtcblx0XHRcdFx0ZG9tLnJlbW92ZShpZCk7XG5cblx0XHRcdFx0aWYgKGVsbSkge1xuXHRcdFx0XHRcdGVsbS5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBlbG0ub25sb2FkID0gZWxtID0gbnVsbDtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGNhbGxiYWNrKCk7XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIGVycm9yKCkge1xuXHRcdFx0XHQvKmVzbGludCBuby1jb25zb2xlOjAgKi9cblxuXHRcdFx0XHQvLyBSZXBvcnQgdGhlIGVycm9yIHNvIGl0J3MgZWFzaWVyIGZvciBwZW9wbGUgdG8gc3BvdCBsb2FkaW5nIGVycm9yc1xuXHRcdFx0XHRpZiAodHlwZW9mIGNvbnNvbGUgIT09IFwidW5kZWZpbmVkXCIgJiYgY29uc29sZS5sb2cpIHtcblx0XHRcdFx0XHRjb25zb2xlLmxvZyhcIkZhaWxlZCB0byBsb2FkOiBcIiArIHVybCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBXZSBjYW4ndCBtYXJrIGl0IGFzIGRvbmUgaWYgdGhlcmUgaXMgYSBsb2FkIGVycm9yIHNpbmNlXG5cdFx0XHRcdC8vIEEpIFdlIGRvbid0IHdhbnQgdG8gcHJvZHVjZSA0MDQgZXJyb3JzIG9uIHRoZSBzZXJ2ZXIgYW5kXG5cdFx0XHRcdC8vIEIpIHRoZSBvbmVycm9yIGV2ZW50IHdvbid0IGZpcmUgb24gYWxsIGJyb3dzZXJzLlxuXHRcdFx0XHQvLyBkb25lKCk7XG5cdFx0XHR9XG5cblx0XHRcdGlkID0gZG9tLnVuaXF1ZUlkKCk7XG5cblx0XHRcdC8vIENyZWF0ZSBuZXcgc2NyaXB0IGVsZW1lbnRcblx0XHRcdGVsbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpO1xuXHRcdFx0ZWxtLmlkID0gaWQ7XG5cdFx0XHRlbG0udHlwZSA9ICd0ZXh0L2phdmFzY3JpcHQnO1xuXHRcdFx0ZWxtLnNyYyA9IFRvb2xzLl9hZGRDYWNoZVN1ZmZpeCh1cmwpO1xuXG5cdFx0XHQvLyBTZWVtcyB0aGF0IG9ucmVhZHlzdGF0ZWNoYW5nZSB3b3JrcyBiZXR0ZXIgb24gSUUgMTAgb25sb2FkIHNlZW1zIHRvIGZpcmUgaW5jb3JyZWN0bHlcblx0XHRcdGlmIChcIm9ucmVhZHlzdGF0ZWNoYW5nZVwiIGluIGVsbSkge1xuXHRcdFx0XHRlbG0ub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0aWYgKC9sb2FkZWR8Y29tcGxldGUvLnRlc3QoZWxtLnJlYWR5U3RhdGUpKSB7XG5cdFx0XHRcdFx0XHRkb25lKCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9O1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0ZWxtLm9ubG9hZCA9IGRvbmU7XG5cdFx0XHR9XG5cblx0XHRcdC8vIEFkZCBvbmVycm9yIGV2ZW50IHdpbGwgZ2V0IGZpcmVkIG9uIHNvbWUgYnJvd3NlcnMgYnV0IG5vdCBhbGwgb2YgdGhlbVxuXHRcdFx0ZWxtLm9uZXJyb3IgPSBlcnJvcjtcblxuXHRcdFx0Ly8gQWRkIHNjcmlwdCB0byBkb2N1bWVudFxuXHRcdFx0KGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdoZWFkJylbMF0gfHwgZG9jdW1lbnQuYm9keSkuYXBwZW5kQ2hpbGQoZWxtKTtcblx0XHR9XG5cblx0XHQvKipcblx0XHQgKiBSZXR1cm5zIHRydWUvZmFsc2UgaWYgYSBzY3JpcHQgaGFzIGJlZW4gbG9hZGVkIG9yIG5vdC5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgaXNEb25lXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IHVybCBVUkwgdG8gY2hlY2sgZm9yLlxuXHRcdCAqIEByZXR1cm4ge0Jvb2xlYW59IHRydWUvZmFsc2UgaWYgdGhlIFVSTCBpcyBsb2FkZWQuXG5cdFx0ICovXG5cdFx0dGhpcy5pc0RvbmUgPSBmdW5jdGlvbih1cmwpIHtcblx0XHRcdHJldHVybiBzdGF0ZXNbdXJsXSA9PSBMT0FERUQ7XG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIE1hcmtzIGEgc3BlY2lmaWMgc2NyaXB0IHRvIGJlIGxvYWRlZC4gVGhpcyBjYW4gYmUgdXNlZnVsIGlmIGEgc2NyaXB0IGdvdCBsb2FkZWQgb3V0c2lkZVxuXHRcdCAqIHRoZSBzY3JpcHQgbG9hZGVyIG9yIHRvIHNraXAgaXQgZnJvbSBsb2FkaW5nIHNvbWUgc2NyaXB0LlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBtYXJrRG9uZVxuXHRcdCAqIEBwYXJhbSB7c3RyaW5nfSB1cmwgQWJzb2x1dGUgVVJMIHRvIHRoZSBzY3JpcHQgdG8gbWFyayBhcyBsb2FkZWQuXG5cdFx0ICovXG5cdFx0dGhpcy5tYXJrRG9uZSA9IGZ1bmN0aW9uKHVybCkge1xuXHRcdFx0c3RhdGVzW3VybF0gPSBMT0FERUQ7XG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIEFkZHMgYSBzcGVjaWZpYyBzY3JpcHQgdG8gdGhlIGxvYWQgcXVldWUgb2YgdGhlIHNjcmlwdCBsb2FkZXIuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGFkZFxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSB1cmwgQWJzb2x1dGUgVVJMIHRvIHNjcmlwdCB0byBhZGQuXG5cdFx0ICogQHBhcmFtIHtmdW5jdGlvbn0gY2FsbGJhY2sgT3B0aW9uYWwgY2FsbGJhY2sgZnVuY3Rpb24gdG8gZXhlY3V0ZSBvbmVzIHRoaXMgc2NyaXB0IGdldHMgbG9hZGVkLlxuXHRcdCAqIEBwYXJhbSB7T2JqZWN0fSBzY29wZSBPcHRpb25hbCBzY29wZSB0byBleGVjdXRlIGNhbGxiYWNrIGluLlxuXHRcdCAqL1xuXHRcdHRoaXMuYWRkID0gdGhpcy5sb2FkID0gZnVuY3Rpb24odXJsLCBjYWxsYmFjaywgc2NvcGUpIHtcblx0XHRcdHZhciBzdGF0ZSA9IHN0YXRlc1t1cmxdO1xuXG5cdFx0XHQvLyBBZGQgdXJsIHRvIGxvYWQgcXVldWVcblx0XHRcdGlmIChzdGF0ZSA9PSB1bmRlZikge1xuXHRcdFx0XHRxdWV1ZS5wdXNoKHVybCk7XG5cdFx0XHRcdHN0YXRlc1t1cmxdID0gUVVFVUVEO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoY2FsbGJhY2spIHtcblx0XHRcdFx0Ly8gU3RvcmUgYXdheSBjYWxsYmFjayBmb3IgbGF0ZXIgZXhlY3V0aW9uXG5cdFx0XHRcdGlmICghc2NyaXB0TG9hZGVkQ2FsbGJhY2tzW3VybF0pIHtcblx0XHRcdFx0XHRzY3JpcHRMb2FkZWRDYWxsYmFja3NbdXJsXSA9IFtdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0c2NyaXB0TG9hZGVkQ2FsbGJhY2tzW3VybF0ucHVzaCh7XG5cdFx0XHRcdFx0ZnVuYzogY2FsbGJhY2ssXG5cdFx0XHRcdFx0c2NvcGU6IHNjb3BlIHx8IHRoaXNcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fTtcblxuXHRcdHRoaXMucmVtb3ZlID0gZnVuY3Rpb24odXJsKSB7XG5cdFx0XHRkZWxldGUgc3RhdGVzW3VybF07XG5cdFx0XHRkZWxldGUgc2NyaXB0TG9hZGVkQ2FsbGJhY2tzW3VybF07XG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIFN0YXJ0cyB0aGUgbG9hZGluZyBvZiB0aGUgcXVldWUuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGxvYWRRdWV1ZVxuXHRcdCAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrIE9wdGlvbmFsIGNhbGxiYWNrIHRvIGV4ZWN1dGUgd2hlbiBhbGwgcXVldWVkIGl0ZW1zIGFyZSBsb2FkZWQuXG5cdFx0ICogQHBhcmFtIHtPYmplY3R9IHNjb3BlIE9wdGlvbmFsIHNjb3BlIHRvIGV4ZWN1dGUgdGhlIGNhbGxiYWNrIGluLlxuXHRcdCAqL1xuXHRcdHRoaXMubG9hZFF1ZXVlID0gZnVuY3Rpb24oY2FsbGJhY2ssIHNjb3BlKSB7XG5cdFx0XHR0aGlzLmxvYWRTY3JpcHRzKHF1ZXVlLCBjYWxsYmFjaywgc2NvcGUpO1xuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBMb2FkcyB0aGUgc3BlY2lmaWVkIHF1ZXVlIG9mIGZpbGVzIGFuZCBleGVjdXRlcyB0aGUgY2FsbGJhY2sgb25lcyB0aGV5IGFyZSBsb2FkZWQuXG5cdFx0ICogVGhpcyBtZXRob2QgaXMgZ2VuZXJhbGx5IG5vdCB1c2VkIG91dHNpZGUgdGhpcyBjbGFzcyBidXQgaXQgbWlnaHQgYmUgdXNlZnVsIGluIHNvbWUgc2NlbmFyaW9zLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBsb2FkU2NyaXB0c1xuXHRcdCAqIEBwYXJhbSB7QXJyYXl9IHNjcmlwdHMgQXJyYXkgb2YgcXVldWUgaXRlbXMgdG8gbG9hZC5cblx0XHQgKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFjayBPcHRpb25hbCBjYWxsYmFjayB0byBleGVjdXRlIG9uZXMgYWxsIGl0ZW1zIGFyZSBsb2FkZWQuXG5cdFx0ICogQHBhcmFtIHtPYmplY3R9IHNjb3BlIE9wdGlvbmFsIHNjb3BlIHRvIGV4ZWN1dGUgY2FsbGJhY2sgaW4uXG5cdFx0ICovXG5cdFx0dGhpcy5sb2FkU2NyaXB0cyA9IGZ1bmN0aW9uKHNjcmlwdHMsIGNhbGxiYWNrLCBzY29wZSkge1xuXHRcdFx0dmFyIGxvYWRTY3JpcHRzO1xuXG5cdFx0XHRmdW5jdGlvbiBleGVjU2NyaXB0TG9hZGVkQ2FsbGJhY2tzKHVybCkge1xuXHRcdFx0XHQvLyBFeGVjdXRlIFVSTCBjYWxsYmFjayBmdW5jdGlvbnNcblx0XHRcdFx0ZWFjaChzY3JpcHRMb2FkZWRDYWxsYmFja3NbdXJsXSwgZnVuY3Rpb24oY2FsbGJhY2spIHtcblx0XHRcdFx0XHRjYWxsYmFjay5mdW5jLmNhbGwoY2FsbGJhY2suc2NvcGUpO1xuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHRzY3JpcHRMb2FkZWRDYWxsYmFja3NbdXJsXSA9IHVuZGVmO1xuXHRcdFx0fVxuXG5cdFx0XHRxdWV1ZUxvYWRlZENhbGxiYWNrcy5wdXNoKHtcblx0XHRcdFx0ZnVuYzogY2FsbGJhY2ssXG5cdFx0XHRcdHNjb3BlOiBzY29wZSB8fCB0aGlzXG5cdFx0XHR9KTtcblxuXHRcdFx0bG9hZFNjcmlwdHMgPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0dmFyIGxvYWRpbmdTY3JpcHRzID0gZ3JlcChzY3JpcHRzKTtcblxuXHRcdFx0XHQvLyBDdXJyZW50IHNjcmlwdHMgaGFzIGJlZW4gaGFuZGxlZFxuXHRcdFx0XHRzY3JpcHRzLmxlbmd0aCA9IDA7XG5cblx0XHRcdFx0Ly8gTG9hZCBzY3JpcHRzIHRoYXQgbmVlZHMgdG8gYmUgbG9hZGVkXG5cdFx0XHRcdGVhY2gobG9hZGluZ1NjcmlwdHMsIGZ1bmN0aW9uKHVybCkge1xuXHRcdFx0XHRcdC8vIFNjcmlwdCBpcyBhbHJlYWR5IGxvYWRlZCB0aGVuIGV4ZWN1dGUgc2NyaXB0IGNhbGxiYWNrcyBkaXJlY3RseVxuXHRcdFx0XHRcdGlmIChzdGF0ZXNbdXJsXSA9PSBMT0FERUQpIHtcblx0XHRcdFx0XHRcdGV4ZWNTY3JpcHRMb2FkZWRDYWxsYmFja3ModXJsKTtcblx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHQvLyBJcyBzY3JpcHQgbm90IGxvYWRpbmcgdGhlbiBzdGFydCBsb2FkaW5nIGl0XG5cdFx0XHRcdFx0aWYgKHN0YXRlc1t1cmxdICE9IExPQURJTkcpIHtcblx0XHRcdFx0XHRcdHN0YXRlc1t1cmxdID0gTE9BRElORztcblx0XHRcdFx0XHRcdGxvYWRpbmcrKztcblxuXHRcdFx0XHRcdFx0bG9hZFNjcmlwdCh1cmwsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdFx0XHRzdGF0ZXNbdXJsXSA9IExPQURFRDtcblx0XHRcdFx0XHRcdFx0bG9hZGluZy0tO1xuXG5cdFx0XHRcdFx0XHRcdGV4ZWNTY3JpcHRMb2FkZWRDYWxsYmFja3ModXJsKTtcblxuXHRcdFx0XHRcdFx0XHQvLyBMb2FkIG1vcmUgc2NyaXB0cyBpZiB0aGV5IHdoZXJlIGFkZGVkIGJ5IHRoZSByZWNlbnRseSBsb2FkZWQgc2NyaXB0XG5cdFx0XHRcdFx0XHRcdGxvYWRTY3JpcHRzKCk7XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdC8vIE5vIHNjcmlwdHMgYXJlIGN1cnJlbnRseSBsb2FkaW5nIHRoZW4gZXhlY3V0ZSBhbGwgcGVuZGluZyBxdWV1ZSBsb2FkZWQgY2FsbGJhY2tzXG5cdFx0XHRcdGlmICghbG9hZGluZykge1xuXHRcdFx0XHRcdGVhY2gocXVldWVMb2FkZWRDYWxsYmFja3MsIGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG5cdFx0XHRcdFx0XHRjYWxsYmFjay5mdW5jLmNhbGwoY2FsbGJhY2suc2NvcGUpO1xuXHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0cXVldWVMb2FkZWRDYWxsYmFja3MubGVuZ3RoID0gMDtcblx0XHRcdFx0fVxuXHRcdFx0fTtcblxuXHRcdFx0bG9hZFNjcmlwdHMoKTtcblx0XHR9O1xuXHR9XG5cblx0U2NyaXB0TG9hZGVyLlNjcmlwdExvYWRlciA9IG5ldyBTY3JpcHRMb2FkZXIoKTtcblxuXHRyZXR1cm4gU2NyaXB0TG9hZGVyO1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy9BZGRPbk1hbmFnZXIuanNcblxuLyoqXG4gKiBBZGRPbk1hbmFnZXIuanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBUaGlzIGNsYXNzIGhhbmRsZXMgdGhlIGxvYWRpbmcgb2YgdGhlbWVzL3BsdWdpbnMgb3Igb3RoZXIgYWRkLW9ucyBhbmQgdGhlaXIgbGFuZ3VhZ2UgcGFja3MuXG4gKlxuICogQGNsYXNzIHRpbnltY2UuQWRkT25NYW5hZ2VyXG4gKi9cbmRlZmluZShcInRpbnltY2UvQWRkT25NYW5hZ2VyXCIsIFtcblx0XCJ0aW55bWNlL2RvbS9TY3JpcHRMb2FkZXJcIixcblx0XCJ0aW55bWNlL3V0aWwvVG9vbHNcIlxuXSwgZnVuY3Rpb24oU2NyaXB0TG9hZGVyLCBUb29scykge1xuXHR2YXIgZWFjaCA9IFRvb2xzLmVhY2g7XG5cblx0ZnVuY3Rpb24gQWRkT25NYW5hZ2VyKCkge1xuXHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdHNlbGYuaXRlbXMgPSBbXTtcblx0XHRzZWxmLnVybHMgPSB7fTtcblx0XHRzZWxmLmxvb2t1cCA9IHt9O1xuXHR9XG5cblx0QWRkT25NYW5hZ2VyLnByb3RvdHlwZSA9IHtcblx0XHQvKipcblx0XHQgKiBSZXR1cm5zIHRoZSBzcGVjaWZpZWQgYWRkIG9uIGJ5IHRoZSBzaG9ydCBuYW1lLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBnZXRcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSBBZGQtb24gdG8gbG9vayBmb3IuXG5cdFx0ICogQHJldHVybiB7dGlueW1jZS5UaGVtZS90aW55bWNlLlBsdWdpbn0gVGhlbWUgb3IgcGx1Z2luIGFkZC1vbiBpbnN0YW5jZSBvciB1bmRlZmluZWQuXG5cdFx0ICovXG5cdFx0Z2V0OiBmdW5jdGlvbihuYW1lKSB7XG5cdFx0XHRpZiAodGhpcy5sb29rdXBbbmFtZV0pIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMubG9va3VwW25hbWVdLmluc3RhbmNlO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gdW5kZWZpbmVkO1xuXHRcdH0sXG5cblx0XHRkZXBlbmRlbmNpZXM6IGZ1bmN0aW9uKG5hbWUpIHtcblx0XHRcdHZhciByZXN1bHQ7XG5cblx0XHRcdGlmICh0aGlzLmxvb2t1cFtuYW1lXSkge1xuXHRcdFx0XHRyZXN1bHQgPSB0aGlzLmxvb2t1cFtuYW1lXS5kZXBlbmRlbmNpZXM7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiByZXN1bHQgfHwgW107XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIExvYWRzIGEgbGFuZ3VhZ2UgcGFjayBmb3IgdGhlIHNwZWNpZmllZCBhZGQtb24uXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHJlcXVpcmVMYW5nUGFja1xuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIFNob3J0IG5hbWUgb2YgdGhlIGFkZC1vbi5cblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gbGFuZ3VhZ2VzIE9wdGlvbmFsIGNvbW1hIG9yIHNwYWNlIHNlcGFyYXRlZCBsaXN0IG9mIGxhbmd1YWdlcyB0byBjaGVjayBpZiBpdCBtYXRjaGVzIHRoZSBuYW1lLlxuXHRcdCAqL1xuXHRcdHJlcXVpcmVMYW5nUGFjazogZnVuY3Rpb24obmFtZSwgbGFuZ3VhZ2VzKSB7XG5cdFx0XHR2YXIgbGFuZ3VhZ2UgPSBBZGRPbk1hbmFnZXIubGFuZ3VhZ2U7XG5cblx0XHRcdGlmIChsYW5ndWFnZSAmJiBBZGRPbk1hbmFnZXIubGFuZ3VhZ2VMb2FkICE9PSBmYWxzZSkge1xuXHRcdFx0XHRpZiAobGFuZ3VhZ2VzKSB7XG5cdFx0XHRcdFx0bGFuZ3VhZ2VzID0gJywnICsgbGFuZ3VhZ2VzICsgJywnO1xuXG5cdFx0XHRcdFx0Ly8gTG9hZCBzaG9ydCBmb3JtIHN2LmpzIG9yIGxvbmcgZm9ybSBzdl9TRS5qc1xuXHRcdFx0XHRcdGlmIChsYW5ndWFnZXMuaW5kZXhPZignLCcgKyBsYW5ndWFnZS5zdWJzdHIoMCwgMikgKyAnLCcpICE9IC0xKSB7XG5cdFx0XHRcdFx0XHRsYW5ndWFnZSA9IGxhbmd1YWdlLnN1YnN0cigwLCAyKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKGxhbmd1YWdlcy5pbmRleE9mKCcsJyArIGxhbmd1YWdlICsgJywnKSA9PSAtMSkge1xuXHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdFNjcmlwdExvYWRlci5TY3JpcHRMb2FkZXIuYWRkKHRoaXMudXJsc1tuYW1lXSArICcvbGFuZ3MvJyArIGxhbmd1YWdlICsgJy5qcycpO1xuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBBZGRzIGEgaW5zdGFuY2Ugb2YgdGhlIGFkZC1vbiBieSBpdCdzIHNob3J0IG5hbWUuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGFkZFxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBpZCBTaG9ydCBuYW1lL2lkIGZvciB0aGUgYWRkLW9uLlxuXHRcdCAqIEBwYXJhbSB7dGlueW1jZS5UaGVtZS90aW55bWNlLlBsdWdpbn0gYWRkT24gVGhlbWUgb3IgcGx1Z2luIHRvIGFkZC5cblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLlRoZW1lL3RpbnltY2UuUGx1Z2lufSBUaGUgc2FtZSB0aGVtZSBvciBwbHVnaW4gaW5zdGFuY2UgdGhhdCBnb3QgcGFzc2VkIGluLlxuXHRcdCAqIEBleGFtcGxlXG5cdFx0ICogLy8gQ3JlYXRlIGEgc2ltcGxlIHBsdWdpblxuXHRcdCAqIHRpbnltY2UuY3JlYXRlKCd0aW55bWNlLnBsdWdpbnMuVGVzdFBsdWdpbicsIHtcblx0XHQgKiAgIFRlc3RQbHVnaW46IGZ1bmN0aW9uKGVkLCB1cmwpIHtcblx0XHQgKiAgIGVkLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcblx0XHQgKiAgICAgIGVkLndpbmRvd01hbmFnZXIuYWxlcnQoJ0hlbGxvIFdvcmxkIScpO1xuXHRcdCAqICAgfSk7XG5cdFx0ICogICB9XG5cdFx0ICogfSk7XG5cdFx0ICpcblx0XHQgKiAvLyBSZWdpc3RlciBwbHVnaW4gdXNpbmcgdGhlIGFkZCBtZXRob2Rcblx0XHQgKiB0aW55bWNlLlBsdWdpbk1hbmFnZXIuYWRkKCd0ZXN0JywgdGlueW1jZS5wbHVnaW5zLlRlc3RQbHVnaW4pO1xuXHRcdCAqXG5cdFx0ICogLy8gSW5pdGlhbGl6ZSBUaW55TUNFXG5cdFx0ICogdGlueW1jZS5pbml0KHtcblx0XHQgKiAgLi4uXG5cdFx0ICogIHBsdWdpbnM6ICctdGVzdCcgLy8gSW5pdCB0aGUgcGx1Z2luIGJ1dCBkb24ndCB0cnkgdG8gbG9hZCBpdFxuXHRcdCAqIH0pO1xuXHRcdCAqL1xuXHRcdGFkZDogZnVuY3Rpb24oaWQsIGFkZE9uLCBkZXBlbmRlbmNpZXMpIHtcblx0XHRcdHRoaXMuaXRlbXMucHVzaChhZGRPbik7XG5cdFx0XHR0aGlzLmxvb2t1cFtpZF0gPSB7aW5zdGFuY2U6IGFkZE9uLCBkZXBlbmRlbmNpZXM6IGRlcGVuZGVuY2llc307XG5cblx0XHRcdHJldHVybiBhZGRPbjtcblx0XHR9LFxuXG5cdFx0cmVtb3ZlOiBmdW5jdGlvbihuYW1lKSB7XG5cdFx0XHRkZWxldGUgdGhpcy51cmxzW25hbWVdO1xuXHRcdFx0ZGVsZXRlIHRoaXMubG9va3VwW25hbWVdO1xuXHRcdH0sXG5cblx0XHRjcmVhdGVVcmw6IGZ1bmN0aW9uKGJhc2VVcmwsIGRlcCkge1xuXHRcdFx0aWYgKHR5cGVvZiBkZXAgPT09IFwib2JqZWN0XCIpIHtcblx0XHRcdFx0cmV0dXJuIGRlcDtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHtwcmVmaXg6IGJhc2VVcmwucHJlZml4LCByZXNvdXJjZTogZGVwLCBzdWZmaXg6IGJhc2VVcmwuc3VmZml4fTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogQWRkIGEgc2V0IG9mIGNvbXBvbmVudHMgdGhhdCB3aWxsIG1ha2UgdXAgdGhlIGFkZC1vbi4gVXNpbmcgdGhlIHVybCBvZiB0aGUgYWRkLW9uIG5hbWUgYXMgdGhlIGJhc2UgdXJsLlxuXHRcdCAqIFRoaXMgc2hvdWxkIGJlIHVzZWQgaW4gZGV2ZWxvcG1lbnQgbW9kZS4gIEEgbmV3IGNvbXByZXNzb3IvamF2YXNjcmlwdCBtdW5nZXIgcHJvY2VzcyB3aWxsIGVuc3VyZSB0aGF0IHRoZVxuXHRcdCAqIGNvbXBvbmVudHMgYXJlIHB1dCB0b2dldGhlciBpbnRvIHRoZSBwbHVnaW4uanMgZmlsZSBhbmQgY29tcHJlc3NlZCBjb3JyZWN0bHkuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGFkZENvbXBvbmVudHNcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gcGx1Z2luTmFtZSBuYW1lIG9mIHRoZSBwbHVnaW4gdG8gbG9hZCBzY3JpcHRzIGZyb20gKHdpbGwgYmUgdXNlZCB0byBnZXQgdGhlIGJhc2UgdXJsIGZvciB0aGUgcGx1Z2lucykuXG5cdFx0ICogQHBhcmFtIHtBcnJheX0gc2NyaXB0cyBBcnJheSBjb250YWluaW5nIHRoZSBuYW1lcyBvZiB0aGUgc2NyaXB0cyB0byBsb2FkLlxuXHRcdCAqL1xuXHRcdGFkZENvbXBvbmVudHM6IGZ1bmN0aW9uKHBsdWdpbk5hbWUsIHNjcmlwdHMpIHtcblx0XHRcdHZhciBwbHVnaW5VcmwgPSB0aGlzLnVybHNbcGx1Z2luTmFtZV07XG5cblx0XHRcdGVhY2goc2NyaXB0cywgZnVuY3Rpb24oc2NyaXB0KSB7XG5cdFx0XHRcdFNjcmlwdExvYWRlci5TY3JpcHRMb2FkZXIuYWRkKHBsdWdpblVybCArIFwiL1wiICsgc2NyaXB0KTtcblx0XHRcdH0pO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBMb2FkcyBhbiBhZGQtb24gZnJvbSBhIHNwZWNpZmljIHVybC5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgbG9hZFxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIFNob3J0IG5hbWUgb2YgdGhlIGFkZC1vbiB0aGF0IGdldHMgbG9hZGVkLlxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBhZGRPblVybCBVUkwgdG8gdGhlIGFkZC1vbiB0aGF0IHdpbGwgZ2V0IGxvYWRlZC5cblx0XHQgKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFjayBPcHRpb25hbCBjYWxsYmFjayB0byBleGVjdXRlIG9uZXMgdGhlIGFkZC1vbiBpcyBsb2FkZWQuXG5cdFx0ICogQHBhcmFtIHtPYmplY3R9IHNjb3BlIE9wdGlvbmFsIHNjb3BlIHRvIGV4ZWN1dGUgdGhlIGNhbGxiYWNrIGluLlxuXHRcdCAqIEBleGFtcGxlXG5cdFx0ICogLy8gTG9hZHMgYSBwbHVnaW4gZnJvbSBhbiBleHRlcm5hbCBVUkxcblx0XHQgKiB0aW55bWNlLlBsdWdpbk1hbmFnZXIubG9hZCgnbXlwbHVnaW4nLCAnL3NvbWUvZGlyL3NvbWVwbHVnaW4vcGx1Z2luLmpzJyk7XG5cdFx0ICpcblx0XHQgKiAvLyBJbml0aWFsaXplIFRpbnlNQ0Vcblx0XHQgKiB0aW55bWNlLmluaXQoe1xuXHRcdCAqICAuLi5cblx0XHQgKiAgcGx1Z2luczogJy1teXBsdWdpbicgLy8gRG9uJ3QgdHJ5IHRvIGxvYWQgaXQgYWdhaW5cblx0XHQgKiB9KTtcblx0XHQgKi9cblx0XHRsb2FkOiBmdW5jdGlvbihuYW1lLCBhZGRPblVybCwgY2FsbGJhY2ssIHNjb3BlKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIHVybCA9IGFkZE9uVXJsO1xuXG5cdFx0XHRmdW5jdGlvbiBsb2FkRGVwZW5kZW5jaWVzKCkge1xuXHRcdFx0XHR2YXIgZGVwZW5kZW5jaWVzID0gc2VsZi5kZXBlbmRlbmNpZXMobmFtZSk7XG5cblx0XHRcdFx0ZWFjaChkZXBlbmRlbmNpZXMsIGZ1bmN0aW9uKGRlcCkge1xuXHRcdFx0XHRcdHZhciBuZXdVcmwgPSBzZWxmLmNyZWF0ZVVybChhZGRPblVybCwgZGVwKTtcblxuXHRcdFx0XHRcdHNlbGYubG9hZChuZXdVcmwucmVzb3VyY2UsIG5ld1VybCwgdW5kZWZpbmVkLCB1bmRlZmluZWQpO1xuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHRpZiAoY2FsbGJhY2spIHtcblx0XHRcdFx0XHRpZiAoc2NvcGUpIHtcblx0XHRcdFx0XHRcdGNhbGxiYWNrLmNhbGwoc2NvcGUpO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRjYWxsYmFjay5jYWxsKFNjcmlwdExvYWRlcik7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmIChzZWxmLnVybHNbbmFtZV0pIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mIGFkZE9uVXJsID09PSBcIm9iamVjdFwiKSB7XG5cdFx0XHRcdHVybCA9IGFkZE9uVXJsLnByZWZpeCArIGFkZE9uVXJsLnJlc291cmNlICsgYWRkT25Vcmwuc3VmZml4O1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAodXJsLmluZGV4T2YoJy8nKSAhPT0gMCAmJiB1cmwuaW5kZXhPZignOi8vJykgPT0gLTEpIHtcblx0XHRcdFx0dXJsID0gQWRkT25NYW5hZ2VyLmJhc2VVUkwgKyAnLycgKyB1cmw7XG5cdFx0XHR9XG5cblx0XHRcdHNlbGYudXJsc1tuYW1lXSA9IHVybC5zdWJzdHJpbmcoMCwgdXJsLmxhc3RJbmRleE9mKCcvJykpO1xuXG5cdFx0XHRpZiAoc2VsZi5sb29rdXBbbmFtZV0pIHtcblx0XHRcdFx0bG9hZERlcGVuZGVuY2llcygpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0U2NyaXB0TG9hZGVyLlNjcmlwdExvYWRlci5hZGQodXJsLCBsb2FkRGVwZW5kZW5jaWVzLCBzY29wZSk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdEFkZE9uTWFuYWdlci5QbHVnaW5NYW5hZ2VyID0gbmV3IEFkZE9uTWFuYWdlcigpO1xuXHRBZGRPbk1hbmFnZXIuVGhlbWVNYW5hZ2VyID0gbmV3IEFkZE9uTWFuYWdlcigpO1xuXG5cdHJldHVybiBBZGRPbk1hbmFnZXI7XG59KTtcblxuLyoqXG4gKiBUaW55TUNFIHRoZW1lIGNsYXNzLlxuICpcbiAqIEBjbGFzcyB0aW55bWNlLlRoZW1lXG4gKi9cblxuLyoqXG4gKiBUaGlzIG1ldGhvZCBpcyByZXNwb25zaWJsZSBmb3IgcmVuZGVyaW5nL2dlbmVyYXRpbmcgdGhlIG92ZXJhbGwgdXNlciBpbnRlcmZhY2Ugd2l0aCB0b29sYmFycywgYnV0dG9ucywgaWZyYW1lIGNvbnRhaW5lcnMgZXRjLlxuICpcbiAqIEBtZXRob2QgcmVuZGVyVUlcbiAqIEBwYXJhbSB7T2JqZWN0fSBvYmogT2JqZWN0IHBhcmFtZXRlciBjb250YWluaW5nIHRoZSB0YXJnZXROb2RlIERPTSBub2RlIHRoYXQgd2lsbCBiZSByZXBsYWNlZCB2aXN1YWxseSB3aXRoIGFuIGVkaXRvciBpbnN0YW5jZS5cbiAqIEByZXR1cm4ge09iamVjdH0gYW4gb2JqZWN0IHdpdGggaXRlbXMgbGlrZSBpZnJhbWVDb250YWluZXIsIGVkaXRvckNvbnRhaW5lciwgc2l6ZUNvbnRhaW5lciwgZGVsdGFXaWR0aCwgZGVsdGFIZWlnaHQuXG4gKi9cblxuLyoqXG4gKiBQbHVnaW4gYmFzZSBjbGFzcywgdGhpcyBpcyBhIHBzZXVkbyBjbGFzcyB0aGF0IGRlc2NyaWJlcyBob3cgYSBwbHVnaW4gaXMgdG8gYmUgY3JlYXRlZCBmb3IgVGlueU1DRS4gVGhlIG1ldGhvZHMgYmVsb3cgYXJlIGFsbCBvcHRpb25hbC5cbiAqXG4gKiBAY2xhc3MgdGlueW1jZS5QbHVnaW5cbiAqIEBleGFtcGxlXG4gKiB0aW55bWNlLlBsdWdpbk1hbmFnZXIuYWRkKCdleGFtcGxlJywgZnVuY3Rpb24oZWRpdG9yLCB1cmwpIHtcbiAqICAgICAvLyBBZGQgYSBidXR0b24gdGhhdCBvcGVucyBhIHdpbmRvd1xuICogICAgIGVkaXRvci5hZGRCdXR0b24oJ2V4YW1wbGUnLCB7XG4gKiAgICAgICAgIHRleHQ6ICdNeSBidXR0b24nLFxuICogICAgICAgICBpY29uOiBmYWxzZSxcbiAqICAgICAgICAgb25jbGljazogZnVuY3Rpb24oKSB7XG4gKiAgICAgICAgICAgICAvLyBPcGVuIHdpbmRvd1xuICogICAgICAgICAgICAgZWRpdG9yLndpbmRvd01hbmFnZXIub3Blbih7XG4gKiAgICAgICAgICAgICAgICAgdGl0bGU6ICdFeGFtcGxlIHBsdWdpbicsXG4gKiAgICAgICAgICAgICAgICAgYm9keTogW1xuICogICAgICAgICAgICAgICAgICAgICB7dHlwZTogJ3RleHRib3gnLCBuYW1lOiAndGl0bGUnLCBsYWJlbDogJ1RpdGxlJ31cbiAqICAgICAgICAgICAgICAgICBdLFxuICogICAgICAgICAgICAgICAgIG9uc3VibWl0OiBmdW5jdGlvbihlKSB7XG4gKiAgICAgICAgICAgICAgICAgICAgIC8vIEluc2VydCBjb250ZW50IHdoZW4gdGhlIHdpbmRvdyBmb3JtIGlzIHN1Ym1pdHRlZFxuICogICAgICAgICAgICAgICAgICAgICBlZGl0b3IuaW5zZXJ0Q29udGVudCgnVGl0bGU6ICcgKyBlLmRhdGEudGl0bGUpO1xuICogICAgICAgICAgICAgICAgIH1cbiAqICAgICAgICAgICAgIH0pO1xuICogICAgICAgICB9XG4gKiAgICAgfSk7XG4gKlxuICogICAgIC8vIEFkZHMgYSBtZW51IGl0ZW0gdG8gdGhlIHRvb2xzIG1lbnVcbiAqICAgICBlZGl0b3IuYWRkTWVudUl0ZW0oJ2V4YW1wbGUnLCB7XG4gKiAgICAgICAgIHRleHQ6ICdFeGFtcGxlIHBsdWdpbicsXG4gKiAgICAgICAgIGNvbnRleHQ6ICd0b29scycsXG4gKiAgICAgICAgIG9uY2xpY2s6IGZ1bmN0aW9uKCkge1xuICogICAgICAgICAgICAgLy8gT3BlbiB3aW5kb3cgd2l0aCBhIHNwZWNpZmljIHVybFxuICogICAgICAgICAgICAgZWRpdG9yLndpbmRvd01hbmFnZXIub3Blbih7XG4gKiAgICAgICAgICAgICAgICAgdGl0bGU6ICdUaW55TUNFIHNpdGUnLFxuICogICAgICAgICAgICAgICAgIHVybDogJ2h0dHA6Ly93d3cudGlueW1jZS5jb20nLFxuICogICAgICAgICAgICAgICAgIHdpZHRoOiA4MDAsXG4gKiAgICAgICAgICAgICAgICAgaGVpZ2h0OiA2MDAsXG4gKiAgICAgICAgICAgICAgICAgYnV0dG9uczogW3tcbiAqICAgICAgICAgICAgICAgICAgICAgdGV4dDogJ0Nsb3NlJyxcbiAqICAgICAgICAgICAgICAgICAgICAgb25jbGljazogJ2Nsb3NlJ1xuICogICAgICAgICAgICAgICAgIH1dXG4gKiAgICAgICAgICAgICB9KTtcbiAqICAgICAgICAgfVxuICogICAgIH0pO1xuICogfSk7XG4gKi9cblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL2RvbS9Ob2RlVHlwZS5qc1xuXG4vKipcbiAqIE5vZGVUeXBlLmpzXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgTEdQTCBMaWNlbnNlLlxuICogQ29weXJpZ2h0IChjKSAxOTk5LTIwMTUgRXBob3ggQ29ycC4gQWxsIHJpZ2h0cyByZXNlcnZlZFxuICpcbiAqIExpY2Vuc2U6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vbGljZW5zZVxuICogQ29udHJpYnV0aW5nOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2NvbnRyaWJ1dGluZ1xuICovXG5cbi8qKlxuICogQ29udGFpbnMgdmFyaW91cyBub2RlIHZhbGlkYXRpb24gZnVuY3Rpb25zLlxuICpcbiAqIEBwcml2YXRlXG4gKiBAY2xhc3MgdGlueW1jZS5kb20uTm9kZVR5cGVcbiAqL1xuZGVmaW5lKFwidGlueW1jZS9kb20vTm9kZVR5cGVcIiwgW10sIGZ1bmN0aW9uKCkge1xuXHRmdW5jdGlvbiBpc05vZGVUeXBlKHR5cGUpIHtcblx0XHRyZXR1cm4gZnVuY3Rpb24obm9kZSkge1xuXHRcdFx0cmV0dXJuICEhbm9kZSAmJiBub2RlLm5vZGVUeXBlID09IHR5cGU7XG5cdFx0fTtcblx0fVxuXG5cdHZhciBpc0VsZW1lbnQgPSBpc05vZGVUeXBlKDEpO1xuXG5cdGZ1bmN0aW9uIG1hdGNoTm9kZU5hbWVzKG5hbWVzKSB7XG5cdFx0bmFtZXMgPSBuYW1lcy50b0xvd2VyQ2FzZSgpLnNwbGl0KCcgJyk7XG5cblx0XHRyZXR1cm4gZnVuY3Rpb24obm9kZSkge1xuXHRcdFx0dmFyIGksIG5hbWU7XG5cblx0XHRcdGlmIChub2RlICYmIG5vZGUubm9kZVR5cGUpIHtcblx0XHRcdFx0bmFtZSA9IG5vZGUubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtcblxuXHRcdFx0XHRmb3IgKGkgPSAwOyBpIDwgbmFtZXMubGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0XHRpZiAobmFtZSA9PT0gbmFtZXNbaV0pIHtcblx0XHRcdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fTtcblx0fVxuXG5cdGZ1bmN0aW9uIG1hdGNoU3R5bGVWYWx1ZXMobmFtZSwgdmFsdWVzKSB7XG5cdFx0dmFsdWVzID0gdmFsdWVzLnRvTG93ZXJDYXNlKCkuc3BsaXQoJyAnKTtcblxuXHRcdHJldHVybiBmdW5jdGlvbihub2RlKSB7XG5cdFx0XHR2YXIgaSwgY3NzVmFsdWU7XG5cblx0XHRcdGlmIChpc0VsZW1lbnQobm9kZSkpIHtcblx0XHRcdFx0Zm9yIChpID0gMDsgaSA8IHZhbHVlcy5sZW5ndGg7IGkrKykge1xuXHRcdFx0XHRcdGNzc1ZhbHVlID0gZ2V0Q29tcHV0ZWRTdHlsZShub2RlLCBudWxsKS5nZXRQcm9wZXJ0eVZhbHVlKG5hbWUpO1xuXHRcdFx0XHRcdGlmIChjc3NWYWx1ZSA9PT0gdmFsdWVzW2ldKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH07XG5cdH1cblxuXHRmdW5jdGlvbiBoYXNQcm9wVmFsdWUocHJvcE5hbWUsIHByb3BWYWx1ZSkge1xuXHRcdHJldHVybiBmdW5jdGlvbihub2RlKSB7XG5cdFx0XHRyZXR1cm4gaXNFbGVtZW50KG5vZGUpICYmIG5vZGVbcHJvcE5hbWVdID09PSBwcm9wVmFsdWU7XG5cdFx0fTtcblx0fVxuXG5cdGZ1bmN0aW9uIGhhc0F0dHJpYnV0ZVZhbHVlKGF0dHJOYW1lLCBhdHRyVmFsdWUpIHtcblx0XHRyZXR1cm4gZnVuY3Rpb24obm9kZSkge1xuXHRcdFx0cmV0dXJuIGlzRWxlbWVudChub2RlKSAmJiBub2RlLmdldEF0dHJpYnV0ZShhdHRyTmFtZSkgPT09IGF0dHJWYWx1ZTtcblx0XHR9O1xuXHR9XG5cblx0ZnVuY3Rpb24gaXNCb2d1cyhub2RlKSB7XG5cdFx0cmV0dXJuIGlzRWxlbWVudChub2RlKSAmJiBub2RlLmhhc0F0dHJpYnV0ZSgnZGF0YS1tY2UtYm9ndXMnKTtcblx0fVxuXG5cdGZ1bmN0aW9uIGhhc0NvbnRlbnRFZGl0YWJsZVN0YXRlKHZhbHVlKSB7XG5cdFx0cmV0dXJuIGZ1bmN0aW9uKG5vZGUpIHtcblx0XHRcdGlmIChpc0VsZW1lbnQobm9kZSkpIHtcblx0XHRcdFx0aWYgKG5vZGUuY29udGVudEVkaXRhYmxlID09PSB2YWx1ZSkge1xuXHRcdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKG5vZGUuZ2V0QXR0cmlidXRlKCdkYXRhLW1jZS1jb250ZW50ZWRpdGFibGUnKSA9PT0gdmFsdWUpIHtcblx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fTtcblx0fVxuXG5cdHJldHVybiB7XG5cdFx0aXNUZXh0OiBpc05vZGVUeXBlKDMpLFxuXHRcdGlzRWxlbWVudDogaXNFbGVtZW50LFxuXHRcdGlzQ29tbWVudDogaXNOb2RlVHlwZSg4KSxcblx0XHRpc0JyOiBtYXRjaE5vZGVOYW1lcygnYnInKSxcblx0XHRpc0NvbnRlbnRFZGl0YWJsZVRydWU6IGhhc0NvbnRlbnRFZGl0YWJsZVN0YXRlKCd0cnVlJyksXG5cdFx0aXNDb250ZW50RWRpdGFibGVGYWxzZTogaGFzQ29udGVudEVkaXRhYmxlU3RhdGUoJ2ZhbHNlJyksXG5cdFx0bWF0Y2hOb2RlTmFtZXM6IG1hdGNoTm9kZU5hbWVzLFxuXHRcdGhhc1Byb3BWYWx1ZTogaGFzUHJvcFZhbHVlLFxuXHRcdGhhc0F0dHJpYnV0ZVZhbHVlOiBoYXNBdHRyaWJ1dGVWYWx1ZSxcblx0XHRtYXRjaFN0eWxlVmFsdWVzOiBtYXRjaFN0eWxlVmFsdWVzLFxuXHRcdGlzQm9ndXM6IGlzQm9ndXNcblx0fTtcbn0pO1xuXG4vLyBJbmNsdWRlZCBmcm9tOiBqcy90aW55bWNlL2NsYXNzZXMvdGV4dC9ad3NwLmpzXG5cbi8qKlxuICogWndzcC5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE1IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKipcbiAqIFV0aWxpdHkgZnVuY3Rpb25zIGZvciB3b3JraW5nIHdpdGggemVybyB3aWR0aCBzcGFjZVxuICogY2hhcmFjdGVycyB1c2VkIGFzIGNoYXJhY3RlciBjb250YWluZXJzIGV0Yy5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQGNsYXNzIHRpbnltY2UudGV4dC5ad3NwXG4gKiBAZXhhbXBsZVxuICogdmFyIGlzWndzcCA9IFp3c3AuaXNad3NwKCdcXHVGRUZGJyk7XG4gKiB2YXIgYWJjID0gWndzcC50cmltKCdhXFx1RkVGRmMnKTtcbiAqL1xuZGVmaW5lKFwidGlueW1jZS90ZXh0L1p3c3BcIiwgW10sIGZ1bmN0aW9uKCkge1xuXHR2YXIgWldTUCA9ICdcXHVGRUZGJztcblxuXHRmdW5jdGlvbiBpc1p3c3AoY2hyKSB7XG5cdFx0cmV0dXJuIGNociA9PSBaV1NQO1xuXHR9XG5cblx0ZnVuY3Rpb24gdHJpbShzdHIpIHtcblx0XHRyZXR1cm4gc3RyLnJlcGxhY2UobmV3IFJlZ0V4cChaV1NQLCAnZycpLCAnJyk7XG5cdH1cblxuXHRyZXR1cm4ge1xuXHRcdGlzWndzcDogaXNad3NwLFxuXHRcdFpXU1A6IFpXU1AsXG5cdFx0dHJpbTogdHJpbVxuXHR9O1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy9jYXJldC9DYXJldENvbnRhaW5lci5qc1xuXG4vKipcbiAqIENhcmV0Q29udGFpbmVyLmpzXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgTEdQTCBMaWNlbnNlLlxuICogQ29weXJpZ2h0IChjKSAxOTk5LTIwMTUgRXBob3ggQ29ycC4gQWxsIHJpZ2h0cyByZXNlcnZlZFxuICpcbiAqIExpY2Vuc2U6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vbGljZW5zZVxuICogQ29udHJpYnV0aW5nOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2NvbnRyaWJ1dGluZ1xuICovXG5cbi8qKlxuICogVGhpcyBtb2R1bGUgaGFuZGxlcyBjYXJldCBjb250YWluZXJzLiBBIGNhcmV0IGNvbnRhaW5lciBpcyBhIG5vZGUgdGhhdFxuICogaG9sZHMgdGhlIGNhcmV0IGZvciBwb3NpdGlvbmFsIHB1cnBvc2VzLlxuICpcbiAqIEBwcml2YXRlXG4gKiBAY2xhc3MgdGlueW1jZS5jYXJldC5DYXJldENvbnRhaW5lclxuICovXG5kZWZpbmUoXCJ0aW55bWNlL2NhcmV0L0NhcmV0Q29udGFpbmVyXCIsIFtcblx0XCJ0aW55bWNlL2RvbS9Ob2RlVHlwZVwiLFxuXHRcInRpbnltY2UvdGV4dC9ad3NwXCJcbl0sIGZ1bmN0aW9uKE5vZGVUeXBlLCBad3NwKSB7XG5cdHZhciBpc0VsZW1lbnQgPSBOb2RlVHlwZS5pc0VsZW1lbnQsXG5cdFx0aXNUZXh0ID0gTm9kZVR5cGUuaXNUZXh0O1xuXG5cdGZ1bmN0aW9uIGlzQ2FyZXRDb250YWluZXJCbG9jayhub2RlKSB7XG5cdFx0aWYgKGlzVGV4dChub2RlKSkge1xuXHRcdFx0bm9kZSA9IG5vZGUucGFyZW50Tm9kZTtcblx0XHR9XG5cblx0XHRyZXR1cm4gaXNFbGVtZW50KG5vZGUpICYmIG5vZGUuaGFzQXR0cmlidXRlKCdkYXRhLW1jZS1jYXJldCcpO1xuXHR9XG5cblx0ZnVuY3Rpb24gaXNDYXJldENvbnRhaW5lcklubGluZShub2RlKSB7XG5cdFx0cmV0dXJuIGlzVGV4dChub2RlKSAmJiBad3NwLmlzWndzcChub2RlLmRhdGEpO1xuXHR9XG5cblx0ZnVuY3Rpb24gaXNDYXJldENvbnRhaW5lcihub2RlKSB7XG5cdFx0cmV0dXJuIGlzQ2FyZXRDb250YWluZXJCbG9jayhub2RlKSB8fCBpc0NhcmV0Q29udGFpbmVySW5saW5lKG5vZGUpO1xuXHR9XG5cblx0ZnVuY3Rpb24gcmVtb3ZlTm9kZShub2RlKSB7XG5cdFx0dmFyIHBhcmVudE5vZGUgPSBub2RlLnBhcmVudE5vZGU7XG5cdFx0aWYgKHBhcmVudE5vZGUpIHtcblx0XHRcdHBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobm9kZSk7XG5cdFx0fVxuXHR9XG5cblx0ZnVuY3Rpb24gZ2V0Tm9kZVZhbHVlKG5vZGUpIHtcblx0XHR0cnkge1xuXHRcdFx0cmV0dXJuIG5vZGUubm9kZVZhbHVlO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQvLyBJRSBzb21ldGltZXMgcHJvZHVjZXMgXCJJbnZhbGlkIGFyZ3VtZW50XCIgb24gbm9kZXNcblx0XHRcdHJldHVybiBcIlwiO1xuXHRcdH1cblx0fVxuXG5cdGZ1bmN0aW9uIHNldE5vZGVWYWx1ZShub2RlLCB0ZXh0KSB7XG5cdFx0aWYgKHRleHQubGVuZ3RoID09PSAwKSB7XG5cdFx0XHRyZW1vdmVOb2RlKG5vZGUpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRub2RlLm5vZGVWYWx1ZSA9IHRleHQ7XG5cdFx0fVxuXHR9XG5cblx0ZnVuY3Rpb24gaW5zZXJ0SW5saW5lKG5vZGUsIGJlZm9yZSkge1xuXHRcdHZhciBkb2MsIHNpYmxpbmcsIHRleHROb2RlLCBwYXJlbnROb2RlO1xuXG5cdFx0ZG9jID0gbm9kZS5vd25lckRvY3VtZW50O1xuXHRcdHRleHROb2RlID0gZG9jLmNyZWF0ZVRleHROb2RlKFp3c3AuWldTUCk7XG5cdFx0cGFyZW50Tm9kZSA9IG5vZGUucGFyZW50Tm9kZTtcblxuXHRcdGlmICghYmVmb3JlKSB7XG5cdFx0XHRzaWJsaW5nID0gbm9kZS5uZXh0U2libGluZztcblx0XHRcdGlmIChpc1RleHQoc2libGluZykpIHtcblx0XHRcdFx0aWYgKGlzQ2FyZXRDb250YWluZXIoc2libGluZykpIHtcblx0XHRcdFx0XHRyZXR1cm4gc2libGluZztcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChzdGFydHNXaXRoQ2FyZXRDb250YWluZXIoc2libGluZykpIHtcblx0XHRcdFx0XHRzaWJsaW5nLnNwbGl0VGV4dCgxKTtcblx0XHRcdFx0XHRyZXR1cm4gc2libGluZztcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAobm9kZS5uZXh0U2libGluZykge1xuXHRcdFx0XHRwYXJlbnROb2RlLmluc2VydEJlZm9yZSh0ZXh0Tm9kZSwgbm9kZS5uZXh0U2libGluZyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRwYXJlbnROb2RlLmFwcGVuZENoaWxkKHRleHROb2RlKTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0c2libGluZyA9IG5vZGUucHJldmlvdXNTaWJsaW5nO1xuXHRcdFx0aWYgKGlzVGV4dChzaWJsaW5nKSkge1xuXHRcdFx0XHRpZiAoaXNDYXJldENvbnRhaW5lcihzaWJsaW5nKSkge1xuXHRcdFx0XHRcdHJldHVybiBzaWJsaW5nO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKGVuZHNXaXRoQ2FyZXRDb250YWluZXIoc2libGluZykpIHtcblx0XHRcdFx0XHRyZXR1cm4gc2libGluZy5zcGxpdFRleHQoc2libGluZy5kYXRhLmxlbmd0aCAtIDEpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHRleHROb2RlLCBub2RlKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gdGV4dE5vZGU7XG5cdH1cblxuXHRmdW5jdGlvbiBjcmVhdGVCb2d1c0JyKCkge1xuXHRcdHZhciBiciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2JyJyk7XG5cdFx0YnIuc2V0QXR0cmlidXRlKCdkYXRhLW1jZS1ib2d1cycsICcxJyk7XG5cdFx0cmV0dXJuIGJyO1xuXHR9XG5cblx0ZnVuY3Rpb24gaW5zZXJ0QmxvY2soYmxvY2tOYW1lLCBub2RlLCBiZWZvcmUpIHtcblx0XHR2YXIgZG9jLCBibG9ja05vZGUsIHBhcmVudE5vZGU7XG5cblx0XHRkb2MgPSBub2RlLm93bmVyRG9jdW1lbnQ7XG5cdFx0YmxvY2tOb2RlID0gZG9jLmNyZWF0ZUVsZW1lbnQoYmxvY2tOYW1lKTtcblx0XHRibG9ja05vZGUuc2V0QXR0cmlidXRlKCdkYXRhLW1jZS1jYXJldCcsIGJlZm9yZSA/ICdiZWZvcmUnIDogJ2FmdGVyJyk7XG5cdFx0YmxvY2tOb2RlLnNldEF0dHJpYnV0ZSgnZGF0YS1tY2UtYm9ndXMnLCAnYWxsJyk7XG5cdFx0YmxvY2tOb2RlLmFwcGVuZENoaWxkKGNyZWF0ZUJvZ3VzQnIoKSk7XG5cdFx0cGFyZW50Tm9kZSA9IG5vZGUucGFyZW50Tm9kZTtcblxuXHRcdGlmICghYmVmb3JlKSB7XG5cdFx0XHRpZiAobm9kZS5uZXh0U2libGluZykge1xuXHRcdFx0XHRwYXJlbnROb2RlLmluc2VydEJlZm9yZShibG9ja05vZGUsIG5vZGUubmV4dFNpYmxpbmcpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0cGFyZW50Tm9kZS5hcHBlbmRDaGlsZChibG9ja05vZGUpO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRwYXJlbnROb2RlLmluc2VydEJlZm9yZShibG9ja05vZGUsIG5vZGUpO1xuXHRcdH1cblxuXHRcdHJldHVybiBibG9ja05vZGU7XG5cdH1cblxuXHRmdW5jdGlvbiBoYXNDb250ZW50KG5vZGUpIHtcblx0XHRyZXR1cm4gbm9kZS5maXJzdENoaWxkICE9PSBub2RlLmxhc3RDaGlsZCB8fCAhTm9kZVR5cGUuaXNCcihub2RlLmZpcnN0Q2hpbGQpO1xuXHR9XG5cblx0ZnVuY3Rpb24gcmVtb3ZlKGNhcmV0Q29udGFpbmVyTm9kZSkge1xuXHRcdGlmIChpc0VsZW1lbnQoY2FyZXRDb250YWluZXJOb2RlKSAmJiBpc0NhcmV0Q29udGFpbmVyKGNhcmV0Q29udGFpbmVyTm9kZSkpIHtcblx0XHRcdGlmIChoYXNDb250ZW50KGNhcmV0Q29udGFpbmVyTm9kZSkpIHtcblx0XHRcdFx0Y2FyZXRDb250YWluZXJOb2RlLnJlbW92ZUF0dHJpYnV0ZSgnZGF0YS1tY2UtY2FyZXQnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHJlbW92ZU5vZGUoY2FyZXRDb250YWluZXJOb2RlKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoaXNUZXh0KGNhcmV0Q29udGFpbmVyTm9kZSkpIHtcblx0XHRcdHZhciB0ZXh0ID0gWndzcC50cmltKGdldE5vZGVWYWx1ZShjYXJldENvbnRhaW5lck5vZGUpKTtcblx0XHRcdHNldE5vZGVWYWx1ZShjYXJldENvbnRhaW5lck5vZGUsIHRleHQpO1xuXHRcdH1cblx0fVxuXG5cdGZ1bmN0aW9uIHN0YXJ0c1dpdGhDYXJldENvbnRhaW5lcihub2RlKSB7XG5cdFx0cmV0dXJuIGlzVGV4dChub2RlKSAmJiBub2RlLmRhdGFbMF0gPT0gWndzcC5aV1NQO1xuXHR9XG5cblx0ZnVuY3Rpb24gZW5kc1dpdGhDYXJldENvbnRhaW5lcihub2RlKSB7XG5cdFx0cmV0dXJuIGlzVGV4dChub2RlKSAmJiBub2RlLmRhdGFbbm9kZS5kYXRhLmxlbmd0aCAtIDFdID09IFp3c3AuWldTUDtcblx0fVxuXG5cdGZ1bmN0aW9uIHRyaW1Cb2d1c0JyKGVsbSkge1xuXHRcdHZhciBicnMgPSBlbG0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2JyJyk7XG5cdFx0dmFyIGxhc3RCciA9IGJyc1ticnMubGVuZ3RoIC0gMV07XG5cdFx0aWYgKE5vZGVUeXBlLmlzQm9ndXMobGFzdEJyKSkge1xuXHRcdFx0bGFzdEJyLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobGFzdEJyKTtcblx0XHR9XG5cdH1cblxuXHRmdW5jdGlvbiBzaG93Q2FyZXRDb250YWluZXJCbG9jayhjYXJldENvbnRhaW5lcikge1xuXHRcdGlmIChjYXJldENvbnRhaW5lciAmJiBjYXJldENvbnRhaW5lci5oYXNBdHRyaWJ1dGUoJ2RhdGEtbWNlLWNhcmV0JykpIHtcblx0XHRcdHRyaW1Cb2d1c0JyKGNhcmV0Q29udGFpbmVyKTtcblx0XHRcdGNhcmV0Q29udGFpbmVyLnJlbW92ZUF0dHJpYnV0ZSgnZGF0YS1tY2UtY2FyZXQnKTtcblx0XHRcdGNhcmV0Q29udGFpbmVyLnJlbW92ZUF0dHJpYnV0ZSgnZGF0YS1tY2UtYm9ndXMnKTtcblx0XHRcdGNhcmV0Q29udGFpbmVyLnJlbW92ZUF0dHJpYnV0ZSgnc3R5bGUnKTtcblx0XHRcdGNhcmV0Q29udGFpbmVyLnJlbW92ZUF0dHJpYnV0ZSgnX21vel9hYnNwb3MnKTtcblx0XHRcdHJldHVybiBjYXJldENvbnRhaW5lcjtcblx0XHR9XG5cblx0XHRyZXR1cm4gbnVsbDtcblx0fVxuXG5cdHJldHVybiB7XG5cdFx0aXNDYXJldENvbnRhaW5lcjogaXNDYXJldENvbnRhaW5lcixcblx0XHRpc0NhcmV0Q29udGFpbmVyQmxvY2s6IGlzQ2FyZXRDb250YWluZXJCbG9jayxcblx0XHRpc0NhcmV0Q29udGFpbmVySW5saW5lOiBpc0NhcmV0Q29udGFpbmVySW5saW5lLFxuXHRcdHNob3dDYXJldENvbnRhaW5lckJsb2NrOiBzaG93Q2FyZXRDb250YWluZXJCbG9jayxcblx0XHRpbnNlcnRJbmxpbmU6IGluc2VydElubGluZSxcblx0XHRpbnNlcnRCbG9jazogaW5zZXJ0QmxvY2ssXG5cdFx0aGFzQ29udGVudDogaGFzQ29udGVudCxcblx0XHRyZW1vdmU6IHJlbW92ZSxcblx0XHRzdGFydHNXaXRoQ2FyZXRDb250YWluZXI6IHN0YXJ0c1dpdGhDYXJldENvbnRhaW5lcixcblx0XHRlbmRzV2l0aENhcmV0Q29udGFpbmVyOiBlbmRzV2l0aENhcmV0Q29udGFpbmVyXG5cdH07XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL2RvbS9SYW5nZVV0aWxzLmpzXG5cbi8qKlxuICogUmFuZ2VVdGlscy5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE1IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKipcbiAqIFRoaXMgY2xhc3MgY29udGFpbnMgYSBmZXcgdXRpbGl0eSBtZXRob2RzIGZvciByYW5nZXMuXG4gKlxuICogQGNsYXNzIHRpbnltY2UuZG9tLlJhbmdlVXRpbHNcbiAqL1xuZGVmaW5lKFwidGlueW1jZS9kb20vUmFuZ2VVdGlsc1wiLCBbXG5cdFwidGlueW1jZS91dGlsL1Rvb2xzXCIsXG5cdFwidGlueW1jZS9kb20vVHJlZVdhbGtlclwiLFxuXHRcInRpbnltY2UvZG9tL05vZGVUeXBlXCIsXG5cdFwidGlueW1jZS9kb20vUmFuZ2VcIixcblx0XCJ0aW55bWNlL2NhcmV0L0NhcmV0Q29udGFpbmVyXCJcbl0sIGZ1bmN0aW9uKFRvb2xzLCBUcmVlV2Fsa2VyLCBOb2RlVHlwZSwgUmFuZ2UsIENhcmV0Q29udGFpbmVyKSB7XG5cdHZhciBlYWNoID0gVG9vbHMuZWFjaCxcblx0XHRpc0NvbnRlbnRFZGl0YWJsZVRydWUgPSBOb2RlVHlwZS5pc0NvbnRlbnRFZGl0YWJsZVRydWUsXG5cdFx0aXNDb250ZW50RWRpdGFibGVGYWxzZSA9IE5vZGVUeXBlLmlzQ29udGVudEVkaXRhYmxlRmFsc2UsXG5cdFx0aXNDYXJldENvbnRhaW5lciA9IENhcmV0Q29udGFpbmVyLmlzQ2FyZXRDb250YWluZXI7XG5cblx0ZnVuY3Rpb24gaGFzQ2VQcm9wZXJ0eShub2RlKSB7XG5cdFx0cmV0dXJuIGlzQ29udGVudEVkaXRhYmxlVHJ1ZShub2RlKSB8fCBpc0NvbnRlbnRFZGl0YWJsZUZhbHNlKG5vZGUpO1xuXHR9XG5cblx0ZnVuY3Rpb24gZ2V0RW5kQ2hpbGQoY29udGFpbmVyLCBpbmRleCkge1xuXHRcdHZhciBjaGlsZE5vZGVzID0gY29udGFpbmVyLmNoaWxkTm9kZXM7XG5cblx0XHRpbmRleC0tO1xuXG5cdFx0aWYgKGluZGV4ID4gY2hpbGROb2Rlcy5sZW5ndGggLSAxKSB7XG5cdFx0XHRpbmRleCA9IGNoaWxkTm9kZXMubGVuZ3RoIC0gMTtcblx0XHR9IGVsc2UgaWYgKGluZGV4IDwgMCkge1xuXHRcdFx0aW5kZXggPSAwO1xuXHRcdH1cblxuXHRcdHJldHVybiBjaGlsZE5vZGVzW2luZGV4XSB8fCBjb250YWluZXI7XG5cdH1cblxuXHRmdW5jdGlvbiBmaW5kUGFyZW50KG5vZGUsIHJvb3ROb2RlLCBwcmVkaWNhdGUpIHtcblx0XHR3aGlsZSAobm9kZSAmJiBub2RlICE9PSByb290Tm9kZSkge1xuXHRcdFx0aWYgKHByZWRpY2F0ZShub2RlKSkge1xuXHRcdFx0XHRyZXR1cm4gbm9kZTtcblx0XHRcdH1cblxuXHRcdFx0bm9kZSA9IG5vZGUucGFyZW50Tm9kZTtcblx0XHR9XG5cblx0XHRyZXR1cm4gbnVsbDtcblx0fVxuXG5cdGZ1bmN0aW9uIGhhc1BhcmVudChub2RlLCByb290Tm9kZSwgcHJlZGljYXRlKSB7XG5cdFx0cmV0dXJuIGZpbmRQYXJlbnQobm9kZSwgcm9vdE5vZGUsIHByZWRpY2F0ZSkgIT09IG51bGw7XG5cdH1cblxuXHRmdW5jdGlvbiBpc0Zvcm1hdHRlckNhcmV0KG5vZGUpIHtcblx0XHRyZXR1cm4gbm9kZS5pZCA9PT0gJ19tY2VfY2FyZXQnO1xuXHR9XG5cblx0ZnVuY3Rpb24gaXNDZUZhbHNlQ2FyZXRDb250YWluZXIobm9kZSwgcm9vdE5vZGUpIHtcblx0XHRyZXR1cm4gaXNDYXJldENvbnRhaW5lcihub2RlKSAmJiBoYXNQYXJlbnQobm9kZSwgcm9vdE5vZGUsIGlzRm9ybWF0dGVyQ2FyZXQpID09PSBmYWxzZTtcblx0fVxuXG5cdGZ1bmN0aW9uIFJhbmdlVXRpbHMoZG9tKSB7XG5cdFx0LyoqXG5cdFx0ICogV2Fsa3MgdGhlIHNwZWNpZmllZCByYW5nZSBsaWtlIG9iamVjdCBhbmQgZXhlY3V0ZXMgdGhlIGNhbGxiYWNrIGZvciBlYWNoIHNpYmxpbmcgY29sbGVjdGlvbiBpdCBmaW5kcy5cblx0XHQgKlxuXHRcdCAqIEBwcml2YXRlXG5cdFx0ICogQG1ldGhvZCB3YWxrXG5cdFx0ICogQHBhcmFtIHtPYmplY3R9IHJuZyBSYW5nZSBsaWtlIG9iamVjdC5cblx0XHQgKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBleGVjdXRlIGZvciBlYWNoIHNpYmxpbmcgY29sbGVjdGlvbi5cblx0XHQgKi9cblx0XHR0aGlzLndhbGsgPSBmdW5jdGlvbihybmcsIGNhbGxiYWNrKSB7XG5cdFx0XHR2YXIgc3RhcnRDb250YWluZXIgPSBybmcuc3RhcnRDb250YWluZXIsXG5cdFx0XHRcdHN0YXJ0T2Zmc2V0ID0gcm5nLnN0YXJ0T2Zmc2V0LFxuXHRcdFx0XHRlbmRDb250YWluZXIgPSBybmcuZW5kQ29udGFpbmVyLFxuXHRcdFx0XHRlbmRPZmZzZXQgPSBybmcuZW5kT2Zmc2V0LFxuXHRcdFx0XHRhbmNlc3Rvciwgc3RhcnRQb2ludCxcblx0XHRcdFx0ZW5kUG9pbnQsIG5vZGUsIHBhcmVudCwgc2libGluZ3MsIG5vZGVzO1xuXG5cdFx0XHQvLyBIYW5kbGUgdGFibGUgY2VsbCBzZWxlY3Rpb24gdGhlIHRhYmxlIHBsdWdpbiBlbmFibGVzXG5cdFx0XHQvLyB5b3UgdG8gZmFrZSBzZWxlY3QgdGFibGUgY2VsbHMgYW5kIHBlcmZvcm0gZm9ybWF0dGluZyBhY3Rpb25zIG9uIHRoZW1cblx0XHRcdG5vZGVzID0gZG9tLnNlbGVjdCgndGRbZGF0YS1tY2Utc2VsZWN0ZWRdLHRoW2RhdGEtbWNlLXNlbGVjdGVkXScpO1xuXHRcdFx0aWYgKG5vZGVzLmxlbmd0aCA+IDApIHtcblx0XHRcdFx0ZWFjaChub2RlcywgZnVuY3Rpb24obm9kZSkge1xuXHRcdFx0XHRcdGNhbGxiYWNrKFtub2RlXSk7XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0LyoqXG5cdFx0XHQgKiBFeGNsdWRlcyBzdGFydC9lbmQgdGV4dCBub2RlIGlmIHRoZXkgYXJlIG91dCBzaWRlIHRoZSByYW5nZVxuXHRcdFx0ICpcblx0XHRcdCAqIEBwcml2YXRlXG5cdFx0XHQgKiBAcGFyYW0ge0FycmF5fSBub2RlcyBOb2RlcyB0byBleGNsdWRlIGl0ZW1zIGZyb20uXG5cdFx0XHQgKiBAcmV0dXJuIHtBcnJheX0gQXJyYXkgd2l0aCBub2RlcyBleGNsdWRpbmcgdGhlIHN0YXJ0L2VuZCBjb250YWluZXIgaWYgbmVlZGVkLlxuXHRcdFx0ICovXG5cdFx0XHRmdW5jdGlvbiBleGNsdWRlKG5vZGVzKSB7XG5cdFx0XHRcdHZhciBub2RlO1xuXG5cdFx0XHRcdC8vIEZpcnN0IG5vZGUgaXMgZXhjbHVkZWRcblx0XHRcdFx0bm9kZSA9IG5vZGVzWzBdO1xuXHRcdFx0XHRpZiAobm9kZS5ub2RlVHlwZSA9PT0gMyAmJiBub2RlID09PSBzdGFydENvbnRhaW5lciAmJiBzdGFydE9mZnNldCA+PSBub2RlLm5vZGVWYWx1ZS5sZW5ndGgpIHtcblx0XHRcdFx0XHRub2Rlcy5zcGxpY2UoMCwgMSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBMYXN0IG5vZGUgaXMgZXhjbHVkZWRcblx0XHRcdFx0bm9kZSA9IG5vZGVzW25vZGVzLmxlbmd0aCAtIDFdO1xuXHRcdFx0XHRpZiAoZW5kT2Zmc2V0ID09PSAwICYmIG5vZGVzLmxlbmd0aCA+IDAgJiYgbm9kZSA9PT0gZW5kQ29udGFpbmVyICYmIG5vZGUubm9kZVR5cGUgPT09IDMpIHtcblx0XHRcdFx0XHRub2Rlcy5zcGxpY2Uobm9kZXMubGVuZ3RoIC0gMSwgMSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbm9kZXM7XG5cdFx0XHR9XG5cblx0XHRcdC8qKlxuXHRcdFx0ICogQ29sbGVjdHMgc2libGluZ3Ncblx0XHRcdCAqXG5cdFx0XHQgKiBAcHJpdmF0ZVxuXHRcdFx0ICogQHBhcmFtIHtOb2RlfSBub2RlIE5vZGUgdG8gY29sbGVjdCBzaWJsaW5ncyBmcm9tLlxuXHRcdFx0ICogQHBhcmFtIHtTdHJpbmd9IG5hbWUgTmFtZSBvZiB0aGUgc2libGluZyB0byBjaGVjayBmb3IuXG5cdFx0XHQgKiBAcGFyYW0ge05vZGV9IGVuZF9ub2RlXG5cdFx0XHQgKiBAcmV0dXJuIHtBcnJheX0gQXJyYXkgb2YgY29sbGVjdGVkIHNpYmxpbmdzLlxuXHRcdFx0ICovXG5cdFx0XHRmdW5jdGlvbiBjb2xsZWN0U2libGluZ3Mobm9kZSwgbmFtZSwgZW5kX25vZGUpIHtcblx0XHRcdFx0dmFyIHNpYmxpbmdzID0gW107XG5cblx0XHRcdFx0Zm9yICg7IG5vZGUgJiYgbm9kZSAhPSBlbmRfbm9kZTsgbm9kZSA9IG5vZGVbbmFtZV0pIHtcblx0XHRcdFx0XHRzaWJsaW5ncy5wdXNoKG5vZGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHNpYmxpbmdzO1xuXHRcdFx0fVxuXG5cdFx0XHQvKipcblx0XHRcdCAqIEZpbmQgYW4gZW5kIHBvaW50IHRoaXMgaXMgdGhlIG5vZGUganVzdCBiZWZvcmUgdGhlIGNvbW1vbiBhbmNlc3RvciByb290LlxuXHRcdFx0ICpcblx0XHRcdCAqIEBwcml2YXRlXG5cdFx0XHQgKiBAcGFyYW0ge05vZGV9IG5vZGUgTm9kZSB0byBzdGFydCBhdC5cblx0XHRcdCAqIEBwYXJhbSB7Tm9kZX0gcm9vdCBSb290L2FuY2VzdG9yIGVsZW1lbnQgdG8gc3RvcCBqdXN0IGJlZm9yZS5cblx0XHRcdCAqIEByZXR1cm4ge05vZGV9IE5vZGUganVzdCBiZWZvcmUgdGhlIHJvb3QgZWxlbWVudC5cblx0XHRcdCAqL1xuXHRcdFx0ZnVuY3Rpb24gZmluZEVuZFBvaW50KG5vZGUsIHJvb3QpIHtcblx0XHRcdFx0ZG8ge1xuXHRcdFx0XHRcdGlmIChub2RlLnBhcmVudE5vZGUgPT0gcm9vdCkge1xuXHRcdFx0XHRcdFx0cmV0dXJuIG5vZGU7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0bm9kZSA9IG5vZGUucGFyZW50Tm9kZTtcblx0XHRcdFx0fSB3aGlsZSAobm9kZSk7XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIHdhbGtCb3VuZGFyeShzdGFydF9ub2RlLCBlbmRfbm9kZSwgbmV4dCkge1xuXHRcdFx0XHR2YXIgc2libGluZ05hbWUgPSBuZXh0ID8gJ25leHRTaWJsaW5nJyA6ICdwcmV2aW91c1NpYmxpbmcnO1xuXG5cdFx0XHRcdGZvciAobm9kZSA9IHN0YXJ0X25vZGUsIHBhcmVudCA9IG5vZGUucGFyZW50Tm9kZTsgbm9kZSAmJiBub2RlICE9IGVuZF9ub2RlOyBub2RlID0gcGFyZW50KSB7XG5cdFx0XHRcdFx0cGFyZW50ID0gbm9kZS5wYXJlbnROb2RlO1xuXHRcdFx0XHRcdHNpYmxpbmdzID0gY29sbGVjdFNpYmxpbmdzKG5vZGUgPT0gc3RhcnRfbm9kZSA/IG5vZGUgOiBub2RlW3NpYmxpbmdOYW1lXSwgc2libGluZ05hbWUpO1xuXG5cdFx0XHRcdFx0aWYgKHNpYmxpbmdzLmxlbmd0aCkge1xuXHRcdFx0XHRcdFx0aWYgKCFuZXh0KSB7XG5cdFx0XHRcdFx0XHRcdHNpYmxpbmdzLnJldmVyc2UoKTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0Y2FsbGJhY2soZXhjbHVkZShzaWJsaW5ncykpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHQvLyBJZiBpbmRleCBiYXNlZCBzdGFydCBwb3NpdGlvbiB0aGVuIHJlc29sdmUgaXRcblx0XHRcdGlmIChzdGFydENvbnRhaW5lci5ub2RlVHlwZSA9PSAxICYmIHN0YXJ0Q29udGFpbmVyLmhhc0NoaWxkTm9kZXMoKSkge1xuXHRcdFx0XHRzdGFydENvbnRhaW5lciA9IHN0YXJ0Q29udGFpbmVyLmNoaWxkTm9kZXNbc3RhcnRPZmZzZXRdO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBJZiBpbmRleCBiYXNlZCBlbmQgcG9zaXRpb24gdGhlbiByZXNvbHZlIGl0XG5cdFx0XHRpZiAoZW5kQ29udGFpbmVyLm5vZGVUeXBlID09IDEgJiYgZW5kQ29udGFpbmVyLmhhc0NoaWxkTm9kZXMoKSkge1xuXHRcdFx0XHRlbmRDb250YWluZXIgPSBnZXRFbmRDaGlsZChlbmRDb250YWluZXIsIGVuZE9mZnNldCk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIFNhbWUgY29udGFpbmVyXG5cdFx0XHRpZiAoc3RhcnRDb250YWluZXIgPT0gZW5kQ29udGFpbmVyKSB7XG5cdFx0XHRcdHJldHVybiBjYWxsYmFjayhleGNsdWRlKFtzdGFydENvbnRhaW5lcl0pKTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gRmluZCBjb21tb24gYW5jZXN0b3IgYW5kIGVuZCBwb2ludHNcblx0XHRcdGFuY2VzdG9yID0gZG9tLmZpbmRDb21tb25BbmNlc3RvcihzdGFydENvbnRhaW5lciwgZW5kQ29udGFpbmVyKTtcblxuXHRcdFx0Ly8gUHJvY2VzcyBsZWZ0IHNpZGVcblx0XHRcdGZvciAobm9kZSA9IHN0YXJ0Q29udGFpbmVyOyBub2RlOyBub2RlID0gbm9kZS5wYXJlbnROb2RlKSB7XG5cdFx0XHRcdGlmIChub2RlID09PSBlbmRDb250YWluZXIpIHtcblx0XHRcdFx0XHRyZXR1cm4gd2Fsa0JvdW5kYXJ5KHN0YXJ0Q29udGFpbmVyLCBhbmNlc3RvciwgdHJ1ZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAobm9kZSA9PT0gYW5jZXN0b3IpIHtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHQvLyBQcm9jZXNzIHJpZ2h0IHNpZGVcblx0XHRcdGZvciAobm9kZSA9IGVuZENvbnRhaW5lcjsgbm9kZTsgbm9kZSA9IG5vZGUucGFyZW50Tm9kZSkge1xuXHRcdFx0XHRpZiAobm9kZSA9PT0gc3RhcnRDb250YWluZXIpIHtcblx0XHRcdFx0XHRyZXR1cm4gd2Fsa0JvdW5kYXJ5KGVuZENvbnRhaW5lciwgYW5jZXN0b3IpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKG5vZGUgPT09IGFuY2VzdG9yKSB7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0Ly8gRmluZCBzdGFydC9lbmQgcG9pbnRcblx0XHRcdHN0YXJ0UG9pbnQgPSBmaW5kRW5kUG9pbnQoc3RhcnRDb250YWluZXIsIGFuY2VzdG9yKSB8fCBzdGFydENvbnRhaW5lcjtcblx0XHRcdGVuZFBvaW50ID0gZmluZEVuZFBvaW50KGVuZENvbnRhaW5lciwgYW5jZXN0b3IpIHx8IGVuZENvbnRhaW5lcjtcblxuXHRcdFx0Ly8gV2FsayBsZWZ0IGxlYWZcblx0XHRcdHdhbGtCb3VuZGFyeShzdGFydENvbnRhaW5lciwgc3RhcnRQb2ludCwgdHJ1ZSk7XG5cblx0XHRcdC8vIFdhbGsgdGhlIG1pZGRsZSBmcm9tIHN0YXJ0IHRvIGVuZCBwb2ludFxuXHRcdFx0c2libGluZ3MgPSBjb2xsZWN0U2libGluZ3MoXG5cdFx0XHRcdHN0YXJ0UG9pbnQgPT0gc3RhcnRDb250YWluZXIgPyBzdGFydFBvaW50IDogc3RhcnRQb2ludC5uZXh0U2libGluZyxcblx0XHRcdFx0J25leHRTaWJsaW5nJyxcblx0XHRcdFx0ZW5kUG9pbnQgPT0gZW5kQ29udGFpbmVyID8gZW5kUG9pbnQubmV4dFNpYmxpbmcgOiBlbmRQb2ludFxuXHRcdFx0KTtcblxuXHRcdFx0aWYgKHNpYmxpbmdzLmxlbmd0aCkge1xuXHRcdFx0XHRjYWxsYmFjayhleGNsdWRlKHNpYmxpbmdzKSk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIFdhbGsgcmlnaHQgbGVhZlxuXHRcdFx0d2Fsa0JvdW5kYXJ5KGVuZENvbnRhaW5lciwgZW5kUG9pbnQpO1xuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBTcGxpdHMgdGhlIHNwZWNpZmllZCByYW5nZSBhdCBpdCdzIHN0YXJ0L2VuZCBwb2ludHMuXG5cdFx0ICpcblx0XHQgKiBAcHJpdmF0ZVxuXHRcdCAqIEBwYXJhbSB7UmFuZ2UvUmFuZ2VPYmplY3R9IHJuZyBSYW5nZSB0byBzcGxpdC5cblx0XHQgKiBAcmV0dXJuIHtPYmplY3R9IFJhbmdlIHBvc2l0aW9uIG9iamVjdC5cblx0XHQgKi9cblx0XHR0aGlzLnNwbGl0ID0gZnVuY3Rpb24ocm5nKSB7XG5cdFx0XHR2YXIgc3RhcnRDb250YWluZXIgPSBybmcuc3RhcnRDb250YWluZXIsXG5cdFx0XHRcdHN0YXJ0T2Zmc2V0ID0gcm5nLnN0YXJ0T2Zmc2V0LFxuXHRcdFx0XHRlbmRDb250YWluZXIgPSBybmcuZW5kQ29udGFpbmVyLFxuXHRcdFx0XHRlbmRPZmZzZXQgPSBybmcuZW5kT2Zmc2V0O1xuXG5cdFx0XHRmdW5jdGlvbiBzcGxpdFRleHQobm9kZSwgb2Zmc2V0KSB7XG5cdFx0XHRcdHJldHVybiBub2RlLnNwbGl0VGV4dChvZmZzZXQpO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBIYW5kbGUgc2luZ2xlIHRleHQgbm9kZVxuXHRcdFx0aWYgKHN0YXJ0Q29udGFpbmVyID09IGVuZENvbnRhaW5lciAmJiBzdGFydENvbnRhaW5lci5ub2RlVHlwZSA9PSAzKSB7XG5cdFx0XHRcdGlmIChzdGFydE9mZnNldCA+IDAgJiYgc3RhcnRPZmZzZXQgPCBzdGFydENvbnRhaW5lci5ub2RlVmFsdWUubGVuZ3RoKSB7XG5cdFx0XHRcdFx0ZW5kQ29udGFpbmVyID0gc3BsaXRUZXh0KHN0YXJ0Q29udGFpbmVyLCBzdGFydE9mZnNldCk7XG5cdFx0XHRcdFx0c3RhcnRDb250YWluZXIgPSBlbmRDb250YWluZXIucHJldmlvdXNTaWJsaW5nO1xuXG5cdFx0XHRcdFx0aWYgKGVuZE9mZnNldCA+IHN0YXJ0T2Zmc2V0KSB7XG5cdFx0XHRcdFx0XHRlbmRPZmZzZXQgPSBlbmRPZmZzZXQgLSBzdGFydE9mZnNldDtcblx0XHRcdFx0XHRcdHN0YXJ0Q29udGFpbmVyID0gZW5kQ29udGFpbmVyID0gc3BsaXRUZXh0KGVuZENvbnRhaW5lciwgZW5kT2Zmc2V0KS5wcmV2aW91c1NpYmxpbmc7XG5cdFx0XHRcdFx0XHRlbmRPZmZzZXQgPSBlbmRDb250YWluZXIubm9kZVZhbHVlLmxlbmd0aDtcblx0XHRcdFx0XHRcdHN0YXJ0T2Zmc2V0ID0gMDtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0ZW5kT2Zmc2V0ID0gMDtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdC8vIFNwbGl0IHN0YXJ0Q29udGFpbmVyIHRleHQgbm9kZSBpZiBuZWVkZWRcblx0XHRcdFx0aWYgKHN0YXJ0Q29udGFpbmVyLm5vZGVUeXBlID09IDMgJiYgc3RhcnRPZmZzZXQgPiAwICYmIHN0YXJ0T2Zmc2V0IDwgc3RhcnRDb250YWluZXIubm9kZVZhbHVlLmxlbmd0aCkge1xuXHRcdFx0XHRcdHN0YXJ0Q29udGFpbmVyID0gc3BsaXRUZXh0KHN0YXJ0Q29udGFpbmVyLCBzdGFydE9mZnNldCk7XG5cdFx0XHRcdFx0c3RhcnRPZmZzZXQgPSAwO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gU3BsaXQgZW5kQ29udGFpbmVyIHRleHQgbm9kZSBpZiBuZWVkZWRcblx0XHRcdFx0aWYgKGVuZENvbnRhaW5lci5ub2RlVHlwZSA9PSAzICYmIGVuZE9mZnNldCA+IDAgJiYgZW5kT2Zmc2V0IDwgZW5kQ29udGFpbmVyLm5vZGVWYWx1ZS5sZW5ndGgpIHtcblx0XHRcdFx0XHRlbmRDb250YWluZXIgPSBzcGxpdFRleHQoZW5kQ29udGFpbmVyLCBlbmRPZmZzZXQpLnByZXZpb3VzU2libGluZztcblx0XHRcdFx0XHRlbmRPZmZzZXQgPSBlbmRDb250YWluZXIubm9kZVZhbHVlLmxlbmd0aDtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4ge1xuXHRcdFx0XHRzdGFydENvbnRhaW5lcjogc3RhcnRDb250YWluZXIsXG5cdFx0XHRcdHN0YXJ0T2Zmc2V0OiBzdGFydE9mZnNldCxcblx0XHRcdFx0ZW5kQ29udGFpbmVyOiBlbmRDb250YWluZXIsXG5cdFx0XHRcdGVuZE9mZnNldDogZW5kT2Zmc2V0XG5cdFx0XHR9O1xuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBOb3JtYWxpemVzIHRoZSBzcGVjaWZpZWQgcmFuZ2UgYnkgZmluZGluZyB0aGUgY2xvc2VzdCBiZXN0IHN1aXRhYmxlIGNhcmV0IGxvY2F0aW9uLlxuXHRcdCAqXG5cdFx0ICogQHByaXZhdGVcblx0XHQgKiBAcGFyYW0ge1JhbmdlfSBybmcgUmFuZ2UgdG8gbm9ybWFsaXplLlxuXHRcdCAqIEByZXR1cm4ge0Jvb2xlYW59IFRydWUvZmFsc2UgaWYgdGhlIHNwZWNpZmllZCByYW5nZSB3YXMgbm9ybWFsaXplZCBvciBub3QuXG5cdFx0ICovXG5cdFx0dGhpcy5ub3JtYWxpemUgPSBmdW5jdGlvbihybmcpIHtcblx0XHRcdHZhciBub3JtYWxpemVkLCBjb2xsYXBzZWQ7XG5cblx0XHRcdGZ1bmN0aW9uIG5vcm1hbGl6ZUVuZFBvaW50KHN0YXJ0KSB7XG5cdFx0XHRcdHZhciBjb250YWluZXIsIG9mZnNldCwgd2Fsa2VyLCBib2R5ID0gZG9tLmdldFJvb3QoKSwgbm9kZSwgbm9uRW1wdHlFbGVtZW50c01hcDtcblx0XHRcdFx0dmFyIGRpcmVjdGlvbkxlZnQsIGlzQWZ0ZXJOb2RlO1xuXG5cdFx0XHRcdGZ1bmN0aW9uIGlzVGFibGVDZWxsKG5vZGUpIHtcblx0XHRcdFx0XHRyZXR1cm4gbm9kZSAmJiAvXihURHxUSHxDQVBUSU9OKSQvLnRlc3Qobm9kZS5ub2RlTmFtZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRmdW5jdGlvbiBoYXNCckJlZm9yZUFmdGVyKG5vZGUsIGxlZnQpIHtcblx0XHRcdFx0XHR2YXIgd2Fsa2VyID0gbmV3IFRyZWVXYWxrZXIobm9kZSwgZG9tLmdldFBhcmVudChub2RlLnBhcmVudE5vZGUsIGRvbS5pc0Jsb2NrKSB8fCBib2R5KTtcblxuXHRcdFx0XHRcdHdoaWxlICgobm9kZSA9IHdhbGtlcltsZWZ0ID8gJ3ByZXYnIDogJ25leHQnXSgpKSkge1xuXHRcdFx0XHRcdFx0aWYgKG5vZGUubm9kZU5hbWUgPT09IFwiQlJcIikge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRmdW5jdGlvbiBoYXNDb250ZW50RWRpdGFibGVGYWxzZVBhcmVudChub2RlKSB7XG5cdFx0XHRcdFx0d2hpbGUgKG5vZGUgJiYgbm9kZSAhPSBib2R5KSB7XG5cdFx0XHRcdFx0XHRpZiAoaXNDb250ZW50RWRpdGFibGVGYWxzZShub2RlKSkge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0bm9kZSA9IG5vZGUucGFyZW50Tm9kZTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRmdW5jdGlvbiBpc1ByZXZOb2RlKG5vZGUsIG5hbWUpIHtcblx0XHRcdFx0XHRyZXR1cm4gbm9kZS5wcmV2aW91c1NpYmxpbmcgJiYgbm9kZS5wcmV2aW91c1NpYmxpbmcubm9kZU5hbWUgPT0gbmFtZTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIFdhbGtzIHRoZSBkb20gbGVmdC9yaWdodCB0byBmaW5kIGEgc3VpdGFibGUgdGV4dCBub2RlIHRvIG1vdmUgdGhlIGVuZHBvaW50IGludG9cblx0XHRcdFx0Ly8gSXQgd2lsbCBvbmx5IHdhbGsgd2l0aGluIHRoZSBjdXJyZW50IHBhcmVudCBibG9jayBvciBib2R5IGFuZCB3aWxsIHN0b3AgaWYgaXQgaGl0cyBhIGJsb2NrIG9yIGEgQlIvSU1HXG5cdFx0XHRcdGZ1bmN0aW9uIGZpbmRUZXh0Tm9kZVJlbGF0aXZlKGxlZnQsIHN0YXJ0Tm9kZSkge1xuXHRcdFx0XHRcdHZhciB3YWxrZXIsIGxhc3RJbmxpbmVFbGVtZW50LCBwYXJlbnRCbG9ja0NvbnRhaW5lcjtcblxuXHRcdFx0XHRcdHN0YXJ0Tm9kZSA9IHN0YXJ0Tm9kZSB8fCBjb250YWluZXI7XG5cdFx0XHRcdFx0cGFyZW50QmxvY2tDb250YWluZXIgPSBkb20uZ2V0UGFyZW50KHN0YXJ0Tm9kZS5wYXJlbnROb2RlLCBkb20uaXNCbG9jaykgfHwgYm9keTtcblxuXHRcdFx0XHRcdC8vIExlYW4gbGVmdCBiZWZvcmUgdGhlIEJSIGVsZW1lbnQgaWYgaXQncyB0aGUgb25seSBCUiB3aXRoaW4gYSBibG9jayBlbGVtZW50LiBHZWNrbyBidWc6ICM2NjgwXG5cdFx0XHRcdFx0Ly8gVGhpczogPHA+PGJyPnw8L3A+IGJlY29tZXMgPHA+fDxicj48L3A+XG5cdFx0XHRcdFx0aWYgKGxlZnQgJiYgc3RhcnROb2RlLm5vZGVOYW1lID09ICdCUicgJiYgaXNBZnRlck5vZGUgJiYgZG9tLmlzRW1wdHkocGFyZW50QmxvY2tDb250YWluZXIpKSB7XG5cdFx0XHRcdFx0XHRjb250YWluZXIgPSBzdGFydE5vZGUucGFyZW50Tm9kZTtcblx0XHRcdFx0XHRcdG9mZnNldCA9IGRvbS5ub2RlSW5kZXgoc3RhcnROb2RlKTtcblx0XHRcdFx0XHRcdG5vcm1hbGl6ZWQgPSB0cnVlO1xuXHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdC8vIFdhbGsgbGVmdCB1bnRpbCB3ZSBoaXQgYSB0ZXh0IG5vZGUgd2UgY2FuIG1vdmUgdG8gb3IgYSBibG9jay9ici9pbWdcblx0XHRcdFx0XHR3YWxrZXIgPSBuZXcgVHJlZVdhbGtlcihzdGFydE5vZGUsIHBhcmVudEJsb2NrQ29udGFpbmVyKTtcblx0XHRcdFx0XHR3aGlsZSAoKG5vZGUgPSB3YWxrZXJbbGVmdCA/ICdwcmV2JyA6ICduZXh0J10oKSkpIHtcblx0XHRcdFx0XHRcdC8vIEJyZWFrIGlmIHdlIGhpdCBhIG5vbiBjb250ZW50IGVkaXRhYmxlIG5vZGVcblx0XHRcdFx0XHRcdGlmIChkb20uZ2V0Q29udGVudEVkaXRhYmxlUGFyZW50KG5vZGUpID09PSBcImZhbHNlXCIgfHwgaXNDZUZhbHNlQ2FyZXRDb250YWluZXIobm9kZSwgZG9tLmdldFJvb3QoKSkpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHQvLyBGb3VuZCB0ZXh0IG5vZGUgdGhhdCBoYXMgYSBsZW5ndGhcblx0XHRcdFx0XHRcdGlmIChub2RlLm5vZGVUeXBlID09PSAzICYmIG5vZGUubm9kZVZhbHVlLmxlbmd0aCA+IDApIHtcblx0XHRcdFx0XHRcdFx0Y29udGFpbmVyID0gbm9kZTtcblx0XHRcdFx0XHRcdFx0b2Zmc2V0ID0gbGVmdCA/IG5vZGUubm9kZVZhbHVlLmxlbmd0aCA6IDA7XG5cdFx0XHRcdFx0XHRcdG5vcm1hbGl6ZWQgPSB0cnVlO1xuXHRcdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdC8vIEJyZWFrIGlmIHdlIGZpbmQgYSBibG9jayBvciBhIEJSL0lNRy9JTlBVVCBldGNcblx0XHRcdFx0XHRcdGlmIChkb20uaXNCbG9jayhub2RlKSB8fCBub25FbXB0eUVsZW1lbnRzTWFwW25vZGUubm9kZU5hbWUudG9Mb3dlckNhc2UoKV0pIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRsYXN0SW5saW5lRWxlbWVudCA9IG5vZGU7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Ly8gT25seSBmZXRjaCB0aGUgbGFzdCBpbmxpbmUgZWxlbWVudCB3aGVuIGluIGNhcmV0IG1vZGUgZm9yIG5vd1xuXHRcdFx0XHRcdGlmIChjb2xsYXBzZWQgJiYgbGFzdElubGluZUVsZW1lbnQpIHtcblx0XHRcdFx0XHRcdGNvbnRhaW5lciA9IGxhc3RJbmxpbmVFbGVtZW50O1xuXHRcdFx0XHRcdFx0bm9ybWFsaXplZCA9IHRydWU7XG5cdFx0XHRcdFx0XHRvZmZzZXQgPSAwO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdGNvbnRhaW5lciA9IHJuZ1soc3RhcnQgPyAnc3RhcnQnIDogJ2VuZCcpICsgJ0NvbnRhaW5lciddO1xuXHRcdFx0XHRvZmZzZXQgPSBybmdbKHN0YXJ0ID8gJ3N0YXJ0JyA6ICdlbmQnKSArICdPZmZzZXQnXTtcblx0XHRcdFx0aXNBZnRlck5vZGUgPSBjb250YWluZXIubm9kZVR5cGUgPT0gMSAmJiBvZmZzZXQgPT09IGNvbnRhaW5lci5jaGlsZE5vZGVzLmxlbmd0aDtcblx0XHRcdFx0bm9uRW1wdHlFbGVtZW50c01hcCA9IGRvbS5zY2hlbWEuZ2V0Tm9uRW1wdHlFbGVtZW50cygpO1xuXHRcdFx0XHRkaXJlY3Rpb25MZWZ0ID0gc3RhcnQ7XG5cblx0XHRcdFx0aWYgKGlzQ2FyZXRDb250YWluZXIoY29udGFpbmVyKSkge1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChjb250YWluZXIubm9kZVR5cGUgPT0gMSAmJiBvZmZzZXQgPiBjb250YWluZXIuY2hpbGROb2Rlcy5sZW5ndGggLSAxKSB7XG5cdFx0XHRcdFx0ZGlyZWN0aW9uTGVmdCA9IGZhbHNlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gSWYgdGhlIGNvbnRhaW5lciBpcyBhIGRvY3VtZW50IG1vdmUgaXQgdG8gdGhlIGJvZHkgZWxlbWVudFxuXHRcdFx0XHRpZiAoY29udGFpbmVyLm5vZGVUeXBlID09PSA5KSB7XG5cdFx0XHRcdFx0Y29udGFpbmVyID0gZG9tLmdldFJvb3QoKTtcblx0XHRcdFx0XHRvZmZzZXQgPSAwO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gSWYgdGhlIGNvbnRhaW5lciBpcyBib2R5IHRyeSBtb3ZlIGl0IGludG8gdGhlIGNsb3Nlc3QgdGV4dCBub2RlIG9yIHBvc2l0aW9uXG5cdFx0XHRcdGlmIChjb250YWluZXIgPT09IGJvZHkpIHtcblx0XHRcdFx0XHQvLyBJZiBzdGFydCBpcyBiZWZvcmUvYWZ0ZXIgYSBpbWFnZSwgdGFibGUgZXRjXG5cdFx0XHRcdFx0aWYgKGRpcmVjdGlvbkxlZnQpIHtcblx0XHRcdFx0XHRcdG5vZGUgPSBjb250YWluZXIuY2hpbGROb2Rlc1tvZmZzZXQgPiAwID8gb2Zmc2V0IC0gMSA6IDBdO1xuXHRcdFx0XHRcdFx0aWYgKG5vZGUpIHtcblx0XHRcdFx0XHRcdFx0aWYgKGlzQ2FyZXRDb250YWluZXIobm9kZSkpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRpZiAobm9uRW1wdHlFbGVtZW50c01hcFtub2RlLm5vZGVOYW1lXSB8fCBub2RlLm5vZGVOYW1lID09IFwiVEFCTEVcIikge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdC8vIFJlc29sdmUgdGhlIGluZGV4XG5cdFx0XHRcdFx0aWYgKGNvbnRhaW5lci5oYXNDaGlsZE5vZGVzKCkpIHtcblx0XHRcdFx0XHRcdG9mZnNldCA9IE1hdGgubWluKCFkaXJlY3Rpb25MZWZ0ICYmIG9mZnNldCA+IDAgPyBvZmZzZXQgLSAxIDogb2Zmc2V0LCBjb250YWluZXIuY2hpbGROb2Rlcy5sZW5ndGggLSAxKTtcblx0XHRcdFx0XHRcdGNvbnRhaW5lciA9IGNvbnRhaW5lci5jaGlsZE5vZGVzW29mZnNldF07XG5cdFx0XHRcdFx0XHRvZmZzZXQgPSAwO1xuXG5cdFx0XHRcdFx0XHQvLyBEb24ndCBub3JtYWxpemUgbm9uIGNvbGxhcHNlZCBzZWxlY3Rpb25zIGxpa2UgPHA+W2E8L3A+PHRhYmxlPjwvdGFibGU+XVxuXHRcdFx0XHRcdFx0aWYgKCFjb2xsYXBzZWQgJiYgY29udGFpbmVyID09PSBib2R5Lmxhc3RDaGlsZCAmJiBjb250YWluZXIubm9kZU5hbWUgPT09ICdUQUJMRScpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRpZiAoaGFzQ29udGVudEVkaXRhYmxlRmFsc2VQYXJlbnQoY29udGFpbmVyKSB8fCBpc0NhcmV0Q29udGFpbmVyKGNvbnRhaW5lcikpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHQvLyBEb24ndCB3YWxrIGludG8gZWxlbWVudHMgdGhhdCBkb2Vzbid0IGhhdmUgYW55IGNoaWxkIG5vZGVzIGxpa2UgYSBJTUdcblx0XHRcdFx0XHRcdGlmIChjb250YWluZXIuaGFzQ2hpbGROb2RlcygpICYmICEvVEFCTEUvLnRlc3QoY29udGFpbmVyLm5vZGVOYW1lKSkge1xuXHRcdFx0XHRcdFx0XHQvLyBXYWxrIHRoZSBET00gdG8gZmluZCBhIHRleHQgbm9kZSB0byBwbGFjZSB0aGUgY2FyZXQgYXQgb3IgYSBCUlxuXHRcdFx0XHRcdFx0XHRub2RlID0gY29udGFpbmVyO1xuXHRcdFx0XHRcdFx0XHR3YWxrZXIgPSBuZXcgVHJlZVdhbGtlcihjb250YWluZXIsIGJvZHkpO1xuXG5cdFx0XHRcdFx0XHRcdGRvIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAoaXNDb250ZW50RWRpdGFibGVGYWxzZShub2RlKSB8fCBpc0NhcmV0Q29udGFpbmVyKG5vZGUpKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRub3JtYWxpemVkID0gZmFsc2U7XG5cdFx0XHRcdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHQvLyBGb3VuZCBhIHRleHQgbm9kZSB1c2UgdGhhdCBwb3NpdGlvblxuXHRcdFx0XHRcdFx0XHRcdGlmIChub2RlLm5vZGVUeXBlID09PSAzICYmIG5vZGUubm9kZVZhbHVlLmxlbmd0aCA+IDApIHtcblx0XHRcdFx0XHRcdFx0XHRcdG9mZnNldCA9IGRpcmVjdGlvbkxlZnQgPyAwIDogbm9kZS5ub2RlVmFsdWUubGVuZ3RoO1xuXHRcdFx0XHRcdFx0XHRcdFx0Y29udGFpbmVyID0gbm9kZTtcblx0XHRcdFx0XHRcdFx0XHRcdG5vcm1hbGl6ZWQgPSB0cnVlO1xuXHRcdFx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0Ly8gRm91bmQgYSBCUi9JTUcgZWxlbWVudCB0aGF0IHdlIGNhbiBwbGFjZSB0aGUgY2FyZXQgYmVmb3JlXG5cdFx0XHRcdFx0XHRcdFx0aWYgKG5vbkVtcHR5RWxlbWVudHNNYXBbbm9kZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpXSAmJiAhaXNUYWJsZUNlbGwobm9kZSkpIHtcblx0XHRcdFx0XHRcdFx0XHRcdG9mZnNldCA9IGRvbS5ub2RlSW5kZXgobm9kZSk7XG5cdFx0XHRcdFx0XHRcdFx0XHRjb250YWluZXIgPSBub2RlLnBhcmVudE5vZGU7XG5cblx0XHRcdFx0XHRcdFx0XHRcdC8vIFB1dCBjYXJldCBhZnRlciBpbWFnZSB3aGVuIG1vdmluZyB0aGUgZW5kIHBvaW50XG5cdFx0XHRcdFx0XHRcdFx0XHRpZiAobm9kZS5ub2RlTmFtZSA9PSBcIklNR1wiICYmICFkaXJlY3Rpb25MZWZ0KSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdG9mZnNldCsrO1xuXHRcdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0XHRub3JtYWxpemVkID0gdHJ1ZTtcblx0XHRcdFx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0fSB3aGlsZSAoKG5vZGUgPSAoZGlyZWN0aW9uTGVmdCA/IHdhbGtlci5uZXh0KCkgOiB3YWxrZXIucHJldigpKSkpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIExlYW4gdGhlIGNhcmV0IHRvIHRoZSBsZWZ0IGlmIHBvc3NpYmxlXG5cdFx0XHRcdGlmIChjb2xsYXBzZWQpIHtcblx0XHRcdFx0XHQvLyBTbyB0aGlzOiA8Yj54PC9iPjxpPnx4PC9pPlxuXHRcdFx0XHRcdC8vIEJlY29tZXM6IDxiPnh8PC9iPjxpPng8L2k+XG5cdFx0XHRcdFx0Ly8gU2VlbXMgdGhhdCBvbmx5IGdlY2tvIGhhcyBpc3N1ZXMgd2l0aCB0aGlzXG5cdFx0XHRcdFx0aWYgKGNvbnRhaW5lci5ub2RlVHlwZSA9PT0gMyAmJiBvZmZzZXQgPT09IDApIHtcblx0XHRcdFx0XHRcdGZpbmRUZXh0Tm9kZVJlbGF0aXZlKHRydWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdC8vIExlYW4gbGVmdCBpbnRvIGVtcHR5IGlubGluZSBlbGVtZW50cyB3aGVuIHRoZSBjYXJldCBpcyBiZWZvcmUgYSBCUlxuXHRcdFx0XHRcdC8vIFNvIHRoaXM6IDxpPjxiPjwvYj48aT58PGJyPjwvaT5cblx0XHRcdFx0XHQvLyBCZWNvbWVzOiA8aT48Yj58PC9iPjxpPjxicj48L2k+XG5cdFx0XHRcdFx0Ly8gU2VlbXMgdGhhdCBvbmx5IGdlY2tvIGhhcyBpc3N1ZXMgd2l0aCB0aGlzLlxuXHRcdFx0XHRcdC8vIFNwZWNpYWwgZWRnZSBjYXNlIGZvciA8cD48YT54PC9hPnw8YnI+PC9wPiBzaW5jZSB3ZSBkb24ndCB3YW50IDxwPjxhPnh8PC9hPjxicj48L3A+XG5cdFx0XHRcdFx0aWYgKGNvbnRhaW5lci5ub2RlVHlwZSA9PT0gMSkge1xuXHRcdFx0XHRcdFx0bm9kZSA9IGNvbnRhaW5lci5jaGlsZE5vZGVzW29mZnNldF07XG5cblx0XHRcdFx0XHRcdC8vIE9mZnNldCBpcyBhZnRlciB0aGUgY29udGFpbmVycyBsYXN0IGNoaWxkXG5cdFx0XHRcdFx0XHQvLyB0aGVuIHVzZSB0aGUgcHJldmlvdXMgY2hpbGQgZm9yIG5vcm1hbGl6YXRpb25cblx0XHRcdFx0XHRcdGlmICghbm9kZSkge1xuXHRcdFx0XHRcdFx0XHRub2RlID0gY29udGFpbmVyLmNoaWxkTm9kZXNbb2Zmc2V0IC0gMV07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGlmIChub2RlICYmIG5vZGUubm9kZU5hbWUgPT09ICdCUicgJiYgIWlzUHJldk5vZGUobm9kZSwgJ0EnKSAmJlxuXHRcdFx0XHRcdFx0XHQhaGFzQnJCZWZvcmVBZnRlcihub2RlKSAmJiAhaGFzQnJCZWZvcmVBZnRlcihub2RlLCB0cnVlKSkge1xuXHRcdFx0XHRcdFx0XHRmaW5kVGV4dE5vZGVSZWxhdGl2ZSh0cnVlLCBub2RlKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBMZWFuIHRoZSBzdGFydCBvZiB0aGUgc2VsZWN0aW9uIHJpZ2h0IGlmIHBvc3NpYmxlXG5cdFx0XHRcdC8vIFNvIHRoaXM6IHhbPGI+eF08L2I+XG5cdFx0XHRcdC8vIEJlY29tZXM6IHg8Yj5beF08L2I+XG5cdFx0XHRcdGlmIChkaXJlY3Rpb25MZWZ0ICYmICFjb2xsYXBzZWQgJiYgY29udGFpbmVyLm5vZGVUeXBlID09PSAzICYmIG9mZnNldCA9PT0gY29udGFpbmVyLm5vZGVWYWx1ZS5sZW5ndGgpIHtcblx0XHRcdFx0XHRmaW5kVGV4dE5vZGVSZWxhdGl2ZShmYWxzZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBTZXQgZW5kcG9pbnQgaWYgaXQgd2FzIG5vcm1hbGl6ZWRcblx0XHRcdFx0aWYgKG5vcm1hbGl6ZWQpIHtcblx0XHRcdFx0XHRybmdbJ3NldCcgKyAoc3RhcnQgPyAnU3RhcnQnIDogJ0VuZCcpXShjb250YWluZXIsIG9mZnNldCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0Y29sbGFwc2VkID0gcm5nLmNvbGxhcHNlZDtcblxuXHRcdFx0bm9ybWFsaXplRW5kUG9pbnQodHJ1ZSk7XG5cblx0XHRcdGlmICghY29sbGFwc2VkKSB7XG5cdFx0XHRcdG5vcm1hbGl6ZUVuZFBvaW50KCk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIElmIGl0IHdhcyBjb2xsYXBzZWQgdGhlbiBtYWtlIHN1cmUgaXQgc3RpbGwgaXNcblx0XHRcdGlmIChub3JtYWxpemVkICYmIGNvbGxhcHNlZCkge1xuXHRcdFx0XHRybmcuY29sbGFwc2UodHJ1ZSk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBub3JtYWxpemVkO1xuXHRcdH07XG5cdH1cblxuXHQvKipcblx0ICogQ29tcGFyZXMgdHdvIHJhbmdlcyBhbmQgY2hlY2tzIGlmIHRoZXkgYXJlIGVxdWFsLlxuXHQgKlxuXHQgKiBAc3RhdGljXG5cdCAqIEBtZXRob2QgY29tcGFyZVJhbmdlc1xuXHQgKiBAcGFyYW0ge0RPTVJhbmdlfSBybmcxIEZpcnN0IHJhbmdlIHRvIGNvbXBhcmUuXG5cdCAqIEBwYXJhbSB7RE9NUmFuZ2V9IHJuZzIgRmlyc3QgcmFuZ2UgdG8gY29tcGFyZS5cblx0ICogQHJldHVybiB7Qm9vbGVhbn0gdHJ1ZS9mYWxzZSBpZiB0aGUgcmFuZ2VzIGFyZSBlcXVhbC5cblx0ICovXG5cdFJhbmdlVXRpbHMuY29tcGFyZVJhbmdlcyA9IGZ1bmN0aW9uKHJuZzEsIHJuZzIpIHtcblx0XHRpZiAocm5nMSAmJiBybmcyKSB7XG5cdFx0XHQvLyBDb21wYXJlIG5hdGl2ZSBJRSByYW5nZXNcblx0XHRcdGlmIChybmcxLml0ZW0gfHwgcm5nMS5kdXBsaWNhdGUpIHtcblx0XHRcdFx0Ly8gQm90aCBhcmUgY29udHJvbCByYW5nZXMgYW5kIHRoZSBzZWxlY3RlZCBlbGVtZW50IG1hdGNoZXNcblx0XHRcdFx0aWYgKHJuZzEuaXRlbSAmJiBybmcyLml0ZW0gJiYgcm5nMS5pdGVtKDApID09PSBybmcyLml0ZW0oMCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIEJvdGggYXJlIHRleHQgcmFuZ2VzIGFuZCB0aGUgcmFuZ2UgbWF0Y2hlc1xuXHRcdFx0XHRpZiAocm5nMS5pc0VxdWFsICYmIHJuZzIuaXNFcXVhbCAmJiBybmcyLmlzRXF1YWwocm5nMSkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Ly8gQ29tcGFyZSB3M2MgcmFuZ2VzXG5cdFx0XHRcdHJldHVybiBybmcxLnN0YXJ0Q29udGFpbmVyID09IHJuZzIuc3RhcnRDb250YWluZXIgJiYgcm5nMS5zdGFydE9mZnNldCA9PSBybmcyLnN0YXJ0T2Zmc2V0O1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiBmYWxzZTtcblx0fTtcblxuXHQvKipcblx0ICogRmluZHMgdGhlIGNsb3Nlc3Qgc2VsZWN0aW9uIHJlY3QgdHJpZXMgdG8gZ2V0IHRoZSByYW5nZSBmcm9tIHRoYXQuXG5cdCAqL1xuXHRmdW5jdGlvbiBmaW5kQ2xvc2VzdEllUmFuZ2UoY2xpZW50WCwgY2xpZW50WSwgZG9jKSB7XG5cdFx0dmFyIGVsZW1lbnQsIHJuZywgcmVjdHM7XG5cblx0XHRlbGVtZW50ID0gZG9jLmVsZW1lbnRGcm9tUG9pbnQoY2xpZW50WCwgY2xpZW50WSk7XG5cdFx0cm5nID0gZG9jLmJvZHkuY3JlYXRlVGV4dFJhbmdlKCk7XG5cblx0XHRpZiAoIWVsZW1lbnQgfHwgZWxlbWVudC50YWdOYW1lID09ICdIVE1MJykge1xuXHRcdFx0ZWxlbWVudCA9IGRvYy5ib2R5O1xuXHRcdH1cblxuXHRcdHJuZy5tb3ZlVG9FbGVtZW50VGV4dChlbGVtZW50KTtcblx0XHRyZWN0cyA9IFRvb2xzLnRvQXJyYXkocm5nLmdldENsaWVudFJlY3RzKCkpO1xuXG5cdFx0cmVjdHMgPSByZWN0cy5zb3J0KGZ1bmN0aW9uKGEsIGIpIHtcblx0XHRcdGEgPSBNYXRoLmFicyhNYXRoLm1heChhLnRvcCAtIGNsaWVudFksIGEuYm90dG9tIC0gY2xpZW50WSkpO1xuXHRcdFx0YiA9IE1hdGguYWJzKE1hdGgubWF4KGIudG9wIC0gY2xpZW50WSwgYi5ib3R0b20gLSBjbGllbnRZKSk7XG5cblx0XHRcdHJldHVybiBhIC0gYjtcblx0XHR9KTtcblxuXHRcdGlmIChyZWN0cy5sZW5ndGggPiAwKSB7XG5cdFx0XHRjbGllbnRZID0gKHJlY3RzWzBdLmJvdHRvbSArIHJlY3RzWzBdLnRvcCkgLyAyO1xuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRybmcubW92ZVRvUG9pbnQoY2xpZW50WCwgY2xpZW50WSk7XG5cdFx0XHRcdHJuZy5jb2xsYXBzZSh0cnVlKTtcblxuXHRcdFx0XHRyZXR1cm4gcm5nO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0Ly8gQXQgbGVhc3Qgd2UgdHJpZWRcblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gbnVsbDtcblx0fVxuXG5cdGZ1bmN0aW9uIG1vdmVPdXRPZkNvbnRlbnRFZGl0YWJsZUZhbHNlKHJuZywgcm9vdE5vZGUpIHtcblx0XHR2YXIgcGFyZW50RWxlbWVudCA9IHJuZyAmJiBybmcucGFyZW50RWxlbWVudCA/IHJuZy5wYXJlbnRFbGVtZW50KCkgOiBudWxsO1xuXHRcdHJldHVybiBpc0NvbnRlbnRFZGl0YWJsZUZhbHNlKGZpbmRQYXJlbnQocGFyZW50RWxlbWVudCwgcm9vdE5vZGUsIGhhc0NlUHJvcGVydHkpKSA/IG51bGwgOiBybmc7XG5cdH1cblxuXHQvKipcblx0ICogR2V0cyB0aGUgY2FyZXQgcmFuZ2UgZm9yIHRoZSBnaXZlbiB4L3kgbG9jYXRpb24uXG5cdCAqXG5cdCAqIEBzdGF0aWNcblx0ICogQG1ldGhvZCBnZXRDYXJldFJhbmdlRnJvbVBvaW50XG5cdCAqIEBwYXJhbSB7TnVtYmVyfSBjbGllbnRYIFggY29vcmRpbmF0ZSBmb3IgcmFuZ2Vcblx0ICogQHBhcmFtIHtOdW1iZXJ9IGNsaWVudFkgWSBjb29yZGluYXRlIGZvciByYW5nZVxuXHQgKiBAcGFyYW0ge0RvY3VtZW50fSBkb2MgRG9jdW1lbnQgdGhhdCB4L3kgYXJlIHJlbGF0aXZlIHRvXG5cdCAqIEByZXR1cm5zIHtSYW5nZX0gY2FyZXQgcmFuZ2Vcblx0ICovXG5cdFJhbmdlVXRpbHMuZ2V0Q2FyZXRSYW5nZUZyb21Qb2ludCA9IGZ1bmN0aW9uKGNsaWVudFgsIGNsaWVudFksIGRvYykge1xuXHRcdHZhciBybmcsIHBvaW50O1xuXG5cdFx0aWYgKGRvYy5jYXJldFBvc2l0aW9uRnJvbVBvaW50KSB7XG5cdFx0XHRwb2ludCA9IGRvYy5jYXJldFBvc2l0aW9uRnJvbVBvaW50KGNsaWVudFgsIGNsaWVudFkpO1xuXHRcdFx0cm5nID0gZG9jLmNyZWF0ZVJhbmdlKCk7XG5cdFx0XHRybmcuc2V0U3RhcnQocG9pbnQub2Zmc2V0Tm9kZSwgcG9pbnQub2Zmc2V0KTtcblx0XHRcdHJuZy5jb2xsYXBzZSh0cnVlKTtcblx0XHR9IGVsc2UgaWYgKGRvYy5jYXJldFJhbmdlRnJvbVBvaW50KSB7XG5cdFx0XHRybmcgPSBkb2MuY2FyZXRSYW5nZUZyb21Qb2ludChjbGllbnRYLCBjbGllbnRZKTtcblx0XHR9IGVsc2UgaWYgKGRvYy5ib2R5LmNyZWF0ZVRleHRSYW5nZSkge1xuXHRcdFx0cm5nID0gZG9jLmJvZHkuY3JlYXRlVGV4dFJhbmdlKCk7XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJuZy5tb3ZlVG9Qb2ludChjbGllbnRYLCBjbGllbnRZKTtcblx0XHRcdFx0cm5nLmNvbGxhcHNlKHRydWUpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0cm5nID0gZmluZENsb3Nlc3RJZVJhbmdlKGNsaWVudFgsIGNsaWVudFksIGRvYyk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBtb3ZlT3V0T2ZDb250ZW50RWRpdGFibGVGYWxzZShybmcsIGRvYy5ib2R5KTtcblx0XHR9XG5cblx0XHRyZXR1cm4gcm5nO1xuXHR9O1xuXG5cdFJhbmdlVXRpbHMuZ2V0U2VsZWN0ZWROb2RlID0gZnVuY3Rpb24ocmFuZ2UpIHtcblx0XHR2YXIgc3RhcnRDb250YWluZXIgPSByYW5nZS5zdGFydENvbnRhaW5lcixcblx0XHRcdHN0YXJ0T2Zmc2V0ID0gcmFuZ2Uuc3RhcnRPZmZzZXQ7XG5cblx0XHRpZiAoc3RhcnRDb250YWluZXIuaGFzQ2hpbGROb2RlcygpICYmIHJhbmdlLmVuZE9mZnNldCA9PSBzdGFydE9mZnNldCArIDEpIHtcblx0XHRcdHJldHVybiBzdGFydENvbnRhaW5lci5jaGlsZE5vZGVzW3N0YXJ0T2Zmc2V0XTtcblx0XHR9XG5cblx0XHRyZXR1cm4gbnVsbDtcblx0fTtcblxuXHRSYW5nZVV0aWxzLmdldE5vZGUgPSBmdW5jdGlvbihjb250YWluZXIsIG9mZnNldCkge1xuXHRcdGlmIChjb250YWluZXIubm9kZVR5cGUgPT0gMSAmJiBjb250YWluZXIuaGFzQ2hpbGROb2RlcygpKSB7XG5cdFx0XHRpZiAob2Zmc2V0ID49IGNvbnRhaW5lci5jaGlsZE5vZGVzLmxlbmd0aCkge1xuXHRcdFx0XHRvZmZzZXQgPSBjb250YWluZXIuY2hpbGROb2Rlcy5sZW5ndGggLSAxO1xuXHRcdFx0fVxuXG5cdFx0XHRjb250YWluZXIgPSBjb250YWluZXIuY2hpbGROb2Rlc1tvZmZzZXRdO1xuXHRcdH1cblxuXHRcdHJldHVybiBjb250YWluZXI7XG5cdH07XG5cblx0cmV0dXJuIFJhbmdlVXRpbHM7XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL05vZGVDaGFuZ2UuanNcblxuLyoqXG4gKiBOb2RlQ2hhbmdlLmpzXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgTEdQTCBMaWNlbnNlLlxuICogQ29weXJpZ2h0IChjKSAxOTk5LTIwMTUgRXBob3ggQ29ycC4gQWxsIHJpZ2h0cyByZXNlcnZlZFxuICpcbiAqIExpY2Vuc2U6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vbGljZW5zZVxuICogQ29udHJpYnV0aW5nOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2NvbnRyaWJ1dGluZ1xuICovXG5cbi8qKlxuICogVGhpcyBjbGFzcyBoYW5kbGVzIHRoZSBub2RlY2hhbmdlIGV2ZW50IGRpc3BhdGNoaW5nIGJvdGggbWFudWFsIGFuZCB0aHJvdWdoIHNlbGVjdGlvbiBjaGFuZ2UgZXZlbnRzLlxuICpcbiAqIEBjbGFzcyB0aW55bWNlLk5vZGVDaGFuZ2VcbiAqIEBwcml2YXRlXG4gKi9cbmRlZmluZShcInRpbnltY2UvTm9kZUNoYW5nZVwiLCBbXG5cdFwidGlueW1jZS9kb20vUmFuZ2VVdGlsc1wiLFxuXHRcInRpbnltY2UvRW52XCIsXG5cdFwidGlueW1jZS91dGlsL0RlbGF5XCJcbl0sIGZ1bmN0aW9uKFJhbmdlVXRpbHMsIEVudiwgRGVsYXkpIHtcblx0cmV0dXJuIGZ1bmN0aW9uKGVkaXRvcikge1xuXHRcdHZhciBsYXN0Um5nLCBsYXN0UGF0aCA9IFtdO1xuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyB0cnVlL2ZhbHNlIGlmIHRoZSBjdXJyZW50IGVsZW1lbnQgcGF0aCBoYXMgYmVlbiBjaGFuZ2VkIG9yIG5vdC5cblx0XHQgKlxuXHRcdCAqIEBwcml2YXRlXG5cdFx0ICogQHJldHVybiB7Qm9vbGVhbn0gVHJ1ZSBpZiB0aGUgZWxlbWVudCBwYXRoIGlzIHRoZSBzYW1lIGZhbHNlIGlmIGl0J3Mgbm90LlxuXHRcdCAqL1xuXHRcdGZ1bmN0aW9uIGlzU2FtZUVsZW1lbnRQYXRoKHN0YXJ0RWxtKSB7XG5cdFx0XHR2YXIgaSwgY3VycmVudFBhdGg7XG5cblx0XHRcdGN1cnJlbnRQYXRoID0gZWRpdG9yLiQoc3RhcnRFbG0pLnBhcmVudHNVbnRpbChlZGl0b3IuZ2V0Qm9keSgpKS5hZGQoc3RhcnRFbG0pO1xuXHRcdFx0aWYgKGN1cnJlbnRQYXRoLmxlbmd0aCA9PT0gbGFzdFBhdGgubGVuZ3RoKSB7XG5cdFx0XHRcdGZvciAoaSA9IGN1cnJlbnRQYXRoLmxlbmd0aDsgaSA+PSAwOyBpLS0pIHtcblx0XHRcdFx0XHRpZiAoY3VycmVudFBhdGhbaV0gIT09IGxhc3RQYXRoW2ldKSB7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoaSA9PT0gLTEpIHtcblx0XHRcdFx0XHRsYXN0UGF0aCA9IGN1cnJlbnRQYXRoO1xuXHRcdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGxhc3RQYXRoID0gY3VycmVudFBhdGg7XG5cblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cblx0XHQvLyBHZWNrbyBkb2Vzbid0IHN1cHBvcnQgdGhlIFwic2VsZWN0aW9uY2hhbmdlXCIgZXZlbnRcblx0XHRpZiAoISgnb25zZWxlY3Rpb25jaGFuZ2UnIGluIGVkaXRvci5nZXREb2MoKSkpIHtcblx0XHRcdGVkaXRvci5vbignTm9kZUNoYW5nZSBDbGljayBNb3VzZVVwIEtleVVwIEZvY3VzJywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHR2YXIgbmF0aXZlUm5nLCBmYWtlUm5nO1xuXG5cdFx0XHRcdC8vIFNpbmNlIERPTSBSYW5nZXMgbXV0YXRlIG9uIG1vZGlmaWNhdGlvblxuXHRcdFx0XHQvLyBvZiB0aGUgRE9NIHdlIG5lZWQgdG8gY2xvbmUgaXQncyBjb250ZW50c1xuXHRcdFx0XHRuYXRpdmVSbmcgPSBlZGl0b3Iuc2VsZWN0aW9uLmdldFJuZygpO1xuXHRcdFx0XHRmYWtlUm5nID0ge1xuXHRcdFx0XHRcdHN0YXJ0Q29udGFpbmVyOiBuYXRpdmVSbmcuc3RhcnRDb250YWluZXIsXG5cdFx0XHRcdFx0c3RhcnRPZmZzZXQ6IG5hdGl2ZVJuZy5zdGFydE9mZnNldCxcblx0XHRcdFx0XHRlbmRDb250YWluZXI6IG5hdGl2ZVJuZy5lbmRDb250YWluZXIsXG5cdFx0XHRcdFx0ZW5kT2Zmc2V0OiBuYXRpdmVSbmcuZW5kT2Zmc2V0XG5cdFx0XHRcdH07XG5cblx0XHRcdFx0Ly8gQWx3YXlzIHRyZWF0IG5vZGVjaGFuZ2UgYXMgYSBzZWxlY3Rpb25jaGFuZ2Ugc2luY2UgYXBwbHlpbmdcblx0XHRcdFx0Ly8gZm9ybWF0dGluZyB0byB0aGUgY3VycmVudCByYW5nZSB3b3VsZG4ndCB1cGRhdGUgdGhlIHJhbmdlIGJ1dCBpdCdzIHBhcmVudFxuXHRcdFx0XHRpZiAoZS50eXBlID09ICdub2RlY2hhbmdlJyB8fCAhUmFuZ2VVdGlscy5jb21wYXJlUmFuZ2VzKGZha2VSbmcsIGxhc3RSbmcpKSB7XG5cdFx0XHRcdFx0ZWRpdG9yLmZpcmUoJ1NlbGVjdGlvbkNoYW5nZScpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0bGFzdFJuZyA9IGZha2VSbmc7XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHQvLyBJRSBoYXMgYSBidWcgd2hlcmUgaXQgZmlyZXMgYSBzZWxlY3Rpb25jaGFuZ2Ugb24gcmlnaHQgY2xpY2sgdGhhdCBoYXMgYSByYW5nZSBhdCB0aGUgc3RhcnQgb2YgdGhlIGJvZHlcblx0XHQvLyBXaGVuIHRoZSBjb250ZXh0bWVudSBldmVudCBmaXJlcyB0aGUgc2VsZWN0aW9uIGlzIGxvY2F0ZWQgYXQgdGhlIHJpZ2h0IGxvY2F0aW9uXG5cdFx0ZWRpdG9yLm9uKCdjb250ZXh0bWVudScsIGZ1bmN0aW9uKCkge1xuXHRcdFx0ZWRpdG9yLmZpcmUoJ1NlbGVjdGlvbkNoYW5nZScpO1xuXHRcdH0pO1xuXG5cdFx0Ly8gU2VsZWN0aW9uIGNoYW5nZSBpcyBkZWxheWVkIH4yMDBtcyBvbiBJRSB3aGVuIHlvdSBjbGljayBpbnNpZGUgdGhlIGN1cnJlbnQgcmFuZ2Vcblx0XHRlZGl0b3Iub24oJ1NlbGVjdGlvbkNoYW5nZScsIGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHN0YXJ0RWxtID0gZWRpdG9yLnNlbGVjdGlvbi5nZXRTdGFydCh0cnVlKTtcblxuXHRcdFx0Ly8gSUUgOCB3aWxsIGZpcmUgYSBzZWxlY3Rpb25jaGFuZ2UgZXZlbnQgd2l0aCBhbiBpbmNvcnJlY3Qgc2VsZWN0aW9uXG5cdFx0XHQvLyB3aGVuIGZvY3VzaW5nIG91dCBvZiB0YWJsZSBjZWxscy4gQ2xpY2sgaW5zaWRlIGNlbGwgLT4gdG9vbGJhciA9IEludmFsaWQgU2VsZWN0aW9uQ2hhbmdlIGV2ZW50XG5cdFx0XHRpZiAoIUVudi5yYW5nZSAmJiBlZGl0b3Iuc2VsZWN0aW9uLmlzQ29sbGFwc2VkKCkpIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoIWlzU2FtZUVsZW1lbnRQYXRoKHN0YXJ0RWxtKSAmJiBlZGl0b3IuZG9tLmlzQ2hpbGRPZihzdGFydEVsbSwgZWRpdG9yLmdldEJvZHkoKSkpIHtcblx0XHRcdFx0ZWRpdG9yLm5vZGVDaGFuZ2VkKHtzZWxlY3Rpb25DaGFuZ2U6IHRydWV9KTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdC8vIEZpcmUgYW4gZXh0cmEgbm9kZUNoYW5nZSBvbiBtb3VzZXVwIGZvciBjb21wYXRpYmlsaXR5IHJlYXNvbnNcblx0XHRlZGl0b3Iub24oJ01vdXNlVXAnLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRpZiAoIWUuaXNEZWZhdWx0UHJldmVudGVkKCkpIHtcblx0XHRcdFx0Ly8gRGVsYXkgbm9kZUNoYW5nZWQgY2FsbCBmb3IgV2ViS2l0IGVkZ2UgY2FzZSBpc3N1ZSB3aGVyZSB0aGUgcmFuZ2Vcblx0XHRcdFx0Ly8gaXNuJ3QgdXBkYXRlZCB1bnRpbCBhZnRlciB5b3UgY2xpY2sgb3V0c2lkZSBhIHNlbGVjdGVkIGltYWdlXG5cdFx0XHRcdGlmIChlZGl0b3Iuc2VsZWN0aW9uLmdldE5vZGUoKS5ub2RlTmFtZSA9PSAnSU1HJykge1xuXHRcdFx0XHRcdERlbGF5LnNldEVkaXRvclRpbWVvdXQoZWRpdG9yLCBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRcdGVkaXRvci5ub2RlQ2hhbmdlZCgpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGVkaXRvci5ub2RlQ2hhbmdlZCgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHQvKipcblx0XHQgKiBEaXNwYXRjaGVzIG91dCBhIG9uTm9kZUNoYW5nZSBldmVudCB0byBhbGwgb2JzZXJ2ZXJzLiBUaGlzIG1ldGhvZCBzaG91bGQgYmUgY2FsbGVkIHdoZW4geW91XG5cdFx0ICogbmVlZCB0byB1cGRhdGUgdGhlIFVJIHN0YXRlcyBvciBlbGVtZW50IHBhdGggZXRjLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBub2RlQ2hhbmdlZFxuXHRcdCAqIEBwYXJhbSB7T2JqZWN0fSBhcmdzIE9wdGlvbmFsIGFyZ3MgdG8gcGFzcyB0byBOb2RlQ2hhbmdlIGV2ZW50IGhhbmRsZXJzLlxuXHRcdCAqL1xuXHRcdHRoaXMubm9kZUNoYW5nZWQgPSBmdW5jdGlvbihhcmdzKSB7XG5cdFx0XHR2YXIgc2VsZWN0aW9uID0gZWRpdG9yLnNlbGVjdGlvbiwgbm9kZSwgcGFyZW50cywgcm9vdDtcblxuXHRcdFx0Ly8gRml4IGZvciBidWcgIzE4OTY1NzcgaXQgc2VlbXMgdGhhdCB0aGlzIGNhbiBub3QgYmUgZmlyZWQgd2hpbGUgdGhlIGVkaXRvciBpcyBsb2FkaW5nXG5cdFx0XHRpZiAoZWRpdG9yLmluaXRpYWxpemVkICYmIHNlbGVjdGlvbiAmJiAhZWRpdG9yLnNldHRpbmdzLmRpc2FibGVfbm9kZWNoYW5nZSAmJiAhZWRpdG9yLnJlYWRvbmx5KSB7XG5cdFx0XHRcdC8vIEdldCBzdGFydCBub2RlXG5cdFx0XHRcdHJvb3QgPSBlZGl0b3IuZ2V0Qm9keSgpO1xuXHRcdFx0XHRub2RlID0gc2VsZWN0aW9uLmdldFN0YXJ0KCkgfHwgcm9vdDtcblxuXHRcdFx0XHQvLyBNYWtlIHN1cmUgdGhlIG5vZGUgaXMgd2l0aGluIHRoZSBlZGl0b3Igcm9vdCBvciBpcyB0aGUgZWRpdG9yIHJvb3Rcblx0XHRcdFx0aWYgKG5vZGUub3duZXJEb2N1bWVudCAhPSBlZGl0b3IuZ2V0RG9jKCkgfHwgIWVkaXRvci5kb20uaXNDaGlsZE9mKG5vZGUsIHJvb3QpKSB7XG5cdFx0XHRcdFx0bm9kZSA9IHJvb3Q7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBFZGdlIGNhc2UgZm9yIDxwPnw8aW1nPjwvcD5cblx0XHRcdFx0aWYgKG5vZGUubm9kZU5hbWUgPT0gJ0lNRycgJiYgc2VsZWN0aW9uLmlzQ29sbGFwc2VkKCkpIHtcblx0XHRcdFx0XHRub2RlID0gbm9kZS5wYXJlbnROb2RlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gR2V0IHBhcmVudHMgYW5kIGFkZCB0aGVtIHRvIG9iamVjdFxuXHRcdFx0XHRwYXJlbnRzID0gW107XG5cdFx0XHRcdGVkaXRvci5kb20uZ2V0UGFyZW50KG5vZGUsIGZ1bmN0aW9uKG5vZGUpIHtcblx0XHRcdFx0XHRpZiAobm9kZSA9PT0gcm9vdCkge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cGFyZW50cy5wdXNoKG5vZGUpO1xuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHRhcmdzID0gYXJncyB8fCB7fTtcblx0XHRcdFx0YXJncy5lbGVtZW50ID0gbm9kZTtcblx0XHRcdFx0YXJncy5wYXJlbnRzID0gcGFyZW50cztcblxuXHRcdFx0XHRlZGl0b3IuZmlyZSgnTm9kZUNoYW5nZScsIGFyZ3MpO1xuXHRcdFx0fVxuXHRcdH07XG5cdH07XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL2h0bWwvTm9kZS5qc1xuXG4vKipcbiAqIE5vZGUuanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBUaGlzIGNsYXNzIGlzIGEgbWluaW1hbGlzdGljIGltcGxlbWVudGF0aW9uIG9mIGEgRE9NIGxpa2Ugbm9kZSB1c2VkIGJ5IHRoZSBEb21QYXJzZXIgY2xhc3MuXG4gKlxuICogQGV4YW1wbGVcbiAqIHZhciBub2RlID0gbmV3IHRpbnltY2UuaHRtbC5Ob2RlKCdzdHJvbmcnLCAxKTtcbiAqIHNvbWVSb290LmFwcGVuZChub2RlKTtcbiAqXG4gKiBAY2xhc3MgdGlueW1jZS5odG1sLk5vZGVcbiAqIEB2ZXJzaW9uIDMuNFxuICovXG5kZWZpbmUoXCJ0aW55bWNlL2h0bWwvTm9kZVwiLCBbXSwgZnVuY3Rpb24oKSB7XG5cdHZhciB3aGl0ZVNwYWNlUmVnRXhwID0gL15bIFxcdFxcclxcbl0qJC8sIHR5cGVMb29rdXAgPSB7XG5cdFx0JyN0ZXh0JzogMyxcblx0XHQnI2NvbW1lbnQnOiA4LFxuXHRcdCcjY2RhdGEnOiA0LFxuXHRcdCcjcGknOiA3LFxuXHRcdCcjZG9jdHlwZSc6IDEwLFxuXHRcdCcjZG9jdW1lbnQtZnJhZ21lbnQnOiAxMVxuXHR9O1xuXG5cdC8vIFdhbGtzIHRoZSB0cmVlIGxlZnQvcmlnaHRcblx0ZnVuY3Rpb24gd2Fsayhub2RlLCByb290X25vZGUsIHByZXYpIHtcblx0XHR2YXIgc2libGluZywgcGFyZW50LCBzdGFydE5hbWUgPSBwcmV2ID8gJ2xhc3RDaGlsZCcgOiAnZmlyc3RDaGlsZCcsIHNpYmxpbmdOYW1lID0gcHJldiA/ICdwcmV2JyA6ICduZXh0JztcblxuXHRcdC8vIFdhbGsgaW50byBub2RlcyBpZiBpdCBoYXMgYSBzdGFydFxuXHRcdGlmIChub2RlW3N0YXJ0TmFtZV0pIHtcblx0XHRcdHJldHVybiBub2RlW3N0YXJ0TmFtZV07XG5cdFx0fVxuXG5cdFx0Ly8gUmV0dXJuIHRoZSBzaWJsaW5nIGlmIGl0IGhhcyBvbmVcblx0XHRpZiAobm9kZSAhPT0gcm9vdF9ub2RlKSB7XG5cdFx0XHRzaWJsaW5nID0gbm9kZVtzaWJsaW5nTmFtZV07XG5cblx0XHRcdGlmIChzaWJsaW5nKSB7XG5cdFx0XHRcdHJldHVybiBzaWJsaW5nO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBXYWxrIHVwIHRoZSBwYXJlbnRzIHRvIGxvb2sgZm9yIHNpYmxpbmdzXG5cdFx0XHRmb3IgKHBhcmVudCA9IG5vZGUucGFyZW50OyBwYXJlbnQgJiYgcGFyZW50ICE9PSByb290X25vZGU7IHBhcmVudCA9IHBhcmVudC5wYXJlbnQpIHtcblx0XHRcdFx0c2libGluZyA9IHBhcmVudFtzaWJsaW5nTmFtZV07XG5cblx0XHRcdFx0aWYgKHNpYmxpbmcpIHtcblx0XHRcdFx0XHRyZXR1cm4gc2libGluZztcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdC8qKlxuXHQgKiBDb25zdHJ1Y3RzIGEgbmV3IE5vZGUgaW5zdGFuY2UuXG5cdCAqXG5cdCAqIEBjb25zdHJ1Y3RvclxuXHQgKiBAbWV0aG9kIE5vZGVcblx0ICogQHBhcmFtIHtTdHJpbmd9IG5hbWUgTmFtZSBvZiB0aGUgbm9kZSB0eXBlLlxuXHQgKiBAcGFyYW0ge051bWJlcn0gdHlwZSBOdW1lcmljIHR5cGUgcmVwcmVzZW50aW5nIHRoZSBub2RlLlxuXHQgKi9cblx0ZnVuY3Rpb24gTm9kZShuYW1lLCB0eXBlKSB7XG5cdFx0dGhpcy5uYW1lID0gbmFtZTtcblx0XHR0aGlzLnR5cGUgPSB0eXBlO1xuXG5cdFx0aWYgKHR5cGUgPT09IDEpIHtcblx0XHRcdHRoaXMuYXR0cmlidXRlcyA9IFtdO1xuXHRcdFx0dGhpcy5hdHRyaWJ1dGVzLm1hcCA9IHt9O1xuXHRcdH1cblx0fVxuXG5cdE5vZGUucHJvdG90eXBlID0ge1xuXHRcdC8qKlxuXHRcdCAqIFJlcGxhY2VzIHRoZSBjdXJyZW50IG5vZGUgd2l0aCB0aGUgc3BlY2lmaWVkIG9uZS5cblx0XHQgKlxuXHRcdCAqIEBleGFtcGxlXG5cdFx0ICogc29tZU5vZGUucmVwbGFjZShzb21lTmV3Tm9kZSk7XG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHJlcGxhY2Vcblx0XHQgKiBAcGFyYW0ge3RpbnltY2UuaHRtbC5Ob2RlfSBub2RlIE5vZGUgdG8gcmVwbGFjZSB0aGUgY3VycmVudCBub2RlIHdpdGguXG5cdFx0ICogQHJldHVybiB7dGlueW1jZS5odG1sLk5vZGV9IFRoZSBvbGQgbm9kZSB0aGF0IGdvdCByZXBsYWNlZC5cblx0XHQgKi9cblx0XHRyZXBsYWNlOiBmdW5jdGlvbihub2RlKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdGlmIChub2RlLnBhcmVudCkge1xuXHRcdFx0XHRub2RlLnJlbW92ZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRzZWxmLmluc2VydChub2RlLCBzZWxmKTtcblx0XHRcdHNlbGYucmVtb3ZlKCk7XG5cblx0XHRcdHJldHVybiBzZWxmO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBHZXRzL3NldHMgb3IgcmVtb3ZlcyBhbiBhdHRyaWJ1dGUgYnkgbmFtZS5cblx0XHQgKlxuXHRcdCAqIEBleGFtcGxlXG5cdFx0ICogc29tZU5vZGUuYXR0cihcIm5hbWVcIiwgXCJ2YWx1ZVwiKTsgLy8gU2V0cyBhbiBhdHRyaWJ1dGVcblx0XHQgKiBjb25zb2xlLmxvZyhzb21lTm9kZS5hdHRyKFwibmFtZVwiKSk7IC8vIEdldHMgYW4gYXR0cmlidXRlXG5cdFx0ICogc29tZU5vZGUuYXR0cihcIm5hbWVcIiwgbnVsbCk7IC8vIFJlbW92ZXMgYW4gYXR0cmlidXRlXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGF0dHJcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSBBdHRyaWJ1dGUgbmFtZSB0byBzZXQgb3IgZ2V0LlxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSB2YWx1ZSBPcHRpb25hbCB2YWx1ZSB0byBzZXQuXG5cdFx0ICogQHJldHVybiB7U3RyaW5nL3RpbnltY2UuaHRtbC5Ob2RlfSBTdHJpbmcgb3IgdW5kZWZpbmVkIG9uIGEgZ2V0IG9wZXJhdGlvbiBvciB0aGUgY3VycmVudCBub2RlIG9uIGEgc2V0IG9wZXJhdGlvbi5cblx0XHQgKi9cblx0XHRhdHRyOiBmdW5jdGlvbihuYW1lLCB2YWx1ZSkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLCBhdHRycywgaSwgdW5kZWY7XG5cblx0XHRcdGlmICh0eXBlb2YgbmFtZSAhPT0gXCJzdHJpbmdcIikge1xuXHRcdFx0XHRmb3IgKGkgaW4gbmFtZSkge1xuXHRcdFx0XHRcdHNlbGYuYXR0cihpLCBuYW1lW2ldKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBzZWxmO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoKGF0dHJzID0gc2VsZi5hdHRyaWJ1dGVzKSkge1xuXHRcdFx0XHRpZiAodmFsdWUgIT09IHVuZGVmKSB7XG5cdFx0XHRcdFx0Ly8gUmVtb3ZlIGF0dHJpYnV0ZVxuXHRcdFx0XHRcdGlmICh2YWx1ZSA9PT0gbnVsbCkge1xuXHRcdFx0XHRcdFx0aWYgKG5hbWUgaW4gYXR0cnMubWFwKSB7XG5cdFx0XHRcdFx0XHRcdGRlbGV0ZSBhdHRycy5tYXBbbmFtZV07XG5cblx0XHRcdFx0XHRcdFx0aSA9IGF0dHJzLmxlbmd0aDtcblx0XHRcdFx0XHRcdFx0d2hpbGUgKGktLSkge1xuXHRcdFx0XHRcdFx0XHRcdGlmIChhdHRyc1tpXS5uYW1lID09PSBuYW1lKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRhdHRycyA9IGF0dHJzLnNwbGljZShpLCAxKTtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiBzZWxmO1xuXHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gc2VsZjtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHQvLyBTZXQgYXR0cmlidXRlXG5cdFx0XHRcdFx0aWYgKG5hbWUgaW4gYXR0cnMubWFwKSB7XG5cdFx0XHRcdFx0XHQvLyBTZXQgYXR0cmlidXRlXG5cdFx0XHRcdFx0XHRpID0gYXR0cnMubGVuZ3RoO1xuXHRcdFx0XHRcdFx0d2hpbGUgKGktLSkge1xuXHRcdFx0XHRcdFx0XHRpZiAoYXR0cnNbaV0ubmFtZSA9PT0gbmFtZSkge1xuXHRcdFx0XHRcdFx0XHRcdGF0dHJzW2ldLnZhbHVlID0gdmFsdWU7XG5cdFx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0YXR0cnMucHVzaCh7bmFtZTogbmFtZSwgdmFsdWU6IHZhbHVlfSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0YXR0cnMubWFwW25hbWVdID0gdmFsdWU7XG5cblx0XHRcdFx0XHRyZXR1cm4gc2VsZjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBhdHRycy5tYXBbbmFtZV07XG5cdFx0XHR9XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIERvZXMgYSBzaGFsbG93IGNsb25lcyB0aGUgbm9kZSBpbnRvIGEgbmV3IG5vZGUuIEl0IHdpbGwgYWxzbyBleGNsdWRlIGlkIGF0dHJpYnV0ZXMgc2luY2Vcblx0XHQgKiB0aGVyZSBzaG91bGQgb25seSBiZSBvbmUgaWQgcGVyIGRvY3VtZW50LlxuXHRcdCAqXG5cdFx0ICogQGV4YW1wbGVcblx0XHQgKiB2YXIgY2xvbmVkTm9kZSA9IG5vZGUuY2xvbmUoKTtcblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgY2xvbmVcblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLmh0bWwuTm9kZX0gTmV3IGNvcHkgb2YgdGhlIG9yaWdpbmFsIG5vZGUuXG5cdFx0ICovXG5cdFx0Y2xvbmU6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLCBjbG9uZSA9IG5ldyBOb2RlKHNlbGYubmFtZSwgc2VsZi50eXBlKSwgaSwgbCwgc2VsZkF0dHJzLCBzZWxmQXR0ciwgY2xvbmVBdHRycztcblxuXHRcdFx0Ly8gQ2xvbmUgZWxlbWVudCBhdHRyaWJ1dGVzXG5cdFx0XHRpZiAoKHNlbGZBdHRycyA9IHNlbGYuYXR0cmlidXRlcykpIHtcblx0XHRcdFx0Y2xvbmVBdHRycyA9IFtdO1xuXHRcdFx0XHRjbG9uZUF0dHJzLm1hcCA9IHt9O1xuXG5cdFx0XHRcdGZvciAoaSA9IDAsIGwgPSBzZWxmQXR0cnMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG5cdFx0XHRcdFx0c2VsZkF0dHIgPSBzZWxmQXR0cnNbaV07XG5cblx0XHRcdFx0XHQvLyBDbG9uZSBldmVyeXRoaW5nIGV4Y2VwdCBpZFxuXHRcdFx0XHRcdGlmIChzZWxmQXR0ci5uYW1lICE9PSAnaWQnKSB7XG5cdFx0XHRcdFx0XHRjbG9uZUF0dHJzW2Nsb25lQXR0cnMubGVuZ3RoXSA9IHtuYW1lOiBzZWxmQXR0ci5uYW1lLCB2YWx1ZTogc2VsZkF0dHIudmFsdWV9O1xuXHRcdFx0XHRcdFx0Y2xvbmVBdHRycy5tYXBbc2VsZkF0dHIubmFtZV0gPSBzZWxmQXR0ci52YWx1ZTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRjbG9uZS5hdHRyaWJ1dGVzID0gY2xvbmVBdHRycztcblx0XHRcdH1cblxuXHRcdFx0Y2xvbmUudmFsdWUgPSBzZWxmLnZhbHVlO1xuXHRcdFx0Y2xvbmUuc2hvcnRFbmRlZCA9IHNlbGYuc2hvcnRFbmRlZDtcblxuXHRcdFx0cmV0dXJuIGNsb25lO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBXcmFwcyB0aGUgbm9kZSBpbiBpbiBhbm90aGVyIG5vZGUuXG5cdFx0ICpcblx0XHQgKiBAZXhhbXBsZVxuXHRcdCAqIG5vZGUud3JhcCh3cmFwcGVyTm9kZSk7XG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHdyYXBcblx0XHQgKi9cblx0XHR3cmFwOiBmdW5jdGlvbih3cmFwcGVyKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdHNlbGYucGFyZW50Lmluc2VydCh3cmFwcGVyLCBzZWxmKTtcblx0XHRcdHdyYXBwZXIuYXBwZW5kKHNlbGYpO1xuXG5cdFx0XHRyZXR1cm4gc2VsZjtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogVW53cmFwcyB0aGUgbm9kZSBpbiBvdGhlciB3b3JkcyBpdCByZW1vdmVzIHRoZSBub2RlIGJ1dCBrZWVwcyB0aGUgY2hpbGRyZW4uXG5cdFx0ICpcblx0XHQgKiBAZXhhbXBsZVxuXHRcdCAqIG5vZGUudW53cmFwKCk7XG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHVud3JhcFxuXHRcdCAqL1xuXHRcdHVud3JhcDogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIG5vZGUsIG5leHQ7XG5cblx0XHRcdGZvciAobm9kZSA9IHNlbGYuZmlyc3RDaGlsZDsgbm9kZTspIHtcblx0XHRcdFx0bmV4dCA9IG5vZGUubmV4dDtcblx0XHRcdFx0c2VsZi5pbnNlcnQobm9kZSwgc2VsZiwgdHJ1ZSk7XG5cdFx0XHRcdG5vZGUgPSBuZXh0O1xuXHRcdFx0fVxuXG5cdFx0XHRzZWxmLnJlbW92ZSgpO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZW1vdmVzIHRoZSBub2RlIGZyb20gaXQncyBwYXJlbnQuXG5cdFx0ICpcblx0XHQgKiBAZXhhbXBsZVxuXHRcdCAqIG5vZGUucmVtb3ZlKCk7XG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHJlbW92ZVxuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UuaHRtbC5Ob2RlfSBDdXJyZW50IG5vZGUgdGhhdCBnb3QgcmVtb3ZlZC5cblx0XHQgKi9cblx0XHRyZW1vdmU6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLCBwYXJlbnQgPSBzZWxmLnBhcmVudCwgbmV4dCA9IHNlbGYubmV4dCwgcHJldiA9IHNlbGYucHJldjtcblxuXHRcdFx0aWYgKHBhcmVudCkge1xuXHRcdFx0XHRpZiAocGFyZW50LmZpcnN0Q2hpbGQgPT09IHNlbGYpIHtcblx0XHRcdFx0XHRwYXJlbnQuZmlyc3RDaGlsZCA9IG5leHQ7XG5cblx0XHRcdFx0XHRpZiAobmV4dCkge1xuXHRcdFx0XHRcdFx0bmV4dC5wcmV2ID0gbnVsbDtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0cHJldi5uZXh0ID0gbmV4dDtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChwYXJlbnQubGFzdENoaWxkID09PSBzZWxmKSB7XG5cdFx0XHRcdFx0cGFyZW50Lmxhc3RDaGlsZCA9IHByZXY7XG5cblx0XHRcdFx0XHRpZiAocHJldikge1xuXHRcdFx0XHRcdFx0cHJldi5uZXh0ID0gbnVsbDtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0bmV4dC5wcmV2ID0gcHJldjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHNlbGYucGFyZW50ID0gc2VsZi5uZXh0ID0gc2VsZi5wcmV2ID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHNlbGY7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIEFwcGVuZHMgYSBuZXcgbm9kZSBhcyBhIGNoaWxkIG9mIHRoZSBjdXJyZW50IG5vZGUuXG5cdFx0ICpcblx0XHQgKiBAZXhhbXBsZVxuXHRcdCAqIG5vZGUuYXBwZW5kKHNvbWVOb2RlKTtcblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgYXBwZW5kXG5cdFx0ICogQHBhcmFtIHt0aW55bWNlLmh0bWwuTm9kZX0gbm9kZSBOb2RlIHRvIGFwcGVuZCBhcyBhIGNoaWxkIG9mIHRoZSBjdXJyZW50IG9uZS5cblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLmh0bWwuTm9kZX0gVGhlIG5vZGUgdGhhdCBnb3QgYXBwZW5kZWQuXG5cdFx0ICovXG5cdFx0YXBwZW5kOiBmdW5jdGlvbihub2RlKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIGxhc3Q7XG5cblx0XHRcdGlmIChub2RlLnBhcmVudCkge1xuXHRcdFx0XHRub2RlLnJlbW92ZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRsYXN0ID0gc2VsZi5sYXN0Q2hpbGQ7XG5cdFx0XHRpZiAobGFzdCkge1xuXHRcdFx0XHRsYXN0Lm5leHQgPSBub2RlO1xuXHRcdFx0XHRub2RlLnByZXYgPSBsYXN0O1xuXHRcdFx0XHRzZWxmLmxhc3RDaGlsZCA9IG5vZGU7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRzZWxmLmxhc3RDaGlsZCA9IHNlbGYuZmlyc3RDaGlsZCA9IG5vZGU7XG5cdFx0XHR9XG5cblx0XHRcdG5vZGUucGFyZW50ID0gc2VsZjtcblxuXHRcdFx0cmV0dXJuIG5vZGU7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIEluc2VydHMgYSBub2RlIGF0IGEgc3BlY2lmaWMgcG9zaXRpb24gYXMgYSBjaGlsZCBvZiB0aGUgY3VycmVudCBub2RlLlxuXHRcdCAqXG5cdFx0ICogQGV4YW1wbGVcblx0XHQgKiBwYXJlbnROb2RlLmluc2VydChuZXdDaGlsZE5vZGUsIG9sZENoaWxkTm9kZSk7XG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGluc2VydFxuXHRcdCAqIEBwYXJhbSB7dGlueW1jZS5odG1sLk5vZGV9IG5vZGUgTm9kZSB0byBpbnNlcnQgYXMgYSBjaGlsZCBvZiB0aGUgY3VycmVudCBub2RlLlxuXHRcdCAqIEBwYXJhbSB7dGlueW1jZS5odG1sLk5vZGV9IHJlZl9ub2RlIFJlZmVyZW5jZSBub2RlIHRvIHNldCBub2RlIGJlZm9yZS9hZnRlci5cblx0XHQgKiBAcGFyYW0ge0Jvb2xlYW59IGJlZm9yZSBPcHRpb25hbCBzdGF0ZSB0byBpbnNlcnQgdGhlIG5vZGUgYmVmb3JlIHRoZSByZWZlcmVuY2Ugbm9kZS5cblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLmh0bWwuTm9kZX0gVGhlIG5vZGUgdGhhdCBnb3QgaW5zZXJ0ZWQuXG5cdFx0ICovXG5cdFx0aW5zZXJ0OiBmdW5jdGlvbihub2RlLCByZWZfbm9kZSwgYmVmb3JlKSB7XG5cdFx0XHR2YXIgcGFyZW50O1xuXG5cdFx0XHRpZiAobm9kZS5wYXJlbnQpIHtcblx0XHRcdFx0bm9kZS5yZW1vdmUoKTtcblx0XHRcdH1cblxuXHRcdFx0cGFyZW50ID0gcmVmX25vZGUucGFyZW50IHx8IHRoaXM7XG5cblx0XHRcdGlmIChiZWZvcmUpIHtcblx0XHRcdFx0aWYgKHJlZl9ub2RlID09PSBwYXJlbnQuZmlyc3RDaGlsZCkge1xuXHRcdFx0XHRcdHBhcmVudC5maXJzdENoaWxkID0gbm9kZTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRyZWZfbm9kZS5wcmV2Lm5leHQgPSBub2RlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0bm9kZS5wcmV2ID0gcmVmX25vZGUucHJldjtcblx0XHRcdFx0bm9kZS5uZXh0ID0gcmVmX25vZGU7XG5cdFx0XHRcdHJlZl9ub2RlLnByZXYgPSBub2RlO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0aWYgKHJlZl9ub2RlID09PSBwYXJlbnQubGFzdENoaWxkKSB7XG5cdFx0XHRcdFx0cGFyZW50Lmxhc3RDaGlsZCA9IG5vZGU7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0cmVmX25vZGUubmV4dC5wcmV2ID0gbm9kZTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdG5vZGUubmV4dCA9IHJlZl9ub2RlLm5leHQ7XG5cdFx0XHRcdG5vZGUucHJldiA9IHJlZl9ub2RlO1xuXHRcdFx0XHRyZWZfbm9kZS5uZXh0ID0gbm9kZTtcblx0XHRcdH1cblxuXHRcdFx0bm9kZS5wYXJlbnQgPSBwYXJlbnQ7XG5cblx0XHRcdHJldHVybiBub2RlO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBHZXQgYWxsIGNoaWxkcmVuIGJ5IG5hbWUuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGdldEFsbFxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIE5hbWUgb2YgdGhlIGNoaWxkIG5vZGVzIHRvIGNvbGxlY3QuXG5cdFx0ICogQHJldHVybiB7QXJyYXl9IEFycmF5IHdpdGggY2hpbGQgbm9kZXMgbWF0Y2hpbiB0aGUgc3BlY2lmaWVkIG5hbWUuXG5cdFx0ICovXG5cdFx0Z2V0QWxsOiBmdW5jdGlvbihuYW1lKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIG5vZGUsIGNvbGxlY3Rpb24gPSBbXTtcblxuXHRcdFx0Zm9yIChub2RlID0gc2VsZi5maXJzdENoaWxkOyBub2RlOyBub2RlID0gd2Fsayhub2RlLCBzZWxmKSkge1xuXHRcdFx0XHRpZiAobm9kZS5uYW1lID09PSBuYW1lKSB7XG5cdFx0XHRcdFx0Y29sbGVjdGlvbi5wdXNoKG5vZGUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBjb2xsZWN0aW9uO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZW1vdmVzIGFsbCBjaGlsZHJlbiBvZiB0aGUgY3VycmVudCBub2RlLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBlbXB0eVxuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UuaHRtbC5Ob2RlfSBUaGUgY3VycmVudCBub2RlIHRoYXQgZ290IGNsZWFyZWQuXG5cdFx0ICovXG5cdFx0ZW1wdHk6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLCBub2RlcywgaSwgbm9kZTtcblxuXHRcdFx0Ly8gUmVtb3ZlIGFsbCBjaGlsZHJlblxuXHRcdFx0aWYgKHNlbGYuZmlyc3RDaGlsZCkge1xuXHRcdFx0XHRub2RlcyA9IFtdO1xuXG5cdFx0XHRcdC8vIENvbGxlY3QgdGhlIGNoaWxkcmVuXG5cdFx0XHRcdGZvciAobm9kZSA9IHNlbGYuZmlyc3RDaGlsZDsgbm9kZTsgbm9kZSA9IHdhbGsobm9kZSwgc2VsZikpIHtcblx0XHRcdFx0XHRub2Rlcy5wdXNoKG5vZGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gUmVtb3ZlIHRoZSBjaGlsZHJlblxuXHRcdFx0XHRpID0gbm9kZXMubGVuZ3RoO1xuXHRcdFx0XHR3aGlsZSAoaS0tKSB7XG5cdFx0XHRcdFx0bm9kZSA9IG5vZGVzW2ldO1xuXHRcdFx0XHRcdG5vZGUucGFyZW50ID0gbm9kZS5maXJzdENoaWxkID0gbm9kZS5sYXN0Q2hpbGQgPSBub2RlLm5leHQgPSBub2RlLnByZXYgPSBudWxsO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHNlbGYuZmlyc3RDaGlsZCA9IHNlbGYubGFzdENoaWxkID0gbnVsbDtcblxuXHRcdFx0cmV0dXJuIHNlbGY7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFJldHVybnMgdHJ1ZS9mYWxzZSBpZiB0aGUgbm9kZSBpcyB0byBiZSBjb25zaWRlcmVkIGVtcHR5IG9yIG5vdC5cblx0XHQgKlxuXHRcdCAqIEBleGFtcGxlXG5cdFx0ICogbm9kZS5pc0VtcHR5KHtpbWc6IHRydWV9KTtcblx0XHQgKiBAbWV0aG9kIGlzRW1wdHlcblx0XHQgKiBAcGFyYW0ge09iamVjdH0gZWxlbWVudHMgTmFtZS92YWx1ZSBvYmplY3Qgd2l0aCBlbGVtZW50cyB0aGF0IGFyZSBhdXRvbWF0aWNhbGx5IHRyZWF0ZWQgYXMgbm9uIGVtcHR5IGVsZW1lbnRzLlxuXHRcdCAqIEByZXR1cm4ge0Jvb2xlYW59IHRydWUvZmFsc2UgaWYgdGhlIG5vZGUgaXMgZW1wdHkgb3Igbm90LlxuXHRcdCAqL1xuXHRcdGlzRW1wdHk6IGZ1bmN0aW9uKGVsZW1lbnRzKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIG5vZGUgPSBzZWxmLmZpcnN0Q2hpbGQsIGksIG5hbWU7XG5cblx0XHRcdGlmIChub2RlKSB7XG5cdFx0XHRcdGRvIHtcblx0XHRcdFx0XHRpZiAobm9kZS50eXBlID09PSAxKSB7XG5cdFx0XHRcdFx0XHQvLyBJZ25vcmUgYm9ndXMgZWxlbWVudHNcblx0XHRcdFx0XHRcdGlmIChub2RlLmF0dHJpYnV0ZXMubWFwWydkYXRhLW1jZS1ib2d1cyddKSB7XG5cdFx0XHRcdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHQvLyBLZWVwIGVtcHR5IGVsZW1lbnRzIGxpa2UgPGltZyAvPlxuXHRcdFx0XHRcdFx0aWYgKGVsZW1lbnRzW25vZGUubmFtZV0pIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHQvLyBLZWVwIGJvb2ttYXJrIG5vZGVzIGFuZCBuYW1lIGF0dHJpYnV0ZSBsaWtlIDxhIG5hbWU9XCIxXCI+PC9hPlxuXHRcdFx0XHRcdFx0aSA9IG5vZGUuYXR0cmlidXRlcy5sZW5ndGg7XG5cdFx0XHRcdFx0XHR3aGlsZSAoaS0tKSB7XG5cdFx0XHRcdFx0XHRcdG5hbWUgPSBub2RlLmF0dHJpYnV0ZXNbaV0ubmFtZTtcblx0XHRcdFx0XHRcdFx0aWYgKG5hbWUgPT09IFwibmFtZVwiIHx8IG5hbWUuaW5kZXhPZignZGF0YS1tY2UtYm9va21hcmsnKSA9PT0gMCkge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdC8vIEtlZXAgY29tbWVudHNcblx0XHRcdFx0XHRpZiAobm9kZS50eXBlID09PSA4KSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Ly8gS2VlcCBub24gd2hpdGVzcGFjZSB0ZXh0IG5vZGVzXG5cdFx0XHRcdFx0aWYgKChub2RlLnR5cGUgPT09IDMgJiYgIXdoaXRlU3BhY2VSZWdFeHAudGVzdChub2RlLnZhbHVlKSkpIHtcblx0XHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gd2hpbGUgKChub2RlID0gd2Fsayhub2RlLCBzZWxmKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogV2Fsa3MgdG8gdGhlIG5leHQgb3IgcHJldmlvdXMgbm9kZSBhbmQgcmV0dXJucyB0aGF0IG5vZGUgb3IgbnVsbCBpZiBpdCB3YXNuJ3QgZm91bmQuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHdhbGtcblx0XHQgKiBAcGFyYW0ge0Jvb2xlYW59IHByZXYgT3B0aW9uYWwgcHJldmlvdXMgbm9kZSBzdGF0ZSBkZWZhdWx0cyB0byBmYWxzZS5cblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLmh0bWwuTm9kZX0gTm9kZSB0aGF0IGlzIG5leHQgdG8gb3IgcHJldmlvdXMgb2YgdGhlIGN1cnJlbnQgbm9kZS5cblx0XHQgKi9cblx0XHR3YWxrOiBmdW5jdGlvbihwcmV2KSB7XG5cdFx0XHRyZXR1cm4gd2Fsayh0aGlzLCBudWxsLCBwcmV2KTtcblx0XHR9XG5cdH07XG5cblx0LyoqXG5cdCAqIENyZWF0ZXMgYSBub2RlIG9mIGEgc3BlY2lmaWMgdHlwZS5cblx0ICpcblx0ICogQHN0YXRpY1xuXHQgKiBAbWV0aG9kIGNyZWF0ZVxuXHQgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSBOYW1lIG9mIHRoZSBub2RlIHR5cGUgdG8gY3JlYXRlIGZvciBleGFtcGxlIFwiYlwiIG9yIFwiI3RleHRcIi5cblx0ICogQHBhcmFtIHtPYmplY3R9IGF0dHJzIE5hbWUvdmFsdWUgY29sbGVjdGlvbiBvZiBhdHRyaWJ1dGVzIHRoYXQgd2lsbCBiZSBhcHBsaWVkIHRvIGVsZW1lbnRzLlxuXHQgKi9cblx0Tm9kZS5jcmVhdGUgPSBmdW5jdGlvbihuYW1lLCBhdHRycykge1xuXHRcdHZhciBub2RlLCBhdHRyTmFtZTtcblxuXHRcdC8vIENyZWF0ZSBub2RlXG5cdFx0bm9kZSA9IG5ldyBOb2RlKG5hbWUsIHR5cGVMb29rdXBbbmFtZV0gfHwgMSk7XG5cblx0XHQvLyBBZGQgYXR0cmlidXRlcyBpZiBuZWVkZWRcblx0XHRpZiAoYXR0cnMpIHtcblx0XHRcdGZvciAoYXR0ck5hbWUgaW4gYXR0cnMpIHtcblx0XHRcdFx0bm9kZS5hdHRyKGF0dHJOYW1lLCBhdHRyc1thdHRyTmFtZV0pO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiBub2RlO1xuXHR9O1xuXG5cdHJldHVybiBOb2RlO1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy9odG1sL1NjaGVtYS5qc1xuXG4vKipcbiAqIFNjaGVtYS5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE1IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKipcbiAqIFNjaGVtYSB2YWxpZGF0b3IgY2xhc3MuXG4gKlxuICogQGNsYXNzIHRpbnltY2UuaHRtbC5TY2hlbWFcbiAqIEBleGFtcGxlXG4gKiAgaWYgKHRpbnltY2UuYWN0aXZlRWRpdG9yLnNjaGVtYS5pc1ZhbGlkQ2hpbGQoJ3AnLCAnc3BhbicpKVxuICogICAgYWxlcnQoJ3NwYW4gaXMgdmFsaWQgY2hpbGQgb2YgcC4nKTtcbiAqXG4gKiAgaWYgKHRpbnltY2UuYWN0aXZlRWRpdG9yLnNjaGVtYS5nZXRFbGVtZW50UnVsZSgncCcpKVxuICogICAgYWxlcnQoJ1AgaXMgYSB2YWxpZCBlbGVtZW50LicpO1xuICpcbiAqIEBjbGFzcyB0aW55bWNlLmh0bWwuU2NoZW1hXG4gKiBAdmVyc2lvbiAzLjRcbiAqL1xuZGVmaW5lKFwidGlueW1jZS9odG1sL1NjaGVtYVwiLCBbXG5cdFwidGlueW1jZS91dGlsL1Rvb2xzXCJcbl0sIGZ1bmN0aW9uKFRvb2xzKSB7XG5cdHZhciBtYXBDYWNoZSA9IHt9LCBkdW1teU9iaiA9IHt9O1xuXHR2YXIgbWFrZU1hcCA9IFRvb2xzLm1ha2VNYXAsIGVhY2ggPSBUb29scy5lYWNoLCBleHRlbmQgPSBUb29scy5leHRlbmQsIGV4cGxvZGUgPSBUb29scy5leHBsb2RlLCBpbkFycmF5ID0gVG9vbHMuaW5BcnJheTtcblxuXHRmdW5jdGlvbiBzcGxpdChpdGVtcywgZGVsaW0pIHtcblx0XHRpdGVtcyA9IFRvb2xzLnRyaW0oaXRlbXMpO1xuXHRcdHJldHVybiBpdGVtcyA/IGl0ZW1zLnNwbGl0KGRlbGltIHx8ICcgJykgOiBbXTtcblx0fVxuXG5cdC8qKlxuXHQgKiBCdWlsZHMgYSBzY2hlbWEgbG9va3VwIHRhYmxlXG5cdCAqXG5cdCAqIEBwcml2YXRlXG5cdCAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlIGh0bWw0LCBodG1sNSBvciBodG1sNS1zdHJpY3Qgc2NoZW1hIHR5cGUuXG5cdCAqIEByZXR1cm4ge09iamVjdH0gU2NoZW1hIGxvb2t1cCB0YWJsZS5cblx0ICovXG5cdGZ1bmN0aW9uIGNvbXBpbGVTY2hlbWEodHlwZSkge1xuXHRcdHZhciBzY2hlbWEgPSB7fSwgZ2xvYmFsQXR0cmlidXRlcywgYmxvY2tDb250ZW50O1xuXHRcdHZhciBwaHJhc2luZ0NvbnRlbnQsIGZsb3dDb250ZW50LCBodG1sNEJsb2NrQ29udGVudCwgaHRtbDRQaHJhc2luZ0NvbnRlbnQ7XG5cblx0XHRmdW5jdGlvbiBhZGQobmFtZSwgYXR0cmlidXRlcywgY2hpbGRyZW4pIHtcblx0XHRcdHZhciBuaSwgYXR0cmlidXRlc09yZGVyLCBlbGVtZW50O1xuXG5cdFx0XHRmdW5jdGlvbiBhcnJheVRvTWFwKGFycmF5LCBvYmopIHtcblx0XHRcdFx0dmFyIG1hcCA9IHt9LCBpLCBsO1xuXG5cdFx0XHRcdGZvciAoaSA9IDAsIGwgPSBhcnJheS5sZW5ndGg7IGkgPCBsOyBpKyspIHtcblx0XHRcdFx0XHRtYXBbYXJyYXlbaV1dID0gb2JqIHx8IHt9O1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG1hcDtcblx0XHRcdH1cblxuXHRcdFx0Y2hpbGRyZW4gPSBjaGlsZHJlbiB8fCBbXTtcblx0XHRcdGF0dHJpYnV0ZXMgPSBhdHRyaWJ1dGVzIHx8IFwiXCI7XG5cblx0XHRcdGlmICh0eXBlb2YgY2hpbGRyZW4gPT09IFwic3RyaW5nXCIpIHtcblx0XHRcdFx0Y2hpbGRyZW4gPSBzcGxpdChjaGlsZHJlbik7XG5cdFx0XHR9XG5cblx0XHRcdG5hbWUgPSBzcGxpdChuYW1lKTtcblx0XHRcdG5pID0gbmFtZS5sZW5ndGg7XG5cdFx0XHR3aGlsZSAobmktLSkge1xuXHRcdFx0XHRhdHRyaWJ1dGVzT3JkZXIgPSBzcGxpdChbZ2xvYmFsQXR0cmlidXRlcywgYXR0cmlidXRlc10uam9pbignICcpKTtcblxuXHRcdFx0XHRlbGVtZW50ID0ge1xuXHRcdFx0XHRcdGF0dHJpYnV0ZXM6IGFycmF5VG9NYXAoYXR0cmlidXRlc09yZGVyKSxcblx0XHRcdFx0XHRhdHRyaWJ1dGVzT3JkZXI6IGF0dHJpYnV0ZXNPcmRlcixcblx0XHRcdFx0XHRjaGlsZHJlbjogYXJyYXlUb01hcChjaGlsZHJlbiwgZHVtbXlPYmopXG5cdFx0XHRcdH07XG5cblx0XHRcdFx0c2NoZW1hW25hbWVbbmldXSA9IGVsZW1lbnQ7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gYWRkQXR0cnMobmFtZSwgYXR0cmlidXRlcykge1xuXHRcdFx0dmFyIG5pLCBzY2hlbWFJdGVtLCBpLCBsO1xuXG5cdFx0XHRuYW1lID0gc3BsaXQobmFtZSk7XG5cdFx0XHRuaSA9IG5hbWUubGVuZ3RoO1xuXHRcdFx0YXR0cmlidXRlcyA9IHNwbGl0KGF0dHJpYnV0ZXMpO1xuXHRcdFx0d2hpbGUgKG5pLS0pIHtcblx0XHRcdFx0c2NoZW1hSXRlbSA9IHNjaGVtYVtuYW1lW25pXV07XG5cdFx0XHRcdGZvciAoaSA9IDAsIGwgPSBhdHRyaWJ1dGVzLmxlbmd0aDsgaSA8IGw7IGkrKykge1xuXHRcdFx0XHRcdHNjaGVtYUl0ZW0uYXR0cmlidXRlc1thdHRyaWJ1dGVzW2ldXSA9IHt9O1xuXHRcdFx0XHRcdHNjaGVtYUl0ZW0uYXR0cmlidXRlc09yZGVyLnB1c2goYXR0cmlidXRlc1tpXSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHQvLyBVc2UgY2FjaGVkIHNjaGVtYVxuXHRcdGlmIChtYXBDYWNoZVt0eXBlXSkge1xuXHRcdFx0cmV0dXJuIG1hcENhY2hlW3R5cGVdO1xuXHRcdH1cblxuXHRcdC8vIEF0dHJpYnV0ZXMgcHJlc2VudCBvbiBhbGwgZWxlbWVudHNcblx0XHRnbG9iYWxBdHRyaWJ1dGVzID0gXCJpZCBhY2Nlc3NrZXkgY2xhc3MgZGlyIGxhbmcgc3R5bGUgdGFiaW5kZXggdGl0bGVcIjtcblxuXHRcdC8vIEV2ZW50IGF0dHJpYnV0ZXMgY2FuIGJlIG9wdC1pbi9vcHQtb3V0XG5cdFx0LypldmVudEF0dHJpYnV0ZXMgPSBzcGxpdChcIm9uYWJvcnQgb25ibHVyIG9uY2FuY2VsIG9uY2FucGxheSBvbmNhbnBsYXl0aHJvdWdoIG9uY2hhbmdlIG9uY2xpY2sgb25jbG9zZSBvbmNvbnRleHRtZW51IG9uY3VlY2hhbmdlIFwiICtcblx0XHQgXCJvbmRibGNsaWNrIG9uZHJhZyBvbmRyYWdlbmQgb25kcmFnZW50ZXIgb25kcmFnbGVhdmUgb25kcmFnb3ZlciBvbmRyYWdzdGFydCBvbmRyb3Agb25kdXJhdGlvbmNoYW5nZSBvbmVtcHRpZWQgb25lbmRlZCBcIiArXG5cdFx0IFwib25lcnJvciBvbmZvY3VzIG9uaW5wdXQgb25pbnZhbGlkIG9ua2V5ZG93biBvbmtleXByZXNzIG9ua2V5dXAgb25sb2FkIG9ubG9hZGVkZGF0YSBvbmxvYWRlZG1ldGFkYXRhIG9ubG9hZHN0YXJ0IFwiICtcblx0XHQgXCJvbm1vdXNlZG93biBvbm1vdXNlbW92ZSBvbm1vdXNlb3V0IG9ubW91c2VvdmVyIG9ubW91c2V1cCBvbm1vdXNld2hlZWwgb25wYXVzZSBvbnBsYXkgb25wbGF5aW5nIG9ucHJvZ3Jlc3Mgb25yYXRlY2hhbmdlIFwiICtcblx0XHQgXCJvbnJlc2V0IG9uc2Nyb2xsIG9uc2Vla2VkIG9uc2Vla2luZyBvbnNlZWtpbmcgb25zZWxlY3Qgb25zaG93IG9uc3RhbGxlZCBvbnN1Ym1pdCBvbnN1c3BlbmQgb250aW1ldXBkYXRlIG9udm9sdW1lY2hhbmdlIFwiICtcblx0XHQgXCJvbndhaXRpbmdcIlxuXHRcdCApOyovXG5cblx0XHQvLyBCbG9jayBjb250ZW50IGVsZW1lbnRzXG5cdFx0YmxvY2tDb250ZW50ID1cblx0XHRcdFwiYWRkcmVzcyBibG9ja3F1b3RlIGRpdiBkbCBmaWVsZHNldCBmb3JtIGgxIGgyIGgzIGg0IGg1IGg2IGhyIG1lbnUgb2wgcCBwcmUgdGFibGUgdWxcIjtcblxuXHRcdC8vIFBocmFzaW5nIGNvbnRlbnQgZWxlbWVudHMgZnJvbSB0aGUgSFRNTDUgc3BlYyAoaW5saW5lKVxuXHRcdHBocmFzaW5nQ29udGVudCA9XG5cdFx0XHRcImEgYWJiciBiIGJkbyBiciBidXR0b24gY2l0ZSBjb2RlIGRlbCBkZm4gZW0gZW1iZWQgaSBpZnJhbWUgaW1nIGlucHV0IGlucyBrYmQgXCIgK1xuXHRcdFx0XCJsYWJlbCBtYXAgbm9zY3JpcHQgb2JqZWN0IHEgcyBzYW1wIHNjcmlwdCBzZWxlY3Qgc21hbGwgc3BhbiBzdHJvbmcgc3ViIHN1cCBcIiArXG5cdFx0XHRcInRleHRhcmVhIHUgdmFyICN0ZXh0ICNjb21tZW50XCJcblx0XHQ7XG5cblx0XHQvLyBBZGQgSFRNTDUgaXRlbXMgdG8gZ2xvYmFsQXR0cmlidXRlcywgYmxvY2tDb250ZW50LCBwaHJhc2luZ0NvbnRlbnRcblx0XHRpZiAodHlwZSAhPSBcImh0bWw0XCIpIHtcblx0XHRcdGdsb2JhbEF0dHJpYnV0ZXMgKz0gXCIgY29udGVudGVkaXRhYmxlIGNvbnRleHRtZW51IGRyYWdnYWJsZSBkcm9wem9uZSBcIiArXG5cdFx0XHRcdFwiaGlkZGVuIHNwZWxsY2hlY2sgdHJhbnNsYXRlXCI7XG5cdFx0XHRibG9ja0NvbnRlbnQgKz0gXCIgYXJ0aWNsZSBhc2lkZSBkZXRhaWxzIGRpYWxvZyBmaWd1cmUgaGVhZGVyIGZvb3RlciBoZ3JvdXAgc2VjdGlvbiBuYXZcIjtcblx0XHRcdHBocmFzaW5nQ29udGVudCArPSBcIiBhdWRpbyBjYW52YXMgY29tbWFuZCBkYXRhbGlzdCBtYXJrIG1ldGVyIG91dHB1dCBwaWN0dXJlIFwiICtcblx0XHRcdFx0XCJwcm9ncmVzcyB0aW1lIHdiciB2aWRlbyBydWJ5IGJkaSBrZXlnZW5cIjtcblx0XHR9XG5cblx0XHQvLyBBZGQgSFRNTDQgZWxlbWVudHMgdW5sZXNzIGl0J3MgaHRtbDUtc3RyaWN0XG5cdFx0aWYgKHR5cGUgIT0gXCJodG1sNS1zdHJpY3RcIikge1xuXHRcdFx0Z2xvYmFsQXR0cmlidXRlcyArPSBcIiB4bWw6bGFuZ1wiO1xuXG5cdFx0XHRodG1sNFBocmFzaW5nQ29udGVudCA9IFwiYWNyb255bSBhcHBsZXQgYmFzZWZvbnQgYmlnIGZvbnQgc3RyaWtlIHR0XCI7XG5cdFx0XHRwaHJhc2luZ0NvbnRlbnQgPSBbcGhyYXNpbmdDb250ZW50LCBodG1sNFBocmFzaW5nQ29udGVudF0uam9pbignICcpO1xuXG5cdFx0XHRlYWNoKHNwbGl0KGh0bWw0UGhyYXNpbmdDb250ZW50KSwgZnVuY3Rpb24obmFtZSkge1xuXHRcdFx0XHRhZGQobmFtZSwgXCJcIiwgcGhyYXNpbmdDb250ZW50KTtcblx0XHRcdH0pO1xuXG5cdFx0XHRodG1sNEJsb2NrQ29udGVudCA9IFwiY2VudGVyIGRpciBpc2luZGV4IG5vZnJhbWVzXCI7XG5cdFx0XHRibG9ja0NvbnRlbnQgPSBbYmxvY2tDb250ZW50LCBodG1sNEJsb2NrQ29udGVudF0uam9pbignICcpO1xuXG5cdFx0XHQvLyBGbG93IGNvbnRlbnQgZWxlbWVudHMgZnJvbSB0aGUgSFRNTDUgc3BlYyAoYmxvY2sraW5saW5lKVxuXHRcdFx0Zmxvd0NvbnRlbnQgPSBbYmxvY2tDb250ZW50LCBwaHJhc2luZ0NvbnRlbnRdLmpvaW4oJyAnKTtcblxuXHRcdFx0ZWFjaChzcGxpdChodG1sNEJsb2NrQ29udGVudCksIGZ1bmN0aW9uKG5hbWUpIHtcblx0XHRcdFx0YWRkKG5hbWUsIFwiXCIsIGZsb3dDb250ZW50KTtcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdC8vIEZsb3cgY29udGVudCBlbGVtZW50cyBmcm9tIHRoZSBIVE1MNSBzcGVjIChibG9jaytpbmxpbmUpXG5cdFx0Zmxvd0NvbnRlbnQgPSBmbG93Q29udGVudCB8fCBbYmxvY2tDb250ZW50LCBwaHJhc2luZ0NvbnRlbnRdLmpvaW4oXCIgXCIpO1xuXG5cdFx0Ly8gSFRNTDQgYmFzZSBzY2hlbWEgVE9ETzogTW92ZSBIVE1MNSBzcGVjaWZpYyBhdHRyaWJ1dGVzIHRvIEhUTUw1IHNwZWNpZmljIGlmIHN0YXRlbWVudFxuXHRcdC8vIFNjaGVtYSBpdGVtcyA8ZWxlbWVudCBuYW1lPiwgPHNwZWNpZmljIGF0dHJpYnV0ZXM+LCA8Y2hpbGRyZW4gLi4+XG5cdFx0YWRkKFwiaHRtbFwiLCBcIm1hbmlmZXN0XCIsIFwiaGVhZCBib2R5XCIpO1xuXHRcdGFkZChcImhlYWRcIiwgXCJcIiwgXCJiYXNlIGNvbW1hbmQgbGluayBtZXRhIG5vc2NyaXB0IHNjcmlwdCBzdHlsZSB0aXRsZVwiKTtcblx0XHRhZGQoXCJ0aXRsZSBociBub3NjcmlwdCBiclwiKTtcblx0XHRhZGQoXCJiYXNlXCIsIFwiaHJlZiB0YXJnZXRcIik7XG5cdFx0YWRkKFwibGlua1wiLCBcImhyZWYgcmVsIG1lZGlhIGhyZWZsYW5nIHR5cGUgc2l6ZXMgaHJlZmxhbmdcIik7XG5cdFx0YWRkKFwibWV0YVwiLCBcIm5hbWUgaHR0cC1lcXVpdiBjb250ZW50IGNoYXJzZXRcIik7XG5cdFx0YWRkKFwic3R5bGVcIiwgXCJtZWRpYSB0eXBlIHNjb3BlZFwiKTtcblx0XHRhZGQoXCJzY3JpcHRcIiwgXCJzcmMgYXN5bmMgZGVmZXIgdHlwZSBjaGFyc2V0XCIpO1xuXHRcdGFkZChcImJvZHlcIiwgXCJvbmFmdGVycHJpbnQgb25iZWZvcmVwcmludCBvbmJlZm9yZXVubG9hZCBvbmJsdXIgb25lcnJvciBvbmZvY3VzIFwiICtcblx0XHRcIm9uaGFzaGNoYW5nZSBvbmxvYWQgb25tZXNzYWdlIG9ub2ZmbGluZSBvbm9ubGluZSBvbnBhZ2VoaWRlIG9ucGFnZXNob3cgXCIgK1xuXHRcdFwib25wb3BzdGF0ZSBvbnJlc2l6ZSBvbnNjcm9sbCBvbnN0b3JhZ2Ugb251bmxvYWRcIiwgZmxvd0NvbnRlbnQpO1xuXHRcdGFkZChcImFkZHJlc3MgZHQgZGQgZGl2IGNhcHRpb25cIiwgXCJcIiwgZmxvd0NvbnRlbnQpO1xuXHRcdGFkZChcImgxIGgyIGgzIGg0IGg1IGg2IHByZSBwIGFiYnIgY29kZSB2YXIgc2FtcCBrYmQgc3ViIHN1cCBpIGIgdSBiZG8gc3BhbiBsZWdlbmQgZW0gc3Ryb25nIHNtYWxsIHMgY2l0ZSBkZm5cIiwgXCJcIiwgcGhyYXNpbmdDb250ZW50KTtcblx0XHRhZGQoXCJibG9ja3F1b3RlXCIsIFwiY2l0ZVwiLCBmbG93Q29udGVudCk7XG5cdFx0YWRkKFwib2xcIiwgXCJyZXZlcnNlZCBzdGFydCB0eXBlXCIsIFwibGlcIik7XG5cdFx0YWRkKFwidWxcIiwgXCJcIiwgXCJsaVwiKTtcblx0XHRhZGQoXCJsaVwiLCBcInZhbHVlXCIsIGZsb3dDb250ZW50KTtcblx0XHRhZGQoXCJkbFwiLCBcIlwiLCBcImR0IGRkXCIpO1xuXHRcdGFkZChcImFcIiwgXCJocmVmIHRhcmdldCByZWwgbWVkaWEgaHJlZmxhbmcgdHlwZVwiLCBwaHJhc2luZ0NvbnRlbnQpO1xuXHRcdGFkZChcInFcIiwgXCJjaXRlXCIsIHBocmFzaW5nQ29udGVudCk7XG5cdFx0YWRkKFwiaW5zIGRlbFwiLCBcImNpdGUgZGF0ZXRpbWVcIiwgZmxvd0NvbnRlbnQpO1xuXHRcdGFkZChcImltZ1wiLCBcInNyYyBzaXplcyBzcmNzZXQgYWx0IHVzZW1hcCBpc21hcCB3aWR0aCBoZWlnaHRcIik7XG5cdFx0YWRkKFwiaWZyYW1lXCIsIFwic3JjIG5hbWUgd2lkdGggaGVpZ2h0XCIsIGZsb3dDb250ZW50KTtcblx0XHRhZGQoXCJlbWJlZFwiLCBcInNyYyB0eXBlIHdpZHRoIGhlaWdodFwiKTtcblx0XHRhZGQoXCJvYmplY3RcIiwgXCJkYXRhIHR5cGUgdHlwZW11c3RtYXRjaCBuYW1lIHVzZW1hcCBmb3JtIHdpZHRoIGhlaWdodFwiLCBbZmxvd0NvbnRlbnQsIFwicGFyYW1cIl0uam9pbignICcpKTtcblx0XHRhZGQoXCJwYXJhbVwiLCBcIm5hbWUgdmFsdWVcIik7XG5cdFx0YWRkKFwibWFwXCIsIFwibmFtZVwiLCBbZmxvd0NvbnRlbnQsIFwiYXJlYVwiXS5qb2luKCcgJykpO1xuXHRcdGFkZChcImFyZWFcIiwgXCJhbHQgY29vcmRzIHNoYXBlIGhyZWYgdGFyZ2V0IHJlbCBtZWRpYSBocmVmbGFuZyB0eXBlXCIpO1xuXHRcdGFkZChcInRhYmxlXCIsIFwiYm9yZGVyXCIsIFwiY2FwdGlvbiBjb2xncm91cCB0aGVhZCB0Zm9vdCB0Ym9keSB0clwiICsgKHR5cGUgPT0gXCJodG1sNFwiID8gXCIgY29sXCIgOiBcIlwiKSk7XG5cdFx0YWRkKFwiY29sZ3JvdXBcIiwgXCJzcGFuXCIsIFwiY29sXCIpO1xuXHRcdGFkZChcImNvbFwiLCBcInNwYW5cIik7XG5cdFx0YWRkKFwidGJvZHkgdGhlYWQgdGZvb3RcIiwgXCJcIiwgXCJ0clwiKTtcblx0XHRhZGQoXCJ0clwiLCBcIlwiLCBcInRkIHRoXCIpO1xuXHRcdGFkZChcInRkXCIsIFwiY29sc3BhbiByb3dzcGFuIGhlYWRlcnNcIiwgZmxvd0NvbnRlbnQpO1xuXHRcdGFkZChcInRoXCIsIFwiY29sc3BhbiByb3dzcGFuIGhlYWRlcnMgc2NvcGUgYWJiclwiLCBmbG93Q29udGVudCk7XG5cdFx0YWRkKFwiZm9ybVwiLCBcImFjY2VwdC1jaGFyc2V0IGFjdGlvbiBhdXRvY29tcGxldGUgZW5jdHlwZSBtZXRob2QgbmFtZSBub3ZhbGlkYXRlIHRhcmdldFwiLCBmbG93Q29udGVudCk7XG5cdFx0YWRkKFwiZmllbGRzZXRcIiwgXCJkaXNhYmxlZCBmb3JtIG5hbWVcIiwgW2Zsb3dDb250ZW50LCBcImxlZ2VuZFwiXS5qb2luKCcgJykpO1xuXHRcdGFkZChcImxhYmVsXCIsIFwiZm9ybSBmb3JcIiwgcGhyYXNpbmdDb250ZW50KTtcblx0XHRhZGQoXCJpbnB1dFwiLCBcImFjY2VwdCBhbHQgYXV0b2NvbXBsZXRlIGNoZWNrZWQgZGlybmFtZSBkaXNhYmxlZCBmb3JtIGZvcm1hY3Rpb24gZm9ybWVuY3R5cGUgZm9ybW1ldGhvZCBmb3Jtbm92YWxpZGF0ZSBcIiArXG5cdFx0XHRcdFwiZm9ybXRhcmdldCBoZWlnaHQgbGlzdCBtYXggbWF4bGVuZ3RoIG1pbiBtdWx0aXBsZSBuYW1lIHBhdHRlcm4gcmVhZG9ubHkgcmVxdWlyZWQgc2l6ZSBzcmMgc3RlcCB0eXBlIHZhbHVlIHdpZHRoXCJcblx0XHQpO1xuXHRcdGFkZChcImJ1dHRvblwiLCBcImRpc2FibGVkIGZvcm0gZm9ybWFjdGlvbiBmb3JtZW5jdHlwZSBmb3JtbWV0aG9kIGZvcm1ub3ZhbGlkYXRlIGZvcm10YXJnZXQgbmFtZSB0eXBlIHZhbHVlXCIsXG5cdFx0XHR0eXBlID09IFwiaHRtbDRcIiA/IGZsb3dDb250ZW50IDogcGhyYXNpbmdDb250ZW50KTtcblx0XHRhZGQoXCJzZWxlY3RcIiwgXCJkaXNhYmxlZCBmb3JtIG11bHRpcGxlIG5hbWUgcmVxdWlyZWQgc2l6ZVwiLCBcIm9wdGlvbiBvcHRncm91cFwiKTtcblx0XHRhZGQoXCJvcHRncm91cFwiLCBcImRpc2FibGVkIGxhYmVsXCIsIFwib3B0aW9uXCIpO1xuXHRcdGFkZChcIm9wdGlvblwiLCBcImRpc2FibGVkIGxhYmVsIHNlbGVjdGVkIHZhbHVlXCIpO1xuXHRcdGFkZChcInRleHRhcmVhXCIsIFwiY29scyBkaXJuYW1lIGRpc2FibGVkIGZvcm0gbWF4bGVuZ3RoIG5hbWUgcmVhZG9ubHkgcmVxdWlyZWQgcm93cyB3cmFwXCIpO1xuXHRcdGFkZChcIm1lbnVcIiwgXCJ0eXBlIGxhYmVsXCIsIFtmbG93Q29udGVudCwgXCJsaVwiXS5qb2luKCcgJykpO1xuXHRcdGFkZChcIm5vc2NyaXB0XCIsIFwiXCIsIGZsb3dDb250ZW50KTtcblxuXHRcdC8vIEV4dGVuZCB3aXRoIEhUTUw1IGVsZW1lbnRzXG5cdFx0aWYgKHR5cGUgIT0gXCJodG1sNFwiKSB7XG5cdFx0XHRhZGQoXCJ3YnJcIik7XG5cdFx0XHRhZGQoXCJydWJ5XCIsIFwiXCIsIFtwaHJhc2luZ0NvbnRlbnQsIFwicnQgcnBcIl0uam9pbignICcpKTtcblx0XHRcdGFkZChcImZpZ2NhcHRpb25cIiwgXCJcIiwgZmxvd0NvbnRlbnQpO1xuXHRcdFx0YWRkKFwibWFyayBydCBycCBzdW1tYXJ5IGJkaVwiLCBcIlwiLCBwaHJhc2luZ0NvbnRlbnQpO1xuXHRcdFx0YWRkKFwiY2FudmFzXCIsIFwid2lkdGggaGVpZ2h0XCIsIGZsb3dDb250ZW50KTtcblx0XHRcdGFkZChcInZpZGVvXCIsIFwic3JjIGNyb3Nzb3JpZ2luIHBvc3RlciBwcmVsb2FkIGF1dG9wbGF5IG1lZGlhZ3JvdXAgbG9vcCBcIiArXG5cdFx0XHRcdFwibXV0ZWQgY29udHJvbHMgd2lkdGggaGVpZ2h0IGJ1ZmZlcmVkXCIsIFtmbG93Q29udGVudCwgXCJ0cmFjayBzb3VyY2VcIl0uam9pbignICcpKTtcblx0XHRcdGFkZChcImF1ZGlvXCIsIFwic3JjIGNyb3Nzb3JpZ2luIHByZWxvYWQgYXV0b3BsYXkgbWVkaWFncm91cCBsb29wIG11dGVkIGNvbnRyb2xzIFwiICtcblx0XHRcdFx0XCJidWZmZXJlZCB2b2x1bWVcIiwgW2Zsb3dDb250ZW50LCBcInRyYWNrIHNvdXJjZVwiXS5qb2luKCcgJykpO1xuXHRcdFx0YWRkKFwicGljdHVyZVwiLCBcIlwiLCBcImltZyBzb3VyY2VcIik7XG5cdFx0XHRhZGQoXCJzb3VyY2VcIiwgXCJzcmMgc3Jjc2V0IHR5cGUgbWVkaWEgc2l6ZXNcIik7XG5cdFx0XHRhZGQoXCJ0cmFja1wiLCBcImtpbmQgc3JjIHNyY2xhbmcgbGFiZWwgZGVmYXVsdFwiKTtcblx0XHRcdGFkZChcImRhdGFsaXN0XCIsIFwiXCIsIFtwaHJhc2luZ0NvbnRlbnQsIFwib3B0aW9uXCJdLmpvaW4oJyAnKSk7XG5cdFx0XHRhZGQoXCJhcnRpY2xlIHNlY3Rpb24gbmF2IGFzaWRlIGhlYWRlciBmb290ZXJcIiwgXCJcIiwgZmxvd0NvbnRlbnQpO1xuXHRcdFx0YWRkKFwiaGdyb3VwXCIsIFwiXCIsIFwiaDEgaDIgaDMgaDQgaDUgaDZcIik7XG5cdFx0XHRhZGQoXCJmaWd1cmVcIiwgXCJcIiwgW2Zsb3dDb250ZW50LCBcImZpZ2NhcHRpb25cIl0uam9pbignICcpKTtcblx0XHRcdGFkZChcInRpbWVcIiwgXCJkYXRldGltZVwiLCBwaHJhc2luZ0NvbnRlbnQpO1xuXHRcdFx0YWRkKFwiZGlhbG9nXCIsIFwib3BlblwiLCBmbG93Q29udGVudCk7XG5cdFx0XHRhZGQoXCJjb21tYW5kXCIsIFwidHlwZSBsYWJlbCBpY29uIGRpc2FibGVkIGNoZWNrZWQgcmFkaW9ncm91cCBjb21tYW5kXCIpO1xuXHRcdFx0YWRkKFwib3V0cHV0XCIsIFwiZm9yIGZvcm0gbmFtZVwiLCBwaHJhc2luZ0NvbnRlbnQpO1xuXHRcdFx0YWRkKFwicHJvZ3Jlc3NcIiwgXCJ2YWx1ZSBtYXhcIiwgcGhyYXNpbmdDb250ZW50KTtcblx0XHRcdGFkZChcIm1ldGVyXCIsIFwidmFsdWUgbWluIG1heCBsb3cgaGlnaCBvcHRpbXVtXCIsIHBocmFzaW5nQ29udGVudCk7XG5cdFx0XHRhZGQoXCJkZXRhaWxzXCIsIFwib3BlblwiLCBbZmxvd0NvbnRlbnQsIFwic3VtbWFyeVwiXS5qb2luKCcgJykpO1xuXHRcdFx0YWRkKFwia2V5Z2VuXCIsIFwiYXV0b2ZvY3VzIGNoYWxsZW5nZSBkaXNhYmxlZCBmb3JtIGtleXR5cGUgbmFtZVwiKTtcblx0XHR9XG5cblx0XHQvLyBFeHRlbmQgd2l0aCBIVE1MNCBhdHRyaWJ1dGVzIHVubGVzcyBpdCdzIGh0bWw1LXN0cmljdFxuXHRcdGlmICh0eXBlICE9IFwiaHRtbDUtc3RyaWN0XCIpIHtcblx0XHRcdGFkZEF0dHJzKFwic2NyaXB0XCIsIFwibGFuZ3VhZ2UgeG1sOnNwYWNlXCIpO1xuXHRcdFx0YWRkQXR0cnMoXCJzdHlsZVwiLCBcInhtbDpzcGFjZVwiKTtcblx0XHRcdGFkZEF0dHJzKFwib2JqZWN0XCIsIFwiZGVjbGFyZSBjbGFzc2lkIGNvZGUgY29kZWJhc2UgY29kZXR5cGUgYXJjaGl2ZSBzdGFuZGJ5IGFsaWduIGJvcmRlciBoc3BhY2UgdnNwYWNlXCIpO1xuXHRcdFx0YWRkQXR0cnMoXCJlbWJlZFwiLCBcImFsaWduIG5hbWUgaHNwYWNlIHZzcGFjZVwiKTtcblx0XHRcdGFkZEF0dHJzKFwicGFyYW1cIiwgXCJ2YWx1ZXR5cGUgdHlwZVwiKTtcblx0XHRcdGFkZEF0dHJzKFwiYVwiLCBcImNoYXJzZXQgbmFtZSByZXYgc2hhcGUgY29vcmRzXCIpO1xuXHRcdFx0YWRkQXR0cnMoXCJiclwiLCBcImNsZWFyXCIpO1xuXHRcdFx0YWRkQXR0cnMoXCJhcHBsZXRcIiwgXCJjb2RlYmFzZSBhcmNoaXZlIGNvZGUgb2JqZWN0IGFsdCBuYW1lIHdpZHRoIGhlaWdodCBhbGlnbiBoc3BhY2UgdnNwYWNlXCIpO1xuXHRcdFx0YWRkQXR0cnMoXCJpbWdcIiwgXCJuYW1lIGxvbmdkZXNjIGFsaWduIGJvcmRlciBoc3BhY2UgdnNwYWNlXCIpO1xuXHRcdFx0YWRkQXR0cnMoXCJpZnJhbWVcIiwgXCJsb25nZGVzYyBmcmFtZWJvcmRlciBtYXJnaW53aWR0aCBtYXJnaW5oZWlnaHQgc2Nyb2xsaW5nIGFsaWduXCIpO1xuXHRcdFx0YWRkQXR0cnMoXCJmb250IGJhc2Vmb250XCIsIFwic2l6ZSBjb2xvciBmYWNlXCIpO1xuXHRcdFx0YWRkQXR0cnMoXCJpbnB1dFwiLCBcInVzZW1hcCBhbGlnblwiKTtcblx0XHRcdGFkZEF0dHJzKFwic2VsZWN0XCIsIFwib25jaGFuZ2VcIik7XG5cdFx0XHRhZGRBdHRycyhcInRleHRhcmVhXCIpO1xuXHRcdFx0YWRkQXR0cnMoXCJoMSBoMiBoMyBoNCBoNSBoNiBkaXYgcCBsZWdlbmQgY2FwdGlvblwiLCBcImFsaWduXCIpO1xuXHRcdFx0YWRkQXR0cnMoXCJ1bFwiLCBcInR5cGUgY29tcGFjdFwiKTtcblx0XHRcdGFkZEF0dHJzKFwibGlcIiwgXCJ0eXBlXCIpO1xuXHRcdFx0YWRkQXR0cnMoXCJvbCBkbCBtZW51IGRpclwiLCBcImNvbXBhY3RcIik7XG5cdFx0XHRhZGRBdHRycyhcInByZVwiLCBcIndpZHRoIHhtbDpzcGFjZVwiKTtcblx0XHRcdGFkZEF0dHJzKFwiaHJcIiwgXCJhbGlnbiBub3NoYWRlIHNpemUgd2lkdGhcIik7XG5cdFx0XHRhZGRBdHRycyhcImlzaW5kZXhcIiwgXCJwcm9tcHRcIik7XG5cdFx0XHRhZGRBdHRycyhcInRhYmxlXCIsIFwic3VtbWFyeSB3aWR0aCBmcmFtZSBydWxlcyBjZWxsc3BhY2luZyBjZWxscGFkZGluZyBhbGlnbiBiZ2NvbG9yXCIpO1xuXHRcdFx0YWRkQXR0cnMoXCJjb2xcIiwgXCJ3aWR0aCBhbGlnbiBjaGFyIGNoYXJvZmYgdmFsaWduXCIpO1xuXHRcdFx0YWRkQXR0cnMoXCJjb2xncm91cFwiLCBcIndpZHRoIGFsaWduIGNoYXIgY2hhcm9mZiB2YWxpZ25cIik7XG5cdFx0XHRhZGRBdHRycyhcInRoZWFkXCIsIFwiYWxpZ24gY2hhciBjaGFyb2ZmIHZhbGlnblwiKTtcblx0XHRcdGFkZEF0dHJzKFwidHJcIiwgXCJhbGlnbiBjaGFyIGNoYXJvZmYgdmFsaWduIGJnY29sb3JcIik7XG5cdFx0XHRhZGRBdHRycyhcInRoXCIsIFwiYXhpcyBhbGlnbiBjaGFyIGNoYXJvZmYgdmFsaWduIG5vd3JhcCBiZ2NvbG9yIHdpZHRoIGhlaWdodFwiKTtcblx0XHRcdGFkZEF0dHJzKFwiZm9ybVwiLCBcImFjY2VwdFwiKTtcblx0XHRcdGFkZEF0dHJzKFwidGRcIiwgXCJhYmJyIGF4aXMgc2NvcGUgYWxpZ24gY2hhciBjaGFyb2ZmIHZhbGlnbiBub3dyYXAgYmdjb2xvciB3aWR0aCBoZWlnaHRcIik7XG5cdFx0XHRhZGRBdHRycyhcInRmb290XCIsIFwiYWxpZ24gY2hhciBjaGFyb2ZmIHZhbGlnblwiKTtcblx0XHRcdGFkZEF0dHJzKFwidGJvZHlcIiwgXCJhbGlnbiBjaGFyIGNoYXJvZmYgdmFsaWduXCIpO1xuXHRcdFx0YWRkQXR0cnMoXCJhcmVhXCIsIFwibm9ocmVmXCIpO1xuXHRcdFx0YWRkQXR0cnMoXCJib2R5XCIsIFwiYmFja2dyb3VuZCBiZ2NvbG9yIHRleHQgbGluayB2bGluayBhbGlua1wiKTtcblx0XHR9XG5cblx0XHQvLyBFeHRlbmQgd2l0aCBIVE1MNSBhdHRyaWJ1dGVzIHVubGVzcyBpdCdzIGh0bWw0XG5cdFx0aWYgKHR5cGUgIT0gXCJodG1sNFwiKSB7XG5cdFx0XHRhZGRBdHRycyhcImlucHV0IGJ1dHRvbiBzZWxlY3QgdGV4dGFyZWFcIiwgXCJhdXRvZm9jdXNcIik7XG5cdFx0XHRhZGRBdHRycyhcImlucHV0IHRleHRhcmVhXCIsIFwicGxhY2Vob2xkZXJcIik7XG5cdFx0XHRhZGRBdHRycyhcImFcIiwgXCJkb3dubG9hZFwiKTtcblx0XHRcdGFkZEF0dHJzKFwibGluayBzY3JpcHQgaW1nXCIsIFwiY3Jvc3NvcmlnaW5cIik7XG5cdFx0XHRhZGRBdHRycyhcImlmcmFtZVwiLCBcInNhbmRib3ggc2VhbWxlc3MgYWxsb3dmdWxsc2NyZWVuXCIpOyAvLyBFeGNsdWRlZDogc3JjZG9jXG5cdFx0fVxuXG5cdFx0Ly8gU3BlY2lhbDogaWZyYW1lLCBydWJ5LCB2aWRlbywgYXVkaW8sIGxhYmVsXG5cblx0XHQvLyBEZWxldGUgY2hpbGRyZW4gb2YgdGhlIHNhbWUgbmFtZSBmcm9tIGl0J3MgcGFyZW50XG5cdFx0Ly8gRm9yIGV4YW1wbGU6IGZvcm0gY2FuJ3QgaGF2ZSBhIGNoaWxkIG9mIHRoZSBuYW1lIGZvcm1cblx0XHRlYWNoKHNwbGl0KCdhIGZvcm0gbWV0ZXIgcHJvZ3Jlc3MgZGZuJyksIGZ1bmN0aW9uKG5hbWUpIHtcblx0XHRcdGlmIChzY2hlbWFbbmFtZV0pIHtcblx0XHRcdFx0ZGVsZXRlIHNjaGVtYVtuYW1lXS5jaGlsZHJlbltuYW1lXTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdC8vIERlbGV0ZSBoZWFkZXIsIGZvb3Rlciwgc2VjdGlvbmluZyBhbmQgaGVhZGluZyBjb250ZW50IGRlc2NlbmRhbnRzXG5cdFx0LyplYWNoKCdkdCB0aCBhZGRyZXNzJywgZnVuY3Rpb24obmFtZSkge1xuXHRcdCBkZWxldGUgc2NoZW1hW25hbWVdLmNoaWxkcmVuW25hbWVdO1xuXHRcdCB9KTsqL1xuXG5cdFx0Ly8gQ2FwdGlvbiBjYW4ndCBoYXZlIHRhYmxlc1xuXHRcdGRlbGV0ZSBzY2hlbWEuY2FwdGlvbi5jaGlsZHJlbi50YWJsZTtcblxuXHRcdC8vIERlbGV0ZSBzY3JpcHRzIGJ5IGRlZmF1bHQgZHVlIHRvIHBvc3NpYmxlIFhTU1xuXHRcdGRlbGV0ZSBzY2hlbWEuc2NyaXB0O1xuXG5cdFx0Ly8gVE9ETzogTEk6cyBjYW4gb25seSBoYXZlIHZhbHVlIGlmIHBhcmVudCBpcyBPTFxuXG5cdFx0Ly8gVE9ETzogSGFuZGxlIHRyYW5zcGFyZW50IGVsZW1lbnRzXG5cdFx0Ly8gYSBpbnMgZGVsIGNhbnZhcyBtYXBcblxuXHRcdG1hcENhY2hlW3R5cGVdID0gc2NoZW1hO1xuXG5cdFx0cmV0dXJuIHNjaGVtYTtcblx0fVxuXG5cdGZ1bmN0aW9uIGNvbXBpbGVFbGVtZW50TWFwKHZhbHVlLCBtb2RlKSB7XG5cdFx0dmFyIHN0eWxlcztcblxuXHRcdGlmICh2YWx1ZSkge1xuXHRcdFx0c3R5bGVzID0ge307XG5cblx0XHRcdGlmICh0eXBlb2YgdmFsdWUgPT0gJ3N0cmluZycpIHtcblx0XHRcdFx0dmFsdWUgPSB7XG5cdFx0XHRcdFx0JyonOiB2YWx1ZVxuXHRcdFx0XHR9O1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBDb252ZXJ0IHN0eWxlcyBpbnRvIGEgcnVsZSBsaXN0XG5cdFx0XHRlYWNoKHZhbHVlLCBmdW5jdGlvbih2YWx1ZSwga2V5KSB7XG5cdFx0XHRcdHN0eWxlc1trZXldID0gc3R5bGVzW2tleS50b1VwcGVyQ2FzZSgpXSA9IG1vZGUgPT0gJ21hcCcgPyBtYWtlTWFwKHZhbHVlLCAvWywgXS8pIDogZXhwbG9kZSh2YWx1ZSwgL1ssIF0vKTtcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdHJldHVybiBzdHlsZXM7XG5cdH1cblxuXHQvKipcblx0ICogQ29uc3RydWN0cyBhIG5ldyBTY2hlbWEgaW5zdGFuY2UuXG5cdCAqXG5cdCAqIEBjb25zdHJ1Y3RvclxuXHQgKiBAbWV0aG9kIFNjaGVtYVxuXHQgKiBAcGFyYW0ge09iamVjdH0gc2V0dGluZ3MgTmFtZS92YWx1ZSBzZXR0aW5ncyBvYmplY3QuXG5cdCAqL1xuXHRyZXR1cm4gZnVuY3Rpb24oc2V0dGluZ3MpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsIGVsZW1lbnRzID0ge30sIGNoaWxkcmVuID0ge30sIHBhdHRlcm5FbGVtZW50cyA9IFtdLCB2YWxpZFN0eWxlcywgaW52YWxpZFN0eWxlcywgc2NoZW1hSXRlbXM7XG5cdFx0dmFyIHdoaXRlU3BhY2VFbGVtZW50c01hcCwgc2VsZkNsb3NpbmdFbGVtZW50c01hcCwgc2hvcnRFbmRlZEVsZW1lbnRzTWFwLCBib29sQXR0ck1hcCwgdmFsaWRDbGFzc2VzO1xuXHRcdHZhciBibG9ja0VsZW1lbnRzTWFwLCBub25FbXB0eUVsZW1lbnRzTWFwLCBtb3ZlQ2FyZXRCZWZvcmVPbkVudGVyRWxlbWVudHNNYXAsIHRleHRCbG9ja0VsZW1lbnRzTWFwLCB0ZXh0SW5saW5lRWxlbWVudHNNYXA7XG5cdFx0dmFyIGN1c3RvbUVsZW1lbnRzTWFwID0ge30sIHNwZWNpYWxFbGVtZW50cyA9IHt9O1xuXG5cdFx0Ly8gQ3JlYXRlcyBhbiBsb29rdXAgdGFibGUgbWFwIG9iamVjdCBmb3IgdGhlIHNwZWNpZmllZCBvcHRpb24gb3IgdGhlIGRlZmF1bHQgdmFsdWVcblx0XHRmdW5jdGlvbiBjcmVhdGVMb29rdXBUYWJsZShvcHRpb24sIGRlZmF1bHRfdmFsdWUsIGV4dGVuZFdpdGgpIHtcblx0XHRcdHZhciB2YWx1ZSA9IHNldHRpbmdzW29wdGlvbl07XG5cblx0XHRcdGlmICghdmFsdWUpIHtcblx0XHRcdFx0Ly8gR2V0IGNhY2hlZCBkZWZhdWx0IG1hcCBvciBtYWtlIGl0IGlmIG5lZWRlZFxuXHRcdFx0XHR2YWx1ZSA9IG1hcENhY2hlW29wdGlvbl07XG5cblx0XHRcdFx0aWYgKCF2YWx1ZSkge1xuXHRcdFx0XHRcdHZhbHVlID0gbWFrZU1hcChkZWZhdWx0X3ZhbHVlLCAnICcsIG1ha2VNYXAoZGVmYXVsdF92YWx1ZS50b1VwcGVyQ2FzZSgpLCAnICcpKTtcblx0XHRcdFx0XHR2YWx1ZSA9IGV4dGVuZCh2YWx1ZSwgZXh0ZW5kV2l0aCk7XG5cblx0XHRcdFx0XHRtYXBDYWNoZVtvcHRpb25dID0gdmFsdWU7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdC8vIENyZWF0ZSBjdXN0b20gbWFwXG5cdFx0XHRcdHZhbHVlID0gbWFrZU1hcCh2YWx1ZSwgL1ssIF0vLCBtYWtlTWFwKHZhbHVlLnRvVXBwZXJDYXNlKCksIC9bLCBdLykpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0fVxuXG5cdFx0c2V0dGluZ3MgPSBzZXR0aW5ncyB8fCB7fTtcblx0XHRzY2hlbWFJdGVtcyA9IGNvbXBpbGVTY2hlbWEoc2V0dGluZ3Muc2NoZW1hKTtcblxuXHRcdC8vIEFsbG93IGFsbCBlbGVtZW50cyBhbmQgYXR0cmlidXRlcyBpZiB2ZXJpZnlfaHRtbCBpcyBzZXQgdG8gZmFsc2Vcblx0XHRpZiAoc2V0dGluZ3MudmVyaWZ5X2h0bWwgPT09IGZhbHNlKSB7XG5cdFx0XHRzZXR0aW5ncy52YWxpZF9lbGVtZW50cyA9ICcqWypdJztcblx0XHR9XG5cblx0XHR2YWxpZFN0eWxlcyA9IGNvbXBpbGVFbGVtZW50TWFwKHNldHRpbmdzLnZhbGlkX3N0eWxlcyk7XG5cdFx0aW52YWxpZFN0eWxlcyA9IGNvbXBpbGVFbGVtZW50TWFwKHNldHRpbmdzLmludmFsaWRfc3R5bGVzLCAnbWFwJyk7XG5cdFx0dmFsaWRDbGFzc2VzID0gY29tcGlsZUVsZW1lbnRNYXAoc2V0dGluZ3MudmFsaWRfY2xhc3NlcywgJ21hcCcpO1xuXG5cdFx0Ly8gU2V0dXAgbWFwIG9iamVjdHNcblx0XHR3aGl0ZVNwYWNlRWxlbWVudHNNYXAgPSBjcmVhdGVMb29rdXBUYWJsZSgnd2hpdGVzcGFjZV9lbGVtZW50cycsICdwcmUgc2NyaXB0IG5vc2NyaXB0IHN0eWxlIHRleHRhcmVhIHZpZGVvIGF1ZGlvIGlmcmFtZSBvYmplY3QnKTtcblx0XHRzZWxmQ2xvc2luZ0VsZW1lbnRzTWFwID0gY3JlYXRlTG9va3VwVGFibGUoJ3NlbGZfY2xvc2luZ19lbGVtZW50cycsICdjb2xncm91cCBkZCBkdCBsaSBvcHRpb24gcCB0ZCB0Zm9vdCB0aCB0aGVhZCB0cicpO1xuXHRcdHNob3J0RW5kZWRFbGVtZW50c01hcCA9IGNyZWF0ZUxvb2t1cFRhYmxlKCdzaG9ydF9lbmRlZF9lbGVtZW50cycsICdhcmVhIGJhc2UgYmFzZWZvbnQgYnIgY29sIGZyYW1lIGhyIGltZyBpbnB1dCBpc2luZGV4IGxpbmsgJyArXG5cdFx0J21ldGEgcGFyYW0gZW1iZWQgc291cmNlIHdiciB0cmFjaycpO1xuXHRcdGJvb2xBdHRyTWFwID0gY3JlYXRlTG9va3VwVGFibGUoJ2Jvb2xlYW5fYXR0cmlidXRlcycsICdjaGVja2VkIGNvbXBhY3QgZGVjbGFyZSBkZWZlciBkaXNhYmxlZCBpc21hcCBtdWx0aXBsZSBub2hyZWYgbm9yZXNpemUgJyArXG5cdFx0J25vc2hhZGUgbm93cmFwIHJlYWRvbmx5IHNlbGVjdGVkIGF1dG9wbGF5IGxvb3AgY29udHJvbHMnKTtcblx0XHRub25FbXB0eUVsZW1lbnRzTWFwID0gY3JlYXRlTG9va3VwVGFibGUoJ25vbl9lbXB0eV9lbGVtZW50cycsICd0ZCB0aCBpZnJhbWUgdmlkZW8gYXVkaW8gb2JqZWN0IHNjcmlwdCcsIHNob3J0RW5kZWRFbGVtZW50c01hcCk7XG5cdFx0bW92ZUNhcmV0QmVmb3JlT25FbnRlckVsZW1lbnRzTWFwID0gY3JlYXRlTG9va3VwVGFibGUoJ21vdmVfY2FyZXRfYmVmb3JlX29uX2VudGVyX2VsZW1lbnRzJywgJ3RhYmxlJywgbm9uRW1wdHlFbGVtZW50c01hcCk7XG5cdFx0dGV4dEJsb2NrRWxlbWVudHNNYXAgPSBjcmVhdGVMb29rdXBUYWJsZSgndGV4dF9ibG9ja19lbGVtZW50cycsICdoMSBoMiBoMyBoNCBoNSBoNiBwIGRpdiBhZGRyZXNzIHByZSBmb3JtICcgK1xuXHRcdCdibG9ja3F1b3RlIGNlbnRlciBkaXIgZmllbGRzZXQgaGVhZGVyIGZvb3RlciBhcnRpY2xlIHNlY3Rpb24gaGdyb3VwIGFzaWRlIG5hdiBmaWd1cmUnKTtcblx0XHRibG9ja0VsZW1lbnRzTWFwID0gY3JlYXRlTG9va3VwVGFibGUoJ2Jsb2NrX2VsZW1lbnRzJywgJ2hyIHRhYmxlIHRib2R5IHRoZWFkIHRmb290ICcgK1xuXHRcdCd0aCB0ciB0ZCBsaSBvbCB1bCBjYXB0aW9uIGRsIGR0IGRkIG5vc2NyaXB0IG1lbnUgaXNpbmRleCBvcHRpb24gJyArXG5cdFx0J2RhdGFsaXN0IHNlbGVjdCBvcHRncm91cCBmaWdjYXB0aW9uJywgdGV4dEJsb2NrRWxlbWVudHNNYXApO1xuXHRcdHRleHRJbmxpbmVFbGVtZW50c01hcCA9IGNyZWF0ZUxvb2t1cFRhYmxlKCd0ZXh0X2lubGluZV9lbGVtZW50cycsICdzcGFuIHN0cm9uZyBiIGVtIGkgZm9udCBzdHJpa2UgdSB2YXIgY2l0ZSAnICtcblx0XHQnZGZuIGNvZGUgbWFyayBxIHN1cCBzdWIgc2FtcCcpO1xuXG5cdFx0ZWFjaCgoc2V0dGluZ3Muc3BlY2lhbCB8fCAnc2NyaXB0IG5vc2NyaXB0IHN0eWxlIHRleHRhcmVhJykuc3BsaXQoJyAnKSwgZnVuY3Rpb24obmFtZSkge1xuXHRcdFx0c3BlY2lhbEVsZW1lbnRzW25hbWVdID0gbmV3IFJlZ0V4cCgnPFxcLycgKyBuYW1lICsgJ1tePl0qPicsICdnaScpO1xuXHRcdH0pO1xuXG5cdFx0Ly8gQ29udmVydHMgYSB3aWxkY2FyZCBleHByZXNzaW9uIHN0cmluZyB0byBhIHJlZ2V4cCBmb3IgZXhhbXBsZSAqYSB3aWxsIGJlY29tZSAvLiphLy5cblx0XHRmdW5jdGlvbiBwYXR0ZXJuVG9SZWdFeHAoc3RyKSB7XG5cdFx0XHRyZXR1cm4gbmV3IFJlZ0V4cCgnXicgKyBzdHIucmVwbGFjZSgvKFs/KypdKS9nLCAnLiQxJykgKyAnJCcpO1xuXHRcdH1cblxuXHRcdC8vIFBhcnNlcyB0aGUgc3BlY2lmaWVkIHZhbGlkX2VsZW1lbnRzIHN0cmluZyBhbmQgYWRkcyB0byB0aGUgY3VycmVudCBydWxlc1xuXHRcdC8vIFRoaXMgZnVuY3Rpb24gaXMgYSBiaXQgaGFyZCB0byByZWFkIHNpbmNlIGl0J3MgaGVhdmlseSBvcHRpbWl6ZWQgZm9yIHNwZWVkXG5cdFx0ZnVuY3Rpb24gYWRkVmFsaWRFbGVtZW50cyh2YWxpZEVsZW1lbnRzKSB7XG5cdFx0XHR2YXIgZWksIGVsLCBhaSwgYWwsIG1hdGNoZXMsIGVsZW1lbnQsIGF0dHIsIGF0dHJEYXRhLCBlbGVtZW50TmFtZSwgYXR0ck5hbWUsIGF0dHJUeXBlLCBhdHRyaWJ1dGVzLCBhdHRyaWJ1dGVzT3JkZXIsXG5cdFx0XHRcdHByZWZpeCwgb3V0cHV0TmFtZSwgZ2xvYmFsQXR0cmlidXRlcywgZ2xvYmFsQXR0cmlidXRlc09yZGVyLCBrZXksIHZhbHVlLFxuXHRcdFx0XHRlbGVtZW50UnVsZVJlZ0V4cCA9IC9eKFsjK1xcLV0pPyhbXlxcWyFcXC9dKykoPzpcXC8oW15cXFshXSspKT8oPzooIT8pXFxbKFteXFxdXSspXFxdKT8kLyxcblx0XHRcdFx0YXR0clJ1bGVSZWdFeHAgPSAvXihbIVxcLV0pPyhcXHcrOjpcXHcrfFtePTo8XSspPyg/OihbPTo8XSkoLiopKT8kLyxcblx0XHRcdFx0aGFzUGF0dGVybnNSZWdFeHAgPSAvWyo/K10vO1xuXG5cdFx0XHRpZiAodmFsaWRFbGVtZW50cykge1xuXHRcdFx0XHQvLyBTcGxpdCB2YWxpZCBlbGVtZW50cyBpbnRvIGFuIGFycmF5IHdpdGggcnVsZXNcblx0XHRcdFx0dmFsaWRFbGVtZW50cyA9IHNwbGl0KHZhbGlkRWxlbWVudHMsICcsJyk7XG5cblx0XHRcdFx0aWYgKGVsZW1lbnRzWydAJ10pIHtcblx0XHRcdFx0XHRnbG9iYWxBdHRyaWJ1dGVzID0gZWxlbWVudHNbJ0AnXS5hdHRyaWJ1dGVzO1xuXHRcdFx0XHRcdGdsb2JhbEF0dHJpYnV0ZXNPcmRlciA9IGVsZW1lbnRzWydAJ10uYXR0cmlidXRlc09yZGVyO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gTG9vcCBhbGwgcnVsZXNcblx0XHRcdFx0Zm9yIChlaSA9IDAsIGVsID0gdmFsaWRFbGVtZW50cy5sZW5ndGg7IGVpIDwgZWw7IGVpKyspIHtcblx0XHRcdFx0XHQvLyBQYXJzZSBlbGVtZW50IHJ1bGVcblx0XHRcdFx0XHRtYXRjaGVzID0gZWxlbWVudFJ1bGVSZWdFeHAuZXhlYyh2YWxpZEVsZW1lbnRzW2VpXSk7XG5cdFx0XHRcdFx0aWYgKG1hdGNoZXMpIHtcblx0XHRcdFx0XHRcdC8vIFNldHVwIGxvY2FsIG5hbWVzIGZvciBtYXRjaGVzXG5cdFx0XHRcdFx0XHRwcmVmaXggPSBtYXRjaGVzWzFdO1xuXHRcdFx0XHRcdFx0ZWxlbWVudE5hbWUgPSBtYXRjaGVzWzJdO1xuXHRcdFx0XHRcdFx0b3V0cHV0TmFtZSA9IG1hdGNoZXNbM107XG5cdFx0XHRcdFx0XHRhdHRyRGF0YSA9IG1hdGNoZXNbNV07XG5cblx0XHRcdFx0XHRcdC8vIENyZWF0ZSBuZXcgYXR0cmlidXRlcyBhbmQgYXR0cmlidXRlc09yZGVyXG5cdFx0XHRcdFx0XHRhdHRyaWJ1dGVzID0ge307XG5cdFx0XHRcdFx0XHRhdHRyaWJ1dGVzT3JkZXIgPSBbXTtcblxuXHRcdFx0XHRcdFx0Ly8gQ3JlYXRlIHRoZSBuZXcgZWxlbWVudFxuXHRcdFx0XHRcdFx0ZWxlbWVudCA9IHtcblx0XHRcdFx0XHRcdFx0YXR0cmlidXRlczogYXR0cmlidXRlcyxcblx0XHRcdFx0XHRcdFx0YXR0cmlidXRlc09yZGVyOiBhdHRyaWJ1dGVzT3JkZXJcblx0XHRcdFx0XHRcdH07XG5cblx0XHRcdFx0XHRcdC8vIFBhZGQgZW1wdHkgZWxlbWVudHMgcHJlZml4XG5cdFx0XHRcdFx0XHRpZiAocHJlZml4ID09PSAnIycpIHtcblx0XHRcdFx0XHRcdFx0ZWxlbWVudC5wYWRkRW1wdHkgPSB0cnVlO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHQvLyBSZW1vdmUgZW1wdHkgZWxlbWVudHMgcHJlZml4XG5cdFx0XHRcdFx0XHRpZiAocHJlZml4ID09PSAnLScpIHtcblx0XHRcdFx0XHRcdFx0ZWxlbWVudC5yZW1vdmVFbXB0eSA9IHRydWU7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGlmIChtYXRjaGVzWzRdID09PSAnIScpIHtcblx0XHRcdFx0XHRcdFx0ZWxlbWVudC5yZW1vdmVFbXB0eUF0dHJzID0gdHJ1ZTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0Ly8gQ29weSBhdHRyaWJ1dGVzIGZyb20gZ2xvYmFsIHJ1bGUgaW50byBjdXJyZW50IHJ1bGVcblx0XHRcdFx0XHRcdGlmIChnbG9iYWxBdHRyaWJ1dGVzKSB7XG5cdFx0XHRcdFx0XHRcdGZvciAoa2V5IGluIGdsb2JhbEF0dHJpYnV0ZXMpIHtcblx0XHRcdFx0XHRcdFx0XHRhdHRyaWJ1dGVzW2tleV0gPSBnbG9iYWxBdHRyaWJ1dGVzW2tleV07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRhdHRyaWJ1dGVzT3JkZXIucHVzaC5hcHBseShhdHRyaWJ1dGVzT3JkZXIsIGdsb2JhbEF0dHJpYnV0ZXNPcmRlcik7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdC8vIEF0dHJpYnV0ZXMgZGVmaW5lZFxuXHRcdFx0XHRcdFx0aWYgKGF0dHJEYXRhKSB7XG5cdFx0XHRcdFx0XHRcdGF0dHJEYXRhID0gc3BsaXQoYXR0ckRhdGEsICd8Jyk7XG5cdFx0XHRcdFx0XHRcdGZvciAoYWkgPSAwLCBhbCA9IGF0dHJEYXRhLmxlbmd0aDsgYWkgPCBhbDsgYWkrKykge1xuXHRcdFx0XHRcdFx0XHRcdG1hdGNoZXMgPSBhdHRyUnVsZVJlZ0V4cC5leGVjKGF0dHJEYXRhW2FpXSk7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKG1hdGNoZXMpIHtcblx0XHRcdFx0XHRcdFx0XHRcdGF0dHIgPSB7fTtcblx0XHRcdFx0XHRcdFx0XHRcdGF0dHJUeXBlID0gbWF0Y2hlc1sxXTtcblx0XHRcdFx0XHRcdFx0XHRcdGF0dHJOYW1lID0gbWF0Y2hlc1syXS5yZXBsYWNlKC86Oi9nLCAnOicpO1xuXHRcdFx0XHRcdFx0XHRcdFx0cHJlZml4ID0gbWF0Y2hlc1szXTtcblx0XHRcdFx0XHRcdFx0XHRcdHZhbHVlID0gbWF0Y2hlc1s0XTtcblxuXHRcdFx0XHRcdFx0XHRcdFx0Ly8gUmVxdWlyZWRcblx0XHRcdFx0XHRcdFx0XHRcdGlmIChhdHRyVHlwZSA9PT0gJyEnKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdGVsZW1lbnQuYXR0cmlidXRlc1JlcXVpcmVkID0gZWxlbWVudC5hdHRyaWJ1dGVzUmVxdWlyZWQgfHwgW107XG5cdFx0XHRcdFx0XHRcdFx0XHRcdGVsZW1lbnQuYXR0cmlidXRlc1JlcXVpcmVkLnB1c2goYXR0ck5hbWUpO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRhdHRyLnJlcXVpcmVkID0gdHJ1ZTtcblx0XHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdFx0Ly8gRGVuaWVkIGZyb20gZ2xvYmFsXG5cdFx0XHRcdFx0XHRcdFx0XHRpZiAoYXR0clR5cGUgPT09ICctJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRkZWxldGUgYXR0cmlidXRlc1thdHRyTmFtZV07XG5cdFx0XHRcdFx0XHRcdFx0XHRcdGF0dHJpYnV0ZXNPcmRlci5zcGxpY2UoaW5BcnJheShhdHRyaWJ1dGVzT3JkZXIsIGF0dHJOYW1lKSwgMSk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0XHQvLyBEZWZhdWx0IHZhbHVlXG5cdFx0XHRcdFx0XHRcdFx0XHRpZiAocHJlZml4KSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdC8vIERlZmF1bHQgdmFsdWVcblx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKHByZWZpeCA9PT0gJz0nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0ZWxlbWVudC5hdHRyaWJ1dGVzRGVmYXVsdCA9IGVsZW1lbnQuYXR0cmlidXRlc0RlZmF1bHQgfHwgW107XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0ZWxlbWVudC5hdHRyaWJ1dGVzRGVmYXVsdC5wdXNoKHtuYW1lOiBhdHRyTmFtZSwgdmFsdWU6IHZhbHVlfSk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0YXR0ci5kZWZhdWx0VmFsdWUgPSB2YWx1ZTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0XHRcdC8vIEZvcmNlZCB2YWx1ZVxuXHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAocHJlZml4ID09PSAnOicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRlbGVtZW50LmF0dHJpYnV0ZXNGb3JjZWQgPSBlbGVtZW50LmF0dHJpYnV0ZXNGb3JjZWQgfHwgW107XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0ZWxlbWVudC5hdHRyaWJ1dGVzRm9yY2VkLnB1c2goe25hbWU6IGF0dHJOYW1lLCB2YWx1ZTogdmFsdWV9KTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRhdHRyLmZvcmNlZFZhbHVlID0gdmFsdWU7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdFx0XHQvLyBSZXF1aXJlZCB2YWx1ZXNcblx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKHByZWZpeCA9PT0gJzwnKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0YXR0ci52YWxpZFZhbHVlcyA9IG1ha2VNYXAodmFsdWUsICc/Jyk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdFx0Ly8gQ2hlY2sgZm9yIGF0dHJpYnV0ZSBwYXR0ZXJuc1xuXHRcdFx0XHRcdFx0XHRcdFx0aWYgKGhhc1BhdHRlcm5zUmVnRXhwLnRlc3QoYXR0ck5hbWUpKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdGVsZW1lbnQuYXR0cmlidXRlUGF0dGVybnMgPSBlbGVtZW50LmF0dHJpYnV0ZVBhdHRlcm5zIHx8IFtdO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRhdHRyLnBhdHRlcm4gPSBwYXR0ZXJuVG9SZWdFeHAoYXR0ck5hbWUpO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRlbGVtZW50LmF0dHJpYnV0ZVBhdHRlcm5zLnB1c2goYXR0cik7XG5cdFx0XHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHQvLyBBZGQgYXR0cmlidXRlIHRvIG9yZGVyIGxpc3QgaWYgaXQgZG9lc24ndCBhbHJlYWR5IGV4aXN0XG5cdFx0XHRcdFx0XHRcdFx0XHRcdGlmICghYXR0cmlidXRlc1thdHRyTmFtZV0pIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRhdHRyaWJ1dGVzT3JkZXIucHVzaChhdHRyTmFtZSk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdFx0XHRhdHRyaWJ1dGVzW2F0dHJOYW1lXSA9IGF0dHI7XG5cdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdC8vIEdsb2JhbCBydWxlLCBzdG9yZSBhd2F5IHRoZXNlIGZvciBsYXRlciB1c2FnZVxuXHRcdFx0XHRcdFx0aWYgKCFnbG9iYWxBdHRyaWJ1dGVzICYmIGVsZW1lbnROYW1lID09ICdAJykge1xuXHRcdFx0XHRcdFx0XHRnbG9iYWxBdHRyaWJ1dGVzID0gYXR0cmlidXRlcztcblx0XHRcdFx0XHRcdFx0Z2xvYmFsQXR0cmlidXRlc09yZGVyID0gYXR0cmlidXRlc09yZGVyO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHQvLyBIYW5kbGUgc3Vic3RpdHV0ZSBlbGVtZW50cyBzdWNoIGFzIGIvc3Ryb25nXG5cdFx0XHRcdFx0XHRpZiAob3V0cHV0TmFtZSkge1xuXHRcdFx0XHRcdFx0XHRlbGVtZW50Lm91dHB1dE5hbWUgPSBlbGVtZW50TmFtZTtcblx0XHRcdFx0XHRcdFx0ZWxlbWVudHNbb3V0cHV0TmFtZV0gPSBlbGVtZW50O1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHQvLyBBZGQgcGF0dGVybiBvciBleGFjdCBlbGVtZW50XG5cdFx0XHRcdFx0XHRpZiAoaGFzUGF0dGVybnNSZWdFeHAudGVzdChlbGVtZW50TmFtZSkpIHtcblx0XHRcdFx0XHRcdFx0ZWxlbWVudC5wYXR0ZXJuID0gcGF0dGVyblRvUmVnRXhwKGVsZW1lbnROYW1lKTtcblx0XHRcdFx0XHRcdFx0cGF0dGVybkVsZW1lbnRzLnB1c2goZWxlbWVudCk7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRlbGVtZW50c1tlbGVtZW50TmFtZV0gPSBlbGVtZW50O1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIHNldFZhbGlkRWxlbWVudHModmFsaWRFbGVtZW50cykge1xuXHRcdFx0ZWxlbWVudHMgPSB7fTtcblx0XHRcdHBhdHRlcm5FbGVtZW50cyA9IFtdO1xuXG5cdFx0XHRhZGRWYWxpZEVsZW1lbnRzKHZhbGlkRWxlbWVudHMpO1xuXG5cdFx0XHRlYWNoKHNjaGVtYUl0ZW1zLCBmdW5jdGlvbihlbGVtZW50LCBuYW1lKSB7XG5cdFx0XHRcdGNoaWxkcmVuW25hbWVdID0gZWxlbWVudC5jaGlsZHJlbjtcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdC8vIEFkZHMgY3VzdG9tIG5vbiBIVE1MIGVsZW1lbnRzIHRvIHRoZSBzY2hlbWFcblx0XHRmdW5jdGlvbiBhZGRDdXN0b21FbGVtZW50cyhjdXN0b21FbGVtZW50cykge1xuXHRcdFx0dmFyIGN1c3RvbUVsZW1lbnRSZWdFeHAgPSAvXih+KT8oLispJC87XG5cblx0XHRcdGlmIChjdXN0b21FbGVtZW50cykge1xuXHRcdFx0XHQvLyBGbHVzaCBjYWNoZWQgaXRlbXMgc2luY2Ugd2UgYXJlIGFsdGVyaW5nIHRoZSBkZWZhdWx0IG1hcHNcblx0XHRcdFx0bWFwQ2FjaGUudGV4dF9ibG9ja19lbGVtZW50cyA9IG1hcENhY2hlLmJsb2NrX2VsZW1lbnRzID0gbnVsbDtcblxuXHRcdFx0XHRlYWNoKHNwbGl0KGN1c3RvbUVsZW1lbnRzLCAnLCcpLCBmdW5jdGlvbihydWxlKSB7XG5cdFx0XHRcdFx0dmFyIG1hdGNoZXMgPSBjdXN0b21FbGVtZW50UmVnRXhwLmV4ZWMocnVsZSksXG5cdFx0XHRcdFx0XHRpbmxpbmUgPSBtYXRjaGVzWzFdID09PSAnficsXG5cdFx0XHRcdFx0XHRjbG9uZU5hbWUgPSBpbmxpbmUgPyAnc3BhbicgOiAnZGl2Jyxcblx0XHRcdFx0XHRcdG5hbWUgPSBtYXRjaGVzWzJdO1xuXG5cdFx0XHRcdFx0Y2hpbGRyZW5bbmFtZV0gPSBjaGlsZHJlbltjbG9uZU5hbWVdO1xuXHRcdFx0XHRcdGN1c3RvbUVsZW1lbnRzTWFwW25hbWVdID0gY2xvbmVOYW1lO1xuXG5cdFx0XHRcdFx0Ly8gSWYgaXQncyBub3QgbWFya2VkIGFzIGlubGluZSB0aGVuIGFkZCBpdCB0byB2YWxpZCBibG9jayBlbGVtZW50c1xuXHRcdFx0XHRcdGlmICghaW5saW5lKSB7XG5cdFx0XHRcdFx0XHRibG9ja0VsZW1lbnRzTWFwW25hbWUudG9VcHBlckNhc2UoKV0gPSB7fTtcblx0XHRcdFx0XHRcdGJsb2NrRWxlbWVudHNNYXBbbmFtZV0gPSB7fTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHQvLyBBZGQgZWxlbWVudHMgY2xvbmUgaWYgbmVlZGVkXG5cdFx0XHRcdFx0aWYgKCFlbGVtZW50c1tuYW1lXSkge1xuXHRcdFx0XHRcdFx0dmFyIGN1c3RvbVJ1bGUgPSBlbGVtZW50c1tjbG9uZU5hbWVdO1xuXG5cdFx0XHRcdFx0XHRjdXN0b21SdWxlID0gZXh0ZW5kKHt9LCBjdXN0b21SdWxlKTtcblx0XHRcdFx0XHRcdGRlbGV0ZSBjdXN0b21SdWxlLnJlbW92ZUVtcHR5QXR0cnM7XG5cdFx0XHRcdFx0XHRkZWxldGUgY3VzdG9tUnVsZS5yZW1vdmVFbXB0eTtcblxuXHRcdFx0XHRcdFx0ZWxlbWVudHNbbmFtZV0gPSBjdXN0b21SdWxlO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdC8vIEFkZCBjdXN0b20gZWxlbWVudHMgYXQgc3Bhbi9kaXYgcG9zaXRpb25zXG5cdFx0XHRcdFx0ZWFjaChjaGlsZHJlbiwgZnVuY3Rpb24oZWxlbWVudCwgZWxtTmFtZSkge1xuXHRcdFx0XHRcdFx0aWYgKGVsZW1lbnRbY2xvbmVOYW1lXSkge1xuXHRcdFx0XHRcdFx0XHRjaGlsZHJlbltlbG1OYW1lXSA9IGVsZW1lbnQgPSBleHRlbmQoe30sIGNoaWxkcmVuW2VsbU5hbWVdKTtcblx0XHRcdFx0XHRcdFx0ZWxlbWVudFtuYW1lXSA9IGVsZW1lbnRbY2xvbmVOYW1lXTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0Ly8gQWRkcyB2YWxpZCBjaGlsZHJlbiB0byB0aGUgc2NoZW1hIG9iamVjdFxuXHRcdGZ1bmN0aW9uIGFkZFZhbGlkQ2hpbGRyZW4odmFsaWRDaGlsZHJlbikge1xuXHRcdFx0dmFyIGNoaWxkUnVsZVJlZ0V4cCA9IC9eKFsrXFwtXT8pKFxcdyspXFxbKFteXFxdXSspXFxdJC87XG5cblx0XHRcdC8vIEludmFsaWRhdGUgdGhlIHNjaGVtYSBjYWNoZSBpZiB0aGUgc2NoZW1hIGlzIG11dGF0ZWRcblx0XHRcdG1hcENhY2hlW3NldHRpbmdzLnNjaGVtYV0gPSBudWxsO1xuXG5cdFx0XHRpZiAodmFsaWRDaGlsZHJlbikge1xuXHRcdFx0XHRlYWNoKHNwbGl0KHZhbGlkQ2hpbGRyZW4sICcsJyksIGZ1bmN0aW9uKHJ1bGUpIHtcblx0XHRcdFx0XHR2YXIgbWF0Y2hlcyA9IGNoaWxkUnVsZVJlZ0V4cC5leGVjKHJ1bGUpLCBwYXJlbnQsIHByZWZpeDtcblxuXHRcdFx0XHRcdGlmIChtYXRjaGVzKSB7XG5cdFx0XHRcdFx0XHRwcmVmaXggPSBtYXRjaGVzWzFdO1xuXG5cdFx0XHRcdFx0XHQvLyBBZGQvcmVtb3ZlIGl0ZW1zIGZyb20gZGVmYXVsdFxuXHRcdFx0XHRcdFx0aWYgKHByZWZpeCkge1xuXHRcdFx0XHRcdFx0XHRwYXJlbnQgPSBjaGlsZHJlblttYXRjaGVzWzJdXTtcblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdHBhcmVudCA9IGNoaWxkcmVuW21hdGNoZXNbMl1dID0geycjY29tbWVudCc6IHt9fTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cGFyZW50ID0gY2hpbGRyZW5bbWF0Y2hlc1syXV07XG5cblx0XHRcdFx0XHRcdGVhY2goc3BsaXQobWF0Y2hlc1szXSwgJ3wnKSwgZnVuY3Rpb24oY2hpbGQpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHByZWZpeCA9PT0gJy0nKSB7XG5cdFx0XHRcdFx0XHRcdFx0ZGVsZXRlIHBhcmVudFtjaGlsZF07XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0cGFyZW50W2NoaWxkXSA9IHt9O1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIGdldEVsZW1lbnRSdWxlKG5hbWUpIHtcblx0XHRcdHZhciBlbGVtZW50ID0gZWxlbWVudHNbbmFtZV0sIGk7XG5cblx0XHRcdC8vIEV4YWN0IG1hdGNoIGZvdW5kXG5cdFx0XHRpZiAoZWxlbWVudCkge1xuXHRcdFx0XHRyZXR1cm4gZWxlbWVudDtcblx0XHRcdH1cblxuXHRcdFx0Ly8gTm8gZXhhY3QgbWF0Y2ggdGhlbiB0cnkgdGhlIHBhdHRlcm5zXG5cdFx0XHRpID0gcGF0dGVybkVsZW1lbnRzLmxlbmd0aDtcblx0XHRcdHdoaWxlIChpLS0pIHtcblx0XHRcdFx0ZWxlbWVudCA9IHBhdHRlcm5FbGVtZW50c1tpXTtcblxuXHRcdFx0XHRpZiAoZWxlbWVudC5wYXR0ZXJuLnRlc3QobmFtZSkpIHtcblx0XHRcdFx0XHRyZXR1cm4gZWxlbWVudDtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghc2V0dGluZ3MudmFsaWRfZWxlbWVudHMpIHtcblx0XHRcdC8vIE5vIHZhbGlkIGVsZW1lbnRzIGRlZmluZWQgdGhlbiBjbG9uZSB0aGUgZWxlbWVudHMgZnJvbSB0aGUgc2NoZW1hIHNwZWNcblx0XHRcdGVhY2goc2NoZW1hSXRlbXMsIGZ1bmN0aW9uKGVsZW1lbnQsIG5hbWUpIHtcblx0XHRcdFx0ZWxlbWVudHNbbmFtZV0gPSB7XG5cdFx0XHRcdFx0YXR0cmlidXRlczogZWxlbWVudC5hdHRyaWJ1dGVzLFxuXHRcdFx0XHRcdGF0dHJpYnV0ZXNPcmRlcjogZWxlbWVudC5hdHRyaWJ1dGVzT3JkZXJcblx0XHRcdFx0fTtcblxuXHRcdFx0XHRjaGlsZHJlbltuYW1lXSA9IGVsZW1lbnQuY2hpbGRyZW47XG5cdFx0XHR9KTtcblxuXHRcdFx0Ly8gU3dpdGNoIHRoZXNlIG9uIEhUTUw0XG5cdFx0XHRpZiAoc2V0dGluZ3Muc2NoZW1hICE9IFwiaHRtbDVcIikge1xuXHRcdFx0XHRlYWNoKHNwbGl0KCdzdHJvbmcvYiBlbS9pJyksIGZ1bmN0aW9uKGl0ZW0pIHtcblx0XHRcdFx0XHRpdGVtID0gc3BsaXQoaXRlbSwgJy8nKTtcblx0XHRcdFx0XHRlbGVtZW50c1tpdGVtWzFdXS5vdXRwdXROYW1lID0gaXRlbVswXTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIEFkZCBkZWZhdWx0IGFsdCBhdHRyaWJ1dGUgZm9yIGltYWdlcywgcmVtb3ZlZCBzaW5jZSBhbHQ9XCJcIiBpcyB0cmVhdGVkIGFzIHByZXNlbnRhdGlvbmFsLlxuXHRcdFx0Ly8gZWxlbWVudHMuaW1nLmF0dHJpYnV0ZXNEZWZhdWx0ID0gW3tuYW1lOiAnYWx0JywgdmFsdWU6ICcnfV07XG5cblx0XHRcdC8vIFJlbW92ZSB0aGVzZSBpZiB0aGV5IGFyZSBlbXB0eSBieSBkZWZhdWx0XG5cdFx0XHRlYWNoKHNwbGl0KCdvbCB1bCBzdWIgc3VwIGJsb2NrcXVvdGUgc3BhbiBmb250IGEgdGFibGUgdGJvZHkgdHIgc3Ryb25nIGVtIGIgaScpLCBmdW5jdGlvbihuYW1lKSB7XG5cdFx0XHRcdGlmIChlbGVtZW50c1tuYW1lXSkge1xuXHRcdFx0XHRcdGVsZW1lbnRzW25hbWVdLnJlbW92ZUVtcHR5ID0gdHJ1ZTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdC8vIFBhZGQgdGhlc2UgYnkgZGVmYXVsdFxuXHRcdFx0ZWFjaChzcGxpdCgncCBoMSBoMiBoMyBoNCBoNSBoNiB0aCB0ZCBwcmUgZGl2IGFkZHJlc3MgY2FwdGlvbicpLCBmdW5jdGlvbihuYW1lKSB7XG5cdFx0XHRcdGVsZW1lbnRzW25hbWVdLnBhZGRFbXB0eSA9IHRydWU7XG5cdFx0XHR9KTtcblxuXHRcdFx0Ly8gUmVtb3ZlIHRoZXNlIGlmIHRoZXkgaGF2ZSBubyBhdHRyaWJ1dGVzXG5cdFx0XHRlYWNoKHNwbGl0KCdzcGFuJyksIGZ1bmN0aW9uKG5hbWUpIHtcblx0XHRcdFx0ZWxlbWVudHNbbmFtZV0ucmVtb3ZlRW1wdHlBdHRycyA9IHRydWU7XG5cdFx0XHR9KTtcblxuXHRcdFx0Ly8gUmVtb3ZlIHRoZXNlIGJ5IGRlZmF1bHRcblx0XHRcdC8vIFRPRE86IFJlZW5hYmxlIGluIDQuMVxuXHRcdFx0LyplYWNoKHNwbGl0KCdzY3JpcHQgc3R5bGUnKSwgZnVuY3Rpb24obmFtZSkge1xuXHRcdFx0IGRlbGV0ZSBlbGVtZW50c1tuYW1lXTtcblx0XHRcdCB9KTsqL1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRzZXRWYWxpZEVsZW1lbnRzKHNldHRpbmdzLnZhbGlkX2VsZW1lbnRzKTtcblx0XHR9XG5cblx0XHRhZGRDdXN0b21FbGVtZW50cyhzZXR0aW5ncy5jdXN0b21fZWxlbWVudHMpO1xuXHRcdGFkZFZhbGlkQ2hpbGRyZW4oc2V0dGluZ3MudmFsaWRfY2hpbGRyZW4pO1xuXHRcdGFkZFZhbGlkRWxlbWVudHMoc2V0dGluZ3MuZXh0ZW5kZWRfdmFsaWRfZWxlbWVudHMpO1xuXG5cdFx0Ly8gVG9kbzogUmVtb3ZlIHRoaXMgd2hlbiB3ZSBmaXggbGlzdCBoYW5kbGluZyB0byBiZSB2YWxpZFxuXHRcdGFkZFZhbGlkQ2hpbGRyZW4oJytvbFt1bHxvbF0sK3VsW3VsfG9sXScpO1xuXG5cblx0XHQvLyBTb21lIGVsZW1lbnRzIGFyZSBub3QgdmFsaWQgYnkgdGhlbXNlbHZlcyAtIHJlcXVpcmUgcGFyZW50c1xuXHRcdGVhY2goe1xuXHRcdFx0ZGQ6ICdkbCcsXG5cdFx0XHRkdDogJ2RsJyxcblx0XHRcdGxpOiAndWwgb2wnLFxuXHRcdFx0dGQ6ICd0cicsXG5cdFx0XHR0aDogJ3RyJyxcblx0XHRcdHRyOiAndGJvZHkgdGhlYWQgdGZvb3QnLFxuXHRcdFx0dGJvZHk6ICd0YWJsZScsXG5cdFx0XHR0aGVhZDogJ3RhYmxlJyxcblx0XHRcdHRmb290OiAndGFibGUnLFxuXHRcdFx0bGVnZW5kOiAnZmllbGRzZXQnLFxuXHRcdFx0YXJlYTogJ21hcCcsXG5cdFx0XHRwYXJhbTogJ3ZpZGVvIGF1ZGlvIG9iamVjdCdcblx0XHR9LCBmdW5jdGlvbihwYXJlbnRzLCBpdGVtKSB7XG5cdFx0XHRpZiAoZWxlbWVudHNbaXRlbV0pIHtcblx0XHRcdFx0ZWxlbWVudHNbaXRlbV0ucGFyZW50c1JlcXVpcmVkID0gc3BsaXQocGFyZW50cyk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblxuXHRcdC8vIERlbGV0ZSBpbnZhbGlkIGVsZW1lbnRzXG5cdFx0aWYgKHNldHRpbmdzLmludmFsaWRfZWxlbWVudHMpIHtcblx0XHRcdGVhY2goZXhwbG9kZShzZXR0aW5ncy5pbnZhbGlkX2VsZW1lbnRzKSwgZnVuY3Rpb24oaXRlbSkge1xuXHRcdFx0XHRpZiAoZWxlbWVudHNbaXRlbV0pIHtcblx0XHRcdFx0XHRkZWxldGUgZWxlbWVudHNbaXRlbV07XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdC8vIElmIHRoZSB1c2VyIGRpZG4ndCBhbGxvdyBzcGFuIG9ubHkgYWxsb3cgaW50ZXJuYWwgc3BhbnNcblx0XHRpZiAoIWdldEVsZW1lbnRSdWxlKCdzcGFuJykpIHtcblx0XHRcdGFkZFZhbGlkRWxlbWVudHMoJ3NwYW5bIWRhdGEtbWNlLXR5cGV8Kl0nKTtcblx0XHR9XG5cblx0XHQvKipcblx0XHQgKiBOYW1lL3ZhbHVlIG1hcCBvYmplY3Qgd2l0aCB2YWxpZCBwYXJlbnRzIGFuZCBjaGlsZHJlbiB0byB0aG9zZSBwYXJlbnRzLlxuXHRcdCAqXG5cdFx0ICogQGV4YW1wbGVcblx0XHQgKiBjaGlsZHJlbiA9IHtcblx0XHQgKiAgICBkaXY6e3A6e30sIGgxOnt9fVxuXHRcdCAqIH07XG5cdFx0ICogQGZpZWxkIGNoaWxkcmVuXG5cdFx0ICogQHR5cGUgT2JqZWN0XG5cdFx0ICovXG5cdFx0c2VsZi5jaGlsZHJlbiA9IGNoaWxkcmVuO1xuXG5cdFx0LyoqXG5cdFx0ICogTmFtZS92YWx1ZSBtYXAgb2JqZWN0IHdpdGggdmFsaWQgc3R5bGVzIGZvciBlYWNoIGVsZW1lbnQuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGdldFZhbGlkU3R5bGVzXG5cdFx0ICogQHR5cGUgT2JqZWN0XG5cdFx0ICovXG5cdFx0c2VsZi5nZXRWYWxpZFN0eWxlcyA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHZhbGlkU3R5bGVzO1xuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBOYW1lL3ZhbHVlIG1hcCBvYmplY3Qgd2l0aCB2YWxpZCBzdHlsZXMgZm9yIGVhY2ggZWxlbWVudC5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgZ2V0SW52YWxpZFN0eWxlc1xuXHRcdCAqIEB0eXBlIE9iamVjdFxuXHRcdCAqL1xuXHRcdHNlbGYuZ2V0SW52YWxpZFN0eWxlcyA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIGludmFsaWRTdHlsZXM7XG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIE5hbWUvdmFsdWUgbWFwIG9iamVjdCB3aXRoIHZhbGlkIGNsYXNzZXMgZm9yIGVhY2ggZWxlbWVudC5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgZ2V0VmFsaWRDbGFzc2VzXG5cdFx0ICogQHR5cGUgT2JqZWN0XG5cdFx0ICovXG5cdFx0c2VsZi5nZXRWYWxpZENsYXNzZXMgPSBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiB2YWxpZENsYXNzZXM7XG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIFJldHVybnMgYSBtYXAgd2l0aCBib29sZWFuIGF0dHJpYnV0ZXMuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGdldEJvb2xBdHRyc1xuXHRcdCAqIEByZXR1cm4ge09iamVjdH0gTmFtZS92YWx1ZSBsb29rdXAgbWFwIGZvciBib29sZWFuIGF0dHJpYnV0ZXMuXG5cdFx0ICovXG5cdFx0c2VsZi5nZXRCb29sQXR0cnMgPSBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiBib29sQXR0ck1hcDtcblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyBhIG1hcCB3aXRoIGJsb2NrIGVsZW1lbnRzLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBnZXRCbG9ja0VsZW1lbnRzXG5cdFx0ICogQHJldHVybiB7T2JqZWN0fSBOYW1lL3ZhbHVlIGxvb2t1cCBtYXAgZm9yIGJsb2NrIGVsZW1lbnRzLlxuXHRcdCAqL1xuXHRcdHNlbGYuZ2V0QmxvY2tFbGVtZW50cyA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIGJsb2NrRWxlbWVudHNNYXA7XG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIFJldHVybnMgYSBtYXAgd2l0aCB0ZXh0IGJsb2NrIGVsZW1lbnRzLiBTdWNoIGFzOiBwLGgxLWg2LGRpdixhZGRyZXNzXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGdldFRleHRCbG9ja0VsZW1lbnRzXG5cdFx0ICogQHJldHVybiB7T2JqZWN0fSBOYW1lL3ZhbHVlIGxvb2t1cCBtYXAgZm9yIGJsb2NrIGVsZW1lbnRzLlxuXHRcdCAqL1xuXHRcdHNlbGYuZ2V0VGV4dEJsb2NrRWxlbWVudHMgPSBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiB0ZXh0QmxvY2tFbGVtZW50c01hcDtcblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyBhIG1hcCBvZiBpbmxpbmUgdGV4dCBmb3JtYXQgbm9kZXMgZm9yIGV4YW1wbGUgc3Ryb25nL3NwYW4gb3IgaW5zLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBnZXRUZXh0SW5saW5lRWxlbWVudHNcblx0XHQgKiBAcmV0dXJuIHtPYmplY3R9IE5hbWUvdmFsdWUgbG9va3VwIG1hcCBmb3IgdGV4dCBmb3JtYXQgZWxlbWVudHMuXG5cdFx0ICovXG5cdFx0c2VsZi5nZXRUZXh0SW5saW5lRWxlbWVudHMgPSBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiB0ZXh0SW5saW5lRWxlbWVudHNNYXA7XG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIFJldHVybnMgYSBtYXAgd2l0aCBzaG9ydCBlbmRlZCBlbGVtZW50cyBzdWNoIGFzIEJSIG9yIElNRy5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgZ2V0U2hvcnRFbmRlZEVsZW1lbnRzXG5cdFx0ICogQHJldHVybiB7T2JqZWN0fSBOYW1lL3ZhbHVlIGxvb2t1cCBtYXAgZm9yIHNob3J0IGVuZGVkIGVsZW1lbnRzLlxuXHRcdCAqL1xuXHRcdHNlbGYuZ2V0U2hvcnRFbmRlZEVsZW1lbnRzID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gc2hvcnRFbmRlZEVsZW1lbnRzTWFwO1xuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBSZXR1cm5zIGEgbWFwIHdpdGggc2VsZiBjbG9zaW5nIHRhZ3Mgc3VjaCBhcyA8bGk+LlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBnZXRTZWxmQ2xvc2luZ0VsZW1lbnRzXG5cdFx0ICogQHJldHVybiB7T2JqZWN0fSBOYW1lL3ZhbHVlIGxvb2t1cCBtYXAgZm9yIHNlbGYgY2xvc2luZyB0YWdzIGVsZW1lbnRzLlxuXHRcdCAqL1xuXHRcdHNlbGYuZ2V0U2VsZkNsb3NpbmdFbGVtZW50cyA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHNlbGZDbG9zaW5nRWxlbWVudHNNYXA7XG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIFJldHVybnMgYSBtYXAgd2l0aCBlbGVtZW50cyB0aGF0IHNob3VsZCBiZSB0cmVhdGVkIGFzIGNvbnRlbnRzIHJlZ2FyZGxlc3MgaWYgaXQgaGFzIHRleHRcblx0XHQgKiBjb250ZW50IGluIHRoZW0gb3Igbm90IHN1Y2ggYXMgVEQsIFZJREVPIG9yIElNRy5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgZ2V0Tm9uRW1wdHlFbGVtZW50c1xuXHRcdCAqIEByZXR1cm4ge09iamVjdH0gTmFtZS92YWx1ZSBsb29rdXAgbWFwIGZvciBub24gZW1wdHkgZWxlbWVudHMuXG5cdFx0ICovXG5cdFx0c2VsZi5nZXROb25FbXB0eUVsZW1lbnRzID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gbm9uRW1wdHlFbGVtZW50c01hcDtcblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyBhIG1hcCB3aXRoIGVsZW1lbnRzIHRoYXQgdGhlIGNhcmV0IHNob3VsZCBiZSBtb3ZlZCBpbiBmcm9udCBvZiBhZnRlciBlbnRlciBpc1xuXHRcdCAqIHByZXNzZWRcblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgZ2V0TW92ZUNhcmV0QmVmb3JlT25FbnRlckVsZW1lbnRzXG5cdFx0ICogQHJldHVybiB7T2JqZWN0fSBOYW1lL3ZhbHVlIGxvb2t1cCBtYXAgZm9yIGVsZW1lbnRzIHRvIHBsYWNlIHRoZSBjYXJldCBpbiBmcm9udCBvZi5cblx0XHQgKi9cblx0XHRzZWxmLmdldE1vdmVDYXJldEJlZm9yZU9uRW50ZXJFbGVtZW50cyA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIG1vdmVDYXJldEJlZm9yZU9uRW50ZXJFbGVtZW50c01hcDtcblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyBhIG1hcCB3aXRoIGVsZW1lbnRzIHdoZXJlIHdoaXRlIHNwYWNlIGlzIHRvIGJlIHByZXNlcnZlZCBsaWtlIFBSRSBvciBTQ1JJUFQuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGdldFdoaXRlU3BhY2VFbGVtZW50c1xuXHRcdCAqIEByZXR1cm4ge09iamVjdH0gTmFtZS92YWx1ZSBsb29rdXAgbWFwIGZvciB3aGl0ZSBzcGFjZSBlbGVtZW50cy5cblx0XHQgKi9cblx0XHRzZWxmLmdldFdoaXRlU3BhY2VFbGVtZW50cyA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHdoaXRlU3BhY2VFbGVtZW50c01hcDtcblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyBhIG1hcCB3aXRoIHNwZWNpYWwgZWxlbWVudHMuIFRoZXNlIGFyZSBlbGVtZW50cyB0aGF0IG5lZWRzIHRvIGJlIHBhcnNlZFxuXHRcdCAqIGluIGEgc3BlY2lhbCB3YXkgc3VjaCBhcyBzY3JpcHQsIHN0eWxlLCB0ZXh0YXJlYSBldGMuIFRoZSBtYXAgb2JqZWN0IHZhbHVlc1xuXHRcdCAqIGFyZSByZWdleHBzIHVzZWQgdG8gZmluZCB0aGUgZW5kIG9mIHRoZSBlbGVtZW50LlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBnZXRTcGVjaWFsRWxlbWVudHNcblx0XHQgKiBAcmV0dXJuIHtPYmplY3R9IE5hbWUvdmFsdWUgbG9va3VwIG1hcCBmb3Igc3BlY2lhbCBlbGVtZW50cy5cblx0XHQgKi9cblx0XHRzZWxmLmdldFNwZWNpYWxFbGVtZW50cyA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHNwZWNpYWxFbGVtZW50cztcblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyB0cnVlL2ZhbHNlIGlmIHRoZSBzcGVjaWZpZWQgZWxlbWVudCBhbmQgaXQncyBjaGlsZCBpcyB2YWxpZCBvciBub3Rcblx0XHQgKiBhY2NvcmRpbmcgdG8gdGhlIHNjaGVtYS5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgaXNWYWxpZENoaWxkXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IG5hbWUgRWxlbWVudCBuYW1lIHRvIGNoZWNrIGZvci5cblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gY2hpbGQgRWxlbWVudCBjaGlsZCB0byB2ZXJpZnkuXG5cdFx0ICogQHJldHVybiB7Qm9vbGVhbn0gVHJ1ZS9mYWxzZSBpZiB0aGUgZWxlbWVudCBpcyBhIHZhbGlkIGNoaWxkIG9mIHRoZSBzcGVjaWZpZWQgcGFyZW50LlxuXHRcdCAqL1xuXHRcdHNlbGYuaXNWYWxpZENoaWxkID0gZnVuY3Rpb24obmFtZSwgY2hpbGQpIHtcblx0XHRcdHZhciBwYXJlbnQgPSBjaGlsZHJlbltuYW1lXTtcblxuXHRcdFx0cmV0dXJuICEhKHBhcmVudCAmJiBwYXJlbnRbY2hpbGRdKTtcblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyB0cnVlL2ZhbHNlIGlmIHRoZSBzcGVjaWZpZWQgZWxlbWVudCBuYW1lIGFuZCBvcHRpb25hbCBhdHRyaWJ1dGUgaXNcblx0XHQgKiB2YWxpZCBhY2NvcmRpbmcgdG8gdGhlIHNjaGVtYS5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgaXNWYWxpZFxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIE5hbWUgb2YgZWxlbWVudCB0byBjaGVjay5cblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gYXR0ciBPcHRpb25hbCBhdHRyaWJ1dGUgbmFtZSB0byBjaGVjayBmb3IuXG5cdFx0ICogQHJldHVybiB7Qm9vbGVhbn0gVHJ1ZS9mYWxzZSBpZiB0aGUgZWxlbWVudCBhbmQgYXR0cmlidXRlIGlzIHZhbGlkLlxuXHRcdCAqL1xuXHRcdHNlbGYuaXNWYWxpZCA9IGZ1bmN0aW9uKG5hbWUsIGF0dHIpIHtcblx0XHRcdHZhciBhdHRyUGF0dGVybnMsIGksIHJ1bGUgPSBnZXRFbGVtZW50UnVsZShuYW1lKTtcblxuXHRcdFx0Ly8gQ2hlY2sgaWYgaXQncyBhIHZhbGlkIGVsZW1lbnRcblx0XHRcdGlmIChydWxlKSB7XG5cdFx0XHRcdGlmIChhdHRyKSB7XG5cdFx0XHRcdFx0Ly8gQ2hlY2sgaWYgYXR0cmlidXRlIG5hbWUgZXhpc3RzXG5cdFx0XHRcdFx0aWYgKHJ1bGUuYXR0cmlidXRlc1thdHRyXSkge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Ly8gQ2hlY2sgaWYgYXR0cmlidXRlIG1hdGNoZXMgYSByZWdleHAgcGF0dGVyblxuXHRcdFx0XHRcdGF0dHJQYXR0ZXJucyA9IHJ1bGUuYXR0cmlidXRlUGF0dGVybnM7XG5cdFx0XHRcdFx0aWYgKGF0dHJQYXR0ZXJucykge1xuXHRcdFx0XHRcdFx0aSA9IGF0dHJQYXR0ZXJucy5sZW5ndGg7XG5cdFx0XHRcdFx0XHR3aGlsZSAoaS0tKSB7XG5cdFx0XHRcdFx0XHRcdGlmIChhdHRyUGF0dGVybnNbaV0ucGF0dGVybi50ZXN0KG5hbWUpKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0Ly8gTm8gbWF0Y2hcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyB0cnVlL2ZhbHNlIGlmIHRoZSBzcGVjaWZpZWQgZWxlbWVudCBpcyB2YWxpZCBvciBub3Rcblx0XHQgKiBhY2NvcmRpbmcgdG8gdGhlIHNjaGVtYS5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgZ2V0RWxlbWVudFJ1bGVcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSBFbGVtZW50IG5hbWUgdG8gY2hlY2sgZm9yLlxuXHRcdCAqIEByZXR1cm4ge09iamVjdH0gRWxlbWVudCBvYmplY3Qgb3IgdW5kZWZpbmVkIGlmIHRoZSBlbGVtZW50IGlzbid0IHZhbGlkLlxuXHRcdCAqL1xuXHRcdHNlbGYuZ2V0RWxlbWVudFJ1bGUgPSBnZXRFbGVtZW50UnVsZTtcblxuXHRcdC8qKlxuXHRcdCAqIFJldHVybnMgYW4gbWFwIG9iamVjdCBvZiBhbGwgY3VzdG9tIGVsZW1lbnRzLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBnZXRDdXN0b21FbGVtZW50c1xuXHRcdCAqIEByZXR1cm4ge09iamVjdH0gTmFtZS92YWx1ZSBtYXAgb2JqZWN0IG9mIGFsbCBjdXN0b20gZWxlbWVudHMuXG5cdFx0ICovXG5cdFx0c2VsZi5nZXRDdXN0b21FbGVtZW50cyA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIGN1c3RvbUVsZW1lbnRzTWFwO1xuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBQYXJzZXMgYSB2YWxpZCBlbGVtZW50cyBzdHJpbmcgYW5kIGFkZHMgaXQgdG8gdGhlIHNjaGVtYS4gVGhlIHZhbGlkIGVsZW1lbnRzXG5cdFx0ICogZm9ybWF0IGlzIGZvciBleGFtcGxlIFwiZWxlbWVudFthdHRyPWRlZmF1bHR8b3RoZXJhdHRyXVwiLlxuXHRcdCAqIEV4aXN0aW5nIHJ1bGVzIHdpbGwgYmUgcmVwbGFjZWQgd2l0aCB0aGUgb25lcyBzcGVjaWZpZWQsIHNvIHRoaXMgZXh0ZW5kcyB0aGUgc2NoZW1hLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBhZGRWYWxpZEVsZW1lbnRzXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IHZhbGlkX2VsZW1lbnRzIFN0cmluZyBpbiB0aGUgdmFsaWQgZWxlbWVudHMgZm9ybWF0IHRvIGJlIHBhcnNlZC5cblx0XHQgKi9cblx0XHRzZWxmLmFkZFZhbGlkRWxlbWVudHMgPSBhZGRWYWxpZEVsZW1lbnRzO1xuXG5cdFx0LyoqXG5cdFx0ICogUGFyc2VzIGEgdmFsaWQgZWxlbWVudHMgc3RyaW5nIGFuZCBzZXRzIGl0IHRvIHRoZSBzY2hlbWEuIFRoZSB2YWxpZCBlbGVtZW50c1xuXHRcdCAqIGZvcm1hdCBpcyBmb3IgZXhhbXBsZSBcImVsZW1lbnRbYXR0cj1kZWZhdWx0fG90aGVyYXR0cl1cIi5cblx0XHQgKiBFeGlzdGluZyBydWxlcyB3aWxsIGJlIHJlcGxhY2VkIHdpdGggdGhlIG9uZXMgc3BlY2lmaWVkLCBzbyB0aGlzIGV4dGVuZHMgdGhlIHNjaGVtYS5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2Qgc2V0VmFsaWRFbGVtZW50c1xuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSB2YWxpZF9lbGVtZW50cyBTdHJpbmcgaW4gdGhlIHZhbGlkIGVsZW1lbnRzIGZvcm1hdCB0byBiZSBwYXJzZWQuXG5cdFx0ICovXG5cdFx0c2VsZi5zZXRWYWxpZEVsZW1lbnRzID0gc2V0VmFsaWRFbGVtZW50cztcblxuXHRcdC8qKlxuXHRcdCAqIEFkZHMgY3VzdG9tIG5vbiBIVE1MIGVsZW1lbnRzIHRvIHRoZSBzY2hlbWEuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGFkZEN1c3RvbUVsZW1lbnRzXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IGN1c3RvbV9lbGVtZW50cyBDb21tYSBzZXBhcmF0ZWQgbGlzdCBvZiBjdXN0b20gZWxlbWVudHMgdG8gYWRkLlxuXHRcdCAqL1xuXHRcdHNlbGYuYWRkQ3VzdG9tRWxlbWVudHMgPSBhZGRDdXN0b21FbGVtZW50cztcblxuXHRcdC8qKlxuXHRcdCAqIFBhcnNlcyBhIHZhbGlkIGNoaWxkcmVuIHN0cmluZyBhbmQgYWRkcyB0aGVtIHRvIHRoZSBzY2hlbWEgc3RydWN0dXJlLiBUaGUgdmFsaWQgY2hpbGRyZW5cblx0XHQgKiBmb3JtYXQgaXMgZm9yIGV4YW1wbGU6IFwiZWxlbWVudFtjaGlsZDF8Y2hpbGQyXVwiLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBhZGRWYWxpZENoaWxkcmVuXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IHZhbGlkX2NoaWxkcmVuIFZhbGlkIGNoaWxkcmVuIGVsZW1lbnRzIHN0cmluZyB0byBwYXJzZVxuXHRcdCAqL1xuXHRcdHNlbGYuYWRkVmFsaWRDaGlsZHJlbiA9IGFkZFZhbGlkQ2hpbGRyZW47XG5cblx0XHRzZWxmLmVsZW1lbnRzID0gZWxlbWVudHM7XG5cdH07XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL2h0bWwvU2F4UGFyc2VyLmpzXG5cbi8qKlxuICogU2F4UGFyc2VyLmpzXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgTEdQTCBMaWNlbnNlLlxuICogQ29weXJpZ2h0IChjKSAxOTk5LTIwMTUgRXBob3ggQ29ycC4gQWxsIHJpZ2h0cyByZXNlcnZlZFxuICpcbiAqIExpY2Vuc2U6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vbGljZW5zZVxuICogQ29udHJpYnV0aW5nOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2NvbnRyaWJ1dGluZ1xuICovXG5cbi8qZXNsaW50IG1heC1kZXB0aDpbMiwgOV0gKi9cblxuLyoqXG4gKiBUaGlzIGNsYXNzIHBhcnNlcyBIVE1MIGNvZGUgdXNpbmcgcHVyZSBKYXZhU2NyaXB0IGFuZCBleGVjdXRlcyB2YXJpb3VzIGV2ZW50cyBmb3IgZWFjaCBpdGVtIGl0IGZpbmRzLiBJdCB3aWxsXG4gKiBhbHdheXMgZXhlY3V0ZSB0aGUgZXZlbnRzIGluIHRoZSByaWdodCBvcmRlciBmb3IgdGFnIHNvdXAgY29kZSBsaWtlIDxiPjxwPjwvYj48L3A+LiBJdCB3aWxsIGFsc28gcmVtb3ZlIGVsZW1lbnRzXG4gKiBhbmQgYXR0cmlidXRlcyB0aGF0IGRvZXNuJ3QgZml0IHRoZSBzY2hlbWEgaWYgdGhlIHZhbGlkYXRlIHNldHRpbmcgaXMgZW5hYmxlZC5cbiAqXG4gKiBAZXhhbXBsZVxuICogdmFyIHBhcnNlciA9IG5ldyB0aW55bWNlLmh0bWwuU2F4UGFyc2VyKHtcbiAqICAgICB2YWxpZGF0ZTogdHJ1ZSxcbiAqXG4gKiAgICAgY29tbWVudDogZnVuY3Rpb24odGV4dCkge1xuICogICAgICAgICBjb25zb2xlLmxvZygnQ29tbWVudDonLCB0ZXh0KTtcbiAqICAgICB9LFxuICpcbiAqICAgICBjZGF0YTogZnVuY3Rpb24odGV4dCkge1xuICogICAgICAgICBjb25zb2xlLmxvZygnQ0RBVEE6JywgdGV4dCk7XG4gKiAgICAgfSxcbiAqXG4gKiAgICAgdGV4dDogZnVuY3Rpb24odGV4dCwgcmF3KSB7XG4gKiAgICAgICAgIGNvbnNvbGUubG9nKCdUZXh0OicsIHRleHQsICdSYXc6JywgcmF3KTtcbiAqICAgICB9LFxuICpcbiAqICAgICBzdGFydDogZnVuY3Rpb24obmFtZSwgYXR0cnMsIGVtcHR5KSB7XG4gKiAgICAgICAgIGNvbnNvbGUubG9nKCdTdGFydDonLCBuYW1lLCBhdHRycywgZW1wdHkpO1xuICogICAgIH0sXG4gKlxuICogICAgIGVuZDogZnVuY3Rpb24obmFtZSkge1xuICogICAgICAgICBjb25zb2xlLmxvZygnRW5kOicsIG5hbWUpO1xuICogICAgIH0sXG4gKlxuICogICAgIHBpOiBmdW5jdGlvbihuYW1lLCB0ZXh0KSB7XG4gKiAgICAgICAgIGNvbnNvbGUubG9nKCdQSTonLCBuYW1lLCB0ZXh0KTtcbiAqICAgICB9LFxuICpcbiAqICAgICBkb2N0eXBlOiBmdW5jdGlvbih0ZXh0KSB7XG4gKiAgICAgICAgIGNvbnNvbGUubG9nKCdEb2NUeXBlOicsIHRleHQpO1xuICogICAgIH1cbiAqIH0sIHNjaGVtYSk7XG4gKiBAY2xhc3MgdGlueW1jZS5odG1sLlNheFBhcnNlclxuICogQHZlcnNpb24gMy40XG4gKi9cbmRlZmluZShcInRpbnltY2UvaHRtbC9TYXhQYXJzZXJcIiwgW1xuXHRcInRpbnltY2UvaHRtbC9TY2hlbWFcIixcblx0XCJ0aW55bWNlL2h0bWwvRW50aXRpZXNcIixcblx0XCJ0aW55bWNlL3V0aWwvVG9vbHNcIlxuXSwgZnVuY3Rpb24oU2NoZW1hLCBFbnRpdGllcywgVG9vbHMpIHtcblx0dmFyIGVhY2ggPSBUb29scy5lYWNoO1xuXG5cdC8qKlxuXHQgKiBSZXR1cm5zIHRoZSBpbmRleCBvZiB0aGUgZW5kIHRhZyBmb3IgYSBzcGVjaWZpYyBzdGFydCB0YWcuIFRoaXMgY2FuIGJlXG5cdCAqIHVzZWQgdG8gc2tpcCBhbGwgY2hpbGRyZW4gb2YgYSBwYXJlbnQgZWxlbWVudCBmcm9tIGJlaW5nIHByb2Nlc3NlZC5cblx0ICpcblx0ICogQHByaXZhdGVcblx0ICogQG1ldGhvZCBmaW5kRW5kVGFnXG5cdCAqIEBwYXJhbSB7dGlueW1jZS5odG1sLlNjaGVtYX0gc2NoZW1hIFNjaGVtYSBpbnN0YW5jZSB0byB1c2UgdG8gbWF0Y2ggc2hvcnQgZW5kZWQgZWxlbWVudHMuXG5cdCAqIEBwYXJhbSB7U3RyaW5nfSBodG1sIEhUTUwgc3RyaW5nIHRvIGZpbmQgdGhlIGVuZCB0YWcgaW4uXG5cdCAqIEBwYXJhbSB7TnVtYmVyfSBzdGFydEluZGV4IEluZGV4dCB0byBzdGFydCBzZWFyY2hpbmcgYXQgc2hvdWxkIGJlIGFmdGVyIHRoZSBzdGFydCB0YWcuXG5cdCAqIEByZXR1cm4ge051bWJlcn0gSW5kZXggb2YgdGhlIGVuZCB0YWcuXG5cdCAqL1xuXHRmdW5jdGlvbiBmaW5kRW5kVGFnKHNjaGVtYSwgaHRtbCwgc3RhcnRJbmRleCkge1xuXHRcdHZhciBjb3VudCA9IDEsIGluZGV4LCBtYXRjaGVzLCB0b2tlblJlZ0V4cCwgc2hvcnRFbmRlZEVsZW1lbnRzO1xuXG5cdFx0c2hvcnRFbmRlZEVsZW1lbnRzID0gc2NoZW1hLmdldFNob3J0RW5kZWRFbGVtZW50cygpO1xuXHRcdHRva2VuUmVnRXhwID0gLzwoWyE/XFwvXSk/KFtBLVphLXowLTlcXC1fXFw6XFwuXSspKCg/OlxccytbXlwiXFwnPl0rKD86KD86XCJbXlwiXSpcIil8KD86XFwnW15cXCddKlxcJyl8W14+XSopKSp8XFwvfFxccyspPi9nO1xuXHRcdHRva2VuUmVnRXhwLmxhc3RJbmRleCA9IGluZGV4ID0gc3RhcnRJbmRleDtcblxuXHRcdHdoaWxlICgobWF0Y2hlcyA9IHRva2VuUmVnRXhwLmV4ZWMoaHRtbCkpKSB7XG5cdFx0XHRpbmRleCA9IHRva2VuUmVnRXhwLmxhc3RJbmRleDtcblxuXHRcdFx0aWYgKG1hdGNoZXNbMV0gPT09ICcvJykgeyAvLyBFbmQgZWxlbWVudFxuXHRcdFx0XHRjb3VudC0tO1xuXHRcdFx0fSBlbHNlIGlmICghbWF0Y2hlc1sxXSkgeyAvLyBTdGFydCBlbGVtZW50XG5cdFx0XHRcdGlmIChtYXRjaGVzWzJdIGluIHNob3J0RW5kZWRFbGVtZW50cykge1xuXHRcdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Y291bnQrKztcblx0XHRcdH1cblxuXHRcdFx0aWYgKGNvdW50ID09PSAwKSB7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiBpbmRleDtcblx0fVxuXG5cdC8qKlxuXHQgKiBDb25zdHJ1Y3RzIGEgbmV3IFNheFBhcnNlciBpbnN0YW5jZS5cblx0ICpcblx0ICogQGNvbnN0cnVjdG9yXG5cdCAqIEBtZXRob2QgU2F4UGFyc2VyXG5cdCAqIEBwYXJhbSB7T2JqZWN0fSBzZXR0aW5ncyBOYW1lL3ZhbHVlIGNvbGxlY3Rpb24gb2Ygc2V0dGluZ3MuIGNvbW1lbnQsIGNkYXRhLCB0ZXh0LCBzdGFydCBhbmQgZW5kIGFyZSBjYWxsYmFja3MuXG5cdCAqIEBwYXJhbSB7dGlueW1jZS5odG1sLlNjaGVtYX0gc2NoZW1hIEhUTUwgU2NoZW1hIGNsYXNzIHRvIHVzZSB3aGVuIHBhcnNpbmcuXG5cdCAqL1xuXHRmdW5jdGlvbiBTYXhQYXJzZXIoc2V0dGluZ3MsIHNjaGVtYSkge1xuXHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdGZ1bmN0aW9uIG5vb3AoKSB7fVxuXG5cdFx0c2V0dGluZ3MgPSBzZXR0aW5ncyB8fCB7fTtcblx0XHRzZWxmLnNjaGVtYSA9IHNjaGVtYSA9IHNjaGVtYSB8fCBuZXcgU2NoZW1hKCk7XG5cblx0XHRpZiAoc2V0dGluZ3MuZml4X3NlbGZfY2xvc2luZyAhPT0gZmFsc2UpIHtcblx0XHRcdHNldHRpbmdzLmZpeF9zZWxmX2Nsb3NpbmcgPSB0cnVlO1xuXHRcdH1cblxuXHRcdC8vIEFkZCBoYW5kbGVyIGZ1bmN0aW9ucyBmcm9tIHNldHRpbmdzIGFuZCBzZXR1cCBkZWZhdWx0IGhhbmRsZXJzXG5cdFx0ZWFjaCgnY29tbWVudCBjZGF0YSB0ZXh0IHN0YXJ0IGVuZCBwaSBkb2N0eXBlJy5zcGxpdCgnICcpLCBmdW5jdGlvbihuYW1lKSB7XG5cdFx0XHRpZiAobmFtZSkge1xuXHRcdFx0XHRzZWxmW25hbWVdID0gc2V0dGluZ3NbbmFtZV0gfHwgbm9vcDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdC8qKlxuXHRcdCAqIFBhcnNlcyB0aGUgc3BlY2lmaWVkIEhUTUwgc3RyaW5nIGFuZCBleGVjdXRlcyB0aGUgY2FsbGJhY2tzIGZvciBlYWNoIGl0ZW0gaXQgZmluZHMuXG5cdFx0ICpcblx0XHQgKiBAZXhhbXBsZVxuXHRcdCAqIG5ldyBTYXhQYXJzZXIoey4uLn0pLnBhcnNlKCc8Yj50ZXh0PC9iPicpO1xuXHRcdCAqIEBtZXRob2QgcGFyc2Vcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gaHRtbCBIdG1sIHN0cmluZyB0byBzYXggcGFyc2UuXG5cdFx0ICovXG5cdFx0c2VsZi5wYXJzZSA9IGZ1bmN0aW9uKGh0bWwpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgbWF0Y2hlcywgaW5kZXggPSAwLCB2YWx1ZSwgZW5kUmVnRXhwLCBzdGFjayA9IFtdLCBhdHRyTGlzdCwgaSwgdGV4dCwgbmFtZTtcblx0XHRcdHZhciBpc0ludGVybmFsRWxlbWVudCwgcmVtb3ZlSW50ZXJuYWxFbGVtZW50cywgc2hvcnRFbmRlZEVsZW1lbnRzLCBmaWxsQXR0cnNNYXAsIGlzU2hvcnRFbmRlZDtcblx0XHRcdHZhciB2YWxpZGF0ZSwgZWxlbWVudFJ1bGUsIGlzVmFsaWRFbGVtZW50LCBhdHRyLCBhdHRyaWJzVmFsdWUsIHZhbGlkQXR0cmlidXRlc01hcCwgdmFsaWRBdHRyaWJ1dGVQYXR0ZXJucztcblx0XHRcdHZhciBhdHRyaWJ1dGVzUmVxdWlyZWQsIGF0dHJpYnV0ZXNEZWZhdWx0LCBhdHRyaWJ1dGVzRm9yY2VkO1xuXHRcdFx0dmFyIGFueUF0dHJpYnV0ZXNSZXF1aXJlZCwgc2VsZkNsb3NpbmcsIHRva2VuUmVnRXhwLCBhdHRyUmVnRXhwLCBzcGVjaWFsRWxlbWVudHMsIGF0dHJWYWx1ZSwgaWRDb3VudCA9IDA7XG5cdFx0XHR2YXIgZGVjb2RlID0gRW50aXRpZXMuZGVjb2RlLCBmaXhTZWxmQ2xvc2luZywgZmlsdGVyZWRVcmxBdHRycyA9IFRvb2xzLm1ha2VNYXAoJ3NyYyxocmVmLGRhdGEsYmFja2dyb3VuZCxmb3JtYWN0aW9uLHBvc3RlcicpO1xuXHRcdFx0dmFyIHNjcmlwdFVyaVJlZ0V4cCA9IC8oKGphdmF8dmIpc2NyaXB0fG1odG1sKTovaSwgZGF0YVVyaVJlZ0V4cCA9IC9eZGF0YTovaTtcblxuXHRcdFx0ZnVuY3Rpb24gcHJvY2Vzc0VuZFRhZyhuYW1lKSB7XG5cdFx0XHRcdHZhciBwb3MsIGk7XG5cblx0XHRcdFx0Ly8gRmluZCBwb3NpdGlvbiBvZiBwYXJlbnQgb2YgdGhlIHNhbWUgdHlwZVxuXHRcdFx0XHRwb3MgPSBzdGFjay5sZW5ndGg7XG5cdFx0XHRcdHdoaWxlIChwb3MtLSkge1xuXHRcdFx0XHRcdGlmIChzdGFja1twb3NdLm5hbWUgPT09IG5hbWUpIHtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIEZvdW5kIHBhcmVudFxuXHRcdFx0XHRpZiAocG9zID49IDApIHtcblx0XHRcdFx0XHQvLyBDbG9zZSBhbGwgdGhlIG9wZW4gZWxlbWVudHNcblx0XHRcdFx0XHRmb3IgKGkgPSBzdGFjay5sZW5ndGggLSAxOyBpID49IHBvczsgaS0tKSB7XG5cdFx0XHRcdFx0XHRuYW1lID0gc3RhY2tbaV07XG5cblx0XHRcdFx0XHRcdGlmIChuYW1lLnZhbGlkKSB7XG5cdFx0XHRcdFx0XHRcdHNlbGYuZW5kKG5hbWUubmFtZSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Ly8gUmVtb3ZlIHRoZSBvcGVuIGVsZW1lbnRzIGZyb20gdGhlIHN0YWNrXG5cdFx0XHRcdFx0c3RhY2subGVuZ3RoID0gcG9zO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIHBhcnNlQXR0cmlidXRlKG1hdGNoLCBuYW1lLCB2YWx1ZSwgdmFsMiwgdmFsMykge1xuXHRcdFx0XHR2YXIgYXR0clJ1bGUsIGksIHRyaW1SZWdFeHAgPSAvW1xcc1xcdTAwMDAtXFx1MDAxRl0rL2c7XG5cblx0XHRcdFx0bmFtZSA9IG5hbWUudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0dmFsdWUgPSBuYW1lIGluIGZpbGxBdHRyc01hcCA/IG5hbWUgOiBkZWNvZGUodmFsdWUgfHwgdmFsMiB8fCB2YWwzIHx8ICcnKTsgLy8gSGFuZGxlIGJvb2xlYW4gYXR0cmlidXRlIHRoYW4gdmFsdWUgYXR0cmlidXRlXG5cblx0XHRcdFx0Ly8gVmFsaWRhdGUgbmFtZSBhbmQgdmFsdWUgcGFzcyB0aHJvdWdoIGFsbCBkYXRhLSBhdHRyaWJ1dGVzXG5cdFx0XHRcdGlmICh2YWxpZGF0ZSAmJiAhaXNJbnRlcm5hbEVsZW1lbnQgJiYgbmFtZS5pbmRleE9mKCdkYXRhLScpICE9PSAwKSB7XG5cdFx0XHRcdFx0YXR0clJ1bGUgPSB2YWxpZEF0dHJpYnV0ZXNNYXBbbmFtZV07XG5cblx0XHRcdFx0XHQvLyBGaW5kIHJ1bGUgYnkgcGF0dGVybiBtYXRjaGluZ1xuXHRcdFx0XHRcdGlmICghYXR0clJ1bGUgJiYgdmFsaWRBdHRyaWJ1dGVQYXR0ZXJucykge1xuXHRcdFx0XHRcdFx0aSA9IHZhbGlkQXR0cmlidXRlUGF0dGVybnMubGVuZ3RoO1xuXHRcdFx0XHRcdFx0d2hpbGUgKGktLSkge1xuXHRcdFx0XHRcdFx0XHRhdHRyUnVsZSA9IHZhbGlkQXR0cmlidXRlUGF0dGVybnNbaV07XG5cdFx0XHRcdFx0XHRcdGlmIChhdHRyUnVsZS5wYXR0ZXJuLnRlc3QobmFtZSkpIHtcblx0XHRcdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHQvLyBObyBydWxlIG1hdGNoZWRcblx0XHRcdFx0XHRcdGlmIChpID09PSAtMSkge1xuXHRcdFx0XHRcdFx0XHRhdHRyUnVsZSA9IG51bGw7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Ly8gTm8gYXR0cmlidXRlIHJ1bGUgZm91bmRcblx0XHRcdFx0XHRpZiAoIWF0dHJSdWxlKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Ly8gVmFsaWRhdGUgdmFsdWVcblx0XHRcdFx0XHRpZiAoYXR0clJ1bGUudmFsaWRWYWx1ZXMgJiYgISh2YWx1ZSBpbiBhdHRyUnVsZS52YWxpZFZhbHVlcykpIHtcblx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBCbG9jayBhbnkgamF2YXNjcmlwdDogdXJscyBvciBub24gaW1hZ2UgZGF0YSB1cmlzXG5cdFx0XHRcdGlmIChmaWx0ZXJlZFVybEF0dHJzW25hbWVdICYmICFzZXR0aW5ncy5hbGxvd19zY3JpcHRfdXJscykge1xuXHRcdFx0XHRcdHZhciB1cmkgPSB2YWx1ZS5yZXBsYWNlKHRyaW1SZWdFeHAsICcnKTtcblxuXHRcdFx0XHRcdHRyeSB7XG5cdFx0XHRcdFx0XHQvLyBNaWdodCB0aHJvdyBtYWxmb3JtZWQgVVJJIHNlcXVlbmNlXG5cdFx0XHRcdFx0XHR1cmkgPSBkZWNvZGVVUklDb21wb25lbnQodXJpKTtcblx0XHRcdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRcdFx0Ly8gRmFsbGJhY2sgdG8gbm9uIFVURi04IGRlY29kZXJcblx0XHRcdFx0XHRcdHVyaSA9IHVuZXNjYXBlKHVyaSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHNjcmlwdFVyaVJlZ0V4cC50ZXN0KHVyaSkpIHtcblx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoIXNldHRpbmdzLmFsbG93X2h0bWxfZGF0YV91cmxzICYmIGRhdGFVcmlSZWdFeHAudGVzdCh1cmkpICYmICEvXmRhdGE6aW1hZ2VcXC8vaS50ZXN0KHVyaSkpIHtcblx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBBZGQgYXR0cmlidXRlIHRvIGxpc3QgYW5kIG1hcFxuXHRcdFx0XHRhdHRyTGlzdC5tYXBbbmFtZV0gPSB2YWx1ZTtcblx0XHRcdFx0YXR0ckxpc3QucHVzaCh7XG5cdFx0XHRcdFx0bmFtZTogbmFtZSxcblx0XHRcdFx0XHR2YWx1ZTogdmFsdWVcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIFByZWNvbXBpbGUgUmVnRXhwcyBhbmQgbWFwIG9iamVjdHNcblx0XHRcdHRva2VuUmVnRXhwID0gbmV3IFJlZ0V4cCgnPCg/OicgK1xuXHRcdFx0XHQnKD86IS0tKFtcXFxcd1xcXFxXXSo/KS0tPil8JyArIC8vIENvbW1lbnRcblx0XHRcdFx0Jyg/OiFcXFxcW0NEQVRBXFxcXFsoW1xcXFx3XFxcXFddKj8pXFxcXF1cXFxcXT4pfCcgKyAvLyBDREFUQVxuXHRcdFx0XHQnKD86IURPQ1RZUEUoW1xcXFx3XFxcXFddKj8pPil8JyArIC8vIERPQ1RZUEVcblx0XHRcdFx0Jyg/OlxcXFw/KFteXFxcXHNcXFxcLzw+XSspID8oW1xcXFx3XFxcXFddKj8pWz8vXT4pfCcgKyAvLyBQSVxuXHRcdFx0XHQnKD86XFxcXC8oW14+XSspPil8JyArIC8vIEVuZCBlbGVtZW50XG5cdFx0XHRcdCcoPzooW0EtWmEtejAtOVxcXFwtX1xcXFw6XFxcXC5dKykoKD86XFxcXHMrW15cIlxcJz5dKyg/Oig/OlwiW15cIl0qXCIpfCg/OlxcJ1teXFwnXSpcXCcpfFtePl0qKSkqfFxcXFwvfFxcXFxzKyk+KScgKyAvLyBTdGFydCBlbGVtZW50XG5cdFx0XHQnKScsICdnJyk7XG5cblx0XHRcdGF0dHJSZWdFeHAgPSAvKFtcXHc6XFwtXSspKD86XFxzKj1cXHMqKD86KD86XFxcIigoPzpbXlxcXCJdKSopXFxcIil8KD86XFwnKCg/OlteXFwnXSkqKVxcJyl8KFtePlxcc10rKSkpPy9nO1xuXG5cdFx0XHQvLyBTZXR1cCBsb29rdXAgdGFibGVzIGZvciBlbXB0eSBlbGVtZW50cyBhbmQgYm9vbGVhbiBhdHRyaWJ1dGVzXG5cdFx0XHRzaG9ydEVuZGVkRWxlbWVudHMgPSBzY2hlbWEuZ2V0U2hvcnRFbmRlZEVsZW1lbnRzKCk7XG5cdFx0XHRzZWxmQ2xvc2luZyA9IHNldHRpbmdzLnNlbGZfY2xvc2luZ19lbGVtZW50cyB8fCBzY2hlbWEuZ2V0U2VsZkNsb3NpbmdFbGVtZW50cygpO1xuXHRcdFx0ZmlsbEF0dHJzTWFwID0gc2NoZW1hLmdldEJvb2xBdHRycygpO1xuXHRcdFx0dmFsaWRhdGUgPSBzZXR0aW5ncy52YWxpZGF0ZTtcblx0XHRcdHJlbW92ZUludGVybmFsRWxlbWVudHMgPSBzZXR0aW5ncy5yZW1vdmVfaW50ZXJuYWxzO1xuXHRcdFx0Zml4U2VsZkNsb3NpbmcgPSBzZXR0aW5ncy5maXhfc2VsZl9jbG9zaW5nO1xuXHRcdFx0c3BlY2lhbEVsZW1lbnRzID0gc2NoZW1hLmdldFNwZWNpYWxFbGVtZW50cygpO1xuXG5cdFx0XHR3aGlsZSAoKG1hdGNoZXMgPSB0b2tlblJlZ0V4cC5leGVjKGh0bWwpKSkge1xuXHRcdFx0XHQvLyBUZXh0XG5cdFx0XHRcdGlmIChpbmRleCA8IG1hdGNoZXMuaW5kZXgpIHtcblx0XHRcdFx0XHRzZWxmLnRleHQoZGVjb2RlKGh0bWwuc3Vic3RyKGluZGV4LCBtYXRjaGVzLmluZGV4IC0gaW5kZXgpKSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoKHZhbHVlID0gbWF0Y2hlc1s2XSkpIHsgLy8gRW5kIGVsZW1lbnRcblx0XHRcdFx0XHR2YWx1ZSA9IHZhbHVlLnRvTG93ZXJDYXNlKCk7XG5cblx0XHRcdFx0XHQvLyBJRSB3aWxsIGFkZCBhIFwiOlwiIGluIGZyb250IG9mIGVsZW1lbnRzIGl0IGRvZXNuJ3QgdW5kZXJzdGFuZCBsaWtlIGN1c3RvbSBlbGVtZW50cyBvciBIVE1MNSBlbGVtZW50c1xuXHRcdFx0XHRcdGlmICh2YWx1ZS5jaGFyQXQoMCkgPT09ICc6Jykge1xuXHRcdFx0XHRcdFx0dmFsdWUgPSB2YWx1ZS5zdWJzdHIoMSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cHJvY2Vzc0VuZFRhZyh2YWx1ZSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoKHZhbHVlID0gbWF0Y2hlc1s3XSkpIHsgLy8gU3RhcnQgZWxlbWVudFxuXHRcdFx0XHRcdHZhbHVlID0gdmFsdWUudG9Mb3dlckNhc2UoKTtcblxuXHRcdFx0XHRcdC8vIElFIHdpbGwgYWRkIGEgXCI6XCIgaW4gZnJvbnQgb2YgZWxlbWVudHMgaXQgZG9lc24ndCB1bmRlcnN0YW5kIGxpa2UgY3VzdG9tIGVsZW1lbnRzIG9yIEhUTUw1IGVsZW1lbnRzXG5cdFx0XHRcdFx0aWYgKHZhbHVlLmNoYXJBdCgwKSA9PT0gJzonKSB7XG5cdFx0XHRcdFx0XHR2YWx1ZSA9IHZhbHVlLnN1YnN0cigxKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpc1Nob3J0RW5kZWQgPSB2YWx1ZSBpbiBzaG9ydEVuZGVkRWxlbWVudHM7XG5cblx0XHRcdFx0XHQvLyBJcyBzZWxmIGNsb3NpbmcgdGFnIGZvciBleGFtcGxlIGFuIDxsaT4gYWZ0ZXIgYW4gb3BlbiA8bGk+XG5cdFx0XHRcdFx0aWYgKGZpeFNlbGZDbG9zaW5nICYmIHNlbGZDbG9zaW5nW3ZhbHVlXSAmJiBzdGFjay5sZW5ndGggPiAwICYmIHN0YWNrW3N0YWNrLmxlbmd0aCAtIDFdLm5hbWUgPT09IHZhbHVlKSB7XG5cdFx0XHRcdFx0XHRwcm9jZXNzRW5kVGFnKHZhbHVlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHQvLyBWYWxpZGF0ZSBlbGVtZW50XG5cdFx0XHRcdFx0aWYgKCF2YWxpZGF0ZSB8fCAoZWxlbWVudFJ1bGUgPSBzY2hlbWEuZ2V0RWxlbWVudFJ1bGUodmFsdWUpKSkge1xuXHRcdFx0XHRcdFx0aXNWYWxpZEVsZW1lbnQgPSB0cnVlO1xuXG5cdFx0XHRcdFx0XHQvLyBHcmFiIGF0dHJpYnV0ZXMgbWFwIGFuZCBwYXR0ZXJzIHdoZW4gdmFsaWRhdGlvbiBpcyBlbmFibGVkXG5cdFx0XHRcdFx0XHRpZiAodmFsaWRhdGUpIHtcblx0XHRcdFx0XHRcdFx0dmFsaWRBdHRyaWJ1dGVzTWFwID0gZWxlbWVudFJ1bGUuYXR0cmlidXRlcztcblx0XHRcdFx0XHRcdFx0dmFsaWRBdHRyaWJ1dGVQYXR0ZXJucyA9IGVsZW1lbnRSdWxlLmF0dHJpYnV0ZVBhdHRlcm5zO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHQvLyBQYXJzZSBhdHRyaWJ1dGVzXG5cdFx0XHRcdFx0XHRpZiAoKGF0dHJpYnNWYWx1ZSA9IG1hdGNoZXNbOF0pKSB7XG5cdFx0XHRcdFx0XHRcdGlzSW50ZXJuYWxFbGVtZW50ID0gYXR0cmlic1ZhbHVlLmluZGV4T2YoJ2RhdGEtbWNlLXR5cGUnKSAhPT0gLTE7IC8vIENoZWNrIGlmIHRoZSBlbGVtZW50IGlzIGFuIGludGVybmFsIGVsZW1lbnRcblxuXHRcdFx0XHRcdFx0XHQvLyBJZiB0aGUgZWxlbWVudCBoYXMgaW50ZXJuYWwgYXR0cmlidXRlcyB0aGVuIHJlbW92ZSBpdCBpZiB3ZSBhcmUgdG9sZCB0byBkbyBzb1xuXHRcdFx0XHRcdFx0XHRpZiAoaXNJbnRlcm5hbEVsZW1lbnQgJiYgcmVtb3ZlSW50ZXJuYWxFbGVtZW50cykge1xuXHRcdFx0XHRcdFx0XHRcdGlzVmFsaWRFbGVtZW50ID0gZmFsc2U7XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRhdHRyTGlzdCA9IFtdO1xuXHRcdFx0XHRcdFx0XHRhdHRyTGlzdC5tYXAgPSB7fTtcblxuXHRcdFx0XHRcdFx0XHRhdHRyaWJzVmFsdWUucmVwbGFjZShhdHRyUmVnRXhwLCBwYXJzZUF0dHJpYnV0ZSk7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRhdHRyTGlzdCA9IFtdO1xuXHRcdFx0XHRcdFx0XHRhdHRyTGlzdC5tYXAgPSB7fTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0Ly8gUHJvY2VzcyBhdHRyaWJ1dGVzIGlmIHZhbGlkYXRpb24gaXMgZW5hYmxlZFxuXHRcdFx0XHRcdFx0aWYgKHZhbGlkYXRlICYmICFpc0ludGVybmFsRWxlbWVudCkge1xuXHRcdFx0XHRcdFx0XHRhdHRyaWJ1dGVzUmVxdWlyZWQgPSBlbGVtZW50UnVsZS5hdHRyaWJ1dGVzUmVxdWlyZWQ7XG5cdFx0XHRcdFx0XHRcdGF0dHJpYnV0ZXNEZWZhdWx0ID0gZWxlbWVudFJ1bGUuYXR0cmlidXRlc0RlZmF1bHQ7XG5cdFx0XHRcdFx0XHRcdGF0dHJpYnV0ZXNGb3JjZWQgPSBlbGVtZW50UnVsZS5hdHRyaWJ1dGVzRm9yY2VkO1xuXHRcdFx0XHRcdFx0XHRhbnlBdHRyaWJ1dGVzUmVxdWlyZWQgPSBlbGVtZW50UnVsZS5yZW1vdmVFbXB0eUF0dHJzO1xuXG5cdFx0XHRcdFx0XHRcdC8vIENoZWNrIGlmIGFueSBhdHRyaWJ1dGUgZXhpc3RzXG5cdFx0XHRcdFx0XHRcdGlmIChhbnlBdHRyaWJ1dGVzUmVxdWlyZWQgJiYgIWF0dHJMaXN0Lmxlbmd0aCkge1xuXHRcdFx0XHRcdFx0XHRcdGlzVmFsaWRFbGVtZW50ID0gZmFsc2U7XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHQvLyBIYW5kbGUgZm9yY2VkIGF0dHJpYnV0ZXNcblx0XHRcdFx0XHRcdFx0aWYgKGF0dHJpYnV0ZXNGb3JjZWQpIHtcblx0XHRcdFx0XHRcdFx0XHRpID0gYXR0cmlidXRlc0ZvcmNlZC5sZW5ndGg7XG5cdFx0XHRcdFx0XHRcdFx0d2hpbGUgKGktLSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0YXR0ciA9IGF0dHJpYnV0ZXNGb3JjZWRbaV07XG5cdFx0XHRcdFx0XHRcdFx0XHRuYW1lID0gYXR0ci5uYW1lO1xuXHRcdFx0XHRcdFx0XHRcdFx0YXR0clZhbHVlID0gYXR0ci52YWx1ZTtcblxuXHRcdFx0XHRcdFx0XHRcdFx0aWYgKGF0dHJWYWx1ZSA9PT0gJ3skdWlkfScpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0YXR0clZhbHVlID0gJ21jZV8nICsgaWRDb3VudCsrO1xuXHRcdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0XHRhdHRyTGlzdC5tYXBbbmFtZV0gPSBhdHRyVmFsdWU7XG5cdFx0XHRcdFx0XHRcdFx0XHRhdHRyTGlzdC5wdXNoKHtuYW1lOiBuYW1lLCB2YWx1ZTogYXR0clZhbHVlfSk7XG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0Ly8gSGFuZGxlIGRlZmF1bHQgYXR0cmlidXRlc1xuXHRcdFx0XHRcdFx0XHRpZiAoYXR0cmlidXRlc0RlZmF1bHQpIHtcblx0XHRcdFx0XHRcdFx0XHRpID0gYXR0cmlidXRlc0RlZmF1bHQubGVuZ3RoO1xuXHRcdFx0XHRcdFx0XHRcdHdoaWxlIChpLS0pIHtcblx0XHRcdFx0XHRcdFx0XHRcdGF0dHIgPSBhdHRyaWJ1dGVzRGVmYXVsdFtpXTtcblx0XHRcdFx0XHRcdFx0XHRcdG5hbWUgPSBhdHRyLm5hbWU7XG5cblx0XHRcdFx0XHRcdFx0XHRcdGlmICghKG5hbWUgaW4gYXR0ckxpc3QubWFwKSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRhdHRyVmFsdWUgPSBhdHRyLnZhbHVlO1xuXG5cdFx0XHRcdFx0XHRcdFx0XHRcdGlmIChhdHRyVmFsdWUgPT09ICd7JHVpZH0nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0YXR0clZhbHVlID0gJ21jZV8nICsgaWRDb3VudCsrO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRcdFx0YXR0ckxpc3QubWFwW25hbWVdID0gYXR0clZhbHVlO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRhdHRyTGlzdC5wdXNoKHtuYW1lOiBuYW1lLCB2YWx1ZTogYXR0clZhbHVlfSk7XG5cdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0Ly8gSGFuZGxlIHJlcXVpcmVkIGF0dHJpYnV0ZXNcblx0XHRcdFx0XHRcdFx0aWYgKGF0dHJpYnV0ZXNSZXF1aXJlZCkge1xuXHRcdFx0XHRcdFx0XHRcdGkgPSBhdHRyaWJ1dGVzUmVxdWlyZWQubGVuZ3RoO1xuXHRcdFx0XHRcdFx0XHRcdHdoaWxlIChpLS0pIHtcblx0XHRcdFx0XHRcdFx0XHRcdGlmIChhdHRyaWJ1dGVzUmVxdWlyZWRbaV0gaW4gYXR0ckxpc3QubWFwKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdC8vIE5vbmUgb2YgdGhlIHJlcXVpcmVkIGF0dHJpYnV0ZXMgd2hlcmUgZm91bmRcblx0XHRcdFx0XHRcdFx0XHRpZiAoaSA9PT0gLTEpIHtcblx0XHRcdFx0XHRcdFx0XHRcdGlzVmFsaWRFbGVtZW50ID0gZmFsc2U7XG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0Ly8gSW52YWxpZGF0ZSBlbGVtZW50IGlmIGl0J3MgbWFya2VkIGFzIGJvZ3VzXG5cdFx0XHRcdFx0XHRcdGlmICgoYXR0ciA9IGF0dHJMaXN0Lm1hcFsnZGF0YS1tY2UtYm9ndXMnXSkpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAoYXR0ciA9PT0gJ2FsbCcpIHtcblx0XHRcdFx0XHRcdFx0XHRcdGluZGV4ID0gZmluZEVuZFRhZyhzY2hlbWEsIGh0bWwsIHRva2VuUmVnRXhwLmxhc3RJbmRleCk7XG5cdFx0XHRcdFx0XHRcdFx0XHR0b2tlblJlZ0V4cC5sYXN0SW5kZXggPSBpbmRleDtcblx0XHRcdFx0XHRcdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdGlzVmFsaWRFbGVtZW50ID0gZmFsc2U7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0aWYgKGlzVmFsaWRFbGVtZW50KSB7XG5cdFx0XHRcdFx0XHRcdHNlbGYuc3RhcnQodmFsdWUsIGF0dHJMaXN0LCBpc1Nob3J0RW5kZWQpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRpc1ZhbGlkRWxlbWVudCA9IGZhbHNlO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdC8vIFRyZWF0IHNjcmlwdCwgbm9zY3JpcHQgYW5kIHN0eWxlIGEgYml0IGRpZmZlcmVudCBzaW5jZSB0aGV5IG1heSBpbmNsdWRlIGNvZGUgdGhhdCBsb29rcyBsaWtlIGVsZW1lbnRzXG5cdFx0XHRcdFx0aWYgKChlbmRSZWdFeHAgPSBzcGVjaWFsRWxlbWVudHNbdmFsdWVdKSkge1xuXHRcdFx0XHRcdFx0ZW5kUmVnRXhwLmxhc3RJbmRleCA9IGluZGV4ID0gbWF0Y2hlcy5pbmRleCArIG1hdGNoZXNbMF0ubGVuZ3RoO1xuXG5cdFx0XHRcdFx0XHRpZiAoKG1hdGNoZXMgPSBlbmRSZWdFeHAuZXhlYyhodG1sKSkpIHtcblx0XHRcdFx0XHRcdFx0aWYgKGlzVmFsaWRFbGVtZW50KSB7XG5cdFx0XHRcdFx0XHRcdFx0dGV4dCA9IGh0bWwuc3Vic3RyKGluZGV4LCBtYXRjaGVzLmluZGV4IC0gaW5kZXgpO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0aW5kZXggPSBtYXRjaGVzLmluZGV4ICsgbWF0Y2hlc1swXS5sZW5ndGg7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHR0ZXh0ID0gaHRtbC5zdWJzdHIoaW5kZXgpO1xuXHRcdFx0XHRcdFx0XHRpbmRleCA9IGh0bWwubGVuZ3RoO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRpZiAoaXNWYWxpZEVsZW1lbnQpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHRleHQubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRcdFx0XHRcdHNlbGYudGV4dCh0ZXh0LCB0cnVlKTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHNlbGYuZW5kKHZhbHVlKTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0dG9rZW5SZWdFeHAubGFzdEluZGV4ID0gaW5kZXg7XG5cdFx0XHRcdFx0XHRjb250aW51ZTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHQvLyBQdXNoIHZhbHVlIG9uIHRvIHN0YWNrXG5cdFx0XHRcdFx0aWYgKCFpc1Nob3J0RW5kZWQpIHtcblx0XHRcdFx0XHRcdGlmICghYXR0cmlic1ZhbHVlIHx8IGF0dHJpYnNWYWx1ZS5pbmRleE9mKCcvJykgIT0gYXR0cmlic1ZhbHVlLmxlbmd0aCAtIDEpIHtcblx0XHRcdFx0XHRcdFx0c3RhY2sucHVzaCh7bmFtZTogdmFsdWUsIHZhbGlkOiBpc1ZhbGlkRWxlbWVudH0pO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmIChpc1ZhbGlkRWxlbWVudCkge1xuXHRcdFx0XHRcdFx0XHRzZWxmLmVuZCh2YWx1ZSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGVsc2UgaWYgKCh2YWx1ZSA9IG1hdGNoZXNbMV0pKSB7IC8vIENvbW1lbnRcblx0XHRcdFx0XHQvLyBQYWRkIGNvbW1lbnQgdmFsdWUgdG8gYXZvaWQgYnJvd3NlcnMgZnJvbSBwYXJzaW5nIGludmFsaWQgY29tbWVudHMgYXMgSFRNTFxuXHRcdFx0XHRcdGlmICh2YWx1ZS5jaGFyQXQoMCkgPT09ICc+Jykge1xuXHRcdFx0XHRcdFx0dmFsdWUgPSAnICcgKyB2YWx1ZTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoIXNldHRpbmdzLmFsbG93X2NvbmRpdGlvbmFsX2NvbW1lbnRzICYmIHZhbHVlLnN1YnN0cigwLCAzKS50b0xvd2VyQ2FzZSgpID09PSAnW2lmJykge1xuXHRcdFx0XHRcdFx0dmFsdWUgPSAnICcgKyB2YWx1ZTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRzZWxmLmNvbW1lbnQodmFsdWUpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCh2YWx1ZSA9IG1hdGNoZXNbMl0pKSB7IC8vIENEQVRBXG5cdFx0XHRcdFx0c2VsZi5jZGF0YSh2YWx1ZSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoKHZhbHVlID0gbWF0Y2hlc1szXSkpIHsgLy8gRE9DVFlQRVxuXHRcdFx0XHRcdHNlbGYuZG9jdHlwZSh2YWx1ZSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoKHZhbHVlID0gbWF0Y2hlc1s0XSkpIHsgLy8gUElcblx0XHRcdFx0XHRzZWxmLnBpKHZhbHVlLCBtYXRjaGVzWzVdKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGluZGV4ID0gbWF0Y2hlcy5pbmRleCArIG1hdGNoZXNbMF0ubGVuZ3RoO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBUZXh0XG5cdFx0XHRpZiAoaW5kZXggPCBodG1sLmxlbmd0aCkge1xuXHRcdFx0XHRzZWxmLnRleHQoZGVjb2RlKGh0bWwuc3Vic3RyKGluZGV4KSkpO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBDbG9zZSBhbnkgb3BlbiBlbGVtZW50c1xuXHRcdFx0Zm9yIChpID0gc3RhY2subGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcblx0XHRcdFx0dmFsdWUgPSBzdGFja1tpXTtcblxuXHRcdFx0XHRpZiAodmFsdWUudmFsaWQpIHtcblx0XHRcdFx0XHRzZWxmLmVuZCh2YWx1ZS5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH07XG5cdH1cblxuXHRTYXhQYXJzZXIuZmluZEVuZFRhZyA9IGZpbmRFbmRUYWc7XG5cblx0cmV0dXJuIFNheFBhcnNlcjtcbn0pO1xuXG4vLyBJbmNsdWRlZCBmcm9tOiBqcy90aW55bWNlL2NsYXNzZXMvaHRtbC9Eb21QYXJzZXIuanNcblxuLyoqXG4gKiBEb21QYXJzZXIuanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBUaGlzIGNsYXNzIHBhcnNlcyBIVE1MIGNvZGUgaW50byBhIERPTSBsaWtlIHN0cnVjdHVyZSBvZiBub2RlcyBpdCB3aWxsIHJlbW92ZSByZWR1bmRhbnQgd2hpdGVzcGFjZSBhbmQgbWFrZVxuICogc3VyZSB0aGF0IHRoZSBub2RlIHRyZWUgaXMgdmFsaWQgYWNjb3JkaW5nIHRvIHRoZSBzcGVjaWZpZWQgc2NoZW1hLlxuICogU28gZm9yIGV4YW1wbGU6IDxwPmE8cD5iPC9wPmM8L3A+IHdpbGwgYmVjb21lIDxwPmE8L3A+PHA+YjwvcD48cD5jPC9wPlxuICpcbiAqIEBleGFtcGxlXG4gKiB2YXIgcGFyc2VyID0gbmV3IHRpbnltY2UuaHRtbC5Eb21QYXJzZXIoe3ZhbGlkYXRlOiB0cnVlfSwgc2NoZW1hKTtcbiAqIHZhciByb290Tm9kZSA9IHBhcnNlci5wYXJzZSgnPGgxPmNvbnRlbnQ8L2gxPicpO1xuICpcbiAqIEBjbGFzcyB0aW55bWNlLmh0bWwuRG9tUGFyc2VyXG4gKiBAdmVyc2lvbiAzLjRcbiAqL1xuZGVmaW5lKFwidGlueW1jZS9odG1sL0RvbVBhcnNlclwiLCBbXG5cdFwidGlueW1jZS9odG1sL05vZGVcIixcblx0XCJ0aW55bWNlL2h0bWwvU2NoZW1hXCIsXG5cdFwidGlueW1jZS9odG1sL1NheFBhcnNlclwiLFxuXHRcInRpbnltY2UvdXRpbC9Ub29sc1wiXG5dLCBmdW5jdGlvbihOb2RlLCBTY2hlbWEsIFNheFBhcnNlciwgVG9vbHMpIHtcblx0dmFyIG1ha2VNYXAgPSBUb29scy5tYWtlTWFwLCBlYWNoID0gVG9vbHMuZWFjaCwgZXhwbG9kZSA9IFRvb2xzLmV4cGxvZGUsIGV4dGVuZCA9IFRvb2xzLmV4dGVuZDtcblxuXHQvKipcblx0ICogQ29uc3RydWN0cyBhIG5ldyBEb21QYXJzZXIgaW5zdGFuY2UuXG5cdCAqXG5cdCAqIEBjb25zdHJ1Y3RvclxuXHQgKiBAbWV0aG9kIERvbVBhcnNlclxuXHQgKiBAcGFyYW0ge09iamVjdH0gc2V0dGluZ3MgTmFtZS92YWx1ZSBjb2xsZWN0aW9uIG9mIHNldHRpbmdzLiBjb21tZW50LCBjZGF0YSwgdGV4dCwgc3RhcnQgYW5kIGVuZCBhcmUgY2FsbGJhY2tzLlxuXHQgKiBAcGFyYW0ge3RpbnltY2UuaHRtbC5TY2hlbWF9IHNjaGVtYSBIVE1MIFNjaGVtYSBjbGFzcyB0byB1c2Ugd2hlbiBwYXJzaW5nLlxuXHQgKi9cblx0cmV0dXJuIGZ1bmN0aW9uKHNldHRpbmdzLCBzY2hlbWEpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsIG5vZGVGaWx0ZXJzID0ge30sIGF0dHJpYnV0ZUZpbHRlcnMgPSBbXSwgbWF0Y2hlZE5vZGVzID0ge30sIG1hdGNoZWRBdHRyaWJ1dGVzID0ge307XG5cblx0XHRzZXR0aW5ncyA9IHNldHRpbmdzIHx8IHt9O1xuXHRcdHNldHRpbmdzLnZhbGlkYXRlID0gXCJ2YWxpZGF0ZVwiIGluIHNldHRpbmdzID8gc2V0dGluZ3MudmFsaWRhdGUgOiB0cnVlO1xuXHRcdHNldHRpbmdzLnJvb3RfbmFtZSA9IHNldHRpbmdzLnJvb3RfbmFtZSB8fCAnYm9keSc7XG5cdFx0c2VsZi5zY2hlbWEgPSBzY2hlbWEgPSBzY2hlbWEgfHwgbmV3IFNjaGVtYSgpO1xuXG5cdFx0ZnVuY3Rpb24gZml4SW52YWxpZENoaWxkcmVuKG5vZGVzKSB7XG5cdFx0XHR2YXIgbmksIG5vZGUsIHBhcmVudCwgcGFyZW50cywgbmV3UGFyZW50LCBjdXJyZW50Tm9kZSwgdGVtcE5vZGUsIGNoaWxkTm9kZSwgaTtcblx0XHRcdHZhciBub25FbXB0eUVsZW1lbnRzLCBub25TcGxpdGFibGVFbGVtZW50cywgdGV4dEJsb2NrRWxlbWVudHMsIHNwZWNpYWxFbGVtZW50cywgc2libGluZywgbmV4dE5vZGU7XG5cblx0XHRcdG5vblNwbGl0YWJsZUVsZW1lbnRzID0gbWFrZU1hcCgndHIsdGQsdGgsdGJvZHksdGhlYWQsdGZvb3QsdGFibGUnKTtcblx0XHRcdG5vbkVtcHR5RWxlbWVudHMgPSBzY2hlbWEuZ2V0Tm9uRW1wdHlFbGVtZW50cygpO1xuXHRcdFx0dGV4dEJsb2NrRWxlbWVudHMgPSBzY2hlbWEuZ2V0VGV4dEJsb2NrRWxlbWVudHMoKTtcblx0XHRcdHNwZWNpYWxFbGVtZW50cyA9IHNjaGVtYS5nZXRTcGVjaWFsRWxlbWVudHMoKTtcblxuXHRcdFx0Zm9yIChuaSA9IDA7IG5pIDwgbm9kZXMubGVuZ3RoOyBuaSsrKSB7XG5cdFx0XHRcdG5vZGUgPSBub2Rlc1tuaV07XG5cblx0XHRcdFx0Ly8gQWxyZWFkeSByZW1vdmVkIG9yIGZpeGVkXG5cdFx0XHRcdGlmICghbm9kZS5wYXJlbnQgfHwgbm9kZS5maXhlZCkge1xuXHRcdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gSWYgdGhlIGludmFsaWQgZWxlbWVudCBpcyBhIHRleHQgYmxvY2sgYW5kIHRoZSB0ZXh0IGJsb2NrIGlzIHdpdGhpbiBhIHBhcmVudCBMSSBlbGVtZW50XG5cdFx0XHRcdC8vIFRoZW4gdW53cmFwIHRoZSBmaXJzdCB0ZXh0IGJsb2NrIGFuZCBjb252ZXJ0IG90aGVyIHNpYmxpbmcgdGV4dCBibG9ja3MgdG8gTEkgZWxlbWVudHMgc2ltaWxhciB0byBXb3JkL09wZW4gT2ZmaWNlXG5cdFx0XHRcdGlmICh0ZXh0QmxvY2tFbGVtZW50c1tub2RlLm5hbWVdICYmIG5vZGUucGFyZW50Lm5hbWUgPT0gJ2xpJykge1xuXHRcdFx0XHRcdC8vIE1vdmUgc2libGluZyB0ZXh0IGJsb2NrcyBhZnRlciBMSSBlbGVtZW50XG5cdFx0XHRcdFx0c2libGluZyA9IG5vZGUubmV4dDtcblx0XHRcdFx0XHR3aGlsZSAoc2libGluZykge1xuXHRcdFx0XHRcdFx0aWYgKHRleHRCbG9ja0VsZW1lbnRzW3NpYmxpbmcubmFtZV0pIHtcblx0XHRcdFx0XHRcdFx0c2libGluZy5uYW1lID0gJ2xpJztcblx0XHRcdFx0XHRcdFx0c2libGluZy5maXhlZCA9IHRydWU7XG5cdFx0XHRcdFx0XHRcdG5vZGUucGFyZW50Lmluc2VydChzaWJsaW5nLCBub2RlLnBhcmVudCk7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0c2libGluZyA9IHNpYmxpbmcubmV4dDtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHQvLyBVbndyYXAgY3VycmVudCB0ZXh0IGJsb2NrXG5cdFx0XHRcdFx0bm9kZS51bndyYXAobm9kZSk7XG5cdFx0XHRcdFx0Y29udGludWU7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBHZXQgbGlzdCBvZiBhbGwgcGFyZW50IG5vZGVzIHVudGlsIHdlIGZpbmQgYSB2YWxpZCBwYXJlbnQgdG8gc3RpY2sgdGhlIGNoaWxkIGludG9cblx0XHRcdFx0cGFyZW50cyA9IFtub2RlXTtcblx0XHRcdFx0Zm9yIChwYXJlbnQgPSBub2RlLnBhcmVudDsgcGFyZW50ICYmICFzY2hlbWEuaXNWYWxpZENoaWxkKHBhcmVudC5uYW1lLCBub2RlLm5hbWUpICYmXG5cdFx0XHRcdFx0IW5vblNwbGl0YWJsZUVsZW1lbnRzW3BhcmVudC5uYW1lXTsgcGFyZW50ID0gcGFyZW50LnBhcmVudCkge1xuXHRcdFx0XHRcdHBhcmVudHMucHVzaChwYXJlbnQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gRm91bmQgYSBzdWl0YWJsZSBwYXJlbnRcblx0XHRcdFx0aWYgKHBhcmVudCAmJiBwYXJlbnRzLmxlbmd0aCA+IDEpIHtcblx0XHRcdFx0XHQvLyBSZXZlcnNlIHRoZSBhcnJheSBzaW5jZSBpdCBtYWtlcyBsb29waW5nIGVhc2llclxuXHRcdFx0XHRcdHBhcmVudHMucmV2ZXJzZSgpO1xuXG5cdFx0XHRcdFx0Ly8gQ2xvbmUgdGhlIHJlbGF0ZWQgcGFyZW50IGFuZCBpbnNlcnQgdGhhdCBhZnRlciB0aGUgbW92ZWQgbm9kZVxuXHRcdFx0XHRcdG5ld1BhcmVudCA9IGN1cnJlbnROb2RlID0gc2VsZi5maWx0ZXJOb2RlKHBhcmVudHNbMF0uY2xvbmUoKSk7XG5cblx0XHRcdFx0XHQvLyBTdGFydCBjbG9uaW5nIGFuZCBtb3ZpbmcgY2hpbGRyZW4gb24gdGhlIGxlZnQgc2lkZSBvZiB0aGUgdGFyZ2V0IG5vZGVcblx0XHRcdFx0XHRmb3IgKGkgPSAwOyBpIDwgcGFyZW50cy5sZW5ndGggLSAxOyBpKyspIHtcblx0XHRcdFx0XHRcdGlmIChzY2hlbWEuaXNWYWxpZENoaWxkKGN1cnJlbnROb2RlLm5hbWUsIHBhcmVudHNbaV0ubmFtZSkpIHtcblx0XHRcdFx0XHRcdFx0dGVtcE5vZGUgPSBzZWxmLmZpbHRlck5vZGUocGFyZW50c1tpXS5jbG9uZSgpKTtcblx0XHRcdFx0XHRcdFx0Y3VycmVudE5vZGUuYXBwZW5kKHRlbXBOb2RlKTtcblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdHRlbXBOb2RlID0gY3VycmVudE5vZGU7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGZvciAoY2hpbGROb2RlID0gcGFyZW50c1tpXS5maXJzdENoaWxkOyBjaGlsZE5vZGUgJiYgY2hpbGROb2RlICE9IHBhcmVudHNbaSArIDFdOykge1xuXHRcdFx0XHRcdFx0XHRuZXh0Tm9kZSA9IGNoaWxkTm9kZS5uZXh0O1xuXHRcdFx0XHRcdFx0XHR0ZW1wTm9kZS5hcHBlbmQoY2hpbGROb2RlKTtcblx0XHRcdFx0XHRcdFx0Y2hpbGROb2RlID0gbmV4dE5vZGU7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGN1cnJlbnROb2RlID0gdGVtcE5vZGU7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKCFuZXdQYXJlbnQuaXNFbXB0eShub25FbXB0eUVsZW1lbnRzKSkge1xuXHRcdFx0XHRcdFx0cGFyZW50Lmluc2VydChuZXdQYXJlbnQsIHBhcmVudHNbMF0sIHRydWUpO1xuXHRcdFx0XHRcdFx0cGFyZW50Lmluc2VydChub2RlLCBuZXdQYXJlbnQpO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRwYXJlbnQuaW5zZXJ0KG5vZGUsIHBhcmVudHNbMF0sIHRydWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdC8vIENoZWNrIGlmIHRoZSBlbGVtZW50IGlzIGVtcHR5IGJ5IGxvb2tpbmcgdGhyb3VnaCBpdCdzIGNvbnRlbnRzIGFuZCBzcGVjaWFsIHRyZWF0bWVudCBmb3IgPHA+PGJyIC8+PC9wPlxuXHRcdFx0XHRcdHBhcmVudCA9IHBhcmVudHNbMF07XG5cdFx0XHRcdFx0aWYgKHBhcmVudC5pc0VtcHR5KG5vbkVtcHR5RWxlbWVudHMpIHx8IHBhcmVudC5maXJzdENoaWxkID09PSBwYXJlbnQubGFzdENoaWxkICYmIHBhcmVudC5maXJzdENoaWxkLm5hbWUgPT09ICdicicpIHtcblx0XHRcdFx0XHRcdHBhcmVudC5lbXB0eSgpLnJlbW92ZSgpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIGlmIChub2RlLnBhcmVudCkge1xuXHRcdFx0XHRcdC8vIElmIGl0J3MgYW4gTEkgdHJ5IHRvIGZpbmQgYSBVTC9PTCBmb3IgaXQgb3Igd3JhcCBpdFxuXHRcdFx0XHRcdGlmIChub2RlLm5hbWUgPT09ICdsaScpIHtcblx0XHRcdFx0XHRcdHNpYmxpbmcgPSBub2RlLnByZXY7XG5cdFx0XHRcdFx0XHRpZiAoc2libGluZyAmJiAoc2libGluZy5uYW1lID09PSAndWwnIHx8IHNpYmxpbmcubmFtZSA9PT0gJ3VsJykpIHtcblx0XHRcdFx0XHRcdFx0c2libGluZy5hcHBlbmQobm9kZSk7XG5cdFx0XHRcdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRzaWJsaW5nID0gbm9kZS5uZXh0O1xuXHRcdFx0XHRcdFx0aWYgKHNpYmxpbmcgJiYgKHNpYmxpbmcubmFtZSA9PT0gJ3VsJyB8fCBzaWJsaW5nLm5hbWUgPT09ICd1bCcpKSB7XG5cdFx0XHRcdFx0XHRcdHNpYmxpbmcuaW5zZXJ0KG5vZGUsIHNpYmxpbmcuZmlyc3RDaGlsZCwgdHJ1ZSk7XG5cdFx0XHRcdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRub2RlLndyYXAoc2VsZi5maWx0ZXJOb2RlKG5ldyBOb2RlKCd1bCcsIDEpKSk7XG5cdFx0XHRcdFx0XHRjb250aW51ZTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHQvLyBUcnkgd3JhcHBpbmcgdGhlIGVsZW1lbnQgaW4gYSBESVZcblx0XHRcdFx0XHRpZiAoc2NoZW1hLmlzVmFsaWRDaGlsZChub2RlLnBhcmVudC5uYW1lLCAnZGl2JykgJiYgc2NoZW1hLmlzVmFsaWRDaGlsZCgnZGl2Jywgbm9kZS5uYW1lKSkge1xuXHRcdFx0XHRcdFx0bm9kZS53cmFwKHNlbGYuZmlsdGVyTm9kZShuZXcgTm9kZSgnZGl2JywgMSkpKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0Ly8gV2UgZmFpbGVkIHdyYXBwaW5nIGl0LCB0aGVuIHJlbW92ZSBvciB1bndyYXAgaXRcblx0XHRcdFx0XHRcdGlmIChzcGVjaWFsRWxlbWVudHNbbm9kZS5uYW1lXSkge1xuXHRcdFx0XHRcdFx0XHRub2RlLmVtcHR5KCkucmVtb3ZlKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRub2RlLnVud3JhcCgpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8qKlxuXHRcdCAqIFJ1bnMgdGhlIHNwZWNpZmllZCBub2RlIHRob3VnaCB0aGUgZWxlbWVudCBhbmQgYXR0cmlidXRlcyBmaWx0ZXJzLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBmaWx0ZXJOb2RlXG5cdFx0ICogQHBhcmFtIHt0aW55bWNlLmh0bWwuTm9kZX0gTm9kZSB0aGUgbm9kZSB0byBydW4gZmlsdGVycyBvbi5cblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLmh0bWwuTm9kZX0gVGhlIHBhc3NlZCBpbiBub2RlLlxuXHRcdCAqL1xuXHRcdHNlbGYuZmlsdGVyTm9kZSA9IGZ1bmN0aW9uKG5vZGUpIHtcblx0XHRcdHZhciBpLCBuYW1lLCBsaXN0O1xuXG5cdFx0XHQvLyBSdW4gZWxlbWVudCBmaWx0ZXJzXG5cdFx0XHRpZiAobmFtZSBpbiBub2RlRmlsdGVycykge1xuXHRcdFx0XHRsaXN0ID0gbWF0Y2hlZE5vZGVzW25hbWVdO1xuXG5cdFx0XHRcdGlmIChsaXN0KSB7XG5cdFx0XHRcdFx0bGlzdC5wdXNoKG5vZGUpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG1hdGNoZWROb2Rlc1tuYW1lXSA9IFtub2RlXTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHQvLyBSdW4gYXR0cmlidXRlIGZpbHRlcnNcblx0XHRcdGkgPSBhdHRyaWJ1dGVGaWx0ZXJzLmxlbmd0aDtcblx0XHRcdHdoaWxlIChpLS0pIHtcblx0XHRcdFx0bmFtZSA9IGF0dHJpYnV0ZUZpbHRlcnNbaV0ubmFtZTtcblxuXHRcdFx0XHRpZiAobmFtZSBpbiBub2RlLmF0dHJpYnV0ZXMubWFwKSB7XG5cdFx0XHRcdFx0bGlzdCA9IG1hdGNoZWRBdHRyaWJ1dGVzW25hbWVdO1xuXG5cdFx0XHRcdFx0aWYgKGxpc3QpIHtcblx0XHRcdFx0XHRcdGxpc3QucHVzaChub2RlKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0bWF0Y2hlZEF0dHJpYnV0ZXNbbmFtZV0gPSBbbm9kZV07XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBub2RlO1xuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBBZGRzIGEgbm9kZSBmaWx0ZXIgZnVuY3Rpb24gdG8gdGhlIHBhcnNlciwgdGhlIHBhcnNlciB3aWxsIGNvbGxlY3QgdGhlIHNwZWNpZmllZCBub2RlcyBieSBuYW1lXG5cdFx0ICogYW5kIHRoZW4gZXhlY3V0ZSB0aGUgY2FsbGJhY2sgb25lcyBpdCBoYXMgZmluaXNoZWQgcGFyc2luZyB0aGUgZG9jdW1lbnQuXG5cdFx0ICpcblx0XHQgKiBAZXhhbXBsZVxuXHRcdCAqIHBhcnNlci5hZGROb2RlRmlsdGVyKCdwLGgxJywgZnVuY3Rpb24obm9kZXMsIG5hbWUpIHtcblx0XHQgKlx0XHRmb3IgKHZhciBpID0gMDsgaSA8IG5vZGVzLmxlbmd0aDsgaSsrKSB7XG5cdFx0ICpcdFx0XHRjb25zb2xlLmxvZyhub2Rlc1tpXS5uYW1lKTtcblx0XHQgKlx0XHR9XG5cdFx0ICogfSk7XG5cdFx0ICogQG1ldGhvZCBhZGROb2RlRmlsdGVyXG5cdFx0ICogQG1ldGhvZCB7U3RyaW5nfSBuYW1lIENvbW1hIHNlcGFyYXRlZCBsaXN0IG9mIG5vZGVzIHRvIGNvbGxlY3QuXG5cdFx0ICogQHBhcmFtIHtmdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gZXhlY3V0ZSBvbmNlIGl0IGhhcyBjb2xsZWN0ZWQgbm9kZXMuXG5cdFx0ICovXG5cdFx0c2VsZi5hZGROb2RlRmlsdGVyID0gZnVuY3Rpb24obmFtZSwgY2FsbGJhY2spIHtcblx0XHRcdGVhY2goZXhwbG9kZShuYW1lKSwgZnVuY3Rpb24obmFtZSkge1xuXHRcdFx0XHR2YXIgbGlzdCA9IG5vZGVGaWx0ZXJzW25hbWVdO1xuXG5cdFx0XHRcdGlmICghbGlzdCkge1xuXHRcdFx0XHRcdG5vZGVGaWx0ZXJzW25hbWVdID0gbGlzdCA9IFtdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0bGlzdC5wdXNoKGNhbGxiYWNrKTtcblx0XHRcdH0pO1xuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBBZGRzIGEgYXR0cmlidXRlIGZpbHRlciBmdW5jdGlvbiB0byB0aGUgcGFyc2VyLCB0aGUgcGFyc2VyIHdpbGwgY29sbGVjdCBub2RlcyB0aGF0IGhhcyB0aGUgc3BlY2lmaWVkIGF0dHJpYnV0ZXNcblx0XHQgKiBhbmQgdGhlbiBleGVjdXRlIHRoZSBjYWxsYmFjayBvbmVzIGl0IGhhcyBmaW5pc2hlZCBwYXJzaW5nIHRoZSBkb2N1bWVudC5cblx0XHQgKlxuXHRcdCAqIEBleGFtcGxlXG5cdFx0ICogcGFyc2VyLmFkZEF0dHJpYnV0ZUZpbHRlcignc3JjLGhyZWYnLCBmdW5jdGlvbihub2RlcywgbmFtZSkge1xuXHRcdCAqXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgbm9kZXMubGVuZ3RoOyBpKyspIHtcblx0XHQgKlx0XHRcdGNvbnNvbGUubG9nKG5vZGVzW2ldLm5hbWUpO1xuXHRcdCAqXHRcdH1cblx0XHQgKiB9KTtcblx0XHQgKiBAbWV0aG9kIGFkZEF0dHJpYnV0ZUZpbHRlclxuXHRcdCAqIEBtZXRob2Qge1N0cmluZ30gbmFtZSBDb21tYSBzZXBhcmF0ZWQgbGlzdCBvZiBub2RlcyB0byBjb2xsZWN0LlxuXHRcdCAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGV4ZWN1dGUgb25jZSBpdCBoYXMgY29sbGVjdGVkIG5vZGVzLlxuXHRcdCAqL1xuXHRcdHNlbGYuYWRkQXR0cmlidXRlRmlsdGVyID0gZnVuY3Rpb24obmFtZSwgY2FsbGJhY2spIHtcblx0XHRcdGVhY2goZXhwbG9kZShuYW1lKSwgZnVuY3Rpb24obmFtZSkge1xuXHRcdFx0XHR2YXIgaTtcblxuXHRcdFx0XHRmb3IgKGkgPSAwOyBpIDwgYXR0cmlidXRlRmlsdGVycy5sZW5ndGg7IGkrKykge1xuXHRcdFx0XHRcdGlmIChhdHRyaWJ1dGVGaWx0ZXJzW2ldLm5hbWUgPT09IG5hbWUpIHtcblx0XHRcdFx0XHRcdGF0dHJpYnV0ZUZpbHRlcnNbaV0uY2FsbGJhY2tzLnB1c2goY2FsbGJhY2spO1xuXHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdGF0dHJpYnV0ZUZpbHRlcnMucHVzaCh7bmFtZTogbmFtZSwgY2FsbGJhY2tzOiBbY2FsbGJhY2tdfSk7XG5cdFx0XHR9KTtcblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogUGFyc2VzIHRoZSBzcGVjaWZpZWQgSFRNTCBzdHJpbmcgaW50byBhIERPTSBsaWtlIG5vZGUgdHJlZSBhbmQgcmV0dXJucyB0aGUgcmVzdWx0LlxuXHRcdCAqXG5cdFx0ICogQGV4YW1wbGVcblx0XHQgKiB2YXIgcm9vdE5vZGUgPSBuZXcgRG9tUGFyc2VyKHsuLi59KS5wYXJzZSgnPGI+dGV4dDwvYj4nKTtcblx0XHQgKiBAbWV0aG9kIHBhcnNlXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IGh0bWwgSHRtbCBzdHJpbmcgdG8gc2F4IHBhcnNlLlxuXHRcdCAqIEBwYXJhbSB7T2JqZWN0fSBhcmdzIE9wdGlvbmFsIGFyZ3Mgb2JqZWN0IHRoYXQgZ2V0cyBwYXNzZWQgdG8gYWxsIGZpbHRlciBmdW5jdGlvbnMuXG5cdFx0ICogQHJldHVybiB7dGlueW1jZS5odG1sLk5vZGV9IFJvb3Qgbm9kZSBjb250YWluaW5nIHRoZSB0cmVlLlxuXHRcdCAqL1xuXHRcdHNlbGYucGFyc2UgPSBmdW5jdGlvbihodG1sLCBhcmdzKSB7XG5cdFx0XHR2YXIgcGFyc2VyLCByb290Tm9kZSwgbm9kZSwgbm9kZXMsIGksIGwsIGZpLCBmbCwgbGlzdCwgbmFtZSwgdmFsaWRhdGU7XG5cdFx0XHR2YXIgYmxvY2tFbGVtZW50cywgc3RhcnRXaGl0ZVNwYWNlUmVnRXhwLCBpbnZhbGlkQ2hpbGRyZW4gPSBbXSwgaXNJbldoaXRlU3BhY2VQcmVzZXJ2ZWRFbGVtZW50O1xuXHRcdFx0dmFyIGVuZFdoaXRlU3BhY2VSZWdFeHAsIGFsbFdoaXRlU3BhY2VSZWdFeHAsIGlzQWxsV2hpdGVTcGFjZVJlZ0V4cCwgd2hpdGVTcGFjZUVsZW1lbnRzO1xuXHRcdFx0dmFyIGNoaWxkcmVuLCBub25FbXB0eUVsZW1lbnRzLCByb290QmxvY2tOYW1lO1xuXG5cdFx0XHRhcmdzID0gYXJncyB8fCB7fTtcblx0XHRcdG1hdGNoZWROb2RlcyA9IHt9O1xuXHRcdFx0bWF0Y2hlZEF0dHJpYnV0ZXMgPSB7fTtcblx0XHRcdGJsb2NrRWxlbWVudHMgPSBleHRlbmQobWFrZU1hcCgnc2NyaXB0LHN0eWxlLGhlYWQsaHRtbCxib2R5LHRpdGxlLG1ldGEscGFyYW0nKSwgc2NoZW1hLmdldEJsb2NrRWxlbWVudHMoKSk7XG5cdFx0XHRub25FbXB0eUVsZW1lbnRzID0gc2NoZW1hLmdldE5vbkVtcHR5RWxlbWVudHMoKTtcblx0XHRcdGNoaWxkcmVuID0gc2NoZW1hLmNoaWxkcmVuO1xuXHRcdFx0dmFsaWRhdGUgPSBzZXR0aW5ncy52YWxpZGF0ZTtcblx0XHRcdHJvb3RCbG9ja05hbWUgPSBcImZvcmNlZF9yb290X2Jsb2NrXCIgaW4gYXJncyA/IGFyZ3MuZm9yY2VkX3Jvb3RfYmxvY2sgOiBzZXR0aW5ncy5mb3JjZWRfcm9vdF9ibG9jaztcblxuXHRcdFx0d2hpdGVTcGFjZUVsZW1lbnRzID0gc2NoZW1hLmdldFdoaXRlU3BhY2VFbGVtZW50cygpO1xuXHRcdFx0c3RhcnRXaGl0ZVNwYWNlUmVnRXhwID0gL15bIFxcdFxcclxcbl0rLztcblx0XHRcdGVuZFdoaXRlU3BhY2VSZWdFeHAgPSAvWyBcXHRcXHJcXG5dKyQvO1xuXHRcdFx0YWxsV2hpdGVTcGFjZVJlZ0V4cCA9IC9bIFxcdFxcclxcbl0rL2c7XG5cdFx0XHRpc0FsbFdoaXRlU3BhY2VSZWdFeHAgPSAvXlsgXFx0XFxyXFxuXSskLztcblxuXHRcdFx0ZnVuY3Rpb24gYWRkUm9vdEJsb2NrcygpIHtcblx0XHRcdFx0dmFyIG5vZGUgPSByb290Tm9kZS5maXJzdENoaWxkLCBuZXh0LCByb290QmxvY2tOb2RlO1xuXG5cdFx0XHRcdC8vIFJlbW92ZXMgd2hpdGVzcGFjZSBhdCBiZWdpbm5pbmcgYW5kIGVuZCBvZiBibG9jayBzbzpcblx0XHRcdFx0Ly8gPHA+IHggPC9wPiAtPiA8cD54PC9wPlxuXHRcdFx0XHRmdW5jdGlvbiB0cmltKHJvb3RCbG9ja05vZGUpIHtcblx0XHRcdFx0XHRpZiAocm9vdEJsb2NrTm9kZSkge1xuXHRcdFx0XHRcdFx0bm9kZSA9IHJvb3RCbG9ja05vZGUuZmlyc3RDaGlsZDtcblx0XHRcdFx0XHRcdGlmIChub2RlICYmIG5vZGUudHlwZSA9PSAzKSB7XG5cdFx0XHRcdFx0XHRcdG5vZGUudmFsdWUgPSBub2RlLnZhbHVlLnJlcGxhY2Uoc3RhcnRXaGl0ZVNwYWNlUmVnRXhwLCAnJyk7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdG5vZGUgPSByb290QmxvY2tOb2RlLmxhc3RDaGlsZDtcblx0XHRcdFx0XHRcdGlmIChub2RlICYmIG5vZGUudHlwZSA9PSAzKSB7XG5cdFx0XHRcdFx0XHRcdG5vZGUudmFsdWUgPSBub2RlLnZhbHVlLnJlcGxhY2UoZW5kV2hpdGVTcGFjZVJlZ0V4cCwgJycpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIENoZWNrIGlmIHJvb3RCbG9jayBpcyB2YWxpZCB3aXRoaW4gcm9vdE5vZGUgZm9yIGV4YW1wbGUgaWYgUCBpcyB2YWxpZCBpbiBIMSBpZiBIMSBpcyB0aGUgY29udGVudEVkaXRhYmUgcm9vdFxuXHRcdFx0XHRpZiAoIXNjaGVtYS5pc1ZhbGlkQ2hpbGQocm9vdE5vZGUubmFtZSwgcm9vdEJsb2NrTmFtZS50b0xvd2VyQ2FzZSgpKSkge1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHdoaWxlIChub2RlKSB7XG5cdFx0XHRcdFx0bmV4dCA9IG5vZGUubmV4dDtcblxuXHRcdFx0XHRcdGlmIChub2RlLnR5cGUgPT0gMyB8fCAobm9kZS50eXBlID09IDEgJiYgbm9kZS5uYW1lICE9PSAncCcgJiZcblx0XHRcdFx0XHRcdCFibG9ja0VsZW1lbnRzW25vZGUubmFtZV0gJiYgIW5vZGUuYXR0cignZGF0YS1tY2UtdHlwZScpKSkge1xuXHRcdFx0XHRcdFx0aWYgKCFyb290QmxvY2tOb2RlKSB7XG5cdFx0XHRcdFx0XHRcdC8vIENyZWF0ZSBhIG5ldyByb290IGJsb2NrIGVsZW1lbnRcblx0XHRcdFx0XHRcdFx0cm9vdEJsb2NrTm9kZSA9IGNyZWF0ZU5vZGUocm9vdEJsb2NrTmFtZSwgMSk7XG5cdFx0XHRcdFx0XHRcdHJvb3RCbG9ja05vZGUuYXR0cihzZXR0aW5ncy5mb3JjZWRfcm9vdF9ibG9ja19hdHRycyk7XG5cdFx0XHRcdFx0XHRcdHJvb3ROb2RlLmluc2VydChyb290QmxvY2tOb2RlLCBub2RlKTtcblx0XHRcdFx0XHRcdFx0cm9vdEJsb2NrTm9kZS5hcHBlbmQobm9kZSk7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRyb290QmxvY2tOb2RlLmFwcGVuZChub2RlKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0dHJpbShyb290QmxvY2tOb2RlKTtcblx0XHRcdFx0XHRcdHJvb3RCbG9ja05vZGUgPSBudWxsO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdG5vZGUgPSBuZXh0O1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0dHJpbShyb290QmxvY2tOb2RlKTtcblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gY3JlYXRlTm9kZShuYW1lLCB0eXBlKSB7XG5cdFx0XHRcdHZhciBub2RlID0gbmV3IE5vZGUobmFtZSwgdHlwZSksIGxpc3Q7XG5cblx0XHRcdFx0aWYgKG5hbWUgaW4gbm9kZUZpbHRlcnMpIHtcblx0XHRcdFx0XHRsaXN0ID0gbWF0Y2hlZE5vZGVzW25hbWVdO1xuXG5cdFx0XHRcdFx0aWYgKGxpc3QpIHtcblx0XHRcdFx0XHRcdGxpc3QucHVzaChub2RlKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0bWF0Y2hlZE5vZGVzW25hbWVdID0gW25vZGVdO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBub2RlO1xuXHRcdFx0fVxuXG5cdFx0XHRmdW5jdGlvbiByZW1vdmVXaGl0ZXNwYWNlQmVmb3JlKG5vZGUpIHtcblx0XHRcdFx0dmFyIHRleHROb2RlLCB0ZXh0Tm9kZU5leHQsIHRleHRWYWwsIHNpYmxpbmcsIGJsb2NrRWxlbWVudHMgPSBzY2hlbWEuZ2V0QmxvY2tFbGVtZW50cygpO1xuXG5cdFx0XHRcdGZvciAodGV4dE5vZGUgPSBub2RlLnByZXY7IHRleHROb2RlICYmIHRleHROb2RlLnR5cGUgPT09IDM7KSB7XG5cdFx0XHRcdFx0dGV4dFZhbCA9IHRleHROb2RlLnZhbHVlLnJlcGxhY2UoZW5kV2hpdGVTcGFjZVJlZ0V4cCwgJycpO1xuXG5cdFx0XHRcdFx0Ly8gRm91bmQgYSB0ZXh0IG5vZGUgd2l0aCBub24gd2hpdGVzcGFjZSB0aGVuIHRyaW0gdGhhdCBhbmQgYnJlYWtcblx0XHRcdFx0XHRpZiAodGV4dFZhbC5sZW5ndGggPiAwKSB7XG5cdFx0XHRcdFx0XHR0ZXh0Tm9kZS52YWx1ZSA9IHRleHRWYWw7XG5cdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0dGV4dE5vZGVOZXh0ID0gdGV4dE5vZGUubmV4dDtcblxuXHRcdFx0XHRcdC8vIEZpeCBmb3IgYnVnICM3NTQzIHdoZXJlIGJvZ3VzIG5vZGVzIHdvdWxkIHByb2R1Y2UgZW1wdHlcblx0XHRcdFx0XHQvLyB0ZXh0IG5vZGVzIGFuZCB0aGVzZSB3b3VsZCBiZSByZW1vdmVkIGlmIGEgbmVzdGVkIGxpc3Qgd2FzIGJlZm9yZSBpdFxuXHRcdFx0XHRcdGlmICh0ZXh0Tm9kZU5leHQpIHtcblx0XHRcdFx0XHRcdGlmICh0ZXh0Tm9kZU5leHQudHlwZSA9PSAzICYmIHRleHROb2RlTmV4dC52YWx1ZS5sZW5ndGgpIHtcblx0XHRcdFx0XHRcdFx0dGV4dE5vZGUgPSB0ZXh0Tm9kZS5wcmV2O1xuXHRcdFx0XHRcdFx0XHRjb250aW51ZTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0aWYgKCFibG9ja0VsZW1lbnRzW3RleHROb2RlTmV4dC5uYW1lXSAmJiB0ZXh0Tm9kZU5leHQubmFtZSAhPSAnc2NyaXB0JyAmJiB0ZXh0Tm9kZU5leHQubmFtZSAhPSAnc3R5bGUnKSB7XG5cdFx0XHRcdFx0XHRcdHRleHROb2RlID0gdGV4dE5vZGUucHJldjtcblx0XHRcdFx0XHRcdFx0Y29udGludWU7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0c2libGluZyA9IHRleHROb2RlLnByZXY7XG5cdFx0XHRcdFx0dGV4dE5vZGUucmVtb3ZlKCk7XG5cdFx0XHRcdFx0dGV4dE5vZGUgPSBzaWJsaW5nO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIGNsb25lQW5kRXhjbHVkZUJsb2NrcyhpbnB1dCkge1xuXHRcdFx0XHR2YXIgbmFtZSwgb3V0cHV0ID0ge307XG5cblx0XHRcdFx0Zm9yIChuYW1lIGluIGlucHV0KSB7XG5cdFx0XHRcdFx0aWYgKG5hbWUgIT09ICdsaScgJiYgbmFtZSAhPSAncCcpIHtcblx0XHRcdFx0XHRcdG91dHB1dFtuYW1lXSA9IGlucHV0W25hbWVdO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBvdXRwdXQ7XG5cdFx0XHR9XG5cblx0XHRcdHBhcnNlciA9IG5ldyBTYXhQYXJzZXIoe1xuXHRcdFx0XHR2YWxpZGF0ZTogdmFsaWRhdGUsXG5cdFx0XHRcdGFsbG93X3NjcmlwdF91cmxzOiBzZXR0aW5ncy5hbGxvd19zY3JpcHRfdXJscyxcblx0XHRcdFx0YWxsb3dfY29uZGl0aW9uYWxfY29tbWVudHM6IHNldHRpbmdzLmFsbG93X2NvbmRpdGlvbmFsX2NvbW1lbnRzLFxuXG5cdFx0XHRcdC8vIEV4Y2x1ZGUgUCBhbmQgTEkgZnJvbSBET00gcGFyc2luZyBzaW5jZSBpdCdzIHRyZWF0ZWQgYmV0dGVyIGJ5IHRoZSBET00gcGFyc2VyXG5cdFx0XHRcdHNlbGZfY2xvc2luZ19lbGVtZW50czogY2xvbmVBbmRFeGNsdWRlQmxvY2tzKHNjaGVtYS5nZXRTZWxmQ2xvc2luZ0VsZW1lbnRzKCkpLFxuXG5cdFx0XHRcdGNkYXRhOiBmdW5jdGlvbih0ZXh0KSB7XG5cdFx0XHRcdFx0bm9kZS5hcHBlbmQoY3JlYXRlTm9kZSgnI2NkYXRhJywgNCkpLnZhbHVlID0gdGV4dDtcblx0XHRcdFx0fSxcblxuXHRcdFx0XHR0ZXh0OiBmdW5jdGlvbih0ZXh0LCByYXcpIHtcblx0XHRcdFx0XHR2YXIgdGV4dE5vZGU7XG5cblx0XHRcdFx0XHQvLyBUcmltIGFsbCByZWR1bmRhbnQgd2hpdGVzcGFjZSBvbiBub24gd2hpdGUgc3BhY2UgZWxlbWVudHNcblx0XHRcdFx0XHRpZiAoIWlzSW5XaGl0ZVNwYWNlUHJlc2VydmVkRWxlbWVudCkge1xuXHRcdFx0XHRcdFx0dGV4dCA9IHRleHQucmVwbGFjZShhbGxXaGl0ZVNwYWNlUmVnRXhwLCAnICcpO1xuXG5cdFx0XHRcdFx0XHRpZiAobm9kZS5sYXN0Q2hpbGQgJiYgYmxvY2tFbGVtZW50c1tub2RlLmxhc3RDaGlsZC5uYW1lXSkge1xuXHRcdFx0XHRcdFx0XHR0ZXh0ID0gdGV4dC5yZXBsYWNlKHN0YXJ0V2hpdGVTcGFjZVJlZ0V4cCwgJycpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdC8vIERvIHdlIG5lZWQgdG8gY3JlYXRlIHRoZSBub2RlXG5cdFx0XHRcdFx0aWYgKHRleHQubGVuZ3RoICE9PSAwKSB7XG5cdFx0XHRcdFx0XHR0ZXh0Tm9kZSA9IGNyZWF0ZU5vZGUoJyN0ZXh0JywgMyk7XG5cdFx0XHRcdFx0XHR0ZXh0Tm9kZS5yYXcgPSAhIXJhdztcblx0XHRcdFx0XHRcdG5vZGUuYXBwZW5kKHRleHROb2RlKS52YWx1ZSA9IHRleHQ7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9LFxuXG5cdFx0XHRcdGNvbW1lbnQ6IGZ1bmN0aW9uKHRleHQpIHtcblx0XHRcdFx0XHRub2RlLmFwcGVuZChjcmVhdGVOb2RlKCcjY29tbWVudCcsIDgpKS52YWx1ZSA9IHRleHQ7XG5cdFx0XHRcdH0sXG5cblx0XHRcdFx0cGk6IGZ1bmN0aW9uKG5hbWUsIHRleHQpIHtcblx0XHRcdFx0XHRub2RlLmFwcGVuZChjcmVhdGVOb2RlKG5hbWUsIDcpKS52YWx1ZSA9IHRleHQ7XG5cdFx0XHRcdFx0cmVtb3ZlV2hpdGVzcGFjZUJlZm9yZShub2RlKTtcblx0XHRcdFx0fSxcblxuXHRcdFx0XHRkb2N0eXBlOiBmdW5jdGlvbih0ZXh0KSB7XG5cdFx0XHRcdFx0dmFyIG5ld05vZGU7XG5cblx0XHRcdFx0XHRuZXdOb2RlID0gbm9kZS5hcHBlbmQoY3JlYXRlTm9kZSgnI2RvY3R5cGUnLCAxMCkpO1xuXHRcdFx0XHRcdG5ld05vZGUudmFsdWUgPSB0ZXh0O1xuXHRcdFx0XHRcdHJlbW92ZVdoaXRlc3BhY2VCZWZvcmUobm9kZSk7XG5cdFx0XHRcdH0sXG5cblx0XHRcdFx0c3RhcnQ6IGZ1bmN0aW9uKG5hbWUsIGF0dHJzLCBlbXB0eSkge1xuXHRcdFx0XHRcdHZhciBuZXdOb2RlLCBhdHRyRmlsdGVyc0xlbiwgZWxlbWVudFJ1bGUsIGF0dHJOYW1lLCBwYXJlbnQ7XG5cblx0XHRcdFx0XHRlbGVtZW50UnVsZSA9IHZhbGlkYXRlID8gc2NoZW1hLmdldEVsZW1lbnRSdWxlKG5hbWUpIDoge307XG5cdFx0XHRcdFx0aWYgKGVsZW1lbnRSdWxlKSB7XG5cdFx0XHRcdFx0XHRuZXdOb2RlID0gY3JlYXRlTm9kZShlbGVtZW50UnVsZS5vdXRwdXROYW1lIHx8IG5hbWUsIDEpO1xuXHRcdFx0XHRcdFx0bmV3Tm9kZS5hdHRyaWJ1dGVzID0gYXR0cnM7XG5cdFx0XHRcdFx0XHRuZXdOb2RlLnNob3J0RW5kZWQgPSBlbXB0eTtcblxuXHRcdFx0XHRcdFx0bm9kZS5hcHBlbmQobmV3Tm9kZSk7XG5cblx0XHRcdFx0XHRcdC8vIENoZWNrIGlmIG5vZGUgaXMgdmFsaWQgY2hpbGQgb2YgdGhlIHBhcmVudCBub2RlIGlzIHRoZSBjaGlsZCBpc1xuXHRcdFx0XHRcdFx0Ly8gdW5rbm93biB3ZSBkb24ndCBjb2xsZWN0IGl0IHNpbmNlIGl0J3MgcHJvYmFibHkgYSBjdXN0b20gZWxlbWVudFxuXHRcdFx0XHRcdFx0cGFyZW50ID0gY2hpbGRyZW5bbm9kZS5uYW1lXTtcblx0XHRcdFx0XHRcdGlmIChwYXJlbnQgJiYgY2hpbGRyZW5bbmV3Tm9kZS5uYW1lXSAmJiAhcGFyZW50W25ld05vZGUubmFtZV0pIHtcblx0XHRcdFx0XHRcdFx0aW52YWxpZENoaWxkcmVuLnB1c2gobmV3Tm9kZSk7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGF0dHJGaWx0ZXJzTGVuID0gYXR0cmlidXRlRmlsdGVycy5sZW5ndGg7XG5cdFx0XHRcdFx0XHR3aGlsZSAoYXR0ckZpbHRlcnNMZW4tLSkge1xuXHRcdFx0XHRcdFx0XHRhdHRyTmFtZSA9IGF0dHJpYnV0ZUZpbHRlcnNbYXR0ckZpbHRlcnNMZW5dLm5hbWU7XG5cblx0XHRcdFx0XHRcdFx0aWYgKGF0dHJOYW1lIGluIGF0dHJzLm1hcCkge1xuXHRcdFx0XHRcdFx0XHRcdGxpc3QgPSBtYXRjaGVkQXR0cmlidXRlc1thdHRyTmFtZV07XG5cblx0XHRcdFx0XHRcdFx0XHRpZiAobGlzdCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0bGlzdC5wdXNoKG5ld05vZGUpO1xuXHRcdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRtYXRjaGVkQXR0cmlidXRlc1thdHRyTmFtZV0gPSBbbmV3Tm9kZV07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdC8vIFRyaW0gd2hpdGVzcGFjZSBiZWZvcmUgYmxvY2tcblx0XHRcdFx0XHRcdGlmIChibG9ja0VsZW1lbnRzW25hbWVdKSB7XG5cdFx0XHRcdFx0XHRcdHJlbW92ZVdoaXRlc3BhY2VCZWZvcmUobmV3Tm9kZSk7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdC8vIENoYW5nZSBjdXJyZW50IG5vZGUgaWYgdGhlIGVsZW1lbnQgd2Fzbid0IGVtcHR5IGkuZSBub3QgPGJyIC8+IG9yIDxpbWcgLz5cblx0XHRcdFx0XHRcdGlmICghZW1wdHkpIHtcblx0XHRcdFx0XHRcdFx0bm9kZSA9IG5ld05vZGU7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdC8vIENoZWNrIGlmIHdlIGFyZSBpbnNpZGUgYSB3aGl0ZXNwYWNlIHByZXNlcnZlZCBlbGVtZW50XG5cdFx0XHRcdFx0XHRpZiAoIWlzSW5XaGl0ZVNwYWNlUHJlc2VydmVkRWxlbWVudCAmJiB3aGl0ZVNwYWNlRWxlbWVudHNbbmFtZV0pIHtcblx0XHRcdFx0XHRcdFx0aXNJbldoaXRlU3BhY2VQcmVzZXJ2ZWRFbGVtZW50ID0gdHJ1ZTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0sXG5cblx0XHRcdFx0ZW5kOiBmdW5jdGlvbihuYW1lKSB7XG5cdFx0XHRcdFx0dmFyIHRleHROb2RlLCBlbGVtZW50UnVsZSwgdGV4dCwgc2libGluZywgdGVtcE5vZGU7XG5cblx0XHRcdFx0XHRlbGVtZW50UnVsZSA9IHZhbGlkYXRlID8gc2NoZW1hLmdldEVsZW1lbnRSdWxlKG5hbWUpIDoge307XG5cdFx0XHRcdFx0aWYgKGVsZW1lbnRSdWxlKSB7XG5cdFx0XHRcdFx0XHRpZiAoYmxvY2tFbGVtZW50c1tuYW1lXSkge1xuXHRcdFx0XHRcdFx0XHRpZiAoIWlzSW5XaGl0ZVNwYWNlUHJlc2VydmVkRWxlbWVudCkge1xuXHRcdFx0XHRcdFx0XHRcdC8vIFRyaW0gd2hpdGVzcGFjZSBvZiB0aGUgZmlyc3Qgbm9kZSBpbiBhIGJsb2NrXG5cdFx0XHRcdFx0XHRcdFx0dGV4dE5vZGUgPSBub2RlLmZpcnN0Q2hpbGQ7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHRleHROb2RlICYmIHRleHROb2RlLnR5cGUgPT09IDMpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHRleHQgPSB0ZXh0Tm9kZS52YWx1ZS5yZXBsYWNlKHN0YXJ0V2hpdGVTcGFjZVJlZ0V4cCwgJycpO1xuXG5cdFx0XHRcdFx0XHRcdFx0XHQvLyBBbnkgY2hhcmFjdGVycyBsZWZ0IGFmdGVyIHRyaW0gb3Igc2hvdWxkIHdlIHJlbW92ZSBpdFxuXHRcdFx0XHRcdFx0XHRcdFx0aWYgKHRleHQubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHR0ZXh0Tm9kZS52YWx1ZSA9IHRleHQ7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdHRleHROb2RlID0gdGV4dE5vZGUubmV4dDtcblx0XHRcdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdHNpYmxpbmcgPSB0ZXh0Tm9kZS5uZXh0O1xuXHRcdFx0XHRcdFx0XHRcdFx0XHR0ZXh0Tm9kZS5yZW1vdmUoKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0dGV4dE5vZGUgPSBzaWJsaW5nO1xuXG5cdFx0XHRcdFx0XHRcdFx0XHRcdC8vIFJlbW92ZSBhbnkgcHVyZSB3aGl0ZXNwYWNlIHNpYmxpbmdzXG5cdFx0XHRcdFx0XHRcdFx0XHRcdHdoaWxlICh0ZXh0Tm9kZSAmJiB0ZXh0Tm9kZS50eXBlID09PSAzKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0dGV4dCA9IHRleHROb2RlLnZhbHVlO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHNpYmxpbmcgPSB0ZXh0Tm9kZS5uZXh0O1xuXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKHRleHQubGVuZ3RoID09PSAwIHx8IGlzQWxsV2hpdGVTcGFjZVJlZ0V4cC50ZXN0KHRleHQpKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHR0ZXh0Tm9kZS5yZW1vdmUoKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdHRleHROb2RlID0gc2libGluZztcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRcdFx0XHR0ZXh0Tm9kZSA9IHNpYmxpbmc7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHQvLyBUcmltIHdoaXRlc3BhY2Ugb2YgdGhlIGxhc3Qgbm9kZSBpbiBhIGJsb2NrXG5cdFx0XHRcdFx0XHRcdFx0dGV4dE5vZGUgPSBub2RlLmxhc3RDaGlsZDtcblx0XHRcdFx0XHRcdFx0XHRpZiAodGV4dE5vZGUgJiYgdGV4dE5vZGUudHlwZSA9PT0gMykge1xuXHRcdFx0XHRcdFx0XHRcdFx0dGV4dCA9IHRleHROb2RlLnZhbHVlLnJlcGxhY2UoZW5kV2hpdGVTcGFjZVJlZ0V4cCwgJycpO1xuXG5cdFx0XHRcdFx0XHRcdFx0XHQvLyBBbnkgY2hhcmFjdGVycyBsZWZ0IGFmdGVyIHRyaW0gb3Igc2hvdWxkIHdlIHJlbW92ZSBpdFxuXHRcdFx0XHRcdFx0XHRcdFx0aWYgKHRleHQubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHR0ZXh0Tm9kZS52YWx1ZSA9IHRleHQ7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdHRleHROb2RlID0gdGV4dE5vZGUucHJldjtcblx0XHRcdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdHNpYmxpbmcgPSB0ZXh0Tm9kZS5wcmV2O1xuXHRcdFx0XHRcdFx0XHRcdFx0XHR0ZXh0Tm9kZS5yZW1vdmUoKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0dGV4dE5vZGUgPSBzaWJsaW5nO1xuXG5cdFx0XHRcdFx0XHRcdFx0XHRcdC8vIFJlbW92ZSBhbnkgcHVyZSB3aGl0ZXNwYWNlIHNpYmxpbmdzXG5cdFx0XHRcdFx0XHRcdFx0XHRcdHdoaWxlICh0ZXh0Tm9kZSAmJiB0ZXh0Tm9kZS50eXBlID09PSAzKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0dGV4dCA9IHRleHROb2RlLnZhbHVlO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHNpYmxpbmcgPSB0ZXh0Tm9kZS5wcmV2O1xuXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKHRleHQubGVuZ3RoID09PSAwIHx8IGlzQWxsV2hpdGVTcGFjZVJlZ0V4cC50ZXN0KHRleHQpKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHR0ZXh0Tm9kZS5yZW1vdmUoKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdHRleHROb2RlID0gc2libGluZztcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRcdFx0XHR0ZXh0Tm9kZSA9IHNpYmxpbmc7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHQvLyBUcmltIHN0YXJ0IHdoaXRlIHNwYWNlXG5cdFx0XHRcdFx0XHRcdC8vIFJlbW92ZWQgZHVlIHRvOiAjNTQyNFxuXHRcdFx0XHRcdFx0XHQvKnRleHROb2RlID0gbm9kZS5wcmV2O1xuXHRcdFx0XHRcdFx0XHRpZiAodGV4dE5vZGUgJiYgdGV4dE5vZGUudHlwZSA9PT0gMykge1xuXHRcdFx0XHRcdFx0XHRcdHRleHQgPSB0ZXh0Tm9kZS52YWx1ZS5yZXBsYWNlKHN0YXJ0V2hpdGVTcGFjZVJlZ0V4cCwgJycpO1xuXG5cdFx0XHRcdFx0XHRcdFx0aWYgKHRleHQubGVuZ3RoID4gMClcblx0XHRcdFx0XHRcdFx0XHRcdHRleHROb2RlLnZhbHVlID0gdGV4dDtcblx0XHRcdFx0XHRcdFx0XHRlbHNlXG5cdFx0XHRcdFx0XHRcdFx0XHR0ZXh0Tm9kZS5yZW1vdmUoKTtcblx0XHRcdFx0XHRcdFx0fSovXG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdC8vIENoZWNrIGlmIHdlIGV4aXRlZCBhIHdoaXRlc3BhY2UgcHJlc2VydmVkIGVsZW1lbnRcblx0XHRcdFx0XHRcdGlmIChpc0luV2hpdGVTcGFjZVByZXNlcnZlZEVsZW1lbnQgJiYgd2hpdGVTcGFjZUVsZW1lbnRzW25hbWVdKSB7XG5cdFx0XHRcdFx0XHRcdGlzSW5XaGl0ZVNwYWNlUHJlc2VydmVkRWxlbWVudCA9IGZhbHNlO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHQvLyBIYW5kbGUgZW1wdHkgbm9kZXNcblx0XHRcdFx0XHRcdGlmIChlbGVtZW50UnVsZS5yZW1vdmVFbXB0eSB8fCBlbGVtZW50UnVsZS5wYWRkRW1wdHkpIHtcblx0XHRcdFx0XHRcdFx0aWYgKG5vZGUuaXNFbXB0eShub25FbXB0eUVsZW1lbnRzKSkge1xuXHRcdFx0XHRcdFx0XHRcdGlmIChlbGVtZW50UnVsZS5wYWRkRW1wdHkpIHtcblx0XHRcdFx0XHRcdFx0XHRcdG5vZGUuZW1wdHkoKS5hcHBlbmQobmV3IE5vZGUoJyN0ZXh0JywgJzMnKSkudmFsdWUgPSAnXFx1MDBhMCc7XG5cdFx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRcdC8vIExlYXZlIG5vZGVzIHRoYXQgaGF2ZSBhIG5hbWUgbGlrZSA8YSBuYW1lPVwibmFtZVwiPlxuXHRcdFx0XHRcdFx0XHRcdFx0aWYgKCFub2RlLmF0dHJpYnV0ZXMubWFwLm5hbWUgJiYgIW5vZGUuYXR0cmlidXRlcy5tYXAuaWQpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0dGVtcE5vZGUgPSBub2RlLnBhcmVudDtcblxuXHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAoYmxvY2tFbGVtZW50c1tub2RlLm5hbWVdKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0bm9kZS5lbXB0eSgpLnJlbW92ZSgpO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdG5vZGUudW53cmFwKCk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdFx0XHRub2RlID0gdGVtcE5vZGU7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0bm9kZSA9IG5vZGUucGFyZW50O1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fSwgc2NoZW1hKTtcblxuXHRcdFx0cm9vdE5vZGUgPSBub2RlID0gbmV3IE5vZGUoYXJncy5jb250ZXh0IHx8IHNldHRpbmdzLnJvb3RfbmFtZSwgMTEpO1xuXG5cdFx0XHRwYXJzZXIucGFyc2UoaHRtbCk7XG5cblx0XHRcdC8vIEZpeCBpbnZhbGlkIGNoaWxkcmVuIG9yIHJlcG9ydCBpbnZhbGlkIGNoaWxkcmVuIGluIGEgY29udGV4dHVhbCBwYXJzaW5nXG5cdFx0XHRpZiAodmFsaWRhdGUgJiYgaW52YWxpZENoaWxkcmVuLmxlbmd0aCkge1xuXHRcdFx0XHRpZiAoIWFyZ3MuY29udGV4dCkge1xuXHRcdFx0XHRcdGZpeEludmFsaWRDaGlsZHJlbihpbnZhbGlkQ2hpbGRyZW4pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGFyZ3MuaW52YWxpZCA9IHRydWU7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0Ly8gV3JhcCBub2RlcyBpbiB0aGUgcm9vdCBpbnRvIGJsb2NrIGVsZW1lbnRzIGlmIHRoZSByb290IGlzIGJvZHlcblx0XHRcdGlmIChyb290QmxvY2tOYW1lICYmIChyb290Tm9kZS5uYW1lID09ICdib2R5JyB8fCBhcmdzLmlzUm9vdENvbnRlbnQpKSB7XG5cdFx0XHRcdGFkZFJvb3RCbG9ja3MoKTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gUnVuIGZpbHRlcnMgb25seSB3aGVuIHRoZSBjb250ZW50cyBpcyB2YWxpZFxuXHRcdFx0aWYgKCFhcmdzLmludmFsaWQpIHtcblx0XHRcdFx0Ly8gUnVuIG5vZGUgZmlsdGVyc1xuXHRcdFx0XHRmb3IgKG5hbWUgaW4gbWF0Y2hlZE5vZGVzKSB7XG5cdFx0XHRcdFx0bGlzdCA9IG5vZGVGaWx0ZXJzW25hbWVdO1xuXHRcdFx0XHRcdG5vZGVzID0gbWF0Y2hlZE5vZGVzW25hbWVdO1xuXG5cdFx0XHRcdFx0Ly8gUmVtb3ZlIGFscmVhZHkgcmVtb3ZlZCBjaGlsZHJlblxuXHRcdFx0XHRcdGZpID0gbm9kZXMubGVuZ3RoO1xuXHRcdFx0XHRcdHdoaWxlIChmaS0tKSB7XG5cdFx0XHRcdFx0XHRpZiAoIW5vZGVzW2ZpXS5wYXJlbnQpIHtcblx0XHRcdFx0XHRcdFx0bm9kZXMuc3BsaWNlKGZpLCAxKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRmb3IgKGkgPSAwLCBsID0gbGlzdC5sZW5ndGg7IGkgPCBsOyBpKyspIHtcblx0XHRcdFx0XHRcdGxpc3RbaV0obm9kZXMsIG5hbWUsIGFyZ3MpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIFJ1biBhdHRyaWJ1dGUgZmlsdGVyc1xuXHRcdFx0XHRmb3IgKGkgPSAwLCBsID0gYXR0cmlidXRlRmlsdGVycy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcblx0XHRcdFx0XHRsaXN0ID0gYXR0cmlidXRlRmlsdGVyc1tpXTtcblxuXHRcdFx0XHRcdGlmIChsaXN0Lm5hbWUgaW4gbWF0Y2hlZEF0dHJpYnV0ZXMpIHtcblx0XHRcdFx0XHRcdG5vZGVzID0gbWF0Y2hlZEF0dHJpYnV0ZXNbbGlzdC5uYW1lXTtcblxuXHRcdFx0XHRcdFx0Ly8gUmVtb3ZlIGFscmVhZHkgcmVtb3ZlZCBjaGlsZHJlblxuXHRcdFx0XHRcdFx0ZmkgPSBub2Rlcy5sZW5ndGg7XG5cdFx0XHRcdFx0XHR3aGlsZSAoZmktLSkge1xuXHRcdFx0XHRcdFx0XHRpZiAoIW5vZGVzW2ZpXS5wYXJlbnQpIHtcblx0XHRcdFx0XHRcdFx0XHRub2Rlcy5zcGxpY2UoZmksIDEpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGZvciAoZmkgPSAwLCBmbCA9IGxpc3QuY2FsbGJhY2tzLmxlbmd0aDsgZmkgPCBmbDsgZmkrKykge1xuXHRcdFx0XHRcdFx0XHRsaXN0LmNhbGxiYWNrc1tmaV0obm9kZXMsIGxpc3QubmFtZSwgYXJncyk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiByb290Tm9kZTtcblx0XHR9O1xuXG5cdFx0Ly8gUmVtb3ZlIDxicj4gYXQgZW5kIG9mIGJsb2NrIGVsZW1lbnRzIEdlY2tvIGFuZCBXZWJLaXQgaW5qZWN0cyBCUiBlbGVtZW50cyB0b1xuXHRcdC8vIG1ha2UgaXQgcG9zc2libGUgdG8gcGxhY2UgdGhlIGNhcmV0IGluc2lkZSBlbXB0eSBibG9ja3MuIFRoaXMgbG9naWMgdHJpZXMgdG8gcmVtb3ZlXG5cdFx0Ly8gdGhlc2UgZWxlbWVudHMgYW5kIGtlZXAgYnIgZWxlbWVudHMgdGhhdCB3aGVyZSBpbnRlbmRlZCB0byBiZSB0aGVyZSBpbnRhY3Rcblx0XHRpZiAoc2V0dGluZ3MucmVtb3ZlX3RyYWlsaW5nX2Jycykge1xuXHRcdFx0c2VsZi5hZGROb2RlRmlsdGVyKCdicicsIGZ1bmN0aW9uKG5vZGVzKSB7XG5cdFx0XHRcdHZhciBpLCBsID0gbm9kZXMubGVuZ3RoLCBub2RlLCBibG9ja0VsZW1lbnRzID0gZXh0ZW5kKHt9LCBzY2hlbWEuZ2V0QmxvY2tFbGVtZW50cygpKTtcblx0XHRcdFx0dmFyIG5vbkVtcHR5RWxlbWVudHMgPSBzY2hlbWEuZ2V0Tm9uRW1wdHlFbGVtZW50cygpLCBwYXJlbnQsIGxhc3RQYXJlbnQsIHByZXYsIHByZXZOYW1lO1xuXHRcdFx0XHR2YXIgZWxlbWVudFJ1bGUsIHRleHROb2RlO1xuXG5cdFx0XHRcdC8vIFJlbW92ZSBicnMgZnJvbSBib2R5IGVsZW1lbnQgYXMgd2VsbFxuXHRcdFx0XHRibG9ja0VsZW1lbnRzLmJvZHkgPSAxO1xuXG5cdFx0XHRcdC8vIE11c3QgbG9vcCBmb3J3YXJkcyBzaW5jZSBpdCB3aWxsIG90aGVyd2lzZSByZW1vdmUgYWxsIGJycyBpbiA8cD5hPGJyPjxicj48YnI+PC9wPlxuXHRcdFx0XHRmb3IgKGkgPSAwOyBpIDwgbDsgaSsrKSB7XG5cdFx0XHRcdFx0bm9kZSA9IG5vZGVzW2ldO1xuXHRcdFx0XHRcdHBhcmVudCA9IG5vZGUucGFyZW50O1xuXG5cdFx0XHRcdFx0aWYgKGJsb2NrRWxlbWVudHNbbm9kZS5wYXJlbnQubmFtZV0gJiYgbm9kZSA9PT0gcGFyZW50Lmxhc3RDaGlsZCkge1xuXHRcdFx0XHRcdFx0Ly8gTG9vcCBhbGwgbm9kZXMgdG8gdGhlIGxlZnQgb2YgdGhlIGN1cnJlbnQgbm9kZSBhbmQgY2hlY2sgZm9yIG90aGVyIEJSIGVsZW1lbnRzXG5cdFx0XHRcdFx0XHQvLyBleGNsdWRpbmcgYm9va21hcmtzIHNpbmNlIHRoZXkgYXJlIGludmlzaWJsZVxuXHRcdFx0XHRcdFx0cHJldiA9IG5vZGUucHJldjtcblx0XHRcdFx0XHRcdHdoaWxlIChwcmV2KSB7XG5cdFx0XHRcdFx0XHRcdHByZXZOYW1lID0gcHJldi5uYW1lO1xuXG5cdFx0XHRcdFx0XHRcdC8vIElnbm9yZSBib29rbWFya3Ncblx0XHRcdFx0XHRcdFx0aWYgKHByZXZOYW1lICE9PSBcInNwYW5cIiB8fCBwcmV2LmF0dHIoJ2RhdGEtbWNlLXR5cGUnKSAhPT0gJ2Jvb2ttYXJrJykge1xuXHRcdFx0XHRcdFx0XHRcdC8vIEZvdW5kIGEgbm9uIEJSIGVsZW1lbnRcblx0XHRcdFx0XHRcdFx0XHRpZiAocHJldk5hbWUgIT09IFwiYnJcIikge1xuXHRcdFx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0Ly8gRm91bmQgYW5vdGhlciBiciBpdCdzIGEgPGJyPjxicj4gc3RydWN0dXJlIHRoZW4gZG9uJ3QgcmVtb3ZlIGFueXRoaW5nXG5cdFx0XHRcdFx0XHRcdFx0aWYgKHByZXZOYW1lID09PSAnYnInKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRub2RlID0gbnVsbDtcblx0XHRcdFx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHByZXYgPSBwcmV2LnByZXY7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGlmIChub2RlKSB7XG5cdFx0XHRcdFx0XHRcdG5vZGUucmVtb3ZlKCk7XG5cblx0XHRcdFx0XHRcdFx0Ly8gSXMgdGhlIHBhcmVudCB0byBiZSBjb25zaWRlcmVkIGVtcHR5IGFmdGVyIHdlIHJlbW92ZWQgdGhlIEJSXG5cdFx0XHRcdFx0XHRcdGlmIChwYXJlbnQuaXNFbXB0eShub25FbXB0eUVsZW1lbnRzKSkge1xuXHRcdFx0XHRcdFx0XHRcdGVsZW1lbnRSdWxlID0gc2NoZW1hLmdldEVsZW1lbnRSdWxlKHBhcmVudC5uYW1lKTtcblxuXHRcdFx0XHRcdFx0XHRcdC8vIFJlbW92ZSBvciBwYWRkIHRoZSBlbGVtZW50IGRlcGVuZGluZyBvbiBzY2hlbWEgcnVsZVxuXHRcdFx0XHRcdFx0XHRcdGlmIChlbGVtZW50UnVsZSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0aWYgKGVsZW1lbnRSdWxlLnJlbW92ZUVtcHR5KSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdHBhcmVudC5yZW1vdmUoKTtcblx0XHRcdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAoZWxlbWVudFJ1bGUucGFkZEVtcHR5KSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdHBhcmVudC5lbXB0eSgpLmFwcGVuZChuZXcgTm9kZSgnI3RleHQnLCAzKSkudmFsdWUgPSAnXFx1MDBhMCc7XG5cdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdC8vIFJlcGxhY2VzIEJSIGVsZW1lbnRzIGluc2lkZSBpbmxpbmUgZWxlbWVudHMgbGlrZSA8cD48Yj48aT48YnI+PC9pPjwvYj48L3A+XG5cdFx0XHRcdFx0XHQvLyBzbyB0aGV5IGJlY29tZSA8cD48Yj48aT4mbmJzcDs8L2k+PC9iPjwvcD5cblx0XHRcdFx0XHRcdGxhc3RQYXJlbnQgPSBub2RlO1xuXHRcdFx0XHRcdFx0d2hpbGUgKHBhcmVudCAmJiBwYXJlbnQuZmlyc3RDaGlsZCA9PT0gbGFzdFBhcmVudCAmJiBwYXJlbnQubGFzdENoaWxkID09PSBsYXN0UGFyZW50KSB7XG5cdFx0XHRcdFx0XHRcdGxhc3RQYXJlbnQgPSBwYXJlbnQ7XG5cblx0XHRcdFx0XHRcdFx0aWYgKGJsb2NrRWxlbWVudHNbcGFyZW50Lm5hbWVdKSB7XG5cdFx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRwYXJlbnQgPSBwYXJlbnQucGFyZW50O1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRpZiAobGFzdFBhcmVudCA9PT0gcGFyZW50KSB7XG5cdFx0XHRcdFx0XHRcdHRleHROb2RlID0gbmV3IE5vZGUoJyN0ZXh0JywgMyk7XG5cdFx0XHRcdFx0XHRcdHRleHROb2RlLnZhbHVlID0gJ1xcdTAwYTAnO1xuXHRcdFx0XHRcdFx0XHRub2RlLnJlcGxhY2UodGV4dE5vZGUpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0aWYgKCFzZXR0aW5ncy5hbGxvd191bnNhZmVfbGlua190YXJnZXQpIHtcblx0XHRcdHNlbGYuYWRkQXR0cmlidXRlRmlsdGVyKCdocmVmJywgZnVuY3Rpb24obm9kZXMpIHtcblx0XHRcdFx0dmFyIGkgPSBub2Rlcy5sZW5ndGgsIG5vZGUsIHJlbDtcblx0XHRcdFx0dmFyIHJ1bGVzID0gJ25vb3BlbmVyIG5vcmVmZXJyZXInO1xuXG5cdFx0XHRcdGZ1bmN0aW9uIGFkZFRhcmdldFJ1bGVzKHJlbCkge1xuXHRcdFx0XHRcdHJlbCA9IHJlbW92ZVRhcmdldFJ1bGVzKHJlbCk7XG5cdFx0XHRcdFx0cmV0dXJuIHJlbCA/IFtyZWwsIHJ1bGVzXS5qb2luKCcgJykgOiBydWxlcztcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGZ1bmN0aW9uIHJlbW92ZVRhcmdldFJ1bGVzKHJlbCkge1xuXHRcdFx0XHRcdHZhciByZWdFeHAgPSBuZXcgUmVnRXhwKCcoJyArIHJ1bGVzLnJlcGxhY2UoJyAnLCAnfCcpICsgJyknLCAnZycpO1xuXHRcdFx0XHRcdGlmIChyZWwpIHtcblx0XHRcdFx0XHRcdHJlbCA9IFRvb2xzLnRyaW0ocmVsLnJlcGxhY2UocmVnRXhwLCAnJykpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmVsID8gcmVsIDogbnVsbDtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGZ1bmN0aW9uIHRvZ2dsZVRhcmdldFJ1bGVzKHJlbCwgaXNVbnNhZmUpIHtcblx0XHRcdFx0XHRyZXR1cm4gaXNVbnNhZmUgPyBhZGRUYXJnZXRSdWxlcyhyZWwpIDogcmVtb3ZlVGFyZ2V0UnVsZXMocmVsKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHdoaWxlIChpLS0pIHtcblx0XHRcdFx0XHRub2RlID0gbm9kZXNbaV07XG5cdFx0XHRcdFx0cmVsID0gbm9kZS5hdHRyKCdyZWwnKTtcblx0XHRcdFx0XHRpZiAobm9kZS5uYW1lID09PSAnYScpIHtcblx0XHRcdFx0XHRcdG5vZGUuYXR0cigncmVsJywgdG9nZ2xlVGFyZ2V0UnVsZXMocmVsLCBub2RlLmF0dHIoJ3RhcmdldCcpID09ICdfYmxhbmsnKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHQvLyBGb3JjZSBhbmNob3IgbmFtZXMgY2xvc2VkLCB1bmxlc3MgdGhlIHNldHRpbmcgXCJhbGxvd19odG1sX2luX25hbWVkX2FuY2hvclwiIGlzIGV4cGxpY2l0bHkgaW5jbHVkZWQuXG5cdFx0aWYgKCFzZXR0aW5ncy5hbGxvd19odG1sX2luX25hbWVkX2FuY2hvcikge1xuXHRcdFx0c2VsZi5hZGRBdHRyaWJ1dGVGaWx0ZXIoJ2lkLG5hbWUnLCBmdW5jdGlvbihub2Rlcykge1xuXHRcdFx0XHR2YXIgaSA9IG5vZGVzLmxlbmd0aCwgc2libGluZywgcHJldlNpYmxpbmcsIHBhcmVudCwgbm9kZTtcblxuXHRcdFx0XHR3aGlsZSAoaS0tKSB7XG5cdFx0XHRcdFx0bm9kZSA9IG5vZGVzW2ldO1xuXHRcdFx0XHRcdGlmIChub2RlLm5hbWUgPT09ICdhJyAmJiBub2RlLmZpcnN0Q2hpbGQgJiYgIW5vZGUuYXR0cignaHJlZicpKSB7XG5cdFx0XHRcdFx0XHRwYXJlbnQgPSBub2RlLnBhcmVudDtcblxuXHRcdFx0XHRcdFx0Ly8gTW92ZSBjaGlsZHJlbiBhZnRlciBjdXJyZW50IG5vZGVcblx0XHRcdFx0XHRcdHNpYmxpbmcgPSBub2RlLmxhc3RDaGlsZDtcblx0XHRcdFx0XHRcdGRvIHtcblx0XHRcdFx0XHRcdFx0cHJldlNpYmxpbmcgPSBzaWJsaW5nLnByZXY7XG5cdFx0XHRcdFx0XHRcdHBhcmVudC5pbnNlcnQoc2libGluZywgbm9kZSk7XG5cdFx0XHRcdFx0XHRcdHNpYmxpbmcgPSBwcmV2U2libGluZztcblx0XHRcdFx0XHRcdH0gd2hpbGUgKHNpYmxpbmcpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0aWYgKHNldHRpbmdzLnZhbGlkYXRlICYmIHNjaGVtYS5nZXRWYWxpZENsYXNzZXMoKSkge1xuXHRcdFx0c2VsZi5hZGRBdHRyaWJ1dGVGaWx0ZXIoJ2NsYXNzJywgZnVuY3Rpb24obm9kZXMpIHtcblx0XHRcdFx0dmFyIGkgPSBub2Rlcy5sZW5ndGgsIG5vZGUsIGNsYXNzTGlzdCwgY2ksIGNsYXNzTmFtZSwgY2xhc3NWYWx1ZTtcblx0XHRcdFx0dmFyIHZhbGlkQ2xhc3NlcyA9IHNjaGVtYS5nZXRWYWxpZENsYXNzZXMoKSwgdmFsaWRDbGFzc2VzTWFwLCB2YWxpZDtcblxuXHRcdFx0XHR3aGlsZSAoaS0tKSB7XG5cdFx0XHRcdFx0bm9kZSA9IG5vZGVzW2ldO1xuXHRcdFx0XHRcdGNsYXNzTGlzdCA9IG5vZGUuYXR0cignY2xhc3MnKS5zcGxpdCgnICcpO1xuXHRcdFx0XHRcdGNsYXNzVmFsdWUgPSAnJztcblxuXHRcdFx0XHRcdGZvciAoY2kgPSAwOyBjaSA8IGNsYXNzTGlzdC5sZW5ndGg7IGNpKyspIHtcblx0XHRcdFx0XHRcdGNsYXNzTmFtZSA9IGNsYXNzTGlzdFtjaV07XG5cdFx0XHRcdFx0XHR2YWxpZCA9IGZhbHNlO1xuXG5cdFx0XHRcdFx0XHR2YWxpZENsYXNzZXNNYXAgPSB2YWxpZENsYXNzZXNbJyonXTtcblx0XHRcdFx0XHRcdGlmICh2YWxpZENsYXNzZXNNYXAgJiYgdmFsaWRDbGFzc2VzTWFwW2NsYXNzTmFtZV0pIHtcblx0XHRcdFx0XHRcdFx0dmFsaWQgPSB0cnVlO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHR2YWxpZENsYXNzZXNNYXAgPSB2YWxpZENsYXNzZXNbbm9kZS5uYW1lXTtcblx0XHRcdFx0XHRcdGlmICghdmFsaWQgJiYgdmFsaWRDbGFzc2VzTWFwICYmIHZhbGlkQ2xhc3Nlc01hcFtjbGFzc05hbWVdKSB7XG5cdFx0XHRcdFx0XHRcdHZhbGlkID0gdHJ1ZTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0aWYgKHZhbGlkKSB7XG5cdFx0XHRcdFx0XHRcdGlmIChjbGFzc1ZhbHVlKSB7XG5cdFx0XHRcdFx0XHRcdFx0Y2xhc3NWYWx1ZSArPSAnICc7XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRjbGFzc1ZhbHVlICs9IGNsYXNzTmFtZTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoIWNsYXNzVmFsdWUubGVuZ3RoKSB7XG5cdFx0XHRcdFx0XHRjbGFzc1ZhbHVlID0gbnVsbDtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRub2RlLmF0dHIoJ2NsYXNzJywgY2xhc3NWYWx1ZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH1cblx0fTtcbn0pO1xuXG4vLyBJbmNsdWRlZCBmcm9tOiBqcy90aW55bWNlL2NsYXNzZXMvaHRtbC9Xcml0ZXIuanNcblxuLyoqXG4gKiBXcml0ZXIuanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBUaGlzIGNsYXNzIGlzIHVzZWQgdG8gd3JpdGUgSFRNTCB0YWdzIG91dCBpdCBjYW4gYmUgdXNlZCB3aXRoIHRoZSBTZXJpYWxpemVyIG9yIHRoZSBTYXhQYXJzZXIuXG4gKlxuICogQGNsYXNzIHRpbnltY2UuaHRtbC5Xcml0ZXJcbiAqIEBleGFtcGxlXG4gKiB2YXIgd3JpdGVyID0gbmV3IHRpbnltY2UuaHRtbC5Xcml0ZXIoe2luZGVudDogdHJ1ZX0pO1xuICogdmFyIHBhcnNlciA9IG5ldyB0aW55bWNlLmh0bWwuU2F4UGFyc2VyKHdyaXRlcikucGFyc2UoJzxwPjxicj48L3A+Jyk7XG4gKiBjb25zb2xlLmxvZyh3cml0ZXIuZ2V0Q29udGVudCgpKTtcbiAqXG4gKiBAY2xhc3MgdGlueW1jZS5odG1sLldyaXRlclxuICogQHZlcnNpb24gMy40XG4gKi9cbmRlZmluZShcInRpbnltY2UvaHRtbC9Xcml0ZXJcIiwgW1xuXHRcInRpbnltY2UvaHRtbC9FbnRpdGllc1wiLFxuXHRcInRpbnltY2UvdXRpbC9Ub29sc1wiXG5dLCBmdW5jdGlvbihFbnRpdGllcywgVG9vbHMpIHtcblx0dmFyIG1ha2VNYXAgPSBUb29scy5tYWtlTWFwO1xuXG5cdC8qKlxuXHQgKiBDb25zdHJ1Y3RzIGEgbmV3IFdyaXRlciBpbnN0YW5jZS5cblx0ICpcblx0ICogQGNvbnN0cnVjdG9yXG5cdCAqIEBtZXRob2QgV3JpdGVyXG5cdCAqIEBwYXJhbSB7T2JqZWN0fSBzZXR0aW5ncyBOYW1lL3ZhbHVlIHNldHRpbmdzIG9iamVjdC5cblx0ICovXG5cdHJldHVybiBmdW5jdGlvbihzZXR0aW5ncykge1xuXHRcdHZhciBodG1sID0gW10sIGluZGVudCwgaW5kZW50QmVmb3JlLCBpbmRlbnRBZnRlciwgZW5jb2RlLCBodG1sT3V0cHV0O1xuXG5cdFx0c2V0dGluZ3MgPSBzZXR0aW5ncyB8fCB7fTtcblx0XHRpbmRlbnQgPSBzZXR0aW5ncy5pbmRlbnQ7XG5cdFx0aW5kZW50QmVmb3JlID0gbWFrZU1hcChzZXR0aW5ncy5pbmRlbnRfYmVmb3JlIHx8ICcnKTtcblx0XHRpbmRlbnRBZnRlciA9IG1ha2VNYXAoc2V0dGluZ3MuaW5kZW50X2FmdGVyIHx8ICcnKTtcblx0XHRlbmNvZGUgPSBFbnRpdGllcy5nZXRFbmNvZGVGdW5jKHNldHRpbmdzLmVudGl0eV9lbmNvZGluZyB8fCAncmF3Jywgc2V0dGluZ3MuZW50aXRpZXMpO1xuXHRcdGh0bWxPdXRwdXQgPSBzZXR0aW5ncy5lbGVtZW50X2Zvcm1hdCA9PSBcImh0bWxcIjtcblxuXHRcdHJldHVybiB7XG5cdFx0XHQvKipcblx0XHRcdCAqIFdyaXRlcyB0aGUgYSBzdGFydCBlbGVtZW50IHN1Y2ggYXMgPHAgaWQ9XCJhXCI+LlxuXHRcdFx0ICpcblx0XHRcdCAqIEBtZXRob2Qgc3RhcnRcblx0XHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIE5hbWUgb2YgdGhlIGVsZW1lbnQuXG5cdFx0XHQgKiBAcGFyYW0ge0FycmF5fSBhdHRycyBPcHRpb25hbCBhdHRyaWJ1dGUgYXJyYXkgb3IgdW5kZWZpbmVkIGlmIGl0IGhhc24ndCBhbnkuXG5cdFx0XHQgKiBAcGFyYW0ge0Jvb2xlYW59IGVtcHR5IE9wdGlvbmFsIGVtcHR5IHN0YXRlIGlmIHRoZSB0YWcgc2hvdWxkIGVuZCBsaWtlIDxiciAvPi5cblx0XHRcdCAqL1xuXHRcdFx0c3RhcnQ6IGZ1bmN0aW9uKG5hbWUsIGF0dHJzLCBlbXB0eSkge1xuXHRcdFx0XHR2YXIgaSwgbCwgYXR0ciwgdmFsdWU7XG5cblx0XHRcdFx0aWYgKGluZGVudCAmJiBpbmRlbnRCZWZvcmVbbmFtZV0gJiYgaHRtbC5sZW5ndGggPiAwKSB7XG5cdFx0XHRcdFx0dmFsdWUgPSBodG1sW2h0bWwubGVuZ3RoIC0gMV07XG5cblx0XHRcdFx0XHRpZiAodmFsdWUubGVuZ3RoID4gMCAmJiB2YWx1ZSAhPT0gJ1xcbicpIHtcblx0XHRcdFx0XHRcdGh0bWwucHVzaCgnXFxuJyk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0aHRtbC5wdXNoKCc8JywgbmFtZSk7XG5cblx0XHRcdFx0aWYgKGF0dHJzKSB7XG5cdFx0XHRcdFx0Zm9yIChpID0gMCwgbCA9IGF0dHJzLmxlbmd0aDsgaSA8IGw7IGkrKykge1xuXHRcdFx0XHRcdFx0YXR0ciA9IGF0dHJzW2ldO1xuXHRcdFx0XHRcdFx0aHRtbC5wdXNoKCcgJywgYXR0ci5uYW1lLCAnPVwiJywgZW5jb2RlKGF0dHIudmFsdWUsIHRydWUpLCAnXCInKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoIWVtcHR5IHx8IGh0bWxPdXRwdXQpIHtcblx0XHRcdFx0XHRodG1sW2h0bWwubGVuZ3RoXSA9ICc+Jztcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRodG1sW2h0bWwubGVuZ3RoXSA9ICcgLz4nO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKGVtcHR5ICYmIGluZGVudCAmJiBpbmRlbnRBZnRlcltuYW1lXSAmJiBodG1sLmxlbmd0aCA+IDApIHtcblx0XHRcdFx0XHR2YWx1ZSA9IGh0bWxbaHRtbC5sZW5ndGggLSAxXTtcblxuXHRcdFx0XHRcdGlmICh2YWx1ZS5sZW5ndGggPiAwICYmIHZhbHVlICE9PSAnXFxuJykge1xuXHRcdFx0XHRcdFx0aHRtbC5wdXNoKCdcXG4nKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0sXG5cblx0XHRcdC8qKlxuXHRcdFx0ICogV3JpdGVzIHRoZSBhIGVuZCBlbGVtZW50IHN1Y2ggYXMgPC9wPi5cblx0XHRcdCAqXG5cdFx0XHQgKiBAbWV0aG9kIGVuZFxuXHRcdFx0ICogQHBhcmFtIHtTdHJpbmd9IG5hbWUgTmFtZSBvZiB0aGUgZWxlbWVudC5cblx0XHRcdCAqL1xuXHRcdFx0ZW5kOiBmdW5jdGlvbihuYW1lKSB7XG5cdFx0XHRcdHZhciB2YWx1ZTtcblxuXHRcdFx0XHQvKmlmIChpbmRlbnQgJiYgaW5kZW50QmVmb3JlW25hbWVdICYmIGh0bWwubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRcdHZhbHVlID0gaHRtbFtodG1sLmxlbmd0aCAtIDFdO1xuXG5cdFx0XHRcdFx0aWYgKHZhbHVlLmxlbmd0aCA+IDAgJiYgdmFsdWUgIT09ICdcXG4nKVxuXHRcdFx0XHRcdFx0aHRtbC5wdXNoKCdcXG4nKTtcblx0XHRcdFx0fSovXG5cblx0XHRcdFx0aHRtbC5wdXNoKCc8LycsIG5hbWUsICc+Jyk7XG5cblx0XHRcdFx0aWYgKGluZGVudCAmJiBpbmRlbnRBZnRlcltuYW1lXSAmJiBodG1sLmxlbmd0aCA+IDApIHtcblx0XHRcdFx0XHR2YWx1ZSA9IGh0bWxbaHRtbC5sZW5ndGggLSAxXTtcblxuXHRcdFx0XHRcdGlmICh2YWx1ZS5sZW5ndGggPiAwICYmIHZhbHVlICE9PSAnXFxuJykge1xuXHRcdFx0XHRcdFx0aHRtbC5wdXNoKCdcXG4nKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0sXG5cblx0XHRcdC8qKlxuXHRcdFx0ICogV3JpdGVzIGEgdGV4dCBub2RlLlxuXHRcdFx0ICpcblx0XHRcdCAqIEBtZXRob2QgdGV4dFxuXHRcdFx0ICogQHBhcmFtIHtTdHJpbmd9IHRleHQgU3RyaW5nIHRvIHdyaXRlIG91dC5cblx0XHRcdCAqIEBwYXJhbSB7Qm9vbGVhbn0gcmF3IE9wdGlvbmFsIHJhdyBzdGF0ZSBpZiB0cnVlIHRoZSBjb250ZW50cyB3b250IGdldCBlbmNvZGVkLlxuXHRcdFx0ICovXG5cdFx0XHR0ZXh0OiBmdW5jdGlvbih0ZXh0LCByYXcpIHtcblx0XHRcdFx0aWYgKHRleHQubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRcdGh0bWxbaHRtbC5sZW5ndGhdID0gcmF3ID8gdGV4dCA6IGVuY29kZSh0ZXh0KTtcblx0XHRcdFx0fVxuXHRcdFx0fSxcblxuXHRcdFx0LyoqXG5cdFx0XHQgKiBXcml0ZXMgYSBjZGF0YSBub2RlIHN1Y2ggYXMgPCFbQ0RBVEFbZGF0YV1dPi5cblx0XHRcdCAqXG5cdFx0XHQgKiBAbWV0aG9kIGNkYXRhXG5cdFx0XHQgKiBAcGFyYW0ge1N0cmluZ30gdGV4dCBTdHJpbmcgdG8gd3JpdGUgb3V0IGluc2lkZSB0aGUgY2RhdGEuXG5cdFx0XHQgKi9cblx0XHRcdGNkYXRhOiBmdW5jdGlvbih0ZXh0KSB7XG5cdFx0XHRcdGh0bWwucHVzaCgnPCFbQ0RBVEFbJywgdGV4dCwgJ11dPicpO1xuXHRcdFx0fSxcblxuXHRcdFx0LyoqXG5cdFx0XHQgKiBXcml0ZXMgYSBjb21tZW50IG5vZGUgc3VjaCBhcyA8IS0tIENvbW1lbnQgLS0+LlxuXHRcdFx0ICpcblx0XHRcdCAqIEBtZXRob2QgY2RhdGFcblx0XHRcdCAqIEBwYXJhbSB7U3RyaW5nfSB0ZXh0IFN0cmluZyB0byB3cml0ZSBvdXQgaW5zaWRlIHRoZSBjb21tZW50LlxuXHRcdFx0ICovXG5cdFx0XHRjb21tZW50OiBmdW5jdGlvbih0ZXh0KSB7XG5cdFx0XHRcdGh0bWwucHVzaCgnPCEtLScsIHRleHQsICctLT4nKTtcblx0XHRcdH0sXG5cblx0XHRcdC8qKlxuXHRcdFx0ICogV3JpdGVzIGEgUEkgbm9kZSBzdWNoIGFzIDw/eG1sIGF0dHI9XCJ2YWx1ZVwiID8+LlxuXHRcdFx0ICpcblx0XHRcdCAqIEBtZXRob2QgcGlcblx0XHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIE5hbWUgb2YgdGhlIHBpLlxuXHRcdFx0ICogQHBhcmFtIHtTdHJpbmd9IHRleHQgU3RyaW5nIHRvIHdyaXRlIG91dCBpbnNpZGUgdGhlIHBpLlxuXHRcdFx0ICovXG5cdFx0XHRwaTogZnVuY3Rpb24obmFtZSwgdGV4dCkge1xuXHRcdFx0XHRpZiAodGV4dCkge1xuXHRcdFx0XHRcdGh0bWwucHVzaCgnPD8nLCBuYW1lLCAnICcsIGVuY29kZSh0ZXh0KSwgJz8+Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0aHRtbC5wdXNoKCc8PycsIG5hbWUsICc/PicpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKGluZGVudCkge1xuXHRcdFx0XHRcdGh0bWwucHVzaCgnXFxuJyk7XG5cdFx0XHRcdH1cblx0XHRcdH0sXG5cblx0XHRcdC8qKlxuXHRcdFx0ICogV3JpdGVzIGEgZG9jdHlwZSBub2RlIHN1Y2ggYXMgPCFET0NUWVBFIGRhdGE+LlxuXHRcdFx0ICpcblx0XHRcdCAqIEBtZXRob2QgZG9jdHlwZVxuXHRcdFx0ICogQHBhcmFtIHtTdHJpbmd9IHRleHQgU3RyaW5nIHRvIHdyaXRlIG91dCBpbnNpZGUgdGhlIGRvY3R5cGUuXG5cdFx0XHQgKi9cblx0XHRcdGRvY3R5cGU6IGZ1bmN0aW9uKHRleHQpIHtcblx0XHRcdFx0aHRtbC5wdXNoKCc8IURPQ1RZUEUnLCB0ZXh0LCAnPicsIGluZGVudCA/ICdcXG4nIDogJycpO1xuXHRcdFx0fSxcblxuXHRcdFx0LyoqXG5cdFx0XHQgKiBSZXNldHMgdGhlIGludGVybmFsIGJ1ZmZlciBpZiBvbmUgd2FudHMgdG8gcmV1c2UgdGhlIHdyaXRlci5cblx0XHRcdCAqXG5cdFx0XHQgKiBAbWV0aG9kIHJlc2V0XG5cdFx0XHQgKi9cblx0XHRcdHJlc2V0OiBmdW5jdGlvbigpIHtcblx0XHRcdFx0aHRtbC5sZW5ndGggPSAwO1xuXHRcdFx0fSxcblxuXHRcdFx0LyoqXG5cdFx0XHQgKiBSZXR1cm5zIHRoZSBjb250ZW50cyB0aGF0IGdvdCBzZXJpYWxpemVkLlxuXHRcdFx0ICpcblx0XHRcdCAqIEBtZXRob2QgZ2V0Q29udGVudFxuXHRcdFx0ICogQHJldHVybiB7U3RyaW5nfSBIVE1MIGNvbnRlbnRzIHRoYXQgZ290IHdyaXR0ZW4gZG93bi5cblx0XHRcdCAqL1xuXHRcdFx0Z2V0Q29udGVudDogZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHJldHVybiBodG1sLmpvaW4oJycpLnJlcGxhY2UoL1xcbiQvLCAnJyk7XG5cdFx0XHR9XG5cdFx0fTtcblx0fTtcbn0pO1xuXG4vLyBJbmNsdWRlZCBmcm9tOiBqcy90aW55bWNlL2NsYXNzZXMvaHRtbC9TZXJpYWxpemVyLmpzXG5cbi8qKlxuICogU2VyaWFsaXplci5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE1IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKipcbiAqIFRoaXMgY2xhc3MgaXMgdXNlZCB0byBzZXJpYWxpemUgZG93biB0aGUgRE9NIHRyZWUgaW50byBhIHN0cmluZyB1c2luZyBhIFdyaXRlciBpbnN0YW5jZS5cbiAqXG4gKlxuICogQGV4YW1wbGVcbiAqIG5ldyB0aW55bWNlLmh0bWwuU2VyaWFsaXplcigpLnNlcmlhbGl6ZShuZXcgdGlueW1jZS5odG1sLkRvbVBhcnNlcigpLnBhcnNlKCc8cD50ZXh0PC9wPicpKTtcbiAqIEBjbGFzcyB0aW55bWNlLmh0bWwuU2VyaWFsaXplclxuICogQHZlcnNpb24gMy40XG4gKi9cbmRlZmluZShcInRpbnltY2UvaHRtbC9TZXJpYWxpemVyXCIsIFtcblx0XCJ0aW55bWNlL2h0bWwvV3JpdGVyXCIsXG5cdFwidGlueW1jZS9odG1sL1NjaGVtYVwiXG5dLCBmdW5jdGlvbihXcml0ZXIsIFNjaGVtYSkge1xuXHQvKipcblx0ICogQ29uc3RydWN0cyBhIG5ldyBTZXJpYWxpemVyIGluc3RhbmNlLlxuXHQgKlxuXHQgKiBAY29uc3RydWN0b3Jcblx0ICogQG1ldGhvZCBTZXJpYWxpemVyXG5cdCAqIEBwYXJhbSB7T2JqZWN0fSBzZXR0aW5ncyBOYW1lL3ZhbHVlIHNldHRpbmdzIG9iamVjdC5cblx0ICogQHBhcmFtIHt0aW55bWNlLmh0bWwuU2NoZW1hfSBzY2hlbWEgU2NoZW1hIGluc3RhbmNlIHRvIHVzZS5cblx0ICovXG5cdHJldHVybiBmdW5jdGlvbihzZXR0aW5ncywgc2NoZW1hKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLCB3cml0ZXIgPSBuZXcgV3JpdGVyKHNldHRpbmdzKTtcblxuXHRcdHNldHRpbmdzID0gc2V0dGluZ3MgfHwge307XG5cdFx0c2V0dGluZ3MudmFsaWRhdGUgPSBcInZhbGlkYXRlXCIgaW4gc2V0dGluZ3MgPyBzZXR0aW5ncy52YWxpZGF0ZSA6IHRydWU7XG5cblx0XHRzZWxmLnNjaGVtYSA9IHNjaGVtYSA9IHNjaGVtYSB8fCBuZXcgU2NoZW1hKCk7XG5cdFx0c2VsZi53cml0ZXIgPSB3cml0ZXI7XG5cblx0XHQvKipcblx0XHQgKiBTZXJpYWxpemVzIHRoZSBzcGVjaWZpZWQgbm9kZSBpbnRvIGEgc3RyaW5nLlxuXHRcdCAqXG5cdFx0ICogQGV4YW1wbGVcblx0XHQgKiBuZXcgdGlueW1jZS5odG1sLlNlcmlhbGl6ZXIoKS5zZXJpYWxpemUobmV3IHRpbnltY2UuaHRtbC5Eb21QYXJzZXIoKS5wYXJzZSgnPHA+dGV4dDwvcD4nKSk7XG5cdFx0ICogQG1ldGhvZCBzZXJpYWxpemVcblx0XHQgKiBAcGFyYW0ge3RpbnltY2UuaHRtbC5Ob2RlfSBub2RlIE5vZGUgaW5zdGFuY2UgdG8gc2VyaWFsaXplLlxuXHRcdCAqIEByZXR1cm4ge1N0cmluZ30gU3RyaW5nIHdpdGggSFRNTCBiYXNlZCBvbiBET00gdHJlZS5cblx0XHQgKi9cblx0XHRzZWxmLnNlcmlhbGl6ZSA9IGZ1bmN0aW9uKG5vZGUpIHtcblx0XHRcdHZhciBoYW5kbGVycywgdmFsaWRhdGU7XG5cblx0XHRcdHZhbGlkYXRlID0gc2V0dGluZ3MudmFsaWRhdGU7XG5cblx0XHRcdGhhbmRsZXJzID0ge1xuXHRcdFx0XHQvLyAjdGV4dFxuXHRcdFx0XHQzOiBmdW5jdGlvbihub2RlKSB7XG5cdFx0XHRcdFx0d3JpdGVyLnRleHQobm9kZS52YWx1ZSwgbm9kZS5yYXcpO1xuXHRcdFx0XHR9LFxuXG5cdFx0XHRcdC8vICNjb21tZW50XG5cdFx0XHRcdDg6IGZ1bmN0aW9uKG5vZGUpIHtcblx0XHRcdFx0XHR3cml0ZXIuY29tbWVudChub2RlLnZhbHVlKTtcblx0XHRcdFx0fSxcblxuXHRcdFx0XHQvLyBQcm9jZXNzaW5nIGluc3RydWN0aW9uXG5cdFx0XHRcdDc6IGZ1bmN0aW9uKG5vZGUpIHtcblx0XHRcdFx0XHR3cml0ZXIucGkobm9kZS5uYW1lLCBub2RlLnZhbHVlKTtcblx0XHRcdFx0fSxcblxuXHRcdFx0XHQvLyBEb2N0eXBlXG5cdFx0XHRcdDEwOiBmdW5jdGlvbihub2RlKSB7XG5cdFx0XHRcdFx0d3JpdGVyLmRvY3R5cGUobm9kZS52YWx1ZSk7XG5cdFx0XHRcdH0sXG5cblx0XHRcdFx0Ly8gQ0RBVEFcblx0XHRcdFx0NDogZnVuY3Rpb24obm9kZSkge1xuXHRcdFx0XHRcdHdyaXRlci5jZGF0YShub2RlLnZhbHVlKTtcblx0XHRcdFx0fSxcblxuXHRcdFx0XHQvLyBEb2N1bWVudCBmcmFnbWVudFxuXHRcdFx0XHQxMTogZnVuY3Rpb24obm9kZSkge1xuXHRcdFx0XHRcdGlmICgobm9kZSA9IG5vZGUuZmlyc3RDaGlsZCkpIHtcblx0XHRcdFx0XHRcdGRvIHtcblx0XHRcdFx0XHRcdFx0d2Fsayhub2RlKTtcblx0XHRcdFx0XHRcdH0gd2hpbGUgKChub2RlID0gbm9kZS5uZXh0KSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9O1xuXG5cdFx0XHR3cml0ZXIucmVzZXQoKTtcblxuXHRcdFx0ZnVuY3Rpb24gd2Fsayhub2RlKSB7XG5cdFx0XHRcdHZhciBoYW5kbGVyID0gaGFuZGxlcnNbbm9kZS50eXBlXSwgbmFtZSwgaXNFbXB0eSwgYXR0cnMsIGF0dHJOYW1lLCBhdHRyVmFsdWUsIHNvcnRlZEF0dHJzLCBpLCBsLCBlbGVtZW50UnVsZTtcblxuXHRcdFx0XHRpZiAoIWhhbmRsZXIpIHtcblx0XHRcdFx0XHRuYW1lID0gbm9kZS5uYW1lO1xuXHRcdFx0XHRcdGlzRW1wdHkgPSBub2RlLnNob3J0RW5kZWQ7XG5cdFx0XHRcdFx0YXR0cnMgPSBub2RlLmF0dHJpYnV0ZXM7XG5cblx0XHRcdFx0XHQvLyBTb3J0IGF0dHJpYnV0ZXNcblx0XHRcdFx0XHRpZiAodmFsaWRhdGUgJiYgYXR0cnMgJiYgYXR0cnMubGVuZ3RoID4gMSkge1xuXHRcdFx0XHRcdFx0c29ydGVkQXR0cnMgPSBbXTtcblx0XHRcdFx0XHRcdHNvcnRlZEF0dHJzLm1hcCA9IHt9O1xuXG5cdFx0XHRcdFx0XHRlbGVtZW50UnVsZSA9IHNjaGVtYS5nZXRFbGVtZW50UnVsZShub2RlLm5hbWUpO1xuXHRcdFx0XHRcdFx0aWYgKGVsZW1lbnRSdWxlKSB7XG5cdFx0XHRcdFx0XHRcdGZvciAoaSA9IDAsIGwgPSBlbGVtZW50UnVsZS5hdHRyaWJ1dGVzT3JkZXIubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG5cdFx0XHRcdFx0XHRcdFx0YXR0ck5hbWUgPSBlbGVtZW50UnVsZS5hdHRyaWJ1dGVzT3JkZXJbaV07XG5cblx0XHRcdFx0XHRcdFx0XHRpZiAoYXR0ck5hbWUgaW4gYXR0cnMubWFwKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRhdHRyVmFsdWUgPSBhdHRycy5tYXBbYXR0ck5hbWVdO1xuXHRcdFx0XHRcdFx0XHRcdFx0c29ydGVkQXR0cnMubWFwW2F0dHJOYW1lXSA9IGF0dHJWYWx1ZTtcblx0XHRcdFx0XHRcdFx0XHRcdHNvcnRlZEF0dHJzLnB1c2goe25hbWU6IGF0dHJOYW1lLCB2YWx1ZTogYXR0clZhbHVlfSk7XG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0Zm9yIChpID0gMCwgbCA9IGF0dHJzLmxlbmd0aDsgaSA8IGw7IGkrKykge1xuXHRcdFx0XHRcdFx0XHRcdGF0dHJOYW1lID0gYXR0cnNbaV0ubmFtZTtcblxuXHRcdFx0XHRcdFx0XHRcdGlmICghKGF0dHJOYW1lIGluIHNvcnRlZEF0dHJzLm1hcCkpIHtcblx0XHRcdFx0XHRcdFx0XHRcdGF0dHJWYWx1ZSA9IGF0dHJzLm1hcFthdHRyTmFtZV07XG5cdFx0XHRcdFx0XHRcdFx0XHRzb3J0ZWRBdHRycy5tYXBbYXR0ck5hbWVdID0gYXR0clZhbHVlO1xuXHRcdFx0XHRcdFx0XHRcdFx0c29ydGVkQXR0cnMucHVzaCh7bmFtZTogYXR0ck5hbWUsIHZhbHVlOiBhdHRyVmFsdWV9KTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRhdHRycyA9IHNvcnRlZEF0dHJzO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHdyaXRlci5zdGFydChub2RlLm5hbWUsIGF0dHJzLCBpc0VtcHR5KTtcblxuXHRcdFx0XHRcdGlmICghaXNFbXB0eSkge1xuXHRcdFx0XHRcdFx0aWYgKChub2RlID0gbm9kZS5maXJzdENoaWxkKSkge1xuXHRcdFx0XHRcdFx0XHRkbyB7XG5cdFx0XHRcdFx0XHRcdFx0d2Fsayhub2RlKTtcblx0XHRcdFx0XHRcdFx0fSB3aGlsZSAoKG5vZGUgPSBub2RlLm5leHQpKTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0d3JpdGVyLmVuZChuYW1lKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0aGFuZGxlcihub2RlKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHQvLyBTZXJpYWxpemUgZWxlbWVudCBhbmQgdHJlYXQgYWxsIG5vbiBlbGVtZW50cyBhcyBmcmFnbWVudHNcblx0XHRcdGlmIChub2RlLnR5cGUgPT0gMSAmJiAhc2V0dGluZ3MuaW5uZXIpIHtcblx0XHRcdFx0d2Fsayhub2RlKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGhhbmRsZXJzWzExXShub2RlKTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHdyaXRlci5nZXRDb250ZW50KCk7XG5cdFx0fTtcblx0fTtcbn0pO1xuXG4vLyBJbmNsdWRlZCBmcm9tOiBqcy90aW55bWNlL2NsYXNzZXMvZG9tL1NlcmlhbGl6ZXIuanNcblxuLyoqXG4gKiBTZXJpYWxpemVyLmpzXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgTEdQTCBMaWNlbnNlLlxuICogQ29weXJpZ2h0IChjKSAxOTk5LTIwMTUgRXBob3ggQ29ycC4gQWxsIHJpZ2h0cyByZXNlcnZlZFxuICpcbiAqIExpY2Vuc2U6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vbGljZW5zZVxuICogQ29udHJpYnV0aW5nOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2NvbnRyaWJ1dGluZ1xuICovXG5cbi8qKlxuICogVGhpcyBjbGFzcyBpcyB1c2VkIHRvIHNlcmlhbGl6ZSBET00gdHJlZXMgaW50byBhIHN0cmluZy4gQ29uc3VsdCB0aGUgVGlueU1DRSBXaWtpIEFQSSBmb3JcbiAqIG1vcmUgZGV0YWlscyBhbmQgZXhhbXBsZXMgb24gaG93IHRvIHVzZSB0aGlzIGNsYXNzLlxuICpcbiAqIEBjbGFzcyB0aW55bWNlLmRvbS5TZXJpYWxpemVyXG4gKi9cbmRlZmluZShcInRpbnltY2UvZG9tL1NlcmlhbGl6ZXJcIiwgW1xuXHRcInRpbnltY2UvZG9tL0RPTVV0aWxzXCIsXG5cdFwidGlueW1jZS9odG1sL0RvbVBhcnNlclwiLFxuXHRcInRpbnltY2UvaHRtbC9TYXhQYXJzZXJcIixcblx0XCJ0aW55bWNlL2h0bWwvRW50aXRpZXNcIixcblx0XCJ0aW55bWNlL2h0bWwvU2VyaWFsaXplclwiLFxuXHRcInRpbnltY2UvaHRtbC9Ob2RlXCIsXG5cdFwidGlueW1jZS9odG1sL1NjaGVtYVwiLFxuXHRcInRpbnltY2UvRW52XCIsXG5cdFwidGlueW1jZS91dGlsL1Rvb2xzXCIsXG5cdFwidGlueW1jZS90ZXh0L1p3c3BcIlxuXSwgZnVuY3Rpb24oRE9NVXRpbHMsIERvbVBhcnNlciwgU2F4UGFyc2VyLCBFbnRpdGllcywgU2VyaWFsaXplciwgTm9kZSwgU2NoZW1hLCBFbnYsIFRvb2xzLCBad3NwKSB7XG5cdHZhciBlYWNoID0gVG9vbHMuZWFjaCwgdHJpbSA9IFRvb2xzLnRyaW07XG5cdHZhciBET00gPSBET01VdGlscy5ET007XG5cblx0LyoqXG5cdCAqIElFIDExIGhhcyBhIGZhbnRhc3RpYyBidWcgd2hlcmUgaXQgd2lsbCBwcm9kdWNlIHR3byB0cmFpbGluZyBCUiBlbGVtZW50cyB0byBpZnJhbWUgYm9kaWVzIHdoZW5cblx0ICogdGhlIGlmcmFtZSBpcyBoaWRkZW4gYnkgZGlzcGxheTogbm9uZSBvbiBhIHBhcmVudCBjb250YWluZXIuIFRoZSBET00gaXMgYWN0dWFsbHkgb3V0IG9mIHN5bmNcblx0ICogd2l0aCBpbm5lckhUTUwgaW4gdGhpcyBjYXNlLiBJdCdzIGxpa2UgSUUgYWRkcyBzaGFkb3cgRE9NIEJSIGVsZW1lbnRzIHRoYXQgYXBwZWFycyBvbiBpbm5lckhUTUxcblx0ICogYnV0IG5vdCBhcyB0aGUgbGFzdENoaWxkIG9mIHRoZSBib2R5LiBTbyB0aGlzIGZpeCBzaW1wbHkgcmVtb3ZlcyB0aGUgbGFzdCB0d29cblx0ICogQlIgZWxlbWVudHMgYXQgdGhlIGVuZCBvZiB0aGUgZG9jdW1lbnQuXG5cdCAqXG5cdCAqIEV4YW1wbGUgb2Ygd2hhdCBoYXBwZW5zOiA8Ym9keT50ZXh0PC9ib2R5PiBiZWNvbWVzIDxib2R5PnRleHQ8YnI+PGJyPjwvYm9keT5cblx0ICovXG5cdGZ1bmN0aW9uIHRyaW1UcmFpbGluZ0JyKHJvb3ROb2RlKSB7XG5cdFx0dmFyIGJyTm9kZTEsIGJyTm9kZTI7XG5cblx0XHRmdW5jdGlvbiBpc0JyKG5vZGUpIHtcblx0XHRcdHJldHVybiBub2RlICYmIG5vZGUubmFtZSA9PT0gJ2JyJztcblx0XHR9XG5cblx0XHRick5vZGUxID0gcm9vdE5vZGUubGFzdENoaWxkO1xuXHRcdGlmIChpc0JyKGJyTm9kZTEpKSB7XG5cdFx0XHRick5vZGUyID0gYnJOb2RlMS5wcmV2O1xuXG5cdFx0XHRpZiAoaXNCcihick5vZGUyKSkge1xuXHRcdFx0XHRick5vZGUxLnJlbW92ZSgpO1xuXHRcdFx0XHRick5vZGUyLnJlbW92ZSgpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdC8qKlxuXHQgKiBDb25zdHJ1Y3RzIGEgbmV3IERPTSBzZXJpYWxpemVyIGNsYXNzLlxuXHQgKlxuXHQgKiBAY29uc3RydWN0b3Jcblx0ICogQG1ldGhvZCBTZXJpYWxpemVyXG5cdCAqIEBwYXJhbSB7T2JqZWN0fSBzZXR0aW5ncyBTZXJpYWxpemVyIHNldHRpbmdzIG9iamVjdC5cblx0ICogQHBhcmFtIHt0aW55bWNlLkVkaXRvcn0gZWRpdG9yIE9wdGlvbmFsIGVkaXRvciB0byBiaW5kIGV2ZW50cyB0byBhbmQgZ2V0IHNjaGVtYS9kb20gZnJvbS5cblx0ICovXG5cdHJldHVybiBmdW5jdGlvbihzZXR0aW5ncywgZWRpdG9yKSB7XG5cdFx0dmFyIGRvbSwgc2NoZW1hLCBodG1sUGFyc2VyLCB0ZW1wQXR0cnMgPSBbXCJkYXRhLW1jZS1zZWxlY3RlZFwiXTtcblxuXHRcdGlmIChlZGl0b3IpIHtcblx0XHRcdGRvbSA9IGVkaXRvci5kb207XG5cdFx0XHRzY2hlbWEgPSBlZGl0b3Iuc2NoZW1hO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIHRyaW1IdG1sKGh0bWwpIHtcblx0XHRcdHZhciB0cmltQ29udGVudFJlZ0V4cCA9IG5ldyBSZWdFeHAoW1xuXHRcdFx0XHQnPHNwYW5bXj5dK2RhdGEtbWNlLWJvZ3VzW14+XSs+W1xcdTIwMEJcXHVGRUZGXSs8XFxcXC9zcGFuPicsIC8vIFRyaW0gYm9ndXMgc3BhbnMgbGlrZSBjYXJldCBjb250YWluZXJzXG5cdFx0XHRcdCdcXFxccz8oJyArIHRlbXBBdHRycy5qb2luKCd8JykgKyAnKT1cIlteXCJdK1wiJyAvLyBUcmltIHRlbXBvcmF0eSBkYXRhLW1jZSBwcmVmaXhlZCBhdHRyaWJ1dGVzIGxpa2UgZGF0YS1tY2Utc2VsZWN0ZWRcblx0XHRcdF0uam9pbignfCcpLCAnZ2knKTtcblxuXHRcdFx0aHRtbCA9IFp3c3AudHJpbShodG1sLnJlcGxhY2UodHJpbUNvbnRlbnRSZWdFeHAsICcnKSk7XG5cblx0XHRcdHJldHVybiBodG1sO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIHRyaW1Db250ZW50KGh0bWwpIHtcblx0XHRcdHZhciBjb250ZW50ID0gaHRtbDtcblx0XHRcdHZhciBib2d1c0FsbFJlZ0V4cCA9IC88KFxcdyspIFtePl0qZGF0YS1tY2UtYm9ndXM9XCJhbGxcIltePl0qPi9nO1xuXHRcdFx0dmFyIGVuZFRhZ0luZGV4LCBpbmRleCwgbWF0Y2hMZW5ndGgsIG1hdGNoZXMsIHNob3J0RW5kZWRFbGVtZW50cywgc2NoZW1hID0gZWRpdG9yLnNjaGVtYTtcblxuXHRcdFx0Y29udGVudCA9IHRyaW1IdG1sKGNvbnRlbnQpO1xuXHRcdFx0c2hvcnRFbmRlZEVsZW1lbnRzID0gc2NoZW1hLmdldFNob3J0RW5kZWRFbGVtZW50cygpO1xuXG5cdFx0XHQvLyBSZW1vdmUgYWxsIGJvZ3VzIGVsZW1lbnRzIG1hcmtlZCB3aXRoIFwiYWxsXCJcblx0XHRcdHdoaWxlICgobWF0Y2hlcyA9IGJvZ3VzQWxsUmVnRXhwLmV4ZWMoY29udGVudCkpKSB7XG5cdFx0XHRcdGluZGV4ID0gYm9ndXNBbGxSZWdFeHAubGFzdEluZGV4O1xuXHRcdFx0XHRtYXRjaExlbmd0aCA9IG1hdGNoZXNbMF0ubGVuZ3RoO1xuXG5cdFx0XHRcdGlmIChzaG9ydEVuZGVkRWxlbWVudHNbbWF0Y2hlc1sxXV0pIHtcblx0XHRcdFx0XHRlbmRUYWdJbmRleCA9IGluZGV4O1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGVuZFRhZ0luZGV4ID0gU2F4UGFyc2VyLmZpbmRFbmRUYWcoc2NoZW1hLCBjb250ZW50LCBpbmRleCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRjb250ZW50ID0gY29udGVudC5zdWJzdHJpbmcoMCwgaW5kZXggLSBtYXRjaExlbmd0aCkgKyBjb250ZW50LnN1YnN0cmluZyhlbmRUYWdJbmRleCk7XG5cdFx0XHRcdGJvZ3VzQWxsUmVnRXhwLmxhc3RJbmRleCA9IGluZGV4IC0gbWF0Y2hMZW5ndGg7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiB0cmltKGNvbnRlbnQpO1xuXHRcdH1cblxuXHRcdC8qKlxuXHRcdCAqIFJldHVybnMgYSB0cmltbWVkIHZlcnNpb24gb2YgdGhlIGVkaXRvciBjb250ZW50cyB0byBiZSB1c2VkIGZvciB0aGUgdW5kbyBsZXZlbC4gVGhpc1xuXHRcdCAqIHdpbGwgcmVtb3ZlIGFueSBkYXRhLW1jZS1ib2d1cz1cImFsbFwiIG1hcmtlZCBlbGVtZW50cyBzaW5jZSB0aGVzZSBhcmUgdXNlZCBmb3IgVUkgaXQgd2lsbCBhbHNvXG5cdFx0ICogcmVtb3ZlIHRoZSBkYXRhLW1jZS1zZWxlY3RlZCBhdHRyaWJ1dGVzIHVzZWQgZm9yIHNlbGVjdGlvbiBvZiBvYmplY3RzIGFuZCBjYXJldCBjb250YWluZXJzLlxuXHRcdCAqIEl0IHdpbGwga2VlcCBhbGwgZGF0YS1tY2UtYm9ndXM9XCIxXCIgZWxlbWVudHMgc2luY2UgdGhlc2UgY2FuIGJlIHVzZWQgdG8gcGxhY2UgdGhlIGNhcmV0IGV0YyBhbmQgd2lsbFxuXHRcdCAqIGJlIHJlbW92ZWQgYnkgdGhlIHNlcmlhbGl6YXRpb24gbG9naWMgd2hlbiB5b3Ugc2F2ZS5cblx0XHQgKlxuXHRcdCAqIEBwcml2YXRlXG5cdFx0ICogQHJldHVybiB7U3RyaW5nfSBIVE1MIGNvbnRlbnRzIG9mIHRoZSBlZGl0b3IgZXhjbHVkaW5nIHNvbWUgaW50ZXJuYWwgYm9ndXMgZWxlbWVudHMuXG5cdFx0ICovXG5cdFx0ZnVuY3Rpb24gZ2V0VHJpbW1lZENvbnRlbnQoKSB7XG5cdFx0XHRyZXR1cm4gdHJpbUNvbnRlbnQoZWRpdG9yLmdldEJvZHkoKS5pbm5lckhUTUwpO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIGFkZFRlbXBBdHRyKG5hbWUpIHtcblx0XHRcdGlmIChUb29scy5pbkFycmF5KHRlbXBBdHRycywgbmFtZSkgPT09IC0xKSB7XG5cdFx0XHRcdGh0bWxQYXJzZXIuYWRkQXR0cmlidXRlRmlsdGVyKG5hbWUsIGZ1bmN0aW9uKG5vZGVzLCBuYW1lKSB7XG5cdFx0XHRcdFx0dmFyIGkgPSBub2Rlcy5sZW5ndGg7XG5cblx0XHRcdFx0XHR3aGlsZSAoaS0tKSB7XG5cdFx0XHRcdFx0XHRub2Rlc1tpXS5hdHRyKG5hbWUsIG51bGwpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0dGVtcEF0dHJzLnB1c2gobmFtZSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0Ly8gRGVmYXVsdCBET00gYW5kIFNjaGVtYSBpZiB0aGV5IGFyZSB1bmRlZmluZWRcblx0XHRkb20gPSBkb20gfHwgRE9NO1xuXHRcdHNjaGVtYSA9IHNjaGVtYSB8fCBuZXcgU2NoZW1hKHNldHRpbmdzKTtcblx0XHRzZXR0aW5ncy5lbnRpdHlfZW5jb2RpbmcgPSBzZXR0aW5ncy5lbnRpdHlfZW5jb2RpbmcgfHwgJ25hbWVkJztcblx0XHRzZXR0aW5ncy5yZW1vdmVfdHJhaWxpbmdfYnJzID0gXCJyZW1vdmVfdHJhaWxpbmdfYnJzXCIgaW4gc2V0dGluZ3MgPyBzZXR0aW5ncy5yZW1vdmVfdHJhaWxpbmdfYnJzIDogdHJ1ZTtcblxuXHRcdGh0bWxQYXJzZXIgPSBuZXcgRG9tUGFyc2VyKHNldHRpbmdzLCBzY2hlbWEpO1xuXG5cdFx0Ly8gQ29udmVydCB0YWJpbmRleCBiYWNrIHRvIGVsZW1lbnRzIHdoZW4gc2VyaWFsaXppbmcgY29udGVudHNcblx0XHRodG1sUGFyc2VyLmFkZEF0dHJpYnV0ZUZpbHRlcignZGF0YS1tY2UtdGFiaW5kZXgnLCBmdW5jdGlvbihub2RlcywgbmFtZSkge1xuXHRcdFx0dmFyIGkgPSBub2Rlcy5sZW5ndGgsIG5vZGU7XG5cblx0XHRcdHdoaWxlIChpLS0pIHtcblx0XHRcdFx0bm9kZSA9IG5vZGVzW2ldO1xuXHRcdFx0XHRub2RlLmF0dHIoJ3RhYmluZGV4Jywgbm9kZS5hdHRyaWJ1dGVzLm1hcFsnZGF0YS1tY2UtdGFiaW5kZXgnXSk7XG5cdFx0XHRcdG5vZGUuYXR0cihuYW1lLCBudWxsKTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdC8vIENvbnZlcnQgbW92ZSBkYXRhLW1jZS1zcmMsIGRhdGEtbWNlLWhyZWYgYW5kIGRhdGEtbWNlLXN0eWxlIGludG8gbm9kZXMgb3IgcHJvY2VzcyB0aGVtIGlmIG5lZWRlZFxuXHRcdGh0bWxQYXJzZXIuYWRkQXR0cmlidXRlRmlsdGVyKCdzcmMsaHJlZixzdHlsZScsIGZ1bmN0aW9uKG5vZGVzLCBuYW1lKSB7XG5cdFx0XHR2YXIgaSA9IG5vZGVzLmxlbmd0aCwgbm9kZSwgdmFsdWUsIGludGVybmFsTmFtZSA9ICdkYXRhLW1jZS0nICsgbmFtZTtcblx0XHRcdHZhciB1cmxDb252ZXJ0ZXIgPSBzZXR0aW5ncy51cmxfY29udmVydGVyLCB1cmxDb252ZXJ0ZXJTY29wZSA9IHNldHRpbmdzLnVybF9jb252ZXJ0ZXJfc2NvcGUsIHVuZGVmO1xuXG5cdFx0XHR3aGlsZSAoaS0tKSB7XG5cdFx0XHRcdG5vZGUgPSBub2Rlc1tpXTtcblxuXHRcdFx0XHR2YWx1ZSA9IG5vZGUuYXR0cmlidXRlcy5tYXBbaW50ZXJuYWxOYW1lXTtcblx0XHRcdFx0aWYgKHZhbHVlICE9PSB1bmRlZikge1xuXHRcdFx0XHRcdC8vIFNldCBleHRlcm5hbCBuYW1lIHRvIGludGVybmFsIHZhbHVlIGFuZCByZW1vdmUgaW50ZXJuYWxcblx0XHRcdFx0XHRub2RlLmF0dHIobmFtZSwgdmFsdWUubGVuZ3RoID4gMCA/IHZhbHVlIDogbnVsbCk7XG5cdFx0XHRcdFx0bm9kZS5hdHRyKGludGVybmFsTmFtZSwgbnVsbCk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Ly8gTm8gaW50ZXJuYWwgYXR0cmlidXRlIGZvdW5kIHRoZW4gY29udmVydCB0aGUgdmFsdWUgd2UgaGF2ZSBpbiB0aGUgRE9NXG5cdFx0XHRcdFx0dmFsdWUgPSBub2RlLmF0dHJpYnV0ZXMubWFwW25hbWVdO1xuXG5cdFx0XHRcdFx0aWYgKG5hbWUgPT09IFwic3R5bGVcIikge1xuXHRcdFx0XHRcdFx0dmFsdWUgPSBkb20uc2VyaWFsaXplU3R5bGUoZG9tLnBhcnNlU3R5bGUodmFsdWUpLCBub2RlLm5hbWUpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodXJsQ29udmVydGVyKSB7XG5cdFx0XHRcdFx0XHR2YWx1ZSA9IHVybENvbnZlcnRlci5jYWxsKHVybENvbnZlcnRlclNjb3BlLCB2YWx1ZSwgbmFtZSwgbm9kZS5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRub2RlLmF0dHIobmFtZSwgdmFsdWUubGVuZ3RoID4gMCA/IHZhbHVlIDogbnVsbCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdC8vIFJlbW92ZSBpbnRlcm5hbCBjbGFzc2VzIG1jZUl0ZW08Li4+IG9yIG1jZVNlbGVjdGVkXG5cdFx0aHRtbFBhcnNlci5hZGRBdHRyaWJ1dGVGaWx0ZXIoJ2NsYXNzJywgZnVuY3Rpb24obm9kZXMpIHtcblx0XHRcdHZhciBpID0gbm9kZXMubGVuZ3RoLCBub2RlLCB2YWx1ZTtcblxuXHRcdFx0d2hpbGUgKGktLSkge1xuXHRcdFx0XHRub2RlID0gbm9kZXNbaV07XG5cdFx0XHRcdHZhbHVlID0gbm9kZS5hdHRyKCdjbGFzcycpO1xuXG5cdFx0XHRcdGlmICh2YWx1ZSkge1xuXHRcdFx0XHRcdHZhbHVlID0gbm9kZS5hdHRyKCdjbGFzcycpLnJlcGxhY2UoLyg/Ol58XFxzKW1jZS1pdGVtLVxcdysoPyFcXFMpL2csICcnKTtcblx0XHRcdFx0XHRub2RlLmF0dHIoJ2NsYXNzJywgdmFsdWUubGVuZ3RoID4gMCA/IHZhbHVlIDogbnVsbCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdC8vIFJlbW92ZSBib29rbWFyayBlbGVtZW50c1xuXHRcdGh0bWxQYXJzZXIuYWRkQXR0cmlidXRlRmlsdGVyKCdkYXRhLW1jZS10eXBlJywgZnVuY3Rpb24obm9kZXMsIG5hbWUsIGFyZ3MpIHtcblx0XHRcdHZhciBpID0gbm9kZXMubGVuZ3RoLCBub2RlO1xuXG5cdFx0XHR3aGlsZSAoaS0tKSB7XG5cdFx0XHRcdG5vZGUgPSBub2Rlc1tpXTtcblxuXHRcdFx0XHRpZiAobm9kZS5hdHRyaWJ1dGVzLm1hcFsnZGF0YS1tY2UtdHlwZSddID09PSAnYm9va21hcmsnICYmICFhcmdzLmNsZWFudXApIHtcblx0XHRcdFx0XHRub2RlLnJlbW92ZSgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRodG1sUGFyc2VyLmFkZE5vZGVGaWx0ZXIoJ25vc2NyaXB0JywgZnVuY3Rpb24obm9kZXMpIHtcblx0XHRcdHZhciBpID0gbm9kZXMubGVuZ3RoLCBub2RlO1xuXG5cdFx0XHR3aGlsZSAoaS0tKSB7XG5cdFx0XHRcdG5vZGUgPSBub2Rlc1tpXS5maXJzdENoaWxkO1xuXG5cdFx0XHRcdGlmIChub2RlKSB7XG5cdFx0XHRcdFx0bm9kZS52YWx1ZSA9IEVudGl0aWVzLmRlY29kZShub2RlLnZhbHVlKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0Ly8gRm9yY2Ugc2NyaXB0IGludG8gQ0RBVEEgc2VjdGlvbnMgYW5kIHJlbW92ZSB0aGUgbWNlLSBwcmVmaXggYWxzbyBhZGQgY29tbWVudHMgYXJvdW5kIHN0eWxlc1xuXHRcdGh0bWxQYXJzZXIuYWRkTm9kZUZpbHRlcignc2NyaXB0LHN0eWxlJywgZnVuY3Rpb24obm9kZXMsIG5hbWUpIHtcblx0XHRcdHZhciBpID0gbm9kZXMubGVuZ3RoLCBub2RlLCB2YWx1ZSwgdHlwZTtcblxuXHRcdFx0ZnVuY3Rpb24gdHJpbSh2YWx1ZSkge1xuXHRcdFx0XHQvKmpzaGludCBtYXhsZW46MjU1ICovXG5cdFx0XHRcdC8qZXNsaW50IG1heC1sZW46MCAqL1xuXHRcdFx0XHRyZXR1cm4gdmFsdWUucmVwbGFjZSgvKDwhLS1cXFtDREFUQVxcW3xcXF1cXF0tLT4pL2csICdcXG4nKVxuXHRcdFx0XHRcdFx0LnJlcGxhY2UoL15bXFxyXFxuXSp8W1xcclxcbl0qJC9nLCAnJylcblx0XHRcdFx0XHRcdC5yZXBsYWNlKC9eXFxzKigoPCEtLSk/KFxccypcXC9cXC8pP1xccyo8IVxcW0NEQVRBXFxbfCg8IS0tXFxzKik/XFwvXFwqXFxzKjwhXFxbQ0RBVEFcXFtcXHMqXFwqXFwvfChcXC9cXC8pP1xccyo8IS0tfFxcL1xcKlxccyo8IS0tXFxzKlxcKlxcLylcXHMqW1xcclxcbl0qL2dpLCAnJylcblx0XHRcdFx0XHRcdC5yZXBsYWNlKC9cXHMqKFxcL1xcKlxccypcXF1cXF0+XFxzKlxcKlxcLygtLT4pP3xcXHMqXFwvXFwvXFxzKlxcXVxcXT4oLS0+KT98XFwvXFwvXFxzKigtLT4pP3xcXF1cXF0+fFxcL1xcKlxccyotLT5cXHMqXFwqXFwvfFxccyotLT5cXHMqKVxccyokL2csICcnKTtcblx0XHRcdH1cblxuXHRcdFx0d2hpbGUgKGktLSkge1xuXHRcdFx0XHRub2RlID0gbm9kZXNbaV07XG5cdFx0XHRcdHZhbHVlID0gbm9kZS5maXJzdENoaWxkID8gbm9kZS5maXJzdENoaWxkLnZhbHVlIDogJyc7XG5cblx0XHRcdFx0aWYgKG5hbWUgPT09IFwic2NyaXB0XCIpIHtcblx0XHRcdFx0XHQvLyBSZW1vdmUgbWNlLSBwcmVmaXggZnJvbSBzY3JpcHQgZWxlbWVudHMgYW5kIHJlbW92ZSBkZWZhdWx0IHR5cGUgc2luY2UgdGhlIHVzZXIgc3BlY2lmaWVkXG5cdFx0XHRcdFx0Ly8gYSBzY3JpcHQgZWxlbWVudCB3aXRob3V0IHR5cGUgYXR0cmlidXRlXG5cdFx0XHRcdFx0dHlwZSA9IG5vZGUuYXR0cigndHlwZScpO1xuXHRcdFx0XHRcdGlmICh0eXBlKSB7XG5cdFx0XHRcdFx0XHRub2RlLmF0dHIoJ3R5cGUnLCB0eXBlID09ICdtY2Utbm8vdHlwZScgPyBudWxsIDogdHlwZS5yZXBsYWNlKC9ebWNlXFwtLywgJycpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodmFsdWUubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRcdFx0bm9kZS5maXJzdENoaWxkLnZhbHVlID0gJy8vIDwhW0NEQVRBW1xcbicgKyB0cmltKHZhbHVlKSArICdcXG4vLyBdXT4nO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRpZiAodmFsdWUubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRcdFx0bm9kZS5maXJzdENoaWxkLnZhbHVlID0gJzwhLS1cXG4nICsgdHJpbSh2YWx1ZSkgKyAnXFxuLS0+Jztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdC8vIENvbnZlcnQgY29tbWVudHMgdG8gY2RhdGEgYW5kIGhhbmRsZSBwcm90ZWN0ZWQgY29tbWVudHNcblx0XHRodG1sUGFyc2VyLmFkZE5vZGVGaWx0ZXIoJyNjb21tZW50JywgZnVuY3Rpb24obm9kZXMpIHtcblx0XHRcdHZhciBpID0gbm9kZXMubGVuZ3RoLCBub2RlO1xuXG5cdFx0XHR3aGlsZSAoaS0tKSB7XG5cdFx0XHRcdG5vZGUgPSBub2Rlc1tpXTtcblxuXHRcdFx0XHRpZiAobm9kZS52YWx1ZS5pbmRleE9mKCdbQ0RBVEFbJykgPT09IDApIHtcblx0XHRcdFx0XHRub2RlLm5hbWUgPSAnI2NkYXRhJztcblx0XHRcdFx0XHRub2RlLnR5cGUgPSA0O1xuXHRcdFx0XHRcdG5vZGUudmFsdWUgPSBub2RlLnZhbHVlLnJlcGxhY2UoL15cXFtDREFUQVxcW3xcXF1cXF0kL2csICcnKTtcblx0XHRcdFx0fSBlbHNlIGlmIChub2RlLnZhbHVlLmluZGV4T2YoJ21jZTpwcm90ZWN0ZWQgJykgPT09IDApIHtcblx0XHRcdFx0XHRub2RlLm5hbWUgPSBcIiN0ZXh0XCI7XG5cdFx0XHRcdFx0bm9kZS50eXBlID0gMztcblx0XHRcdFx0XHRub2RlLnJhdyA9IHRydWU7XG5cdFx0XHRcdFx0bm9kZS52YWx1ZSA9IHVuZXNjYXBlKG5vZGUudmFsdWUpLnN1YnN0cigxNCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGh0bWxQYXJzZXIuYWRkTm9kZUZpbHRlcigneG1sOm5hbWVzcGFjZSxpbnB1dCcsIGZ1bmN0aW9uKG5vZGVzLCBuYW1lKSB7XG5cdFx0XHR2YXIgaSA9IG5vZGVzLmxlbmd0aCwgbm9kZTtcblxuXHRcdFx0d2hpbGUgKGktLSkge1xuXHRcdFx0XHRub2RlID0gbm9kZXNbaV07XG5cdFx0XHRcdGlmIChub2RlLnR5cGUgPT09IDcpIHtcblx0XHRcdFx0XHRub2RlLnJlbW92ZSgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKG5vZGUudHlwZSA9PT0gMSkge1xuXHRcdFx0XHRcdGlmIChuYW1lID09PSBcImlucHV0XCIgJiYgIShcInR5cGVcIiBpbiBub2RlLmF0dHJpYnV0ZXMubWFwKSkge1xuXHRcdFx0XHRcdFx0bm9kZS5hdHRyKCd0eXBlJywgJ3RleHQnKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdC8vIEZpeCBsaXN0IGVsZW1lbnRzLCBUT0RPOiBSZXBsYWNlIHRoaXMgbGF0ZXJcblx0XHRpZiAoc2V0dGluZ3MuZml4X2xpc3RfZWxlbWVudHMpIHtcblx0XHRcdGh0bWxQYXJzZXIuYWRkTm9kZUZpbHRlcigndWwsb2wnLCBmdW5jdGlvbihub2Rlcykge1xuXHRcdFx0XHR2YXIgaSA9IG5vZGVzLmxlbmd0aCwgbm9kZSwgcGFyZW50Tm9kZTtcblxuXHRcdFx0XHR3aGlsZSAoaS0tKSB7XG5cdFx0XHRcdFx0bm9kZSA9IG5vZGVzW2ldO1xuXHRcdFx0XHRcdHBhcmVudE5vZGUgPSBub2RlLnBhcmVudDtcblxuXHRcdFx0XHRcdGlmIChwYXJlbnROb2RlLm5hbWUgPT09ICd1bCcgfHwgcGFyZW50Tm9kZS5uYW1lID09PSAnb2wnKSB7XG5cdFx0XHRcdFx0XHRpZiAobm9kZS5wcmV2ICYmIG5vZGUucHJldi5uYW1lID09PSAnbGknKSB7XG5cdFx0XHRcdFx0XHRcdG5vZGUucHJldi5hcHBlbmQobm9kZSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHQvLyBSZW1vdmUgaW50ZXJuYWwgZGF0YSBhdHRyaWJ1dGVzXG5cdFx0aHRtbFBhcnNlci5hZGRBdHRyaWJ1dGVGaWx0ZXIoXG5cdFx0XHQnZGF0YS1tY2Utc3JjLGRhdGEtbWNlLWhyZWYsZGF0YS1tY2Utc3R5bGUsJyArXG5cdFx0XHQnZGF0YS1tY2Utc2VsZWN0ZWQsZGF0YS1tY2UtZXhwYW5kbywnICtcblx0XHRcdCdkYXRhLW1jZS10eXBlLGRhdGEtbWNlLXJlc2l6ZScsXG5cblx0XHRcdGZ1bmN0aW9uKG5vZGVzLCBuYW1lKSB7XG5cdFx0XHRcdHZhciBpID0gbm9kZXMubGVuZ3RoO1xuXG5cdFx0XHRcdHdoaWxlIChpLS0pIHtcblx0XHRcdFx0XHRub2Rlc1tpXS5hdHRyKG5hbWUsIG51bGwpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KTtcblxuXHRcdC8vIFJldHVybiBwdWJsaWMgbWV0aG9kc1xuXHRcdHJldHVybiB7XG5cdFx0XHQvKipcblx0XHRcdCAqIFNjaGVtYSBpbnN0YW5jZSB0aGF0IHdhcyB1c2VkIHRvIHdoZW4gdGhlIFNlcmlhbGl6ZXIgd2FzIGNvbnN0cnVjdGVkLlxuXHRcdFx0ICpcblx0XHRcdCAqIEBmaWVsZCB7dGlueW1jZS5odG1sLlNjaGVtYX0gc2NoZW1hXG5cdFx0XHQgKi9cblx0XHRcdHNjaGVtYTogc2NoZW1hLFxuXG5cdFx0XHQvKipcblx0XHRcdCAqIEFkZHMgYSBub2RlIGZpbHRlciBmdW5jdGlvbiB0byB0aGUgcGFyc2VyIHVzZWQgYnkgdGhlIHNlcmlhbGl6ZXIsIHRoZSBwYXJzZXIgd2lsbCBjb2xsZWN0IHRoZSBzcGVjaWZpZWQgbm9kZXMgYnkgbmFtZVxuXHRcdFx0ICogYW5kIHRoZW4gZXhlY3V0ZSB0aGUgY2FsbGJhY2sgb25lcyBpdCBoYXMgZmluaXNoZWQgcGFyc2luZyB0aGUgZG9jdW1lbnQuXG5cdFx0XHQgKlxuXHRcdFx0ICogQGV4YW1wbGVcblx0XHRcdCAqIHBhcnNlci5hZGROb2RlRmlsdGVyKCdwLGgxJywgZnVuY3Rpb24obm9kZXMsIG5hbWUpIHtcblx0XHRcdCAqXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgbm9kZXMubGVuZ3RoOyBpKyspIHtcblx0XHRcdCAqXHRcdFx0Y29uc29sZS5sb2cobm9kZXNbaV0ubmFtZSk7XG5cdFx0XHQgKlx0XHR9XG5cdFx0XHQgKiB9KTtcblx0XHRcdCAqIEBtZXRob2QgYWRkTm9kZUZpbHRlclxuXHRcdFx0ICogQG1ldGhvZCB7U3RyaW5nfSBuYW1lIENvbW1hIHNlcGFyYXRlZCBsaXN0IG9mIG5vZGVzIHRvIGNvbGxlY3QuXG5cdFx0XHQgKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBleGVjdXRlIG9uY2UgaXQgaGFzIGNvbGxlY3RlZCBub2Rlcy5cblx0XHRcdCAqL1xuXHRcdFx0YWRkTm9kZUZpbHRlcjogaHRtbFBhcnNlci5hZGROb2RlRmlsdGVyLFxuXG5cdFx0XHQvKipcblx0XHRcdCAqIEFkZHMgYSBhdHRyaWJ1dGUgZmlsdGVyIGZ1bmN0aW9uIHRvIHRoZSBwYXJzZXIgdXNlZCBieSB0aGUgc2VyaWFsaXplciwgdGhlIHBhcnNlciB3aWxsXG5cdFx0XHQgKiBjb2xsZWN0IG5vZGVzIHRoYXQgaGFzIHRoZSBzcGVjaWZpZWQgYXR0cmlidXRlc1xuXHRcdFx0ICogYW5kIHRoZW4gZXhlY3V0ZSB0aGUgY2FsbGJhY2sgb25lcyBpdCBoYXMgZmluaXNoZWQgcGFyc2luZyB0aGUgZG9jdW1lbnQuXG5cdFx0XHQgKlxuXHRcdFx0ICogQGV4YW1wbGVcblx0XHRcdCAqIHBhcnNlci5hZGRBdHRyaWJ1dGVGaWx0ZXIoJ3NyYyxocmVmJywgZnVuY3Rpb24obm9kZXMsIG5hbWUpIHtcblx0XHRcdCAqXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgbm9kZXMubGVuZ3RoOyBpKyspIHtcblx0XHRcdCAqXHRcdFx0Y29uc29sZS5sb2cobm9kZXNbaV0ubmFtZSk7XG5cdFx0XHQgKlx0XHR9XG5cdFx0XHQgKiB9KTtcblx0XHRcdCAqIEBtZXRob2QgYWRkQXR0cmlidXRlRmlsdGVyXG5cdFx0XHQgKiBAbWV0aG9kIHtTdHJpbmd9IG5hbWUgQ29tbWEgc2VwYXJhdGVkIGxpc3Qgb2Ygbm9kZXMgdG8gY29sbGVjdC5cblx0XHRcdCAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGV4ZWN1dGUgb25jZSBpdCBoYXMgY29sbGVjdGVkIG5vZGVzLlxuXHRcdFx0ICovXG5cdFx0XHRhZGRBdHRyaWJ1dGVGaWx0ZXI6IGh0bWxQYXJzZXIuYWRkQXR0cmlidXRlRmlsdGVyLFxuXG5cdFx0XHQvKipcblx0XHRcdCAqIFNlcmlhbGl6ZXMgdGhlIHNwZWNpZmllZCBicm93c2VyIERPTSBub2RlIGludG8gYSBIVE1MIHN0cmluZy5cblx0XHRcdCAqXG5cdFx0XHQgKiBAbWV0aG9kIHNlcmlhbGl6ZVxuXHRcdFx0ICogQHBhcmFtIHtET01Ob2RlfSBub2RlIERPTSBub2RlIHRvIHNlcmlhbGl6ZS5cblx0XHRcdCAqIEBwYXJhbSB7T2JqZWN0fSBhcmdzIEFyZ3VtZW50cyBvcHRpb24gdGhhdCBnZXRzIHBhc3NlZCB0byBldmVudCBoYW5kbGVycy5cblx0XHRcdCAqL1xuXHRcdFx0c2VyaWFsaXplOiBmdW5jdGlvbihub2RlLCBhcmdzKSB7XG5cdFx0XHRcdHZhciBzZWxmID0gdGhpcywgaW1wbCwgZG9jLCBvbGREb2MsIGh0bWxTZXJpYWxpemVyLCBjb250ZW50LCByb290Tm9kZTtcblxuXHRcdFx0XHQvLyBFeHBsb3JlciB3b24ndCBjbG9uZSBjb250ZW50cyBvZiBzY3JpcHQgYW5kIHN0eWxlIGFuZCB0aGVcblx0XHRcdFx0Ly8gc2VsZWN0ZWQgaW5kZXggb2Ygc2VsZWN0IGVsZW1lbnRzIGFyZSBjbGVhcmVkIG9uIGEgY2xvbmUgb3BlcmF0aW9uLlxuXHRcdFx0XHRpZiAoRW52LmllICYmIGRvbS5zZWxlY3QoJ3NjcmlwdCxzdHlsZSxzZWxlY3QsbWFwJykubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRcdGNvbnRlbnQgPSBub2RlLmlubmVySFRNTDtcblx0XHRcdFx0XHRub2RlID0gbm9kZS5jbG9uZU5vZGUoZmFsc2UpO1xuXHRcdFx0XHRcdGRvbS5zZXRIVE1MKG5vZGUsIGNvbnRlbnQpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG5vZGUgPSBub2RlLmNsb25lTm9kZSh0cnVlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIE5vZGVzIG5lZWRzIHRvIGJlIGF0dGFjaGVkIHRvIHNvbWV0aGluZyBpbiBXZWJLaXQvT3BlcmFcblx0XHRcdFx0Ly8gVGhpcyBmaXggd2lsbCBtYWtlIERPTSByYW5nZXMgYW5kIG1ha2UgU2l6emxlIGhhcHB5IVxuXHRcdFx0XHRpbXBsID0gZG9jdW1lbnQuaW1wbGVtZW50YXRpb247XG5cdFx0XHRcdGlmIChpbXBsLmNyZWF0ZUhUTUxEb2N1bWVudCkge1xuXHRcdFx0XHRcdC8vIENyZWF0ZSBhbiBlbXB0eSBIVE1MIGRvY3VtZW50XG5cdFx0XHRcdFx0ZG9jID0gaW1wbC5jcmVhdGVIVE1MRG9jdW1lbnQoXCJcIik7XG5cblx0XHRcdFx0XHQvLyBBZGQgdGhlIGVsZW1lbnQgb3IgaXQncyBjaGlsZHJlbiBpZiBpdCdzIGEgYm9keSBlbGVtZW50IHRvIHRoZSBuZXcgZG9jdW1lbnRcblx0XHRcdFx0XHRlYWNoKG5vZGUubm9kZU5hbWUgPT0gJ0JPRFknID8gbm9kZS5jaGlsZE5vZGVzIDogW25vZGVdLCBmdW5jdGlvbihub2RlKSB7XG5cdFx0XHRcdFx0XHRkb2MuYm9keS5hcHBlbmRDaGlsZChkb2MuaW1wb3J0Tm9kZShub2RlLCB0cnVlKSk7XG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHQvLyBHcmFiIGZpcnN0IGNoaWxkIG9yIGJvZHkgZWxlbWVudCBmb3Igc2VyaWFsaXphdGlvblxuXHRcdFx0XHRcdGlmIChub2RlLm5vZGVOYW1lICE9ICdCT0RZJykge1xuXHRcdFx0XHRcdFx0bm9kZSA9IGRvYy5ib2R5LmZpcnN0Q2hpbGQ7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdG5vZGUgPSBkb2MuYm9keTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHQvLyBzZXQgdGhlIG5ldyBkb2N1bWVudCBpbiBET01VdGlscyBzbyBjcmVhdGVFbGVtZW50IGV0YyB3b3Jrc1xuXHRcdFx0XHRcdG9sZERvYyA9IGRvbS5kb2M7XG5cdFx0XHRcdFx0ZG9tLmRvYyA9IGRvYztcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGFyZ3MgPSBhcmdzIHx8IHt9O1xuXHRcdFx0XHRhcmdzLmZvcm1hdCA9IGFyZ3MuZm9ybWF0IHx8ICdodG1sJztcblxuXHRcdFx0XHQvLyBEb24ndCB3cmFwIGNvbnRlbnQgaWYgd2Ugd2FudCBzZWxlY3RlZCBodG1sXG5cdFx0XHRcdGlmIChhcmdzLnNlbGVjdGlvbikge1xuXHRcdFx0XHRcdGFyZ3MuZm9yY2VkX3Jvb3RfYmxvY2sgPSAnJztcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIFByZSBwcm9jZXNzXG5cdFx0XHRcdGlmICghYXJncy5ub19ldmVudHMpIHtcblx0XHRcdFx0XHRhcmdzLm5vZGUgPSBub2RlO1xuXHRcdFx0XHRcdHNlbGYub25QcmVQcm9jZXNzKGFyZ3MpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gUGFyc2UgSFRNTFxuXHRcdFx0XHRyb290Tm9kZSA9IGh0bWxQYXJzZXIucGFyc2UodHJpbShhcmdzLmdldElubmVyID8gbm9kZS5pbm5lckhUTUwgOiBkb20uZ2V0T3V0ZXJIVE1MKG5vZGUpKSwgYXJncyk7XG5cdFx0XHRcdHRyaW1UcmFpbGluZ0JyKHJvb3ROb2RlKTtcblxuXHRcdFx0XHQvLyBTZXJpYWxpemUgSFRNTFxuXHRcdFx0XHRodG1sU2VyaWFsaXplciA9IG5ldyBTZXJpYWxpemVyKHNldHRpbmdzLCBzY2hlbWEpO1xuXHRcdFx0XHRhcmdzLmNvbnRlbnQgPSBodG1sU2VyaWFsaXplci5zZXJpYWxpemUocm9vdE5vZGUpO1xuXG5cdFx0XHRcdC8vIFJlcGxhY2UgYWxsIEJPTSBjaGFyYWN0ZXJzIGZvciBub3cgdW50aWwgd2UgY2FuIGZpbmQgYSBiZXR0ZXIgc29sdXRpb25cblx0XHRcdFx0aWYgKCFhcmdzLmNsZWFudXApIHtcblx0XHRcdFx0XHRhcmdzLmNvbnRlbnQgPSBad3NwLnRyaW0oYXJncy5jb250ZW50KTtcblx0XHRcdFx0XHRhcmdzLmNvbnRlbnQgPSBhcmdzLmNvbnRlbnQucmVwbGFjZSgvXFx1RkVGRi9nLCAnJyk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBQb3N0IHByb2Nlc3Ncblx0XHRcdFx0aWYgKCFhcmdzLm5vX2V2ZW50cykge1xuXHRcdFx0XHRcdHNlbGYub25Qb3N0UHJvY2VzcyhhcmdzKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIFJlc3RvcmUgdGhlIG9sZCBkb2N1bWVudCBpZiBpdCB3YXMgY2hhbmdlZFxuXHRcdFx0XHRpZiAob2xkRG9jKSB7XG5cdFx0XHRcdFx0ZG9tLmRvYyA9IG9sZERvYztcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGFyZ3Mubm9kZSA9IG51bGw7XG5cblx0XHRcdFx0cmV0dXJuIGFyZ3MuY29udGVudDtcblx0XHRcdH0sXG5cblx0XHRcdC8qKlxuXHRcdFx0ICogQWRkcyB2YWxpZCBlbGVtZW50cyBydWxlcyB0byB0aGUgc2VyaWFsaXplcnMgc2NoZW1hIGluc3RhbmNlIHRoaXMgZW5hYmxlcyB5b3UgdG8gc3BlY2lmeSB0aGluZ3Ncblx0XHRcdCAqIGxpa2Ugd2hhdCBlbGVtZW50cyBzaG91bGQgYmUgb3V0cHV0dGVkIGFuZCB3aGF0IGF0dHJpYnV0ZXMgc3BlY2lmaWMgZWxlbWVudHMgbWlnaHQgaGF2ZS5cblx0XHRcdCAqIENvbnN1bHQgdGhlIFdpa2kgZm9yIG1vcmUgZGV0YWlscyBvbiB0aGlzIGZvcm1hdC5cblx0XHRcdCAqXG5cdFx0XHQgKiBAbWV0aG9kIGFkZFJ1bGVzXG5cdFx0XHQgKiBAcGFyYW0ge1N0cmluZ30gcnVsZXMgVmFsaWQgZWxlbWVudHMgcnVsZXMgc3RyaW5nIHRvIGFkZCB0byBzY2hlbWEuXG5cdFx0XHQgKi9cblx0XHRcdGFkZFJ1bGVzOiBmdW5jdGlvbihydWxlcykge1xuXHRcdFx0XHRzY2hlbWEuYWRkVmFsaWRFbGVtZW50cyhydWxlcyk7XG5cdFx0XHR9LFxuXG5cdFx0XHQvKipcblx0XHRcdCAqIFNldHMgdGhlIHZhbGlkIGVsZW1lbnRzIHJ1bGVzIHRvIHRoZSBzZXJpYWxpemVycyBzY2hlbWEgaW5zdGFuY2UgdGhpcyBlbmFibGVzIHlvdSB0byBzcGVjaWZ5IHRoaW5nc1xuXHRcdFx0ICogbGlrZSB3aGF0IGVsZW1lbnRzIHNob3VsZCBiZSBvdXRwdXR0ZWQgYW5kIHdoYXQgYXR0cmlidXRlcyBzcGVjaWZpYyBlbGVtZW50cyBtaWdodCBoYXZlLlxuXHRcdFx0ICogQ29uc3VsdCB0aGUgV2lraSBmb3IgbW9yZSBkZXRhaWxzIG9uIHRoaXMgZm9ybWF0LlxuXHRcdFx0ICpcblx0XHRcdCAqIEBtZXRob2Qgc2V0UnVsZXNcblx0XHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBydWxlcyBWYWxpZCBlbGVtZW50cyBydWxlcyBzdHJpbmcuXG5cdFx0XHQgKi9cblx0XHRcdHNldFJ1bGVzOiBmdW5jdGlvbihydWxlcykge1xuXHRcdFx0XHRzY2hlbWEuc2V0VmFsaWRFbGVtZW50cyhydWxlcyk7XG5cdFx0XHR9LFxuXG5cdFx0XHRvblByZVByb2Nlc3M6IGZ1bmN0aW9uKGFyZ3MpIHtcblx0XHRcdFx0aWYgKGVkaXRvcikge1xuXHRcdFx0XHRcdGVkaXRvci5maXJlKCdQcmVQcm9jZXNzJywgYXJncyk7XG5cdFx0XHRcdH1cblx0XHRcdH0sXG5cblx0XHRcdG9uUG9zdFByb2Nlc3M6IGZ1bmN0aW9uKGFyZ3MpIHtcblx0XHRcdFx0aWYgKGVkaXRvcikge1xuXHRcdFx0XHRcdGVkaXRvci5maXJlKCdQb3N0UHJvY2VzcycsIGFyZ3MpO1xuXHRcdFx0XHR9XG5cdFx0XHR9LFxuXG5cdFx0XHQvKipcblx0XHRcdCAqIEFkZHMgYSB0ZW1wb3JhcnkgaW50ZXJuYWwgYXR0cmlidXRlIHRoZXNlIGF0dHJpYnV0ZXMgd2lsbCBnZXQgcmVtb3ZlZCBvbiB1bmRvIGFuZFxuXHRcdFx0ICogd2hlbiBnZXR0aW5nIGNvbnRlbnRzIG91dCBvZiB0aGUgZWRpdG9yLlxuXHRcdFx0ICpcblx0XHRcdCAqIEBtZXRob2QgYWRkVGVtcEF0dHJcblx0XHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIHN0cmluZ1xuXHRcdFx0ICovXG5cdFx0XHRhZGRUZW1wQXR0cjogYWRkVGVtcEF0dHIsXG5cblx0XHRcdC8vIEludGVybmFsXG5cdFx0XHR0cmltSHRtbDogdHJpbUh0bWwsXG5cdFx0XHRnZXRUcmltbWVkQ29udGVudDogZ2V0VHJpbW1lZENvbnRlbnQsXG5cdFx0XHR0cmltQ29udGVudDogdHJpbUNvbnRlbnRcblx0XHR9O1xuXHR9O1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy9kb20vVHJpZGVudFNlbGVjdGlvbi5qc1xuXG4vKipcbiAqIFRyaWRlbnRTZWxlY3Rpb24uanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBTZWxlY3Rpb24gY2xhc3MgZm9yIG9sZCBleHBsb3JlciB2ZXJzaW9ucy4gVGhpcyBvbmUgZmFrZXMgdGhlXG4gKiBuYXRpdmUgc2VsZWN0aW9uIG9iamVjdCBhdmFpbGFibGUgb24gbW9kZXJuIGJyb3dzZXJzLlxuICpcbiAqIEBwcml2YXRlXG4gKiBAY2xhc3MgdGlueW1jZS5kb20uVHJpZGVudFNlbGVjdGlvblxuICovXG5kZWZpbmUoXCJ0aW55bWNlL2RvbS9UcmlkZW50U2VsZWN0aW9uXCIsIFtdLCBmdW5jdGlvbigpIHtcblx0ZnVuY3Rpb24gU2VsZWN0aW9uKHNlbGVjdGlvbikge1xuXHRcdHZhciBzZWxmID0gdGhpcywgZG9tID0gc2VsZWN0aW9uLmRvbSwgRkFMU0UgPSBmYWxzZTtcblxuXHRcdGZ1bmN0aW9uIGdldFBvc2l0aW9uKHJuZywgc3RhcnQpIHtcblx0XHRcdHZhciBjaGVja1JuZywgc3RhcnRJbmRleCA9IDAsIGVuZEluZGV4LCBpbnNpZGUsXG5cdFx0XHRcdGNoaWxkcmVuLCBjaGlsZCwgb2Zmc2V0LCBpbmRleCwgcG9zaXRpb24gPSAtMSwgcGFyZW50O1xuXG5cdFx0XHQvLyBTZXR1cCB0ZXN0IHJhbmdlLCBjb2xsYXBzZSBpdCBhbmQgZ2V0IHRoZSBwYXJlbnRcblx0XHRcdGNoZWNrUm5nID0gcm5nLmR1cGxpY2F0ZSgpO1xuXHRcdFx0Y2hlY2tSbmcuY29sbGFwc2Uoc3RhcnQpO1xuXHRcdFx0cGFyZW50ID0gY2hlY2tSbmcucGFyZW50RWxlbWVudCgpO1xuXG5cdFx0XHQvLyBDaGVjayBpZiB0aGUgc2VsZWN0aW9uIGlzIHdpdGhpbiB0aGUgcmlnaHQgZG9jdW1lbnRcblx0XHRcdGlmIChwYXJlbnQub3duZXJEb2N1bWVudCAhPT0gc2VsZWN0aW9uLmRvbS5kb2MpIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBJRSB3aWxsIHJlcG9ydCBub24gZWRpdGFibGUgZWxlbWVudHMgYXMgaXQncyBwYXJlbnQgc28gbG9vayBmb3IgYW4gZWRpdGFibGUgb25lXG5cdFx0XHR3aGlsZSAocGFyZW50LmNvbnRlbnRFZGl0YWJsZSA9PT0gXCJmYWxzZVwiKSB7XG5cdFx0XHRcdHBhcmVudCA9IHBhcmVudC5wYXJlbnROb2RlO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBJZiBwYXJlbnQgZG9lc24ndCBoYXZlIGFueSBjaGlsZHJlbiB0aGVuIHJldHVybiB0aGF0IHdlIGFyZSBpbnNpZGUgdGhlIGVsZW1lbnRcblx0XHRcdGlmICghcGFyZW50Lmhhc0NoaWxkTm9kZXMoKSkge1xuXHRcdFx0XHRyZXR1cm4ge25vZGU6IHBhcmVudCwgaW5zaWRlOiAxfTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gU2V0dXAgbm9kZSBsaXN0IGFuZCBlbmRJbmRleFxuXHRcdFx0Y2hpbGRyZW4gPSBwYXJlbnQuY2hpbGRyZW47XG5cdFx0XHRlbmRJbmRleCA9IGNoaWxkcmVuLmxlbmd0aCAtIDE7XG5cblx0XHRcdC8vIFBlcmZvcm0gYSBiaW5hcnkgc2VhcmNoIGZvciB0aGUgcG9zaXRpb25cblx0XHRcdHdoaWxlIChzdGFydEluZGV4IDw9IGVuZEluZGV4KSB7XG5cdFx0XHRcdGluZGV4ID0gTWF0aC5mbG9vcigoc3RhcnRJbmRleCArIGVuZEluZGV4KSAvIDIpO1xuXG5cdFx0XHRcdC8vIE1vdmUgc2VsZWN0aW9uIHRvIG5vZGUgYW5kIGNvbXBhcmUgdGhlIHJhbmdlc1xuXHRcdFx0XHRjaGlsZCA9IGNoaWxkcmVuW2luZGV4XTtcblx0XHRcdFx0Y2hlY2tSbmcubW92ZVRvRWxlbWVudFRleHQoY2hpbGQpO1xuXHRcdFx0XHRwb3NpdGlvbiA9IGNoZWNrUm5nLmNvbXBhcmVFbmRQb2ludHMoc3RhcnQgPyAnU3RhcnRUb1N0YXJ0JyA6ICdFbmRUb0VuZCcsIHJuZyk7XG5cblx0XHRcdFx0Ly8gQmVmb3JlL2FmdGVyIG9yIGFuIGV4YWN0IG1hdGNoXG5cdFx0XHRcdGlmIChwb3NpdGlvbiA+IDApIHtcblx0XHRcdFx0XHRlbmRJbmRleCA9IGluZGV4IC0gMTtcblx0XHRcdFx0fSBlbHNlIGlmIChwb3NpdGlvbiA8IDApIHtcblx0XHRcdFx0XHRzdGFydEluZGV4ID0gaW5kZXggKyAxO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHJldHVybiB7bm9kZTogY2hpbGR9O1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdC8vIENoZWNrIGlmIGNoaWxkIHBvc2l0aW9uIGlzIGJlZm9yZSBvciB3ZSBkaWRuJ3QgZmluZCBhIHBvc2l0aW9uXG5cdFx0XHRpZiAocG9zaXRpb24gPCAwKSB7XG5cdFx0XHRcdC8vIE5vIGVsZW1lbnQgY2hpbGQgd2FzIGZvdW5kIHVzZSB0aGUgcGFyZW50IGVsZW1lbnQgYW5kIHRoZSBvZmZzZXQgaW5zaWRlIHRoYXRcblx0XHRcdFx0aWYgKCFjaGlsZCkge1xuXHRcdFx0XHRcdGNoZWNrUm5nLm1vdmVUb0VsZW1lbnRUZXh0KHBhcmVudCk7XG5cdFx0XHRcdFx0Y2hlY2tSbmcuY29sbGFwc2UodHJ1ZSk7XG5cdFx0XHRcdFx0Y2hpbGQgPSBwYXJlbnQ7XG5cdFx0XHRcdFx0aW5zaWRlID0gdHJ1ZTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjaGVja1JuZy5jb2xsYXBzZShmYWxzZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBXYWxrIGNoYXJhY3RlciBieSBjaGFyYWN0ZXIgaW4gdGV4dCBub2RlIHVudGlsIHdlIGhpdCB0aGUgc2VsZWN0ZWQgcmFuZ2UgZW5kcG9pbnQsXG5cdFx0XHRcdC8vIGhpdCB0aGUgZW5kIG9mIGRvY3VtZW50IG9yIHBhcmVudCBpc24ndCB0aGUgcmlnaHQgb25lXG5cdFx0XHRcdC8vIFdlIG5lZWQgdG8gd2FsayBjaGFyIGJ5IGNoYXIgc2luY2Ugcm5nLnRleHQgb3Igcm5nLmh0bWxUZXh0IHdpbGwgdHJpbSBsaW5lIGVuZGluZ3Ncblx0XHRcdFx0b2Zmc2V0ID0gMDtcblx0XHRcdFx0d2hpbGUgKGNoZWNrUm5nLmNvbXBhcmVFbmRQb2ludHMoc3RhcnQgPyAnU3RhcnRUb1N0YXJ0JyA6ICdTdGFydFRvRW5kJywgcm5nKSAhPT0gMCkge1xuXHRcdFx0XHRcdGlmIChjaGVja1JuZy5tb3ZlKCdjaGFyYWN0ZXInLCAxKSA9PT0gMCB8fCBwYXJlbnQgIT0gY2hlY2tSbmcucGFyZW50RWxlbWVudCgpKSB7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRvZmZzZXQrKztcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Ly8gQ2hpbGQgcG9zaXRpb24gaXMgYWZ0ZXIgdGhlIHNlbGVjdGlvbiBlbmRwb2ludFxuXHRcdFx0XHRjaGVja1JuZy5jb2xsYXBzZSh0cnVlKTtcblxuXHRcdFx0XHQvLyBXYWxrIGNoYXJhY3RlciBieSBjaGFyYWN0ZXIgaW4gdGV4dCBub2RlIHVudGlsIHdlIGhpdCB0aGUgc2VsZWN0ZWQgcmFuZ2UgZW5kcG9pbnQsIGhpdFxuXHRcdFx0XHQvLyB0aGUgZW5kIG9mIGRvY3VtZW50IG9yIHBhcmVudCBpc24ndCB0aGUgcmlnaHQgb25lXG5cdFx0XHRcdG9mZnNldCA9IDA7XG5cdFx0XHRcdHdoaWxlIChjaGVja1JuZy5jb21wYXJlRW5kUG9pbnRzKHN0YXJ0ID8gJ1N0YXJ0VG9TdGFydCcgOiAnU3RhcnRUb0VuZCcsIHJuZykgIT09IDApIHtcblx0XHRcdFx0XHRpZiAoY2hlY2tSbmcubW92ZSgnY2hhcmFjdGVyJywgLTEpID09PSAwIHx8IHBhcmVudCAhPSBjaGVja1JuZy5wYXJlbnRFbGVtZW50KCkpIHtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdG9mZnNldCsrO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiB7bm9kZTogY2hpbGQsIHBvc2l0aW9uOiBwb3NpdGlvbiwgb2Zmc2V0OiBvZmZzZXQsIGluc2lkZTogaW5zaWRlfTtcblx0XHR9XG5cblx0XHQvLyBSZXR1cm5zIGEgVzNDIERPTSBjb21wYXRpYmxlIHJhbmdlIG9iamVjdCBieSB1c2luZyB0aGUgSUUgUmFuZ2UgQVBJXG5cdFx0ZnVuY3Rpb24gZ2V0UmFuZ2UoKSB7XG5cdFx0XHR2YXIgaWVSYW5nZSA9IHNlbGVjdGlvbi5nZXRSbmcoKSwgZG9tUmFuZ2UgPSBkb20uY3JlYXRlUm5nKCksIGVsZW1lbnQsIGNvbGxhcHNlZCwgdG1wUmFuZ2UsIGVsZW1lbnQyLCBib29rbWFyaztcblxuXHRcdFx0Ly8gSWYgc2VsZWN0aW9uIGlzIG91dHNpZGUgdGhlIGN1cnJlbnQgZG9jdW1lbnQganVzdCByZXR1cm4gYW4gZW1wdHkgcmFuZ2Vcblx0XHRcdGVsZW1lbnQgPSBpZVJhbmdlLml0ZW0gPyBpZVJhbmdlLml0ZW0oMCkgOiBpZVJhbmdlLnBhcmVudEVsZW1lbnQoKTtcblx0XHRcdGlmIChlbGVtZW50Lm93bmVyRG9jdW1lbnQgIT0gZG9tLmRvYykge1xuXHRcdFx0XHRyZXR1cm4gZG9tUmFuZ2U7XG5cdFx0XHR9XG5cblx0XHRcdGNvbGxhcHNlZCA9IHNlbGVjdGlvbi5pc0NvbGxhcHNlZCgpO1xuXG5cdFx0XHQvLyBIYW5kbGUgY29udHJvbCBzZWxlY3Rpb25cblx0XHRcdGlmIChpZVJhbmdlLml0ZW0pIHtcblx0XHRcdFx0ZG9tUmFuZ2Uuc2V0U3RhcnQoZWxlbWVudC5wYXJlbnROb2RlLCBkb20ubm9kZUluZGV4KGVsZW1lbnQpKTtcblx0XHRcdFx0ZG9tUmFuZ2Uuc2V0RW5kKGRvbVJhbmdlLnN0YXJ0Q29udGFpbmVyLCBkb21SYW5nZS5zdGFydE9mZnNldCArIDEpO1xuXG5cdFx0XHRcdHJldHVybiBkb21SYW5nZTtcblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gZmluZEVuZFBvaW50KHN0YXJ0KSB7XG5cdFx0XHRcdHZhciBlbmRQb2ludCA9IGdldFBvc2l0aW9uKGllUmFuZ2UsIHN0YXJ0KSwgY29udGFpbmVyLCBvZmZzZXQsIHRleHROb2RlT2Zmc2V0ID0gMCwgc2libGluZywgdW5kZWYsIG5vZGVWYWx1ZTtcblxuXHRcdFx0XHRjb250YWluZXIgPSBlbmRQb2ludC5ub2RlO1xuXHRcdFx0XHRvZmZzZXQgPSBlbmRQb2ludC5vZmZzZXQ7XG5cblx0XHRcdFx0aWYgKGVuZFBvaW50Lmluc2lkZSAmJiAhY29udGFpbmVyLmhhc0NoaWxkTm9kZXMoKSkge1xuXHRcdFx0XHRcdGRvbVJhbmdlW3N0YXJ0ID8gJ3NldFN0YXJ0JyA6ICdzZXRFbmQnXShjb250YWluZXIsIDApO1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChvZmZzZXQgPT09IHVuZGVmKSB7XG5cdFx0XHRcdFx0ZG9tUmFuZ2Vbc3RhcnQgPyAnc2V0U3RhcnRCZWZvcmUnIDogJ3NldEVuZEFmdGVyJ10oY29udGFpbmVyKTtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoZW5kUG9pbnQucG9zaXRpb24gPCAwKSB7XG5cdFx0XHRcdFx0c2libGluZyA9IGVuZFBvaW50Lmluc2lkZSA/IGNvbnRhaW5lci5maXJzdENoaWxkIDogY29udGFpbmVyLm5leHRTaWJsaW5nO1xuXG5cdFx0XHRcdFx0aWYgKCFzaWJsaW5nKSB7XG5cdFx0XHRcdFx0XHRkb21SYW5nZVtzdGFydCA/ICdzZXRTdGFydEFmdGVyJyA6ICdzZXRFbmRBZnRlciddKGNvbnRhaW5lcik7XG5cdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKCFvZmZzZXQpIHtcblx0XHRcdFx0XHRcdGlmIChzaWJsaW5nLm5vZGVUeXBlID09IDMpIHtcblx0XHRcdFx0XHRcdFx0ZG9tUmFuZ2Vbc3RhcnQgPyAnc2V0U3RhcnQnIDogJ3NldEVuZCddKHNpYmxpbmcsIDApO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0ZG9tUmFuZ2Vbc3RhcnQgPyAnc2V0U3RhcnRCZWZvcmUnIDogJ3NldEVuZEJlZm9yZSddKHNpYmxpbmcpO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Ly8gRmluZCB0aGUgdGV4dCBub2RlIGFuZCBvZmZzZXRcblx0XHRcdFx0XHR3aGlsZSAoc2libGluZykge1xuXHRcdFx0XHRcdFx0aWYgKHNpYmxpbmcubm9kZVR5cGUgPT0gMykge1xuXHRcdFx0XHRcdFx0XHRub2RlVmFsdWUgPSBzaWJsaW5nLm5vZGVWYWx1ZTtcblx0XHRcdFx0XHRcdFx0dGV4dE5vZGVPZmZzZXQgKz0gbm9kZVZhbHVlLmxlbmd0aDtcblxuXHRcdFx0XHRcdFx0XHQvLyBXZSBhcmUgYXQgb3IgcGFzc2VkIHRoZSBwb3NpdGlvbiB3ZSB3aGVyZSBsb29raW5nIGZvclxuXHRcdFx0XHRcdFx0XHRpZiAodGV4dE5vZGVPZmZzZXQgPj0gb2Zmc2V0KSB7XG5cdFx0XHRcdFx0XHRcdFx0Y29udGFpbmVyID0gc2libGluZztcblx0XHRcdFx0XHRcdFx0XHR0ZXh0Tm9kZU9mZnNldCAtPSBvZmZzZXQ7XG5cdFx0XHRcdFx0XHRcdFx0dGV4dE5vZGVPZmZzZXQgPSBub2RlVmFsdWUubGVuZ3RoIC0gdGV4dE5vZGVPZmZzZXQ7XG5cdFx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0c2libGluZyA9IHNpYmxpbmcubmV4dFNpYmxpbmc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdC8vIEZpbmQgdGhlIHRleHQgbm9kZSBhbmQgb2Zmc2V0XG5cdFx0XHRcdFx0c2libGluZyA9IGNvbnRhaW5lci5wcmV2aW91c1NpYmxpbmc7XG5cblx0XHRcdFx0XHRpZiAoIXNpYmxpbmcpIHtcblx0XHRcdFx0XHRcdHJldHVybiBkb21SYW5nZVtzdGFydCA/ICdzZXRTdGFydEJlZm9yZScgOiAnc2V0RW5kQmVmb3JlJ10oY29udGFpbmVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHQvLyBJZiB0aGVyZSBpc24ndCBhbnkgdGV4dCB0byBsb29wIHRoZW4gdXNlIHRoZSBmaXJzdCBwb3NpdGlvblxuXHRcdFx0XHRcdGlmICghb2Zmc2V0KSB7XG5cdFx0XHRcdFx0XHRpZiAoY29udGFpbmVyLm5vZGVUeXBlID09IDMpIHtcblx0XHRcdFx0XHRcdFx0ZG9tUmFuZ2Vbc3RhcnQgPyAnc2V0U3RhcnQnIDogJ3NldEVuZCddKHNpYmxpbmcsIGNvbnRhaW5lci5ub2RlVmFsdWUubGVuZ3RoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdGRvbVJhbmdlW3N0YXJ0ID8gJ3NldFN0YXJ0QWZ0ZXInIDogJ3NldEVuZEFmdGVyJ10oc2libGluZyk7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHR3aGlsZSAoc2libGluZykge1xuXHRcdFx0XHRcdFx0aWYgKHNpYmxpbmcubm9kZVR5cGUgPT0gMykge1xuXHRcdFx0XHRcdFx0XHR0ZXh0Tm9kZU9mZnNldCArPSBzaWJsaW5nLm5vZGVWYWx1ZS5sZW5ndGg7XG5cblx0XHRcdFx0XHRcdFx0Ly8gV2UgYXJlIGF0IG9yIHBhc3NlZCB0aGUgcG9zaXRpb24gd2Ugd2hlcmUgbG9va2luZyBmb3Jcblx0XHRcdFx0XHRcdFx0aWYgKHRleHROb2RlT2Zmc2V0ID49IG9mZnNldCkge1xuXHRcdFx0XHRcdFx0XHRcdGNvbnRhaW5lciA9IHNpYmxpbmc7XG5cdFx0XHRcdFx0XHRcdFx0dGV4dE5vZGVPZmZzZXQgLT0gb2Zmc2V0O1xuXHRcdFx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHNpYmxpbmcgPSBzaWJsaW5nLnByZXZpb3VzU2libGluZztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRkb21SYW5nZVtzdGFydCA/ICdzZXRTdGFydCcgOiAnc2V0RW5kJ10oY29udGFpbmVyLCB0ZXh0Tm9kZU9mZnNldCk7XG5cdFx0XHR9XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdC8vIEZpbmQgc3RhcnQgcG9pbnRcblx0XHRcdFx0ZmluZEVuZFBvaW50KHRydWUpO1xuXG5cdFx0XHRcdC8vIEZpbmQgZW5kIHBvaW50IGlmIG5lZWRlZFxuXHRcdFx0XHRpZiAoIWNvbGxhcHNlZCkge1xuXHRcdFx0XHRcdGZpbmRFbmRQb2ludCgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvLyBJRSBoYXMgYSBuYXN0eSBidWcgd2hlcmUgdGV4dCBub2RlcyBtaWdodCB0aHJvdyBcImludmFsaWQgYXJndW1lbnRcIiB3aGVuIHlvdVxuXHRcdFx0XHQvLyBhY2Nlc3MgdGhlIG5vZGVWYWx1ZSBvciBvdGhlciBwcm9wZXJ0aWVzIG9mIHRleHQgbm9kZXMuIFRoaXMgc2VlbXMgdG8gaGFwcGVuIHdoZW5cblx0XHRcdFx0Ly8gdGV4dCBub2RlcyBhcmUgc3BsaXQgaW50byB0d28gbm9kZXMgYnkgYSBkZWxldGUvYmFja3NwYWNlIGNhbGwuXG5cdFx0XHRcdC8vIFNvIGxldCB1cyBkZXRlY3QgYW5kIHRyeSB0byBmaXggaXQuXG5cdFx0XHRcdGlmIChleC5udW1iZXIgPT0gLTIxNDcwMjQ4MDkpIHtcblx0XHRcdFx0XHQvLyBHZXQgdGhlIGN1cnJlbnQgc2VsZWN0aW9uXG5cdFx0XHRcdFx0Ym9va21hcmsgPSBzZWxmLmdldEJvb2ttYXJrKDIpO1xuXG5cdFx0XHRcdFx0Ly8gR2V0IHN0YXJ0IGVsZW1lbnRcblx0XHRcdFx0XHR0bXBSYW5nZSA9IGllUmFuZ2UuZHVwbGljYXRlKCk7XG5cdFx0XHRcdFx0dG1wUmFuZ2UuY29sbGFwc2UodHJ1ZSk7XG5cdFx0XHRcdFx0ZWxlbWVudCA9IHRtcFJhbmdlLnBhcmVudEVsZW1lbnQoKTtcblxuXHRcdFx0XHRcdC8vIEdldCBlbmQgZWxlbWVudFxuXHRcdFx0XHRcdGlmICghY29sbGFwc2VkKSB7XG5cdFx0XHRcdFx0XHR0bXBSYW5nZSA9IGllUmFuZ2UuZHVwbGljYXRlKCk7XG5cdFx0XHRcdFx0XHR0bXBSYW5nZS5jb2xsYXBzZShmYWxzZSk7XG5cdFx0XHRcdFx0XHRlbGVtZW50MiA9IHRtcFJhbmdlLnBhcmVudEVsZW1lbnQoKTtcblx0XHRcdFx0XHRcdGVsZW1lbnQyLmlubmVySFRNTCA9IGVsZW1lbnQyLmlubmVySFRNTDtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHQvLyBSZW1vdmUgdGhlIGJyb2tlbiBlbGVtZW50c1xuXHRcdFx0XHRcdGVsZW1lbnQuaW5uZXJIVE1MID0gZWxlbWVudC5pbm5lckhUTUw7XG5cblx0XHRcdFx0XHQvLyBSZXN0b3JlIHRoZSBzZWxlY3Rpb25cblx0XHRcdFx0XHRzZWxmLm1vdmVUb0Jvb2ttYXJrKGJvb2ttYXJrKTtcblxuXHRcdFx0XHRcdC8vIFNpbmNlIHRoZSByYW5nZSBoYXMgbW92ZWQgd2UgbmVlZCB0byByZS1nZXQgaXRcblx0XHRcdFx0XHRpZVJhbmdlID0gc2VsZWN0aW9uLmdldFJuZygpO1xuXG5cdFx0XHRcdFx0Ly8gRmluZCBzdGFydCBwb2ludFxuXHRcdFx0XHRcdGZpbmRFbmRQb2ludCh0cnVlKTtcblxuXHRcdFx0XHRcdC8vIEZpbmQgZW5kIHBvaW50IGlmIG5lZWRlZFxuXHRcdFx0XHRcdGlmICghY29sbGFwc2VkKSB7XG5cdFx0XHRcdFx0XHRmaW5kRW5kUG9pbnQoKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhyb3cgZXg7IC8vIFRocm93IG90aGVyIGVycm9yc1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBkb21SYW5nZTtcblx0XHR9XG5cblx0XHR0aGlzLmdldEJvb2ttYXJrID0gZnVuY3Rpb24odHlwZSkge1xuXHRcdFx0dmFyIHJuZyA9IHNlbGVjdGlvbi5nZXRSbmcoKSwgYm9va21hcmsgPSB7fTtcblxuXHRcdFx0ZnVuY3Rpb24gZ2V0SW5kZXhlcyhub2RlKSB7XG5cdFx0XHRcdHZhciBwYXJlbnQsIHJvb3QsIGNoaWxkcmVuLCBpLCBpbmRleGVzID0gW107XG5cblx0XHRcdFx0cGFyZW50ID0gbm9kZS5wYXJlbnROb2RlO1xuXHRcdFx0XHRyb290ID0gZG9tLmdldFJvb3QoKS5wYXJlbnROb2RlO1xuXG5cdFx0XHRcdHdoaWxlIChwYXJlbnQgIT0gcm9vdCAmJiBwYXJlbnQubm9kZVR5cGUgIT09IDkpIHtcblx0XHRcdFx0XHRjaGlsZHJlbiA9IHBhcmVudC5jaGlsZHJlbjtcblxuXHRcdFx0XHRcdGkgPSBjaGlsZHJlbi5sZW5ndGg7XG5cdFx0XHRcdFx0d2hpbGUgKGktLSkge1xuXHRcdFx0XHRcdFx0aWYgKG5vZGUgPT09IGNoaWxkcmVuW2ldKSB7XG5cdFx0XHRcdFx0XHRcdGluZGV4ZXMucHVzaChpKTtcblx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0bm9kZSA9IHBhcmVudDtcblx0XHRcdFx0XHRwYXJlbnQgPSBwYXJlbnQucGFyZW50Tm9kZTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBpbmRleGVzO1xuXHRcdFx0fVxuXG5cdFx0XHRmdW5jdGlvbiBnZXRCb29rbWFya0VuZFBvaW50KHN0YXJ0KSB7XG5cdFx0XHRcdHZhciBwb3NpdGlvbjtcblxuXHRcdFx0XHRwb3NpdGlvbiA9IGdldFBvc2l0aW9uKHJuZywgc3RhcnQpO1xuXHRcdFx0XHRpZiAocG9zaXRpb24pIHtcblx0XHRcdFx0XHRyZXR1cm4ge1xuXHRcdFx0XHRcdFx0cG9zaXRpb246IHBvc2l0aW9uLnBvc2l0aW9uLFxuXHRcdFx0XHRcdFx0b2Zmc2V0OiBwb3NpdGlvbi5vZmZzZXQsXG5cdFx0XHRcdFx0XHRpbmRleGVzOiBnZXRJbmRleGVzKHBvc2l0aW9uLm5vZGUpLFxuXHRcdFx0XHRcdFx0aW5zaWRlOiBwb3NpdGlvbi5pbnNpZGVcblx0XHRcdFx0XHR9O1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdC8vIE5vbiB1YnN0cnVjdGl2ZSBib29rbWFya1xuXHRcdFx0aWYgKHR5cGUgPT09IDIpIHtcblx0XHRcdFx0Ly8gSGFuZGxlIHRleHQgc2VsZWN0aW9uXG5cdFx0XHRcdGlmICghcm5nLml0ZW0pIHtcblx0XHRcdFx0XHRib29rbWFyay5zdGFydCA9IGdldEJvb2ttYXJrRW5kUG9pbnQodHJ1ZSk7XG5cblx0XHRcdFx0XHRpZiAoIXNlbGVjdGlvbi5pc0NvbGxhcHNlZCgpKSB7XG5cdFx0XHRcdFx0XHRib29rbWFyay5lbmQgPSBnZXRCb29rbWFya0VuZFBvaW50KCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGJvb2ttYXJrLnN0YXJ0ID0ge2N0cmw6IHRydWUsIGluZGV4ZXM6IGdldEluZGV4ZXMocm5nLml0ZW0oMCkpfTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gYm9va21hcms7XG5cdFx0fTtcblxuXHRcdHRoaXMubW92ZVRvQm9va21hcmsgPSBmdW5jdGlvbihib29rbWFyaykge1xuXHRcdFx0dmFyIHJuZywgYm9keSA9IGRvbS5kb2MuYm9keTtcblxuXHRcdFx0ZnVuY3Rpb24gcmVzb2x2ZUluZGV4ZXMoaW5kZXhlcykge1xuXHRcdFx0XHR2YXIgbm9kZSwgaSwgaWR4LCBjaGlsZHJlbjtcblxuXHRcdFx0XHRub2RlID0gZG9tLmdldFJvb3QoKTtcblx0XHRcdFx0Zm9yIChpID0gaW5kZXhlcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuXHRcdFx0XHRcdGNoaWxkcmVuID0gbm9kZS5jaGlsZHJlbjtcblx0XHRcdFx0XHRpZHggPSBpbmRleGVzW2ldO1xuXG5cdFx0XHRcdFx0aWYgKGlkeCA8PSBjaGlsZHJlbi5sZW5ndGggLSAxKSB7XG5cdFx0XHRcdFx0XHRub2RlID0gY2hpbGRyZW5baWR4XTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbm9kZTtcblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gc2V0Qm9va21hcmtFbmRQb2ludChzdGFydCkge1xuXHRcdFx0XHR2YXIgZW5kUG9pbnQgPSBib29rbWFya1tzdGFydCA/ICdzdGFydCcgOiAnZW5kJ10sIG1vdmVMZWZ0LCBtb3ZlUm5nLCB1bmRlZiwgb2Zmc2V0O1xuXG5cdFx0XHRcdGlmIChlbmRQb2ludCkge1xuXHRcdFx0XHRcdG1vdmVMZWZ0ID0gZW5kUG9pbnQucG9zaXRpb24gPiAwO1xuXG5cdFx0XHRcdFx0bW92ZVJuZyA9IGJvZHkuY3JlYXRlVGV4dFJhbmdlKCk7XG5cdFx0XHRcdFx0bW92ZVJuZy5tb3ZlVG9FbGVtZW50VGV4dChyZXNvbHZlSW5kZXhlcyhlbmRQb2ludC5pbmRleGVzKSk7XG5cblx0XHRcdFx0XHRvZmZzZXQgPSBlbmRQb2ludC5vZmZzZXQ7XG5cdFx0XHRcdFx0aWYgKG9mZnNldCAhPT0gdW5kZWYpIHtcblx0XHRcdFx0XHRcdG1vdmVSbmcuY29sbGFwc2UoZW5kUG9pbnQuaW5zaWRlIHx8IG1vdmVMZWZ0KTtcblx0XHRcdFx0XHRcdG1vdmVSbmcubW92ZVN0YXJ0KCdjaGFyYWN0ZXInLCBtb3ZlTGVmdCA/IC1vZmZzZXQgOiBvZmZzZXQpO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRtb3ZlUm5nLmNvbGxhcHNlKHN0YXJ0KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRybmcuc2V0RW5kUG9pbnQoc3RhcnQgPyAnU3RhcnRUb1N0YXJ0JyA6ICdFbmRUb1N0YXJ0JywgbW92ZVJuZyk7XG5cblx0XHRcdFx0XHRpZiAoc3RhcnQpIHtcblx0XHRcdFx0XHRcdHJuZy5jb2xsYXBzZSh0cnVlKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKGJvb2ttYXJrLnN0YXJ0KSB7XG5cdFx0XHRcdGlmIChib29rbWFyay5zdGFydC5jdHJsKSB7XG5cdFx0XHRcdFx0cm5nID0gYm9keS5jcmVhdGVDb250cm9sUmFuZ2UoKTtcblx0XHRcdFx0XHRybmcuYWRkRWxlbWVudChyZXNvbHZlSW5kZXhlcyhib29rbWFyay5zdGFydC5pbmRleGVzKSk7XG5cdFx0XHRcdFx0cm5nLnNlbGVjdCgpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHJuZyA9IGJvZHkuY3JlYXRlVGV4dFJhbmdlKCk7XG5cdFx0XHRcdFx0c2V0Qm9va21hcmtFbmRQb2ludCh0cnVlKTtcblx0XHRcdFx0XHRzZXRCb29rbWFya0VuZFBvaW50KCk7XG5cdFx0XHRcdFx0cm5nLnNlbGVjdCgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fTtcblxuXHRcdHRoaXMuYWRkUmFuZ2UgPSBmdW5jdGlvbihybmcpIHtcblx0XHRcdHZhciBpZVJuZywgY3RybFJuZywgc3RhcnRDb250YWluZXIsIHN0YXJ0T2Zmc2V0LCBlbmRDb250YWluZXIsIGVuZE9mZnNldCwgc2libGluZyxcblx0XHRcdFx0ZG9jID0gc2VsZWN0aW9uLmRvbS5kb2MsIGJvZHkgPSBkb2MuYm9keSwgbmF0aXZlUm5nLCBjdHJsRWxtO1xuXG5cdFx0XHRmdW5jdGlvbiBzZXRFbmRQb2ludChzdGFydCkge1xuXHRcdFx0XHR2YXIgY29udGFpbmVyLCBvZmZzZXQsIG1hcmtlciwgdG1wUm5nLCBub2RlcztcblxuXHRcdFx0XHRtYXJrZXIgPSBkb20uY3JlYXRlKCdhJyk7XG5cdFx0XHRcdGNvbnRhaW5lciA9IHN0YXJ0ID8gc3RhcnRDb250YWluZXIgOiBlbmRDb250YWluZXI7XG5cdFx0XHRcdG9mZnNldCA9IHN0YXJ0ID8gc3RhcnRPZmZzZXQgOiBlbmRPZmZzZXQ7XG5cdFx0XHRcdHRtcFJuZyA9IGllUm5nLmR1cGxpY2F0ZSgpO1xuXG5cdFx0XHRcdGlmIChjb250YWluZXIgPT0gZG9jIHx8IGNvbnRhaW5lciA9PSBkb2MuZG9jdW1lbnRFbGVtZW50KSB7XG5cdFx0XHRcdFx0Y29udGFpbmVyID0gYm9keTtcblx0XHRcdFx0XHRvZmZzZXQgPSAwO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKGNvbnRhaW5lci5ub2RlVHlwZSA9PSAzKSB7XG5cdFx0XHRcdFx0Y29udGFpbmVyLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKG1hcmtlciwgY29udGFpbmVyKTtcblx0XHRcdFx0XHR0bXBSbmcubW92ZVRvRWxlbWVudFRleHQobWFya2VyKTtcblx0XHRcdFx0XHR0bXBSbmcubW92ZVN0YXJ0KCdjaGFyYWN0ZXInLCBvZmZzZXQpO1xuXHRcdFx0XHRcdGRvbS5yZW1vdmUobWFya2VyKTtcblx0XHRcdFx0XHRpZVJuZy5zZXRFbmRQb2ludChzdGFydCA/ICdTdGFydFRvU3RhcnQnIDogJ0VuZFRvRW5kJywgdG1wUm5nKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRub2RlcyA9IGNvbnRhaW5lci5jaGlsZE5vZGVzO1xuXG5cdFx0XHRcdFx0aWYgKG5vZGVzLmxlbmd0aCkge1xuXHRcdFx0XHRcdFx0aWYgKG9mZnNldCA+PSBub2Rlcy5sZW5ndGgpIHtcblx0XHRcdFx0XHRcdFx0ZG9tLmluc2VydEFmdGVyKG1hcmtlciwgbm9kZXNbbm9kZXMubGVuZ3RoIC0gMV0pO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0Y29udGFpbmVyLmluc2VydEJlZm9yZShtYXJrZXIsIG5vZGVzW29mZnNldF0pO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHR0bXBSbmcubW92ZVRvRWxlbWVudFRleHQobWFya2VyKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKGNvbnRhaW5lci5jYW5IYXZlSFRNTCkge1xuXHRcdFx0XHRcdFx0Ly8gRW1wdHkgbm9kZSBzZWxlY3Rpb24gZm9yIGV4YW1wbGUgPGRpdj58PC9kaXY+XG5cdFx0XHRcdFx0XHQvLyBTZXR0aW5nIGlubmVySFRNTCB3aXRoIGEgc3BhbiBtYXJrZXIgdGhlbiByZW1vdmUgdGhhdCBtYXJrZXIgc2VlbXMgdG8ga2VlcCBlbXB0eSBibG9jayBlbGVtZW50cyBvcGVuXG5cdFx0XHRcdFx0XHRjb250YWluZXIuaW5uZXJIVE1MID0gJzxzcGFuPiYjeEZFRkY7PC9zcGFuPic7XG5cdFx0XHRcdFx0XHRtYXJrZXIgPSBjb250YWluZXIuZmlyc3RDaGlsZDtcblx0XHRcdFx0XHRcdHRtcFJuZy5tb3ZlVG9FbGVtZW50VGV4dChtYXJrZXIpO1xuXHRcdFx0XHRcdFx0dG1wUm5nLmNvbGxhcHNlKEZBTFNFKTsgLy8gQ29sbGFwc2UgZmFsc2Ugd29ya3MgYmV0dGVyIHRoYW4gdHJ1ZSBmb3Igc29tZSBvZGQgcmVhc29uXG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWVSbmcuc2V0RW5kUG9pbnQoc3RhcnQgPyAnU3RhcnRUb1N0YXJ0JyA6ICdFbmRUb0VuZCcsIHRtcFJuZyk7XG5cdFx0XHRcdFx0ZG9tLnJlbW92ZShtYXJrZXIpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdC8vIFNldHVwIHNvbWUgc2hvcnRlciB2ZXJzaW9uc1xuXHRcdFx0c3RhcnRDb250YWluZXIgPSBybmcuc3RhcnRDb250YWluZXI7XG5cdFx0XHRzdGFydE9mZnNldCA9IHJuZy5zdGFydE9mZnNldDtcblx0XHRcdGVuZENvbnRhaW5lciA9IHJuZy5lbmRDb250YWluZXI7XG5cdFx0XHRlbmRPZmZzZXQgPSBybmcuZW5kT2Zmc2V0O1xuXHRcdFx0aWVSbmcgPSBib2R5LmNyZWF0ZVRleHRSYW5nZSgpO1xuXG5cdFx0XHQvLyBJZiBzaW5nbGUgZWxlbWVudCBzZWxlY3Rpb24gdGhlbiB0cnkgbWFraW5nIGEgY29udHJvbCBzZWxlY3Rpb24gb3V0IG9mIGl0XG5cdFx0XHRpZiAoc3RhcnRDb250YWluZXIgPT0gZW5kQ29udGFpbmVyICYmIHN0YXJ0Q29udGFpbmVyLm5vZGVUeXBlID09IDEpIHtcblx0XHRcdFx0Ly8gVHJpY2sgdG8gcGxhY2UgdGhlIGNhcmV0IGluc2lkZSBhbiBlbXB0eSBibG9jayBlbGVtZW50IGxpa2UgPHA+PC9wPlxuXHRcdFx0XHRpZiAoc3RhcnRPZmZzZXQgPT0gZW5kT2Zmc2V0ICYmICFzdGFydENvbnRhaW5lci5oYXNDaGlsZE5vZGVzKCkpIHtcblx0XHRcdFx0XHRpZiAoc3RhcnRDb250YWluZXIuY2FuSGF2ZUhUTUwpIHtcblx0XHRcdFx0XHRcdC8vIENoZWNrIGlmIHByZXZpb3VzIHNpYmxpbmcgaXMgYW4gZW1wdHkgYmxvY2sgaWYgaXQgaXMgdGhlbiB3ZSBuZWVkIHRvIHJlbmRlciBpdFxuXHRcdFx0XHRcdFx0Ly8gSUUgd291bGQgb3RoZXJ3aXNlIG1vdmUgdGhlIGNhcmV0IGludG8gdGhlIHNpYmxpbmcgaW5zdGVhZCBvZiB0aGUgZW1wdHkgc3RhcnRDb250YWluZXIgc2VlOiAjNTIzNlxuXHRcdFx0XHRcdFx0Ly8gRXhhbXBsZSB0aGlzOiA8cD48L3A+PHA+fDwvcD4gd291bGQgYmVjb21lIHRoaXM6IDxwPnw8L3A+PHA+PC9wPlxuXHRcdFx0XHRcdFx0c2libGluZyA9IHN0YXJ0Q29udGFpbmVyLnByZXZpb3VzU2libGluZztcblx0XHRcdFx0XHRcdGlmIChzaWJsaW5nICYmICFzaWJsaW5nLmhhc0NoaWxkTm9kZXMoKSAmJiBkb20uaXNCbG9jayhzaWJsaW5nKSkge1xuXHRcdFx0XHRcdFx0XHRzaWJsaW5nLmlubmVySFRNTCA9ICcmI3hGRUZGOyc7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRzaWJsaW5nID0gbnVsbDtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0c3RhcnRDb250YWluZXIuaW5uZXJIVE1MID0gJzxzcGFuPiYjeEZFRkY7PC9zcGFuPjxzcGFuPiYjeEZFRkY7PC9zcGFuPic7XG5cdFx0XHRcdFx0XHRpZVJuZy5tb3ZlVG9FbGVtZW50VGV4dChzdGFydENvbnRhaW5lci5sYXN0Q2hpbGQpO1xuXHRcdFx0XHRcdFx0aWVSbmcuc2VsZWN0KCk7XG5cdFx0XHRcdFx0XHRkb20uZG9jLnNlbGVjdGlvbi5jbGVhcigpO1xuXHRcdFx0XHRcdFx0c3RhcnRDb250YWluZXIuaW5uZXJIVE1MID0gJyc7XG5cblx0XHRcdFx0XHRcdGlmIChzaWJsaW5nKSB7XG5cdFx0XHRcdFx0XHRcdHNpYmxpbmcuaW5uZXJIVE1MID0gJyc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0c3RhcnRPZmZzZXQgPSBkb20ubm9kZUluZGV4KHN0YXJ0Q29udGFpbmVyKTtcblx0XHRcdFx0XHRzdGFydENvbnRhaW5lciA9IHN0YXJ0Q29udGFpbmVyLnBhcmVudE5vZGU7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoc3RhcnRPZmZzZXQgPT0gZW5kT2Zmc2V0IC0gMSkge1xuXHRcdFx0XHRcdHRyeSB7XG5cdFx0XHRcdFx0XHRjdHJsRWxtID0gc3RhcnRDb250YWluZXIuY2hpbGROb2Rlc1tzdGFydE9mZnNldF07XG5cdFx0XHRcdFx0XHRjdHJsUm5nID0gYm9keS5jcmVhdGVDb250cm9sUmFuZ2UoKTtcblx0XHRcdFx0XHRcdGN0cmxSbmcuYWRkRWxlbWVudChjdHJsRWxtKTtcblx0XHRcdFx0XHRcdGN0cmxSbmcuc2VsZWN0KCk7XG5cblx0XHRcdFx0XHRcdC8vIENoZWNrIGlmIHRoZSByYW5nZSBwcm9kdWNlZCBpcyBvbiB0aGUgY29ycmVjdCBlbGVtZW50IGFuZCBpcyBhIGNvbnRyb2wgcmFuZ2Vcblx0XHRcdFx0XHRcdC8vIE9uIElFIDggaXQgd2lsbCBzZWxlY3QgdGhlIHBhcmVudCBjb250ZW50RWRpdGFibGUgY29udGFpbmVyIGlmIHlvdSBzZWxlY3QgYW4gaW5uZXIgZWxlbWVudCBzZWU6ICM1Mzk4XG5cdFx0XHRcdFx0XHRuYXRpdmVSbmcgPSBzZWxlY3Rpb24uZ2V0Um5nKCk7XG5cdFx0XHRcdFx0XHRpZiAobmF0aXZlUm5nLml0ZW0gJiYgY3RybEVsbSA9PT0gbmF0aXZlUm5nLml0ZW0oMCkpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdFx0XHQvLyBJZ25vcmVcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0Ly8gU2V0IHN0YXJ0L2VuZCBwb2ludCBvZiBzZWxlY3Rpb25cblx0XHRcdHNldEVuZFBvaW50KHRydWUpO1xuXHRcdFx0c2V0RW5kUG9pbnQoKTtcblxuXHRcdFx0Ly8gU2VsZWN0IHRoZSBuZXcgcmFuZ2UgYW5kIHNjcm9sbCBpdCBpbnRvIHZpZXdcblx0XHRcdGllUm5nLnNlbGVjdCgpO1xuXHRcdH07XG5cblx0XHQvLyBFeHBvc2UgcmFuZ2UgbWV0aG9kXG5cdFx0dGhpcy5nZXRSYW5nZUF0ID0gZ2V0UmFuZ2U7XG5cdH1cblxuXHRyZXR1cm4gU2VsZWN0aW9uO1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy91dGlsL1ZLLmpzXG5cbi8qKlxuICogVksuanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBUaGlzIGZpbGUgZXhwb3NlcyBhIHNldCBvZiB0aGUgY29tbW9uIEtleUNvZGVzIGZvciB1c2UuIFBsZWFzZSBncm93IGl0IGFzIG5lZWRlZC5cbiAqL1xuZGVmaW5lKFwidGlueW1jZS91dGlsL1ZLXCIsIFtcblx0XCJ0aW55bWNlL0VudlwiXG5dLCBmdW5jdGlvbihFbnYpIHtcblx0cmV0dXJuIHtcblx0XHRCQUNLU1BBQ0U6IDgsXG5cdFx0REVMRVRFOiA0Nixcblx0XHRET1dOOiA0MCxcblx0XHRFTlRFUjogMTMsXG5cdFx0TEVGVDogMzcsXG5cdFx0UklHSFQ6IDM5LFxuXHRcdFNQQUNFQkFSOiAzMixcblx0XHRUQUI6IDksXG5cdFx0VVA6IDM4LFxuXG5cdFx0bW9kaWZpZXJQcmVzc2VkOiBmdW5jdGlvbihlKSB7XG5cdFx0XHRyZXR1cm4gZS5zaGlmdEtleSB8fCBlLmN0cmxLZXkgfHwgZS5hbHRLZXkgfHwgdGhpcy5tZXRhS2V5UHJlc3NlZChlKTtcblx0XHR9LFxuXG5cdFx0bWV0YUtleVByZXNzZWQ6IGZ1bmN0aW9uKGUpIHtcblx0XHRcdC8vIENoZWNrIGlmIGN0cmwgb3IgbWV0YSBrZXkgaXMgcHJlc3NlZC4gRWRnZSBjYXNlIGZvciBBbHRHciBvbiBXaW5kb3dzIHdoZXJlIGl0IHByb2R1Y2VzIGN0cmxLZXkrYWx0S2V5IHN0YXRlc1xuXHRcdFx0cmV0dXJuIChFbnYubWFjID8gZS5tZXRhS2V5IDogZS5jdHJsS2V5ICYmICFlLmFsdEtleSk7XG5cdFx0fVxuXHR9O1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy9kb20vQ29udHJvbFNlbGVjdGlvbi5qc1xuXG4vKipcbiAqIENvbnRyb2xTZWxlY3Rpb24uanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBUaGlzIGNsYXNzIGhhbmRsZXMgY29udHJvbCBzZWxlY3Rpb24gb2YgZWxlbWVudHMuIENvbnRyb2xzIGFyZSBlbGVtZW50c1xuICogdGhhdCBjYW4gYmUgcmVzaXplZCBhbmQgbmVlZHMgdG8gYmUgc2VsZWN0ZWQgYXMgYSB3aG9sZS4gSXQgYWRkcyBjdXN0b20gcmVzaXplIGhhbmRsZXNcbiAqIHRvIGFsbCBicm93c2VyIGVuZ2luZXMgdGhhdCBzdXBwb3J0IHByb3Blcmx5IGRpc2FibGluZyB0aGUgYnVpbHQgaW4gcmVzaXplIGxvZ2ljLlxuICpcbiAqIEBjbGFzcyB0aW55bWNlLmRvbS5Db250cm9sU2VsZWN0aW9uXG4gKi9cbmRlZmluZShcInRpbnltY2UvZG9tL0NvbnRyb2xTZWxlY3Rpb25cIiwgW1xuXHRcInRpbnltY2UvdXRpbC9WS1wiLFxuXHRcInRpbnltY2UvdXRpbC9Ub29sc1wiLFxuXHRcInRpbnltY2UvdXRpbC9EZWxheVwiLFxuXHRcInRpbnltY2UvRW52XCIsXG5cdFwidGlueW1jZS9kb20vTm9kZVR5cGVcIlxuXSwgZnVuY3Rpb24oVkssIFRvb2xzLCBEZWxheSwgRW52LCBOb2RlVHlwZSkge1xuXHR2YXIgaXNDb250ZW50RWRpdGFibGVGYWxzZSA9IE5vZGVUeXBlLmlzQ29udGVudEVkaXRhYmxlRmFsc2U7XG5cdHZhciBpc0NvbnRlbnRFZGl0YWJsZVRydWUgPSBOb2RlVHlwZS5pc0NvbnRlbnRFZGl0YWJsZVRydWU7XG5cblx0ZnVuY3Rpb24gZ2V0Q29udGVudEVkaXRhYmxlUm9vdChyb290LCBub2RlKSB7XG5cdFx0d2hpbGUgKG5vZGUgJiYgbm9kZSAhPSByb290KSB7XG5cdFx0XHRpZiAoaXNDb250ZW50RWRpdGFibGVUcnVlKG5vZGUpIHx8IGlzQ29udGVudEVkaXRhYmxlRmFsc2Uobm9kZSkpIHtcblx0XHRcdFx0cmV0dXJuIG5vZGU7XG5cdFx0XHR9XG5cblx0XHRcdG5vZGUgPSBub2RlLnBhcmVudE5vZGU7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIG51bGw7XG5cdH1cblxuXHRyZXR1cm4gZnVuY3Rpb24oc2VsZWN0aW9uLCBlZGl0b3IpIHtcblx0XHR2YXIgZG9tID0gZWRpdG9yLmRvbSwgZWFjaCA9IFRvb2xzLmVhY2g7XG5cdFx0dmFyIHNlbGVjdGVkRWxtLCBzZWxlY3RlZEVsbUdob3N0LCByZXNpemVIZWxwZXIsIHJlc2l6ZUhhbmRsZXMsIHNlbGVjdGVkSGFuZGxlLCBsYXN0TW91c2VEb3duRXZlbnQ7XG5cdFx0dmFyIHN0YXJ0WCwgc3RhcnRZLCBzZWxlY3RlZEVsbVgsIHNlbGVjdGVkRWxtWSwgc3RhcnRXLCBzdGFydEgsIHJhdGlvLCByZXNpemVTdGFydGVkO1xuXHRcdHZhciB3aWR0aCwgaGVpZ2h0LCBlZGl0YWJsZURvYyA9IGVkaXRvci5nZXREb2MoKSwgcm9vdERvY3VtZW50ID0gZG9jdW1lbnQsIGlzSUUgPSBFbnYuaWUgJiYgRW52LmllIDwgMTE7XG5cdFx0dmFyIGFicyA9IE1hdGguYWJzLCByb3VuZCA9IE1hdGgucm91bmQsIHJvb3RFbGVtZW50ID0gZWRpdG9yLmdldEJvZHkoKSwgc3RhcnRTY3JvbGxXaWR0aCwgc3RhcnRTY3JvbGxIZWlnaHQ7XG5cblx0XHQvLyBEZXRhaWxzIGFib3V0IGVhY2ggcmVzaXplIGhhbmRsZSBob3cgdG8gc2NhbGUgZXRjXG5cdFx0cmVzaXplSGFuZGxlcyA9IHtcblx0XHRcdC8vIE5hbWU6IHggbXVsdGlwbGllciwgeSBtdWx0aXBsaWVyLCBkZWx0YSBzaXplIHgsIGRlbHRhIHNpemUgeVxuXHRcdFx0LypuOiBbMC41LCAwLCAwLCAtMV0sXG5cdFx0XHRlOiBbMSwgMC41LCAxLCAwXSxcblx0XHRcdHM6IFswLjUsIDEsIDAsIDFdLFxuXHRcdFx0dzogWzAsIDAuNSwgLTEsIDBdLCovXG5cdFx0XHRudzogWzAsIDAsIC0xLCAtMV0sXG5cdFx0XHRuZTogWzEsIDAsIDEsIC0xXSxcblx0XHRcdHNlOiBbMSwgMSwgMSwgMV0sXG5cdFx0XHRzdzogWzAsIDEsIC0xLCAxXVxuXHRcdH07XG5cblx0XHQvLyBBZGQgQ1NTIGZvciByZXNpemUgaGFuZGxlcywgY2xvbmVkIGVsZW1lbnQgYW5kIHNlbGVjdGVkXG5cdFx0dmFyIHJvb3RDbGFzcyA9ICcubWNlLWNvbnRlbnQtYm9keSc7XG5cdFx0ZWRpdG9yLmNvbnRlbnRTdHlsZXMucHVzaChcblx0XHRcdHJvb3RDbGFzcyArICcgZGl2Lm1jZS1yZXNpemVoYW5kbGUgeycgK1xuXHRcdFx0XHQncG9zaXRpb246IGFic29sdXRlOycgK1xuXHRcdFx0XHQnYm9yZGVyOiAxcHggc29saWQgYmxhY2s7JyArXG5cdFx0XHRcdCdib3gtc2l6aW5nOiBib3gtc2l6aW5nOycgK1xuXHRcdFx0XHQnYmFja2dyb3VuZDogI0ZGRjsnICtcblx0XHRcdFx0J3dpZHRoOiA3cHg7JyArXG5cdFx0XHRcdCdoZWlnaHQ6IDdweDsnICtcblx0XHRcdFx0J3otaW5kZXg6IDEwMDAwJyArXG5cdFx0XHQnfScgK1xuXHRcdFx0cm9vdENsYXNzICsgJyAubWNlLXJlc2l6ZWhhbmRsZTpob3ZlciB7JyArXG5cdFx0XHRcdCdiYWNrZ3JvdW5kOiAjMDAwJyArXG5cdFx0XHQnfScgK1xuXHRcdFx0cm9vdENsYXNzICsgJyBpbWdbZGF0YS1tY2Utc2VsZWN0ZWRdLCcgKyByb290Q2xhc3MgKyAnIGhyW2RhdGEtbWNlLXNlbGVjdGVkXSB7JyArXG5cdFx0XHRcdCdvdXRsaW5lOiAxcHggc29saWQgYmxhY2s7JyArXG5cdFx0XHRcdCdyZXNpemU6IG5vbmUnICsgLy8gSGF2ZSBiZWVuIHRhbGtzIGFib3V0IGltcGxlbWVudGluZyB0aGlzIGluIGJyb3dzZXJzXG5cdFx0XHQnfScgK1xuXHRcdFx0cm9vdENsYXNzICsgJyAubWNlLWNsb25lZHJlc2l6YWJsZSB7JyArXG5cdFx0XHRcdCdwb3NpdGlvbjogYWJzb2x1dGU7JyArXG5cdFx0XHRcdChFbnYuZ2Vja28gPyAnJyA6ICdvdXRsaW5lOiAxcHggZGFzaGVkIGJsYWNrOycpICsgLy8gR2Vja28gcHJvZHVjZXMgdHJhaWxzIHdoaWxlIHJlc2l6aW5nXG5cdFx0XHRcdCdvcGFjaXR5OiAuNTsnICtcblx0XHRcdFx0J2ZpbHRlcjogYWxwaGEob3BhY2l0eT01MCk7JyArXG5cdFx0XHRcdCd6LWluZGV4OiAxMDAwMCcgK1xuXHRcdFx0J30nICtcblx0XHRcdHJvb3RDbGFzcyArICcgLm1jZS1yZXNpemUtaGVscGVyIHsnICtcblx0XHRcdFx0J2JhY2tncm91bmQ6ICM1NTU7JyArXG5cdFx0XHRcdCdiYWNrZ3JvdW5kOiByZ2JhKDAsMCwwLDAuNzUpOycgK1xuXHRcdFx0XHQnYm9yZGVyLXJhZGl1czogM3B4OycgK1xuXHRcdFx0XHQnYm9yZGVyOiAxcHg7JyArXG5cdFx0XHRcdCdjb2xvcjogd2hpdGU7JyArXG5cdFx0XHRcdCdkaXNwbGF5OiBub25lOycgK1xuXHRcdFx0XHQnZm9udC1mYW1pbHk6IHNhbnMtc2VyaWY7JyArXG5cdFx0XHRcdCdmb250LXNpemU6IDEycHg7JyArXG5cdFx0XHRcdCd3aGl0ZS1zcGFjZTogbm93cmFwOycgK1xuXHRcdFx0XHQnbGluZS1oZWlnaHQ6IDE0cHg7JyArXG5cdFx0XHRcdCdtYXJnaW46IDVweCAxMHB4OycgK1xuXHRcdFx0XHQncGFkZGluZzogNXB4OycgK1xuXHRcdFx0XHQncG9zaXRpb246IGFic29sdXRlOycgK1xuXHRcdFx0XHQnei1pbmRleDogMTAwMDEnICtcblx0XHRcdCd9J1xuXHRcdCk7XG5cblx0XHRmdW5jdGlvbiBpc1Jlc2l6YWJsZShlbG0pIHtcblx0XHRcdHZhciBzZWxlY3RvciA9IGVkaXRvci5zZXR0aW5ncy5vYmplY3RfcmVzaXppbmc7XG5cblx0XHRcdGlmIChzZWxlY3RvciA9PT0gZmFsc2UgfHwgRW52LmlPUykge1xuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2Ygc2VsZWN0b3IgIT0gJ3N0cmluZycpIHtcblx0XHRcdFx0c2VsZWN0b3IgPSAndGFibGUsaW1nLGRpdic7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChlbG0uZ2V0QXR0cmlidXRlKCdkYXRhLW1jZS1yZXNpemUnKSA9PT0gJ2ZhbHNlJykge1xuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChlbG0gPT0gZWRpdG9yLmdldEJvZHkoKSkge1xuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBlZGl0b3IuZG9tLmlzKGVsbSwgc2VsZWN0b3IpO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIHJlc2l6ZUdob3N0RWxlbWVudChlKSB7XG5cdFx0XHR2YXIgZGVsdGFYLCBkZWx0YVksIHByb3BvcnRpb25hbDtcblx0XHRcdHZhciByZXNpemVIZWxwZXJYLCByZXNpemVIZWxwZXJZO1xuXG5cdFx0XHQvLyBDYWxjIG5ldyB3aWR0aC9oZWlnaHRcblx0XHRcdGRlbHRhWCA9IGUuc2NyZWVuWCAtIHN0YXJ0WDtcblx0XHRcdGRlbHRhWSA9IGUuc2NyZWVuWSAtIHN0YXJ0WTtcblxuXHRcdFx0Ly8gQ2FsYyBuZXcgc2l6ZVxuXHRcdFx0d2lkdGggPSBkZWx0YVggKiBzZWxlY3RlZEhhbmRsZVsyXSArIHN0YXJ0Vztcblx0XHRcdGhlaWdodCA9IGRlbHRhWSAqIHNlbGVjdGVkSGFuZGxlWzNdICsgc3RhcnRIO1xuXG5cdFx0XHQvLyBOZXZlciBzY2FsZSBkb3duIGxvd2VyIHRoYW4gNSBwaXhlbHNcblx0XHRcdHdpZHRoID0gd2lkdGggPCA1ID8gNSA6IHdpZHRoO1xuXHRcdFx0aGVpZ2h0ID0gaGVpZ2h0IDwgNSA/IDUgOiBoZWlnaHQ7XG5cblx0XHRcdGlmIChzZWxlY3RlZEVsbS5ub2RlTmFtZSA9PSBcIklNR1wiICYmIGVkaXRvci5zZXR0aW5ncy5yZXNpemVfaW1nX3Byb3BvcnRpb25hbCAhPT0gZmFsc2UpIHtcblx0XHRcdFx0cHJvcG9ydGlvbmFsID0gIVZLLm1vZGlmaWVyUHJlc3NlZChlKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHByb3BvcnRpb25hbCA9IFZLLm1vZGlmaWVyUHJlc3NlZChlKSB8fCAoc2VsZWN0ZWRFbG0ubm9kZU5hbWUgPT0gXCJJTUdcIiAmJiBzZWxlY3RlZEhhbmRsZVsyXSAqIHNlbGVjdGVkSGFuZGxlWzNdICE9PSAwKTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gQ29uc3RyYWluIHByb3BvcnRpb25zXG5cdFx0XHRpZiAocHJvcG9ydGlvbmFsKSB7XG5cdFx0XHRcdGlmIChhYnMoZGVsdGFYKSA+IGFicyhkZWx0YVkpKSB7XG5cdFx0XHRcdFx0aGVpZ2h0ID0gcm91bmQod2lkdGggKiByYXRpbyk7XG5cdFx0XHRcdFx0d2lkdGggPSByb3VuZChoZWlnaHQgLyByYXRpbyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0d2lkdGggPSByb3VuZChoZWlnaHQgLyByYXRpbyk7XG5cdFx0XHRcdFx0aGVpZ2h0ID0gcm91bmQod2lkdGggKiByYXRpbyk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0Ly8gVXBkYXRlIGdob3N0IHNpemVcblx0XHRcdGRvbS5zZXRTdHlsZXMoc2VsZWN0ZWRFbG1HaG9zdCwge1xuXHRcdFx0XHR3aWR0aDogd2lkdGgsXG5cdFx0XHRcdGhlaWdodDogaGVpZ2h0XG5cdFx0XHR9KTtcblxuXHRcdFx0Ly8gVXBkYXRlIHJlc2l6ZSBoZWxwZXIgcG9zaXRpb25cblx0XHRcdHJlc2l6ZUhlbHBlclggPSBzZWxlY3RlZEhhbmRsZS5zdGFydFBvcy54ICsgZGVsdGFYO1xuXHRcdFx0cmVzaXplSGVscGVyWSA9IHNlbGVjdGVkSGFuZGxlLnN0YXJ0UG9zLnkgKyBkZWx0YVk7XG5cdFx0XHRyZXNpemVIZWxwZXJYID0gcmVzaXplSGVscGVyWCA+IDAgPyByZXNpemVIZWxwZXJYIDogMDtcblx0XHRcdHJlc2l6ZUhlbHBlclkgPSByZXNpemVIZWxwZXJZID4gMCA/IHJlc2l6ZUhlbHBlclkgOiAwO1xuXG5cdFx0XHRkb20uc2V0U3R5bGVzKHJlc2l6ZUhlbHBlciwge1xuXHRcdFx0XHRsZWZ0OiByZXNpemVIZWxwZXJYLFxuXHRcdFx0XHR0b3A6IHJlc2l6ZUhlbHBlclksXG5cdFx0XHRcdGRpc3BsYXk6ICdibG9jaydcblx0XHRcdH0pO1xuXG5cdFx0XHRyZXNpemVIZWxwZXIuaW5uZXJIVE1MID0gd2lkdGggKyAnICZ0aW1lczsgJyArIGhlaWdodDtcblxuXHRcdFx0Ly8gVXBkYXRlIGdob3N0IFggcG9zaXRpb24gaWYgbmVlZGVkXG5cdFx0XHRpZiAoc2VsZWN0ZWRIYW5kbGVbMl0gPCAwICYmIHNlbGVjdGVkRWxtR2hvc3QuY2xpZW50V2lkdGggPD0gd2lkdGgpIHtcblx0XHRcdFx0ZG9tLnNldFN0eWxlKHNlbGVjdGVkRWxtR2hvc3QsICdsZWZ0Jywgc2VsZWN0ZWRFbG1YICsgKHN0YXJ0VyAtIHdpZHRoKSk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIFVwZGF0ZSBnaG9zdCBZIHBvc2l0aW9uIGlmIG5lZWRlZFxuXHRcdFx0aWYgKHNlbGVjdGVkSGFuZGxlWzNdIDwgMCAmJiBzZWxlY3RlZEVsbUdob3N0LmNsaWVudEhlaWdodCA8PSBoZWlnaHQpIHtcblx0XHRcdFx0ZG9tLnNldFN0eWxlKHNlbGVjdGVkRWxtR2hvc3QsICd0b3AnLCBzZWxlY3RlZEVsbVkgKyAoc3RhcnRIIC0gaGVpZ2h0KSk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIENhbGN1bGF0ZSBob3cgbXVzdCBvdmVyZmxvdyB3ZSBnb3Rcblx0XHRcdGRlbHRhWCA9IHJvb3RFbGVtZW50LnNjcm9sbFdpZHRoIC0gc3RhcnRTY3JvbGxXaWR0aDtcblx0XHRcdGRlbHRhWSA9IHJvb3RFbGVtZW50LnNjcm9sbEhlaWdodCAtIHN0YXJ0U2Nyb2xsSGVpZ2h0O1xuXG5cdFx0XHQvLyBSZS1wb3NpdGlvbiB0aGUgcmVzaXplIGhlbHBlciBiYXNlZCBvbiB0aGUgb3ZlcmZsb3dcblx0XHRcdGlmIChkZWx0YVggKyBkZWx0YVkgIT09IDApIHtcblx0XHRcdFx0ZG9tLnNldFN0eWxlcyhyZXNpemVIZWxwZXIsIHtcblx0XHRcdFx0XHRsZWZ0OiByZXNpemVIZWxwZXJYIC0gZGVsdGFYLFxuXHRcdFx0XHRcdHRvcDogcmVzaXplSGVscGVyWSAtIGRlbHRhWVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKCFyZXNpemVTdGFydGVkKSB7XG5cdFx0XHRcdGVkaXRvci5maXJlKCdPYmplY3RSZXNpemVTdGFydCcsIHt0YXJnZXQ6IHNlbGVjdGVkRWxtLCB3aWR0aDogc3RhcnRXLCBoZWlnaHQ6IHN0YXJ0SH0pO1xuXHRcdFx0XHRyZXNpemVTdGFydGVkID0gdHJ1ZTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRmdW5jdGlvbiBlbmRHaG9zdFJlc2l6ZSgpIHtcblx0XHRcdHJlc2l6ZVN0YXJ0ZWQgPSBmYWxzZTtcblxuXHRcdFx0ZnVuY3Rpb24gc2V0U2l6ZVByb3AobmFtZSwgdmFsdWUpIHtcblx0XHRcdFx0aWYgKHZhbHVlKSB7XG5cdFx0XHRcdFx0Ly8gUmVzaXplIGJ5IHVzaW5nIHN0eWxlIG9yIGF0dHJpYnV0ZVxuXHRcdFx0XHRcdGlmIChzZWxlY3RlZEVsbS5zdHlsZVtuYW1lXSB8fCAhZWRpdG9yLnNjaGVtYS5pc1ZhbGlkKHNlbGVjdGVkRWxtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCksIG5hbWUpKSB7XG5cdFx0XHRcdFx0XHRkb20uc2V0U3R5bGUoc2VsZWN0ZWRFbG0sIG5hbWUsIHZhbHVlKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0ZG9tLnNldEF0dHJpYihzZWxlY3RlZEVsbSwgbmFtZSwgdmFsdWUpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHQvLyBTZXQgd2lkdGgvaGVpZ2h0IHByb3BlcnRpZXNcblx0XHRcdHNldFNpemVQcm9wKCd3aWR0aCcsIHdpZHRoKTtcblx0XHRcdHNldFNpemVQcm9wKCdoZWlnaHQnLCBoZWlnaHQpO1xuXG5cdFx0XHRkb20udW5iaW5kKGVkaXRhYmxlRG9jLCAnbW91c2Vtb3ZlJywgcmVzaXplR2hvc3RFbGVtZW50KTtcblx0XHRcdGRvbS51bmJpbmQoZWRpdGFibGVEb2MsICdtb3VzZXVwJywgZW5kR2hvc3RSZXNpemUpO1xuXG5cdFx0XHRpZiAocm9vdERvY3VtZW50ICE9IGVkaXRhYmxlRG9jKSB7XG5cdFx0XHRcdGRvbS51bmJpbmQocm9vdERvY3VtZW50LCAnbW91c2Vtb3ZlJywgcmVzaXplR2hvc3RFbGVtZW50KTtcblx0XHRcdFx0ZG9tLnVuYmluZChyb290RG9jdW1lbnQsICdtb3VzZXVwJywgZW5kR2hvc3RSZXNpemUpO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBSZW1vdmUgZ2hvc3QvaGVscGVyIGFuZCB1cGRhdGUgcmVzaXplIGhhbmRsZSBwb3NpdGlvbnNcblx0XHRcdGRvbS5yZW1vdmUoc2VsZWN0ZWRFbG1HaG9zdCk7XG5cdFx0XHRkb20ucmVtb3ZlKHJlc2l6ZUhlbHBlcik7XG5cblx0XHRcdGlmICghaXNJRSB8fCBzZWxlY3RlZEVsbS5ub2RlTmFtZSA9PSBcIlRBQkxFXCIpIHtcblx0XHRcdFx0c2hvd1Jlc2l6ZVJlY3Qoc2VsZWN0ZWRFbG0pO1xuXHRcdFx0fVxuXG5cdFx0XHRlZGl0b3IuZmlyZSgnT2JqZWN0UmVzaXplZCcsIHt0YXJnZXQ6IHNlbGVjdGVkRWxtLCB3aWR0aDogd2lkdGgsIGhlaWdodDogaGVpZ2h0fSk7XG5cdFx0XHRkb20uc2V0QXR0cmliKHNlbGVjdGVkRWxtLCAnc3R5bGUnLCBkb20uZ2V0QXR0cmliKHNlbGVjdGVkRWxtLCAnc3R5bGUnKSk7XG5cdFx0XHRlZGl0b3Iubm9kZUNoYW5nZWQoKTtcblx0XHR9XG5cblx0XHRmdW5jdGlvbiBzaG93UmVzaXplUmVjdCh0YXJnZXRFbG0sIG1vdXNlRG93bkhhbmRsZU5hbWUsIG1vdXNlRG93bkV2ZW50KSB7XG5cdFx0XHR2YXIgcG9zaXRpb24sIHRhcmdldFdpZHRoLCB0YXJnZXRIZWlnaHQsIGUsIHJlY3Q7XG5cblx0XHRcdGhpZGVSZXNpemVSZWN0KCk7XG5cdFx0XHR1bmJpbmRSZXNpemVIYW5kbGVFdmVudHMoKTtcblxuXHRcdFx0Ly8gR2V0IHBvc2l0aW9uIGFuZCBzaXplIG9mIHRhcmdldFxuXHRcdFx0cG9zaXRpb24gPSBkb20uZ2V0UG9zKHRhcmdldEVsbSwgcm9vdEVsZW1lbnQpO1xuXHRcdFx0c2VsZWN0ZWRFbG1YID0gcG9zaXRpb24ueDtcblx0XHRcdHNlbGVjdGVkRWxtWSA9IHBvc2l0aW9uLnk7XG5cdFx0XHRyZWN0ID0gdGFyZ2V0RWxtLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOyAvLyBGaXggZm9yIEdlY2tvIG9mZnNldEhlaWdodCBmb3IgdGFibGUgd2l0aCBjYXB0aW9uXG5cdFx0XHR0YXJnZXRXaWR0aCA9IHJlY3Qud2lkdGggfHwgKHJlY3QucmlnaHQgLSByZWN0LmxlZnQpO1xuXHRcdFx0dGFyZ2V0SGVpZ2h0ID0gcmVjdC5oZWlnaHQgfHwgKHJlY3QuYm90dG9tIC0gcmVjdC50b3ApO1xuXG5cdFx0XHQvLyBSZXNldCB3aWR0aC9oZWlnaHQgaWYgdXNlciBzZWxlY3RzIGEgbmV3IGltYWdlL3RhYmxlXG5cdFx0XHRpZiAoc2VsZWN0ZWRFbG0gIT0gdGFyZ2V0RWxtKSB7XG5cdFx0XHRcdGRldGFjaFJlc2l6ZVN0YXJ0TGlzdGVuZXIoKTtcblx0XHRcdFx0c2VsZWN0ZWRFbG0gPSB0YXJnZXRFbG07XG5cdFx0XHRcdHdpZHRoID0gaGVpZ2h0ID0gMDtcblx0XHRcdH1cblxuXHRcdFx0Ly8gTWFrZXMgaXQgcG9zc2libGUgdG8gZGlzYWJsZSByZXNpemluZ1xuXHRcdFx0ZSA9IGVkaXRvci5maXJlKCdPYmplY3RTZWxlY3RlZCcsIHt0YXJnZXQ6IHRhcmdldEVsbX0pO1xuXG5cdFx0XHRpZiAoaXNSZXNpemFibGUodGFyZ2V0RWxtKSAmJiAhZS5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkge1xuXHRcdFx0XHRlYWNoKHJlc2l6ZUhhbmRsZXMsIGZ1bmN0aW9uKGhhbmRsZSwgbmFtZSkge1xuXHRcdFx0XHRcdHZhciBoYW5kbGVFbG07XG5cblx0XHRcdFx0XHRmdW5jdGlvbiBzdGFydERyYWcoZSkge1xuXHRcdFx0XHRcdFx0c3RhcnRYID0gZS5zY3JlZW5YO1xuXHRcdFx0XHRcdFx0c3RhcnRZID0gZS5zY3JlZW5ZO1xuXHRcdFx0XHRcdFx0c3RhcnRXID0gc2VsZWN0ZWRFbG0uY2xpZW50V2lkdGg7XG5cdFx0XHRcdFx0XHRzdGFydEggPSBzZWxlY3RlZEVsbS5jbGllbnRIZWlnaHQ7XG5cdFx0XHRcdFx0XHRyYXRpbyA9IHN0YXJ0SCAvIHN0YXJ0Vztcblx0XHRcdFx0XHRcdHNlbGVjdGVkSGFuZGxlID0gaGFuZGxlO1xuXG5cdFx0XHRcdFx0XHRoYW5kbGUuc3RhcnRQb3MgPSB7XG5cdFx0XHRcdFx0XHRcdHg6IHRhcmdldFdpZHRoICogaGFuZGxlWzBdICsgc2VsZWN0ZWRFbG1YLFxuXHRcdFx0XHRcdFx0XHR5OiB0YXJnZXRIZWlnaHQgKiBoYW5kbGVbMV0gKyBzZWxlY3RlZEVsbVlcblx0XHRcdFx0XHRcdH07XG5cblx0XHRcdFx0XHRcdHN0YXJ0U2Nyb2xsV2lkdGggPSByb290RWxlbWVudC5zY3JvbGxXaWR0aDtcblx0XHRcdFx0XHRcdHN0YXJ0U2Nyb2xsSGVpZ2h0ID0gcm9vdEVsZW1lbnQuc2Nyb2xsSGVpZ2h0O1xuXG5cdFx0XHRcdFx0XHRzZWxlY3RlZEVsbUdob3N0ID0gc2VsZWN0ZWRFbG0uY2xvbmVOb2RlKHRydWUpO1xuXHRcdFx0XHRcdFx0ZG9tLmFkZENsYXNzKHNlbGVjdGVkRWxtR2hvc3QsICdtY2UtY2xvbmVkcmVzaXphYmxlJyk7XG5cdFx0XHRcdFx0XHRkb20uc2V0QXR0cmliKHNlbGVjdGVkRWxtR2hvc3QsICdkYXRhLW1jZS1ib2d1cycsICdhbGwnKTtcblx0XHRcdFx0XHRcdHNlbGVjdGVkRWxtR2hvc3QuY29udGVudEVkaXRhYmxlID0gZmFsc2U7IC8vIEhpZGVzIElFIG1vdmUgbGF5ZXIgY3Vyc29yXG5cdFx0XHRcdFx0XHRzZWxlY3RlZEVsbUdob3N0LnVuU2VsZWN0YWJlID0gdHJ1ZTtcblx0XHRcdFx0XHRcdGRvbS5zZXRTdHlsZXMoc2VsZWN0ZWRFbG1HaG9zdCwge1xuXHRcdFx0XHRcdFx0XHRsZWZ0OiBzZWxlY3RlZEVsbVgsXG5cdFx0XHRcdFx0XHRcdHRvcDogc2VsZWN0ZWRFbG1ZLFxuXHRcdFx0XHRcdFx0XHRtYXJnaW46IDBcblx0XHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0XHRzZWxlY3RlZEVsbUdob3N0LnJlbW92ZUF0dHJpYnV0ZSgnZGF0YS1tY2Utc2VsZWN0ZWQnKTtcblx0XHRcdFx0XHRcdHJvb3RFbGVtZW50LmFwcGVuZENoaWxkKHNlbGVjdGVkRWxtR2hvc3QpO1xuXG5cdFx0XHRcdFx0XHRkb20uYmluZChlZGl0YWJsZURvYywgJ21vdXNlbW92ZScsIHJlc2l6ZUdob3N0RWxlbWVudCk7XG5cdFx0XHRcdFx0XHRkb20uYmluZChlZGl0YWJsZURvYywgJ21vdXNldXAnLCBlbmRHaG9zdFJlc2l6ZSk7XG5cblx0XHRcdFx0XHRcdGlmIChyb290RG9jdW1lbnQgIT0gZWRpdGFibGVEb2MpIHtcblx0XHRcdFx0XHRcdFx0ZG9tLmJpbmQocm9vdERvY3VtZW50LCAnbW91c2Vtb3ZlJywgcmVzaXplR2hvc3RFbGVtZW50KTtcblx0XHRcdFx0XHRcdFx0ZG9tLmJpbmQocm9vdERvY3VtZW50LCAnbW91c2V1cCcsIGVuZEdob3N0UmVzaXplKTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmVzaXplSGVscGVyID0gZG9tLmFkZChyb290RWxlbWVudCwgJ2RpdicsIHtcblx0XHRcdFx0XHRcdFx0J2NsYXNzJzogJ21jZS1yZXNpemUtaGVscGVyJyxcblx0XHRcdFx0XHRcdFx0J2RhdGEtbWNlLWJvZ3VzJzogJ2FsbCdcblx0XHRcdFx0XHRcdH0sIHN0YXJ0VyArICcgJnRpbWVzOyAnICsgc3RhcnRIKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAobW91c2VEb3duSGFuZGxlTmFtZSkge1xuXHRcdFx0XHRcdFx0Ly8gRHJhZyBzdGFydGVkIGJ5IElFIG5hdGl2ZSByZXNpemVzdGFydFxuXHRcdFx0XHRcdFx0aWYgKG5hbWUgPT0gbW91c2VEb3duSGFuZGxlTmFtZSkge1xuXHRcdFx0XHRcdFx0XHRzdGFydERyYWcobW91c2VEb3duRXZlbnQpO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Ly8gR2V0IGV4aXN0aW5nIG9yIHJlbmRlciByZXNpemUgaGFuZGxlXG5cdFx0XHRcdFx0aGFuZGxlRWxtID0gZG9tLmdldCgnbWNlUmVzaXplSGFuZGxlJyArIG5hbWUpO1xuXHRcdFx0XHRcdGlmIChoYW5kbGVFbG0pIHtcblx0XHRcdFx0XHRcdGRvbS5yZW1vdmUoaGFuZGxlRWxtKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRoYW5kbGVFbG0gPSBkb20uYWRkKHJvb3RFbGVtZW50LCAnZGl2Jywge1xuXHRcdFx0XHRcdFx0aWQ6ICdtY2VSZXNpemVIYW5kbGUnICsgbmFtZSxcblx0XHRcdFx0XHRcdCdkYXRhLW1jZS1ib2d1cyc6ICdhbGwnLFxuXHRcdFx0XHRcdFx0J2NsYXNzJzogJ21jZS1yZXNpemVoYW5kbGUnLFxuXHRcdFx0XHRcdFx0dW5zZWxlY3RhYmxlOiB0cnVlLFxuXHRcdFx0XHRcdFx0c3R5bGU6ICdjdXJzb3I6JyArIG5hbWUgKyAnLXJlc2l6ZTsgbWFyZ2luOjA7IHBhZGRpbmc6MCdcblx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdC8vIEhpZGVzIElFIG1vdmUgbGF5ZXIgY3Vyc29yXG5cdFx0XHRcdFx0Ly8gSWYgd2Ugc2V0IGl0IG9uIENocm9tZSB3ZSBnZXQgdGhpcyB3b3VuZGVyZnVsIGJ1ZzogIzY3MjVcblx0XHRcdFx0XHRpZiAoRW52LmllKSB7XG5cdFx0XHRcdFx0XHRoYW5kbGVFbG0uY29udGVudEVkaXRhYmxlID0gZmFsc2U7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0ZG9tLmJpbmQoaGFuZGxlRWxtLCAnbW91c2Vkb3duJywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRcdFx0ZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcblx0XHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHRcdHN0YXJ0RHJhZyhlKTtcblx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdGhhbmRsZS5lbG0gPSBoYW5kbGVFbG07XG5cblx0XHRcdFx0XHQvLyBQb3NpdGlvbiBlbGVtZW50XG5cdFx0XHRcdFx0ZG9tLnNldFN0eWxlcyhoYW5kbGVFbG0sIHtcblx0XHRcdFx0XHRcdGxlZnQ6ICh0YXJnZXRXaWR0aCAqIGhhbmRsZVswXSArIHNlbGVjdGVkRWxtWCkgLSAoaGFuZGxlRWxtLm9mZnNldFdpZHRoIC8gMiksXG5cdFx0XHRcdFx0XHR0b3A6ICh0YXJnZXRIZWlnaHQgKiBoYW5kbGVbMV0gKyBzZWxlY3RlZEVsbVkpIC0gKGhhbmRsZUVsbS5vZmZzZXRIZWlnaHQgLyAyKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGhpZGVSZXNpemVSZWN0KCk7XG5cdFx0XHR9XG5cblx0XHRcdHNlbGVjdGVkRWxtLnNldEF0dHJpYnV0ZSgnZGF0YS1tY2Utc2VsZWN0ZWQnLCAnMScpO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIGhpZGVSZXNpemVSZWN0KCkge1xuXHRcdFx0dmFyIG5hbWUsIGhhbmRsZUVsbTtcblxuXHRcdFx0dW5iaW5kUmVzaXplSGFuZGxlRXZlbnRzKCk7XG5cblx0XHRcdGlmIChzZWxlY3RlZEVsbSkge1xuXHRcdFx0XHRzZWxlY3RlZEVsbS5yZW1vdmVBdHRyaWJ1dGUoJ2RhdGEtbWNlLXNlbGVjdGVkJyk7XG5cdFx0XHR9XG5cblx0XHRcdGZvciAobmFtZSBpbiByZXNpemVIYW5kbGVzKSB7XG5cdFx0XHRcdGhhbmRsZUVsbSA9IGRvbS5nZXQoJ21jZVJlc2l6ZUhhbmRsZScgKyBuYW1lKTtcblx0XHRcdFx0aWYgKGhhbmRsZUVsbSkge1xuXHRcdFx0XHRcdGRvbS51bmJpbmQoaGFuZGxlRWxtKTtcblx0XHRcdFx0XHRkb20ucmVtb3ZlKGhhbmRsZUVsbSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRmdW5jdGlvbiB1cGRhdGVSZXNpemVSZWN0KGUpIHtcblx0XHRcdHZhciBzdGFydEVsbSwgY29udHJvbEVsbTtcblxuXHRcdFx0ZnVuY3Rpb24gaXNDaGlsZE9yRXF1YWwobm9kZSwgcGFyZW50KSB7XG5cdFx0XHRcdGlmIChub2RlKSB7XG5cdFx0XHRcdFx0ZG8ge1xuXHRcdFx0XHRcdFx0aWYgKG5vZGUgPT09IHBhcmVudCkge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9IHdoaWxlICgobm9kZSA9IG5vZGUucGFyZW50Tm9kZSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdC8vIElnbm9yZSBhbGwgZXZlbnRzIHdoaWxlIHJlc2l6aW5nIG9yIGlmIHRoZSBlZGl0b3IgaW5zdGFuY2Ugd2FzIHJlbW92ZWRcblx0XHRcdGlmIChyZXNpemVTdGFydGVkIHx8IGVkaXRvci5yZW1vdmVkKSB7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0Ly8gUmVtb3ZlIGRhdGEtbWNlLXNlbGVjdGVkIGZyb20gYWxsIGVsZW1lbnRzIHNpbmNlIHRoZXkgbWlnaHQgaGF2ZSBiZWVuIGNvcGllZCB1c2luZyBDdHJsK2MvdlxuXHRcdFx0ZWFjaChkb20uc2VsZWN0KCdpbWdbZGF0YS1tY2Utc2VsZWN0ZWRdLGhyW2RhdGEtbWNlLXNlbGVjdGVkXScpLCBmdW5jdGlvbihpbWcpIHtcblx0XHRcdFx0aW1nLnJlbW92ZUF0dHJpYnV0ZSgnZGF0YS1tY2Utc2VsZWN0ZWQnKTtcblx0XHRcdH0pO1xuXG5cdFx0XHRjb250cm9sRWxtID0gZS50eXBlID09ICdtb3VzZWRvd24nID8gZS50YXJnZXQgOiBzZWxlY3Rpb24uZ2V0Tm9kZSgpO1xuXHRcdFx0Y29udHJvbEVsbSA9IGRvbS4kKGNvbnRyb2xFbG0pLmNsb3Nlc3QoaXNJRSA/ICd0YWJsZScgOiAndGFibGUsaW1nLGhyJylbMF07XG5cblx0XHRcdGlmIChpc0NoaWxkT3JFcXVhbChjb250cm9sRWxtLCByb290RWxlbWVudCkpIHtcblx0XHRcdFx0ZGlzYWJsZUdlY2tvUmVzaXplKCk7XG5cdFx0XHRcdHN0YXJ0RWxtID0gc2VsZWN0aW9uLmdldFN0YXJ0KHRydWUpO1xuXG5cdFx0XHRcdGlmIChpc0NoaWxkT3JFcXVhbChzdGFydEVsbSwgY29udHJvbEVsbSkgJiYgaXNDaGlsZE9yRXF1YWwoc2VsZWN0aW9uLmdldEVuZCh0cnVlKSwgY29udHJvbEVsbSkpIHtcblx0XHRcdFx0XHRpZiAoIWlzSUUgfHwgKGNvbnRyb2xFbG0gIT0gc3RhcnRFbG0gJiYgc3RhcnRFbG0ubm9kZU5hbWUgIT09ICdJTUcnKSkge1xuXHRcdFx0XHRcdFx0c2hvd1Jlc2l6ZVJlY3QoY29udHJvbEVsbSk7XG5cdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGhpZGVSZXNpemVSZWN0KCk7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gYXR0YWNoRXZlbnQoZWxtLCBuYW1lLCBmdW5jKSB7XG5cdFx0XHRpZiAoZWxtICYmIGVsbS5hdHRhY2hFdmVudCkge1xuXHRcdFx0XHRlbG0uYXR0YWNoRXZlbnQoJ29uJyArIG5hbWUsIGZ1bmMpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIGRldGFjaEV2ZW50KGVsbSwgbmFtZSwgZnVuYykge1xuXHRcdFx0aWYgKGVsbSAmJiBlbG0uZGV0YWNoRXZlbnQpIHtcblx0XHRcdFx0ZWxtLmRldGFjaEV2ZW50KCdvbicgKyBuYW1lLCBmdW5jKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRmdW5jdGlvbiByZXNpemVOYXRpdmVTdGFydChlKSB7XG5cdFx0XHR2YXIgdGFyZ2V0ID0gZS5zcmNFbGVtZW50LCBwb3MsIG5hbWUsIGNvcm5lciwgY29ybmVyWCwgY29ybmVyWSwgcmVsYXRpdmVYLCByZWxhdGl2ZVk7XG5cblx0XHRcdHBvcyA9IHRhcmdldC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblx0XHRcdHJlbGF0aXZlWCA9IGxhc3RNb3VzZURvd25FdmVudC5jbGllbnRYIC0gcG9zLmxlZnQ7XG5cdFx0XHRyZWxhdGl2ZVkgPSBsYXN0TW91c2VEb3duRXZlbnQuY2xpZW50WSAtIHBvcy50b3A7XG5cblx0XHRcdC8vIEZpZ3VyZSBvdXQgd2hhdCBjb3JuZXIgd2UgYXJlIGRyYWdpbmcgb25cblx0XHRcdGZvciAobmFtZSBpbiByZXNpemVIYW5kbGVzKSB7XG5cdFx0XHRcdGNvcm5lciA9IHJlc2l6ZUhhbmRsZXNbbmFtZV07XG5cblx0XHRcdFx0Y29ybmVyWCA9IHRhcmdldC5vZmZzZXRXaWR0aCAqIGNvcm5lclswXTtcblx0XHRcdFx0Y29ybmVyWSA9IHRhcmdldC5vZmZzZXRIZWlnaHQgKiBjb3JuZXJbMV07XG5cblx0XHRcdFx0aWYgKGFicyhjb3JuZXJYIC0gcmVsYXRpdmVYKSA8IDggJiYgYWJzKGNvcm5lclkgLSByZWxhdGl2ZVkpIDwgOCkge1xuXHRcdFx0XHRcdHNlbGVjdGVkSGFuZGxlID0gY29ybmVyO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdC8vIFJlbW92ZSBuYXRpdmUgc2VsZWN0aW9uIGFuZCBsZXQgdGhlIG1hZ2ljIGJlZ2luXG5cdFx0XHRyZXNpemVTdGFydGVkID0gdHJ1ZTtcblx0XHRcdGVkaXRvci5maXJlKCdPYmplY3RSZXNpemVTdGFydCcsIHtcblx0XHRcdFx0dGFyZ2V0OiBzZWxlY3RlZEVsbSxcblx0XHRcdFx0d2lkdGg6IHNlbGVjdGVkRWxtLmNsaWVudFdpZHRoLFxuXHRcdFx0XHRoZWlnaHQ6IHNlbGVjdGVkRWxtLmNsaWVudEhlaWdodFxuXHRcdFx0fSk7XG5cdFx0XHRlZGl0b3IuZ2V0RG9jKCkuc2VsZWN0aW9uLmVtcHR5KCk7XG5cdFx0XHRzaG93UmVzaXplUmVjdCh0YXJnZXQsIG5hbWUsIGxhc3RNb3VzZURvd25FdmVudCk7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gcHJldmVudERlZmF1bHQoZSkge1xuXHRcdFx0aWYgKGUucHJldmVudERlZmF1bHQpIHtcblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0ZS5yZXR1cm5WYWx1ZSA9IGZhbHNlOyAvLyBJRVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIGlzV2l0aGluQ29udGVudEVkaXRhYmxlRmFsc2UoZWxtKSB7XG5cdFx0XHRyZXR1cm4gaXNDb250ZW50RWRpdGFibGVGYWxzZShnZXRDb250ZW50RWRpdGFibGVSb290KGVkaXRvci5nZXRCb2R5KCksIGVsbSkpO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIG5hdGl2ZUNvbnRyb2xTZWxlY3QoZSkge1xuXHRcdFx0dmFyIHRhcmdldCA9IGUuc3JjRWxlbWVudDtcblxuXHRcdFx0aWYgKGlzV2l0aGluQ29udGVudEVkaXRhYmxlRmFsc2UodGFyZ2V0KSkge1xuXHRcdFx0XHRwcmV2ZW50RGVmYXVsdChlKTtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAodGFyZ2V0ICE9IHNlbGVjdGVkRWxtKSB7XG5cdFx0XHRcdGVkaXRvci5maXJlKCdPYmplY3RTZWxlY3RlZCcsIHt0YXJnZXQ6IHRhcmdldH0pO1xuXHRcdFx0XHRkZXRhY2hSZXNpemVTdGFydExpc3RlbmVyKCk7XG5cblx0XHRcdFx0aWYgKHRhcmdldC5pZC5pbmRleE9mKCdtY2VSZXNpemVIYW5kbGUnKSA9PT0gMCkge1xuXHRcdFx0XHRcdGUucmV0dXJuVmFsdWUgPSBmYWxzZTtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodGFyZ2V0Lm5vZGVOYW1lID09ICdJTUcnIHx8IHRhcmdldC5ub2RlTmFtZSA9PSAnVEFCTEUnKSB7XG5cdFx0XHRcdFx0aGlkZVJlc2l6ZVJlY3QoKTtcblx0XHRcdFx0XHRzZWxlY3RlZEVsbSA9IHRhcmdldDtcblx0XHRcdFx0XHRhdHRhY2hFdmVudCh0YXJnZXQsICdyZXNpemVzdGFydCcsIHJlc2l6ZU5hdGl2ZVN0YXJ0KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIGRldGFjaFJlc2l6ZVN0YXJ0TGlzdGVuZXIoKSB7XG5cdFx0XHRkZXRhY2hFdmVudChzZWxlY3RlZEVsbSwgJ3Jlc2l6ZXN0YXJ0JywgcmVzaXplTmF0aXZlU3RhcnQpO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIHVuYmluZFJlc2l6ZUhhbmRsZUV2ZW50cygpIHtcblx0XHRcdGZvciAodmFyIG5hbWUgaW4gcmVzaXplSGFuZGxlcykge1xuXHRcdFx0XHR2YXIgaGFuZGxlID0gcmVzaXplSGFuZGxlc1tuYW1lXTtcblxuXHRcdFx0XHRpZiAoaGFuZGxlLmVsbSkge1xuXHRcdFx0XHRcdGRvbS51bmJpbmQoaGFuZGxlLmVsbSk7XG5cdFx0XHRcdFx0ZGVsZXRlIGhhbmRsZS5lbG07XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRmdW5jdGlvbiBkaXNhYmxlR2Vja29SZXNpemUoKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHQvLyBEaXNhYmxlIG9iamVjdCByZXNpemluZyBvbiBHZWNrb1xuXHRcdFx0XHRlZGl0b3IuZ2V0RG9jKCkuZXhlY0NvbW1hbmQoJ2VuYWJsZU9iamVjdFJlc2l6aW5nJywgZmFsc2UsIGZhbHNlKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8vIElnbm9yZVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIGNvbnRyb2xTZWxlY3QoZWxtKSB7XG5cdFx0XHR2YXIgY3RybFJuZztcblxuXHRcdFx0aWYgKCFpc0lFKSB7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0Y3RybFJuZyA9IGVkaXRhYmxlRG9jLmJvZHkuY3JlYXRlQ29udHJvbFJhbmdlKCk7XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdGN0cmxSbmcuYWRkRWxlbWVudChlbG0pO1xuXHRcdFx0XHRjdHJsUm5nLnNlbGVjdCgpO1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8vIElnbm9yZSBzaW5jZSB0aGUgZWxlbWVudCBjYW4ndCBiZSBjb250cm9sIHNlbGVjdGVkIGZvciBleGFtcGxlIGEgUCB0YWdcblx0XHRcdH1cblx0XHR9XG5cblx0XHRlZGl0b3Iub24oJ2luaXQnLCBmdW5jdGlvbigpIHtcblx0XHRcdGlmIChpc0lFKSB7XG5cdFx0XHRcdC8vIEhpZGUgdGhlIHJlc2l6ZSByZWN0IG9uIHJlc2l6ZSBhbmQgcmVzZWxlY3QgdGhlIGltYWdlXG5cdFx0XHRcdGVkaXRvci5vbignT2JqZWN0UmVzaXplZCcsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0XHRpZiAoZS50YXJnZXQubm9kZU5hbWUgIT0gJ1RBQkxFJykge1xuXHRcdFx0XHRcdFx0aGlkZVJlc2l6ZVJlY3QoKTtcblx0XHRcdFx0XHRcdGNvbnRyb2xTZWxlY3QoZS50YXJnZXQpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0YXR0YWNoRXZlbnQocm9vdEVsZW1lbnQsICdjb250cm9sc2VsZWN0JywgbmF0aXZlQ29udHJvbFNlbGVjdCk7XG5cblx0XHRcdFx0ZWRpdG9yLm9uKCdtb3VzZWRvd24nLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdFx0bGFzdE1vdXNlRG93bkV2ZW50ID0gZTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRkaXNhYmxlR2Vja29SZXNpemUoKTtcblxuXHRcdFx0XHQvLyBTbmlmZiBzbmlmZiwgaGFyZCB0byBmZWF0dXJlIGRldGVjdCB0aGlzIHN0dWZmXG5cdFx0XHRcdGlmIChFbnYuaWUgPj0gMTEpIHtcblx0XHRcdFx0XHQvLyBOZWVkcyB0byBiZSBtb3VzZWRvd24gZm9yIGRyYWcvZHJvcCB0byB3b3JrIG9uIElFIDExXG5cdFx0XHRcdFx0Ly8gTmVlZHMgdG8gYmUgY2xpY2sgb24gRWRnZSB0byBwcm9wZXJseSBzZWxlY3QgaW1hZ2VzXG5cdFx0XHRcdFx0ZWRpdG9yLm9uKCdtb3VzZWRvd24gY2xpY2snLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdFx0XHR2YXIgdGFyZ2V0ID0gZS50YXJnZXQsIG5vZGVOYW1lID0gdGFyZ2V0Lm5vZGVOYW1lO1xuXG5cdFx0XHRcdFx0XHRpZiAoIXJlc2l6ZVN0YXJ0ZWQgJiYgL14oVEFCTEV8SU1HfEhSKSQvLnRlc3Qobm9kZU5hbWUpICYmICFpc1dpdGhpbkNvbnRlbnRFZGl0YWJsZUZhbHNlKHRhcmdldCkpIHtcblx0XHRcdFx0XHRcdFx0ZWRpdG9yLnNlbGVjdGlvbi5zZWxlY3QodGFyZ2V0LCBub2RlTmFtZSA9PSAnVEFCTEUnKTtcblxuXHRcdFx0XHRcdFx0XHQvLyBPbmx5IGZpcmUgb25jZSBzaW5jZSBub2RlQ2hhbmdlIGlzIGV4cGVuc2l2ZVxuXHRcdFx0XHRcdFx0XHRpZiAoZS50eXBlID09ICdtb3VzZWRvd24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0ZWRpdG9yLm5vZGVDaGFuZ2VkKCk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdGVkaXRvci5kb20uYmluZChyb290RWxlbWVudCwgJ21zY29udHJvbHNlbGVjdCcsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0XHRcdGZ1bmN0aW9uIGRlbGF5ZWRTZWxlY3Qobm9kZSkge1xuXHRcdFx0XHRcdFx0XHREZWxheS5zZXRFZGl0b3JUaW1lb3V0KGVkaXRvciwgZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0XHRcdFx0ZWRpdG9yLnNlbGVjdGlvbi5zZWxlY3Qobm9kZSk7XG5cdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRpZiAoaXNXaXRoaW5Db250ZW50RWRpdGFibGVGYWxzZShlLnRhcmdldCkpIHtcblx0XHRcdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRcdFx0XHRkZWxheWVkU2VsZWN0KGUudGFyZ2V0KTtcblx0XHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRpZiAoL14oVEFCTEV8SU1HfEhSKSQvLnRlc3QoZS50YXJnZXQubm9kZU5hbWUpKSB7XG5cdFx0XHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdFx0XHRcdFx0XHQvLyBUaGlzIG1vdmVzIHRoZSBzZWxlY3Rpb24gZnJvbSBiZWluZyBhIGNvbnRyb2wgc2VsZWN0aW9uIHRvIGEgdGV4dCBsaWtlIHNlbGVjdGlvbiBsaWtlIGluIFdlYktpdCAjNjc1M1xuXHRcdFx0XHRcdFx0XHQvLyBUT0RPOiBGaXggdGhpcyB0aGUgZGF5IElFIHdvcmtzIGxpa2Ugb3RoZXIgYnJvd3NlcnMgd2l0aG91dCB0aGlzIG5hc3R5IG5hdGl2ZSB1Z2x5IGNvbnRyb2wgc2VsZWN0aW9ucy5cblx0XHRcdFx0XHRcdFx0aWYgKGUudGFyZ2V0LnRhZ05hbWUgPT0gJ0lNRycpIHtcblx0XHRcdFx0XHRcdFx0XHRkZWxheWVkU2VsZWN0KGUudGFyZ2V0KTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHZhciB0aHJvdHRsZWRVcGRhdGVSZXNpemVSZWN0ID0gRGVsYXkudGhyb3R0bGUoZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRpZiAoIWVkaXRvci5jb21wb3NpbmcpIHtcblx0XHRcdFx0XHR1cGRhdGVSZXNpemVSZWN0KGUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0ZWRpdG9yLm9uKCdub2RlY2hhbmdlIFJlc2l6ZUVkaXRvciBSZXNpemVXaW5kb3cgZHJvcCcsIHRocm90dGxlZFVwZGF0ZVJlc2l6ZVJlY3QpO1xuXG5cdFx0XHQvLyBVcGRhdGUgcmVzaXplIHJlY3Qgd2hpbGUgdHlwaW5nIGluIGEgdGFibGVcblx0XHRcdGVkaXRvci5vbigna2V5dXAgY29tcG9zaXRpb25lbmQnLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdC8vIERvbid0IHVwZGF0ZSB0aGUgcmVzaXplIHJlY3Qgd2hpbGUgY29tcG9zaW5nIHNpbmNlIGl0IGJsb3dzIGF3YXkgdGhlIElNRSBzZWU6ICMyNzEwXG5cdFx0XHRcdGlmIChzZWxlY3RlZEVsbSAmJiBzZWxlY3RlZEVsbS5ub2RlTmFtZSA9PSBcIlRBQkxFXCIpIHtcblx0XHRcdFx0XHR0aHJvdHRsZWRVcGRhdGVSZXNpemVSZWN0KGUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0ZWRpdG9yLm9uKCdoaWRlIGJsdXInLCBoaWRlUmVzaXplUmVjdCk7XG5cblx0XHRcdC8vIEhpZGUgcmVjdCBvbiBmb2N1c291dCBzaW5jZSBpdCB3b3VsZCBmbG9hdCBvbiB0b3Agb2Ygd2luZG93cyBvdGhlcndpc2Vcblx0XHRcdC8vZWRpdG9yLm9uKCdmb2N1c291dCcsIGhpZGVSZXNpemVSZWN0KTtcblx0XHR9KTtcblxuXHRcdGVkaXRvci5vbigncmVtb3ZlJywgdW5iaW5kUmVzaXplSGFuZGxlRXZlbnRzKTtcblxuXHRcdGZ1bmN0aW9uIGRlc3Ryb3koKSB7XG5cdFx0XHRzZWxlY3RlZEVsbSA9IHNlbGVjdGVkRWxtR2hvc3QgPSBudWxsO1xuXG5cdFx0XHRpZiAoaXNJRSkge1xuXHRcdFx0XHRkZXRhY2hSZXNpemVTdGFydExpc3RlbmVyKCk7XG5cdFx0XHRcdGRldGFjaEV2ZW50KHJvb3RFbGVtZW50LCAnY29udHJvbHNlbGVjdCcsIG5hdGl2ZUNvbnRyb2xTZWxlY3QpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiB7XG5cdFx0XHRpc1Jlc2l6YWJsZTogaXNSZXNpemFibGUsXG5cdFx0XHRzaG93UmVzaXplUmVjdDogc2hvd1Jlc2l6ZVJlY3QsXG5cdFx0XHRoaWRlUmVzaXplUmVjdDogaGlkZVJlc2l6ZVJlY3QsXG5cdFx0XHR1cGRhdGVSZXNpemVSZWN0OiB1cGRhdGVSZXNpemVSZWN0LFxuXHRcdFx0Y29udHJvbFNlbGVjdDogY29udHJvbFNlbGVjdCxcblx0XHRcdGRlc3Ryb3k6IGRlc3Ryb3lcblx0XHR9O1xuXHR9O1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy91dGlsL0Z1bi5qc1xuXG4vKipcbiAqIEZ1bi5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE1IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKipcbiAqIEZ1bmN0aW9uYWwgdXRpbGl0eSBjbGFzcy5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQGNsYXNzIHRpbnltY2UudXRpbC5GdW5cbiAqL1xuZGVmaW5lKFwidGlueW1jZS91dGlsL0Z1blwiLCBbXSwgZnVuY3Rpb24oKSB7XG5cdHZhciBzbGljZSA9IFtdLnNsaWNlO1xuXG5cdGZ1bmN0aW9uIGNvbnN0YW50KHZhbHVlKSB7XG5cdFx0cmV0dXJuIGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdH07XG5cdH1cblxuXHRmdW5jdGlvbiBuZWdhdGUocHJlZGljYXRlKSB7XG5cdFx0cmV0dXJuIGZ1bmN0aW9uKHgpIHtcblx0XHRcdHJldHVybiAhcHJlZGljYXRlKHgpO1xuXHRcdH07XG5cdH1cblxuXHRmdW5jdGlvbiBjb21wb3NlKGYsIGcpIHtcblx0XHRyZXR1cm4gZnVuY3Rpb24oeCkge1xuXHRcdFx0cmV0dXJuIGYoZyh4KSk7XG5cdFx0fTtcblx0fVxuXG5cdGZ1bmN0aW9uIG9yKCkge1xuXHRcdHZhciBhcmdzID0gc2xpY2UuY2FsbChhcmd1bWVudHMpO1xuXG5cdFx0cmV0dXJuIGZ1bmN0aW9uKHgpIHtcblx0XHRcdGZvciAodmFyIGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7IGkrKykge1xuXHRcdFx0XHRpZiAoYXJnc1tpXSh4KSkge1xuXHRcdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9O1xuXHR9XG5cblx0ZnVuY3Rpb24gYW5kKCkge1xuXHRcdHZhciBhcmdzID0gc2xpY2UuY2FsbChhcmd1bWVudHMpO1xuXG5cdFx0cmV0dXJuIGZ1bmN0aW9uKHgpIHtcblx0XHRcdGZvciAodmFyIGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7IGkrKykge1xuXHRcdFx0XHRpZiAoIWFyZ3NbaV0oeCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0fTtcblx0fVxuXG5cdGZ1bmN0aW9uIGN1cnJ5KGZuKSB7XG5cdFx0dmFyIGFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cyk7XG5cblx0XHRpZiAoYXJncy5sZW5ndGggLSAxID49IGZuLmxlbmd0aCkge1xuXHRcdFx0cmV0dXJuIGZuLmFwcGx5KHRoaXMsIGFyZ3Muc2xpY2UoMSkpO1xuXHRcdH1cblxuXHRcdHJldHVybiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciB0ZW1wQXJncyA9IGFyZ3MuY29uY2F0KFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzKSk7XG5cdFx0XHRyZXR1cm4gY3VycnkuYXBwbHkodGhpcywgdGVtcEFyZ3MpO1xuXHRcdH07XG5cdH1cblxuXHRmdW5jdGlvbiBub29wKCkge1xuXHR9XG5cblx0cmV0dXJuIHtcblx0XHRjb25zdGFudDogY29uc3RhbnQsXG5cdFx0bmVnYXRlOiBuZWdhdGUsXG5cdFx0YW5kOiBhbmQsXG5cdFx0b3I6IG9yLFxuXHRcdGN1cnJ5OiBjdXJyeSxcblx0XHRjb21wb3NlOiBjb21wb3NlLFxuXHRcdG5vb3A6IG5vb3Bcblx0fTtcbn0pO1xuXG4vLyBJbmNsdWRlZCBmcm9tOiBqcy90aW55bWNlL2NsYXNzZXMvY2FyZXQvQ2FyZXRDYW5kaWRhdGUuanNcblxuLyoqXG4gKiBDYXJldENhbmRpZGF0ZS5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE1IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKipcbiAqIFRoaXMgbW9kdWxlIGNvbnRhaW5zIGxvZ2ljIGZvciBoYW5kbGluZyBjYXJldCBjYW5kaWRhdGVzLiBBIGNhcmV0IGNhbmRpZGF0ZSBpc1xuICogZm9yIGV4YW1wbGUgdGV4dCBub2RlcywgaW1hZ2VzLCBpbnB1dCBlbGVtZW50cywgY0U9ZmFsc2UgZWxlbWVudHMgZXRjLlxuICpcbiAqIEBwcml2YXRlXG4gKiBAY2xhc3MgdGlueW1jZS5jYXJldC5DYXJldENhbmRpZGF0ZVxuICovXG5kZWZpbmUoXCJ0aW55bWNlL2NhcmV0L0NhcmV0Q2FuZGlkYXRlXCIsIFtcblx0XCJ0aW55bWNlL2RvbS9Ob2RlVHlwZVwiLFxuXHRcInRpbnltY2UvdXRpbC9BcnJcIixcblx0XCJ0aW55bWNlL2NhcmV0L0NhcmV0Q29udGFpbmVyXCJcbl0sIGZ1bmN0aW9uKE5vZGVUeXBlLCBBcnIsIENhcmV0Q29udGFpbmVyKSB7XG5cdHZhciBpc0NvbnRlbnRFZGl0YWJsZVRydWUgPSBOb2RlVHlwZS5pc0NvbnRlbnRFZGl0YWJsZVRydWUsXG5cdFx0aXNDb250ZW50RWRpdGFibGVGYWxzZSA9IE5vZGVUeXBlLmlzQ29udGVudEVkaXRhYmxlRmFsc2UsXG5cdFx0aXNCciA9IE5vZGVUeXBlLmlzQnIsXG5cdFx0aXNUZXh0ID0gTm9kZVR5cGUuaXNUZXh0LFxuXHRcdGlzSW52YWxpZFRleHRFbGVtZW50ID0gTm9kZVR5cGUubWF0Y2hOb2RlTmFtZXMoJ3NjcmlwdCBzdHlsZSB0ZXh0YXJlYScpLFxuXHRcdGlzQXRvbWljSW5saW5lID0gTm9kZVR5cGUubWF0Y2hOb2RlTmFtZXMoJ2ltZyBpbnB1dCB0ZXh0YXJlYSBociBpZnJhbWUgdmlkZW8gYXVkaW8gb2JqZWN0JyksXG5cdFx0aXNUYWJsZSA9IE5vZGVUeXBlLm1hdGNoTm9kZU5hbWVzKCd0YWJsZScpLFxuXHRcdGlzQ2FyZXRDb250YWluZXIgPSBDYXJldENvbnRhaW5lci5pc0NhcmV0Q29udGFpbmVyO1xuXG5cdGZ1bmN0aW9uIGlzQ2FyZXRDYW5kaWRhdGUobm9kZSkge1xuXHRcdGlmIChpc0NhcmV0Q29udGFpbmVyKG5vZGUpKSB7XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXG5cdFx0aWYgKGlzVGV4dChub2RlKSkge1xuXHRcdFx0aWYgKGlzSW52YWxpZFRleHRFbGVtZW50KG5vZGUucGFyZW50Tm9kZSkpIHtcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHR9XG5cblx0XHRyZXR1cm4gaXNBdG9taWNJbmxpbmUobm9kZSkgfHwgaXNCcihub2RlKSB8fCBpc1RhYmxlKG5vZGUpIHx8IGlzQ29udGVudEVkaXRhYmxlRmFsc2Uobm9kZSk7XG5cdH1cblxuXHRmdW5jdGlvbiBpc0luRWRpdGFibGUobm9kZSwgcm9vdE5vZGUpIHtcblx0XHRmb3IgKG5vZGUgPSBub2RlLnBhcmVudE5vZGU7IG5vZGUgJiYgbm9kZSAhPSByb290Tm9kZTsgbm9kZSA9IG5vZGUucGFyZW50Tm9kZSkge1xuXHRcdFx0aWYgKGlzQ29udGVudEVkaXRhYmxlRmFsc2Uobm9kZSkpIHtcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoaXNDb250ZW50RWRpdGFibGVUcnVlKG5vZGUpKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0ZnVuY3Rpb24gaXNBdG9taWNDb250ZW50RWRpdGFibGVGYWxzZShub2RlKSB7XG5cdFx0aWYgKCFpc0NvbnRlbnRFZGl0YWJsZUZhbHNlKG5vZGUpKSB7XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIEFyci5yZWR1Y2Uobm9kZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnKicpLCBmdW5jdGlvbihyZXN1bHQsIGVsbSkge1xuXHRcdFx0cmV0dXJuIHJlc3VsdCB8fCBpc0NvbnRlbnRFZGl0YWJsZVRydWUoZWxtKTtcblx0XHR9LCBmYWxzZSkgIT09IHRydWU7XG5cdH1cblxuXHRmdW5jdGlvbiBpc0F0b21pYyhub2RlKSB7XG5cdFx0cmV0dXJuIGlzQXRvbWljSW5saW5lKG5vZGUpIHx8IGlzQXRvbWljQ29udGVudEVkaXRhYmxlRmFsc2Uobm9kZSk7XG5cdH1cblxuXHRmdW5jdGlvbiBpc0VkaXRhYmxlQ2FyZXRDYW5kaWRhdGUobm9kZSwgcm9vdE5vZGUpIHtcblx0XHRyZXR1cm4gaXNDYXJldENhbmRpZGF0ZShub2RlKSAmJiBpc0luRWRpdGFibGUobm9kZSwgcm9vdE5vZGUpO1xuXHR9XG5cblx0cmV0dXJuIHtcblx0XHRpc0NhcmV0Q2FuZGlkYXRlOiBpc0NhcmV0Q2FuZGlkYXRlLFxuXHRcdGlzSW5FZGl0YWJsZTogaXNJbkVkaXRhYmxlLFxuXHRcdGlzQXRvbWljOiBpc0F0b21pYyxcblx0XHRpc0VkaXRhYmxlQ2FyZXRDYW5kaWRhdGU6IGlzRWRpdGFibGVDYXJldENhbmRpZGF0ZVxuXHR9O1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy9nZW9tL0NsaWVudFJlY3QuanNcblxuLyoqXG4gKiBDbGllbnRSZWN0LmpzXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgTEdQTCBMaWNlbnNlLlxuICogQ29weXJpZ2h0IChjKSAxOTk5LTIwMTUgRXBob3ggQ29ycC4gQWxsIHJpZ2h0cyByZXNlcnZlZFxuICpcbiAqIExpY2Vuc2U6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vbGljZW5zZVxuICogQ29udHJpYnV0aW5nOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2NvbnRyaWJ1dGluZ1xuICovXG5cbi8qKlxuICogVXRpbGl0eSBmdW5jdGlvbnMgZm9yIHdvcmtpbmcgd2l0aCBjbGllbnQgcmVjdHMuXG4gKlxuICogQHByaXZhdGVcbiAqIEBjbGFzcyB0aW55bWNlLmdlb20uQ2xpZW50UmVjdFxuICovXG5kZWZpbmUoXCJ0aW55bWNlL2dlb20vQ2xpZW50UmVjdFwiLCBbXSwgZnVuY3Rpb24oKSB7XG5cdHZhciByb3VuZCA9IE1hdGgucm91bmQ7XG5cblx0ZnVuY3Rpb24gY2xvbmUocmVjdCkge1xuXHRcdGlmICghcmVjdCkge1xuXHRcdFx0cmV0dXJuIHtsZWZ0OiAwLCB0b3A6IDAsIGJvdHRvbTogMCwgcmlnaHQ6IDAsIHdpZHRoOiAwLCBoZWlnaHQ6IDB9O1xuXHRcdH1cblxuXHRcdHJldHVybiB7XG5cdFx0XHRsZWZ0OiByb3VuZChyZWN0LmxlZnQpLFxuXHRcdFx0dG9wOiByb3VuZChyZWN0LnRvcCksXG5cdFx0XHRib3R0b206IHJvdW5kKHJlY3QuYm90dG9tKSxcblx0XHRcdHJpZ2h0OiByb3VuZChyZWN0LnJpZ2h0KSxcblx0XHRcdHdpZHRoOiByb3VuZChyZWN0LndpZHRoKSxcblx0XHRcdGhlaWdodDogcm91bmQocmVjdC5oZWlnaHQpXG5cdFx0fTtcblx0fVxuXG5cdGZ1bmN0aW9uIGNvbGxhcHNlKGNsaWVudFJlY3QsIHRvU3RhcnQpIHtcblx0XHRjbGllbnRSZWN0ID0gY2xvbmUoY2xpZW50UmVjdCk7XG5cblx0XHRpZiAodG9TdGFydCkge1xuXHRcdFx0Y2xpZW50UmVjdC5yaWdodCA9IGNsaWVudFJlY3QubGVmdDtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Y2xpZW50UmVjdC5sZWZ0ID0gY2xpZW50UmVjdC5sZWZ0ICsgY2xpZW50UmVjdC53aWR0aDtcblx0XHRcdGNsaWVudFJlY3QucmlnaHQgPSBjbGllbnRSZWN0LmxlZnQ7XG5cdFx0fVxuXG5cdFx0Y2xpZW50UmVjdC53aWR0aCA9IDA7XG5cblx0XHRyZXR1cm4gY2xpZW50UmVjdDtcblx0fVxuXG5cdGZ1bmN0aW9uIGlzRXF1YWwocmVjdDEsIHJlY3QyKSB7XG5cdFx0cmV0dXJuIChcblx0XHRcdHJlY3QxLmxlZnQgPT09IHJlY3QyLmxlZnQgJiZcblx0XHRcdHJlY3QxLnRvcCA9PT0gcmVjdDIudG9wICYmXG5cdFx0XHRyZWN0MS5ib3R0b20gPT09IHJlY3QyLmJvdHRvbSAmJlxuXHRcdFx0cmVjdDEucmlnaHQgPT09IHJlY3QyLnJpZ2h0XG5cdFx0KTtcblx0fVxuXG5cdGZ1bmN0aW9uIGlzVmFsaWRPdmVyZmxvdyhvdmVyZmxvd1ksIGNsaWVudFJlY3QxLCBjbGllbnRSZWN0Mikge1xuXHRcdHJldHVybiBvdmVyZmxvd1kgPj0gMCAmJiBvdmVyZmxvd1kgPD0gTWF0aC5taW4oY2xpZW50UmVjdDEuaGVpZ2h0LCBjbGllbnRSZWN0Mi5oZWlnaHQpIC8gMjtcblxuXHR9XG5cblx0ZnVuY3Rpb24gaXNBYm92ZShjbGllbnRSZWN0MSwgY2xpZW50UmVjdDIpIHtcblx0XHRpZiAoY2xpZW50UmVjdDEuYm90dG9tIDwgY2xpZW50UmVjdDIudG9wKSB7XG5cdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHR9XG5cblx0XHRpZiAoY2xpZW50UmVjdDEudG9wID4gY2xpZW50UmVjdDIuYm90dG9tKSB7XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGlzVmFsaWRPdmVyZmxvdyhjbGllbnRSZWN0Mi50b3AgLSBjbGllbnRSZWN0MS5ib3R0b20sIGNsaWVudFJlY3QxLCBjbGllbnRSZWN0Mik7XG5cdH1cblxuXHRmdW5jdGlvbiBpc0JlbG93KGNsaWVudFJlY3QxLCBjbGllbnRSZWN0Mikge1xuXHRcdGlmIChjbGllbnRSZWN0MS50b3AgPiBjbGllbnRSZWN0Mi5ib3R0b20pIHtcblx0XHRcdHJldHVybiB0cnVlO1xuXHRcdH1cblxuXHRcdGlmIChjbGllbnRSZWN0MS5ib3R0b20gPCBjbGllbnRSZWN0Mi50b3ApIHtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cblx0XHRyZXR1cm4gaXNWYWxpZE92ZXJmbG93KGNsaWVudFJlY3QyLmJvdHRvbSAtIGNsaWVudFJlY3QxLnRvcCwgY2xpZW50UmVjdDEsIGNsaWVudFJlY3QyKTtcblx0fVxuXG5cdGZ1bmN0aW9uIGlzTGVmdChjbGllbnRSZWN0MSwgY2xpZW50UmVjdDIpIHtcblx0XHRyZXR1cm4gY2xpZW50UmVjdDEubGVmdCA8IGNsaWVudFJlY3QyLmxlZnQ7XG5cdH1cblxuXHRmdW5jdGlvbiBpc1JpZ2h0KGNsaWVudFJlY3QxLCBjbGllbnRSZWN0Mikge1xuXHRcdHJldHVybiBjbGllbnRSZWN0MS5yaWdodCA+IGNsaWVudFJlY3QyLnJpZ2h0O1xuXHR9XG5cblx0ZnVuY3Rpb24gY29tcGFyZShjbGllbnRSZWN0MSwgY2xpZW50UmVjdDIpIHtcblx0XHRpZiAoaXNBYm92ZShjbGllbnRSZWN0MSwgY2xpZW50UmVjdDIpKSB7XG5cdFx0XHRyZXR1cm4gLTE7XG5cdFx0fVxuXG5cdFx0aWYgKGlzQmVsb3coY2xpZW50UmVjdDEsIGNsaWVudFJlY3QyKSkge1xuXHRcdFx0cmV0dXJuIDE7XG5cdFx0fVxuXG5cdFx0aWYgKGlzTGVmdChjbGllbnRSZWN0MSwgY2xpZW50UmVjdDIpKSB7XG5cdFx0XHRyZXR1cm4gLTE7XG5cdFx0fVxuXG5cdFx0aWYgKGlzUmlnaHQoY2xpZW50UmVjdDEsIGNsaWVudFJlY3QyKSkge1xuXHRcdFx0cmV0dXJuIDE7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIDA7XG5cdH1cblxuXHRmdW5jdGlvbiBjb250YWluc1hZKGNsaWVudFJlY3QsIGNsaWVudFgsIGNsaWVudFkpIHtcblx0XHRyZXR1cm4gKFxuXHRcdFx0Y2xpZW50WCA+PSBjbGllbnRSZWN0LmxlZnQgJiZcblx0XHRcdGNsaWVudFggPD0gY2xpZW50UmVjdC5yaWdodCAmJlxuXHRcdFx0Y2xpZW50WSA+PSBjbGllbnRSZWN0LnRvcCAmJlxuXHRcdFx0Y2xpZW50WSA8PSBjbGllbnRSZWN0LmJvdHRvbVxuXHRcdCk7XG5cdH1cblxuXHRyZXR1cm4ge1xuXHRcdGNsb25lOiBjbG9uZSxcblx0XHRjb2xsYXBzZTogY29sbGFwc2UsXG5cdFx0aXNFcXVhbDogaXNFcXVhbCxcblx0XHRpc0Fib3ZlOiBpc0Fib3ZlLFxuXHRcdGlzQmVsb3c6IGlzQmVsb3csXG5cdFx0aXNMZWZ0OiBpc0xlZnQsXG5cdFx0aXNSaWdodDogaXNSaWdodCxcblx0XHRjb21wYXJlOiBjb21wYXJlLFxuXHRcdGNvbnRhaW5zWFk6IGNvbnRhaW5zWFlcblx0fTtcbn0pO1xuXG4vLyBJbmNsdWRlZCBmcm9tOiBqcy90aW55bWNlL2NsYXNzZXMvdGV4dC9FeHRlbmRpbmdDaGFyLmpzXG5cbi8qKlxuICogRXh0ZW5kaW5nQ2hhci5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE1IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKipcbiAqIFRoaXMgY2xhc3MgY29udGFpbnMgbG9naWMgZm9yIGRldGVjdGluZyBleHRlbmRpbmcgY2hhcmFjdGVycy5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQGNsYXNzIHRpbnltY2UudGV4dC5FeHRlbmRpbmdDaGFyXG4gKiBAZXhhbXBsZVxuICogdmFyIGlzRXh0ZW5kaW5nID0gRXh0ZW5kaW5nQ2hhci5pc0V4dGVuZGluZ0NoYXIoJ2EnKTtcbiAqL1xuZGVmaW5lKFwidGlueW1jZS90ZXh0L0V4dGVuZGluZ0NoYXJcIiwgW10sIGZ1bmN0aW9uKCkge1xuXHQvLyBHZW5lcmF0ZWQgZnJvbTogaHR0cDovL3d3dy51bmljb2RlLm9yZy9QdWJsaWMvVU5JREFUQS9EZXJpdmVkQ29yZVByb3BlcnRpZXMudHh0XG5cdC8vIE9ubHkgaW5jbHVkZXMgdGhlIGNoYXJhY3RlcnMgaW4gdGhhdCBmaXQgaW50byBVQ1MtMiAxNiBiaXRcblx0dmFyIGV4dGVuZGluZ0NoYXJzID0gbmV3IFJlZ0V4cChcblx0XHRcIltcXHUwMzAwLVxcdTAzNkZcXHUwNDgzLVxcdTA0ODdcXHUwNDg4LVxcdTA0ODlcXHUwNTkxLVxcdTA1QkRcXHUwNUJGXFx1MDVDMS1cXHUwNUMyXFx1MDVDNC1cXHUwNUM1XFx1MDVDN1xcdTA2MTAtXFx1MDYxQVwiICtcblx0XHRcIlxcdTA2NEItXFx1MDY1RlxcdTA2NzBcXHUwNkQ2LVxcdTA2RENcXHUwNkRGLVxcdTA2RTRcXHUwNkU3LVxcdTA2RThcXHUwNkVBLVxcdTA2RURcXHUwNzExXFx1MDczMC1cXHUwNzRBXFx1MDdBNi1cXHUwN0IwXCIgK1xuXHRcdFwiXFx1MDdFQi1cXHUwN0YzXFx1MDgxNi1cXHUwODE5XFx1MDgxQi1cXHUwODIzXFx1MDgyNS1cXHUwODI3XFx1MDgyOS1cXHUwODJEXFx1MDg1OS1cXHUwODVCXFx1MDhFMy1cXHUwOTAyXFx1MDkzQVxcdTA5M0NcIiArXG5cdFx0XCJcXHUwOTQxLVxcdTA5NDhcXHUwOTREXFx1MDk1MS1cXHUwOTU3XFx1MDk2Mi1cXHUwOTYzXFx1MDk4MVxcdTA5QkNcXHUwOUJFXFx1MDlDMS1cXHUwOUM0XFx1MDlDRFxcdTA5RDdcXHUwOUUyLVxcdTA5RTNcIiArXG5cdFx0XCJcXHUwQTAxLVxcdTBBMDJcXHUwQTNDXFx1MEE0MS1cXHUwQTQyXFx1MEE0Ny1cXHUwQTQ4XFx1MEE0Qi1cXHUwQTREXFx1MEE1MVxcdTBBNzAtXFx1MEE3MVxcdTBBNzVcXHUwQTgxLVxcdTBBODJcXHUwQUJDXCIgK1xuXHRcdFwiXFx1MEFDMS1cXHUwQUM1XFx1MEFDNy1cXHUwQUM4XFx1MEFDRFxcdTBBRTItXFx1MEFFM1xcdTBCMDFcXHUwQjNDXFx1MEIzRVxcdTBCM0ZcXHUwQjQxLVxcdTBCNDRcXHUwQjREXFx1MEI1NlxcdTBCNTdcIiArXG5cdFx0XCJcXHUwQjYyLVxcdTBCNjNcXHUwQjgyXFx1MEJCRVxcdTBCQzBcXHUwQkNEXFx1MEJEN1xcdTBDMDBcXHUwQzNFLVxcdTBDNDBcXHUwQzQ2LVxcdTBDNDhcXHUwQzRBLVxcdTBDNERcXHUwQzU1LVxcdTBDNTZcIiArXG5cdFx0XCJcXHUwQzYyLVxcdTBDNjNcXHUwQzgxXFx1MENCQ1xcdTBDQkZcXHUwQ0MyXFx1MENDNlxcdTBDQ0MtXFx1MENDRFxcdTBDRDUtXFx1MENENlxcdTBDRTItXFx1MENFM1xcdTBEMDFcXHUwRDNFXFx1MEQ0MS1cXHUwRDQ0XCIgK1xuXHRcdFwiXFx1MEQ0RFxcdTBENTdcXHUwRDYyLVxcdTBENjNcXHUwRENBXFx1MERDRlxcdTBERDItXFx1MERENFxcdTBERDZcXHUwRERGXFx1MEUzMVxcdTBFMzQtXFx1MEUzQVxcdTBFNDctXFx1MEU0RVxcdTBFQjFcXHUwRUI0LVxcdTBFQjlcIiArXG5cdFx0XCJcXHUwRUJCLVxcdTBFQkNcXHUwRUM4LVxcdTBFQ0RcXHUwRjE4LVxcdTBGMTlcXHUwRjM1XFx1MEYzN1xcdTBGMzlcXHUwRjcxLVxcdTBGN0VcXHUwRjgwLVxcdTBGODRcXHUwRjg2LVxcdTBGODdcXHUwRjhELVxcdTBGOTdcIiArXG5cdFx0XCJcXHUwRjk5LVxcdTBGQkNcXHUwRkM2XFx1MTAyRC1cXHUxMDMwXFx1MTAzMi1cXHUxMDM3XFx1MTAzOS1cXHUxMDNBXFx1MTAzRC1cXHUxMDNFXFx1MTA1OC1cXHUxMDU5XFx1MTA1RS1cXHUxMDYwXFx1MTA3MS1cXHUxMDc0XCIgK1xuXHRcdFwiXFx1MTA4MlxcdTEwODUtXFx1MTA4NlxcdTEwOERcXHUxMDlEXFx1MTM1RC1cXHUxMzVGXFx1MTcxMi1cXHUxNzE0XFx1MTczMi1cXHUxNzM0XFx1MTc1Mi1cXHUxNzUzXFx1MTc3Mi1cXHUxNzczXFx1MTdCNC1cXHUxN0I1XCIgK1xuXHRcdFwiXFx1MTdCNy1cXHUxN0JEXFx1MTdDNlxcdTE3QzktXFx1MTdEM1xcdTE3RERcXHUxODBCLVxcdTE4MERcXHUxOEE5XFx1MTkyMC1cXHUxOTIyXFx1MTkyNy1cXHUxOTI4XFx1MTkzMlxcdTE5MzktXFx1MTkzQlxcdTFBMTctXFx1MUExOFwiICtcblx0XHRcIlxcdTFBMUJcXHUxQTU2XFx1MUE1OC1cXHUxQTVFXFx1MUE2MFxcdTFBNjJcXHUxQTY1LVxcdTFBNkNcXHUxQTczLVxcdTFBN0NcXHUxQTdGXFx1MUFCMC1cXHUxQUJEXFx1MUFCRVxcdTFCMDAtXFx1MUIwM1xcdTFCMzRcIiArXG5cdFx0XCJcXHUxQjM2LVxcdTFCM0FcXHUxQjNDXFx1MUI0MlxcdTFCNkItXFx1MUI3M1xcdTFCODAtXFx1MUI4MVxcdTFCQTItXFx1MUJBNVxcdTFCQTgtXFx1MUJBOVxcdTFCQUItXFx1MUJBRFxcdTFCRTZcXHUxQkU4LVxcdTFCRTlcIiArXG5cdFx0XCJcXHUxQkVEXFx1MUJFRi1cXHUxQkYxXFx1MUMyQy1cXHUxQzMzXFx1MUMzNi1cXHUxQzM3XFx1MUNEMC1cXHUxQ0QyXFx1MUNENC1cXHUxQ0UwXFx1MUNFMi1cXHUxQ0U4XFx1MUNFRFxcdTFDRjRcXHUxQ0Y4LVxcdTFDRjlcIiArXG5cdFx0XCJcXHUxREMwLVxcdTFERjVcXHUxREZDLVxcdTFERkZcXHUyMDBDLVxcdTIwMERcXHUyMEQwLVxcdTIwRENcXHUyMERELVxcdTIwRTBcXHUyMEUxXFx1MjBFMi1cXHUyMEU0XFx1MjBFNS1cXHUyMEYwXFx1MkNFRi1cXHUyQ0YxXCIgK1xuXHRcdFwiXFx1MkQ3RlxcdTJERTAtXFx1MkRGRlxcdTMwMkEtXFx1MzAyRFxcdTMwMkUtXFx1MzAyRlxcdTMwOTktXFx1MzA5QVxcdUE2NkZcXHVBNjcwLVxcdUE2NzJcXHVBNjc0LVxcdUE2N0RcXHVBNjlFLVxcdUE2OUZcXHVBNkYwLVxcdUE2RjFcIiArXG5cdFx0XCJcXHVBODAyXFx1QTgwNlxcdUE4MEJcXHVBODI1LVxcdUE4MjZcXHVBOEM0XFx1QThFMC1cXHVBOEYxXFx1QTkyNi1cXHVBOTJEXFx1QTk0Ny1cXHVBOTUxXFx1QTk4MC1cXHVBOTgyXFx1QTlCM1xcdUE5QjYtXFx1QTlCOVxcdUE5QkNcIiArXG5cdFx0XCJcXHVBOUU1XFx1QUEyOS1cXHVBQTJFXFx1QUEzMS1cXHVBQTMyXFx1QUEzNS1cXHVBQTM2XFx1QUE0M1xcdUFBNENcXHVBQTdDXFx1QUFCMFxcdUFBQjItXFx1QUFCNFxcdUFBQjctXFx1QUFCOFxcdUFBQkUtXFx1QUFCRlxcdUFBQzFcIiArXG5cdFx0XCJcXHVBQUVDLVxcdUFBRURcXHVBQUY2XFx1QUJFNVxcdUFCRThcXHVBQkVEXFx1RkIxRVxcdUZFMDAtXFx1RkUwRlxcdUZFMjAtXFx1RkUyRlxcdUZGOUUtXFx1RkY5Rl1cIlxuXHQpO1xuXG5cdGZ1bmN0aW9uIGlzRXh0ZW5kaW5nQ2hhcihjaCkge1xuXHRcdHJldHVybiB0eXBlb2YgY2ggPT0gXCJzdHJpbmdcIiAmJiBjaC5jaGFyQ29kZUF0KDApID49IDc2OCAmJiBleHRlbmRpbmdDaGFycy50ZXN0KGNoKTtcblx0fVxuXG5cdHJldHVybiB7XG5cdFx0aXNFeHRlbmRpbmdDaGFyOiBpc0V4dGVuZGluZ0NoYXJcblx0fTtcbn0pO1xuXG4vLyBJbmNsdWRlZCBmcm9tOiBqcy90aW55bWNlL2NsYXNzZXMvY2FyZXQvQ2FyZXRQb3NpdGlvbi5qc1xuXG4vKipcbiAqIENhcmV0UG9zaXRpb24uanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBUaGlzIG1vZHVsZSBjb250YWlucyBsb2dpYyBmb3IgY3JlYXRpbmcgY2FyZXQgcG9zaXRpb25zIHdpdGhpbiBhIGRvY3VtZW50IGEgY2FyZXRwb3NpdGlvblxuICogaXMgc2ltaWxhciB0byBhIERPTVJhbmdlIG9iamVjdCBidXQgaXQgZG9lc24ndCBoYXZlIHR3byBlbmRwb2ludHMgYW5kIGlzIGFsc28gbW9yZSBsaWdodHdlaWdodFxuICogc2luY2UgaXQncyBub3cgdXBkYXRlZCBsaXZlIHdoZW4gdGhlIERPTSBjaGFuZ2VzLlxuICpcbiAqIEBwcml2YXRlXG4gKiBAY2xhc3MgdGlueW1jZS5jYXJldC5DYXJldFBvc2l0aW9uXG4gKiBAZXhhbXBsZVxuICogdmFyIGNhcmV0UG9zMSA9IG5ldyBDYXJldFBvc2l0aW9uKGNvbnRhaW5lciwgb2Zmc2V0KTtcbiAqIHZhciBjYXJldFBvczIgPSBDYXJldFBvc2l0aW9uLmZyb21SYW5nZVN0YXJ0KHNvbWVSYW5nZSk7XG4gKi9cbmRlZmluZShcInRpbnltY2UvY2FyZXQvQ2FyZXRQb3NpdGlvblwiLCBbXG5cdFwidGlueW1jZS91dGlsL0Z1blwiLFxuXHRcInRpbnltY2UvZG9tL05vZGVUeXBlXCIsXG5cdFwidGlueW1jZS9kb20vRE9NVXRpbHNcIixcblx0XCJ0aW55bWNlL2RvbS9SYW5nZVV0aWxzXCIsXG5cdFwidGlueW1jZS9jYXJldC9DYXJldENhbmRpZGF0ZVwiLFxuXHRcInRpbnltY2UvZ2VvbS9DbGllbnRSZWN0XCIsXG5cdFwidGlueW1jZS90ZXh0L0V4dGVuZGluZ0NoYXJcIlxuXSwgZnVuY3Rpb24oRnVuLCBOb2RlVHlwZSwgRE9NVXRpbHMsIFJhbmdlVXRpbHMsIENhcmV0Q2FuZGlkYXRlLCBDbGllbnRSZWN0LCBFeHRlbmRpbmdDaGFyKSB7XG5cdHZhciBpc0VsZW1lbnQgPSBOb2RlVHlwZS5pc0VsZW1lbnQsXG5cdFx0aXNDYXJldENhbmRpZGF0ZSA9IENhcmV0Q2FuZGlkYXRlLmlzQ2FyZXRDYW5kaWRhdGUsXG5cdFx0aXNCbG9jayA9IE5vZGVUeXBlLm1hdGNoU3R5bGVWYWx1ZXMoJ2Rpc3BsYXknLCAnYmxvY2sgdGFibGUnKSxcblx0XHRpc0Zsb2F0ZWQgPSBOb2RlVHlwZS5tYXRjaFN0eWxlVmFsdWVzKCdmbG9hdCcsICdsZWZ0IHJpZ2h0JyksXG5cdFx0aXNWYWxpZEVsZW1lbnRDYXJldENhbmRpZGF0ZSA9IEZ1bi5hbmQoaXNFbGVtZW50LCBpc0NhcmV0Q2FuZGlkYXRlLCBGdW4ubmVnYXRlKGlzRmxvYXRlZCkpLFxuXHRcdGlzTm90UHJlID0gRnVuLm5lZ2F0ZShOb2RlVHlwZS5tYXRjaFN0eWxlVmFsdWVzKCd3aGl0ZS1zcGFjZScsICdwcmUgcHJlLWxpbmUgcHJlLXdyYXAnKSksXG5cdFx0aXNUZXh0ID0gTm9kZVR5cGUuaXNUZXh0LFxuXHRcdGlzQnIgPSBOb2RlVHlwZS5pc0JyLFxuXHRcdG5vZGVJbmRleCA9IERPTVV0aWxzLm5vZGVJbmRleCxcblx0XHRyZXNvbHZlSW5kZXggPSBSYW5nZVV0aWxzLmdldE5vZGU7XG5cblx0ZnVuY3Rpb24gY3JlYXRlUmFuZ2UoZG9jKSB7XG5cdFx0cmV0dXJuIFwiY3JlYXRlUmFuZ2VcIiBpbiBkb2MgPyBkb2MuY3JlYXRlUmFuZ2UoKSA6IERPTVV0aWxzLkRPTS5jcmVhdGVSbmcoKTtcblx0fVxuXG5cdGZ1bmN0aW9uIGlzV2hpdGVTcGFjZShjaHIpIHtcblx0XHRyZXR1cm4gY2hyICYmIC9bXFxyXFxuXFx0IF0vLnRlc3QoY2hyKTtcblx0fVxuXG5cdGZ1bmN0aW9uIGlzSGlkZGVuV2hpdGVTcGFjZVJhbmdlKHJhbmdlKSB7XG5cdFx0dmFyIGNvbnRhaW5lciA9IHJhbmdlLnN0YXJ0Q29udGFpbmVyLFxuXHRcdFx0b2Zmc2V0ID0gcmFuZ2Uuc3RhcnRPZmZzZXQsXG5cdFx0XHR0ZXh0O1xuXG5cdFx0aWYgKGlzV2hpdGVTcGFjZShyYW5nZS50b1N0cmluZygpKSAmJiBpc05vdFByZShjb250YWluZXIucGFyZW50Tm9kZSkpIHtcblx0XHRcdHRleHQgPSBjb250YWluZXIuZGF0YTtcblxuXHRcdFx0aWYgKGlzV2hpdGVTcGFjZSh0ZXh0W29mZnNldCAtIDFdKSB8fCBpc1doaXRlU3BhY2UodGV4dFtvZmZzZXQgKyAxXSkpIHtcblx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9XG5cblx0ZnVuY3Rpb24gZ2V0Q2FyZXRQb3NpdGlvbkNsaWVudFJlY3RzKGNhcmV0UG9zaXRpb24pIHtcblx0XHR2YXIgY2xpZW50UmVjdHMgPSBbXSwgYmVmb3JlTm9kZSwgbm9kZTtcblxuXHRcdC8vIEhhY2sgZm9yIG9sZGVyIFdlYktpdCB2ZXJzaW9ucyB0aGF0IGRvZXNuJ3Rcblx0XHQvLyBzdXBwb3J0IGdldEJvdW5kaW5nQ2xpZW50UmVjdCBvbiBCUiBlbGVtZW50c1xuXHRcdGZ1bmN0aW9uIGdldEJyQ2xpZW50UmVjdChick5vZGUpIHtcblx0XHRcdHZhciBkb2MgPSBick5vZGUub3duZXJEb2N1bWVudCxcblx0XHRcdFx0cm5nID0gY3JlYXRlUmFuZ2UoZG9jKSxcblx0XHRcdFx0bmJzcCA9IGRvYy5jcmVhdGVUZXh0Tm9kZSgnXFx1MDBhMCcpLFxuXHRcdFx0XHRwYXJlbnROb2RlID0gYnJOb2RlLnBhcmVudE5vZGUsXG5cdFx0XHRcdGNsaWVudFJlY3Q7XG5cblx0XHRcdHBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKG5ic3AsIGJyTm9kZSk7XG5cdFx0XHRybmcuc2V0U3RhcnQobmJzcCwgMCk7XG5cdFx0XHRybmcuc2V0RW5kKG5ic3AsIDEpO1xuXHRcdFx0Y2xpZW50UmVjdCA9IENsaWVudFJlY3QuY2xvbmUocm5nLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpKTtcblx0XHRcdHBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobmJzcCk7XG5cblx0XHRcdHJldHVybiBjbGllbnRSZWN0O1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIGdldEJvdW5kaW5nQ2xpZW50UmVjdChpdGVtKSB7XG5cdFx0XHR2YXIgY2xpZW50UmVjdCwgY2xpZW50UmVjdHM7XG5cblx0XHRcdGNsaWVudFJlY3RzID0gaXRlbS5nZXRDbGllbnRSZWN0cygpO1xuXHRcdFx0aWYgKGNsaWVudFJlY3RzLmxlbmd0aCA+IDApIHtcblx0XHRcdFx0Y2xpZW50UmVjdCA9IENsaWVudFJlY3QuY2xvbmUoY2xpZW50UmVjdHNbMF0pO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y2xpZW50UmVjdCA9IENsaWVudFJlY3QuY2xvbmUoaXRlbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChpc0JyKGl0ZW0pICYmIGNsaWVudFJlY3QubGVmdCA9PT0gMCkge1xuXHRcdFx0XHRyZXR1cm4gZ2V0QnJDbGllbnRSZWN0KGl0ZW0pO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gY2xpZW50UmVjdDtcblx0XHR9XG5cblx0XHRmdW5jdGlvbiBjb2xsYXBzZUFuZEluZmxhdGVXaWR0aChjbGllbnRSZWN0LCB0b1N0YXJ0KSB7XG5cdFx0XHRjbGllbnRSZWN0ID0gQ2xpZW50UmVjdC5jb2xsYXBzZShjbGllbnRSZWN0LCB0b1N0YXJ0KTtcblx0XHRcdGNsaWVudFJlY3Qud2lkdGggPSAxO1xuXHRcdFx0Y2xpZW50UmVjdC5yaWdodCA9IGNsaWVudFJlY3QubGVmdCArIDE7XG5cblx0XHRcdHJldHVybiBjbGllbnRSZWN0O1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIGFkZFVuaXF1ZUFuZFZhbGlkUmVjdChjbGllbnRSZWN0KSB7XG5cdFx0XHRpZiAoY2xpZW50UmVjdC5oZWlnaHQgPT09IDApIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoY2xpZW50UmVjdHMubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRpZiAoQ2xpZW50UmVjdC5pc0VxdWFsKGNsaWVudFJlY3QsIGNsaWVudFJlY3RzW2NsaWVudFJlY3RzLmxlbmd0aCAtIDFdKSkge1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRjbGllbnRSZWN0cy5wdXNoKGNsaWVudFJlY3QpO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIGFkZENoYXJhY3Rlck9mZnNldChjb250YWluZXIsIG9mZnNldCkge1xuXHRcdFx0dmFyIHJhbmdlID0gY3JlYXRlUmFuZ2UoY29udGFpbmVyLm93bmVyRG9jdW1lbnQpO1xuXG5cdFx0XHRpZiAob2Zmc2V0IDwgY29udGFpbmVyLmRhdGEubGVuZ3RoKSB7XG5cdFx0XHRcdGlmIChFeHRlbmRpbmdDaGFyLmlzRXh0ZW5kaW5nQ2hhcihjb250YWluZXIuZGF0YVtvZmZzZXRdKSkge1xuXHRcdFx0XHRcdHJldHVybiBjbGllbnRSZWN0cztcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIFdlYktpdCByZXR1cm5zIHR3byBjbGllbnQgcmVjdHMgZm9yIGEgcG9zaXRpb24gYWZ0ZXIgYW4gZXh0ZW5kaW5nXG5cdFx0XHRcdC8vIGNoYXJhY3RlciBhXFx1eHh4fGIgc28gZXhwYW5kIG9uIFwiYlwiIGFuZCBjb2xsYXBzZSB0byBzdGFydCBvZiBcImJcIiBib3hcblx0XHRcdFx0aWYgKEV4dGVuZGluZ0NoYXIuaXNFeHRlbmRpbmdDaGFyKGNvbnRhaW5lci5kYXRhW29mZnNldCAtIDFdKSkge1xuXHRcdFx0XHRcdHJhbmdlLnNldFN0YXJ0KGNvbnRhaW5lciwgb2Zmc2V0KTtcblx0XHRcdFx0XHRyYW5nZS5zZXRFbmQoY29udGFpbmVyLCBvZmZzZXQgKyAxKTtcblxuXHRcdFx0XHRcdGlmICghaXNIaWRkZW5XaGl0ZVNwYWNlUmFuZ2UocmFuZ2UpKSB7XG5cdFx0XHRcdFx0XHRhZGRVbmlxdWVBbmRWYWxpZFJlY3QoY29sbGFwc2VBbmRJbmZsYXRlV2lkdGgoZ2V0Qm91bmRpbmdDbGllbnRSZWN0KHJhbmdlKSwgZmFsc2UpKTtcblx0XHRcdFx0XHRcdHJldHVybiBjbGllbnRSZWN0cztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKG9mZnNldCA+IDApIHtcblx0XHRcdFx0cmFuZ2Uuc2V0U3RhcnQoY29udGFpbmVyLCBvZmZzZXQgLSAxKTtcblx0XHRcdFx0cmFuZ2Uuc2V0RW5kKGNvbnRhaW5lciwgb2Zmc2V0KTtcblxuXHRcdFx0XHRpZiAoIWlzSGlkZGVuV2hpdGVTcGFjZVJhbmdlKHJhbmdlKSkge1xuXHRcdFx0XHRcdGFkZFVuaXF1ZUFuZFZhbGlkUmVjdChjb2xsYXBzZUFuZEluZmxhdGVXaWR0aChnZXRCb3VuZGluZ0NsaWVudFJlY3QocmFuZ2UpLCBmYWxzZSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmIChvZmZzZXQgPCBjb250YWluZXIuZGF0YS5sZW5ndGgpIHtcblx0XHRcdFx0cmFuZ2Uuc2V0U3RhcnQoY29udGFpbmVyLCBvZmZzZXQpO1xuXHRcdFx0XHRyYW5nZS5zZXRFbmQoY29udGFpbmVyLCBvZmZzZXQgKyAxKTtcblxuXHRcdFx0XHRpZiAoIWlzSGlkZGVuV2hpdGVTcGFjZVJhbmdlKHJhbmdlKSkge1xuXHRcdFx0XHRcdGFkZFVuaXF1ZUFuZFZhbGlkUmVjdChjb2xsYXBzZUFuZEluZmxhdGVXaWR0aChnZXRCb3VuZGluZ0NsaWVudFJlY3QocmFuZ2UpLCB0cnVlKSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoaXNUZXh0KGNhcmV0UG9zaXRpb24uY29udGFpbmVyKCkpKSB7XG5cdFx0XHRhZGRDaGFyYWN0ZXJPZmZzZXQoY2FyZXRQb3NpdGlvbi5jb250YWluZXIoKSwgY2FyZXRQb3NpdGlvbi5vZmZzZXQoKSk7XG5cdFx0XHRyZXR1cm4gY2xpZW50UmVjdHM7XG5cdFx0fVxuXG5cdFx0aWYgKGlzRWxlbWVudChjYXJldFBvc2l0aW9uLmNvbnRhaW5lcigpKSkge1xuXHRcdFx0aWYgKGNhcmV0UG9zaXRpb24uaXNBdEVuZCgpKSB7XG5cdFx0XHRcdG5vZGUgPSByZXNvbHZlSW5kZXgoY2FyZXRQb3NpdGlvbi5jb250YWluZXIoKSwgY2FyZXRQb3NpdGlvbi5vZmZzZXQoKSk7XG5cdFx0XHRcdGlmIChpc1RleHQobm9kZSkpIHtcblx0XHRcdFx0XHRhZGRDaGFyYWN0ZXJPZmZzZXQobm9kZSwgbm9kZS5kYXRhLmxlbmd0aCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoaXNWYWxpZEVsZW1lbnRDYXJldENhbmRpZGF0ZShub2RlKSAmJiAhaXNCcihub2RlKSkge1xuXHRcdFx0XHRcdGFkZFVuaXF1ZUFuZFZhbGlkUmVjdChjb2xsYXBzZUFuZEluZmxhdGVXaWR0aChnZXRCb3VuZGluZ0NsaWVudFJlY3Qobm9kZSksIGZhbHNlKSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdG5vZGUgPSByZXNvbHZlSW5kZXgoY2FyZXRQb3NpdGlvbi5jb250YWluZXIoKSwgY2FyZXRQb3NpdGlvbi5vZmZzZXQoKSk7XG5cdFx0XHRcdGlmIChpc1RleHQobm9kZSkpIHtcblx0XHRcdFx0XHRhZGRDaGFyYWN0ZXJPZmZzZXQobm9kZSwgMCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoaXNWYWxpZEVsZW1lbnRDYXJldENhbmRpZGF0ZShub2RlKSAmJiBjYXJldFBvc2l0aW9uLmlzQXRFbmQoKSkge1xuXHRcdFx0XHRcdGFkZFVuaXF1ZUFuZFZhbGlkUmVjdChjb2xsYXBzZUFuZEluZmxhdGVXaWR0aChnZXRCb3VuZGluZ0NsaWVudFJlY3Qobm9kZSksIGZhbHNlKSk7XG5cdFx0XHRcdFx0cmV0dXJuIGNsaWVudFJlY3RzO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0YmVmb3JlTm9kZSA9IHJlc29sdmVJbmRleChjYXJldFBvc2l0aW9uLmNvbnRhaW5lcigpLCBjYXJldFBvc2l0aW9uLm9mZnNldCgpIC0gMSk7XG5cdFx0XHRcdGlmIChpc1ZhbGlkRWxlbWVudENhcmV0Q2FuZGlkYXRlKGJlZm9yZU5vZGUpICYmICFpc0JyKGJlZm9yZU5vZGUpKSB7XG5cdFx0XHRcdFx0aWYgKGlzQmxvY2soYmVmb3JlTm9kZSkgfHwgaXNCbG9jayhub2RlKSB8fCAhaXNWYWxpZEVsZW1lbnRDYXJldENhbmRpZGF0ZShub2RlKSkge1xuXHRcdFx0XHRcdFx0YWRkVW5pcXVlQW5kVmFsaWRSZWN0KGNvbGxhcHNlQW5kSW5mbGF0ZVdpZHRoKGdldEJvdW5kaW5nQ2xpZW50UmVjdChiZWZvcmVOb2RlKSwgZmFsc2UpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoaXNWYWxpZEVsZW1lbnRDYXJldENhbmRpZGF0ZShub2RlKSkge1xuXHRcdFx0XHRcdGFkZFVuaXF1ZUFuZFZhbGlkUmVjdChjb2xsYXBzZUFuZEluZmxhdGVXaWR0aChnZXRCb3VuZGluZ0NsaWVudFJlY3Qobm9kZSksIHRydWUpKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiBjbGllbnRSZWN0cztcblx0fVxuXG5cdC8qKlxuXHQgKiBSZXByZXNlbnRzIGEgbG9jYXRpb24gd2l0aGluIHRoZSBkb2N1bWVudCBieSBhIGNvbnRhaW5lciBhbmQgYW4gb2Zmc2V0LlxuXHQgKlxuXHQgKiBAY29uc3RydWN0b3Jcblx0ICogQHBhcmFtIHtOb2RlfSBjb250YWluZXIgQ29udGFpbmVyIG5vZGUuXG5cdCAqIEBwYXJhbSB7TnVtYmVyfSBvZmZzZXQgT2Zmc2V0IHdpdGhpbiB0aGF0IGNvbnRhaW5lciBub2RlLlxuXHQgKiBAcGFyYW0ge0FycmF5fSBjbGllbnRSZWN0cyBPcHRpb25hbCBjbGllbnQgcmVjdHMgYXJyYXkgZm9yIHRoZSBwb3NpdGlvbi5cblx0ICovXG5cdGZ1bmN0aW9uIENhcmV0UG9zaXRpb24oY29udGFpbmVyLCBvZmZzZXQsIGNsaWVudFJlY3RzKSB7XG5cdFx0ZnVuY3Rpb24gaXNBdFN0YXJ0KCkge1xuXHRcdFx0aWYgKGlzVGV4dChjb250YWluZXIpKSB7XG5cdFx0XHRcdHJldHVybiBvZmZzZXQgPT09IDA7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBvZmZzZXQgPT09IDA7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gaXNBdEVuZCgpIHtcblx0XHRcdGlmIChpc1RleHQoY29udGFpbmVyKSkge1xuXHRcdFx0XHRyZXR1cm4gb2Zmc2V0ID49IGNvbnRhaW5lci5kYXRhLmxlbmd0aDtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG9mZnNldCA+PSBjb250YWluZXIuY2hpbGROb2Rlcy5sZW5ndGg7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gdG9SYW5nZSgpIHtcblx0XHRcdHZhciByYW5nZTtcblxuXHRcdFx0cmFuZ2UgPSBjcmVhdGVSYW5nZShjb250YWluZXIub3duZXJEb2N1bWVudCk7XG5cdFx0XHRyYW5nZS5zZXRTdGFydChjb250YWluZXIsIG9mZnNldCk7XG5cdFx0XHRyYW5nZS5zZXRFbmQoY29udGFpbmVyLCBvZmZzZXQpO1xuXG5cdFx0XHRyZXR1cm4gcmFuZ2U7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gZ2V0Q2xpZW50UmVjdHMoKSB7XG5cdFx0XHRpZiAoIWNsaWVudFJlY3RzKSB7XG5cdFx0XHRcdGNsaWVudFJlY3RzID0gZ2V0Q2FyZXRQb3NpdGlvbkNsaWVudFJlY3RzKG5ldyBDYXJldFBvc2l0aW9uKGNvbnRhaW5lciwgb2Zmc2V0KSk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBjbGllbnRSZWN0cztcblx0XHR9XG5cblx0XHRmdW5jdGlvbiBpc1Zpc2libGUoKSB7XG5cdFx0XHRyZXR1cm4gZ2V0Q2xpZW50UmVjdHMoKS5sZW5ndGggPiAwO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIGlzRXF1YWwoY2FyZXRQb3NpdGlvbikge1xuXHRcdFx0cmV0dXJuIGNhcmV0UG9zaXRpb24gJiYgY29udGFpbmVyID09PSBjYXJldFBvc2l0aW9uLmNvbnRhaW5lcigpICYmIG9mZnNldCA9PT0gY2FyZXRQb3NpdGlvbi5vZmZzZXQoKTtcblx0XHR9XG5cblx0XHRmdW5jdGlvbiBnZXROb2RlKGJlZm9yZSkge1xuXHRcdFx0cmV0dXJuIHJlc29sdmVJbmRleChjb250YWluZXIsIGJlZm9yZSA/IG9mZnNldCAtIDEgOiBvZmZzZXQpO1xuXHRcdH1cblxuXHRcdHJldHVybiB7XG5cdFx0XHQvKipcblx0XHRcdCAqIFJldHVybnMgdGhlIGNvbnRhaW5lciBub2RlLlxuXHRcdFx0ICpcblx0XHRcdCAqIEBtZXRob2QgY29udGFpbmVyXG5cdFx0XHQgKiBAcmV0dXJuIHtOb2RlfSBDb250YWluZXIgbm9kZS5cblx0XHRcdCAqL1xuXHRcdFx0Y29udGFpbmVyOiBGdW4uY29uc3RhbnQoY29udGFpbmVyKSxcblxuXHRcdFx0LyoqXG5cdFx0XHQgKiBSZXR1cm5zIHRoZSBvZmZzZXQgd2l0aGluIHRoZSBjb250YWluZXIgbm9kZS5cblx0XHRcdCAqXG5cdFx0XHQgKiBAbWV0aG9kIG9mZnNldFxuXHRcdFx0ICogQHJldHVybiB7TnVtYmVyfSBPZmZzZXQgd2l0aGluIHRoZSBjb250YWluZXIgbm9kZS5cblx0XHRcdCAqL1xuXHRcdFx0b2Zmc2V0OiBGdW4uY29uc3RhbnQob2Zmc2V0KSxcblxuXHRcdFx0LyoqXG5cdFx0XHQgKiBSZXR1cm5zIGEgcmFuZ2Ugb3V0IG9mIGEgdGhlIGNhcmV0IHBvc2l0aW9uLlxuXHRcdFx0ICpcblx0XHRcdCAqIEBtZXRob2QgdG9SYW5nZVxuXHRcdFx0ICogQHJldHVybiB7RE9NUmFuZ2V9IHJhbmdlIGZvciB0aGUgY2FyZXQgcG9zaXRpb24uXG5cdFx0XHQgKi9cblx0XHRcdHRvUmFuZ2U6IHRvUmFuZ2UsXG5cblx0XHRcdC8qKlxuXHRcdFx0ICogUmV0dXJucyB0aGUgY2xpZW50IHJlY3RzIGZvciB0aGUgY2FyZXQgcG9zaXRpb24uIE1pZ2h0IGJlIG11bHRpcGxlIHJlY3RzIGJldHdlZW5cblx0XHRcdCAqIGJsb2NrIGVsZW1lbnRzLlxuXHRcdFx0ICpcblx0XHRcdCAqIEBtZXRob2QgZ2V0Q2xpZW50UmVjdHNcblx0XHRcdCAqIEByZXR1cm4ge0FycmF5fSBBcnJheSBvZiBjbGllbnQgcmVjdHMuXG5cdFx0XHQgKi9cblx0XHRcdGdldENsaWVudFJlY3RzOiBnZXRDbGllbnRSZWN0cyxcblxuXHRcdFx0LyoqXG5cdFx0XHQgKiBSZXR1cm5zIHRydWUgaWYgdGhlIGNhcmV0IGxvY2F0aW9uIGlzIHZpc2libGUvZGlzcGxheWVkIG9uIHNjcmVlbi5cblx0XHRcdCAqXG5cdFx0XHQgKiBAbWV0aG9kIGlzVmlzaWJsZVxuXHRcdFx0ICogQHJldHVybiB7Qm9vbGVhbn0gdHJ1ZS9mYWxzZSBpZiB0aGUgcG9zaXRpb24gaXMgdmlzaWJsZSBvciBub3QuXG5cdFx0XHQgKi9cblx0XHRcdGlzVmlzaWJsZTogaXNWaXNpYmxlLFxuXG5cdFx0XHQvKipcblx0XHRcdCAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgY2FyZXQgbG9jYXRpb24gaXMgYXQgdGhlIGJlZ2lubmluZyBvZiB0ZXh0IG5vZGUgb3IgY29udGFpbmVyLlxuXHRcdFx0ICpcblx0XHRcdCAqIEBtZXRob2QgaXNWaXNpYmxlXG5cdFx0XHQgKiBAcmV0dXJuIHtCb29sZWFufSB0cnVlL2ZhbHNlIGlmIHRoZSBwb3NpdGlvbiBpcyBhdCB0aGUgYmVnaW5uaW5nLlxuXHRcdFx0ICovXG5cdFx0XHRpc0F0U3RhcnQ6IGlzQXRTdGFydCxcblxuXHRcdFx0LyoqXG5cdFx0XHQgKiBSZXR1cm5zIHRydWUgaWYgdGhlIGNhcmV0IGxvY2F0aW9uIGlzIGF0IHRoZSBlbmQgb2YgdGV4dCBub2RlIG9yIGNvbnRhaW5lci5cblx0XHRcdCAqXG5cdFx0XHQgKiBAbWV0aG9kIGlzVmlzaWJsZVxuXHRcdFx0ICogQHJldHVybiB7Qm9vbGVhbn0gdHJ1ZS9mYWxzZSBpZiB0aGUgcG9zaXRpb24gaXMgYXQgdGhlIGVuZC5cblx0XHRcdCAqL1xuXHRcdFx0aXNBdEVuZDogaXNBdEVuZCxcblxuXHRcdFx0LyoqXG5cdFx0XHQgKiBDb21wYXJlcyB0aGUgY2FyZXQgcG9zaXRpb24gdG8gYW5vdGhlciBjYXJldCBwb3NpdGlvbi4gVGhpcyB3aWxsIG9ubHkgY29tcGFyZSB0aGVcblx0XHRcdCAqIGNvbnRhaW5lciBhbmQgb2Zmc2V0IG5vdCBpdCdzIHZpc3VhbCBwb3NpdGlvbi5cblx0XHRcdCAqXG5cdFx0XHQgKiBAbWV0aG9kIGlzRXF1YWxcblx0XHRcdCAqIEBwYXJhbSB7dGlueW1jZS5jYXJldC5DYXJldFBvc2l0aW9ufSBjYXJldFBvc2l0aW9uIENhcmV0IHBvc2l0aW9uIHRvIGNvbXBhcmUgd2l0aC5cblx0XHRcdCAqIEByZXR1cm4ge0Jvb2xlYW59IHRydWUgaWYgdGhlIGNhcmV0IHBvc2l0aW9ucyBhcmUgZXF1YWwuXG5cdFx0XHQgKi9cblx0XHRcdGlzRXF1YWw6IGlzRXF1YWwsXG5cblx0XHRcdC8qKlxuXHRcdFx0ICogUmV0dXJucyB0aGUgY2xvc2VzdCByZXNvbHZlZCBub2RlIGZyb20gYSBub2RlIGluZGV4LiBUaGF0IG1lYW5zIGlmIHlvdSBoYXZlIGFuIG9mZnNldCBhZnRlciB0aGVcblx0XHRcdCAqIGxhc3Qgbm9kZSBpbiBhIGNvbnRhaW5lciBpdCB3aWxsIHJldHVybiB0aGF0IGxhc3Qgbm9kZS5cblx0XHRcdCAqXG5cdFx0XHQgKiBAbWV0aG9kIGdldE5vZGVcblx0XHRcdCAqIEByZXR1cm4ge05vZGV9IE5vZGUgdGhhdCBpcyBjbG9zZXN0IHRvIHRoZSBpbmRleC5cblx0XHRcdCAqL1xuXHRcdFx0Z2V0Tm9kZTogZ2V0Tm9kZVxuXHRcdH07XG5cdH1cblxuXHQvKipcblx0ICogQ3JlYXRlcyBhIGNhcmV0IHBvc2l0aW9uIGZyb20gdGhlIHN0YXJ0IG9mIGEgcmFuZ2UuXG5cdCAqXG5cdCAqIEBtZXRob2QgZnJvbVJhbmdlU3RhcnRcblx0ICogQHBhcmFtIHtET01SYW5nZX0gcmFuZ2UgRE9NIFJhbmdlIHRvIGNyZWF0ZSBjYXJldCBwb3NpdGlvbiBmcm9tLlxuXHQgKiBAcmV0dXJuIHt0aW55bWNlLmNhcmV0LkNhcmV0UG9zaXRpb259IENhcmV0IHBvc2l0aW9uIGZyb20gdGhlIHN0YXJ0IG9mIERPTSByYW5nZS5cblx0ICovXG5cdENhcmV0UG9zaXRpb24uZnJvbVJhbmdlU3RhcnQgPSBmdW5jdGlvbihyYW5nZSkge1xuXHRcdHJldHVybiBuZXcgQ2FyZXRQb3NpdGlvbihyYW5nZS5zdGFydENvbnRhaW5lciwgcmFuZ2Uuc3RhcnRPZmZzZXQpO1xuXHR9O1xuXG5cdC8qKlxuXHQgKiBDcmVhdGVzIGEgY2FyZXQgcG9zaXRpb24gZnJvbSB0aGUgZW5kIG9mIGEgcmFuZ2UuXG5cdCAqXG5cdCAqIEBtZXRob2QgZnJvbVJhbmdlRW5kXG5cdCAqIEBwYXJhbSB7RE9NUmFuZ2V9IHJhbmdlIERPTSBSYW5nZSB0byBjcmVhdGUgY2FyZXQgcG9zaXRpb24gZnJvbS5cblx0ICogQHJldHVybiB7dGlueW1jZS5jYXJldC5DYXJldFBvc2l0aW9ufSBDYXJldCBwb3NpdGlvbiBmcm9tIHRoZSBlbmQgb2YgRE9NIHJhbmdlLlxuXHQgKi9cblx0Q2FyZXRQb3NpdGlvbi5mcm9tUmFuZ2VFbmQgPSBmdW5jdGlvbihyYW5nZSkge1xuXHRcdHJldHVybiBuZXcgQ2FyZXRQb3NpdGlvbihyYW5nZS5lbmRDb250YWluZXIsIHJhbmdlLmVuZE9mZnNldCk7XG5cdH07XG5cblx0LyoqXG5cdCAqIENyZWF0ZXMgYSBjYXJldCBwb3NpdGlvbiBmcm9tIGEgbm9kZSBhbmQgcGxhY2VzIHRoZSBvZmZzZXQgYWZ0ZXIgaXQuXG5cdCAqXG5cdCAqIEBtZXRob2QgYWZ0ZXJcblx0ICogQHBhcmFtIHtOb2RlfSBub2RlIE5vZGUgdG8gZ2V0IGNhcmV0IHBvc2l0aW9uIGZyb20uXG5cdCAqIEByZXR1cm4ge3RpbnltY2UuY2FyZXQuQ2FyZXRQb3NpdGlvbn0gQ2FyZXQgcG9zaXRpb24gZnJvbSB0aGUgbm9kZS5cblx0ICovXG5cdENhcmV0UG9zaXRpb24uYWZ0ZXIgPSBmdW5jdGlvbihub2RlKSB7XG5cdFx0cmV0dXJuIG5ldyBDYXJldFBvc2l0aW9uKG5vZGUucGFyZW50Tm9kZSwgbm9kZUluZGV4KG5vZGUpICsgMSk7XG5cdH07XG5cblx0LyoqXG5cdCAqIENyZWF0ZXMgYSBjYXJldCBwb3NpdGlvbiBmcm9tIGEgbm9kZSBhbmQgcGxhY2VzIHRoZSBvZmZzZXQgYmVmb3JlIGl0LlxuXHQgKlxuXHQgKiBAbWV0aG9kIGJlZm9yZVxuXHQgKiBAcGFyYW0ge05vZGV9IG5vZGUgTm9kZSB0byBnZXQgY2FyZXQgcG9zaXRpb24gZnJvbS5cblx0ICogQHJldHVybiB7dGlueW1jZS5jYXJldC5DYXJldFBvc2l0aW9ufSBDYXJldCBwb3NpdGlvbiBmcm9tIHRoZSBub2RlLlxuXHQgKi9cblx0Q2FyZXRQb3NpdGlvbi5iZWZvcmUgPSBmdW5jdGlvbihub2RlKSB7XG5cdFx0cmV0dXJuIG5ldyBDYXJldFBvc2l0aW9uKG5vZGUucGFyZW50Tm9kZSwgbm9kZUluZGV4KG5vZGUpKTtcblx0fTtcblxuXHRyZXR1cm4gQ2FyZXRQb3NpdGlvbjtcbn0pO1xuXG4vLyBJbmNsdWRlZCBmcm9tOiBqcy90aW55bWNlL2NsYXNzZXMvY2FyZXQvQ2FyZXRCb29rbWFyay5qc1xuXG4vKipcbiAqIENhcmV0Qm9va21hcmsuanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBUaGlzIG1vZHVsZSBjcmVhdGVzIG9yIHJlc29sdmVzIHhwYXRoIGxpa2Ugc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGEgQ2FyZXRQb3NpdGlvbnMuXG4gKlxuICogVGhlIGZvcm1hdCBpcyBhIC8gc2VwYXJhdGVkIGxpc3Qgb2YgY2h1bmtzIHdpdGg6XG4gKiA8ZWxlbWVudHx0ZXh0KCk+W2luZGV4fGFmdGVyfGJlZm9yZV1cbiAqXG4gKiBGb3IgZXhhbXBsZTpcbiAqICBwWzBdL2JbMF0vdGV4dCgpWzBdLDEgPSA8cD48Yj5hfGM8L2I+PC9wPlxuICogIHBbMF0vaW1nWzBdLGJlZm9yZSA9IDxwPnw8aW1nPjwvcD5cbiAqICBwWzBdL2ltZ1swXSxhZnRlciA9IDxwPjxpbWc+fDwvcD5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQHN0YXRpY1xuICogQGNsYXNzIHRpbnltY2UuY2FyZXQuQ2FyZXRCb29rbWFya1xuICogQGV4YW1wbGVcbiAqIHZhciBib29rbWFyayA9IENhcmV0Qm9va21hcmsuY3JlYXRlKHJvb3RFbG0sIENhcmV0UG9zaXRpb24uYmVmb3JlKHJvb3RFbG0uZmlyc3RDaGlsZCkpO1xuICogdmFyIGNhcmV0UG9zaXRpb24gPSBDYXJldEJvb2ttYXJrLnJlc29sdmUoYm9va21hcmspO1xuICovXG5kZWZpbmUoJ3RpbnltY2UvY2FyZXQvQ2FyZXRCb29rbWFyaycsIFtcblx0J3RpbnltY2UvZG9tL05vZGVUeXBlJyxcblx0J3RpbnltY2UvZG9tL0RPTVV0aWxzJyxcblx0J3RpbnltY2UvdXRpbC9GdW4nLFxuXHQndGlueW1jZS91dGlsL0FycicsXG5cdCd0aW55bWNlL2NhcmV0L0NhcmV0UG9zaXRpb24nXG5dLCBmdW5jdGlvbihOb2RlVHlwZSwgRG9tVXRpbHMsIEZ1biwgQXJyLCBDYXJldFBvc2l0aW9uKSB7XG5cdHZhciBpc1RleHQgPSBOb2RlVHlwZS5pc1RleHQsXG5cdFx0aXNCb2d1cyA9IE5vZGVUeXBlLmlzQm9ndXMsXG5cdFx0bm9kZUluZGV4ID0gRG9tVXRpbHMubm9kZUluZGV4O1xuXG5cdGZ1bmN0aW9uIG5vcm1hbGl6ZWRQYXJlbnQobm9kZSkge1xuXHRcdHZhciBwYXJlbnROb2RlID0gbm9kZS5wYXJlbnROb2RlO1xuXG5cdFx0aWYgKGlzQm9ndXMocGFyZW50Tm9kZSkpIHtcblx0XHRcdHJldHVybiBub3JtYWxpemVkUGFyZW50KHBhcmVudE5vZGUpO1xuXHRcdH1cblxuXHRcdHJldHVybiBwYXJlbnROb2RlO1xuXHR9XG5cblx0ZnVuY3Rpb24gZ2V0Q2hpbGROb2Rlcyhub2RlKSB7XG5cdFx0aWYgKCFub2RlKSB7XG5cdFx0XHRyZXR1cm4gW107XG5cdFx0fVxuXG5cdFx0cmV0dXJuIEFyci5yZWR1Y2Uobm9kZS5jaGlsZE5vZGVzLCBmdW5jdGlvbihyZXN1bHQsIG5vZGUpIHtcblx0XHRcdGlmIChpc0JvZ3VzKG5vZGUpICYmIG5vZGUubm9kZU5hbWUgIT0gJ0JSJykge1xuXHRcdFx0XHRyZXN1bHQgPSByZXN1bHQuY29uY2F0KGdldENoaWxkTm9kZXMobm9kZSkpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0cmVzdWx0LnB1c2gobm9kZSk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiByZXN1bHQ7XG5cdFx0fSwgW10pO1xuXHR9XG5cblx0ZnVuY3Rpb24gbm9ybWFsaXplZFRleHRPZmZzZXQodGV4dE5vZGUsIG9mZnNldCkge1xuXHRcdHdoaWxlICgodGV4dE5vZGUgPSB0ZXh0Tm9kZS5wcmV2aW91c1NpYmxpbmcpKSB7XG5cdFx0XHRpZiAoIWlzVGV4dCh0ZXh0Tm9kZSkpIHtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHR9XG5cblx0XHRcdG9mZnNldCArPSB0ZXh0Tm9kZS5kYXRhLmxlbmd0aDtcblx0XHR9XG5cblx0XHRyZXR1cm4gb2Zmc2V0O1xuXHR9XG5cblx0ZnVuY3Rpb24gZXF1YWwodGFyZ2V0VmFsdWUpIHtcblx0XHRyZXR1cm4gZnVuY3Rpb24odmFsdWUpIHtcblx0XHRcdHJldHVybiB0YXJnZXRWYWx1ZSA9PT0gdmFsdWU7XG5cdFx0fTtcblx0fVxuXG5cdGZ1bmN0aW9uIG5vcm1hbGl6ZWROb2RlSW5kZXgobm9kZSkge1xuXHRcdHZhciBub2RlcywgaW5kZXgsIG51bVRleHRGcmFnbWVudHM7XG5cblx0XHRub2RlcyA9IGdldENoaWxkTm9kZXMobm9ybWFsaXplZFBhcmVudChub2RlKSk7XG5cdFx0aW5kZXggPSBBcnIuZmluZEluZGV4KG5vZGVzLCBlcXVhbChub2RlKSwgbm9kZSk7XG5cdFx0bm9kZXMgPSBub2Rlcy5zbGljZSgwLCBpbmRleCArIDEpO1xuXHRcdG51bVRleHRGcmFnbWVudHMgPSBBcnIucmVkdWNlKG5vZGVzLCBmdW5jdGlvbihyZXN1bHQsIG5vZGUsIGkpIHtcblx0XHRcdGlmIChpc1RleHQobm9kZSkgJiYgaXNUZXh0KG5vZGVzW2kgLSAxXSkpIHtcblx0XHRcdFx0cmVzdWx0Kys7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiByZXN1bHQ7XG5cdFx0fSwgMCk7XG5cblx0XHRub2RlcyA9IEFyci5maWx0ZXIobm9kZXMsIE5vZGVUeXBlLm1hdGNoTm9kZU5hbWVzKG5vZGUubm9kZU5hbWUpKTtcblx0XHRpbmRleCA9IEFyci5maW5kSW5kZXgobm9kZXMsIGVxdWFsKG5vZGUpLCBub2RlKTtcblxuXHRcdHJldHVybiBpbmRleCAtIG51bVRleHRGcmFnbWVudHM7XG5cdH1cblxuXHRmdW5jdGlvbiBjcmVhdGVQYXRoSXRlbShub2RlKSB7XG5cdFx0dmFyIG5hbWU7XG5cblx0XHRpZiAoaXNUZXh0KG5vZGUpKSB7XG5cdFx0XHRuYW1lID0gJ3RleHQoKSc7XG5cdFx0fSBlbHNlIHtcblx0XHRcdG5hbWUgPSBub2RlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIG5hbWUgKyAnWycgKyBub3JtYWxpemVkTm9kZUluZGV4KG5vZGUpICsgJ10nO1xuXHR9XG5cblx0ZnVuY3Rpb24gcGFyZW50c1VudGlsKHJvb3ROb2RlLCBub2RlLCBwcmVkaWNhdGUpIHtcblx0XHR2YXIgcGFyZW50cyA9IFtdO1xuXG5cdFx0Zm9yIChub2RlID0gbm9kZS5wYXJlbnROb2RlOyBub2RlICE9IHJvb3ROb2RlOyBub2RlID0gbm9kZS5wYXJlbnROb2RlKSB7XG5cdFx0XHRpZiAocHJlZGljYXRlICYmIHByZWRpY2F0ZShub2RlKSkge1xuXHRcdFx0XHRicmVhaztcblx0XHRcdH1cblxuXHRcdFx0cGFyZW50cy5wdXNoKG5vZGUpO1xuXHRcdH1cblxuXHRcdHJldHVybiBwYXJlbnRzO1xuXHR9XG5cblx0ZnVuY3Rpb24gY3JlYXRlKHJvb3ROb2RlLCBjYXJldFBvc2l0aW9uKSB7XG5cdFx0dmFyIGNvbnRhaW5lciwgb2Zmc2V0LCBwYXRoID0gW10sXG5cdFx0XHRvdXRwdXRPZmZzZXQsIGNoaWxkTm9kZXMsIHBhcmVudHM7XG5cblx0XHRjb250YWluZXIgPSBjYXJldFBvc2l0aW9uLmNvbnRhaW5lcigpO1xuXHRcdG9mZnNldCA9IGNhcmV0UG9zaXRpb24ub2Zmc2V0KCk7XG5cblx0XHRpZiAoaXNUZXh0KGNvbnRhaW5lcikpIHtcblx0XHRcdG91dHB1dE9mZnNldCA9IG5vcm1hbGl6ZWRUZXh0T2Zmc2V0KGNvbnRhaW5lciwgb2Zmc2V0KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Y2hpbGROb2RlcyA9IGNvbnRhaW5lci5jaGlsZE5vZGVzO1xuXHRcdFx0aWYgKG9mZnNldCA+PSBjaGlsZE5vZGVzLmxlbmd0aCkge1xuXHRcdFx0XHRvdXRwdXRPZmZzZXQgPSAnYWZ0ZXInO1xuXHRcdFx0XHRvZmZzZXQgPSBjaGlsZE5vZGVzLmxlbmd0aCAtIDE7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRvdXRwdXRPZmZzZXQgPSAnYmVmb3JlJztcblx0XHRcdH1cblxuXHRcdFx0Y29udGFpbmVyID0gY2hpbGROb2Rlc1tvZmZzZXRdO1xuXHRcdH1cblxuXHRcdHBhdGgucHVzaChjcmVhdGVQYXRoSXRlbShjb250YWluZXIpKTtcblx0XHRwYXJlbnRzID0gcGFyZW50c1VudGlsKHJvb3ROb2RlLCBjb250YWluZXIpO1xuXHRcdHBhcmVudHMgPSBBcnIuZmlsdGVyKHBhcmVudHMsIEZ1bi5uZWdhdGUoTm9kZVR5cGUuaXNCb2d1cykpO1xuXHRcdHBhdGggPSBwYXRoLmNvbmNhdChBcnIubWFwKHBhcmVudHMsIGZ1bmN0aW9uKG5vZGUpIHtcblx0XHRcdHJldHVybiBjcmVhdGVQYXRoSXRlbShub2RlKTtcblx0XHR9KSk7XG5cblx0XHRyZXR1cm4gcGF0aC5yZXZlcnNlKCkuam9pbignLycpICsgJywnICsgb3V0cHV0T2Zmc2V0O1xuXHR9XG5cblx0ZnVuY3Rpb24gcmVzb2x2ZVBhdGhJdGVtKG5vZGUsIG5hbWUsIGluZGV4KSB7XG5cdFx0dmFyIG5vZGVzID0gZ2V0Q2hpbGROb2Rlcyhub2RlKTtcblxuXHRcdG5vZGVzID0gQXJyLmZpbHRlcihub2RlcywgZnVuY3Rpb24obm9kZSwgaW5kZXgpIHtcblx0XHRcdHJldHVybiAhaXNUZXh0KG5vZGUpIHx8ICFpc1RleHQobm9kZXNbaW5kZXggLSAxXSk7XG5cdFx0fSk7XG5cblx0XHRub2RlcyA9IEFyci5maWx0ZXIobm9kZXMsIE5vZGVUeXBlLm1hdGNoTm9kZU5hbWVzKG5hbWUpKTtcblx0XHRyZXR1cm4gbm9kZXNbaW5kZXhdO1xuXHR9XG5cblx0ZnVuY3Rpb24gZmluZFRleHRQb3NpdGlvbihjb250YWluZXIsIG9mZnNldCkge1xuXHRcdHZhciBub2RlID0gY29udGFpbmVyLCB0YXJnZXRPZmZzZXQgPSAwLCBkYXRhTGVuO1xuXG5cdFx0d2hpbGUgKGlzVGV4dChub2RlKSkge1xuXHRcdFx0ZGF0YUxlbiA9IG5vZGUuZGF0YS5sZW5ndGg7XG5cblx0XHRcdGlmIChvZmZzZXQgPj0gdGFyZ2V0T2Zmc2V0ICYmIG9mZnNldCA8PSB0YXJnZXRPZmZzZXQgKyBkYXRhTGVuKSB7XG5cdFx0XHRcdGNvbnRhaW5lciA9IG5vZGU7XG5cdFx0XHRcdG9mZnNldCA9IG9mZnNldCAtIHRhcmdldE9mZnNldDtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHR9XG5cblx0XHRcdGlmICghaXNUZXh0KG5vZGUubmV4dFNpYmxpbmcpKSB7XG5cdFx0XHRcdGNvbnRhaW5lciA9IG5vZGU7XG5cdFx0XHRcdG9mZnNldCA9IGRhdGFMZW47XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0fVxuXG5cdFx0XHR0YXJnZXRPZmZzZXQgKz0gZGF0YUxlbjtcblx0XHRcdG5vZGUgPSBub2RlLm5leHRTaWJsaW5nO1xuXHRcdH1cblxuXHRcdGlmIChvZmZzZXQgPiBjb250YWluZXIuZGF0YS5sZW5ndGgpIHtcblx0XHRcdG9mZnNldCA9IGNvbnRhaW5lci5kYXRhLmxlbmd0aDtcblx0XHR9XG5cblx0XHRyZXR1cm4gbmV3IENhcmV0UG9zaXRpb24oY29udGFpbmVyLCBvZmZzZXQpO1xuXHR9XG5cblx0ZnVuY3Rpb24gcmVzb2x2ZShyb290Tm9kZSwgcGF0aCkge1xuXHRcdHZhciBwYXJ0cywgY29udGFpbmVyLCBvZmZzZXQ7XG5cblx0XHRpZiAoIXBhdGgpIHtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblxuXHRcdHBhcnRzID0gcGF0aC5zcGxpdCgnLCcpO1xuXHRcdHBhdGggPSBwYXJ0c1swXS5zcGxpdCgnLycpO1xuXHRcdG9mZnNldCA9IHBhcnRzLmxlbmd0aCA+IDEgPyBwYXJ0c1sxXSA6ICdiZWZvcmUnO1xuXG5cdFx0Y29udGFpbmVyID0gQXJyLnJlZHVjZShwYXRoLCBmdW5jdGlvbihyZXN1bHQsIHZhbHVlKSB7XG5cdFx0XHR2YWx1ZSA9IC8oW1xcd1xcLVxcKFxcKV0rKVxcWyhbMC05XSspXFxdLy5leGVjKHZhbHVlKTtcblx0XHRcdGlmICghdmFsdWUpIHtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cblx0XHRcdGlmICh2YWx1ZVsxXSA9PT0gJ3RleHQoKScpIHtcblx0XHRcdFx0dmFsdWVbMV0gPSAnI3RleHQnO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gcmVzb2x2ZVBhdGhJdGVtKHJlc3VsdCwgdmFsdWVbMV0sIHBhcnNlSW50KHZhbHVlWzJdLCAxMCkpO1xuXHRcdH0sIHJvb3ROb2RlKTtcblxuXHRcdGlmICghY29udGFpbmVyKSB7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cblx0XHRpZiAoIWlzVGV4dChjb250YWluZXIpKSB7XG5cdFx0XHRpZiAob2Zmc2V0ID09PSAnYWZ0ZXInKSB7XG5cdFx0XHRcdG9mZnNldCA9IG5vZGVJbmRleChjb250YWluZXIpICsgMTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdG9mZnNldCA9IG5vZGVJbmRleChjb250YWluZXIpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbmV3IENhcmV0UG9zaXRpb24oY29udGFpbmVyLnBhcmVudE5vZGUsIG9mZnNldCk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGZpbmRUZXh0UG9zaXRpb24oY29udGFpbmVyLCBwYXJzZUludChvZmZzZXQsIDEwKSk7XG5cdH1cblxuXHRyZXR1cm4ge1xuXHRcdC8qKlxuXHRcdCAqIENyZWF0ZSBhIHhwYXRoIGJvb2ttYXJrIGxvY2F0aW9uIGZvciB0aGUgc3BlY2lmaWVkIGNhcmV0IHBvc2l0aW9uLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBjcmVhdGVcblx0XHQgKiBAcGFyYW0ge05vZGV9IHJvb3ROb2RlIFJvb3Qgbm9kZSB0byBjcmVhdGUgYm9va21hcmsgd2l0aGluLlxuXHRcdCAqIEBwYXJhbSB7dGlueW1jZS5jYXJldC5DYXJldFBvc2l0aW9ufSBjYXJldFBvc2l0aW9uIENhcmV0IHBvc2l0aW9uIHdpdGhpbiB0aGUgcm9vdCBub2RlLlxuXHRcdCAqIEByZXR1cm4ge1N0cmluZ30gU3RyaW5nIHhwYXRoIGxpa2UgbG9jYXRpb24gb2YgY2FyZXQgcG9zaXRpb24uXG5cdFx0ICovXG5cdFx0Y3JlYXRlOiBjcmVhdGUsXG5cblx0XHQvKipcblx0XHQgKiBSZXNvbHZlcyBhIHhwYXRoIGxpa2UgYm9va21hcmsgbG9jYXRpb24gdG8gdGhlIGEgY2FyZXQgcG9zaXRpb24uXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHJlc29sdmVcblx0XHQgKiBAcGFyYW0ge05vZGV9IHJvb3ROb2RlIFJvb3Qgbm9kZSB0byByZXNvbHZlIHhwYXRoIGJvb2ttYXJrIHdpdGhpbi5cblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gYm9va21hcmsgQm9va21hcmsgc3RyaW5nIHRvIHJlc29sdmUuXG5cdFx0ICogQHJldHVybiB7dGlueW1jZS5jYXJldC5DYXJldFBvc2l0aW9ufSBDYXJldCBwb3NpdGlvbiByZXNvbHZlZCBmcm9tIHhwYXRoIGxpa2UgYm9va21hcmsuXG5cdFx0ICovXG5cdFx0cmVzb2x2ZTogcmVzb2x2ZVxuXHR9O1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy9kb20vQm9va21hcmtNYW5hZ2VyLmpzXG5cbi8qKlxuICogQm9va21hcmtNYW5hZ2VyLmpzXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgTEdQTCBMaWNlbnNlLlxuICogQ29weXJpZ2h0IChjKSAxOTk5LTIwMTUgRXBob3ggQ29ycC4gQWxsIHJpZ2h0cyByZXNlcnZlZFxuICpcbiAqIExpY2Vuc2U6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vbGljZW5zZVxuICogQ29udHJpYnV0aW5nOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2NvbnRyaWJ1dGluZ1xuICovXG5cbi8qKlxuICogVGhpcyBjbGFzcyBoYW5kbGVzIHNlbGVjdGlvbiBib29rbWFya3MuXG4gKlxuICogQGNsYXNzIHRpbnltY2UuZG9tLkJvb2ttYXJrTWFuYWdlclxuICovXG5kZWZpbmUoXCJ0aW55bWNlL2RvbS9Cb29rbWFya01hbmFnZXJcIiwgW1xuXHRcInRpbnltY2UvRW52XCIsXG5cdFwidGlueW1jZS91dGlsL1Rvb2xzXCIsXG5cdFwidGlueW1jZS9jYXJldC9DYXJldENvbnRhaW5lclwiLFxuXHRcInRpbnltY2UvY2FyZXQvQ2FyZXRCb29rbWFya1wiLFxuXHRcInRpbnltY2UvY2FyZXQvQ2FyZXRQb3NpdGlvblwiLFxuXHRcInRpbnltY2UvZG9tL05vZGVUeXBlXCIsXG5cdFwidGlueW1jZS9kb20vUmFuZ2VVdGlsc1wiXG5dLCBmdW5jdGlvbihFbnYsIFRvb2xzLCBDYXJldENvbnRhaW5lciwgQ2FyZXRCb29rbWFyaywgQ2FyZXRQb3NpdGlvbiwgTm9kZVR5cGUsIFJhbmdlVXRpbHMpIHtcblx0dmFyIGlzQ29udGVudEVkaXRhYmxlRmFsc2UgPSBOb2RlVHlwZS5pc0NvbnRlbnRFZGl0YWJsZUZhbHNlO1xuXG5cdC8qKlxuXHQgKiBDb25zdHJ1Y3RzIGEgbmV3IEJvb2ttYXJrTWFuYWdlciBpbnN0YW5jZSBmb3IgYSBzcGVjaWZpYyBzZWxlY3Rpb24gaW5zdGFuY2UuXG5cdCAqXG5cdCAqIEBjb25zdHJ1Y3RvclxuXHQgKiBAbWV0aG9kIEJvb2ttYXJrTWFuYWdlclxuXHQgKiBAcGFyYW0ge3RpbnltY2UuZG9tLlNlbGVjdGlvbn0gc2VsZWN0aW9uIFNlbGVjdGlvbiBpbnN0YW5jZSB0byBoYW5kbGUgYm9va21hcmtzIGZvci5cblx0ICovXG5cdGZ1bmN0aW9uIEJvb2ttYXJrTWFuYWdlcihzZWxlY3Rpb24pIHtcblx0XHR2YXIgZG9tID0gc2VsZWN0aW9uLmRvbTtcblxuXHRcdC8qKlxuXHRcdCAqIFJldHVybnMgYSBib29rbWFyayBsb2NhdGlvbiBmb3IgdGhlIGN1cnJlbnQgc2VsZWN0aW9uLiBUaGlzIGJvb2ttYXJrIG9iamVjdFxuXHRcdCAqIGNhbiB0aGVuIGJlIHVzZWQgdG8gcmVzdG9yZSB0aGUgc2VsZWN0aW9uIGFmdGVyIHNvbWUgY29udGVudCBtb2RpZmljYXRpb24gdG8gdGhlIGRvY3VtZW50LlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBnZXRCb29rbWFya1xuXHRcdCAqIEBwYXJhbSB7TnVtYmVyfSB0eXBlIE9wdGlvbmFsIHN0YXRlIGlmIHRoZSBib29rbWFyayBzaG91bGQgYmUgc2ltcGxlIG9yIG5vdC4gRGVmYXVsdCBpcyBjb21wbGV4LlxuXHRcdCAqIEBwYXJhbSB7Qm9vbGVhbn0gbm9ybWFsaXplZCBPcHRpb25hbCBzdGF0ZSB0aGF0IGVuYWJsZXMgeW91IHRvIGdldCBhIHBvc2l0aW9uIHRoYXQgaXQgd291bGQgYmUgYWZ0ZXIgbm9ybWFsaXphdGlvbi5cblx0XHQgKiBAcmV0dXJuIHtPYmplY3R9IEJvb2ttYXJrIG9iamVjdCwgdXNlIG1vdmVUb0Jvb2ttYXJrIHdpdGggdGhpcyBvYmplY3QgdG8gcmVzdG9yZSB0aGUgc2VsZWN0aW9uLlxuXHRcdCAqIEBleGFtcGxlXG5cdFx0ICogLy8gU3RvcmVzIGEgYm9va21hcmsgb2YgdGhlIGN1cnJlbnQgc2VsZWN0aW9uXG5cdFx0ICogdmFyIGJtID0gdGlueW1jZS5hY3RpdmVFZGl0b3Iuc2VsZWN0aW9uLmdldEJvb2ttYXJrKCk7XG5cdFx0ICpcblx0XHQgKiB0aW55bWNlLmFjdGl2ZUVkaXRvci5zZXRDb250ZW50KHRpbnltY2UuYWN0aXZlRWRpdG9yLmdldENvbnRlbnQoKSArICdTb21lIG5ldyBjb250ZW50Jyk7XG5cdFx0ICpcblx0XHQgKiAvLyBSZXN0b3JlIHRoZSBzZWxlY3Rpb24gYm9va21hcmtcblx0XHQgKiB0aW55bWNlLmFjdGl2ZUVkaXRvci5zZWxlY3Rpb24ubW92ZVRvQm9va21hcmsoYm0pO1xuXHRcdCAqL1xuXHRcdHRoaXMuZ2V0Qm9va21hcmsgPSBmdW5jdGlvbih0eXBlLCBub3JtYWxpemVkKSB7XG5cdFx0XHR2YXIgcm5nLCBybmcyLCBpZCwgY29sbGFwc2VkLCBuYW1lLCBlbGVtZW50LCBjaHIgPSAnJiN4RkVGRjsnLCBzdHlsZXM7XG5cblx0XHRcdGZ1bmN0aW9uIGZpbmRJbmRleChuYW1lLCBlbGVtZW50KSB7XG5cdFx0XHRcdHZhciBjb3VudCA9IDA7XG5cblx0XHRcdFx0VG9vbHMuZWFjaChkb20uc2VsZWN0KG5hbWUpLCBmdW5jdGlvbihub2RlKSB7XG5cdFx0XHRcdFx0aWYgKG5vZGUuZ2V0QXR0cmlidXRlKCdkYXRhLW1jZS1ib2d1cycpID09PSAnYWxsJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmIChub2RlID09IGVsZW1lbnQpIHtcblx0XHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRjb3VudCsrO1xuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHRyZXR1cm4gY291bnQ7XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIG5vcm1hbGl6ZVRhYmxlQ2VsbFNlbGVjdGlvbihybmcpIHtcblx0XHRcdFx0ZnVuY3Rpb24gbW92ZUVuZFBvaW50KHN0YXJ0KSB7XG5cdFx0XHRcdFx0dmFyIGNvbnRhaW5lciwgb2Zmc2V0LCBjaGlsZE5vZGVzLCBwcmVmaXggPSBzdGFydCA/ICdzdGFydCcgOiAnZW5kJztcblxuXHRcdFx0XHRcdGNvbnRhaW5lciA9IHJuZ1twcmVmaXggKyAnQ29udGFpbmVyJ107XG5cdFx0XHRcdFx0b2Zmc2V0ID0gcm5nW3ByZWZpeCArICdPZmZzZXQnXTtcblxuXHRcdFx0XHRcdGlmIChjb250YWluZXIubm9kZVR5cGUgPT0gMSAmJiBjb250YWluZXIubm9kZU5hbWUgPT0gXCJUUlwiKSB7XG5cdFx0XHRcdFx0XHRjaGlsZE5vZGVzID0gY29udGFpbmVyLmNoaWxkTm9kZXM7XG5cdFx0XHRcdFx0XHRjb250YWluZXIgPSBjaGlsZE5vZGVzW01hdGgubWluKHN0YXJ0ID8gb2Zmc2V0IDogb2Zmc2V0IC0gMSwgY2hpbGROb2Rlcy5sZW5ndGggLSAxKV07XG5cdFx0XHRcdFx0XHRpZiAoY29udGFpbmVyKSB7XG5cdFx0XHRcdFx0XHRcdG9mZnNldCA9IHN0YXJ0ID8gMCA6IGNvbnRhaW5lci5jaGlsZE5vZGVzLmxlbmd0aDtcblx0XHRcdFx0XHRcdFx0cm5nWydzZXQnICsgKHN0YXJ0ID8gJ1N0YXJ0JyA6ICdFbmQnKV0oY29udGFpbmVyLCBvZmZzZXQpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdG1vdmVFbmRQb2ludCh0cnVlKTtcblx0XHRcdFx0bW92ZUVuZFBvaW50KCk7XG5cblx0XHRcdFx0cmV0dXJuIHJuZztcblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gZ2V0TG9jYXRpb24ocm5nKSB7XG5cdFx0XHRcdHZhciByb290ID0gZG9tLmdldFJvb3QoKSwgYm9va21hcmsgPSB7fTtcblxuXHRcdFx0XHRmdW5jdGlvbiBnZXRQb2ludChybmcsIHN0YXJ0KSB7XG5cdFx0XHRcdFx0dmFyIGNvbnRhaW5lciA9IHJuZ1tzdGFydCA/ICdzdGFydENvbnRhaW5lcicgOiAnZW5kQ29udGFpbmVyJ10sXG5cdFx0XHRcdFx0XHRvZmZzZXQgPSBybmdbc3RhcnQgPyAnc3RhcnRPZmZzZXQnIDogJ2VuZE9mZnNldCddLCBwb2ludCA9IFtdLCBub2RlLCBjaGlsZE5vZGVzLCBhZnRlciA9IDA7XG5cblx0XHRcdFx0XHRpZiAoY29udGFpbmVyLm5vZGVUeXBlID09IDMpIHtcblx0XHRcdFx0XHRcdGlmIChub3JtYWxpemVkKSB7XG5cdFx0XHRcdFx0XHRcdGZvciAobm9kZSA9IGNvbnRhaW5lci5wcmV2aW91c1NpYmxpbmc7IG5vZGUgJiYgbm9kZS5ub2RlVHlwZSA9PSAzOyBub2RlID0gbm9kZS5wcmV2aW91c1NpYmxpbmcpIHtcblx0XHRcdFx0XHRcdFx0XHRvZmZzZXQgKz0gbm9kZS5ub2RlVmFsdWUubGVuZ3RoO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHBvaW50LnB1c2gob2Zmc2V0KTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0Y2hpbGROb2RlcyA9IGNvbnRhaW5lci5jaGlsZE5vZGVzO1xuXG5cdFx0XHRcdFx0XHRpZiAob2Zmc2V0ID49IGNoaWxkTm9kZXMubGVuZ3RoICYmIGNoaWxkTm9kZXMubGVuZ3RoKSB7XG5cdFx0XHRcdFx0XHRcdGFmdGVyID0gMTtcblx0XHRcdFx0XHRcdFx0b2Zmc2V0ID0gTWF0aC5tYXgoMCwgY2hpbGROb2Rlcy5sZW5ndGggLSAxKTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cG9pbnQucHVzaChkb20ubm9kZUluZGV4KGNoaWxkTm9kZXNbb2Zmc2V0XSwgbm9ybWFsaXplZCkgKyBhZnRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Zm9yICg7IGNvbnRhaW5lciAmJiBjb250YWluZXIgIT0gcm9vdDsgY29udGFpbmVyID0gY29udGFpbmVyLnBhcmVudE5vZGUpIHtcblx0XHRcdFx0XHRcdHBvaW50LnB1c2goZG9tLm5vZGVJbmRleChjb250YWluZXIsIG5vcm1hbGl6ZWQpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcG9pbnQ7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRib29rbWFyay5zdGFydCA9IGdldFBvaW50KHJuZywgdHJ1ZSk7XG5cblx0XHRcdFx0aWYgKCFzZWxlY3Rpb24uaXNDb2xsYXBzZWQoKSkge1xuXHRcdFx0XHRcdGJvb2ttYXJrLmVuZCA9IGdldFBvaW50KHJuZyk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gYm9va21hcms7XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIGZpbmRBZGphY2VudENvbnRlbnRFZGl0YWJsZUZhbHNlRWxtKHJuZykge1xuXHRcdFx0XHRmdW5jdGlvbiBmaW5kU2libGluZyhub2RlLCBvZmZzZXQpIHtcblx0XHRcdFx0XHR2YXIgc2libGluZztcblxuXHRcdFx0XHRcdGlmIChOb2RlVHlwZS5pc0VsZW1lbnQobm9kZSkpIHtcblx0XHRcdFx0XHRcdG5vZGUgPSBSYW5nZVV0aWxzLmdldE5vZGUobm9kZSwgb2Zmc2V0KTtcblx0XHRcdFx0XHRcdGlmIChpc0NvbnRlbnRFZGl0YWJsZUZhbHNlKG5vZGUpKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiBub2RlO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmIChDYXJldENvbnRhaW5lci5pc0NhcmV0Q29udGFpbmVyKG5vZGUpKSB7XG5cdFx0XHRcdFx0XHRpZiAoTm9kZVR5cGUuaXNUZXh0KG5vZGUpICYmIENhcmV0Q29udGFpbmVyLmlzQ2FyZXRDb250YWluZXJCbG9jayhub2RlKSkge1xuXHRcdFx0XHRcdFx0XHRub2RlID0gbm9kZS5wYXJlbnROb2RlO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRzaWJsaW5nID0gbm9kZS5wcmV2aW91c1NpYmxpbmc7XG5cdFx0XHRcdFx0XHRpZiAoaXNDb250ZW50RWRpdGFibGVGYWxzZShzaWJsaW5nKSkge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gc2libGluZztcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0c2libGluZyA9IG5vZGUubmV4dFNpYmxpbmc7XG5cdFx0XHRcdFx0XHRpZiAoaXNDb250ZW50RWRpdGFibGVGYWxzZShzaWJsaW5nKSkge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gc2libGluZztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gZmluZFNpYmxpbmcocm5nLnN0YXJ0Q29udGFpbmVyLCBybmcuc3RhcnRPZmZzZXQpIHx8IGZpbmRTaWJsaW5nKHJuZy5lbmRDb250YWluZXIsIHJuZy5lbmRPZmZzZXQpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZSA9PSAyKSB7XG5cdFx0XHRcdGVsZW1lbnQgPSBzZWxlY3Rpb24uZ2V0Tm9kZSgpO1xuXHRcdFx0XHRuYW1lID0gZWxlbWVudCA/IGVsZW1lbnQubm9kZU5hbWUgOiBudWxsO1xuXHRcdFx0XHRybmcgPSBzZWxlY3Rpb24uZ2V0Um5nKCk7XG5cblx0XHRcdFx0aWYgKGlzQ29udGVudEVkaXRhYmxlRmFsc2UoZWxlbWVudCkgfHwgbmFtZSA9PSAnSU1HJykge1xuXHRcdFx0XHRcdHJldHVybiB7bmFtZTogbmFtZSwgaW5kZXg6IGZpbmRJbmRleChuYW1lLCBlbGVtZW50KX07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoc2VsZWN0aW9uLnRyaWRlbnRTZWwpIHtcblx0XHRcdFx0XHRyZXR1cm4gc2VsZWN0aW9uLnRyaWRlbnRTZWwuZ2V0Qm9va21hcmsodHlwZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRlbGVtZW50ID0gZmluZEFkamFjZW50Q29udGVudEVkaXRhYmxlRmFsc2VFbG0ocm5nKTtcblx0XHRcdFx0aWYgKGVsZW1lbnQpIHtcblx0XHRcdFx0XHRuYW1lID0gZWxlbWVudC50YWdOYW1lO1xuXHRcdFx0XHRcdHJldHVybiB7bmFtZTogbmFtZSwgaW5kZXg6IGZpbmRJbmRleChuYW1lLCBlbGVtZW50KX07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gZ2V0TG9jYXRpb24ocm5nKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGUgPT0gMykge1xuXHRcdFx0XHRybmcgPSBzZWxlY3Rpb24uZ2V0Um5nKCk7XG5cblx0XHRcdFx0cmV0dXJuIHtcblx0XHRcdFx0XHRzdGFydDogQ2FyZXRCb29rbWFyay5jcmVhdGUoZG9tLmdldFJvb3QoKSwgQ2FyZXRQb3NpdGlvbi5mcm9tUmFuZ2VTdGFydChybmcpKSxcblx0XHRcdFx0XHRlbmQ6IENhcmV0Qm9va21hcmsuY3JlYXRlKGRvbS5nZXRSb290KCksIENhcmV0UG9zaXRpb24uZnJvbVJhbmdlRW5kKHJuZykpXG5cdFx0XHRcdH07XG5cdFx0XHR9XG5cblx0XHRcdC8vIEhhbmRsZSBzaW1wbGUgcmFuZ2Vcblx0XHRcdGlmICh0eXBlKSB7XG5cdFx0XHRcdHJldHVybiB7cm5nOiBzZWxlY3Rpb24uZ2V0Um5nKCl9O1xuXHRcdFx0fVxuXG5cdFx0XHRybmcgPSBzZWxlY3Rpb24uZ2V0Um5nKCk7XG5cdFx0XHRpZCA9IGRvbS51bmlxdWVJZCgpO1xuXHRcdFx0Y29sbGFwc2VkID0gc2VsZWN0aW9uLmlzQ29sbGFwc2VkKCk7XG5cdFx0XHRzdHlsZXMgPSAnb3ZlcmZsb3c6aGlkZGVuO2xpbmUtaGVpZ2h0OjBweCc7XG5cblx0XHRcdC8vIEV4cGxvcmVyIG1ldGhvZFxuXHRcdFx0aWYgKHJuZy5kdXBsaWNhdGUgfHwgcm5nLml0ZW0pIHtcblx0XHRcdFx0Ly8gVGV4dCBzZWxlY3Rpb25cblx0XHRcdFx0aWYgKCFybmcuaXRlbSkge1xuXHRcdFx0XHRcdHJuZzIgPSBybmcuZHVwbGljYXRlKCk7XG5cblx0XHRcdFx0XHR0cnkge1xuXHRcdFx0XHRcdFx0Ly8gSW5zZXJ0IHN0YXJ0IG1hcmtlclxuXHRcdFx0XHRcdFx0cm5nLmNvbGxhcHNlKCk7XG5cdFx0XHRcdFx0XHRybmcucGFzdGVIVE1MKCc8c3BhbiBkYXRhLW1jZS10eXBlPVwiYm9va21hcmtcIiBpZD1cIicgKyBpZCArICdfc3RhcnRcIiBzdHlsZT1cIicgKyBzdHlsZXMgKyAnXCI+JyArIGNociArICc8L3NwYW4+Jyk7XG5cblx0XHRcdFx0XHRcdC8vIEluc2VydCBlbmQgbWFya2VyXG5cdFx0XHRcdFx0XHRpZiAoIWNvbGxhcHNlZCkge1xuXHRcdFx0XHRcdFx0XHRybmcyLmNvbGxhcHNlKGZhbHNlKTtcblxuXHRcdFx0XHRcdFx0XHQvLyBEZXRlY3QgdGhlIGVtcHR5IHNwYWNlIGFmdGVyIGJsb2NrIGVsZW1lbnRzIGluIElFIGFuZCBtb3ZlIHRoZVxuXHRcdFx0XHRcdFx0XHQvLyBlbmQgYmFjayBvbmUgY2hhcmFjdGVyIDxwPjwvcD5dIGJlY29tZXMgPHA+XTwvcD5cblx0XHRcdFx0XHRcdFx0cm5nLm1vdmVUb0VsZW1lbnRUZXh0KHJuZzIucGFyZW50RWxlbWVudCgpKTtcblx0XHRcdFx0XHRcdFx0aWYgKHJuZy5jb21wYXJlRW5kUG9pbnRzKCdTdGFydFRvRW5kJywgcm5nMikgPT09IDApIHtcblx0XHRcdFx0XHRcdFx0XHRybmcyLm1vdmUoJ2NoYXJhY3RlcicsIC0xKTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJuZzIucGFzdGVIVE1MKCc8c3BhbiBkYXRhLW1jZS10eXBlPVwiYm9va21hcmtcIiBpZD1cIicgKyBpZCArICdfZW5kXCIgc3R5bGU9XCInICsgc3R5bGVzICsgJ1wiPicgKyBjaHIgKyAnPC9zcGFuPicpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdFx0XHQvLyBJRSBtaWdodCB0aHJvdyB1bnNwZWNpZmllZCBlcnJvciBzbyBsZXRzIGlnbm9yZSBpdFxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdC8vIENvbnRyb2wgc2VsZWN0aW9uXG5cdFx0XHRcdFx0ZWxlbWVudCA9IHJuZy5pdGVtKDApO1xuXHRcdFx0XHRcdG5hbWUgPSBlbGVtZW50Lm5vZGVOYW1lO1xuXG5cdFx0XHRcdFx0cmV0dXJuIHtuYW1lOiBuYW1lLCBpbmRleDogZmluZEluZGV4KG5hbWUsIGVsZW1lbnQpfTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0ZWxlbWVudCA9IHNlbGVjdGlvbi5nZXROb2RlKCk7XG5cdFx0XHRcdG5hbWUgPSBlbGVtZW50Lm5vZGVOYW1lO1xuXHRcdFx0XHRpZiAobmFtZSA9PSAnSU1HJykge1xuXHRcdFx0XHRcdHJldHVybiB7bmFtZTogbmFtZSwgaW5kZXg6IGZpbmRJbmRleChuYW1lLCBlbGVtZW50KX07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBXM0MgbWV0aG9kXG5cdFx0XHRcdHJuZzIgPSBub3JtYWxpemVUYWJsZUNlbGxTZWxlY3Rpb24ocm5nLmNsb25lUmFuZ2UoKSk7XG5cblx0XHRcdFx0Ly8gSW5zZXJ0IGVuZCBtYXJrZXJcblx0XHRcdFx0aWYgKCFjb2xsYXBzZWQpIHtcblx0XHRcdFx0XHRybmcyLmNvbGxhcHNlKGZhbHNlKTtcblx0XHRcdFx0XHRybmcyLmluc2VydE5vZGUoZG9tLmNyZWF0ZSgnc3BhbicsIHsnZGF0YS1tY2UtdHlwZSc6IFwiYm9va21hcmtcIiwgaWQ6IGlkICsgJ19lbmQnLCBzdHlsZTogc3R5bGVzfSwgY2hyKSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRybmcgPSBub3JtYWxpemVUYWJsZUNlbGxTZWxlY3Rpb24ocm5nKTtcblx0XHRcdFx0cm5nLmNvbGxhcHNlKHRydWUpO1xuXHRcdFx0XHRybmcuaW5zZXJ0Tm9kZShkb20uY3JlYXRlKCdzcGFuJywgeydkYXRhLW1jZS10eXBlJzogXCJib29rbWFya1wiLCBpZDogaWQgKyAnX3N0YXJ0Jywgc3R5bGU6IHN0eWxlc30sIGNocikpO1xuXHRcdFx0fVxuXG5cdFx0XHRzZWxlY3Rpb24ubW92ZVRvQm9va21hcmsoe2lkOiBpZCwga2VlcDogMX0pO1xuXG5cdFx0XHRyZXR1cm4ge2lkOiBpZH07XG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIFJlc3RvcmVzIHRoZSBzZWxlY3Rpb24gdG8gdGhlIHNwZWNpZmllZCBib29rbWFyay5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgbW92ZVRvQm9va21hcmtcblx0XHQgKiBAcGFyYW0ge09iamVjdH0gYm9va21hcmsgQm9va21hcmsgdG8gcmVzdG9yZSBzZWxlY3Rpb24gZnJvbS5cblx0XHQgKiBAcmV0dXJuIHtCb29sZWFufSB0cnVlL2ZhbHNlIGlmIGl0IHdhcyBzdWNjZXNzZnVsIG9yIG5vdC5cblx0XHQgKiBAZXhhbXBsZVxuXHRcdCAqIC8vIFN0b3JlcyBhIGJvb2ttYXJrIG9mIHRoZSBjdXJyZW50IHNlbGVjdGlvblxuXHRcdCAqIHZhciBibSA9IHRpbnltY2UuYWN0aXZlRWRpdG9yLnNlbGVjdGlvbi5nZXRCb29rbWFyaygpO1xuXHRcdCAqXG5cdFx0ICogdGlueW1jZS5hY3RpdmVFZGl0b3Iuc2V0Q29udGVudCh0aW55bWNlLmFjdGl2ZUVkaXRvci5nZXRDb250ZW50KCkgKyAnU29tZSBuZXcgY29udGVudCcpO1xuXHRcdCAqXG5cdFx0ICogLy8gUmVzdG9yZSB0aGUgc2VsZWN0aW9uIGJvb2ttYXJrXG5cdFx0ICogdGlueW1jZS5hY3RpdmVFZGl0b3Iuc2VsZWN0aW9uLm1vdmVUb0Jvb2ttYXJrKGJtKTtcblx0XHQgKi9cblx0XHR0aGlzLm1vdmVUb0Jvb2ttYXJrID0gZnVuY3Rpb24oYm9va21hcmspIHtcblx0XHRcdHZhciBybmcsIHJvb3QsIHN0YXJ0Q29udGFpbmVyLCBlbmRDb250YWluZXIsIHN0YXJ0T2Zmc2V0LCBlbmRPZmZzZXQ7XG5cblx0XHRcdGZ1bmN0aW9uIHNldEVuZFBvaW50KHN0YXJ0KSB7XG5cdFx0XHRcdHZhciBwb2ludCA9IGJvb2ttYXJrW3N0YXJ0ID8gJ3N0YXJ0JyA6ICdlbmQnXSwgaSwgbm9kZSwgb2Zmc2V0LCBjaGlsZHJlbjtcblxuXHRcdFx0XHRpZiAocG9pbnQpIHtcblx0XHRcdFx0XHRvZmZzZXQgPSBwb2ludFswXTtcblxuXHRcdFx0XHRcdC8vIEZpbmQgY29udGFpbmVyIG5vZGVcblx0XHRcdFx0XHRmb3IgKG5vZGUgPSByb290LCBpID0gcG9pbnQubGVuZ3RoIC0gMTsgaSA+PSAxOyBpLS0pIHtcblx0XHRcdFx0XHRcdGNoaWxkcmVuID0gbm9kZS5jaGlsZE5vZGVzO1xuXG5cdFx0XHRcdFx0XHRpZiAocG9pbnRbaV0gPiBjaGlsZHJlbi5sZW5ndGggLSAxKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0bm9kZSA9IGNoaWxkcmVuW3BvaW50W2ldXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHQvLyBNb3ZlIHRleHQgb2Zmc2V0IHRvIGJlc3Qgc3VpdGFibGUgbG9jYXRpb25cblx0XHRcdFx0XHRpZiAobm9kZS5ub2RlVHlwZSA9PT0gMykge1xuXHRcdFx0XHRcdFx0b2Zmc2V0ID0gTWF0aC5taW4ocG9pbnRbMF0sIG5vZGUubm9kZVZhbHVlLmxlbmd0aCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Ly8gTW92ZSBlbGVtZW50IG9mZnNldCB0byBiZXN0IHN1aXRhYmxlIGxvY2F0aW9uXG5cdFx0XHRcdFx0aWYgKG5vZGUubm9kZVR5cGUgPT09IDEpIHtcblx0XHRcdFx0XHRcdG9mZnNldCA9IE1hdGgubWluKHBvaW50WzBdLCBub2RlLmNoaWxkTm9kZXMubGVuZ3RoKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHQvLyBTZXQgb2Zmc2V0IHdpdGhpbiBjb250YWluZXIgbm9kZVxuXHRcdFx0XHRcdGlmIChzdGFydCkge1xuXHRcdFx0XHRcdFx0cm5nLnNldFN0YXJ0KG5vZGUsIG9mZnNldCk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdHJuZy5zZXRFbmQobm9kZSwgb2Zmc2V0KTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gcmVzdG9yZUVuZFBvaW50KHN1ZmZpeCkge1xuXHRcdFx0XHR2YXIgbWFya2VyID0gZG9tLmdldChib29rbWFyay5pZCArICdfJyArIHN1ZmZpeCksIG5vZGUsIGlkeCwgbmV4dCwgcHJldiwga2VlcCA9IGJvb2ttYXJrLmtlZXA7XG5cblx0XHRcdFx0aWYgKG1hcmtlcikge1xuXHRcdFx0XHRcdG5vZGUgPSBtYXJrZXIucGFyZW50Tm9kZTtcblxuXHRcdFx0XHRcdGlmIChzdWZmaXggPT0gJ3N0YXJ0Jykge1xuXHRcdFx0XHRcdFx0aWYgKCFrZWVwKSB7XG5cdFx0XHRcdFx0XHRcdGlkeCA9IGRvbS5ub2RlSW5kZXgobWFya2VyKTtcblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdG5vZGUgPSBtYXJrZXIuZmlyc3RDaGlsZDtcblx0XHRcdFx0XHRcdFx0aWR4ID0gMTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0c3RhcnRDb250YWluZXIgPSBlbmRDb250YWluZXIgPSBub2RlO1xuXHRcdFx0XHRcdFx0c3RhcnRPZmZzZXQgPSBlbmRPZmZzZXQgPSBpZHg7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGlmICgha2VlcCkge1xuXHRcdFx0XHRcdFx0XHRpZHggPSBkb20ubm9kZUluZGV4KG1hcmtlcik7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRub2RlID0gbWFya2VyLmZpcnN0Q2hpbGQ7XG5cdFx0XHRcdFx0XHRcdGlkeCA9IDE7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGVuZENvbnRhaW5lciA9IG5vZGU7XG5cdFx0XHRcdFx0XHRlbmRPZmZzZXQgPSBpZHg7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKCFrZWVwKSB7XG5cdFx0XHRcdFx0XHRwcmV2ID0gbWFya2VyLnByZXZpb3VzU2libGluZztcblx0XHRcdFx0XHRcdG5leHQgPSBtYXJrZXIubmV4dFNpYmxpbmc7XG5cblx0XHRcdFx0XHRcdC8vIFJlbW92ZSBhbGwgbWFya2VyIHRleHQgbm9kZXNcblx0XHRcdFx0XHRcdFRvb2xzLmVhY2goVG9vbHMuZ3JlcChtYXJrZXIuY2hpbGROb2RlcyksIGZ1bmN0aW9uKG5vZGUpIHtcblx0XHRcdFx0XHRcdFx0aWYgKG5vZGUubm9kZVR5cGUgPT0gMykge1xuXHRcdFx0XHRcdFx0XHRcdG5vZGUubm9kZVZhbHVlID0gbm9kZS5ub2RlVmFsdWUucmVwbGFjZSgvXFx1RkVGRi9nLCAnJyk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0XHQvLyBSZW1vdmUgbWFya2VyIGJ1dCBrZWVwIGNoaWxkcmVuIGlmIGZvciBleGFtcGxlIGNvbnRlbnRzIHdoZXJlIGluc2VydGVkIGludG8gdGhlIG1hcmtlclxuXHRcdFx0XHRcdFx0Ly8gQWxzbyByZW1vdmUgZHVwbGljYXRlZCBpbnN0YW5jZXMgb2YgdGhlIG1hcmtlciBmb3IgZXhhbXBsZSBieSBhXG5cdFx0XHRcdFx0XHQvLyBzcGxpdCBvcGVyYXRpb24gb3IgYnkgV2ViS2l0IGF1dG8gc3BsaXQgb24gcGFzdGUgZmVhdHVyZVxuXHRcdFx0XHRcdFx0d2hpbGUgKChtYXJrZXIgPSBkb20uZ2V0KGJvb2ttYXJrLmlkICsgJ18nICsgc3VmZml4KSkpIHtcblx0XHRcdFx0XHRcdFx0ZG9tLnJlbW92ZShtYXJrZXIsIDEpO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHQvLyBJZiBzaWJsaW5ncyBhcmUgdGV4dCBub2RlcyB0aGVuIG1lcmdlIHRoZW0gdW5sZXNzIGl0J3MgT3BlcmEgc2luY2UgaXQgc29tZSBob3cgcmVtb3ZlcyB0aGUgbm9kZVxuXHRcdFx0XHRcdFx0Ly8gYW5kIHdlIGFyZSBzbmlmZmluZyBzaW5jZSBhZGRpbmcgYSBsb3Qgb2YgZGV0ZWN0aW9uIGNvZGUgZm9yIGEgYnJvd3NlciB3aXRoIDMlIG9mIHRoZSBtYXJrZXRcblx0XHRcdFx0XHRcdC8vIGlzbid0IHdvcnRoIHRoZSBlZmZvcnQuIFNvcnJ5LCBPcGVyYSBidXQgaXQncyBqdXN0IGEgZmFjdFxuXHRcdFx0XHRcdFx0aWYgKHByZXYgJiYgbmV4dCAmJiBwcmV2Lm5vZGVUeXBlID09IG5leHQubm9kZVR5cGUgJiYgcHJldi5ub2RlVHlwZSA9PSAzICYmICFFbnYub3BlcmEpIHtcblx0XHRcdFx0XHRcdFx0aWR4ID0gcHJldi5ub2RlVmFsdWUubGVuZ3RoO1xuXHRcdFx0XHRcdFx0XHRwcmV2LmFwcGVuZERhdGEobmV4dC5ub2RlVmFsdWUpO1xuXHRcdFx0XHRcdFx0XHRkb20ucmVtb3ZlKG5leHQpO1xuXG5cdFx0XHRcdFx0XHRcdGlmIChzdWZmaXggPT0gJ3N0YXJ0Jykge1xuXHRcdFx0XHRcdFx0XHRcdHN0YXJ0Q29udGFpbmVyID0gZW5kQ29udGFpbmVyID0gcHJldjtcblx0XHRcdFx0XHRcdFx0XHRzdGFydE9mZnNldCA9IGVuZE9mZnNldCA9IGlkeDtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRlbmRDb250YWluZXIgPSBwcmV2O1xuXHRcdFx0XHRcdFx0XHRcdGVuZE9mZnNldCA9IGlkeDtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRmdW5jdGlvbiBhZGRCb2d1cyhub2RlKSB7XG5cdFx0XHRcdC8vIEFkZHMgYSBib2d1cyBCUiBlbGVtZW50IGZvciBlbXB0eSBibG9jayBlbGVtZW50c1xuXHRcdFx0XHRpZiAoZG9tLmlzQmxvY2sobm9kZSkgJiYgIW5vZGUuaW5uZXJIVE1MICYmICFFbnYuaWUpIHtcblx0XHRcdFx0XHRub2RlLmlubmVySFRNTCA9ICc8YnIgZGF0YS1tY2UtYm9ndXM9XCIxXCIgLz4nO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG5vZGU7XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIHJlc29sdmVDYXJldFBvc2l0aW9uQm9va21hcmsoKSB7XG5cdFx0XHRcdHZhciBybmcsIHBvcztcblxuXHRcdFx0XHRybmcgPSBkb20uY3JlYXRlUm5nKCk7XG5cdFx0XHRcdHBvcyA9IENhcmV0Qm9va21hcmsucmVzb2x2ZShkb20uZ2V0Um9vdCgpLCBib29rbWFyay5zdGFydCk7XG5cdFx0XHRcdHJuZy5zZXRTdGFydChwb3MuY29udGFpbmVyKCksIHBvcy5vZmZzZXQoKSk7XG5cblx0XHRcdFx0cG9zID0gQ2FyZXRCb29rbWFyay5yZXNvbHZlKGRvbS5nZXRSb290KCksIGJvb2ttYXJrLmVuZCk7XG5cdFx0XHRcdHJuZy5zZXRFbmQocG9zLmNvbnRhaW5lcigpLCBwb3Mub2Zmc2V0KCkpO1xuXG5cdFx0XHRcdHJldHVybiBybmc7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChib29rbWFyaykge1xuXHRcdFx0XHRpZiAoVG9vbHMuaXNBcnJheShib29rbWFyay5zdGFydCkpIHtcblx0XHRcdFx0XHRybmcgPSBkb20uY3JlYXRlUm5nKCk7XG5cdFx0XHRcdFx0cm9vdCA9IGRvbS5nZXRSb290KCk7XG5cblx0XHRcdFx0XHRpZiAoc2VsZWN0aW9uLnRyaWRlbnRTZWwpIHtcblx0XHRcdFx0XHRcdHJldHVybiBzZWxlY3Rpb24udHJpZGVudFNlbC5tb3ZlVG9Cb29rbWFyayhib29rbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHNldEVuZFBvaW50KHRydWUpICYmIHNldEVuZFBvaW50KCkpIHtcblx0XHRcdFx0XHRcdHNlbGVjdGlvbi5zZXRSbmcocm5nKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mIGJvb2ttYXJrLnN0YXJ0ID09ICdzdHJpbmcnKSB7XG5cdFx0XHRcdFx0c2VsZWN0aW9uLnNldFJuZyhyZXNvbHZlQ2FyZXRQb3NpdGlvbkJvb2ttYXJrKGJvb2ttYXJrKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoYm9va21hcmsuaWQpIHtcblx0XHRcdFx0XHQvLyBSZXN0b3JlIHN0YXJ0L2VuZCBwb2ludHNcblx0XHRcdFx0XHRyZXN0b3JlRW5kUG9pbnQoJ3N0YXJ0Jyk7XG5cdFx0XHRcdFx0cmVzdG9yZUVuZFBvaW50KCdlbmQnKTtcblxuXHRcdFx0XHRcdGlmIChzdGFydENvbnRhaW5lcikge1xuXHRcdFx0XHRcdFx0cm5nID0gZG9tLmNyZWF0ZVJuZygpO1xuXHRcdFx0XHRcdFx0cm5nLnNldFN0YXJ0KGFkZEJvZ3VzKHN0YXJ0Q29udGFpbmVyKSwgc3RhcnRPZmZzZXQpO1xuXHRcdFx0XHRcdFx0cm5nLnNldEVuZChhZGRCb2d1cyhlbmRDb250YWluZXIpLCBlbmRPZmZzZXQpO1xuXHRcdFx0XHRcdFx0c2VsZWN0aW9uLnNldFJuZyhybmcpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIGlmIChib29rbWFyay5uYW1lKSB7XG5cdFx0XHRcdFx0c2VsZWN0aW9uLnNlbGVjdChkb20uc2VsZWN0KGJvb2ttYXJrLm5hbWUpW2Jvb2ttYXJrLmluZGV4XSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoYm9va21hcmsucm5nKSB7XG5cdFx0XHRcdFx0c2VsZWN0aW9uLnNldFJuZyhib29rbWFyay5ybmcpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fTtcblx0fVxuXG5cdC8qKlxuXHQgKiBSZXR1cm5zIHRydWUvZmFsc2UgaWYgdGhlIHNwZWNpZmllZCBub2RlIGlzIGEgYm9va21hcmsgbm9kZSBvciBub3QuXG5cdCAqXG5cdCAqIEBzdGF0aWNcblx0ICogQG1ldGhvZCBpc0Jvb2ttYXJrTm9kZVxuXHQgKiBAcGFyYW0ge0RPTU5vZGV9IG5vZGUgRE9NIE5vZGUgdG8gY2hlY2sgaWYgaXQncyBhIGJvb2ttYXJrIG5vZGUgb3Igbm90LlxuXHQgKiBAcmV0dXJuIHtCb29sZWFufSB0cnVlL2ZhbHNlIGlmIHRoZSBub2RlIGlzIGEgYm9va21hcmsgbm9kZSBvciBub3QuXG5cdCAqL1xuXHRCb29rbWFya01hbmFnZXIuaXNCb29rbWFya05vZGUgPSBmdW5jdGlvbihub2RlKSB7XG5cdFx0cmV0dXJuIG5vZGUgJiYgbm9kZS50YWdOYW1lID09PSAnU1BBTicgJiYgbm9kZS5nZXRBdHRyaWJ1dGUoJ2RhdGEtbWNlLXR5cGUnKSA9PT0gJ2Jvb2ttYXJrJztcblx0fTtcblxuXHRyZXR1cm4gQm9va21hcmtNYW5hZ2VyO1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy9kb20vU2VsZWN0aW9uLmpzXG5cbi8qKlxuICogU2VsZWN0aW9uLmpzXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgTEdQTCBMaWNlbnNlLlxuICogQ29weXJpZ2h0IChjKSAxOTk5LTIwMTUgRXBob3ggQ29ycC4gQWxsIHJpZ2h0cyByZXNlcnZlZFxuICpcbiAqIExpY2Vuc2U6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vbGljZW5zZVxuICogQ29udHJpYnV0aW5nOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2NvbnRyaWJ1dGluZ1xuICovXG5cbi8qKlxuICogVGhpcyBjbGFzcyBoYW5kbGVzIHRleHQgYW5kIGNvbnRyb2wgc2VsZWN0aW9uIGl0J3MgYW4gY3Jvc3Nicm93c2VyIHV0aWxpdHkgY2xhc3MuXG4gKiBDb25zdWx0IHRoZSBUaW55TUNFIFdpa2kgQVBJIGZvciBtb3JlIGRldGFpbHMgYW5kIGV4YW1wbGVzIG9uIGhvdyB0byB1c2UgdGhpcyBjbGFzcy5cbiAqXG4gKiBAY2xhc3MgdGlueW1jZS5kb20uU2VsZWN0aW9uXG4gKiBAZXhhbXBsZVxuICogLy8gR2V0dGluZyB0aGUgY3VycmVudGx5IHNlbGVjdGVkIG5vZGUgZm9yIHRoZSBhY3RpdmUgZWRpdG9yXG4gKiBhbGVydCh0aW55bWNlLmFjdGl2ZUVkaXRvci5zZWxlY3Rpb24uZ2V0Tm9kZSgpLm5vZGVOYW1lKTtcbiAqL1xuZGVmaW5lKFwidGlueW1jZS9kb20vU2VsZWN0aW9uXCIsIFtcblx0XCJ0aW55bWNlL2RvbS9UcmVlV2Fsa2VyXCIsXG5cdFwidGlueW1jZS9kb20vVHJpZGVudFNlbGVjdGlvblwiLFxuXHRcInRpbnltY2UvZG9tL0NvbnRyb2xTZWxlY3Rpb25cIixcblx0XCJ0aW55bWNlL2RvbS9SYW5nZVV0aWxzXCIsXG5cdFwidGlueW1jZS9kb20vQm9va21hcmtNYW5hZ2VyXCIsXG5cdFwidGlueW1jZS9kb20vTm9kZVR5cGVcIixcblx0XCJ0aW55bWNlL0VudlwiLFxuXHRcInRpbnltY2UvdXRpbC9Ub29sc1wiLFxuXHRcInRpbnltY2UvY2FyZXQvQ2FyZXRQb3NpdGlvblwiXG5dLCBmdW5jdGlvbihUcmVlV2Fsa2VyLCBUcmlkZW50U2VsZWN0aW9uLCBDb250cm9sU2VsZWN0aW9uLCBSYW5nZVV0aWxzLCBCb29rbWFya01hbmFnZXIsIE5vZGVUeXBlLCBFbnYsIFRvb2xzLCBDYXJldFBvc2l0aW9uKSB7XG5cdHZhciBlYWNoID0gVG9vbHMuZWFjaCwgdHJpbSA9IFRvb2xzLnRyaW07XG5cdHZhciBpc0lFID0gRW52LmllO1xuXG5cdC8qKlxuXHQgKiBDb25zdHJ1Y3RzIGEgbmV3IHNlbGVjdGlvbiBpbnN0YW5jZS5cblx0ICpcblx0ICogQGNvbnN0cnVjdG9yXG5cdCAqIEBtZXRob2QgU2VsZWN0aW9uXG5cdCAqIEBwYXJhbSB7dGlueW1jZS5kb20uRE9NVXRpbHN9IGRvbSBET01VdGlscyBvYmplY3QgcmVmZXJlbmNlLlxuXHQgKiBAcGFyYW0ge1dpbmRvd30gd2luIFdpbmRvdyB0byBiaW5kIHRoZSBzZWxlY3Rpb24gb2JqZWN0IHRvLlxuXHQgKiBAcGFyYW0ge3RpbnltY2UuRWRpdG9yfSBlZGl0b3IgRWRpdG9yIGluc3RhbmNlIG9mIHRoZSBzZWxlY3Rpb24uXG5cdCAqIEBwYXJhbSB7dGlueW1jZS5kb20uU2VyaWFsaXplcn0gc2VyaWFsaXplciBET00gc2VyaWFsaXphdGlvbiBjbGFzcyB0byB1c2UgZm9yIGdldENvbnRlbnQuXG5cdCAqL1xuXHRmdW5jdGlvbiBTZWxlY3Rpb24oZG9tLCB3aW4sIHNlcmlhbGl6ZXIsIGVkaXRvcikge1xuXHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdHNlbGYuZG9tID0gZG9tO1xuXHRcdHNlbGYud2luID0gd2luO1xuXHRcdHNlbGYuc2VyaWFsaXplciA9IHNlcmlhbGl6ZXI7XG5cdFx0c2VsZi5lZGl0b3IgPSBlZGl0b3I7XG5cdFx0c2VsZi5ib29rbWFya01hbmFnZXIgPSBuZXcgQm9va21hcmtNYW5hZ2VyKHNlbGYpO1xuXHRcdHNlbGYuY29udHJvbFNlbGVjdGlvbiA9IG5ldyBDb250cm9sU2VsZWN0aW9uKHNlbGYsIGVkaXRvcik7XG5cblx0XHQvLyBObyBXM0MgUmFuZ2Ugc3VwcG9ydFxuXHRcdGlmICghc2VsZi53aW4uZ2V0U2VsZWN0aW9uKSB7XG5cdFx0XHRzZWxmLnRyaWRlbnRTZWwgPSBuZXcgVHJpZGVudFNlbGVjdGlvbihzZWxmKTtcblx0XHR9XG5cdH1cblxuXHRTZWxlY3Rpb24ucHJvdG90eXBlID0ge1xuXHRcdC8qKlxuXHRcdCAqIE1vdmUgdGhlIHNlbGVjdGlvbiBjdXJzb3IgcmFuZ2UgdG8gdGhlIHNwZWNpZmllZCBub2RlIGFuZCBvZmZzZXQuXG5cdFx0ICogSWYgdGhlcmUgaXMgbm8gbm9kZSBzcGVjaWZpZWQgaXQgd2lsbCBtb3ZlIGl0IHRvIHRoZSBmaXJzdCBzdWl0YWJsZSBsb2NhdGlvbiB3aXRoaW4gdGhlIGJvZHkuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHNldEN1cnNvckxvY2F0aW9uXG5cdFx0ICogQHBhcmFtIHtOb2RlfSBub2RlIE9wdGlvbmFsIG5vZGUgdG8gcHV0IHRoZSBjdXJzb3IgaW4uXG5cdFx0ICogQHBhcmFtIHtOdW1iZXJ9IG9mZnNldCBPcHRpb25hbCBvZmZzZXQgZnJvbSB0aGUgc3RhcnQgb2YgdGhlIG5vZGUgdG8gcHV0IHRoZSBjdXJzb3IgYXQuXG5cdFx0ICovXG5cdFx0c2V0Q3Vyc29yTG9jYXRpb246IGZ1bmN0aW9uKG5vZGUsIG9mZnNldCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLCBybmcgPSBzZWxmLmRvbS5jcmVhdGVSbmcoKTtcblxuXHRcdFx0aWYgKCFub2RlKSB7XG5cdFx0XHRcdHNlbGYuX21vdmVFbmRQb2ludChybmcsIHNlbGYuZWRpdG9yLmdldEJvZHkoKSwgdHJ1ZSk7XG5cdFx0XHRcdHNlbGYuc2V0Um5nKHJuZyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRybmcuc2V0U3RhcnQobm9kZSwgb2Zmc2V0KTtcblx0XHRcdFx0cm5nLnNldEVuZChub2RlLCBvZmZzZXQpO1xuXHRcdFx0XHRzZWxmLnNldFJuZyhybmcpO1xuXHRcdFx0XHRzZWxmLmNvbGxhcHNlKGZhbHNlKTtcblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyB0aGUgc2VsZWN0ZWQgY29udGVudHMgdXNpbmcgdGhlIERPTSBzZXJpYWxpemVyIHBhc3NlZCBpbiB0byB0aGlzIGNsYXNzLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBnZXRDb250ZW50XG5cdFx0ICogQHBhcmFtIHtPYmplY3R9IGFyZ3MgT3B0aW9uYWwgc2V0dGluZ3MgY2xhc3Mgd2l0aCBmb3IgZXhhbXBsZSBvdXRwdXQgZm9ybWF0IHRleHQgb3IgaHRtbC5cblx0XHQgKiBAcmV0dXJuIHtTdHJpbmd9IFNlbGVjdGVkIGNvbnRlbnRzIGluIGZvciBleGFtcGxlIEhUTUwgZm9ybWF0LlxuXHRcdCAqIEBleGFtcGxlXG5cdFx0ICogLy8gQWxlcnRzIHRoZSBjdXJyZW50bHkgc2VsZWN0ZWQgY29udGVudHNcblx0XHQgKiBhbGVydCh0aW55bWNlLmFjdGl2ZUVkaXRvci5zZWxlY3Rpb24uZ2V0Q29udGVudCgpKTtcblx0XHQgKlxuXHRcdCAqIC8vIEFsZXJ0cyB0aGUgY3VycmVudGx5IHNlbGVjdGVkIGNvbnRlbnRzIGFzIHBsYWluIHRleHRcblx0XHQgKiBhbGVydCh0aW55bWNlLmFjdGl2ZUVkaXRvci5zZWxlY3Rpb24uZ2V0Q29udGVudCh7Zm9ybWF0OiAndGV4dCd9KSk7XG5cdFx0ICovXG5cdFx0Z2V0Q29udGVudDogZnVuY3Rpb24oYXJncykge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLCBybmcgPSBzZWxmLmdldFJuZygpLCB0bXBFbG0gPSBzZWxmLmRvbS5jcmVhdGUoXCJib2R5XCIpO1xuXHRcdFx0dmFyIHNlID0gc2VsZi5nZXRTZWwoKSwgd2hpdGVTcGFjZUJlZm9yZSwgd2hpdGVTcGFjZUFmdGVyLCBmcmFnbWVudDtcblxuXHRcdFx0YXJncyA9IGFyZ3MgfHwge307XG5cdFx0XHR3aGl0ZVNwYWNlQmVmb3JlID0gd2hpdGVTcGFjZUFmdGVyID0gJyc7XG5cdFx0XHRhcmdzLmdldCA9IHRydWU7XG5cdFx0XHRhcmdzLmZvcm1hdCA9IGFyZ3MuZm9ybWF0IHx8ICdodG1sJztcblx0XHRcdGFyZ3Muc2VsZWN0aW9uID0gdHJ1ZTtcblx0XHRcdHNlbGYuZWRpdG9yLmZpcmUoJ0JlZm9yZUdldENvbnRlbnQnLCBhcmdzKTtcblxuXHRcdFx0aWYgKGFyZ3MuZm9ybWF0ID09ICd0ZXh0Jykge1xuXHRcdFx0XHRyZXR1cm4gc2VsZi5pc0NvbGxhcHNlZCgpID8gJycgOiAocm5nLnRleHQgfHwgKHNlLnRvU3RyaW5nID8gc2UudG9TdHJpbmcoKSA6ICcnKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChybmcuY2xvbmVDb250ZW50cykge1xuXHRcdFx0XHRmcmFnbWVudCA9IHJuZy5jbG9uZUNvbnRlbnRzKCk7XG5cblx0XHRcdFx0aWYgKGZyYWdtZW50KSB7XG5cdFx0XHRcdFx0dG1wRWxtLmFwcGVuZENoaWxkKGZyYWdtZW50KTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChybmcuaXRlbSAhPT0gdW5kZWZpbmVkIHx8IHJuZy5odG1sVGV4dCAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRcdC8vIElFIHdpbGwgcHJvZHVjZSBpbnZhbGlkIG1hcmt1cCBpZiBlbGVtZW50cyBhcmUgcHJlc2VudCB0aGF0XG5cdFx0XHRcdC8vIGl0IGRvZXNuJ3QgdW5kZXJzdGFuZCBsaWtlIGN1c3RvbSBlbGVtZW50cyBvciBIVE1MNSBlbGVtZW50cy5cblx0XHRcdFx0Ly8gQWRkaW5nIGEgQlIgaW4gZnJvbnQgb2YgdGhlIGNvbnRlbnRzIGFuZCB0aGVuIHJlbW9pdmluZyBpdCBzZWVtcyB0byBmaXggaXQgdGhvdWdoLlxuXHRcdFx0XHR0bXBFbG0uaW5uZXJIVE1MID0gJzxicj4nICsgKHJuZy5pdGVtID8gcm5nLml0ZW0oMCkub3V0ZXJIVE1MIDogcm5nLmh0bWxUZXh0KTtcblx0XHRcdFx0dG1wRWxtLnJlbW92ZUNoaWxkKHRtcEVsbS5maXJzdENoaWxkKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRtcEVsbS5pbm5lckhUTUwgPSBybmcudG9TdHJpbmcoKTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gS2VlcCB3aGl0ZXNwYWNlIGJlZm9yZSBhbmQgYWZ0ZXJcblx0XHRcdGlmICgvXlxccy8udGVzdCh0bXBFbG0uaW5uZXJIVE1MKSkge1xuXHRcdFx0XHR3aGl0ZVNwYWNlQmVmb3JlID0gJyAnO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoL1xccyskLy50ZXN0KHRtcEVsbS5pbm5lckhUTUwpKSB7XG5cdFx0XHRcdHdoaXRlU3BhY2VBZnRlciA9ICcgJztcblx0XHRcdH1cblxuXHRcdFx0YXJncy5nZXRJbm5lciA9IHRydWU7XG5cblx0XHRcdGFyZ3MuY29udGVudCA9IHNlbGYuaXNDb2xsYXBzZWQoKSA/ICcnIDogd2hpdGVTcGFjZUJlZm9yZSArIHNlbGYuc2VyaWFsaXplci5zZXJpYWxpemUodG1wRWxtLCBhcmdzKSArIHdoaXRlU3BhY2VBZnRlcjtcblx0XHRcdHNlbGYuZWRpdG9yLmZpcmUoJ0dldENvbnRlbnQnLCBhcmdzKTtcblxuXHRcdFx0cmV0dXJuIGFyZ3MuY29udGVudDtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogU2V0cyB0aGUgY3VycmVudCBzZWxlY3Rpb24gdG8gdGhlIHNwZWNpZmllZCBjb250ZW50LiBJZiBhbnkgY29udGVudHMgaXMgc2VsZWN0ZWQgaXQgd2lsbCBiZSByZXBsYWNlZFxuXHRcdCAqIHdpdGggdGhlIGNvbnRlbnRzIHBhc3NlZCBpbiB0byB0aGlzIGZ1bmN0aW9uLiBJZiB0aGVyZSBpcyBubyBzZWxlY3Rpb24gdGhlIGNvbnRlbnRzIHdpbGwgYmUgaW5zZXJ0ZWRcblx0XHQgKiB3aGVyZSB0aGUgY2FyZXQgaXMgcGxhY2VkIGluIHRoZSBlZGl0b3IvcGFnZS5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2Qgc2V0Q29udGVudFxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBjb250ZW50IEhUTUwgY29udGVudHMgdG8gc2V0IGNvdWxkIGFsc28gYmUgb3RoZXIgZm9ybWF0cyBkZXBlbmRpbmcgb24gc2V0dGluZ3MuXG5cdFx0ICogQHBhcmFtIHtPYmplY3R9IGFyZ3MgT3B0aW9uYWwgc2V0dGluZ3Mgb2JqZWN0IHdpdGggZm9yIGV4YW1wbGUgZGF0YSBmb3JtYXQuXG5cdFx0ICogQGV4YW1wbGVcblx0XHQgKiAvLyBJbnNlcnRzIHNvbWUgSFRNTCBjb250ZW50cyBhdCB0aGUgY3VycmVudCBzZWxlY3Rpb25cblx0XHQgKiB0aW55bWNlLmFjdGl2ZUVkaXRvci5zZWxlY3Rpb24uc2V0Q29udGVudCgnPHN0cm9uZz5Tb21lIGNvbnRlbnRzPC9zdHJvbmc+Jyk7XG5cdFx0ICovXG5cdFx0c2V0Q29udGVudDogZnVuY3Rpb24oY29udGVudCwgYXJncykge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLCBybmcgPSBzZWxmLmdldFJuZygpLCBjYXJldE5vZGUsIGRvYyA9IHNlbGYud2luLmRvY3VtZW50LCBmcmFnLCB0ZW1wO1xuXG5cdFx0XHRhcmdzID0gYXJncyB8fCB7Zm9ybWF0OiAnaHRtbCd9O1xuXHRcdFx0YXJncy5zZXQgPSB0cnVlO1xuXHRcdFx0YXJncy5zZWxlY3Rpb24gPSB0cnVlO1xuXHRcdFx0YXJncy5jb250ZW50ID0gY29udGVudDtcblxuXHRcdFx0Ly8gRGlzcGF0Y2ggYmVmb3JlIHNldCBjb250ZW50IGV2ZW50XG5cdFx0XHRpZiAoIWFyZ3Mubm9fZXZlbnRzKSB7XG5cdFx0XHRcdHNlbGYuZWRpdG9yLmZpcmUoJ0JlZm9yZVNldENvbnRlbnQnLCBhcmdzKTtcblx0XHRcdH1cblxuXHRcdFx0Y29udGVudCA9IGFyZ3MuY29udGVudDtcblxuXHRcdFx0aWYgKHJuZy5pbnNlcnROb2RlKSB7XG5cdFx0XHRcdC8vIE1ha2UgY2FyZXQgbWFya2VyIHNpbmNlIGluc2VydE5vZGUgcGxhY2VzIHRoZSBjYXJldCBpbiB0aGUgYmVnaW5uaW5nIG9mIHRleHQgYWZ0ZXIgaW5zZXJ0XG5cdFx0XHRcdGNvbnRlbnQgKz0gJzxzcGFuIGlkPVwiX19jYXJldFwiPl88L3NwYW4+JztcblxuXHRcdFx0XHQvLyBEZWxldGUgYW5kIGluc2VydCBuZXcgbm9kZVxuXHRcdFx0XHRpZiAocm5nLnN0YXJ0Q29udGFpbmVyID09IGRvYyAmJiBybmcuZW5kQ29udGFpbmVyID09IGRvYykge1xuXHRcdFx0XHRcdC8vIFdlYktpdCB3aWxsIGZhaWwgaWYgdGhlIGJvZHkgaXMgZW1wdHkgc2luY2UgdGhlIHJhbmdlIGlzIHRoZW4gaW52YWxpZCBhbmQgaXQgY2FuJ3QgaW5zZXJ0IGNvbnRlbnRzXG5cdFx0XHRcdFx0ZG9jLmJvZHkuaW5uZXJIVE1MID0gY29udGVudDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRybmcuZGVsZXRlQ29udGVudHMoKTtcblxuXHRcdFx0XHRcdGlmIChkb2MuYm9keS5jaGlsZE5vZGVzLmxlbmd0aCA9PT0gMCkge1xuXHRcdFx0XHRcdFx0ZG9jLmJvZHkuaW5uZXJIVE1MID0gY29udGVudDtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0Ly8gY3JlYXRlQ29udGV4dHVhbEZyYWdtZW50IGRvZXNuJ3QgZXhpc3RzIGluIElFIDkgRE9NUmFuZ2VzXG5cdFx0XHRcdFx0XHRpZiAocm5nLmNyZWF0ZUNvbnRleHR1YWxGcmFnbWVudCkge1xuXHRcdFx0XHRcdFx0XHRybmcuaW5zZXJ0Tm9kZShybmcuY3JlYXRlQ29udGV4dHVhbEZyYWdtZW50KGNvbnRlbnQpKTtcblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdC8vIEZha2UgY3JlYXRlQ29udGV4dHVhbEZyYWdtZW50IGNhbGwgaW4gSUUgOVxuXHRcdFx0XHRcdFx0XHRmcmFnID0gZG9jLmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcblx0XHRcdFx0XHRcdFx0dGVtcCA9IGRvYy5jcmVhdGVFbGVtZW50KCdkaXYnKTtcblxuXHRcdFx0XHRcdFx0XHRmcmFnLmFwcGVuZENoaWxkKHRlbXApO1xuXHRcdFx0XHRcdFx0XHR0ZW1wLm91dGVySFRNTCA9IGNvbnRlbnQ7XG5cblx0XHRcdFx0XHRcdFx0cm5nLmluc2VydE5vZGUoZnJhZyk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gTW92ZSB0byBjYXJldCBtYXJrZXJcblx0XHRcdFx0Y2FyZXROb2RlID0gc2VsZi5kb20uZ2V0KCdfX2NhcmV0Jyk7XG5cblx0XHRcdFx0Ly8gTWFrZSBzdXJlIHdlIHdyYXAgaXQgY29tcGxlYXRseSwgT3BlcmEgZmFpbHMgd2l0aCBhIHNpbXBsZSBzZWxlY3QgY2FsbFxuXHRcdFx0XHRybmcgPSBkb2MuY3JlYXRlUmFuZ2UoKTtcblx0XHRcdFx0cm5nLnNldFN0YXJ0QmVmb3JlKGNhcmV0Tm9kZSk7XG5cdFx0XHRcdHJuZy5zZXRFbmRCZWZvcmUoY2FyZXROb2RlKTtcblx0XHRcdFx0c2VsZi5zZXRSbmcocm5nKTtcblxuXHRcdFx0XHQvLyBSZW1vdmUgdGhlIGNhcmV0IHBvc2l0aW9uXG5cdFx0XHRcdHNlbGYuZG9tLnJlbW92ZSgnX19jYXJldCcpO1xuXG5cdFx0XHRcdHRyeSB7XG5cdFx0XHRcdFx0c2VsZi5zZXRSbmcocm5nKTtcblx0XHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0XHQvLyBNaWdodCBmYWlsIG9uIE9wZXJhIGZvciBzb21lIG9kZCByZWFzb25cblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0aWYgKHJuZy5pdGVtKSB7XG5cdFx0XHRcdFx0Ly8gRGVsZXRlIGNvbnRlbnQgYW5kIGdldCBjYXJldCB0ZXh0IHNlbGVjdGlvblxuXHRcdFx0XHRcdGRvYy5leGVjQ29tbWFuZCgnRGVsZXRlJywgZmFsc2UsIG51bGwpO1xuXHRcdFx0XHRcdHJuZyA9IHNlbGYuZ2V0Um5nKCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBFeHBsb3JlciByZW1vdmVzIHNwYWNlcyBmcm9tIHRoZSBiZWdpbm5pbmcgb2YgcGFzdGVkIGNvbnRlbnRzXG5cdFx0XHRcdGlmICgvXlxccysvLnRlc3QoY29udGVudCkpIHtcblx0XHRcdFx0XHRybmcucGFzdGVIVE1MKCc8c3BhbiBpZD1cIl9fbWNlX3RtcFwiPl88L3NwYW4+JyArIGNvbnRlbnQpO1xuXHRcdFx0XHRcdHNlbGYuZG9tLnJlbW92ZSgnX19tY2VfdG1wJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0cm5nLnBhc3RlSFRNTChjb250ZW50KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHQvLyBEaXNwYXRjaCBzZXQgY29udGVudCBldmVudFxuXHRcdFx0aWYgKCFhcmdzLm5vX2V2ZW50cykge1xuXHRcdFx0XHRzZWxmLmVkaXRvci5maXJlKCdTZXRDb250ZW50JywgYXJncyk7XG5cdFx0XHR9XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFJldHVybnMgdGhlIHN0YXJ0IGVsZW1lbnQgb2YgYSBzZWxlY3Rpb24gcmFuZ2UuIElmIHRoZSBzdGFydCBpcyBpbiBhIHRleHRcblx0XHQgKiBub2RlIHRoZSBwYXJlbnQgZWxlbWVudCB3aWxsIGJlIHJldHVybmVkLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBnZXRTdGFydFxuXHRcdCAqIEBwYXJhbSB7Qm9vbGVhbn0gcmVhbCBPcHRpb25hbCBzdGF0ZSB0byBnZXQgdGhlIHJlYWwgcGFyZW50IHdoZW4gdGhlIHNlbGVjdGlvbiBpcyBjb2xsYXBzZWQgbm90IHRoZSBjbG9zZXN0IGVsZW1lbnQuXG5cdFx0ICogQHJldHVybiB7RWxlbWVudH0gU3RhcnQgZWxlbWVudCBvZiBzZWxlY3Rpb24gcmFuZ2UuXG5cdFx0ICovXG5cdFx0Z2V0U3RhcnQ6IGZ1bmN0aW9uKHJlYWwpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgcm5nID0gc2VsZi5nZXRSbmcoKSwgc3RhcnRFbGVtZW50LCBwYXJlbnRFbGVtZW50LCBjaGVja1JuZywgbm9kZTtcblxuXHRcdFx0aWYgKHJuZy5kdXBsaWNhdGUgfHwgcm5nLml0ZW0pIHtcblx0XHRcdFx0Ly8gQ29udHJvbCBzZWxlY3Rpb24sIHJldHVybiBmaXJzdCBpdGVtXG5cdFx0XHRcdGlmIChybmcuaXRlbSkge1xuXHRcdFx0XHRcdHJldHVybiBybmcuaXRlbSgwKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIEdldCBzdGFydCBlbGVtZW50XG5cdFx0XHRcdGNoZWNrUm5nID0gcm5nLmR1cGxpY2F0ZSgpO1xuXHRcdFx0XHRjaGVja1JuZy5jb2xsYXBzZSgxKTtcblx0XHRcdFx0c3RhcnRFbGVtZW50ID0gY2hlY2tSbmcucGFyZW50RWxlbWVudCgpO1xuXHRcdFx0XHRpZiAoc3RhcnRFbGVtZW50Lm93bmVyRG9jdW1lbnQgIT09IHNlbGYuZG9tLmRvYykge1xuXHRcdFx0XHRcdHN0YXJ0RWxlbWVudCA9IHNlbGYuZG9tLmdldFJvb3QoKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIENoZWNrIGlmIHJhbmdlIHBhcmVudCBpcyBpbnNpZGUgdGhlIHN0YXJ0IGVsZW1lbnQsIHRoZW4gcmV0dXJuIHRoZSBpbm5lciBwYXJlbnQgZWxlbWVudFxuXHRcdFx0XHQvLyBUaGlzIHdpbGwgZml4IGlzc3VlcyB3aGVuIGEgc2luZ2xlIGVsZW1lbnQgaXMgc2VsZWN0ZWQsIElFIHdvdWxkIG90aGVyd2lzZSByZXR1cm4gdGhlIHdyb25nIHN0YXJ0IGVsZW1lbnRcblx0XHRcdFx0cGFyZW50RWxlbWVudCA9IG5vZGUgPSBybmcucGFyZW50RWxlbWVudCgpO1xuXHRcdFx0XHR3aGlsZSAoKG5vZGUgPSBub2RlLnBhcmVudE5vZGUpKSB7XG5cdFx0XHRcdFx0aWYgKG5vZGUgPT0gc3RhcnRFbGVtZW50KSB7XG5cdFx0XHRcdFx0XHRzdGFydEVsZW1lbnQgPSBwYXJlbnRFbGVtZW50O1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHN0YXJ0RWxlbWVudDtcblx0XHRcdH1cblxuXHRcdFx0c3RhcnRFbGVtZW50ID0gcm5nLnN0YXJ0Q29udGFpbmVyO1xuXG5cdFx0XHRpZiAoc3RhcnRFbGVtZW50Lm5vZGVUeXBlID09IDEgJiYgc3RhcnRFbGVtZW50Lmhhc0NoaWxkTm9kZXMoKSkge1xuXHRcdFx0XHRpZiAoIXJlYWwgfHwgIXJuZy5jb2xsYXBzZWQpIHtcblx0XHRcdFx0XHRzdGFydEVsZW1lbnQgPSBzdGFydEVsZW1lbnQuY2hpbGROb2Rlc1tNYXRoLm1pbihzdGFydEVsZW1lbnQuY2hpbGROb2Rlcy5sZW5ndGggLSAxLCBybmcuc3RhcnRPZmZzZXQpXTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAoc3RhcnRFbGVtZW50ICYmIHN0YXJ0RWxlbWVudC5ub2RlVHlwZSA9PSAzKSB7XG5cdFx0XHRcdHJldHVybiBzdGFydEVsZW1lbnQucGFyZW50Tm9kZTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHN0YXJ0RWxlbWVudDtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyB0aGUgZW5kIGVsZW1lbnQgb2YgYSBzZWxlY3Rpb24gcmFuZ2UuIElmIHRoZSBlbmQgaXMgaW4gYSB0ZXh0XG5cdFx0ICogbm9kZSB0aGUgcGFyZW50IGVsZW1lbnQgd2lsbCBiZSByZXR1cm5lZC5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgZ2V0RW5kXG5cdFx0ICogQHBhcmFtIHtCb29sZWFufSByZWFsIE9wdGlvbmFsIHN0YXRlIHRvIGdldCB0aGUgcmVhbCBwYXJlbnQgd2hlbiB0aGUgc2VsZWN0aW9uIGlzIGNvbGxhcHNlZCBub3QgdGhlIGNsb3Nlc3QgZWxlbWVudC5cblx0XHQgKiBAcmV0dXJuIHtFbGVtZW50fSBFbmQgZWxlbWVudCBvZiBzZWxlY3Rpb24gcmFuZ2UuXG5cdFx0ICovXG5cdFx0Z2V0RW5kOiBmdW5jdGlvbihyZWFsKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIHJuZyA9IHNlbGYuZ2V0Um5nKCksIGVuZEVsZW1lbnQsIGVuZE9mZnNldDtcblxuXHRcdFx0aWYgKHJuZy5kdXBsaWNhdGUgfHwgcm5nLml0ZW0pIHtcblx0XHRcdFx0aWYgKHJuZy5pdGVtKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHJuZy5pdGVtKDApO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cm5nID0gcm5nLmR1cGxpY2F0ZSgpO1xuXHRcdFx0XHRybmcuY29sbGFwc2UoMCk7XG5cdFx0XHRcdGVuZEVsZW1lbnQgPSBybmcucGFyZW50RWxlbWVudCgpO1xuXHRcdFx0XHRpZiAoZW5kRWxlbWVudC5vd25lckRvY3VtZW50ICE9PSBzZWxmLmRvbS5kb2MpIHtcblx0XHRcdFx0XHRlbmRFbGVtZW50ID0gc2VsZi5kb20uZ2V0Um9vdCgpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKGVuZEVsZW1lbnQgJiYgZW5kRWxlbWVudC5ub2RlTmFtZSA9PSAnQk9EWScpIHtcblx0XHRcdFx0XHRyZXR1cm4gZW5kRWxlbWVudC5sYXN0Q2hpbGQgfHwgZW5kRWxlbWVudDtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBlbmRFbGVtZW50O1xuXHRcdFx0fVxuXG5cdFx0XHRlbmRFbGVtZW50ID0gcm5nLmVuZENvbnRhaW5lcjtcblx0XHRcdGVuZE9mZnNldCA9IHJuZy5lbmRPZmZzZXQ7XG5cblx0XHRcdGlmIChlbmRFbGVtZW50Lm5vZGVUeXBlID09IDEgJiYgZW5kRWxlbWVudC5oYXNDaGlsZE5vZGVzKCkpIHtcblx0XHRcdFx0aWYgKCFyZWFsIHx8ICFybmcuY29sbGFwc2VkKSB7XG5cdFx0XHRcdFx0ZW5kRWxlbWVudCA9IGVuZEVsZW1lbnQuY2hpbGROb2Rlc1tlbmRPZmZzZXQgPiAwID8gZW5kT2Zmc2V0IC0gMSA6IGVuZE9mZnNldF07XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKGVuZEVsZW1lbnQgJiYgZW5kRWxlbWVudC5ub2RlVHlwZSA9PSAzKSB7XG5cdFx0XHRcdHJldHVybiBlbmRFbGVtZW50LnBhcmVudE5vZGU7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBlbmRFbGVtZW50O1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZXR1cm5zIGEgYm9va21hcmsgbG9jYXRpb24gZm9yIHRoZSBjdXJyZW50IHNlbGVjdGlvbi4gVGhpcyBib29rbWFyayBvYmplY3Rcblx0XHQgKiBjYW4gdGhlbiBiZSB1c2VkIHRvIHJlc3RvcmUgdGhlIHNlbGVjdGlvbiBhZnRlciBzb21lIGNvbnRlbnQgbW9kaWZpY2F0aW9uIHRvIHRoZSBkb2N1bWVudC5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgZ2V0Qm9va21hcmtcblx0XHQgKiBAcGFyYW0ge051bWJlcn0gdHlwZSBPcHRpb25hbCBzdGF0ZSBpZiB0aGUgYm9va21hcmsgc2hvdWxkIGJlIHNpbXBsZSBvciBub3QuIERlZmF1bHQgaXMgY29tcGxleC5cblx0XHQgKiBAcGFyYW0ge0Jvb2xlYW59IG5vcm1hbGl6ZWQgT3B0aW9uYWwgc3RhdGUgdGhhdCBlbmFibGVzIHlvdSB0byBnZXQgYSBwb3NpdGlvbiB0aGF0IGl0IHdvdWxkIGJlIGFmdGVyIG5vcm1hbGl6YXRpb24uXG5cdFx0ICogQHJldHVybiB7T2JqZWN0fSBCb29rbWFyayBvYmplY3QsIHVzZSBtb3ZlVG9Cb29rbWFyayB3aXRoIHRoaXMgb2JqZWN0IHRvIHJlc3RvcmUgdGhlIHNlbGVjdGlvbi5cblx0XHQgKiBAZXhhbXBsZVxuXHRcdCAqIC8vIFN0b3JlcyBhIGJvb2ttYXJrIG9mIHRoZSBjdXJyZW50IHNlbGVjdGlvblxuXHRcdCAqIHZhciBibSA9IHRpbnltY2UuYWN0aXZlRWRpdG9yLnNlbGVjdGlvbi5nZXRCb29rbWFyaygpO1xuXHRcdCAqXG5cdFx0ICogdGlueW1jZS5hY3RpdmVFZGl0b3Iuc2V0Q29udGVudCh0aW55bWNlLmFjdGl2ZUVkaXRvci5nZXRDb250ZW50KCkgKyAnU29tZSBuZXcgY29udGVudCcpO1xuXHRcdCAqXG5cdFx0ICogLy8gUmVzdG9yZSB0aGUgc2VsZWN0aW9uIGJvb2ttYXJrXG5cdFx0ICogdGlueW1jZS5hY3RpdmVFZGl0b3Iuc2VsZWN0aW9uLm1vdmVUb0Jvb2ttYXJrKGJtKTtcblx0XHQgKi9cblx0XHRnZXRCb29rbWFyazogZnVuY3Rpb24odHlwZSwgbm9ybWFsaXplZCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuYm9va21hcmtNYW5hZ2VyLmdldEJvb2ttYXJrKHR5cGUsIG5vcm1hbGl6ZWQpO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZXN0b3JlcyB0aGUgc2VsZWN0aW9uIHRvIHRoZSBzcGVjaWZpZWQgYm9va21hcmsuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIG1vdmVUb0Jvb2ttYXJrXG5cdFx0ICogQHBhcmFtIHtPYmplY3R9IGJvb2ttYXJrIEJvb2ttYXJrIHRvIHJlc3RvcmUgc2VsZWN0aW9uIGZyb20uXG5cdFx0ICogQHJldHVybiB7Qm9vbGVhbn0gdHJ1ZS9mYWxzZSBpZiBpdCB3YXMgc3VjY2Vzc2Z1bCBvciBub3QuXG5cdFx0ICogQGV4YW1wbGVcblx0XHQgKiAvLyBTdG9yZXMgYSBib29rbWFyayBvZiB0aGUgY3VycmVudCBzZWxlY3Rpb25cblx0XHQgKiB2YXIgYm0gPSB0aW55bWNlLmFjdGl2ZUVkaXRvci5zZWxlY3Rpb24uZ2V0Qm9va21hcmsoKTtcblx0XHQgKlxuXHRcdCAqIHRpbnltY2UuYWN0aXZlRWRpdG9yLnNldENvbnRlbnQodGlueW1jZS5hY3RpdmVFZGl0b3IuZ2V0Q29udGVudCgpICsgJ1NvbWUgbmV3IGNvbnRlbnQnKTtcblx0XHQgKlxuXHRcdCAqIC8vIFJlc3RvcmUgdGhlIHNlbGVjdGlvbiBib29rbWFya1xuXHRcdCAqIHRpbnltY2UuYWN0aXZlRWRpdG9yLnNlbGVjdGlvbi5tb3ZlVG9Cb29rbWFyayhibSk7XG5cdFx0ICovXG5cdFx0bW92ZVRvQm9va21hcms6IGZ1bmN0aW9uKGJvb2ttYXJrKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5ib29rbWFya01hbmFnZXIubW92ZVRvQm9va21hcmsoYm9va21hcmspO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBTZWxlY3RzIHRoZSBzcGVjaWZpZWQgZWxlbWVudC4gVGhpcyB3aWxsIHBsYWNlIHRoZSBzdGFydCBhbmQgZW5kIG9mIHRoZSBzZWxlY3Rpb24gcmFuZ2UgYXJvdW5kIHRoZSBlbGVtZW50LlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBzZWxlY3Rcblx0XHQgKiBAcGFyYW0ge0VsZW1lbnR9IG5vZGUgSFRNTCBET00gZWxlbWVudCB0byBzZWxlY3QuXG5cdFx0ICogQHBhcmFtIHtCb29sZWFufSBjb250ZW50IE9wdGlvbmFsIGJvb2wgc3RhdGUgaWYgdGhlIGNvbnRlbnRzIHNob3VsZCBiZSBzZWxlY3RlZCBvciBub3Qgb24gbm9uIElFIGJyb3dzZXIuXG5cdFx0ICogQHJldHVybiB7RWxlbWVudH0gU2VsZWN0ZWQgZWxlbWVudCB0aGUgc2FtZSBlbGVtZW50IGFzIHRoZSBvbmUgdGhhdCBnb3QgcGFzc2VkIGluLlxuXHRcdCAqIEBleGFtcGxlXG5cdFx0ICogLy8gU2VsZWN0IHRoZSBmaXJzdCBwYXJhZ3JhcGggaW4gdGhlIGFjdGl2ZSBlZGl0b3Jcblx0XHQgKiB0aW55bWNlLmFjdGl2ZUVkaXRvci5zZWxlY3Rpb24uc2VsZWN0KHRpbnltY2UuYWN0aXZlRWRpdG9yLmRvbS5zZWxlY3QoJ3AnKVswXSk7XG5cdFx0ICovXG5cdFx0c2VsZWN0OiBmdW5jdGlvbihub2RlLCBjb250ZW50KSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIGRvbSA9IHNlbGYuZG9tLCBybmcgPSBkb20uY3JlYXRlUm5nKCksIGlkeDtcblxuXHRcdFx0Ly8gQ2xlYXIgc3RvcmVkIHJhbmdlIHNldCBieSBGb2N1c01hbmFnZXJcblx0XHRcdHNlbGYubGFzdEZvY3VzQm9va21hcmsgPSBudWxsO1xuXG5cdFx0XHRpZiAobm9kZSkge1xuXHRcdFx0XHRpZiAoIWNvbnRlbnQgJiYgc2VsZi5jb250cm9sU2VsZWN0aW9uLmNvbnRyb2xTZWxlY3Qobm9kZSkpIHtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZHggPSBkb20ubm9kZUluZGV4KG5vZGUpO1xuXHRcdFx0XHRybmcuc2V0U3RhcnQobm9kZS5wYXJlbnROb2RlLCBpZHgpO1xuXHRcdFx0XHRybmcuc2V0RW5kKG5vZGUucGFyZW50Tm9kZSwgaWR4ICsgMSk7XG5cblx0XHRcdFx0Ly8gRmluZCBmaXJzdC9sYXN0IHRleHQgbm9kZSBvciBCUiBlbGVtZW50XG5cdFx0XHRcdGlmIChjb250ZW50KSB7XG5cdFx0XHRcdFx0c2VsZi5fbW92ZUVuZFBvaW50KHJuZywgbm9kZSwgdHJ1ZSk7XG5cdFx0XHRcdFx0c2VsZi5fbW92ZUVuZFBvaW50KHJuZywgbm9kZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRzZWxmLnNldFJuZyhybmcpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbm9kZTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyB0cnVlL2ZhbHNlIGlmIHRoZSBzZWxlY3Rpb24gcmFuZ2UgaXMgY29sbGFwc2VkIG9yIG5vdC4gQ29sbGFwc2VkIG1lYW5zIGlmIGl0J3MgYSBjYXJldCBvciBhIGxhcmdlciBzZWxlY3Rpb24uXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGlzQ29sbGFwc2VkXG5cdFx0ICogQHJldHVybiB7Qm9vbGVhbn0gdHJ1ZS9mYWxzZSBzdGF0ZSBpZiB0aGUgc2VsZWN0aW9uIHJhbmdlIGlzIGNvbGxhcHNlZCBvciBub3QuXG5cdFx0ICogQ29sbGFwc2VkIG1lYW5zIGlmIGl0J3MgYSBjYXJldCBvciBhIGxhcmdlciBzZWxlY3Rpb24uXG5cdFx0ICovXG5cdFx0aXNDb2xsYXBzZWQ6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLCBybmcgPSBzZWxmLmdldFJuZygpLCBzZWwgPSBzZWxmLmdldFNlbCgpO1xuXG5cdFx0XHRpZiAoIXJuZyB8fCBybmcuaXRlbSkge1xuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChybmcuY29tcGFyZUVuZFBvaW50cykge1xuXHRcdFx0XHRyZXR1cm4gcm5nLmNvbXBhcmVFbmRQb2ludHMoJ1N0YXJ0VG9FbmQnLCBybmcpID09PSAwO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gIXNlbCB8fCBybmcuY29sbGFwc2VkO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBDb2xsYXBzZSB0aGUgc2VsZWN0aW9uIHRvIHN0YXJ0IG9yIGVuZCBvZiByYW5nZS5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgY29sbGFwc2Vcblx0XHQgKiBAcGFyYW0ge0Jvb2xlYW59IHRvU3RhcnQgT3B0aW9uYWwgYm9vbGVhbiBzdGF0ZSBpZiB0byBjb2xsYXBzZSB0byBlbmQgb3Igbm90LiBEZWZhdWx0cyB0byBmYWxzZS5cblx0XHQgKi9cblx0XHRjb2xsYXBzZTogZnVuY3Rpb24odG9TdGFydCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLCBybmcgPSBzZWxmLmdldFJuZygpLCBub2RlO1xuXG5cdFx0XHQvLyBDb250cm9sIHJhbmdlIG9uIElFXG5cdFx0XHRpZiAocm5nLml0ZW0pIHtcblx0XHRcdFx0bm9kZSA9IHJuZy5pdGVtKDApO1xuXHRcdFx0XHRybmcgPSBzZWxmLndpbi5kb2N1bWVudC5ib2R5LmNyZWF0ZVRleHRSYW5nZSgpO1xuXHRcdFx0XHRybmcubW92ZVRvRWxlbWVudFRleHQobm9kZSk7XG5cdFx0XHR9XG5cblx0XHRcdHJuZy5jb2xsYXBzZSghIXRvU3RhcnQpO1xuXHRcdFx0c2VsZi5zZXRSbmcocm5nKTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyB0aGUgYnJvd3NlcnMgaW50ZXJuYWwgc2VsZWN0aW9uIG9iamVjdC5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgZ2V0U2VsXG5cdFx0ICogQHJldHVybiB7U2VsZWN0aW9ufSBJbnRlcm5hbCBicm93c2VyIHNlbGVjdGlvbiBvYmplY3QuXG5cdFx0ICovXG5cdFx0Z2V0U2VsOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciB3aW4gPSB0aGlzLndpbjtcblxuXHRcdFx0cmV0dXJuIHdpbi5nZXRTZWxlY3Rpb24gPyB3aW4uZ2V0U2VsZWN0aW9uKCkgOiB3aW4uZG9jdW1lbnQuc2VsZWN0aW9uO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZXR1cm5zIHRoZSBicm93c2VycyBpbnRlcm5hbCByYW5nZSBvYmplY3QuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGdldFJuZ1xuXHRcdCAqIEBwYXJhbSB7Qm9vbGVhbn0gdzNjIEZvcmNlcyBhIGNvbXBhdGlibGUgVzNDIHJhbmdlIG9uIElFLlxuXHRcdCAqIEByZXR1cm4ge1JhbmdlfSBJbnRlcm5hbCBicm93c2VyIHJhbmdlIG9iamVjdC5cblx0XHQgKiBAc2VlIGh0dHA6Ly93d3cucXVpcmtzbW9kZS5vcmcvZG9tL3JhbmdlX2ludHJvLmh0bWxcblx0XHQgKiBAc2VlIGh0dHA6Ly93d3cuZG90dm9pZC5jb20vMjAwMS8wMy91c2luZy10aGUtcmFuZ2Utb2JqZWN0LWluLW1vemlsbGEvXG5cdFx0ICovXG5cdFx0Z2V0Um5nOiBmdW5jdGlvbih3M2MpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgc2VsZWN0aW9uLCBybmcsIGVsbSwgZG9jLCBpZVJuZywgZXZ0O1xuXG5cdFx0XHRmdW5jdGlvbiB0cnlDb21wYXJlQm91bmRhcnlQb2ludHMoaG93LCBzb3VyY2VSYW5nZSwgZGVzdGluYXRpb25SYW5nZSkge1xuXHRcdFx0XHR0cnkge1xuXHRcdFx0XHRcdHJldHVybiBzb3VyY2VSYW5nZS5jb21wYXJlQm91bmRhcnlQb2ludHMoaG93LCBkZXN0aW5hdGlvblJhbmdlKTtcblx0XHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0XHQvLyBHZWNrbyB0aHJvd3Mgd3JvbmcgZG9jdW1lbnQgZXhjZXB0aW9uIGlmIHRoZSByYW5nZSBwb2ludHNcblx0XHRcdFx0XHQvLyB0byBub2RlcyB0aGF0IHdoZXJlIHJlbW92ZWQgZnJvbSB0aGUgZG9tICM2NjkwXG5cdFx0XHRcdFx0Ly8gQnJvd3NlcnMgc2hvdWxkIG11dGF0ZSBleGlzdGluZyBET01SYW5nZSBpbnN0YW5jZXMgc28gdGhhdCB0aGV5IGFsd2F5cyBwb2ludFxuXHRcdFx0XHRcdC8vIHRvIHNvbWV0aGluZyBpbiB0aGUgZG9jdW1lbnQgdGhpcyBpcyBub3QgdGhlIGNhc2UgaW4gR2Vja28gd29ya3MgZmluZSBpbiBJRS9XZWJLaXQvQmxpbmtcblx0XHRcdFx0XHQvLyBGb3IgcGVyZm9ybWFuY2UgcmVhc29ucyBqdXN0IHJldHVybiAtMVxuXHRcdFx0XHRcdHJldHVybiAtMTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAoIXNlbGYud2luKSB7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXG5cdFx0XHRkb2MgPSBzZWxmLndpbi5kb2N1bWVudDtcblxuXHRcdFx0aWYgKHR5cGVvZiBkb2MgPT09ICd1bmRlZmluZWQnIHx8IGRvYyA9PT0gbnVsbCkge1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblxuXHRcdFx0Ly8gVXNlIGxhc3Qgcm5nIHBhc3NlZCBmcm9tIEZvY3VzTWFuYWdlciBpZiBpdCdzIGF2YWlsYWJsZSB0aGlzIGVuYWJsZXNcblx0XHRcdC8vIGNhbGxzIHRvIGVkaXRvci5zZWxlY3Rpb24uZ2V0U3RhcnQoKSB0byB3b3JrIHdoZW4gY2FyZXQgZm9jdXMgaXMgbG9zdCBvbiBJRVxuXHRcdFx0aWYgKCF3M2MgJiYgc2VsZi5sYXN0Rm9jdXNCb29rbWFyaykge1xuXHRcdFx0XHR2YXIgYm9va21hcmsgPSBzZWxmLmxhc3RGb2N1c0Jvb2ttYXJrO1xuXG5cdFx0XHRcdC8vIENvbnZlcnQgYm9va21hcmsgdG8gcmFuZ2UgSUUgMTEgZml4XG5cdFx0XHRcdGlmIChib29rbWFyay5zdGFydENvbnRhaW5lcikge1xuXHRcdFx0XHRcdHJuZyA9IGRvYy5jcmVhdGVSYW5nZSgpO1xuXHRcdFx0XHRcdHJuZy5zZXRTdGFydChib29rbWFyay5zdGFydENvbnRhaW5lciwgYm9va21hcmsuc3RhcnRPZmZzZXQpO1xuXHRcdFx0XHRcdHJuZy5zZXRFbmQoYm9va21hcmsuZW5kQ29udGFpbmVyLCBib29rbWFyay5lbmRPZmZzZXQpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHJuZyA9IGJvb2ttYXJrO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJuZztcblx0XHRcdH1cblxuXHRcdFx0Ly8gRm91bmQgdHJpZGVudFNlbCBvYmplY3QgdGhlbiB3ZSBuZWVkIHRvIHVzZSB0aGF0IG9uZVxuXHRcdFx0aWYgKHczYyAmJiBzZWxmLnRyaWRlbnRTZWwpIHtcblx0XHRcdFx0cmV0dXJuIHNlbGYudHJpZGVudFNlbC5nZXRSYW5nZUF0KDApO1xuXHRcdFx0fVxuXG5cdFx0XHR0cnkge1xuXHRcdFx0XHRpZiAoKHNlbGVjdGlvbiA9IHNlbGYuZ2V0U2VsKCkpKSB7XG5cdFx0XHRcdFx0aWYgKHNlbGVjdGlvbi5yYW5nZUNvdW50ID4gMCkge1xuXHRcdFx0XHRcdFx0cm5nID0gc2VsZWN0aW9uLmdldFJhbmdlQXQoMCk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdHJuZyA9IHNlbGVjdGlvbi5jcmVhdGVSYW5nZSA/IHNlbGVjdGlvbi5jcmVhdGVSYW5nZSgpIDogZG9jLmNyZWF0ZVJhbmdlKCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvLyBJRSB0aHJvd3MgdW5zcGVjaWZpZWQgZXJyb3IgaGVyZSBpZiBUaW55TUNFIGlzIHBsYWNlZCBpbiBhIGZyYW1lL2lmcmFtZVxuXHRcdFx0fVxuXG5cdFx0XHRldnQgPSBzZWxmLmVkaXRvci5maXJlKCdHZXRTZWxlY3Rpb25SYW5nZScsIHtyYW5nZTogcm5nfSk7XG5cdFx0XHRpZiAoZXZ0LnJhbmdlICE9PSBybmcpIHtcblx0XHRcdFx0cmV0dXJuIGV2dC5yYW5nZTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gV2UgaGF2ZSBXM0MgcmFuZ2VzIGFuZCBpdCdzIElFIHRoZW4gZmFrZSBjb250cm9sIHNlbGVjdGlvbiBzaW5jZSBJRTkgZG9lc24ndCBoYW5kbGUgdGhhdCBjb3JyZWN0bHkgeWV0XG5cdFx0XHQvLyBJRSAxMSBkb2Vzbid0IHN1cHBvcnQgdGhlIHNlbGVjdGlvbiBvYmplY3Qgc28gd2UgY2hlY2sgZm9yIHRoYXQgYXMgd2VsbFxuXHRcdFx0aWYgKGlzSUUgJiYgcm5nICYmIHJuZy5zZXRTdGFydCAmJiBkb2Muc2VsZWN0aW9uKSB7XG5cdFx0XHRcdHRyeSB7XG5cdFx0XHRcdFx0Ly8gSUUgd2lsbCBzb21ldGltZXMgdGhyb3cgYW4gZXhjZXB0aW9uIGhlcmVcblx0XHRcdFx0XHRpZVJuZyA9IGRvYy5zZWxlY3Rpb24uY3JlYXRlUmFuZ2UoKTtcblx0XHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0XHQvLyBJZ25vcmVcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChpZVJuZyAmJiBpZVJuZy5pdGVtKSB7XG5cdFx0XHRcdFx0ZWxtID0gaWVSbmcuaXRlbSgwKTtcblx0XHRcdFx0XHRybmcgPSBkb2MuY3JlYXRlUmFuZ2UoKTtcblx0XHRcdFx0XHRybmcuc2V0U3RhcnRCZWZvcmUoZWxtKTtcblx0XHRcdFx0XHRybmcuc2V0RW5kQWZ0ZXIoZWxtKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHQvLyBObyByYW5nZSBmb3VuZCB0aGVuIGNyZWF0ZSBhbiBlbXB0eSBvbmVcblx0XHRcdC8vIFRoaXMgY2FuIG9jY3VyIHdoZW4gdGhlIGVkaXRvciBpcyBwbGFjZWQgaW4gYSBoaWRkZW4gY29udGFpbmVyIGVsZW1lbnQgb24gR2Vja29cblx0XHRcdC8vIE9yIG9uIElFIHdoZW4gdGhlcmUgd2FzIGFuIGV4Y2VwdGlvblxuXHRcdFx0aWYgKCFybmcpIHtcblx0XHRcdFx0cm5nID0gZG9jLmNyZWF0ZVJhbmdlID8gZG9jLmNyZWF0ZVJhbmdlKCkgOiBkb2MuYm9keS5jcmVhdGVUZXh0UmFuZ2UoKTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gSWYgcmFuZ2UgaXMgYXQgc3RhcnQgb2YgZG9jdW1lbnQgdGhlbiBtb3ZlIGl0IHRvIHN0YXJ0IG9mIGJvZHlcblx0XHRcdGlmIChybmcuc2V0U3RhcnQgJiYgcm5nLnN0YXJ0Q29udGFpbmVyLm5vZGVUeXBlID09PSA5ICYmIHJuZy5jb2xsYXBzZWQpIHtcblx0XHRcdFx0ZWxtID0gc2VsZi5kb20uZ2V0Um9vdCgpO1xuXHRcdFx0XHRybmcuc2V0U3RhcnQoZWxtLCAwKTtcblx0XHRcdFx0cm5nLnNldEVuZChlbG0sIDApO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoc2VsZi5zZWxlY3RlZFJhbmdlICYmIHNlbGYuZXhwbGljaXRSYW5nZSkge1xuXHRcdFx0XHRpZiAodHJ5Q29tcGFyZUJvdW5kYXJ5UG9pbnRzKHJuZy5TVEFSVF9UT19TVEFSVCwgcm5nLCBzZWxmLnNlbGVjdGVkUmFuZ2UpID09PSAwICYmXG5cdFx0XHRcdFx0dHJ5Q29tcGFyZUJvdW5kYXJ5UG9pbnRzKHJuZy5FTkRfVE9fRU5ELCBybmcsIHNlbGYuc2VsZWN0ZWRSYW5nZSkgPT09IDApIHtcblx0XHRcdFx0XHQvLyBTYWZhcmksIE9wZXJhIGFuZCBDaHJvbWUgb25seSBldmVyIHNlbGVjdCB0ZXh0IHdoaWNoIGNhdXNlcyB0aGUgcmFuZ2UgdG8gY2hhbmdlLlxuXHRcdFx0XHRcdC8vIFRoaXMgbGV0cyB1cyB1c2UgdGhlIG9yaWdpbmFsbHkgc2V0IHJhbmdlIGlmIHRoZSBzZWxlY3Rpb24gaGFzbid0IGJlZW4gY2hhbmdlZCBieSB0aGUgdXNlci5cblx0XHRcdFx0XHRybmcgPSBzZWxmLmV4cGxpY2l0UmFuZ2U7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0c2VsZi5zZWxlY3RlZFJhbmdlID0gbnVsbDtcblx0XHRcdFx0XHRzZWxmLmV4cGxpY2l0UmFuZ2UgPSBudWxsO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBybmc7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIENoYW5nZXMgdGhlIHNlbGVjdGlvbiB0byB0aGUgc3BlY2lmaWVkIERPTSByYW5nZS5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2Qgc2V0Um5nXG5cdFx0ICogQHBhcmFtIHtSYW5nZX0gcm5nIFJhbmdlIHRvIHNlbGVjdC5cblx0XHQgKiBAcGFyYW0ge0Jvb2xlYW59IGZvcndhcmQgT3B0aW9uYWwgYm9vbGVhbiBpZiB0aGUgc2VsZWN0aW9uIGlzIGZvcndhcmRzIG9yIGJhY2t3YXJkcy5cblx0XHQgKi9cblx0XHRzZXRSbmc6IGZ1bmN0aW9uKHJuZywgZm9yd2FyZCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLCBzZWwsIG5vZGUsIGV2dDtcblxuXHRcdFx0aWYgKCFybmcpIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBJcyBJRSBzcGVjaWZpYyByYW5nZVxuXHRcdFx0aWYgKHJuZy5zZWxlY3QpIHtcblx0XHRcdFx0c2VsZi5leHBsaWNpdFJhbmdlID0gbnVsbDtcblxuXHRcdFx0XHR0cnkge1xuXHRcdFx0XHRcdHJuZy5zZWxlY3QoKTtcblx0XHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0XHQvLyBOZWVkZWQgZm9yIHNvbWUgb2RkIElFIGJ1ZyAjMTg0MzMwNlxuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoIXNlbGYudHJpZGVudFNlbCkge1xuXHRcdFx0XHRzZWwgPSBzZWxmLmdldFNlbCgpO1xuXG5cdFx0XHRcdGV2dCA9IHNlbGYuZWRpdG9yLmZpcmUoJ1NldFNlbGVjdGlvblJhbmdlJywge3JhbmdlOiBybmd9KTtcblx0XHRcdFx0cm5nID0gZXZ0LnJhbmdlO1xuXG5cdFx0XHRcdGlmIChzZWwpIHtcblx0XHRcdFx0XHRzZWxmLmV4cGxpY2l0UmFuZ2UgPSBybmc7XG5cblx0XHRcdFx0XHR0cnkge1xuXHRcdFx0XHRcdFx0c2VsLnJlbW92ZUFsbFJhbmdlcygpO1xuXHRcdFx0XHRcdFx0c2VsLmFkZFJhbmdlKHJuZyk7XG5cdFx0XHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0XHRcdC8vIElFIG1pZ2h0IHRocm93IGVycm9ycyBoZXJlIGlmIHRoZSBlZGl0b3IgaXMgd2l0aGluIGEgaGlkZGVuIGNvbnRhaW5lciBhbmQgc2VsZWN0aW9uIGlzIGNoYW5nZWRcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHQvLyBGb3J3YXJkIGlzIHNldCB0byBmYWxzZSBhbmQgd2UgaGF2ZSBhbiBleHRlbmQgZnVuY3Rpb25cblx0XHRcdFx0XHRpZiAoZm9yd2FyZCA9PT0gZmFsc2UgJiYgc2VsLmV4dGVuZCkge1xuXHRcdFx0XHRcdFx0c2VsLmNvbGxhcHNlKHJuZy5lbmRDb250YWluZXIsIHJuZy5lbmRPZmZzZXQpO1xuXHRcdFx0XHRcdFx0c2VsLmV4dGVuZChybmcuc3RhcnRDb250YWluZXIsIHJuZy5zdGFydE9mZnNldCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Ly8gYWRkaW5nIHJhbmdlIGlzbid0IGFsd2F5cyBzdWNjZXNzZnVsIHNvIHdlIG5lZWQgdG8gY2hlY2sgcmFuZ2UgY291bnQgb3RoZXJ3aXNlIGFuIGV4Y2VwdGlvbiBjYW4gb2NjdXJcblx0XHRcdFx0XHRzZWxmLnNlbGVjdGVkUmFuZ2UgPSBzZWwucmFuZ2VDb3VudCA+IDAgPyBzZWwuZ2V0UmFuZ2VBdCgwKSA6IG51bGw7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBXZWJLaXQgZWdkZSBjYXNlIHNlbGVjdGluZyBpbWFnZXMgd29ya3MgYmV0dGVyIHVzaW5nIHNldEJhc2VBbmRFeHRlbnRcblx0XHRcdFx0aWYgKCFybmcuY29sbGFwc2VkICYmIHJuZy5zdGFydENvbnRhaW5lciA9PSBybmcuZW5kQ29udGFpbmVyICYmIHNlbC5zZXRCYXNlQW5kRXh0ZW50ICYmICFFbnYuaWUpIHtcblx0XHRcdFx0XHRpZiAocm5nLmVuZE9mZnNldCAtIHJuZy5zdGFydE9mZnNldCA8IDIpIHtcblx0XHRcdFx0XHRcdGlmIChybmcuc3RhcnRDb250YWluZXIuaGFzQ2hpbGROb2RlcygpKSB7XG5cdFx0XHRcdFx0XHRcdG5vZGUgPSBybmcuc3RhcnRDb250YWluZXIuY2hpbGROb2Rlc1tybmcuc3RhcnRPZmZzZXRdO1xuXHRcdFx0XHRcdFx0XHRpZiAobm9kZSAmJiBub2RlLnRhZ05hbWUgPT0gJ0lNRycpIHtcblx0XHRcdFx0XHRcdFx0XHRzZWxmLmdldFNlbCgpLnNldEJhc2VBbmRFeHRlbnQobm9kZSwgMCwgbm9kZSwgMSk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRzZWxmLmVkaXRvci5maXJlKCdBZnRlclNldFNlbGVjdGlvblJhbmdlJywge3JhbmdlOiBybmd9KTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdC8vIElzIFczQyBSYW5nZSBmYWtlIHJhbmdlIG9uIElFXG5cdFx0XHRcdGlmIChybmcuY2xvbmVSYW5nZSkge1xuXHRcdFx0XHRcdHRyeSB7XG5cdFx0XHRcdFx0XHRzZWxmLnRyaWRlbnRTZWwuYWRkUmFuZ2Uocm5nKTtcblx0XHRcdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRcdFx0Ly9JRTkgdGhyb3dzIGFuIGVycm9yIGhlcmUgaWYgY2FsbGVkIGJlZm9yZSBzZWxlY3Rpb24gaXMgcGxhY2VkIGluIHRoZSBlZGl0b3Jcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogU2V0cyB0aGUgY3VycmVudCBzZWxlY3Rpb24gdG8gdGhlIHNwZWNpZmllZCBET00gZWxlbWVudC5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2Qgc2V0Tm9kZVxuXHRcdCAqIEBwYXJhbSB7RWxlbWVudH0gZWxtIEVsZW1lbnQgdG8gc2V0IGFzIHRoZSBjb250ZW50cyBvZiB0aGUgc2VsZWN0aW9uLlxuXHRcdCAqIEByZXR1cm4ge0VsZW1lbnR9IFJldHVybnMgdGhlIGVsZW1lbnQgdGhhdCBnb3QgcGFzc2VkIGluLlxuXHRcdCAqIEBleGFtcGxlXG5cdFx0ICogLy8gSW5zZXJ0cyBhIERPTSBub2RlIGF0IGN1cnJlbnQgc2VsZWN0aW9uL2NhcmV0IGxvY2F0aW9uXG5cdFx0ICogdGlueW1jZS5hY3RpdmVFZGl0b3Iuc2VsZWN0aW9uLnNldE5vZGUodGlueW1jZS5hY3RpdmVFZGl0b3IuZG9tLmNyZWF0ZSgnaW1nJywge3NyYzogJ3NvbWUuZ2lmJywgdGl0bGU6ICdzb21lIHRpdGxlJ30pKTtcblx0XHQgKi9cblx0XHRzZXROb2RlOiBmdW5jdGlvbihlbG0pIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0c2VsZi5zZXRDb250ZW50KHNlbGYuZG9tLmdldE91dGVySFRNTChlbG0pKTtcblxuXHRcdFx0cmV0dXJuIGVsbTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyB0aGUgY3VycmVudGx5IHNlbGVjdGVkIGVsZW1lbnQgb3IgdGhlIGNvbW1vbiBhbmNlc3RvciBlbGVtZW50IGZvciBib3RoIHN0YXJ0IGFuZCBlbmQgb2YgdGhlIHNlbGVjdGlvbi5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgZ2V0Tm9kZVxuXHRcdCAqIEByZXR1cm4ge0VsZW1lbnR9IEN1cnJlbnRseSBzZWxlY3RlZCBlbGVtZW50IG9yIGNvbW1vbiBhbmNlc3RvciBlbGVtZW50LlxuXHRcdCAqIEBleGFtcGxlXG5cdFx0ICogLy8gQWxlcnRzIHRoZSBjdXJyZW50bHkgc2VsZWN0ZWQgZWxlbWVudHMgbm9kZSBuYW1lXG5cdFx0ICogYWxlcnQodGlueW1jZS5hY3RpdmVFZGl0b3Iuc2VsZWN0aW9uLmdldE5vZGUoKS5ub2RlTmFtZSk7XG5cdFx0ICovXG5cdFx0Z2V0Tm9kZTogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIHJuZyA9IHNlbGYuZ2V0Um5nKCksIGVsbTtcblx0XHRcdHZhciBzdGFydENvbnRhaW5lciwgZW5kQ29udGFpbmVyLCBzdGFydE9mZnNldCwgZW5kT2Zmc2V0LCByb290ID0gc2VsZi5kb20uZ2V0Um9vdCgpO1xuXG5cdFx0XHRmdW5jdGlvbiBza2lwRW1wdHlUZXh0Tm9kZXMobm9kZSwgZm9yd2FyZHMpIHtcblx0XHRcdFx0dmFyIG9yaWcgPSBub2RlO1xuXG5cdFx0XHRcdHdoaWxlIChub2RlICYmIG5vZGUubm9kZVR5cGUgPT09IDMgJiYgbm9kZS5sZW5ndGggPT09IDApIHtcblx0XHRcdFx0XHRub2RlID0gZm9yd2FyZHMgPyBub2RlLm5leHRTaWJsaW5nIDogbm9kZS5wcmV2aW91c1NpYmxpbmc7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbm9kZSB8fCBvcmlnO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBSYW5nZSBtYXliZSBsb3N0IGFmdGVyIHRoZSBlZGl0b3IgaXMgbWFkZSB2aXNpYmxlIGFnYWluXG5cdFx0XHRpZiAoIXJuZykge1xuXHRcdFx0XHRyZXR1cm4gcm9vdDtcblx0XHRcdH1cblxuXHRcdFx0c3RhcnRDb250YWluZXIgPSBybmcuc3RhcnRDb250YWluZXI7XG5cdFx0XHRlbmRDb250YWluZXIgPSBybmcuZW5kQ29udGFpbmVyO1xuXHRcdFx0c3RhcnRPZmZzZXQgPSBybmcuc3RhcnRPZmZzZXQ7XG5cdFx0XHRlbmRPZmZzZXQgPSBybmcuZW5kT2Zmc2V0O1xuXG5cdFx0XHRpZiAocm5nLnNldFN0YXJ0KSB7XG5cdFx0XHRcdGVsbSA9IHJuZy5jb21tb25BbmNlc3RvckNvbnRhaW5lcjtcblxuXHRcdFx0XHQvLyBIYW5kbGUgc2VsZWN0aW9uIGEgaW1hZ2Ugb3Igb3RoZXIgY29udHJvbCBsaWtlIGVsZW1lbnQgc3VjaCBhcyBhbmNob3JzXG5cdFx0XHRcdGlmICghcm5nLmNvbGxhcHNlZCkge1xuXHRcdFx0XHRcdGlmIChzdGFydENvbnRhaW5lciA9PSBlbmRDb250YWluZXIpIHtcblx0XHRcdFx0XHRcdGlmIChlbmRPZmZzZXQgLSBzdGFydE9mZnNldCA8IDIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHN0YXJ0Q29udGFpbmVyLmhhc0NoaWxkTm9kZXMoKSkge1xuXHRcdFx0XHRcdFx0XHRcdGVsbSA9IHN0YXJ0Q29udGFpbmVyLmNoaWxkTm9kZXNbc3RhcnRPZmZzZXRdO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Ly8gSWYgdGhlIGFuY2hvciBub2RlIGlzIGEgZWxlbWVudCBpbnN0ZWFkIG9mIGEgdGV4dCBub2RlIHRoZW4gcmV0dXJuIHRoaXMgZWxlbWVudFxuXHRcdFx0XHRcdC8vaWYgKHRpbnltY2UuaXNXZWJLaXQgJiYgc2VsLmFuY2hvck5vZGUgJiYgc2VsLmFuY2hvck5vZGUubm9kZVR5cGUgPT0gMSlcblx0XHRcdFx0XHQvL1x0cmV0dXJuIHNlbC5hbmNob3JOb2RlLmNoaWxkTm9kZXNbc2VsLmFuY2hvck9mZnNldF07XG5cblx0XHRcdFx0XHQvLyBIYW5kbGUgY2FzZXMgd2hlcmUgdGhlIHNlbGVjdGlvbiBpcyBpbW1lZGlhdGVseSB3cmFwcGVkIGFyb3VuZCBhIG5vZGUgYW5kIHJldHVybiB0aGF0IG5vZGUgaW5zdGVhZCBvZiBpdCdzIHBhcmVudC5cblx0XHRcdFx0XHQvLyBUaGlzIGhhcHBlbnMgd2hlbiB5b3UgZG91YmxlIGNsaWNrIGFuIHVuZGVybGluZWQgd29yZCBpbiBGaXJlRm94LlxuXHRcdFx0XHRcdGlmIChzdGFydENvbnRhaW5lci5ub2RlVHlwZSA9PT0gMyAmJiBlbmRDb250YWluZXIubm9kZVR5cGUgPT09IDMpIHtcblx0XHRcdFx0XHRcdGlmIChzdGFydENvbnRhaW5lci5sZW5ndGggPT09IHN0YXJ0T2Zmc2V0KSB7XG5cdFx0XHRcdFx0XHRcdHN0YXJ0Q29udGFpbmVyID0gc2tpcEVtcHR5VGV4dE5vZGVzKHN0YXJ0Q29udGFpbmVyLm5leHRTaWJsaW5nLCB0cnVlKTtcblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdHN0YXJ0Q29udGFpbmVyID0gc3RhcnRDb250YWluZXIucGFyZW50Tm9kZTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0aWYgKGVuZE9mZnNldCA9PT0gMCkge1xuXHRcdFx0XHRcdFx0XHRlbmRDb250YWluZXIgPSBza2lwRW1wdHlUZXh0Tm9kZXMoZW5kQ29udGFpbmVyLnByZXZpb3VzU2libGluZywgZmFsc2UpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0ZW5kQ29udGFpbmVyID0gZW5kQ29udGFpbmVyLnBhcmVudE5vZGU7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGlmIChzdGFydENvbnRhaW5lciAmJiBzdGFydENvbnRhaW5lciA9PT0gZW5kQ29udGFpbmVyKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiBzdGFydENvbnRhaW5lcjtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoZWxtICYmIGVsbS5ub2RlVHlwZSA9PSAzKSB7XG5cdFx0XHRcdFx0cmV0dXJuIGVsbS5wYXJlbnROb2RlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIGVsbTtcblx0XHRcdH1cblxuXHRcdFx0ZWxtID0gcm5nLml0ZW0gPyBybmcuaXRlbSgwKSA6IHJuZy5wYXJlbnRFbGVtZW50KCk7XG5cblx0XHRcdC8vIElFIDcgbWlnaHQgcmV0dXJuIGVsZW1lbnRzIG91dHNpZGUgdGhlIGlmcmFtZVxuXHRcdFx0aWYgKGVsbS5vd25lckRvY3VtZW50ICE9PSBzZWxmLndpbi5kb2N1bWVudCkge1xuXHRcdFx0XHRlbG0gPSByb290O1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gZWxtO1xuXHRcdH0sXG5cblx0XHRnZXRTZWxlY3RlZEJsb2NrczogZnVuY3Rpb24oc3RhcnRFbG0sIGVuZEVsbSkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLCBkb20gPSBzZWxmLmRvbSwgbm9kZSwgcm9vdCwgc2VsZWN0ZWRCbG9ja3MgPSBbXTtcblxuXHRcdFx0cm9vdCA9IGRvbS5nZXRSb290KCk7XG5cdFx0XHRzdGFydEVsbSA9IGRvbS5nZXRQYXJlbnQoc3RhcnRFbG0gfHwgc2VsZi5nZXRTdGFydCgpLCBkb20uaXNCbG9jayk7XG5cdFx0XHRlbmRFbG0gPSBkb20uZ2V0UGFyZW50KGVuZEVsbSB8fCBzZWxmLmdldEVuZCgpLCBkb20uaXNCbG9jayk7XG5cblx0XHRcdGlmIChzdGFydEVsbSAmJiBzdGFydEVsbSAhPSByb290KSB7XG5cdFx0XHRcdHNlbGVjdGVkQmxvY2tzLnB1c2goc3RhcnRFbG0pO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoc3RhcnRFbG0gJiYgZW5kRWxtICYmIHN0YXJ0RWxtICE9IGVuZEVsbSkge1xuXHRcdFx0XHRub2RlID0gc3RhcnRFbG07XG5cblx0XHRcdFx0dmFyIHdhbGtlciA9IG5ldyBUcmVlV2Fsa2VyKHN0YXJ0RWxtLCByb290KTtcblx0XHRcdFx0d2hpbGUgKChub2RlID0gd2Fsa2VyLm5leHQoKSkgJiYgbm9kZSAhPSBlbmRFbG0pIHtcblx0XHRcdFx0XHRpZiAoZG9tLmlzQmxvY2sobm9kZSkpIHtcblx0XHRcdFx0XHRcdHNlbGVjdGVkQmxvY2tzLnB1c2gobm9kZSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmIChlbmRFbG0gJiYgc3RhcnRFbG0gIT0gZW5kRWxtICYmIGVuZEVsbSAhPSByb290KSB7XG5cdFx0XHRcdHNlbGVjdGVkQmxvY2tzLnB1c2goZW5kRWxtKTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHNlbGVjdGVkQmxvY2tzO1xuXHRcdH0sXG5cblx0XHRpc0ZvcndhcmQ6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIGRvbSA9IHRoaXMuZG9tLCBzZWwgPSB0aGlzLmdldFNlbCgpLCBhbmNob3JSYW5nZSwgZm9jdXNSYW5nZTtcblxuXHRcdFx0Ly8gTm8gc3VwcG9ydCBmb3Igc2VsZWN0aW9uIGRpcmVjdGlvbiB0aGVuIGFsd2F5cyByZXR1cm4gdHJ1ZVxuXHRcdFx0aWYgKCFzZWwgfHwgIXNlbC5hbmNob3JOb2RlIHx8ICFzZWwuZm9jdXNOb2RlKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0fVxuXG5cdFx0XHRhbmNob3JSYW5nZSA9IGRvbS5jcmVhdGVSbmcoKTtcblx0XHRcdGFuY2hvclJhbmdlLnNldFN0YXJ0KHNlbC5hbmNob3JOb2RlLCBzZWwuYW5jaG9yT2Zmc2V0KTtcblx0XHRcdGFuY2hvclJhbmdlLmNvbGxhcHNlKHRydWUpO1xuXG5cdFx0XHRmb2N1c1JhbmdlID0gZG9tLmNyZWF0ZVJuZygpO1xuXHRcdFx0Zm9jdXNSYW5nZS5zZXRTdGFydChzZWwuZm9jdXNOb2RlLCBzZWwuZm9jdXNPZmZzZXQpO1xuXHRcdFx0Zm9jdXNSYW5nZS5jb2xsYXBzZSh0cnVlKTtcblxuXHRcdFx0cmV0dXJuIGFuY2hvclJhbmdlLmNvbXBhcmVCb3VuZGFyeVBvaW50cyhhbmNob3JSYW5nZS5TVEFSVF9UT19TVEFSVCwgZm9jdXNSYW5nZSkgPD0gMDtcblx0XHR9LFxuXG5cdFx0bm9ybWFsaXplOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgcm5nID0gc2VsZi5nZXRSbmcoKTtcblxuXHRcdFx0aWYgKEVudi5yYW5nZSAmJiBuZXcgUmFuZ2VVdGlscyhzZWxmLmRvbSkubm9ybWFsaXplKHJuZykpIHtcblx0XHRcdFx0c2VsZi5zZXRSbmcocm5nLCBzZWxmLmlzRm9yd2FyZCgpKTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHJuZztcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogRXhlY3V0ZXMgY2FsbGJhY2sgd2hlbiB0aGUgY3VycmVudCBzZWxlY3Rpb24gc3RhcnRzL3N0b3BzIG1hdGNoaW5nIHRoZSBzcGVjaWZpZWQgc2VsZWN0b3IuIFRoZSBjdXJyZW50XG5cdFx0ICogc3RhdGUgd2lsbCBiZSBwYXNzZWQgdG8gdGhlIGNhbGxiYWNrIGFzIGl0J3MgZmlyc3QgYXJndW1lbnQuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHNlbGVjdG9yQ2hhbmdlZFxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBzZWxlY3RvciBDU1Mgc2VsZWN0b3IgdG8gY2hlY2sgZm9yLlxuXHRcdCAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIHdpdGggc3RhdGUgYW5kIGFyZ3Mgd2hlbiB0aGUgc2VsZWN0b3IgaXMgbWF0Y2hlcyBvciBub3QuXG5cdFx0ICovXG5cdFx0c2VsZWN0b3JDaGFuZ2VkOiBmdW5jdGlvbihzZWxlY3RvciwgY2FsbGJhY2spIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgY3VycmVudFNlbGVjdG9ycztcblxuXHRcdFx0aWYgKCFzZWxmLnNlbGVjdG9yQ2hhbmdlZERhdGEpIHtcblx0XHRcdFx0c2VsZi5zZWxlY3RvckNoYW5nZWREYXRhID0ge307XG5cdFx0XHRcdGN1cnJlbnRTZWxlY3RvcnMgPSB7fTtcblxuXHRcdFx0XHRzZWxmLmVkaXRvci5vbignTm9kZUNoYW5nZScsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0XHR2YXIgbm9kZSA9IGUuZWxlbWVudCwgZG9tID0gc2VsZi5kb20sIHBhcmVudHMgPSBkb20uZ2V0UGFyZW50cyhub2RlLCBudWxsLCBkb20uZ2V0Um9vdCgpKSwgbWF0Y2hlZFNlbGVjdG9ycyA9IHt9O1xuXG5cdFx0XHRcdFx0Ly8gQ2hlY2sgZm9yIG5ldyBtYXRjaGluZyBzZWxlY3RvcnNcblx0XHRcdFx0XHRlYWNoKHNlbGYuc2VsZWN0b3JDaGFuZ2VkRGF0YSwgZnVuY3Rpb24oY2FsbGJhY2tzLCBzZWxlY3Rvcikge1xuXHRcdFx0XHRcdFx0ZWFjaChwYXJlbnRzLCBmdW5jdGlvbihub2RlKSB7XG5cdFx0XHRcdFx0XHRcdGlmIChkb20uaXMobm9kZSwgc2VsZWN0b3IpKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKCFjdXJyZW50U2VsZWN0b3JzW3NlbGVjdG9yXSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0Ly8gRXhlY3V0ZSBjYWxsYmFja3Ncblx0XHRcdFx0XHRcdFx0XHRcdGVhY2goY2FsbGJhY2tzLCBmdW5jdGlvbihjYWxsYmFjaykge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRjYWxsYmFjayh0cnVlLCB7bm9kZTogbm9kZSwgc2VsZWN0b3I6IHNlbGVjdG9yLCBwYXJlbnRzOiBwYXJlbnRzfSk7XG5cdFx0XHRcdFx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdFx0XHRcdFx0Y3VycmVudFNlbGVjdG9yc1tzZWxlY3Rvcl0gPSBjYWxsYmFja3M7XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0bWF0Y2hlZFNlbGVjdG9yc1tzZWxlY3Rvcl0gPSBjYWxsYmFja3M7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdC8vIENoZWNrIGlmIGN1cnJlbnQgc2VsZWN0b3JzIHN0aWxsIG1hdGNoXG5cdFx0XHRcdFx0ZWFjaChjdXJyZW50U2VsZWN0b3JzLCBmdW5jdGlvbihjYWxsYmFja3MsIHNlbGVjdG9yKSB7XG5cdFx0XHRcdFx0XHRpZiAoIW1hdGNoZWRTZWxlY3RvcnNbc2VsZWN0b3JdKSB7XG5cdFx0XHRcdFx0XHRcdGRlbGV0ZSBjdXJyZW50U2VsZWN0b3JzW3NlbGVjdG9yXTtcblxuXHRcdFx0XHRcdFx0XHRlYWNoKGNhbGxiYWNrcywgZnVuY3Rpb24oY2FsbGJhY2spIHtcblx0XHRcdFx0XHRcdFx0XHRjYWxsYmFjayhmYWxzZSwge25vZGU6IG5vZGUsIHNlbGVjdG9yOiBzZWxlY3RvciwgcGFyZW50czogcGFyZW50c30pO1xuXHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIEFkZCBzZWxlY3RvciBsaXN0ZW5lcnNcblx0XHRcdGlmICghc2VsZi5zZWxlY3RvckNoYW5nZWREYXRhW3NlbGVjdG9yXSkge1xuXHRcdFx0XHRzZWxmLnNlbGVjdG9yQ2hhbmdlZERhdGFbc2VsZWN0b3JdID0gW107XG5cdFx0XHR9XG5cblx0XHRcdHNlbGYuc2VsZWN0b3JDaGFuZ2VkRGF0YVtzZWxlY3Rvcl0ucHVzaChjYWxsYmFjayk7XG5cblx0XHRcdHJldHVybiBzZWxmO1xuXHRcdH0sXG5cblx0XHRnZXRTY3JvbGxDb250YWluZXI6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNjcm9sbENvbnRhaW5lciwgbm9kZSA9IHRoaXMuZG9tLmdldFJvb3QoKTtcblxuXHRcdFx0d2hpbGUgKG5vZGUgJiYgbm9kZS5ub2RlTmFtZSAhPSAnQk9EWScpIHtcblx0XHRcdFx0aWYgKG5vZGUuc2Nyb2xsSGVpZ2h0ID4gbm9kZS5jbGllbnRIZWlnaHQpIHtcblx0XHRcdFx0XHRzY3JvbGxDb250YWluZXIgPSBub2RlO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0bm9kZSA9IG5vZGUucGFyZW50Tm9kZTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHNjcm9sbENvbnRhaW5lcjtcblx0XHR9LFxuXG5cdFx0c2Nyb2xsSW50b1ZpZXc6IGZ1bmN0aW9uKGVsbSwgYWxpZ25Ub1RvcCkge1xuXHRcdFx0dmFyIHksIHZpZXdQb3J0LCBzZWxmID0gdGhpcywgZG9tID0gc2VsZi5kb20sIHJvb3QgPSBkb20uZ2V0Um9vdCgpLCB2aWV3UG9ydFksIHZpZXdQb3J0SCwgb2Zmc2V0WSA9IDA7XG5cblx0XHRcdGZ1bmN0aW9uIGdldFBvcyhlbG0pIHtcblx0XHRcdFx0dmFyIHggPSAwLCB5ID0gMDtcblxuXHRcdFx0XHR2YXIgb2Zmc2V0UGFyZW50ID0gZWxtO1xuXHRcdFx0XHR3aGlsZSAob2Zmc2V0UGFyZW50ICYmIG9mZnNldFBhcmVudC5ub2RlVHlwZSkge1xuXHRcdFx0XHRcdHggKz0gb2Zmc2V0UGFyZW50Lm9mZnNldExlZnQgfHwgMDtcblx0XHRcdFx0XHR5ICs9IG9mZnNldFBhcmVudC5vZmZzZXRUb3AgfHwgMDtcblx0XHRcdFx0XHRvZmZzZXRQYXJlbnQgPSBvZmZzZXRQYXJlbnQub2Zmc2V0UGFyZW50O1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHt4OiB4LCB5OiB5fTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKCFOb2RlVHlwZS5pc0VsZW1lbnQoZWxtKSkge1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhbGlnblRvVG9wID09PSBmYWxzZSkge1xuXHRcdFx0XHRvZmZzZXRZID0gZWxtLm9mZnNldEhlaWdodDtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHJvb3Qubm9kZU5hbWUgIT0gJ0JPRFknKSB7XG5cdFx0XHRcdHZhciBzY3JvbGxDb250YWluZXIgPSBzZWxmLmdldFNjcm9sbENvbnRhaW5lcigpO1xuXHRcdFx0XHRpZiAoc2Nyb2xsQ29udGFpbmVyKSB7XG5cdFx0XHRcdFx0eSA9IGdldFBvcyhlbG0pLnkgLSBnZXRQb3Moc2Nyb2xsQ29udGFpbmVyKS55ICsgb2Zmc2V0WTtcblx0XHRcdFx0XHR2aWV3UG9ydEggPSBzY3JvbGxDb250YWluZXIuY2xpZW50SGVpZ2h0O1xuXHRcdFx0XHRcdHZpZXdQb3J0WSA9IHNjcm9sbENvbnRhaW5lci5zY3JvbGxUb3A7XG5cdFx0XHRcdFx0aWYgKHkgPCB2aWV3UG9ydFkgfHwgeSArIDI1ID4gdmlld1BvcnRZICsgdmlld1BvcnRIKSB7XG5cdFx0XHRcdFx0XHRzY3JvbGxDb250YWluZXIuc2Nyb2xsVG9wID0geSA8IHZpZXdQb3J0WSA/IHkgOiB5IC0gdmlld1BvcnRIICsgMjU7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHZpZXdQb3J0ID0gZG9tLmdldFZpZXdQb3J0KHNlbGYuZWRpdG9yLmdldFdpbigpKTtcblx0XHRcdHkgPSBkb20uZ2V0UG9zKGVsbSkueSArIG9mZnNldFk7XG5cdFx0XHR2aWV3UG9ydFkgPSB2aWV3UG9ydC55O1xuXHRcdFx0dmlld1BvcnRIID0gdmlld1BvcnQuaDtcblx0XHRcdGlmICh5IDwgdmlld1BvcnQueSB8fCB5ICsgMjUgPiB2aWV3UG9ydFkgKyB2aWV3UG9ydEgpIHtcblx0XHRcdFx0c2VsZi5lZGl0b3IuZ2V0V2luKCkuc2Nyb2xsVG8oMCwgeSA8IHZpZXdQb3J0WSA/IHkgOiB5IC0gdmlld1BvcnRIICsgMjUpO1xuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHRwbGFjZUNhcmV0QXQ6IGZ1bmN0aW9uKGNsaWVudFgsIGNsaWVudFkpIHtcblx0XHRcdHRoaXMuc2V0Um5nKFJhbmdlVXRpbHMuZ2V0Q2FyZXRSYW5nZUZyb21Qb2ludChjbGllbnRYLCBjbGllbnRZLCB0aGlzLmVkaXRvci5nZXREb2MoKSkpO1xuXHRcdH0sXG5cblx0XHRfbW92ZUVuZFBvaW50OiBmdW5jdGlvbihybmcsIG5vZGUsIHN0YXJ0KSB7XG5cdFx0XHR2YXIgcm9vdCA9IG5vZGUsIHdhbGtlciA9IG5ldyBUcmVlV2Fsa2VyKG5vZGUsIHJvb3QpO1xuXHRcdFx0dmFyIG5vbkVtcHR5RWxlbWVudHNNYXAgPSB0aGlzLmRvbS5zY2hlbWEuZ2V0Tm9uRW1wdHlFbGVtZW50cygpO1xuXG5cdFx0XHRkbyB7XG5cdFx0XHRcdC8vIFRleHQgbm9kZVxuXHRcdFx0XHRpZiAobm9kZS5ub2RlVHlwZSA9PSAzICYmIHRyaW0obm9kZS5ub2RlVmFsdWUpLmxlbmd0aCAhPT0gMCkge1xuXHRcdFx0XHRcdGlmIChzdGFydCkge1xuXHRcdFx0XHRcdFx0cm5nLnNldFN0YXJ0KG5vZGUsIDApO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRybmcuc2V0RW5kKG5vZGUsIG5vZGUubm9kZVZhbHVlLmxlbmd0aCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gQlIvSU1HL0lOUFVUIGVsZW1lbnRzIGJ1dCBub3QgdGFibGUgY2VsbHNcblx0XHRcdFx0aWYgKG5vbkVtcHR5RWxlbWVudHNNYXBbbm9kZS5ub2RlTmFtZV0gJiYgIS9eKFREfFRIKSQvLnRlc3Qobm9kZS5ub2RlTmFtZSkpIHtcblx0XHRcdFx0XHRpZiAoc3RhcnQpIHtcblx0XHRcdFx0XHRcdHJuZy5zZXRTdGFydEJlZm9yZShub2RlKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0aWYgKG5vZGUubm9kZU5hbWUgPT0gJ0JSJykge1xuXHRcdFx0XHRcdFx0XHRybmcuc2V0RW5kQmVmb3JlKG5vZGUpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0cm5nLnNldEVuZEFmdGVyKG5vZGUpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIEZvdW5kIGVtcHR5IHRleHQgYmxvY2sgb2xkIElFIGNhbiBwbGFjZSB0aGUgc2VsZWN0aW9uIGluc2lkZSB0aG9zZVxuXHRcdFx0XHRpZiAoRW52LmllICYmIEVudi5pZSA8IDExICYmIHRoaXMuZG9tLmlzQmxvY2sobm9kZSkgJiYgdGhpcy5kb20uaXNFbXB0eShub2RlKSkge1xuXHRcdFx0XHRcdGlmIChzdGFydCkge1xuXHRcdFx0XHRcdFx0cm5nLnNldFN0YXJ0KG5vZGUsIDApO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRybmcuc2V0RW5kKG5vZGUsIDApO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXHRcdFx0fSB3aGlsZSAoKG5vZGUgPSAoc3RhcnQgPyB3YWxrZXIubmV4dCgpIDogd2Fsa2VyLnByZXYoKSkpKTtcblxuXHRcdFx0Ly8gRmFpbGVkIHRvIGZpbmQgYW55IHRleHQgbm9kZSBvciBvdGhlciBzdWl0YWJsZSBsb2NhdGlvbiB0aGVuIG1vdmUgdG8gdGhlIHJvb3Qgb2YgYm9keVxuXHRcdFx0aWYgKHJvb3Qubm9kZU5hbWUgPT0gJ0JPRFknKSB7XG5cdFx0XHRcdGlmIChzdGFydCkge1xuXHRcdFx0XHRcdHJuZy5zZXRTdGFydChyb290LCAwKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRybmcuc2V0RW5kKHJvb3QsIHJvb3QuY2hpbGROb2Rlcy5sZW5ndGgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSxcblxuXHRcdGdldEJvdW5kaW5nQ2xpZW50UmVjdDogIGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHJuZyA9IHRoaXMuZ2V0Um5nKCk7XG5cdFx0XHRyZXR1cm4gcm5nLmNvbGxhcHNlZCA/IENhcmV0UG9zaXRpb24uZnJvbVJhbmdlU3RhcnQocm5nKS5nZXRDbGllbnRSZWN0cygpWzBdIDogcm5nLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuXHRcdH0sXG5cblx0XHRkZXN0cm95OiBmdW5jdGlvbigpIHtcblx0XHRcdHRoaXMud2luID0gbnVsbDtcblx0XHRcdHRoaXMuY29udHJvbFNlbGVjdGlvbi5kZXN0cm95KCk7XG5cdFx0fVxuXHR9O1xuXG5cdHJldHVybiBTZWxlY3Rpb247XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL2RvbS9FbGVtZW50VXRpbHMuanNcblxuLyoqXG4gKiBFbGVtZW50VXRpbHMuanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBVdGlsaXR5IGNsYXNzIGZvciB2YXJpb3VzIGVsZW1lbnQgc3BlY2lmaWMgZnVuY3Rpb25zLlxuICpcbiAqIEBwcml2YXRlXG4gKiBAY2xhc3MgdGlueW1jZS5kb20uRWxlbWVudFV0aWxzXG4gKi9cbmRlZmluZShcInRpbnltY2UvZG9tL0VsZW1lbnRVdGlsc1wiLCBbXG5cdFwidGlueW1jZS9kb20vQm9va21hcmtNYW5hZ2VyXCIsXG5cdFwidGlueW1jZS91dGlsL1Rvb2xzXCJcbl0sIGZ1bmN0aW9uKEJvb2ttYXJrTWFuYWdlciwgVG9vbHMpIHtcblx0dmFyIGVhY2ggPSBUb29scy5lYWNoO1xuXG5cdGZ1bmN0aW9uIEVsZW1lbnRVdGlscyhkb20pIHtcblx0XHQvKipcblx0XHQgKiBDb21wYXJlcyB0d28gbm9kZXMgYW5kIGNoZWNrcyBpZiBpdCdzIGF0dHJpYnV0ZXMgYW5kIHN0eWxlcyBtYXRjaGVzLlxuXHRcdCAqIFRoaXMgZG9lc24ndCBjb21wYXJlIGNsYXNzZXMgYXMgaXRlbXMgc2luY2UgdGhlaXIgb3JkZXIgaXMgc2lnbmlmaWNhbnQuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGNvbXBhcmVcblx0XHQgKiBAcGFyYW0ge05vZGV9IG5vZGUxIEZpcnN0IG5vZGUgdG8gY29tcGFyZSB3aXRoLlxuXHRcdCAqIEBwYXJhbSB7Tm9kZX0gbm9kZTIgU2Vjb25kIG5vZGUgdG8gY29tcGFyZSB3aXRoLlxuXHRcdCAqIEByZXR1cm4ge2Jvb2xlYW59IFRydWUvZmFsc2UgaWYgdGhlIG5vZGVzIGFyZSB0aGUgc2FtZSBvciBub3QuXG5cdFx0ICovXG5cdFx0dGhpcy5jb21wYXJlID0gZnVuY3Rpb24obm9kZTEsIG5vZGUyKSB7XG5cdFx0XHQvLyBOb3QgdGhlIHNhbWUgbmFtZVxuXHRcdFx0aWYgKG5vZGUxLm5vZGVOYW1lICE9IG5vZGUyLm5vZGVOYW1lKSB7XG5cdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdH1cblxuXHRcdFx0LyoqXG5cdFx0XHQgKiBSZXR1cm5zIGFsbCB0aGUgbm9kZXMgYXR0cmlidXRlcyBleGNsdWRpbmcgaW50ZXJuYWwgb25lcywgc3R5bGVzIGFuZCBjbGFzc2VzLlxuXHRcdFx0ICpcblx0XHRcdCAqIEBwcml2YXRlXG5cdFx0XHQgKiBAcGFyYW0ge05vZGV9IG5vZGUgTm9kZSB0byBnZXQgYXR0cmlidXRlcyBmcm9tLlxuXHRcdFx0ICogQHJldHVybiB7T2JqZWN0fSBOYW1lL3ZhbHVlIG9iamVjdCB3aXRoIGF0dHJpYnV0ZXMgYW5kIGF0dHJpYnV0ZSB2YWx1ZXMuXG5cdFx0XHQgKi9cblx0XHRcdGZ1bmN0aW9uIGdldEF0dHJpYnMobm9kZSkge1xuXHRcdFx0XHR2YXIgYXR0cmlicyA9IHt9O1xuXG5cdFx0XHRcdGVhY2goZG9tLmdldEF0dHJpYnMobm9kZSksIGZ1bmN0aW9uKGF0dHIpIHtcblx0XHRcdFx0XHR2YXIgbmFtZSA9IGF0dHIubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtcblxuXHRcdFx0XHRcdC8vIERvbid0IGNvbXBhcmUgaW50ZXJuYWwgYXR0cmlidXRlcyBvciBzdHlsZVxuXHRcdFx0XHRcdGlmIChuYW1lLmluZGV4T2YoJ18nKSAhPT0gMCAmJiBuYW1lICE9PSAnc3R5bGUnICYmIG5hbWUuaW5kZXhPZignZGF0YS0nKSAhPT0gMCkge1xuXHRcdFx0XHRcdFx0YXR0cmlic1tuYW1lXSA9IGRvbS5nZXRBdHRyaWIobm9kZSwgbmFtZSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHRyZXR1cm4gYXR0cmlicztcblx0XHRcdH1cblxuXHRcdFx0LyoqXG5cdFx0XHQgKiBDb21wYXJlcyB0d28gb2JqZWN0cyBjaGVja3MgaWYgaXQncyBrZXkgKyB2YWx1ZSBleGlzdHMgaW4gdGhlIG90aGVyIG9uZS5cblx0XHRcdCAqXG5cdFx0XHQgKiBAcHJpdmF0ZVxuXHRcdFx0ICogQHBhcmFtIHtPYmplY3R9IG9iajEgRmlyc3Qgb2JqZWN0IHRvIGNvbXBhcmUuXG5cdFx0XHQgKiBAcGFyYW0ge09iamVjdH0gb2JqMiBTZWNvbmQgb2JqZWN0IHRvIGNvbXBhcmUuXG5cdFx0XHQgKiBAcmV0dXJuIHtib29sZWFufSBUcnVlL2ZhbHNlIGlmIHRoZSBvYmplY3RzIG1hdGNoZXMgb3Igbm90LlxuXHRcdFx0ICovXG5cdFx0XHRmdW5jdGlvbiBjb21wYXJlT2JqZWN0cyhvYmoxLCBvYmoyKSB7XG5cdFx0XHRcdHZhciB2YWx1ZSwgbmFtZTtcblxuXHRcdFx0XHRmb3IgKG5hbWUgaW4gb2JqMSkge1xuXHRcdFx0XHRcdC8vIE9iajEgaGFzIGl0ZW0gb2JqMiBkb2Vzbid0IGhhdmVcblx0XHRcdFx0XHRpZiAob2JqMS5oYXNPd25Qcm9wZXJ0eShuYW1lKSkge1xuXHRcdFx0XHRcdFx0dmFsdWUgPSBvYmoyW25hbWVdO1xuXG5cdFx0XHRcdFx0XHQvLyBPYmoyIGRvZXNuJ3QgaGF2ZSBvYmoxIGl0ZW1cblx0XHRcdFx0XHRcdGlmICh0eXBlb2YgdmFsdWUgPT0gXCJ1bmRlZmluZWRcIikge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdC8vIE9iajIgaXRlbSBoYXMgYSBkaWZmZXJlbnQgdmFsdWVcblx0XHRcdFx0XHRcdGlmIChvYmoxW25hbWVdICE9IHZhbHVlKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0Ly8gRGVsZXRlIHNpbWlsYXIgdmFsdWVcblx0XHRcdFx0XHRcdGRlbGV0ZSBvYmoyW25hbWVdO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIENoZWNrIGlmIG9iaiAyIGhhcyBzb21ldGhpbmcgb2JqIDEgZG9lc24ndCBoYXZlXG5cdFx0XHRcdGZvciAobmFtZSBpbiBvYmoyKSB7XG5cdFx0XHRcdFx0Ly8gT2JqMiBoYXMgaXRlbSBvYmoxIGRvZXNuJ3QgaGF2ZVxuXHRcdFx0XHRcdGlmIChvYmoyLmhhc093blByb3BlcnR5KG5hbWUpKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHR9XG5cblx0XHRcdC8vIEF0dHJpYnMgYXJlIG5vdCB0aGUgc2FtZVxuXHRcdFx0aWYgKCFjb21wYXJlT2JqZWN0cyhnZXRBdHRyaWJzKG5vZGUxKSwgZ2V0QXR0cmlicyhub2RlMikpKSB7XG5cdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gU3R5bGVzIGFyZSBub3QgdGhlIHNhbWVcblx0XHRcdGlmICghY29tcGFyZU9iamVjdHMoZG9tLnBhcnNlU3R5bGUoZG9tLmdldEF0dHJpYihub2RlMSwgJ3N0eWxlJykpLCBkb20ucGFyc2VTdHlsZShkb20uZ2V0QXR0cmliKG5vZGUyLCAnc3R5bGUnKSkpKSB7XG5cdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuICFCb29rbWFya01hbmFnZXIuaXNCb29rbWFya05vZGUobm9kZTEpICYmICFCb29rbWFya01hbmFnZXIuaXNCb29rbWFya05vZGUobm9kZTIpO1xuXHRcdH07XG5cdH1cblxuXHRyZXR1cm4gRWxlbWVudFV0aWxzO1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy9mbXQvUHJldmlldy5qc1xuXG4vKipcbiAqIFByZXZpZXcuanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBJbnRlcm5hbCBjbGFzcyBmb3IgZ2VuZXJhdGluZyBwcmV2aWV3cyBzdHlsZXMgZm9yIGZvcm1hdHMuXG4gKlxuICogRXhhbXBsZTpcbiAqICBQcmV2aWV3LmdldENzc1RleHQoZWRpdG9yLCAnYm9sZCcpO1xuICpcbiAqIEBwcml2YXRlXG4gKiBAY2xhc3MgdGlueW1jZS5mbXQuUHJldmlld1xuICovXG5kZWZpbmUoXCJ0aW55bWNlL2ZtdC9QcmV2aWV3XCIsIFtcblx0XCJ0aW55bWNlL2RvbS9ET01VdGlsc1wiLFxuXHRcInRpbnltY2UvdXRpbC9Ub29sc1wiLFxuXHRcInRpbnltY2UvaHRtbC9TY2hlbWFcIlxuXSwgZnVuY3Rpb24oRE9NVXRpbHMsIFRvb2xzLCBTY2hlbWEpIHtcblx0dmFyIGVhY2ggPSBUb29scy5lYWNoO1xuXHR2YXIgZG9tID0gRE9NVXRpbHMuRE9NO1xuXG5cdGZ1bmN0aW9uIHBhcnNlZFNlbGVjdG9yVG9IdG1sKGFuY2VzdHJ5LCBlZGl0b3IpIHtcblx0XHR2YXIgZWxtLCBpdGVtLCBmcmFnbWVudDtcblx0XHR2YXIgc2NoZW1hID0gZWRpdG9yICYmIGVkaXRvci5zY2hlbWEgfHwgbmV3IFNjaGVtYSh7fSk7XG5cblx0XHRmdW5jdGlvbiBkZWNvcmF0ZShlbG0sIGl0ZW0pIHtcblx0XHRcdGlmIChpdGVtLmNsYXNzZXMubGVuZ3RoKSB7XG5cdFx0XHRcdGRvbS5hZGRDbGFzcyhlbG0sIGl0ZW0uY2xhc3Nlcy5qb2luKCcgJykpO1xuXHRcdFx0fVxuXHRcdFx0ZG9tLnNldEF0dHJpYnMoZWxtLCBpdGVtLmF0dHJzKTtcblx0XHR9XG5cblx0XHRmdW5jdGlvbiBjcmVhdGVFbGVtZW50KHNJdGVtKSB7XG5cdFx0XHR2YXIgZWxtO1xuXG5cdFx0XHRpdGVtID0gdHlwZW9mIHNJdGVtID09PSAnc3RyaW5nJyA/IHtcblx0XHRcdFx0bmFtZTogc0l0ZW0sXG5cdFx0XHRcdGNsYXNzZXM6IFtdLFxuXHRcdFx0XHRhdHRyczoge31cblx0XHRcdH0gOiBzSXRlbTtcblxuXHRcdFx0ZWxtID0gZG9tLmNyZWF0ZShpdGVtLm5hbWUpO1xuXHRcdFx0ZGVjb3JhdGUoZWxtLCBpdGVtKTtcblx0XHRcdHJldHVybiBlbG07XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gZ2V0UmVxdWlyZWRQYXJlbnQoZWxtLCBjYW5kaWRhdGUpIHtcblx0XHRcdHZhciBuYW1lID0gdHlwZW9mIGVsbSAhPT0gJ3N0cmluZycgPyBlbG0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA6IGVsbTtcblx0XHRcdHZhciBlbG1SdWxlID0gc2NoZW1hLmdldEVsZW1lbnRSdWxlKG5hbWUpO1xuXHRcdFx0dmFyIHBhcmVudHNSZXF1aXJlZCA9IGVsbVJ1bGUucGFyZW50c1JlcXVpcmVkO1xuXG5cdFx0XHRpZiAocGFyZW50c1JlcXVpcmVkICYmIHBhcmVudHNSZXF1aXJlZC5sZW5ndGgpIHtcblx0XHRcdFx0cmV0dXJuIGNhbmRpZGF0ZSAmJiBUb29scy5pbkFycmF5KHBhcmVudHNSZXF1aXJlZCwgY2FuZGlkYXRlKSAhPT0gLTEgPyBjYW5kaWRhdGUgOiBwYXJlbnRzUmVxdWlyZWRbMF07XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gd3JhcEluSHRtbChlbG0sIGFuY2VzdHJ5LCBzaWJsaW5ncykge1xuXHRcdFx0dmFyIHBhcmVudCwgcGFyZW50Q2FuZGlkYXRlLCBwYXJlbnRSZXF1aXJlZDtcblx0XHRcdHZhciBhbmNlc3RvciA9IGFuY2VzdHJ5Lmxlbmd0aCAmJiBhbmNlc3RyeVswXTtcblx0XHRcdHZhciBhbmNlc3Rvck5hbWUgPSBhbmNlc3RvciAmJiBhbmNlc3Rvci5uYW1lO1xuXG5cdFx0XHRwYXJlbnRSZXF1aXJlZCA9IGdldFJlcXVpcmVkUGFyZW50KGVsbSwgYW5jZXN0b3JOYW1lKTtcblxuXHRcdFx0aWYgKHBhcmVudFJlcXVpcmVkKSB7XG5cdFx0XHRcdGlmIChhbmNlc3Rvck5hbWUgPT0gcGFyZW50UmVxdWlyZWQpIHtcblx0XHRcdFx0XHRwYXJlbnRDYW5kaWRhdGUgPSBhbmNlc3RyeVswXTtcblx0XHRcdFx0XHRhbmNlc3RyeSA9IGFuY2VzdHJ5LnNsaWNlKDEpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHBhcmVudENhbmRpZGF0ZSA9IHBhcmVudFJlcXVpcmVkO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKGFuY2VzdG9yKSB7XG5cdFx0XHRcdHBhcmVudENhbmRpZGF0ZSA9IGFuY2VzdHJ5WzBdO1xuXHRcdFx0XHRhbmNlc3RyeSA9IGFuY2VzdHJ5LnNsaWNlKDEpO1xuXHRcdFx0fSBlbHNlIGlmICghc2libGluZ3MpIHtcblx0XHRcdFx0cmV0dXJuIGVsbTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHBhcmVudENhbmRpZGF0ZSkge1xuXHRcdFx0XHRwYXJlbnQgPSBjcmVhdGVFbGVtZW50KHBhcmVudENhbmRpZGF0ZSk7XG5cdFx0XHRcdHBhcmVudC5hcHBlbmRDaGlsZChlbG0pO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoc2libGluZ3MpIHtcblx0XHRcdFx0aWYgKCFwYXJlbnQpIHtcblx0XHRcdFx0XHQvLyBpZiBubyBtb3JlIGFuY2VzdHJ5LCB3cmFwIGluIGdlbmVyaWMgZGl2XG5cdFx0XHRcdFx0cGFyZW50ID0gZG9tLmNyZWF0ZSgnZGl2Jyk7XG5cdFx0XHRcdFx0cGFyZW50LmFwcGVuZENoaWxkKGVsbSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRUb29scy5lYWNoKHNpYmxpbmdzLCBmdW5jdGlvbihzaWJsaW5nKSB7XG5cdFx0XHRcdFx0dmFyIHNpYmxpbmdFbG0gPSBjcmVhdGVFbGVtZW50KHNpYmxpbmcpO1xuXHRcdFx0XHRcdHBhcmVudC5pbnNlcnRCZWZvcmUoc2libGluZ0VsbSwgZWxtKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiB3cmFwSW5IdG1sKHBhcmVudCwgYW5jZXN0cnksIHBhcmVudENhbmRpZGF0ZSAmJiBwYXJlbnRDYW5kaWRhdGUuc2libGluZ3MpO1xuXHRcdH1cblxuXHRcdGlmIChhbmNlc3RyeSAmJiBhbmNlc3RyeS5sZW5ndGgpIHtcblx0XHRcdGl0ZW0gPSBhbmNlc3RyeVswXTtcblx0XHRcdGVsbSA9IGNyZWF0ZUVsZW1lbnQoaXRlbSk7XG5cdFx0XHRmcmFnbWVudCA9IGRvbS5jcmVhdGUoJ2RpdicpO1xuXHRcdFx0ZnJhZ21lbnQuYXBwZW5kQ2hpbGQod3JhcEluSHRtbChlbG0sIGFuY2VzdHJ5LnNsaWNlKDEpLCBpdGVtLnNpYmxpbmdzKSk7XG5cdFx0XHRyZXR1cm4gZnJhZ21lbnQ7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiAnJztcblx0XHR9XG5cdH1cblxuXG5cdGZ1bmN0aW9uIHNlbGVjdG9yVG9IdG1sKHNlbGVjdG9yLCBlZGl0b3IpIHtcblx0XHRyZXR1cm4gcGFyc2VkU2VsZWN0b3JUb0h0bWwocGFyc2VTZWxlY3RvcihzZWxlY3RvciwgZWRpdG9yKSk7XG5cdH1cblxuXG5cdGZ1bmN0aW9uIHBhcnNlU2VsZWN0b3JJdGVtKGl0ZW0pIHtcblx0XHR2YXIgdGFnTmFtZTtcblx0XHR2YXIgb2JqID0ge1xuXHRcdFx0Y2xhc3NlczogW10sXG5cdFx0XHRhdHRyczoge31cblx0XHR9O1xuXG5cdFx0aXRlbSA9IG9iai5zZWxlY3RvciA9IFRvb2xzLnRyaW0oaXRlbSk7XG5cblx0XHRpZiAoaXRlbSAhPT0gJyonKSB7XG5cdFx0XHQvLyBtYXRjaGluZyBJRHMsIENMQVNTZXMsIEFUVFJJQlVURVMgYW5kIFBTRVVET3Ncblx0XHRcdHRhZ05hbWUgPSBpdGVtLnJlcGxhY2UoLyg/OihbI1xcLl18Ojo/KShbXFx3XFwtXSspfChcXFspKFteXFxdXSspXFxdPykvZywgZnVuY3Rpb24oJDAsICQxLCAkMiwgJDMsICQ0KSB7XG5cdFx0XHRcdHN3aXRjaCAoJDEpIHtcblx0XHRcdFx0XHRjYXNlICcjJzpcblx0XHRcdFx0XHRcdG9iai5hdHRycy5pZCA9ICQyO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRjYXNlICcuJzpcblx0XHRcdFx0XHRcdG9iai5jbGFzc2VzLnB1c2goJDIpO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRjYXNlICc6Jzpcblx0XHRcdFx0XHRcdGlmIChUb29scy5pbkFycmF5KCdjaGVja2VkIGRpc2FibGVkIGVuYWJsZWQgcmVhZC1vbmx5IHJlcXVpcmVkJy5zcGxpdCgnICcpLCAkMikgIT09IC0xKSB7XG5cdFx0XHRcdFx0XHRcdG9iai5hdHRyc1skMl0gPSAkMjtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gYXRyaWJ1dGUgbWF0Y2hlZFxuXHRcdFx0XHRpZiAoJDMgPT0gJ1snKSB7XG5cdFx0XHRcdFx0dmFyIG0gPSAkNC5tYXRjaCgvKFtcXHdcXC1dKykoPzpcXD1cXFwiKFteXFxcIl0rKSk/Lyk7XG5cdFx0XHRcdFx0aWYgKG0pIHtcblx0XHRcdFx0XHRcdG9iai5hdHRyc1ttWzFdXSA9IG1bMl07XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuICcnO1xuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0b2JqLm5hbWUgPSB0YWdOYW1lIHx8ICdkaXYnO1xuXHRcdHJldHVybiBvYmo7XG5cdH1cblxuXG5cdGZ1bmN0aW9uIHBhcnNlU2VsZWN0b3Ioc2VsZWN0b3IpIHtcblx0XHRpZiAoIXNlbGVjdG9yIHx8IHR5cGVvZiBzZWxlY3RvciAhPT0gJ3N0cmluZycpIHtcblx0XHRcdHJldHVybiBbXTtcblx0XHR9XG5cblx0XHQvLyB0YWtlIGludG8gYWNjb3VudCBvbmx5IGZpcnN0IG9uZVxuXHRcdHNlbGVjdG9yID0gc2VsZWN0b3Iuc3BsaXQoL1xccyosXFxzKi8pWzBdO1xuXG5cdFx0Ly8gdGlnaHRlblxuXHRcdHNlbGVjdG9yID0gc2VsZWN0b3IucmVwbGFjZSgvXFxzKih+XFwrfH58XFwrfD4pXFxzKi9nLCAnJDEnKTtcblxuXHRcdC8vIHNwbGl0IGVpdGhlciBvbiA+IG9yIG9uIHNwYWNlLCBidXQgbm90IHRoZSBvbmUgaW5zaWRlIGJyYWNrZXRzXG5cdFx0cmV0dXJuIFRvb2xzLm1hcChzZWxlY3Rvci5zcGxpdCgvKD86PnxcXHMrKD8hW15cXFtcXF1dK1xcXSkpLyksIGZ1bmN0aW9uKGl0ZW0pIHtcblx0XHRcdC8vIHByb2Nlc3MgZWFjaCBzaWJsaW5nIHNlbGVjdG9yIHNlcGFyYXRlbHlcblx0XHRcdHZhciBzaWJsaW5ncyA9IFRvb2xzLm1hcChpdGVtLnNwbGl0KC8oPzp+XFwrfH58XFwrKS8pLCBwYXJzZVNlbGVjdG9ySXRlbSk7XG5cdFx0XHR2YXIgb2JqID0gc2libGluZ3MucG9wKCk7IC8vIHRoZSBsYXN0IG9uZSBpcyBvdXIgcmVhbCB0YXJnZXRcblxuXHRcdFx0aWYgKHNpYmxpbmdzLmxlbmd0aCkge1xuXHRcdFx0XHRvYmouc2libGluZ3MgPSBzaWJsaW5ncztcblx0XHRcdH1cblx0XHRcdHJldHVybiBvYmo7XG5cdFx0fSkucmV2ZXJzZSgpO1xuXHR9XG5cblxuXHRmdW5jdGlvbiBnZXRDc3NUZXh0KGVkaXRvciwgZm9ybWF0KSB7XG5cdFx0dmFyIG5hbWUsIHByZXZpZXdGcmFnLCBwcmV2aWV3RWxtLCBpdGVtcztcblx0XHR2YXIgcHJldmlld0NzcyA9ICcnLCBwYXJlbnRGb250U2l6ZSwgcHJldmlld1N0eWxlcztcblxuXHRcdHByZXZpZXdTdHlsZXMgPSBlZGl0b3Iuc2V0dGluZ3MucHJldmlld19zdHlsZXM7XG5cblx0XHQvLyBObyBwcmV2aWV3IGZvcmNlZFxuXHRcdGlmIChwcmV2aWV3U3R5bGVzID09PSBmYWxzZSkge1xuXHRcdFx0cmV0dXJuICcnO1xuXHRcdH1cblxuXHRcdC8vIERlZmF1bHQgcHJldmlld1xuXHRcdGlmICh0eXBlb2YgcHJldmlld1N0eWxlcyAhPT0gJ3N0cmluZycpIHtcblx0XHRcdHByZXZpZXdTdHlsZXMgPSAnZm9udC1mYW1pbHkgZm9udC1zaXplIGZvbnQtd2VpZ2h0IGZvbnQtc3R5bGUgdGV4dC1kZWNvcmF0aW9uICcgK1xuXHRcdFx0XHQndGV4dC10cmFuc2Zvcm0gY29sb3IgYmFja2dyb3VuZC1jb2xvciBib3JkZXIgYm9yZGVyLXJhZGl1cyBvdXRsaW5lIHRleHQtc2hhZG93Jztcblx0XHR9XG5cblx0XHQvLyBSZW1vdmVzIGFueSB2YXJpYWJsZXMgc2luY2UgdGhlc2UgY2FuJ3QgYmUgcHJldmlld2VkXG5cdFx0ZnVuY3Rpb24gcmVtb3ZlVmFycyh2YWwpIHtcblx0XHRcdHJldHVybiB2YWwucmVwbGFjZSgvJShcXHcrKS9nLCAnJyk7XG5cdFx0fVxuXG5cdFx0Ly8gQ3JlYXRlIGJsb2NrL2lubGluZSBlbGVtZW50IHRvIHVzZSBmb3IgcHJldmlld1xuXHRcdGlmICh0eXBlb2YgZm9ybWF0ID09IFwic3RyaW5nXCIpIHtcblx0XHRcdGZvcm1hdCA9IGVkaXRvci5mb3JtYXR0ZXIuZ2V0KGZvcm1hdCk7XG5cdFx0XHRpZiAoIWZvcm1hdCkge1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdGZvcm1hdCA9IGZvcm1hdFswXTtcblx0XHR9XG5cblx0XHQvLyBGb3JtYXQgc3BlY2lmaWMgcHJldmlldyBvdmVycmlkZVxuXHRcdC8vIFRPRE86IFRoaXMgc2hvdWxkIHByb2JhYmx5IGJlIGZ1cnRoZXIgcmVkdWNlZCBieSB0aGUgcHJldmlld1N0eWxlcyBvcHRpb25cblx0XHRpZiAoJ3ByZXZpZXcnIGluIGZvcm1hdCkge1xuXHRcdFx0cHJldmlld1N0eWxlcyA9IGZvcm1hdC5wcmV2aWV3O1xuXHRcdFx0aWYgKHByZXZpZXdTdHlsZXMgPT09IGZhbHNlKSB7XG5cdFx0XHRcdHJldHVybiAnJztcblx0XHRcdH1cblx0XHR9XG5cblx0XHRuYW1lID0gZm9ybWF0LmJsb2NrIHx8IGZvcm1hdC5pbmxpbmUgfHwgJ3NwYW4nO1xuXG5cdFx0aXRlbXMgPSBwYXJzZVNlbGVjdG9yKGZvcm1hdC5zZWxlY3Rvcik7XG5cdFx0aWYgKGl0ZW1zLmxlbmd0aCkge1xuXHRcdFx0aWYgKCFpdGVtc1swXS5uYW1lKSB7IC8vIGUuZy4gc29tZXRoaW5nIGxpa2UgdWwgPiAuc29tZUNsYXNzIHdhcyBwcm92aWRlZFxuXHRcdFx0XHRpdGVtc1swXS5uYW1lID0gbmFtZTtcblx0XHRcdH1cblx0XHRcdG5hbWUgPSBmb3JtYXQuc2VsZWN0b3I7XG5cdFx0XHRwcmV2aWV3RnJhZyA9IHBhcnNlZFNlbGVjdG9yVG9IdG1sKGl0ZW1zKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0cHJldmlld0ZyYWcgPSBwYXJzZWRTZWxlY3RvclRvSHRtbChbbmFtZV0pO1xuXHRcdH1cblxuXHRcdHByZXZpZXdFbG0gPSBkb20uc2VsZWN0KG5hbWUsIHByZXZpZXdGcmFnKVswXSB8fCBwcmV2aWV3RnJhZy5maXJzdENoaWxkO1xuXG5cdFx0Ly8gQWRkIGZvcm1hdCBzdHlsZXMgdG8gcHJldmlldyBlbGVtZW50XG5cdFx0ZWFjaChmb3JtYXQuc3R5bGVzLCBmdW5jdGlvbih2YWx1ZSwgbmFtZSkge1xuXHRcdFx0dmFsdWUgPSByZW1vdmVWYXJzKHZhbHVlKTtcblxuXHRcdFx0aWYgKHZhbHVlKSB7XG5cdFx0XHRcdGRvbS5zZXRTdHlsZShwcmV2aWV3RWxtLCBuYW1lLCB2YWx1ZSk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHQvLyBBZGQgYXR0cmlidXRlcyB0byBwcmV2aWV3IGVsZW1lbnRcblx0XHRlYWNoKGZvcm1hdC5hdHRyaWJ1dGVzLCBmdW5jdGlvbih2YWx1ZSwgbmFtZSkge1xuXHRcdFx0dmFsdWUgPSByZW1vdmVWYXJzKHZhbHVlKTtcblxuXHRcdFx0aWYgKHZhbHVlKSB7XG5cdFx0XHRcdGRvbS5zZXRBdHRyaWIocHJldmlld0VsbSwgbmFtZSwgdmFsdWUpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0Ly8gQWRkIGNsYXNzZXMgdG8gcHJldmlldyBlbGVtZW50XG5cdFx0ZWFjaChmb3JtYXQuY2xhc3NlcywgZnVuY3Rpb24odmFsdWUpIHtcblx0XHRcdHZhbHVlID0gcmVtb3ZlVmFycyh2YWx1ZSk7XG5cblx0XHRcdGlmICghZG9tLmhhc0NsYXNzKHByZXZpZXdFbG0sIHZhbHVlKSkge1xuXHRcdFx0XHRkb20uYWRkQ2xhc3MocHJldmlld0VsbSwgdmFsdWUpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0ZWRpdG9yLmZpcmUoJ1ByZXZpZXdGb3JtYXRzJyk7XG5cblx0XHQvLyBBZGQgdGhlIHByZXZpZXdFbG0gb3V0c2lkZSB0aGUgdmlzdWFsIGFyZWFcblx0XHRkb20uc2V0U3R5bGVzKHByZXZpZXdGcmFnLCB7cG9zaXRpb246ICdhYnNvbHV0ZScsIGxlZnQ6IC0weEZGRkZ9KTtcblx0XHRlZGl0b3IuZ2V0Qm9keSgpLmFwcGVuZENoaWxkKHByZXZpZXdGcmFnKTtcblxuXHRcdC8vIEdldCBwYXJlbnQgY29udGFpbmVyIGZvbnQgc2l6ZSBzbyB3ZSBjYW4gY29tcHV0ZSBweCB2YWx1ZXMgb3V0IG9mIGVtLyUgZm9yIG9sZGVyIElFOnNcblx0XHRwYXJlbnRGb250U2l6ZSA9IGRvbS5nZXRTdHlsZShlZGl0b3IuZ2V0Qm9keSgpLCAnZm9udFNpemUnLCB0cnVlKTtcblx0XHRwYXJlbnRGb250U2l6ZSA9IC9weCQvLnRlc3QocGFyZW50Rm9udFNpemUpID8gcGFyc2VJbnQocGFyZW50Rm9udFNpemUsIDEwKSA6IDA7XG5cblx0XHRlYWNoKHByZXZpZXdTdHlsZXMuc3BsaXQoJyAnKSwgZnVuY3Rpb24obmFtZSkge1xuXHRcdFx0dmFyIHZhbHVlID0gZG9tLmdldFN0eWxlKHByZXZpZXdFbG0sIG5hbWUsIHRydWUpO1xuXG5cdFx0XHQvLyBJZiBiYWNrZ3JvdW5kIGlzIHRyYW5zcGFyZW50IHRoZW4gY2hlY2sgaWYgdGhlIGJvZHkgaGFzIGEgYmFja2dyb3VuZCBjb2xvciB3ZSBjYW4gdXNlXG5cdFx0XHRpZiAobmFtZSA9PSAnYmFja2dyb3VuZC1jb2xvcicgJiYgL3RyYW5zcGFyZW50fHJnYmFcXHMqXFwoW14pXSssXFxzKjBcXCkvLnRlc3QodmFsdWUpKSB7XG5cdFx0XHRcdHZhbHVlID0gZG9tLmdldFN0eWxlKGVkaXRvci5nZXRCb2R5KCksIG5hbWUsIHRydWUpO1xuXG5cdFx0XHRcdC8vIElnbm9yZSB3aGl0ZSBzaW5jZSBpdCdzIHRoZSBkZWZhdWx0IGNvbG9yLCBub3QgdGhlIG5pY2VzdCBmaXhcblx0XHRcdFx0Ly8gVE9ETzogRml4IHRoaXMgYnkgZGV0ZWN0aW5nIHJ1bnRpbWUgc3R5bGVcblx0XHRcdFx0aWYgKGRvbS50b0hleCh2YWx1ZSkudG9Mb3dlckNhc2UoKSA9PSAnI2ZmZmZmZicpIHtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKG5hbWUgPT0gJ2NvbG9yJykge1xuXHRcdFx0XHQvLyBJZ25vcmUgYmxhY2sgc2luY2UgaXQncyB0aGUgZGVmYXVsdCBjb2xvciwgbm90IHRoZSBuaWNlc3QgZml4XG5cdFx0XHRcdC8vIFRPRE86IEZpeCB0aGlzIGJ5IGRldGVjdGluZyBydW50aW1lIHN0eWxlXG5cdFx0XHRcdGlmIChkb20udG9IZXgodmFsdWUpLnRvTG93ZXJDYXNlKCkgPT0gJyMwMDAwMDAnKSB7XG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdC8vIE9sZCBJRSB3b24ndCBjYWxjdWxhdGUgdGhlIGZvbnQgc2l6ZSBzbyB3ZSBuZWVkIHRvIGRvIHRoYXQgbWFudWFsbHlcblx0XHRcdGlmIChuYW1lID09ICdmb250LXNpemUnKSB7XG5cdFx0XHRcdGlmICgvZW18JSQvLnRlc3QodmFsdWUpKSB7XG5cdFx0XHRcdFx0aWYgKHBhcmVudEZvbnRTaXplID09PSAwKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Ly8gQ29udmVydCBmb250IHNpemUgZnJvbSBlbS8lIHRvIHB4XG5cdFx0XHRcdFx0dmFsdWUgPSBwYXJzZUZsb2F0KHZhbHVlLCAxMCkgLyAoLyUkLy50ZXN0KHZhbHVlKSA/IDEwMCA6IDEpO1xuXHRcdFx0XHRcdHZhbHVlID0gKHZhbHVlICogcGFyZW50Rm9udFNpemUpICsgJ3B4Jztcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAobmFtZSA9PSBcImJvcmRlclwiICYmIHZhbHVlKSB7XG5cdFx0XHRcdHByZXZpZXdDc3MgKz0gJ3BhZGRpbmc6MCAycHg7Jztcblx0XHRcdH1cblxuXHRcdFx0cHJldmlld0NzcyArPSBuYW1lICsgJzonICsgdmFsdWUgKyAnOyc7XG5cdFx0fSk7XG5cblx0XHRlZGl0b3IuZmlyZSgnQWZ0ZXJQcmV2aWV3Rm9ybWF0cycpO1xuXG5cdFx0Ly9wcmV2aWV3Q3NzICs9ICdsaW5lLWhlaWdodDpub3JtYWwnO1xuXG5cdFx0ZG9tLnJlbW92ZShwcmV2aWV3RnJhZyk7XG5cblx0XHRyZXR1cm4gcHJldmlld0Nzcztcblx0fVxuXG5cdHJldHVybiB7XG5cdFx0Z2V0Q3NzVGV4dDogZ2V0Q3NzVGV4dCxcblx0XHRwYXJzZVNlbGVjdG9yOiBwYXJzZVNlbGVjdG9yLFxuXHRcdHNlbGVjdG9yVG9IdG1sOiBzZWxlY3RvclRvSHRtbFxuXHR9O1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy9mbXQvSG9va3MuanNcblxuLyoqXG4gKiBIb29rcy5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE2IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKipcbiAqIEludGVybmFsIGNsYXNzIGZvciBvdmVycmlkaW5nIGZvcm1hdHRpbmcuXG4gKlxuICogQHByaXZhdGVcbiAqIEBjbGFzcyB0aW55bWNlLmZtdC5Ib29rc1xuICovXG5kZWZpbmUoXCJ0aW55bWNlL2ZtdC9Ib29rc1wiLCBbXG5cdFwidGlueW1jZS91dGlsL0FyclwiLFxuXHRcInRpbnltY2UvZG9tL05vZGVUeXBlXCIsXG5cdFwidGlueW1jZS9kb20vRG9tUXVlcnlcIlxuXSwgZnVuY3Rpb24oQXJyLCBOb2RlVHlwZSwgJCkge1xuXHR2YXIgcG9zdFByb2Nlc3NIb29rcyA9IHt9LCBmaWx0ZXIgPSBBcnIuZmlsdGVyLCBlYWNoID0gQXJyLmVhY2g7XG5cblx0ZnVuY3Rpb24gYWRkUG9zdFByb2Nlc3NIb29rKG5hbWUsIGhvb2spIHtcblx0XHR2YXIgaG9va3MgPSBwb3N0UHJvY2Vzc0hvb2tzW25hbWVdO1xuXG5cdFx0aWYgKCFob29rcykge1xuXHRcdFx0cG9zdFByb2Nlc3NIb29rc1tuYW1lXSA9IGhvb2tzID0gW107XG5cdFx0fVxuXG5cdFx0cG9zdFByb2Nlc3NIb29rc1tuYW1lXS5wdXNoKGhvb2spO1xuXHR9XG5cblx0ZnVuY3Rpb24gcG9zdFByb2Nlc3MobmFtZSwgZWRpdG9yKSB7XG5cdFx0ZWFjaChwb3N0UHJvY2Vzc0hvb2tzW25hbWVdLCBmdW5jdGlvbihob29rKSB7XG5cdFx0XHRob29rKGVkaXRvcik7XG5cdFx0fSk7XG5cdH1cblxuXHRhZGRQb3N0UHJvY2Vzc0hvb2soXCJwcmVcIiwgZnVuY3Rpb24oZWRpdG9yKSB7XG5cdFx0dmFyIHJuZyA9IGVkaXRvci5zZWxlY3Rpb24uZ2V0Um5nKCksIGlzUHJlLCBibG9ja3M7XG5cblx0XHRmdW5jdGlvbiBoYXNQcmVTaWJsaW5nKHByZSkge1xuXHRcdFx0cmV0dXJuIGlzUHJlKHByZS5wcmV2aW91c1NpYmxpbmcpICYmIEFyci5pbmRleE9mKGJsb2NrcywgcHJlLnByZXZpb3VzU2libGluZykgIT0gLTE7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gam9pblByZShwcmUxLCBwcmUyKSB7XG5cdFx0XHQkKHByZTIpLnJlbW92ZSgpO1xuXHRcdFx0JChwcmUxKS5hcHBlbmQoJzxicj48YnI+JykuYXBwZW5kKHByZTIuY2hpbGROb2Rlcyk7XG5cdFx0fVxuXG5cdFx0aXNQcmUgPSBOb2RlVHlwZS5tYXRjaE5vZGVOYW1lcygncHJlJyk7XG5cblx0XHRpZiAoIXJuZy5jb2xsYXBzZWQpIHtcblx0XHRcdGJsb2NrcyA9IGVkaXRvci5zZWxlY3Rpb24uZ2V0U2VsZWN0ZWRCbG9ja3MoKTtcblxuXHRcdFx0ZWFjaChmaWx0ZXIoZmlsdGVyKGJsb2NrcywgaXNQcmUpLCBoYXNQcmVTaWJsaW5nKSwgZnVuY3Rpb24ocHJlKSB7XG5cdFx0XHRcdGpvaW5QcmUocHJlLnByZXZpb3VzU2libGluZywgcHJlKTtcblx0XHRcdH0pO1xuXHRcdH1cblx0fSk7XG5cblx0cmV0dXJuIHtcblx0XHRwb3N0UHJvY2VzczogcG9zdFByb2Nlc3Ncblx0fTtcbn0pO1xuXG4vLyBJbmNsdWRlZCBmcm9tOiBqcy90aW55bWNlL2NsYXNzZXMvRm9ybWF0dGVyLmpzXG5cbi8qKlxuICogRm9ybWF0dGVyLmpzXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgTEdQTCBMaWNlbnNlLlxuICogQ29weXJpZ2h0IChjKSAxOTk5LTIwMTUgRXBob3ggQ29ycC4gQWxsIHJpZ2h0cyByZXNlcnZlZFxuICpcbiAqIExpY2Vuc2U6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vbGljZW5zZVxuICogQ29udHJpYnV0aW5nOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2NvbnRyaWJ1dGluZ1xuICovXG5cbi8qKlxuICogVGV4dCBmb3JtYXR0ZXIgZW5naW5lIGNsYXNzLiBUaGlzIGNsYXNzIGlzIHVzZWQgdG8gYXBwbHkgZm9ybWF0cyBsaWtlIGJvbGQsIGl0YWxpYywgZm9udCBzaXplXG4gKiBldGMgdG8gdGhlIGN1cnJlbnQgc2VsZWN0aW9uIG9yIHNwZWNpZmljIG5vZGVzLiBUaGlzIGVuZ2luZSB3YXMgYnVpbHQgdG8gcmVwbGFjZSB0aGUgYnJvd3NlcidzXG4gKiBkZWZhdWx0IGZvcm1hdHRpbmcgbG9naWMgZm9yIGV4ZWNDb21tYW5kIGR1ZSB0byBpdHMgaW5jb25zaXN0ZW50IGFuZCBidWdneSBiZWhhdmlvci5cbiAqXG4gKiBAY2xhc3MgdGlueW1jZS5Gb3JtYXR0ZXJcbiAqIEBleGFtcGxlXG4gKiAgdGlueW1jZS5hY3RpdmVFZGl0b3IuZm9ybWF0dGVyLnJlZ2lzdGVyKCdteWN1c3RvbWZvcm1hdCcsIHtcbiAqICAgIGlubGluZTogJ3NwYW4nLFxuICogICAgc3R5bGVzOiB7Y29sb3I6ICcjZmYwMDAwJ31cbiAqICB9KTtcbiAqXG4gKiAgdGlueW1jZS5hY3RpdmVFZGl0b3IuZm9ybWF0dGVyLmFwcGx5KCdteWN1c3RvbWZvcm1hdCcpO1xuICovXG5kZWZpbmUoXCJ0aW55bWNlL0Zvcm1hdHRlclwiLCBbXG5cdFwidGlueW1jZS9kb20vVHJlZVdhbGtlclwiLFxuXHRcInRpbnltY2UvZG9tL1JhbmdlVXRpbHNcIixcblx0XCJ0aW55bWNlL2RvbS9Cb29rbWFya01hbmFnZXJcIixcblx0XCJ0aW55bWNlL2RvbS9FbGVtZW50VXRpbHNcIixcblx0XCJ0aW55bWNlL3V0aWwvVG9vbHNcIixcblx0XCJ0aW55bWNlL2ZtdC9QcmV2aWV3XCIsXG5cdFwidGlueW1jZS9mbXQvSG9va3NcIlxuXSwgZnVuY3Rpb24oVHJlZVdhbGtlciwgUmFuZ2VVdGlscywgQm9va21hcmtNYW5hZ2VyLCBFbGVtZW50VXRpbHMsIFRvb2xzLCBQcmV2aWV3LCBIb29rcykge1xuXHQvKipcblx0ICogQ29uc3RydWN0cyBhIG5ldyBmb3JtYXR0ZXIgaW5zdGFuY2UuXG5cdCAqXG5cdCAqIEBjb25zdHJ1Y3RvciBGb3JtYXR0ZXJcblx0ICogQHBhcmFtIHt0aW55bWNlLkVkaXRvcn0gZWQgRWRpdG9yIGluc3RhbmNlIHRvIGNvbnN0cnVjdCB0aGUgZm9ybWF0dGVyIGVuZ2luZSB0by5cblx0ICovXG5cdHJldHVybiBmdW5jdGlvbihlZCkge1xuXHRcdHZhciBmb3JtYXRzID0ge30sXG5cdFx0XHRkb20gPSBlZC5kb20sXG5cdFx0XHRzZWxlY3Rpb24gPSBlZC5zZWxlY3Rpb24sXG5cdFx0XHRyYW5nZVV0aWxzID0gbmV3IFJhbmdlVXRpbHMoZG9tKSxcblx0XHRcdGlzVmFsaWQgPSBlZC5zY2hlbWEuaXNWYWxpZENoaWxkLFxuXHRcdFx0aXNCbG9jayA9IGRvbS5pc0Jsb2NrLFxuXHRcdFx0Zm9yY2VkUm9vdEJsb2NrID0gZWQuc2V0dGluZ3MuZm9yY2VkX3Jvb3RfYmxvY2ssXG5cdFx0XHRub2RlSW5kZXggPSBkb20ubm9kZUluZGV4LFxuXHRcdFx0SU5WSVNJQkxFX0NIQVIgPSAnXFx1RkVGRicsXG5cdFx0XHRNQ0VfQVRUUl9SRSA9IC9eKHNyY3xocmVmfHN0eWxlKSQvLFxuXHRcdFx0RkFMU0UgPSBmYWxzZSxcblx0XHRcdFRSVUUgPSB0cnVlLFxuXHRcdFx0Zm9ybWF0Q2hhbmdlRGF0YSxcblx0XHRcdHVuZGVmLFxuXHRcdFx0Z2V0Q29udGVudEVkaXRhYmxlID0gZG9tLmdldENvbnRlbnRFZGl0YWJsZSxcblx0XHRcdGRpc2FibGVDYXJldENvbnRhaW5lcixcblx0XHRcdG1hcmtDYXJldENvbnRhaW5lcnNCb2d1cyxcblx0XHRcdGlzQm9va21hcmtOb2RlID0gQm9va21hcmtNYW5hZ2VyLmlzQm9va21hcmtOb2RlO1xuXG5cdFx0dmFyIGVhY2ggPSBUb29scy5lYWNoLFxuXHRcdFx0Z3JlcCA9IFRvb2xzLmdyZXAsXG5cdFx0XHR3YWxrID0gVG9vbHMud2Fsayxcblx0XHRcdGV4dGVuZCA9IFRvb2xzLmV4dGVuZDtcblxuXHRcdGZ1bmN0aW9uIGlzVGV4dEJsb2NrKG5hbWUpIHtcblx0XHRcdGlmIChuYW1lLm5vZGVUeXBlKSB7XG5cdFx0XHRcdG5hbWUgPSBuYW1lLm5vZGVOYW1lO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gISFlZC5zY2hlbWEuZ2V0VGV4dEJsb2NrRWxlbWVudHMoKVtuYW1lLnRvTG93ZXJDYXNlKCldO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIGlzVGFibGVDZWxsKG5vZGUpIHtcblx0XHRcdHJldHVybiAvXihUSHxURCkkLy50ZXN0KG5vZGUubm9kZU5hbWUpO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIGlzSW5saW5lQmxvY2sobm9kZSkge1xuXHRcdFx0cmV0dXJuIG5vZGUgJiYgL14oSU1HKSQvLnRlc3Qobm9kZS5ub2RlTmFtZSk7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gZ2V0UGFyZW50cyhub2RlLCBzZWxlY3Rvcikge1xuXHRcdFx0cmV0dXJuIGRvbS5nZXRQYXJlbnRzKG5vZGUsIHNlbGVjdG9yLCBkb20uZ2V0Um9vdCgpKTtcblx0XHR9XG5cblx0XHRmdW5jdGlvbiBpc0NhcmV0Tm9kZShub2RlKSB7XG5cdFx0XHRyZXR1cm4gbm9kZS5ub2RlVHlwZSA9PT0gMSAmJiBub2RlLmlkID09PSAnX21jZV9jYXJldCc7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gZGVmYXVsdEZvcm1hdHMoKSB7XG5cdFx0XHRyZWdpc3Rlcih7XG5cdFx0XHRcdHZhbGlnbnRvcDogW1xuXHRcdFx0XHRcdHtzZWxlY3RvcjogJ3RkLHRoJywgc3R5bGVzOiB7J3ZlcnRpY2FsQWxpZ24nOiAndG9wJ319XG5cdFx0XHRcdF0sXG5cblx0XHRcdFx0dmFsaWdubWlkZGxlOiBbXG5cdFx0XHRcdFx0e3NlbGVjdG9yOiAndGQsdGgnLCBzdHlsZXM6IHsndmVydGljYWxBbGlnbic6ICdtaWRkbGUnfX1cblx0XHRcdFx0XSxcblxuXHRcdFx0XHR2YWxpZ25ib3R0b206IFtcblx0XHRcdFx0XHR7c2VsZWN0b3I6ICd0ZCx0aCcsIHN0eWxlczogeyd2ZXJ0aWNhbEFsaWduJzogJ2JvdHRvbSd9fVxuXHRcdFx0XHRdLFxuXG5cdFx0XHRcdGFsaWdubGVmdDogW1xuXHRcdFx0XHRcdHtcblx0XHRcdFx0XHRcdHNlbGVjdG9yOiAnZmlndXJlLmltYWdlJyxcblx0XHRcdFx0XHRcdGNvbGxhcHNlZDogZmFsc2UsXG5cdFx0XHRcdFx0XHRjbGFzc2VzOiAnYWxpZ24tbGVmdCcsXG5cdFx0XHRcdFx0XHRjZUZhbHNlT3ZlcnJpZGU6IHRydWUsXG5cdFx0XHRcdFx0XHRwcmV2aWV3OiAnZm9udC1mYW1pbHkgZm9udC1zaXplJ1xuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0e1xuXHRcdFx0XHRcdFx0c2VsZWN0b3I6ICdmaWd1cmUscCxoMSxoMixoMyxoNCxoNSxoNix0ZCx0aCx0cixkaXYsdWwsb2wsbGknLFxuXHRcdFx0XHRcdFx0c3R5bGVzOiB7XG5cdFx0XHRcdFx0XHRcdHRleHRBbGlnbjogJ2xlZnQnXG5cdFx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdFx0aW5oZXJpdDogZmFsc2UsXG5cdFx0XHRcdFx0XHRwcmV2aWV3OiBmYWxzZSxcblx0XHRcdFx0XHRcdGRlZmF1bHRCbG9jazogJ2Rpdidcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdHtzZWxlY3RvcjogJ2ltZyx0YWJsZScsIGNvbGxhcHNlZDogZmFsc2UsIHN0eWxlczogeydmbG9hdCc6ICdsZWZ0J30sIHByZXZpZXc6ICdmb250LWZhbWlseSBmb250LXNpemUnfVxuXHRcdFx0XHRdLFxuXG5cdFx0XHRcdGFsaWduY2VudGVyOiBbXG5cdFx0XHRcdFx0e1xuXHRcdFx0XHRcdFx0c2VsZWN0b3I6ICdmaWd1cmUscCxoMSxoMixoMyxoNCxoNSxoNix0ZCx0aCx0cixkaXYsdWwsb2wsbGknLFxuXHRcdFx0XHRcdFx0c3R5bGVzOiB7XG5cdFx0XHRcdFx0XHRcdHRleHRBbGlnbjogJ2NlbnRlcidcblx0XHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0XHRpbmhlcml0OiBmYWxzZSxcblx0XHRcdFx0XHRcdHByZXZpZXc6IGZhbHNlLFxuXHRcdFx0XHRcdFx0ZGVmYXVsdEJsb2NrOiAnZGl2J1xuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0e1xuXHRcdFx0XHRcdFx0c2VsZWN0b3I6ICdmaWd1cmUuaW1hZ2UnLFxuXHRcdFx0XHRcdFx0Y29sbGFwc2VkOiBmYWxzZSxcblx0XHRcdFx0XHRcdGNsYXNzZXM6ICdhbGlnbi1jZW50ZXInLFxuXHRcdFx0XHRcdFx0Y2VGYWxzZU92ZXJyaWRlOiB0cnVlLFxuXHRcdFx0XHRcdFx0cHJldmlldzogJ2ZvbnQtZmFtaWx5IGZvbnQtc2l6ZSdcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdHtcblx0XHRcdFx0XHRcdHNlbGVjdG9yOiAnaW1nJyxcblx0XHRcdFx0XHRcdGNvbGxhcHNlZDogZmFsc2UsXG5cdFx0XHRcdFx0XHRzdHlsZXM6IHtcblx0XHRcdFx0XHRcdFx0ZGlzcGxheTogJ2Jsb2NrJyxcblx0XHRcdFx0XHRcdFx0bWFyZ2luTGVmdDogJ2F1dG8nLFxuXHRcdFx0XHRcdFx0XHRtYXJnaW5SaWdodDogJ2F1dG8nXG5cdFx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdFx0cHJldmlldzogZmFsc2Vcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdHtcblx0XHRcdFx0XHRcdHNlbGVjdG9yOiAndGFibGUnLFxuXHRcdFx0XHRcdFx0Y29sbGFwc2VkOiBmYWxzZSxcblx0XHRcdFx0XHRcdHN0eWxlczoge1xuXHRcdFx0XHRcdFx0XHRtYXJnaW5MZWZ0OiAnYXV0bycsXG5cdFx0XHRcdFx0XHRcdG1hcmdpblJpZ2h0OiAnYXV0bydcblx0XHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0XHRwcmV2aWV3OiAnZm9udC1mYW1pbHkgZm9udC1zaXplJ1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XSxcblxuXHRcdFx0XHRhbGlnbnJpZ2h0OiBbXG5cdFx0XHRcdFx0e1xuXHRcdFx0XHRcdFx0c2VsZWN0b3I6ICdmaWd1cmUuaW1hZ2UnLFxuXHRcdFx0XHRcdFx0Y29sbGFwc2VkOiBmYWxzZSxcblx0XHRcdFx0XHRcdGNsYXNzZXM6ICdhbGlnbi1yaWdodCcsXG5cdFx0XHRcdFx0XHRjZUZhbHNlT3ZlcnJpZGU6IHRydWUsXG5cdFx0XHRcdFx0XHRwcmV2aWV3OiAnZm9udC1mYW1pbHkgZm9udC1zaXplJ1xuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0e1xuXHRcdFx0XHRcdFx0c2VsZWN0b3I6ICdmaWd1cmUscCxoMSxoMixoMyxoNCxoNSxoNix0ZCx0aCx0cixkaXYsdWwsb2wsbGknLFxuXHRcdFx0XHRcdFx0c3R5bGVzOiB7XG5cdFx0XHRcdFx0XHRcdHRleHRBbGlnbjogJ3JpZ2h0J1xuXHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdGluaGVyaXQ6IGZhbHNlLFxuXHRcdFx0XHRcdFx0cHJldmlldzogJ2ZvbnQtZmFtaWx5IGZvbnQtc2l6ZScsXG5cdFx0XHRcdFx0XHRkZWZhdWx0QmxvY2s6ICdkaXYnXG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XHR7XG5cdFx0XHRcdFx0XHRzZWxlY3RvcjogJ2ltZyx0YWJsZScsXG5cdFx0XHRcdFx0XHRjb2xsYXBzZWQ6IGZhbHNlLFxuXHRcdFx0XHRcdFx0c3R5bGVzOiB7XG5cdFx0XHRcdFx0XHRcdCdmbG9hdCc6ICdyaWdodCdcblx0XHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0XHRwcmV2aWV3OiAnZm9udC1mYW1pbHkgZm9udC1zaXplJ1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XSxcblxuXHRcdFx0XHRhbGlnbmp1c3RpZnk6IFtcblx0XHRcdFx0XHR7XG5cdFx0XHRcdFx0XHRzZWxlY3RvcjogJ2ZpZ3VyZSxwLGgxLGgyLGgzLGg0LGg1LGg2LHRkLHRoLHRyLGRpdix1bCxvbCxsaScsXG5cdFx0XHRcdFx0XHRzdHlsZXM6IHtcblx0XHRcdFx0XHRcdFx0dGV4dEFsaWduOiAnanVzdGlmeSdcblx0XHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0XHRpbmhlcml0OiBmYWxzZSxcblx0XHRcdFx0XHRcdGRlZmF1bHRCbG9jazogJ2RpdicsXG5cdFx0XHRcdFx0XHRwcmV2aWV3OiAnZm9udC1mYW1pbHkgZm9udC1zaXplJ1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XSxcblxuXHRcdFx0XHRib2xkOiBbXG5cdFx0XHRcdFx0e2lubGluZTogJ3N0cm9uZycsIHJlbW92ZTogJ2FsbCd9LFxuXHRcdFx0XHRcdHtpbmxpbmU6ICdzcGFuJywgc3R5bGVzOiB7Zm9udFdlaWdodDogJ2JvbGQnfX0sXG5cdFx0XHRcdFx0e2lubGluZTogJ2InLCByZW1vdmU6ICdhbGwnfVxuXHRcdFx0XHRdLFxuXG5cdFx0XHRcdGl0YWxpYzogW1xuXHRcdFx0XHRcdHtpbmxpbmU6ICdlbScsIHJlbW92ZTogJ2FsbCd9LFxuXHRcdFx0XHRcdHtpbmxpbmU6ICdzcGFuJywgc3R5bGVzOiB7Zm9udFN0eWxlOiAnaXRhbGljJ319LFxuXHRcdFx0XHRcdHtpbmxpbmU6ICdpJywgcmVtb3ZlOiAnYWxsJ31cblx0XHRcdFx0XSxcblxuXHRcdFx0XHR1bmRlcmxpbmU6IFtcblx0XHRcdFx0XHR7aW5saW5lOiAnc3BhbicsIHN0eWxlczoge3RleHREZWNvcmF0aW9uOiAndW5kZXJsaW5lJ30sIGV4YWN0OiB0cnVlfSxcblx0XHRcdFx0XHR7aW5saW5lOiAndScsIHJlbW92ZTogJ2FsbCd9XG5cdFx0XHRcdF0sXG5cblx0XHRcdFx0c3RyaWtldGhyb3VnaDogW1xuXHRcdFx0XHRcdHtpbmxpbmU6ICdzcGFuJywgc3R5bGVzOiB7dGV4dERlY29yYXRpb246ICdsaW5lLXRocm91Z2gnfSwgZXhhY3Q6IHRydWV9LFxuXHRcdFx0XHRcdHtpbmxpbmU6ICdzdHJpa2UnLCByZW1vdmU6ICdhbGwnfVxuXHRcdFx0XHRdLFxuXG5cdFx0XHRcdGZvcmVjb2xvcjoge2lubGluZTogJ3NwYW4nLCBzdHlsZXM6IHtjb2xvcjogJyV2YWx1ZSd9LCBsaW5rczogdHJ1ZSwgcmVtb3ZlX3NpbWlsYXI6IHRydWV9LFxuXHRcdFx0XHRoaWxpdGVjb2xvcjoge2lubGluZTogJ3NwYW4nLCBzdHlsZXM6IHtiYWNrZ3JvdW5kQ29sb3I6ICcldmFsdWUnfSwgbGlua3M6IHRydWUsIHJlbW92ZV9zaW1pbGFyOiB0cnVlfSxcblx0XHRcdFx0Zm9udG5hbWU6IHtpbmxpbmU6ICdzcGFuJywgc3R5bGVzOiB7Zm9udEZhbWlseTogJyV2YWx1ZSd9fSxcblx0XHRcdFx0Zm9udHNpemU6IHtpbmxpbmU6ICdzcGFuJywgc3R5bGVzOiB7Zm9udFNpemU6ICcldmFsdWUnfX0sXG5cdFx0XHRcdGZvbnRzaXplX2NsYXNzOiB7aW5saW5lOiAnc3BhbicsIGF0dHJpYnV0ZXM6IHsnY2xhc3MnOiAnJXZhbHVlJ319LFxuXHRcdFx0XHRibG9ja3F1b3RlOiB7YmxvY2s6ICdibG9ja3F1b3RlJywgd3JhcHBlcjogMSwgcmVtb3ZlOiAnYWxsJ30sXG5cdFx0XHRcdHN1YnNjcmlwdDoge2lubGluZTogJ3N1Yid9LFxuXHRcdFx0XHRzdXBlcnNjcmlwdDoge2lubGluZTogJ3N1cCd9LFxuXHRcdFx0XHRjb2RlOiB7aW5saW5lOiAnY29kZSd9LFxuXG5cdFx0XHRcdGxpbms6IHtpbmxpbmU6ICdhJywgc2VsZWN0b3I6ICdhJywgcmVtb3ZlOiAnYWxsJywgc3BsaXQ6IHRydWUsIGRlZXA6IHRydWUsXG5cdFx0XHRcdFx0b25tYXRjaDogZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdFx0XHR9LFxuXG5cdFx0XHRcdFx0b25mb3JtYXQ6IGZ1bmN0aW9uKGVsbSwgZm10LCB2YXJzKSB7XG5cdFx0XHRcdFx0XHRlYWNoKHZhcnMsIGZ1bmN0aW9uKHZhbHVlLCBrZXkpIHtcblx0XHRcdFx0XHRcdFx0ZG9tLnNldEF0dHJpYihlbG0sIGtleSwgdmFsdWUpO1xuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9LFxuXG5cdFx0XHRcdHJlbW92ZWZvcm1hdDogW1xuXHRcdFx0XHRcdHtcblx0XHRcdFx0XHRcdHNlbGVjdG9yOiAnYixzdHJvbmcsZW0saSxmb250LHUsc3RyaWtlLHN1YixzdXAsZGZuLGNvZGUsc2FtcCxrYmQsdmFyLGNpdGUsbWFyayxxLGRlbCxpbnMnLFxuXHRcdFx0XHRcdFx0cmVtb3ZlOiAnYWxsJyxcblx0XHRcdFx0XHRcdHNwbGl0OiB0cnVlLFxuXHRcdFx0XHRcdFx0ZXhwYW5kOiBmYWxzZSxcblx0XHRcdFx0XHRcdGJsb2NrX2V4cGFuZDogdHJ1ZSxcblx0XHRcdFx0XHRcdGRlZXA6IHRydWVcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdHtzZWxlY3RvcjogJ3NwYW4nLCBhdHRyaWJ1dGVzOiBbJ3N0eWxlJywgJ2NsYXNzJ10sIHJlbW92ZTogJ2VtcHR5Jywgc3BsaXQ6IHRydWUsIGV4cGFuZDogZmFsc2UsIGRlZXA6IHRydWV9LFxuXHRcdFx0XHRcdHtzZWxlY3RvcjogJyonLCBhdHRyaWJ1dGVzOiBbJ3N0eWxlJywgJ2NsYXNzJ10sIHNwbGl0OiBmYWxzZSwgZXhwYW5kOiBmYWxzZSwgZGVlcDogdHJ1ZX1cblx0XHRcdFx0XVxuXHRcdFx0fSk7XG5cblx0XHRcdC8vIFJlZ2lzdGVyIGRlZmF1bHQgYmxvY2sgZm9ybWF0c1xuXHRcdFx0ZWFjaCgncCBoMSBoMiBoMyBoNCBoNSBoNiBkaXYgYWRkcmVzcyBwcmUgZGl2IGR0IGRkIHNhbXAnLnNwbGl0KC9cXHMvKSwgZnVuY3Rpb24obmFtZSkge1xuXHRcdFx0XHRyZWdpc3RlcihuYW1lLCB7YmxvY2s6IG5hbWUsIHJlbW92ZTogJ2FsbCd9KTtcblx0XHRcdH0pO1xuXG5cdFx0XHQvLyBSZWdpc3RlciB1c2VyIGRlZmluZWQgZm9ybWF0c1xuXHRcdFx0cmVnaXN0ZXIoZWQuc2V0dGluZ3MuZm9ybWF0cyk7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gYWRkS2V5Ym9hcmRTaG9ydGN1dHMoKSB7XG5cdFx0XHQvLyBBZGQgc29tZSBpbmxpbmUgc2hvcnRjdXRzXG5cdFx0XHRlZC5hZGRTaG9ydGN1dCgnbWV0YStiJywgJ2JvbGRfZGVzYycsICdCb2xkJyk7XG5cdFx0XHRlZC5hZGRTaG9ydGN1dCgnbWV0YStpJywgJ2l0YWxpY19kZXNjJywgJ0l0YWxpYycpO1xuXHRcdFx0ZWQuYWRkU2hvcnRjdXQoJ21ldGErdScsICd1bmRlcmxpbmVfZGVzYycsICdVbmRlcmxpbmUnKTtcblxuXHRcdFx0Ly8gQmxvY2tGb3JtYXQgc2hvcnRjdXRzIGtleXNcblx0XHRcdGZvciAodmFyIGkgPSAxOyBpIDw9IDY7IGkrKykge1xuXHRcdFx0XHRlZC5hZGRTaG9ydGN1dCgnYWNjZXNzKycgKyBpLCAnJywgWydGb3JtYXRCbG9jaycsIGZhbHNlLCAnaCcgKyBpXSk7XG5cdFx0XHR9XG5cblx0XHRcdGVkLmFkZFNob3J0Y3V0KCdhY2Nlc3MrNycsICcnLCBbJ0Zvcm1hdEJsb2NrJywgZmFsc2UsICdwJ10pO1xuXHRcdFx0ZWQuYWRkU2hvcnRjdXQoJ2FjY2Vzcys4JywgJycsIFsnRm9ybWF0QmxvY2snLCBmYWxzZSwgJ2RpdiddKTtcblx0XHRcdGVkLmFkZFNob3J0Y3V0KCdhY2Nlc3MrOScsICcnLCBbJ0Zvcm1hdEJsb2NrJywgZmFsc2UsICdhZGRyZXNzJ10pO1xuXHRcdH1cblxuXHRcdC8vIFB1YmxpYyBmdW5jdGlvbnNcblxuXHRcdC8qKlxuXHRcdCAqIFJldHVybnMgdGhlIGZvcm1hdCBieSBuYW1lIG9yIGFsbCBmb3JtYXRzIGlmIG5vIG5hbWUgaXMgc3BlY2lmaWVkLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBnZXRcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSBPcHRpb25hbCBuYW1lIHRvIHJldHJpZXZlIGJ5LlxuXHRcdCAqIEByZXR1cm4ge0FycmF5L09iamVjdH0gQXJyYXkvT2JqZWN0IHdpdGggYWxsIHJlZ2lzdGVyZWQgZm9ybWF0cyBvciBhIHNwZWNpZmljIGZvcm1hdC5cblx0XHQgKi9cblx0XHRmdW5jdGlvbiBnZXQobmFtZSkge1xuXHRcdFx0cmV0dXJuIG5hbWUgPyBmb3JtYXRzW25hbWVdIDogZm9ybWF0cztcblx0XHR9XG5cblx0XHQvKipcblx0XHQgKiBSZWdpc3RlcnMgYSBzcGVjaWZpYyBmb3JtYXQgYnkgbmFtZS5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgcmVnaXN0ZXJcblx0XHQgKiBAcGFyYW0ge09iamVjdC9TdHJpbmd9IG5hbWUgTmFtZSBvZiB0aGUgZm9ybWF0IGZvciBleGFtcGxlIFwiYm9sZFwiLlxuXHRcdCAqIEBwYXJhbSB7T2JqZWN0L0FycmF5fSBmb3JtYXQgT3B0aW9uYWwgZm9ybWF0IG9iamVjdCBvciBhcnJheSBvZiBmb3JtYXQgdmFyaWFudHNcblx0XHQgKiBjYW4gb25seSBiZSBvbWl0dGVkIGlmIHRoZSBmaXJzdCBhcmcgaXMgYW4gb2JqZWN0LlxuXHRcdCAqL1xuXHRcdGZ1bmN0aW9uIHJlZ2lzdGVyKG5hbWUsIGZvcm1hdCkge1xuXHRcdFx0aWYgKG5hbWUpIHtcblx0XHRcdFx0aWYgKHR5cGVvZiBuYW1lICE9PSAnc3RyaW5nJykge1xuXHRcdFx0XHRcdGVhY2gobmFtZSwgZnVuY3Rpb24oZm9ybWF0LCBuYW1lKSB7XG5cdFx0XHRcdFx0XHRyZWdpc3RlcihuYW1lLCBmb3JtYXQpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdC8vIEZvcmNlIGZvcm1hdCBpbnRvIGFycmF5IGFuZCBhZGQgaXQgdG8gaW50ZXJuYWwgY29sbGVjdGlvblxuXHRcdFx0XHRcdGZvcm1hdCA9IGZvcm1hdC5sZW5ndGggPyBmb3JtYXQgOiBbZm9ybWF0XTtcblxuXHRcdFx0XHRcdGVhY2goZm9ybWF0LCBmdW5jdGlvbihmb3JtYXQpIHtcblx0XHRcdFx0XHRcdC8vIFNldCBkZWVwIHRvIGZhbHNlIGJ5IGRlZmF1bHQgb24gc2VsZWN0b3IgZm9ybWF0cyB0aGlzIHRvIGF2b2lkIHJlbW92aW5nXG5cdFx0XHRcdFx0XHQvLyBhbGlnbm1lbnQgb24gaW1hZ2VzIGluc2lkZSBwYXJhZ3JhcGhzIHdoZW4gYWxpZ25tZW50IGlzIGNoYW5nZWQgb24gcGFyYWdyYXBoc1xuXHRcdFx0XHRcdFx0aWYgKGZvcm1hdC5kZWVwID09PSB1bmRlZikge1xuXHRcdFx0XHRcdFx0XHRmb3JtYXQuZGVlcCA9ICFmb3JtYXQuc2VsZWN0b3I7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdC8vIERlZmF1bHQgdG8gdHJ1ZVxuXHRcdFx0XHRcdFx0aWYgKGZvcm1hdC5zcGxpdCA9PT0gdW5kZWYpIHtcblx0XHRcdFx0XHRcdFx0Zm9ybWF0LnNwbGl0ID0gIWZvcm1hdC5zZWxlY3RvciB8fCBmb3JtYXQuaW5saW5lO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHQvLyBEZWZhdWx0IHRvIHRydWVcblx0XHRcdFx0XHRcdGlmIChmb3JtYXQucmVtb3ZlID09PSB1bmRlZiAmJiBmb3JtYXQuc2VsZWN0b3IgJiYgIWZvcm1hdC5pbmxpbmUpIHtcblx0XHRcdFx0XHRcdFx0Zm9ybWF0LnJlbW92ZSA9ICdub25lJztcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0Ly8gTWFyayBmb3JtYXQgYXMgYSBtaXhlZCBmb3JtYXQgaW5saW5lICsgYmxvY2sgbGV2ZWxcblx0XHRcdFx0XHRcdGlmIChmb3JtYXQuc2VsZWN0b3IgJiYgZm9ybWF0LmlubGluZSkge1xuXHRcdFx0XHRcdFx0XHRmb3JtYXQubWl4ZWQgPSB0cnVlO1xuXHRcdFx0XHRcdFx0XHRmb3JtYXQuYmxvY2tfZXhwYW5kID0gdHJ1ZTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0Ly8gU3BsaXQgY2xhc3NlcyBpZiBuZWVkZWRcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YgZm9ybWF0LmNsYXNzZXMgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRcdFx0XHRcdGZvcm1hdC5jbGFzc2VzID0gZm9ybWF0LmNsYXNzZXMuc3BsaXQoL1xccysvKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdGZvcm1hdHNbbmFtZV0gPSBmb3JtYXQ7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHQvKipcblx0XHQgKiBVbnJlZ2lzdGVyIGEgc3BlY2lmaWMgZm9ybWF0IGJ5IG5hbWUuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHVucmVnaXN0ZXJcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSBOYW1lIG9mIHRoZSBmb3JtYXQgZm9yIGV4YW1wbGUgXCJib2xkXCIuXG5cdFx0ICovXG5cdFx0ZnVuY3Rpb24gdW5yZWdpc3RlcihuYW1lKSB7XG5cdFx0XHRpZiAobmFtZSAmJiBmb3JtYXRzW25hbWVdKSB7XG5cdFx0XHRcdGRlbGV0ZSBmb3JtYXRzW25hbWVdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gZm9ybWF0cztcblx0XHR9XG5cblx0XHRmdW5jdGlvbiBtYXRjaGVzVW5Jbmhlcml0ZWRGb3JtYXRTZWxlY3Rvcihub2RlLCBuYW1lKSB7XG5cdFx0XHR2YXIgZm9ybWF0TGlzdCA9IGdldChuYW1lKTtcblxuXHRcdFx0aWYgKGZvcm1hdExpc3QpIHtcblx0XHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBmb3JtYXRMaXN0Lmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRcdFx0aWYgKGZvcm1hdExpc3RbaV0uaW5oZXJpdCA9PT0gZmFsc2UgJiYgZG9tLmlzKG5vZGUsIGZvcm1hdExpc3RbaV0uc2VsZWN0b3IpKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIGdldFRleHREZWNvcmF0aW9uKG5vZGUpIHtcblx0XHRcdHZhciBkZWNvcmF0aW9uO1xuXG5cdFx0XHRlZC5kb20uZ2V0UGFyZW50KG5vZGUsIGZ1bmN0aW9uKG4pIHtcblx0XHRcdFx0ZGVjb3JhdGlvbiA9IGVkLmRvbS5nZXRTdHlsZShuLCAndGV4dC1kZWNvcmF0aW9uJyk7XG5cdFx0XHRcdHJldHVybiBkZWNvcmF0aW9uICYmIGRlY29yYXRpb24gIT09ICdub25lJztcblx0XHRcdH0pO1xuXG5cdFx0XHRyZXR1cm4gZGVjb3JhdGlvbjtcblx0XHR9XG5cblx0XHRmdW5jdGlvbiBwcm9jZXNzVW5kZXJsaW5lQW5kQ29sb3Iobm9kZSkge1xuXHRcdFx0dmFyIHRleHREZWNvcmF0aW9uO1xuXHRcdFx0aWYgKG5vZGUubm9kZVR5cGUgPT09IDEgJiYgbm9kZS5wYXJlbnROb2RlICYmIG5vZGUucGFyZW50Tm9kZS5ub2RlVHlwZSA9PT0gMSkge1xuXHRcdFx0XHR0ZXh0RGVjb3JhdGlvbiA9IGdldFRleHREZWNvcmF0aW9uKG5vZGUucGFyZW50Tm9kZSk7XG5cdFx0XHRcdGlmIChlZC5kb20uZ2V0U3R5bGUobm9kZSwgJ2NvbG9yJykgJiYgdGV4dERlY29yYXRpb24pIHtcblx0XHRcdFx0XHRlZC5kb20uc2V0U3R5bGUobm9kZSwgJ3RleHQtZGVjb3JhdGlvbicsIHRleHREZWNvcmF0aW9uKTtcblx0XHRcdFx0fSBlbHNlIGlmIChlZC5kb20uZ2V0U3R5bGUobm9kZSwgJ3RleHQtZGVjb3JhdGlvbicpID09PSB0ZXh0RGVjb3JhdGlvbikge1xuXHRcdFx0XHRcdGVkLmRvbS5zZXRTdHlsZShub2RlLCAndGV4dC1kZWNvcmF0aW9uJywgbnVsbCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHQvKipcblx0XHQgKiBBcHBsaWVzIHRoZSBzcGVjaWZpZWQgZm9ybWF0IHRvIHRoZSBjdXJyZW50IHNlbGVjdGlvbiBvciBzcGVjaWZpZWQgbm9kZS5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgYXBwbHlcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSBOYW1lIG9mIGZvcm1hdCB0byBhcHBseS5cblx0XHQgKiBAcGFyYW0ge09iamVjdH0gdmFycyBPcHRpb25hbCBsaXN0IG9mIHZhcmlhYmxlcyB0byByZXBsYWNlIHdpdGhpbiBmb3JtYXQgYmVmb3JlIGFwcGx5aW5nIGl0LlxuXHRcdCAqIEBwYXJhbSB7Tm9kZX0gbm9kZSBPcHRpb25hbCBub2RlIHRvIGFwcGx5IHRoZSBmb3JtYXQgdG8gZGVmYXVsdHMgdG8gY3VycmVudCBzZWxlY3Rpb24uXG5cdFx0ICovXG5cdFx0ZnVuY3Rpb24gYXBwbHkobmFtZSwgdmFycywgbm9kZSkge1xuXHRcdFx0dmFyIGZvcm1hdExpc3QgPSBnZXQobmFtZSksIGZvcm1hdCA9IGZvcm1hdExpc3RbMF0sIGJvb2ttYXJrLCBybmcsIGlzQ29sbGFwc2VkID0gIW5vZGUgJiYgc2VsZWN0aW9uLmlzQ29sbGFwc2VkKCk7XG5cblx0XHRcdGZ1bmN0aW9uIHNldEVsZW1lbnRGb3JtYXQoZWxtLCBmbXQpIHtcblx0XHRcdFx0Zm10ID0gZm10IHx8IGZvcm1hdDtcblxuXHRcdFx0XHRpZiAoZWxtKSB7XG5cdFx0XHRcdFx0aWYgKGZtdC5vbmZvcm1hdCkge1xuXHRcdFx0XHRcdFx0Zm10Lm9uZm9ybWF0KGVsbSwgZm10LCB2YXJzLCBub2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRlYWNoKGZtdC5zdHlsZXMsIGZ1bmN0aW9uKHZhbHVlLCBuYW1lKSB7XG5cdFx0XHRcdFx0XHRkb20uc2V0U3R5bGUoZWxtLCBuYW1lLCByZXBsYWNlVmFycyh2YWx1ZSwgdmFycykpO1xuXHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0Ly8gTmVlZGVkIGZvciB0aGUgV2ViS2l0IHNwYW4gc3BhbSBidWdcblx0XHRcdFx0XHQvLyBUT0RPOiBSZW1vdmUgdGhpcyBvbmNlIFdlYktpdC9CbGluayBmaXhlcyB0aGlzXG5cdFx0XHRcdFx0aWYgKGZtdC5zdHlsZXMpIHtcblx0XHRcdFx0XHRcdHZhciBzdHlsZVZhbCA9IGRvbS5nZXRBdHRyaWIoZWxtLCAnc3R5bGUnKTtcblxuXHRcdFx0XHRcdFx0aWYgKHN0eWxlVmFsKSB7XG5cdFx0XHRcdFx0XHRcdGVsbS5zZXRBdHRyaWJ1dGUoJ2RhdGEtbWNlLXN0eWxlJywgc3R5bGVWYWwpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGVhY2goZm10LmF0dHJpYnV0ZXMsIGZ1bmN0aW9uKHZhbHVlLCBuYW1lKSB7XG5cdFx0XHRcdFx0XHRkb20uc2V0QXR0cmliKGVsbSwgbmFtZSwgcmVwbGFjZVZhcnModmFsdWUsIHZhcnMpKTtcblx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdGVhY2goZm10LmNsYXNzZXMsIGZ1bmN0aW9uKHZhbHVlKSB7XG5cdFx0XHRcdFx0XHR2YWx1ZSA9IHJlcGxhY2VWYXJzKHZhbHVlLCB2YXJzKTtcblxuXHRcdFx0XHRcdFx0aWYgKCFkb20uaGFzQ2xhc3MoZWxtLCB2YWx1ZSkpIHtcblx0XHRcdFx0XHRcdFx0ZG9tLmFkZENsYXNzKGVsbSwgdmFsdWUpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIGFwcGx5Tm9kZVN0eWxlKGZvcm1hdExpc3QsIG5vZGUpIHtcblx0XHRcdFx0dmFyIGZvdW5kID0gZmFsc2U7XG5cblx0XHRcdFx0aWYgKCFmb3JtYXQuc2VsZWN0b3IpIHtcblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBMb29rIGZvciBtYXRjaGluZyBmb3JtYXRzXG5cdFx0XHRcdGVhY2goZm9ybWF0TGlzdCwgZnVuY3Rpb24oZm9ybWF0KSB7XG5cdFx0XHRcdFx0Ly8gQ2hlY2sgY29sbGFwc2VkIHN0YXRlIGlmIGl0IGV4aXN0c1xuXHRcdFx0XHRcdGlmICgnY29sbGFwc2VkJyBpbiBmb3JtYXQgJiYgZm9ybWF0LmNvbGxhcHNlZCAhPT0gaXNDb2xsYXBzZWQpIHtcblx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoZG9tLmlzKG5vZGUsIGZvcm1hdC5zZWxlY3RvcikgJiYgIWlzQ2FyZXROb2RlKG5vZGUpKSB7XG5cdFx0XHRcdFx0XHRzZXRFbGVtZW50Rm9ybWF0KG5vZGUsIGZvcm1hdCk7XG5cdFx0XHRcdFx0XHRmb3VuZCA9IHRydWU7XG5cdFx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHRyZXR1cm4gZm91bmQ7XG5cdFx0XHR9XG5cblx0XHRcdC8vIFRoaXMgY29udmVydHM6IDxwPlthPC9wPjxwPl1iPC9wPiAtPiA8cD5bYV08L3A+PHA+YjwvcD5cblx0XHRcdGZ1bmN0aW9uIGFkanVzdFNlbGVjdGlvblRvVmlzaWJsZVNlbGVjdGlvbigpIHtcblx0XHRcdFx0ZnVuY3Rpb24gZmluZFNlbGVjdGlvbkVuZChzdGFydCwgZW5kKSB7XG5cdFx0XHRcdFx0dmFyIHdhbGtlciA9IG5ldyBUcmVlV2Fsa2VyKGVuZCk7XG5cdFx0XHRcdFx0Zm9yIChub2RlID0gd2Fsa2VyLnByZXYyKCk7IG5vZGU7IG5vZGUgPSB3YWxrZXIucHJldjIoKSkge1xuXHRcdFx0XHRcdFx0aWYgKG5vZGUubm9kZVR5cGUgPT0gMyAmJiBub2RlLmRhdGEubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbm9kZTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0aWYgKG5vZGUuY2hpbGROb2Rlcy5sZW5ndGggPiAxIHx8IG5vZGUgPT0gc3RhcnQgfHwgbm9kZS50YWdOYW1lID09ICdCUicpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIG5vZGU7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gQWRqdXN0IHNlbGVjdGlvbiBzbyB0aGF0IGEgZW5kIGNvbnRhaW5lciB3aXRoIGEgZW5kIG9mZnNldCBvZiB6ZXJvIGlzIG5vdCBpbmNsdWRlZCBpbiB0aGUgc2VsZWN0aW9uXG5cdFx0XHRcdC8vIGFzIHRoaXMgaXNuJ3QgdmlzaWJsZSB0byB0aGUgdXNlci5cblx0XHRcdFx0dmFyIHJuZyA9IGVkLnNlbGVjdGlvbi5nZXRSbmcoKTtcblx0XHRcdFx0dmFyIHN0YXJ0ID0gcm5nLnN0YXJ0Q29udGFpbmVyO1xuXHRcdFx0XHR2YXIgZW5kID0gcm5nLmVuZENvbnRhaW5lcjtcblxuXHRcdFx0XHRpZiAoc3RhcnQgIT0gZW5kICYmIHJuZy5lbmRPZmZzZXQgPT09IDApIHtcblx0XHRcdFx0XHR2YXIgbmV3RW5kID0gZmluZFNlbGVjdGlvbkVuZChzdGFydCwgZW5kKTtcblx0XHRcdFx0XHR2YXIgZW5kT2Zmc2V0ID0gbmV3RW5kLm5vZGVUeXBlID09IDMgPyBuZXdFbmQuZGF0YS5sZW5ndGggOiBuZXdFbmQuY2hpbGROb2Rlcy5sZW5ndGg7XG5cblx0XHRcdFx0XHRybmcuc2V0RW5kKG5ld0VuZCwgZW5kT2Zmc2V0KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBybmc7XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIGFwcGx5Um5nU3R5bGUocm5nLCBib29rbWFyaywgbm9kZV9zcGVjaWZpYykge1xuXHRcdFx0XHR2YXIgbmV3V3JhcHBlcnMgPSBbXSwgd3JhcE5hbWUsIHdyYXBFbG0sIGNvbnRlbnRFZGl0YWJsZSA9IHRydWU7XG5cblx0XHRcdFx0Ly8gU2V0dXAgd3JhcHBlciBlbGVtZW50XG5cdFx0XHRcdHdyYXBOYW1lID0gZm9ybWF0LmlubGluZSB8fCBmb3JtYXQuYmxvY2s7XG5cdFx0XHRcdHdyYXBFbG0gPSBkb20uY3JlYXRlKHdyYXBOYW1lKTtcblx0XHRcdFx0c2V0RWxlbWVudEZvcm1hdCh3cmFwRWxtKTtcblxuXHRcdFx0XHRyYW5nZVV0aWxzLndhbGsocm5nLCBmdW5jdGlvbihub2Rlcykge1xuXHRcdFx0XHRcdHZhciBjdXJyZW50V3JhcEVsbTtcblxuXHRcdFx0XHRcdC8qKlxuXHRcdFx0XHRcdCAqIFByb2Nlc3MgYSBsaXN0IG9mIG5vZGVzIHdyYXAgdGhlbS5cblx0XHRcdFx0XHQgKi9cblx0XHRcdFx0XHRmdW5jdGlvbiBwcm9jZXNzKG5vZGUpIHtcblx0XHRcdFx0XHRcdHZhciBub2RlTmFtZSwgcGFyZW50TmFtZSwgaGFzQ29udGVudEVkaXRhYmxlU3RhdGUsIGxhc3RDb250ZW50RWRpdGFibGU7XG5cblx0XHRcdFx0XHRcdGxhc3RDb250ZW50RWRpdGFibGUgPSBjb250ZW50RWRpdGFibGU7XG5cdFx0XHRcdFx0XHRub2RlTmFtZSA9IG5vZGUubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0XHRcdHBhcmVudE5hbWUgPSBub2RlLnBhcmVudE5vZGUubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtcblxuXHRcdFx0XHRcdFx0Ly8gTm9kZSBoYXMgYSBjb250ZW50RWRpdGFibGUgdmFsdWVcblx0XHRcdFx0XHRcdGlmIChub2RlLm5vZGVUeXBlID09PSAxICYmIGdldENvbnRlbnRFZGl0YWJsZShub2RlKSkge1xuXHRcdFx0XHRcdFx0XHRsYXN0Q29udGVudEVkaXRhYmxlID0gY29udGVudEVkaXRhYmxlO1xuXHRcdFx0XHRcdFx0XHRjb250ZW50RWRpdGFibGUgPSBnZXRDb250ZW50RWRpdGFibGUobm9kZSkgPT09IFwidHJ1ZVwiO1xuXHRcdFx0XHRcdFx0XHRoYXNDb250ZW50RWRpdGFibGVTdGF0ZSA9IHRydWU7IC8vIFdlIGRvbid0IHdhbnQgdG8gd3JhcCB0aGUgY29udGFpbmVyIG9ubHkgaXQncyBjaGlsZHJlblxuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHQvLyBTdG9wIHdyYXBwaW5nIG9uIGJyIGVsZW1lbnRzXG5cdFx0XHRcdFx0XHRpZiAoaXNFcShub2RlTmFtZSwgJ2JyJykpIHtcblx0XHRcdFx0XHRcdFx0Y3VycmVudFdyYXBFbG0gPSAwO1xuXG5cdFx0XHRcdFx0XHRcdC8vIFJlbW92ZSBhbnkgYnIgZWxlbWVudHMgd2hlbiB3ZSB3cmFwIHRoaW5nc1xuXHRcdFx0XHRcdFx0XHRpZiAoZm9ybWF0LmJsb2NrKSB7XG5cdFx0XHRcdFx0XHRcdFx0ZG9tLnJlbW92ZShub2RlKTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0Ly8gSWYgbm9kZSBpcyB3cmFwcGVyIHR5cGVcblx0XHRcdFx0XHRcdGlmIChmb3JtYXQud3JhcHBlciAmJiBtYXRjaE5vZGUobm9kZSwgbmFtZSwgdmFycykpIHtcblx0XHRcdFx0XHRcdFx0Y3VycmVudFdyYXBFbG0gPSAwO1xuXHRcdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdC8vIENhbiB3ZSByZW5hbWUgdGhlIGJsb2NrXG5cdFx0XHRcdFx0XHQvLyBUT0RPOiBCcmVhayB0aGlzIGlmIHVwLCB0b28gY29tcGxleFxuXHRcdFx0XHRcdFx0aWYgKGNvbnRlbnRFZGl0YWJsZSAmJiAhaGFzQ29udGVudEVkaXRhYmxlU3RhdGUgJiYgZm9ybWF0LmJsb2NrICYmXG5cdFx0XHRcdFx0XHRcdCFmb3JtYXQud3JhcHBlciAmJiBpc1RleHRCbG9jayhub2RlTmFtZSkgJiYgaXNWYWxpZChwYXJlbnROYW1lLCB3cmFwTmFtZSkpIHtcblx0XHRcdFx0XHRcdFx0bm9kZSA9IGRvbS5yZW5hbWUobm9kZSwgd3JhcE5hbWUpO1xuXHRcdFx0XHRcdFx0XHRzZXRFbGVtZW50Rm9ybWF0KG5vZGUpO1xuXHRcdFx0XHRcdFx0XHRuZXdXcmFwcGVycy5wdXNoKG5vZGUpO1xuXHRcdFx0XHRcdFx0XHRjdXJyZW50V3JhcEVsbSA9IDA7XG5cdFx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0Ly8gSGFuZGxlIHNlbGVjdG9yIHBhdHRlcm5zXG5cdFx0XHRcdFx0XHRpZiAoZm9ybWF0LnNlbGVjdG9yKSB7XG5cdFx0XHRcdFx0XHRcdHZhciBmb3VuZCA9IGFwcGx5Tm9kZVN0eWxlKGZvcm1hdExpc3QsIG5vZGUpO1xuXG5cdFx0XHRcdFx0XHRcdC8vIENvbnRpbnVlIHByb2Nlc3NpbmcgaWYgYSBzZWxlY3RvciBtYXRjaCB3YXNuJ3QgZm91bmQgYW5kIGEgaW5saW5lIGVsZW1lbnQgaXMgZGVmaW5lZFxuXHRcdFx0XHRcdFx0XHRpZiAoIWZvcm1hdC5pbmxpbmUgfHwgZm91bmQpIHtcblx0XHRcdFx0XHRcdFx0XHRjdXJyZW50V3JhcEVsbSA9IDA7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdC8vIElzIGl0IHZhbGlkIHRvIHdyYXAgdGhpcyBpdGVtXG5cdFx0XHRcdFx0XHQvLyBUT0RPOiBCcmVhayB0aGlzIGlmIHVwLCB0b28gY29tcGxleFxuXHRcdFx0XHRcdFx0aWYgKGNvbnRlbnRFZGl0YWJsZSAmJiAhaGFzQ29udGVudEVkaXRhYmxlU3RhdGUgJiYgaXNWYWxpZCh3cmFwTmFtZSwgbm9kZU5hbWUpICYmIGlzVmFsaWQocGFyZW50TmFtZSwgd3JhcE5hbWUpICYmXG5cdFx0XHRcdFx0XHRcdFx0ISghbm9kZV9zcGVjaWZpYyAmJiBub2RlLm5vZGVUeXBlID09PSAzICYmXG5cdFx0XHRcdFx0XHRcdFx0bm9kZS5ub2RlVmFsdWUubGVuZ3RoID09PSAxICYmXG5cdFx0XHRcdFx0XHRcdFx0bm9kZS5ub2RlVmFsdWUuY2hhckNvZGVBdCgwKSA9PT0gNjUyNzkpICYmXG5cdFx0XHRcdFx0XHRcdFx0IWlzQ2FyZXROb2RlKG5vZGUpICYmXG5cdFx0XHRcdFx0XHRcdFx0KCFmb3JtYXQuaW5saW5lIHx8ICFpc0Jsb2NrKG5vZGUpKSkge1xuXHRcdFx0XHRcdFx0XHQvLyBTdGFydCB3cmFwcGluZ1xuXHRcdFx0XHRcdFx0XHRpZiAoIWN1cnJlbnRXcmFwRWxtKSB7XG5cdFx0XHRcdFx0XHRcdFx0Ly8gV3JhcCB0aGUgbm9kZVxuXHRcdFx0XHRcdFx0XHRcdGN1cnJlbnRXcmFwRWxtID0gZG9tLmNsb25lKHdyYXBFbG0sIEZBTFNFKTtcblx0XHRcdFx0XHRcdFx0XHRub2RlLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGN1cnJlbnRXcmFwRWxtLCBub2RlKTtcblx0XHRcdFx0XHRcdFx0XHRuZXdXcmFwcGVycy5wdXNoKGN1cnJlbnRXcmFwRWxtKTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdGN1cnJlbnRXcmFwRWxtLmFwcGVuZENoaWxkKG5vZGUpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0Ly8gU3RhcnQgYSBuZXcgd3JhcHBlciBmb3IgcG9zc2libGUgY2hpbGRyZW5cblx0XHRcdFx0XHRcdFx0Y3VycmVudFdyYXBFbG0gPSAwO1xuXG5cdFx0XHRcdFx0XHRcdGVhY2goZ3JlcChub2RlLmNoaWxkTm9kZXMpLCBwcm9jZXNzKTtcblxuXHRcdFx0XHRcdFx0XHRpZiAoaGFzQ29udGVudEVkaXRhYmxlU3RhdGUpIHtcblx0XHRcdFx0XHRcdFx0XHRjb250ZW50RWRpdGFibGUgPSBsYXN0Q29udGVudEVkaXRhYmxlOyAvLyBSZXN0b3JlIGxhc3QgY29udGVudEVkaXRhYmxlIHN0YXRlIGZyb20gc3RhY2tcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdC8vIEVuZCB0aGUgbGFzdCB3cmFwcGVyXG5cdFx0XHRcdFx0XHRcdGN1cnJlbnRXcmFwRWxtID0gMDtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHQvLyBQcm9jZXNzIHNpYmxpbmdzIGZyb20gcmFuZ2Vcblx0XHRcdFx0XHRlYWNoKG5vZGVzLCBwcm9jZXNzKTtcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0Ly8gQXBwbHkgZm9ybWF0cyB0byBsaW5rcyBhcyB3ZWxsIHRvIGdldCB0aGUgY29sb3Igb2YgdGhlIHVuZGVybGluZSB0byBjaGFuZ2UgYXMgd2VsbFxuXHRcdFx0XHRpZiAoZm9ybWF0LmxpbmtzID09PSB0cnVlKSB7XG5cdFx0XHRcdFx0ZWFjaChuZXdXcmFwcGVycywgZnVuY3Rpb24obm9kZSkge1xuXHRcdFx0XHRcdFx0ZnVuY3Rpb24gcHJvY2Vzcyhub2RlKSB7XG5cdFx0XHRcdFx0XHRcdGlmIChub2RlLm5vZGVOYW1lID09PSAnQScpIHtcblx0XHRcdFx0XHRcdFx0XHRzZXRFbGVtZW50Rm9ybWF0KG5vZGUsIGZvcm1hdCk7XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRlYWNoKGdyZXAobm9kZS5jaGlsZE5vZGVzKSwgcHJvY2Vzcyk7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHByb2Nlc3Mobm9kZSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBDbGVhbnVwXG5cdFx0XHRcdGVhY2gobmV3V3JhcHBlcnMsIGZ1bmN0aW9uKG5vZGUpIHtcblx0XHRcdFx0XHR2YXIgY2hpbGRDb3VudDtcblxuXHRcdFx0XHRcdGZ1bmN0aW9uIGdldENoaWxkQ291bnQobm9kZSkge1xuXHRcdFx0XHRcdFx0dmFyIGNvdW50ID0gMDtcblxuXHRcdFx0XHRcdFx0ZWFjaChub2RlLmNoaWxkTm9kZXMsIGZ1bmN0aW9uKG5vZGUpIHtcblx0XHRcdFx0XHRcdFx0aWYgKCFpc1doaXRlU3BhY2VOb2RlKG5vZGUpICYmICFpc0Jvb2ttYXJrTm9kZShub2RlKSkge1xuXHRcdFx0XHRcdFx0XHRcdGNvdW50Kys7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0XHRyZXR1cm4gY291bnQ7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0ZnVuY3Rpb24gbWVyZ2VTdHlsZXMobm9kZSkge1xuXHRcdFx0XHRcdFx0dmFyIGNoaWxkLCBjbG9uZTtcblxuXHRcdFx0XHRcdFx0ZWFjaChub2RlLmNoaWxkTm9kZXMsIGZ1bmN0aW9uKG5vZGUpIHtcblx0XHRcdFx0XHRcdFx0aWYgKG5vZGUubm9kZVR5cGUgPT0gMSAmJiAhaXNCb29rbWFya05vZGUobm9kZSkgJiYgIWlzQ2FyZXROb2RlKG5vZGUpKSB7XG5cdFx0XHRcdFx0XHRcdFx0Y2hpbGQgPSBub2RlO1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiBGQUxTRTsgLy8gYnJlYWsgbG9vcFxuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdFx0Ly8gSWYgY2hpbGQgd2FzIGZvdW5kIGFuZCBvZiB0aGUgc2FtZSB0eXBlIGFzIHRoZSBjdXJyZW50IG5vZGVcblx0XHRcdFx0XHRcdGlmIChjaGlsZCAmJiAhaXNCb29rbWFya05vZGUoY2hpbGQpICYmIG1hdGNoTmFtZShjaGlsZCwgZm9ybWF0KSkge1xuXHRcdFx0XHRcdFx0XHRjbG9uZSA9IGRvbS5jbG9uZShjaGlsZCwgRkFMU0UpO1xuXHRcdFx0XHRcdFx0XHRzZXRFbGVtZW50Rm9ybWF0KGNsb25lKTtcblxuXHRcdFx0XHRcdFx0XHRkb20ucmVwbGFjZShjbG9uZSwgbm9kZSwgVFJVRSk7XG5cdFx0XHRcdFx0XHRcdGRvbS5yZW1vdmUoY2hpbGQsIDEpO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gY2xvbmUgfHwgbm9kZTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRjaGlsZENvdW50ID0gZ2V0Q2hpbGRDb3VudChub2RlKTtcblxuXHRcdFx0XHRcdC8vIFJlbW92ZSBlbXB0eSBub2RlcyBidXQgb25seSBpZiB0aGVyZSBpcyBtdWx0aXBsZSB3cmFwcGVycyBhbmQgdGhleSBhcmUgbm90IGJsb2NrXG5cdFx0XHRcdFx0Ly8gZWxlbWVudHMgc28gbmV2ZXIgcmVtb3ZlIHNpbmdsZSA8aDE+PC9oMT4gc2luY2UgdGhhdCB3b3VsZCByZW1vdmUgdGhlXG5cdFx0XHRcdFx0Ly8gY3VycmVudCBlbXB0eSBibG9jayBlbGVtZW50IHdoZXJlIHRoZSBjYXJldCBpcyBhdFxuXHRcdFx0XHRcdGlmICgobmV3V3JhcHBlcnMubGVuZ3RoID4gMSB8fCAhaXNCbG9jayhub2RlKSkgJiYgY2hpbGRDb3VudCA9PT0gMCkge1xuXHRcdFx0XHRcdFx0ZG9tLnJlbW92ZShub2RlLCAxKTtcblx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoZm9ybWF0LmlubGluZSB8fCBmb3JtYXQud3JhcHBlcikge1xuXHRcdFx0XHRcdFx0Ly8gTWVyZ2VzIHRoZSBjdXJyZW50IG5vZGUgd2l0aCBpdCdzIGNoaWxkcmVuIG9mIHNpbWlsYXIgdHlwZSB0byByZWR1Y2UgdGhlIG51bWJlciBvZiBlbGVtZW50c1xuXHRcdFx0XHRcdFx0aWYgKCFmb3JtYXQuZXhhY3QgJiYgY2hpbGRDb3VudCA9PT0gMSkge1xuXHRcdFx0XHRcdFx0XHRub2RlID0gbWVyZ2VTdHlsZXMobm9kZSk7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdC8vIFJlbW92ZS9tZXJnZSBjaGlsZHJlblxuXHRcdFx0XHRcdFx0ZWFjaChmb3JtYXRMaXN0LCBmdW5jdGlvbihmb3JtYXQpIHtcblx0XHRcdFx0XHRcdFx0Ly8gTWVyZ2UgYWxsIGNoaWxkcmVuIG9mIHNpbWlsYXIgdHlwZSB3aWxsIG1vdmUgc3R5bGVzIGZyb20gY2hpbGQgdG8gcGFyZW50XG5cdFx0XHRcdFx0XHRcdC8vIHRoaXM6IDxzcGFuIHN0eWxlPVwiY29sb3I6cmVkXCI+PGI+PHNwYW4gc3R5bGU9XCJjb2xvcjpyZWQ7IGZvbnQtc2l6ZToxMHB4XCI+dGV4dDwvc3Bhbj48L2I+PC9zcGFuPlxuXHRcdFx0XHRcdFx0XHQvLyB3aWxsIGJlY29tZTogPHNwYW4gc3R5bGU9XCJjb2xvcjpyZWRcIj48Yj48c3BhbiBzdHlsZT1cImZvbnQtc2l6ZToxMHB4XCI+dGV4dDwvc3Bhbj48L2I+PC9zcGFuPlxuXHRcdFx0XHRcdFx0XHRlYWNoKGRvbS5zZWxlY3QoZm9ybWF0LmlubGluZSwgbm9kZSksIGZ1bmN0aW9uKGNoaWxkKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKGlzQm9va21hcmtOb2RlKGNoaWxkKSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJlbW92ZUZvcm1hdChmb3JtYXQsIHZhcnMsIGNoaWxkLCBmb3JtYXQuZXhhY3QgPyBjaGlsZCA6IG51bGwpO1xuXHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0XHQvLyBSZW1vdmUgY2hpbGQgaWYgZGlyZWN0IHBhcmVudCBpcyBvZiBzYW1lIHR5cGVcblx0XHRcdFx0XHRcdGlmIChtYXRjaE5vZGUobm9kZS5wYXJlbnROb2RlLCBuYW1lLCB2YXJzKSkge1xuXHRcdFx0XHRcdFx0XHRkb20ucmVtb3ZlKG5vZGUsIDEpO1xuXHRcdFx0XHRcdFx0XHRub2RlID0gMDtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIFRSVUU7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdC8vIExvb2sgZm9yIHBhcmVudCB3aXRoIHNpbWlsYXIgc3R5bGUgZm9ybWF0XG5cdFx0XHRcdFx0XHRpZiAoZm9ybWF0Lm1lcmdlX3dpdGhfcGFyZW50cykge1xuXHRcdFx0XHRcdFx0XHRkb20uZ2V0UGFyZW50KG5vZGUucGFyZW50Tm9kZSwgZnVuY3Rpb24ocGFyZW50KSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKG1hdGNoTm9kZShwYXJlbnQsIG5hbWUsIHZhcnMpKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRkb20ucmVtb3ZlKG5vZGUsIDEpO1xuXHRcdFx0XHRcdFx0XHRcdFx0bm9kZSA9IDA7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gVFJVRTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHQvLyBNZXJnZSBuZXh0IGFuZCBwcmV2aW91cyBzaWJsaW5ncyBpZiB0aGV5IGFyZSBzaW1pbGFyIDxiPnRleHQ8L2I+PGI+dGV4dDwvYj4gYmVjb21lcyA8Yj50ZXh0dGV4dDwvYj5cblx0XHRcdFx0XHRcdGlmIChub2RlICYmIGZvcm1hdC5tZXJnZV9zaWJsaW5ncyAhPT0gZmFsc2UpIHtcblx0XHRcdFx0XHRcdFx0bm9kZSA9IG1lcmdlU2libGluZ3MoZ2V0Tm9uV2hpdGVTcGFjZVNpYmxpbmcobm9kZSksIG5vZGUpO1xuXHRcdFx0XHRcdFx0XHRub2RlID0gbWVyZ2VTaWJsaW5ncyhub2RlLCBnZXROb25XaGl0ZVNwYWNlU2libGluZyhub2RlLCBUUlVFKSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGdldENvbnRlbnRFZGl0YWJsZShzZWxlY3Rpb24uZ2V0Tm9kZSgpKSA9PT0gXCJmYWxzZVwiKSB7XG5cdFx0XHRcdG5vZGUgPSBzZWxlY3Rpb24uZ2V0Tm9kZSgpO1xuXHRcdFx0XHRmb3IgKHZhciBpID0gMCwgbCA9IGZvcm1hdExpc3QubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG5cdFx0XHRcdFx0aWYgKGZvcm1hdExpc3RbaV0uY2VGYWxzZU92ZXJyaWRlICYmIGRvbS5pcyhub2RlLCBmb3JtYXRMaXN0W2ldLnNlbGVjdG9yKSkge1xuXHRcdFx0XHRcdFx0c2V0RWxlbWVudEZvcm1hdChub2RlLCBmb3JtYXRMaXN0W2ldKTtcblx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdGlmIChmb3JtYXQpIHtcblx0XHRcdFx0aWYgKG5vZGUpIHtcblx0XHRcdFx0XHRpZiAobm9kZS5ub2RlVHlwZSkge1xuXHRcdFx0XHRcdFx0aWYgKCFhcHBseU5vZGVTdHlsZShmb3JtYXRMaXN0LCBub2RlKSkge1xuXHRcdFx0XHRcdFx0XHRybmcgPSBkb20uY3JlYXRlUm5nKCk7XG5cdFx0XHRcdFx0XHRcdHJuZy5zZXRTdGFydEJlZm9yZShub2RlKTtcblx0XHRcdFx0XHRcdFx0cm5nLnNldEVuZEFmdGVyKG5vZGUpO1xuXHRcdFx0XHRcdFx0XHRhcHBseVJuZ1N0eWxlKGV4cGFuZFJuZyhybmcsIGZvcm1hdExpc3QpLCBudWxsLCB0cnVlKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0YXBwbHlSbmdTdHlsZShub2RlLCBudWxsLCB0cnVlKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0aWYgKCFpc0NvbGxhcHNlZCB8fCAhZm9ybWF0LmlubGluZSB8fCBkb20uc2VsZWN0KCd0ZFtkYXRhLW1jZS1zZWxlY3RlZF0sdGhbZGF0YS1tY2Utc2VsZWN0ZWRdJykubGVuZ3RoKSB7XG5cdFx0XHRcdFx0XHQvLyBPYnRhaW4gc2VsZWN0aW9uIG5vZGUgYmVmb3JlIHNlbGVjdGlvbiBpcyB1bnNlbGVjdGVkIGJ5IGFwcGx5Um5nU3R5bGUoKVxuXHRcdFx0XHRcdFx0dmFyIGN1clNlbE5vZGUgPSBlZC5zZWxlY3Rpb24uZ2V0Tm9kZSgpO1xuXG5cdFx0XHRcdFx0XHQvLyBJZiB0aGUgZm9ybWF0cyBoYXZlIGEgZGVmYXVsdCBibG9jayBhbmQgd2UgY2FuJ3QgZmluZCBhIHBhcmVudCBibG9jayB0aGVuXG5cdFx0XHRcdFx0XHQvLyBzdGFydCB3cmFwcGluZyBpdCB3aXRoIGEgRElWIHRoaXMgaXMgZm9yIGZvcmNlZF9yb290X2Jsb2NrczogZmFsc2Vcblx0XHRcdFx0XHRcdC8vIEl0J3Mga2luZCBvZiBhIGhhY2sgYnV0IHBlb3BsZSBzaG91bGQgYmUgdXNpbmcgdGhlIGRlZmF1bHQgYmxvY2sgdHlwZSBQIHNpbmNlIGFsbCBkZXNrdG9wIGVkaXRvcnMgd29yayB0aGF0IHdheVxuXHRcdFx0XHRcdFx0aWYgKCFmb3JjZWRSb290QmxvY2sgJiYgZm9ybWF0TGlzdFswXS5kZWZhdWx0QmxvY2sgJiYgIWRvbS5nZXRQYXJlbnQoY3VyU2VsTm9kZSwgZG9tLmlzQmxvY2spKSB7XG5cdFx0XHRcdFx0XHRcdGFwcGx5KGZvcm1hdExpc3RbMF0uZGVmYXVsdEJsb2NrKTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0Ly8gQXBwbHkgZm9ybWF0dGluZyB0byBzZWxlY3Rpb25cblx0XHRcdFx0XHRcdGVkLnNlbGVjdGlvbi5zZXRSbmcoYWRqdXN0U2VsZWN0aW9uVG9WaXNpYmxlU2VsZWN0aW9uKCkpO1xuXHRcdFx0XHRcdFx0Ym9va21hcmsgPSBzZWxlY3Rpb24uZ2V0Qm9va21hcmsoKTtcblx0XHRcdFx0XHRcdGFwcGx5Um5nU3R5bGUoZXhwYW5kUm5nKHNlbGVjdGlvbi5nZXRSbmcoVFJVRSksIGZvcm1hdExpc3QpLCBib29rbWFyayk7XG5cblx0XHRcdFx0XHRcdC8vIENvbG9yZWQgbm9kZXMgc2hvdWxkIGJlIHVuZGVybGluZWQgc28gdGhhdCB0aGUgY29sb3Igb2YgdGhlIHVuZGVybGluZSBtYXRjaGVzIHRoZSB0ZXh0IGNvbG9yLlxuXHRcdFx0XHRcdFx0aWYgKGZvcm1hdC5zdHlsZXMgJiYgKGZvcm1hdC5zdHlsZXMuY29sb3IgfHwgZm9ybWF0LnN0eWxlcy50ZXh0RGVjb3JhdGlvbikpIHtcblx0XHRcdFx0XHRcdFx0d2FsayhjdXJTZWxOb2RlLCBwcm9jZXNzVW5kZXJsaW5lQW5kQ29sb3IsICdjaGlsZE5vZGVzJyk7XG5cdFx0XHRcdFx0XHRcdHByb2Nlc3NVbmRlcmxpbmVBbmRDb2xvcihjdXJTZWxOb2RlKTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0c2VsZWN0aW9uLm1vdmVUb0Jvb2ttYXJrKGJvb2ttYXJrKTtcblx0XHRcdFx0XHRcdG1vdmVTdGFydChzZWxlY3Rpb24uZ2V0Um5nKFRSVUUpKTtcblx0XHRcdFx0XHRcdGVkLm5vZGVDaGFuZ2VkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdHBlcmZvcm1DYXJldEFjdGlvbignYXBwbHknLCBuYW1lLCB2YXJzKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRIb29rcy5wb3N0UHJvY2VzcyhuYW1lLCBlZCk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0LyoqXG5cdFx0ICogUmVtb3ZlcyB0aGUgc3BlY2lmaWVkIGZvcm1hdCBmcm9tIHRoZSBjdXJyZW50IHNlbGVjdGlvbiBvciBzcGVjaWZpZWQgbm9kZS5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgcmVtb3ZlXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IG5hbWUgTmFtZSBvZiBmb3JtYXQgdG8gcmVtb3ZlLlxuXHRcdCAqIEBwYXJhbSB7T2JqZWN0fSB2YXJzIE9wdGlvbmFsIGxpc3Qgb2YgdmFyaWFibGVzIHRvIHJlcGxhY2Ugd2l0aGluIGZvcm1hdCBiZWZvcmUgcmVtb3ZpbmcgaXQuXG5cdFx0ICogQHBhcmFtIHtOb2RlL1JhbmdlfSBub2RlIE9wdGlvbmFsIG5vZGUgb3IgRE9NIHJhbmdlIHRvIHJlbW92ZSB0aGUgZm9ybWF0IGZyb20gZGVmYXVsdHMgdG8gY3VycmVudCBzZWxlY3Rpb24uXG5cdFx0ICovXG5cdFx0ZnVuY3Rpb24gcmVtb3ZlKG5hbWUsIHZhcnMsIG5vZGUsIHNpbWlsYXIpIHtcblx0XHRcdHZhciBmb3JtYXRMaXN0ID0gZ2V0KG5hbWUpLCBmb3JtYXQgPSBmb3JtYXRMaXN0WzBdLCBib29rbWFyaywgcm5nLCBjb250ZW50RWRpdGFibGUgPSB0cnVlO1xuXG5cdFx0XHQvLyBNZXJnZXMgdGhlIHN0eWxlcyBmb3IgZWFjaCBub2RlXG5cdFx0XHRmdW5jdGlvbiBwcm9jZXNzKG5vZGUpIHtcblx0XHRcdFx0dmFyIGNoaWxkcmVuLCBpLCBsLCBsYXN0Q29udGVudEVkaXRhYmxlLCBoYXNDb250ZW50RWRpdGFibGVTdGF0ZTtcblxuXHRcdFx0XHQvLyBOb2RlIGhhcyBhIGNvbnRlbnRFZGl0YWJsZSB2YWx1ZVxuXHRcdFx0XHRpZiAobm9kZS5ub2RlVHlwZSA9PT0gMSAmJiBnZXRDb250ZW50RWRpdGFibGUobm9kZSkpIHtcblx0XHRcdFx0XHRsYXN0Q29udGVudEVkaXRhYmxlID0gY29udGVudEVkaXRhYmxlO1xuXHRcdFx0XHRcdGNvbnRlbnRFZGl0YWJsZSA9IGdldENvbnRlbnRFZGl0YWJsZShub2RlKSA9PT0gXCJ0cnVlXCI7XG5cdFx0XHRcdFx0aGFzQ29udGVudEVkaXRhYmxlU3RhdGUgPSB0cnVlOyAvLyBXZSBkb24ndCB3YW50IHRvIHdyYXAgdGhlIGNvbnRhaW5lciBvbmx5IGl0J3MgY2hpbGRyZW5cblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIEdyYWIgdGhlIGNoaWxkcmVuIGZpcnN0IHNpbmNlIHRoZSBub2RlbGlzdCBtaWdodCBiZSBjaGFuZ2VkXG5cdFx0XHRcdGNoaWxkcmVuID0gZ3JlcChub2RlLmNoaWxkTm9kZXMpO1xuXG5cdFx0XHRcdC8vIFByb2Nlc3MgY3VycmVudCBub2RlXG5cdFx0XHRcdGlmIChjb250ZW50RWRpdGFibGUgJiYgIWhhc0NvbnRlbnRFZGl0YWJsZVN0YXRlKSB7XG5cdFx0XHRcdFx0Zm9yIChpID0gMCwgbCA9IGZvcm1hdExpc3QubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG5cdFx0XHRcdFx0XHRpZiAocmVtb3ZlRm9ybWF0KGZvcm1hdExpc3RbaV0sIHZhcnMsIG5vZGUsIG5vZGUpKSB7XG5cdFx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIFByb2Nlc3MgdGhlIGNoaWxkcmVuXG5cdFx0XHRcdGlmIChmb3JtYXQuZGVlcCkge1xuXHRcdFx0XHRcdGlmIChjaGlsZHJlbi5sZW5ndGgpIHtcblx0XHRcdFx0XHRcdGZvciAoaSA9IDAsIGwgPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBsOyBpKyspIHtcblx0XHRcdFx0XHRcdFx0cHJvY2VzcyhjaGlsZHJlbltpXSk7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGlmIChoYXNDb250ZW50RWRpdGFibGVTdGF0ZSkge1xuXHRcdFx0XHRcdFx0XHRjb250ZW50RWRpdGFibGUgPSBsYXN0Q29udGVudEVkaXRhYmxlOyAvLyBSZXN0b3JlIGxhc3QgY29udGVudEVkaXRhYmxlIHN0YXRlIGZyb20gc3RhY2tcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gZmluZEZvcm1hdFJvb3QoY29udGFpbmVyKSB7XG5cdFx0XHRcdHZhciBmb3JtYXRSb290O1xuXG5cdFx0XHRcdC8vIEZpbmQgZm9ybWF0IHJvb3Rcblx0XHRcdFx0ZWFjaChnZXRQYXJlbnRzKGNvbnRhaW5lci5wYXJlbnROb2RlKS5yZXZlcnNlKCksIGZ1bmN0aW9uKHBhcmVudCkge1xuXHRcdFx0XHRcdHZhciBmb3JtYXQ7XG5cblx0XHRcdFx0XHQvLyBGaW5kIGZvcm1hdCByb290IGVsZW1lbnRcblx0XHRcdFx0XHRpZiAoIWZvcm1hdFJvb3QgJiYgcGFyZW50LmlkICE9ICdfc3RhcnQnICYmIHBhcmVudC5pZCAhPSAnX2VuZCcpIHtcblx0XHRcdFx0XHRcdC8vIElzIHRoZSBub2RlIG1hdGNoaW5nIHRoZSBmb3JtYXQgd2UgYXJlIGxvb2tpbmcgZm9yXG5cdFx0XHRcdFx0XHRmb3JtYXQgPSBtYXRjaE5vZGUocGFyZW50LCBuYW1lLCB2YXJzLCBzaW1pbGFyKTtcblx0XHRcdFx0XHRcdGlmIChmb3JtYXQgJiYgZm9ybWF0LnNwbGl0ICE9PSBmYWxzZSkge1xuXHRcdFx0XHRcdFx0XHRmb3JtYXRSb290ID0gcGFyZW50O1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0cmV0dXJuIGZvcm1hdFJvb3Q7XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIHdyYXBBbmRTcGxpdChmb3JtYXRSb290LCBjb250YWluZXIsIHRhcmdldCwgc3BsaXQpIHtcblx0XHRcdFx0dmFyIHBhcmVudCwgY2xvbmUsIGxhc3RDbG9uZSwgZmlyc3RDbG9uZSwgaSwgZm9ybWF0Um9vdFBhcmVudDtcblxuXHRcdFx0XHQvLyBGb3JtYXQgcm9vdCBmb3VuZCB0aGVuIGNsb25lIGZvcm1hdHMgYW5kIHNwbGl0IGl0XG5cdFx0XHRcdGlmIChmb3JtYXRSb290KSB7XG5cdFx0XHRcdFx0Zm9ybWF0Um9vdFBhcmVudCA9IGZvcm1hdFJvb3QucGFyZW50Tm9kZTtcblxuXHRcdFx0XHRcdGZvciAocGFyZW50ID0gY29udGFpbmVyLnBhcmVudE5vZGU7IHBhcmVudCAmJiBwYXJlbnQgIT0gZm9ybWF0Um9vdFBhcmVudDsgcGFyZW50ID0gcGFyZW50LnBhcmVudE5vZGUpIHtcblx0XHRcdFx0XHRcdGNsb25lID0gZG9tLmNsb25lKHBhcmVudCwgRkFMU0UpO1xuXG5cdFx0XHRcdFx0XHRmb3IgKGkgPSAwOyBpIDwgZm9ybWF0TGlzdC5sZW5ndGg7IGkrKykge1xuXHRcdFx0XHRcdFx0XHRpZiAocmVtb3ZlRm9ybWF0KGZvcm1hdExpc3RbaV0sIHZhcnMsIGNsb25lLCBjbG9uZSkpIHtcblx0XHRcdFx0XHRcdFx0XHRjbG9uZSA9IDA7XG5cdFx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0Ly8gQnVpbGQgd3JhcHBlciBub2RlXG5cdFx0XHRcdFx0XHRpZiAoY2xvbmUpIHtcblx0XHRcdFx0XHRcdFx0aWYgKGxhc3RDbG9uZSkge1xuXHRcdFx0XHRcdFx0XHRcdGNsb25lLmFwcGVuZENoaWxkKGxhc3RDbG9uZSk7XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRpZiAoIWZpcnN0Q2xvbmUpIHtcblx0XHRcdFx0XHRcdFx0XHRmaXJzdENsb25lID0gY2xvbmU7XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRsYXN0Q2xvbmUgPSBjbG9uZTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHQvLyBOZXZlciBzcGxpdCBibG9jayBlbGVtZW50cyBpZiB0aGUgZm9ybWF0IGlzIG1peGVkXG5cdFx0XHRcdFx0aWYgKHNwbGl0ICYmICghZm9ybWF0Lm1peGVkIHx8ICFpc0Jsb2NrKGZvcm1hdFJvb3QpKSkge1xuXHRcdFx0XHRcdFx0Y29udGFpbmVyID0gZG9tLnNwbGl0KGZvcm1hdFJvb3QsIGNvbnRhaW5lcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Ly8gV3JhcCBjb250YWluZXIgaW4gY2xvbmVkIGZvcm1hdHNcblx0XHRcdFx0XHRpZiAobGFzdENsb25lKSB7XG5cdFx0XHRcdFx0XHR0YXJnZXQucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUobGFzdENsb25lLCB0YXJnZXQpO1xuXHRcdFx0XHRcdFx0Zmlyc3RDbG9uZS5hcHBlbmRDaGlsZCh0YXJnZXQpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBjb250YWluZXI7XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIHNwbGl0VG9Gb3JtYXRSb290KGNvbnRhaW5lcikge1xuXHRcdFx0XHRyZXR1cm4gd3JhcEFuZFNwbGl0KGZpbmRGb3JtYXRSb290KGNvbnRhaW5lciksIGNvbnRhaW5lciwgY29udGFpbmVyLCB0cnVlKTtcblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gdW53cmFwKHN0YXJ0KSB7XG5cdFx0XHRcdHZhciBub2RlID0gZG9tLmdldChzdGFydCA/ICdfc3RhcnQnIDogJ19lbmQnKSxcblx0XHRcdFx0XHRvdXQgPSBub2RlW3N0YXJ0ID8gJ2ZpcnN0Q2hpbGQnIDogJ2xhc3RDaGlsZCddO1xuXG5cdFx0XHRcdC8vIElmIHRoZSBlbmQgaXMgcGxhY2VkIHdpdGhpbiB0aGUgc3RhcnQgdGhlIHJlc3VsdCB3aWxsIGJlIHJlbW92ZWRcblx0XHRcdFx0Ly8gU28gdGhpcyBjaGVja3MgaWYgdGhlIG91dCBub2RlIGlzIGEgYm9va21hcmsgbm9kZSBpZiBpdCBpcyBpdFxuXHRcdFx0XHQvLyBjaGVja3MgZm9yIGFub3RoZXIgbW9yZSBzdWl0YWJsZSBub2RlXG5cdFx0XHRcdGlmIChpc0Jvb2ttYXJrTm9kZShvdXQpKSB7XG5cdFx0XHRcdFx0b3V0ID0gb3V0W3N0YXJ0ID8gJ2ZpcnN0Q2hpbGQnIDogJ2xhc3RDaGlsZCddO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gU2luY2UgZG9tLnJlbW92ZSByZW1vdmVzIGVtcHR5IHRleHQgbm9kZXMgdGhlbiB3ZSBuZWVkIHRvIHRyeSB0byBmaW5kIGEgYmV0dGVyIG5vZGVcblx0XHRcdFx0aWYgKG91dC5ub2RlVHlwZSA9PSAzICYmIG91dC5kYXRhLmxlbmd0aCA9PT0gMCkge1xuXHRcdFx0XHRcdG91dCA9IHN0YXJ0ID8gbm9kZS5wcmV2aW91c1NpYmxpbmcgfHwgbm9kZS5uZXh0U2libGluZyA6IG5vZGUubmV4dFNpYmxpbmcgfHwgbm9kZS5wcmV2aW91c1NpYmxpbmc7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRkb20ucmVtb3ZlKG5vZGUsIHRydWUpO1xuXG5cdFx0XHRcdHJldHVybiBvdXQ7XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIHJlbW92ZVJuZ1N0eWxlKHJuZykge1xuXHRcdFx0XHR2YXIgc3RhcnRDb250YWluZXIsIGVuZENvbnRhaW5lcjtcblx0XHRcdFx0dmFyIGNvbW1vbkFuY2VzdG9yQ29udGFpbmVyID0gcm5nLmNvbW1vbkFuY2VzdG9yQ29udGFpbmVyO1xuXG5cdFx0XHRcdHJuZyA9IGV4cGFuZFJuZyhybmcsIGZvcm1hdExpc3QsIFRSVUUpO1xuXG5cdFx0XHRcdGlmIChmb3JtYXQuc3BsaXQpIHtcblx0XHRcdFx0XHRzdGFydENvbnRhaW5lciA9IGdldENvbnRhaW5lcihybmcsIFRSVUUpO1xuXHRcdFx0XHRcdGVuZENvbnRhaW5lciA9IGdldENvbnRhaW5lcihybmcpO1xuXG5cdFx0XHRcdFx0aWYgKHN0YXJ0Q29udGFpbmVyICE9IGVuZENvbnRhaW5lcikge1xuXHRcdFx0XHRcdFx0Ly8gV2ViS2l0IHdpbGwgcmVuZGVyIHRoZSB0YWJsZSBpbmNvcnJlY3RseSBpZiB3ZSB3cmFwIGEgVEggb3IgVEQgaW4gYSBTUEFOXG5cdFx0XHRcdFx0XHQvLyBzbyBsZXQncyBzZWUgaWYgd2UgY2FuIHVzZSB0aGUgZmlyc3QgY2hpbGQgaW5zdGVhZFxuXHRcdFx0XHRcdFx0Ly8gVGhpcyB3aWxsIGhhcHBlbiBpZiB5b3UgdHJpcGxlIGNsaWNrIGEgdGFibGUgY2VsbCBhbmQgdXNlIHJlbW92ZSBmb3JtYXR0aW5nXG5cdFx0XHRcdFx0XHRpZiAoL14oVFJ8VEh8VEQpJC8udGVzdChzdGFydENvbnRhaW5lci5ub2RlTmFtZSkgJiYgc3RhcnRDb250YWluZXIuZmlyc3RDaGlsZCkge1xuXHRcdFx0XHRcdFx0XHRpZiAoc3RhcnRDb250YWluZXIubm9kZU5hbWUgPT0gXCJUUlwiKSB7XG5cdFx0XHRcdFx0XHRcdFx0c3RhcnRDb250YWluZXIgPSBzdGFydENvbnRhaW5lci5maXJzdENoaWxkLmZpcnN0Q2hpbGQgfHwgc3RhcnRDb250YWluZXI7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0c3RhcnRDb250YWluZXIgPSBzdGFydENvbnRhaW5lci5maXJzdENoaWxkIHx8IHN0YXJ0Q29udGFpbmVyO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdC8vIFRyeSB0byBhZGp1c3QgZW5kQ29udGFpbmVyIGFzIHdlbGwgaWYgY2VsbHMgb24gdGhlIHNhbWUgcm93IHdlcmUgc2VsZWN0ZWQgLSBidWcgIzY0MTBcblx0XHRcdFx0XHRcdGlmIChjb21tb25BbmNlc3RvckNvbnRhaW5lciAmJlxuXHRcdFx0XHRcdFx0XHQvXlQoSEVBRHxCT0RZfEZPT1R8UikkLy50ZXN0KGNvbW1vbkFuY2VzdG9yQ29udGFpbmVyLm5vZGVOYW1lKSAmJlxuXHRcdFx0XHRcdFx0XHRpc1RhYmxlQ2VsbChlbmRDb250YWluZXIpICYmIGVuZENvbnRhaW5lci5maXJzdENoaWxkKSB7XG5cdFx0XHRcdFx0XHRcdGVuZENvbnRhaW5lciA9IGVuZENvbnRhaW5lci5maXJzdENoaWxkIHx8IGVuZENvbnRhaW5lcjtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0aWYgKGRvbS5pc0NoaWxkT2Yoc3RhcnRDb250YWluZXIsIGVuZENvbnRhaW5lcikgJiYgIWlzQmxvY2soZW5kQ29udGFpbmVyKSAmJlxuXHRcdFx0XHRcdFx0XHQhaXNUYWJsZUNlbGwoc3RhcnRDb250YWluZXIpICYmICFpc1RhYmxlQ2VsbChlbmRDb250YWluZXIpKSB7XG5cdFx0XHRcdFx0XHRcdHN0YXJ0Q29udGFpbmVyID0gd3JhcChzdGFydENvbnRhaW5lciwgJ3NwYW4nLCB7aWQ6ICdfc3RhcnQnLCAnZGF0YS1tY2UtdHlwZSc6ICdib29rbWFyayd9KTtcblx0XHRcdFx0XHRcdFx0c3BsaXRUb0Zvcm1hdFJvb3Qoc3RhcnRDb250YWluZXIpO1xuXHRcdFx0XHRcdFx0XHRzdGFydENvbnRhaW5lciA9IHVud3JhcChUUlVFKTtcblx0XHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHQvLyBXcmFwIHN0YXJ0L2VuZCBub2RlcyBpbiBzcGFuIGVsZW1lbnQgc2luY2UgdGhlc2UgbWlnaHQgYmUgY2xvbmVkL21vdmVkXG5cdFx0XHRcdFx0XHRzdGFydENvbnRhaW5lciA9IHdyYXAoc3RhcnRDb250YWluZXIsICdzcGFuJywge2lkOiAnX3N0YXJ0JywgJ2RhdGEtbWNlLXR5cGUnOiAnYm9va21hcmsnfSk7XG5cdFx0XHRcdFx0XHRlbmRDb250YWluZXIgPSB3cmFwKGVuZENvbnRhaW5lciwgJ3NwYW4nLCB7aWQ6ICdfZW5kJywgJ2RhdGEtbWNlLXR5cGUnOiAnYm9va21hcmsnfSk7XG5cblx0XHRcdFx0XHRcdC8vIFNwbGl0IHN0YXJ0L2VuZFxuXHRcdFx0XHRcdFx0c3BsaXRUb0Zvcm1hdFJvb3Qoc3RhcnRDb250YWluZXIpO1xuXHRcdFx0XHRcdFx0c3BsaXRUb0Zvcm1hdFJvb3QoZW5kQ29udGFpbmVyKTtcblxuXHRcdFx0XHRcdFx0Ly8gVW53cmFwIHN0YXJ0L2VuZCB0byBnZXQgcmVhbCBlbGVtZW50cyBhZ2FpblxuXHRcdFx0XHRcdFx0c3RhcnRDb250YWluZXIgPSB1bndyYXAoVFJVRSk7XG5cdFx0XHRcdFx0XHRlbmRDb250YWluZXIgPSB1bndyYXAoKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0c3RhcnRDb250YWluZXIgPSBlbmRDb250YWluZXIgPSBzcGxpdFRvRm9ybWF0Um9vdChzdGFydENvbnRhaW5lcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Ly8gVXBkYXRlIHJhbmdlIHBvc2l0aW9ucyBzaW5jZSB0aGV5IG1pZ2h0IGhhdmUgY2hhbmdlZCBhZnRlciB0aGUgc3BsaXQgb3BlcmF0aW9uc1xuXHRcdFx0XHRcdHJuZy5zdGFydENvbnRhaW5lciA9IHN0YXJ0Q29udGFpbmVyLnBhcmVudE5vZGUgPyBzdGFydENvbnRhaW5lci5wYXJlbnROb2RlIDogc3RhcnRDb250YWluZXI7XG5cdFx0XHRcdFx0cm5nLnN0YXJ0T2Zmc2V0ID0gbm9kZUluZGV4KHN0YXJ0Q29udGFpbmVyKTtcblx0XHRcdFx0XHRybmcuZW5kQ29udGFpbmVyID0gZW5kQ29udGFpbmVyLnBhcmVudE5vZGUgPyBlbmRDb250YWluZXIucGFyZW50Tm9kZSA6IGVuZENvbnRhaW5lcjtcblx0XHRcdFx0XHRybmcuZW5kT2Zmc2V0ID0gbm9kZUluZGV4KGVuZENvbnRhaW5lcikgKyAxO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gUmVtb3ZlIGl0ZW1zIGJldHdlZW4gc3RhcnQvZW5kXG5cdFx0XHRcdHJhbmdlVXRpbHMud2FsayhybmcsIGZ1bmN0aW9uKG5vZGVzKSB7XG5cdFx0XHRcdFx0ZWFjaChub2RlcywgZnVuY3Rpb24obm9kZSkge1xuXHRcdFx0XHRcdFx0cHJvY2Vzcyhub2RlKTtcblxuXHRcdFx0XHRcdFx0Ly8gUmVtb3ZlIHBhcmVudCBzcGFuIGlmIGl0IG9ubHkgY29udGFpbnMgdGV4dC1kZWNvcmF0aW9uOiB1bmRlcmxpbmUsIHlldCBhIHBhcmVudCBub2RlIGlzIGFsc28gdW5kZXJsaW5lZC5cblx0XHRcdFx0XHRcdGlmIChub2RlLm5vZGVUeXBlID09PSAxICYmIGVkLmRvbS5nZXRTdHlsZShub2RlLCAndGV4dC1kZWNvcmF0aW9uJykgPT09ICd1bmRlcmxpbmUnICYmXG5cdFx0XHRcdFx0XHRcdG5vZGUucGFyZW50Tm9kZSAmJiBnZXRUZXh0RGVjb3JhdGlvbihub2RlLnBhcmVudE5vZGUpID09PSAndW5kZXJsaW5lJykge1xuXHRcdFx0XHRcdFx0XHRyZW1vdmVGb3JtYXQoe1xuXHRcdFx0XHRcdFx0XHRcdCdkZWVwJzogZmFsc2UsXG5cdFx0XHRcdFx0XHRcdFx0J2V4YWN0JzogdHJ1ZSxcblx0XHRcdFx0XHRcdFx0XHQnaW5saW5lJzogJ3NwYW4nLFxuXHRcdFx0XHRcdFx0XHRcdCdzdHlsZXMnOiB7XG5cdFx0XHRcdFx0XHRcdFx0XHQndGV4dERlY29yYXRpb24nOiAndW5kZXJsaW5lJ1xuXHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0fSwgbnVsbCwgbm9kZSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBIYW5kbGUgbm9kZVxuXHRcdFx0aWYgKG5vZGUpIHtcblx0XHRcdFx0aWYgKG5vZGUubm9kZVR5cGUpIHtcblx0XHRcdFx0XHRybmcgPSBkb20uY3JlYXRlUm5nKCk7XG5cdFx0XHRcdFx0cm5nLnNldFN0YXJ0QmVmb3JlKG5vZGUpO1xuXHRcdFx0XHRcdHJuZy5zZXRFbmRBZnRlcihub2RlKTtcblx0XHRcdFx0XHRyZW1vdmVSbmdTdHlsZShybmcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHJlbW92ZVJuZ1N0eWxlKG5vZGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoZ2V0Q29udGVudEVkaXRhYmxlKHNlbGVjdGlvbi5nZXROb2RlKCkpID09PSBcImZhbHNlXCIpIHtcblx0XHRcdFx0bm9kZSA9IHNlbGVjdGlvbi5nZXROb2RlKCk7XG5cdFx0XHRcdGZvciAodmFyIGkgPSAwLCBsID0gZm9ybWF0TGlzdC5sZW5ndGg7IGkgPCBsOyBpKyspIHtcblx0XHRcdFx0XHRpZiAoZm9ybWF0TGlzdFtpXS5jZUZhbHNlT3ZlcnJpZGUpIHtcblx0XHRcdFx0XHRcdGlmIChyZW1vdmVGb3JtYXQoZm9ybWF0TGlzdFtpXSwgdmFycywgbm9kZSwgbm9kZSkpIHtcblx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoIXNlbGVjdGlvbi5pc0NvbGxhcHNlZCgpIHx8ICFmb3JtYXQuaW5saW5lIHx8IGRvbS5zZWxlY3QoJ3RkW2RhdGEtbWNlLXNlbGVjdGVkXSx0aFtkYXRhLW1jZS1zZWxlY3RlZF0nKS5sZW5ndGgpIHtcblx0XHRcdFx0Ym9va21hcmsgPSBzZWxlY3Rpb24uZ2V0Qm9va21hcmsoKTtcblx0XHRcdFx0cmVtb3ZlUm5nU3R5bGUoc2VsZWN0aW9uLmdldFJuZyhUUlVFKSk7XG5cdFx0XHRcdHNlbGVjdGlvbi5tb3ZlVG9Cb29rbWFyayhib29rbWFyayk7XG5cblx0XHRcdFx0Ly8gQ2hlY2sgaWYgc3RhcnQgZWxlbWVudCBzdGlsbCBoYXMgZm9ybWF0dGluZyB0aGVuIHdlIGFyZSBhdDogXCI8Yj50ZXh0fDwvYj50ZXh0XCJcblx0XHRcdFx0Ly8gYW5kIG5lZWQgdG8gbW92ZSB0aGUgc3RhcnQgaW50byB0aGUgbmV4dCB0ZXh0IG5vZGVcblx0XHRcdFx0aWYgKGZvcm1hdC5pbmxpbmUgJiYgbWF0Y2gobmFtZSwgdmFycywgc2VsZWN0aW9uLmdldFN0YXJ0KCkpKSB7XG5cdFx0XHRcdFx0bW92ZVN0YXJ0KHNlbGVjdGlvbi5nZXRSbmcodHJ1ZSkpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0ZWQubm9kZUNoYW5nZWQoKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHBlcmZvcm1DYXJldEFjdGlvbigncmVtb3ZlJywgbmFtZSwgdmFycywgc2ltaWxhcik7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0LyoqXG5cdFx0ICogVG9nZ2xlcyB0aGUgc3BlY2lmaWVkIGZvcm1hdCBvbi9vZmYuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHRvZ2dsZVxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIE5hbWUgb2YgZm9ybWF0IHRvIGFwcGx5L3JlbW92ZS5cblx0XHQgKiBAcGFyYW0ge09iamVjdH0gdmFycyBPcHRpb25hbCBsaXN0IG9mIHZhcmlhYmxlcyB0byByZXBsYWNlIHdpdGhpbiBmb3JtYXQgYmVmb3JlIGFwcGx5aW5nL3JlbW92aW5nIGl0LlxuXHRcdCAqIEBwYXJhbSB7Tm9kZX0gbm9kZSBPcHRpb25hbCBub2RlIHRvIGFwcGx5IHRoZSBmb3JtYXQgdG8gb3IgcmVtb3ZlIGZyb20uIERlZmF1bHRzIHRvIGN1cnJlbnQgc2VsZWN0aW9uLlxuXHRcdCAqL1xuXHRcdGZ1bmN0aW9uIHRvZ2dsZShuYW1lLCB2YXJzLCBub2RlKSB7XG5cdFx0XHR2YXIgZm10ID0gZ2V0KG5hbWUpO1xuXG5cdFx0XHRpZiAobWF0Y2gobmFtZSwgdmFycywgbm9kZSkgJiYgKCEoJ3RvZ2dsZScgaW4gZm10WzBdKSB8fCBmbXRbMF0udG9nZ2xlKSkge1xuXHRcdFx0XHRyZW1vdmUobmFtZSwgdmFycywgbm9kZSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRhcHBseShuYW1lLCB2YXJzLCBub2RlKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHQvKipcblx0XHQgKiBSZXR1cm4gdHJ1ZS9mYWxzZSBpZiB0aGUgc3BlY2lmaWVkIG5vZGUgaGFzIHRoZSBzcGVjaWZpZWQgZm9ybWF0LlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBtYXRjaE5vZGVcblx0XHQgKiBAcGFyYW0ge05vZGV9IG5vZGUgTm9kZSB0byBjaGVjayB0aGUgZm9ybWF0IG9uLlxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIEZvcm1hdCBuYW1lIHRvIGNoZWNrLlxuXHRcdCAqIEBwYXJhbSB7T2JqZWN0fSB2YXJzIE9wdGlvbmFsIGxpc3Qgb2YgdmFyaWFibGVzIHRvIHJlcGxhY2UgYmVmb3JlIGNoZWNraW5nIGl0LlxuXHRcdCAqIEBwYXJhbSB7Qm9vbGVhbn0gc2ltaWxhciBNYXRjaCBmb3JtYXQgdGhhdCBoYXMgc2ltaWxhciBwcm9wZXJ0aWVzLlxuXHRcdCAqIEByZXR1cm4ge09iamVjdH0gUmV0dXJucyB0aGUgZm9ybWF0IG9iamVjdCBpdCBtYXRjaGVzIG9yIHVuZGVmaW5lZCBpZiBpdCBkb2Vzbid0IG1hdGNoLlxuXHRcdCAqL1xuXHRcdGZ1bmN0aW9uIG1hdGNoTm9kZShub2RlLCBuYW1lLCB2YXJzLCBzaW1pbGFyKSB7XG5cdFx0XHR2YXIgZm9ybWF0TGlzdCA9IGdldChuYW1lKSwgZm9ybWF0LCBpLCBjbGFzc2VzO1xuXG5cdFx0XHRmdW5jdGlvbiBtYXRjaEl0ZW1zKG5vZGUsIGZvcm1hdCwgaXRlbV9uYW1lKSB7XG5cdFx0XHRcdHZhciBrZXksIHZhbHVlLCBpdGVtcyA9IGZvcm1hdFtpdGVtX25hbWVdLCBpO1xuXG5cdFx0XHRcdC8vIEN1c3RvbSBtYXRjaFxuXHRcdFx0XHRpZiAoZm9ybWF0Lm9ubWF0Y2gpIHtcblx0XHRcdFx0XHRyZXR1cm4gZm9ybWF0Lm9ubWF0Y2gobm9kZSwgZm9ybWF0LCBpdGVtX25hbWUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gQ2hlY2sgYWxsIGl0ZW1zXG5cdFx0XHRcdGlmIChpdGVtcykge1xuXHRcdFx0XHRcdC8vIE5vbiBpbmRleGVkIG9iamVjdFxuXHRcdFx0XHRcdGlmIChpdGVtcy5sZW5ndGggPT09IHVuZGVmKSB7XG5cdFx0XHRcdFx0XHRmb3IgKGtleSBpbiBpdGVtcykge1xuXHRcdFx0XHRcdFx0XHRpZiAoaXRlbXMuaGFzT3duUHJvcGVydHkoa2V5KSkge1xuXHRcdFx0XHRcdFx0XHRcdGlmIChpdGVtX25hbWUgPT09ICdhdHRyaWJ1dGVzJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0dmFsdWUgPSBkb20uZ2V0QXR0cmliKG5vZGUsIGtleSk7XG5cdFx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRcdHZhbHVlID0gZ2V0U3R5bGUobm9kZSwga2V5KTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRpZiAoc2ltaWxhciAmJiAhdmFsdWUgJiYgIWZvcm1hdC5leGFjdCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdGlmICgoIXNpbWlsYXIgfHwgZm9ybWF0LmV4YWN0KSAmJiAhaXNFcSh2YWx1ZSwgbm9ybWFsaXplU3R5bGVWYWx1ZShyZXBsYWNlVmFycyhpdGVtc1trZXldLCB2YXJzKSwga2V5KSkpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0Ly8gT25seSBvbmUgbWF0Y2ggbmVlZGVkIGZvciBpbmRleGVkIGFycmF5c1xuXHRcdFx0XHRcdFx0Zm9yIChpID0gMDsgaSA8IGl0ZW1zLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRcdFx0XHRcdGlmIChpdGVtX25hbWUgPT09ICdhdHRyaWJ1dGVzJyA/IGRvbS5nZXRBdHRyaWIobm9kZSwgaXRlbXNbaV0pIDogZ2V0U3R5bGUobm9kZSwgaXRlbXNbaV0pKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIGZvcm1hdDtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBmb3JtYXQ7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChmb3JtYXRMaXN0ICYmIG5vZGUpIHtcblx0XHRcdFx0Ly8gQ2hlY2sgZWFjaCBmb3JtYXQgaW4gbGlzdFxuXHRcdFx0XHRmb3IgKGkgPSAwOyBpIDwgZm9ybWF0TGlzdC5sZW5ndGg7IGkrKykge1xuXHRcdFx0XHRcdGZvcm1hdCA9IGZvcm1hdExpc3RbaV07XG5cblx0XHRcdFx0XHQvLyBOYW1lIG5hbWUsIGF0dHJpYnV0ZXMsIHN0eWxlcyBhbmQgY2xhc3Nlc1xuXHRcdFx0XHRcdGlmIChtYXRjaE5hbWUobm9kZSwgZm9ybWF0KSAmJiBtYXRjaEl0ZW1zKG5vZGUsIGZvcm1hdCwgJ2F0dHJpYnV0ZXMnKSAmJiBtYXRjaEl0ZW1zKG5vZGUsIGZvcm1hdCwgJ3N0eWxlcycpKSB7XG5cdFx0XHRcdFx0XHQvLyBNYXRjaCBjbGFzc2VzXG5cdFx0XHRcdFx0XHRpZiAoKGNsYXNzZXMgPSBmb3JtYXQuY2xhc3NlcykpIHtcblx0XHRcdFx0XHRcdFx0Zm9yIChpID0gMDsgaSA8IGNsYXNzZXMubGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAoIWRvbS5oYXNDbGFzcyhub2RlLCBjbGFzc2VzW2ldKSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gZm9ybWF0O1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8qKlxuXHRcdCAqIE1hdGNoZXMgdGhlIGN1cnJlbnQgc2VsZWN0aW9uIG9yIHNwZWNpZmllZCBub2RlIGFnYWluc3QgdGhlIHNwZWNpZmllZCBmb3JtYXQgbmFtZS5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgbWF0Y2hcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSBOYW1lIG9mIGZvcm1hdCB0byBtYXRjaC5cblx0XHQgKiBAcGFyYW0ge09iamVjdH0gdmFycyBPcHRpb25hbCBsaXN0IG9mIHZhcmlhYmxlcyB0byByZXBsYWNlIGJlZm9yZSBjaGVja2luZyBpdC5cblx0XHQgKiBAcGFyYW0ge05vZGV9IG5vZGUgT3B0aW9uYWwgbm9kZSB0byBjaGVjay5cblx0XHQgKiBAcmV0dXJuIHtib29sZWFufSB0cnVlL2ZhbHNlIGlmIHRoZSBzcGVjaWZpZWQgc2VsZWN0aW9uL25vZGUgbWF0Y2hlcyB0aGUgZm9ybWF0LlxuXHRcdCAqL1xuXHRcdGZ1bmN0aW9uIG1hdGNoKG5hbWUsIHZhcnMsIG5vZGUpIHtcblx0XHRcdHZhciBzdGFydE5vZGU7XG5cblx0XHRcdGZ1bmN0aW9uIG1hdGNoUGFyZW50cyhub2RlKSB7XG5cdFx0XHRcdHZhciByb290ID0gZG9tLmdldFJvb3QoKTtcblxuXHRcdFx0XHRpZiAobm9kZSA9PT0gcm9vdCkge1xuXHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIEZpbmQgZmlyc3Qgbm9kZSB3aXRoIHNpbWlsYXIgZm9ybWF0IHNldHRpbmdzXG5cdFx0XHRcdG5vZGUgPSBkb20uZ2V0UGFyZW50KG5vZGUsIGZ1bmN0aW9uKG5vZGUpIHtcblx0XHRcdFx0XHRpZiAobWF0Y2hlc1VuSW5oZXJpdGVkRm9ybWF0U2VsZWN0b3Iobm9kZSwgbmFtZSkpIHtcblx0XHRcdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBub2RlLnBhcmVudE5vZGUgPT09IHJvb3QgfHwgISFtYXRjaE5vZGUobm9kZSwgbmFtZSwgdmFycywgdHJ1ZSk7XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdC8vIERvIGFuIGV4YWN0IGNoZWNrIG9uIHRoZSBzaW1pbGFyIGZvcm1hdCBlbGVtZW50XG5cdFx0XHRcdHJldHVybiBtYXRjaE5vZGUobm9kZSwgbmFtZSwgdmFycyk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIENoZWNrIHNwZWNpZmllZCBub2RlXG5cdFx0XHRpZiAobm9kZSkge1xuXHRcdFx0XHRyZXR1cm4gbWF0Y2hQYXJlbnRzKG5vZGUpO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBDaGVjayBzZWxlY3RlZCBub2RlXG5cdFx0XHRub2RlID0gc2VsZWN0aW9uLmdldE5vZGUoKTtcblx0XHRcdGlmIChtYXRjaFBhcmVudHMobm9kZSkpIHtcblx0XHRcdFx0cmV0dXJuIFRSVUU7XG5cdFx0XHR9XG5cblx0XHRcdC8vIENoZWNrIHN0YXJ0IG5vZGUgaWYgaXQncyBkaWZmZXJlbnRcblx0XHRcdHN0YXJ0Tm9kZSA9IHNlbGVjdGlvbi5nZXRTdGFydCgpO1xuXHRcdFx0aWYgKHN0YXJ0Tm9kZSAhPSBub2RlKSB7XG5cdFx0XHRcdGlmIChtYXRjaFBhcmVudHMoc3RhcnROb2RlKSkge1xuXHRcdFx0XHRcdHJldHVybiBUUlVFO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBGQUxTRTtcblx0XHR9XG5cblx0XHQvKipcblx0XHQgKiBNYXRjaGVzIHRoZSBjdXJyZW50IHNlbGVjdGlvbiBhZ2FpbnN0IHRoZSBhcnJheSBvZiBmb3JtYXRzIGFuZCByZXR1cm5zIGEgbmV3IGFycmF5IHdpdGggbWF0Y2hpbmcgZm9ybWF0cy5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgbWF0Y2hBbGxcblx0XHQgKiBAcGFyYW0ge0FycmF5fSBuYW1lcyBOYW1lIG9mIGZvcm1hdCB0byBtYXRjaC5cblx0XHQgKiBAcGFyYW0ge09iamVjdH0gdmFycyBPcHRpb25hbCBsaXN0IG9mIHZhcmlhYmxlcyB0byByZXBsYWNlIGJlZm9yZSBjaGVja2luZyBpdC5cblx0XHQgKiBAcmV0dXJuIHtBcnJheX0gQXJyYXkgd2l0aCBtYXRjaGVkIGZvcm1hdHMuXG5cdFx0ICovXG5cdFx0ZnVuY3Rpb24gbWF0Y2hBbGwobmFtZXMsIHZhcnMpIHtcblx0XHRcdHZhciBzdGFydEVsZW1lbnQsIG1hdGNoZWRGb3JtYXROYW1lcyA9IFtdLCBjaGVja2VkTWFwID0ge307XG5cblx0XHRcdC8vIENoZWNrIHN0YXJ0IG9mIHNlbGVjdGlvbiBmb3IgZm9ybWF0c1xuXHRcdFx0c3RhcnRFbGVtZW50ID0gc2VsZWN0aW9uLmdldFN0YXJ0KCk7XG5cdFx0XHRkb20uZ2V0UGFyZW50KHN0YXJ0RWxlbWVudCwgZnVuY3Rpb24obm9kZSkge1xuXHRcdFx0XHR2YXIgaSwgbmFtZTtcblxuXHRcdFx0XHRmb3IgKGkgPSAwOyBpIDwgbmFtZXMubGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0XHRuYW1lID0gbmFtZXNbaV07XG5cblx0XHRcdFx0XHRpZiAoIWNoZWNrZWRNYXBbbmFtZV0gJiYgbWF0Y2hOb2RlKG5vZGUsIG5hbWUsIHZhcnMpKSB7XG5cdFx0XHRcdFx0XHRjaGVja2VkTWFwW25hbWVdID0gdHJ1ZTtcblx0XHRcdFx0XHRcdG1hdGNoZWRGb3JtYXROYW1lcy5wdXNoKG5hbWUpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fSwgZG9tLmdldFJvb3QoKSk7XG5cblx0XHRcdHJldHVybiBtYXRjaGVkRm9ybWF0TmFtZXM7XG5cdFx0fVxuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyB0cnVlL2ZhbHNlIGlmIHRoZSBzcGVjaWZpZWQgZm9ybWF0IGNhbiBiZSBhcHBsaWVkIHRvIHRoZSBjdXJyZW50IHNlbGVjdGlvbiBvciBub3QuIEl0XG5cdFx0ICogd2lsbCBjdXJyZW50bHkgb25seSBjaGVjayB0aGUgc3RhdGUgZm9yIHNlbGVjdG9yIGZvcm1hdHMsIGl0IHJldHVybnMgdHJ1ZSBvbiBhbGwgb3RoZXIgZm9ybWF0IHR5cGVzLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBjYW5BcHBseVxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIE5hbWUgb2YgZm9ybWF0IHRvIGNoZWNrLlxuXHRcdCAqIEByZXR1cm4ge2Jvb2xlYW59IHRydWUvZmFsc2UgaWYgdGhlIHNwZWNpZmllZCBmb3JtYXQgY2FuIGJlIGFwcGxpZWQgdG8gdGhlIGN1cnJlbnQgc2VsZWN0aW9uL25vZGUuXG5cdFx0ICovXG5cdFx0ZnVuY3Rpb24gY2FuQXBwbHkobmFtZSkge1xuXHRcdFx0dmFyIGZvcm1hdExpc3QgPSBnZXQobmFtZSksIHN0YXJ0Tm9kZSwgcGFyZW50cywgaSwgeCwgc2VsZWN0b3I7XG5cblx0XHRcdGlmIChmb3JtYXRMaXN0KSB7XG5cdFx0XHRcdHN0YXJ0Tm9kZSA9IHNlbGVjdGlvbi5nZXRTdGFydCgpO1xuXHRcdFx0XHRwYXJlbnRzID0gZ2V0UGFyZW50cyhzdGFydE5vZGUpO1xuXG5cdFx0XHRcdGZvciAoeCA9IGZvcm1hdExpc3QubGVuZ3RoIC0gMTsgeCA+PSAwOyB4LS0pIHtcblx0XHRcdFx0XHRzZWxlY3RvciA9IGZvcm1hdExpc3RbeF0uc2VsZWN0b3I7XG5cblx0XHRcdFx0XHQvLyBGb3JtYXQgaXMgbm90IHNlbGVjdG9yIGJhc2VkIHRoZW4gYWx3YXlzIHJldHVybiBUUlVFXG5cdFx0XHRcdFx0Ly8gSXMgaXQgaGFzIGEgZGVmYXVsdEJsb2NrIHRoZW4gaXQncyBsaWtlbHkgaXQgY2FuIGJlIGFwcGxpZWQgZm9yIGV4YW1wbGUgYWxpZ24gb24gYSBub24gYmxvY2sgZWxlbWVudCBsaW5lXG5cdFx0XHRcdFx0aWYgKCFzZWxlY3RvciB8fCBmb3JtYXRMaXN0W3hdLmRlZmF1bHRCbG9jaykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIFRSVUU7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Zm9yIChpID0gcGFyZW50cy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuXHRcdFx0XHRcdFx0aWYgKGRvbS5pcyhwYXJlbnRzW2ldLCBzZWxlY3RvcikpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIFRSVUU7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBGQUxTRTtcblx0XHR9XG5cblx0XHQvKipcblx0XHQgKiBFeGVjdXRlcyB0aGUgc3BlY2lmaWVkIGNhbGxiYWNrIHdoZW4gdGhlIGN1cnJlbnQgc2VsZWN0aW9uIG1hdGNoZXMgdGhlIGZvcm1hdHMgb3Igbm90LlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBmb3JtYXRDaGFuZ2VkXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IGZvcm1hdHMgQ29tbWEgc2VwYXJhdGVkIGxpc3Qgb2YgZm9ybWF0cyB0byBjaGVjayBmb3IuXG5cdFx0ICogQHBhcmFtIHtmdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgd2l0aCBzdGF0ZSBhbmQgYXJncyB3aGVuIHRoZSBmb3JtYXQgaXMgY2hhbmdlZC90b2dnbGVkIG9uL29mZi5cblx0XHQgKiBAcGFyYW0ge0Jvb2xlYW59IHNpbWlsYXIgVHJ1ZS9mYWxzZSBzdGF0ZSBpZiB0aGUgbWF0Y2ggc2hvdWxkIGhhbmRsZSBzaW1pbGFyIG9yIGV4YWN0IGZvcm1hdHMuXG5cdFx0ICovXG5cdFx0ZnVuY3Rpb24gZm9ybWF0Q2hhbmdlZChmb3JtYXRzLCBjYWxsYmFjaywgc2ltaWxhcikge1xuXHRcdFx0dmFyIGN1cnJlbnRGb3JtYXRzO1xuXG5cdFx0XHQvLyBTZXR1cCBmb3JtYXQgbm9kZSBjaGFuZ2UgbG9naWNcblx0XHRcdGlmICghZm9ybWF0Q2hhbmdlRGF0YSkge1xuXHRcdFx0XHRmb3JtYXRDaGFuZ2VEYXRhID0ge307XG5cdFx0XHRcdGN1cnJlbnRGb3JtYXRzID0ge307XG5cblx0XHRcdFx0ZWQub24oJ05vZGVDaGFuZ2UnLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdFx0dmFyIHBhcmVudHMgPSBnZXRQYXJlbnRzKGUuZWxlbWVudCksIG1hdGNoZWRGb3JtYXRzID0ge307XG5cblx0XHRcdFx0XHQvLyBJZ25vcmUgYm9ndXMgbm9kZXMgbGlrZSB0aGUgPGE+IHRhZyBjcmVhdGVkIGJ5IG1vdmVTdGFydCgpXG5cdFx0XHRcdFx0cGFyZW50cyA9IFRvb2xzLmdyZXAocGFyZW50cywgZnVuY3Rpb24obm9kZSkge1xuXHRcdFx0XHRcdFx0cmV0dXJuIG5vZGUubm9kZVR5cGUgPT0gMSAmJiAhbm9kZS5nZXRBdHRyaWJ1dGUoJ2RhdGEtbWNlLWJvZ3VzJyk7XG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHQvLyBDaGVjayBmb3IgbmV3IGZvcm1hdHNcblx0XHRcdFx0XHRlYWNoKGZvcm1hdENoYW5nZURhdGEsIGZ1bmN0aW9uKGNhbGxiYWNrcywgZm9ybWF0KSB7XG5cdFx0XHRcdFx0XHRlYWNoKHBhcmVudHMsIGZ1bmN0aW9uKG5vZGUpIHtcblx0XHRcdFx0XHRcdFx0aWYgKG1hdGNoTm9kZShub2RlLCBmb3JtYXQsIHt9LCBjYWxsYmFja3Muc2ltaWxhcikpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAoIWN1cnJlbnRGb3JtYXRzW2Zvcm1hdF0pIHtcblx0XHRcdFx0XHRcdFx0XHRcdC8vIEV4ZWN1dGUgY2FsbGJhY2tzXG5cdFx0XHRcdFx0XHRcdFx0XHRlYWNoKGNhbGxiYWNrcywgZnVuY3Rpb24oY2FsbGJhY2spIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0Y2FsbGJhY2sodHJ1ZSwge25vZGU6IG5vZGUsIGZvcm1hdDogZm9ybWF0LCBwYXJlbnRzOiBwYXJlbnRzfSk7XG5cdFx0XHRcdFx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdFx0XHRcdFx0Y3VycmVudEZvcm1hdHNbZm9ybWF0XSA9IGNhbGxiYWNrcztcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRtYXRjaGVkRm9ybWF0c1tmb3JtYXRdID0gY2FsbGJhY2tzO1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdGlmIChtYXRjaGVzVW5Jbmhlcml0ZWRGb3JtYXRTZWxlY3Rvcihub2RlLCBmb3JtYXQpKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdC8vIENoZWNrIGlmIGN1cnJlbnQgZm9ybWF0cyBzdGlsbCBtYXRjaFxuXHRcdFx0XHRcdGVhY2goY3VycmVudEZvcm1hdHMsIGZ1bmN0aW9uKGNhbGxiYWNrcywgZm9ybWF0KSB7XG5cdFx0XHRcdFx0XHRpZiAoIW1hdGNoZWRGb3JtYXRzW2Zvcm1hdF0pIHtcblx0XHRcdFx0XHRcdFx0ZGVsZXRlIGN1cnJlbnRGb3JtYXRzW2Zvcm1hdF07XG5cblx0XHRcdFx0XHRcdFx0ZWFjaChjYWxsYmFja3MsIGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG5cdFx0XHRcdFx0XHRcdFx0Y2FsbGJhY2soZmFsc2UsIHtub2RlOiBlLmVsZW1lbnQsIGZvcm1hdDogZm9ybWF0LCBwYXJlbnRzOiBwYXJlbnRzfSk7XG5cdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gQWRkIGZvcm1hdCBsaXN0ZW5lcnNcblx0XHRcdGVhY2goZm9ybWF0cy5zcGxpdCgnLCcpLCBmdW5jdGlvbihmb3JtYXQpIHtcblx0XHRcdFx0aWYgKCFmb3JtYXRDaGFuZ2VEYXRhW2Zvcm1hdF0pIHtcblx0XHRcdFx0XHRmb3JtYXRDaGFuZ2VEYXRhW2Zvcm1hdF0gPSBbXTtcblx0XHRcdFx0XHRmb3JtYXRDaGFuZ2VEYXRhW2Zvcm1hdF0uc2ltaWxhciA9IHNpbWlsYXI7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRmb3JtYXRDaGFuZ2VEYXRhW2Zvcm1hdF0ucHVzaChjYWxsYmFjayk7XG5cdFx0XHR9KTtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyBhIHByZXZpZXcgY3NzIHRleHQgZm9yIHRoZSBzcGVjaWZpZWQgZm9ybWF0LlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBnZXRDc3NUZXh0XG5cdFx0ICogQHBhcmFtIHtTdHJpbmcvT2JqZWN0fSBmb3JtYXQgRm9ybWF0IHRvIGdlbmVyYXRlIHByZXZpZXcgY3NzIHRleHQgZm9yLlxuXHRcdCAqIEByZXR1cm4ge1N0cmluZ30gQ3NzIHRleHQgZm9yIHRoZSBzcGVjaWZpZWQgZm9ybWF0LlxuXHRcdCAqIEBleGFtcGxlXG5cdFx0ICogdmFyIGNzc1RleHQxID0gZWRpdG9yLmZvcm1hdHRlci5nZXRDc3NUZXh0KCdib2xkJyk7XG5cdFx0ICogdmFyIGNzc1RleHQyID0gZWRpdG9yLmZvcm1hdHRlci5nZXRDc3NUZXh0KHtpbmxpbmU6ICdiJ30pO1xuXHRcdCAqL1xuXHRcdGZ1bmN0aW9uIGdldENzc1RleHQoZm9ybWF0KSB7XG5cdFx0XHRyZXR1cm4gUHJldmlldy5nZXRDc3NUZXh0KGVkLCBmb3JtYXQpO1xuXHRcdH1cblxuXHRcdC8vIEV4cG9zZSB0byBwdWJsaWNcblx0XHRleHRlbmQodGhpcywge1xuXHRcdFx0Z2V0OiBnZXQsXG5cdFx0XHRyZWdpc3RlcjogcmVnaXN0ZXIsXG5cdFx0XHR1bnJlZ2lzdGVyOiB1bnJlZ2lzdGVyLFxuXHRcdFx0YXBwbHk6IGFwcGx5LFxuXHRcdFx0cmVtb3ZlOiByZW1vdmUsXG5cdFx0XHR0b2dnbGU6IHRvZ2dsZSxcblx0XHRcdG1hdGNoOiBtYXRjaCxcblx0XHRcdG1hdGNoQWxsOiBtYXRjaEFsbCxcblx0XHRcdG1hdGNoTm9kZTogbWF0Y2hOb2RlLFxuXHRcdFx0Y2FuQXBwbHk6IGNhbkFwcGx5LFxuXHRcdFx0Zm9ybWF0Q2hhbmdlZDogZm9ybWF0Q2hhbmdlZCxcblx0XHRcdGdldENzc1RleHQ6IGdldENzc1RleHRcblx0XHR9KTtcblxuXHRcdC8vIEluaXRpYWxpemVcblx0XHRkZWZhdWx0Rm9ybWF0cygpO1xuXHRcdGFkZEtleWJvYXJkU2hvcnRjdXRzKCk7XG5cdFx0ZWQub24oJ0JlZm9yZUdldENvbnRlbnQnLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRpZiAobWFya0NhcmV0Q29udGFpbmVyc0JvZ3VzICYmIGUuZm9ybWF0ICE9ICdyYXcnKSB7XG5cdFx0XHRcdG1hcmtDYXJldENvbnRhaW5lcnNCb2d1cygpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHRcdGVkLm9uKCdtb3VzZXVwIGtleWRvd24nLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRpZiAoZGlzYWJsZUNhcmV0Q29udGFpbmVyKSB7XG5cdFx0XHRcdGRpc2FibGVDYXJldENvbnRhaW5lcihlKTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdC8vIFByaXZhdGUgZnVuY3Rpb25zXG5cblx0XHQvKipcblx0XHQgKiBDaGVja3MgaWYgdGhlIHNwZWNpZmllZCBub2RlcyBuYW1lIG1hdGNoZXMgdGhlIGZvcm1hdCBpbmxpbmUvYmxvY2sgb3Igc2VsZWN0b3IuXG5cdFx0ICpcblx0XHQgKiBAcHJpdmF0ZVxuXHRcdCAqIEBwYXJhbSB7Tm9kZX0gbm9kZSBOb2RlIHRvIG1hdGNoIGFnYWluc3QgdGhlIHNwZWNpZmllZCBmb3JtYXQuXG5cdFx0ICogQHBhcmFtIHtPYmplY3R9IGZvcm1hdCBGb3JtYXQgb2JqZWN0IG8gbWF0Y2ggd2l0aC5cblx0XHQgKiBAcmV0dXJuIHtib29sZWFufSB0cnVlL2ZhbHNlIGlmIHRoZSBmb3JtYXQgbWF0Y2hlcy5cblx0XHQgKi9cblx0XHRmdW5jdGlvbiBtYXRjaE5hbWUobm9kZSwgZm9ybWF0KSB7XG5cdFx0XHQvLyBDaGVjayBmb3IgaW5saW5lIG1hdGNoXG5cdFx0XHRpZiAoaXNFcShub2RlLCBmb3JtYXQuaW5saW5lKSkge1xuXHRcdFx0XHRyZXR1cm4gVFJVRTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gQ2hlY2sgZm9yIGJsb2NrIG1hdGNoXG5cdFx0XHRpZiAoaXNFcShub2RlLCBmb3JtYXQuYmxvY2spKSB7XG5cdFx0XHRcdHJldHVybiBUUlVFO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBDaGVjayBmb3Igc2VsZWN0b3IgbWF0Y2hcblx0XHRcdGlmIChmb3JtYXQuc2VsZWN0b3IpIHtcblx0XHRcdFx0cmV0dXJuIG5vZGUubm9kZVR5cGUgPT0gMSAmJiBkb20uaXMobm9kZSwgZm9ybWF0LnNlbGVjdG9yKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHQvKipcblx0XHQgKiBDb21wYXJlcyB0d28gc3RyaW5nL25vZGVzIHJlZ2FyZGxlc3Mgb2YgdGhlaXIgY2FzZS5cblx0XHQgKlxuXHRcdCAqIEBwcml2YXRlXG5cdFx0ICogQHBhcmFtIHtTdHJpbmcvTm9kZX0gc3RyMSBOb2RlIG9yIHN0cmluZyB0byBjb21wYXJlLlxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nL05vZGV9IHN0cjIgTm9kZSBvciBzdHJpbmcgdG8gY29tcGFyZS5cblx0XHQgKiBAcmV0dXJuIHtib29sZWFufSBUcnVlL2ZhbHNlIGlmIHRoZXkgbWF0Y2guXG5cdFx0ICovXG5cdFx0ZnVuY3Rpb24gaXNFcShzdHIxLCBzdHIyKSB7XG5cdFx0XHRzdHIxID0gc3RyMSB8fCAnJztcblx0XHRcdHN0cjIgPSBzdHIyIHx8ICcnO1xuXG5cdFx0XHRzdHIxID0gJycgKyAoc3RyMS5ub2RlTmFtZSB8fCBzdHIxKTtcblx0XHRcdHN0cjIgPSAnJyArIChzdHIyLm5vZGVOYW1lIHx8IHN0cjIpO1xuXG5cdFx0XHRyZXR1cm4gc3RyMS50b0xvd2VyQ2FzZSgpID09IHN0cjIudG9Mb3dlckNhc2UoKTtcblx0XHR9XG5cblx0XHQvKipcblx0XHQgKiBSZXR1cm5zIHRoZSBzdHlsZSBieSBuYW1lIG9uIHRoZSBzcGVjaWZpZWQgbm9kZS4gVGhpcyBtZXRob2QgbW9kaWZpZXMgdGhlIHN0eWxlXG5cdFx0ICogY29udGVudHMgdG8gbWFrZSBpdCBtb3JlIGVhc3kgdG8gbWF0Y2guIFRoaXMgd2lsbCByZXNvbHZlIGEgZmV3IGJyb3dzZXIgaXNzdWVzLlxuXHRcdCAqXG5cdFx0ICogQHByaXZhdGVcblx0XHQgKiBAcGFyYW0ge05vZGV9IG5vZGUgdG8gZ2V0IHN0eWxlIGZyb20uXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IG5hbWUgU3R5bGUgbmFtZSB0byBnZXQuXG5cdFx0ICogQHJldHVybiB7U3RyaW5nfSBTdHlsZSBpdGVtIHZhbHVlLlxuXHRcdCAqL1xuXHRcdGZ1bmN0aW9uIGdldFN0eWxlKG5vZGUsIG5hbWUpIHtcblx0XHRcdHJldHVybiBub3JtYWxpemVTdHlsZVZhbHVlKGRvbS5nZXRTdHlsZShub2RlLCBuYW1lKSwgbmFtZSk7XG5cdFx0fVxuXG5cdFx0LyoqXG5cdFx0ICogTm9ybWFsaXplIHN0eWxlIHZhbHVlIGJ5IG5hbWUuIFRoaXMgbWV0aG9kIG1vZGlmaWVzIHRoZSBzdHlsZSBjb250ZW50c1xuXHRcdCAqIHRvIG1ha2UgaXQgbW9yZSBlYXN5IHRvIG1hdGNoLiBUaGlzIHdpbGwgcmVzb2x2ZSBhIGZldyBicm93c2VyIGlzc3Vlcy5cblx0XHQgKlxuXHRcdCAqIEBwcml2YXRlXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IHZhbHVlIFZhbHVlIHRvIGdldCBzdHlsZSBmcm9tLlxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIFN0eWxlIG5hbWUgdG8gZ2V0LlxuXHRcdCAqIEByZXR1cm4ge1N0cmluZ30gU3R5bGUgaXRlbSB2YWx1ZS5cblx0XHQgKi9cblx0XHRmdW5jdGlvbiBub3JtYWxpemVTdHlsZVZhbHVlKHZhbHVlLCBuYW1lKSB7XG5cdFx0XHQvLyBGb3JjZSB0aGUgZm9ybWF0IHRvIGhleFxuXHRcdFx0aWYgKG5hbWUgPT0gJ2NvbG9yJyB8fCBuYW1lID09ICdiYWNrZ3JvdW5kQ29sb3InKSB7XG5cdFx0XHRcdHZhbHVlID0gZG9tLnRvSGV4KHZhbHVlKTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gT3BlcmEgd2lsbCByZXR1cm4gYm9sZCBhcyA3MDBcblx0XHRcdGlmIChuYW1lID09ICdmb250V2VpZ2h0JyAmJiB2YWx1ZSA9PSA3MDApIHtcblx0XHRcdFx0dmFsdWUgPSAnYm9sZCc7XG5cdFx0XHR9XG5cblx0XHRcdC8vIE5vcm1hbGl6ZSBmb250RmFtaWx5IHNvIFwiJ0ZvbnQgbmFtZScsIEZvbnRcIiBiZWNvbWVzOiBcIkZvbnQgbmFtZSxGb250XCJcblx0XHRcdGlmIChuYW1lID09ICdmb250RmFtaWx5Jykge1xuXHRcdFx0XHR2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoL1tcXCdcXFwiXS9nLCAnJykucmVwbGFjZSgvLFxccysvZywgJywnKTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuICcnICsgdmFsdWU7XG5cdFx0fVxuXG5cdFx0LyoqXG5cdFx0ICogUmVwbGFjZXMgdmFyaWFibGVzIGluIHRoZSB2YWx1ZS4gVGhlIHZhcmlhYmxlIGZvcm1hdCBpcyAldmFyLlxuXHRcdCAqXG5cdFx0ICogQHByaXZhdGVcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gdmFsdWUgVmFsdWUgdG8gcmVwbGFjZSB2YXJpYWJsZXMgaW4uXG5cdFx0ICogQHBhcmFtIHtPYmplY3R9IHZhcnMgTmFtZS92YWx1ZSBhcnJheSB3aXRoIHZhcmlhYmxlcyB0byByZXBsYWNlLlxuXHRcdCAqIEByZXR1cm4ge1N0cmluZ30gTmV3IHZhbHVlIHdpdGggcmVwbGFjZWQgdmFyaWFibGVzLlxuXHRcdCAqL1xuXHRcdGZ1bmN0aW9uIHJlcGxhY2VWYXJzKHZhbHVlLCB2YXJzKSB7XG5cdFx0XHRpZiAodHlwZW9mIHZhbHVlICE9IFwic3RyaW5nXCIpIHtcblx0XHRcdFx0dmFsdWUgPSB2YWx1ZSh2YXJzKTtcblx0XHRcdH0gZWxzZSBpZiAodmFycykge1xuXHRcdFx0XHR2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoLyUoXFx3KykvZywgZnVuY3Rpb24oc3RyLCBuYW1lKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHZhcnNbbmFtZV0gfHwgc3RyO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIGlzV2hpdGVTcGFjZU5vZGUobm9kZSkge1xuXHRcdFx0cmV0dXJuIG5vZGUgJiYgbm9kZS5ub2RlVHlwZSA9PT0gMyAmJiAvXihbXFx0IFxcclxcbl0rfCkkLy50ZXN0KG5vZGUubm9kZVZhbHVlKTtcblx0XHR9XG5cblx0XHRmdW5jdGlvbiB3cmFwKG5vZGUsIG5hbWUsIGF0dHJzKSB7XG5cdFx0XHR2YXIgd3JhcHBlciA9IGRvbS5jcmVhdGUobmFtZSwgYXR0cnMpO1xuXG5cdFx0XHRub2RlLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHdyYXBwZXIsIG5vZGUpO1xuXHRcdFx0d3JhcHBlci5hcHBlbmRDaGlsZChub2RlKTtcblxuXHRcdFx0cmV0dXJuIHdyYXBwZXI7XG5cdFx0fVxuXG5cdFx0LyoqXG5cdFx0ICogRXhwYW5kcyB0aGUgc3BlY2lmaWVkIHJhbmdlIGxpa2Ugb2JqZWN0IHRvIGRlcGVuZGluZyBvbiBmb3JtYXQuXG5cdFx0ICpcblx0XHQgKiBGb3IgZXhhbXBsZSBvbiBibG9jayBmb3JtYXRzIGl0IHdpbGwgbW92ZSB0aGUgc3RhcnQvZW5kIHBvc2l0aW9uXG5cdFx0ICogdG8gdGhlIGJlZ2lubmluZyBvZiB0aGUgY3VycmVudCBibG9jay5cblx0XHQgKlxuXHRcdCAqIEBwcml2YXRlXG5cdFx0ICogQHBhcmFtIHtPYmplY3R9IHJuZyBSYW5nZSBsaWtlIG9iamVjdC5cblx0XHQgKiBAcGFyYW0ge0FycmF5fSBmb3JtYXQgQXJyYXkgd2l0aCBmb3JtYXRzIHRvIGV4cGFuZCBieS5cblx0XHQgKiBAcGFyYW0ge0Jvb2xlYW59IHJlbW92ZVxuXHRcdCAqIEByZXR1cm4ge09iamVjdH0gRXhwYW5kZWQgcmFuZ2UgbGlrZSBvYmplY3QuXG5cdFx0ICovXG5cdFx0ZnVuY3Rpb24gZXhwYW5kUm5nKHJuZywgZm9ybWF0LCByZW1vdmUpIHtcblx0XHRcdHZhciBsYXN0SWR4LCBsZWFmLCBlbmRQb2ludCxcblx0XHRcdFx0c3RhcnRDb250YWluZXIgPSBybmcuc3RhcnRDb250YWluZXIsXG5cdFx0XHRcdHN0YXJ0T2Zmc2V0ID0gcm5nLnN0YXJ0T2Zmc2V0LFxuXHRcdFx0XHRlbmRDb250YWluZXIgPSBybmcuZW5kQ29udGFpbmVyLFxuXHRcdFx0XHRlbmRPZmZzZXQgPSBybmcuZW5kT2Zmc2V0O1xuXG5cdFx0XHQvLyBUaGlzIGZ1bmN0aW9uIHdhbGtzIHVwIHRoZSB0cmVlIGlmIHRoZXJlIGlzIG5vIHNpYmxpbmdzIGJlZm9yZS9hZnRlciB0aGUgbm9kZVxuXHRcdFx0ZnVuY3Rpb24gZmluZFBhcmVudENvbnRhaW5lcihzdGFydCkge1xuXHRcdFx0XHR2YXIgY29udGFpbmVyLCBwYXJlbnQsIHNpYmxpbmcsIHNpYmxpbmdOYW1lLCByb290O1xuXG5cdFx0XHRcdGNvbnRhaW5lciA9IHBhcmVudCA9IHN0YXJ0ID8gc3RhcnRDb250YWluZXIgOiBlbmRDb250YWluZXI7XG5cdFx0XHRcdHNpYmxpbmdOYW1lID0gc3RhcnQgPyAncHJldmlvdXNTaWJsaW5nJyA6ICduZXh0U2libGluZyc7XG5cdFx0XHRcdHJvb3QgPSBkb20uZ2V0Um9vdCgpO1xuXG5cdFx0XHRcdGZ1bmN0aW9uIGlzQm9ndXNCcihub2RlKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5vZGUubm9kZU5hbWUgPT0gXCJCUlwiICYmIG5vZGUuZ2V0QXR0cmlidXRlKCdkYXRhLW1jZS1ib2d1cycpICYmICFub2RlLm5leHRTaWJsaW5nO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gSWYgaXQncyBhIHRleHQgbm9kZSBhbmQgdGhlIG9mZnNldCBpcyBpbnNpZGUgdGhlIHRleHRcblx0XHRcdFx0aWYgKGNvbnRhaW5lci5ub2RlVHlwZSA9PSAzICYmICFpc1doaXRlU3BhY2VOb2RlKGNvbnRhaW5lcikpIHtcblx0XHRcdFx0XHRpZiAoc3RhcnQgPyBzdGFydE9mZnNldCA+IDAgOiBlbmRPZmZzZXQgPCBjb250YWluZXIubm9kZVZhbHVlLmxlbmd0aCkge1xuXHRcdFx0XHRcdFx0cmV0dXJuIGNvbnRhaW5lcjtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvKmVzbGludCBuby1jb25zdGFudC1jb25kaXRpb246MCAqL1xuXHRcdFx0XHR3aGlsZSAodHJ1ZSkge1xuXHRcdFx0XHRcdC8vIFN0b3AgZXhwYW5kaW5nIG9uIGJsb2NrIGVsZW1lbnRzXG5cdFx0XHRcdFx0aWYgKCFmb3JtYXRbMF0uYmxvY2tfZXhwYW5kICYmIGlzQmxvY2socGFyZW50KSkge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHBhcmVudDtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHQvLyBXYWxrIGxlZnQvcmlnaHRcblx0XHRcdFx0XHRmb3IgKHNpYmxpbmcgPSBwYXJlbnRbc2libGluZ05hbWVdOyBzaWJsaW5nOyBzaWJsaW5nID0gc2libGluZ1tzaWJsaW5nTmFtZV0pIHtcblx0XHRcdFx0XHRcdGlmICghaXNCb29rbWFya05vZGUoc2libGluZykgJiYgIWlzV2hpdGVTcGFjZU5vZGUoc2libGluZykgJiYgIWlzQm9ndXNCcihzaWJsaW5nKSkge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcGFyZW50O1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdC8vIENoZWNrIGlmIHdlIGNhbiBtb3ZlIHVwIGFyZSB3ZSBhdCByb290IGxldmVsIG9yIGJvZHkgbGV2ZWxcblx0XHRcdFx0XHRpZiAocGFyZW50ID09IHJvb3QgfHwgcGFyZW50LnBhcmVudE5vZGUgPT0gcm9vdCkge1xuXHRcdFx0XHRcdFx0Y29udGFpbmVyID0gcGFyZW50O1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cGFyZW50ID0gcGFyZW50LnBhcmVudE5vZGU7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gY29udGFpbmVyO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBUaGlzIGZ1bmN0aW9uIHdhbGtzIGRvd24gdGhlIHRyZWUgdG8gZmluZCB0aGUgbGVhZiBhdCB0aGUgc2VsZWN0aW9uLlxuXHRcdFx0Ly8gVGhlIG9mZnNldCBpcyBhbHNvIHJldHVybmVkIGFzIGlmIG5vZGUgaW5pdGlhbGx5IGEgbGVhZiwgdGhlIG9mZnNldCBtYXkgYmUgaW4gdGhlIG1pZGRsZSBvZiB0aGUgdGV4dCBub2RlLlxuXHRcdFx0ZnVuY3Rpb24gZmluZExlYWYobm9kZSwgb2Zmc2V0KSB7XG5cdFx0XHRcdGlmIChvZmZzZXQgPT09IHVuZGVmKSB7XG5cdFx0XHRcdFx0b2Zmc2V0ID0gbm9kZS5ub2RlVHlwZSA9PT0gMyA/IG5vZGUubGVuZ3RoIDogbm9kZS5jaGlsZE5vZGVzLmxlbmd0aDtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHdoaWxlIChub2RlICYmIG5vZGUuaGFzQ2hpbGROb2RlcygpKSB7XG5cdFx0XHRcdFx0bm9kZSA9IG5vZGUuY2hpbGROb2Rlc1tvZmZzZXRdO1xuXHRcdFx0XHRcdGlmIChub2RlKSB7XG5cdFx0XHRcdFx0XHRvZmZzZXQgPSBub2RlLm5vZGVUeXBlID09PSAzID8gbm9kZS5sZW5ndGggOiBub2RlLmNoaWxkTm9kZXMubGVuZ3RoO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4ge25vZGU6IG5vZGUsIG9mZnNldDogb2Zmc2V0fTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gSWYgaW5kZXggYmFzZWQgc3RhcnQgcG9zaXRpb24gdGhlbiByZXNvbHZlIGl0XG5cdFx0XHRpZiAoc3RhcnRDb250YWluZXIubm9kZVR5cGUgPT0gMSAmJiBzdGFydENvbnRhaW5lci5oYXNDaGlsZE5vZGVzKCkpIHtcblx0XHRcdFx0bGFzdElkeCA9IHN0YXJ0Q29udGFpbmVyLmNoaWxkTm9kZXMubGVuZ3RoIC0gMTtcblx0XHRcdFx0c3RhcnRDb250YWluZXIgPSBzdGFydENvbnRhaW5lci5jaGlsZE5vZGVzW3N0YXJ0T2Zmc2V0ID4gbGFzdElkeCA/IGxhc3RJZHggOiBzdGFydE9mZnNldF07XG5cblx0XHRcdFx0aWYgKHN0YXJ0Q29udGFpbmVyLm5vZGVUeXBlID09IDMpIHtcblx0XHRcdFx0XHRzdGFydE9mZnNldCA9IDA7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0Ly8gSWYgaW5kZXggYmFzZWQgZW5kIHBvc2l0aW9uIHRoZW4gcmVzb2x2ZSBpdFxuXHRcdFx0aWYgKGVuZENvbnRhaW5lci5ub2RlVHlwZSA9PSAxICYmIGVuZENvbnRhaW5lci5oYXNDaGlsZE5vZGVzKCkpIHtcblx0XHRcdFx0bGFzdElkeCA9IGVuZENvbnRhaW5lci5jaGlsZE5vZGVzLmxlbmd0aCAtIDE7XG5cdFx0XHRcdGVuZENvbnRhaW5lciA9IGVuZENvbnRhaW5lci5jaGlsZE5vZGVzW2VuZE9mZnNldCA+IGxhc3RJZHggPyBsYXN0SWR4IDogZW5kT2Zmc2V0IC0gMV07XG5cblx0XHRcdFx0aWYgKGVuZENvbnRhaW5lci5ub2RlVHlwZSA9PSAzKSB7XG5cdFx0XHRcdFx0ZW5kT2Zmc2V0ID0gZW5kQ29udGFpbmVyLm5vZGVWYWx1ZS5sZW5ndGg7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0Ly8gRXhwYW5kcyB0aGUgbm9kZSB0byB0aGUgY2xvc2VzIGNvbnRlbnRFZGl0YWJsZSBmYWxzZSBlbGVtZW50IGlmIGl0IGV4aXN0c1xuXHRcdFx0ZnVuY3Rpb24gZmluZFBhcmVudENvbnRlbnRFZGl0YWJsZShub2RlKSB7XG5cdFx0XHRcdHZhciBwYXJlbnQgPSBub2RlO1xuXG5cdFx0XHRcdHdoaWxlIChwYXJlbnQpIHtcblx0XHRcdFx0XHRpZiAocGFyZW50Lm5vZGVUeXBlID09PSAxICYmIGdldENvbnRlbnRFZGl0YWJsZShwYXJlbnQpKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gZ2V0Q29udGVudEVkaXRhYmxlKHBhcmVudCkgPT09IFwiZmFsc2VcIiA/IHBhcmVudCA6IG5vZGU7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cGFyZW50ID0gcGFyZW50LnBhcmVudE5vZGU7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbm9kZTtcblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gZmluZFdvcmRFbmRQb2ludChjb250YWluZXIsIG9mZnNldCwgc3RhcnQpIHtcblx0XHRcdFx0dmFyIHdhbGtlciwgbm9kZSwgcG9zLCBsYXN0VGV4dE5vZGU7XG5cblx0XHRcdFx0ZnVuY3Rpb24gZmluZFNwYWNlKG5vZGUsIG9mZnNldCkge1xuXHRcdFx0XHRcdHZhciBwb3MsIHBvczIsIHN0ciA9IG5vZGUubm9kZVZhbHVlO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZiBvZmZzZXQgPT0gXCJ1bmRlZmluZWRcIikge1xuXHRcdFx0XHRcdFx0b2Zmc2V0ID0gc3RhcnQgPyBzdHIubGVuZ3RoIDogMDtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoc3RhcnQpIHtcblx0XHRcdFx0XHRcdHBvcyA9IHN0ci5sYXN0SW5kZXhPZignICcsIG9mZnNldCk7XG5cdFx0XHRcdFx0XHRwb3MyID0gc3RyLmxhc3RJbmRleE9mKCdcXHUwMGEwJywgb2Zmc2V0KTtcblx0XHRcdFx0XHRcdHBvcyA9IHBvcyA+IHBvczIgPyBwb3MgOiBwb3MyO1xuXG5cdFx0XHRcdFx0XHQvLyBJbmNsdWRlIHRoZSBzcGFjZSBvbiByZW1vdmUgdG8gYXZvaWQgdGFnIHNvdXBcblx0XHRcdFx0XHRcdGlmIChwb3MgIT09IC0xICYmICFyZW1vdmUpIHtcblx0XHRcdFx0XHRcdFx0cG9zKys7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdHBvcyA9IHN0ci5pbmRleE9mKCcgJywgb2Zmc2V0KTtcblx0XHRcdFx0XHRcdHBvczIgPSBzdHIuaW5kZXhPZignXFx1MDBhMCcsIG9mZnNldCk7XG5cdFx0XHRcdFx0XHRwb3MgPSBwb3MgIT09IC0xICYmIChwb3MyID09PSAtMSB8fCBwb3MgPCBwb3MyKSA/IHBvcyA6IHBvczI7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHBvcztcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChjb250YWluZXIubm9kZVR5cGUgPT09IDMpIHtcblx0XHRcdFx0XHRwb3MgPSBmaW5kU3BhY2UoY29udGFpbmVyLCBvZmZzZXQpO1xuXG5cdFx0XHRcdFx0aWYgKHBvcyAhPT0gLTEpIHtcblx0XHRcdFx0XHRcdHJldHVybiB7Y29udGFpbmVyOiBjb250YWluZXIsIG9mZnNldDogcG9zfTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRsYXN0VGV4dE5vZGUgPSBjb250YWluZXI7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBXYWxrIHRoZSBub2RlcyBpbnNpZGUgdGhlIGJsb2NrXG5cdFx0XHRcdHdhbGtlciA9IG5ldyBUcmVlV2Fsa2VyKGNvbnRhaW5lciwgZG9tLmdldFBhcmVudChjb250YWluZXIsIGlzQmxvY2spIHx8IGVkLmdldEJvZHkoKSk7XG5cdFx0XHRcdHdoaWxlICgobm9kZSA9IHdhbGtlcltzdGFydCA/ICdwcmV2JyA6ICduZXh0J10oKSkpIHtcblx0XHRcdFx0XHRpZiAobm9kZS5ub2RlVHlwZSA9PT0gMykge1xuXHRcdFx0XHRcdFx0bGFzdFRleHROb2RlID0gbm9kZTtcblx0XHRcdFx0XHRcdHBvcyA9IGZpbmRTcGFjZShub2RlKTtcblxuXHRcdFx0XHRcdFx0aWYgKHBvcyAhPT0gLTEpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHtjb250YWluZXI6IG5vZGUsIG9mZnNldDogcG9zfTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9IGVsc2UgaWYgKGlzQmxvY2sobm9kZSkpIHtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChsYXN0VGV4dE5vZGUpIHtcblx0XHRcdFx0XHRpZiAoc3RhcnQpIHtcblx0XHRcdFx0XHRcdG9mZnNldCA9IDA7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdG9mZnNldCA9IGxhc3RUZXh0Tm9kZS5sZW5ndGg7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHtjb250YWluZXI6IGxhc3RUZXh0Tm9kZSwgb2Zmc2V0OiBvZmZzZXR9O1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIGZpbmRTZWxlY3RvckVuZFBvaW50KGNvbnRhaW5lciwgc2libGluZ19uYW1lKSB7XG5cdFx0XHRcdHZhciBwYXJlbnRzLCBpLCB5LCBjdXJGb3JtYXQ7XG5cblx0XHRcdFx0aWYgKGNvbnRhaW5lci5ub2RlVHlwZSA9PSAzICYmIGNvbnRhaW5lci5ub2RlVmFsdWUubGVuZ3RoID09PSAwICYmIGNvbnRhaW5lcltzaWJsaW5nX25hbWVdKSB7XG5cdFx0XHRcdFx0Y29udGFpbmVyID0gY29udGFpbmVyW3NpYmxpbmdfbmFtZV07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRwYXJlbnRzID0gZ2V0UGFyZW50cyhjb250YWluZXIpO1xuXHRcdFx0XHRmb3IgKGkgPSAwOyBpIDwgcGFyZW50cy5sZW5ndGg7IGkrKykge1xuXHRcdFx0XHRcdGZvciAoeSA9IDA7IHkgPCBmb3JtYXQubGVuZ3RoOyB5KyspIHtcblx0XHRcdFx0XHRcdGN1ckZvcm1hdCA9IGZvcm1hdFt5XTtcblxuXHRcdFx0XHRcdFx0Ly8gSWYgY29sbGFwc2VkIHN0YXRlIGlzIHNldCB0aGVuIHNraXAgZm9ybWF0cyB0aGF0IGRvZXNuJ3QgbWF0Y2ggdGhhdFxuXHRcdFx0XHRcdFx0aWYgKFwiY29sbGFwc2VkXCIgaW4gY3VyRm9ybWF0ICYmIGN1ckZvcm1hdC5jb2xsYXBzZWQgIT09IHJuZy5jb2xsYXBzZWQpIHtcblx0XHRcdFx0XHRcdFx0Y29udGludWU7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGlmIChkb20uaXMocGFyZW50c1tpXSwgY3VyRm9ybWF0LnNlbGVjdG9yKSkge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcGFyZW50c1tpXTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gY29udGFpbmVyO1xuXHRcdFx0fVxuXG5cdFx0XHRmdW5jdGlvbiBmaW5kQmxvY2tFbmRQb2ludChjb250YWluZXIsIHNpYmxpbmdfbmFtZSkge1xuXHRcdFx0XHR2YXIgbm9kZSwgcm9vdCA9IGRvbS5nZXRSb290KCk7XG5cblx0XHRcdFx0Ly8gRXhwYW5kIHRvIGJsb2NrIG9mIHNpbWlsYXIgdHlwZVxuXHRcdFx0XHRpZiAoIWZvcm1hdFswXS53cmFwcGVyKSB7XG5cdFx0XHRcdFx0bm9kZSA9IGRvbS5nZXRQYXJlbnQoY29udGFpbmVyLCBmb3JtYXRbMF0uYmxvY2ssIHJvb3QpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gRXhwYW5kIHRvIGZpcnN0IHdyYXBwYWJsZSBibG9jayBlbGVtZW50IG9yIGFueSBibG9jayBlbGVtZW50XG5cdFx0XHRcdGlmICghbm9kZSkge1xuXHRcdFx0XHRcdG5vZGUgPSBkb20uZ2V0UGFyZW50KGNvbnRhaW5lci5ub2RlVHlwZSA9PSAzID8gY29udGFpbmVyLnBhcmVudE5vZGUgOiBjb250YWluZXIsIGZ1bmN0aW9uKG5vZGUpIHtcblx0XHRcdFx0XHRcdC8vIEZpeGVzICM2MTgzIHdoZXJlIGl0IHdvdWxkIGV4cGFuZCB0byBlZGl0YWJsZSBwYXJlbnQgZWxlbWVudCBpbiBpbmxpbmUgbW9kZVxuXHRcdFx0XHRcdFx0cmV0dXJuIG5vZGUgIT0gcm9vdCAmJiBpc1RleHRCbG9jayhub2RlKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIEV4Y2x1ZGUgaW5uZXIgbGlzdHMgZnJvbSB3cmFwcGluZ1xuXHRcdFx0XHRpZiAobm9kZSAmJiBmb3JtYXRbMF0ud3JhcHBlcikge1xuXHRcdFx0XHRcdG5vZGUgPSBnZXRQYXJlbnRzKG5vZGUsICd1bCxvbCcpLnJldmVyc2UoKVswXSB8fCBub2RlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gRGlkbid0IGZpbmQgYSBibG9jayBlbGVtZW50IGxvb2sgZm9yIGZpcnN0L2xhc3Qgd3JhcHBhYmxlIGVsZW1lbnRcblx0XHRcdFx0aWYgKCFub2RlKSB7XG5cdFx0XHRcdFx0bm9kZSA9IGNvbnRhaW5lcjtcblxuXHRcdFx0XHRcdHdoaWxlIChub2RlW3NpYmxpbmdfbmFtZV0gJiYgIWlzQmxvY2sobm9kZVtzaWJsaW5nX25hbWVdKSkge1xuXHRcdFx0XHRcdFx0bm9kZSA9IG5vZGVbc2libGluZ19uYW1lXTtcblxuXHRcdFx0XHRcdFx0Ly8gQnJlYWsgb24gQlIgYnV0IGluY2x1ZGUgaXQgd2lsbCBiZSByZW1vdmVkIGxhdGVyIG9uXG5cdFx0XHRcdFx0XHQvLyB3ZSBjYW4ndCByZW1vdmUgaXQgbm93IHNpbmNlIHdlIG5lZWQgdG8gY2hlY2sgaWYgaXQgY2FuIGJlIHdyYXBwZWRcblx0XHRcdFx0XHRcdGlmIChpc0VxKG5vZGUsICdicicpKSB7XG5cdFx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBub2RlIHx8IGNvbnRhaW5lcjtcblx0XHRcdH1cblxuXHRcdFx0Ly8gRXhwYW5kIHRvIGNsb3Nlc3QgY29udGVudEVkaXRhYmxlIGVsZW1lbnRcblx0XHRcdHN0YXJ0Q29udGFpbmVyID0gZmluZFBhcmVudENvbnRlbnRFZGl0YWJsZShzdGFydENvbnRhaW5lcik7XG5cdFx0XHRlbmRDb250YWluZXIgPSBmaW5kUGFyZW50Q29udGVudEVkaXRhYmxlKGVuZENvbnRhaW5lcik7XG5cblx0XHRcdC8vIEV4Y2x1ZGUgYm9va21hcmsgbm9kZXMgaWYgcG9zc2libGVcblx0XHRcdGlmIChpc0Jvb2ttYXJrTm9kZShzdGFydENvbnRhaW5lci5wYXJlbnROb2RlKSB8fCBpc0Jvb2ttYXJrTm9kZShzdGFydENvbnRhaW5lcikpIHtcblx0XHRcdFx0c3RhcnRDb250YWluZXIgPSBpc0Jvb2ttYXJrTm9kZShzdGFydENvbnRhaW5lcikgPyBzdGFydENvbnRhaW5lciA6IHN0YXJ0Q29udGFpbmVyLnBhcmVudE5vZGU7XG5cdFx0XHRcdHN0YXJ0Q29udGFpbmVyID0gc3RhcnRDb250YWluZXIubmV4dFNpYmxpbmcgfHwgc3RhcnRDb250YWluZXI7XG5cblx0XHRcdFx0aWYgKHN0YXJ0Q29udGFpbmVyLm5vZGVUeXBlID09IDMpIHtcblx0XHRcdFx0XHRzdGFydE9mZnNldCA9IDA7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKGlzQm9va21hcmtOb2RlKGVuZENvbnRhaW5lci5wYXJlbnROb2RlKSB8fCBpc0Jvb2ttYXJrTm9kZShlbmRDb250YWluZXIpKSB7XG5cdFx0XHRcdGVuZENvbnRhaW5lciA9IGlzQm9va21hcmtOb2RlKGVuZENvbnRhaW5lcikgPyBlbmRDb250YWluZXIgOiBlbmRDb250YWluZXIucGFyZW50Tm9kZTtcblx0XHRcdFx0ZW5kQ29udGFpbmVyID0gZW5kQ29udGFpbmVyLnByZXZpb3VzU2libGluZyB8fCBlbmRDb250YWluZXI7XG5cblx0XHRcdFx0aWYgKGVuZENvbnRhaW5lci5ub2RlVHlwZSA9PSAzKSB7XG5cdFx0XHRcdFx0ZW5kT2Zmc2V0ID0gZW5kQ29udGFpbmVyLmxlbmd0aDtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAoZm9ybWF0WzBdLmlubGluZSkge1xuXHRcdFx0XHRpZiAocm5nLmNvbGxhcHNlZCkge1xuXHRcdFx0XHRcdC8vIEV4cGFuZCBsZWZ0IHRvIGNsb3Nlc3Qgd29yZCBib3VuZGFyeVxuXHRcdFx0XHRcdGVuZFBvaW50ID0gZmluZFdvcmRFbmRQb2ludChzdGFydENvbnRhaW5lciwgc3RhcnRPZmZzZXQsIHRydWUpO1xuXHRcdFx0XHRcdGlmIChlbmRQb2ludCkge1xuXHRcdFx0XHRcdFx0c3RhcnRDb250YWluZXIgPSBlbmRQb2ludC5jb250YWluZXI7XG5cdFx0XHRcdFx0XHRzdGFydE9mZnNldCA9IGVuZFBvaW50Lm9mZnNldDtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHQvLyBFeHBhbmQgcmlnaHQgdG8gY2xvc2VzdCB3b3JkIGJvdW5kYXJ5XG5cdFx0XHRcdFx0ZW5kUG9pbnQgPSBmaW5kV29yZEVuZFBvaW50KGVuZENvbnRhaW5lciwgZW5kT2Zmc2V0KTtcblx0XHRcdFx0XHRpZiAoZW5kUG9pbnQpIHtcblx0XHRcdFx0XHRcdGVuZENvbnRhaW5lciA9IGVuZFBvaW50LmNvbnRhaW5lcjtcblx0XHRcdFx0XHRcdGVuZE9mZnNldCA9IGVuZFBvaW50Lm9mZnNldDtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBBdm9pZCBhcHBseWluZyBmb3JtYXR0aW5nIHRvIGEgdHJhaWxpbmcgc3BhY2UuXG5cdFx0XHRcdGxlYWYgPSBmaW5kTGVhZihlbmRDb250YWluZXIsIGVuZE9mZnNldCk7XG5cdFx0XHRcdGlmIChsZWFmLm5vZGUpIHtcblx0XHRcdFx0XHR3aGlsZSAobGVhZi5ub2RlICYmIGxlYWYub2Zmc2V0ID09PSAwICYmIGxlYWYubm9kZS5wcmV2aW91c1NpYmxpbmcpIHtcblx0XHRcdFx0XHRcdGxlYWYgPSBmaW5kTGVhZihsZWFmLm5vZGUucHJldmlvdXNTaWJsaW5nKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAobGVhZi5ub2RlICYmIGxlYWYub2Zmc2V0ID4gMCAmJiBsZWFmLm5vZGUubm9kZVR5cGUgPT09IDMgJiZcblx0XHRcdFx0XHRcdFx0bGVhZi5ub2RlLm5vZGVWYWx1ZS5jaGFyQXQobGVhZi5vZmZzZXQgLSAxKSA9PT0gJyAnKSB7XG5cblx0XHRcdFx0XHRcdGlmIChsZWFmLm9mZnNldCA+IDEpIHtcblx0XHRcdFx0XHRcdFx0ZW5kQ29udGFpbmVyID0gbGVhZi5ub2RlO1xuXHRcdFx0XHRcdFx0XHRlbmRDb250YWluZXIuc3BsaXRUZXh0KGxlYWYub2Zmc2V0IC0gMSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdC8vIE1vdmUgc3RhcnQvZW5kIHBvaW50IHVwIHRoZSB0cmVlIGlmIHRoZSBsZWF2ZXMgYXJlIHNoYXJwIGFuZCBpZiB3ZSBhcmUgaW4gZGlmZmVyZW50IGNvbnRhaW5lcnNcblx0XHRcdC8vIEV4YW1wbGUgKiBiZWNvbWVzICE6ICE8cD48Yj48aT4qdGV4dDwvaT48aT50ZXh0KjwvaT48L2I+PC9wPiFcblx0XHRcdC8vIFRoaXMgd2lsbCByZWR1Y2UgdGhlIG51bWJlciBvZiB3cmFwcGVyIGVsZW1lbnRzIHRoYXQgbmVlZHMgdG8gYmUgY3JlYXRlZFxuXHRcdFx0Ly8gTW92ZSBzdGFydCBwb2ludCB1cCB0aGUgdHJlZVxuXHRcdFx0aWYgKGZvcm1hdFswXS5pbmxpbmUgfHwgZm9ybWF0WzBdLmJsb2NrX2V4cGFuZCkge1xuXHRcdFx0XHRpZiAoIWZvcm1hdFswXS5pbmxpbmUgfHwgKHN0YXJ0Q29udGFpbmVyLm5vZGVUeXBlICE9IDMgfHwgc3RhcnRPZmZzZXQgPT09IDApKSB7XG5cdFx0XHRcdFx0c3RhcnRDb250YWluZXIgPSBmaW5kUGFyZW50Q29udGFpbmVyKHRydWUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKCFmb3JtYXRbMF0uaW5saW5lIHx8IChlbmRDb250YWluZXIubm9kZVR5cGUgIT0gMyB8fCBlbmRPZmZzZXQgPT09IGVuZENvbnRhaW5lci5ub2RlVmFsdWUubGVuZ3RoKSkge1xuXHRcdFx0XHRcdGVuZENvbnRhaW5lciA9IGZpbmRQYXJlbnRDb250YWluZXIoKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHQvLyBFeHBhbmQgc3RhcnQvZW5kIGNvbnRhaW5lciB0byBtYXRjaGluZyBzZWxlY3RvclxuXHRcdFx0aWYgKGZvcm1hdFswXS5zZWxlY3RvciAmJiBmb3JtYXRbMF0uZXhwYW5kICE9PSBGQUxTRSAmJiAhZm9ybWF0WzBdLmlubGluZSkge1xuXHRcdFx0XHQvLyBGaW5kIG5ldyBzdGFydENvbnRhaW5lci9lbmRDb250YWluZXIgaWYgdGhlcmUgaXMgYmV0dGVyIG9uZVxuXHRcdFx0XHRzdGFydENvbnRhaW5lciA9IGZpbmRTZWxlY3RvckVuZFBvaW50KHN0YXJ0Q29udGFpbmVyLCAncHJldmlvdXNTaWJsaW5nJyk7XG5cdFx0XHRcdGVuZENvbnRhaW5lciA9IGZpbmRTZWxlY3RvckVuZFBvaW50KGVuZENvbnRhaW5lciwgJ25leHRTaWJsaW5nJyk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIEV4cGFuZCBzdGFydC9lbmQgY29udGFpbmVyIHRvIG1hdGNoaW5nIGJsb2NrIGVsZW1lbnQgb3IgdGV4dCBub2RlXG5cdFx0XHRpZiAoZm9ybWF0WzBdLmJsb2NrIHx8IGZvcm1hdFswXS5zZWxlY3Rvcikge1xuXHRcdFx0XHQvLyBGaW5kIG5ldyBzdGFydENvbnRhaW5lci9lbmRDb250YWluZXIgaWYgdGhlcmUgaXMgYmV0dGVyIG9uZVxuXHRcdFx0XHRzdGFydENvbnRhaW5lciA9IGZpbmRCbG9ja0VuZFBvaW50KHN0YXJ0Q29udGFpbmVyLCAncHJldmlvdXNTaWJsaW5nJyk7XG5cdFx0XHRcdGVuZENvbnRhaW5lciA9IGZpbmRCbG9ja0VuZFBvaW50KGVuZENvbnRhaW5lciwgJ25leHRTaWJsaW5nJyk7XG5cblx0XHRcdFx0Ly8gTm9uIGJsb2NrIGVsZW1lbnQgdGhlbiB0cnkgdG8gZXhwYW5kIHVwIHRoZSBsZWFmXG5cdFx0XHRcdGlmIChmb3JtYXRbMF0uYmxvY2spIHtcblx0XHRcdFx0XHRpZiAoIWlzQmxvY2soc3RhcnRDb250YWluZXIpKSB7XG5cdFx0XHRcdFx0XHRzdGFydENvbnRhaW5lciA9IGZpbmRQYXJlbnRDb250YWluZXIodHJ1ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKCFpc0Jsb2NrKGVuZENvbnRhaW5lcikpIHtcblx0XHRcdFx0XHRcdGVuZENvbnRhaW5lciA9IGZpbmRQYXJlbnRDb250YWluZXIoKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0Ly8gU2V0dXAgaW5kZXggZm9yIHN0YXJ0Q29udGFpbmVyXG5cdFx0XHRpZiAoc3RhcnRDb250YWluZXIubm9kZVR5cGUgPT0gMSkge1xuXHRcdFx0XHRzdGFydE9mZnNldCA9IG5vZGVJbmRleChzdGFydENvbnRhaW5lcik7XG5cdFx0XHRcdHN0YXJ0Q29udGFpbmVyID0gc3RhcnRDb250YWluZXIucGFyZW50Tm9kZTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gU2V0dXAgaW5kZXggZm9yIGVuZENvbnRhaW5lclxuXHRcdFx0aWYgKGVuZENvbnRhaW5lci5ub2RlVHlwZSA9PSAxKSB7XG5cdFx0XHRcdGVuZE9mZnNldCA9IG5vZGVJbmRleChlbmRDb250YWluZXIpICsgMTtcblx0XHRcdFx0ZW5kQ29udGFpbmVyID0gZW5kQ29udGFpbmVyLnBhcmVudE5vZGU7XG5cdFx0XHR9XG5cblx0XHRcdC8vIFJldHVybiBuZXcgcmFuZ2UgbGlrZSBvYmplY3Rcblx0XHRcdHJldHVybiB7XG5cdFx0XHRcdHN0YXJ0Q29udGFpbmVyOiBzdGFydENvbnRhaW5lcixcblx0XHRcdFx0c3RhcnRPZmZzZXQ6IHN0YXJ0T2Zmc2V0LFxuXHRcdFx0XHRlbmRDb250YWluZXI6IGVuZENvbnRhaW5lcixcblx0XHRcdFx0ZW5kT2Zmc2V0OiBlbmRPZmZzZXRcblx0XHRcdH07XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gaXNDb2xvckZvcm1hdEFuZEFuY2hvcihub2RlLCBmb3JtYXQpIHtcblx0XHRcdHJldHVybiBmb3JtYXQubGlua3MgJiYgbm9kZS50YWdOYW1lID09ICdBJztcblx0XHR9XG5cblx0XHQvKipcblx0XHQgKiBSZW1vdmVzIHRoZSBzcGVjaWZpZWQgZm9ybWF0IGZvciB0aGUgc3BlY2lmaWVkIG5vZGUuIEl0IHdpbGwgYWxzbyByZW1vdmUgdGhlIG5vZGUgaWYgaXQgZG9lc24ndCBoYXZlXG5cdFx0ICogYW55IGF0dHJpYnV0ZXMgaWYgdGhlIGZvcm1hdCBzcGVjaWZpZXMgaXQgdG8gZG8gc28uXG5cdFx0ICpcblx0XHQgKiBAcHJpdmF0ZVxuXHRcdCAqIEBwYXJhbSB7T2JqZWN0fSBmb3JtYXQgRm9ybWF0IG9iamVjdCB3aXRoIGl0ZW1zIHRvIHJlbW92ZSBmcm9tIG5vZGUuXG5cdFx0ICogQHBhcmFtIHtPYmplY3R9IHZhcnMgTmFtZS92YWx1ZSBvYmplY3Qgd2l0aCB2YXJpYWJsZXMgdG8gYXBwbHkgdG8gZm9ybWF0LlxuXHRcdCAqIEBwYXJhbSB7Tm9kZX0gbm9kZSBOb2RlIHRvIHJlbW92ZSB0aGUgZm9ybWF0IHN0eWxlcyBvbi5cblx0XHQgKiBAcGFyYW0ge05vZGV9IGNvbXBhcmVfbm9kZSBPcHRpb25hbCBjb21wYXJlIG5vZGUsIGlmIHNwZWNpZmllZCB0aGUgc3R5bGVzIHdpbGwgYmUgY29tcGFyZWQgdG8gdGhhdCBub2RlLlxuXHRcdCAqIEByZXR1cm4ge0Jvb2xlYW59IFRydWUvZmFsc2UgaWYgdGhlIG5vZGUgd2FzIHJlbW92ZWQgb3Igbm90LlxuXHRcdCAqL1xuXHRcdGZ1bmN0aW9uIHJlbW92ZUZvcm1hdChmb3JtYXQsIHZhcnMsIG5vZGUsIGNvbXBhcmVfbm9kZSkge1xuXHRcdFx0dmFyIGksIGF0dHJzLCBzdHlsZXNNb2RpZmllZDtcblxuXHRcdFx0Ly8gQ2hlY2sgaWYgbm9kZSBtYXRjaGVzIGZvcm1hdFxuXHRcdFx0aWYgKCFtYXRjaE5hbWUobm9kZSwgZm9ybWF0KSAmJiAhaXNDb2xvckZvcm1hdEFuZEFuY2hvcihub2RlLCBmb3JtYXQpKSB7XG5cdFx0XHRcdHJldHVybiBGQUxTRTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gU2hvdWxkIHdlIGNvbXBhcmUgd2l0aCBmb3JtYXQgYXR0cmlicyBhbmQgc3R5bGVzXG5cdFx0XHRpZiAoZm9ybWF0LnJlbW92ZSAhPSAnYWxsJykge1xuXHRcdFx0XHQvLyBSZW1vdmUgc3R5bGVzXG5cdFx0XHRcdGVhY2goZm9ybWF0LnN0eWxlcywgZnVuY3Rpb24odmFsdWUsIG5hbWUpIHtcblx0XHRcdFx0XHR2YWx1ZSA9IG5vcm1hbGl6ZVN0eWxlVmFsdWUocmVwbGFjZVZhcnModmFsdWUsIHZhcnMpLCBuYW1lKTtcblxuXHRcdFx0XHRcdC8vIEluZGV4ZWQgYXJyYXlcblx0XHRcdFx0XHRpZiAodHlwZW9mIG5hbWUgPT09ICdudW1iZXInKSB7XG5cdFx0XHRcdFx0XHRuYW1lID0gdmFsdWU7XG5cdFx0XHRcdFx0XHRjb21wYXJlX25vZGUgPSAwO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmIChmb3JtYXQucmVtb3ZlX3NpbWlsYXIgfHwgKCFjb21wYXJlX25vZGUgfHwgaXNFcShnZXRTdHlsZShjb21wYXJlX25vZGUsIG5hbWUpLCB2YWx1ZSkpKSB7XG5cdFx0XHRcdFx0XHRkb20uc2V0U3R5bGUobm9kZSwgbmFtZSwgJycpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHN0eWxlc01vZGlmaWVkID0gMTtcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0Ly8gUmVtb3ZlIHN0eWxlIGF0dHJpYnV0ZSBpZiBpdCdzIGVtcHR5XG5cdFx0XHRcdGlmIChzdHlsZXNNb2RpZmllZCAmJiBkb20uZ2V0QXR0cmliKG5vZGUsICdzdHlsZScpID09PSAnJykge1xuXHRcdFx0XHRcdG5vZGUucmVtb3ZlQXR0cmlidXRlKCdzdHlsZScpO1xuXHRcdFx0XHRcdG5vZGUucmVtb3ZlQXR0cmlidXRlKCdkYXRhLW1jZS1zdHlsZScpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gUmVtb3ZlIGF0dHJpYnV0ZXNcblx0XHRcdFx0ZWFjaChmb3JtYXQuYXR0cmlidXRlcywgZnVuY3Rpb24odmFsdWUsIG5hbWUpIHtcblx0XHRcdFx0XHR2YXIgdmFsdWVPdXQ7XG5cblx0XHRcdFx0XHR2YWx1ZSA9IHJlcGxhY2VWYXJzKHZhbHVlLCB2YXJzKTtcblxuXHRcdFx0XHRcdC8vIEluZGV4ZWQgYXJyYXlcblx0XHRcdFx0XHRpZiAodHlwZW9mIG5hbWUgPT09ICdudW1iZXInKSB7XG5cdFx0XHRcdFx0XHRuYW1lID0gdmFsdWU7XG5cdFx0XHRcdFx0XHRjb21wYXJlX25vZGUgPSAwO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICghY29tcGFyZV9ub2RlIHx8IGlzRXEoZG9tLmdldEF0dHJpYihjb21wYXJlX25vZGUsIG5hbWUpLCB2YWx1ZSkpIHtcblx0XHRcdFx0XHRcdC8vIEtlZXAgaW50ZXJuYWwgY2xhc3Nlc1xuXHRcdFx0XHRcdFx0aWYgKG5hbWUgPT0gJ2NsYXNzJykge1xuXHRcdFx0XHRcdFx0XHR2YWx1ZSA9IGRvbS5nZXRBdHRyaWIobm9kZSwgbmFtZSk7XG5cdFx0XHRcdFx0XHRcdGlmICh2YWx1ZSkge1xuXHRcdFx0XHRcdFx0XHRcdC8vIEJ1aWxkIG5ldyBjbGFzcyB2YWx1ZSB3aGVyZSBldmVyeXRoaW5nIGlzIHJlbW92ZWQgZXhjZXB0IHRoZSBpbnRlcm5hbCBwcmVmaXhlZCBjbGFzc2VzXG5cdFx0XHRcdFx0XHRcdFx0dmFsdWVPdXQgPSAnJztcblx0XHRcdFx0XHRcdFx0XHRlYWNoKHZhbHVlLnNwbGl0KC9cXHMrLyksIGZ1bmN0aW9uKGNscykge1xuXHRcdFx0XHRcdFx0XHRcdFx0aWYgKC9tY2VcXC1cXHcrLy50ZXN0KGNscykpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0dmFsdWVPdXQgKz0gKHZhbHVlT3V0ID8gJyAnIDogJycpICsgY2xzO1xuXHRcdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0XHRcdFx0Ly8gV2UgZ290IHNvbWUgaW50ZXJuYWwgY2xhc3NlcyBsZWZ0XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHZhbHVlT3V0KSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRkb20uc2V0QXR0cmliKG5vZGUsIG5hbWUsIHZhbHVlT3V0KTtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0Ly8gSUU2IGhhcyBhIGJ1ZyB3aGVyZSB0aGUgYXR0cmlidXRlIGRvZXNuJ3QgZ2V0IHJlbW92ZWQgY29ycmVjdGx5XG5cdFx0XHRcdFx0XHRpZiAobmFtZSA9PSBcImNsYXNzXCIpIHtcblx0XHRcdFx0XHRcdFx0bm9kZS5yZW1vdmVBdHRyaWJ1dGUoJ2NsYXNzTmFtZScpO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHQvLyBSZW1vdmUgbWNlIHByZWZpeGVkIGF0dHJpYnV0ZXNcblx0XHRcdFx0XHRcdGlmIChNQ0VfQVRUUl9SRS50ZXN0KG5hbWUpKSB7XG5cdFx0XHRcdFx0XHRcdG5vZGUucmVtb3ZlQXR0cmlidXRlKCdkYXRhLW1jZS0nICsgbmFtZSk7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdG5vZGUucmVtb3ZlQXR0cmlidXRlKG5hbWUpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0Ly8gUmVtb3ZlIGNsYXNzZXNcblx0XHRcdFx0ZWFjaChmb3JtYXQuY2xhc3NlcywgZnVuY3Rpb24odmFsdWUpIHtcblx0XHRcdFx0XHR2YWx1ZSA9IHJlcGxhY2VWYXJzKHZhbHVlLCB2YXJzKTtcblxuXHRcdFx0XHRcdGlmICghY29tcGFyZV9ub2RlIHx8IGRvbS5oYXNDbGFzcyhjb21wYXJlX25vZGUsIHZhbHVlKSkge1xuXHRcdFx0XHRcdFx0ZG9tLnJlbW92ZUNsYXNzKG5vZGUsIHZhbHVlKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdC8vIENoZWNrIGZvciBub24gaW50ZXJuYWwgYXR0cmlidXRlc1xuXHRcdFx0XHRhdHRycyA9IGRvbS5nZXRBdHRyaWJzKG5vZGUpO1xuXHRcdFx0XHRmb3IgKGkgPSAwOyBpIDwgYXR0cnMubGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0XHR2YXIgYXR0ck5hbWUgPSBhdHRyc1tpXS5ub2RlTmFtZTtcblx0XHRcdFx0XHRpZiAoYXR0ck5hbWUuaW5kZXhPZignXycpICE9PSAwICYmIGF0dHJOYW1lLmluZGV4T2YoJ2RhdGEtJykgIT09IDApIHtcblx0XHRcdFx0XHRcdHJldHVybiBGQUxTRTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0Ly8gUmVtb3ZlIHRoZSBpbmxpbmUgY2hpbGQgaWYgaXQncyBlbXB0eSBmb3IgZXhhbXBsZSA8Yj4gb3IgPHNwYW4+XG5cdFx0XHRpZiAoZm9ybWF0LnJlbW92ZSAhPSAnbm9uZScpIHtcblx0XHRcdFx0cmVtb3ZlTm9kZShub2RlLCBmb3JtYXQpO1xuXHRcdFx0XHRyZXR1cm4gVFJVRTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHQvKipcblx0XHQgKiBSZW1vdmVzIHRoZSBub2RlIGFuZCB3cmFwIGl0J3MgY2hpbGRyZW4gaW4gcGFyYWdyYXBocyBiZWZvcmUgZG9pbmcgc28gb3Jcblx0XHQgKiBhcHBlbmRzIEJSIGVsZW1lbnRzIHRvIHRoZSBiZWdpbm5pbmcvZW5kIG9mIHRoZSBibG9jayBlbGVtZW50IGlmIGZvcmNlZFJvb3RCbG9ja3MgaXMgZGlzYWJsZWQuXG5cdFx0ICpcblx0XHQgKiBJZiB0aGUgZGl2IGluIHRoZSBub2RlIGJlbG93IGdldHMgcmVtb3ZlZDpcblx0XHQgKiAgdGV4dDxkaXY+dGV4dDwvZGl2PnRleHRcblx0XHQgKlxuXHRcdCAqIE91dHB1dCBiZWNvbWVzOlxuXHRcdCAqICB0ZXh0PGRpdj48YnIgLz50ZXh0PGJyIC8+PC9kaXY+dGV4dFxuXHRcdCAqXG5cdFx0ICogU28gd2hlbiB0aGUgZGl2IGlzIHJlbW92ZWQgdGhlIHJlc3VsdCBpczpcblx0XHQgKiAgdGV4dDxiciAvPnRleHQ8YnIgLz50ZXh0XG5cdFx0ICpcblx0XHQgKiBAcHJpdmF0ZVxuXHRcdCAqIEBwYXJhbSB7Tm9kZX0gbm9kZSBOb2RlIHRvIHJlbW92ZSArIGFwcGx5IEJSL1AgZWxlbWVudHMgdG8uXG5cdFx0ICogQHBhcmFtIHtPYmplY3R9IGZvcm1hdCBGb3JtYXQgcnVsZS5cblx0XHQgKiBAcmV0dXJuIHtOb2RlfSBJbnB1dCBub2RlLlxuXHRcdCAqL1xuXHRcdGZ1bmN0aW9uIHJlbW92ZU5vZGUobm9kZSwgZm9ybWF0KSB7XG5cdFx0XHR2YXIgcGFyZW50Tm9kZSA9IG5vZGUucGFyZW50Tm9kZSwgcm9vdEJsb2NrRWxtO1xuXG5cdFx0XHRmdW5jdGlvbiBmaW5kKG5vZGUsIG5leHQsIGluYykge1xuXHRcdFx0XHRub2RlID0gZ2V0Tm9uV2hpdGVTcGFjZVNpYmxpbmcobm9kZSwgbmV4dCwgaW5jKTtcblxuXHRcdFx0XHRyZXR1cm4gIW5vZGUgfHwgKG5vZGUubm9kZU5hbWUgPT0gJ0JSJyB8fCBpc0Jsb2NrKG5vZGUpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGZvcm1hdC5ibG9jaykge1xuXHRcdFx0XHRpZiAoIWZvcmNlZFJvb3RCbG9jaykge1xuXHRcdFx0XHRcdC8vIEFwcGVuZCBCUiBlbGVtZW50cyBpZiBuZWVkZWQgYmVmb3JlIHdlIHJlbW92ZSB0aGUgYmxvY2tcblx0XHRcdFx0XHRpZiAoaXNCbG9jayhub2RlKSAmJiAhaXNCbG9jayhwYXJlbnROb2RlKSkge1xuXHRcdFx0XHRcdFx0aWYgKCFmaW5kKG5vZGUsIEZBTFNFKSAmJiAhZmluZChub2RlLmZpcnN0Q2hpbGQsIFRSVUUsIDEpKSB7XG5cdFx0XHRcdFx0XHRcdG5vZGUuaW5zZXJ0QmVmb3JlKGRvbS5jcmVhdGUoJ2JyJyksIG5vZGUuZmlyc3RDaGlsZCk7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGlmICghZmluZChub2RlLCBUUlVFKSAmJiAhZmluZChub2RlLmxhc3RDaGlsZCwgRkFMU0UsIDEpKSB7XG5cdFx0XHRcdFx0XHRcdG5vZGUuYXBwZW5kQ2hpbGQoZG9tLmNyZWF0ZSgnYnInKSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdC8vIFdyYXAgdGhlIGJsb2NrIGluIGEgZm9yY2VkUm9vdEJsb2NrIGlmIHdlIGFyZSBhdCB0aGUgcm9vdCBvZiBkb2N1bWVudFxuXHRcdFx0XHRcdGlmIChwYXJlbnROb2RlID09IGRvbS5nZXRSb290KCkpIHtcblx0XHRcdFx0XHRcdGlmICghZm9ybWF0Lmxpc3RfYmxvY2sgfHwgIWlzRXEobm9kZSwgZm9ybWF0Lmxpc3RfYmxvY2spKSB7XG5cdFx0XHRcdFx0XHRcdGVhY2goZ3JlcChub2RlLmNoaWxkTm9kZXMpLCBmdW5jdGlvbihub2RlKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKGlzVmFsaWQoZm9yY2VkUm9vdEJsb2NrLCBub2RlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkpKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRpZiAoIXJvb3RCbG9ja0VsbSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRyb290QmxvY2tFbG0gPSB3cmFwKG5vZGUsIGZvcmNlZFJvb3RCbG9jayk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdGRvbS5zZXRBdHRyaWJzKHJvb3RCbG9ja0VsbSwgZWQuc2V0dGluZ3MuZm9yY2VkX3Jvb3RfYmxvY2tfYXR0cnMpO1xuXHRcdFx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0cm9vdEJsb2NrRWxtLmFwcGVuZENoaWxkKG5vZGUpO1xuXHRcdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyb290QmxvY2tFbG0gPSAwO1xuXHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdC8vIE5ldmVyIHJlbW92ZSBub2RlcyB0aGF0IGlzbid0IHRoZSBzcGVjaWZpZWQgaW5saW5lIGVsZW1lbnQgaWYgYSBzZWxlY3RvciBpcyBzcGVjaWZpZWQgdG9vXG5cdFx0XHRpZiAoZm9ybWF0LnNlbGVjdG9yICYmIGZvcm1hdC5pbmxpbmUgJiYgIWlzRXEoZm9ybWF0LmlubGluZSwgbm9kZSkpIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHRkb20ucmVtb3ZlKG5vZGUsIDEpO1xuXHRcdH1cblxuXHRcdC8qKlxuXHRcdCAqIFJldHVybnMgdGhlIG5leHQvcHJldmlvdXMgbm9uIHdoaXRlc3BhY2Ugbm9kZS5cblx0XHQgKlxuXHRcdCAqIEBwcml2YXRlXG5cdFx0ICogQHBhcmFtIHtOb2RlfSBub2RlIE5vZGUgdG8gc3RhcnQgYXQuXG5cdFx0ICogQHBhcmFtIHtib29sZWFufSBuZXh0IChPcHRpb25hbCkgSW5jbHVkZSBuZXh0IG9yIHByZXZpb3VzIG5vZGUgZGVmYXVsdHMgdG8gcHJldmlvdXMuXG5cdFx0ICogQHBhcmFtIHtib29sZWFufSBpbmMgKE9wdGlvbmFsKSBJbmNsdWRlIHRoZSBjdXJyZW50IG5vZGUgaW4gY2hlY2tpbmcuIERlZmF1bHRzIHRvIGZhbHNlLlxuXHRcdCAqIEByZXR1cm4ge05vZGV9IE5leHQgb3IgcHJldmlvdXMgbm9kZSBvciB1bmRlZmluZWQgaWYgaXQgd2Fzbid0IGZvdW5kLlxuXHRcdCAqL1xuXHRcdGZ1bmN0aW9uIGdldE5vbldoaXRlU3BhY2VTaWJsaW5nKG5vZGUsIG5leHQsIGluYykge1xuXHRcdFx0aWYgKG5vZGUpIHtcblx0XHRcdFx0bmV4dCA9IG5leHQgPyAnbmV4dFNpYmxpbmcnIDogJ3ByZXZpb3VzU2libGluZyc7XG5cblx0XHRcdFx0Zm9yIChub2RlID0gaW5jID8gbm9kZSA6IG5vZGVbbmV4dF07IG5vZGU7IG5vZGUgPSBub2RlW25leHRdKSB7XG5cdFx0XHRcdFx0aWYgKG5vZGUubm9kZVR5cGUgPT0gMSB8fCAhaXNXaGl0ZVNwYWNlTm9kZShub2RlKSkge1xuXHRcdFx0XHRcdFx0cmV0dXJuIG5vZGU7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0LyoqXG5cdFx0ICogTWVyZ2VzIHRoZSBuZXh0L3ByZXZpb3VzIHNpYmxpbmcgZWxlbWVudCBpZiB0aGV5IG1hdGNoLlxuXHRcdCAqXG5cdFx0ICogQHByaXZhdGVcblx0XHQgKiBAcGFyYW0ge05vZGV9IHByZXYgUHJldmlvdXMgbm9kZSB0byBjb21wYXJlL21lcmdlLlxuXHRcdCAqIEBwYXJhbSB7Tm9kZX0gbmV4dCBOZXh0IG5vZGUgdG8gY29tcGFyZS9tZXJnZS5cblx0XHQgKiBAcmV0dXJuIHtOb2RlfSBOZXh0IG5vZGUgaWYgd2UgZGlkbid0IG1lcmdlIGFuZCBwcmV2IG5vZGUgaWYgd2UgZGlkLlxuXHRcdCAqL1xuXHRcdGZ1bmN0aW9uIG1lcmdlU2libGluZ3MocHJldiwgbmV4dCkge1xuXHRcdFx0dmFyIHNpYmxpbmcsIHRtcFNpYmxpbmcsIGVsZW1lbnRVdGlscyA9IG5ldyBFbGVtZW50VXRpbHMoZG9tKTtcblxuXHRcdFx0ZnVuY3Rpb24gZmluZEVsZW1lbnRTaWJsaW5nKG5vZGUsIHNpYmxpbmdfbmFtZSkge1xuXHRcdFx0XHRmb3IgKHNpYmxpbmcgPSBub2RlOyBzaWJsaW5nOyBzaWJsaW5nID0gc2libGluZ1tzaWJsaW5nX25hbWVdKSB7XG5cdFx0XHRcdFx0aWYgKHNpYmxpbmcubm9kZVR5cGUgPT0gMyAmJiBzaWJsaW5nLm5vZGVWYWx1ZS5sZW5ndGggIT09IDApIHtcblx0XHRcdFx0XHRcdHJldHVybiBub2RlO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmIChzaWJsaW5nLm5vZGVUeXBlID09IDEgJiYgIWlzQm9va21hcmtOb2RlKHNpYmxpbmcpKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gc2libGluZztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbm9kZTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gQ2hlY2sgaWYgbmV4dC9wcmV2IGV4aXN0cyBhbmQgdGhhdCB0aGV5IGFyZSBlbGVtZW50c1xuXHRcdFx0aWYgKHByZXYgJiYgbmV4dCkge1xuXHRcdFx0XHQvLyBJZiBwcmV2aW91cyBzaWJsaW5nIGlzIGVtcHR5IHRoZW4ganVtcCBvdmVyIGl0XG5cdFx0XHRcdHByZXYgPSBmaW5kRWxlbWVudFNpYmxpbmcocHJldiwgJ3ByZXZpb3VzU2libGluZycpO1xuXHRcdFx0XHRuZXh0ID0gZmluZEVsZW1lbnRTaWJsaW5nKG5leHQsICduZXh0U2libGluZycpO1xuXG5cdFx0XHRcdC8vIENvbXBhcmUgbmV4dCBhbmQgcHJldmlvdXMgbm9kZXNcblx0XHRcdFx0aWYgKGVsZW1lbnRVdGlscy5jb21wYXJlKHByZXYsIG5leHQpKSB7XG5cdFx0XHRcdFx0Ly8gQXBwZW5kIG5vZGVzIGJldHdlZW5cblx0XHRcdFx0XHRmb3IgKHNpYmxpbmcgPSBwcmV2Lm5leHRTaWJsaW5nOyBzaWJsaW5nICYmIHNpYmxpbmcgIT0gbmV4dDspIHtcblx0XHRcdFx0XHRcdHRtcFNpYmxpbmcgPSBzaWJsaW5nO1xuXHRcdFx0XHRcdFx0c2libGluZyA9IHNpYmxpbmcubmV4dFNpYmxpbmc7XG5cdFx0XHRcdFx0XHRwcmV2LmFwcGVuZENoaWxkKHRtcFNpYmxpbmcpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdC8vIFJlbW92ZSBuZXh0IG5vZGVcblx0XHRcdFx0XHRkb20ucmVtb3ZlKG5leHQpO1xuXG5cdFx0XHRcdFx0Ly8gTW92ZSBjaGlsZHJlbiBpbnRvIHByZXYgbm9kZVxuXHRcdFx0XHRcdGVhY2goZ3JlcChuZXh0LmNoaWxkTm9kZXMpLCBmdW5jdGlvbihub2RlKSB7XG5cdFx0XHRcdFx0XHRwcmV2LmFwcGVuZENoaWxkKG5vZGUpO1xuXHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0cmV0dXJuIHByZXY7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG5leHQ7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gZ2V0Q29udGFpbmVyKHJuZywgc3RhcnQpIHtcblx0XHRcdHZhciBjb250YWluZXIsIG9mZnNldCwgbGFzdElkeDtcblxuXHRcdFx0Y29udGFpbmVyID0gcm5nW3N0YXJ0ID8gJ3N0YXJ0Q29udGFpbmVyJyA6ICdlbmRDb250YWluZXInXTtcblx0XHRcdG9mZnNldCA9IHJuZ1tzdGFydCA/ICdzdGFydE9mZnNldCcgOiAnZW5kT2Zmc2V0J107XG5cblx0XHRcdGlmIChjb250YWluZXIubm9kZVR5cGUgPT0gMSkge1xuXHRcdFx0XHRsYXN0SWR4ID0gY29udGFpbmVyLmNoaWxkTm9kZXMubGVuZ3RoIC0gMTtcblxuXHRcdFx0XHRpZiAoIXN0YXJ0ICYmIG9mZnNldCkge1xuXHRcdFx0XHRcdG9mZnNldC0tO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Y29udGFpbmVyID0gY29udGFpbmVyLmNoaWxkTm9kZXNbb2Zmc2V0ID4gbGFzdElkeCA/IGxhc3RJZHggOiBvZmZzZXRdO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBJZiBzdGFydCB0ZXh0IG5vZGUgaXMgZXhjbHVkZWQgdGhlbiB3YWxrIHRvIHRoZSBuZXh0IG5vZGVcblx0XHRcdGlmIChjb250YWluZXIubm9kZVR5cGUgPT09IDMgJiYgc3RhcnQgJiYgb2Zmc2V0ID49IGNvbnRhaW5lci5ub2RlVmFsdWUubGVuZ3RoKSB7XG5cdFx0XHRcdGNvbnRhaW5lciA9IG5ldyBUcmVlV2Fsa2VyKGNvbnRhaW5lciwgZWQuZ2V0Qm9keSgpKS5uZXh0KCkgfHwgY29udGFpbmVyO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBJZiBlbmQgdGV4dCBub2RlIGlzIGV4Y2x1ZGVkIHRoZW4gd2FsayB0byB0aGUgcHJldmlvdXMgbm9kZVxuXHRcdFx0aWYgKGNvbnRhaW5lci5ub2RlVHlwZSA9PT0gMyAmJiAhc3RhcnQgJiYgb2Zmc2V0ID09PSAwKSB7XG5cdFx0XHRcdGNvbnRhaW5lciA9IG5ldyBUcmVlV2Fsa2VyKGNvbnRhaW5lciwgZWQuZ2V0Qm9keSgpKS5wcmV2KCkgfHwgY29udGFpbmVyO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gY29udGFpbmVyO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIHBlcmZvcm1DYXJldEFjdGlvbih0eXBlLCBuYW1lLCB2YXJzLCBzaW1pbGFyKSB7XG5cdFx0XHR2YXIgY2FyZXRDb250YWluZXJJZCA9ICdfbWNlX2NhcmV0JywgZGVidWcgPSBlZC5zZXR0aW5ncy5jYXJldF9kZWJ1ZztcblxuXHRcdFx0Ly8gQ3JlYXRlcyBhIGNhcmV0IGNvbnRhaW5lciBib2d1cyBlbGVtZW50XG5cdFx0XHRmdW5jdGlvbiBjcmVhdGVDYXJldENvbnRhaW5lcihmaWxsKSB7XG5cdFx0XHRcdHZhciBjYXJldENvbnRhaW5lciA9IGRvbS5jcmVhdGUoJ3NwYW4nLCB7aWQ6IGNhcmV0Q29udGFpbmVySWQsICdkYXRhLW1jZS1ib2d1cyc6IHRydWUsIHN0eWxlOiBkZWJ1ZyA/ICdjb2xvcjpyZWQnIDogJyd9KTtcblxuXHRcdFx0XHRpZiAoZmlsbCkge1xuXHRcdFx0XHRcdGNhcmV0Q29udGFpbmVyLmFwcGVuZENoaWxkKGVkLmdldERvYygpLmNyZWF0ZVRleHROb2RlKElOVklTSUJMRV9DSEFSKSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gY2FyZXRDb250YWluZXI7XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIGlzQ2FyZXRDb250YWluZXJFbXB0eShub2RlLCBub2Rlcykge1xuXHRcdFx0XHR3aGlsZSAobm9kZSkge1xuXHRcdFx0XHRcdGlmICgobm9kZS5ub2RlVHlwZSA9PT0gMyAmJiBub2RlLm5vZGVWYWx1ZSAhPT0gSU5WSVNJQkxFX0NIQVIpIHx8IG5vZGUuY2hpbGROb2Rlcy5sZW5ndGggPiAxKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Ly8gQ29sbGVjdCBub2Rlc1xuXHRcdFx0XHRcdGlmIChub2RlcyAmJiBub2RlLm5vZGVUeXBlID09PSAxKSB7XG5cdFx0XHRcdFx0XHRub2Rlcy5wdXNoKG5vZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdG5vZGUgPSBub2RlLmZpcnN0Q2hpbGQ7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gUmV0dXJucyBhbnkgcGFyZW50IGNhcmV0IGNvbnRhaW5lciBlbGVtZW50XG5cdFx0XHRmdW5jdGlvbiBnZXRQYXJlbnRDYXJldENvbnRhaW5lcihub2RlKSB7XG5cdFx0XHRcdHdoaWxlIChub2RlKSB7XG5cdFx0XHRcdFx0aWYgKG5vZGUuaWQgPT09IGNhcmV0Q29udGFpbmVySWQpIHtcblx0XHRcdFx0XHRcdHJldHVybiBub2RlO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdG5vZGUgPSBub2RlLnBhcmVudE5vZGU7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0Ly8gRmluZHMgdGhlIGZpcnN0IHRleHQgbm9kZSBpbiB0aGUgc3BlY2lmaWVkIG5vZGVcblx0XHRcdGZ1bmN0aW9uIGZpbmRGaXJzdFRleHROb2RlKG5vZGUpIHtcblx0XHRcdFx0dmFyIHdhbGtlcjtcblxuXHRcdFx0XHRpZiAobm9kZSkge1xuXHRcdFx0XHRcdHdhbGtlciA9IG5ldyBUcmVlV2Fsa2VyKG5vZGUsIG5vZGUpO1xuXG5cdFx0XHRcdFx0Zm9yIChub2RlID0gd2Fsa2VyLmN1cnJlbnQoKTsgbm9kZTsgbm9kZSA9IHdhbGtlci5uZXh0KCkpIHtcblx0XHRcdFx0XHRcdGlmIChub2RlLm5vZGVUeXBlID09PSAzKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiBub2RlO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHQvLyBSZW1vdmVzIHRoZSBjYXJldCBjb250YWluZXIgZm9yIHRoZSBzcGVjaWZpZWQgbm9kZSBvciBhbGwgb24gdGhlIGN1cnJlbnQgZG9jdW1lbnRcblx0XHRcdGZ1bmN0aW9uIHJlbW92ZUNhcmV0Q29udGFpbmVyKG5vZGUsIG1vdmVfY2FyZXQpIHtcblx0XHRcdFx0dmFyIGNoaWxkLCBybmc7XG5cblx0XHRcdFx0aWYgKCFub2RlKSB7XG5cdFx0XHRcdFx0bm9kZSA9IGdldFBhcmVudENhcmV0Q29udGFpbmVyKHNlbGVjdGlvbi5nZXRTdGFydCgpKTtcblxuXHRcdFx0XHRcdGlmICghbm9kZSkge1xuXHRcdFx0XHRcdFx0d2hpbGUgKChub2RlID0gZG9tLmdldChjYXJldENvbnRhaW5lcklkKSkpIHtcblx0XHRcdFx0XHRcdFx0cmVtb3ZlQ2FyZXRDb250YWluZXIobm9kZSwgZmFsc2UpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRybmcgPSBzZWxlY3Rpb24uZ2V0Um5nKHRydWUpO1xuXG5cdFx0XHRcdFx0aWYgKGlzQ2FyZXRDb250YWluZXJFbXB0eShub2RlKSkge1xuXHRcdFx0XHRcdFx0aWYgKG1vdmVfY2FyZXQgIT09IGZhbHNlKSB7XG5cdFx0XHRcdFx0XHRcdHJuZy5zZXRTdGFydEJlZm9yZShub2RlKTtcblx0XHRcdFx0XHRcdFx0cm5nLnNldEVuZEJlZm9yZShub2RlKTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0ZG9tLnJlbW92ZShub2RlKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0Y2hpbGQgPSBmaW5kRmlyc3RUZXh0Tm9kZShub2RlKTtcblxuXHRcdFx0XHRcdFx0aWYgKGNoaWxkLm5vZGVWYWx1ZS5jaGFyQXQoMCkgPT09IElOVklTSUJMRV9DSEFSKSB7XG5cdFx0XHRcdFx0XHRcdGNoaWxkLmRlbGV0ZURhdGEoMCwgMSk7XG5cblx0XHRcdFx0XHRcdFx0Ly8gRml4IGZvciBidWcgIzY5NzZcblx0XHRcdFx0XHRcdFx0aWYgKHJuZy5zdGFydENvbnRhaW5lciA9PSBjaGlsZCAmJiBybmcuc3RhcnRPZmZzZXQgPiAwKSB7XG5cdFx0XHRcdFx0XHRcdFx0cm5nLnNldFN0YXJ0KGNoaWxkLCBybmcuc3RhcnRPZmZzZXQgLSAxKTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdGlmIChybmcuZW5kQ29udGFpbmVyID09IGNoaWxkICYmIHJuZy5lbmRPZmZzZXQgPiAwKSB7XG5cdFx0XHRcdFx0XHRcdFx0cm5nLnNldEVuZChjaGlsZCwgcm5nLmVuZE9mZnNldCAtIDEpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGRvbS5yZW1vdmUobm9kZSwgMSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0c2VsZWN0aW9uLnNldFJuZyhybmcpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdC8vIEFwcGxpZXMgZm9ybWF0dGluZyB0byB0aGUgY2FyZXQgcG9zaXRpb25cblx0XHRcdGZ1bmN0aW9uIGFwcGx5Q2FyZXRGb3JtYXQoKSB7XG5cdFx0XHRcdHZhciBybmcsIGNhcmV0Q29udGFpbmVyLCB0ZXh0Tm9kZSwgb2Zmc2V0LCBib29rbWFyaywgY29udGFpbmVyLCB0ZXh0O1xuXG5cdFx0XHRcdHJuZyA9IHNlbGVjdGlvbi5nZXRSbmcodHJ1ZSk7XG5cdFx0XHRcdG9mZnNldCA9IHJuZy5zdGFydE9mZnNldDtcblx0XHRcdFx0Y29udGFpbmVyID0gcm5nLnN0YXJ0Q29udGFpbmVyO1xuXHRcdFx0XHR0ZXh0ID0gY29udGFpbmVyLm5vZGVWYWx1ZTtcblxuXHRcdFx0XHRjYXJldENvbnRhaW5lciA9IGdldFBhcmVudENhcmV0Q29udGFpbmVyKHNlbGVjdGlvbi5nZXRTdGFydCgpKTtcblx0XHRcdFx0aWYgKGNhcmV0Q29udGFpbmVyKSB7XG5cdFx0XHRcdFx0dGV4dE5vZGUgPSBmaW5kRmlyc3RUZXh0Tm9kZShjYXJldENvbnRhaW5lcik7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBFeHBhbmQgdG8gd29yZCBpcyBjYXJldCBpcyBpbiB0aGUgbWlkZGxlIG9mIGEgdGV4dCBub2RlIGFuZCB0aGUgY2hhciBiZWZvcmUvYWZ0ZXIgaXMgYSBhbHBoYSBudW1lcmljIGNoYXJhY3RlclxuXHRcdFx0XHRpZiAodGV4dCAmJiBvZmZzZXQgPiAwICYmIG9mZnNldCA8IHRleHQubGVuZ3RoICYmIC9cXHcvLnRlc3QodGV4dC5jaGFyQXQob2Zmc2V0KSkgJiYgL1xcdy8udGVzdCh0ZXh0LmNoYXJBdChvZmZzZXQgLSAxKSkpIHtcblx0XHRcdFx0XHQvLyBHZXQgYm9va21hcmsgb2YgY2FyZXQgcG9zaXRpb25cblx0XHRcdFx0XHRib29rbWFyayA9IHNlbGVjdGlvbi5nZXRCb29rbWFyaygpO1xuXG5cdFx0XHRcdFx0Ly8gQ29sbGFwc2UgYm9va21hcmsgcmFuZ2UgKFdlYktpdClcblx0XHRcdFx0XHRybmcuY29sbGFwc2UodHJ1ZSk7XG5cblx0XHRcdFx0XHQvLyBFeHBhbmQgdGhlIHJhbmdlIHRvIHRoZSBjbG9zZXN0IHdvcmQgYW5kIHNwbGl0IGl0IGF0IHRob3NlIHBvaW50c1xuXHRcdFx0XHRcdHJuZyA9IGV4cGFuZFJuZyhybmcsIGdldChuYW1lKSk7XG5cdFx0XHRcdFx0cm5nID0gcmFuZ2VVdGlscy5zcGxpdChybmcpO1xuXG5cdFx0XHRcdFx0Ly8gQXBwbHkgdGhlIGZvcm1hdCB0byB0aGUgcmFuZ2Vcblx0XHRcdFx0XHRhcHBseShuYW1lLCB2YXJzLCBybmcpO1xuXG5cdFx0XHRcdFx0Ly8gTW92ZSBzZWxlY3Rpb24gYmFjayB0byBjYXJldCBwb3NpdGlvblxuXHRcdFx0XHRcdHNlbGVjdGlvbi5tb3ZlVG9Cb29rbWFyayhib29rbWFyayk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0aWYgKCFjYXJldENvbnRhaW5lciB8fCB0ZXh0Tm9kZS5ub2RlVmFsdWUgIT09IElOVklTSUJMRV9DSEFSKSB7XG5cdFx0XHRcdFx0XHRjYXJldENvbnRhaW5lciA9IGNyZWF0ZUNhcmV0Q29udGFpbmVyKHRydWUpO1xuXHRcdFx0XHRcdFx0dGV4dE5vZGUgPSBjYXJldENvbnRhaW5lci5maXJzdENoaWxkO1xuXG5cdFx0XHRcdFx0XHRybmcuaW5zZXJ0Tm9kZShjYXJldENvbnRhaW5lcik7XG5cdFx0XHRcdFx0XHRvZmZzZXQgPSAxO1xuXG5cdFx0XHRcdFx0XHRhcHBseShuYW1lLCB2YXJzLCBjYXJldENvbnRhaW5lcik7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGFwcGx5KG5hbWUsIHZhcnMsIGNhcmV0Q29udGFpbmVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHQvLyBNb3ZlIHNlbGVjdGlvbiB0byB0ZXh0IG5vZGVcblx0XHRcdFx0XHRzZWxlY3Rpb24uc2V0Q3Vyc29yTG9jYXRpb24odGV4dE5vZGUsIG9mZnNldCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gcmVtb3ZlQ2FyZXRGb3JtYXQoKSB7XG5cdFx0XHRcdHZhciBybmcgPSBzZWxlY3Rpb24uZ2V0Um5nKHRydWUpLCBjb250YWluZXIsIG9mZnNldCwgYm9va21hcmssXG5cdFx0XHRcdFx0aGFzQ29udGVudEFmdGVyLCBub2RlLCBmb3JtYXROb2RlLCBwYXJlbnRzID0gW10sIGksIGNhcmV0Q29udGFpbmVyO1xuXG5cdFx0XHRcdGNvbnRhaW5lciA9IHJuZy5zdGFydENvbnRhaW5lcjtcblx0XHRcdFx0b2Zmc2V0ID0gcm5nLnN0YXJ0T2Zmc2V0O1xuXHRcdFx0XHRub2RlID0gY29udGFpbmVyO1xuXG5cdFx0XHRcdGlmIChjb250YWluZXIubm9kZVR5cGUgPT0gMykge1xuXHRcdFx0XHRcdGlmIChvZmZzZXQgIT0gY29udGFpbmVyLm5vZGVWYWx1ZS5sZW5ndGgpIHtcblx0XHRcdFx0XHRcdGhhc0NvbnRlbnRBZnRlciA9IHRydWU7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0bm9kZSA9IG5vZGUucGFyZW50Tm9kZTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHdoaWxlIChub2RlKSB7XG5cdFx0XHRcdFx0aWYgKG1hdGNoTm9kZShub2RlLCBuYW1lLCB2YXJzLCBzaW1pbGFyKSkge1xuXHRcdFx0XHRcdFx0Zm9ybWF0Tm9kZSA9IG5vZGU7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAobm9kZS5uZXh0U2libGluZykge1xuXHRcdFx0XHRcdFx0aGFzQ29udGVudEFmdGVyID0gdHJ1ZTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRwYXJlbnRzLnB1c2gobm9kZSk7XG5cdFx0XHRcdFx0bm9kZSA9IG5vZGUucGFyZW50Tm9kZTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIE5vZGUgZG9lc24ndCBoYXZlIHRoZSBzcGVjaWZpZWQgZm9ybWF0XG5cdFx0XHRcdGlmICghZm9ybWF0Tm9kZSkge1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIElzIHRoZXJlIGNvbnRlbnRzIGFmdGVyIHRoZSBjYXJldCB0aGVuIHJlbW92ZSB0aGUgZm9ybWF0IG9uIHRoZSBlbGVtZW50XG5cdFx0XHRcdGlmIChoYXNDb250ZW50QWZ0ZXIpIHtcblx0XHRcdFx0XHQvLyBHZXQgYm9va21hcmsgb2YgY2FyZXQgcG9zaXRpb25cblx0XHRcdFx0XHRib29rbWFyayA9IHNlbGVjdGlvbi5nZXRCb29rbWFyaygpO1xuXG5cdFx0XHRcdFx0Ly8gQ29sbGFwc2UgYm9va21hcmsgcmFuZ2UgKFdlYktpdClcblx0XHRcdFx0XHRybmcuY29sbGFwc2UodHJ1ZSk7XG5cblx0XHRcdFx0XHQvLyBFeHBhbmQgdGhlIHJhbmdlIHRvIHRoZSBjbG9zZXN0IHdvcmQgYW5kIHNwbGl0IGl0IGF0IHRob3NlIHBvaW50c1xuXHRcdFx0XHRcdHJuZyA9IGV4cGFuZFJuZyhybmcsIGdldChuYW1lKSwgdHJ1ZSk7XG5cdFx0XHRcdFx0cm5nID0gcmFuZ2VVdGlscy5zcGxpdChybmcpO1xuXG5cdFx0XHRcdFx0Ly8gUmVtb3ZlIHRoZSBmb3JtYXQgZnJvbSB0aGUgcmFuZ2Vcblx0XHRcdFx0XHRyZW1vdmUobmFtZSwgdmFycywgcm5nKTtcblxuXHRcdFx0XHRcdC8vIE1vdmUgc2VsZWN0aW9uIGJhY2sgdG8gY2FyZXQgcG9zaXRpb25cblx0XHRcdFx0XHRzZWxlY3Rpb24ubW92ZVRvQm9va21hcmsoYm9va21hcmspO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNhcmV0Q29udGFpbmVyID0gY3JlYXRlQ2FyZXRDb250YWluZXIoKTtcblxuXHRcdFx0XHRcdG5vZGUgPSBjYXJldENvbnRhaW5lcjtcblx0XHRcdFx0XHRmb3IgKGkgPSBwYXJlbnRzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG5cdFx0XHRcdFx0XHRub2RlLmFwcGVuZENoaWxkKGRvbS5jbG9uZShwYXJlbnRzW2ldLCBmYWxzZSkpO1xuXHRcdFx0XHRcdFx0bm9kZSA9IG5vZGUuZmlyc3RDaGlsZDtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHQvLyBJbnNlcnQgaW52aXNpYmxlIGNoYXJhY3RlciBpbnRvIGlubmVyIG1vc3QgZm9ybWF0IGVsZW1lbnRcblx0XHRcdFx0XHRub2RlLmFwcGVuZENoaWxkKGRvbS5kb2MuY3JlYXRlVGV4dE5vZGUoSU5WSVNJQkxFX0NIQVIpKTtcblx0XHRcdFx0XHRub2RlID0gbm9kZS5maXJzdENoaWxkO1xuXG5cdFx0XHRcdFx0dmFyIGJsb2NrID0gZG9tLmdldFBhcmVudChmb3JtYXROb2RlLCBpc1RleHRCbG9jayk7XG5cblx0XHRcdFx0XHRpZiAoYmxvY2sgJiYgZG9tLmlzRW1wdHkoYmxvY2spKSB7XG5cdFx0XHRcdFx0XHQvLyBSZXBsYWNlIGZvcm1hdE5vZGUgd2l0aCBjYXJldENvbnRhaW5lciB3aGVuIHJlbW92aW5nIGZvcm1hdCBmcm9tIGVtcHR5IGJsb2NrIGxpa2UgPHA+PGI+fDwvYj48L3A+XG5cdFx0XHRcdFx0XHRmb3JtYXROb2RlLnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKGNhcmV0Q29udGFpbmVyLCBmb3JtYXROb2RlKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0Ly8gSW5zZXJ0IGNhcmV0IGNvbnRhaW5lciBhZnRlciB0aGUgZm9ybWF0dGVkIG5vZGVcblx0XHRcdFx0XHRcdGRvbS5pbnNlcnRBZnRlcihjYXJldENvbnRhaW5lciwgZm9ybWF0Tm9kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Ly8gTW92ZSBzZWxlY3Rpb24gdG8gdGV4dCBub2RlXG5cdFx0XHRcdFx0c2VsZWN0aW9uLnNldEN1cnNvckxvY2F0aW9uKG5vZGUsIDEpO1xuXG5cdFx0XHRcdFx0Ly8gSWYgdGhlIGZvcm1hdE5vZGUgaXMgZW1wdHksIHdlIGNhbiByZW1vdmUgaXQgc2FmZWx5LlxuXHRcdFx0XHRcdGlmIChkb20uaXNFbXB0eShmb3JtYXROb2RlKSkge1xuXHRcdFx0XHRcdFx0ZG9tLnJlbW92ZShmb3JtYXROb2RlKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0Ly8gQ2hlY2tzIGlmIHRoZSBwYXJlbnQgY2FyZXQgY29udGFpbmVyIG5vZGUgaXNuJ3QgZW1wdHkgaWYgdGhhdCBpcyB0aGUgY2FzZSBpdFxuXHRcdFx0Ly8gd2lsbCByZW1vdmUgdGhlIGJvZ3VzIHN0YXRlIG9uIGFsbCBjaGlsZHJlbiB0aGF0IGlzbid0IGVtcHR5XG5cdFx0XHRmdW5jdGlvbiB1bm1hcmtCb2d1c0NhcmV0UGFyZW50cygpIHtcblx0XHRcdFx0dmFyIGNhcmV0Q29udGFpbmVyO1xuXG5cdFx0XHRcdGNhcmV0Q29udGFpbmVyID0gZ2V0UGFyZW50Q2FyZXRDb250YWluZXIoc2VsZWN0aW9uLmdldFN0YXJ0KCkpO1xuXHRcdFx0XHRpZiAoY2FyZXRDb250YWluZXIgJiYgIWRvbS5pc0VtcHR5KGNhcmV0Q29udGFpbmVyKSkge1xuXHRcdFx0XHRcdHdhbGsoY2FyZXRDb250YWluZXIsIGZ1bmN0aW9uKG5vZGUpIHtcblx0XHRcdFx0XHRcdGlmIChub2RlLm5vZGVUeXBlID09IDEgJiYgbm9kZS5pZCAhPT0gY2FyZXRDb250YWluZXJJZCAmJiAhZG9tLmlzRW1wdHkobm9kZSkpIHtcblx0XHRcdFx0XHRcdFx0ZG9tLnNldEF0dHJpYihub2RlLCAnZGF0YS1tY2UtYm9ndXMnLCBudWxsKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9LCAnY2hpbGROb2RlcycpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdC8vIE9ubHkgYmluZCB0aGUgY2FyZXQgZXZlbnRzIG9uY2Vcblx0XHRcdGlmICghZWQuX2hhc0NhcmV0RXZlbnRzKSB7XG5cdFx0XHRcdC8vIE1hcmsgY3VycmVudCBjYXJldCBjb250YWluZXIgZWxlbWVudHMgYXMgYm9ndXMgd2hlbiBnZXR0aW5nIHRoZSBjb250ZW50cyBzbyB3ZSBkb24ndCBlbmQgdXAgd2l0aCBlbXB0eSBlbGVtZW50c1xuXHRcdFx0XHRtYXJrQ2FyZXRDb250YWluZXJzQm9ndXMgPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHR2YXIgbm9kZXMgPSBbXSwgaTtcblxuXHRcdFx0XHRcdGlmIChpc0NhcmV0Q29udGFpbmVyRW1wdHkoZ2V0UGFyZW50Q2FyZXRDb250YWluZXIoc2VsZWN0aW9uLmdldFN0YXJ0KCkpLCBub2RlcykpIHtcblx0XHRcdFx0XHRcdC8vIE1hcmsgY2hpbGRyZW5cblx0XHRcdFx0XHRcdGkgPSBub2Rlcy5sZW5ndGg7XG5cdFx0XHRcdFx0XHR3aGlsZSAoaS0tKSB7XG5cdFx0XHRcdFx0XHRcdGRvbS5zZXRBdHRyaWIobm9kZXNbaV0sICdkYXRhLW1jZS1ib2d1cycsICcxJyk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9O1xuXG5cdFx0XHRcdGRpc2FibGVDYXJldENvbnRhaW5lciA9IGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0XHR2YXIga2V5Q29kZSA9IGUua2V5Q29kZTtcblxuXHRcdFx0XHRcdHJlbW92ZUNhcmV0Q29udGFpbmVyKCk7XG5cblx0XHRcdFx0XHQvLyBSZW1vdmUgY2FyZXQgY29udGFpbmVyIGlmIGl0J3MgZW1wdHlcblx0XHRcdFx0XHRpZiAoa2V5Q29kZSA9PSA4ICYmIHNlbGVjdGlvbi5pc0NvbGxhcHNlZCgpICYmIHNlbGVjdGlvbi5nZXRTdGFydCgpLmlubmVySFRNTCA9PSBJTlZJU0lCTEVfQ0hBUikge1xuXHRcdFx0XHRcdFx0cmVtb3ZlQ2FyZXRDb250YWluZXIoZ2V0UGFyZW50Q2FyZXRDb250YWluZXIoc2VsZWN0aW9uLmdldFN0YXJ0KCkpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHQvLyBSZW1vdmUgY2FyZXQgY29udGFpbmVyIG9uIGtleWRvd24gYW5kIGl0J3MgbGVmdC9yaWdodCBhcnJvdyBrZXlzXG5cdFx0XHRcdFx0aWYgKGtleUNvZGUgPT0gMzcgfHwga2V5Q29kZSA9PSAzOSkge1xuXHRcdFx0XHRcdFx0cmVtb3ZlQ2FyZXRDb250YWluZXIoZ2V0UGFyZW50Q2FyZXRDb250YWluZXIoc2VsZWN0aW9uLmdldFN0YXJ0KCkpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHR1bm1hcmtCb2d1c0NhcmV0UGFyZW50cygpO1xuXHRcdFx0XHR9O1xuXG5cdFx0XHRcdC8vIFJlbW92ZSBib2d1cyBzdGF0ZSBpZiB0aGV5IGdvdCBmaWxsZWQgYnkgY29udGVudHMgdXNpbmcgZWRpdG9yLnNlbGVjdGlvbi5zZXRDb250ZW50XG5cdFx0XHRcdGVkLm9uKCdTZXRDb250ZW50JywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRcdGlmIChlLnNlbGVjdGlvbikge1xuXHRcdFx0XHRcdFx0dW5tYXJrQm9ndXNDYXJldFBhcmVudHMoKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXHRcdFx0XHRlZC5faGFzQ2FyZXRFdmVudHMgPSB0cnVlO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBEbyBhcHBseSBvciByZW1vdmUgY2FyZXQgZm9ybWF0XG5cdFx0XHRpZiAodHlwZSA9PSBcImFwcGx5XCIpIHtcblx0XHRcdFx0YXBwbHlDYXJldEZvcm1hdCgpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0cmVtb3ZlQ2FyZXRGb3JtYXQoKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHQvKipcblx0XHQgKiBNb3ZlcyB0aGUgc3RhcnQgdG8gdGhlIGZpcnN0IHN1aXRhYmxlIHRleHQgbm9kZS5cblx0XHQgKi9cblx0XHRmdW5jdGlvbiBtb3ZlU3RhcnQocm5nKSB7XG5cdFx0XHR2YXIgY29udGFpbmVyID0gcm5nLnN0YXJ0Q29udGFpbmVyLFxuXHRcdFx0XHRcdG9mZnNldCA9IHJuZy5zdGFydE9mZnNldCwgaXNBdEVuZE9mVGV4dCxcblx0XHRcdFx0XHR3YWxrZXIsIG5vZGUsIG5vZGVzLCB0bXBOb2RlO1xuXG5cdFx0XHRpZiAocm5nLnN0YXJ0Q29udGFpbmVyID09IHJuZy5lbmRDb250YWluZXIpIHtcblx0XHRcdFx0aWYgKGlzSW5saW5lQmxvY2socm5nLnN0YXJ0Q29udGFpbmVyLmNoaWxkTm9kZXNbcm5nLnN0YXJ0T2Zmc2V0XSkpIHtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0Ly8gQ29udmVydCB0ZXh0IG5vZGUgaW50byBpbmRleCBpZiBwb3NzaWJsZVxuXHRcdFx0aWYgKGNvbnRhaW5lci5ub2RlVHlwZSA9PSAzICYmIG9mZnNldCA+PSBjb250YWluZXIubm9kZVZhbHVlLmxlbmd0aCkge1xuXHRcdFx0XHQvLyBHZXQgdGhlIHBhcmVudCBjb250YWluZXIgbG9jYXRpb24gYW5kIHdhbGsgZnJvbSB0aGVyZVxuXHRcdFx0XHRvZmZzZXQgPSBub2RlSW5kZXgoY29udGFpbmVyKTtcblx0XHRcdFx0Y29udGFpbmVyID0gY29udGFpbmVyLnBhcmVudE5vZGU7XG5cdFx0XHRcdGlzQXRFbmRPZlRleHQgPSB0cnVlO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBNb3ZlIHN0YXJ0Q29udGFpbmVyL3N0YXJ0T2Zmc2V0IGluIHRvIGEgc3VpdGFibGUgbm9kZVxuXHRcdFx0aWYgKGNvbnRhaW5lci5ub2RlVHlwZSA9PSAxKSB7XG5cdFx0XHRcdG5vZGVzID0gY29udGFpbmVyLmNoaWxkTm9kZXM7XG5cdFx0XHRcdGNvbnRhaW5lciA9IG5vZGVzW01hdGgubWluKG9mZnNldCwgbm9kZXMubGVuZ3RoIC0gMSldO1xuXHRcdFx0XHR3YWxrZXIgPSBuZXcgVHJlZVdhbGtlcihjb250YWluZXIsIGRvbS5nZXRQYXJlbnQoY29udGFpbmVyLCBkb20uaXNCbG9jaykpO1xuXG5cdFx0XHRcdC8vIElmIG9mZnNldCBpcyBhdCBlbmQgb2YgdGhlIHBhcmVudCBub2RlIHdhbGsgdG8gdGhlIG5leHQgb25lXG5cdFx0XHRcdGlmIChvZmZzZXQgPiBub2Rlcy5sZW5ndGggLSAxIHx8IGlzQXRFbmRPZlRleHQpIHtcblx0XHRcdFx0XHR3YWxrZXIubmV4dCgpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Zm9yIChub2RlID0gd2Fsa2VyLmN1cnJlbnQoKTsgbm9kZTsgbm9kZSA9IHdhbGtlci5uZXh0KCkpIHtcblx0XHRcdFx0XHRpZiAobm9kZS5ub2RlVHlwZSA9PSAzICYmICFpc1doaXRlU3BhY2VOb2RlKG5vZGUpKSB7XG5cdFx0XHRcdFx0XHQvLyBJRSBoYXMgYSBcIm5lYXRcIiBmZWF0dXJlIHdoZXJlIGl0IG1vdmVzIHRoZSBzdGFydCBub2RlIGludG8gdGhlIGNsb3Nlc3QgZWxlbWVudFxuXHRcdFx0XHRcdFx0Ly8gd2UgY2FuIGF2b2lkIHRoaXMgYnkgaW5zZXJ0aW5nIGFuIGVsZW1lbnQgYmVmb3JlIGl0IGFuZCB0aGVuIHJlbW92ZSBpdCBhZnRlciB3ZSBzZXQgdGhlIHNlbGVjdGlvblxuXHRcdFx0XHRcdFx0dG1wTm9kZSA9IGRvbS5jcmVhdGUoJ2EnLCB7J2RhdGEtbWNlLWJvZ3VzJzogJ2FsbCd9LCBJTlZJU0lCTEVfQ0hBUik7XG5cdFx0XHRcdFx0XHRub2RlLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHRtcE5vZGUsIG5vZGUpO1xuXG5cdFx0XHRcdFx0XHQvLyBTZXQgc2VsZWN0aW9uIGFuZCByZW1vdmUgdG1wTm9kZVxuXHRcdFx0XHRcdFx0cm5nLnNldFN0YXJ0KG5vZGUsIDApO1xuXHRcdFx0XHRcdFx0c2VsZWN0aW9uLnNldFJuZyhybmcpO1xuXHRcdFx0XHRcdFx0ZG9tLnJlbW92ZSh0bXBOb2RlKTtcblxuXHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblx0fTtcbn0pO1xuXG4vLyBJbmNsdWRlZCBmcm9tOiBqcy90aW55bWNlL2NsYXNzZXMvdW5kby9EaWZmLmpzXG5cbi8qKlxuICogRGlmZi5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE2IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKipcbiAqIEpTIEltcGxlbWVudGF0aW9uIG9mIHRoZSBPKE5EKSBEaWZmZXJlbmNlIEFsZ29yaXRobSBieSBFdWdlbmUgVy4gTXllcnMuXG4gKlxuICogQGNsYXNzIHRpbnltY2UudW5kby5EaWZmXG4gKiBAcHJpdmF0ZVxuICovXG5kZWZpbmUoXCJ0aW55bWNlL3VuZG8vRGlmZlwiLCBbXG5dLCBmdW5jdGlvbiAoKSB7XG5cdHZhciBLRUVQID0gMCwgSU5TRVJUID0gMSwgREVMRVRFID0gMjtcblxuXHR2YXIgZGlmZiA9IGZ1bmN0aW9uIChsZWZ0LCByaWdodCkge1xuXHRcdHZhciBzaXplID0gbGVmdC5sZW5ndGggKyByaWdodC5sZW5ndGggKyAyO1xuXHRcdHZhciB2RG93biA9IG5ldyBBcnJheShzaXplKTtcblx0XHR2YXIgdlVwID0gbmV3IEFycmF5KHNpemUpO1xuXG5cdFx0dmFyIHNuYWtlID0gZnVuY3Rpb24gKHN0YXJ0LCBlbmQsIGRpYWcpIHtcblx0XHRcdHJldHVybiB7XG5cdFx0XHRcdHN0YXJ0OiBzdGFydCxcblx0XHRcdFx0ZW5kOiBlbmQsXG5cdFx0XHRcdGRpYWc6IGRpYWdcblx0XHRcdH07XG5cdFx0fTtcblxuXHRcdHZhciBidWlsZFNjcmlwdCA9IGZ1bmN0aW9uIChzdGFydDEsIGVuZDEsIHN0YXJ0MiwgZW5kMiwgc2NyaXB0KSB7XG5cdFx0XHR2YXIgbWlkZGxlID0gZ2V0TWlkZGxlU25ha2Uoc3RhcnQxLCBlbmQxLCBzdGFydDIsIGVuZDIpO1xuXG5cdFx0XHRpZiAobWlkZGxlID09PSBudWxsIHx8IG1pZGRsZS5zdGFydCA9PT0gZW5kMSAmJiBtaWRkbGUuZGlhZyA9PT0gZW5kMSAtIGVuZDIgfHxcblx0XHRcdFx0bWlkZGxlLmVuZCA9PT0gc3RhcnQxICYmIG1pZGRsZS5kaWFnID09PSBzdGFydDEgLSBzdGFydDIpIHtcblx0XHRcdFx0dmFyIGkgPSBzdGFydDE7XG5cdFx0XHRcdHZhciBqID0gc3RhcnQyO1xuXHRcdFx0XHR3aGlsZSAoaSA8IGVuZDEgfHwgaiA8IGVuZDIpIHtcblx0XHRcdFx0XHRpZiAoaSA8IGVuZDEgJiYgaiA8IGVuZDIgJiYgbGVmdFtpXSA9PT0gcmlnaHRbal0pIHtcblx0XHRcdFx0XHRcdHNjcmlwdC5wdXNoKFtLRUVQLCBsZWZ0W2ldXSk7XG5cdFx0XHRcdFx0XHQrK2k7XG5cdFx0XHRcdFx0XHQrK2o7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGlmIChlbmQxIC0gc3RhcnQxID4gZW5kMiAtIHN0YXJ0Mikge1xuXHRcdFx0XHRcdFx0XHRzY3JpcHQucHVzaChbREVMRVRFLCBsZWZ0W2ldXSk7XG5cdFx0XHRcdFx0XHRcdCsraTtcblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdHNjcmlwdC5wdXNoKFtJTlNFUlQsIHJpZ2h0W2pdXSk7XG5cdFx0XHRcdFx0XHRcdCsrajtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGJ1aWxkU2NyaXB0KHN0YXJ0MSwgbWlkZGxlLnN0YXJ0LCBzdGFydDIsIG1pZGRsZS5zdGFydCAtIG1pZGRsZS5kaWFnLCBzY3JpcHQpO1xuXHRcdFx0XHRmb3IgKHZhciBpMiA9IG1pZGRsZS5zdGFydDsgaTIgPCBtaWRkbGUuZW5kOyArK2kyKSB7XG5cdFx0XHRcdFx0c2NyaXB0LnB1c2goW0tFRVAsIGxlZnRbaTJdXSk7XG5cdFx0XHRcdH1cblx0XHRcdFx0YnVpbGRTY3JpcHQobWlkZGxlLmVuZCwgZW5kMSwgbWlkZGxlLmVuZCAtIG1pZGRsZS5kaWFnLCBlbmQyLCBzY3JpcHQpO1xuXHRcdFx0fVxuXHRcdH07XG5cblx0XHR2YXIgYnVpbGRTbmFrZSA9IGZ1bmN0aW9uIChzdGFydCwgZGlhZywgZW5kMSwgZW5kMikge1xuXHRcdFx0dmFyIGVuZCA9IHN0YXJ0O1xuXHRcdFx0d2hpbGUgKGVuZCAtIGRpYWcgPCBlbmQyICYmIGVuZCA8IGVuZDEgJiYgbGVmdFtlbmRdID09PSByaWdodFtlbmQgLSBkaWFnXSkge1xuXHRcdFx0XHQrK2VuZDtcblx0XHRcdH1cblx0XHRcdHJldHVybiBzbmFrZShzdGFydCwgZW5kLCBkaWFnKTtcblx0XHR9O1xuXG5cdFx0dmFyIGdldE1pZGRsZVNuYWtlID0gZnVuY3Rpb24gKHN0YXJ0MSwgZW5kMSwgc3RhcnQyLCBlbmQyKSB7XG5cdFx0XHQvLyBNeWVycyBBbGdvcml0aG1cblx0XHRcdC8vIEluaXRpYWxpc2F0aW9uc1xuXHRcdFx0dmFyIG0gPSBlbmQxIC0gc3RhcnQxO1xuXHRcdFx0dmFyIG4gPSBlbmQyIC0gc3RhcnQyO1xuXHRcdFx0aWYgKG0gPT09IDAgfHwgbiA9PT0gMCkge1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblxuXHRcdFx0dmFyIGRlbHRhID0gbSAtIG47XG5cdFx0XHR2YXIgc3VtID0gbiArIG07XG5cdFx0XHR2YXIgb2Zmc2V0ID0gKHN1bSAlIDIgPT09IDAgPyBzdW0gOiBzdW0gKyAxKSAvIDI7XG5cdFx0XHR2RG93blsxICsgb2Zmc2V0XSA9IHN0YXJ0MTtcblx0XHRcdHZVcFsxICsgb2Zmc2V0XSA9IGVuZDEgKyAxO1xuXG5cdFx0XHRmb3IgKHZhciBkID0gMDsgZCA8PSBvZmZzZXQ7ICsrZCkge1xuXHRcdFx0XHQvLyBEb3duXG5cdFx0XHRcdGZvciAodmFyIGsgPSAtZDsgayA8PSBkOyBrICs9IDIpIHtcblx0XHRcdFx0XHQvLyBGaXJzdCBzdGVwXG5cblx0XHRcdFx0XHR2YXIgaSA9IGsgKyBvZmZzZXQ7XG5cdFx0XHRcdFx0aWYgKGsgPT09IC1kIHx8IGsgIT0gZCAmJiB2RG93bltpIC0gMV0gPCB2RG93bltpICsgMV0pIHtcblx0XHRcdFx0XHRcdHZEb3duW2ldID0gdkRvd25baSArIDFdO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHR2RG93bltpXSA9IHZEb3duW2kgLSAxXSArIDE7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0dmFyIHggPSB2RG93bltpXTtcblx0XHRcdFx0XHR2YXIgeSA9IHggLSBzdGFydDEgKyBzdGFydDIgLSBrO1xuXG5cdFx0XHRcdFx0d2hpbGUgKHggPCBlbmQxICYmIHkgPCBlbmQyICYmIGxlZnRbeF0gPT09IHJpZ2h0W3ldKSB7XG5cdFx0XHRcdFx0XHR2RG93bltpXSA9ICsreDtcblx0XHRcdFx0XHRcdCsreTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0Ly8gU2Vjb25kIHN0ZXBcblx0XHRcdFx0XHRpZiAoZGVsdGEgJSAyICE9IDAgJiYgZGVsdGEgLSBkIDw9IGsgJiYgayA8PSBkZWx0YSArIGQpIHtcblx0XHRcdFx0XHRcdGlmICh2VXBbaSAtIGRlbHRhXSA8PSB2RG93bltpXSkge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gYnVpbGRTbmFrZSh2VXBbaSAtIGRlbHRhXSwgayArIHN0YXJ0MSAtIHN0YXJ0MiwgZW5kMSwgZW5kMik7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gVXBcblx0XHRcdFx0Zm9yIChrID0gZGVsdGEgLSBkOyBrIDw9IGRlbHRhICsgZDsgayArPSAyKSB7XG5cdFx0XHRcdFx0Ly8gRmlyc3Qgc3RlcFxuXHRcdFx0XHRcdGkgPSBrICsgb2Zmc2V0IC0gZGVsdGE7XG5cdFx0XHRcdFx0aWYgKGsgPT09IGRlbHRhIC0gZCB8fCBrICE9IGRlbHRhICsgZCAmJiB2VXBbaSArIDFdIDw9IHZVcFtpIC0gMV0pIHtcblx0XHRcdFx0XHRcdHZVcFtpXSA9IHZVcFtpICsgMV0gLSAxO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHR2VXBbaV0gPSB2VXBbaSAtIDFdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHggPSB2VXBbaV0gLSAxO1xuXHRcdFx0XHRcdHkgPSB4IC0gc3RhcnQxICsgc3RhcnQyIC0gaztcblx0XHRcdFx0XHR3aGlsZSAoeCA+PSBzdGFydDEgJiYgeSA+PSBzdGFydDIgJiYgbGVmdFt4XSA9PT0gcmlnaHRbeV0pIHtcblx0XHRcdFx0XHRcdHZVcFtpXSA9IHgtLTtcblx0XHRcdFx0XHRcdHktLTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0Ly8gU2Vjb25kIHN0ZXBcblx0XHRcdFx0XHRpZiAoZGVsdGEgJSAyID09PSAwICYmIC1kIDw9IGsgJiYgayA8PSBkKSB7XG5cdFx0XHRcdFx0XHRpZiAodlVwW2ldIDw9IHZEb3duW2kgKyBkZWx0YV0pIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIGJ1aWxkU25ha2UodlVwW2ldLCBrICsgc3RhcnQxIC0gc3RhcnQyLCBlbmQxLCBlbmQyKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9O1xuXG5cdFx0dmFyIHNjcmlwdCA9IFtdO1xuXHRcdGJ1aWxkU2NyaXB0KDAsIGxlZnQubGVuZ3RoLCAwLCByaWdodC5sZW5ndGgsIHNjcmlwdCk7XG5cdFx0cmV0dXJuIHNjcmlwdDtcblx0fTtcblxuXHRyZXR1cm4ge1xuXHRcdEtFRVA6IEtFRVAsXG5cdFx0REVMRVRFOiBERUxFVEUsXG5cdFx0SU5TRVJUOiBJTlNFUlQsXG5cdFx0ZGlmZjogZGlmZlxuXHR9O1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy91bmRvL0ZyYWdtZW50cy5qc1xuXG4vKipcbiAqIEZyYWdtZW50cy5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE2IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKipcbiAqIFRoaXMgbW9kdWxlIHJlYWRzIGFuZCBhcHBsaWVzIGh0bWwgZnJhZ21lbnRzIGZyb20vdG8gZG9tIG5vZGVzLlxuICpcbiAqIEBjbGFzcyB0aW55bWNlLnVuZG8uRnJhZ21lbnRzXG4gKiBAcHJpdmF0ZVxuICovXG5kZWZpbmUoXCJ0aW55bWNlL3VuZG8vRnJhZ21lbnRzXCIsIFtcblx0XCJ0aW55bWNlL3V0aWwvQXJyXCIsXG5cdFwidGlueW1jZS9odG1sL0VudGl0aWVzXCIsXG5cdFwidGlueW1jZS91bmRvL0RpZmZcIlxuXSwgZnVuY3Rpb24gKEFyciwgRW50aXRpZXMsIERpZmYpIHtcblx0dmFyIGdldE91dGVySHRtbCA9IGZ1bmN0aW9uIChlbG0pIHtcblx0XHRpZiAoZWxtLm5vZGVUeXBlID09PSAxKSB7XG5cdFx0XHRyZXR1cm4gZWxtLm91dGVySFRNTDtcblx0XHR9IGVsc2UgaWYgKGVsbS5ub2RlVHlwZSA9PT0gMykge1xuXHRcdFx0cmV0dXJuIEVudGl0aWVzLmVuY29kZVJhdyhlbG0uZGF0YSwgZmFsc2UpO1xuXHRcdH0gZWxzZSBpZiAoZWxtLm5vZGVUeXBlID09PSA4KSB7XG5cdFx0XHRyZXR1cm4gJzwhLS0nICsgZWxtLmRhdGEgKyAnLS0+Jztcblx0XHR9XG5cblx0XHRyZXR1cm4gJyc7XG5cdH07XG5cblx0dmFyIGNyZWF0ZUZyYWdtZW50ID0gZnVuY3Rpb24oaHRtbCkge1xuXHRcdHZhciBmcmFnLCBub2RlLCBjb250YWluZXI7XG5cblx0XHRjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXHRcdGZyYWcgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG5cblx0XHRpZiAoaHRtbCkge1xuXHRcdFx0Y29udGFpbmVyLmlubmVySFRNTCA9IGh0bWw7XG5cdFx0fVxuXG5cdFx0d2hpbGUgKChub2RlID0gY29udGFpbmVyLmZpcnN0Q2hpbGQpKSB7XG5cdFx0XHRmcmFnLmFwcGVuZENoaWxkKG5vZGUpO1xuXHRcdH1cblxuXHRcdHJldHVybiBmcmFnO1xuXHR9O1xuXG5cdHZhciBpbnNlcnRBdCA9IGZ1bmN0aW9uIChlbG0sIGh0bWwsIGluZGV4KSB7XG5cdFx0dmFyIGZyYWdtZW50ID0gY3JlYXRlRnJhZ21lbnQoaHRtbCk7XG5cdFx0aWYgKGVsbS5oYXNDaGlsZE5vZGVzKCkgJiYgaW5kZXggPCBlbG0uY2hpbGROb2Rlcy5sZW5ndGgpIHtcblx0XHRcdHZhciB0YXJnZXQgPSBlbG0uY2hpbGROb2Rlc1tpbmRleF07XG5cdFx0XHR0YXJnZXQucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoZnJhZ21lbnQsIHRhcmdldCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGVsbS5hcHBlbmRDaGlsZChmcmFnbWVudCk7XG5cdFx0fVxuXHR9O1xuXG5cdHZhciByZW1vdmVBdCA9IGZ1bmN0aW9uIChlbG0sIGluZGV4KSB7XG5cdFx0aWYgKGVsbS5oYXNDaGlsZE5vZGVzKCkgJiYgaW5kZXggPCBlbG0uY2hpbGROb2Rlcy5sZW5ndGgpIHtcblx0XHRcdHZhciB0YXJnZXQgPSBlbG0uY2hpbGROb2Rlc1tpbmRleF07XG5cdFx0XHR0YXJnZXQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0YXJnZXQpO1xuXHRcdH1cblx0fTtcblxuXHR2YXIgYXBwbHlEaWZmID0gZnVuY3Rpb24gKGRpZmYsIGVsbSkge1xuXHRcdHZhciBpbmRleCA9IDA7XG5cdFx0QXJyLmVhY2goZGlmZiwgZnVuY3Rpb24gKGFjdGlvbikge1xuXHRcdFx0aWYgKGFjdGlvblswXSA9PT0gRGlmZi5LRUVQKSB7XG5cdFx0XHRcdGluZGV4Kys7XG5cdFx0XHR9IGVsc2UgaWYgKGFjdGlvblswXSA9PT0gRGlmZi5JTlNFUlQpIHtcblx0XHRcdFx0aW5zZXJ0QXQoZWxtLCBhY3Rpb25bMV0sIGluZGV4KTtcblx0XHRcdFx0aW5kZXgrKztcblx0XHRcdH0gZWxzZSBpZiAoYWN0aW9uWzBdID09PSBEaWZmLkRFTEVURSkge1xuXHRcdFx0XHRyZW1vdmVBdChlbG0sIGluZGV4KTtcblx0XHRcdH1cblx0XHR9KTtcblx0fTtcblxuXHR2YXIgcmVhZCA9IGZ1bmN0aW9uIChlbG0pIHtcblx0XHRyZXR1cm4gQXJyLm1hcChlbG0uY2hpbGROb2RlcywgZ2V0T3V0ZXJIdG1sKTtcblx0fTtcblxuXHR2YXIgd3JpdGUgPSBmdW5jdGlvbiAoZnJhZ21lbnRzLCBlbG0pIHtcblx0XHR2YXIgY3VycmVudEZyYWdtZW50cyA9IEFyci5tYXAoZWxtLmNoaWxkTm9kZXMsIGdldE91dGVySHRtbCk7XG5cdFx0YXBwbHlEaWZmKERpZmYuZGlmZihjdXJyZW50RnJhZ21lbnRzLCBmcmFnbWVudHMpLCBlbG0pO1xuXHRcdHJldHVybiBlbG07XG5cdH07XG5cblx0cmV0dXJuIHtcblx0XHRyZWFkOiByZWFkLFxuXHRcdHdyaXRlOiB3cml0ZVxuXHR9O1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy91bmRvL0xldmVscy5qc1xuXG4vKipcbiAqIExldmVscy5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE2IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKipcbiAqIFRoaXMgbW9kdWxlIGhhbmRsZXMgZ2V0dGluZy9zZXR0aW5nIHVuZG8gbGV2ZWxzIHRvL2Zyb20gZWRpdG9yIGluc3RhbmNlcy5cbiAqXG4gKiBAY2xhc3MgdGlueW1jZS51bmRvLkxldmVsc1xuICogQHByaXZhdGVcbiAqL1xuZGVmaW5lKFwidGlueW1jZS91bmRvL0xldmVsc1wiLCBbXG5cdFwidGlueW1jZS91dGlsL0FyclwiLFxuXHRcInRpbnltY2UvdW5kby9GcmFnbWVudHNcIlxuXSwgZnVuY3Rpb24gKEFyciwgRnJhZ21lbnRzKSB7XG5cdHZhciBoYXNJZnJhbWVzID0gZnVuY3Rpb24gKGh0bWwpIHtcblx0XHRyZXR1cm4gaHRtbC5pbmRleE9mKCc8L2lmcmFtZT4nKSAhPT0gLTE7XG5cdH07XG5cblx0dmFyIGNyZWF0ZUZyYWdtZW50ZWRMZXZlbCA9IGZ1bmN0aW9uIChmcmFnbWVudHMpIHtcblx0XHRyZXR1cm4ge1xuXHRcdFx0dHlwZTogJ2ZyYWdtZW50ZWQnLFxuXHRcdFx0ZnJhZ21lbnRzOiBmcmFnbWVudHMsXG5cdFx0XHRjb250ZW50OiAnJyxcblx0XHRcdGJvb2ttYXJrOiBudWxsLFxuXHRcdFx0YmVmb3JlQm9va21hcms6IG51bGxcblx0XHR9O1xuXHR9O1xuXG5cdHZhciBjcmVhdGVDb21wbGV0ZUxldmVsID0gZnVuY3Rpb24gKGNvbnRlbnQpIHtcblx0XHRyZXR1cm4ge1xuXHRcdFx0dHlwZTogJ2NvbXBsZXRlJyxcblx0XHRcdGZyYWdtZW50czogbnVsbCxcblx0XHRcdGNvbnRlbnQ6IGNvbnRlbnQsXG5cdFx0XHRib29rbWFyazogbnVsbCxcblx0XHRcdGJlZm9yZUJvb2ttYXJrOiBudWxsXG5cdFx0fTtcblx0fTtcblxuXHR2YXIgY3JlYXRlRnJvbUVkaXRvciA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcblx0XHR2YXIgZnJhZ21lbnRzLCBjb250ZW50O1xuXG5cdFx0ZnJhZ21lbnRzID0gRnJhZ21lbnRzLnJlYWQoZWRpdG9yLmdldEJvZHkoKSk7XG5cdFx0Y29udGVudCA9IEFyci5tYXAoZnJhZ21lbnRzLCBmdW5jdGlvbiAoaHRtbCkge1xuXHRcdFx0cmV0dXJuIGVkaXRvci5zZXJpYWxpemVyLnRyaW1Db250ZW50KGh0bWwpO1xuXHRcdH0pLmpvaW4oJycpO1xuXG5cdFx0cmV0dXJuIGhhc0lmcmFtZXMoY29udGVudCkgPyBjcmVhdGVGcmFnbWVudGVkTGV2ZWwoZnJhZ21lbnRzKSA6IGNyZWF0ZUNvbXBsZXRlTGV2ZWwoY29udGVudCk7XG5cdH07XG5cblx0dmFyIGFwcGx5VG9FZGl0b3IgPSBmdW5jdGlvbiAoZWRpdG9yLCBsZXZlbCwgYmVmb3JlKSB7XG5cdFx0aWYgKGxldmVsLnR5cGUgPT09ICdmcmFnbWVudGVkJykge1xuXHRcdFx0RnJhZ21lbnRzLndyaXRlKGxldmVsLmZyYWdtZW50cywgZWRpdG9yLmdldEJvZHkoKSk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGVkaXRvci5zZXRDb250ZW50KGxldmVsLmNvbnRlbnQsIHtmb3JtYXQ6ICdyYXcnfSk7XG5cdFx0fVxuXG5cdFx0ZWRpdG9yLnNlbGVjdGlvbi5tb3ZlVG9Cb29rbWFyayhiZWZvcmUgPyBsZXZlbC5iZWZvcmVCb29rbWFyayA6IGxldmVsLmJvb2ttYXJrKTtcblx0fTtcblxuXHR2YXIgZ2V0TGV2ZWxDb250ZW50ID0gZnVuY3Rpb24gKGxldmVsKSB7XG5cdFx0cmV0dXJuIGxldmVsLnR5cGUgPT09ICdmcmFnbWVudGVkJyA/IGxldmVsLmZyYWdtZW50cy5qb2luKCcnKSA6IGxldmVsLmNvbnRlbnQ7XG5cdH07XG5cblx0dmFyIGlzRXEgPSBmdW5jdGlvbiAobGV2ZWwxLCBsZXZlbDIpIHtcblx0XHRyZXR1cm4gZ2V0TGV2ZWxDb250ZW50KGxldmVsMSkgPT09IGdldExldmVsQ29udGVudChsZXZlbDIpO1xuXHR9O1xuXG5cdHJldHVybiB7XG5cdFx0Y3JlYXRlRnJhZ21lbnRlZExldmVsOiBjcmVhdGVGcmFnbWVudGVkTGV2ZWwsXG5cdFx0Y3JlYXRlQ29tcGxldGVMZXZlbDogY3JlYXRlQ29tcGxldGVMZXZlbCxcblx0XHRjcmVhdGVGcm9tRWRpdG9yOiBjcmVhdGVGcm9tRWRpdG9yLFxuXHRcdGFwcGx5VG9FZGl0b3I6IGFwcGx5VG9FZGl0b3IsXG5cdFx0aXNFcTogaXNFcVxuXHR9O1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy9VbmRvTWFuYWdlci5qc1xuXG4vKipcbiAqIFVuZG9NYW5hZ2VyLmpzXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgTEdQTCBMaWNlbnNlLlxuICogQ29weXJpZ2h0IChjKSAxOTk5LTIwMTUgRXBob3ggQ29ycC4gQWxsIHJpZ2h0cyByZXNlcnZlZFxuICpcbiAqIExpY2Vuc2U6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vbGljZW5zZVxuICogQ29udHJpYnV0aW5nOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2NvbnRyaWJ1dGluZ1xuICovXG5cbi8qKlxuICogVGhpcyBjbGFzcyBoYW5kbGVzIHRoZSB1bmRvL3JlZG8gaGlzdG9yeSBsZXZlbHMgZm9yIHRoZSBlZGl0b3IuIFNpbmNlIHRoZSBidWlsdC1pbiB1bmRvL3JlZG8gaGFzIG1ham9yIGRyYXdiYWNrcyBhIGN1c3RvbSBvbmUgd2FzIG5lZWRlZC5cbiAqXG4gKiBAY2xhc3MgdGlueW1jZS5VbmRvTWFuYWdlclxuICovXG5kZWZpbmUoXCJ0aW55bWNlL1VuZG9NYW5hZ2VyXCIsIFtcblx0XCJ0aW55bWNlL3V0aWwvVktcIixcblx0XCJ0aW55bWNlL3V0aWwvVG9vbHNcIixcblx0XCJ0aW55bWNlL3VuZG8vTGV2ZWxzXCIsXG5cdFwidGlueW1jZS9FbnZcIlxuXSwgZnVuY3Rpb24oVkssIFRvb2xzLCBMZXZlbHMsIEVudikge1xuXHRyZXR1cm4gZnVuY3Rpb24oZWRpdG9yKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLCBpbmRleCA9IDAsIGRhdGEgPSBbXSwgYmVmb3JlQm9va21hcmssIGlzRmlyc3RUeXBlZENoYXJhY3RlciwgbG9ja3MgPSAwO1xuXG5cdFx0ZnVuY3Rpb24gc2V0RGlydHkoc3RhdGUpIHtcblx0XHRcdGVkaXRvci5zZXREaXJ0eShzdGF0ZSk7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gYWRkTm9uVHlwaW5nVW5kb0xldmVsKGUpIHtcblx0XHRcdHNlbGYudHlwaW5nID0gZmFsc2U7XG5cdFx0XHRzZWxmLmFkZCh7fSwgZSk7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gZW5kVHlwaW5nKCkge1xuXHRcdFx0aWYgKHNlbGYudHlwaW5nKSB7XG5cdFx0XHRcdHNlbGYudHlwaW5nID0gZmFsc2U7XG5cdFx0XHRcdHNlbGYuYWRkKCk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0Ly8gQWRkIGluaXRpYWwgdW5kbyBsZXZlbCB3aGVuIHRoZSBlZGl0b3IgaXMgaW5pdGlhbGl6ZWRcblx0XHRlZGl0b3Iub24oJ2luaXQnLCBmdW5jdGlvbigpIHtcblx0XHRcdHNlbGYuYWRkKCk7XG5cdFx0fSk7XG5cblx0XHQvLyBHZXQgcG9zaXRpb24gYmVmb3JlIGFuIGV4ZWNDb21tYW5kIGlzIHByb2Nlc3NlZFxuXHRcdGVkaXRvci5vbignQmVmb3JlRXhlY0NvbW1hbmQnLCBmdW5jdGlvbihlKSB7XG5cdFx0XHR2YXIgY21kID0gZS5jb21tYW5kO1xuXG5cdFx0XHRpZiAoY21kICE9PSAnVW5kbycgJiYgY21kICE9PSAnUmVkbycgJiYgY21kICE9PSAnbWNlUmVwYWludCcpIHtcblx0XHRcdFx0ZW5kVHlwaW5nKCk7XG5cdFx0XHRcdHNlbGYuYmVmb3JlQ2hhbmdlKCk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHQvLyBBZGQgdW5kbyBsZXZlbCBhZnRlciBhbiBleGVjQ29tbWFuZCBjYWxsIHdhcyBtYWRlXG5cdFx0ZWRpdG9yLm9uKCdFeGVjQ29tbWFuZCcsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdHZhciBjbWQgPSBlLmNvbW1hbmQ7XG5cblx0XHRcdGlmIChjbWQgIT09ICdVbmRvJyAmJiBjbWQgIT09ICdSZWRvJyAmJiBjbWQgIT09ICdtY2VSZXBhaW50Jykge1xuXHRcdFx0XHRhZGROb25UeXBpbmdVbmRvTGV2ZWwoZSk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRlZGl0b3Iub24oJ09iamVjdFJlc2l6ZVN0YXJ0IEN1dCcsIGZ1bmN0aW9uKCkge1xuXHRcdFx0c2VsZi5iZWZvcmVDaGFuZ2UoKTtcblx0XHR9KTtcblxuXHRcdGVkaXRvci5vbignU2F2ZUNvbnRlbnQgT2JqZWN0UmVzaXplZCBibHVyJywgYWRkTm9uVHlwaW5nVW5kb0xldmVsKTtcblx0XHRlZGl0b3Iub24oJ0RyYWdFbmQnLCBhZGROb25UeXBpbmdVbmRvTGV2ZWwpO1xuXG5cdFx0ZWRpdG9yLm9uKCdLZXlVcCcsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdHZhciBrZXlDb2RlID0gZS5rZXlDb2RlO1xuXG5cdFx0XHQvLyBJZiBrZXkgaXMgcHJldmVudGVkIHRoZW4gZG9uJ3QgYWRkIHVuZG8gbGV2ZWxcblx0XHRcdC8vIFRoaXMgd291bGQgaGFwcGVuIG9uIGtleWJvYXJkIHNob3J0Y3V0cyBmb3IgZXhhbXBsZVxuXHRcdFx0aWYgKGUuaXNEZWZhdWx0UHJldmVudGVkKCkpIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoKGtleUNvZGUgPj0gMzMgJiYga2V5Q29kZSA8PSAzNikgfHwgKGtleUNvZGUgPj0gMzcgJiYga2V5Q29kZSA8PSA0MCkgfHwga2V5Q29kZSA9PT0gNDUgfHwgZS5jdHJsS2V5KSB7XG5cdFx0XHRcdGFkZE5vblR5cGluZ1VuZG9MZXZlbCgpO1xuXHRcdFx0XHRlZGl0b3Iubm9kZUNoYW5nZWQoKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGtleUNvZGUgPT09IDQ2IHx8IGtleUNvZGUgPT09IDggfHwgKEVudi5tYWMgJiYgKGtleUNvZGUgPT09IDkxIHx8IGtleUNvZGUgPT09IDkzKSkpIHtcblx0XHRcdFx0ZWRpdG9yLm5vZGVDaGFuZ2VkKCk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIEZpcmUgYSBUeXBpbmdVbmRvIGV2ZW50IG9uIHRoZSBmaXJzdCBjaGFyYWN0ZXIgZW50ZXJlZFxuXHRcdFx0aWYgKGlzRmlyc3RUeXBlZENoYXJhY3RlciAmJiBzZWxmLnR5cGluZykge1xuXHRcdFx0XHQvLyBNYWtlIGl0IGRpcnR5IGlmIHRoZSBjb250ZW50IHdhcyBjaGFuZ2VkIGFmdGVyIHR5cGluZyB0aGUgZmlyc3QgY2hhcmFjdGVyXG5cdFx0XHRcdGlmICghZWRpdG9yLmlzRGlydHkoKSkge1xuXHRcdFx0XHRcdHNldERpcnR5KGRhdGFbMF0gJiYgIUxldmVscy5pc0VxKExldmVscy5jcmVhdGVGcm9tRWRpdG9yKGVkaXRvciksIGRhdGFbMF0pKTtcblxuXHRcdFx0XHRcdC8vIEZpcmUgaW5pdGlhbCBjaGFuZ2UgZXZlbnRcblx0XHRcdFx0XHRpZiAoZWRpdG9yLmlzRGlydHkoKSkge1xuXHRcdFx0XHRcdFx0ZWRpdG9yLmZpcmUoJ2NoYW5nZScsIHtsZXZlbDogZGF0YVswXSwgbGFzdExldmVsOiBudWxsfSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0ZWRpdG9yLmZpcmUoJ1R5cGluZ1VuZG8nKTtcblx0XHRcdFx0aXNGaXJzdFR5cGVkQ2hhcmFjdGVyID0gZmFsc2U7XG5cdFx0XHRcdGVkaXRvci5ub2RlQ2hhbmdlZCgpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0ZWRpdG9yLm9uKCdLZXlEb3duJywgZnVuY3Rpb24oZSkge1xuXHRcdFx0dmFyIGtleUNvZGUgPSBlLmtleUNvZGU7XG5cblx0XHRcdC8vIElmIGtleSBpcyBwcmV2ZW50ZWQgdGhlbiBkb24ndCBhZGQgdW5kbyBsZXZlbFxuXHRcdFx0Ly8gVGhpcyB3b3VsZCBoYXBwZW4gb24ga2V5Ym9hcmQgc2hvcnRjdXRzIGZvciBleGFtcGxlXG5cdFx0XHRpZiAoZS5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkge1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdC8vIElzIGNoYXJhY3RlciBwb3NpdGlvbiBrZXlzIGxlZnQscmlnaHQsdXAsZG93bixob21lLGVuZCxwZ2Rvd24scGd1cCxlbnRlclxuXHRcdFx0aWYgKChrZXlDb2RlID49IDMzICYmIGtleUNvZGUgPD0gMzYpIHx8IChrZXlDb2RlID49IDM3ICYmIGtleUNvZGUgPD0gNDApIHx8IGtleUNvZGUgPT09IDQ1KSB7XG5cdFx0XHRcdGlmIChzZWxmLnR5cGluZykge1xuXHRcdFx0XHRcdGFkZE5vblR5cGluZ1VuZG9MZXZlbChlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0Ly8gSWYga2V5IGlzbid0IEN0cmwrQWx0L0FsdEdyXG5cdFx0XHR2YXIgbW9kS2V5ID0gKGUuY3RybEtleSAmJiAhZS5hbHRLZXkpIHx8IGUubWV0YUtleTtcblx0XHRcdGlmICgoa2V5Q29kZSA8IDE2IHx8IGtleUNvZGUgPiAyMCkgJiYga2V5Q29kZSAhPT0gMjI0ICYmIGtleUNvZGUgIT09IDkxICYmICFzZWxmLnR5cGluZyAmJiAhbW9kS2V5KSB7XG5cdFx0XHRcdHNlbGYuYmVmb3JlQ2hhbmdlKCk7XG5cdFx0XHRcdHNlbGYudHlwaW5nID0gdHJ1ZTtcblx0XHRcdFx0c2VsZi5hZGQoe30sIGUpO1xuXHRcdFx0XHRpc0ZpcnN0VHlwZWRDaGFyYWN0ZXIgPSB0cnVlO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0ZWRpdG9yLm9uKCdNb3VzZURvd24nLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRpZiAoc2VsZi50eXBpbmcpIHtcblx0XHRcdFx0YWRkTm9uVHlwaW5nVW5kb0xldmVsKGUpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0Ly8gQWRkIGtleWJvYXJkIHNob3J0Y3V0cyBmb3IgdW5kby9yZWRvIGtleXNcblx0XHRlZGl0b3IuYWRkU2hvcnRjdXQoJ21ldGEreicsICcnLCAnVW5kbycpO1xuXHRcdGVkaXRvci5hZGRTaG9ydGN1dCgnbWV0YSt5LG1ldGErc2hpZnQreicsICcnLCAnUmVkbycpO1xuXG5cdFx0ZWRpdG9yLm9uKCdBZGRVbmRvIFVuZG8gUmVkbyBDbGVhclVuZG9zJywgZnVuY3Rpb24oZSkge1xuXHRcdFx0aWYgKCFlLmlzRGVmYXVsdFByZXZlbnRlZCgpKSB7XG5cdFx0XHRcdGVkaXRvci5ub2RlQ2hhbmdlZCgpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0Lyplc2xpbnQgY29uc2lzdGVudC10aGlzOjAgKi9cblx0XHRzZWxmID0ge1xuXHRcdFx0Ly8gRXhwbG9kZSBmb3IgZGVidWdnaW5nIHJlYXNvbnNcblx0XHRcdGRhdGE6IGRhdGEsXG5cblx0XHRcdC8qKlxuXHRcdFx0ICogU3RhdGUgaWYgdGhlIHVzZXIgaXMgY3VycmVudGx5IHR5cGluZyBvciBub3QuIFRoaXMgd2lsbCBhZGQgYSB0eXBpbmcgb3BlcmF0aW9uIGludG8gb25lIHVuZG9cblx0XHRcdCAqIGxldmVsIGluc3RlYWQgb2Ygb25lIG5ldyBsZXZlbCBmb3IgZWFjaCBrZXlzdHJva2UuXG5cdFx0XHQgKlxuXHRcdFx0ICogQGZpZWxkIHtCb29sZWFufSB0eXBpbmdcblx0XHRcdCAqL1xuXHRcdFx0dHlwaW5nOiBmYWxzZSxcblxuXHRcdFx0LyoqXG5cdFx0XHQgKiBTdG9yZXMgYXdheSBhIGJvb2ttYXJrIHRvIGJlIHVzZWQgd2hlbiBwZXJmb3JtaW5nIGFuIHVuZG8gYWN0aW9uIHNvIHRoYXQgdGhlIHNlbGVjdGlvbiBpcyBiZWZvcmVcblx0XHRcdCAqIHRoZSBjaGFuZ2UgaGFzIGJlZW4gbWFkZS5cblx0XHRcdCAqXG5cdFx0XHQgKiBAbWV0aG9kIGJlZm9yZUNoYW5nZVxuXHRcdFx0ICovXG5cdFx0XHRiZWZvcmVDaGFuZ2U6IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRpZiAoIWxvY2tzKSB7XG5cdFx0XHRcdFx0YmVmb3JlQm9va21hcmsgPSBlZGl0b3Iuc2VsZWN0aW9uLmdldEJvb2ttYXJrKDIsIHRydWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9LFxuXG5cdFx0XHQvKipcblx0XHRcdCAqIEFkZHMgYSBuZXcgdW5kbyBsZXZlbC9zbmFwc2hvdCB0byB0aGUgdW5kbyBsaXN0LlxuXHRcdFx0ICpcblx0XHRcdCAqIEBtZXRob2QgYWRkXG5cdFx0XHQgKiBAcGFyYW0ge09iamVjdH0gbGV2ZWwgT3B0aW9uYWwgdW5kbyBsZXZlbCBvYmplY3QgdG8gYWRkLlxuXHRcdFx0ICogQHBhcmFtIHtET01FdmVudH0gZXZlbnQgT3B0aW9uYWwgZXZlbnQgcmVzcG9uc2libGUgZm9yIHRoZSBjcmVhdGlvbiBvZiB0aGUgdW5kbyBsZXZlbC5cblx0XHRcdCAqIEByZXR1cm4ge09iamVjdH0gVW5kbyBsZXZlbCB0aGF0IGdvdCBhZGRlZCBvciBudWxsIGl0IGEgbGV2ZWwgd2Fzbid0IG5lZWRlZC5cblx0XHRcdCAqL1xuXHRcdFx0YWRkOiBmdW5jdGlvbihsZXZlbCwgZXZlbnQpIHtcblx0XHRcdFx0dmFyIGksIHNldHRpbmdzID0gZWRpdG9yLnNldHRpbmdzLCBsYXN0TGV2ZWwsIGN1cnJlbnRMZXZlbDtcblxuXHRcdFx0XHRjdXJyZW50TGV2ZWwgPSBMZXZlbHMuY3JlYXRlRnJvbUVkaXRvcihlZGl0b3IpO1xuXHRcdFx0XHRsZXZlbCA9IGxldmVsIHx8IHt9O1xuXHRcdFx0XHRsZXZlbCA9IFRvb2xzLmV4dGVuZChsZXZlbCwgY3VycmVudExldmVsKTtcblxuXHRcdFx0XHRpZiAobG9ja3MgfHwgZWRpdG9yLnJlbW92ZWQpIHtcblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGxhc3RMZXZlbCA9IGRhdGFbaW5kZXhdO1xuXHRcdFx0XHRpZiAoZWRpdG9yLmZpcmUoJ0JlZm9yZUFkZFVuZG8nLCB7bGV2ZWw6IGxldmVsLCBsYXN0TGV2ZWw6IGxhc3RMZXZlbCwgb3JpZ2luYWxFdmVudDogZXZlbnR9KS5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkge1xuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gQWRkIHVuZG8gbGV2ZWwgaWYgbmVlZGVkXG5cdFx0XHRcdGlmIChsYXN0TGV2ZWwgJiYgTGV2ZWxzLmlzRXEobGFzdExldmVsLCBsZXZlbCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIFNldCBiZWZvcmUgYm9va21hcmsgb24gcHJldmlvdXMgbGV2ZWxcblx0XHRcdFx0aWYgKGRhdGFbaW5kZXhdKSB7XG5cdFx0XHRcdFx0ZGF0YVtpbmRleF0uYmVmb3JlQm9va21hcmsgPSBiZWZvcmVCb29rbWFyaztcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIFRpbWUgdG8gY29tcHJlc3Ncblx0XHRcdFx0aWYgKHNldHRpbmdzLmN1c3RvbV91bmRvX3JlZG9fbGV2ZWxzKSB7XG5cdFx0XHRcdFx0aWYgKGRhdGEubGVuZ3RoID4gc2V0dGluZ3MuY3VzdG9tX3VuZG9fcmVkb19sZXZlbHMpIHtcblx0XHRcdFx0XHRcdGZvciAoaSA9IDA7IGkgPCBkYXRhLmxlbmd0aCAtIDE7IGkrKykge1xuXHRcdFx0XHRcdFx0XHRkYXRhW2ldID0gZGF0YVtpICsgMV07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGRhdGEubGVuZ3RoLS07XG5cdFx0XHRcdFx0XHRpbmRleCA9IGRhdGEubGVuZ3RoO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIEdldCBhIG5vbiBpbnRydXNpdmUgbm9ybWFsaXplZCBib29rbWFya1xuXHRcdFx0XHRsZXZlbC5ib29rbWFyayA9IGVkaXRvci5zZWxlY3Rpb24uZ2V0Qm9va21hcmsoMiwgdHJ1ZSk7XG5cblx0XHRcdFx0Ly8gQ3JvcCBhcnJheSBpZiBuZWVkZWRcblx0XHRcdFx0aWYgKGluZGV4IDwgZGF0YS5sZW5ndGggLSAxKSB7XG5cdFx0XHRcdFx0ZGF0YS5sZW5ndGggPSBpbmRleCArIDE7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRkYXRhLnB1c2gobGV2ZWwpO1xuXHRcdFx0XHRpbmRleCA9IGRhdGEubGVuZ3RoIC0gMTtcblxuXHRcdFx0XHR2YXIgYXJncyA9IHtsZXZlbDogbGV2ZWwsIGxhc3RMZXZlbDogbGFzdExldmVsLCBvcmlnaW5hbEV2ZW50OiBldmVudH07XG5cblx0XHRcdFx0ZWRpdG9yLmZpcmUoJ0FkZFVuZG8nLCBhcmdzKTtcblxuXHRcdFx0XHRpZiAoaW5kZXggPiAwKSB7XG5cdFx0XHRcdFx0c2V0RGlydHkodHJ1ZSk7XG5cdFx0XHRcdFx0ZWRpdG9yLmZpcmUoJ2NoYW5nZScsIGFyZ3MpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIGxldmVsO1xuXHRcdFx0fSxcblxuXHRcdFx0LyoqXG5cdFx0XHQgKiBVbmRvZXMgdGhlIGxhc3QgYWN0aW9uLlxuXHRcdFx0ICpcblx0XHRcdCAqIEBtZXRob2QgdW5kb1xuXHRcdFx0ICogQHJldHVybiB7T2JqZWN0fSBVbmRvIGxldmVsIG9yIG51bGwgaWYgbm8gdW5kbyB3YXMgcGVyZm9ybWVkLlxuXHRcdFx0ICovXG5cdFx0XHR1bmRvOiBmdW5jdGlvbigpIHtcblx0XHRcdFx0dmFyIGxldmVsO1xuXG5cdFx0XHRcdGlmIChzZWxmLnR5cGluZykge1xuXHRcdFx0XHRcdHNlbGYuYWRkKCk7XG5cdFx0XHRcdFx0c2VsZi50eXBpbmcgPSBmYWxzZTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChpbmRleCA+IDApIHtcblx0XHRcdFx0XHRsZXZlbCA9IGRhdGFbLS1pbmRleF07XG5cdFx0XHRcdFx0TGV2ZWxzLmFwcGx5VG9FZGl0b3IoZWRpdG9yLCBsZXZlbCwgdHJ1ZSk7XG5cdFx0XHRcdFx0c2V0RGlydHkodHJ1ZSk7XG5cdFx0XHRcdFx0ZWRpdG9yLmZpcmUoJ3VuZG8nLCB7bGV2ZWw6IGxldmVsfSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbGV2ZWw7XG5cdFx0XHR9LFxuXG5cdFx0XHQvKipcblx0XHRcdCAqIFJlZG9lcyB0aGUgbGFzdCBhY3Rpb24uXG5cdFx0XHQgKlxuXHRcdFx0ICogQG1ldGhvZCByZWRvXG5cdFx0XHQgKiBAcmV0dXJuIHtPYmplY3R9IFJlZG8gbGV2ZWwgb3IgbnVsbCBpZiBubyByZWRvIHdhcyBwZXJmb3JtZWQuXG5cdFx0XHQgKi9cblx0XHRcdHJlZG86IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR2YXIgbGV2ZWw7XG5cblx0XHRcdFx0aWYgKGluZGV4IDwgZGF0YS5sZW5ndGggLSAxKSB7XG5cdFx0XHRcdFx0bGV2ZWwgPSBkYXRhWysraW5kZXhdO1xuXHRcdFx0XHRcdExldmVscy5hcHBseVRvRWRpdG9yKGVkaXRvciwgbGV2ZWwsIGZhbHNlKTtcblx0XHRcdFx0XHRzZXREaXJ0eSh0cnVlKTtcblx0XHRcdFx0XHRlZGl0b3IuZmlyZSgncmVkbycsIHtsZXZlbDogbGV2ZWx9KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBsZXZlbDtcblx0XHRcdH0sXG5cblx0XHRcdC8qKlxuXHRcdFx0ICogUmVtb3ZlcyBhbGwgdW5kbyBsZXZlbHMuXG5cdFx0XHQgKlxuXHRcdFx0ICogQG1ldGhvZCBjbGVhclxuXHRcdFx0ICovXG5cdFx0XHRjbGVhcjogZnVuY3Rpb24oKSB7XG5cdFx0XHRcdGRhdGEgPSBbXTtcblx0XHRcdFx0aW5kZXggPSAwO1xuXHRcdFx0XHRzZWxmLnR5cGluZyA9IGZhbHNlO1xuXHRcdFx0XHRzZWxmLmRhdGEgPSBkYXRhO1xuXHRcdFx0XHRlZGl0b3IuZmlyZSgnQ2xlYXJVbmRvcycpO1xuXHRcdFx0fSxcblxuXHRcdFx0LyoqXG5cdFx0XHQgKiBSZXR1cm5zIHRydWUvZmFsc2UgaWYgdGhlIHVuZG8gbWFuYWdlciBoYXMgYW55IHVuZG8gbGV2ZWxzLlxuXHRcdFx0ICpcblx0XHRcdCAqIEBtZXRob2QgaGFzVW5kb1xuXHRcdFx0ICogQHJldHVybiB7Qm9vbGVhbn0gdHJ1ZS9mYWxzZSBpZiB0aGUgdW5kbyBtYW5hZ2VyIGhhcyBhbnkgdW5kbyBsZXZlbHMuXG5cdFx0XHQgKi9cblx0XHRcdGhhc1VuZG86IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHQvLyBIYXMgdW5kbyBsZXZlbHMgb3IgdHlwaW5nIGFuZCBjb250ZW50IGlzbid0IHRoZSBzYW1lIGFzIHRoZSBpbml0aWFsIGxldmVsXG5cdFx0XHRcdHJldHVybiBpbmRleCA+IDAgfHwgKHNlbGYudHlwaW5nICYmIGRhdGFbMF0gJiYgIUxldmVscy5pc0VxKExldmVscy5jcmVhdGVGcm9tRWRpdG9yKGVkaXRvciksIGRhdGFbMF0pKTtcblx0XHRcdH0sXG5cblx0XHRcdC8qKlxuXHRcdFx0ICogUmV0dXJucyB0cnVlL2ZhbHNlIGlmIHRoZSB1bmRvIG1hbmFnZXIgaGFzIGFueSByZWRvIGxldmVscy5cblx0XHRcdCAqXG5cdFx0XHQgKiBAbWV0aG9kIGhhc1JlZG9cblx0XHRcdCAqIEByZXR1cm4ge0Jvb2xlYW59IHRydWUvZmFsc2UgaWYgdGhlIHVuZG8gbWFuYWdlciBoYXMgYW55IHJlZG8gbGV2ZWxzLlxuXHRcdFx0ICovXG5cdFx0XHRoYXNSZWRvOiBmdW5jdGlvbigpIHtcblx0XHRcdFx0cmV0dXJuIGluZGV4IDwgZGF0YS5sZW5ndGggLSAxICYmICFzZWxmLnR5cGluZztcblx0XHRcdH0sXG5cblx0XHRcdC8qKlxuXHRcdFx0ICogRXhlY3V0ZXMgdGhlIHNwZWNpZmllZCBtdXRhdG9yIGZ1bmN0aW9uIGFzIGFuIHVuZG8gdHJhbnNhY3Rpb24uIFRoZSBzZWxlY3Rpb25cblx0XHRcdCAqIGJlZm9yZSB0aGUgbW9kaWZpY2F0aW9uIHdpbGwgYmUgc3RvcmVkIHRvIHRoZSB1bmRvIHN0YWNrIGFuZCBpZiB0aGUgRE9NIGNoYW5nZXNcblx0XHRcdCAqIGl0IHdpbGwgYWRkIGEgbmV3IHVuZG8gbGV2ZWwuIEFueSBtZXRob2RzIHdpdGhpbiB0aGUgdHJhbnNsYXRpb24gdGhhdCBhZGRzIHVuZG8gbGV2ZWxzIHdpbGxcblx0XHRcdCAqIGJlIGlnbm9yZWQuIFNvIGEgdHJhbnNsYXRpb24gY2FuIGluY2x1ZGUgY2FsbHMgdG8gZXhlY0NvbW1hbmQgb3IgZWRpdG9yLmluc2VydENvbnRlbnQuXG5cdFx0XHQgKlxuXHRcdFx0ICogQG1ldGhvZCB0cmFuc2FjdFxuXHRcdFx0ICogQHBhcmFtIHtmdW5jdGlvbn0gY2FsbGJhY2sgRnVuY3Rpb24gdGhhdCBnZXRzIGV4ZWN1dGVkIGFuZCBoYXMgZG9tIG1hbmlwdWxhdGlvbiBsb2dpYyBpbiBpdC5cblx0XHRcdCAqIEByZXR1cm4ge09iamVjdH0gVW5kbyBsZXZlbCB0aGF0IGdvdCBhZGRlZCBvciBudWxsIGl0IGEgbGV2ZWwgd2Fzbid0IG5lZWRlZC5cblx0XHRcdCAqL1xuXHRcdFx0dHJhbnNhY3Q6IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG5cdFx0XHRcdGVuZFR5cGluZygpO1xuXHRcdFx0XHRzZWxmLmJlZm9yZUNoYW5nZSgpO1xuXG5cdFx0XHRcdHRyeSB7XG5cdFx0XHRcdFx0bG9ja3MrKztcblx0XHRcdFx0XHRjYWxsYmFjaygpO1xuXHRcdFx0XHR9IGZpbmFsbHkge1xuXHRcdFx0XHRcdGxvY2tzLS07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gc2VsZi5hZGQoKTtcblx0XHRcdH0sXG5cblx0XHRcdC8qKlxuXHRcdFx0ICogQWRkcyBhbiBleHRyYSBcImhpZGRlblwiIHVuZG8gbGV2ZWwgYnkgZmlyc3QgYXBwbHlpbmcgdGhlIGZpcnN0IG11dGF0aW9uIGFuZCBzdG9yZSB0aGF0IHRvIHRoZSB1bmRvIHN0YWNrXG5cdFx0XHQgKiB0aGVuIHJvbGwgYmFjayB0aGF0IGNoYW5nZSBhbmQgZG8gdGhlIHNlY29uZCBtdXRhdGlvbiBvbiB0b3Agb2YgdGhlIHN0YWNrLiBUaGlzIHdpbGwgcHJvZHVjZSBhbiBleHRyYVxuXHRcdFx0ICogdW5kbyBsZXZlbCB0aGF0IHRoZSB1c2VyIGRvZXNuJ3Qgc2VlIHVudGlsIHRoZXkgdW5kby5cblx0XHRcdCAqXG5cdFx0XHQgKiBAbWV0aG9kIGV4dHJhXG5cdFx0XHQgKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFjazEgRnVuY3Rpb24gdGhhdCBkb2VzIG11dGF0aW9uIGJ1dCBnZXRzIHN0b3JlZCBhcyBhIFwiaGlkZGVuXCIgZXh0cmEgdW5kbyBsZXZlbC5cblx0XHRcdCAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrMiBGdW5jdGlvbiB0aGF0IGRvZXMgbXV0YXRpb24gYnV0IGdldHMgZGlzcGxheWVkIHRvIHRoZSB1c2VyLlxuXHRcdFx0ICovXG5cdFx0XHRleHRyYTogZnVuY3Rpb24gKGNhbGxiYWNrMSwgY2FsbGJhY2syKSB7XG5cdFx0XHRcdHZhciBsYXN0TGV2ZWwsIGJvb2ttYXJrO1xuXG5cdFx0XHRcdGlmIChzZWxmLnRyYW5zYWN0KGNhbGxiYWNrMSkpIHtcblx0XHRcdFx0XHRib29rbWFyayA9IGRhdGFbaW5kZXhdLmJvb2ttYXJrO1xuXHRcdFx0XHRcdGxhc3RMZXZlbCA9IGRhdGFbaW5kZXggLSAxXTtcblx0XHRcdFx0XHRMZXZlbHMuYXBwbHlUb0VkaXRvcihlZGl0b3IsIGxhc3RMZXZlbCwgdHJ1ZSk7XG5cblx0XHRcdFx0XHRpZiAoc2VsZi50cmFuc2FjdChjYWxsYmFjazIpKSB7XG5cdFx0XHRcdFx0XHRkYXRhW2luZGV4IC0gMV0uYmVmb3JlQm9va21hcmsgPSBib29rbWFyaztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9O1xuXG5cdFx0cmV0dXJuIHNlbGY7XG5cdH07XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL0VudGVyS2V5LmpzXG5cbi8qKlxuICogRW50ZXJLZXkuanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBDb250YWlucyBsb2dpYyBmb3IgaGFuZGxpbmcgdGhlIGVudGVyIGtleSB0byBzcGxpdC9nZW5lcmF0ZSBibG9jayBlbGVtZW50cy5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQGNsYXNzIHRpbnltY2UuRW50ZXJLZXlcbiAqL1xuZGVmaW5lKFwidGlueW1jZS9FbnRlcktleVwiLCBbXG5cdFwidGlueW1jZS9kb20vVHJlZVdhbGtlclwiLFxuXHRcInRpbnltY2UvZG9tL1JhbmdlVXRpbHNcIixcblx0XCJ0aW55bWNlL2NhcmV0L0NhcmV0Q29udGFpbmVyXCIsXG5cdFwidGlueW1jZS9FbnZcIlxuXSwgZnVuY3Rpb24oVHJlZVdhbGtlciwgUmFuZ2VVdGlscywgQ2FyZXRDb250YWluZXIsIEVudikge1xuXHR2YXIgaXNJRSA9IEVudi5pZSAmJiBFbnYuaWUgPCAxMTtcblxuXHRyZXR1cm4gZnVuY3Rpb24oZWRpdG9yKSB7XG5cdFx0dmFyIGRvbSA9IGVkaXRvci5kb20sIHNlbGVjdGlvbiA9IGVkaXRvci5zZWxlY3Rpb24sIHNldHRpbmdzID0gZWRpdG9yLnNldHRpbmdzO1xuXHRcdHZhciB1bmRvTWFuYWdlciA9IGVkaXRvci51bmRvTWFuYWdlciwgc2NoZW1hID0gZWRpdG9yLnNjaGVtYSwgbm9uRW1wdHlFbGVtZW50c01hcCA9IHNjaGVtYS5nZXROb25FbXB0eUVsZW1lbnRzKCksXG5cdFx0XHRtb3ZlQ2FyZXRCZWZvcmVPbkVudGVyRWxlbWVudHNNYXAgPSBzY2hlbWEuZ2V0TW92ZUNhcmV0QmVmb3JlT25FbnRlckVsZW1lbnRzKCk7XG5cblx0XHRmdW5jdGlvbiBoYW5kbGVFbnRlcktleShldnQpIHtcblx0XHRcdHZhciBybmcsIHRtcFJuZywgZWRpdGFibGVSb290LCBjb250YWluZXIsIG9mZnNldCwgcGFyZW50QmxvY2ssIGRvY3VtZW50TW9kZSwgc2hpZnRLZXksXG5cdFx0XHRcdG5ld0Jsb2NrLCBmcmFnbWVudCwgY29udGFpbmVyQmxvY2ssIHBhcmVudEJsb2NrTmFtZSwgY29udGFpbmVyQmxvY2tOYW1lLCBuZXdCbG9ja05hbWUsIGlzQWZ0ZXJMYXN0Tm9kZUluQ29udGFpbmVyO1xuXG5cdFx0XHQvLyBSZXR1cm5zIHRydWUgaWYgdGhlIGJsb2NrIGNhbiBiZSBzcGxpdCBpbnRvIHR3byBibG9ja3Mgb3Igbm90XG5cdFx0XHRmdW5jdGlvbiBjYW5TcGxpdEJsb2NrKG5vZGUpIHtcblx0XHRcdFx0cmV0dXJuIG5vZGUgJiZcblx0XHRcdFx0XHRkb20uaXNCbG9jayhub2RlKSAmJlxuXHRcdFx0XHRcdCEvXihURHxUSHxDQVBUSU9OfEZPUk0pJC8udGVzdChub2RlLm5vZGVOYW1lKSAmJlxuXHRcdFx0XHRcdCEvXihmaXhlZHxhYnNvbHV0ZSkvaS50ZXN0KG5vZGUuc3R5bGUucG9zaXRpb24pICYmXG5cdFx0XHRcdFx0ZG9tLmdldENvbnRlbnRFZGl0YWJsZShub2RlKSAhPT0gXCJ0cnVlXCI7XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIGlzVGFibGVDZWxsKG5vZGUpIHtcblx0XHRcdFx0cmV0dXJuIG5vZGUgJiYgL14oVER8VEh8Q0FQVElPTikkLy50ZXN0KG5vZGUubm9kZU5hbWUpO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBSZW5kZXJzIGVtcHR5IGJsb2NrIG9uIElFXG5cdFx0XHRmdW5jdGlvbiByZW5kZXJCbG9ja09uSUUoYmxvY2spIHtcblx0XHRcdFx0dmFyIG9sZFJuZztcblxuXHRcdFx0XHRpZiAoZG9tLmlzQmxvY2soYmxvY2spKSB7XG5cdFx0XHRcdFx0b2xkUm5nID0gc2VsZWN0aW9uLmdldFJuZygpO1xuXHRcdFx0XHRcdGJsb2NrLmFwcGVuZENoaWxkKGRvbS5jcmVhdGUoJ3NwYW4nLCBudWxsLCAnXFx1MDBhMCcpKTtcblx0XHRcdFx0XHRzZWxlY3Rpb24uc2VsZWN0KGJsb2NrKTtcblx0XHRcdFx0XHRibG9jay5sYXN0Q2hpbGQub3V0ZXJIVE1MID0gJyc7XG5cdFx0XHRcdFx0c2VsZWN0aW9uLnNldFJuZyhvbGRSbmcpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdC8vIFJlbW92ZSB0aGUgZmlyc3QgZW1wdHkgaW5saW5lIGVsZW1lbnQgb2YgdGhlIGJsb2NrIHNvIHRoaXM6IDxwPjxiPjxlbT48L2VtPjwvYj54PC9wPiBiZWNvbWVzIHRoaXM6IDxwPng8L3A+XG5cdFx0XHRmdW5jdGlvbiB0cmltSW5saW5lRWxlbWVudHNPbkxlZnRTaWRlT2ZCbG9jayhibG9jaykge1xuXHRcdFx0XHR2YXIgbm9kZSA9IGJsb2NrLCBmaXJzdENoaWxkcyA9IFtdLCBpO1xuXG5cdFx0XHRcdGlmICghbm9kZSkge1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIEZpbmQgaW5uZXIgbW9zdCBmaXJzdCBjaGlsZCBleDogPHA+PGk+PGI+KjwvYj48L2k+PC9wPlxuXHRcdFx0XHR3aGlsZSAoKG5vZGUgPSBub2RlLmZpcnN0Q2hpbGQpKSB7XG5cdFx0XHRcdFx0aWYgKGRvbS5pc0Jsb2NrKG5vZGUpKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKG5vZGUubm9kZVR5cGUgPT0gMSAmJiAhbm9uRW1wdHlFbGVtZW50c01hcFtub2RlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCldKSB7XG5cdFx0XHRcdFx0XHRmaXJzdENoaWxkcy5wdXNoKG5vZGUpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdGkgPSBmaXJzdENoaWxkcy5sZW5ndGg7XG5cdFx0XHRcdHdoaWxlIChpLS0pIHtcblx0XHRcdFx0XHRub2RlID0gZmlyc3RDaGlsZHNbaV07XG5cdFx0XHRcdFx0aWYgKCFub2RlLmhhc0NoaWxkTm9kZXMoKSB8fCAobm9kZS5maXJzdENoaWxkID09IG5vZGUubGFzdENoaWxkICYmIG5vZGUuZmlyc3RDaGlsZC5ub2RlVmFsdWUgPT09ICcnKSkge1xuXHRcdFx0XHRcdFx0ZG9tLnJlbW92ZShub2RlKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0Ly8gUmVtb3ZlIDxhPiA8L2E+IHNlZSAjNTM4MVxuXHRcdFx0XHRcdFx0aWYgKG5vZGUubm9kZU5hbWUgPT0gXCJBXCIgJiYgKG5vZGUuaW5uZXJUZXh0IHx8IG5vZGUudGV4dENvbnRlbnQpID09PSAnICcpIHtcblx0XHRcdFx0XHRcdFx0ZG9tLnJlbW92ZShub2RlKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0Ly8gTW92ZXMgdGhlIGNhcmV0IHRvIGEgc3VpdGFibGUgcG9zaXRpb24gd2l0aGluIHRoZSByb290IGZvciBleGFtcGxlIGluIHRoZSBmaXJzdCBub25cblx0XHRcdC8vIHB1cmUgd2hpdGVzcGFjZSB0ZXh0IG5vZGUgb3IgYmVmb3JlIGFuIGltYWdlXG5cdFx0XHRmdW5jdGlvbiBtb3ZlVG9DYXJldFBvc2l0aW9uKHJvb3QpIHtcblx0XHRcdFx0dmFyIHdhbGtlciwgbm9kZSwgcm5nLCBsYXN0Tm9kZSA9IHJvb3QsIHRlbXBFbG07XG5cdFx0XHRcdGZ1bmN0aW9uIGZpcnN0Tm9uV2hpdGVTcGFjZU5vZGVTaWJsaW5nKG5vZGUpIHtcblx0XHRcdFx0XHR3aGlsZSAobm9kZSkge1xuXHRcdFx0XHRcdFx0aWYgKG5vZGUubm9kZVR5cGUgPT0gMSB8fCAobm9kZS5ub2RlVHlwZSA9PSAzICYmIG5vZGUuZGF0YSAmJiAvW1xcclxcblxcc10vLnRlc3Qobm9kZS5kYXRhKSkpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIG5vZGU7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdG5vZGUgPSBub2RlLm5leHRTaWJsaW5nO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICghcm9vdCkge1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIE9sZCBJRSB2ZXJzaW9ucyBkb2Vzbid0IHByb3Blcmx5IHJlbmRlciBibG9ja3Mgd2l0aCBiciBlbGVtZW50cyBpbiB0aGVtXG5cdFx0XHRcdC8vIEZvciBleGFtcGxlIDxwPjxicj48L3A+IHdvbnQgYmUgcmVuZGVyZWQgY29ycmVjdGx5IGluIGEgY29udGVudEVkaXRhYmxlIGFyZWFcblx0XHRcdFx0Ly8gdW50aWwgeW91IHJlbW92ZSB0aGUgYnIgcHJvZHVjaW5nIDxwPjwvcD5cblx0XHRcdFx0aWYgKEVudi5pZSAmJiBFbnYuaWUgPCA5ICYmIHBhcmVudEJsb2NrICYmIHBhcmVudEJsb2NrLmZpcnN0Q2hpbGQpIHtcblx0XHRcdFx0XHRpZiAocGFyZW50QmxvY2suZmlyc3RDaGlsZCA9PSBwYXJlbnRCbG9jay5sYXN0Q2hpbGQgJiYgcGFyZW50QmxvY2suZmlyc3RDaGlsZC50YWdOYW1lID09ICdCUicpIHtcblx0XHRcdFx0XHRcdGRvbS5yZW1vdmUocGFyZW50QmxvY2suZmlyc3RDaGlsZCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKC9eKExJfERUfEREKSQvLnRlc3Qocm9vdC5ub2RlTmFtZSkpIHtcblx0XHRcdFx0XHR2YXIgZmlyc3RDaGlsZCA9IGZpcnN0Tm9uV2hpdGVTcGFjZU5vZGVTaWJsaW5nKHJvb3QuZmlyc3RDaGlsZCk7XG5cblx0XHRcdFx0XHRpZiAoZmlyc3RDaGlsZCAmJiAvXihVTHxPTHxETCkkLy50ZXN0KGZpcnN0Q2hpbGQubm9kZU5hbWUpKSB7XG5cdFx0XHRcdFx0XHRyb290Lmluc2VydEJlZm9yZShkb20uZG9jLmNyZWF0ZVRleHROb2RlKCdcXHUwMGEwJyksIHJvb3QuZmlyc3RDaGlsZCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0cm5nID0gZG9tLmNyZWF0ZVJuZygpO1xuXG5cdFx0XHRcdC8vIE5vcm1hbGl6ZSB3aGl0ZXNwYWNlIHRvIHJlbW92ZSBlbXB0eSB0ZXh0IG5vZGVzLiBGaXggZm9yOiAjNjkwNFxuXHRcdFx0XHQvLyBHZWNrbyB3aWxsIGJlIGFibGUgdG8gcGxhY2UgdGhlIGNhcmV0IGluIGVtcHR5IHRleHQgbm9kZXMgYnV0IGl0IHdvbid0IHJlbmRlciBwcm9wZXJ5XG5cdFx0XHRcdC8vIE9sZGVyIElFIHZlcnNpb25zIHdpbGwgc29tZXRpbWVzIGNyYXNoIHNvIGZvciBub3cgaWdub3JlIGFsbCBJRSB2ZXJzaW9uc1xuXHRcdFx0XHRpZiAoIUVudi5pZSkge1xuXHRcdFx0XHRcdHJvb3Qubm9ybWFsaXplKCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAocm9vdC5oYXNDaGlsZE5vZGVzKCkpIHtcblx0XHRcdFx0XHR3YWxrZXIgPSBuZXcgVHJlZVdhbGtlcihyb290LCByb290KTtcblxuXHRcdFx0XHRcdHdoaWxlICgobm9kZSA9IHdhbGtlci5jdXJyZW50KCkpKSB7XG5cdFx0XHRcdFx0XHRpZiAobm9kZS5ub2RlVHlwZSA9PSAzKSB7XG5cdFx0XHRcdFx0XHRcdHJuZy5zZXRTdGFydChub2RlLCAwKTtcblx0XHRcdFx0XHRcdFx0cm5nLnNldEVuZChub2RlLCAwKTtcblx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGlmIChtb3ZlQ2FyZXRCZWZvcmVPbkVudGVyRWxlbWVudHNNYXBbbm9kZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpXSkge1xuXHRcdFx0XHRcdFx0XHRybmcuc2V0U3RhcnRCZWZvcmUobm9kZSk7XG5cdFx0XHRcdFx0XHRcdHJuZy5zZXRFbmRCZWZvcmUobm9kZSk7XG5cdFx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRsYXN0Tm9kZSA9IG5vZGU7XG5cdFx0XHRcdFx0XHRub2RlID0gd2Fsa2VyLm5leHQoKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoIW5vZGUpIHtcblx0XHRcdFx0XHRcdHJuZy5zZXRTdGFydChsYXN0Tm9kZSwgMCk7XG5cdFx0XHRcdFx0XHRybmcuc2V0RW5kKGxhc3ROb2RlLCAwKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0aWYgKHJvb3Qubm9kZU5hbWUgPT0gJ0JSJykge1xuXHRcdFx0XHRcdFx0aWYgKHJvb3QubmV4dFNpYmxpbmcgJiYgZG9tLmlzQmxvY2socm9vdC5uZXh0U2libGluZykpIHtcblx0XHRcdFx0XHRcdFx0Ly8gVHJpY2sgb24gb2xkZXIgSUUgdmVyc2lvbnMgdG8gcmVuZGVyIHRoZSBjYXJldCBiZWZvcmUgdGhlIEJSIGJldHdlZW4gdHdvIGxpc3RzXG5cdFx0XHRcdFx0XHRcdGlmICghZG9jdW1lbnRNb2RlIHx8IGRvY3VtZW50TW9kZSA8IDkpIHtcblx0XHRcdFx0XHRcdFx0XHR0ZW1wRWxtID0gZG9tLmNyZWF0ZSgnYnInKTtcblx0XHRcdFx0XHRcdFx0XHRyb290LnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHRlbXBFbG0sIHJvb3QpO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cm5nLnNldFN0YXJ0QmVmb3JlKHJvb3QpO1xuXHRcdFx0XHRcdFx0XHRybmcuc2V0RW5kQmVmb3JlKHJvb3QpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0cm5nLnNldFN0YXJ0QWZ0ZXIocm9vdCk7XG5cdFx0XHRcdFx0XHRcdHJuZy5zZXRFbmRBZnRlcihyb290KTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0cm5nLnNldFN0YXJ0KHJvb3QsIDApO1xuXHRcdFx0XHRcdFx0cm5nLnNldEVuZChyb290LCAwKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRzZWxlY3Rpb24uc2V0Um5nKHJuZyk7XG5cblx0XHRcdFx0Ly8gUmVtb3ZlIHRlbXBFbG0gY3JlYXRlZCBmb3Igb2xkIElFOnNcblx0XHRcdFx0ZG9tLnJlbW92ZSh0ZW1wRWxtKTtcblx0XHRcdFx0c2VsZWN0aW9uLnNjcm9sbEludG9WaWV3KHJvb3QpO1xuXHRcdFx0fVxuXG5cdFx0XHRmdW5jdGlvbiBzZXRGb3JjZWRCbG9ja0F0dHJzKG5vZGUpIHtcblx0XHRcdFx0dmFyIGZvcmNlZFJvb3RCbG9ja05hbWUgPSBzZXR0aW5ncy5mb3JjZWRfcm9vdF9ibG9jaztcblxuXHRcdFx0XHRpZiAoZm9yY2VkUm9vdEJsb2NrTmFtZSAmJiBmb3JjZWRSb290QmxvY2tOYW1lLnRvTG93ZXJDYXNlKCkgPT09IG5vZGUudGFnTmFtZS50b0xvd2VyQ2FzZSgpKSB7XG5cdFx0XHRcdFx0ZG9tLnNldEF0dHJpYnMobm9kZSwgc2V0dGluZ3MuZm9yY2VkX3Jvb3RfYmxvY2tfYXR0cnMpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIGVtcHR5QmxvY2soZWxtKSB7XG5cdFx0XHRcdC8vIEJSIGlzIG5lZWRlZCBpbiBlbXB0eSBibG9ja3Mgb24gbm9uIElFIGJyb3dzZXJzXG5cdFx0XHRcdGVsbS5pbm5lckhUTUwgPSAhaXNJRSA/ICc8YnIgZGF0YS1tY2UtYm9ndXM9XCIxXCI+JyA6ICcnO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBDcmVhdGVzIGEgbmV3IGJsb2NrIGVsZW1lbnQgYnkgY2xvbmluZyB0aGUgY3VycmVudCBvbmUgb3IgY3JlYXRpbmcgYSBuZXcgb25lIGlmIHRoZSBuYW1lIGlzIHNwZWNpZmllZFxuXHRcdFx0Ly8gVGhpcyBmdW5jdGlvbiB3aWxsIGFsc28gY29weSBhbnkgdGV4dCBmb3JtYXR0aW5nIGZyb20gdGhlIHBhcmVudCBibG9jayBhbmQgYWRkIGl0IHRvIHRoZSBuZXcgb25lXG5cdFx0XHRmdW5jdGlvbiBjcmVhdGVOZXdCbG9jayhuYW1lKSB7XG5cdFx0XHRcdHZhciBub2RlID0gY29udGFpbmVyLCBibG9jaywgY2xvbmVkTm9kZSwgY2FyZXROb2RlLCB0ZXh0SW5saW5lRWxlbWVudHMgPSBzY2hlbWEuZ2V0VGV4dElubGluZUVsZW1lbnRzKCk7XG5cblx0XHRcdFx0aWYgKG5hbWUgfHwgcGFyZW50QmxvY2tOYW1lID09IFwiVEFCTEVcIikge1xuXHRcdFx0XHRcdGJsb2NrID0gZG9tLmNyZWF0ZShuYW1lIHx8IG5ld0Jsb2NrTmFtZSk7XG5cdFx0XHRcdFx0c2V0Rm9yY2VkQmxvY2tBdHRycyhibG9jayk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0YmxvY2sgPSBwYXJlbnRCbG9jay5jbG9uZU5vZGUoZmFsc2UpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Y2FyZXROb2RlID0gYmxvY2s7XG5cblx0XHRcdFx0Ly8gQ2xvbmUgYW55IHBhcmVudCBzdHlsZXNcblx0XHRcdFx0aWYgKHNldHRpbmdzLmtlZXBfc3R5bGVzICE9PSBmYWxzZSkge1xuXHRcdFx0XHRcdGRvIHtcblx0XHRcdFx0XHRcdGlmICh0ZXh0SW5saW5lRWxlbWVudHNbbm9kZS5ub2RlTmFtZV0pIHtcblx0XHRcdFx0XHRcdFx0Ly8gTmV2ZXIgY2xvbmUgYSBjYXJldCBjb250YWluZXJzXG5cdFx0XHRcdFx0XHRcdGlmIChub2RlLmlkID09ICdfbWNlX2NhcmV0Jykge1xuXHRcdFx0XHRcdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0Y2xvbmVkTm9kZSA9IG5vZGUuY2xvbmVOb2RlKGZhbHNlKTtcblx0XHRcdFx0XHRcdFx0ZG9tLnNldEF0dHJpYihjbG9uZWROb2RlLCAnaWQnLCAnJyk7IC8vIFJlbW92ZSBJRCBzaW5jZSBpdCBuZWVkcyB0byBiZSBkb2N1bWVudCB1bmlxdWVcblxuXHRcdFx0XHRcdFx0XHRpZiAoYmxvY2suaGFzQ2hpbGROb2RlcygpKSB7XG5cdFx0XHRcdFx0XHRcdFx0Y2xvbmVkTm9kZS5hcHBlbmRDaGlsZChibG9jay5maXJzdENoaWxkKTtcblx0XHRcdFx0XHRcdFx0XHRibG9jay5hcHBlbmRDaGlsZChjbG9uZWROb2RlKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRjYXJldE5vZGUgPSBjbG9uZWROb2RlO1xuXHRcdFx0XHRcdFx0XHRcdGJsb2NrLmFwcGVuZENoaWxkKGNsb25lZE5vZGUpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSB3aGlsZSAoKG5vZGUgPSBub2RlLnBhcmVudE5vZGUpICYmIG5vZGUgIT0gZWRpdGFibGVSb290KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIEJSIGlzIG5lZWRlZCBpbiBlbXB0eSBibG9ja3Mgb24gbm9uIElFIGJyb3dzZXJzXG5cdFx0XHRcdGlmICghaXNJRSkge1xuXHRcdFx0XHRcdGNhcmV0Tm9kZS5pbm5lckhUTUwgPSAnPGJyIGRhdGEtbWNlLWJvZ3VzPVwiMVwiPic7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gYmxvY2s7XG5cdFx0XHR9XG5cblx0XHRcdC8vIFJldHVybnMgdHJ1ZS9mYWxzZSBpZiB0aGUgY2FyZXQgaXMgYXQgdGhlIHN0YXJ0L2VuZCBvZiB0aGUgcGFyZW50IGJsb2NrIGVsZW1lbnRcblx0XHRcdGZ1bmN0aW9uIGlzQ2FyZXRBdFN0YXJ0T3JFbmRPZkJsb2NrKHN0YXJ0KSB7XG5cdFx0XHRcdHZhciB3YWxrZXIsIG5vZGUsIG5hbWU7XG5cblx0XHRcdFx0Ly8gQ2FyZXQgaXMgaW4gdGhlIG1pZGRsZSBvZiBhIHRleHQgbm9kZSBsaWtlIFwiYXxiXCJcblx0XHRcdFx0aWYgKGNvbnRhaW5lci5ub2RlVHlwZSA9PSAzICYmIChzdGFydCA/IG9mZnNldCA+IDAgOiBvZmZzZXQgPCBjb250YWluZXIubm9kZVZhbHVlLmxlbmd0aCkpIHtcblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBJZiBhZnRlciB0aGUgbGFzdCBlbGVtZW50IGluIGJsb2NrIG5vZGUgZWRnZSBjYXNlIGZvciAjNTA5MVxuXHRcdFx0XHRpZiAoY29udGFpbmVyLnBhcmVudE5vZGUgPT0gcGFyZW50QmxvY2sgJiYgaXNBZnRlckxhc3ROb2RlSW5Db250YWluZXIgJiYgIXN0YXJ0KSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBJZiB0aGUgY2FyZXQgaWYgYmVmb3JlIHRoZSBmaXJzdCBlbGVtZW50IGluIHBhcmVudEJsb2NrXG5cdFx0XHRcdGlmIChzdGFydCAmJiBjb250YWluZXIubm9kZVR5cGUgPT0gMSAmJiBjb250YWluZXIgPT0gcGFyZW50QmxvY2suZmlyc3RDaGlsZCkge1xuXHRcdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gQ2FyZXQgY2FuIGJlIGJlZm9yZS9hZnRlciBhIHRhYmxlXG5cdFx0XHRcdGlmIChjb250YWluZXIubm9kZU5hbWUgPT09IFwiVEFCTEVcIiB8fCAoY29udGFpbmVyLnByZXZpb3VzU2libGluZyAmJiBjb250YWluZXIucHJldmlvdXNTaWJsaW5nLm5vZGVOYW1lID09IFwiVEFCTEVcIikpIHtcblx0XHRcdFx0XHRyZXR1cm4gKGlzQWZ0ZXJMYXN0Tm9kZUluQ29udGFpbmVyICYmICFzdGFydCkgfHwgKCFpc0FmdGVyTGFzdE5vZGVJbkNvbnRhaW5lciAmJiBzdGFydCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBXYWxrIHRoZSBET00gYW5kIGxvb2sgZm9yIHRleHQgbm9kZXMgb3Igbm9uIGVtcHR5IGVsZW1lbnRzXG5cdFx0XHRcdHdhbGtlciA9IG5ldyBUcmVlV2Fsa2VyKGNvbnRhaW5lciwgcGFyZW50QmxvY2spO1xuXG5cdFx0XHRcdC8vIElmIGNhcmV0IGlzIGluIGJlZ2lubmluZyBvciBlbmQgb2YgYSB0ZXh0IGJsb2NrIHRoZW4ganVtcCB0byB0aGUgbmV4dC9wcmV2aW91cyBub2RlXG5cdFx0XHRcdGlmIChjb250YWluZXIubm9kZVR5cGUgPT0gMykge1xuXHRcdFx0XHRcdGlmIChzdGFydCAmJiBvZmZzZXQgPT09IDApIHtcblx0XHRcdFx0XHRcdHdhbGtlci5wcmV2KCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICghc3RhcnQgJiYgb2Zmc2V0ID09IGNvbnRhaW5lci5ub2RlVmFsdWUubGVuZ3RoKSB7XG5cdFx0XHRcdFx0XHR3YWxrZXIubmV4dCgpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdHdoaWxlICgobm9kZSA9IHdhbGtlci5jdXJyZW50KCkpKSB7XG5cdFx0XHRcdFx0aWYgKG5vZGUubm9kZVR5cGUgPT09IDEpIHtcblx0XHRcdFx0XHRcdC8vIElnbm9yZSBib2d1cyBlbGVtZW50c1xuXHRcdFx0XHRcdFx0aWYgKCFub2RlLmdldEF0dHJpYnV0ZSgnZGF0YS1tY2UtYm9ndXMnKSkge1xuXHRcdFx0XHRcdFx0XHQvLyBLZWVwIGVtcHR5IGVsZW1lbnRzIGxpa2UgPGltZyAvPiA8aW5wdXQgLz4gYnV0IG5vdCB0cmFpbGluZyBicjpzIGxpa2UgPHA+dGV4dHw8YnI+PC9wPlxuXHRcdFx0XHRcdFx0XHRuYW1lID0gbm9kZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRcdFx0XHRpZiAobm9uRW1wdHlFbGVtZW50c01hcFtuYW1lXSAmJiBuYW1lICE9PSAnYnInKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSBlbHNlIGlmIChub2RlLm5vZGVUeXBlID09PSAzICYmICEvXlsgXFx0XFxyXFxuXSokLy50ZXN0KG5vZGUubm9kZVZhbHVlKSkge1xuXHRcdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmIChzdGFydCkge1xuXHRcdFx0XHRcdFx0d2Fsa2VyLnByZXYoKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0d2Fsa2VyLm5leHQoKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gV3JhcHMgYW55IHRleHQgbm9kZXMgb3IgaW5saW5lIGVsZW1lbnRzIGluIHRoZSBzcGVjaWZpZWQgZm9yY2VkIHJvb3QgYmxvY2sgbmFtZVxuXHRcdFx0ZnVuY3Rpb24gd3JhcFNlbGZBbmRTaWJsaW5nc0luRGVmYXVsdEJsb2NrKGNvbnRhaW5lciwgb2Zmc2V0KSB7XG5cdFx0XHRcdHZhciBuZXdCbG9jaywgcGFyZW50QmxvY2ssIHN0YXJ0Tm9kZSwgbm9kZSwgbmV4dCwgcm9vdEJsb2NrTmFtZSwgYmxvY2tOYW1lID0gbmV3QmxvY2tOYW1lIHx8ICdQJztcblxuXHRcdFx0XHQvLyBOb3QgaW4gYSBibG9jayBlbGVtZW50IG9yIGluIGEgdGFibGUgY2VsbCBvciBjYXB0aW9uXG5cdFx0XHRcdHBhcmVudEJsb2NrID0gZG9tLmdldFBhcmVudChjb250YWluZXIsIGRvbS5pc0Jsb2NrKTtcblx0XHRcdFx0aWYgKCFwYXJlbnRCbG9jayB8fCAhY2FuU3BsaXRCbG9jayhwYXJlbnRCbG9jaykpIHtcblx0XHRcdFx0XHRwYXJlbnRCbG9jayA9IHBhcmVudEJsb2NrIHx8IGVkaXRhYmxlUm9vdDtcblxuXHRcdFx0XHRcdGlmIChwYXJlbnRCbG9jayA9PSBlZGl0b3IuZ2V0Qm9keSgpIHx8IGlzVGFibGVDZWxsKHBhcmVudEJsb2NrKSkge1xuXHRcdFx0XHRcdFx0cm9vdEJsb2NrTmFtZSA9IHBhcmVudEJsb2NrLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdHJvb3RCbG9ja05hbWUgPSBwYXJlbnRCbG9jay5wYXJlbnROb2RlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKCFwYXJlbnRCbG9jay5oYXNDaGlsZE5vZGVzKCkpIHtcblx0XHRcdFx0XHRcdG5ld0Jsb2NrID0gZG9tLmNyZWF0ZShibG9ja05hbWUpO1xuXHRcdFx0XHRcdFx0c2V0Rm9yY2VkQmxvY2tBdHRycyhuZXdCbG9jayk7XG5cdFx0XHRcdFx0XHRwYXJlbnRCbG9jay5hcHBlbmRDaGlsZChuZXdCbG9jayk7XG5cdFx0XHRcdFx0XHRybmcuc2V0U3RhcnQobmV3QmxvY2ssIDApO1xuXHRcdFx0XHRcdFx0cm5nLnNldEVuZChuZXdCbG9jaywgMCk7XG5cdFx0XHRcdFx0XHRyZXR1cm4gbmV3QmxvY2s7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Ly8gRmluZCBwYXJlbnQgdGhhdCBpcyB0aGUgZmlyc3QgY2hpbGQgb2YgcGFyZW50QmxvY2tcblx0XHRcdFx0XHRub2RlID0gY29udGFpbmVyO1xuXHRcdFx0XHRcdHdoaWxlIChub2RlLnBhcmVudE5vZGUgIT0gcGFyZW50QmxvY2spIHtcblx0XHRcdFx0XHRcdG5vZGUgPSBub2RlLnBhcmVudE5vZGU7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Ly8gTG9vcCBsZWZ0IHRvIGZpbmQgc3RhcnQgbm9kZSBzdGFydCB3cmFwcGluZyBhdFxuXHRcdFx0XHRcdHdoaWxlIChub2RlICYmICFkb20uaXNCbG9jayhub2RlKSkge1xuXHRcdFx0XHRcdFx0c3RhcnROb2RlID0gbm9kZTtcblx0XHRcdFx0XHRcdG5vZGUgPSBub2RlLnByZXZpb3VzU2libGluZztcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoc3RhcnROb2RlICYmIHNjaGVtYS5pc1ZhbGlkQ2hpbGQocm9vdEJsb2NrTmFtZSwgYmxvY2tOYW1lLnRvTG93ZXJDYXNlKCkpKSB7XG5cdFx0XHRcdFx0XHRuZXdCbG9jayA9IGRvbS5jcmVhdGUoYmxvY2tOYW1lKTtcblx0XHRcdFx0XHRcdHNldEZvcmNlZEJsb2NrQXR0cnMobmV3QmxvY2spO1xuXHRcdFx0XHRcdFx0c3RhcnROb2RlLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKG5ld0Jsb2NrLCBzdGFydE5vZGUpO1xuXG5cdFx0XHRcdFx0XHQvLyBTdGFydCB3cmFwcGluZyB1bnRpbCB3ZSBoaXQgYSBibG9ja1xuXHRcdFx0XHRcdFx0bm9kZSA9IHN0YXJ0Tm9kZTtcblx0XHRcdFx0XHRcdHdoaWxlIChub2RlICYmICFkb20uaXNCbG9jayhub2RlKSkge1xuXHRcdFx0XHRcdFx0XHRuZXh0ID0gbm9kZS5uZXh0U2libGluZztcblx0XHRcdFx0XHRcdFx0bmV3QmxvY2suYXBwZW5kQ2hpbGQobm9kZSk7XG5cdFx0XHRcdFx0XHRcdG5vZGUgPSBuZXh0O1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHQvLyBSZXN0b3JlIHJhbmdlIHRvIGl0J3MgcGFzdCBsb2NhdGlvblxuXHRcdFx0XHRcdFx0cm5nLnNldFN0YXJ0KGNvbnRhaW5lciwgb2Zmc2V0KTtcblx0XHRcdFx0XHRcdHJuZy5zZXRFbmQoY29udGFpbmVyLCBvZmZzZXQpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBjb250YWluZXI7XG5cdFx0XHR9XG5cblx0XHRcdC8vIEluc2VydHMgYSBibG9jayBvciBiciBiZWZvcmUvYWZ0ZXIgb3IgaW4gdGhlIG1pZGRsZSBvZiBhIHNwbGl0IGxpc3Qgb2YgdGhlIExJIGlzIGVtcHR5XG5cdFx0XHRmdW5jdGlvbiBoYW5kbGVFbXB0eUxpc3RJdGVtKCkge1xuXHRcdFx0XHRmdW5jdGlvbiBpc0ZpcnN0T3JMYXN0TGkoZmlyc3QpIHtcblx0XHRcdFx0XHR2YXIgbm9kZSA9IGNvbnRhaW5lckJsb2NrW2ZpcnN0ID8gJ2ZpcnN0Q2hpbGQnIDogJ2xhc3RDaGlsZCddO1xuXG5cdFx0XHRcdFx0Ly8gRmluZCBmaXJzdC9sYXN0IGVsZW1lbnQgc2luY2UgdGhlcmUgbWlnaHQgYmUgd2hpdGVzcGFjZSB0aGVyZVxuXHRcdFx0XHRcdHdoaWxlIChub2RlKSB7XG5cdFx0XHRcdFx0XHRpZiAobm9kZS5ub2RlVHlwZSA9PSAxKSB7XG5cdFx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRub2RlID0gbm9kZVtmaXJzdCA/ICduZXh0U2libGluZycgOiAncHJldmlvdXNTaWJsaW5nJ107XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG5vZGUgPT09IHBhcmVudEJsb2NrO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0ZnVuY3Rpb24gZ2V0Q29udGFpbmVyQmxvY2soKSB7XG5cdFx0XHRcdFx0dmFyIGNvbnRhaW5lckJsb2NrUGFyZW50ID0gY29udGFpbmVyQmxvY2sucGFyZW50Tm9kZTtcblxuXHRcdFx0XHRcdGlmICgvXihMSXxEVHxERCkkLy50ZXN0KGNvbnRhaW5lckJsb2NrUGFyZW50Lm5vZGVOYW1lKSkge1xuXHRcdFx0XHRcdFx0cmV0dXJuIGNvbnRhaW5lckJsb2NrUGFyZW50O1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBjb250YWluZXJCbG9jaztcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChjb250YWluZXJCbG9jayA9PSBlZGl0b3IuZ2V0Qm9keSgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gQ2hlY2sgaWYgd2UgYXJlIGluIGFuIG5lc3RlZCBsaXN0XG5cdFx0XHRcdHZhciBjb250YWluZXJCbG9ja1BhcmVudE5hbWUgPSBjb250YWluZXJCbG9jay5wYXJlbnROb2RlLm5vZGVOYW1lO1xuXHRcdFx0XHRpZiAoL14oT0x8VUx8TEkpJC8udGVzdChjb250YWluZXJCbG9ja1BhcmVudE5hbWUpKSB7XG5cdFx0XHRcdFx0bmV3QmxvY2tOYW1lID0gJ0xJJztcblx0XHRcdFx0fVxuXG5cdFx0XHRcdG5ld0Jsb2NrID0gbmV3QmxvY2tOYW1lID8gY3JlYXRlTmV3QmxvY2sobmV3QmxvY2tOYW1lKSA6IGRvbS5jcmVhdGUoJ0JSJyk7XG5cblx0XHRcdFx0aWYgKGlzRmlyc3RPckxhc3RMaSh0cnVlKSAmJiBpc0ZpcnN0T3JMYXN0TGkoKSkge1xuXHRcdFx0XHRcdGlmIChjb250YWluZXJCbG9ja1BhcmVudE5hbWUgPT0gJ0xJJykge1xuXHRcdFx0XHRcdFx0Ly8gTmVzdGVkIGxpc3QgaXMgaW5zaWRlIGEgTElcblx0XHRcdFx0XHRcdGRvbS5pbnNlcnRBZnRlcihuZXdCbG9jaywgZ2V0Q29udGFpbmVyQmxvY2soKSk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdC8vIElzIGZpcnN0IGFuZCBsYXN0IGxpc3QgaXRlbSB0aGVuIHJlcGxhY2UgdGhlIE9ML1VMIHdpdGggYSB0ZXh0IGJsb2NrXG5cdFx0XHRcdFx0XHRkb20ucmVwbGFjZShuZXdCbG9jaywgY29udGFpbmVyQmxvY2spO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIGlmIChpc0ZpcnN0T3JMYXN0TGkodHJ1ZSkpIHtcblx0XHRcdFx0XHRpZiAoY29udGFpbmVyQmxvY2tQYXJlbnROYW1lID09ICdMSScpIHtcblx0XHRcdFx0XHRcdC8vIExpc3QgbmVzdGVkIGluIGFuIExJIHRoZW4gbW92ZSB0aGUgbGlzdCB0byBhIG5ldyBzaWJsaW5nIExJXG5cdFx0XHRcdFx0XHRkb20uaW5zZXJ0QWZ0ZXIobmV3QmxvY2ssIGdldENvbnRhaW5lckJsb2NrKCkpO1xuXHRcdFx0XHRcdFx0bmV3QmxvY2suYXBwZW5kQ2hpbGQoZG9tLmRvYy5jcmVhdGVUZXh0Tm9kZSgnICcpKTsgLy8gTmVlZGVkIGZvciBJRSBzbyB0aGUgY2FyZXQgY2FuIGJlIHBsYWNlZFxuXHRcdFx0XHRcdFx0bmV3QmxvY2suYXBwZW5kQ2hpbGQoY29udGFpbmVyQmxvY2spO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHQvLyBGaXJzdCBMSSBpbiBsaXN0IHRoZW4gcmVtb3ZlIExJIGFuZCBhZGQgdGV4dCBibG9jayBiZWZvcmUgbGlzdFxuXHRcdFx0XHRcdFx0Y29udGFpbmVyQmxvY2sucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUobmV3QmxvY2ssIGNvbnRhaW5lckJsb2NrKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gZWxzZSBpZiAoaXNGaXJzdE9yTGFzdExpKCkpIHtcblx0XHRcdFx0XHQvLyBMYXN0IExJIGluIGxpc3QgdGhlbiByZW1vdmUgTEkgYW5kIGFkZCB0ZXh0IGJsb2NrIGFmdGVyIGxpc3Rcblx0XHRcdFx0XHRkb20uaW5zZXJ0QWZ0ZXIobmV3QmxvY2ssIGdldENvbnRhaW5lckJsb2NrKCkpO1xuXHRcdFx0XHRcdHJlbmRlckJsb2NrT25JRShuZXdCbG9jayk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Ly8gTWlkZGxlIExJIGluIGxpc3QgdGhlIHNwbGl0IHRoZSBsaXN0IGFuZCBpbnNlcnQgYSB0ZXh0IGJsb2NrIGluIHRoZSBtaWRkbGVcblx0XHRcdFx0XHQvLyBFeHRyYWN0IGFmdGVyIGZyYWdtZW50IGFuZCBpbnNlcnQgaXQgYWZ0ZXIgdGhlIGN1cnJlbnQgYmxvY2tcblx0XHRcdFx0XHRjb250YWluZXJCbG9jayA9IGdldENvbnRhaW5lckJsb2NrKCk7XG5cdFx0XHRcdFx0dG1wUm5nID0gcm5nLmNsb25lUmFuZ2UoKTtcblx0XHRcdFx0XHR0bXBSbmcuc2V0U3RhcnRBZnRlcihwYXJlbnRCbG9jayk7XG5cdFx0XHRcdFx0dG1wUm5nLnNldEVuZEFmdGVyKGNvbnRhaW5lckJsb2NrKTtcblx0XHRcdFx0XHRmcmFnbWVudCA9IHRtcFJuZy5leHRyYWN0Q29udGVudHMoKTtcblxuXHRcdFx0XHRcdGlmIChuZXdCbG9ja05hbWUgPT0gJ0xJJyAmJiBmcmFnbWVudC5maXJzdENoaWxkLm5vZGVOYW1lID09ICdMSScpIHtcblx0XHRcdFx0XHRcdG5ld0Jsb2NrID0gZnJhZ21lbnQuZmlyc3RDaGlsZDtcblx0XHRcdFx0XHRcdGRvbS5pbnNlcnRBZnRlcihmcmFnbWVudCwgY29udGFpbmVyQmxvY2spO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRkb20uaW5zZXJ0QWZ0ZXIoZnJhZ21lbnQsIGNvbnRhaW5lckJsb2NrKTtcblx0XHRcdFx0XHRcdGRvbS5pbnNlcnRBZnRlcihuZXdCbG9jaywgY29udGFpbmVyQmxvY2spO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdGRvbS5yZW1vdmUocGFyZW50QmxvY2spO1xuXHRcdFx0XHRtb3ZlVG9DYXJldFBvc2l0aW9uKG5ld0Jsb2NrKTtcblx0XHRcdFx0dW5kb01hbmFnZXIuYWRkKCk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIEluc2VydHMgYSBCUiBlbGVtZW50IGlmIHRoZSBmb3JjZWRfcm9vdF9ibG9jayBvcHRpb24gaXMgc2V0IHRvIGZhbHNlIG9yIGVtcHR5IHN0cmluZ1xuXHRcdFx0ZnVuY3Rpb24gaW5zZXJ0QnIoKSB7XG5cdFx0XHRcdGVkaXRvci5leGVjQ29tbWFuZChcIkluc2VydExpbmVCcmVha1wiLCBmYWxzZSwgZXZ0KTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gVHJpbXMgYW55IGxpbmVicmVha3MgYXQgdGhlIGJlZ2lubmluZyBvZiBub2RlIHVzZXIgZm9yIGV4YW1wbGUgd2hlbiBwcmVzc2luZyBlbnRlciBpbiBhIFBSRSBlbGVtZW50XG5cdFx0XHRmdW5jdGlvbiB0cmltTGVhZGluZ0xpbmVCcmVha3Mobm9kZSkge1xuXHRcdFx0XHRkbyB7XG5cdFx0XHRcdFx0aWYgKG5vZGUubm9kZVR5cGUgPT09IDMpIHtcblx0XHRcdFx0XHRcdG5vZGUubm9kZVZhbHVlID0gbm9kZS5ub2RlVmFsdWUucmVwbGFjZSgvXltcXHJcXG5dKy8sICcnKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRub2RlID0gbm9kZS5maXJzdENoaWxkO1xuXHRcdFx0XHR9IHdoaWxlIChub2RlKTtcblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gZ2V0RWRpdGFibGVSb290KG5vZGUpIHtcblx0XHRcdFx0dmFyIHJvb3QgPSBkb20uZ2V0Um9vdCgpLCBwYXJlbnQsIGVkaXRhYmxlUm9vdDtcblxuXHRcdFx0XHQvLyBHZXQgYWxsIHBhcmVudHMgdW50aWwgd2UgaGl0IGEgbm9uIGVkaXRhYmxlIHBhcmVudCBvciB0aGUgcm9vdFxuXHRcdFx0XHRwYXJlbnQgPSBub2RlO1xuXHRcdFx0XHR3aGlsZSAocGFyZW50ICE9PSByb290ICYmIGRvbS5nZXRDb250ZW50RWRpdGFibGUocGFyZW50KSAhPT0gXCJmYWxzZVwiKSB7XG5cdFx0XHRcdFx0aWYgKGRvbS5nZXRDb250ZW50RWRpdGFibGUocGFyZW50KSA9PT0gXCJ0cnVlXCIpIHtcblx0XHRcdFx0XHRcdGVkaXRhYmxlUm9vdCA9IHBhcmVudDtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRwYXJlbnQgPSBwYXJlbnQucGFyZW50Tm9kZTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBwYXJlbnQgIT09IHJvb3QgPyBlZGl0YWJsZVJvb3QgOiByb290O1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBBZGRzIGEgQlIgYXQgdGhlIGVuZCBvZiBibG9ja3MgdGhhdCBvbmx5IGNvbnRhaW5zIGFuIElNRyBvciBJTlBVVCBzaW5jZVxuXHRcdFx0Ly8gdGhlc2UgbWlnaHQgYmUgZmxvYXRlZCBhbmQgdGhlbiB0aGV5IHdvbid0IGV4cGFuZCB0aGUgYmxvY2tcblx0XHRcdGZ1bmN0aW9uIGFkZEJyVG9CbG9ja0lmTmVlZGVkKGJsb2NrKSB7XG5cdFx0XHRcdHZhciBsYXN0Q2hpbGQ7XG5cblx0XHRcdFx0Ly8gSUUgd2lsbCByZW5kZXIgdGhlIGJsb2NrcyBjb3JyZWN0bHkgb3RoZXIgYnJvd3NlcnMgbmVlZHMgYSBCUlxuXHRcdFx0XHRpZiAoIWlzSUUpIHtcblx0XHRcdFx0XHRibG9jay5ub3JtYWxpemUoKTsgLy8gUmVtb3ZlIGVtcHR5IHRleHQgbm9kZXMgdGhhdCBnb3QgbGVmdCBiZWhpbmQgYnkgdGhlIGV4dHJhY3RcblxuXHRcdFx0XHRcdC8vIENoZWNrIGlmIHRoZSBibG9jayBpcyBlbXB0eSBvciBjb250YWlucyBhIGZsb2F0ZWQgbGFzdCBjaGlsZFxuXHRcdFx0XHRcdGxhc3RDaGlsZCA9IGJsb2NrLmxhc3RDaGlsZDtcblx0XHRcdFx0XHRpZiAoIWxhc3RDaGlsZCB8fCAoL14obGVmdHxyaWdodCkkL2dpLnRlc3QoZG9tLmdldFN0eWxlKGxhc3RDaGlsZCwgJ2Zsb2F0JywgdHJ1ZSkpKSkge1xuXHRcdFx0XHRcdFx0ZG9tLmFkZChibG9jaywgJ2JyJyk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIGluc2VydE5ld0Jsb2NrQWZ0ZXIoKSB7XG5cdFx0XHRcdC8vIElmIHRoZSBjYXJldCBpcyBhdCB0aGUgZW5kIG9mIGEgaGVhZGVyIHdlIHByb2R1Y2UgYSBQIHRhZyBhZnRlciBpdCBzaW1pbGFyIHRvIFdvcmQgdW5sZXNzIHdlIGFyZSBpbiBhIGhncm91cFxuXHRcdFx0XHRpZiAoL14oSFsxLTZdfFBSRXxGSUdVUkUpJC8udGVzdChwYXJlbnRCbG9ja05hbWUpICYmIGNvbnRhaW5lckJsb2NrTmFtZSAhPSAnSEdST1VQJykge1xuXHRcdFx0XHRcdG5ld0Jsb2NrID0gY3JlYXRlTmV3QmxvY2sobmV3QmxvY2tOYW1lKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRuZXdCbG9jayA9IGNyZWF0ZU5ld0Jsb2NrKCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBTcGxpdCB0aGUgY3VycmVudCBjb250YWluZXIgYmxvY2sgZWxlbWVudCBpZiBlbnRlciBpcyBwcmVzc2VkIGluc2lkZSBhbiBlbXB0eSBpbm5lciBibG9jayBlbGVtZW50XG5cdFx0XHRcdGlmIChzZXR0aW5ncy5lbmRfY29udGFpbmVyX29uX2VtcHR5X2Jsb2NrICYmIGNhblNwbGl0QmxvY2soY29udGFpbmVyQmxvY2spICYmIGRvbS5pc0VtcHR5KHBhcmVudEJsb2NrKSkge1xuXHRcdFx0XHRcdC8vIFNwbGl0IGNvbnRhaW5lciBibG9jayBmb3IgZXhhbXBsZSBhIEJMT0NLUVVPVEUgYXQgdGhlIGN1cnJlbnQgYmxvY2tQYXJlbnQgbG9jYXRpb24gZm9yIGV4YW1wbGUgYSBQXG5cdFx0XHRcdFx0bmV3QmxvY2sgPSBkb20uc3BsaXQoY29udGFpbmVyQmxvY2ssIHBhcmVudEJsb2NrKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRkb20uaW5zZXJ0QWZ0ZXIobmV3QmxvY2ssIHBhcmVudEJsb2NrKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdG1vdmVUb0NhcmV0UG9zaXRpb24obmV3QmxvY2spO1xuXHRcdFx0fVxuXG5cdFx0XHRybmcgPSBzZWxlY3Rpb24uZ2V0Um5nKHRydWUpO1xuXG5cdFx0XHQvLyBFdmVudCBpcyBibG9ja2VkIGJ5IHNvbWUgb3RoZXIgaGFuZGxlciBmb3IgZXhhbXBsZSB0aGUgbGlzdHMgcGx1Z2luXG5cdFx0XHRpZiAoZXZ0LmlzRGVmYXVsdFByZXZlbnRlZCgpKSB7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0Ly8gRGVsZXRlIGFueSBzZWxlY3RlZCBjb250ZW50c1xuXHRcdFx0aWYgKCFybmcuY29sbGFwc2VkKSB7XG5cdFx0XHRcdGVkaXRvci5leGVjQ29tbWFuZCgnRGVsZXRlJyk7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0Ly8gU2V0dXAgcmFuZ2UgaXRlbXMgYW5kIG5ld0Jsb2NrTmFtZVxuXHRcdFx0bmV3IFJhbmdlVXRpbHMoZG9tKS5ub3JtYWxpemUocm5nKTtcblx0XHRcdGNvbnRhaW5lciA9IHJuZy5zdGFydENvbnRhaW5lcjtcblx0XHRcdG9mZnNldCA9IHJuZy5zdGFydE9mZnNldDtcblx0XHRcdG5ld0Jsb2NrTmFtZSA9IChzZXR0aW5ncy5mb3JjZV9wX25ld2xpbmVzID8gJ3AnIDogJycpIHx8IHNldHRpbmdzLmZvcmNlZF9yb290X2Jsb2NrO1xuXHRcdFx0bmV3QmxvY2tOYW1lID0gbmV3QmxvY2tOYW1lID8gbmV3QmxvY2tOYW1lLnRvVXBwZXJDYXNlKCkgOiAnJztcblx0XHRcdGRvY3VtZW50TW9kZSA9IGRvbS5kb2MuZG9jdW1lbnRNb2RlO1xuXHRcdFx0c2hpZnRLZXkgPSBldnQuc2hpZnRLZXk7XG5cblx0XHRcdC8vIFJlc29sdmUgbm9kZSBpbmRleFxuXHRcdFx0aWYgKGNvbnRhaW5lci5ub2RlVHlwZSA9PSAxICYmIGNvbnRhaW5lci5oYXNDaGlsZE5vZGVzKCkpIHtcblx0XHRcdFx0aXNBZnRlckxhc3ROb2RlSW5Db250YWluZXIgPSBvZmZzZXQgPiBjb250YWluZXIuY2hpbGROb2Rlcy5sZW5ndGggLSAxO1xuXG5cdFx0XHRcdGNvbnRhaW5lciA9IGNvbnRhaW5lci5jaGlsZE5vZGVzW01hdGgubWluKG9mZnNldCwgY29udGFpbmVyLmNoaWxkTm9kZXMubGVuZ3RoIC0gMSldIHx8IGNvbnRhaW5lcjtcblx0XHRcdFx0aWYgKGlzQWZ0ZXJMYXN0Tm9kZUluQ29udGFpbmVyICYmIGNvbnRhaW5lci5ub2RlVHlwZSA9PSAzKSB7XG5cdFx0XHRcdFx0b2Zmc2V0ID0gY29udGFpbmVyLm5vZGVWYWx1ZS5sZW5ndGg7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2Zmc2V0ID0gMDtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHQvLyBHZXQgZWRpdGFibGUgcm9vdCBub2RlLCBub3JtYWxseSB0aGUgYm9keSBlbGVtZW50IGJ1dCBzb21ldGltZXMgYSBkaXYgb3Igc3BhblxuXHRcdFx0ZWRpdGFibGVSb290ID0gZ2V0RWRpdGFibGVSb290KGNvbnRhaW5lcik7XG5cblx0XHRcdC8vIElmIHRoZXJlIGlzIG5vIGVkaXRhYmxlIHJvb3QgdGhlbiBlbnRlciBpcyBkb25lIGluc2lkZSBhIGNvbnRlbnRFZGl0YWJsZSBmYWxzZSBlbGVtZW50XG5cdFx0XHRpZiAoIWVkaXRhYmxlUm9vdCkge1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdHVuZG9NYW5hZ2VyLmJlZm9yZUNoYW5nZSgpO1xuXG5cdFx0XHQvLyBJZiBlZGl0YWJsZSByb290IGlzbid0IGJsb2NrIG5vciB0aGUgcm9vdCBvZiB0aGUgZWRpdG9yXG5cdFx0XHRpZiAoIWRvbS5pc0Jsb2NrKGVkaXRhYmxlUm9vdCkgJiYgZWRpdGFibGVSb290ICE9IGRvbS5nZXRSb290KCkpIHtcblx0XHRcdFx0aWYgKCFuZXdCbG9ja05hbWUgfHwgc2hpZnRLZXkpIHtcblx0XHRcdFx0XHRpbnNlcnRCcigpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBXcmFwIHRoZSBjdXJyZW50IG5vZGUgYW5kIGl0J3Mgc2libGluZyBpbiBhIGRlZmF1bHQgYmxvY2sgaWYgaXQncyBuZWVkZWQuXG5cdFx0XHQvLyBmb3IgZXhhbXBsZSB0aGlzIDx0ZD50ZXh0fDxiPnRleHQyPC9iPjwvdGQ+IHdpbGwgYmVjb21lIHRoaXMgPHRkPjxwPnRleHR8PGI+dGV4dDI8L3A+PC9iPjwvdGQ+XG5cdFx0XHQvLyBUaGlzIHdvbid0IGhhcHBlbiBpZiByb290IGJsb2NrcyBhcmUgZGlzYWJsZWQgb3IgdGhlIHNoaWZ0S2V5IGlzIHByZXNzZWRcblx0XHRcdGlmICgobmV3QmxvY2tOYW1lICYmICFzaGlmdEtleSkgfHwgKCFuZXdCbG9ja05hbWUgJiYgc2hpZnRLZXkpKSB7XG5cdFx0XHRcdGNvbnRhaW5lciA9IHdyYXBTZWxmQW5kU2libGluZ3NJbkRlZmF1bHRCbG9jayhjb250YWluZXIsIG9mZnNldCk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIEZpbmQgcGFyZW50IGJsb2NrIGFuZCBzZXR1cCBlbXB0eSBibG9jayBwYWRkaW5nc1xuXHRcdFx0cGFyZW50QmxvY2sgPSBkb20uZ2V0UGFyZW50KGNvbnRhaW5lciwgZG9tLmlzQmxvY2spO1xuXHRcdFx0Y29udGFpbmVyQmxvY2sgPSBwYXJlbnRCbG9jayA/IGRvbS5nZXRQYXJlbnQocGFyZW50QmxvY2sucGFyZW50Tm9kZSwgZG9tLmlzQmxvY2spIDogbnVsbDtcblxuXHRcdFx0Ly8gU2V0dXAgYmxvY2sgbmFtZXNcblx0XHRcdHBhcmVudEJsb2NrTmFtZSA9IHBhcmVudEJsb2NrID8gcGFyZW50QmxvY2subm9kZU5hbWUudG9VcHBlckNhc2UoKSA6ICcnOyAvLyBJRSA8IDkgJiBIVE1MNVxuXHRcdFx0Y29udGFpbmVyQmxvY2tOYW1lID0gY29udGFpbmVyQmxvY2sgPyBjb250YWluZXJCbG9jay5ub2RlTmFtZS50b1VwcGVyQ2FzZSgpIDogJyc7IC8vIElFIDwgOSAmIEhUTUw1XG5cblx0XHRcdC8vIEVudGVyIGluc2lkZSBibG9jayBjb250YWluZWQgd2l0aGluIGEgTEkgdGhlbiBzcGxpdCBvciBpbnNlcnQgYmVmb3JlL2FmdGVyIExJXG5cdFx0XHRpZiAoY29udGFpbmVyQmxvY2tOYW1lID09ICdMSScgJiYgIWV2dC5jdHJsS2V5KSB7XG5cdFx0XHRcdHBhcmVudEJsb2NrID0gY29udGFpbmVyQmxvY2s7XG5cdFx0XHRcdHBhcmVudEJsb2NrTmFtZSA9IGNvbnRhaW5lckJsb2NrTmFtZTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGVkaXRvci51bmRvTWFuYWdlci50eXBpbmcpIHtcblx0XHRcdFx0ZWRpdG9yLnVuZG9NYW5hZ2VyLnR5cGluZyA9IGZhbHNlO1xuXHRcdFx0XHRlZGl0b3IudW5kb01hbmFnZXIuYWRkKCk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIEhhbmRsZSBlbnRlciBpbiBsaXN0IGl0ZW1cblx0XHRcdGlmICgvXihMSXxEVHxERCkkLy50ZXN0KHBhcmVudEJsb2NrTmFtZSkpIHtcblx0XHRcdFx0aWYgKCFuZXdCbG9ja05hbWUgJiYgc2hpZnRLZXkpIHtcblx0XHRcdFx0XHRpbnNlcnRCcigpO1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIEhhbmRsZSBlbnRlciBpbnNpZGUgYW4gZW1wdHkgbGlzdCBpdGVtXG5cdFx0XHRcdGlmIChkb20uaXNFbXB0eShwYXJlbnRCbG9jaykpIHtcblx0XHRcdFx0XHRoYW5kbGVFbXB0eUxpc3RJdGVtKCk7XG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdC8vIERvbid0IHNwbGl0IFBSRSB0YWdzIGJ1dCBpbnNlcnQgYSBCUiBpbnN0ZWFkIGVhc2llciB3aGVuIHdyaXRpbmcgY29kZSBzYW1wbGVzIGV0Y1xuXHRcdFx0aWYgKHBhcmVudEJsb2NrTmFtZSA9PSAnUFJFJyAmJiBzZXR0aW5ncy5icl9pbl9wcmUgIT09IGZhbHNlKSB7XG5cdFx0XHRcdGlmICghc2hpZnRLZXkpIHtcblx0XHRcdFx0XHRpbnNlcnRCcigpO1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Ly8gSWYgbm8gcm9vdCBibG9jayBpcyBjb25maWd1cmVkIHRoZW4gaW5zZXJ0IGEgQlIgYnkgZGVmYXVsdCBvciBpZiB0aGUgc2hpZnRLZXkgaXMgcHJlc3NlZFxuXHRcdFx0XHRpZiAoKCFuZXdCbG9ja05hbWUgJiYgIXNoaWZ0S2V5ICYmIHBhcmVudEJsb2NrTmFtZSAhPSAnTEknKSB8fCAobmV3QmxvY2tOYW1lICYmIHNoaWZ0S2V5KSkge1xuXHRcdFx0XHRcdGluc2VydEJyKCk7XG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdC8vIElmIHBhcmVudCBibG9jayBpcyByb290IHRoZW4gbmV2ZXIgaW5zZXJ0IG5ldyBibG9ja3Ncblx0XHRcdGlmIChuZXdCbG9ja05hbWUgJiYgcGFyZW50QmxvY2sgPT09IGVkaXRvci5nZXRCb2R5KCkpIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBEZWZhdWx0IGJsb2NrIG5hbWUgaWYgaXQncyBub3QgY29uZmlndXJlZFxuXHRcdFx0bmV3QmxvY2tOYW1lID0gbmV3QmxvY2tOYW1lIHx8ICdQJztcblxuXHRcdFx0Ly8gSW5zZXJ0IG5ldyBibG9jayBiZWZvcmUvYWZ0ZXIgdGhlIHBhcmVudCBibG9jayBkZXBlbmRpbmcgb24gY2FyZXQgbG9jYXRpb25cblx0XHRcdGlmIChDYXJldENvbnRhaW5lci5pc0NhcmV0Q29udGFpbmVyQmxvY2socGFyZW50QmxvY2spKSB7XG5cdFx0XHRcdG5ld0Jsb2NrID0gQ2FyZXRDb250YWluZXIuc2hvd0NhcmV0Q29udGFpbmVyQmxvY2socGFyZW50QmxvY2spO1xuXHRcdFx0fSBlbHNlIGlmIChpc0NhcmV0QXRTdGFydE9yRW5kT2ZCbG9jaygpKSB7XG5cdFx0XHRcdGluc2VydE5ld0Jsb2NrQWZ0ZXIoKTtcblx0XHRcdH0gZWxzZSBpZiAoaXNDYXJldEF0U3RhcnRPckVuZE9mQmxvY2sodHJ1ZSkpIHtcblx0XHRcdFx0Ly8gSW5zZXJ0IG5ldyBibG9jayBiZWZvcmVcblx0XHRcdFx0bmV3QmxvY2sgPSBwYXJlbnRCbG9jay5wYXJlbnROb2RlLmluc2VydEJlZm9yZShjcmVhdGVOZXdCbG9jaygpLCBwYXJlbnRCbG9jayk7XG5cdFx0XHRcdHJlbmRlckJsb2NrT25JRShuZXdCbG9jayk7XG5cdFx0XHRcdG1vdmVUb0NhcmV0UG9zaXRpb24ocGFyZW50QmxvY2spO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Ly8gRXh0cmFjdCBhZnRlciBmcmFnbWVudCBhbmQgaW5zZXJ0IGl0IGFmdGVyIHRoZSBjdXJyZW50IGJsb2NrXG5cdFx0XHRcdHRtcFJuZyA9IHJuZy5jbG9uZVJhbmdlKCk7XG5cdFx0XHRcdHRtcFJuZy5zZXRFbmRBZnRlcihwYXJlbnRCbG9jayk7XG5cdFx0XHRcdGZyYWdtZW50ID0gdG1wUm5nLmV4dHJhY3RDb250ZW50cygpO1xuXHRcdFx0XHR0cmltTGVhZGluZ0xpbmVCcmVha3MoZnJhZ21lbnQpO1xuXHRcdFx0XHRuZXdCbG9jayA9IGZyYWdtZW50LmZpcnN0Q2hpbGQ7XG5cdFx0XHRcdGRvbS5pbnNlcnRBZnRlcihmcmFnbWVudCwgcGFyZW50QmxvY2spO1xuXHRcdFx0XHR0cmltSW5saW5lRWxlbWVudHNPbkxlZnRTaWRlT2ZCbG9jayhuZXdCbG9jayk7XG5cdFx0XHRcdGFkZEJyVG9CbG9ja0lmTmVlZGVkKHBhcmVudEJsb2NrKTtcblxuXHRcdFx0XHRpZiAoZG9tLmlzRW1wdHkocGFyZW50QmxvY2spKSB7XG5cdFx0XHRcdFx0ZW1wdHlCbG9jayhwYXJlbnRCbG9jayk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRuZXdCbG9jay5ub3JtYWxpemUoKTtcblxuXHRcdFx0XHQvLyBOZXcgYmxvY2sgbWlnaHQgYmVjb21lIGVtcHR5IGlmIGl0J3MgPHA+PGI+YSB8PC9iPjwvcD5cblx0XHRcdFx0aWYgKGRvbS5pc0VtcHR5KG5ld0Jsb2NrKSkge1xuXHRcdFx0XHRcdGRvbS5yZW1vdmUobmV3QmxvY2spO1xuXHRcdFx0XHRcdGluc2VydE5ld0Jsb2NrQWZ0ZXIoKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRtb3ZlVG9DYXJldFBvc2l0aW9uKG5ld0Jsb2NrKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRkb20uc2V0QXR0cmliKG5ld0Jsb2NrLCAnaWQnLCAnJyk7IC8vIFJlbW92ZSBJRCBzaW5jZSBpdCBuZWVkcyB0byBiZSBkb2N1bWVudCB1bmlxdWVcblxuXHRcdFx0Ly8gQWxsb3cgY3VzdG9tIGhhbmRsaW5nIG9mIG5ldyBibG9ja3Ncblx0XHRcdGVkaXRvci5maXJlKCdOZXdCbG9jaycsIHtuZXdCbG9jazogbmV3QmxvY2t9KTtcblxuXHRcdFx0dW5kb01hbmFnZXIudHlwaW5nID0gZmFsc2U7XG5cdFx0XHR1bmRvTWFuYWdlci5hZGQoKTtcblx0XHR9XG5cblx0XHRlZGl0b3Iub24oJ2tleWRvd24nLCBmdW5jdGlvbihldnQpIHtcblx0XHRcdGlmIChldnQua2V5Q29kZSA9PSAxMykge1xuXHRcdFx0XHRpZiAoaGFuZGxlRW50ZXJLZXkoZXZ0KSAhPT0gZmFsc2UpIHtcblx0XHRcdFx0XHRldnQucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0pO1xuXHR9O1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy9Gb3JjZUJsb2Nrcy5qc1xuXG4vKipcbiAqIEZvcmNlQmxvY2tzLmpzXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgTEdQTCBMaWNlbnNlLlxuICogQ29weXJpZ2h0IChjKSAxOTk5LTIwMTUgRXBob3ggQ29ycC4gQWxsIHJpZ2h0cyByZXNlcnZlZFxuICpcbiAqIExpY2Vuc2U6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vbGljZW5zZVxuICogQ29udHJpYnV0aW5nOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2NvbnRyaWJ1dGluZ1xuICovXG5cbi8qKlxuICogTWFrZXMgc3VyZSB0aGF0IGV2ZXJ5dGhpbmcgZ2V0cyB3cmFwcGVkIGluIHBhcmFncmFwaHMuXG4gKlxuICogQHByaXZhdGVcbiAqIEBjbGFzcyB0aW55bWNlLkZvcmNlQmxvY2tzXG4gKi9cbmRlZmluZShcInRpbnltY2UvRm9yY2VCbG9ja3NcIiwgW10sIGZ1bmN0aW9uKCkge1xuXHRyZXR1cm4gZnVuY3Rpb24oZWRpdG9yKSB7XG5cdFx0dmFyIHNldHRpbmdzID0gZWRpdG9yLnNldHRpbmdzLCBkb20gPSBlZGl0b3IuZG9tLCBzZWxlY3Rpb24gPSBlZGl0b3Iuc2VsZWN0aW9uO1xuXHRcdHZhciBzY2hlbWEgPSBlZGl0b3Iuc2NoZW1hLCBibG9ja0VsZW1lbnRzID0gc2NoZW1hLmdldEJsb2NrRWxlbWVudHMoKTtcblxuXHRcdGZ1bmN0aW9uIGFkZFJvb3RCbG9ja3MoKSB7XG5cdFx0XHR2YXIgbm9kZSA9IHNlbGVjdGlvbi5nZXRTdGFydCgpLCByb290Tm9kZSA9IGVkaXRvci5nZXRCb2R5KCksIHJuZztcblx0XHRcdHZhciBzdGFydENvbnRhaW5lciwgc3RhcnRPZmZzZXQsIGVuZENvbnRhaW5lciwgZW5kT2Zmc2V0LCByb290QmxvY2tOb2RlO1xuXHRcdFx0dmFyIHRlbXBOb2RlLCBvZmZzZXQgPSAtMHhGRkZGRkYsIHdyYXBwZWQsIHJlc3RvcmVTZWxlY3Rpb247XG5cdFx0XHR2YXIgdG1wUm5nLCByb290Tm9kZU5hbWUsIGZvcmNlZFJvb3RCbG9jaztcblxuXHRcdFx0Zm9yY2VkUm9vdEJsb2NrID0gc2V0dGluZ3MuZm9yY2VkX3Jvb3RfYmxvY2s7XG5cblx0XHRcdGlmICghbm9kZSB8fCBub2RlLm5vZGVUeXBlICE9PSAxIHx8ICFmb3JjZWRSb290QmxvY2spIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBDaGVjayBpZiBub2RlIGlzIHdyYXBwZWQgaW4gYmxvY2tcblx0XHRcdHdoaWxlIChub2RlICYmIG5vZGUgIT0gcm9vdE5vZGUpIHtcblx0XHRcdFx0aWYgKGJsb2NrRWxlbWVudHNbbm9kZS5ub2RlTmFtZV0pIHtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRub2RlID0gbm9kZS5wYXJlbnROb2RlO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBHZXQgY3VycmVudCBzZWxlY3Rpb25cblx0XHRcdHJuZyA9IHNlbGVjdGlvbi5nZXRSbmcoKTtcblx0XHRcdGlmIChybmcuc2V0U3RhcnQpIHtcblx0XHRcdFx0c3RhcnRDb250YWluZXIgPSBybmcuc3RhcnRDb250YWluZXI7XG5cdFx0XHRcdHN0YXJ0T2Zmc2V0ID0gcm5nLnN0YXJ0T2Zmc2V0O1xuXHRcdFx0XHRlbmRDb250YWluZXIgPSBybmcuZW5kQ29udGFpbmVyO1xuXHRcdFx0XHRlbmRPZmZzZXQgPSBybmcuZW5kT2Zmc2V0O1xuXG5cdFx0XHRcdHRyeSB7XG5cdFx0XHRcdFx0cmVzdG9yZVNlbGVjdGlvbiA9IGVkaXRvci5nZXREb2MoKS5hY3RpdmVFbGVtZW50ID09PSByb290Tm9kZTtcblx0XHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0XHQvLyBJRSB0aHJvd3MgdW5zcGVjaWZpZWQgZXJyb3IgaGVyZSBzb21ldGltZXNcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Ly8gRm9yY2UgY29udHJvbCByYW5nZSBpbnRvIHRleHQgcmFuZ2Vcblx0XHRcdFx0aWYgKHJuZy5pdGVtKSB7XG5cdFx0XHRcdFx0bm9kZSA9IHJuZy5pdGVtKDApO1xuXHRcdFx0XHRcdHJuZyA9IGVkaXRvci5nZXREb2MoKS5ib2R5LmNyZWF0ZVRleHRSYW5nZSgpO1xuXHRcdFx0XHRcdHJuZy5tb3ZlVG9FbGVtZW50VGV4dChub2RlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJlc3RvcmVTZWxlY3Rpb24gPSBybmcucGFyZW50RWxlbWVudCgpLm93bmVyRG9jdW1lbnQgPT09IGVkaXRvci5nZXREb2MoKTtcblx0XHRcdFx0dG1wUm5nID0gcm5nLmR1cGxpY2F0ZSgpO1xuXHRcdFx0XHR0bXBSbmcuY29sbGFwc2UodHJ1ZSk7XG5cdFx0XHRcdHN0YXJ0T2Zmc2V0ID0gdG1wUm5nLm1vdmUoJ2NoYXJhY3RlcicsIG9mZnNldCkgKiAtMTtcblxuXHRcdFx0XHRpZiAoIXRtcFJuZy5jb2xsYXBzZWQpIHtcblx0XHRcdFx0XHR0bXBSbmcgPSBybmcuZHVwbGljYXRlKCk7XG5cdFx0XHRcdFx0dG1wUm5nLmNvbGxhcHNlKGZhbHNlKTtcblx0XHRcdFx0XHRlbmRPZmZzZXQgPSAodG1wUm5nLm1vdmUoJ2NoYXJhY3RlcicsIG9mZnNldCkgKiAtMSkgLSBzdGFydE9mZnNldDtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHQvLyBXcmFwIG5vbiBibG9jayBlbGVtZW50cyBhbmQgdGV4dCBub2Rlc1xuXHRcdFx0bm9kZSA9IHJvb3ROb2RlLmZpcnN0Q2hpbGQ7XG5cdFx0XHRyb290Tm9kZU5hbWUgPSByb290Tm9kZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0d2hpbGUgKG5vZGUpIHtcblx0XHRcdFx0Ly8gVE9ETzogQnJlYWsgdGhpcyB1cCwgdG9vIGNvbXBsZXhcblx0XHRcdFx0aWYgKCgobm9kZS5ub2RlVHlwZSA9PT0gMyB8fCAobm9kZS5ub2RlVHlwZSA9PSAxICYmICFibG9ja0VsZW1lbnRzW25vZGUubm9kZU5hbWVdKSkpICYmXG5cdFx0XHRcdFx0c2NoZW1hLmlzVmFsaWRDaGlsZChyb290Tm9kZU5hbWUsIGZvcmNlZFJvb3RCbG9jay50b0xvd2VyQ2FzZSgpKSkge1xuXHRcdFx0XHRcdC8vIFJlbW92ZSBlbXB0eSB0ZXh0IG5vZGVzXG5cdFx0XHRcdFx0aWYgKG5vZGUubm9kZVR5cGUgPT09IDMgJiYgbm9kZS5ub2RlVmFsdWUubGVuZ3RoID09PSAwKSB7XG5cdFx0XHRcdFx0XHR0ZW1wTm9kZSA9IG5vZGU7XG5cdFx0XHRcdFx0XHRub2RlID0gbm9kZS5uZXh0U2libGluZztcblx0XHRcdFx0XHRcdGRvbS5yZW1vdmUodGVtcE5vZGUpO1xuXHRcdFx0XHRcdFx0Y29udGludWU7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKCFyb290QmxvY2tOb2RlKSB7XG5cdFx0XHRcdFx0XHRyb290QmxvY2tOb2RlID0gZG9tLmNyZWF0ZShmb3JjZWRSb290QmxvY2ssIGVkaXRvci5zZXR0aW5ncy5mb3JjZWRfcm9vdF9ibG9ja19hdHRycyk7XG5cdFx0XHRcdFx0XHRub2RlLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHJvb3RCbG9ja05vZGUsIG5vZGUpO1xuXHRcdFx0XHRcdFx0d3JhcHBlZCA9IHRydWU7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0dGVtcE5vZGUgPSBub2RlO1xuXHRcdFx0XHRcdG5vZGUgPSBub2RlLm5leHRTaWJsaW5nO1xuXHRcdFx0XHRcdHJvb3RCbG9ja05vZGUuYXBwZW5kQ2hpbGQodGVtcE5vZGUpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHJvb3RCbG9ja05vZGUgPSBudWxsO1xuXHRcdFx0XHRcdG5vZGUgPSBub2RlLm5leHRTaWJsaW5nO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh3cmFwcGVkICYmIHJlc3RvcmVTZWxlY3Rpb24pIHtcblx0XHRcdFx0aWYgKHJuZy5zZXRTdGFydCkge1xuXHRcdFx0XHRcdHJuZy5zZXRTdGFydChzdGFydENvbnRhaW5lciwgc3RhcnRPZmZzZXQpO1xuXHRcdFx0XHRcdHJuZy5zZXRFbmQoZW5kQ29udGFpbmVyLCBlbmRPZmZzZXQpO1xuXHRcdFx0XHRcdHNlbGVjdGlvbi5zZXRSbmcocm5nKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHQvLyBPbmx5IHNlbGVjdCBpZiB0aGUgcHJldmlvdXMgc2VsZWN0aW9uIHdhcyBpbnNpZGUgdGhlIGRvY3VtZW50IHRvIHByZXZlbnQgYXV0byBmb2N1cyBpbiBxdWlya3MgbW9kZVxuXHRcdFx0XHRcdHRyeSB7XG5cdFx0XHRcdFx0XHRybmcgPSBlZGl0b3IuZ2V0RG9jKCkuYm9keS5jcmVhdGVUZXh0UmFuZ2UoKTtcblx0XHRcdFx0XHRcdHJuZy5tb3ZlVG9FbGVtZW50VGV4dChyb290Tm9kZSk7XG5cdFx0XHRcdFx0XHRybmcuY29sbGFwc2UodHJ1ZSk7XG5cdFx0XHRcdFx0XHRybmcubW92ZVN0YXJ0KCdjaGFyYWN0ZXInLCBzdGFydE9mZnNldCk7XG5cblx0XHRcdFx0XHRcdGlmIChlbmRPZmZzZXQgPiAwKSB7XG5cdFx0XHRcdFx0XHRcdHJuZy5tb3ZlRW5kKCdjaGFyYWN0ZXInLCBlbmRPZmZzZXQpO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRybmcuc2VsZWN0KCk7XG5cdFx0XHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0XHRcdC8vIElnbm9yZVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdGVkaXRvci5ub2RlQ2hhbmdlZCgpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8vIEZvcmNlIHJvb3QgYmxvY2tzXG5cdFx0aWYgKHNldHRpbmdzLmZvcmNlZF9yb290X2Jsb2NrKSB7XG5cdFx0XHRlZGl0b3Iub24oJ05vZGVDaGFuZ2UnLCBhZGRSb290QmxvY2tzKTtcblx0XHR9XG5cdH07XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL2NhcmV0L0NhcmV0VXRpbHMuanNcblxuLyoqXG4gKiBDYXJldFV0aWxzLmpzXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgTEdQTCBMaWNlbnNlLlxuICogQ29weXJpZ2h0IChjKSAxOTk5LTIwMTUgRXBob3ggQ29ycC4gQWxsIHJpZ2h0cyByZXNlcnZlZFxuICpcbiAqIExpY2Vuc2U6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vbGljZW5zZVxuICogQ29udHJpYnV0aW5nOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2NvbnRyaWJ1dGluZ1xuICovXG5cbi8qKlxuICogVXRpbGl0eSBmdW5jdGlvbnMgc2hhcmVkIGJ5IHRoZSBjYXJldCBsb2dpYy5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQGNsYXNzIHRpbnltY2UuY2FyZXQuQ2FyZXRVdGlsc1xuICovXG5kZWZpbmUoXCJ0aW55bWNlL2NhcmV0L0NhcmV0VXRpbHNcIiwgW1xuXHRcInRpbnltY2UvdXRpbC9GdW5cIixcblx0XCJ0aW55bWNlL2RvbS9UcmVlV2Fsa2VyXCIsXG5cdFwidGlueW1jZS9kb20vTm9kZVR5cGVcIixcblx0XCJ0aW55bWNlL2NhcmV0L0NhcmV0UG9zaXRpb25cIixcblx0XCJ0aW55bWNlL2NhcmV0L0NhcmV0Q29udGFpbmVyXCIsXG5cdFwidGlueW1jZS9jYXJldC9DYXJldENhbmRpZGF0ZVwiXG5dLCBmdW5jdGlvbihGdW4sIFRyZWVXYWxrZXIsIE5vZGVUeXBlLCBDYXJldFBvc2l0aW9uLCBDYXJldENvbnRhaW5lciwgQ2FyZXRDYW5kaWRhdGUpIHtcblx0dmFyIGlzQ29udGVudEVkaXRhYmxlVHJ1ZSA9IE5vZGVUeXBlLmlzQ29udGVudEVkaXRhYmxlVHJ1ZSxcblx0XHRpc0NvbnRlbnRFZGl0YWJsZUZhbHNlID0gTm9kZVR5cGUuaXNDb250ZW50RWRpdGFibGVGYWxzZSxcblx0XHRpc0Jsb2NrTGlrZSA9IE5vZGVUeXBlLm1hdGNoU3R5bGVWYWx1ZXMoJ2Rpc3BsYXknLCAnYmxvY2sgdGFibGUgdGFibGUtY2VsbCB0YWJsZS1jYXB0aW9uJyksXG5cdFx0aXNDYXJldENvbnRhaW5lciA9IENhcmV0Q29udGFpbmVyLmlzQ2FyZXRDb250YWluZXIsXG5cdFx0aXNDYXJldENvbnRhaW5lckJsb2NrID0gQ2FyZXRDb250YWluZXIuaXNDYXJldENvbnRhaW5lckJsb2NrLFxuXHRcdGN1cnJ5ID0gRnVuLmN1cnJ5LFxuXHRcdGlzRWxlbWVudCA9IE5vZGVUeXBlLmlzRWxlbWVudCxcblx0XHRpc0NhcmV0Q2FuZGlkYXRlID0gQ2FyZXRDYW5kaWRhdGUuaXNDYXJldENhbmRpZGF0ZTtcblxuXHRmdW5jdGlvbiBpc0ZvcndhcmRzKGRpcmVjdGlvbikge1xuXHRcdHJldHVybiBkaXJlY3Rpb24gPiAwO1xuXHR9XG5cblx0ZnVuY3Rpb24gaXNCYWNrd2FyZHMoZGlyZWN0aW9uKSB7XG5cdFx0cmV0dXJuIGRpcmVjdGlvbiA8IDA7XG5cdH1cblxuXHRmdW5jdGlvbiBza2lwQ2FyZXRDb250YWluZXJzKHdhbGssIHNoYWxsb3cpIHtcblx0XHR2YXIgbm9kZTtcblxuXHRcdHdoaWxlICgobm9kZSA9IHdhbGsoc2hhbGxvdykpKSB7XG5cdFx0XHRpZiAoIWlzQ2FyZXRDb250YWluZXJCbG9jayhub2RlKSkge1xuXHRcdFx0XHRyZXR1cm4gbm9kZTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gbnVsbDtcblx0fVxuXG5cdGZ1bmN0aW9uIGZpbmROb2RlKG5vZGUsIGRpcmVjdGlvbiwgcHJlZGljYXRlRm4sIHJvb3ROb2RlLCBzaGFsbG93KSB7XG5cdFx0dmFyIHdhbGtlciA9IG5ldyBUcmVlV2Fsa2VyKG5vZGUsIHJvb3ROb2RlKTtcblxuXHRcdGlmIChpc0JhY2t3YXJkcyhkaXJlY3Rpb24pKSB7XG5cdFx0XHRpZiAoaXNDb250ZW50RWRpdGFibGVGYWxzZShub2RlKSB8fCBpc0NhcmV0Q29udGFpbmVyQmxvY2sobm9kZSkpIHtcblx0XHRcdFx0bm9kZSA9IHNraXBDYXJldENvbnRhaW5lcnMod2Fsa2VyLnByZXYsIHRydWUpO1xuXHRcdFx0XHRpZiAocHJlZGljYXRlRm4obm9kZSkpIHtcblx0XHRcdFx0XHRyZXR1cm4gbm9kZTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHR3aGlsZSAoKG5vZGUgPSBza2lwQ2FyZXRDb250YWluZXJzKHdhbGtlci5wcmV2LCBzaGFsbG93KSkpIHtcblx0XHRcdFx0aWYgKHByZWRpY2F0ZUZuKG5vZGUpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5vZGU7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoaXNGb3J3YXJkcyhkaXJlY3Rpb24pKSB7XG5cdFx0XHRpZiAoaXNDb250ZW50RWRpdGFibGVGYWxzZShub2RlKSB8fCBpc0NhcmV0Q29udGFpbmVyQmxvY2sobm9kZSkpIHtcblx0XHRcdFx0bm9kZSA9IHNraXBDYXJldENvbnRhaW5lcnMod2Fsa2VyLm5leHQsIHRydWUpO1xuXHRcdFx0XHRpZiAocHJlZGljYXRlRm4obm9kZSkpIHtcblx0XHRcdFx0XHRyZXR1cm4gbm9kZTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHR3aGlsZSAoKG5vZGUgPSBza2lwQ2FyZXRDb250YWluZXJzKHdhbGtlci5uZXh0LCBzaGFsbG93KSkpIHtcblx0XHRcdFx0aWYgKHByZWRpY2F0ZUZuKG5vZGUpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5vZGU7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gbnVsbDtcblx0fVxuXG5cdGZ1bmN0aW9uIGdldEVkaXRpbmdIb3N0KG5vZGUsIHJvb3ROb2RlKSB7XG5cdFx0Zm9yIChub2RlID0gbm9kZS5wYXJlbnROb2RlOyBub2RlICYmIG5vZGUgIT0gcm9vdE5vZGU7IG5vZGUgPSBub2RlLnBhcmVudE5vZGUpIHtcblx0XHRcdGlmIChpc0NvbnRlbnRFZGl0YWJsZVRydWUobm9kZSkpIHtcblx0XHRcdFx0cmV0dXJuIG5vZGU7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJvb3ROb2RlO1xuXHR9XG5cblx0ZnVuY3Rpb24gZ2V0UGFyZW50QmxvY2sobm9kZSwgcm9vdE5vZGUpIHtcblx0XHR3aGlsZSAobm9kZSAmJiBub2RlICE9IHJvb3ROb2RlKSB7XG5cdFx0XHRpZiAoaXNCbG9ja0xpa2Uobm9kZSkpIHtcblx0XHRcdFx0cmV0dXJuIG5vZGU7XG5cdFx0XHR9XG5cblx0XHRcdG5vZGUgPSBub2RlLnBhcmVudE5vZGU7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIG51bGw7XG5cdH1cblxuXHRmdW5jdGlvbiBpc0luU2FtZUJsb2NrKGNhcmV0UG9zaXRpb24xLCBjYXJldFBvc2l0aW9uMiwgcm9vdE5vZGUpIHtcblx0XHRyZXR1cm4gZ2V0UGFyZW50QmxvY2soY2FyZXRQb3NpdGlvbjEuY29udGFpbmVyKCksIHJvb3ROb2RlKSA9PSBnZXRQYXJlbnRCbG9jayhjYXJldFBvc2l0aW9uMi5jb250YWluZXIoKSwgcm9vdE5vZGUpO1xuXHR9XG5cblx0ZnVuY3Rpb24gaXNJblNhbWVFZGl0aW5nSG9zdChjYXJldFBvc2l0aW9uMSwgY2FyZXRQb3NpdGlvbjIsIHJvb3ROb2RlKSB7XG5cdFx0cmV0dXJuIGdldEVkaXRpbmdIb3N0KGNhcmV0UG9zaXRpb24xLmNvbnRhaW5lcigpLCByb290Tm9kZSkgPT0gZ2V0RWRpdGluZ0hvc3QoY2FyZXRQb3NpdGlvbjIuY29udGFpbmVyKCksIHJvb3ROb2RlKTtcblx0fVxuXG5cdGZ1bmN0aW9uIGdldENoaWxkTm9kZUF0UmVsYXRpdmVPZmZzZXQocmVsYXRpdmVPZmZzZXQsIGNhcmV0UG9zaXRpb24pIHtcblx0XHR2YXIgY29udGFpbmVyLCBvZmZzZXQ7XG5cblx0XHRpZiAoIWNhcmV0UG9zaXRpb24pIHtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblxuXHRcdGNvbnRhaW5lciA9IGNhcmV0UG9zaXRpb24uY29udGFpbmVyKCk7XG5cdFx0b2Zmc2V0ID0gY2FyZXRQb3NpdGlvbi5vZmZzZXQoKTtcblxuXHRcdGlmICghaXNFbGVtZW50KGNvbnRhaW5lcikpIHtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblxuXHRcdHJldHVybiBjb250YWluZXIuY2hpbGROb2Rlc1tvZmZzZXQgKyByZWxhdGl2ZU9mZnNldF07XG5cdH1cblxuXHRmdW5jdGlvbiBiZWZvcmVBZnRlcihiZWZvcmUsIG5vZGUpIHtcblx0XHR2YXIgcmFuZ2UgPSBub2RlLm93bmVyRG9jdW1lbnQuY3JlYXRlUmFuZ2UoKTtcblxuXHRcdGlmIChiZWZvcmUpIHtcblx0XHRcdHJhbmdlLnNldFN0YXJ0QmVmb3JlKG5vZGUpO1xuXHRcdFx0cmFuZ2Uuc2V0RW5kQmVmb3JlKG5vZGUpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyYW5nZS5zZXRTdGFydEFmdGVyKG5vZGUpO1xuXHRcdFx0cmFuZ2Uuc2V0RW5kQWZ0ZXIobm9kZSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJhbmdlO1xuXHR9XG5cblx0ZnVuY3Rpb24gaXNOb2Rlc0luU2FtZUJsb2NrKHJvb3ROb2RlLCBub2RlMSwgbm9kZTIpIHtcblx0XHRyZXR1cm4gZ2V0UGFyZW50QmxvY2sobm9kZTEsIHJvb3ROb2RlKSA9PSBnZXRQYXJlbnRCbG9jayhub2RlMiwgcm9vdE5vZGUpO1xuXHR9XG5cblx0ZnVuY3Rpb24gbGVhbihsZWZ0LCByb290Tm9kZSwgbm9kZSkge1xuXHRcdHZhciBzaWJsaW5nLCBzaWJsaW5nTmFtZTtcblxuXHRcdGlmIChsZWZ0KSB7XG5cdFx0XHRzaWJsaW5nTmFtZSA9ICdwcmV2aW91c1NpYmxpbmcnO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRzaWJsaW5nTmFtZSA9ICduZXh0U2libGluZyc7XG5cdFx0fVxuXG5cdFx0d2hpbGUgKG5vZGUgJiYgbm9kZSAhPSByb290Tm9kZSkge1xuXHRcdFx0c2libGluZyA9IG5vZGVbc2libGluZ05hbWVdO1xuXG5cdFx0XHRpZiAoaXNDYXJldENvbnRhaW5lcihzaWJsaW5nKSkge1xuXHRcdFx0XHRzaWJsaW5nID0gc2libGluZ1tzaWJsaW5nTmFtZV07XG5cdFx0XHR9XG5cblx0XHRcdGlmIChpc0NvbnRlbnRFZGl0YWJsZUZhbHNlKHNpYmxpbmcpKSB7XG5cdFx0XHRcdGlmIChpc05vZGVzSW5TYW1lQmxvY2socm9vdE5vZGUsIHNpYmxpbmcsIG5vZGUpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHNpYmxpbmc7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRicmVhaztcblx0XHRcdH1cblxuXHRcdFx0aWYgKGlzQ2FyZXRDYW5kaWRhdGUoc2libGluZykpIHtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHR9XG5cblx0XHRcdG5vZGUgPSBub2RlLnBhcmVudE5vZGU7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIG51bGw7XG5cdH1cblxuXHR2YXIgYmVmb3JlID0gY3VycnkoYmVmb3JlQWZ0ZXIsIHRydWUpO1xuXHR2YXIgYWZ0ZXIgPSBjdXJyeShiZWZvcmVBZnRlciwgZmFsc2UpO1xuXG5cdGZ1bmN0aW9uIG5vcm1hbGl6ZVJhbmdlKGRpcmVjdGlvbiwgcm9vdE5vZGUsIHJhbmdlKSB7XG5cdFx0dmFyIG5vZGUsIGNvbnRhaW5lciwgb2Zmc2V0LCBsb2NhdGlvbjtcblx0XHR2YXIgbGVhbkxlZnQgPSBjdXJyeShsZWFuLCB0cnVlLCByb290Tm9kZSk7XG5cdFx0dmFyIGxlYW5SaWdodCA9IGN1cnJ5KGxlYW4sIGZhbHNlLCByb290Tm9kZSk7XG5cblx0XHRjb250YWluZXIgPSByYW5nZS5zdGFydENvbnRhaW5lcjtcblx0XHRvZmZzZXQgPSByYW5nZS5zdGFydE9mZnNldDtcblxuXHRcdGlmIChDYXJldENvbnRhaW5lci5pc0NhcmV0Q29udGFpbmVyQmxvY2soY29udGFpbmVyKSkge1xuXHRcdFx0aWYgKCFpc0VsZW1lbnQoY29udGFpbmVyKSkge1xuXHRcdFx0XHRjb250YWluZXIgPSBjb250YWluZXIucGFyZW50Tm9kZTtcblx0XHRcdH1cblxuXHRcdFx0bG9jYXRpb24gPSBjb250YWluZXIuZ2V0QXR0cmlidXRlKCdkYXRhLW1jZS1jYXJldCcpO1xuXG5cdFx0XHRpZiAobG9jYXRpb24gPT0gJ2JlZm9yZScpIHtcblx0XHRcdFx0bm9kZSA9IGNvbnRhaW5lci5uZXh0U2libGluZztcblx0XHRcdFx0aWYgKGlzQ29udGVudEVkaXRhYmxlRmFsc2Uobm9kZSkpIHtcblx0XHRcdFx0XHRyZXR1cm4gYmVmb3JlKG5vZGUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmIChsb2NhdGlvbiA9PSAnYWZ0ZXInKSB7XG5cdFx0XHRcdG5vZGUgPSBjb250YWluZXIucHJldmlvdXNTaWJsaW5nO1xuXHRcdFx0XHRpZiAoaXNDb250ZW50RWRpdGFibGVGYWxzZShub2RlKSkge1xuXHRcdFx0XHRcdHJldHVybiBhZnRlcihub2RlKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghcmFuZ2UuY29sbGFwc2VkKSB7XG5cdFx0XHRyZXR1cm4gcmFuZ2U7XG5cdFx0fVxuXG5cdFx0aWYgKE5vZGVUeXBlLmlzVGV4dChjb250YWluZXIpKSB7XG5cdFx0XHRpZiAoaXNDYXJldENvbnRhaW5lcihjb250YWluZXIpKSB7XG5cdFx0XHRcdGlmIChkaXJlY3Rpb24gPT09IDEpIHtcblx0XHRcdFx0XHRub2RlID0gbGVhblJpZ2h0KGNvbnRhaW5lcik7XG5cdFx0XHRcdFx0aWYgKG5vZGUpIHtcblx0XHRcdFx0XHRcdHJldHVybiBiZWZvcmUobm9kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0bm9kZSA9IGxlYW5MZWZ0KGNvbnRhaW5lcik7XG5cdFx0XHRcdFx0aWYgKG5vZGUpIHtcblx0XHRcdFx0XHRcdHJldHVybiBhZnRlcihub2RlKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoZGlyZWN0aW9uID09PSAtMSkge1xuXHRcdFx0XHRcdG5vZGUgPSBsZWFuTGVmdChjb250YWluZXIpO1xuXHRcdFx0XHRcdGlmIChub2RlKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gYWZ0ZXIobm9kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0bm9kZSA9IGxlYW5SaWdodChjb250YWluZXIpO1xuXHRcdFx0XHRcdGlmIChub2RlKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gYmVmb3JlKG5vZGUpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByYW5nZTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKENhcmV0Q29udGFpbmVyLmVuZHNXaXRoQ2FyZXRDb250YWluZXIoY29udGFpbmVyKSAmJiBvZmZzZXQgPj0gY29udGFpbmVyLmRhdGEubGVuZ3RoIC0gMSkge1xuXHRcdFx0XHRpZiAoZGlyZWN0aW9uID09PSAxKSB7XG5cdFx0XHRcdFx0bm9kZSA9IGxlYW5SaWdodChjb250YWluZXIpO1xuXHRcdFx0XHRcdGlmIChub2RlKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gYmVmb3JlKG5vZGUpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByYW5nZTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKENhcmV0Q29udGFpbmVyLnN0YXJ0c1dpdGhDYXJldENvbnRhaW5lcihjb250YWluZXIpICYmIG9mZnNldCA8PSAxKSB7XG5cdFx0XHRcdGlmIChkaXJlY3Rpb24gPT09IC0xKSB7XG5cdFx0XHRcdFx0bm9kZSA9IGxlYW5MZWZ0KGNvbnRhaW5lcik7XG5cdFx0XHRcdFx0aWYgKG5vZGUpIHtcblx0XHRcdFx0XHRcdHJldHVybiBhZnRlcihub2RlKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcmFuZ2U7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChvZmZzZXQgPT09IGNvbnRhaW5lci5kYXRhLmxlbmd0aCkge1xuXHRcdFx0XHRub2RlID0gbGVhblJpZ2h0KGNvbnRhaW5lcik7XG5cdFx0XHRcdGlmIChub2RlKSB7XG5cdFx0XHRcdFx0cmV0dXJuIGJlZm9yZShub2RlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByYW5nZTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKG9mZnNldCA9PT0gMCkge1xuXHRcdFx0XHRub2RlID0gbGVhbkxlZnQoY29udGFpbmVyKTtcblx0XHRcdFx0aWYgKG5vZGUpIHtcblx0XHRcdFx0XHRyZXR1cm4gYWZ0ZXIobm9kZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcmFuZ2U7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJhbmdlO1xuXHR9XG5cblx0ZnVuY3Rpb24gaXNOZXh0VG9Db250ZW50RWRpdGFibGVGYWxzZShyZWxhdGl2ZU9mZnNldCwgY2FyZXRQb3NpdGlvbikge1xuXHRcdHJldHVybiBpc0NvbnRlbnRFZGl0YWJsZUZhbHNlKGdldENoaWxkTm9kZUF0UmVsYXRpdmVPZmZzZXQocmVsYXRpdmVPZmZzZXQsIGNhcmV0UG9zaXRpb24pKTtcblx0fVxuXG5cdHJldHVybiB7XG5cdFx0aXNGb3J3YXJkczogaXNGb3J3YXJkcyxcblx0XHRpc0JhY2t3YXJkczogaXNCYWNrd2FyZHMsXG5cdFx0ZmluZE5vZGU6IGZpbmROb2RlLFxuXHRcdGdldEVkaXRpbmdIb3N0OiBnZXRFZGl0aW5nSG9zdCxcblx0XHRnZXRQYXJlbnRCbG9jazogZ2V0UGFyZW50QmxvY2ssXG5cdFx0aXNJblNhbWVCbG9jazogaXNJblNhbWVCbG9jayxcblx0XHRpc0luU2FtZUVkaXRpbmdIb3N0OiBpc0luU2FtZUVkaXRpbmdIb3N0LFxuXHRcdGlzQmVmb3JlQ29udGVudEVkaXRhYmxlRmFsc2U6IGN1cnJ5KGlzTmV4dFRvQ29udGVudEVkaXRhYmxlRmFsc2UsIDApLFxuXHRcdGlzQWZ0ZXJDb250ZW50RWRpdGFibGVGYWxzZTogY3VycnkoaXNOZXh0VG9Db250ZW50RWRpdGFibGVGYWxzZSwgLTEpLFxuXHRcdG5vcm1hbGl6ZVJhbmdlOiBub3JtYWxpemVSYW5nZVxuXHR9O1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy9jYXJldC9DYXJldFdhbGtlci5qc1xuXG4vKipcbiAqIENhcmV0V2Fsa2VyLmpzXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgTEdQTCBMaWNlbnNlLlxuICogQ29weXJpZ2h0IChjKSAxOTk5LTIwMTUgRXBob3ggQ29ycC4gQWxsIHJpZ2h0cyByZXNlcnZlZFxuICpcbiAqIExpY2Vuc2U6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vbGljZW5zZVxuICogQ29udHJpYnV0aW5nOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2NvbnRyaWJ1dGluZ1xuICovXG5cbi8qKlxuICogVGhpcyBtb2R1bGUgY29udGFpbnMgbG9naWMgZm9yIG1vdmluZyBhcm91bmQgYSB2aXJ0dWFsIGNhcmV0IGluIGxvZ2ljYWwgb3JkZXIgd2l0aGluIGEgRE9NIGVsZW1lbnQuXG4gKlxuICogSXQgaWdub3JlcyB0aGUgbW9zdCBvYnZpb3VzIGludmFsaWQgY2FyZXQgbG9jYXRpb25zIHN1Y2ggYXMgd2l0aGluIGEgc2NyaXB0IGVsZW1lbnQgb3Igd2l0aGluIGFcbiAqIGNvbnRlbnRFZGl0YWJsZT1mYWxzZSBlbGVtZW50IGJ1dCBpdCB3aWxsIHJldHVybiBsb2NhdGlvbnMgdGhhdCBpc24ndCBwb3NzaWJsZSB0byByZW5kZXIgdmlzdWFsbHkuXG4gKlxuICogQHByaXZhdGVcbiAqIEBjbGFzcyB0aW55bWNlLmNhcmV0LkNhcmV0V2Fsa2VyXG4gKiBAZXhhbXBsZVxuICogdmFyIGNhcmV0V2Fsa2VyID0gbmV3IENhcmV0V2Fsa2VyKHJvb3RFbG0pO1xuICpcbiAqIHZhciBwcmV2TG9naWNhbENhcmV0UG9zaXRpb24gPSBjYXJldFdhbGtlci5wcmV2KENhcmV0UG9zaXRpb24uZnJvbVJhbmdlU3RhcnQocmFuZ2UpKTtcbiAqIHZhciBuZXh0TG9naWNhbENhcmV0UG9zaXRpb24gPSBjYXJldFdhbGtlci5uZXh0KENhcmV0UG9zaXRpb24uZnJvbVJhbmdlRW5kKHJhbmdlKSk7XG4gKi9cbmRlZmluZShcInRpbnltY2UvY2FyZXQvQ2FyZXRXYWxrZXJcIiwgW1xuXHRcInRpbnltY2UvZG9tL05vZGVUeXBlXCIsXG5cdFwidGlueW1jZS9jYXJldC9DYXJldENhbmRpZGF0ZVwiLFxuXHRcInRpbnltY2UvY2FyZXQvQ2FyZXRQb3NpdGlvblwiLFxuXHRcInRpbnltY2UvY2FyZXQvQ2FyZXRVdGlsc1wiLFxuXHRcInRpbnltY2UvdXRpbC9BcnJcIixcblx0XCJ0aW55bWNlL3V0aWwvRnVuXCJcbl0sIGZ1bmN0aW9uKE5vZGVUeXBlLCBDYXJldENhbmRpZGF0ZSwgQ2FyZXRQb3NpdGlvbiwgQ2FyZXRVdGlscywgQXJyLCBGdW4pIHtcblx0dmFyIGlzQ29udGVudEVkaXRhYmxlRmFsc2UgPSBOb2RlVHlwZS5pc0NvbnRlbnRFZGl0YWJsZUZhbHNlLFxuXHRcdGlzVGV4dCA9IE5vZGVUeXBlLmlzVGV4dCxcblx0XHRpc0VsZW1lbnQgPSBOb2RlVHlwZS5pc0VsZW1lbnQsXG5cdFx0aXNCciA9IE5vZGVUeXBlLmlzQnIsXG5cdFx0aXNGb3J3YXJkcyA9IENhcmV0VXRpbHMuaXNGb3J3YXJkcyxcblx0XHRpc0JhY2t3YXJkcyA9IENhcmV0VXRpbHMuaXNCYWNrd2FyZHMsXG5cdFx0aXNDYXJldENhbmRpZGF0ZSA9IENhcmV0Q2FuZGlkYXRlLmlzQ2FyZXRDYW5kaWRhdGUsXG5cdFx0aXNBdG9taWMgPSBDYXJldENhbmRpZGF0ZS5pc0F0b21pYyxcblx0XHRpc0VkaXRhYmxlQ2FyZXRDYW5kaWRhdGUgPSBDYXJldENhbmRpZGF0ZS5pc0VkaXRhYmxlQ2FyZXRDYW5kaWRhdGU7XG5cblx0ZnVuY3Rpb24gZ2V0UGFyZW50cyhub2RlLCByb290Tm9kZSkge1xuXHRcdHZhciBwYXJlbnRzID0gW107XG5cblx0XHR3aGlsZSAobm9kZSAmJiBub2RlICE9IHJvb3ROb2RlKSB7XG5cdFx0XHRwYXJlbnRzLnB1c2gobm9kZSk7XG5cdFx0XHRub2RlID0gbm9kZS5wYXJlbnROb2RlO1xuXHRcdH1cblxuXHRcdHJldHVybiBwYXJlbnRzO1xuXHR9XG5cblx0ZnVuY3Rpb24gbm9kZUF0SW5kZXgoY29udGFpbmVyLCBvZmZzZXQpIHtcblx0XHRpZiAoY29udGFpbmVyLmhhc0NoaWxkTm9kZXMoKSAmJiBvZmZzZXQgPCBjb250YWluZXIuY2hpbGROb2Rlcy5sZW5ndGgpIHtcblx0XHRcdHJldHVybiBjb250YWluZXIuY2hpbGROb2Rlc1tvZmZzZXRdO1xuXHRcdH1cblxuXHRcdHJldHVybiBudWxsO1xuXHR9XG5cblx0ZnVuY3Rpb24gZ2V0Q2FyZXRDYW5kaWRhdGVQb3NpdGlvbihkaXJlY3Rpb24sIG5vZGUpIHtcblx0XHRpZiAoaXNGb3J3YXJkcyhkaXJlY3Rpb24pKSB7XG5cdFx0XHRpZiAoaXNDYXJldENhbmRpZGF0ZShub2RlLnByZXZpb3VzU2libGluZykgJiYgIWlzVGV4dChub2RlLnByZXZpb3VzU2libGluZykpIHtcblx0XHRcdFx0cmV0dXJuIENhcmV0UG9zaXRpb24uYmVmb3JlKG5vZGUpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoaXNUZXh0KG5vZGUpKSB7XG5cdFx0XHRcdHJldHVybiBDYXJldFBvc2l0aW9uKG5vZGUsIDApO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmIChpc0JhY2t3YXJkcyhkaXJlY3Rpb24pKSB7XG5cdFx0XHRpZiAoaXNDYXJldENhbmRpZGF0ZShub2RlLm5leHRTaWJsaW5nKSAmJiAhaXNUZXh0KG5vZGUubmV4dFNpYmxpbmcpKSB7XG5cdFx0XHRcdHJldHVybiBDYXJldFBvc2l0aW9uLmFmdGVyKG5vZGUpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoaXNUZXh0KG5vZGUpKSB7XG5cdFx0XHRcdHJldHVybiBDYXJldFBvc2l0aW9uKG5vZGUsIG5vZGUuZGF0YS5sZW5ndGgpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmIChpc0JhY2t3YXJkcyhkaXJlY3Rpb24pKSB7XG5cdFx0XHRpZiAoaXNCcihub2RlKSkge1xuXHRcdFx0XHRyZXR1cm4gQ2FyZXRQb3NpdGlvbi5iZWZvcmUobm9kZSk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBDYXJldFBvc2l0aW9uLmFmdGVyKG5vZGUpO1xuXHRcdH1cblxuXHRcdHJldHVybiBDYXJldFBvc2l0aW9uLmJlZm9yZShub2RlKTtcblx0fVxuXG5cdC8vIEp1bXBzIG92ZXIgQlIgZWxlbWVudHMgPHA+fDxicj48L3A+PHA+YTwvcD4gLT4gPHA+PGJyPjwvcD48cD58YTwvcD5cblx0ZnVuY3Rpb24gaXNCckJlZm9yZUJsb2NrKG5vZGUsIHJvb3ROb2RlKSB7XG5cdFx0dmFyIG5leHQ7XG5cblx0XHRpZiAoIU5vZGVUeXBlLmlzQnIobm9kZSkpIHtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cblx0XHRuZXh0ID0gZmluZENhcmV0UG9zaXRpb24oMSwgQ2FyZXRQb3NpdGlvbi5hZnRlcihub2RlKSwgcm9vdE5vZGUpO1xuXHRcdGlmICghbmV4dCkge1xuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblxuXHRcdHJldHVybiAhQ2FyZXRVdGlscy5pc0luU2FtZUJsb2NrKENhcmV0UG9zaXRpb24uYmVmb3JlKG5vZGUpLCBDYXJldFBvc2l0aW9uLmJlZm9yZShuZXh0KSwgcm9vdE5vZGUpO1xuXHR9XG5cblx0ZnVuY3Rpb24gZmluZENhcmV0UG9zaXRpb24oZGlyZWN0aW9uLCBzdGFydENhcmV0UG9zaXRpb24sIHJvb3ROb2RlKSB7XG5cdFx0dmFyIGNvbnRhaW5lciwgb2Zmc2V0LCBub2RlLCBuZXh0Tm9kZSwgaW5uZXJOb2RlLFxuXHRcdFx0cm9vdENvbnRlbnRFZGl0YWJsZUZhbHNlRWxtLCBjYXJldFBvc2l0aW9uO1xuXG5cdFx0aWYgKCFpc0VsZW1lbnQocm9vdE5vZGUpIHx8ICFzdGFydENhcmV0UG9zaXRpb24pIHtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblxuXHRcdGNhcmV0UG9zaXRpb24gPSBzdGFydENhcmV0UG9zaXRpb247XG5cdFx0Y29udGFpbmVyID0gY2FyZXRQb3NpdGlvbi5jb250YWluZXIoKTtcblx0XHRvZmZzZXQgPSBjYXJldFBvc2l0aW9uLm9mZnNldCgpO1xuXG5cdFx0aWYgKGlzVGV4dChjb250YWluZXIpKSB7XG5cdFx0XHRpZiAoaXNCYWNrd2FyZHMoZGlyZWN0aW9uKSAmJiBvZmZzZXQgPiAwKSB7XG5cdFx0XHRcdHJldHVybiBDYXJldFBvc2l0aW9uKGNvbnRhaW5lciwgLS1vZmZzZXQpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoaXNGb3J3YXJkcyhkaXJlY3Rpb24pICYmIG9mZnNldCA8IGNvbnRhaW5lci5sZW5ndGgpIHtcblx0XHRcdFx0cmV0dXJuIENhcmV0UG9zaXRpb24oY29udGFpbmVyLCArK29mZnNldCk7XG5cdFx0XHR9XG5cblx0XHRcdG5vZGUgPSBjb250YWluZXI7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGlmIChpc0JhY2t3YXJkcyhkaXJlY3Rpb24pICYmIG9mZnNldCA+IDApIHtcblx0XHRcdFx0bmV4dE5vZGUgPSBub2RlQXRJbmRleChjb250YWluZXIsIG9mZnNldCAtIDEpO1xuXHRcdFx0XHRpZiAoaXNDYXJldENhbmRpZGF0ZShuZXh0Tm9kZSkpIHtcblx0XHRcdFx0XHRpZiAoIWlzQXRvbWljKG5leHROb2RlKSkge1xuXHRcdFx0XHRcdFx0aW5uZXJOb2RlID0gQ2FyZXRVdGlscy5maW5kTm9kZShuZXh0Tm9kZSwgZGlyZWN0aW9uLCBpc0VkaXRhYmxlQ2FyZXRDYW5kaWRhdGUsIG5leHROb2RlKTtcblx0XHRcdFx0XHRcdGlmIChpbm5lck5vZGUpIHtcblx0XHRcdFx0XHRcdFx0aWYgKGlzVGV4dChpbm5lck5vZGUpKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIENhcmV0UG9zaXRpb24oaW5uZXJOb2RlLCBpbm5lck5vZGUuZGF0YS5sZW5ndGgpO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIENhcmV0UG9zaXRpb24uYWZ0ZXIoaW5uZXJOb2RlKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoaXNUZXh0KG5leHROb2RlKSkge1xuXHRcdFx0XHRcdFx0cmV0dXJuIENhcmV0UG9zaXRpb24obmV4dE5vZGUsIG5leHROb2RlLmRhdGEubGVuZ3RoKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gQ2FyZXRQb3NpdGlvbi5iZWZvcmUobmV4dE5vZGUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmIChpc0ZvcndhcmRzKGRpcmVjdGlvbikgJiYgb2Zmc2V0IDwgY29udGFpbmVyLmNoaWxkTm9kZXMubGVuZ3RoKSB7XG5cdFx0XHRcdG5leHROb2RlID0gbm9kZUF0SW5kZXgoY29udGFpbmVyLCBvZmZzZXQpO1xuXHRcdFx0XHRpZiAoaXNDYXJldENhbmRpZGF0ZShuZXh0Tm9kZSkpIHtcblx0XHRcdFx0XHRpZiAoaXNCckJlZm9yZUJsb2NrKG5leHROb2RlLCByb290Tm9kZSkpIHtcblx0XHRcdFx0XHRcdHJldHVybiBmaW5kQ2FyZXRQb3NpdGlvbihkaXJlY3Rpb24sIENhcmV0UG9zaXRpb24uYWZ0ZXIobmV4dE5vZGUpLCByb290Tm9kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKCFpc0F0b21pYyhuZXh0Tm9kZSkpIHtcblx0XHRcdFx0XHRcdGlubmVyTm9kZSA9IENhcmV0VXRpbHMuZmluZE5vZGUobmV4dE5vZGUsIGRpcmVjdGlvbiwgaXNFZGl0YWJsZUNhcmV0Q2FuZGlkYXRlLCBuZXh0Tm9kZSk7XG5cdFx0XHRcdFx0XHRpZiAoaW5uZXJOb2RlKSB7XG5cdFx0XHRcdFx0XHRcdGlmIChpc1RleHQoaW5uZXJOb2RlKSkge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiBDYXJldFBvc2l0aW9uKGlubmVyTm9kZSwgMCk7XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gQ2FyZXRQb3NpdGlvbi5iZWZvcmUoaW5uZXJOb2RlKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoaXNUZXh0KG5leHROb2RlKSkge1xuXHRcdFx0XHRcdFx0cmV0dXJuIENhcmV0UG9zaXRpb24obmV4dE5vZGUsIDApO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBDYXJldFBvc2l0aW9uLmFmdGVyKG5leHROb2RlKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRub2RlID0gY2FyZXRQb3NpdGlvbi5nZXROb2RlKCk7XG5cdFx0fVxuXG5cdFx0aWYgKChpc0ZvcndhcmRzKGRpcmVjdGlvbikgJiYgY2FyZXRQb3NpdGlvbi5pc0F0RW5kKCkpIHx8IChpc0JhY2t3YXJkcyhkaXJlY3Rpb24pICYmIGNhcmV0UG9zaXRpb24uaXNBdFN0YXJ0KCkpKSB7XG5cdFx0XHRub2RlID0gQ2FyZXRVdGlscy5maW5kTm9kZShub2RlLCBkaXJlY3Rpb24sIEZ1bi5jb25zdGFudCh0cnVlKSwgcm9vdE5vZGUsIHRydWUpO1xuXHRcdFx0aWYgKGlzRWRpdGFibGVDYXJldENhbmRpZGF0ZShub2RlKSkge1xuXHRcdFx0XHRyZXR1cm4gZ2V0Q2FyZXRDYW5kaWRhdGVQb3NpdGlvbihkaXJlY3Rpb24sIG5vZGUpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdG5leHROb2RlID0gQ2FyZXRVdGlscy5maW5kTm9kZShub2RlLCBkaXJlY3Rpb24sIGlzRWRpdGFibGVDYXJldENhbmRpZGF0ZSwgcm9vdE5vZGUpO1xuXG5cdFx0cm9vdENvbnRlbnRFZGl0YWJsZUZhbHNlRWxtID0gQXJyLmxhc3QoQXJyLmZpbHRlcihnZXRQYXJlbnRzKGNvbnRhaW5lciwgcm9vdE5vZGUpLCBpc0NvbnRlbnRFZGl0YWJsZUZhbHNlKSk7XG5cdFx0aWYgKHJvb3RDb250ZW50RWRpdGFibGVGYWxzZUVsbSAmJiAoIW5leHROb2RlIHx8ICFyb290Q29udGVudEVkaXRhYmxlRmFsc2VFbG0uY29udGFpbnMobmV4dE5vZGUpKSkge1xuXHRcdFx0aWYgKGlzRm9yd2FyZHMoZGlyZWN0aW9uKSkge1xuXHRcdFx0XHRjYXJldFBvc2l0aW9uID0gQ2FyZXRQb3NpdGlvbi5hZnRlcihyb290Q29udGVudEVkaXRhYmxlRmFsc2VFbG0pO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y2FyZXRQb3NpdGlvbiA9IENhcmV0UG9zaXRpb24uYmVmb3JlKHJvb3RDb250ZW50RWRpdGFibGVGYWxzZUVsbSk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBjYXJldFBvc2l0aW9uO1xuXHRcdH1cblxuXHRcdGlmIChuZXh0Tm9kZSkge1xuXHRcdFx0cmV0dXJuIGdldENhcmV0Q2FuZGlkYXRlUG9zaXRpb24oZGlyZWN0aW9uLCBuZXh0Tm9kZSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIG51bGw7XG5cdH1cblxuXHRyZXR1cm4gZnVuY3Rpb24ocm9vdE5vZGUpIHtcblx0XHRyZXR1cm4ge1xuXHRcdFx0LyoqXG5cdFx0XHQgKiBSZXR1cm5zIHRoZSBuZXh0IGxvZ2ljYWwgY2FyZXQgcG9zaXRpb24gZnJvbSB0aGUgc3BlY2lmaWNlZCBpbnB1dFxuXHRcdFx0ICogY2FyZXRQb2lzaXRvbiBvciBudWxsIGlmIHRoZXJlIGlzbid0IGFueSBtb3JlIHBvc2l0aW9ucyBsZWZ0IGZvciBleGFtcGxlXG5cdFx0XHQgKiBhdCB0aGUgZW5kIHNwZWNpZmllZCByb290IGVsZW1lbnQuXG5cdFx0XHQgKlxuXHRcdFx0ICogQG1ldGhvZCBuZXh0XG5cdFx0XHQgKiBAcGFyYW0ge3RpbnltY2UuY2FyZXQuQ2FyZXRQb3NpdGlvbn0gY2FyZXRQb3NpdGlvbiBDYXJldCBwb3NpdGlvbiB0byBzdGFydCBmcm9tLlxuXHRcdFx0ICogQHJldHVybiB7dGlueW1jZS5jYXJldC5DYXJldFBvc2l0aW9ufSBDYXJldFBvc2l0aW9uIG9yIG51bGwgaWYgbm8gcG9zaXRpb24gd2FzIGZvdW5kLlxuXHRcdFx0ICovXG5cdFx0XHRuZXh0OiBmdW5jdGlvbihjYXJldFBvc2l0aW9uKSB7XG5cdFx0XHRcdHJldHVybiBmaW5kQ2FyZXRQb3NpdGlvbigxLCBjYXJldFBvc2l0aW9uLCByb290Tm9kZSk7XG5cdFx0XHR9LFxuXG5cdFx0XHQvKipcblx0XHRcdCAqIFJldHVybnMgdGhlIHByZXZpb3VzIGxvZ2ljYWwgY2FyZXQgcG9zaXRpb24gZnJvbSB0aGUgc3BlY2lmaWNlZCBpbnB1dFxuXHRcdFx0ICogY2FyZXRQb2lzaXRvbiBvciBudWxsIGlmIHRoZXJlIGlzbid0IGFueSBtb3JlIHBvc2l0aW9ucyBsZWZ0IGZvciBleGFtcGxlXG5cdFx0XHQgKiBhdCB0aGUgZW5kIHNwZWNpZmllZCByb290IGVsZW1lbnQuXG5cdFx0XHQgKlxuXHRcdFx0ICogQG1ldGhvZCBwcmV2XG5cdFx0XHQgKiBAcGFyYW0ge3RpbnltY2UuY2FyZXQuQ2FyZXRQb3NpdGlvbn0gY2FyZXRQb3NpdGlvbiBDYXJldCBwb3NpdGlvbiB0byBzdGFydCBmcm9tLlxuXHRcdFx0ICogQHJldHVybiB7dGlueW1jZS5jYXJldC5DYXJldFBvc2l0aW9ufSBDYXJldFBvc2l0aW9uIG9yIG51bGwgaWYgbm8gcG9zaXRpb24gd2FzIGZvdW5kLlxuXHRcdFx0ICovXG5cdFx0XHRwcmV2OiBmdW5jdGlvbihjYXJldFBvc2l0aW9uKSB7XG5cdFx0XHRcdHJldHVybiBmaW5kQ2FyZXRQb3NpdGlvbigtMSwgY2FyZXRQb3NpdGlvbiwgcm9vdE5vZGUpO1xuXHRcdFx0fVxuXHRcdH07XG5cdH07XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL0luc2VydExpc3QuanNcblxuLyoqXG4gKiBJbnNlcnRMaXN0LmpzXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgTEdQTCBMaWNlbnNlLlxuICogQ29weXJpZ2h0IChjKSAxOTk5LTIwMTYgRXBob3ggQ29ycC4gQWxsIHJpZ2h0cyByZXNlcnZlZFxuICpcbiAqIExpY2Vuc2U6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vbGljZW5zZVxuICogQ29udHJpYnV0aW5nOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2NvbnRyaWJ1dGluZ1xuICovXG5cbi8qKlxuICogSGFuZGxlcyBpbnNlcnRzIG9mIGxpc3RzIGludG8gdGhlIGVkaXRvciBpbnN0YW5jZS5cbiAqXG4gKiBAY2xhc3MgdGlueW1jZS5JbnNlcnRMaXN0XG4gKiBAcHJpdmF0ZVxuICovXG5kZWZpbmUoXCJ0aW55bWNlL0luc2VydExpc3RcIiwgW1xuXHRcInRpbnltY2UvdXRpbC9Ub29sc1wiLFxuXHRcInRpbnltY2UvY2FyZXQvQ2FyZXRXYWxrZXJcIixcblx0XCJ0aW55bWNlL2NhcmV0L0NhcmV0UG9zaXRpb25cIlxuXSwgZnVuY3Rpb24oVG9vbHMsIENhcmV0V2Fsa2VyLCBDYXJldFBvc2l0aW9uKSB7XG5cdHZhciBpc0xpc3RGcmFnbWVudCA9IGZ1bmN0aW9uKGZyYWdtZW50KSB7XG5cdFx0dmFyIGZpcnN0Q2hpbGQgPSBmcmFnbWVudC5maXJzdENoaWxkO1xuXHRcdHZhciBsYXN0Q2hpbGQgPSBmcmFnbWVudC5sYXN0Q2hpbGQ7XG5cblx0XHQvLyBTa2lwIG1ldGEgc2luY2UgaXQncyBsaWtlbHkgPG1ldGE+PHVsPi4uPC91bD5cblx0XHRpZiAoZmlyc3RDaGlsZCAmJiBmaXJzdENoaWxkLm5hbWUgPT09ICdtZXRhJykge1xuXHRcdFx0Zmlyc3RDaGlsZCA9IGZpcnN0Q2hpbGQubmV4dDtcblx0XHR9XG5cblx0XHQvLyBTa2lwIG1jZV9tYXJrZXIgc2luY2UgaXQncyBsaWtlbHkgPHVsPi4uPC91bD48c3BhbiBpZD1cIm1jZV9tYXJrZXJcIj48L3NwYW4+XG5cdFx0aWYgKGxhc3RDaGlsZCAmJiBsYXN0Q2hpbGQuYXR0cignaWQnKSA9PT0gJ21jZV9tYXJrZXInKSB7XG5cdFx0XHRsYXN0Q2hpbGQgPSBsYXN0Q2hpbGQucHJldjtcblx0XHR9XG5cblx0XHRpZiAoIWZpcnN0Q2hpbGQgfHwgZmlyc3RDaGlsZCAhPT0gbGFzdENoaWxkKSB7XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGZpcnN0Q2hpbGQubmFtZSA9PT0gJ3VsJyB8fCBmaXJzdENoaWxkLm5hbWUgPT09ICdvbCc7XG5cdH07XG5cblx0dmFyIGNsZWFudXBEb21GcmFnbWVudCA9IGZ1bmN0aW9uIChkb21GcmFnbWVudCkge1xuXHRcdHZhciBmaXJzdENoaWxkID0gZG9tRnJhZ21lbnQuZmlyc3RDaGlsZDtcblx0XHR2YXIgbGFzdENoaWxkID0gZG9tRnJhZ21lbnQubGFzdENoaWxkO1xuXG5cdFx0Ly8gVE9ETzogcmVtb3ZlIHRoZSBtZXRhIHRhZyBmcm9tIHBhc3RlIGxvZ2ljXG5cdFx0aWYgKGZpcnN0Q2hpbGQgJiYgZmlyc3RDaGlsZC5ub2RlTmFtZSA9PT0gJ01FVEEnKSB7XG5cdFx0XHRmaXJzdENoaWxkLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZmlyc3RDaGlsZCk7XG5cdFx0fVxuXG5cdFx0aWYgKGxhc3RDaGlsZCAmJiBsYXN0Q2hpbGQuaWQgPT09ICdtY2VfbWFya2VyJykge1xuXHRcdFx0bGFzdENoaWxkLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobGFzdENoaWxkKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gZG9tRnJhZ21lbnQ7XG5cdH07XG5cblx0dmFyIHRvRG9tRnJhZ21lbnQgPSBmdW5jdGlvbihkb20sIHNlcmlhbGl6ZXIsIGZyYWdtZW50KSB7XG5cdFx0dmFyIGh0bWwgPSBzZXJpYWxpemVyLnNlcmlhbGl6ZShmcmFnbWVudCk7XG5cdFx0dmFyIGRvbUZyYWdtZW50ID0gZG9tLmNyZWF0ZUZyYWdtZW50KGh0bWwpO1xuXG5cdFx0cmV0dXJuIGNsZWFudXBEb21GcmFnbWVudChkb21GcmFnbWVudCk7XG5cdH07XG5cblx0dmFyIGxpc3RJdGVtcyA9IGZ1bmN0aW9uKGVsbSkge1xuXHRcdHJldHVybiBUb29scy5ncmVwKGVsbS5jaGlsZE5vZGVzLCBmdW5jdGlvbihjaGlsZCkge1xuXHRcdFx0cmV0dXJuIGNoaWxkLm5vZGVOYW1lID09PSAnTEknO1xuXHRcdH0pO1xuXHR9O1xuXG5cdHZhciBpc0VtcHR5ID0gZnVuY3Rpb24gKGVsbSkge1xuXHRcdHJldHVybiAhZWxtLmZpcnN0Q2hpbGQ7XG5cdH07XG5cblx0dmFyIHRyaW1MaXN0SXRlbXMgPSBmdW5jdGlvbihlbG1zKSB7XG5cdFx0cmV0dXJuIGVsbXMubGVuZ3RoID4gMCAmJiBpc0VtcHR5KGVsbXNbZWxtcy5sZW5ndGggLSAxXSkgPyBlbG1zLnNsaWNlKDAsIC0xKSA6IGVsbXM7XG5cdH07XG5cblx0dmFyIGdldFBhcmVudExpID0gZnVuY3Rpb24oZG9tLCBub2RlKSB7XG5cdFx0dmFyIHBhcmVudEJsb2NrID0gZG9tLmdldFBhcmVudChub2RlLCBkb20uaXNCbG9jayk7XG5cdFx0cmV0dXJuIHBhcmVudEJsb2NrICYmIHBhcmVudEJsb2NrLm5vZGVOYW1lID09PSAnTEknID8gcGFyZW50QmxvY2sgOiBudWxsO1xuXHR9O1xuXG5cdHZhciBpc1BhcmVudEJsb2NrTGkgPSBmdW5jdGlvbihkb20sIG5vZGUpIHtcblx0XHRyZXR1cm4gISFnZXRQYXJlbnRMaShkb20sIG5vZGUpO1xuXHR9O1xuXG5cdHZhciBnZXRTcGxpdCA9IGZ1bmN0aW9uKHBhcmVudE5vZGUsIHJuZykge1xuXHRcdHZhciBiZWZvcmVSbmcgPSBybmcuY2xvbmVSYW5nZSgpO1xuXHRcdHZhciBhZnRlclJuZyA9IHJuZy5jbG9uZVJhbmdlKCk7XG5cblx0XHRiZWZvcmVSbmcuc2V0U3RhcnRCZWZvcmUocGFyZW50Tm9kZSk7XG5cdFx0YWZ0ZXJSbmcuc2V0RW5kQWZ0ZXIocGFyZW50Tm9kZSk7XG5cblx0XHRyZXR1cm4gW1xuXHRcdFx0YmVmb3JlUm5nLmNsb25lQ29udGVudHMoKSxcblx0XHRcdGFmdGVyUm5nLmNsb25lQ29udGVudHMoKVxuXHRcdF07XG5cdH07XG5cblx0dmFyIGZpbmRGaXJzdEluID0gZnVuY3Rpb24obm9kZSwgcm9vdE5vZGUpIHtcblx0XHR2YXIgY2FyZXRQb3MgPSBDYXJldFBvc2l0aW9uLmJlZm9yZShub2RlKTtcblx0XHR2YXIgY2FyZXRXYWxrZXIgPSBuZXcgQ2FyZXRXYWxrZXIocm9vdE5vZGUpO1xuXHRcdHZhciBuZXdDYXJldFBvcyA9IGNhcmV0V2Fsa2VyLm5leHQoY2FyZXRQb3MpO1xuXG5cdFx0cmV0dXJuIG5ld0NhcmV0UG9zID8gbmV3Q2FyZXRQb3MudG9SYW5nZSgpIDogbnVsbDtcblx0fTtcblxuXHR2YXIgZmluZExhc3RPZiA9IGZ1bmN0aW9uKG5vZGUsIHJvb3ROb2RlKSB7XG5cdFx0dmFyIGNhcmV0UG9zID0gQ2FyZXRQb3NpdGlvbi5hZnRlcihub2RlKTtcblx0XHR2YXIgY2FyZXRXYWxrZXIgPSBuZXcgQ2FyZXRXYWxrZXIocm9vdE5vZGUpO1xuXHRcdHZhciBuZXdDYXJldFBvcyA9IGNhcmV0V2Fsa2VyLnByZXYoY2FyZXRQb3MpO1xuXG5cdFx0cmV0dXJuIG5ld0NhcmV0UG9zID8gbmV3Q2FyZXRQb3MudG9SYW5nZSgpIDogbnVsbDtcblx0fTtcblxuXHR2YXIgaW5zZXJ0TWlkZGxlID0gZnVuY3Rpb24odGFyZ2V0LCBlbG1zLCByb290Tm9kZSwgcm5nKSB7XG5cdFx0dmFyIHBhcnRzID0gZ2V0U3BsaXQodGFyZ2V0LCBybmcpO1xuXHRcdHZhciBwYXJlbnRFbG0gPSB0YXJnZXQucGFyZW50Tm9kZTtcblxuXHRcdHBhcmVudEVsbS5pbnNlcnRCZWZvcmUocGFydHNbMF0sIHRhcmdldCk7XG5cdFx0VG9vbHMuZWFjaChlbG1zLCBmdW5jdGlvbihsaSkge1xuXHRcdFx0cGFyZW50RWxtLmluc2VydEJlZm9yZShsaSwgdGFyZ2V0KTtcblx0XHR9KTtcblx0XHRwYXJlbnRFbG0uaW5zZXJ0QmVmb3JlKHBhcnRzWzFdLCB0YXJnZXQpO1xuXHRcdHBhcmVudEVsbS5yZW1vdmVDaGlsZCh0YXJnZXQpO1xuXG5cdFx0cmV0dXJuIGZpbmRMYXN0T2YoZWxtc1tlbG1zLmxlbmd0aCAtIDFdLCByb290Tm9kZSk7XG5cdH07XG5cblx0dmFyIGluc2VydEJlZm9yZSA9IGZ1bmN0aW9uKHRhcmdldCwgZWxtcywgcm9vdE5vZGUpIHtcblx0XHR2YXIgcGFyZW50RWxtID0gdGFyZ2V0LnBhcmVudE5vZGU7XG5cblx0XHRUb29scy5lYWNoKGVsbXMsIGZ1bmN0aW9uKGVsbSkge1xuXHRcdFx0cGFyZW50RWxtLmluc2VydEJlZm9yZShlbG0sIHRhcmdldCk7XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gZmluZEZpcnN0SW4odGFyZ2V0LCByb290Tm9kZSk7XG5cdH07XG5cblx0dmFyIGluc2VydEFmdGVyID0gZnVuY3Rpb24odGFyZ2V0LCBlbG1zLCByb290Tm9kZSwgZG9tKSB7XG5cdFx0ZG9tLmluc2VydEFmdGVyKGVsbXMucmV2ZXJzZSgpLCB0YXJnZXQpO1xuXHRcdHJldHVybiBmaW5kTGFzdE9mKGVsbXNbMF0sIHJvb3ROb2RlKTtcblx0fTtcblxuXHR2YXIgaW5zZXJ0QXRDYXJldCA9IGZ1bmN0aW9uKHNlcmlhbGl6ZXIsIGRvbSwgcm5nLCBmcmFnbWVudCkge1xuXHRcdHZhciBkb21GcmFnbWVudCA9IHRvRG9tRnJhZ21lbnQoZG9tLCBzZXJpYWxpemVyLCBmcmFnbWVudCk7XG5cdFx0dmFyIGxpVGFyZ2V0ID0gZ2V0UGFyZW50TGkoZG9tLCBybmcuc3RhcnRDb250YWluZXIpO1xuXHRcdHZhciBsaUVsbXMgPSB0cmltTGlzdEl0ZW1zKGxpc3RJdGVtcyhkb21GcmFnbWVudC5maXJzdENoaWxkKSk7XG5cdFx0dmFyIEJFR0lOTklORyA9IDEsIEVORCA9IDI7XG5cdFx0dmFyIHJvb3ROb2RlID0gZG9tLmdldFJvb3QoKTtcblxuXHRcdHZhciBpc0F0ID0gZnVuY3Rpb24obG9jYXRpb24pIHtcblx0XHRcdHZhciBjYXJldFBvcyA9IENhcmV0UG9zaXRpb24uZnJvbVJhbmdlU3RhcnQocm5nKTtcblx0XHRcdHZhciBjYXJldFdhbGtlciA9IG5ldyBDYXJldFdhbGtlcihkb20uZ2V0Um9vdCgpKTtcblx0XHRcdHZhciBuZXdQb3MgPSBsb2NhdGlvbiA9PT0gQkVHSU5OSU5HID8gY2FyZXRXYWxrZXIucHJldihjYXJldFBvcykgOiBjYXJldFdhbGtlci5uZXh0KGNhcmV0UG9zKTtcblxuXHRcdFx0cmV0dXJuIG5ld1BvcyA/IGdldFBhcmVudExpKGRvbSwgbmV3UG9zLmdldE5vZGUoKSkgIT09IGxpVGFyZ2V0IDogdHJ1ZTtcblx0XHR9O1xuXG5cdFx0aWYgKGlzQXQoQkVHSU5OSU5HKSkge1xuXHRcdFx0cmV0dXJuIGluc2VydEJlZm9yZShsaVRhcmdldCwgbGlFbG1zLCByb290Tm9kZSk7XG5cdFx0fSBlbHNlIGlmIChpc0F0KEVORCkpIHtcblx0XHRcdHJldHVybiBpbnNlcnRBZnRlcihsaVRhcmdldCwgbGlFbG1zLCByb290Tm9kZSwgZG9tKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gaW5zZXJ0TWlkZGxlKGxpVGFyZ2V0LCBsaUVsbXMsIHJvb3ROb2RlLCBybmcpO1xuXHR9O1xuXG5cdHJldHVybiB7XG5cdFx0aXNMaXN0RnJhZ21lbnQ6IGlzTGlzdEZyYWdtZW50LFxuXHRcdGluc2VydEF0Q2FyZXQ6IGluc2VydEF0Q2FyZXQsXG5cdFx0aXNQYXJlbnRCbG9ja0xpOiBpc1BhcmVudEJsb2NrTGksXG5cdFx0dHJpbUxpc3RJdGVtczogdHJpbUxpc3RJdGVtcyxcblx0XHRsaXN0SXRlbXM6IGxpc3RJdGVtc1xuXHR9O1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy9JbnNlcnRDb250ZW50LmpzXG5cbi8qKlxuICogSW5zZXJ0Q29udGVudC5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE2IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKipcbiAqIEhhbmRsZXMgaW5zZXJ0cyBvZiBjb250ZW50cyBpbnRvIHRoZSBlZGl0b3IgaW5zdGFuY2UuXG4gKlxuICogQGNsYXNzIHRpbnltY2UuSW5zZXJ0Q29udGVudFxuICogQHByaXZhdGVcbiAqL1xuZGVmaW5lKFwidGlueW1jZS9JbnNlcnRDb250ZW50XCIsIFtcblx0XCJ0aW55bWNlL0VudlwiLFxuXHRcInRpbnltY2UvdXRpbC9Ub29sc1wiLFxuXHRcInRpbnltY2UvaHRtbC9TZXJpYWxpemVyXCIsXG5cdFwidGlueW1jZS9jYXJldC9DYXJldFdhbGtlclwiLFxuXHRcInRpbnltY2UvY2FyZXQvQ2FyZXRQb3NpdGlvblwiLFxuXHRcInRpbnltY2UvZG9tL0VsZW1lbnRVdGlsc1wiLFxuXHRcInRpbnltY2UvZG9tL05vZGVUeXBlXCIsXG5cdFwidGlueW1jZS9JbnNlcnRMaXN0XCJcbl0sIGZ1bmN0aW9uKEVudiwgVG9vbHMsIFNlcmlhbGl6ZXIsIENhcmV0V2Fsa2VyLCBDYXJldFBvc2l0aW9uLCBFbGVtZW50VXRpbHMsIE5vZGVUeXBlLCBJbnNlcnRMaXN0KSB7XG5cdHZhciBpc1RhYmxlQ2VsbCA9IE5vZGVUeXBlLm1hdGNoTm9kZU5hbWVzKCd0ZCB0aCcpO1xuXG5cdHZhciBpbnNlcnRIdG1sQXRDYXJldCA9IGZ1bmN0aW9uKGVkaXRvciwgdmFsdWUsIGRldGFpbHMpIHtcblx0XHR2YXIgcGFyc2VyLCBzZXJpYWxpemVyLCBwYXJlbnROb2RlLCByb290Tm9kZSwgZnJhZ21lbnQsIGFyZ3M7XG5cdFx0dmFyIG1hcmtlciwgcm5nLCBub2RlLCBub2RlMiwgYm9va21hcmtIdG1sLCBtZXJnZTtcblx0XHR2YXIgdGV4dElubGluZUVsZW1lbnRzID0gZWRpdG9yLnNjaGVtYS5nZXRUZXh0SW5saW5lRWxlbWVudHMoKTtcblx0XHR2YXIgc2VsZWN0aW9uID0gZWRpdG9yLnNlbGVjdGlvbiwgZG9tID0gZWRpdG9yLmRvbTtcblxuXHRcdGZ1bmN0aW9uIHRyaW1PclBhZGRMZWZ0UmlnaHQoaHRtbCkge1xuXHRcdFx0dmFyIHJuZywgY29udGFpbmVyLCBvZmZzZXQ7XG5cblx0XHRcdHJuZyA9IHNlbGVjdGlvbi5nZXRSbmcodHJ1ZSk7XG5cdFx0XHRjb250YWluZXIgPSBybmcuc3RhcnRDb250YWluZXI7XG5cdFx0XHRvZmZzZXQgPSBybmcuc3RhcnRPZmZzZXQ7XG5cblx0XHRcdGZ1bmN0aW9uIGhhc1NpYmxpbmdUZXh0KHNpYmxpbmdOYW1lKSB7XG5cdFx0XHRcdHJldHVybiBjb250YWluZXJbc2libGluZ05hbWVdICYmIGNvbnRhaW5lcltzaWJsaW5nTmFtZV0ubm9kZVR5cGUgPT0gMztcblx0XHRcdH1cblxuXHRcdFx0aWYgKGNvbnRhaW5lci5ub2RlVHlwZSA9PSAzKSB7XG5cdFx0XHRcdGlmIChvZmZzZXQgPiAwKSB7XG5cdFx0XHRcdFx0aHRtbCA9IGh0bWwucmVwbGFjZSgvXiZuYnNwOy8sICcgJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIWhhc1NpYmxpbmdUZXh0KCdwcmV2aW91c1NpYmxpbmcnKSkge1xuXHRcdFx0XHRcdGh0bWwgPSBodG1sLnJlcGxhY2UoL14gLywgJyZuYnNwOycpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKG9mZnNldCA8IGNvbnRhaW5lci5sZW5ndGgpIHtcblx0XHRcdFx0XHRodG1sID0gaHRtbC5yZXBsYWNlKC8mbmJzcDsoPGJyPnwpJC8sICcgJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIWhhc1NpYmxpbmdUZXh0KCduZXh0U2libGluZycpKSB7XG5cdFx0XHRcdFx0aHRtbCA9IGh0bWwucmVwbGFjZSgvKCZuYnNwO3wgKSg8YnI+fCkkLywgJyZuYnNwOycpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBodG1sO1xuXHRcdH1cblxuXHRcdC8vIFJlbW92ZXMgJm5ic3A7IGZyb20gYSBbYl0gYyAtPiBhICZuYnNwO2MgLT4gYSBjXG5cdFx0ZnVuY3Rpb24gdHJpbU5ic3BBZnRlckRlbGV0ZUFuZFBhZGRWYWx1ZSgpIHtcblx0XHRcdHZhciBybmcsIGNvbnRhaW5lciwgb2Zmc2V0O1xuXG5cdFx0XHRybmcgPSBzZWxlY3Rpb24uZ2V0Um5nKHRydWUpO1xuXHRcdFx0Y29udGFpbmVyID0gcm5nLnN0YXJ0Q29udGFpbmVyO1xuXHRcdFx0b2Zmc2V0ID0gcm5nLnN0YXJ0T2Zmc2V0O1xuXG5cdFx0XHRpZiAoY29udGFpbmVyLm5vZGVUeXBlID09IDMgJiYgcm5nLmNvbGxhcHNlZCkge1xuXHRcdFx0XHRpZiAoY29udGFpbmVyLmRhdGFbb2Zmc2V0XSA9PT0gJ1xcdTAwYTAnKSB7XG5cdFx0XHRcdFx0Y29udGFpbmVyLmRlbGV0ZURhdGEob2Zmc2V0LCAxKTtcblxuXHRcdFx0XHRcdGlmICghL1tcXHUwMGEwfCBdJC8udGVzdCh2YWx1ZSkpIHtcblx0XHRcdFx0XHRcdHZhbHVlICs9ICcgJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gZWxzZSBpZiAoY29udGFpbmVyLmRhdGFbb2Zmc2V0IC0gMV0gPT09ICdcXHUwMGEwJykge1xuXHRcdFx0XHRcdGNvbnRhaW5lci5kZWxldGVEYXRhKG9mZnNldCAtIDEsIDEpO1xuXG5cdFx0XHRcdFx0aWYgKCEvW1xcdTAwYTB8IF0kLy50ZXN0KHZhbHVlKSkge1xuXHRcdFx0XHRcdFx0dmFsdWUgPSAnICcgKyB2YWx1ZTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRmdW5jdGlvbiByZWR1Y2VJbmxpbmVUZXh0RWxlbWVudHMoKSB7XG5cdFx0XHRpZiAobWVyZ2UpIHtcblx0XHRcdFx0dmFyIHJvb3QgPSBlZGl0b3IuZ2V0Qm9keSgpLCBlbGVtZW50VXRpbHMgPSBuZXcgRWxlbWVudFV0aWxzKGRvbSk7XG5cblx0XHRcdFx0VG9vbHMuZWFjaChkb20uc2VsZWN0KCcqW2RhdGEtbWNlLWZyYWdtZW50XScpLCBmdW5jdGlvbihub2RlKSB7XG5cdFx0XHRcdFx0Zm9yICh2YXIgdGVzdE5vZGUgPSBub2RlLnBhcmVudE5vZGU7IHRlc3ROb2RlICYmIHRlc3ROb2RlICE9IHJvb3Q7IHRlc3ROb2RlID0gdGVzdE5vZGUucGFyZW50Tm9kZSkge1xuXHRcdFx0XHRcdFx0aWYgKHRleHRJbmxpbmVFbGVtZW50c1tub2RlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCldICYmIGVsZW1lbnRVdGlscy5jb21wYXJlKHRlc3ROb2RlLCBub2RlKSkge1xuXHRcdFx0XHRcdFx0XHRkb20ucmVtb3ZlKG5vZGUsIHRydWUpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gbWFya0ZyYWdtZW50RWxlbWVudHMoZnJhZ21lbnQpIHtcblx0XHRcdHZhciBub2RlID0gZnJhZ21lbnQ7XG5cblx0XHRcdHdoaWxlICgobm9kZSA9IG5vZGUud2FsaygpKSkge1xuXHRcdFx0XHRpZiAobm9kZS50eXBlID09PSAxKSB7XG5cdFx0XHRcdFx0bm9kZS5hdHRyKCdkYXRhLW1jZS1mcmFnbWVudCcsICcxJyk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRmdW5jdGlvbiB1bWFya0ZyYWdtZW50RWxlbWVudHMoZWxtKSB7XG5cdFx0XHRUb29scy5lYWNoKGVsbS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnKicpLCBmdW5jdGlvbihlbG0pIHtcblx0XHRcdFx0ZWxtLnJlbW92ZUF0dHJpYnV0ZSgnZGF0YS1tY2UtZnJhZ21lbnQnKTtcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIGlzUGFydE9mRnJhZ21lbnQobm9kZSkge1xuXHRcdFx0cmV0dXJuICEhbm9kZS5nZXRBdHRyaWJ1dGUoJ2RhdGEtbWNlLWZyYWdtZW50Jyk7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gY2FuSGF2ZUNoaWxkcmVuKG5vZGUpIHtcblx0XHRcdHJldHVybiBub2RlICYmICFlZGl0b3Iuc2NoZW1hLmdldFNob3J0RW5kZWRFbGVtZW50cygpW25vZGUubm9kZU5hbWVdO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIG1vdmVTZWxlY3Rpb25Ub01hcmtlcihtYXJrZXIpIHtcblx0XHRcdHZhciBwYXJlbnRFZGl0YWJsZUZhbHNlRWxtLCBwYXJlbnRCbG9jaywgbmV4dFJuZztcblxuXHRcdFx0ZnVuY3Rpb24gZ2V0Q29udGVudEVkaXRhYmxlRmFsc2VQYXJlbnQobm9kZSkge1xuXHRcdFx0XHR2YXIgcm9vdCA9IGVkaXRvci5nZXRCb2R5KCk7XG5cblx0XHRcdFx0Zm9yICg7IG5vZGUgJiYgbm9kZSAhPT0gcm9vdDsgbm9kZSA9IG5vZGUucGFyZW50Tm9kZSkge1xuXHRcdFx0XHRcdGlmIChlZGl0b3IuZG9tLmdldENvbnRlbnRFZGl0YWJsZShub2RlKSA9PT0gJ2ZhbHNlJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIG5vZGU7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cblx0XHRcdGlmICghbWFya2VyKSB7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0c2VsZWN0aW9uLnNjcm9sbEludG9WaWV3KG1hcmtlcik7XG5cblx0XHRcdC8vIElmIG1hcmtlciBpcyBpbiBjRT1mYWxzZSB0aGVuIG1vdmUgc2VsZWN0aW9uIHRvIHRoYXQgZWxlbWVudCBpbnN0ZWFkXG5cdFx0XHRwYXJlbnRFZGl0YWJsZUZhbHNlRWxtID0gZ2V0Q29udGVudEVkaXRhYmxlRmFsc2VQYXJlbnQobWFya2VyKTtcblx0XHRcdGlmIChwYXJlbnRFZGl0YWJsZUZhbHNlRWxtKSB7XG5cdFx0XHRcdGRvbS5yZW1vdmUobWFya2VyKTtcblx0XHRcdFx0c2VsZWN0aW9uLnNlbGVjdChwYXJlbnRFZGl0YWJsZUZhbHNlRWxtKTtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBNb3ZlIHNlbGVjdGlvbiBiZWZvcmUgbWFya2VyIGFuZCByZW1vdmUgaXRcblx0XHRcdHJuZyA9IGRvbS5jcmVhdGVSbmcoKTtcblxuXHRcdFx0Ly8gSWYgcHJldmlvdXMgc2libGluZyBpcyBhIHRleHQgbm9kZSBzZXQgdGhlIHNlbGVjdGlvbiB0byB0aGUgZW5kIG9mIHRoYXQgbm9kZVxuXHRcdFx0bm9kZSA9IG1hcmtlci5wcmV2aW91c1NpYmxpbmc7XG5cdFx0XHRpZiAobm9kZSAmJiBub2RlLm5vZGVUeXBlID09IDMpIHtcblx0XHRcdFx0cm5nLnNldFN0YXJ0KG5vZGUsIG5vZGUubm9kZVZhbHVlLmxlbmd0aCk7XG5cblx0XHRcdFx0Ly8gVE9ETzogV2h5IGNhbid0IHdlIG5vcm1hbGl6ZSBvbiBJRVxuXHRcdFx0XHRpZiAoIUVudi5pZSkge1xuXHRcdFx0XHRcdG5vZGUyID0gbWFya2VyLm5leHRTaWJsaW5nO1xuXHRcdFx0XHRcdGlmIChub2RlMiAmJiBub2RlMi5ub2RlVHlwZSA9PSAzKSB7XG5cdFx0XHRcdFx0XHRub2RlLmFwcGVuZERhdGEobm9kZTIuZGF0YSk7XG5cdFx0XHRcdFx0XHRub2RlMi5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG5vZGUyKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdC8vIElmIHRoZSBwcmV2aW91cyBzaWJsaW5nIGlzbid0IGEgdGV4dCBub2RlIG9yIGRvZXNuJ3QgZXhpc3Qgc2V0IHRoZSBzZWxlY3Rpb24gYmVmb3JlIHRoZSBtYXJrZXIgbm9kZVxuXHRcdFx0XHRybmcuc2V0U3RhcnRCZWZvcmUobWFya2VyKTtcblx0XHRcdFx0cm5nLnNldEVuZEJlZm9yZShtYXJrZXIpO1xuXHRcdFx0fVxuXG5cdFx0XHRmdW5jdGlvbiBmaW5kTmV4dENhcmV0Um5nKHJuZykge1xuXHRcdFx0XHR2YXIgY2FyZXRQb3MgPSBDYXJldFBvc2l0aW9uLmZyb21SYW5nZVN0YXJ0KHJuZyk7XG5cdFx0XHRcdHZhciBjYXJldFdhbGtlciA9IG5ldyBDYXJldFdhbGtlcihlZGl0b3IuZ2V0Qm9keSgpKTtcblxuXHRcdFx0XHRjYXJldFBvcyA9IGNhcmV0V2Fsa2VyLm5leHQoY2FyZXRQb3MpO1xuXHRcdFx0XHRpZiAoY2FyZXRQb3MpIHtcblx0XHRcdFx0XHRyZXR1cm4gY2FyZXRQb3MudG9SYW5nZSgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdC8vIFJlbW92ZSB0aGUgbWFya2VyIG5vZGUgYW5kIHNldCB0aGUgbmV3IHJhbmdlXG5cdFx0XHRwYXJlbnRCbG9jayA9IGRvbS5nZXRQYXJlbnQobWFya2VyLCBkb20uaXNCbG9jayk7XG5cdFx0XHRkb20ucmVtb3ZlKG1hcmtlcik7XG5cblx0XHRcdGlmIChwYXJlbnRCbG9jayAmJiBkb20uaXNFbXB0eShwYXJlbnRCbG9jaykpIHtcblx0XHRcdFx0ZWRpdG9yLiQocGFyZW50QmxvY2spLmVtcHR5KCk7XG5cblx0XHRcdFx0cm5nLnNldFN0YXJ0KHBhcmVudEJsb2NrLCAwKTtcblx0XHRcdFx0cm5nLnNldEVuZChwYXJlbnRCbG9jaywgMCk7XG5cblx0XHRcdFx0aWYgKCFpc1RhYmxlQ2VsbChwYXJlbnRCbG9jaykgJiYgIWlzUGFydE9mRnJhZ21lbnQocGFyZW50QmxvY2spICYmIChuZXh0Um5nID0gZmluZE5leHRDYXJldFJuZyhybmcpKSkge1xuXHRcdFx0XHRcdHJuZyA9IG5leHRSbmc7XG5cdFx0XHRcdFx0ZG9tLnJlbW92ZShwYXJlbnRCbG9jayk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0ZG9tLmFkZChwYXJlbnRCbG9jaywgZG9tLmNyZWF0ZSgnYnInLCB7J2RhdGEtbWNlLWJvZ3VzJzogJzEnfSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHNlbGVjdGlvbi5zZXRSbmcocm5nKTtcblx0XHR9XG5cblx0XHQvLyBDaGVjayBmb3Igd2hpdGVzcGFjZSBiZWZvcmUvYWZ0ZXIgdmFsdWVcblx0XHRpZiAoL14gfCAkLy50ZXN0KHZhbHVlKSkge1xuXHRcdFx0dmFsdWUgPSB0cmltT3JQYWRkTGVmdFJpZ2h0KHZhbHVlKTtcblx0XHR9XG5cblx0XHQvLyBTZXR1cCBwYXJzZXIgYW5kIHNlcmlhbGl6ZXJcblx0XHRwYXJzZXIgPSBlZGl0b3IucGFyc2VyO1xuXHRcdG1lcmdlID0gZGV0YWlscy5tZXJnZTtcblxuXHRcdHNlcmlhbGl6ZXIgPSBuZXcgU2VyaWFsaXplcih7XG5cdFx0XHR2YWxpZGF0ZTogZWRpdG9yLnNldHRpbmdzLnZhbGlkYXRlXG5cdFx0fSwgZWRpdG9yLnNjaGVtYSk7XG5cdFx0Ym9va21hcmtIdG1sID0gJzxzcGFuIGlkPVwibWNlX21hcmtlclwiIGRhdGEtbWNlLXR5cGU9XCJib29rbWFya1wiPiYjeEZFRkY7JiN4MjAwQjs8L3NwYW4+JztcblxuXHRcdC8vIFJ1biBiZWZvcmVTZXRDb250ZW50IGhhbmRsZXJzIG9uIHRoZSBIVE1MIHRvIGJlIGluc2VydGVkXG5cdFx0YXJncyA9IHtjb250ZW50OiB2YWx1ZSwgZm9ybWF0OiAnaHRtbCcsIHNlbGVjdGlvbjogdHJ1ZX07XG5cdFx0ZWRpdG9yLmZpcmUoJ0JlZm9yZVNldENvbnRlbnQnLCBhcmdzKTtcblx0XHR2YWx1ZSA9IGFyZ3MuY29udGVudDtcblxuXHRcdC8vIEFkZCBjYXJldCBhdCBlbmQgb2YgY29udGVudHMgaWYgaXQncyBtaXNzaW5nXG5cdFx0aWYgKHZhbHVlLmluZGV4T2YoJ3skY2FyZXR9JykgPT0gLTEpIHtcblx0XHRcdHZhbHVlICs9ICd7JGNhcmV0fSc7XG5cdFx0fVxuXG5cdFx0Ly8gUmVwbGFjZSB0aGUgY2FyZXQgbWFya2VyIHdpdGggYSBzcGFuIGJvb2ttYXJrIGVsZW1lbnRcblx0XHR2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoL1xce1xcJGNhcmV0XFx9LywgYm9va21hcmtIdG1sKTtcblxuXHRcdC8vIElmIHNlbGVjdGlvbiBpcyBhdCA8Ym9keT58PHA+PC9wPiB0aGVuIG1vdmUgaXQgaW50byA8Ym9keT48cD58PC9wPlxuXHRcdHJuZyA9IHNlbGVjdGlvbi5nZXRSbmcoKTtcblx0XHR2YXIgY2FyZXRFbGVtZW50ID0gcm5nLnN0YXJ0Q29udGFpbmVyIHx8IChybmcucGFyZW50RWxlbWVudCA/IHJuZy5wYXJlbnRFbGVtZW50KCkgOiBudWxsKTtcblx0XHR2YXIgYm9keSA9IGVkaXRvci5nZXRCb2R5KCk7XG5cdFx0aWYgKGNhcmV0RWxlbWVudCA9PT0gYm9keSAmJiBzZWxlY3Rpb24uaXNDb2xsYXBzZWQoKSkge1xuXHRcdFx0aWYgKGRvbS5pc0Jsb2NrKGJvZHkuZmlyc3RDaGlsZCkgJiYgY2FuSGF2ZUNoaWxkcmVuKGJvZHkuZmlyc3RDaGlsZCkgJiYgZG9tLmlzRW1wdHkoYm9keS5maXJzdENoaWxkKSkge1xuXHRcdFx0XHRybmcgPSBkb20uY3JlYXRlUm5nKCk7XG5cdFx0XHRcdHJuZy5zZXRTdGFydChib2R5LmZpcnN0Q2hpbGQsIDApO1xuXHRcdFx0XHRybmcuc2V0RW5kKGJvZHkuZmlyc3RDaGlsZCwgMCk7XG5cdFx0XHRcdHNlbGVjdGlvbi5zZXRSbmcocm5nKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHQvLyBJbnNlcnQgbm9kZSBtYWtlciB3aGVyZSB3ZSB3aWxsIGluc2VydCB0aGUgbmV3IEhUTUwgYW5kIGdldCBpdCdzIHBhcmVudFxuXHRcdGlmICghc2VsZWN0aW9uLmlzQ29sbGFwc2VkKCkpIHtcblx0XHRcdC8vIEZpeCBmb3IgIzI1OTUgc2VlbXMgdGhhdCBkZWxldGUgcmVtb3ZlcyBvbmUgZXh0cmEgY2hhcmFjdGVyIG9uXG5cdFx0XHQvLyBXZWJLaXQgZm9yIHNvbWUgb2RkIHJlYXNvbiBpZiB5b3UgZG91YmxlIGNsaWNrIHNlbGVjdCBhIHdvcmRcblx0XHRcdGVkaXRvci5zZWxlY3Rpb24uc2V0Um5nKGVkaXRvci5zZWxlY3Rpb24uZ2V0Um5nKCkpO1xuXHRcdFx0ZWRpdG9yLmdldERvYygpLmV4ZWNDb21tYW5kKCdEZWxldGUnLCBmYWxzZSwgbnVsbCk7XG5cdFx0XHR0cmltTmJzcEFmdGVyRGVsZXRlQW5kUGFkZFZhbHVlKCk7XG5cdFx0fVxuXG5cdFx0cGFyZW50Tm9kZSA9IHNlbGVjdGlvbi5nZXROb2RlKCk7XG5cblx0XHQvLyBQYXJzZSB0aGUgZnJhZ21lbnQgd2l0aGluIHRoZSBjb250ZXh0IG9mIHRoZSBwYXJlbnQgbm9kZVxuXHRcdHZhciBwYXJzZXJBcmdzID0ge2NvbnRleHQ6IHBhcmVudE5vZGUubm9kZU5hbWUudG9Mb3dlckNhc2UoKSwgZGF0YTogZGV0YWlscy5kYXRhfTtcblx0XHRmcmFnbWVudCA9IHBhcnNlci5wYXJzZSh2YWx1ZSwgcGFyc2VyQXJncyk7XG5cblx0XHQvLyBDdXN0b20gaGFuZGxpbmcgb2YgbGlzdHNcblx0XHRpZiAoZGV0YWlscy5wYXN0ZSA9PT0gdHJ1ZSAmJiBJbnNlcnRMaXN0LmlzTGlzdEZyYWdtZW50KGZyYWdtZW50KSAmJiBJbnNlcnRMaXN0LmlzUGFyZW50QmxvY2tMaShkb20sIHBhcmVudE5vZGUpKSB7XG5cdFx0XHRybmcgPSBJbnNlcnRMaXN0Lmluc2VydEF0Q2FyZXQoc2VyaWFsaXplciwgZG9tLCBlZGl0b3Iuc2VsZWN0aW9uLmdldFJuZyh0cnVlKSwgZnJhZ21lbnQpO1xuXHRcdFx0ZWRpdG9yLnNlbGVjdGlvbi5zZXRSbmcocm5nKTtcblx0XHRcdGVkaXRvci5maXJlKCdTZXRDb250ZW50JywgYXJncyk7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXG5cdFx0bWFya0ZyYWdtZW50RWxlbWVudHMoZnJhZ21lbnQpO1xuXG5cdFx0Ly8gTW92ZSB0aGUgY2FyZXQgdG8gYSBtb3JlIHN1aXRhYmxlIGxvY2F0aW9uXG5cdFx0bm9kZSA9IGZyYWdtZW50Lmxhc3RDaGlsZDtcblx0XHRpZiAobm9kZS5hdHRyKCdpZCcpID09ICdtY2VfbWFya2VyJykge1xuXHRcdFx0bWFya2VyID0gbm9kZTtcblxuXHRcdFx0Zm9yIChub2RlID0gbm9kZS5wcmV2OyBub2RlOyBub2RlID0gbm9kZS53YWxrKHRydWUpKSB7XG5cdFx0XHRcdGlmIChub2RlLnR5cGUgPT0gMyB8fCAhZG9tLmlzQmxvY2sobm9kZS5uYW1lKSkge1xuXHRcdFx0XHRcdGlmIChlZGl0b3Iuc2NoZW1hLmlzVmFsaWRDaGlsZChub2RlLnBhcmVudC5uYW1lLCAnc3BhbicpKSB7XG5cdFx0XHRcdFx0XHRub2RlLnBhcmVudC5pbnNlcnQobWFya2VyLCBub2RlLCBub2RlLm5hbWUgPT09ICdicicpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGVkaXRvci5fc2VsZWN0aW9uT3ZlcnJpZGVzLnNob3dCbG9ja0NhcmV0Q29udGFpbmVyKHBhcmVudE5vZGUpO1xuXG5cdFx0Ly8gSWYgcGFyc2VyIHNheXMgdmFsaWQgd2UgY2FuIGluc2VydCB0aGUgY29udGVudHMgaW50byB0aGF0IHBhcmVudFxuXHRcdGlmICghcGFyc2VyQXJncy5pbnZhbGlkKSB7XG5cdFx0XHR2YWx1ZSA9IHNlcmlhbGl6ZXIuc2VyaWFsaXplKGZyYWdtZW50KTtcblxuXHRcdFx0Ly8gQ2hlY2sgaWYgcGFyZW50IGlzIGVtcHR5IG9yIG9ubHkgaGFzIG9uZSBCUiBlbGVtZW50IHRoZW4gc2V0IHRoZSBpbm5lckhUTUwgb2YgdGhhdCBwYXJlbnRcblx0XHRcdG5vZGUgPSBwYXJlbnROb2RlLmZpcnN0Q2hpbGQ7XG5cdFx0XHRub2RlMiA9IHBhcmVudE5vZGUubGFzdENoaWxkO1xuXHRcdFx0aWYgKCFub2RlIHx8IChub2RlID09PSBub2RlMiAmJiBub2RlLm5vZGVOYW1lID09PSAnQlInKSkge1xuXHRcdFx0XHRkb20uc2V0SFRNTChwYXJlbnROb2RlLCB2YWx1ZSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRzZWxlY3Rpb24uc2V0Q29udGVudCh2YWx1ZSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdC8vIElmIHRoZSBmcmFnbWVudCB3YXMgaW52YWxpZCB3aXRoaW4gdGhhdCBjb250ZXh0IHRoZW4gd2UgbmVlZFxuXHRcdFx0Ly8gdG8gcGFyc2UgYW5kIHByb2Nlc3MgdGhlIHBhcmVudCBpdCdzIGluc2VydGVkIGludG9cblxuXHRcdFx0Ly8gSW5zZXJ0IGJvb2ttYXJrIG5vZGUgYW5kIGdldCB0aGUgcGFyZW50XG5cdFx0XHRzZWxlY3Rpb24uc2V0Q29udGVudChib29rbWFya0h0bWwpO1xuXHRcdFx0cGFyZW50Tm9kZSA9IHNlbGVjdGlvbi5nZXROb2RlKCk7XG5cdFx0XHRyb290Tm9kZSA9IGVkaXRvci5nZXRCb2R5KCk7XG5cblx0XHRcdC8vIE9wZXJhIHdpbGwgcmV0dXJuIHRoZSBkb2N1bWVudCBub2RlIHdoZW4gc2VsZWN0aW9uIGlzIGluIHJvb3Rcblx0XHRcdGlmIChwYXJlbnROb2RlLm5vZGVUeXBlID09IDkpIHtcblx0XHRcdFx0cGFyZW50Tm9kZSA9IG5vZGUgPSByb290Tm9kZTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdG5vZGUgPSBwYXJlbnROb2RlO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBGaW5kIHRoZSBhbmNlc3RvciBqdXN0IGJlZm9yZSB0aGUgcm9vdCBlbGVtZW50XG5cdFx0XHR3aGlsZSAobm9kZSAhPT0gcm9vdE5vZGUpIHtcblx0XHRcdFx0cGFyZW50Tm9kZSA9IG5vZGU7XG5cdFx0XHRcdG5vZGUgPSBub2RlLnBhcmVudE5vZGU7XG5cdFx0XHR9XG5cblx0XHRcdC8vIEdldCB0aGUgb3V0ZXIvaW5uZXIgSFRNTCBkZXBlbmRpbmcgb24gaWYgd2UgYXJlIGluIHRoZSByb290IGFuZCBwYXJzZXIgYW5kIHNlcmlhbGl6ZSB0aGF0XG5cdFx0XHR2YWx1ZSA9IHBhcmVudE5vZGUgPT0gcm9vdE5vZGUgPyByb290Tm9kZS5pbm5lckhUTUwgOiBkb20uZ2V0T3V0ZXJIVE1MKHBhcmVudE5vZGUpO1xuXHRcdFx0dmFsdWUgPSBzZXJpYWxpemVyLnNlcmlhbGl6ZShcblx0XHRcdFx0cGFyc2VyLnBhcnNlKFxuXHRcdFx0XHRcdC8vIE5lZWQgdG8gcmVwbGFjZSBieSB1c2luZyBhIGZ1bmN0aW9uIHNpbmNlICQgaW4gdGhlIGNvbnRlbnRzIHdvdWxkIG90aGVyd2lzZSBiZSBhIHByb2JsZW1cblx0XHRcdFx0XHR2YWx1ZS5yZXBsYWNlKC88c3BhbiAoaWQ9XCJtY2VfbWFya2VyXCJ8aWQ9bWNlX21hcmtlcikuKz88XFwvc3Bhbj4vaSwgZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gc2VyaWFsaXplci5zZXJpYWxpemUoZnJhZ21lbnQpO1xuXHRcdFx0XHRcdH0pXG5cdFx0XHRcdClcblx0XHRcdCk7XG5cblx0XHRcdC8vIFNldCB0aGUgaW5uZXIvb3V0ZXIgSFRNTCBkZXBlbmRpbmcgb24gaWYgd2UgYXJlIGluIHRoZSByb290IG9yIG5vdFxuXHRcdFx0aWYgKHBhcmVudE5vZGUgPT0gcm9vdE5vZGUpIHtcblx0XHRcdFx0ZG9tLnNldEhUTUwocm9vdE5vZGUsIHZhbHVlKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGRvbS5zZXRPdXRlckhUTUwocGFyZW50Tm9kZSwgdmFsdWUpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJlZHVjZUlubGluZVRleHRFbGVtZW50cygpO1xuXHRcdG1vdmVTZWxlY3Rpb25Ub01hcmtlcihkb20uZ2V0KCdtY2VfbWFya2VyJykpO1xuXHRcdHVtYXJrRnJhZ21lbnRFbGVtZW50cyhlZGl0b3IuZ2V0Qm9keSgpKTtcblx0XHRlZGl0b3IuZmlyZSgnU2V0Q29udGVudCcsIGFyZ3MpO1xuXHRcdGVkaXRvci5hZGRWaXN1YWwoKTtcblx0fTtcblxuXHR2YXIgcHJvY2Vzc1ZhbHVlID0gZnVuY3Rpb24gKHZhbHVlKSB7XG5cdFx0dmFyIGRldGFpbHM7XG5cblx0XHRpZiAodHlwZW9mIHZhbHVlICE9PSAnc3RyaW5nJykge1xuXHRcdFx0ZGV0YWlscyA9IFRvb2xzLmV4dGVuZCh7XG5cdFx0XHRcdHBhc3RlOiB2YWx1ZS5wYXN0ZSxcblx0XHRcdFx0ZGF0YToge1xuXHRcdFx0XHRcdHBhc3RlOiB2YWx1ZS5wYXN0ZVxuXHRcdFx0XHR9XG5cdFx0XHR9LCB2YWx1ZSk7XG5cblx0XHRcdHJldHVybiB7XG5cdFx0XHRcdGNvbnRlbnQ6IHZhbHVlLmNvbnRlbnQsXG5cdFx0XHRcdGRldGFpbHM6IGRldGFpbHNcblx0XHRcdH07XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHtcblx0XHRcdGNvbnRlbnQ6IHZhbHVlLFxuXHRcdFx0ZGV0YWlsczoge31cblx0XHR9O1xuXHR9O1xuXG5cdHZhciBpbnNlcnRBdENhcmV0ID0gZnVuY3Rpb24gKGVkaXRvciwgdmFsdWUpIHtcblx0XHR2YXIgcmVzdWx0ID0gcHJvY2Vzc1ZhbHVlKHZhbHVlKTtcblx0XHRpbnNlcnRIdG1sQXRDYXJldChlZGl0b3IsIHJlc3VsdC5jb250ZW50LCByZXN1bHQuZGV0YWlscyk7XG5cdH07XG5cblx0cmV0dXJuIHtcblx0XHRpbnNlcnRBdENhcmV0OiBpbnNlcnRBdENhcmV0XG5cdH07XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL0VkaXRvckNvbW1hbmRzLmpzXG5cbi8qKlxuICogRWRpdG9yQ29tbWFuZHMuanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBUaGlzIGNsYXNzIGVuYWJsZXMgeW91IHRvIGFkZCBjdXN0b20gZWRpdG9yIGNvbW1hbmRzIGFuZCBpdCBjb250YWluc1xuICogb3ZlcnJpZGVzIGZvciBuYXRpdmUgYnJvd3NlciBjb21tYW5kcyB0byBhZGRyZXNzIHZhcmlvdXMgYnVncyBhbmQgaXNzdWVzLlxuICpcbiAqIEBjbGFzcyB0aW55bWNlLkVkaXRvckNvbW1hbmRzXG4gKi9cbmRlZmluZShcInRpbnltY2UvRWRpdG9yQ29tbWFuZHNcIiwgW1xuXHRcInRpbnltY2UvRW52XCIsXG5cdFwidGlueW1jZS91dGlsL1Rvb2xzXCIsXG5cdFwidGlueW1jZS9kb20vUmFuZ2VVdGlsc1wiLFxuXHRcInRpbnltY2UvZG9tL1RyZWVXYWxrZXJcIixcblx0XCJ0aW55bWNlL0luc2VydENvbnRlbnRcIlxuXSwgZnVuY3Rpb24oRW52LCBUb29scywgUmFuZ2VVdGlscywgVHJlZVdhbGtlciwgSW5zZXJ0Q29udGVudCkge1xuXHQvLyBBZGRlZCBmb3IgY29tcHJlc3Npb24gcHVycG9zZXNcblx0dmFyIGVhY2ggPSBUb29scy5lYWNoLCBleHRlbmQgPSBUb29scy5leHRlbmQ7XG5cdHZhciBtYXAgPSBUb29scy5tYXAsIGluQXJyYXkgPSBUb29scy5pbkFycmF5LCBleHBsb2RlID0gVG9vbHMuZXhwbG9kZTtcblx0dmFyIGlzT2xkSUUgPSBFbnYuaWUgJiYgRW52LmllIDwgMTE7XG5cdHZhciBUUlVFID0gdHJ1ZSwgRkFMU0UgPSBmYWxzZTtcblxuXHRyZXR1cm4gZnVuY3Rpb24oZWRpdG9yKSB7XG5cdFx0dmFyIGRvbSwgc2VsZWN0aW9uLCBmb3JtYXR0ZXIsXG5cdFx0XHRjb21tYW5kcyA9IHtzdGF0ZToge30sIGV4ZWM6IHt9LCB2YWx1ZToge319LFxuXHRcdFx0c2V0dGluZ3MgPSBlZGl0b3Iuc2V0dGluZ3MsXG5cdFx0XHRib29rbWFyaztcblxuXHRcdGVkaXRvci5vbignUHJlSW5pdCcsIGZ1bmN0aW9uKCkge1xuXHRcdFx0ZG9tID0gZWRpdG9yLmRvbTtcblx0XHRcdHNlbGVjdGlvbiA9IGVkaXRvci5zZWxlY3Rpb247XG5cdFx0XHRzZXR0aW5ncyA9IGVkaXRvci5zZXR0aW5ncztcblx0XHRcdGZvcm1hdHRlciA9IGVkaXRvci5mb3JtYXR0ZXI7XG5cdFx0fSk7XG5cblx0XHQvKipcblx0XHQgKiBFeGVjdXRlcyB0aGUgc3BlY2lmaWVkIGNvbW1hbmQuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGV4ZWNDb21tYW5kXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IGNvbW1hbmQgQ29tbWFuZCB0byBleGVjdXRlLlxuXHRcdCAqIEBwYXJhbSB7Qm9vbGVhbn0gdWkgT3B0aW9uYWwgdXNlciBpbnRlcmZhY2Ugc3RhdGUuXG5cdFx0ICogQHBhcmFtIHtPYmplY3R9IHZhbHVlIE9wdGlvbmFsIHZhbHVlIGZvciBjb21tYW5kLlxuXHRcdCAqIEBwYXJhbSB7T2JqZWN0fSBhcmdzIE9wdGlvbmFsIGV4dHJhIGFyZ3VtZW50cyB0byB0aGUgZXhlY0NvbW1hbmQuXG5cdFx0ICogQHJldHVybiB7Qm9vbGVhbn0gdHJ1ZS9mYWxzZSBpZiB0aGUgY29tbWFuZCB3YXMgZm91bmQgb3Igbm90LlxuXHRcdCAqL1xuXHRcdGZ1bmN0aW9uIGV4ZWNDb21tYW5kKGNvbW1hbmQsIHVpLCB2YWx1ZSwgYXJncykge1xuXHRcdFx0dmFyIGZ1bmMsIGN1c3RvbUNvbW1hbmQsIHN0YXRlID0gMDtcblxuXHRcdFx0aWYgKCEvXihtY2VBZGRVbmRvTGV2ZWx8bWNlRW5kVW5kb0xldmVsfG1jZUJlZ2luVW5kb0xldmVsfG1jZVJlcGFpbnQpJC8udGVzdChjb21tYW5kKSAmJiAoIWFyZ3MgfHwgIWFyZ3Muc2tpcF9mb2N1cykpIHtcblx0XHRcdFx0ZWRpdG9yLmZvY3VzKCk7XG5cdFx0XHR9XG5cblx0XHRcdGFyZ3MgPSBlZGl0b3IuZmlyZSgnQmVmb3JlRXhlY0NvbW1hbmQnLCB7Y29tbWFuZDogY29tbWFuZCwgdWk6IHVpLCB2YWx1ZTogdmFsdWV9KTtcblx0XHRcdGlmIChhcmdzLmlzRGVmYXVsdFByZXZlbnRlZCgpKSB7XG5cdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdH1cblxuXHRcdFx0Y3VzdG9tQ29tbWFuZCA9IGNvbW1hbmQudG9Mb3dlckNhc2UoKTtcblx0XHRcdGlmICgoZnVuYyA9IGNvbW1hbmRzLmV4ZWNbY3VzdG9tQ29tbWFuZF0pKSB7XG5cdFx0XHRcdGZ1bmMoY3VzdG9tQ29tbWFuZCwgdWksIHZhbHVlKTtcblx0XHRcdFx0ZWRpdG9yLmZpcmUoJ0V4ZWNDb21tYW5kJywge2NvbW1hbmQ6IGNvbW1hbmQsIHVpOiB1aSwgdmFsdWU6IHZhbHVlfSk7XG5cdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBQbHVnaW4gY29tbWFuZHNcblx0XHRcdGVhY2goZWRpdG9yLnBsdWdpbnMsIGZ1bmN0aW9uKHApIHtcblx0XHRcdFx0aWYgKHAuZXhlY0NvbW1hbmQgJiYgcC5leGVjQ29tbWFuZChjb21tYW5kLCB1aSwgdmFsdWUpKSB7XG5cdFx0XHRcdFx0ZWRpdG9yLmZpcmUoJ0V4ZWNDb21tYW5kJywge2NvbW1hbmQ6IGNvbW1hbmQsIHVpOiB1aSwgdmFsdWU6IHZhbHVlfSk7XG5cdFx0XHRcdFx0c3RhdGUgPSB0cnVlO1xuXHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdGlmIChzdGF0ZSkge1xuXHRcdFx0XHRyZXR1cm4gc3RhdGU7XG5cdFx0XHR9XG5cblx0XHRcdC8vIFRoZW1lIGNvbW1hbmRzXG5cdFx0XHRpZiAoZWRpdG9yLnRoZW1lICYmIGVkaXRvci50aGVtZS5leGVjQ29tbWFuZCAmJiBlZGl0b3IudGhlbWUuZXhlY0NvbW1hbmQoY29tbWFuZCwgdWksIHZhbHVlKSkge1xuXHRcdFx0XHRlZGl0b3IuZmlyZSgnRXhlY0NvbW1hbmQnLCB7Y29tbWFuZDogY29tbWFuZCwgdWk6IHVpLCB2YWx1ZTogdmFsdWV9KTtcblx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHR9XG5cblx0XHRcdC8vIEJyb3dzZXIgY29tbWFuZHNcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHN0YXRlID0gZWRpdG9yLmdldERvYygpLmV4ZWNDb21tYW5kKGNvbW1hbmQsIHVpLCB2YWx1ZSk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvLyBJZ25vcmUgb2xkIElFIGVycm9yc1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoc3RhdGUpIHtcblx0XHRcdFx0ZWRpdG9yLmZpcmUoJ0V4ZWNDb21tYW5kJywge2NvbW1hbmQ6IGNvbW1hbmQsIHVpOiB1aSwgdmFsdWU6IHZhbHVlfSk7XG5cdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXG5cdFx0LyoqXG5cdFx0ICogUXVlcmllcyB0aGUgY3VycmVudCBzdGF0ZSBmb3IgYSBjb21tYW5kIGZvciBleGFtcGxlIGlmIHRoZSBjdXJyZW50IHNlbGVjdGlvbiBpcyBcImJvbGRcIi5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgcXVlcnlDb21tYW5kU3RhdGVcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gY29tbWFuZCBDb21tYW5kIHRvIGNoZWNrIHRoZSBzdGF0ZSBvZi5cblx0XHQgKiBAcmV0dXJuIHtCb29sZWFuL051bWJlcn0gdHJ1ZS9mYWxzZSBpZiB0aGUgc2VsZWN0ZWQgY29udGVudHMgaXMgYm9sZCBvciBub3QsIC0xIGlmIGl0J3Mgbm90IGZvdW5kLlxuXHRcdCAqL1xuXHRcdGZ1bmN0aW9uIHF1ZXJ5Q29tbWFuZFN0YXRlKGNvbW1hbmQpIHtcblx0XHRcdHZhciBmdW5jO1xuXG5cdFx0XHQvLyBJcyBoaWRkZW4gdGhlbiByZXR1cm4gdW5kZWZpbmVkXG5cdFx0XHRpZiAoZWRpdG9yLnF1aXJrcy5pc0hpZGRlbigpKSB7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0Y29tbWFuZCA9IGNvbW1hbmQudG9Mb3dlckNhc2UoKTtcblx0XHRcdGlmICgoZnVuYyA9IGNvbW1hbmRzLnN0YXRlW2NvbW1hbmRdKSkge1xuXHRcdFx0XHRyZXR1cm4gZnVuYyhjb21tYW5kKTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gQnJvd3NlciBjb21tYW5kc1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0cmV0dXJuIGVkaXRvci5nZXREb2MoKS5xdWVyeUNvbW1hbmRTdGF0ZShjb21tYW5kKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8vIEZhaWxzIHNvbWV0aW1lcyBzZWUgYnVnOiAxODk2NTc3XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cblx0XHQvKipcblx0XHQgKiBRdWVyaWVzIHRoZSBjb21tYW5kIHZhbHVlIGZvciBleGFtcGxlIHRoZSBjdXJyZW50IGZvbnRzaXplLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBxdWVyeUNvbW1hbmRWYWx1ZVxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBjb21tYW5kIENvbW1hbmQgdG8gY2hlY2sgdGhlIHZhbHVlIG9mLlxuXHRcdCAqIEByZXR1cm4ge09iamVjdH0gQ29tbWFuZCB2YWx1ZSBvZiBmYWxzZSBpZiBpdCdzIG5vdCBmb3VuZC5cblx0XHQgKi9cblx0XHRmdW5jdGlvbiBxdWVyeUNvbW1hbmRWYWx1ZShjb21tYW5kKSB7XG5cdFx0XHR2YXIgZnVuYztcblxuXHRcdFx0Ly8gSXMgaGlkZGVuIHRoZW4gcmV0dXJuIHVuZGVmaW5lZFxuXHRcdFx0aWYgKGVkaXRvci5xdWlya3MuaXNIaWRkZW4oKSkge1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdGNvbW1hbmQgPSBjb21tYW5kLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRpZiAoKGZ1bmMgPSBjb21tYW5kcy52YWx1ZVtjb21tYW5kXSkpIHtcblx0XHRcdFx0cmV0dXJuIGZ1bmMoY29tbWFuZCk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIEJyb3dzZXIgY29tbWFuZHNcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJldHVybiBlZGl0b3IuZ2V0RG9jKCkucXVlcnlDb21tYW5kVmFsdWUoY29tbWFuZCk7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvLyBGYWlscyBzb21ldGltZXMgc2VlIGJ1ZzogMTg5NjU3N1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8qKlxuXHRcdCAqIEFkZHMgY29tbWFuZHMgdG8gdGhlIGNvbW1hbmQgY29sbGVjdGlvbi5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgYWRkQ29tbWFuZHNcblx0XHQgKiBAcGFyYW0ge09iamVjdH0gY29tbWFuZF9saXN0IE5hbWUvdmFsdWUgY29sbGVjdGlvbiB3aXRoIGNvbW1hbmRzIHRvIGFkZCwgdGhlIG5hbWVzIGNhbiBhbHNvIGJlIGNvbW1hIHNlcGFyYXRlZC5cblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gdHlwZSBPcHRpb25hbCB0eXBlIHRvIGFkZCwgZGVmYXVsdHMgdG8gZXhlYy4gQ2FuIGJlIHZhbHVlIG9yIHN0YXRlIGFzIHdlbGwuXG5cdFx0ICovXG5cdFx0ZnVuY3Rpb24gYWRkQ29tbWFuZHMoY29tbWFuZF9saXN0LCB0eXBlKSB7XG5cdFx0XHR0eXBlID0gdHlwZSB8fCAnZXhlYyc7XG5cblx0XHRcdGVhY2goY29tbWFuZF9saXN0LCBmdW5jdGlvbihjYWxsYmFjaywgY29tbWFuZCkge1xuXHRcdFx0XHRlYWNoKGNvbW1hbmQudG9Mb3dlckNhc2UoKS5zcGxpdCgnLCcpLCBmdW5jdGlvbihjb21tYW5kKSB7XG5cdFx0XHRcdFx0Y29tbWFuZHNbdHlwZV1bY29tbWFuZF0gPSBjYWxsYmFjaztcblx0XHRcdFx0fSk7XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRmdW5jdGlvbiBhZGRDb21tYW5kKGNvbW1hbmQsIGNhbGxiYWNrLCBzY29wZSkge1xuXHRcdFx0Y29tbWFuZCA9IGNvbW1hbmQudG9Mb3dlckNhc2UoKTtcblx0XHRcdGNvbW1hbmRzLmV4ZWNbY29tbWFuZF0gPSBmdW5jdGlvbihjb21tYW5kLCB1aSwgdmFsdWUsIGFyZ3MpIHtcblx0XHRcdFx0cmV0dXJuIGNhbGxiYWNrLmNhbGwoc2NvcGUgfHwgZWRpdG9yLCB1aSwgdmFsdWUsIGFyZ3MpO1xuXHRcdFx0fTtcblx0XHR9XG5cblx0XHQvKipcblx0XHQgKiBSZXR1cm5zIHRydWUvZmFsc2UgaWYgdGhlIGNvbW1hbmQgaXMgc3VwcG9ydGVkIG9yIG5vdC5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgcXVlcnlDb21tYW5kU3VwcG9ydGVkXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IGNvbW1hbmQgQ29tbWFuZCB0aGF0IHdlIGNoZWNrIHN1cHBvcnQgZm9yLlxuXHRcdCAqIEByZXR1cm4ge0Jvb2xlYW59IHRydWUvZmFsc2UgaWYgdGhlIGNvbW1hbmQgaXMgc3VwcG9ydGVkIG9yIG5vdC5cblx0XHQgKi9cblx0XHRmdW5jdGlvbiBxdWVyeUNvbW1hbmRTdXBwb3J0ZWQoY29tbWFuZCkge1xuXHRcdFx0Y29tbWFuZCA9IGNvbW1hbmQudG9Mb3dlckNhc2UoKTtcblxuXHRcdFx0aWYgKGNvbW1hbmRzLmV4ZWNbY29tbWFuZF0pIHtcblx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHR9XG5cblx0XHRcdC8vIEJyb3dzZXIgY29tbWFuZHNcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJldHVybiBlZGl0b3IuZ2V0RG9jKCkucXVlcnlDb21tYW5kU3VwcG9ydGVkKGNvbW1hbmQpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0Ly8gRmFpbHMgc29tZXRpbWVzIHNlZSBidWc6IDE4OTY1Nzdcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIGFkZFF1ZXJ5U3RhdGVIYW5kbGVyKGNvbW1hbmQsIGNhbGxiYWNrLCBzY29wZSkge1xuXHRcdFx0Y29tbWFuZCA9IGNvbW1hbmQudG9Mb3dlckNhc2UoKTtcblx0XHRcdGNvbW1hbmRzLnN0YXRlW2NvbW1hbmRdID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHJldHVybiBjYWxsYmFjay5jYWxsKHNjb3BlIHx8IGVkaXRvcik7XG5cdFx0XHR9O1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIGFkZFF1ZXJ5VmFsdWVIYW5kbGVyKGNvbW1hbmQsIGNhbGxiYWNrLCBzY29wZSkge1xuXHRcdFx0Y29tbWFuZCA9IGNvbW1hbmQudG9Mb3dlckNhc2UoKTtcblx0XHRcdGNvbW1hbmRzLnZhbHVlW2NvbW1hbmRdID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHJldHVybiBjYWxsYmFjay5jYWxsKHNjb3BlIHx8IGVkaXRvcik7XG5cdFx0XHR9O1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIGhhc0N1c3RvbUNvbW1hbmQoY29tbWFuZCkge1xuXHRcdFx0Y29tbWFuZCA9IGNvbW1hbmQudG9Mb3dlckNhc2UoKTtcblx0XHRcdHJldHVybiAhIWNvbW1hbmRzLmV4ZWNbY29tbWFuZF07XG5cdFx0fVxuXG5cdFx0Ly8gRXhwb3NlIHB1YmxpYyBtZXRob2RzXG5cdFx0ZXh0ZW5kKHRoaXMsIHtcblx0XHRcdGV4ZWNDb21tYW5kOiBleGVjQ29tbWFuZCxcblx0XHRcdHF1ZXJ5Q29tbWFuZFN0YXRlOiBxdWVyeUNvbW1hbmRTdGF0ZSxcblx0XHRcdHF1ZXJ5Q29tbWFuZFZhbHVlOiBxdWVyeUNvbW1hbmRWYWx1ZSxcblx0XHRcdHF1ZXJ5Q29tbWFuZFN1cHBvcnRlZDogcXVlcnlDb21tYW5kU3VwcG9ydGVkLFxuXHRcdFx0YWRkQ29tbWFuZHM6IGFkZENvbW1hbmRzLFxuXHRcdFx0YWRkQ29tbWFuZDogYWRkQ29tbWFuZCxcblx0XHRcdGFkZFF1ZXJ5U3RhdGVIYW5kbGVyOiBhZGRRdWVyeVN0YXRlSGFuZGxlcixcblx0XHRcdGFkZFF1ZXJ5VmFsdWVIYW5kbGVyOiBhZGRRdWVyeVZhbHVlSGFuZGxlcixcblx0XHRcdGhhc0N1c3RvbUNvbW1hbmQ6IGhhc0N1c3RvbUNvbW1hbmRcblx0XHR9KTtcblxuXHRcdC8vIFByaXZhdGUgbWV0aG9kc1xuXG5cdFx0ZnVuY3Rpb24gZXhlY05hdGl2ZUNvbW1hbmQoY29tbWFuZCwgdWksIHZhbHVlKSB7XG5cdFx0XHRpZiAodWkgPT09IHVuZGVmaW5lZCkge1xuXHRcdFx0XHR1aSA9IEZBTFNFO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkge1xuXHRcdFx0XHR2YWx1ZSA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBlZGl0b3IuZ2V0RG9jKCkuZXhlY0NvbW1hbmQoY29tbWFuZCwgdWksIHZhbHVlKTtcblx0XHR9XG5cblx0XHRmdW5jdGlvbiBpc0Zvcm1hdE1hdGNoKG5hbWUpIHtcblx0XHRcdHJldHVybiBmb3JtYXR0ZXIubWF0Y2gobmFtZSk7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gdG9nZ2xlRm9ybWF0KG5hbWUsIHZhbHVlKSB7XG5cdFx0XHRmb3JtYXR0ZXIudG9nZ2xlKG5hbWUsIHZhbHVlID8ge3ZhbHVlOiB2YWx1ZX0gOiB1bmRlZmluZWQpO1xuXHRcdFx0ZWRpdG9yLm5vZGVDaGFuZ2VkKCk7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gc3RvcmVTZWxlY3Rpb24odHlwZSkge1xuXHRcdFx0Ym9va21hcmsgPSBzZWxlY3Rpb24uZ2V0Qm9va21hcmsodHlwZSk7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gcmVzdG9yZVNlbGVjdGlvbigpIHtcblx0XHRcdHNlbGVjdGlvbi5tb3ZlVG9Cb29rbWFyayhib29rbWFyayk7XG5cdFx0fVxuXG5cdFx0Ly8gQWRkIGV4ZWNDb21tYW5kIG92ZXJyaWRlc1xuXHRcdGFkZENvbW1hbmRzKHtcblx0XHRcdC8vIElnbm9yZSB0aGVzZSwgYWRkZWQgZm9yIGNvbXBhdGliaWxpdHlcblx0XHRcdCdtY2VSZXNldERlc2lnbk1vZGUsbWNlQmVnaW5VbmRvTGV2ZWwnOiBmdW5jdGlvbigpIHt9LFxuXG5cdFx0XHQvLyBBZGQgdW5kbyBtYW5hZ2VyIGxvZ2ljXG5cdFx0XHQnbWNlRW5kVW5kb0xldmVsLG1jZUFkZFVuZG9MZXZlbCc6IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRlZGl0b3IudW5kb01hbmFnZXIuYWRkKCk7XG5cdFx0XHR9LFxuXG5cdFx0XHQnQ3V0LENvcHksUGFzdGUnOiBmdW5jdGlvbihjb21tYW5kKSB7XG5cdFx0XHRcdHZhciBkb2MgPSBlZGl0b3IuZ2V0RG9jKCksIGZhaWxlZDtcblxuXHRcdFx0XHQvLyBUcnkgZXhlY3V0aW5nIHRoZSBuYXRpdmUgY29tbWFuZFxuXHRcdFx0XHR0cnkge1xuXHRcdFx0XHRcdGV4ZWNOYXRpdmVDb21tYW5kKGNvbW1hbmQpO1xuXHRcdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRcdC8vIENvbW1hbmQgZmFpbGVkXG5cdFx0XHRcdFx0ZmFpbGVkID0gVFJVRTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIENocm9tZSByZXBvcnRzIHRoZSBwYXN0ZSBjb21tYW5kIGFzIHN1cHBvcnRlZCBob3dldmVyIG9sZGVyIElFOnMgd2lsbCByZXR1cm4gZmFsc2UgZm9yIGN1dC9wYXN0ZVxuXHRcdFx0XHRpZiAoY29tbWFuZCA9PT0gJ3Bhc3RlJyAmJiAhZG9jLnF1ZXJ5Q29tbWFuZEVuYWJsZWQoY29tbWFuZCkpIHtcblx0XHRcdFx0XHRmYWlsZWQgPSB0cnVlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gUHJlc2VudCBhbGVydCBtZXNzYWdlIGFib3V0IGNsaXBib2FyZCBhY2Nlc3Mgbm90IGJlaW5nIGF2YWlsYWJsZVxuXHRcdFx0XHRpZiAoZmFpbGVkIHx8ICFkb2MucXVlcnlDb21tYW5kU3VwcG9ydGVkKGNvbW1hbmQpKSB7XG5cdFx0XHRcdFx0dmFyIG1zZyA9IGVkaXRvci50cmFuc2xhdGUoXG5cdFx0XHRcdFx0XHRcIllvdXIgYnJvd3NlciBkb2Vzbid0IHN1cHBvcnQgZGlyZWN0IGFjY2VzcyB0byB0aGUgY2xpcGJvYXJkLiBcIiArXG5cdFx0XHRcdFx0XHRcIlBsZWFzZSB1c2UgdGhlIEN0cmwrWC9DL1Yga2V5Ym9hcmQgc2hvcnRjdXRzIGluc3RlYWQuXCJcblx0XHRcdFx0XHQpO1xuXG5cdFx0XHRcdFx0aWYgKEVudi5tYWMpIHtcblx0XHRcdFx0XHRcdG1zZyA9IG1zZy5yZXBsYWNlKC9DdHJsXFwrL2csICdcXHUyMzE4KycpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGVkaXRvci5ub3RpZmljYXRpb25NYW5hZ2VyLm9wZW4oe3RleHQ6IG1zZywgdHlwZTogJ2Vycm9yJ30pO1xuXHRcdFx0XHR9XG5cdFx0XHR9LFxuXG5cdFx0XHQvLyBPdmVycmlkZSB1bmxpbmsgY29tbWFuZFxuXHRcdFx0dW5saW5rOiBmdW5jdGlvbigpIHtcblx0XHRcdFx0aWYgKHNlbGVjdGlvbi5pc0NvbGxhcHNlZCgpKSB7XG5cdFx0XHRcdFx0dmFyIGVsbSA9IGVkaXRvci5kb20uZ2V0UGFyZW50KGVkaXRvci5zZWxlY3Rpb24uZ2V0U3RhcnQoKSwgJ2EnKTtcblx0XHRcdFx0XHRpZiAoZWxtKSB7XG5cdFx0XHRcdFx0XHRlZGl0b3IuZG9tLnJlbW92ZShlbG0sIHRydWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGZvcm1hdHRlci5yZW1vdmUoXCJsaW5rXCIpO1xuXHRcdFx0fSxcblxuXHRcdFx0Ly8gT3ZlcnJpZGUganVzdGlmeSBjb21tYW5kcyB0byB1c2UgdGhlIHRleHQgZm9ybWF0dGVyIGVuZ2luZVxuXHRcdFx0J0p1c3RpZnlMZWZ0LEp1c3RpZnlDZW50ZXIsSnVzdGlmeVJpZ2h0LEp1c3RpZnlGdWxsLEp1c3RpZnlOb25lJzogZnVuY3Rpb24oY29tbWFuZCkge1xuXHRcdFx0XHR2YXIgYWxpZ24gPSBjb21tYW5kLnN1YnN0cmluZyg3KTtcblxuXHRcdFx0XHRpZiAoYWxpZ24gPT0gJ2Z1bGwnKSB7XG5cdFx0XHRcdFx0YWxpZ24gPSAnanVzdGlmeSc7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBSZW1vdmUgYWxsIG90aGVyIGFsaWdubWVudHMgZmlyc3Rcblx0XHRcdFx0ZWFjaCgnbGVmdCxjZW50ZXIscmlnaHQsanVzdGlmeScuc3BsaXQoJywnKSwgZnVuY3Rpb24obmFtZSkge1xuXHRcdFx0XHRcdGlmIChhbGlnbiAhPSBuYW1lKSB7XG5cdFx0XHRcdFx0XHRmb3JtYXR0ZXIucmVtb3ZlKCdhbGlnbicgKyBuYW1lKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdGlmIChhbGlnbiAhPSAnbm9uZScpIHtcblx0XHRcdFx0XHR0b2dnbGVGb3JtYXQoJ2FsaWduJyArIGFsaWduKTtcblx0XHRcdFx0fVxuXHRcdFx0fSxcblxuXHRcdFx0Ly8gT3ZlcnJpZGUgbGlzdCBjb21tYW5kcyB0byBmaXggV2ViS2l0IGJ1Z1xuXHRcdFx0J0luc2VydFVub3JkZXJlZExpc3QsSW5zZXJ0T3JkZXJlZExpc3QnOiBmdW5jdGlvbihjb21tYW5kKSB7XG5cdFx0XHRcdHZhciBsaXN0RWxtLCBsaXN0UGFyZW50O1xuXG5cdFx0XHRcdGV4ZWNOYXRpdmVDb21tYW5kKGNvbW1hbmQpO1xuXG5cdFx0XHRcdC8vIFdlYktpdCBwcm9kdWNlcyBsaXN0cyB3aXRoaW4gYmxvY2sgZWxlbWVudHMgc28gd2UgbmVlZCB0byBzcGxpdCB0aGVtXG5cdFx0XHRcdC8vIHdlIHdpbGwgcmVwbGFjZSB0aGUgbmF0aXZlIGxpc3QgY3JlYXRpb24gbG9naWMgdG8gY3VzdG9tIGxvZ2ljIGxhdGVyIG9uXG5cdFx0XHRcdC8vIFRPRE86IFJlbW92ZSB0aGlzIHdoZW4gdGhlIGxpc3QgY3JlYXRpb24gbG9naWMgaXMgcmVtb3ZlZFxuXHRcdFx0XHRsaXN0RWxtID0gZG9tLmdldFBhcmVudChzZWxlY3Rpb24uZ2V0Tm9kZSgpLCAnb2wsdWwnKTtcblx0XHRcdFx0aWYgKGxpc3RFbG0pIHtcblx0XHRcdFx0XHRsaXN0UGFyZW50ID0gbGlzdEVsbS5wYXJlbnROb2RlO1xuXG5cdFx0XHRcdFx0Ly8gSWYgbGlzdCBpcyB3aXRoaW4gYSB0ZXh0IGJsb2NrIHRoZW4gc3BsaXQgdGhhdCBibG9ja1xuXHRcdFx0XHRcdGlmICgvXihIWzEtNl18UHxBRERSRVNTfFBSRSkkLy50ZXN0KGxpc3RQYXJlbnQubm9kZU5hbWUpKSB7XG5cdFx0XHRcdFx0XHRzdG9yZVNlbGVjdGlvbigpO1xuXHRcdFx0XHRcdFx0ZG9tLnNwbGl0KGxpc3RQYXJlbnQsIGxpc3RFbG0pO1xuXHRcdFx0XHRcdFx0cmVzdG9yZVNlbGVjdGlvbigpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fSxcblxuXHRcdFx0Ly8gT3ZlcnJpZGUgY29tbWFuZHMgdG8gdXNlIHRoZSB0ZXh0IGZvcm1hdHRlciBlbmdpbmVcblx0XHRcdCdCb2xkLEl0YWxpYyxVbmRlcmxpbmUsU3RyaWtldGhyb3VnaCxTdXBlcnNjcmlwdCxTdWJzY3JpcHQnOiBmdW5jdGlvbihjb21tYW5kKSB7XG5cdFx0XHRcdHRvZ2dsZUZvcm1hdChjb21tYW5kKTtcblx0XHRcdH0sXG5cblx0XHRcdC8vIE92ZXJyaWRlIGNvbW1hbmRzIHRvIHVzZSB0aGUgdGV4dCBmb3JtYXR0ZXIgZW5naW5lXG5cdFx0XHQnRm9yZUNvbG9yLEhpbGl0ZUNvbG9yLEZvbnROYW1lJzogZnVuY3Rpb24oY29tbWFuZCwgdWksIHZhbHVlKSB7XG5cdFx0XHRcdHRvZ2dsZUZvcm1hdChjb21tYW5kLCB2YWx1ZSk7XG5cdFx0XHR9LFxuXG5cdFx0XHRGb250U2l6ZTogZnVuY3Rpb24oY29tbWFuZCwgdWksIHZhbHVlKSB7XG5cdFx0XHRcdHZhciBmb250Q2xhc3NlcywgZm9udFNpemVzO1xuXG5cdFx0XHRcdC8vIENvbnZlcnQgZm9udCBzaXplIDEtNyB0byBzdHlsZXNcblx0XHRcdFx0aWYgKHZhbHVlID49IDEgJiYgdmFsdWUgPD0gNykge1xuXHRcdFx0XHRcdGZvbnRTaXplcyA9IGV4cGxvZGUoc2V0dGluZ3MuZm9udF9zaXplX3N0eWxlX3ZhbHVlcyk7XG5cdFx0XHRcdFx0Zm9udENsYXNzZXMgPSBleHBsb2RlKHNldHRpbmdzLmZvbnRfc2l6ZV9jbGFzc2VzKTtcblxuXHRcdFx0XHRcdGlmIChmb250Q2xhc3Nlcykge1xuXHRcdFx0XHRcdFx0dmFsdWUgPSBmb250Q2xhc3Nlc1t2YWx1ZSAtIDFdIHx8IHZhbHVlO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHR2YWx1ZSA9IGZvbnRTaXplc1t2YWx1ZSAtIDFdIHx8IHZhbHVlO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdHRvZ2dsZUZvcm1hdChjb21tYW5kLCB2YWx1ZSk7XG5cdFx0XHR9LFxuXG5cdFx0XHRSZW1vdmVGb3JtYXQ6IGZ1bmN0aW9uKGNvbW1hbmQpIHtcblx0XHRcdFx0Zm9ybWF0dGVyLnJlbW92ZShjb21tYW5kKTtcblx0XHRcdH0sXG5cblx0XHRcdG1jZUJsb2NrUXVvdGU6IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0b2dnbGVGb3JtYXQoJ2Jsb2NrcXVvdGUnKTtcblx0XHRcdH0sXG5cblx0XHRcdEZvcm1hdEJsb2NrOiBmdW5jdGlvbihjb21tYW5kLCB1aSwgdmFsdWUpIHtcblx0XHRcdFx0cmV0dXJuIHRvZ2dsZUZvcm1hdCh2YWx1ZSB8fCAncCcpO1xuXHRcdFx0fSxcblxuXHRcdFx0bWNlQ2xlYW51cDogZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHZhciBib29rbWFyayA9IHNlbGVjdGlvbi5nZXRCb29rbWFyaygpO1xuXG5cdFx0XHRcdGVkaXRvci5zZXRDb250ZW50KGVkaXRvci5nZXRDb250ZW50KHtjbGVhbnVwOiBUUlVFfSksIHtjbGVhbnVwOiBUUlVFfSk7XG5cblx0XHRcdFx0c2VsZWN0aW9uLm1vdmVUb0Jvb2ttYXJrKGJvb2ttYXJrKTtcblx0XHRcdH0sXG5cblx0XHRcdG1jZVJlbW92ZU5vZGU6IGZ1bmN0aW9uKGNvbW1hbmQsIHVpLCB2YWx1ZSkge1xuXHRcdFx0XHR2YXIgbm9kZSA9IHZhbHVlIHx8IHNlbGVjdGlvbi5nZXROb2RlKCk7XG5cblx0XHRcdFx0Ly8gTWFrZSBzdXJlIHRoYXQgdGhlIGJvZHkgbm9kZSBpc24ndCByZW1vdmVkXG5cdFx0XHRcdGlmIChub2RlICE9IGVkaXRvci5nZXRCb2R5KCkpIHtcblx0XHRcdFx0XHRzdG9yZVNlbGVjdGlvbigpO1xuXHRcdFx0XHRcdGVkaXRvci5kb20ucmVtb3ZlKG5vZGUsIFRSVUUpO1xuXHRcdFx0XHRcdHJlc3RvcmVTZWxlY3Rpb24oKTtcblx0XHRcdFx0fVxuXHRcdFx0fSxcblxuXHRcdFx0bWNlU2VsZWN0Tm9kZURlcHRoOiBmdW5jdGlvbihjb21tYW5kLCB1aSwgdmFsdWUpIHtcblx0XHRcdFx0dmFyIGNvdW50ZXIgPSAwO1xuXG5cdFx0XHRcdGRvbS5nZXRQYXJlbnQoc2VsZWN0aW9uLmdldE5vZGUoKSwgZnVuY3Rpb24obm9kZSkge1xuXHRcdFx0XHRcdGlmIChub2RlLm5vZGVUeXBlID09IDEgJiYgY291bnRlcisrID09IHZhbHVlKSB7XG5cdFx0XHRcdFx0XHRzZWxlY3Rpb24uc2VsZWN0KG5vZGUpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIEZBTFNFO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSwgZWRpdG9yLmdldEJvZHkoKSk7XG5cdFx0XHR9LFxuXG5cdFx0XHRtY2VTZWxlY3ROb2RlOiBmdW5jdGlvbihjb21tYW5kLCB1aSwgdmFsdWUpIHtcblx0XHRcdFx0c2VsZWN0aW9uLnNlbGVjdCh2YWx1ZSk7XG5cdFx0XHR9LFxuXG5cdFx0XHRtY2VJbnNlcnRDb250ZW50OiBmdW5jdGlvbihjb21tYW5kLCB1aSwgdmFsdWUpIHtcblx0XHRcdFx0SW5zZXJ0Q29udGVudC5pbnNlcnRBdENhcmV0KGVkaXRvciwgdmFsdWUpO1xuXHRcdFx0fSxcblxuXHRcdFx0bWNlSW5zZXJ0UmF3SFRNTDogZnVuY3Rpb24oY29tbWFuZCwgdWksIHZhbHVlKSB7XG5cdFx0XHRcdHNlbGVjdGlvbi5zZXRDb250ZW50KCd0aW55X21jZV9tYXJrZXInKTtcblx0XHRcdFx0ZWRpdG9yLnNldENvbnRlbnQoXG5cdFx0XHRcdFx0ZWRpdG9yLmdldENvbnRlbnQoKS5yZXBsYWNlKC90aW55X21jZV9tYXJrZXIvZywgZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSlcblx0XHRcdFx0KTtcblx0XHRcdH0sXG5cblx0XHRcdG1jZVRvZ2dsZUZvcm1hdDogZnVuY3Rpb24oY29tbWFuZCwgdWksIHZhbHVlKSB7XG5cdFx0XHRcdHRvZ2dsZUZvcm1hdCh2YWx1ZSk7XG5cdFx0XHR9LFxuXG5cdFx0XHRtY2VTZXRDb250ZW50OiBmdW5jdGlvbihjb21tYW5kLCB1aSwgdmFsdWUpIHtcblx0XHRcdFx0ZWRpdG9yLnNldENvbnRlbnQodmFsdWUpO1xuXHRcdFx0fSxcblxuXHRcdFx0J0luZGVudCxPdXRkZW50JzogZnVuY3Rpb24oY29tbWFuZCkge1xuXHRcdFx0XHR2YXIgaW50ZW50VmFsdWUsIGluZGVudFVuaXQsIHZhbHVlO1xuXG5cdFx0XHRcdC8vIFNldHVwIGluZGVudCBsZXZlbFxuXHRcdFx0XHRpbnRlbnRWYWx1ZSA9IHNldHRpbmdzLmluZGVudGF0aW9uO1xuXHRcdFx0XHRpbmRlbnRVbml0ID0gL1thLXolXSskL2kuZXhlYyhpbnRlbnRWYWx1ZSk7XG5cdFx0XHRcdGludGVudFZhbHVlID0gcGFyc2VJbnQoaW50ZW50VmFsdWUsIDEwKTtcblxuXHRcdFx0XHRpZiAoIXF1ZXJ5Q29tbWFuZFN0YXRlKCdJbnNlcnRVbm9yZGVyZWRMaXN0JykgJiYgIXF1ZXJ5Q29tbWFuZFN0YXRlKCdJbnNlcnRPcmRlcmVkTGlzdCcpKSB7XG5cdFx0XHRcdFx0Ly8gSWYgZm9yY2VkX3Jvb3RfYmxvY2tzIGlzIHNldCB0byBmYWxzZSB3ZSBkb24ndCBoYXZlIGEgYmxvY2sgdG8gaW5kZW50IHNvIGxldHMgY3JlYXRlIGEgZGl2XG5cdFx0XHRcdFx0aWYgKCFzZXR0aW5ncy5mb3JjZWRfcm9vdF9ibG9jayAmJiAhZG9tLmdldFBhcmVudChzZWxlY3Rpb24uZ2V0Tm9kZSgpLCBkb20uaXNCbG9jaykpIHtcblx0XHRcdFx0XHRcdGZvcm1hdHRlci5hcHBseSgnZGl2Jyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0ZWFjaChzZWxlY3Rpb24uZ2V0U2VsZWN0ZWRCbG9ja3MoKSwgZnVuY3Rpb24oZWxlbWVudCkge1xuXHRcdFx0XHRcdFx0aWYgKGRvbS5nZXRDb250ZW50RWRpdGFibGUoZWxlbWVudCkgPT09IFwiZmFsc2VcIikge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGlmIChlbGVtZW50Lm5vZGVOYW1lICE9PSBcIkxJXCIpIHtcblx0XHRcdFx0XHRcdFx0dmFyIGluZGVudFN0eWxlTmFtZSA9IGVkaXRvci5nZXRQYXJhbSgnaW5kZW50X3VzZV9tYXJnaW4nLCBmYWxzZSkgPyAnbWFyZ2luJyA6ICdwYWRkaW5nJztcblx0XHRcdFx0XHRcdFx0aW5kZW50U3R5bGVOYW1lID0gZWxlbWVudC5ub2RlTmFtZSA9PT0gJ1RBQkxFJyA/ICdtYXJnaW4nIDogaW5kZW50U3R5bGVOYW1lO1xuXHRcdFx0XHRcdFx0XHRpbmRlbnRTdHlsZU5hbWUgKz0gZG9tLmdldFN0eWxlKGVsZW1lbnQsICdkaXJlY3Rpb24nLCB0cnVlKSA9PSAncnRsJyA/ICdSaWdodCcgOiAnTGVmdCc7XG5cblx0XHRcdFx0XHRcdFx0aWYgKGNvbW1hbmQgPT0gJ291dGRlbnQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0dmFsdWUgPSBNYXRoLm1heCgwLCBwYXJzZUludChlbGVtZW50LnN0eWxlW2luZGVudFN0eWxlTmFtZV0gfHwgMCwgMTApIC0gaW50ZW50VmFsdWUpO1xuXHRcdFx0XHRcdFx0XHRcdGRvbS5zZXRTdHlsZShlbGVtZW50LCBpbmRlbnRTdHlsZU5hbWUsIHZhbHVlID8gdmFsdWUgKyBpbmRlbnRVbml0IDogJycpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRcdHZhbHVlID0gKHBhcnNlSW50KGVsZW1lbnQuc3R5bGVbaW5kZW50U3R5bGVOYW1lXSB8fCAwLCAxMCkgKyBpbnRlbnRWYWx1ZSkgKyBpbmRlbnRVbml0O1xuXHRcdFx0XHRcdFx0XHRcdGRvbS5zZXRTdHlsZShlbGVtZW50LCBpbmRlbnRTdHlsZU5hbWUsIHZhbHVlKTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGV4ZWNOYXRpdmVDb21tYW5kKGNvbW1hbmQpO1xuXHRcdFx0XHR9XG5cdFx0XHR9LFxuXG5cdFx0XHRtY2VSZXBhaW50OiBmdW5jdGlvbigpIHtcblx0XHRcdH0sXG5cblx0XHRcdEluc2VydEhvcml6b250YWxSdWxlOiBmdW5jdGlvbigpIHtcblx0XHRcdFx0ZWRpdG9yLmV4ZWNDb21tYW5kKCdtY2VJbnNlcnRDb250ZW50JywgZmFsc2UsICc8aHIgLz4nKTtcblx0XHRcdH0sXG5cblx0XHRcdG1jZVRvZ2dsZVZpc3VhbEFpZDogZnVuY3Rpb24oKSB7XG5cdFx0XHRcdGVkaXRvci5oYXNWaXN1YWwgPSAhZWRpdG9yLmhhc1Zpc3VhbDtcblx0XHRcdFx0ZWRpdG9yLmFkZFZpc3VhbCgpO1xuXHRcdFx0fSxcblxuXHRcdFx0bWNlUmVwbGFjZUNvbnRlbnQ6IGZ1bmN0aW9uKGNvbW1hbmQsIHVpLCB2YWx1ZSkge1xuXHRcdFx0XHRlZGl0b3IuZXhlY0NvbW1hbmQoJ21jZUluc2VydENvbnRlbnQnLCBmYWxzZSwgdmFsdWUucmVwbGFjZSgvXFx7XFwkc2VsZWN0aW9uXFx9L2csIHNlbGVjdGlvbi5nZXRDb250ZW50KHtmb3JtYXQ6ICd0ZXh0J30pKSk7XG5cdFx0XHR9LFxuXG5cdFx0XHRtY2VJbnNlcnRMaW5rOiBmdW5jdGlvbihjb21tYW5kLCB1aSwgdmFsdWUpIHtcblx0XHRcdFx0dmFyIGFuY2hvcjtcblxuXHRcdFx0XHRpZiAodHlwZW9mIHZhbHVlID09ICdzdHJpbmcnKSB7XG5cdFx0XHRcdFx0dmFsdWUgPSB7aHJlZjogdmFsdWV9O1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0YW5jaG9yID0gZG9tLmdldFBhcmVudChzZWxlY3Rpb24uZ2V0Tm9kZSgpLCAnYScpO1xuXG5cdFx0XHRcdC8vIFNwYWNlcyBhcmUgbmV2ZXIgdmFsaWQgaW4gVVJMcyBhbmQgaXQncyBhIHZlcnkgY29tbW9uIG1pc3Rha2UgZm9yIHBlb3BsZSB0byBtYWtlIHNvIHdlIGZpeCBpdCBoZXJlLlxuXHRcdFx0XHR2YWx1ZS5ocmVmID0gdmFsdWUuaHJlZi5yZXBsYWNlKCcgJywgJyUyMCcpO1xuXG5cdFx0XHRcdC8vIFJlbW92ZSBleGlzdGluZyBsaW5rcyBpZiB0aGVyZSBjb3VsZCBiZSBjaGlsZCBsaW5rcyBvciB0aGF0IHRoZSBocmVmIGlzbid0IHNwZWNpZmllZFxuXHRcdFx0XHRpZiAoIWFuY2hvciB8fCAhdmFsdWUuaHJlZikge1xuXHRcdFx0XHRcdGZvcm1hdHRlci5yZW1vdmUoJ2xpbmsnKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIEFwcGx5IG5ldyBsaW5rIHRvIHNlbGVjdGlvblxuXHRcdFx0XHRpZiAodmFsdWUuaHJlZikge1xuXHRcdFx0XHRcdGZvcm1hdHRlci5hcHBseSgnbGluaycsIHZhbHVlLCBhbmNob3IpO1xuXHRcdFx0XHR9XG5cdFx0XHR9LFxuXG5cdFx0XHRzZWxlY3RBbGw6IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR2YXIgcm9vdCA9IGRvbS5nZXRSb290KCksIHJuZztcblxuXHRcdFx0XHRpZiAoc2VsZWN0aW9uLmdldFJuZygpLnNldFN0YXJ0KSB7XG5cdFx0XHRcdFx0cm5nID0gZG9tLmNyZWF0ZVJuZygpO1xuXHRcdFx0XHRcdHJuZy5zZXRTdGFydChyb290LCAwKTtcblx0XHRcdFx0XHRybmcuc2V0RW5kKHJvb3QsIHJvb3QuY2hpbGROb2Rlcy5sZW5ndGgpO1xuXHRcdFx0XHRcdHNlbGVjdGlvbi5zZXRSbmcocm5nKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHQvLyBJRSB3aWxsIHJlbmRlciBpdCdzIG93biByb290IGxldmVsIGJsb2NrIGVsZW1lbnRzIGFuZCBzb21ldGltZXNcblx0XHRcdFx0XHQvLyBldmVuIHB1dCBmb250IGVsZW1lbnRzIGluIHRoZW0gd2hlbiB0aGUgdXNlciBzdGFydHMgdHlwaW5nLiBTbyB3ZSBuZWVkIHRvXG5cdFx0XHRcdFx0Ly8gbW92ZSB0aGUgc2VsZWN0aW9uIHRvIGEgbW9yZSBzdWl0YWJsZSBlbGVtZW50IGZyb20gdGhpczpcblx0XHRcdFx0XHQvLyA8Ym9keT58PHA+PC9wPjwvYm9keT4gdG8gdGhpczogPGJvZHk+PHA+fDwvcD48L2JvZHk+XG5cdFx0XHRcdFx0cm5nID0gc2VsZWN0aW9uLmdldFJuZygpO1xuXHRcdFx0XHRcdGlmICghcm5nLml0ZW0pIHtcblx0XHRcdFx0XHRcdHJuZy5tb3ZlVG9FbGVtZW50VGV4dChyb290KTtcblx0XHRcdFx0XHRcdHJuZy5zZWxlY3QoKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0sXG5cblx0XHRcdFwiZGVsZXRlXCI6IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRleGVjTmF0aXZlQ29tbWFuZChcIkRlbGV0ZVwiKTtcblxuXHRcdFx0XHQvLyBDaGVjayBpZiBib2R5IGlzIGVtcHR5IGFmdGVyIHRoZSBkZWxldGUgY2FsbCBpZiBzbyB0aGVuIHNldCB0aGUgY29udGVudHNcblx0XHRcdFx0Ly8gdG8gYW4gZW1wdHkgc3RyaW5nIGFuZCBtb3ZlIHRoZSBjYXJldCB0byBhbnkgYmxvY2sgcHJvZHVjZWQgYnkgdGhhdCBvcGVyYXRpb25cblx0XHRcdFx0Ly8gdGhpcyBmaXhlcyB0aGUgaXNzdWUgd2l0aCByb290IGJsb2NrcyBub3QgYmVpbmcgcHJvcGVybHkgcHJvZHVjZWQgYWZ0ZXIgYSBkZWxldGUgY2FsbCBvbiBJRVxuXHRcdFx0XHR2YXIgYm9keSA9IGVkaXRvci5nZXRCb2R5KCk7XG5cblx0XHRcdFx0aWYgKGRvbS5pc0VtcHR5KGJvZHkpKSB7XG5cdFx0XHRcdFx0ZWRpdG9yLnNldENvbnRlbnQoJycpO1xuXG5cdFx0XHRcdFx0aWYgKGJvZHkuZmlyc3RDaGlsZCAmJiBkb20uaXNCbG9jayhib2R5LmZpcnN0Q2hpbGQpKSB7XG5cdFx0XHRcdFx0XHRlZGl0b3Iuc2VsZWN0aW9uLnNldEN1cnNvckxvY2F0aW9uKGJvZHkuZmlyc3RDaGlsZCwgMCk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGVkaXRvci5zZWxlY3Rpb24uc2V0Q3Vyc29yTG9jYXRpb24oYm9keSwgMCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9LFxuXG5cdFx0XHRtY2VOZXdEb2N1bWVudDogZnVuY3Rpb24oKSB7XG5cdFx0XHRcdGVkaXRvci5zZXRDb250ZW50KCcnKTtcblx0XHRcdH0sXG5cblx0XHRcdEluc2VydExpbmVCcmVhazogZnVuY3Rpb24oY29tbWFuZCwgdWksIHZhbHVlKSB7XG5cdFx0XHRcdC8vIFdlIGxvYWQgdGhlIGN1cnJlbnQgZXZlbnQgaW4gZnJvbSBFbnRlcktleS5qcyB3aGVuIGFwcHJvcHJpYXRlIHRvIGhlZWRcblx0XHRcdFx0Ly8gY2VydGFpbiBldmVudC1zcGVjaWZpYyB2YXJpYXRpb25zIHN1Y2ggYXMgY3RybC1lbnRlciBpbiBhIGxpc3Rcblx0XHRcdFx0dmFyIGV2dCA9IHZhbHVlO1xuXHRcdFx0XHR2YXIgYnJFbG0sIGV4dHJhQnIsIG1hcmtlcjtcblx0XHRcdFx0dmFyIHJuZyA9IHNlbGVjdGlvbi5nZXRSbmcodHJ1ZSk7XG5cdFx0XHRcdG5ldyBSYW5nZVV0aWxzKGRvbSkubm9ybWFsaXplKHJuZyk7XG5cblx0XHRcdFx0dmFyIG9mZnNldCA9IHJuZy5zdGFydE9mZnNldDtcblx0XHRcdFx0dmFyIGNvbnRhaW5lciA9IHJuZy5zdGFydENvbnRhaW5lcjtcblxuXHRcdFx0XHQvLyBSZXNvbHZlIG5vZGUgaW5kZXhcblx0XHRcdFx0aWYgKGNvbnRhaW5lci5ub2RlVHlwZSA9PSAxICYmIGNvbnRhaW5lci5oYXNDaGlsZE5vZGVzKCkpIHtcblx0XHRcdFx0XHR2YXIgaXNBZnRlckxhc3ROb2RlSW5Db250YWluZXIgPSBvZmZzZXQgPiBjb250YWluZXIuY2hpbGROb2Rlcy5sZW5ndGggLSAxO1xuXG5cdFx0XHRcdFx0Y29udGFpbmVyID0gY29udGFpbmVyLmNoaWxkTm9kZXNbTWF0aC5taW4ob2Zmc2V0LCBjb250YWluZXIuY2hpbGROb2Rlcy5sZW5ndGggLSAxKV0gfHwgY29udGFpbmVyO1xuXHRcdFx0XHRcdGlmIChpc0FmdGVyTGFzdE5vZGVJbkNvbnRhaW5lciAmJiBjb250YWluZXIubm9kZVR5cGUgPT0gMykge1xuXHRcdFx0XHRcdFx0b2Zmc2V0ID0gY29udGFpbmVyLm5vZGVWYWx1ZS5sZW5ndGg7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdG9mZnNldCA9IDA7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0dmFyIHBhcmVudEJsb2NrID0gZG9tLmdldFBhcmVudChjb250YWluZXIsIGRvbS5pc0Jsb2NrKTtcblx0XHRcdFx0dmFyIHBhcmVudEJsb2NrTmFtZSA9IHBhcmVudEJsb2NrID8gcGFyZW50QmxvY2subm9kZU5hbWUudG9VcHBlckNhc2UoKSA6ICcnOyAvLyBJRSA8IDkgJiBIVE1MNVxuXHRcdFx0XHR2YXIgY29udGFpbmVyQmxvY2sgPSBwYXJlbnRCbG9jayA/IGRvbS5nZXRQYXJlbnQocGFyZW50QmxvY2sucGFyZW50Tm9kZSwgZG9tLmlzQmxvY2spIDogbnVsbDtcblx0XHRcdFx0dmFyIGNvbnRhaW5lckJsb2NrTmFtZSA9IGNvbnRhaW5lckJsb2NrID8gY29udGFpbmVyQmxvY2subm9kZU5hbWUudG9VcHBlckNhc2UoKSA6ICcnOyAvLyBJRSA8IDkgJiBIVE1MNVxuXG5cdFx0XHRcdC8vIEVudGVyIGluc2lkZSBibG9jayBjb250YWluZWQgd2l0aGluIGEgTEkgdGhlbiBzcGxpdCBvciBpbnNlcnQgYmVmb3JlL2FmdGVyIExJXG5cdFx0XHRcdHZhciBpc0NvbnRyb2xLZXkgPSBldnQgJiYgZXZ0LmN0cmxLZXk7XG5cdFx0XHRcdGlmIChjb250YWluZXJCbG9ja05hbWUgPT0gJ0xJJyAmJiAhaXNDb250cm9sS2V5KSB7XG5cdFx0XHRcdFx0cGFyZW50QmxvY2sgPSBjb250YWluZXJCbG9jaztcblx0XHRcdFx0XHRwYXJlbnRCbG9ja05hbWUgPSBjb250YWluZXJCbG9ja05hbWU7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBXYWxrcyB0aGUgcGFyZW50IGJsb2NrIHRvIHRoZSByaWdodCBhbmQgbG9vayBmb3IgQlIgZWxlbWVudHNcblx0XHRcdFx0ZnVuY3Rpb24gaGFzUmlnaHRTaWRlQ29udGVudCgpIHtcblx0XHRcdFx0XHR2YXIgd2Fsa2VyID0gbmV3IFRyZWVXYWxrZXIoY29udGFpbmVyLCBwYXJlbnRCbG9jayksIG5vZGU7XG5cdFx0XHRcdFx0dmFyIG5vbkVtcHR5RWxlbWVudHNNYXAgPSBlZGl0b3Iuc2NoZW1hLmdldE5vbkVtcHR5RWxlbWVudHMoKTtcblxuXHRcdFx0XHRcdHdoaWxlICgobm9kZSA9IHdhbGtlci5uZXh0KCkpKSB7XG5cdFx0XHRcdFx0XHRpZiAobm9uRW1wdHlFbGVtZW50c01hcFtub2RlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCldIHx8IG5vZGUubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoY29udGFpbmVyICYmIGNvbnRhaW5lci5ub2RlVHlwZSA9PSAzICYmIG9mZnNldCA+PSBjb250YWluZXIubm9kZVZhbHVlLmxlbmd0aCkge1xuXHRcdFx0XHRcdC8vIEluc2VydCBleHRyYSBCUiBlbGVtZW50IGF0IHRoZSBlbmQgYmxvY2sgZWxlbWVudHNcblx0XHRcdFx0XHRpZiAoIWlzT2xkSUUgJiYgIWhhc1JpZ2h0U2lkZUNvbnRlbnQoKSkge1xuXHRcdFx0XHRcdFx0YnJFbG0gPSBkb20uY3JlYXRlKCdicicpO1xuXHRcdFx0XHRcdFx0cm5nLmluc2VydE5vZGUoYnJFbG0pO1xuXHRcdFx0XHRcdFx0cm5nLnNldFN0YXJ0QWZ0ZXIoYnJFbG0pO1xuXHRcdFx0XHRcdFx0cm5nLnNldEVuZEFmdGVyKGJyRWxtKTtcblx0XHRcdFx0XHRcdGV4dHJhQnIgPSB0cnVlO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdGJyRWxtID0gZG9tLmNyZWF0ZSgnYnInKTtcblx0XHRcdFx0cm5nLmluc2VydE5vZGUoYnJFbG0pO1xuXG5cdFx0XHRcdC8vIFJlbmRlcmluZyBtb2RlcyBiZWxvdyBJRTggZG9lc24ndCBkaXNwbGF5IEJSIGVsZW1lbnRzIGluIFBSRSB1bmxlc3Mgd2UgaGF2ZSBhIFxcbiBiZWZvcmUgaXRcblx0XHRcdFx0dmFyIGRvY3VtZW50TW9kZSA9IGRvbS5kb2MuZG9jdW1lbnRNb2RlO1xuXHRcdFx0XHRpZiAoaXNPbGRJRSAmJiBwYXJlbnRCbG9ja05hbWUgPT0gJ1BSRScgJiYgKCFkb2N1bWVudE1vZGUgfHwgZG9jdW1lbnRNb2RlIDwgOCkpIHtcblx0XHRcdFx0XHRickVsbS5wYXJlbnROb2RlLmluc2VydEJlZm9yZShkb20uZG9jLmNyZWF0ZVRleHROb2RlKCdcXHInKSwgYnJFbG0pO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gSW5zZXJ0IHRlbXAgbWFya2VyIGFuZCBzY3JvbGwgdG8gdGhhdFxuXHRcdFx0XHRtYXJrZXIgPSBkb20uY3JlYXRlKCdzcGFuJywge30sICcmbmJzcDsnKTtcblx0XHRcdFx0YnJFbG0ucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUobWFya2VyLCBickVsbSk7XG5cdFx0XHRcdHNlbGVjdGlvbi5zY3JvbGxJbnRvVmlldyhtYXJrZXIpO1xuXHRcdFx0XHRkb20ucmVtb3ZlKG1hcmtlcik7XG5cblx0XHRcdFx0aWYgKCFleHRyYUJyKSB7XG5cdFx0XHRcdFx0cm5nLnNldFN0YXJ0QWZ0ZXIoYnJFbG0pO1xuXHRcdFx0XHRcdHJuZy5zZXRFbmRBZnRlcihickVsbSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0cm5nLnNldFN0YXJ0QmVmb3JlKGJyRWxtKTtcblx0XHRcdFx0XHRybmcuc2V0RW5kQmVmb3JlKGJyRWxtKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHNlbGVjdGlvbi5zZXRSbmcocm5nKTtcblx0XHRcdFx0ZWRpdG9yLnVuZG9NYW5hZ2VyLmFkZCgpO1xuXG5cdFx0XHRcdHJldHVybiBUUlVFO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0Ly8gQWRkIHF1ZXJ5Q29tbWFuZFN0YXRlIG92ZXJyaWRlc1xuXHRcdGFkZENvbW1hbmRzKHtcblx0XHRcdC8vIE92ZXJyaWRlIGp1c3RpZnkgY29tbWFuZHNcblx0XHRcdCdKdXN0aWZ5TGVmdCxKdXN0aWZ5Q2VudGVyLEp1c3RpZnlSaWdodCxKdXN0aWZ5RnVsbCc6IGZ1bmN0aW9uKGNvbW1hbmQpIHtcblx0XHRcdFx0dmFyIG5hbWUgPSAnYWxpZ24nICsgY29tbWFuZC5zdWJzdHJpbmcoNyk7XG5cdFx0XHRcdHZhciBub2RlcyA9IHNlbGVjdGlvbi5pc0NvbGxhcHNlZCgpID8gW2RvbS5nZXRQYXJlbnQoc2VsZWN0aW9uLmdldE5vZGUoKSwgZG9tLmlzQmxvY2spXSA6IHNlbGVjdGlvbi5nZXRTZWxlY3RlZEJsb2NrcygpO1xuXHRcdFx0XHR2YXIgbWF0Y2hlcyA9IG1hcChub2RlcywgZnVuY3Rpb24obm9kZSkge1xuXHRcdFx0XHRcdHJldHVybiAhIWZvcm1hdHRlci5tYXRjaE5vZGUobm9kZSwgbmFtZSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0XHRyZXR1cm4gaW5BcnJheShtYXRjaGVzLCBUUlVFKSAhPT0gLTE7XG5cdFx0XHR9LFxuXG5cdFx0XHQnQm9sZCxJdGFsaWMsVW5kZXJsaW5lLFN0cmlrZXRocm91Z2gsU3VwZXJzY3JpcHQsU3Vic2NyaXB0JzogZnVuY3Rpb24oY29tbWFuZCkge1xuXHRcdFx0XHRyZXR1cm4gaXNGb3JtYXRNYXRjaChjb21tYW5kKTtcblx0XHRcdH0sXG5cblx0XHRcdG1jZUJsb2NrUXVvdGU6IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRyZXR1cm4gaXNGb3JtYXRNYXRjaCgnYmxvY2txdW90ZScpO1xuXHRcdFx0fSxcblxuXHRcdFx0T3V0ZGVudDogZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHZhciBub2RlO1xuXG5cdFx0XHRcdGlmIChzZXR0aW5ncy5pbmxpbmVfc3R5bGVzKSB7XG5cdFx0XHRcdFx0aWYgKChub2RlID0gZG9tLmdldFBhcmVudChzZWxlY3Rpb24uZ2V0U3RhcnQoKSwgZG9tLmlzQmxvY2spKSAmJiBwYXJzZUludChub2RlLnN0eWxlLnBhZGRpbmdMZWZ0LCAxMCkgPiAwKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gVFJVRTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoKG5vZGUgPSBkb20uZ2V0UGFyZW50KHNlbGVjdGlvbi5nZXRFbmQoKSwgZG9tLmlzQmxvY2spKSAmJiBwYXJzZUludChub2RlLnN0eWxlLnBhZGRpbmdMZWZ0LCAxMCkgPiAwKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gVFJVRTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gKFxuXHRcdFx0XHRcdHF1ZXJ5Q29tbWFuZFN0YXRlKCdJbnNlcnRVbm9yZGVyZWRMaXN0JykgfHxcblx0XHRcdFx0XHRxdWVyeUNvbW1hbmRTdGF0ZSgnSW5zZXJ0T3JkZXJlZExpc3QnKSB8fFxuXHRcdFx0XHRcdCghc2V0dGluZ3MuaW5saW5lX3N0eWxlcyAmJiAhIWRvbS5nZXRQYXJlbnQoc2VsZWN0aW9uLmdldE5vZGUoKSwgJ0JMT0NLUVVPVEUnKSlcblx0XHRcdFx0KTtcblx0XHRcdH0sXG5cblx0XHRcdCdJbnNlcnRVbm9yZGVyZWRMaXN0LEluc2VydE9yZGVyZWRMaXN0JzogZnVuY3Rpb24oY29tbWFuZCkge1xuXHRcdFx0XHR2YXIgbGlzdCA9IGRvbS5nZXRQYXJlbnQoc2VsZWN0aW9uLmdldE5vZGUoKSwgJ3VsLG9sJyk7XG5cblx0XHRcdFx0cmV0dXJuIGxpc3QgJiZcblx0XHRcdFx0XHQoXG5cdFx0XHRcdFx0XHRjb21tYW5kID09PSAnaW5zZXJ0dW5vcmRlcmVkbGlzdCcgJiYgbGlzdC50YWdOYW1lID09PSAnVUwnIHx8XG5cdFx0XHRcdFx0XHRjb21tYW5kID09PSAnaW5zZXJ0b3JkZXJlZGxpc3QnICYmIGxpc3QudGFnTmFtZSA9PT0gJ09MJ1xuXHRcdFx0XHRcdCk7XG5cdFx0XHR9XG5cdFx0fSwgJ3N0YXRlJyk7XG5cblx0XHQvLyBBZGQgcXVlcnlDb21tYW5kVmFsdWUgb3ZlcnJpZGVzXG5cdFx0YWRkQ29tbWFuZHMoe1xuXHRcdFx0J0ZvbnRTaXplLEZvbnROYW1lJzogZnVuY3Rpb24oY29tbWFuZCkge1xuXHRcdFx0XHR2YXIgdmFsdWUgPSAwLCBwYXJlbnQ7XG5cblx0XHRcdFx0aWYgKChwYXJlbnQgPSBkb20uZ2V0UGFyZW50KHNlbGVjdGlvbi5nZXROb2RlKCksICdzcGFuJykpKSB7XG5cdFx0XHRcdFx0aWYgKGNvbW1hbmQgPT0gJ2ZvbnRzaXplJykge1xuXHRcdFx0XHRcdFx0dmFsdWUgPSBwYXJlbnQuc3R5bGUuZm9udFNpemU7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdHZhbHVlID0gcGFyZW50LnN0eWxlLmZvbnRGYW1pbHkucmVwbGFjZSgvLCAvZywgJywnKS5yZXBsYWNlKC9bXFwnXFxcIl0vZywgJycpLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0fVxuXHRcdH0sICd2YWx1ZScpO1xuXG5cdFx0Ly8gQWRkIHVuZG8gbWFuYWdlciBsb2dpY1xuXHRcdGFkZENvbW1hbmRzKHtcblx0XHRcdFVuZG86IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRlZGl0b3IudW5kb01hbmFnZXIudW5kbygpO1xuXHRcdFx0fSxcblxuXHRcdFx0UmVkbzogZnVuY3Rpb24oKSB7XG5cdFx0XHRcdGVkaXRvci51bmRvTWFuYWdlci5yZWRvKCk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH07XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL3V0aWwvVVJJLmpzXG5cbi8qKlxuICogVVJJLmpzXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgTEdQTCBMaWNlbnNlLlxuICogQ29weXJpZ2h0IChjKSAxOTk5LTIwMTUgRXBob3ggQ29ycC4gQWxsIHJpZ2h0cyByZXNlcnZlZFxuICpcbiAqIExpY2Vuc2U6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vbGljZW5zZVxuICogQ29udHJpYnV0aW5nOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2NvbnRyaWJ1dGluZ1xuICovXG5cbi8qKlxuICogVGhpcyBjbGFzcyBoYW5kbGVzIHBhcnNpbmcsIG1vZGlmaWNhdGlvbiBhbmQgc2VyaWFsaXphdGlvbiBvZiBVUkkvVVJMIHN0cmluZ3MuXG4gKiBAY2xhc3MgdGlueW1jZS51dGlsLlVSSVxuICovXG5kZWZpbmUoXCJ0aW55bWNlL3V0aWwvVVJJXCIsIFtcblx0XCJ0aW55bWNlL3V0aWwvVG9vbHNcIlxuXSwgZnVuY3Rpb24oVG9vbHMpIHtcblx0dmFyIGVhY2ggPSBUb29scy5lYWNoLCB0cmltID0gVG9vbHMudHJpbTtcblx0dmFyIHF1ZXJ5UGFydHMgPSBcInNvdXJjZSBwcm90b2NvbCBhdXRob3JpdHkgdXNlckluZm8gdXNlciBwYXNzd29yZCBob3N0IHBvcnQgcmVsYXRpdmUgcGF0aCBkaXJlY3RvcnkgZmlsZSBxdWVyeSBhbmNob3JcIi5zcGxpdCgnICcpO1xuXHR2YXIgREVGQVVMVF9QT1JUUyA9IHtcblx0XHQnZnRwJzogMjEsXG5cdFx0J2h0dHAnOiA4MCxcblx0XHQnaHR0cHMnOiA0NDMsXG5cdFx0J21haWx0byc6IDI1XG5cdH07XG5cblx0LyoqXG5cdCAqIENvbnN0cnVjdHMgYSBuZXcgVVJJIGluc3RhbmNlLlxuXHQgKlxuXHQgKiBAY29uc3RydWN0b3Jcblx0ICogQG1ldGhvZCBVUklcblx0ICogQHBhcmFtIHtTdHJpbmd9IHVybCBVUkkgc3RyaW5nIHRvIHBhcnNlLlxuXHQgKiBAcGFyYW0ge09iamVjdH0gc2V0dGluZ3MgT3B0aW9uYWwgc2V0dGluZ3Mgb2JqZWN0LlxuXHQgKi9cblx0ZnVuY3Rpb24gVVJJKHVybCwgc2V0dGluZ3MpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsIGJhc2VVcmksIGJhc2VfdXJsO1xuXG5cdFx0dXJsID0gdHJpbSh1cmwpO1xuXHRcdHNldHRpbmdzID0gc2VsZi5zZXR0aW5ncyA9IHNldHRpbmdzIHx8IHt9O1xuXHRcdGJhc2VVcmkgPSBzZXR0aW5ncy5iYXNlX3VyaTtcblxuXHRcdC8vIFN0cmFuZ2UgYXBwIHByb3RvY29sIHRoYXQgaXNuJ3QgaHR0cC9odHRwcyBvciBsb2NhbCBhbmNob3Jcblx0XHQvLyBGb3IgZXhhbXBsZTogbWFpbHRvLHNreXBlLHRlbCBldGMuXG5cdFx0aWYgKC9eKFtcXHdcXC1dKyk6KFteXFwvXXsyfSkvaS50ZXN0KHVybCkgfHwgL15cXHMqIy8udGVzdCh1cmwpKSB7XG5cdFx0XHRzZWxmLnNvdXJjZSA9IHVybDtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHR2YXIgaXNQcm90b2NvbFJlbGF0aXZlID0gdXJsLmluZGV4T2YoJy8vJykgPT09IDA7XG5cblx0XHQvLyBBYnNvbHV0ZSBwYXRoIHdpdGggbm8gaG9zdCwgZmFrZSBob3N0IGFuZCBwcm90b2NvbFxuXHRcdGlmICh1cmwuaW5kZXhPZignLycpID09PSAwICYmICFpc1Byb3RvY29sUmVsYXRpdmUpIHtcblx0XHRcdHVybCA9IChiYXNlVXJpID8gYmFzZVVyaS5wcm90b2NvbCB8fCAnaHR0cCcgOiAnaHR0cCcpICsgJzovL21jZV9ob3N0JyArIHVybDtcblx0XHR9XG5cblx0XHQvLyBSZWxhdGl2ZSBwYXRoIGh0dHA6Ly8gb3IgcHJvdG9jb2wgcmVsYXRpdmUgLy9wYXRoXG5cdFx0aWYgKCEvXltcXHdcXC1dKjo/XFwvXFwvLy50ZXN0KHVybCkpIHtcblx0XHRcdGJhc2VfdXJsID0gc2V0dGluZ3MuYmFzZV91cmkgPyBzZXR0aW5ncy5iYXNlX3VyaS5wYXRoIDogbmV3IFVSSShsb2NhdGlvbi5ocmVmKS5kaXJlY3Rvcnk7XG5cdFx0XHRpZiAoc2V0dGluZ3MuYmFzZV91cmkucHJvdG9jb2wgPT09IFwiXCIpIHtcblx0XHRcdFx0dXJsID0gJy8vbWNlX2hvc3QnICsgc2VsZi50b0Fic1BhdGgoYmFzZV91cmwsIHVybCk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR1cmwgPSAvKFteIz9dKikoWyM/XT8uKikvLmV4ZWModXJsKTtcblx0XHRcdFx0dXJsID0gKChiYXNlVXJpICYmIGJhc2VVcmkucHJvdG9jb2wpIHx8ICdodHRwJykgKyAnOi8vbWNlX2hvc3QnICsgc2VsZi50b0Fic1BhdGgoYmFzZV91cmwsIHVybFsxXSkgKyB1cmxbMl07XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0Ly8gUGFyc2UgVVJMIChDcmVkaXRzIGdvZXMgdG8gU3RlYXZlLCBodHRwOi8vYmxvZy5zdGV2ZW5sZXZpdGhhbi5jb20vYXJjaGl2ZXMvcGFyc2V1cmkpXG5cdFx0dXJsID0gdXJsLnJlcGxhY2UoL0BAL2csICcobWNlX2F0KScpOyAvLyBab3BlIDMgd29ya2Fyb3VuZCwgdGhleSB1c2UgQEBzb21ldGhpbmdcblxuXHRcdC8qanNoaW50IG1heGxlbjogMjU1ICovXG5cdFx0Lyplc2xpbnQgbWF4LWxlbjogMCAqL1xuXHRcdHVybCA9IC9eKD86KD8hW146QF0rOlteOkBcXC9dKkApKFteOlxcLz8jLl0rKTopPyg/OlxcL1xcLyk/KCg/OigoW146QFxcL10qKTo/KFteOkBcXC9dKikpP0ApPyhbXjpcXC8/I10qKSg/OjooXFxkKikpPykoKChcXC8oPzpbXj8jXSg/IVtePyNcXC9dKlxcLltePyNcXC8uXSsoPzpbPyNdfCQpKSkqXFwvPyk/KFtePyNcXC9dKikpKD86XFw/KFteI10qKSk/KD86IyguKikpPykvLmV4ZWModXJsKTtcblxuXHRcdGVhY2gocXVlcnlQYXJ0cywgZnVuY3Rpb24odiwgaSkge1xuXHRcdFx0dmFyIHBhcnQgPSB1cmxbaV07XG5cblx0XHRcdC8vIFpvcGUgMyB3b3JrYXJvdW5kLCB0aGV5IHVzZSBAQHNvbWV0aGluZ1xuXHRcdFx0aWYgKHBhcnQpIHtcblx0XHRcdFx0cGFydCA9IHBhcnQucmVwbGFjZSgvXFwobWNlX2F0XFwpL2csICdAQCcpO1xuXHRcdFx0fVxuXG5cdFx0XHRzZWxmW3ZdID0gcGFydDtcblx0XHR9KTtcblxuXHRcdGlmIChiYXNlVXJpKSB7XG5cdFx0XHRpZiAoIXNlbGYucHJvdG9jb2wpIHtcblx0XHRcdFx0c2VsZi5wcm90b2NvbCA9IGJhc2VVcmkucHJvdG9jb2w7XG5cdFx0XHR9XG5cblx0XHRcdGlmICghc2VsZi51c2VySW5mbykge1xuXHRcdFx0XHRzZWxmLnVzZXJJbmZvID0gYmFzZVVyaS51c2VySW5mbztcblx0XHRcdH1cblxuXHRcdFx0aWYgKCFzZWxmLnBvcnQgJiYgc2VsZi5ob3N0ID09PSAnbWNlX2hvc3QnKSB7XG5cdFx0XHRcdHNlbGYucG9ydCA9IGJhc2VVcmkucG9ydDtcblx0XHRcdH1cblxuXHRcdFx0aWYgKCFzZWxmLmhvc3QgfHwgc2VsZi5ob3N0ID09PSAnbWNlX2hvc3QnKSB7XG5cdFx0XHRcdHNlbGYuaG9zdCA9IGJhc2VVcmkuaG9zdDtcblx0XHRcdH1cblxuXHRcdFx0c2VsZi5zb3VyY2UgPSAnJztcblx0XHR9XG5cblx0XHRpZiAoaXNQcm90b2NvbFJlbGF0aXZlKSB7XG5cdFx0XHRzZWxmLnByb3RvY29sID0gJyc7XG5cdFx0fVxuXG5cdFx0Ly90LnBhdGggPSB0LnBhdGggfHwgJy8nO1xuXHR9XG5cblx0VVJJLnByb3RvdHlwZSA9IHtcblx0XHQvKipcblx0XHQgKiBTZXRzIHRoZSBpbnRlcm5hbCBwYXRoIHBhcnQgb2YgdGhlIFVSSS5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2Qgc2V0UGF0aFxuXHRcdCAqIEBwYXJhbSB7c3RyaW5nfSBwYXRoIFBhdGggc3RyaW5nIHRvIHNldC5cblx0XHQgKi9cblx0XHRzZXRQYXRoOiBmdW5jdGlvbihwYXRoKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdHBhdGggPSAvXiguKj8pXFwvPyhcXHcrKT8kLy5leGVjKHBhdGgpO1xuXG5cdFx0XHQvLyBVcGRhdGUgcGF0aCBwYXJ0c1xuXHRcdFx0c2VsZi5wYXRoID0gcGF0aFswXTtcblx0XHRcdHNlbGYuZGlyZWN0b3J5ID0gcGF0aFsxXTtcblx0XHRcdHNlbGYuZmlsZSA9IHBhdGhbMl07XG5cblx0XHRcdC8vIFJlYnVpbGQgc291cmNlXG5cdFx0XHRzZWxmLnNvdXJjZSA9ICcnO1xuXHRcdFx0c2VsZi5nZXRVUkkoKTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogQ29udmVydHMgdGhlIHNwZWNpZmllZCBVUkkgaW50byBhIHJlbGF0aXZlIFVSSSBiYXNlZCBvbiB0aGUgY3VycmVudCBVUkkgaW5zdGFuY2UgbG9jYXRpb24uXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHRvUmVsYXRpdmVcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gdXJpIFVSSSB0byBjb252ZXJ0IGludG8gYSByZWxhdGl2ZSBwYXRoL1VSSS5cblx0XHQgKiBAcmV0dXJuIHtTdHJpbmd9IFJlbGF0aXZlIFVSSSBmcm9tIHRoZSBwb2ludCBzcGVjaWZpZWQgaW4gdGhlIGN1cnJlbnQgVVJJIGluc3RhbmNlLlxuXHRcdCAqIEBleGFtcGxlXG5cdFx0ICogLy8gQ29udmVydHMgYW4gYWJzb2x1dGUgVVJMIHRvIGFuIHJlbGF0aXZlIFVSTCB1cmwgd2lsbCBiZSBzb21lZGlyL3NvbWVmaWxlLmh0bVxuXHRcdCAqIHZhciB1cmwgPSBuZXcgdGlueW1jZS51dGlsLlVSSSgnaHR0cDovL3d3dy5zaXRlLmNvbS9kaXIvJykudG9SZWxhdGl2ZSgnaHR0cDovL3d3dy5zaXRlLmNvbS9kaXIvc29tZWRpci9zb21lZmlsZS5odG0nKTtcblx0XHQgKi9cblx0XHR0b1JlbGF0aXZlOiBmdW5jdGlvbih1cmkpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgb3V0cHV0O1xuXG5cdFx0XHRpZiAodXJpID09PSBcIi4vXCIpIHtcblx0XHRcdFx0cmV0dXJuIHVyaTtcblx0XHRcdH1cblxuXHRcdFx0dXJpID0gbmV3IFVSSSh1cmksIHtiYXNlX3VyaTogc2VsZn0pO1xuXG5cdFx0XHQvLyBOb3Qgb24gc2FtZSBkb21haW4vcG9ydCBvciBwcm90b2NvbFxuXHRcdFx0aWYgKCh1cmkuaG9zdCAhPSAnbWNlX2hvc3QnICYmIHNlbGYuaG9zdCAhPSB1cmkuaG9zdCAmJiB1cmkuaG9zdCkgfHwgc2VsZi5wb3J0ICE9IHVyaS5wb3J0IHx8XG5cdFx0XHRcdChzZWxmLnByb3RvY29sICE9IHVyaS5wcm90b2NvbCAmJiB1cmkucHJvdG9jb2wgIT09IFwiXCIpKSB7XG5cdFx0XHRcdHJldHVybiB1cmkuZ2V0VVJJKCk7XG5cdFx0XHR9XG5cblx0XHRcdHZhciB0dSA9IHNlbGYuZ2V0VVJJKCksIHV1ID0gdXJpLmdldFVSSSgpO1xuXG5cdFx0XHQvLyBBbGxvdyB1c2FnZSBvZiB0aGUgYmFzZV91cmkgd2hlbiByZWxhdGl2ZV91cmxzID0gdHJ1ZVxuXHRcdFx0aWYgKHR1ID09IHV1IHx8ICh0dS5jaGFyQXQodHUubGVuZ3RoIC0gMSkgPT0gXCIvXCIgJiYgdHUuc3Vic3RyKDAsIHR1Lmxlbmd0aCAtIDEpID09IHV1KSkge1xuXHRcdFx0XHRyZXR1cm4gdHU7XG5cdFx0XHR9XG5cblx0XHRcdG91dHB1dCA9IHNlbGYudG9SZWxQYXRoKHNlbGYucGF0aCwgdXJpLnBhdGgpO1xuXG5cdFx0XHQvLyBBZGQgcXVlcnlcblx0XHRcdGlmICh1cmkucXVlcnkpIHtcblx0XHRcdFx0b3V0cHV0ICs9ICc/JyArIHVyaS5xdWVyeTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gQWRkIGFuY2hvclxuXHRcdFx0aWYgKHVyaS5hbmNob3IpIHtcblx0XHRcdFx0b3V0cHV0ICs9ICcjJyArIHVyaS5hbmNob3I7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBvdXRwdXQ7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIENvbnZlcnRzIHRoZSBzcGVjaWZpZWQgVVJJIGludG8gYSBhYnNvbHV0ZSBVUkkgYmFzZWQgb24gdGhlIGN1cnJlbnQgVVJJIGluc3RhbmNlIGxvY2F0aW9uLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCB0b0Fic29sdXRlXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IHVyaSBVUkkgdG8gY29udmVydCBpbnRvIGEgcmVsYXRpdmUgcGF0aC9VUkkuXG5cdFx0ICogQHBhcmFtIHtCb29sZWFufSBub0hvc3QgTm8gaG9zdCBhbmQgcHJvdG9jb2wgcHJlZml4LlxuXHRcdCAqIEByZXR1cm4ge1N0cmluZ30gQWJzb2x1dGUgVVJJIGZyb20gdGhlIHBvaW50IHNwZWNpZmllZCBpbiB0aGUgY3VycmVudCBVUkkgaW5zdGFuY2UuXG5cdFx0ICogQGV4YW1wbGVcblx0XHQgKiAvLyBDb252ZXJ0cyBhbiByZWxhdGl2ZSBVUkwgdG8gYW4gYWJzb2x1dGUgVVJMIHVybCB3aWxsIGJlIGh0dHA6Ly93d3cuc2l0ZS5jb20vZGlyL3NvbWVkaXIvc29tZWZpbGUuaHRtXG5cdFx0ICogdmFyIHVybCA9IG5ldyB0aW55bWNlLnV0aWwuVVJJKCdodHRwOi8vd3d3LnNpdGUuY29tL2Rpci8nKS50b0Fic29sdXRlKCdzb21lZGlyL3NvbWVmaWxlLmh0bScpO1xuXHRcdCAqL1xuXHRcdHRvQWJzb2x1dGU6IGZ1bmN0aW9uKHVyaSwgbm9Ib3N0KSB7XG5cdFx0XHR1cmkgPSBuZXcgVVJJKHVyaSwge2Jhc2VfdXJpOiB0aGlzfSk7XG5cblx0XHRcdHJldHVybiB1cmkuZ2V0VVJJKG5vSG9zdCAmJiB0aGlzLmlzU2FtZU9yaWdpbih1cmkpKTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogRGV0ZXJtaW5lIHdoZXRoZXIgdGhlIGdpdmVuIFVSSSBoYXMgdGhlIHNhbWUgb3JpZ2luIGFzIHRoaXMgVVJJLiAgQmFzZWQgb24gUkZDLTY0NTQuXG5cdFx0ICogU3VwcG9ydHMgZGVmYXVsdCBwb3J0cyBmb3IgcHJvdG9jb2xzIGxpc3RlZCBpbiBERUZBVUxUX1BPUlRTLiAgVW5zdXBwb3J0ZWQgcHJvdG9jb2xzIHdpbGwgZmFpbCBzYWZlOiB0aGV5XG5cdFx0ICogd29uJ3QgbWF0Y2gsIGlmIHRoZSBwb3J0IHNwZWNpZmljYXRpb25zIGRpZmZlci5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgaXNTYW1lT3JpZ2luXG5cdFx0ICogQHBhcmFtIHt0aW55bWNlLnV0aWwuVVJJfSB1cmkgVXJpIGluc3RhbmNlIHRvIGNvbXBhcmUuXG5cdFx0ICogQHJldHVybnMge0Jvb2xlYW59IFRydWUgaWYgdGhlIG9yaWdpbnMgYXJlIHRoZSBzYW1lLlxuXHRcdCAqL1xuXHRcdGlzU2FtZU9yaWdpbjogZnVuY3Rpb24odXJpKSB7XG5cdFx0XHRpZiAodGhpcy5ob3N0ID09IHVyaS5ob3N0ICYmIHRoaXMucHJvdG9jb2wgPT0gdXJpLnByb3RvY29sKSB7XG5cdFx0XHRcdGlmICh0aGlzLnBvcnQgPT0gdXJpLnBvcnQpIHtcblx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHZhciBkZWZhdWx0UG9ydCA9IERFRkFVTFRfUE9SVFNbdGhpcy5wcm90b2NvbF07XG5cdFx0XHRcdGlmIChkZWZhdWx0UG9ydCAmJiAoKHRoaXMucG9ydCB8fCBkZWZhdWx0UG9ydCkgPT0gKHVyaS5wb3J0IHx8IGRlZmF1bHRQb3J0KSkpIHtcblx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIENvbnZlcnRzIGEgYWJzb2x1dGUgcGF0aCBpbnRvIGEgcmVsYXRpdmUgcGF0aC5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgdG9SZWxQYXRoXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IGJhc2UgQmFzZSBwb2ludCB0byBjb252ZXJ0IHRoZSBwYXRoIGZyb20uXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IHBhdGggQWJzb2x1dGUgcGF0aCB0byBjb252ZXJ0IGludG8gYSByZWxhdGl2ZSBwYXRoLlxuXHRcdCAqL1xuXHRcdHRvUmVsUGF0aDogZnVuY3Rpb24oYmFzZSwgcGF0aCkge1xuXHRcdFx0dmFyIGl0ZW1zLCBicmVha1BvaW50ID0gMCwgb3V0ID0gJycsIGksIGw7XG5cblx0XHRcdC8vIFNwbGl0IHRoZSBwYXRoc1xuXHRcdFx0YmFzZSA9IGJhc2Uuc3Vic3RyaW5nKDAsIGJhc2UubGFzdEluZGV4T2YoJy8nKSk7XG5cdFx0XHRiYXNlID0gYmFzZS5zcGxpdCgnLycpO1xuXHRcdFx0aXRlbXMgPSBwYXRoLnNwbGl0KCcvJyk7XG5cblx0XHRcdGlmIChiYXNlLmxlbmd0aCA+PSBpdGVtcy5sZW5ndGgpIHtcblx0XHRcdFx0Zm9yIChpID0gMCwgbCA9IGJhc2UubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG5cdFx0XHRcdFx0aWYgKGkgPj0gaXRlbXMubGVuZ3RoIHx8IGJhc2VbaV0gIT0gaXRlbXNbaV0pIHtcblx0XHRcdFx0XHRcdGJyZWFrUG9pbnQgPSBpICsgMTtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYmFzZS5sZW5ndGggPCBpdGVtcy5sZW5ndGgpIHtcblx0XHRcdFx0Zm9yIChpID0gMCwgbCA9IGl0ZW1zLmxlbmd0aDsgaSA8IGw7IGkrKykge1xuXHRcdFx0XHRcdGlmIChpID49IGJhc2UubGVuZ3RoIHx8IGJhc2VbaV0gIT0gaXRlbXNbaV0pIHtcblx0XHRcdFx0XHRcdGJyZWFrUG9pbnQgPSBpICsgMTtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYnJlYWtQb2ludCA9PT0gMSkge1xuXHRcdFx0XHRyZXR1cm4gcGF0aDtcblx0XHRcdH1cblxuXHRcdFx0Zm9yIChpID0gMCwgbCA9IGJhc2UubGVuZ3RoIC0gKGJyZWFrUG9pbnQgLSAxKTsgaSA8IGw7IGkrKykge1xuXHRcdFx0XHRvdXQgKz0gXCIuLi9cIjtcblx0XHRcdH1cblxuXHRcdFx0Zm9yIChpID0gYnJlYWtQb2ludCAtIDEsIGwgPSBpdGVtcy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcblx0XHRcdFx0aWYgKGkgIT0gYnJlYWtQb2ludCAtIDEpIHtcblx0XHRcdFx0XHRvdXQgKz0gXCIvXCIgKyBpdGVtc1tpXTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvdXQgKz0gaXRlbXNbaV07XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG91dDtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogQ29udmVydHMgYSByZWxhdGl2ZSBwYXRoIGludG8gYSBhYnNvbHV0ZSBwYXRoLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCB0b0Fic1BhdGhcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gYmFzZSBCYXNlIHBvaW50IHRvIGNvbnZlcnQgdGhlIHBhdGggZnJvbS5cblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gcGF0aCBSZWxhdGl2ZSBwYXRoIHRvIGNvbnZlcnQgaW50byBhbiBhYnNvbHV0ZSBwYXRoLlxuXHRcdCAqL1xuXHRcdHRvQWJzUGF0aDogZnVuY3Rpb24oYmFzZSwgcGF0aCkge1xuXHRcdFx0dmFyIGksIG5iID0gMCwgbyA9IFtdLCB0ciwgb3V0UGF0aDtcblxuXHRcdFx0Ly8gU3BsaXQgcGF0aHNcblx0XHRcdHRyID0gL1xcLyQvLnRlc3QocGF0aCkgPyAnLycgOiAnJztcblx0XHRcdGJhc2UgPSBiYXNlLnNwbGl0KCcvJyk7XG5cdFx0XHRwYXRoID0gcGF0aC5zcGxpdCgnLycpO1xuXG5cdFx0XHQvLyBSZW1vdmUgZW1wdHkgY2h1bmtzXG5cdFx0XHRlYWNoKGJhc2UsIGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0aWYgKGspIHtcblx0XHRcdFx0XHRvLnB1c2goayk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRiYXNlID0gbztcblxuXHRcdFx0Ly8gTWVyZ2UgcmVsVVJMUGFydHMgY2h1bmtzXG5cdFx0XHRmb3IgKGkgPSBwYXRoLmxlbmd0aCAtIDEsIG8gPSBbXTsgaSA+PSAwOyBpLS0pIHtcblx0XHRcdFx0Ly8gSWdub3JlIGVtcHR5IG9yIC5cblx0XHRcdFx0aWYgKHBhdGhbaV0ubGVuZ3RoID09PSAwIHx8IHBhdGhbaV0gPT09IFwiLlwiKSB7XG5cdFx0XHRcdFx0Y29udGludWU7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBJcyBwYXJlbnRcblx0XHRcdFx0aWYgKHBhdGhbaV0gPT09ICcuLicpIHtcblx0XHRcdFx0XHRuYisrO1xuXHRcdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gTW92ZSB1cFxuXHRcdFx0XHRpZiAobmIgPiAwKSB7XG5cdFx0XHRcdFx0bmItLTtcblx0XHRcdFx0XHRjb250aW51ZTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdG8ucHVzaChwYXRoW2ldKTtcblx0XHRcdH1cblxuXHRcdFx0aSA9IGJhc2UubGVuZ3RoIC0gbmI7XG5cblx0XHRcdC8vIElmIC9hL2IvYyBvciAvXG5cdFx0XHRpZiAoaSA8PSAwKSB7XG5cdFx0XHRcdG91dFBhdGggPSBvLnJldmVyc2UoKS5qb2luKCcvJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRvdXRQYXRoID0gYmFzZS5zbGljZSgwLCBpKS5qb2luKCcvJykgKyAnLycgKyBvLnJldmVyc2UoKS5qb2luKCcvJyk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIEFkZCBmcm9udCAvIGlmIGl0J3MgbmVlZGVkXG5cdFx0XHRpZiAob3V0UGF0aC5pbmRleE9mKCcvJykgIT09IDApIHtcblx0XHRcdFx0b3V0UGF0aCA9ICcvJyArIG91dFBhdGg7XG5cdFx0XHR9XG5cblx0XHRcdC8vIEFkZCB0cmFsaW5nIC8gaWYgaXQncyBuZWVkZWRcblx0XHRcdGlmICh0ciAmJiBvdXRQYXRoLmxhc3RJbmRleE9mKCcvJykgIT09IG91dFBhdGgubGVuZ3RoIC0gMSkge1xuXHRcdFx0XHRvdXRQYXRoICs9IHRyO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gb3V0UGF0aDtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyB0aGUgZnVsbCBVUkkgb2YgdGhlIGludGVybmFsIHN0cnVjdHVyZS5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgZ2V0VVJJXG5cdFx0ICogQHBhcmFtIHtCb29sZWFufSBub1Byb3RvSG9zdCBPcHRpb25hbCBubyBob3N0IGFuZCBwcm90b2NvbCBwYXJ0LiBEZWZhdWx0cyB0byBmYWxzZS5cblx0XHQgKi9cblx0XHRnZXRVUkk6IGZ1bmN0aW9uKG5vUHJvdG9Ib3N0KSB7XG5cdFx0XHR2YXIgcywgc2VsZiA9IHRoaXM7XG5cblx0XHRcdC8vIFJlYnVpbGQgc291cmNlXG5cdFx0XHRpZiAoIXNlbGYuc291cmNlIHx8IG5vUHJvdG9Ib3N0KSB7XG5cdFx0XHRcdHMgPSAnJztcblxuXHRcdFx0XHRpZiAoIW5vUHJvdG9Ib3N0KSB7XG5cdFx0XHRcdFx0aWYgKHNlbGYucHJvdG9jb2wpIHtcblx0XHRcdFx0XHRcdHMgKz0gc2VsZi5wcm90b2NvbCArICc6Ly8nO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRzICs9ICcvLyc7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHNlbGYudXNlckluZm8pIHtcblx0XHRcdFx0XHRcdHMgKz0gc2VsZi51c2VySW5mbyArICdAJztcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoc2VsZi5ob3N0KSB7XG5cdFx0XHRcdFx0XHRzICs9IHNlbGYuaG9zdDtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoc2VsZi5wb3J0KSB7XG5cdFx0XHRcdFx0XHRzICs9ICc6JyArIHNlbGYucG9ydDtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoc2VsZi5wYXRoKSB7XG5cdFx0XHRcdFx0cyArPSBzZWxmLnBhdGg7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoc2VsZi5xdWVyeSkge1xuXHRcdFx0XHRcdHMgKz0gJz8nICsgc2VsZi5xdWVyeTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChzZWxmLmFuY2hvcikge1xuXHRcdFx0XHRcdHMgKz0gJyMnICsgc2VsZi5hbmNob3I7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRzZWxmLnNvdXJjZSA9IHM7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBzZWxmLnNvdXJjZTtcblx0XHR9XG5cdH07XG5cblx0VVJJLnBhcnNlRGF0YVVyaSA9IGZ1bmN0aW9uKHVyaSkge1xuXHRcdHZhciB0eXBlLCBtYXRjaGVzO1xuXG5cdFx0dXJpID0gZGVjb2RlVVJJQ29tcG9uZW50KHVyaSkuc3BsaXQoJywnKTtcblxuXHRcdG1hdGNoZXMgPSAvZGF0YTooW147XSspLy5leGVjKHVyaVswXSk7XG5cdFx0aWYgKG1hdGNoZXMpIHtcblx0XHRcdHR5cGUgPSBtYXRjaGVzWzFdO1xuXHRcdH1cblxuXHRcdHJldHVybiB7XG5cdFx0XHR0eXBlOiB0eXBlLFxuXHRcdFx0ZGF0YTogdXJpWzFdXG5cdFx0fTtcblx0fTtcblxuXHRVUkkuZ2V0RG9jdW1lbnRCYXNlVXJsID0gZnVuY3Rpb24obG9jKSB7XG5cdFx0dmFyIGJhc2VVcmw7XG5cblx0XHQvLyBQYXNzIGFwcGxld2ViZGF0YTovLyBhbmQgb3RoZXIgbm9uIHdlYiBwcm90b2NvbHMgdGhvdWdoXG5cdFx0aWYgKGxvYy5wcm90b2NvbC5pbmRleE9mKCdodHRwJykgIT09IDAgJiYgbG9jLnByb3RvY29sICE9PSAnZmlsZTonKSB7XG5cdFx0XHRiYXNlVXJsID0gbG9jLmhyZWY7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGJhc2VVcmwgPSBsb2MucHJvdG9jb2wgKyAnLy8nICsgbG9jLmhvc3QgKyBsb2MucGF0aG5hbWU7XG5cdFx0fVxuXG5cdFx0aWYgKC9eW146XSs6XFwvXFwvXFwvP1teXFwvXStcXC8vLnRlc3QoYmFzZVVybCkpIHtcblx0XHRcdGJhc2VVcmwgPSBiYXNlVXJsLnJlcGxhY2UoL1tcXD8jXS4qJC8sICcnKS5yZXBsYWNlKC9bXFwvXFxcXF1bXlxcL10rJC8sICcnKTtcblxuXHRcdFx0aWYgKCEvW1xcL1xcXFxdJC8udGVzdChiYXNlVXJsKSkge1xuXHRcdFx0XHRiYXNlVXJsICs9ICcvJztcblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gYmFzZVVybDtcblx0fTtcblxuXHRyZXR1cm4gVVJJO1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy91dGlsL0NsYXNzLmpzXG5cbi8qKlxuICogQ2xhc3MuanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBUaGlzIHV0aWxpdGl5IGNsYXNzIGlzIHVzZWQgZm9yIGVhc2llciBpbmhlcml0YW5jZS5cbiAqXG4gKiBGZWF0dXJlczpcbiAqICogRXhwb3NlZCBzdXBlciBmdW5jdGlvbnM6IHRoaXMuX3N1cGVyKCk7XG4gKiAqIE1peGluc1xuICogKiBEdW1teSBmdW5jdGlvbnNcbiAqICogUHJvcGVydHkgZnVuY3Rpb25zOiB2YXIgdmFsdWUgPSBvYmplY3QudmFsdWUoKTsgYW5kIG9iamVjdC52YWx1ZShuZXdWYWx1ZSk7XG4gKiAqIFN0YXRpYyBmdW5jdGlvbnNcbiAqICogRGVmYXVsdHMgc2V0dGluZ3NcbiAqL1xuZGVmaW5lKFwidGlueW1jZS91dGlsL0NsYXNzXCIsIFtcblx0XCJ0aW55bWNlL3V0aWwvVG9vbHNcIlxuXSwgZnVuY3Rpb24oVG9vbHMpIHtcblx0dmFyIGVhY2ggPSBUb29scy5lYWNoLCBleHRlbmQgPSBUb29scy5leHRlbmQ7XG5cblx0dmFyIGV4dGVuZENsYXNzLCBpbml0aWFsaXppbmc7XG5cblx0ZnVuY3Rpb24gQ2xhc3MoKSB7XG5cdH1cblxuXHQvLyBQcm92aWRlcyBjbGFzc2ljYWwgaW5oZXJpdGFuY2UsIGJhc2VkIG9uIGNvZGUgbWFkZSBieSBKb2huIFJlc2lnXG5cdENsYXNzLmV4dGVuZCA9IGV4dGVuZENsYXNzID0gZnVuY3Rpb24ocHJvcCkge1xuXHRcdHZhciBzZWxmID0gdGhpcywgX3N1cGVyID0gc2VsZi5wcm90b3R5cGUsIHByb3RvdHlwZSwgbmFtZSwgbWVtYmVyO1xuXG5cdFx0Ly8gVGhlIGR1bW15IGNsYXNzIGNvbnN0cnVjdG9yXG5cdFx0ZnVuY3Rpb24gQ2xhc3MoKSB7XG5cdFx0XHR2YXIgaSwgbWl4aW5zLCBtaXhpbiwgc2VsZiA9IHRoaXM7XG5cblx0XHRcdC8vIEFsbCBjb25zdHJ1Y3Rpb24gaXMgYWN0dWFsbHkgZG9uZSBpbiB0aGUgaW5pdCBtZXRob2Rcblx0XHRcdGlmICghaW5pdGlhbGl6aW5nKSB7XG5cdFx0XHRcdC8vIFJ1biBjbGFzcyBjb25zdHVjdG9yXG5cdFx0XHRcdGlmIChzZWxmLmluaXQpIHtcblx0XHRcdFx0XHRzZWxmLmluaXQuYXBwbHkoc2VsZiwgYXJndW1lbnRzKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIFJ1biBtaXhpbiBjb25zdHJ1Y3RvcnNcblx0XHRcdFx0bWl4aW5zID0gc2VsZi5NaXhpbnM7XG5cdFx0XHRcdGlmIChtaXhpbnMpIHtcblx0XHRcdFx0XHRpID0gbWl4aW5zLmxlbmd0aDtcblx0XHRcdFx0XHR3aGlsZSAoaS0tKSB7XG5cdFx0XHRcdFx0XHRtaXhpbiA9IG1peGluc1tpXTtcblx0XHRcdFx0XHRcdGlmIChtaXhpbi5pbml0KSB7XG5cdFx0XHRcdFx0XHRcdG1peGluLmluaXQuYXBwbHkoc2VsZiwgYXJndW1lbnRzKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHQvLyBEdW1teSBmdW5jdGlvbiwgbmVlZHMgdG8gYmUgZXh0ZW5kZWQgaW4gb3JkZXIgdG8gcHJvdmlkZSBmdW5jdGlvbmFsaXR5XG5cdFx0ZnVuY3Rpb24gZHVtbXkoKSB7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQvLyBDcmVhdGVzIGEgb3ZlcmxvYWRlZCBtZXRob2QgZm9yIHRoZSBjbGFzc1xuXHRcdC8vIHRoaXMgZW5hYmxlcyB5b3UgdG8gdXNlIHRoaXMuX3N1cGVyKCk7IHRvIGNhbGwgdGhlIHN1cGVyIGZ1bmN0aW9uXG5cdFx0ZnVuY3Rpb24gY3JlYXRlTWV0aG9kKG5hbWUsIGZuKSB7XG5cdFx0XHRyZXR1cm4gZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHZhciBzZWxmID0gdGhpcywgdG1wID0gc2VsZi5fc3VwZXIsIHJldDtcblxuXHRcdFx0XHRzZWxmLl9zdXBlciA9IF9zdXBlcltuYW1lXTtcblx0XHRcdFx0cmV0ID0gZm4uYXBwbHkoc2VsZiwgYXJndW1lbnRzKTtcblx0XHRcdFx0c2VsZi5fc3VwZXIgPSB0bXA7XG5cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH07XG5cdFx0fVxuXG5cdFx0Ly8gSW5zdGFudGlhdGUgYSBiYXNlIGNsYXNzIChidXQgb25seSBjcmVhdGUgdGhlIGluc3RhbmNlLFxuXHRcdC8vIGRvbid0IHJ1biB0aGUgaW5pdCBjb25zdHJ1Y3Rvcilcblx0XHRpbml0aWFsaXppbmcgPSB0cnVlO1xuXG5cdFx0Lyplc2xpbnQgbmV3LWNhcDowICovXG5cdFx0cHJvdG90eXBlID0gbmV3IHNlbGYoKTtcblx0XHRpbml0aWFsaXppbmcgPSBmYWxzZTtcblxuXHRcdC8vIEFkZCBtaXhpbnNcblx0XHRpZiAocHJvcC5NaXhpbnMpIHtcblx0XHRcdGVhY2gocHJvcC5NaXhpbnMsIGZ1bmN0aW9uKG1peGluKSB7XG5cdFx0XHRcdGZvciAodmFyIG5hbWUgaW4gbWl4aW4pIHtcblx0XHRcdFx0XHRpZiAobmFtZSAhPT0gXCJpbml0XCIpIHtcblx0XHRcdFx0XHRcdHByb3BbbmFtZV0gPSBtaXhpbltuYW1lXTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRpZiAoX3N1cGVyLk1peGlucykge1xuXHRcdFx0XHRwcm9wLk1peGlucyA9IF9zdXBlci5NaXhpbnMuY29uY2F0KHByb3AuTWl4aW5zKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHQvLyBHZW5lcmF0ZSBkdW1teSBtZXRob2RzXG5cdFx0aWYgKHByb3AuTWV0aG9kcykge1xuXHRcdFx0ZWFjaChwcm9wLk1ldGhvZHMuc3BsaXQoJywnKSwgZnVuY3Rpb24obmFtZSkge1xuXHRcdFx0XHRwcm9wW25hbWVdID0gZHVtbXk7XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHQvLyBHZW5lcmF0ZSBwcm9wZXJ0eSBtZXRob2RzXG5cdFx0aWYgKHByb3AuUHJvcGVydGllcykge1xuXHRcdFx0ZWFjaChwcm9wLlByb3BlcnRpZXMuc3BsaXQoJywnKSwgZnVuY3Rpb24obmFtZSkge1xuXHRcdFx0XHR2YXIgZmllbGROYW1lID0gJ18nICsgbmFtZTtcblxuXHRcdFx0XHRwcm9wW25hbWVdID0gZnVuY3Rpb24odmFsdWUpIHtcblx0XHRcdFx0XHR2YXIgc2VsZiA9IHRoaXMsIHVuZGVmO1xuXG5cdFx0XHRcdFx0Ly8gU2V0IHZhbHVlXG5cdFx0XHRcdFx0aWYgKHZhbHVlICE9PSB1bmRlZikge1xuXHRcdFx0XHRcdFx0c2VsZltmaWVsZE5hbWVdID0gdmFsdWU7XG5cblx0XHRcdFx0XHRcdHJldHVybiBzZWxmO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdC8vIEdldCB2YWx1ZVxuXHRcdFx0XHRcdHJldHVybiBzZWxmW2ZpZWxkTmFtZV07XG5cdFx0XHRcdH07XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHQvLyBTdGF0aWMgZnVuY3Rpb25zXG5cdFx0aWYgKHByb3AuU3RhdGljcykge1xuXHRcdFx0ZWFjaChwcm9wLlN0YXRpY3MsIGZ1bmN0aW9uKGZ1bmMsIG5hbWUpIHtcblx0XHRcdFx0Q2xhc3NbbmFtZV0gPSBmdW5jO1xuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0Ly8gRGVmYXVsdCBzZXR0aW5nc1xuXHRcdGlmIChwcm9wLkRlZmF1bHRzICYmIF9zdXBlci5EZWZhdWx0cykge1xuXHRcdFx0cHJvcC5EZWZhdWx0cyA9IGV4dGVuZCh7fSwgX3N1cGVyLkRlZmF1bHRzLCBwcm9wLkRlZmF1bHRzKTtcblx0XHR9XG5cblx0XHQvLyBDb3B5IHRoZSBwcm9wZXJ0aWVzIG92ZXIgb250byB0aGUgbmV3IHByb3RvdHlwZVxuXHRcdGZvciAobmFtZSBpbiBwcm9wKSB7XG5cdFx0XHRtZW1iZXIgPSBwcm9wW25hbWVdO1xuXG5cdFx0XHRpZiAodHlwZW9mIG1lbWJlciA9PSBcImZ1bmN0aW9uXCIgJiYgX3N1cGVyW25hbWVdKSB7XG5cdFx0XHRcdHByb3RvdHlwZVtuYW1lXSA9IGNyZWF0ZU1ldGhvZChuYW1lLCBtZW1iZXIpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0cHJvdG90eXBlW25hbWVdID0gbWVtYmVyO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8vIFBvcHVsYXRlIG91ciBjb25zdHJ1Y3RlZCBwcm90b3R5cGUgb2JqZWN0XG5cdFx0Q2xhc3MucHJvdG90eXBlID0gcHJvdG90eXBlO1xuXG5cdFx0Ly8gRW5mb3JjZSB0aGUgY29uc3RydWN0b3IgdG8gYmUgd2hhdCB3ZSBleHBlY3Rcblx0XHRDbGFzcy5jb25zdHJ1Y3RvciA9IENsYXNzO1xuXG5cdFx0Ly8gQW5kIG1ha2UgdGhpcyBjbGFzcyBleHRlbmRpYmxlXG5cdFx0Q2xhc3MuZXh0ZW5kID0gZXh0ZW5kQ2xhc3M7XG5cblx0XHRyZXR1cm4gQ2xhc3M7XG5cdH07XG5cblx0cmV0dXJuIENsYXNzO1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy91dGlsL0V2ZW50RGlzcGF0Y2hlci5qc1xuXG4vKipcbiAqIEV2ZW50RGlzcGF0Y2hlci5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE1IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKipcbiAqIFRoaXMgY2xhc3MgbGV0cyB5b3UgYWRkL3JlbW92ZSBhbmQgZmlyZSBldmVudHMgYnkgbmFtZSBvbiB0aGUgc3BlY2lmaWVkIHNjb3BlLiBUaGlzIG1ha2VzXG4gKiBpdCBlYXN5IHRvIGFkZCBldmVudCBsaXN0ZW5lciBsb2dpYyB0byBhbnkgY2xhc3MuXG4gKlxuICogQGNsYXNzIHRpbnltY2UudXRpbC5FdmVudERpc3BhdGNoZXJcbiAqIEBleGFtcGxlXG4gKiAgdmFyIGV2ZW50RGlzcGF0Y2hlciA9IG5ldyBFdmVudERpc3BhdGNoZXIoKTtcbiAqXG4gKiAgZXZlbnREaXNwYXRjaGVyLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge2NvbnNvbGUubG9nKCdkYXRhJyk7fSk7XG4gKiAgZXZlbnREaXNwYXRjaGVyLmZpcmUoJ2NsaWNrJywge2RhdGE6IDEyM30pO1xuICovXG5kZWZpbmUoXCJ0aW55bWNlL3V0aWwvRXZlbnREaXNwYXRjaGVyXCIsIFtcblx0XCJ0aW55bWNlL3V0aWwvVG9vbHNcIlxuXSwgZnVuY3Rpb24oVG9vbHMpIHtcblx0dmFyIG5hdGl2ZUV2ZW50cyA9IFRvb2xzLm1ha2VNYXAoXG5cdFx0XCJmb2N1cyBibHVyIGZvY3VzaW4gZm9jdXNvdXQgY2xpY2sgZGJsY2xpY2sgbW91c2Vkb3duIG1vdXNldXAgbW91c2Vtb3ZlIG1vdXNlb3ZlciBiZWZvcmVwYXN0ZSBwYXN0ZSBjdXQgY29weSBzZWxlY3Rpb25jaGFuZ2UgXCIgK1xuXHRcdFwibW91c2VvdXQgbW91c2VlbnRlciBtb3VzZWxlYXZlIHdoZWVsIGtleWRvd24ga2V5cHJlc3Mga2V5dXAgaW5wdXQgY29udGV4dG1lbnUgZHJhZ3N0YXJ0IGRyYWdlbmQgZHJhZ292ZXIgXCIgK1xuXHRcdFwiZHJhZ2dlc3R1cmUgZHJhZ2Ryb3AgZHJvcCBkcmFnIHN1Ym1pdCBcIiArXG5cdFx0XCJjb21wb3NpdGlvbnN0YXJ0IGNvbXBvc2l0aW9uZW5kIGNvbXBvc2l0aW9udXBkYXRlIHRvdWNoc3RhcnQgdG91Y2htb3ZlIHRvdWNoZW5kXCIsXG5cdFx0JyAnXG5cdCk7XG5cblx0ZnVuY3Rpb24gRGlzcGF0Y2hlcihzZXR0aW5ncykge1xuXHRcdHZhciBzZWxmID0gdGhpcywgc2NvcGUsIGJpbmRpbmdzID0ge30sIHRvZ2dsZUV2ZW50O1xuXG5cdFx0ZnVuY3Rpb24gcmV0dXJuRmFsc2UoKSB7XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gcmV0dXJuVHJ1ZSgpIHtcblx0XHRcdHJldHVybiB0cnVlO1xuXHRcdH1cblxuXHRcdHNldHRpbmdzID0gc2V0dGluZ3MgfHwge307XG5cdFx0c2NvcGUgPSBzZXR0aW5ncy5zY29wZSB8fCBzZWxmO1xuXHRcdHRvZ2dsZUV2ZW50ID0gc2V0dGluZ3MudG9nZ2xlRXZlbnQgfHwgcmV0dXJuRmFsc2U7XG5cblx0XHQvKipcblx0XHQgKiBGaXJlcyB0aGUgc3BlY2lmaWVkIGV2ZW50IGJ5IG5hbWUuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGZpcmVcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSBOYW1lIG9mIHRoZSBldmVudCB0byBmaXJlLlxuXHRcdCAqIEBwYXJhbSB7T2JqZWN0P30gYXJncyBFdmVudCBhcmd1bWVudHMuXG5cdFx0ICogQHJldHVybiB7T2JqZWN0fSBFdmVudCBhcmdzIGluc3RhbmNlIHBhc3NlZCBpbi5cblx0XHQgKiBAZXhhbXBsZVxuXHRcdCAqIGluc3RhbmNlLmZpcmUoJ2V2ZW50Jywgey4uLn0pO1xuXHRcdCAqL1xuXHRcdGZ1bmN0aW9uIGZpcmUobmFtZSwgYXJncykge1xuXHRcdFx0dmFyIGhhbmRsZXJzLCBpLCBsLCBjYWxsYmFjaztcblxuXHRcdFx0bmFtZSA9IG5hbWUudG9Mb3dlckNhc2UoKTtcblx0XHRcdGFyZ3MgPSBhcmdzIHx8IHt9O1xuXHRcdFx0YXJncy50eXBlID0gbmFtZTtcblxuXHRcdFx0Ly8gU2V0dXAgdGFyZ2V0IGlzIHRoZXJlIGlzbid0IG9uZVxuXHRcdFx0aWYgKCFhcmdzLnRhcmdldCkge1xuXHRcdFx0XHRhcmdzLnRhcmdldCA9IHNjb3BlO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBBZGQgZXZlbnQgZGVsZWdhdGlvbiBtZXRob2RzIGlmIHRoZXkgYXJlIG1pc3Npbmdcblx0XHRcdGlmICghYXJncy5wcmV2ZW50RGVmYXVsdCkge1xuXHRcdFx0XHQvLyBBZGQgcHJldmVudERlZmF1bHQgbWV0aG9kXG5cdFx0XHRcdGFyZ3MucHJldmVudERlZmF1bHQgPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRhcmdzLmlzRGVmYXVsdFByZXZlbnRlZCA9IHJldHVyblRydWU7XG5cdFx0XHRcdH07XG5cblx0XHRcdFx0Ly8gQWRkIHN0b3BQcm9wYWdhdGlvblxuXHRcdFx0XHRhcmdzLnN0b3BQcm9wYWdhdGlvbiA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdGFyZ3MuaXNQcm9wYWdhdGlvblN0b3BwZWQgPSByZXR1cm5UcnVlO1xuXHRcdFx0XHR9O1xuXG5cdFx0XHRcdC8vIEFkZCBzdG9wSW1tZWRpYXRlUHJvcGFnYXRpb25cblx0XHRcdFx0YXJncy5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24gPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRhcmdzLmlzSW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkID0gcmV0dXJuVHJ1ZTtcblx0XHRcdFx0fTtcblxuXHRcdFx0XHQvLyBBZGQgZXZlbnQgZGVsZWdhdGlvbiBzdGF0ZXNcblx0XHRcdFx0YXJncy5pc0RlZmF1bHRQcmV2ZW50ZWQgPSByZXR1cm5GYWxzZTtcblx0XHRcdFx0YXJncy5pc1Byb3BhZ2F0aW9uU3RvcHBlZCA9IHJldHVybkZhbHNlO1xuXHRcdFx0XHRhcmdzLmlzSW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkID0gcmV0dXJuRmFsc2U7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChzZXR0aW5ncy5iZWZvcmVGaXJlKSB7XG5cdFx0XHRcdHNldHRpbmdzLmJlZm9yZUZpcmUoYXJncyk7XG5cdFx0XHR9XG5cblx0XHRcdGhhbmRsZXJzID0gYmluZGluZ3NbbmFtZV07XG5cdFx0XHRpZiAoaGFuZGxlcnMpIHtcblx0XHRcdFx0Zm9yIChpID0gMCwgbCA9IGhhbmRsZXJzLmxlbmd0aDsgaSA8IGw7IGkrKykge1xuXHRcdFx0XHRcdGNhbGxiYWNrID0gaGFuZGxlcnNbaV07XG5cblx0XHRcdFx0XHQvLyBVbmJpbmQgaGFuZGxlcnMgbWFya2VkIHdpdGggXCJvbmNlXCJcblx0XHRcdFx0XHRpZiAoY2FsbGJhY2sub25jZSkge1xuXHRcdFx0XHRcdFx0b2ZmKG5hbWUsIGNhbGxiYWNrLmZ1bmMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdC8vIFN0b3AgaW1tZWRpYXRlIHByb3BhZ2F0aW9uIGlmIG5lZWRlZFxuXHRcdFx0XHRcdGlmIChhcmdzLmlzSW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkKCkpIHtcblx0XHRcdFx0XHRcdGFyZ3Muc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdFx0XHRyZXR1cm4gYXJncztcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHQvLyBJZiBjYWxsYmFjayByZXR1cm5zIGZhbHNlIHRoZW4gcHJldmVudCBkZWZhdWx0IGFuZCBzdG9wIGFsbCBwcm9wYWdhdGlvblxuXHRcdFx0XHRcdGlmIChjYWxsYmFjay5mdW5jLmNhbGwoc2NvcGUsIGFyZ3MpID09PSBmYWxzZSkge1xuXHRcdFx0XHRcdFx0YXJncy5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIGFyZ3M7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBhcmdzO1xuXHRcdH1cblxuXHRcdC8qKlxuXHRcdCAqIEJpbmRzIGFuIGV2ZW50IGxpc3RlbmVyIHRvIGEgc3BlY2lmaWMgZXZlbnQgYnkgbmFtZS5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2Qgb25cblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSBFdmVudCBuYW1lIG9yIHNwYWNlIHNlcGFyYXRlZCBsaXN0IG9mIGV2ZW50cyB0byBiaW5kLlxuXHRcdCAqIEBwYXJhbSB7Y2FsbGJhY2t9IGNhbGxiYWNrIENhbGxiYWNrIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGV2ZW50IG9jY3Vycy5cblx0XHQgKiBAcGFyYW0ge0Jvb2xlYW59IGZpcnN0IE9wdGlvbmFsIGZsYWcgaWYgdGhlIGV2ZW50IHNob3VsZCBiZSBwcmVwZW5kZWQuIFVzZSB0aGlzIHdpdGggY2FyZS5cblx0XHQgKiBAcmV0dXJuIHtPYmplY3R9IEN1cnJlbnQgY2xhc3MgaW5zdGFuY2UuXG5cdFx0ICogQGV4YW1wbGVcblx0XHQgKiBpbnN0YW5jZS5vbignZXZlbnQnLCBmdW5jdGlvbihlKSB7XG5cdFx0ICogICAgIC8vIENhbGxiYWNrIGxvZ2ljXG5cdFx0ICogfSk7XG5cdFx0ICovXG5cdFx0ZnVuY3Rpb24gb24obmFtZSwgY2FsbGJhY2ssIHByZXBlbmQsIGV4dHJhKSB7XG5cdFx0XHR2YXIgaGFuZGxlcnMsIG5hbWVzLCBpO1xuXG5cdFx0XHRpZiAoY2FsbGJhY2sgPT09IGZhbHNlKSB7XG5cdFx0XHRcdGNhbGxiYWNrID0gcmV0dXJuRmFsc2U7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChjYWxsYmFjaykge1xuXHRcdFx0XHRjYWxsYmFjayA9IHtcblx0XHRcdFx0XHRmdW5jOiBjYWxsYmFja1xuXHRcdFx0XHR9O1xuXG5cdFx0XHRcdGlmIChleHRyYSkge1xuXHRcdFx0XHRcdFRvb2xzLmV4dGVuZChjYWxsYmFjaywgZXh0cmEpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0bmFtZXMgPSBuYW1lLnRvTG93ZXJDYXNlKCkuc3BsaXQoJyAnKTtcblx0XHRcdFx0aSA9IG5hbWVzLmxlbmd0aDtcblx0XHRcdFx0d2hpbGUgKGktLSkge1xuXHRcdFx0XHRcdG5hbWUgPSBuYW1lc1tpXTtcblx0XHRcdFx0XHRoYW5kbGVycyA9IGJpbmRpbmdzW25hbWVdO1xuXHRcdFx0XHRcdGlmICghaGFuZGxlcnMpIHtcblx0XHRcdFx0XHRcdGhhbmRsZXJzID0gYmluZGluZ3NbbmFtZV0gPSBbXTtcblx0XHRcdFx0XHRcdHRvZ2dsZUV2ZW50KG5hbWUsIHRydWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmIChwcmVwZW5kKSB7XG5cdFx0XHRcdFx0XHRoYW5kbGVycy51bnNoaWZ0KGNhbGxiYWNrKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0aGFuZGxlcnMucHVzaChjYWxsYmFjayk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBzZWxmO1xuXHRcdH1cblxuXHRcdC8qKlxuXHRcdCAqIFVuYmluZHMgYW4gZXZlbnQgbGlzdGVuZXIgdG8gYSBzcGVjaWZpYyBldmVudCBieSBuYW1lLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBvZmZcblx0XHQgKiBAcGFyYW0ge1N0cmluZz99IG5hbWUgTmFtZSBvZiB0aGUgZXZlbnQgdG8gdW5iaW5kLlxuXHRcdCAqIEBwYXJhbSB7Y2FsbGJhY2s/fSBjYWxsYmFjayBDYWxsYmFjayB0byB1bmJpbmQuXG5cdFx0ICogQHJldHVybiB7T2JqZWN0fSBDdXJyZW50IGNsYXNzIGluc3RhbmNlLlxuXHRcdCAqIEBleGFtcGxlXG5cdFx0ICogLy8gVW5iaW5kIHNwZWNpZmljIGNhbGxiYWNrXG5cdFx0ICogaW5zdGFuY2Uub2ZmKCdldmVudCcsIGhhbmRsZXIpO1xuXHRcdCAqXG5cdFx0ICogLy8gVW5iaW5kIGFsbCBsaXN0ZW5lcnMgYnkgbmFtZVxuXHRcdCAqIGluc3RhbmNlLm9mZignZXZlbnQnKTtcblx0XHQgKlxuXHRcdCAqIC8vIFVuYmluZCBhbGwgZXZlbnRzXG5cdFx0ICogaW5zdGFuY2Uub2ZmKCk7XG5cdFx0ICovXG5cdFx0ZnVuY3Rpb24gb2ZmKG5hbWUsIGNhbGxiYWNrKSB7XG5cdFx0XHR2YXIgaSwgaGFuZGxlcnMsIGJpbmRpbmdOYW1lLCBuYW1lcywgaGk7XG5cblx0XHRcdGlmIChuYW1lKSB7XG5cdFx0XHRcdG5hbWVzID0gbmFtZS50b0xvd2VyQ2FzZSgpLnNwbGl0KCcgJyk7XG5cdFx0XHRcdGkgPSBuYW1lcy5sZW5ndGg7XG5cdFx0XHRcdHdoaWxlIChpLS0pIHtcblx0XHRcdFx0XHRuYW1lID0gbmFtZXNbaV07XG5cdFx0XHRcdFx0aGFuZGxlcnMgPSBiaW5kaW5nc1tuYW1lXTtcblxuXHRcdFx0XHRcdC8vIFVuYmluZCBhbGwgaGFuZGxlcnNcblx0XHRcdFx0XHRpZiAoIW5hbWUpIHtcblx0XHRcdFx0XHRcdGZvciAoYmluZGluZ05hbWUgaW4gYmluZGluZ3MpIHtcblx0XHRcdFx0XHRcdFx0dG9nZ2xlRXZlbnQoYmluZGluZ05hbWUsIGZhbHNlKTtcblx0XHRcdFx0XHRcdFx0ZGVsZXRlIGJpbmRpbmdzW2JpbmRpbmdOYW1lXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHNlbGY7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKGhhbmRsZXJzKSB7XG5cdFx0XHRcdFx0XHQvLyBVbmJpbmQgYWxsIGJ5IG5hbWVcblx0XHRcdFx0XHRcdGlmICghY2FsbGJhY2spIHtcblx0XHRcdFx0XHRcdFx0aGFuZGxlcnMubGVuZ3RoID0gMDtcblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdC8vIFVuYmluZCBzcGVjaWZpYyBvbmVzXG5cdFx0XHRcdFx0XHRcdGhpID0gaGFuZGxlcnMubGVuZ3RoO1xuXHRcdFx0XHRcdFx0XHR3aGlsZSAoaGktLSkge1xuXHRcdFx0XHRcdFx0XHRcdGlmIChoYW5kbGVyc1toaV0uZnVuYyA9PT0gY2FsbGJhY2spIHtcblx0XHRcdFx0XHRcdFx0XHRcdGhhbmRsZXJzID0gaGFuZGxlcnMuc2xpY2UoMCwgaGkpLmNvbmNhdChoYW5kbGVycy5zbGljZShoaSArIDEpKTtcblx0XHRcdFx0XHRcdFx0XHRcdGJpbmRpbmdzW25hbWVdID0gaGFuZGxlcnM7XG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGlmICghaGFuZGxlcnMubGVuZ3RoKSB7XG5cdFx0XHRcdFx0XHRcdHRvZ2dsZUV2ZW50KG5hbWUsIGZhbHNlKTtcblx0XHRcdFx0XHRcdFx0ZGVsZXRlIGJpbmRpbmdzW25hbWVdO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Zm9yIChuYW1lIGluIGJpbmRpbmdzKSB7XG5cdFx0XHRcdFx0dG9nZ2xlRXZlbnQobmFtZSwgZmFsc2UpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0YmluZGluZ3MgPSB7fTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHNlbGY7XG5cdFx0fVxuXG5cdFx0LyoqXG5cdFx0ICogQmluZHMgYW4gZXZlbnQgbGlzdGVuZXIgdG8gYSBzcGVjaWZpYyBldmVudCBieSBuYW1lXG5cdFx0ICogYW5kIGF1dG9tYXRpY2FsbHkgdW5iaW5kIHRoZSBldmVudCBvbmNlIHRoZSBjYWxsYmFjayBmaXJlcy5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2Qgb25jZVxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIEV2ZW50IG5hbWUgb3Igc3BhY2Ugc2VwYXJhdGVkIGxpc3Qgb2YgZXZlbnRzIHRvIGJpbmQuXG5cdFx0ICogQHBhcmFtIHtjYWxsYmFja30gY2FsbGJhY2sgQ2FsbGJhY2sgdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgZXZlbnQgb2NjdXJzLlxuXHRcdCAqIEBwYXJhbSB7Qm9vbGVhbn0gZmlyc3QgT3B0aW9uYWwgZmxhZyBpZiB0aGUgZXZlbnQgc2hvdWxkIGJlIHByZXBlbmRlZC4gVXNlIHRoaXMgd2l0aCBjYXJlLlxuXHRcdCAqIEByZXR1cm4ge09iamVjdH0gQ3VycmVudCBjbGFzcyBpbnN0YW5jZS5cblx0XHQgKiBAZXhhbXBsZVxuXHRcdCAqIGluc3RhbmNlLm9uY2UoJ2V2ZW50JywgZnVuY3Rpb24oZSkge1xuXHRcdCAqICAgICAvLyBDYWxsYmFjayBsb2dpY1xuXHRcdCAqIH0pO1xuXHRcdCAqL1xuXHRcdGZ1bmN0aW9uIG9uY2UobmFtZSwgY2FsbGJhY2ssIHByZXBlbmQpIHtcblx0XHRcdHJldHVybiBvbihuYW1lLCBjYWxsYmFjaywgcHJlcGVuZCwge29uY2U6IHRydWV9KTtcblx0XHR9XG5cblx0XHQvKipcblx0XHQgKiBSZXR1cm5zIHRydWUvZmFsc2UgaWYgdGhlIGRpc3BhdGNoZXIgaGFzIGEgZXZlbnQgb2YgdGhlIHNwZWNpZmllZCBuYW1lLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBoYXNcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSBOYW1lIG9mIHRoZSBldmVudCB0byBjaGVjayBmb3IuXG5cdFx0ICogQHJldHVybiB7Qm9vbGVhbn0gdHJ1ZS9mYWxzZSBpZiB0aGUgZXZlbnQgZXhpc3RzIG9yIG5vdC5cblx0XHQgKi9cblx0XHRmdW5jdGlvbiBoYXMobmFtZSkge1xuXHRcdFx0bmFtZSA9IG5hbWUudG9Mb3dlckNhc2UoKTtcblx0XHRcdHJldHVybiAhKCFiaW5kaW5nc1tuYW1lXSB8fCBiaW5kaW5nc1tuYW1lXS5sZW5ndGggPT09IDApO1xuXHRcdH1cblxuXHRcdC8vIEV4cG9zZVxuXHRcdHNlbGYuZmlyZSA9IGZpcmU7XG5cdFx0c2VsZi5vbiA9IG9uO1xuXHRcdHNlbGYub2ZmID0gb2ZmO1xuXHRcdHNlbGYub25jZSA9IG9uY2U7XG5cdFx0c2VsZi5oYXMgPSBoYXM7XG5cdH1cblxuXHQvKipcblx0ICogUmV0dXJucyB0cnVlL2ZhbHNlIGlmIHRoZSBzcGVjaWZpZWQgZXZlbnQgbmFtZSBpcyBhIG5hdGl2ZSBicm93c2VyIGV2ZW50IG9yIG5vdC5cblx0ICpcblx0ICogQG1ldGhvZCBpc05hdGl2ZVxuXHQgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSBOYW1lIHRvIGNoZWNrIGlmIGl0J3MgbmF0aXZlLlxuXHQgKiBAcmV0dXJuIHtCb29sZWFufSB0cnVlL2ZhbHNlIGlmIHRoZSBldmVudCBpcyBuYXRpdmUgb3Igbm90LlxuXHQgKiBAc3RhdGljXG5cdCAqL1xuXHREaXNwYXRjaGVyLmlzTmF0aXZlID0gZnVuY3Rpb24obmFtZSkge1xuXHRcdHJldHVybiAhIW5hdGl2ZUV2ZW50c1tuYW1lLnRvTG93ZXJDYXNlKCldO1xuXHR9O1xuXG5cdHJldHVybiBEaXNwYXRjaGVyO1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy9kYXRhL0JpbmRpbmcuanNcblxuLyoqXG4gKiBCaW5kaW5nLmpzXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgTEdQTCBMaWNlbnNlLlxuICogQ29weXJpZ2h0IChjKSAxOTk5LTIwMTUgRXBob3ggQ29ycC4gQWxsIHJpZ2h0cyByZXNlcnZlZFxuICpcbiAqIExpY2Vuc2U6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vbGljZW5zZVxuICogQ29udHJpYnV0aW5nOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2NvbnRyaWJ1dGluZ1xuICovXG5cbi8qKlxuICogVGhpcyBjbGFzcyBnZXRzIGR5bmFtaWNhbGx5IGV4dGVuZGVkIHRvIHByb3ZpZGUgYSBiaW5kaW5nIGJldHdlZW4gdHdvIG1vZGVscy4gVGhpcyBtYWtlcyBpdCBwb3NzaWJsZSB0b1xuICogc3luYyB0aGUgc3RhdGUgb2YgdHdvIHByb3BlcnRpZXMgaW4gdHdvIG1vZGVscyBieSBhIGxheWVyIG9mIGFic3RyYWN0aW9uLlxuICpcbiAqIEBwcml2YXRlXG4gKiBAY2xhc3MgdGlueW1jZS5kYXRhLkJpbmRpbmdcbiAqL1xuZGVmaW5lKFwidGlueW1jZS9kYXRhL0JpbmRpbmdcIiwgW10sIGZ1bmN0aW9uKCkge1xuXHQvKipcblx0ICogQ29uc3RydWN0cyBhIG5ldyBiaWRuaW5nLlxuXHQgKlxuXHQgKiBAY29uc3RydWN0b3Jcblx0ICogQG1ldGhvZCBCaW5kaW5nXG5cdCAqIEBwYXJhbSB7T2JqZWN0fSBzZXR0aW5ncyBTZXR0aW5ncyB0byB0aGUgYmluZGluZy5cblx0ICovXG5cdGZ1bmN0aW9uIEJpbmRpbmcoc2V0dGluZ3MpIHtcblx0XHR0aGlzLmNyZWF0ZSA9IHNldHRpbmdzLmNyZWF0ZTtcblx0fVxuXG5cdC8qKlxuXHQgKiBDcmVhdGVzIGEgYmluZGluZyBmb3IgYSBwcm9wZXJ0eSBvbiBhIG1vZGVsLlxuXHQgKlxuXHQgKiBAbWV0aG9kIGNyZWF0ZVxuXHQgKiBAcGFyYW0ge3RpbnltY2UuZGF0YS5PYnNlcnZhYmxlT2JqZWN0fSBtb2RlbCBNb2RlbCB0byBjcmVhdGUgYmluZGluZyB0by5cblx0ICogQHBhcmFtIHtTdHJpbmd9IG5hbWUgTmFtZSBvZiBwcm9wZXJ0eSB0byBiaW5kLlxuXHQgKiBAcmV0dXJuIHt0aW55bWNlLmRhdGEuQmluZGluZ30gQmluZGluZyBpbnN0YW5jZS5cblx0ICovXG5cdEJpbmRpbmcuY3JlYXRlID0gZnVuY3Rpb24obW9kZWwsIG5hbWUpIHtcblx0XHRyZXR1cm4gbmV3IEJpbmRpbmcoe1xuXHRcdFx0Y3JlYXRlOiBmdW5jdGlvbihvdGhlck1vZGVsLCBvdGhlck5hbWUpIHtcblx0XHRcdFx0dmFyIGJpbmRpbmdzO1xuXG5cdFx0XHRcdGZ1bmN0aW9uIGZyb21TZWxmVG9PdGhlcihlKSB7XG5cdFx0XHRcdFx0b3RoZXJNb2RlbC5zZXQob3RoZXJOYW1lLCBlLnZhbHVlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGZ1bmN0aW9uIGZyb21PdGhlclRvU2VsZihlKSB7XG5cdFx0XHRcdFx0bW9kZWwuc2V0KG5hbWUsIGUudmFsdWUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0b3RoZXJNb2RlbC5vbignY2hhbmdlOicgKyBvdGhlck5hbWUsIGZyb21PdGhlclRvU2VsZik7XG5cdFx0XHRcdG1vZGVsLm9uKCdjaGFuZ2U6JyArIG5hbWUsIGZyb21TZWxmVG9PdGhlcik7XG5cblx0XHRcdFx0Ly8gS2VlcCB0cmFjayBvZiB0aGUgYmluZGluZ3Ncblx0XHRcdFx0YmluZGluZ3MgPSBvdGhlck1vZGVsLl9iaW5kaW5ncztcblxuXHRcdFx0XHRpZiAoIWJpbmRpbmdzKSB7XG5cdFx0XHRcdFx0YmluZGluZ3MgPSBvdGhlck1vZGVsLl9iaW5kaW5ncyA9IFtdO1xuXG5cdFx0XHRcdFx0b3RoZXJNb2RlbC5vbignZGVzdHJveScsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdFx0dmFyIGkgPSBiaW5kaW5ncy5sZW5ndGg7XG5cblx0XHRcdFx0XHRcdHdoaWxlIChpLS0pIHtcblx0XHRcdFx0XHRcdFx0YmluZGluZ3NbaV0oKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGJpbmRpbmdzLnB1c2goZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0bW9kZWwub2ZmKCdjaGFuZ2U6JyArIG5hbWUsIGZyb21TZWxmVG9PdGhlcik7XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdHJldHVybiBtb2RlbC5nZXQobmFtZSk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH07XG5cblx0cmV0dXJuIEJpbmRpbmc7XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL3V0aWwvT2JzZXJ2YWJsZS5qc1xuXG4vKipcbiAqIE9ic2VydmFibGUuanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBUaGlzIG1peGluIHdpbGwgYWRkIGV2ZW50IGJpbmRpbmcgbG9naWMgdG8gY2xhc3Nlcy5cbiAqXG4gKiBAbWl4aW4gdGlueW1jZS51dGlsLk9ic2VydmFibGVcbiAqL1xuZGVmaW5lKFwidGlueW1jZS91dGlsL09ic2VydmFibGVcIiwgW1xuXHRcInRpbnltY2UvdXRpbC9FdmVudERpc3BhdGNoZXJcIlxuXSwgZnVuY3Rpb24oRXZlbnREaXNwYXRjaGVyKSB7XG5cdGZ1bmN0aW9uIGdldEV2ZW50RGlzcGF0Y2hlcihvYmopIHtcblx0XHRpZiAoIW9iai5fZXZlbnREaXNwYXRjaGVyKSB7XG5cdFx0XHRvYmouX2V2ZW50RGlzcGF0Y2hlciA9IG5ldyBFdmVudERpc3BhdGNoZXIoe1xuXHRcdFx0XHRzY29wZTogb2JqLFxuXHRcdFx0XHR0b2dnbGVFdmVudDogZnVuY3Rpb24obmFtZSwgc3RhdGUpIHtcblx0XHRcdFx0XHRpZiAoRXZlbnREaXNwYXRjaGVyLmlzTmF0aXZlKG5hbWUpICYmIG9iai50b2dnbGVOYXRpdmVFdmVudCkge1xuXHRcdFx0XHRcdFx0b2JqLnRvZ2dsZU5hdGl2ZUV2ZW50KG5hbWUsIHN0YXRlKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdHJldHVybiBvYmouX2V2ZW50RGlzcGF0Y2hlcjtcblx0fVxuXG5cdHJldHVybiB7XG5cdFx0LyoqXG5cdFx0ICogRmlyZXMgdGhlIHNwZWNpZmllZCBldmVudCBieSBuYW1lLiBDb25zdWx0IHRoZVxuXHRcdCAqIDxhIGhyZWY9XCIvYWR2YW5jZWQvZXZlbnRzXCI+ZXZlbnQgcmVmZXJlbmNlPC9hPiBmb3IgbW9yZSBkZXRhaWxzIG9uIGVhY2ggZXZlbnQuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGZpcmVcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSBOYW1lIG9mIHRoZSBldmVudCB0byBmaXJlLlxuXHRcdCAqIEBwYXJhbSB7T2JqZWN0P30gYXJncyBFdmVudCBhcmd1bWVudHMuXG5cdFx0ICogQHBhcmFtIHtCb29sZWFuP30gYnViYmxlIFRydWUvZmFsc2UgaWYgdGhlIGV2ZW50IGlzIHRvIGJlIGJ1YmJsZWQuXG5cdFx0ICogQHJldHVybiB7T2JqZWN0fSBFdmVudCBhcmdzIGluc3RhbmNlIHBhc3NlZCBpbi5cblx0XHQgKiBAZXhhbXBsZVxuXHRcdCAqIGluc3RhbmNlLmZpcmUoJ2V2ZW50Jywgey4uLn0pO1xuXHRcdCAqL1xuXHRcdGZpcmU6IGZ1bmN0aW9uKG5hbWUsIGFyZ3MsIGJ1YmJsZSkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHQvLyBQcmV2ZW50IGFsbCBldmVudHMgZXhjZXB0IHRoZSByZW1vdmUgZXZlbnQgYWZ0ZXIgdGhlIGluc3RhbmNlIGhhcyBiZWVuIHJlbW92ZWRcblx0XHRcdGlmIChzZWxmLnJlbW92ZWQgJiYgbmFtZSAhPT0gXCJyZW1vdmVcIikge1xuXHRcdFx0XHRyZXR1cm4gYXJncztcblx0XHRcdH1cblxuXHRcdFx0YXJncyA9IGdldEV2ZW50RGlzcGF0Y2hlcihzZWxmKS5maXJlKG5hbWUsIGFyZ3MsIGJ1YmJsZSk7XG5cblx0XHRcdC8vIEJ1YmJsZSBldmVudCB1cCB0byBwYXJlbnRzXG5cdFx0XHRpZiAoYnViYmxlICE9PSBmYWxzZSAmJiBzZWxmLnBhcmVudCkge1xuXHRcdFx0XHR2YXIgcGFyZW50ID0gc2VsZi5wYXJlbnQoKTtcblx0XHRcdFx0d2hpbGUgKHBhcmVudCAmJiAhYXJncy5pc1Byb3BhZ2F0aW9uU3RvcHBlZCgpKSB7XG5cdFx0XHRcdFx0cGFyZW50LmZpcmUobmFtZSwgYXJncywgZmFsc2UpO1xuXHRcdFx0XHRcdHBhcmVudCA9IHBhcmVudC5wYXJlbnQoKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gYXJncztcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogQmluZHMgYW4gZXZlbnQgbGlzdGVuZXIgdG8gYSBzcGVjaWZpYyBldmVudCBieSBuYW1lLiBDb25zdWx0IHRoZVxuXHRcdCAqIDxhIGhyZWY9XCIvYWR2YW5jZWQvZXZlbnRzXCI+ZXZlbnQgcmVmZXJlbmNlPC9hPiBmb3IgbW9yZSBkZXRhaWxzIG9uIGVhY2ggZXZlbnQuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIG9uXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IG5hbWUgRXZlbnQgbmFtZSBvciBzcGFjZSBzZXBhcmF0ZWQgbGlzdCBvZiBldmVudHMgdG8gYmluZC5cblx0XHQgKiBAcGFyYW0ge2NhbGxiYWNrfSBjYWxsYmFjayBDYWxsYmFjayB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBldmVudCBvY2N1cnMuXG5cdFx0ICogQHBhcmFtIHtCb29sZWFufSBmaXJzdCBPcHRpb25hbCBmbGFnIGlmIHRoZSBldmVudCBzaG91bGQgYmUgcHJlcGVuZGVkLiBVc2UgdGhpcyB3aXRoIGNhcmUuXG5cdFx0ICogQHJldHVybiB7T2JqZWN0fSBDdXJyZW50IGNsYXNzIGluc3RhbmNlLlxuXHRcdCAqIEBleGFtcGxlXG5cdFx0ICogaW5zdGFuY2Uub24oJ2V2ZW50JywgZnVuY3Rpb24oZSkge1xuXHRcdCAqICAgICAvLyBDYWxsYmFjayBsb2dpY1xuXHRcdCAqIH0pO1xuXHRcdCAqL1xuXHRcdG9uOiBmdW5jdGlvbihuYW1lLCBjYWxsYmFjaywgcHJlcGVuZCkge1xuXHRcdFx0cmV0dXJuIGdldEV2ZW50RGlzcGF0Y2hlcih0aGlzKS5vbihuYW1lLCBjYWxsYmFjaywgcHJlcGVuZCk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFVuYmluZHMgYW4gZXZlbnQgbGlzdGVuZXIgdG8gYSBzcGVjaWZpYyBldmVudCBieSBuYW1lLiBDb25zdWx0IHRoZVxuXHRcdCAqIDxhIGhyZWY9XCIvYWR2YW5jZWQvZXZlbnRzXCI+ZXZlbnQgcmVmZXJlbmNlPC9hPiBmb3IgbW9yZSBkZXRhaWxzIG9uIGVhY2ggZXZlbnQuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIG9mZlxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nP30gbmFtZSBOYW1lIG9mIHRoZSBldmVudCB0byB1bmJpbmQuXG5cdFx0ICogQHBhcmFtIHtjYWxsYmFjaz99IGNhbGxiYWNrIENhbGxiYWNrIHRvIHVuYmluZC5cblx0XHQgKiBAcmV0dXJuIHtPYmplY3R9IEN1cnJlbnQgY2xhc3MgaW5zdGFuY2UuXG5cdFx0ICogQGV4YW1wbGVcblx0XHQgKiAvLyBVbmJpbmQgc3BlY2lmaWMgY2FsbGJhY2tcblx0XHQgKiBpbnN0YW5jZS5vZmYoJ2V2ZW50JywgaGFuZGxlcik7XG5cdFx0ICpcblx0XHQgKiAvLyBVbmJpbmQgYWxsIGxpc3RlbmVycyBieSBuYW1lXG5cdFx0ICogaW5zdGFuY2Uub2ZmKCdldmVudCcpO1xuXHRcdCAqXG5cdFx0ICogLy8gVW5iaW5kIGFsbCBldmVudHNcblx0XHQgKiBpbnN0YW5jZS5vZmYoKTtcblx0XHQgKi9cblx0XHRvZmY6IGZ1bmN0aW9uKG5hbWUsIGNhbGxiYWNrKSB7XG5cdFx0XHRyZXR1cm4gZ2V0RXZlbnREaXNwYXRjaGVyKHRoaXMpLm9mZihuYW1lLCBjYWxsYmFjayk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIEJpbmQgdGhlIGV2ZW50IGNhbGxiYWNrIGFuZCBvbmNlIGl0IGZpcmVzIHRoZSBjYWxsYmFjayBpcyByZW1vdmVkLiBDb25zdWx0IHRoZVxuXHRcdCAqIDxhIGhyZWY9XCIvYWR2YW5jZWQvZXZlbnRzXCI+ZXZlbnQgcmVmZXJlbmNlPC9hPiBmb3IgbW9yZSBkZXRhaWxzIG9uIGVhY2ggZXZlbnQuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIG9uY2Vcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSBOYW1lIG9mIHRoZSBldmVudCB0byBiaW5kLlxuXHRcdCAqIEBwYXJhbSB7Y2FsbGJhY2t9IGNhbGxiYWNrIENhbGxiYWNrIHRvIGJpbmQgb25seSBvbmNlLlxuXHRcdCAqIEByZXR1cm4ge09iamVjdH0gQ3VycmVudCBjbGFzcyBpbnN0YW5jZS5cblx0XHQgKi9cblx0XHRvbmNlOiBmdW5jdGlvbihuYW1lLCBjYWxsYmFjaykge1xuXHRcdFx0cmV0dXJuIGdldEV2ZW50RGlzcGF0Y2hlcih0aGlzKS5vbmNlKG5hbWUsIGNhbGxiYWNrKTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyB0cnVlL2ZhbHNlIGlmIHRoZSBvYmplY3QgaGFzIGEgZXZlbnQgb2YgdGhlIHNwZWNpZmllZCBuYW1lLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBoYXNFdmVudExpc3RlbmVyc1xuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIE5hbWUgb2YgdGhlIGV2ZW50IHRvIGNoZWNrIGZvci5cblx0XHQgKiBAcmV0dXJuIHtCb29sZWFufSB0cnVlL2ZhbHNlIGlmIHRoZSBldmVudCBleGlzdHMgb3Igbm90LlxuXHRcdCAqL1xuXHRcdGhhc0V2ZW50TGlzdGVuZXJzOiBmdW5jdGlvbihuYW1lKSB7XG5cdFx0XHRyZXR1cm4gZ2V0RXZlbnREaXNwYXRjaGVyKHRoaXMpLmhhcyhuYW1lKTtcblx0XHR9XG5cdH07XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL2RhdGEvT2JzZXJ2YWJsZU9iamVjdC5qc1xuXG4vKipcbiAqIE9ic2VydmFibGVPYmplY3QuanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBUaGlzIGNsYXNzIGlzIGEgb2JqZWN0IHRoYXQgaXMgb2JzZXJ2YWJsZSB3aGVuIHByb3BlcnRpZXMgY2hhbmdlcyBhIGNoYW5nZSBldmVudCBnZXRzIGVtaXR0ZWQuXG4gKlxuICogQHByaXZhdGVcbiAqIEBjbGFzcyB0aW55bWNlLmRhdGEuT2JzZXJ2YWJsZU9iamVjdFxuICovXG5kZWZpbmUoXCJ0aW55bWNlL2RhdGEvT2JzZXJ2YWJsZU9iamVjdFwiLCBbXG5cdFwidGlueW1jZS9kYXRhL0JpbmRpbmdcIixcblx0XCJ0aW55bWNlL3V0aWwvT2JzZXJ2YWJsZVwiLFxuXHRcInRpbnltY2UvdXRpbC9DbGFzc1wiLFxuXHRcInRpbnltY2UvdXRpbC9Ub29sc1wiXG5dLCBmdW5jdGlvbihCaW5kaW5nLCBPYnNlcnZhYmxlLCBDbGFzcywgVG9vbHMpIHtcblx0ZnVuY3Rpb24gaXNOb2RlKG5vZGUpIHtcblx0XHRyZXR1cm4gbm9kZS5ub2RlVHlwZSA+IDA7XG5cdH1cblxuXHQvLyBUb2RvOiBNYXliZSB0aGlzIHNob3VsZCBiZSBzaGFsbG93IGNvbXBhcmUgc2luY2UgaXQgbWlnaHQgYmUgaHVnZSBvYmplY3QgcmVmZXJlbmNlc1xuXHRmdW5jdGlvbiBpc0VxdWFsKGEsIGIpIHtcblx0XHR2YXIgaywgY2hlY2tlZDtcblxuXHRcdC8vIFN0cmljdCBlcXVhbHNcblx0XHRpZiAoYSA9PT0gYikge1xuXHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0fVxuXG5cdFx0Ly8gQ29tcGFyZSBudWxsXG5cdFx0aWYgKGEgPT09IG51bGwgfHwgYiA9PT0gbnVsbCkge1xuXHRcdFx0cmV0dXJuIGEgPT09IGI7XG5cdFx0fVxuXG5cdFx0Ly8gQ29tcGFyZSBudW1iZXIsIGJvb2xlYW4sIHN0cmluZywgdW5kZWZpbmVkXG5cdFx0aWYgKHR5cGVvZiBhICE9PSBcIm9iamVjdFwiIHx8IHR5cGVvZiBiICE9PSBcIm9iamVjdFwiKSB7XG5cdFx0XHRyZXR1cm4gYSA9PT0gYjtcblx0XHR9XG5cblx0XHQvLyBDb21wYXJlIGFycmF5c1xuXHRcdGlmIChUb29scy5pc0FycmF5KGIpKSB7XG5cdFx0XHRpZiAoYS5sZW5ndGggIT09IGIubGVuZ3RoKSB7XG5cdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdH1cblxuXHRcdFx0ayA9IGEubGVuZ3RoO1xuXHRcdFx0d2hpbGUgKGstLSkge1xuXHRcdFx0XHRpZiAoIWlzRXF1YWwoYVtrXSwgYltrXSkpIHtcblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHQvLyBTaGFsbG93IGNvbXBhcmUgbm9kZXNcblx0XHRpZiAoaXNOb2RlKGEpIHx8IGlzTm9kZShiKSkge1xuXHRcdFx0cmV0dXJuIGEgPT09IGI7XG5cdFx0fVxuXG5cdFx0Ly8gQ29tcGFyZSBvYmplY3RzXG5cdFx0Y2hlY2tlZCA9IHt9O1xuXHRcdGZvciAoayBpbiBiKSB7XG5cdFx0XHRpZiAoIWlzRXF1YWwoYVtrXSwgYltrXSkpIHtcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0fVxuXG5cdFx0XHRjaGVja2VkW2tdID0gdHJ1ZTtcblx0XHR9XG5cblx0XHRmb3IgKGsgaW4gYSkge1xuXHRcdFx0aWYgKCFjaGVja2VkW2tdICYmICFpc0VxdWFsKGFba10sIGJba10pKSB7XG5cdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdHJldHVybiBDbGFzcy5leHRlbmQoe1xuXHRcdE1peGluczogW09ic2VydmFibGVdLFxuXG5cdFx0LyoqXG5cdFx0ICogQ29uc3RydWN0cyBhIG5ldyBvYnNlcnZhYmxlIG9iamVjdCBpbnN0YW5jZS5cblx0XHQgKlxuXHRcdCAqIEBjb25zdHJ1Y3RvclxuXHRcdCAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhIEluaXRpYWwgZGF0YSBmb3IgdGhlIG9iamVjdC5cblx0XHQgKi9cblx0XHRpbml0OiBmdW5jdGlvbihkYXRhKSB7XG5cdFx0XHR2YXIgbmFtZSwgdmFsdWU7XG5cblx0XHRcdGRhdGEgPSBkYXRhIHx8IHt9O1xuXG5cdFx0XHRmb3IgKG5hbWUgaW4gZGF0YSkge1xuXHRcdFx0XHR2YWx1ZSA9IGRhdGFbbmFtZV07XG5cblx0XHRcdFx0aWYgKHZhbHVlIGluc3RhbmNlb2YgQmluZGluZykge1xuXHRcdFx0XHRcdGRhdGFbbmFtZV0gPSB2YWx1ZS5jcmVhdGUodGhpcywgbmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0dGhpcy5kYXRhID0gZGF0YTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogU2V0cyBhIHByb3BlcnR5IG9uIHRoZSB2YWx1ZSB0aGlzIHdpbGwgY2FsbFxuXHRcdCAqIG9ic2VydmVycyBpZiB0aGUgdmFsdWUgaXMgYSBjaGFuZ2UgZnJvbSB0aGUgY3VycmVudCB2YWx1ZS5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2Qgc2V0XG5cdFx0ICogQHBhcmFtIHtTdHJpbmcvb2JqZWN0fSBuYW1lIE5hbWUgb2YgdGhlIHByb3BlcnR5IHRvIHNldCBvciBhIG9iamVjdCBvZiBpdGVtcyB0byBzZXQuXG5cdFx0ICogQHBhcmFtIHtPYmplY3R9IHZhbHVlIFZhbHVlIHRvIHNldCBmb3IgdGhlIHByb3BlcnR5LlxuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UuZGF0YS5PYnNlcnZhYmxlT2JqZWN0fSBPYnNlcnZhYmxlIG9iamVjdCBpbnN0YW5jZS5cblx0XHQgKi9cblx0XHRzZXQ6IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7XG5cdFx0XHR2YXIga2V5LCBhcmdzLCBvbGRWYWx1ZSA9IHRoaXMuZGF0YVtuYW1lXTtcblxuXHRcdFx0aWYgKHZhbHVlIGluc3RhbmNlb2YgQmluZGluZykge1xuXHRcdFx0XHR2YWx1ZSA9IHZhbHVlLmNyZWF0ZSh0aGlzLCBuYW1lKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZiBuYW1lID09PSBcIm9iamVjdFwiKSB7XG5cdFx0XHRcdGZvciAoa2V5IGluIG5hbWUpIHtcblx0XHRcdFx0XHR0aGlzLnNldChrZXksIG5hbWVba2V5XSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gdGhpcztcblx0XHRcdH1cblxuXHRcdFx0aWYgKCFpc0VxdWFsKG9sZFZhbHVlLCB2YWx1ZSkpIHtcblx0XHRcdFx0dGhpcy5kYXRhW25hbWVdID0gdmFsdWU7XG5cblx0XHRcdFx0YXJncyA9IHtcblx0XHRcdFx0XHR0YXJnZXQ6IHRoaXMsXG5cdFx0XHRcdFx0bmFtZTogbmFtZSxcblx0XHRcdFx0XHR2YWx1ZTogdmFsdWUsXG5cdFx0XHRcdFx0b2xkVmFsdWU6IG9sZFZhbHVlXG5cdFx0XHRcdH07XG5cblx0XHRcdFx0dGhpcy5maXJlKCdjaGFuZ2U6JyArIG5hbWUsIGFyZ3MpO1xuXHRcdFx0XHR0aGlzLmZpcmUoJ2NoYW5nZScsIGFyZ3MpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogR2V0cyBhIHByb3BlcnR5IGJ5IG5hbWUuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGdldFxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIE5hbWUgb2YgdGhlIHByb3BlcnR5IHRvIGdldC5cblx0XHQgKiBAcmV0dXJuIHtPYmplY3R9IE9iamVjdCB2YWx1ZSBvZiBwcm9wZXJ5LlxuXHRcdCAqL1xuXHRcdGdldDogZnVuY3Rpb24obmFtZSkge1xuXHRcdFx0cmV0dXJuIHRoaXMuZGF0YVtuYW1lXTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyB0cnVlL2ZhbHNlIGlmIHRoZSBzcGVjaWZpZWQgcHJvcGVydHkgZXhpc3RzLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBoYXNcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSBOYW1lIG9mIHRoZSBwcm9wZXJ0eSB0byBjaGVjayBmb3IuXG5cdFx0ICogQHJldHVybiB7Qm9vbGVhbn0gdHJ1ZS9mYWxzZSBpZiB0aGUgaXRlbSBleGlzdHMuXG5cdFx0ICovXG5cdFx0aGFzOiBmdW5jdGlvbihuYW1lKSB7XG5cdFx0XHRyZXR1cm4gbmFtZSBpbiB0aGlzLmRhdGE7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFJldHVybnMgYSBkeW5hbWljIHByb3BlcnR5IGJpbmRpbmcgZm9yIHRoZSBzcGVjaWZpZWQgcHJvcGVydHkgbmFtZS4gVGhpcyBtYWtlc1xuXHRcdCAqIGl0IHBvc3NpYmxlIHRvIHN5bmMgdGhlIHN0YXRlIG9mIHR3byBwcm9wZXJ0aWVzIGluIHR3byBPYnNlcnZhYmxlT2JqZWN0IGluc3RhbmNlcy5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgYmluZFxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIE5hbWUgb2YgdGhlIHByb3BlcnR5IHRvIHN5bmMgd2l0aCB0aGUgcHJvcGVydHkgaXQncyBpbnNlcnRlZCB0by5cblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLmRhdGEuQmluZGluZ30gRGF0YSBiaW5kaW5nIGluc3RhbmNlLlxuXHRcdCAqL1xuXHRcdGJpbmQ6IGZ1bmN0aW9uKG5hbWUpIHtcblx0XHRcdHJldHVybiBCaW5kaW5nLmNyZWF0ZSh0aGlzLCBuYW1lKTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogRGVzdHJveXMgdGhlIG9ic2VydmFibGUgb2JqZWN0IGFuZCBmaXJlcyB0aGUgXCJkZXN0cm95XCJcblx0XHQgKiBldmVudCBhbmQgY2xlYW4gdXAgYW55IGludGVybmFsIHJlc291cmNlcy5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgZGVzdHJveVxuXHRcdCAqL1xuXHRcdGRlc3Ryb3k6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dGhpcy5maXJlKCdkZXN0cm95Jyk7XG5cdFx0fVxuXHR9KTtcbn0pO1xuXG4vLyBJbmNsdWRlZCBmcm9tOiBqcy90aW55bWNlL2NsYXNzZXMvdWkvU2VsZWN0b3IuanNcblxuLyoqXG4gKiBTZWxlY3Rvci5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE1IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKmVzbGludCBuby1uZXN0ZWQtdGVybmFyeTowICovXG5cbi8qKlxuICogU2VsZWN0b3IgZW5naW5lLCBlbmFibGVzIHlvdSB0byBzZWxlY3QgY29udHJvbHMgYnkgdXNpbmcgQ1NTIGxpa2UgZXhwcmVzc2lvbnMuXG4gKiBXZSBjdXJyZW50bHkgb25seSBzdXBwb3J0IGJhc2ljIENTUyBleHByZXNzaW9ucyB0byByZWR1Y2UgdGhlIHNpemUgb2YgdGhlIGNvcmVcbiAqIGFuZCB0aGUgb25lcyB3ZSBzdXBwb3J0IHNob3VsZCBiZSBlbm91Z2ggZm9yIG1vc3QgY2FzZXMuXG4gKlxuICogQGV4YW1wbGVcbiAqIFN1cHBvcnRlZCBleHByZXNzaW9uczpcbiAqICBlbGVtZW50XG4gKiAgZWxlbWVudCNuYW1lXG4gKiAgZWxlbWVudC5jbGFzc1xuICogIGVsZW1lbnRbYXR0cl1cbiAqICBlbGVtZW50W2F0dHIqPXZhbHVlXVxuICogIGVsZW1lbnRbYXR0cn49dmFsdWVdXG4gKiAgZWxlbWVudFthdHRyIT12YWx1ZV1cbiAqICBlbGVtZW50W2F0dHJePXZhbHVlXVxuICogIGVsZW1lbnRbYXR0ciQ9dmFsdWVdXG4gKiAgZWxlbWVudDo8c3RhdGU+XG4gKiAgZWxlbWVudDpub3QoPGV4cHJlc3Npb24+KVxuICogIGVsZW1lbnQ6Zmlyc3RcbiAqICBlbGVtZW50Omxhc3RcbiAqICBlbGVtZW50Om9kZFxuICogIGVsZW1lbnQ6ZXZlblxuICogIGVsZW1lbnQgZWxlbWVudFxuICogIGVsZW1lbnQgPiBlbGVtZW50XG4gKlxuICogQGNsYXNzIHRpbnltY2UudWkuU2VsZWN0b3JcbiAqL1xuZGVmaW5lKFwidGlueW1jZS91aS9TZWxlY3RvclwiLCBbXG5cdFwidGlueW1jZS91dGlsL0NsYXNzXCJcbl0sIGZ1bmN0aW9uKENsYXNzKSB7XG5cdFwidXNlIHN0cmljdFwiO1xuXG5cdC8qKlxuXHQgKiBQcm9kdWNlcyBhbiBhcnJheSB3aXRoIGEgdW5pcXVlIHNldCBvZiBvYmplY3RzLiBJdCB3aWxsIG5vdCBjb21wYXJlIHRoZSB2YWx1ZXNcblx0ICogYnV0IHRoZSByZWZlcmVuY2VzIG9mIHRoZSBvYmplY3RzLlxuXHQgKlxuXHQgKiBAcHJpdmF0ZVxuXHQgKiBAbWV0aG9kIHVucWl1ZVxuXHQgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBBcnJheSB0byBtYWtlIGludG8gYW4gYXJyYXkgd2l0aCB1bmlxdWUgaXRlbXMuXG5cdCAqIEByZXR1cm4ge0FycmF5fSBBcnJheSB3aXRoIHVuaXF1ZSBpdGVtcy5cblx0ICovXG5cdGZ1bmN0aW9uIHVuaXF1ZShhcnJheSkge1xuXHRcdHZhciB1bmlxdWVJdGVtcyA9IFtdLCBpID0gYXJyYXkubGVuZ3RoLCBpdGVtO1xuXG5cdFx0d2hpbGUgKGktLSkge1xuXHRcdFx0aXRlbSA9IGFycmF5W2ldO1xuXG5cdFx0XHRpZiAoIWl0ZW0uX19jaGVja2VkKSB7XG5cdFx0XHRcdHVuaXF1ZUl0ZW1zLnB1c2goaXRlbSk7XG5cdFx0XHRcdGl0ZW0uX19jaGVja2VkID0gMTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpID0gdW5pcXVlSXRlbXMubGVuZ3RoO1xuXHRcdHdoaWxlIChpLS0pIHtcblx0XHRcdGRlbGV0ZSB1bmlxdWVJdGVtc1tpXS5fX2NoZWNrZWQ7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHVuaXF1ZUl0ZW1zO1xuXHR9XG5cblx0dmFyIGV4cHJlc3Npb24gPSAvXihbXFx3XFxcXCpdKyk/KD86IyhbXFx3XFwtXFxcXF0rKSk/KD86XFwuKFtcXHdcXFxcXFwuXSspKT8oPzpcXFtcXEA/KFtcXHdcXFxcXSspKFtcXF5cXCRcXCohfl0/PSkoW1xcd1xcXFxdKylcXF0pPyg/OlxcOiguKykpPy9pO1xuXG5cdC8qanNoaW50IG1heGxlbjoyNTUgKi9cblx0Lyplc2xpbnQgbWF4LWxlbjowICovXG5cdHZhciBjaHVua2VyID0gLygoPzpcXCgoPzpcXChbXigpXStcXCl8W14oKV0rKStcXCl8XFxbKD86XFxbW15cXFtcXF1dKlxcXXxbJ1wiXVteJ1wiXSpbJ1wiXXxbXlxcW1xcXSdcIl0rKStcXF18XFxcXC58W14gPit+LChcXFtcXFxcXSspK3xbPit+XSkoXFxzKixcXHMqKT8oKD86LnxcXHJ8XFxuKSopL2csXG5cdFx0d2hpdGVTcGFjZSA9IC9eXFxzKnxcXHMqJC9nLFxuXHRcdENvbGxlY3Rpb247XG5cblx0dmFyIFNlbGVjdG9yID0gQ2xhc3MuZXh0ZW5kKHtcblx0XHQvKipcblx0XHQgKiBDb25zdHJ1Y3RzIGEgbmV3IFNlbGVjdG9yIGluc3RhbmNlLlxuXHRcdCAqXG5cdFx0ICogQGNvbnN0cnVjdG9yXG5cdFx0ICogQG1ldGhvZCBpbml0XG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IHNlbGVjdG9yIENTUyBsaWtlIHNlbGVjdG9yIGV4cHJlc3Npb24uXG5cdFx0ICovXG5cdFx0aW5pdDogZnVuY3Rpb24oc2VsZWN0b3IpIHtcblx0XHRcdHZhciBtYXRjaCA9IHRoaXMubWF0Y2g7XG5cblx0XHRcdGZ1bmN0aW9uIGNvbXBpbGVOYW1lRmlsdGVyKG5hbWUpIHtcblx0XHRcdFx0aWYgKG5hbWUpIHtcblx0XHRcdFx0XHRuYW1lID0gbmFtZS50b0xvd2VyQ2FzZSgpO1xuXG5cdFx0XHRcdFx0cmV0dXJuIGZ1bmN0aW9uKGl0ZW0pIHtcblx0XHRcdFx0XHRcdHJldHVybiBuYW1lID09PSAnKicgfHwgaXRlbS50eXBlID09PSBuYW1lO1xuXHRcdFx0XHRcdH07XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gY29tcGlsZUlkRmlsdGVyKGlkKSB7XG5cdFx0XHRcdGlmIChpZCkge1xuXHRcdFx0XHRcdHJldHVybiBmdW5jdGlvbihpdGVtKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gaXRlbS5fbmFtZSA9PT0gaWQ7XG5cdFx0XHRcdFx0fTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRmdW5jdGlvbiBjb21waWxlQ2xhc3Nlc0ZpbHRlcihjbGFzc2VzKSB7XG5cdFx0XHRcdGlmIChjbGFzc2VzKSB7XG5cdFx0XHRcdFx0Y2xhc3NlcyA9IGNsYXNzZXMuc3BsaXQoJy4nKTtcblxuXHRcdFx0XHRcdHJldHVybiBmdW5jdGlvbihpdGVtKSB7XG5cdFx0XHRcdFx0XHR2YXIgaSA9IGNsYXNzZXMubGVuZ3RoO1xuXG5cdFx0XHRcdFx0XHR3aGlsZSAoaS0tKSB7XG5cdFx0XHRcdFx0XHRcdGlmICghaXRlbS5jbGFzc2VzLmNvbnRhaW5zKGNsYXNzZXNbaV0pKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0XHRcdH07XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gY29tcGlsZUF0dHJGaWx0ZXIobmFtZSwgY21wLCBjaGVjaykge1xuXHRcdFx0XHRpZiAobmFtZSkge1xuXHRcdFx0XHRcdHJldHVybiBmdW5jdGlvbihpdGVtKSB7XG5cdFx0XHRcdFx0XHR2YXIgdmFsdWUgPSBpdGVtW25hbWVdID8gaXRlbVtuYW1lXSgpIDogJyc7XG5cblx0XHRcdFx0XHRcdHJldHVybiAhY21wID8gISFjaGVjayA6XG5cdFx0XHRcdFx0XHRcdGNtcCA9PT0gXCI9XCIgPyB2YWx1ZSA9PT0gY2hlY2sgOlxuXHRcdFx0XHRcdFx0XHRjbXAgPT09IFwiKj1cIiA/IHZhbHVlLmluZGV4T2YoY2hlY2spID49IDAgOlxuXHRcdFx0XHRcdFx0XHRjbXAgPT09IFwifj1cIiA/IChcIiBcIiArIHZhbHVlICsgXCIgXCIpLmluZGV4T2YoXCIgXCIgKyBjaGVjayArIFwiIFwiKSA+PSAwIDpcblx0XHRcdFx0XHRcdFx0Y21wID09PSBcIiE9XCIgPyB2YWx1ZSAhPSBjaGVjayA6XG5cdFx0XHRcdFx0XHRcdGNtcCA9PT0gXCJePVwiID8gdmFsdWUuaW5kZXhPZihjaGVjaykgPT09IDAgOlxuXHRcdFx0XHRcdFx0XHRjbXAgPT09IFwiJD1cIiA/IHZhbHVlLnN1YnN0cih2YWx1ZS5sZW5ndGggLSBjaGVjay5sZW5ndGgpID09PSBjaGVjayA6XG5cdFx0XHRcdFx0XHRcdGZhbHNlO1xuXHRcdFx0XHRcdH07XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gY29tcGlsZVBzdWVkb0ZpbHRlcihuYW1lKSB7XG5cdFx0XHRcdHZhciBub3RTZWxlY3RvcnM7XG5cblx0XHRcdFx0aWYgKG5hbWUpIHtcblx0XHRcdFx0XHRuYW1lID0gLyg/Om5vdFxcKCguKylcXCkpfCguKykvaS5leGVjKG5hbWUpO1xuXG5cdFx0XHRcdFx0aWYgKCFuYW1lWzFdKSB7XG5cdFx0XHRcdFx0XHRuYW1lID0gbmFtZVsyXTtcblxuXHRcdFx0XHRcdFx0cmV0dXJuIGZ1bmN0aW9uKGl0ZW0sIGluZGV4LCBsZW5ndGgpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIG5hbWUgPT09ICdmaXJzdCcgPyBpbmRleCA9PT0gMCA6XG5cdFx0XHRcdFx0XHRcdFx0bmFtZSA9PT0gJ2xhc3QnID8gaW5kZXggPT09IGxlbmd0aCAtIDEgOlxuXHRcdFx0XHRcdFx0XHRcdG5hbWUgPT09ICdldmVuJyA/IGluZGV4ICUgMiA9PT0gMCA6XG5cdFx0XHRcdFx0XHRcdFx0bmFtZSA9PT0gJ29kZCcgPyBpbmRleCAlIDIgPT09IDEgOlxuXHRcdFx0XHRcdFx0XHRcdGl0ZW1bbmFtZV0gPyBpdGVtW25hbWVdKCkgOlxuXHRcdFx0XHRcdFx0XHRcdGZhbHNlO1xuXHRcdFx0XHRcdFx0fTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHQvLyBDb21waWxlIG5vdCBleHByZXNzaW9uXG5cdFx0XHRcdFx0bm90U2VsZWN0b3JzID0gcGFyc2VDaHVua3MobmFtZVsxXSwgW10pO1xuXG5cdFx0XHRcdFx0cmV0dXJuIGZ1bmN0aW9uKGl0ZW0pIHtcblx0XHRcdFx0XHRcdHJldHVybiAhbWF0Y2goaXRlbSwgbm90U2VsZWN0b3JzKTtcblx0XHRcdFx0XHR9O1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIGNvbXBpbGUoc2VsZWN0b3IsIGZpbHRlcnMsIGRpcmVjdCkge1xuXHRcdFx0XHR2YXIgcGFydHM7XG5cblx0XHRcdFx0ZnVuY3Rpb24gYWRkKGZpbHRlcikge1xuXHRcdFx0XHRcdGlmIChmaWx0ZXIpIHtcblx0XHRcdFx0XHRcdGZpbHRlcnMucHVzaChmaWx0ZXIpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIFBhcnNlIGV4cHJlc3Npb24gaW50byBwYXJ0c1xuXHRcdFx0XHRwYXJ0cyA9IGV4cHJlc3Npb24uZXhlYyhzZWxlY3Rvci5yZXBsYWNlKHdoaXRlU3BhY2UsICcnKSk7XG5cblx0XHRcdFx0YWRkKGNvbXBpbGVOYW1lRmlsdGVyKHBhcnRzWzFdKSk7XG5cdFx0XHRcdGFkZChjb21waWxlSWRGaWx0ZXIocGFydHNbMl0pKTtcblx0XHRcdFx0YWRkKGNvbXBpbGVDbGFzc2VzRmlsdGVyKHBhcnRzWzNdKSk7XG5cdFx0XHRcdGFkZChjb21waWxlQXR0ckZpbHRlcihwYXJ0c1s0XSwgcGFydHNbNV0sIHBhcnRzWzZdKSk7XG5cdFx0XHRcdGFkZChjb21waWxlUHN1ZWRvRmlsdGVyKHBhcnRzWzddKSk7XG5cblx0XHRcdFx0Ly8gTWFyayB0aGUgZmlsdGVyIHdpdGggcHNldWRvIGZvciBwZXJmb3JtYW5jZVxuXHRcdFx0XHRmaWx0ZXJzLnBzZXVkbyA9ICEhcGFydHNbN107XG5cdFx0XHRcdGZpbHRlcnMuZGlyZWN0ID0gZGlyZWN0O1xuXG5cdFx0XHRcdHJldHVybiBmaWx0ZXJzO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBQYXJzZXIgbG9naWMgYmFzZWQgb24gU2l6emxlIGJ5IEpvaG4gUmVzaWdcblx0XHRcdGZ1bmN0aW9uIHBhcnNlQ2h1bmtzKHNlbGVjdG9yLCBzZWxlY3RvcnMpIHtcblx0XHRcdFx0dmFyIHBhcnRzID0gW10sIGV4dHJhLCBtYXRjaGVzLCBpO1xuXG5cdFx0XHRcdGRvIHtcblx0XHRcdFx0XHRjaHVua2VyLmV4ZWMoXCJcIik7XG5cdFx0XHRcdFx0bWF0Y2hlcyA9IGNodW5rZXIuZXhlYyhzZWxlY3Rvcik7XG5cblx0XHRcdFx0XHRpZiAobWF0Y2hlcykge1xuXHRcdFx0XHRcdFx0c2VsZWN0b3IgPSBtYXRjaGVzWzNdO1xuXHRcdFx0XHRcdFx0cGFydHMucHVzaChtYXRjaGVzWzFdKTtcblxuXHRcdFx0XHRcdFx0aWYgKG1hdGNoZXNbMl0pIHtcblx0XHRcdFx0XHRcdFx0ZXh0cmEgPSBtYXRjaGVzWzNdO1xuXHRcdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gd2hpbGUgKG1hdGNoZXMpO1xuXG5cdFx0XHRcdGlmIChleHRyYSkge1xuXHRcdFx0XHRcdHBhcnNlQ2h1bmtzKGV4dHJhLCBzZWxlY3RvcnMpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0c2VsZWN0b3IgPSBbXTtcblx0XHRcdFx0Zm9yIChpID0gMDsgaSA8IHBhcnRzLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRcdFx0aWYgKHBhcnRzW2ldICE9ICc+Jykge1xuXHRcdFx0XHRcdFx0c2VsZWN0b3IucHVzaChjb21waWxlKHBhcnRzW2ldLCBbXSwgcGFydHNbaSAtIDFdID09PSAnPicpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRzZWxlY3RvcnMucHVzaChzZWxlY3Rvcik7XG5cblx0XHRcdFx0cmV0dXJuIHNlbGVjdG9ycztcblx0XHRcdH1cblxuXHRcdFx0dGhpcy5fc2VsZWN0b3JzID0gcGFyc2VDaHVua3Moc2VsZWN0b3IsIFtdKTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyB0cnVlL2ZhbHNlIGlmIHRoZSBzZWxlY3RvciBtYXRjaGVzIHRoZSBzcGVjaWZpZWQgY29udHJvbC5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgbWF0Y2hcblx0XHQgKiBAcGFyYW0ge3RpbnltY2UudWkuQ29udHJvbH0gY29udHJvbCBDb250cm9sIHRvIG1hdGNoIGFnYWluc3QgdGhlIHNlbGVjdG9yLlxuXHRcdCAqIEBwYXJhbSB7QXJyYXl9IHNlbGVjdG9ycyBPcHRpb25hbCBhcnJheSBvZiBzZWxlY3RvcnMsIG1vc3RseSB1c2VkIGludGVybmFsbHkuXG5cdFx0ICogQHJldHVybiB7Qm9vbGVhbn0gdHJ1ZS9mYWxzZSBzdGF0ZSBpZiB0aGUgY29udHJvbCBtYXRjaGVzIG9yIG5vdC5cblx0XHQgKi9cblx0XHRtYXRjaDogZnVuY3Rpb24oY29udHJvbCwgc2VsZWN0b3JzKSB7XG5cdFx0XHR2YXIgaSwgbCwgc2ksIHNsLCBzZWxlY3RvciwgZmksIGZsLCBmaWx0ZXJzLCBpbmRleCwgbGVuZ3RoLCBzaWJsaW5ncywgY291bnQsIGl0ZW07XG5cblx0XHRcdHNlbGVjdG9ycyA9IHNlbGVjdG9ycyB8fCB0aGlzLl9zZWxlY3RvcnM7XG5cdFx0XHRmb3IgKGkgPSAwLCBsID0gc2VsZWN0b3JzLmxlbmd0aDsgaSA8IGw7IGkrKykge1xuXHRcdFx0XHRzZWxlY3RvciA9IHNlbGVjdG9yc1tpXTtcblx0XHRcdFx0c2wgPSBzZWxlY3Rvci5sZW5ndGg7XG5cdFx0XHRcdGl0ZW0gPSBjb250cm9sO1xuXHRcdFx0XHRjb3VudCA9IDA7XG5cblx0XHRcdFx0Zm9yIChzaSA9IHNsIC0gMTsgc2kgPj0gMDsgc2ktLSkge1xuXHRcdFx0XHRcdGZpbHRlcnMgPSBzZWxlY3RvcltzaV07XG5cblx0XHRcdFx0XHR3aGlsZSAoaXRlbSkge1xuXHRcdFx0XHRcdFx0Ly8gRmluZCB0aGUgaW5kZXggYW5kIGxlbmd0aCBzaW5jZSBhIHBzZXVkbyBmaWx0ZXIgbGlrZSA6Zmlyc3QgbmVlZHMgaXRcblx0XHRcdFx0XHRcdGlmIChmaWx0ZXJzLnBzZXVkbykge1xuXHRcdFx0XHRcdFx0XHRzaWJsaW5ncyA9IGl0ZW0ucGFyZW50KCkuaXRlbXMoKTtcblx0XHRcdFx0XHRcdFx0aW5kZXggPSBsZW5ndGggPSBzaWJsaW5ncy5sZW5ndGg7XG5cdFx0XHRcdFx0XHRcdHdoaWxlIChpbmRleC0tKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHNpYmxpbmdzW2luZGV4XSA9PT0gaXRlbSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGZvciAoZmkgPSAwLCBmbCA9IGZpbHRlcnMubGVuZ3RoOyBmaSA8IGZsOyBmaSsrKSB7XG5cdFx0XHRcdFx0XHRcdGlmICghZmlsdGVyc1tmaV0oaXRlbSwgaW5kZXgsIGxlbmd0aCkpIHtcblx0XHRcdFx0XHRcdFx0XHRmaSA9IGZsICsgMTtcblx0XHRcdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRpZiAoZmkgPT09IGZsKSB7XG5cdFx0XHRcdFx0XHRcdGNvdW50Kys7XG5cdFx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0Ly8gSWYgaXQgZGlkbid0IG1hdGNoIHRoZSByaWdodCBtb3N0IGV4cHJlc3Npb24gdGhlblxuXHRcdFx0XHRcdFx0XHQvLyBicmVhayBzaW5jZSBpdCdzIG5vIHBvaW50IGxvb2tpbmcgYXQgdGhlIHBhcmVudHNcblx0XHRcdFx0XHRcdFx0aWYgKHNpID09PSBzbCAtIDEpIHtcblx0XHRcdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRpdGVtID0gaXRlbS5wYXJlbnQoKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBJZiB3ZSBmb3VuZCBhbGwgc2VsZWN0b3JzIHRoZW4gcmV0dXJuIHRydWUgb3RoZXJ3aXNlIGNvbnRpbnVlIGxvb2tpbmdcblx0XHRcdFx0aWYgKGNvdW50ID09PSBzbCkge1xuXHRcdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyBhIHRpbnltY2UudWkuQ29sbGVjdGlvbiB3aXRoIG1hdGNoZXMgb2YgdGhlIHNwZWNpZmllZCBzZWxlY3RvciBpbnNpZGUgdGhlIHNwZWNpZmllZCBjb250YWluZXIuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGZpbmRcblx0XHQgKiBAcGFyYW0ge3RpbnltY2UudWkuQ29udHJvbH0gY29udGFpbmVyIENvbnRhaW5lciB0byBsb29rIGZvciBpdGVtcyBpbi5cblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLnVpLkNvbGxlY3Rpb259IENvbGxlY3Rpb24gd2l0aCBtYXRjaGVkIGVsZW1lbnRzLlxuXHRcdCAqL1xuXHRcdGZpbmQ6IGZ1bmN0aW9uKGNvbnRhaW5lcikge1xuXHRcdFx0dmFyIG1hdGNoZXMgPSBbXSwgaSwgbCwgc2VsZWN0b3JzID0gdGhpcy5fc2VsZWN0b3JzO1xuXG5cdFx0XHRmdW5jdGlvbiBjb2xsZWN0KGl0ZW1zLCBzZWxlY3RvciwgaW5kZXgpIHtcblx0XHRcdFx0dmFyIGksIGwsIGZpLCBmbCwgaXRlbSwgZmlsdGVycyA9IHNlbGVjdG9yW2luZGV4XTtcblxuXHRcdFx0XHRmb3IgKGkgPSAwLCBsID0gaXRlbXMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG5cdFx0XHRcdFx0aXRlbSA9IGl0ZW1zW2ldO1xuXG5cdFx0XHRcdFx0Ly8gUnVuIGVhY2ggZmlsdGVyIGFnYWluc3QgdGhlIGl0ZW1cblx0XHRcdFx0XHRmb3IgKGZpID0gMCwgZmwgPSBmaWx0ZXJzLmxlbmd0aDsgZmkgPCBmbDsgZmkrKykge1xuXHRcdFx0XHRcdFx0aWYgKCFmaWx0ZXJzW2ZpXShpdGVtLCBpLCBsKSkge1xuXHRcdFx0XHRcdFx0XHRmaSA9IGZsICsgMTtcblx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Ly8gQWxsIGZpbHRlcnMgbWF0Y2hlZCB0aGUgaXRlbVxuXHRcdFx0XHRcdGlmIChmaSA9PT0gZmwpIHtcblx0XHRcdFx0XHRcdC8vIE1hdGNoZWQgaXRlbSBpcyBvbiB0aGUgbGFzdCBleHByZXNzaW9uIGxpa2U6IHBhbmVsIHRvb2xiYXIgW2J1dHRvbl1cblx0XHRcdFx0XHRcdGlmIChpbmRleCA9PSBzZWxlY3Rvci5sZW5ndGggLSAxKSB7XG5cdFx0XHRcdFx0XHRcdG1hdGNoZXMucHVzaChpdGVtKTtcblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdC8vIENvbGxlY3QgbmV4dCBleHByZXNzaW9uIHR5cGVcblx0XHRcdFx0XHRcdFx0aWYgKGl0ZW0uaXRlbXMpIHtcblx0XHRcdFx0XHRcdFx0XHRjb2xsZWN0KGl0ZW0uaXRlbXMoKSwgc2VsZWN0b3IsIGluZGV4ICsgMSk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9IGVsc2UgaWYgKGZpbHRlcnMuZGlyZWN0KSB7XG5cdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Ly8gQ29sbGVjdCBjaGlsZCBpdGVtc1xuXHRcdFx0XHRcdGlmIChpdGVtLml0ZW1zKSB7XG5cdFx0XHRcdFx0XHRjb2xsZWN0KGl0ZW0uaXRlbXMoKSwgc2VsZWN0b3IsIGluZGV4KTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKGNvbnRhaW5lci5pdGVtcykge1xuXHRcdFx0XHRmb3IgKGkgPSAwLCBsID0gc2VsZWN0b3JzLmxlbmd0aDsgaSA8IGw7IGkrKykge1xuXHRcdFx0XHRcdGNvbGxlY3QoY29udGFpbmVyLml0ZW1zKCksIHNlbGVjdG9yc1tpXSwgMCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBVbmlxdWUgdGhlIG1hdGNoZXMgaWYgbmVlZGVkXG5cdFx0XHRcdGlmIChsID4gMSkge1xuXHRcdFx0XHRcdG1hdGNoZXMgPSB1bmlxdWUobWF0Y2hlcyk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0Ly8gRml4IGZvciBjaXJjdWxhciByZWZlcmVuY2Vcblx0XHRcdGlmICghQ29sbGVjdGlvbikge1xuXHRcdFx0XHQvLyBUT0RPOiBGaXggbWUhXG5cdFx0XHRcdENvbGxlY3Rpb24gPSBTZWxlY3Rvci5Db2xsZWN0aW9uO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbmV3IENvbGxlY3Rpb24obWF0Y2hlcyk7XG5cdFx0fVxuXHR9KTtcblxuXHRyZXR1cm4gU2VsZWN0b3I7XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL3VpL0NvbGxlY3Rpb24uanNcblxuLyoqXG4gKiBDb2xsZWN0aW9uLmpzXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgTEdQTCBMaWNlbnNlLlxuICogQ29weXJpZ2h0IChjKSAxOTk5LTIwMTUgRXBob3ggQ29ycC4gQWxsIHJpZ2h0cyByZXNlcnZlZFxuICpcbiAqIExpY2Vuc2U6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vbGljZW5zZVxuICogQ29udHJpYnV0aW5nOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2NvbnRyaWJ1dGluZ1xuICovXG5cbi8qKlxuICogQ29udHJvbCBjb2xsZWN0aW9uLCB0aGlzIGNsYXNzIGNvbnRhaW5zIGNvbnRyb2wgaW5zdGFuY2VzIGFuZCBpdCBlbmFibGVzIHlvdSB0b1xuICogcGVyZm9ybSBhY3Rpb25zIG9uIGFsbCB0aGUgY29udGFpbmVkIGl0ZW1zLiBUaGlzIGlzIHZlcnkgc2ltaWxhciB0byBob3cgalF1ZXJ5IHdvcmtzLlxuICpcbiAqIEBleGFtcGxlXG4gKiBzb21lQ29sbGVjdGlvbi5zaG93KCkuZGlzYWJsZWQodHJ1ZSk7XG4gKlxuICogQGNsYXNzIHRpbnltY2UudWkuQ29sbGVjdGlvblxuICovXG5kZWZpbmUoXCJ0aW55bWNlL3VpL0NvbGxlY3Rpb25cIiwgW1xuXHRcInRpbnltY2UvdXRpbC9Ub29sc1wiLFxuXHRcInRpbnltY2UvdWkvU2VsZWN0b3JcIixcblx0XCJ0aW55bWNlL3V0aWwvQ2xhc3NcIlxuXSwgZnVuY3Rpb24oVG9vbHMsIFNlbGVjdG9yLCBDbGFzcykge1xuXHRcInVzZSBzdHJpY3RcIjtcblxuXHR2YXIgQ29sbGVjdGlvbiwgcHJvdG8sIHB1c2ggPSBBcnJheS5wcm90b3R5cGUucHVzaCwgc2xpY2UgPSBBcnJheS5wcm90b3R5cGUuc2xpY2U7XG5cblx0cHJvdG8gPSB7XG5cdFx0LyoqXG5cdFx0ICogQ3VycmVudCBudW1iZXIgb2YgY29udGFpbmVkIGNvbnRyb2wgaW5zdGFuY2VzLlxuXHRcdCAqXG5cdFx0ICogQGZpZWxkIGxlbmd0aFxuXHRcdCAqIEB0eXBlIE51bWJlclxuXHRcdCAqL1xuXHRcdGxlbmd0aDogMCxcblxuXHRcdC8qKlxuXHRcdCAqIENvbnN0cnVjdG9yIGZvciB0aGUgY29sbGVjdGlvbi5cblx0XHQgKlxuXHRcdCAqIEBjb25zdHJ1Y3RvclxuXHRcdCAqIEBtZXRob2QgaW5pdFxuXHRcdCAqIEBwYXJhbSB7QXJyYXl9IGl0ZW1zIE9wdGlvbmFsIGFycmF5IHdpdGggaXRlbXMgdG8gYWRkLlxuXHRcdCAqL1xuXHRcdGluaXQ6IGZ1bmN0aW9uKGl0ZW1zKSB7XG5cdFx0XHRpZiAoaXRlbXMpIHtcblx0XHRcdFx0dGhpcy5hZGQoaXRlbXMpO1xuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBBZGRzIG5ldyBpdGVtcyB0byB0aGUgY29udHJvbCBjb2xsZWN0aW9uLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBhZGRcblx0XHQgKiBAcGFyYW0ge0FycmF5fSBpdGVtcyBBcnJheSBpZiBpdGVtcyB0byBhZGQgdG8gY29sbGVjdGlvbi5cblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLnVpLkNvbGxlY3Rpb259IEN1cnJlbnQgY29sbGVjdGlvbiBpbnN0YW5jZS5cblx0XHQgKi9cblx0XHRhZGQ6IGZ1bmN0aW9uKGl0ZW1zKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdC8vIEZvcmNlIHNpbmdsZSBpdGVtIGludG8gYXJyYXlcblx0XHRcdGlmICghVG9vbHMuaXNBcnJheShpdGVtcykpIHtcblx0XHRcdFx0aWYgKGl0ZW1zIGluc3RhbmNlb2YgQ29sbGVjdGlvbikge1xuXHRcdFx0XHRcdHNlbGYuYWRkKGl0ZW1zLnRvQXJyYXkoKSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0cHVzaC5jYWxsKHNlbGYsIGl0ZW1zKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0cHVzaC5hcHBseShzZWxmLCBpdGVtcyk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBzZWxmO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBTZXRzIHRoZSBjb250ZW50cyBvZiB0aGUgY29sbGVjdGlvbi4gVGhpcyB3aWxsIHJlbW92ZSBhbnkgZXhpc3RpbmcgaXRlbXNcblx0XHQgKiBhbmQgcmVwbGFjZSB0aGVtIHdpdGggdGhlIG9uZXMgc3BlY2lmaWVkIGluIHRoZSBpbnB1dCBhcnJheS5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2Qgc2V0XG5cdFx0ICogQHBhcmFtIHtBcnJheX0gaXRlbXMgQXJyYXkgd2l0aCBpdGVtcyB0byBzZXQgaW50byB0aGUgQ29sbGVjdGlvbi5cblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLnVpLkNvbGxlY3Rpb259IENvbGxlY3Rpb24gaW5zdGFuY2UuXG5cdFx0ICovXG5cdFx0c2V0OiBmdW5jdGlvbihpdGVtcykge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLCBsZW4gPSBzZWxmLmxlbmd0aCwgaTtcblxuXHRcdFx0c2VsZi5sZW5ndGggPSAwO1xuXHRcdFx0c2VsZi5hZGQoaXRlbXMpO1xuXG5cdFx0XHQvLyBSZW1vdmUgb2xkIGVudHJpZXNcblx0XHRcdGZvciAoaSA9IHNlbGYubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcblx0XHRcdFx0ZGVsZXRlIHNlbGZbaV07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBzZWxmO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBGaWx0ZXJzIHRoZSBjb2xsZWN0aW9uIGl0ZW0gYmFzZWQgb24gdGhlIHNwZWNpZmllZCBzZWxlY3RvciBleHByZXNzaW9uIG9yIHNlbGVjdG9yIGZ1bmN0aW9uLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBmaWx0ZXJcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gc2VsZWN0b3IgU2VsZWN0b3IgZXhwcmVzc2lvbiB0byBmaWx0ZXIgaXRlbXMgYnkuXG5cdFx0ICogQHJldHVybiB7dGlueW1jZS51aS5Db2xsZWN0aW9ufSBDb2xsZWN0aW9uIGNvbnRhaW5pbmcgdGhlIGZpbHRlcmVkIGl0ZW1zLlxuXHRcdCAqL1xuXHRcdGZpbHRlcjogZnVuY3Rpb24oc2VsZWN0b3IpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgaSwgbCwgbWF0Y2hlcyA9IFtdLCBpdGVtLCBtYXRjaDtcblxuXHRcdFx0Ly8gQ29tcGlsZSBzdHJpbmcgaW50byBzZWxlY3RvciBleHByZXNzaW9uXG5cdFx0XHRpZiAodHlwZW9mIHNlbGVjdG9yID09PSBcInN0cmluZ1wiKSB7XG5cdFx0XHRcdHNlbGVjdG9yID0gbmV3IFNlbGVjdG9yKHNlbGVjdG9yKTtcblxuXHRcdFx0XHRtYXRjaCA9IGZ1bmN0aW9uKGl0ZW0pIHtcblx0XHRcdFx0XHRyZXR1cm4gc2VsZWN0b3IubWF0Y2goaXRlbSk7XG5cdFx0XHRcdH07XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQvLyBVc2Ugc2VsZWN0b3IgYXMgbWF0Y2hpbmcgZnVuY3Rpb25cblx0XHRcdFx0bWF0Y2ggPSBzZWxlY3Rvcjtcblx0XHRcdH1cblxuXHRcdFx0Zm9yIChpID0gMCwgbCA9IHNlbGYubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG5cdFx0XHRcdGl0ZW0gPSBzZWxmW2ldO1xuXG5cdFx0XHRcdGlmIChtYXRjaChpdGVtKSkge1xuXHRcdFx0XHRcdG1hdGNoZXMucHVzaChpdGVtKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbmV3IENvbGxlY3Rpb24obWF0Y2hlcyk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFNsaWNlcyB0aGUgaXRlbXMgd2l0aGluIHRoZSBjb2xsZWN0aW9uLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBzbGljZVxuXHRcdCAqIEBwYXJhbSB7TnVtYmVyfSBpbmRleCBJbmRleCB0byBzbGljZSBhdC5cblx0XHQgKiBAcGFyYW0ge051bWJlcn0gbGVuIE9wdGlvbmFsIGxlbmd0aCB0byBzbGljZS5cblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLnVpLkNvbGxlY3Rpb259IEN1cnJlbnQgY29sbGVjdGlvbi5cblx0XHQgKi9cblx0XHRzbGljZTogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gbmV3IENvbGxlY3Rpb24oc2xpY2UuYXBwbHkodGhpcywgYXJndW1lbnRzKSk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIE1ha2VzIHRoZSBjdXJyZW50IGNvbGxlY3Rpb24gZXF1YWwgdG8gdGhlIHNwZWNpZmllZCBpbmRleC5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgZXFcblx0XHQgKiBAcGFyYW0ge051bWJlcn0gaW5kZXggSW5kZXggb2YgdGhlIGl0ZW0gdG8gc2V0IHRoZSBjb2xsZWN0aW9uIHRvLlxuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UudWkuQ29sbGVjdGlvbn0gQ3VycmVudCBjb2xsZWN0aW9uLlxuXHRcdCAqL1xuXHRcdGVxOiBmdW5jdGlvbihpbmRleCkge1xuXHRcdFx0cmV0dXJuIGluZGV4ID09PSAtMSA/IHRoaXMuc2xpY2UoaW5kZXgpIDogdGhpcy5zbGljZShpbmRleCwgK2luZGV4ICsgMSk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIEV4ZWN1dGVzIHRoZSBzcGVjaWZpZWQgY2FsbGJhY2sgb24gZWFjaCBpdGVtIGluIGNvbGxlY3Rpb24uXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGVhY2hcblx0XHQgKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayB0byBleGVjdXRlIGZvciBlYWNoIGl0ZW0gaW4gY29sbGVjdGlvbi5cblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLnVpLkNvbGxlY3Rpb259IEN1cnJlbnQgY29sbGVjdGlvbiBpbnN0YW5jZS5cblx0XHQgKi9cblx0XHRlYWNoOiBmdW5jdGlvbihjYWxsYmFjaykge1xuXHRcdFx0VG9vbHMuZWFjaCh0aGlzLCBjYWxsYmFjayk7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZXR1cm5zIGFuIEphdmFTY3JpcHQgYXJyYXkgb2JqZWN0IG9mIHRoZSBjb250ZW50cyBpbnNpZGUgdGhlIGNvbGxlY3Rpb24uXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHRvQXJyYXlcblx0XHQgKiBAcmV0dXJuIHtBcnJheX0gQXJyYXkgd2l0aCBhbGwgaXRlbXMgZnJvbSBjb2xsZWN0aW9uLlxuXHRcdCAqL1xuXHRcdHRvQXJyYXk6IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIFRvb2xzLnRvQXJyYXkodGhpcyk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIEZpbmRzIHRoZSBpbmRleCBvZiB0aGUgc3BlY2lmaWVkIGNvbnRyb2wgb3IgcmV0dXJuIC0xIGlmIGl0IGlzbid0IGluIHRoZSBjb2xsZWN0aW9uLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBpbmRleE9mXG5cdFx0ICogQHBhcmFtIHtDb250cm9sfSBjdHJsIENvbnRyb2wgaW5zdGFuY2UgdG8gbG9vayBmb3IuXG5cdFx0ICogQHJldHVybiB7TnVtYmVyfSBJbmRleCBvZiB0aGUgc3BlY2lmaWVkIGNvbnRyb2wgb3IgLTEuXG5cdFx0ICovXG5cdFx0aW5kZXhPZjogZnVuY3Rpb24oY3RybCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLCBpID0gc2VsZi5sZW5ndGg7XG5cblx0XHRcdHdoaWxlIChpLS0pIHtcblx0XHRcdFx0aWYgKHNlbGZbaV0gPT09IGN0cmwpIHtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gaTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyBhIG5ldyBjb2xsZWN0aW9uIG9mIHRoZSBjb250ZW50cyBpbiByZXZlcnNlIG9yZGVyLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCByZXZlcnNlXG5cdFx0ICogQHJldHVybiB7dGlueW1jZS51aS5Db2xsZWN0aW9ufSBDb2xsZWN0aW9uIGluc3RhbmNlIHdpdGggcmV2ZXJzZWQgaXRlbXMuXG5cdFx0ICovXG5cdFx0cmV2ZXJzZTogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gbmV3IENvbGxlY3Rpb24oVG9vbHMudG9BcnJheSh0aGlzKS5yZXZlcnNlKCkpO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZXR1cm5zIHRydWUvZmFsc2UgaWYgdGhlIGNsYXNzIGV4aXN0cyBvciBub3QuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGhhc0NsYXNzXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IGNscyBDbGFzcyB0byBjaGVjayBmb3IuXG5cdFx0ICogQHJldHVybiB7Qm9vbGVhbn0gdHJ1ZS9mYWxzZSBzdGF0ZSBpZiB0aGUgY2xhc3MgZXhpc3RzIG9yIG5vdC5cblx0XHQgKi9cblx0XHRoYXNDbGFzczogZnVuY3Rpb24oY2xzKSB7XG5cdFx0XHRyZXR1cm4gdGhpc1swXSA/IHRoaXNbMF0uY2xhc3Nlcy5jb250YWlucyhjbHMpIDogZmFsc2U7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFNldHMvZ2V0cyB0aGUgc3BlY2lmaWMgcHJvcGVydHkgb24gdGhlIGl0ZW1zIGluIHRoZSBjb2xsZWN0aW9uLiBUaGUgc2FtZSBhcyBleGVjdXRpbmcgY29udHJvbC48cHJvcGVydHk+KDx2YWx1ZT4pO1xuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBwcm9wXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IG5hbWUgUHJvcGVydHkgbmFtZSB0byBnZXQvc2V0LlxuXHRcdCAqIEBwYXJhbSB7T2JqZWN0fSB2YWx1ZSBPcHRpb25hbCBvYmplY3QgdmFsdWUgdG8gc2V0LlxuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UudWkuQ29sbGVjdGlvbn0gQ3VycmVudCBjb2xsZWN0aW9uIGluc3RhbmNlIG9yIHZhbHVlIG9mIHRoZSBmaXJzdCBpdGVtIG9uIGEgZ2V0IG9wZXJhdGlvbi5cblx0XHQgKi9cblx0XHRwcm9wOiBmdW5jdGlvbihuYW1lLCB2YWx1ZSkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLCB1bmRlZiwgaXRlbTtcblxuXHRcdFx0aWYgKHZhbHVlICE9PSB1bmRlZikge1xuXHRcdFx0XHRzZWxmLmVhY2goZnVuY3Rpb24oaXRlbSkge1xuXHRcdFx0XHRcdGlmIChpdGVtW25hbWVdKSB7XG5cdFx0XHRcdFx0XHRpdGVtW25hbWVdKHZhbHVlKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdHJldHVybiBzZWxmO1xuXHRcdFx0fVxuXG5cdFx0XHRpdGVtID0gc2VsZlswXTtcblxuXHRcdFx0aWYgKGl0ZW0gJiYgaXRlbVtuYW1lXSkge1xuXHRcdFx0XHRyZXR1cm4gaXRlbVtuYW1lXSgpO1xuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBFeGVjdXRlcyB0aGUgc3BlY2lmaWMgZnVuY3Rpb24gbmFtZSB3aXRoIG9wdGlvbmFsIGFyZ3VtZW50cyBhbiBhbGwgaXRlbXMgaW4gY29sbGVjdGlvbiBpZiBpdCBleGlzdHMuXG5cdFx0ICpcblx0XHQgKiBAZXhhbXBsZSBjb2xsZWN0aW9uLmV4ZWMoXCJteU1ldGhvZFwiLCBhcmcxLCBhcmcyLCBhcmczKTtcblx0XHQgKiBAbWV0aG9kIGV4ZWNcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSBOYW1lIG9mIHRoZSBmdW5jdGlvbiB0byBleGVjdXRlLlxuXHRcdCAqIEBwYXJhbSB7T2JqZWN0fSAuLi4gTXVsdGlwbGUgYXJndW1lbnRzIHRvIHBhc3MgdG8gZWFjaCBmdW5jdGlvbi5cblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLnVpLkNvbGxlY3Rpb259IEN1cnJlbnQgY29sbGVjdGlvbi5cblx0XHQgKi9cblx0XHRleGVjOiBmdW5jdGlvbihuYW1lKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIGFyZ3MgPSBUb29scy50b0FycmF5KGFyZ3VtZW50cykuc2xpY2UoMSk7XG5cblx0XHRcdHNlbGYuZWFjaChmdW5jdGlvbihpdGVtKSB7XG5cdFx0XHRcdGlmIChpdGVtW25hbWVdKSB7XG5cdFx0XHRcdFx0aXRlbVtuYW1lXS5hcHBseShpdGVtLCBhcmdzKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdHJldHVybiBzZWxmO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZW1vdmUgYWxsIGl0ZW1zIGZyb20gY29sbGVjdGlvbiBhbmQgRE9NLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCByZW1vdmVcblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLnVpLkNvbGxlY3Rpb259IEN1cnJlbnQgY29sbGVjdGlvbi5cblx0XHQgKi9cblx0XHRyZW1vdmU6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIGkgPSB0aGlzLmxlbmd0aDtcblxuXHRcdFx0d2hpbGUgKGktLSkge1xuXHRcdFx0XHR0aGlzW2ldLnJlbW92ZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogQWRkcyBhIGNsYXNzIHRvIGFsbCBpdGVtcyBpbiB0aGUgY29sbGVjdGlvbi5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgYWRkQ2xhc3Ncblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gY2xzIENsYXNzIHRvIGFkZCB0byBlYWNoIGl0ZW0uXG5cdFx0ICogQHJldHVybiB7dGlueW1jZS51aS5Db2xsZWN0aW9ufSBDdXJyZW50IGNvbGxlY3Rpb24gaW5zdGFuY2UuXG5cdFx0ICovXG5cdFx0YWRkQ2xhc3M6IGZ1bmN0aW9uKGNscykge1xuXHRcdFx0cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihpdGVtKSB7XG5cdFx0XHRcdGl0ZW0uY2xhc3Nlcy5hZGQoY2xzKTtcblx0XHRcdH0pO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZW1vdmVzIHRoZSBzcGVjaWZpZWQgY2xhc3MgZnJvbSBhbGwgaXRlbXMgaW4gY29sbGVjdGlvbi5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgcmVtb3ZlQ2xhc3Ncblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gY2xzIENsYXNzIHRvIHJlbW92ZSBmcm9tIGVhY2ggaXRlbS5cblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLnVpLkNvbGxlY3Rpb259IEN1cnJlbnQgY29sbGVjdGlvbiBpbnN0YW5jZS5cblx0XHQgKi9cblx0XHRyZW1vdmVDbGFzczogZnVuY3Rpb24oY2xzKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcblx0XHRcdFx0aXRlbS5jbGFzc2VzLnJlbW92ZShjbHMpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0LyoqXG5cdFx0ICogRmlyZXMgdGhlIHNwZWNpZmllZCBldmVudCBieSBuYW1lIGFuZCBhcmd1bWVudHMgb24gdGhlIGNvbnRyb2wuIFRoaXMgd2lsbCBleGVjdXRlIGFsbFxuXHRcdCAqIGJvdW5kIGV2ZW50IGhhbmRsZXJzLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBmaXJlXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IG5hbWUgTmFtZSBvZiB0aGUgZXZlbnQgdG8gZmlyZS5cblx0XHQgKiBAcGFyYW0ge09iamVjdH0gYXJncyBPcHRpb25hbCBhcmd1bWVudHMgdG8gcGFzcyB0byB0aGUgZXZlbnQuXG5cdFx0ICogQHJldHVybiB7dGlueW1jZS51aS5Db2xsZWN0aW9ufSBDdXJyZW50IGNvbGxlY3Rpb24gaW5zdGFuY2UuXG5cdFx0ICovXG5cdFx0Ly8gZmlyZTogZnVuY3Rpb24oZXZlbnQsIGFyZ3MpIHt9LCAtLSBHZW5lcmF0ZWQgYnkgY29kZSBiZWxvd1xuXG5cdFx0LyoqXG5cdFx0ICogQmluZHMgYSBjYWxsYmFjayB0byB0aGUgc3BlY2lmaWVkIGV2ZW50LiBUaGlzIGV2ZW50IGNhbiBib3RoIGJlXG5cdFx0ICogbmF0aXZlIGJyb3dzZXIgZXZlbnRzIGxpa2UgXCJjbGlja1wiIG9yIGN1c3RvbSBvbmVzIGxpa2UgUG9zdFJlbmRlci5cblx0XHQgKlxuXHRcdCAqIFRoZSBjYWxsYmFjayBmdW5jdGlvbiB3aWxsIGhhdmUgdHdvIHBhcmFtZXRlcnMgdGhlIGZpcnN0IG9uZSBiZWluZyB0aGUgY29udHJvbCB0aGF0IHJlY2VpdmVkIHRoZSBldmVudFxuXHRcdCAqIHRoZSBzZWNvbmQgb25lIHdpbGwgYmUgdGhlIGV2ZW50IG9iamVjdCBlaXRoZXIgdGhlIGJyb3dzZXJzIG5hdGl2ZSBldmVudCBvYmplY3Qgb3IgYSBjdXN0b20gSlMgb2JqZWN0LlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBvblxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIE5hbWUgb2YgdGhlIGV2ZW50IHRvIGJpbmQuIEZvciBleGFtcGxlIFwiY2xpY2tcIi5cblx0XHQgKiBAcGFyYW0ge1N0cmluZy9mdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gZXhlY3V0ZSBvbmVzIHRoZSBldmVudCBvY2N1cnMuXG5cdFx0ICogQHJldHVybiB7dGlueW1jZS51aS5Db2xsZWN0aW9ufSBDdXJyZW50IGNvbGxlY3Rpb24gaW5zdGFuY2UuXG5cdFx0ICovXG5cdFx0Ly8gb246IGZ1bmN0aW9uKG5hbWUsIGNhbGxiYWNrKSB7fSwgLS0gR2VuZXJhdGVkIGJ5IGNvZGUgYmVsb3dcblxuXHRcdC8qKlxuXHRcdCAqIFVuYmluZHMgdGhlIHNwZWNpZmllZCBldmVudCBhbmQgb3B0aW9uYWxseSBhIHNwZWNpZmljIGNhbGxiYWNrLiBJZiB5b3Ugb21pdCB0aGUgbmFtZVxuXHRcdCAqIHBhcmFtZXRlciBhbGwgZXZlbnQgaGFuZGxlcnMgd2lsbCBiZSByZW1vdmVkLiBJZiB5b3Ugb21pdCB0aGUgY2FsbGJhY2sgYWxsIGV2ZW50IGhhbmRsZXNcblx0XHQgKiBieSB0aGUgc3BlY2lmaWVkIG5hbWUgd2lsbCBiZSByZW1vdmVkLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBvZmZcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSBPcHRpb25hbCBuYW1lIGZvciB0aGUgZXZlbnQgdG8gdW5iaW5kLlxuXHRcdCAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrIE9wdGlvbmFsIGNhbGxiYWNrIGZ1bmN0aW9uIHRvIHVuYmluZC5cblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLnVpLkNvbGxlY3Rpb259IEN1cnJlbnQgY29sbGVjdGlvbiBpbnN0YW5jZS5cblx0XHQgKi9cblx0XHQvLyBvZmY6IGZ1bmN0aW9uKG5hbWUsIGNhbGxiYWNrKSB7fSwgLS0gR2VuZXJhdGVkIGJ5IGNvZGUgYmVsb3dcblxuXHRcdC8qKlxuXHRcdCAqIFNob3dzIHRoZSBpdGVtcyBpbiB0aGUgY3VycmVudCBjb2xsZWN0aW9uLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBzaG93XG5cdFx0ICogQHJldHVybiB7dGlueW1jZS51aS5Db2xsZWN0aW9ufSBDdXJyZW50IGNvbGxlY3Rpb24gaW5zdGFuY2UuXG5cdFx0ICovXG5cdFx0Ly8gc2hvdzogZnVuY3Rpb24oKSB7fSwgLS0gR2VuZXJhdGVkIGJ5IGNvZGUgYmVsb3dcblxuXHRcdC8qKlxuXHRcdCAqIEhpZGVzIHRoZSBpdGVtcyBpbiB0aGUgY3VycmVudCBjb2xsZWN0aW9uLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBoaWRlXG5cdFx0ICogQHJldHVybiB7dGlueW1jZS51aS5Db2xsZWN0aW9ufSBDdXJyZW50IGNvbGxlY3Rpb24gaW5zdGFuY2UuXG5cdFx0ICovXG5cdFx0Ly8gaGlkZTogZnVuY3Rpb24oKSB7fSwgLS0gR2VuZXJhdGVkIGJ5IGNvZGUgYmVsb3dcblxuXHRcdC8qKlxuXHRcdCAqIFNldHMvZ2V0cyB0aGUgdGV4dCBjb250ZW50cyBvZiB0aGUgaXRlbXMgaW4gdGhlIGN1cnJlbnQgY29sbGVjdGlvbi5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgdGV4dFxuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UudWkuQ29sbGVjdGlvbn0gQ3VycmVudCBjb2xsZWN0aW9uIGluc3RhbmNlIG9yIHRleHQgdmFsdWUgb2YgdGhlIGZpcnN0IGl0ZW0gb24gYSBnZXQgb3BlcmF0aW9uLlxuXHRcdCAqL1xuXHRcdC8vIHRleHQ6IGZ1bmN0aW9uKHZhbHVlKSB7fSwgLS0gR2VuZXJhdGVkIGJ5IGNvZGUgYmVsb3dcblxuXHRcdC8qKlxuXHRcdCAqIFNldHMvZ2V0cyB0aGUgbmFtZSBjb250ZW50cyBvZiB0aGUgaXRlbXMgaW4gdGhlIGN1cnJlbnQgY29sbGVjdGlvbi5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgbmFtZVxuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UudWkuQ29sbGVjdGlvbn0gQ3VycmVudCBjb2xsZWN0aW9uIGluc3RhbmNlIG9yIG5hbWUgdmFsdWUgb2YgdGhlIGZpcnN0IGl0ZW0gb24gYSBnZXQgb3BlcmF0aW9uLlxuXHRcdCAqL1xuXHRcdC8vIG5hbWU6IGZ1bmN0aW9uKHZhbHVlKSB7fSwgLS0gR2VuZXJhdGVkIGJ5IGNvZGUgYmVsb3dcblxuXHRcdC8qKlxuXHRcdCAqIFNldHMvZ2V0cyB0aGUgZGlzYWJsZWQgc3RhdGUgb24gdGhlIGl0ZW1zIGluIHRoZSBjdXJyZW50IGNvbGxlY3Rpb24uXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGRpc2FibGVkXG5cdFx0ICogQHJldHVybiB7dGlueW1jZS51aS5Db2xsZWN0aW9ufSBDdXJyZW50IGNvbGxlY3Rpb24gaW5zdGFuY2Ugb3IgZGlzYWJsZWQgc3RhdGUgb2YgdGhlIGZpcnN0IGl0ZW0gb24gYSBnZXQgb3BlcmF0aW9uLlxuXHRcdCAqL1xuXHRcdC8vIGRpc2FibGVkOiBmdW5jdGlvbihzdGF0ZSkge30sIC0tIEdlbmVyYXRlZCBieSBjb2RlIGJlbG93XG5cblx0XHQvKipcblx0XHQgKiBTZXRzL2dldHMgdGhlIGFjdGl2ZSBzdGF0ZSBvbiB0aGUgaXRlbXMgaW4gdGhlIGN1cnJlbnQgY29sbGVjdGlvbi5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgYWN0aXZlXG5cdFx0ICogQHJldHVybiB7dGlueW1jZS51aS5Db2xsZWN0aW9ufSBDdXJyZW50IGNvbGxlY3Rpb24gaW5zdGFuY2Ugb3IgYWN0aXZlIHN0YXRlIG9mIHRoZSBmaXJzdCBpdGVtIG9uIGEgZ2V0IG9wZXJhdGlvbi5cblx0XHQgKi9cblx0XHQvLyBhY3RpdmU6IGZ1bmN0aW9uKHN0YXRlKSB7fSwgLS0gR2VuZXJhdGVkIGJ5IGNvZGUgYmVsb3dcblxuXHRcdC8qKlxuXHRcdCAqIFNldHMvZ2V0cyB0aGUgc2VsZWN0ZWQgc3RhdGUgb24gdGhlIGl0ZW1zIGluIHRoZSBjdXJyZW50IGNvbGxlY3Rpb24uXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHNlbGVjdGVkXG5cdFx0ICogQHJldHVybiB7dGlueW1jZS51aS5Db2xsZWN0aW9ufSBDdXJyZW50IGNvbGxlY3Rpb24gaW5zdGFuY2Ugb3Igc2VsZWN0ZWQgc3RhdGUgb2YgdGhlIGZpcnN0IGl0ZW0gb24gYSBnZXQgb3BlcmF0aW9uLlxuXHRcdCAqL1xuXHRcdC8vIHNlbGVjdGVkOiBmdW5jdGlvbihzdGF0ZSkge30sIC0tIEdlbmVyYXRlZCBieSBjb2RlIGJlbG93XG5cblx0XHQvKipcblx0XHQgKiBTZXRzL2dldHMgdGhlIHNlbGVjdGVkIHN0YXRlIG9uIHRoZSBpdGVtcyBpbiB0aGUgY3VycmVudCBjb2xsZWN0aW9uLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCB2aXNpYmxlXG5cdFx0ICogQHJldHVybiB7dGlueW1jZS51aS5Db2xsZWN0aW9ufSBDdXJyZW50IGNvbGxlY3Rpb24gaW5zdGFuY2Ugb3IgdmlzaWJsZSBzdGF0ZSBvZiB0aGUgZmlyc3QgaXRlbSBvbiBhIGdldCBvcGVyYXRpb24uXG5cdFx0ICovXG5cdFx0Ly8gdmlzaWJsZTogZnVuY3Rpb24oc3RhdGUpIHt9LCAtLSBHZW5lcmF0ZWQgYnkgY29kZSBiZWxvd1xuXHR9O1xuXG5cdC8vIEV4dGVuZCB0aW55bWNlLnVpLkNvbGxlY3Rpb24gcHJvdG90eXBlIHdpdGggc29tZSBnZW5lcmF0ZWQgY29udHJvbCBzcGVjaWZpYyBtZXRob2RzXG5cdFRvb2xzLmVhY2goJ2ZpcmUgb24gb2ZmIHNob3cgaGlkZSBhcHBlbmQgcHJlcGVuZCBiZWZvcmUgYWZ0ZXIgcmVmbG93Jy5zcGxpdCgnICcpLCBmdW5jdGlvbihuYW1lKSB7XG5cdFx0cHJvdG9bbmFtZV0gPSBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBhcmdzID0gVG9vbHMudG9BcnJheShhcmd1bWVudHMpO1xuXG5cdFx0XHR0aGlzLmVhY2goZnVuY3Rpb24oY3RybCkge1xuXHRcdFx0XHRpZiAobmFtZSBpbiBjdHJsKSB7XG5cdFx0XHRcdFx0Y3RybFtuYW1lXS5hcHBseShjdHJsLCBhcmdzKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH07XG5cdH0pO1xuXG5cdC8vIEV4dGVuZCB0aW55bWNlLnVpLkNvbGxlY3Rpb24gcHJvdG90eXBlIHdpdGggc29tZSBwcm9wZXJ0eSBtZXRob2RzXG5cdFRvb2xzLmVhY2goJ3RleHQgbmFtZSBkaXNhYmxlZCBhY3RpdmUgc2VsZWN0ZWQgY2hlY2tlZCB2aXNpYmxlIHBhcmVudCB2YWx1ZSBkYXRhJy5zcGxpdCgnICcpLCBmdW5jdGlvbihuYW1lKSB7XG5cdFx0cHJvdG9bbmFtZV0gPSBmdW5jdGlvbih2YWx1ZSkge1xuXHRcdFx0cmV0dXJuIHRoaXMucHJvcChuYW1lLCB2YWx1ZSk7XG5cdFx0fTtcblx0fSk7XG5cblx0Ly8gQ3JlYXRlIGNsYXNzIGJhc2VkIG9uIHRoZSBuZXcgcHJvdG90eXBlXG5cdENvbGxlY3Rpb24gPSBDbGFzcy5leHRlbmQocHJvdG8pO1xuXG5cdC8vIFN0aWNrIENvbGxlY3Rpb24gaW50byBTZWxlY3RvciB0byBwcmV2ZW50IGNpcmN1YWwgcmVmZXJlbmNlc1xuXHRTZWxlY3Rvci5Db2xsZWN0aW9uID0gQ29sbGVjdGlvbjtcblxuXHRyZXR1cm4gQ29sbGVjdGlvbjtcbn0pO1xuXG4vLyBJbmNsdWRlZCBmcm9tOiBqcy90aW55bWNlL2NsYXNzZXMvdWkvRG9tVXRpbHMuanNcblxuLyoqXG4gKiBEb21VdGlscy5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE1IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKipcbiAqIFByaXZhdGUgVUkgRG9tVXRpbHMgcHJveHkuXG4gKlxuICogQHByaXZhdGVcbiAqIEBjbGFzcyB0aW55bWNlLnVpLkRvbVV0aWxzXG4gKi9cbmRlZmluZShcInRpbnltY2UvdWkvRG9tVXRpbHNcIiwgW1xuXHRcInRpbnltY2UvRW52XCIsXG5cdFwidGlueW1jZS91dGlsL1Rvb2xzXCIsXG5cdFwidGlueW1jZS9kb20vRE9NVXRpbHNcIlxuXSwgZnVuY3Rpb24oRW52LCBUb29scywgRE9NVXRpbHMpIHtcblx0XCJ1c2Ugc3RyaWN0XCI7XG5cblx0dmFyIGNvdW50ID0gMDtcblxuXHR2YXIgZnVuY3MgPSB7XG5cdFx0aWQ6IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuICdtY2V1XycgKyAoY291bnQrKyk7XG5cdFx0fSxcblxuXHRcdGNyZWF0ZTogZnVuY3Rpb24obmFtZSwgYXR0cnMsIGNoaWxkcmVuKSB7XG5cdFx0XHR2YXIgZWxtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChuYW1lKTtcblxuXHRcdFx0RE9NVXRpbHMuRE9NLnNldEF0dHJpYnMoZWxtLCBhdHRycyk7XG5cblx0XHRcdGlmICh0eXBlb2YgY2hpbGRyZW4gPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRcdGVsbS5pbm5lckhUTUwgPSBjaGlsZHJlbjtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFRvb2xzLmVhY2goY2hpbGRyZW4sIGZ1bmN0aW9uKGNoaWxkKSB7XG5cdFx0XHRcdFx0aWYgKGNoaWxkLm5vZGVUeXBlKSB7XG5cdFx0XHRcdFx0XHRlbG0uYXBwZW5kQ2hpbGQoY2hpbGQpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBlbG07XG5cdFx0fSxcblxuXHRcdGNyZWF0ZUZyYWdtZW50OiBmdW5jdGlvbihodG1sKSB7XG5cdFx0XHRyZXR1cm4gRE9NVXRpbHMuRE9NLmNyZWF0ZUZyYWdtZW50KGh0bWwpO1xuXHRcdH0sXG5cblx0XHRnZXRXaW5kb3dTaXplOiBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiBET01VdGlscy5ET00uZ2V0Vmlld1BvcnQoKTtcblx0XHR9LFxuXG5cdFx0Z2V0U2l6ZTogZnVuY3Rpb24oZWxtKSB7XG5cdFx0XHR2YXIgd2lkdGgsIGhlaWdodDtcblxuXHRcdFx0aWYgKGVsbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QpIHtcblx0XHRcdFx0dmFyIHJlY3QgPSBlbG0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG5cblx0XHRcdFx0d2lkdGggPSBNYXRoLm1heChyZWN0LndpZHRoIHx8IChyZWN0LnJpZ2h0IC0gcmVjdC5sZWZ0KSwgZWxtLm9mZnNldFdpZHRoKTtcblx0XHRcdFx0aGVpZ2h0ID0gTWF0aC5tYXgocmVjdC5oZWlnaHQgfHwgKHJlY3QuYm90dG9tIC0gcmVjdC5ib3R0b20pLCBlbG0ub2Zmc2V0SGVpZ2h0KTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHdpZHRoID0gZWxtLm9mZnNldFdpZHRoO1xuXHRcdFx0XHRoZWlnaHQgPSBlbG0ub2Zmc2V0SGVpZ2h0O1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4ge3dpZHRoOiB3aWR0aCwgaGVpZ2h0OiBoZWlnaHR9O1xuXHRcdH0sXG5cblx0XHRnZXRQb3M6IGZ1bmN0aW9uKGVsbSwgcm9vdCkge1xuXHRcdFx0cmV0dXJuIERPTVV0aWxzLkRPTS5nZXRQb3MoZWxtLCByb290IHx8IGZ1bmNzLmdldENvbnRhaW5lcigpKTtcblx0XHR9LFxuXG5cdFx0Z2V0Q29udGFpbmVyOiBmdW5jdGlvbiAoKSB7XG5cdFx0XHRyZXR1cm4gRW52LmNvbnRhaW5lciA/IEVudi5jb250YWluZXIgOiBkb2N1bWVudC5ib2R5O1xuXHRcdH0sXG5cblx0XHRnZXRWaWV3UG9ydDogZnVuY3Rpb24od2luKSB7XG5cdFx0XHRyZXR1cm4gRE9NVXRpbHMuRE9NLmdldFZpZXdQb3J0KHdpbik7XG5cdFx0fSxcblxuXHRcdGdldDogZnVuY3Rpb24oaWQpIHtcblx0XHRcdHJldHVybiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7XG5cdFx0fSxcblxuXHRcdGFkZENsYXNzOiBmdW5jdGlvbihlbG0sIGNscykge1xuXHRcdFx0cmV0dXJuIERPTVV0aWxzLkRPTS5hZGRDbGFzcyhlbG0sIGNscyk7XG5cdFx0fSxcblxuXHRcdHJlbW92ZUNsYXNzOiBmdW5jdGlvbihlbG0sIGNscykge1xuXHRcdFx0cmV0dXJuIERPTVV0aWxzLkRPTS5yZW1vdmVDbGFzcyhlbG0sIGNscyk7XG5cdFx0fSxcblxuXHRcdGhhc0NsYXNzOiBmdW5jdGlvbihlbG0sIGNscykge1xuXHRcdFx0cmV0dXJuIERPTVV0aWxzLkRPTS5oYXNDbGFzcyhlbG0sIGNscyk7XG5cdFx0fSxcblxuXHRcdHRvZ2dsZUNsYXNzOiBmdW5jdGlvbihlbG0sIGNscywgc3RhdGUpIHtcblx0XHRcdHJldHVybiBET01VdGlscy5ET00udG9nZ2xlQ2xhc3MoZWxtLCBjbHMsIHN0YXRlKTtcblx0XHR9LFxuXG5cdFx0Y3NzOiBmdW5jdGlvbihlbG0sIG5hbWUsIHZhbHVlKSB7XG5cdFx0XHRyZXR1cm4gRE9NVXRpbHMuRE9NLnNldFN0eWxlKGVsbSwgbmFtZSwgdmFsdWUpO1xuXHRcdH0sXG5cblx0XHRnZXRSdW50aW1lU3R5bGU6IGZ1bmN0aW9uKGVsbSwgbmFtZSkge1xuXHRcdFx0cmV0dXJuIERPTVV0aWxzLkRPTS5nZXRTdHlsZShlbG0sIG5hbWUsIHRydWUpO1xuXHRcdH0sXG5cblx0XHRvbjogZnVuY3Rpb24odGFyZ2V0LCBuYW1lLCBjYWxsYmFjaywgc2NvcGUpIHtcblx0XHRcdHJldHVybiBET01VdGlscy5ET00uYmluZCh0YXJnZXQsIG5hbWUsIGNhbGxiYWNrLCBzY29wZSk7XG5cdFx0fSxcblxuXHRcdG9mZjogZnVuY3Rpb24odGFyZ2V0LCBuYW1lLCBjYWxsYmFjaykge1xuXHRcdFx0cmV0dXJuIERPTVV0aWxzLkRPTS51bmJpbmQodGFyZ2V0LCBuYW1lLCBjYWxsYmFjayk7XG5cdFx0fSxcblxuXHRcdGZpcmU6IGZ1bmN0aW9uKHRhcmdldCwgbmFtZSwgYXJncykge1xuXHRcdFx0cmV0dXJuIERPTVV0aWxzLkRPTS5maXJlKHRhcmdldCwgbmFtZSwgYXJncyk7XG5cdFx0fSxcblxuXHRcdGlubmVySHRtbDogZnVuY3Rpb24oZWxtLCBodG1sKSB7XG5cdFx0XHQvLyBXb3JrYXJvdW5kIGZvciA8ZGl2PiBpbiA8cD4gYnVnIG9uIElFIDggIzYxNzhcblx0XHRcdERPTVV0aWxzLkRPTS5zZXRIVE1MKGVsbSwgaHRtbCk7XG5cdFx0fVxuXHR9O1xuXG5cdHJldHVybiBmdW5jcztcbn0pO1xuXG4vLyBJbmNsdWRlZCBmcm9tOiBqcy90aW55bWNlL2NsYXNzZXMvdWkvQm94VXRpbHMuanNcblxuLyoqXG4gKiBCb3hVdGlscy5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE1IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKipcbiAqIFV0aWxpdHkgY2xhc3MgZm9yIGJveCBwYXJzaW5nIGFuZCBtZWFzdXJpbmcuXG4gKlxuICogQHByaXZhdGVcbiAqIEBjbGFzcyB0aW55bWNlLnVpLkJveFV0aWxzXG4gKi9cbmRlZmluZShcInRpbnltY2UvdWkvQm94VXRpbHNcIiwgW1xuXSwgZnVuY3Rpb24oKSB7XG5cdFwidXNlIHN0cmljdFwiO1xuXG5cdHJldHVybiB7XG5cdFx0LyoqXG5cdFx0ICogUGFyc2VzIHRoZSBzcGVjaWZpZWQgYm94IHZhbHVlLiBBIGJveCB2YWx1ZSBjb250YWlucyAxLTQgcHJvcGVydGllcyBpbiBjbG9ja3dpc2Ugb3JkZXIuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHBhcnNlQm94XG5cdFx0ICogQHBhcmFtIHtTdHJpbmcvTnVtYmVyfSB2YWx1ZSBCb3ggdmFsdWUgXCIwIDEgMiAzXCIgb3IgXCIwXCIgZXRjLlxuXHRcdCAqIEByZXR1cm4ge09iamVjdH0gT2JqZWN0IHdpdGggdG9wL3JpZ2h0L2JvdHRvbS9sZWZ0IHByb3BlcnRpZXMuXG5cdFx0ICogQHByaXZhdGVcblx0XHQgKi9cblx0XHRwYXJzZUJveDogZnVuY3Rpb24odmFsdWUpIHtcblx0XHRcdHZhciBsZW4sIHJhZGl4ID0gMTA7XG5cblx0XHRcdGlmICghdmFsdWUpIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mIHZhbHVlID09PSBcIm51bWJlclwiKSB7XG5cdFx0XHRcdHZhbHVlID0gdmFsdWUgfHwgMDtcblxuXHRcdFx0XHRyZXR1cm4ge1xuXHRcdFx0XHRcdHRvcDogdmFsdWUsXG5cdFx0XHRcdFx0bGVmdDogdmFsdWUsXG5cdFx0XHRcdFx0Ym90dG9tOiB2YWx1ZSxcblx0XHRcdFx0XHRyaWdodDogdmFsdWVcblx0XHRcdFx0fTtcblx0XHRcdH1cblxuXHRcdFx0dmFsdWUgPSB2YWx1ZS5zcGxpdCgnICcpO1xuXHRcdFx0bGVuID0gdmFsdWUubGVuZ3RoO1xuXG5cdFx0XHRpZiAobGVuID09PSAxKSB7XG5cdFx0XHRcdHZhbHVlWzFdID0gdmFsdWVbMl0gPSB2YWx1ZVszXSA9IHZhbHVlWzBdO1xuXHRcdFx0fSBlbHNlIGlmIChsZW4gPT09IDIpIHtcblx0XHRcdFx0dmFsdWVbMl0gPSB2YWx1ZVswXTtcblx0XHRcdFx0dmFsdWVbM10gPSB2YWx1ZVsxXTtcblx0XHRcdH0gZWxzZSBpZiAobGVuID09PSAzKSB7XG5cdFx0XHRcdHZhbHVlWzNdID0gdmFsdWVbMV07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiB7XG5cdFx0XHRcdHRvcDogcGFyc2VJbnQodmFsdWVbMF0sIHJhZGl4KSB8fCAwLFxuXHRcdFx0XHRyaWdodDogcGFyc2VJbnQodmFsdWVbMV0sIHJhZGl4KSB8fCAwLFxuXHRcdFx0XHRib3R0b206IHBhcnNlSW50KHZhbHVlWzJdLCByYWRpeCkgfHwgMCxcblx0XHRcdFx0bGVmdDogcGFyc2VJbnQodmFsdWVbM10sIHJhZGl4KSB8fCAwXG5cdFx0XHR9O1xuXHRcdH0sXG5cblx0XHRtZWFzdXJlQm94OiBmdW5jdGlvbihlbG0sIHByZWZpeCkge1xuXHRcdFx0ZnVuY3Rpb24gZ2V0U3R5bGUobmFtZSkge1xuXHRcdFx0XHR2YXIgZGVmYXVsdFZpZXcgPSBkb2N1bWVudC5kZWZhdWx0VmlldztcblxuXHRcdFx0XHRpZiAoZGVmYXVsdFZpZXcpIHtcblx0XHRcdFx0XHQvLyBSZW1vdmUgY2FtZWxjYXNlXG5cdFx0XHRcdFx0bmFtZSA9IG5hbWUucmVwbGFjZSgvW0EtWl0vZywgZnVuY3Rpb24oYSkge1xuXHRcdFx0XHRcdFx0cmV0dXJuICctJyArIGE7XG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRyZXR1cm4gZGVmYXVsdFZpZXcuZ2V0Q29tcHV0ZWRTdHlsZShlbG0sIG51bGwpLmdldFByb3BlcnR5VmFsdWUobmFtZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gZWxtLmN1cnJlbnRTdHlsZVtuYW1lXTtcblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gZ2V0U2lkZShuYW1lKSB7XG5cdFx0XHRcdHZhciB2YWwgPSBwYXJzZUZsb2F0KGdldFN0eWxlKG5hbWUpLCAxMCk7XG5cblx0XHRcdFx0cmV0dXJuIGlzTmFOKHZhbCkgPyAwIDogdmFsO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4ge1xuXHRcdFx0XHR0b3A6IGdldFNpZGUocHJlZml4ICsgXCJUb3BXaWR0aFwiKSxcblx0XHRcdFx0cmlnaHQ6IGdldFNpZGUocHJlZml4ICsgXCJSaWdodFdpZHRoXCIpLFxuXHRcdFx0XHRib3R0b206IGdldFNpZGUocHJlZml4ICsgXCJCb3R0b21XaWR0aFwiKSxcblx0XHRcdFx0bGVmdDogZ2V0U2lkZShwcmVmaXggKyBcIkxlZnRXaWR0aFwiKVxuXHRcdFx0fTtcblx0XHR9XG5cdH07XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL3VpL0NsYXNzTGlzdC5qc1xuXG4vKipcbiAqIENsYXNzTGlzdC5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE1IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKipcbiAqIEhhbmRsZXMgYWRkaW5nIGFuZCByZW1vdmFsIG9mIGNsYXNzZXMuXG4gKlxuICogQHByaXZhdGVcbiAqIEBjbGFzcyB0aW55bWNlLnVpLkNsYXNzTGlzdFxuICovXG5kZWZpbmUoXCJ0aW55bWNlL3VpL0NsYXNzTGlzdFwiLCBbXG5cdFwidGlueW1jZS91dGlsL1Rvb2xzXCJcbl0sIGZ1bmN0aW9uKFRvb2xzKSB7XG5cdFwidXNlIHN0cmljdFwiO1xuXG5cdGZ1bmN0aW9uIG5vb3AoKSB7XG5cdH1cblxuXHQvKipcblx0ICogQ29uc3RydWN0cyBhIG5ldyBjbGFzcyBsaXN0IHRoZSBzcGVjaWZpZWQgb25jaGFuZ2Vcblx0ICogY2FsbGJhY2sgd2lsbCBiZSBleGVjdXRlZCB3aGVuIHRoZSBjbGFzcyBsaXN0IGdldHMgbW9kaWZlZC5cblx0ICpcblx0ICogQGNvbnN0cnVjdG9yIENsYXNzTGlzdFxuXHQgKiBAcGFyYW0ge2Z1bmN0aW9ufSBvbmNoYW5nZSBPbmNoYW5nZSBjYWxsYmFjayB0byBiZSBleGVjdXRlZC5cblx0ICovXG5cdGZ1bmN0aW9uIENsYXNzTGlzdChvbmNoYW5nZSkge1xuXHRcdHRoaXMuY2xzID0gW107XG5cdFx0dGhpcy5jbHMuX21hcCA9IHt9O1xuXHRcdHRoaXMub25jaGFuZ2UgPSBvbmNoYW5nZSB8fCBub29wO1xuXHRcdHRoaXMucHJlZml4ID0gJyc7XG5cdH1cblxuXHRUb29scy5leHRlbmQoQ2xhc3NMaXN0LnByb3RvdHlwZSwge1xuXHRcdC8qKlxuXHRcdCAqIEFkZHMgYSBuZXcgY2xhc3MgdG8gdGhlIGNsYXNzIGxpc3QuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGFkZFxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBjbHMgQ2xhc3MgdG8gYmUgYWRkZWQuXG5cdFx0ICogQHJldHVybiB7dGlueW1jZS51aS5DbGFzc0xpc3R9IEN1cnJlbnQgY2xhc3MgbGlzdCBpbnN0YW5jZS5cblx0XHQgKi9cblx0XHRhZGQ6IGZ1bmN0aW9uKGNscykge1xuXHRcdFx0aWYgKGNscyAmJiAhdGhpcy5jb250YWlucyhjbHMpKSB7XG5cdFx0XHRcdHRoaXMuY2xzLl9tYXBbY2xzXSA9IHRydWU7XG5cdFx0XHRcdHRoaXMuY2xzLnB1c2goY2xzKTtcblx0XHRcdFx0dGhpcy5fY2hhbmdlKCk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZW1vdmVzIHRoZSBzcGVjaWZpZWQgY2xhc3MgZnJvbSB0aGUgY2xhc3MgbGlzdC5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgcmVtb3ZlXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IGNscyBDbGFzcyB0byBiZSByZW1vdmVkLlxuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UudWkuQ2xhc3NMaXN0fSBDdXJyZW50IGNsYXNzIGxpc3QgaW5zdGFuY2UuXG5cdFx0ICovXG5cdFx0cmVtb3ZlOiBmdW5jdGlvbihjbHMpIHtcblx0XHRcdGlmICh0aGlzLmNvbnRhaW5zKGNscykpIHtcblx0XHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmNscy5sZW5ndGg7IGkrKykge1xuXHRcdFx0XHRcdGlmICh0aGlzLmNsc1tpXSA9PT0gY2xzKSB7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHR0aGlzLmNscy5zcGxpY2UoaSwgMSk7XG5cdFx0XHRcdGRlbGV0ZSB0aGlzLmNscy5fbWFwW2Nsc107XG5cdFx0XHRcdHRoaXMuX2NoYW5nZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogVG9nZ2xlcyBhIGNsYXNzIGluIHRoZSBjbGFzcyBsaXN0LlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCB0b2dnbGVcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gY2xzIENsYXNzIHRvIGJlIGFkZGVkL3JlbW92ZWQuXG5cdFx0ICogQHBhcmFtIHtCb29sZWFufSBzdGF0ZSBPcHRpb25hbCBzdGF0ZSBpZiBpdCBzaG91bGQgYmUgYWRkZWQvcmVtb3ZlZC5cblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLnVpLkNsYXNzTGlzdH0gQ3VycmVudCBjbGFzcyBsaXN0IGluc3RhbmNlLlxuXHRcdCAqL1xuXHRcdHRvZ2dsZTogZnVuY3Rpb24oY2xzLCBzdGF0ZSkge1xuXHRcdFx0dmFyIGN1clN0YXRlID0gdGhpcy5jb250YWlucyhjbHMpO1xuXG5cdFx0XHRpZiAoY3VyU3RhdGUgIT09IHN0YXRlKSB7XG5cdFx0XHRcdGlmIChjdXJTdGF0ZSkge1xuXHRcdFx0XHRcdHRoaXMucmVtb3ZlKGNscyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5hZGQoY2xzKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHRoaXMuX2NoYW5nZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyB0cnVlIGlmIHRoZSBjbGFzcyBsaXN0IGhhcyB0aGUgc3BlY2lmaWVkIGNsYXNzLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBjb250YWluc1xuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBjbHMgQ2xhc3MgdG8gbG9vayBmb3IuXG5cdFx0ICogQHJldHVybiB7Qm9vbGVhbn0gdHJ1ZS9mYWxzZSBpZiB0aGUgY2xhc3MgZXhpc3RzIG9yIG5vdC5cblx0XHQgKi9cblx0XHRjb250YWluczogZnVuY3Rpb24oY2xzKSB7XG5cdFx0XHRyZXR1cm4gISF0aGlzLmNscy5fbWFwW2Nsc107XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFJldHVybnMgYSBzcGFjZSBzZXBhcmF0ZWQgbGlzdCBvZiBjbGFzc2VzLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCB0b1N0cmluZ1xuXHRcdCAqIEByZXR1cm4ge1N0cmluZ30gU3BhY2Ugc2VwYXJhdGVkIGxpc3Qgb2YgY2xhc3Nlcy5cblx0XHQgKi9cblxuXHRcdF9jaGFuZ2U6IGZ1bmN0aW9uKCkge1xuXHRcdFx0ZGVsZXRlIHRoaXMuY2xzVmFsdWU7XG5cdFx0XHR0aGlzLm9uY2hhbmdlLmNhbGwodGhpcyk7XG5cdFx0fVxuXHR9KTtcblxuXHQvLyBJRSA4IGNvbXBhdGliaWxpdHlcblx0Q2xhc3NMaXN0LnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uKCkge1xuXHRcdHZhciB2YWx1ZTtcblxuXHRcdGlmICh0aGlzLmNsc1ZhbHVlKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5jbHNWYWx1ZTtcblx0XHR9XG5cblx0XHR2YWx1ZSA9ICcnO1xuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5jbHMubGVuZ3RoOyBpKyspIHtcblx0XHRcdGlmIChpID4gMCkge1xuXHRcdFx0XHR2YWx1ZSArPSAnICc7XG5cdFx0XHR9XG5cblx0XHRcdHZhbHVlICs9IHRoaXMucHJlZml4ICsgdGhpcy5jbHNbaV07XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHZhbHVlO1xuXHR9O1xuXG5cdHJldHVybiBDbGFzc0xpc3Q7XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL3VpL1JlZmxvd1F1ZXVlLmpzXG5cbi8qKlxuICogUmVmbG93UXVldWUuanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBUaGlzIGNsYXNzIHdpbGwgYXV0b21hdGljYWxseSByZWZsb3cgY29udHJvbHMgb24gdGhlIG5leHQgYW5pbWF0aW9uIGZyYW1lIHdpdGhpbiBhIGZldyBtaWxsaXNlY29uZHMgb24gb2xkZXIgYnJvd3NlcnMuXG4gKiBJZiB0aGUgdXNlciBtYW51YWxseSByZWZsb3dzIHRoZW4gdGhlIGF1dG9tYXRpYyByZWZsb3cgd2lsbCBiZSBjYW5jZWxsZWQuIFRoaXMgY2xhc3MgaXMgdXNlZCBpbnRlcm5hbGx5IHdoZW4gdmFyaW91cyBjb250cm9sIHN0YXRlc1xuICogY2hhbmdlcyB0aGF0IHRyaWdnZXJzIGEgcmVmbG93LlxuICpcbiAqIEBjbGFzcyB0aW55bWNlLnVpLlJlZmxvd1F1ZXVlXG4gKiBAc3RhdGljXG4gKi9cbmRlZmluZShcInRpbnltY2UvdWkvUmVmbG93UXVldWVcIiwgW1xuXHRcInRpbnltY2UvdXRpbC9EZWxheVwiXG5dLCBmdW5jdGlvbihEZWxheSkge1xuXHR2YXIgZGlydHlDdHJscyA9IHt9LCBhbmltYXRpb25GcmFtZVJlcXVlc3RlZDtcblxuXHRyZXR1cm4ge1xuXHRcdC8qKlxuXHRcdCAqIEFkZHMgYSBjb250cm9sIHRvIHRoZSBuZXh0IGF1dG9tYXRpYyByZWZsb3cgY2FsbC4gVGhpcyBpcyB0aGUgY29udHJvbCB0aGF0IGhhZCBhIHN0YXRlXG5cdFx0ICogY2hhbmdlIGZvciBleGFtcGxlIGlmIHRoZSBjb250cm9sIHdhcyBoaWRkZW4vc2hvd24uXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGFkZFxuXHRcdCAqIEBwYXJhbSB7dGlueW1jZS51aS5Db250cm9sfSBjdHJsIENvbnRyb2wgdG8gYWRkIHRvIHF1ZXVlLlxuXHRcdCAqL1xuXHRcdGFkZDogZnVuY3Rpb24oY3RybCkge1xuXHRcdFx0dmFyIHBhcmVudCA9IGN0cmwucGFyZW50KCk7XG5cblx0XHRcdGlmIChwYXJlbnQpIHtcblx0XHRcdFx0aWYgKCFwYXJlbnQuX2xheW91dCB8fCBwYXJlbnQuX2xheW91dC5pc05hdGl2ZSgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKCFkaXJ0eUN0cmxzW3BhcmVudC5faWRdKSB7XG5cdFx0XHRcdFx0ZGlydHlDdHJsc1twYXJlbnQuX2lkXSA9IHBhcmVudDtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICghYW5pbWF0aW9uRnJhbWVSZXF1ZXN0ZWQpIHtcblx0XHRcdFx0XHRhbmltYXRpb25GcmFtZVJlcXVlc3RlZCA9IHRydWU7XG5cblx0XHRcdFx0XHREZWxheS5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0XHR2YXIgaWQsIGN0cmw7XG5cblx0XHRcdFx0XHRcdGFuaW1hdGlvbkZyYW1lUmVxdWVzdGVkID0gZmFsc2U7XG5cblx0XHRcdFx0XHRcdGZvciAoaWQgaW4gZGlydHlDdHJscykge1xuXHRcdFx0XHRcdFx0XHRjdHJsID0gZGlydHlDdHJsc1tpZF07XG5cblx0XHRcdFx0XHRcdFx0aWYgKGN0cmwuc3RhdGUuZ2V0KCdyZW5kZXJlZCcpKSB7XG5cdFx0XHRcdFx0XHRcdFx0Y3RybC5yZWZsb3coKTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRkaXJ0eUN0cmxzID0ge307XG5cdFx0XHRcdFx0fSwgZG9jdW1lbnQuYm9keSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmVtb3ZlcyB0aGUgc3BlY2lmaWVkIGNvbnRyb2wgZnJvbSB0aGUgYXV0b21hdGljIHJlZmxvdy4gVGhpcyB3aWxsIGhhcHBlbiB3aGVuIGZvciBleGFtcGxlIHRoZSB1c2VyXG5cdFx0ICogbWFudWFsbHkgdHJpZ2dlcnMgYSByZWZsb3cuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHJlbW92ZVxuXHRcdCAqIEBwYXJhbSB7dGlueW1jZS51aS5Db250cm9sfSBjdHJsIENvbnRyb2wgdG8gcmVtb3ZlIGZyb20gcXVldWUuXG5cdFx0ICovXG5cdFx0cmVtb3ZlOiBmdW5jdGlvbihjdHJsKSB7XG5cdFx0XHRpZiAoZGlydHlDdHJsc1tjdHJsLl9pZF0pIHtcblx0XHRcdFx0ZGVsZXRlIGRpcnR5Q3RybHNbY3RybC5faWRdO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcbn0pO1xuXG4vLyBJbmNsdWRlZCBmcm9tOiBqcy90aW55bWNlL2NsYXNzZXMvdWkvQ29udHJvbC5qc1xuXG4vKipcbiAqIENvbnRyb2wuanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyplc2xpbnQgY29uc2lzdGVudC10aGlzOjAgKi9cblxuLyoqXG4gKiBUaGlzIGlzIHRoZSBiYXNlIGNsYXNzIGZvciBhbGwgY29udHJvbHMgYW5kIGNvbnRhaW5lcnMuIEFsbCBVSSBjb250cm9sIGluc3RhbmNlcyBpbmhlcml0XG4gKiBmcm9tIHRoaXMgb25lIGFzIGl0IGhhcyB0aGUgYmFzZSBsb2dpYyBuZWVkZWQgYnkgYWxsIG9mIHRoZW0uXG4gKlxuICogQGNsYXNzIHRpbnltY2UudWkuQ29udHJvbFxuICovXG5kZWZpbmUoXCJ0aW55bWNlL3VpL0NvbnRyb2xcIiwgW1xuXHRcInRpbnltY2UvdXRpbC9DbGFzc1wiLFxuXHRcInRpbnltY2UvdXRpbC9Ub29sc1wiLFxuXHRcInRpbnltY2UvdXRpbC9FdmVudERpc3BhdGNoZXJcIixcblx0XCJ0aW55bWNlL2RhdGEvT2JzZXJ2YWJsZU9iamVjdFwiLFxuXHRcInRpbnltY2UvdWkvQ29sbGVjdGlvblwiLFxuXHRcInRpbnltY2UvdWkvRG9tVXRpbHNcIixcblx0XCJ0aW55bWNlL2RvbS9Eb21RdWVyeVwiLFxuXHRcInRpbnltY2UvdWkvQm94VXRpbHNcIixcblx0XCJ0aW55bWNlL3VpL0NsYXNzTGlzdFwiLFxuXHRcInRpbnltY2UvdWkvUmVmbG93UXVldWVcIlxuXSwgZnVuY3Rpb24oQ2xhc3MsIFRvb2xzLCBFdmVudERpc3BhdGNoZXIsIE9ic2VydmFibGVPYmplY3QsIENvbGxlY3Rpb24sIERvbVV0aWxzLCAkLCBCb3hVdGlscywgQ2xhc3NMaXN0LCBSZWZsb3dRdWV1ZSkge1xuXHRcInVzZSBzdHJpY3RcIjtcblxuXHR2YXIgaGFzTW91c2VXaGVlbEV2ZW50U3VwcG9ydCA9IFwib25tb3VzZXdoZWVsXCIgaW4gZG9jdW1lbnQ7XG5cdHZhciBoYXNXaGVlbEV2ZW50U3VwcG9ydCA9IGZhbHNlO1xuXHR2YXIgY2xhc3NQcmVmaXggPSBcIm1jZS1cIjtcblx0dmFyIENvbnRyb2wsIGlkQ291bnRlciA9IDA7XG5cblx0dmFyIHByb3RvID0ge1xuXHRcdFN0YXRpY3M6IHtcblx0XHRcdGNsYXNzUHJlZml4OiBjbGFzc1ByZWZpeFxuXHRcdH0sXG5cblx0XHRpc1J0bDogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gQ29udHJvbC5ydGw7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIENsYXNzL2lkIHByZWZpeCB0byB1c2UgZm9yIGFsbCBjb250cm9scy5cblx0XHQgKlxuXHRcdCAqIEBmaW5hbFxuXHRcdCAqIEBmaWVsZCB7U3RyaW5nfSBjbGFzc1ByZWZpeFxuXHRcdCAqL1xuXHRcdGNsYXNzUHJlZml4OiBjbGFzc1ByZWZpeCxcblxuXHRcdC8qKlxuXHRcdCAqIENvbnN0cnVjdHMgYSBuZXcgY29udHJvbCBpbnN0YW5jZSB3aXRoIHRoZSBzcGVjaWZpZWQgc2V0dGluZ3MuXG5cdFx0ICpcblx0XHQgKiBAY29uc3RydWN0b3Jcblx0XHQgKiBAcGFyYW0ge09iamVjdH0gc2V0dGluZ3MgTmFtZS92YWx1ZSBvYmplY3Qgd2l0aCBzZXR0aW5ncy5cblx0XHQgKiBAc2V0dGluZyB7U3RyaW5nfSBzdHlsZSBTdHlsZSBDU1MgcHJvcGVydGllcyB0byBhZGQuXG5cdFx0ICogQHNldHRpbmcge1N0cmluZ30gYm9yZGVyIEJvcmRlciBib3ggdmFsdWVzIGV4YW1wbGU6IDEgMSAxIDFcblx0XHQgKiBAc2V0dGluZyB7U3RyaW5nfSBwYWRkaW5nIFBhZGRpbmcgYm94IHZhbHVlcyBleGFtcGxlOiAxIDEgMSAxXG5cdFx0ICogQHNldHRpbmcge1N0cmluZ30gbWFyZ2luIE1hcmdpbiBib3ggdmFsdWVzIGV4YW1wbGU6IDEgMSAxIDFcblx0XHQgKiBAc2V0dGluZyB7TnVtYmVyfSBtaW5XaWR0aCBNaW5pbWFsIHdpZHRoIGZvciB0aGUgY29udHJvbC5cblx0XHQgKiBAc2V0dGluZyB7TnVtYmVyfSBtaW5IZWlnaHQgTWluaW1hbCBoZWlnaHQgZm9yIHRoZSBjb250cm9sLlxuXHRcdCAqIEBzZXR0aW5nIHtTdHJpbmd9IGNsYXNzZXMgU3BhY2Ugc2VwYXJhdGVkIGxpc3Qgb2YgY2xhc3NlcyB0byBhZGQuXG5cdFx0ICogQHNldHRpbmcge1N0cmluZ30gcm9sZSBXQUktQVJJQSByb2xlIHRvIHVzZSBmb3IgY29udHJvbC5cblx0XHQgKiBAc2V0dGluZyB7Qm9vbGVhbn0gaGlkZGVuIElzIHRoZSBjb250cm9sIGhpZGRlbiBieSBkZWZhdWx0LlxuXHRcdCAqIEBzZXR0aW5nIHtCb29sZWFufSBkaXNhYmxlZCBJcyB0aGUgY29udHJvbCBkaXNhYmxlZCBieSBkZWZhdWx0LlxuXHRcdCAqIEBzZXR0aW5nIHtTdHJpbmd9IG5hbWUgTmFtZSBvZiB0aGUgY29udHJvbCBpbnN0YW5jZS5cblx0XHQgKi9cblx0XHRpbml0OiBmdW5jdGlvbihzZXR0aW5ncykge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLCBjbGFzc2VzLCBkZWZhdWx0Q2xhc3NlcztcblxuXHRcdFx0ZnVuY3Rpb24gYXBwbHlDbGFzc2VzKGNsYXNzZXMpIHtcblx0XHRcdFx0dmFyIGk7XG5cblx0XHRcdFx0Y2xhc3NlcyA9IGNsYXNzZXMuc3BsaXQoJyAnKTtcblx0XHRcdFx0Zm9yIChpID0gMDsgaSA8IGNsYXNzZXMubGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0XHRzZWxmLmNsYXNzZXMuYWRkKGNsYXNzZXNbaV0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHNlbGYuc2V0dGluZ3MgPSBzZXR0aW5ncyA9IFRvb2xzLmV4dGVuZCh7fSwgc2VsZi5EZWZhdWx0cywgc2V0dGluZ3MpO1xuXG5cdFx0XHQvLyBJbml0aWFsIHN0YXRlc1xuXHRcdFx0c2VsZi5faWQgPSBzZXR0aW5ncy5pZCB8fCAoJ21jZXVfJyArIChpZENvdW50ZXIrKykpO1xuXHRcdFx0c2VsZi5fYXJpYSA9IHtyb2xlOiBzZXR0aW5ncy5yb2xlfTtcblx0XHRcdHNlbGYuX2VsbUNhY2hlID0ge307XG5cdFx0XHRzZWxmLiQgPSAkO1xuXG5cdFx0XHRzZWxmLnN0YXRlID0gbmV3IE9ic2VydmFibGVPYmplY3Qoe1xuXHRcdFx0XHR2aXNpYmxlOiB0cnVlLFxuXHRcdFx0XHRhY3RpdmU6IGZhbHNlLFxuXHRcdFx0XHRkaXNhYmxlZDogZmFsc2UsXG5cdFx0XHRcdHZhbHVlOiAnJ1xuXHRcdFx0fSk7XG5cblx0XHRcdHNlbGYuZGF0YSA9IG5ldyBPYnNlcnZhYmxlT2JqZWN0KHNldHRpbmdzLmRhdGEpO1xuXG5cdFx0XHRzZWxmLmNsYXNzZXMgPSBuZXcgQ2xhc3NMaXN0KGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRpZiAoc2VsZi5zdGF0ZS5nZXQoJ3JlbmRlcmVkJykpIHtcblx0XHRcdFx0XHRzZWxmLmdldEVsKCkuY2xhc3NOYW1lID0gdGhpcy50b1N0cmluZygpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHRcdHNlbGYuY2xhc3Nlcy5wcmVmaXggPSBzZWxmLmNsYXNzUHJlZml4O1xuXG5cdFx0XHQvLyBTZXR1cCBjbGFzc2VzXG5cdFx0XHRjbGFzc2VzID0gc2V0dGluZ3MuY2xhc3Nlcztcblx0XHRcdGlmIChjbGFzc2VzKSB7XG5cdFx0XHRcdGlmIChzZWxmLkRlZmF1bHRzKSB7XG5cdFx0XHRcdFx0ZGVmYXVsdENsYXNzZXMgPSBzZWxmLkRlZmF1bHRzLmNsYXNzZXM7XG5cblx0XHRcdFx0XHRpZiAoZGVmYXVsdENsYXNzZXMgJiYgY2xhc3NlcyAhPSBkZWZhdWx0Q2xhc3Nlcykge1xuXHRcdFx0XHRcdFx0YXBwbHlDbGFzc2VzKGRlZmF1bHRDbGFzc2VzKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRhcHBseUNsYXNzZXMoY2xhc3Nlcyk7XG5cdFx0XHR9XG5cblx0XHRcdFRvb2xzLmVhY2goJ3RpdGxlIHRleHQgbmFtZSB2aXNpYmxlIGRpc2FibGVkIGFjdGl2ZSB2YWx1ZScuc3BsaXQoJyAnKSwgZnVuY3Rpb24obmFtZSkge1xuXHRcdFx0XHRpZiAobmFtZSBpbiBzZXR0aW5ncykge1xuXHRcdFx0XHRcdHNlbGZbbmFtZV0oc2V0dGluZ3NbbmFtZV0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0c2VsZi5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcblx0XHRcdFx0aWYgKHNlbGYuZGlzYWJsZWQoKSkge1xuXHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdC8qKlxuXHRcdFx0ICogTmFtZS92YWx1ZSBvYmplY3Qgd2l0aCBzZXR0aW5ncyBmb3IgdGhlIGN1cnJlbnQgY29udHJvbC5cblx0XHRcdCAqXG5cdFx0XHQgKiBAZmllbGQge09iamVjdH0gc2V0dGluZ3Ncblx0XHRcdCAqL1xuXHRcdFx0c2VsZi5zZXR0aW5ncyA9IHNldHRpbmdzO1xuXG5cdFx0XHRzZWxmLmJvcmRlckJveCA9IEJveFV0aWxzLnBhcnNlQm94KHNldHRpbmdzLmJvcmRlcik7XG5cdFx0XHRzZWxmLnBhZGRpbmdCb3ggPSBCb3hVdGlscy5wYXJzZUJveChzZXR0aW5ncy5wYWRkaW5nKTtcblx0XHRcdHNlbGYubWFyZ2luQm94ID0gQm94VXRpbHMucGFyc2VCb3goc2V0dGluZ3MubWFyZ2luKTtcblxuXHRcdFx0aWYgKHNldHRpbmdzLmhpZGRlbikge1xuXHRcdFx0XHRzZWxmLmhpZGUoKTtcblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0Ly8gV2lsbCBnZW5lcmF0ZSBnZXR0ZXIvc2V0dGVyIG1ldGhvZHMgZm9yIHRoZXNlIHByb3BlcnRpZXNcblx0XHRQcm9wZXJ0aWVzOiAncGFyZW50LG5hbWUnLFxuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyB0aGUgcm9vdCBlbGVtZW50IHRvIHJlbmRlciBjb250cm9scyBpbnRvLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBnZXRDb250YWluZXJFbG1cblx0XHQgKiBAcmV0dXJuIHtFbGVtZW50fSBIVE1MIERPTSBlbGVtZW50IHRvIHJlbmRlciBpbnRvLlxuXHRcdCAqL1xuXHRcdGdldENvbnRhaW5lckVsbTogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gRG9tVXRpbHMuZ2V0Q29udGFpbmVyKCk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFJldHVybnMgYSBjb250cm9sIGluc3RhbmNlIGZvciB0aGUgY3VycmVudCBET00gZWxlbWVudC5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgZ2V0UGFyZW50Q3RybFxuXHRcdCAqIEBwYXJhbSB7RWxlbWVudH0gZWxtIEhUTUwgZG9tIGVsZW1lbnQgdG8gZ2V0IHBhcmVudCBjb250cm9sIGZyb20uXG5cdFx0ICogQHJldHVybiB7dGlueW1jZS51aS5Db250cm9sfSBDb250cm9sIGluc3RhbmNlIG9yIHVuZGVmaW5lZC5cblx0XHQgKi9cblx0XHRnZXRQYXJlbnRDdHJsOiBmdW5jdGlvbihlbG0pIHtcblx0XHRcdHZhciBjdHJsLCBsb29rdXAgPSB0aGlzLmdldFJvb3QoKS5jb250cm9sSWRMb29rdXA7XG5cblx0XHRcdHdoaWxlIChlbG0gJiYgbG9va3VwKSB7XG5cdFx0XHRcdGN0cmwgPSBsb29rdXBbZWxtLmlkXTtcblx0XHRcdFx0aWYgKGN0cmwpIHtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGVsbSA9IGVsbS5wYXJlbnROb2RlO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gY3RybDtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogSW5pdGlhbGl6ZXMgdGhlIGN1cnJlbnQgY29udHJvbHMgbGF5b3V0IHJlY3QuXG5cdFx0ICogVGhpcyB3aWxsIGJlIGV4ZWN1dGVkIGJ5IHRoZSBsYXlvdXQgbWFuYWdlcnMgdG8gZGV0ZXJtaW5lIHRoZVxuXHRcdCAqIGRlZmF1bHQgbWluV2lkdGgvbWluSGVpZ2h0IGV0Yy5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgaW5pdExheW91dFJlY3Rcblx0XHQgKiBAcmV0dXJuIHtPYmplY3R9IExheW91dCByZWN0IGluc3RhbmNlLlxuXHRcdCAqL1xuXHRcdGluaXRMYXlvdXRSZWN0OiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgc2V0dGluZ3MgPSBzZWxmLnNldHRpbmdzLCBib3JkZXJCb3gsIGxheW91dFJlY3Q7XG5cdFx0XHR2YXIgZWxtID0gc2VsZi5nZXRFbCgpLCB3aWR0aCwgaGVpZ2h0LCBtaW5XaWR0aCwgbWluSGVpZ2h0LCBhdXRvUmVzaXplO1xuXHRcdFx0dmFyIHN0YXJ0TWluV2lkdGgsIHN0YXJ0TWluSGVpZ2h0LCBpbml0aWFsU2l6ZTtcblxuXHRcdFx0Ly8gTWVhc3VyZSB0aGUgY3VycmVudCBlbGVtZW50XG5cdFx0XHRib3JkZXJCb3ggPSBzZWxmLmJvcmRlckJveCA9IHNlbGYuYm9yZGVyQm94IHx8IEJveFV0aWxzLm1lYXN1cmVCb3goZWxtLCAnYm9yZGVyJyk7XG5cdFx0XHRzZWxmLnBhZGRpbmdCb3ggPSBzZWxmLnBhZGRpbmdCb3ggfHwgQm94VXRpbHMubWVhc3VyZUJveChlbG0sICdwYWRkaW5nJyk7XG5cdFx0XHRzZWxmLm1hcmdpbkJveCA9IHNlbGYubWFyZ2luQm94IHx8IEJveFV0aWxzLm1lYXN1cmVCb3goZWxtLCAnbWFyZ2luJyk7XG5cdFx0XHRpbml0aWFsU2l6ZSA9IERvbVV0aWxzLmdldFNpemUoZWxtKTtcblxuXHRcdFx0Ly8gU2V0dXAgbWluV2lkdGgvbWluSGVpZ2h0IGFuZCB3aWR0aC9oZWlnaHRcblx0XHRcdHN0YXJ0TWluV2lkdGggPSBzZXR0aW5ncy5taW5XaWR0aDtcblx0XHRcdHN0YXJ0TWluSGVpZ2h0ID0gc2V0dGluZ3MubWluSGVpZ2h0O1xuXHRcdFx0bWluV2lkdGggPSBzdGFydE1pbldpZHRoIHx8IGluaXRpYWxTaXplLndpZHRoO1xuXHRcdFx0bWluSGVpZ2h0ID0gc3RhcnRNaW5IZWlnaHQgfHwgaW5pdGlhbFNpemUuaGVpZ2h0O1xuXHRcdFx0d2lkdGggPSBzZXR0aW5ncy53aWR0aDtcblx0XHRcdGhlaWdodCA9IHNldHRpbmdzLmhlaWdodDtcblx0XHRcdGF1dG9SZXNpemUgPSBzZXR0aW5ncy5hdXRvUmVzaXplO1xuXHRcdFx0YXV0b1Jlc2l6ZSA9IHR5cGVvZiBhdXRvUmVzaXplICE9IFwidW5kZWZpbmVkXCIgPyBhdXRvUmVzaXplIDogIXdpZHRoICYmICFoZWlnaHQ7XG5cblx0XHRcdHdpZHRoID0gd2lkdGggfHwgbWluV2lkdGg7XG5cdFx0XHRoZWlnaHQgPSBoZWlnaHQgfHwgbWluSGVpZ2h0O1xuXG5cdFx0XHR2YXIgZGVsdGFXID0gYm9yZGVyQm94LmxlZnQgKyBib3JkZXJCb3gucmlnaHQ7XG5cdFx0XHR2YXIgZGVsdGFIID0gYm9yZGVyQm94LnRvcCArIGJvcmRlckJveC5ib3R0b207XG5cblx0XHRcdHZhciBtYXhXID0gc2V0dGluZ3MubWF4V2lkdGggfHwgMHhGRkZGO1xuXHRcdFx0dmFyIG1heEggPSBzZXR0aW5ncy5tYXhIZWlnaHQgfHwgMHhGRkZGO1xuXG5cdFx0XHQvLyBTZXR1cCBpbml0aWFsIGxheW91dCByZWN0XG5cdFx0XHRzZWxmLl9sYXlvdXRSZWN0ID0gbGF5b3V0UmVjdCA9IHtcblx0XHRcdFx0eDogc2V0dGluZ3MueCB8fCAwLFxuXHRcdFx0XHR5OiBzZXR0aW5ncy55IHx8IDAsXG5cdFx0XHRcdHc6IHdpZHRoLFxuXHRcdFx0XHRoOiBoZWlnaHQsXG5cdFx0XHRcdGRlbHRhVzogZGVsdGFXLFxuXHRcdFx0XHRkZWx0YUg6IGRlbHRhSCxcblx0XHRcdFx0Y29udGVudFc6IHdpZHRoIC0gZGVsdGFXLFxuXHRcdFx0XHRjb250ZW50SDogaGVpZ2h0IC0gZGVsdGFILFxuXHRcdFx0XHRpbm5lclc6IHdpZHRoIC0gZGVsdGFXLFxuXHRcdFx0XHRpbm5lckg6IGhlaWdodCAtIGRlbHRhSCxcblx0XHRcdFx0c3RhcnRNaW5XaWR0aDogc3RhcnRNaW5XaWR0aCB8fCAwLFxuXHRcdFx0XHRzdGFydE1pbkhlaWdodDogc3RhcnRNaW5IZWlnaHQgfHwgMCxcblx0XHRcdFx0bWluVzogTWF0aC5taW4obWluV2lkdGgsIG1heFcpLFxuXHRcdFx0XHRtaW5IOiBNYXRoLm1pbihtaW5IZWlnaHQsIG1heEgpLFxuXHRcdFx0XHRtYXhXOiBtYXhXLFxuXHRcdFx0XHRtYXhIOiBtYXhILFxuXHRcdFx0XHRhdXRvUmVzaXplOiBhdXRvUmVzaXplLFxuXHRcdFx0XHRzY3JvbGxXOiAwXG5cdFx0XHR9O1xuXG5cdFx0XHRzZWxmLl9sYXN0TGF5b3V0UmVjdCA9IHt9O1xuXG5cdFx0XHRyZXR1cm4gbGF5b3V0UmVjdDtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogR2V0dGVyL3NldHRlciBmb3IgdGhlIGN1cnJlbnQgbGF5b3V0IHJlY3QuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGxheW91dFJlY3Rcblx0XHQgKiBAcGFyYW0ge09iamVjdH0gW25ld1JlY3RdIE9wdGlvbmFsIG5ldyBsYXlvdXQgcmVjdC5cblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLnVpLkNvbnRyb2wvT2JqZWN0fSBDdXJyZW50IGNvbnRyb2wgb3IgcmVjdCBvYmplY3QuXG5cdFx0ICovXG5cdFx0bGF5b3V0UmVjdDogZnVuY3Rpb24obmV3UmVjdCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLCBjdXJSZWN0ID0gc2VsZi5fbGF5b3V0UmVjdCwgbGFzdExheW91dFJlY3QsIHNpemUsIGRlbHRhV2lkdGgsIGRlbHRhSGVpZ2h0LCB1bmRlZiwgcmVwYWludENvbnRyb2xzO1xuXG5cdFx0XHQvLyBJbml0aWFsaXplIGRlZmF1bHQgbGF5b3V0IHJlY3Rcblx0XHRcdGlmICghY3VyUmVjdCkge1xuXHRcdFx0XHRjdXJSZWN0ID0gc2VsZi5pbml0TGF5b3V0UmVjdCgpO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBTZXQgbmV3IHJlY3QgdmFsdWVzXG5cdFx0XHRpZiAobmV3UmVjdCkge1xuXHRcdFx0XHQvLyBDYWxjIGRlbHRhcyBiZXR3ZWVuIGlubmVyIGFuZCBvdXRlciBzaXplc1xuXHRcdFx0XHRkZWx0YVdpZHRoID0gY3VyUmVjdC5kZWx0YVc7XG5cdFx0XHRcdGRlbHRhSGVpZ2h0ID0gY3VyUmVjdC5kZWx0YUg7XG5cblx0XHRcdFx0Ly8gU2V0IHggcG9zaXRpb25cblx0XHRcdFx0aWYgKG5ld1JlY3QueCAhPT0gdW5kZWYpIHtcblx0XHRcdFx0XHRjdXJSZWN0LnggPSBuZXdSZWN0Lng7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBTZXQgeSBwb3NpdGlvblxuXHRcdFx0XHRpZiAobmV3UmVjdC55ICE9PSB1bmRlZikge1xuXHRcdFx0XHRcdGN1clJlY3QueSA9IG5ld1JlY3QueTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIFNldCBtaW5XXG5cdFx0XHRcdGlmIChuZXdSZWN0Lm1pblcgIT09IHVuZGVmKSB7XG5cdFx0XHRcdFx0Y3VyUmVjdC5taW5XID0gbmV3UmVjdC5taW5XO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gU2V0IG1pbkhcblx0XHRcdFx0aWYgKG5ld1JlY3QubWluSCAhPT0gdW5kZWYpIHtcblx0XHRcdFx0XHRjdXJSZWN0Lm1pbkggPSBuZXdSZWN0Lm1pbkg7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBTZXQgbmV3IHdpZHRoIGFuZCBjYWxjdWxhdGUgaW5uZXIgd2lkdGhcblx0XHRcdFx0c2l6ZSA9IG5ld1JlY3Qudztcblx0XHRcdFx0aWYgKHNpemUgIT09IHVuZGVmKSB7XG5cdFx0XHRcdFx0c2l6ZSA9IHNpemUgPCBjdXJSZWN0Lm1pblcgPyBjdXJSZWN0Lm1pblcgOiBzaXplO1xuXHRcdFx0XHRcdHNpemUgPSBzaXplID4gY3VyUmVjdC5tYXhXID8gY3VyUmVjdC5tYXhXIDogc2l6ZTtcblx0XHRcdFx0XHRjdXJSZWN0LncgPSBzaXplO1xuXHRcdFx0XHRcdGN1clJlY3QuaW5uZXJXID0gc2l6ZSAtIGRlbHRhV2lkdGg7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBTZXQgbmV3IGhlaWdodCBhbmQgY2FsY3VsYXRlIGlubmVyIGhlaWdodFxuXHRcdFx0XHRzaXplID0gbmV3UmVjdC5oO1xuXHRcdFx0XHRpZiAoc2l6ZSAhPT0gdW5kZWYpIHtcblx0XHRcdFx0XHRzaXplID0gc2l6ZSA8IGN1clJlY3QubWluSCA/IGN1clJlY3QubWluSCA6IHNpemU7XG5cdFx0XHRcdFx0c2l6ZSA9IHNpemUgPiBjdXJSZWN0Lm1heEggPyBjdXJSZWN0Lm1heEggOiBzaXplO1xuXHRcdFx0XHRcdGN1clJlY3QuaCA9IHNpemU7XG5cdFx0XHRcdFx0Y3VyUmVjdC5pbm5lckggPSBzaXplIC0gZGVsdGFIZWlnaHQ7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBTZXQgbmV3IGlubmVyIHdpZHRoIGFuZCBjYWxjdWxhdGUgd2lkdGhcblx0XHRcdFx0c2l6ZSA9IG5ld1JlY3QuaW5uZXJXO1xuXHRcdFx0XHRpZiAoc2l6ZSAhPT0gdW5kZWYpIHtcblx0XHRcdFx0XHRzaXplID0gc2l6ZSA8IGN1clJlY3QubWluVyAtIGRlbHRhV2lkdGggPyBjdXJSZWN0Lm1pblcgLSBkZWx0YVdpZHRoIDogc2l6ZTtcblx0XHRcdFx0XHRzaXplID0gc2l6ZSA+IGN1clJlY3QubWF4VyAtIGRlbHRhV2lkdGggPyBjdXJSZWN0Lm1heFcgLSBkZWx0YVdpZHRoIDogc2l6ZTtcblx0XHRcdFx0XHRjdXJSZWN0LmlubmVyVyA9IHNpemU7XG5cdFx0XHRcdFx0Y3VyUmVjdC53ID0gc2l6ZSArIGRlbHRhV2lkdGg7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBTZXQgbmV3IGhlaWdodCBhbmQgY2FsY3VsYXRlIGlubmVyIGhlaWdodFxuXHRcdFx0XHRzaXplID0gbmV3UmVjdC5pbm5lckg7XG5cdFx0XHRcdGlmIChzaXplICE9PSB1bmRlZikge1xuXHRcdFx0XHRcdHNpemUgPSBzaXplIDwgY3VyUmVjdC5taW5IIC0gZGVsdGFIZWlnaHQgPyBjdXJSZWN0Lm1pbkggLSBkZWx0YUhlaWdodCA6IHNpemU7XG5cdFx0XHRcdFx0c2l6ZSA9IHNpemUgPiBjdXJSZWN0Lm1heEggLSBkZWx0YUhlaWdodCA/IGN1clJlY3QubWF4SCAtIGRlbHRhSGVpZ2h0IDogc2l6ZTtcblx0XHRcdFx0XHRjdXJSZWN0LmlubmVySCA9IHNpemU7XG5cdFx0XHRcdFx0Y3VyUmVjdC5oID0gc2l6ZSArIGRlbHRhSGVpZ2h0O1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gU2V0IG5ldyBjb250ZW50V1xuXHRcdFx0XHRpZiAobmV3UmVjdC5jb250ZW50VyAhPT0gdW5kZWYpIHtcblx0XHRcdFx0XHRjdXJSZWN0LmNvbnRlbnRXID0gbmV3UmVjdC5jb250ZW50Vztcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIFNldCBuZXcgY29udGVudEhcblx0XHRcdFx0aWYgKG5ld1JlY3QuY29udGVudEggIT09IHVuZGVmKSB7XG5cdFx0XHRcdFx0Y3VyUmVjdC5jb250ZW50SCA9IG5ld1JlY3QuY29udGVudEg7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBDb21wYXJlIGxhc3QgbGF5b3V0IHJlY3Qgd2l0aCB0aGUgY3VycmVudCBvbmUgdG8gc2VlIGlmIHdlIG5lZWQgdG8gcmVwYWludCBvciBub3Rcblx0XHRcdFx0bGFzdExheW91dFJlY3QgPSBzZWxmLl9sYXN0TGF5b3V0UmVjdDtcblx0XHRcdFx0aWYgKGxhc3RMYXlvdXRSZWN0LnggIT09IGN1clJlY3QueCB8fCBsYXN0TGF5b3V0UmVjdC55ICE9PSBjdXJSZWN0LnkgfHxcblx0XHRcdFx0XHRsYXN0TGF5b3V0UmVjdC53ICE9PSBjdXJSZWN0LncgfHwgbGFzdExheW91dFJlY3QuaCAhPT0gY3VyUmVjdC5oKSB7XG5cdFx0XHRcdFx0cmVwYWludENvbnRyb2xzID0gQ29udHJvbC5yZXBhaW50Q29udHJvbHM7XG5cblx0XHRcdFx0XHRpZiAocmVwYWludENvbnRyb2xzKSB7XG5cdFx0XHRcdFx0XHRpZiAocmVwYWludENvbnRyb2xzLm1hcCAmJiAhcmVwYWludENvbnRyb2xzLm1hcFtzZWxmLl9pZF0pIHtcblx0XHRcdFx0XHRcdFx0cmVwYWludENvbnRyb2xzLnB1c2goc2VsZik7XG5cdFx0XHRcdFx0XHRcdHJlcGFpbnRDb250cm9scy5tYXBbc2VsZi5faWRdID0gdHJ1ZTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRsYXN0TGF5b3V0UmVjdC54ID0gY3VyUmVjdC54O1xuXHRcdFx0XHRcdGxhc3RMYXlvdXRSZWN0LnkgPSBjdXJSZWN0Lnk7XG5cdFx0XHRcdFx0bGFzdExheW91dFJlY3QudyA9IGN1clJlY3Qudztcblx0XHRcdFx0XHRsYXN0TGF5b3V0UmVjdC5oID0gY3VyUmVjdC5oO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHNlbGY7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBjdXJSZWN0O1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZXBhaW50cyB0aGUgY29udHJvbCBhZnRlciBhIGxheW91dCBvcGVyYXRpb24uXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHJlcGFpbnRcblx0XHQgKi9cblx0XHRyZXBhaW50OiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgc3R5bGUsIGJvZHlTdHlsZSwgYm9keUVsbSwgcmVjdCwgYm9yZGVyQm94O1xuXHRcdFx0dmFyIGJvcmRlclcsIGJvcmRlckgsIGxhc3RSZXBhaW50UmVjdCwgcm91bmQsIHZhbHVlO1xuXG5cdFx0XHQvLyBVc2UgTWF0aC5yb3VuZCBvbiBhbGwgdmFsdWVzIG9uIElFIDwgOVxuXHRcdFx0cm91bmQgPSAhZG9jdW1lbnQuY3JlYXRlUmFuZ2UgPyBNYXRoLnJvdW5kIDogZnVuY3Rpb24odmFsdWUpIHtcblx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0fTtcblxuXHRcdFx0c3R5bGUgPSBzZWxmLmdldEVsKCkuc3R5bGU7XG5cdFx0XHRyZWN0ID0gc2VsZi5fbGF5b3V0UmVjdDtcblx0XHRcdGxhc3RSZXBhaW50UmVjdCA9IHNlbGYuX2xhc3RSZXBhaW50UmVjdCB8fCB7fTtcblxuXHRcdFx0Ym9yZGVyQm94ID0gc2VsZi5ib3JkZXJCb3g7XG5cdFx0XHRib3JkZXJXID0gYm9yZGVyQm94LmxlZnQgKyBib3JkZXJCb3gucmlnaHQ7XG5cdFx0XHRib3JkZXJIID0gYm9yZGVyQm94LnRvcCArIGJvcmRlckJveC5ib3R0b207XG5cblx0XHRcdGlmIChyZWN0LnggIT09IGxhc3RSZXBhaW50UmVjdC54KSB7XG5cdFx0XHRcdHN0eWxlLmxlZnQgPSByb3VuZChyZWN0LngpICsgJ3B4Jztcblx0XHRcdFx0bGFzdFJlcGFpbnRSZWN0LnggPSByZWN0Lng7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChyZWN0LnkgIT09IGxhc3RSZXBhaW50UmVjdC55KSB7XG5cdFx0XHRcdHN0eWxlLnRvcCA9IHJvdW5kKHJlY3QueSkgKyAncHgnO1xuXHRcdFx0XHRsYXN0UmVwYWludFJlY3QueSA9IHJlY3QueTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHJlY3QudyAhPT0gbGFzdFJlcGFpbnRSZWN0LncpIHtcblx0XHRcdFx0dmFsdWUgPSByb3VuZChyZWN0LncgLSBib3JkZXJXKTtcblx0XHRcdFx0c3R5bGUud2lkdGggPSAodmFsdWUgPj0gMCA/IHZhbHVlIDogMCkgKyAncHgnO1xuXHRcdFx0XHRsYXN0UmVwYWludFJlY3QudyA9IHJlY3Qudztcblx0XHRcdH1cblxuXHRcdFx0aWYgKHJlY3QuaCAhPT0gbGFzdFJlcGFpbnRSZWN0LmgpIHtcblx0XHRcdFx0dmFsdWUgPSByb3VuZChyZWN0LmggLSBib3JkZXJIKTtcblx0XHRcdFx0c3R5bGUuaGVpZ2h0ID0gKHZhbHVlID49IDAgPyB2YWx1ZSA6IDApICsgJ3B4Jztcblx0XHRcdFx0bGFzdFJlcGFpbnRSZWN0LmggPSByZWN0Lmg7XG5cdFx0XHR9XG5cblx0XHRcdC8vIFVwZGF0ZSBib2R5IGlmIG5lZWRlZFxuXHRcdFx0aWYgKHNlbGYuX2hhc0JvZHkgJiYgcmVjdC5pbm5lclcgIT09IGxhc3RSZXBhaW50UmVjdC5pbm5lclcpIHtcblx0XHRcdFx0dmFsdWUgPSByb3VuZChyZWN0LmlubmVyVyk7XG5cblx0XHRcdFx0Ym9keUVsbSA9IHNlbGYuZ2V0RWwoJ2JvZHknKTtcblx0XHRcdFx0aWYgKGJvZHlFbG0pIHtcblx0XHRcdFx0XHRib2R5U3R5bGUgPSBib2R5RWxtLnN0eWxlO1xuXHRcdFx0XHRcdGJvZHlTdHlsZS53aWR0aCA9ICh2YWx1ZSA+PSAwID8gdmFsdWUgOiAwKSArICdweCc7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRsYXN0UmVwYWludFJlY3QuaW5uZXJXID0gcmVjdC5pbm5lclc7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChzZWxmLl9oYXNCb2R5ICYmIHJlY3QuaW5uZXJIICE9PSBsYXN0UmVwYWludFJlY3QuaW5uZXJIKSB7XG5cdFx0XHRcdHZhbHVlID0gcm91bmQocmVjdC5pbm5lckgpO1xuXG5cdFx0XHRcdGJvZHlFbG0gPSBib2R5RWxtIHx8IHNlbGYuZ2V0RWwoJ2JvZHknKTtcblx0XHRcdFx0aWYgKGJvZHlFbG0pIHtcblx0XHRcdFx0XHRib2R5U3R5bGUgPSBib2R5U3R5bGUgfHwgYm9keUVsbS5zdHlsZTtcblx0XHRcdFx0XHRib2R5U3R5bGUuaGVpZ2h0ID0gKHZhbHVlID49IDAgPyB2YWx1ZSA6IDApICsgJ3B4Jztcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGxhc3RSZXBhaW50UmVjdC5pbm5lckggPSByZWN0LmlubmVySDtcblx0XHRcdH1cblxuXHRcdFx0c2VsZi5fbGFzdFJlcGFpbnRSZWN0ID0gbGFzdFJlcGFpbnRSZWN0O1xuXHRcdFx0c2VsZi5maXJlKCdyZXBhaW50Jywge30sIGZhbHNlKTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogVXBkYXRlcyB0aGUgY29udHJvbHMgbGF5b3V0IHJlY3QgYnkgcmUtbWVhc3VpbmcgaXQuXG5cdFx0ICovXG5cdFx0dXBkYXRlTGF5b3V0UmVjdDogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdHNlbGYucGFyZW50KCkuX2xhc3RSZWN0ID0gbnVsbDtcblxuXHRcdFx0RG9tVXRpbHMuY3NzKHNlbGYuZ2V0RWwoKSwge3dpZHRoOiAnJywgaGVpZ2h0OiAnJ30pO1xuXG5cdFx0XHRzZWxmLl9sYXlvdXRSZWN0ID0gc2VsZi5fbGFzdFJlcGFpbnRSZWN0ID0gc2VsZi5fbGFzdExheW91dFJlY3QgPSBudWxsO1xuXHRcdFx0c2VsZi5pbml0TGF5b3V0UmVjdCgpO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBCaW5kcyBhIGNhbGxiYWNrIHRvIHRoZSBzcGVjaWZpZWQgZXZlbnQuIFRoaXMgZXZlbnQgY2FuIGJvdGggYmVcblx0XHQgKiBuYXRpdmUgYnJvd3NlciBldmVudHMgbGlrZSBcImNsaWNrXCIgb3IgY3VzdG9tIG9uZXMgbGlrZSBQb3N0UmVuZGVyLlxuXHRcdCAqXG5cdFx0ICogVGhlIGNhbGxiYWNrIGZ1bmN0aW9uIHdpbGwgYmUgcGFzc2VkIGEgRE9NIGV2ZW50IGxpa2Ugb2JqZWN0IHRoYXQgZW5hYmxlcyB5b3V0IGRvIHN0b3AgcHJvcGFnYXRpb24uXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIG9uXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IG5hbWUgTmFtZSBvZiB0aGUgZXZlbnQgdG8gYmluZC4gRm9yIGV4YW1wbGUgXCJjbGlja1wiLlxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nL2Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBleGVjdXRlIG9uZXMgdGhlIGV2ZW50IG9jY3Vycy5cblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLnVpLkNvbnRyb2x9IEN1cnJlbnQgY29udHJvbCBvYmplY3QuXG5cdFx0ICovXG5cdFx0b246IGZ1bmN0aW9uKG5hbWUsIGNhbGxiYWNrKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdGZ1bmN0aW9uIHJlc29sdmVDYWxsYmFja05hbWUobmFtZSkge1xuXHRcdFx0XHR2YXIgY2FsbGJhY2ssIHNjb3BlO1xuXG5cdFx0XHRcdGlmICh0eXBlb2YgbmFtZSAhPSAnc3RyaW5nJykge1xuXHRcdFx0XHRcdHJldHVybiBuYW1lO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0XHRpZiAoIWNhbGxiYWNrKSB7XG5cdFx0XHRcdFx0XHRzZWxmLnBhcmVudHNBbmRTZWxmKCkuZWFjaChmdW5jdGlvbihjdHJsKSB7XG5cdFx0XHRcdFx0XHRcdHZhciBjYWxsYmFja3MgPSBjdHJsLnNldHRpbmdzLmNhbGxiYWNrcztcblxuXHRcdFx0XHRcdFx0XHRpZiAoY2FsbGJhY2tzICYmIChjYWxsYmFjayA9IGNhbGxiYWNrc1tuYW1lXSkpIHtcblx0XHRcdFx0XHRcdFx0XHRzY29wZSA9IGN0cmw7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoIWNhbGxiYWNrKSB7XG5cdFx0XHRcdFx0XHRlLmFjdGlvbiA9IG5hbWU7XG5cdFx0XHRcdFx0XHR0aGlzLmZpcmUoJ2V4ZWN1dGUnLCBlKTtcblx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gY2FsbGJhY2suY2FsbChzY29wZSwgZSk7XG5cdFx0XHRcdH07XG5cdFx0XHR9XG5cblx0XHRcdGdldEV2ZW50RGlzcGF0Y2hlcihzZWxmKS5vbihuYW1lLCByZXNvbHZlQ2FsbGJhY2tOYW1lKGNhbGxiYWNrKSk7XG5cblx0XHRcdHJldHVybiBzZWxmO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBVbmJpbmRzIHRoZSBzcGVjaWZpZWQgZXZlbnQgYW5kIG9wdGlvbmFsbHkgYSBzcGVjaWZpYyBjYWxsYmFjay4gSWYgeW91IG9taXQgdGhlIG5hbWVcblx0XHQgKiBwYXJhbWV0ZXIgYWxsIGV2ZW50IGhhbmRsZXJzIHdpbGwgYmUgcmVtb3ZlZC4gSWYgeW91IG9taXQgdGhlIGNhbGxiYWNrIGFsbCBldmVudCBoYW5kbGVzXG5cdFx0ICogYnkgdGhlIHNwZWNpZmllZCBuYW1lIHdpbGwgYmUgcmVtb3ZlZC5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2Qgb2ZmXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IFtuYW1lXSBOYW1lIGZvciB0aGUgZXZlbnQgdG8gdW5iaW5kLlxuXHRcdCAqIEBwYXJhbSB7ZnVuY3Rpb259IFtjYWxsYmFja10gQ2FsbGJhY2sgZnVuY3Rpb24gdG8gdW5iaW5kLlxuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UudWkuQ29udHJvbH0gQ3VycmVudCBjb250cm9sIG9iamVjdC5cblx0XHQgKi9cblx0XHRvZmY6IGZ1bmN0aW9uKG5hbWUsIGNhbGxiYWNrKSB7XG5cdFx0XHRnZXRFdmVudERpc3BhdGNoZXIodGhpcykub2ZmKG5hbWUsIGNhbGxiYWNrKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBGaXJlcyB0aGUgc3BlY2lmaWVkIGV2ZW50IGJ5IG5hbWUgYW5kIGFyZ3VtZW50cyBvbiB0aGUgY29udHJvbC4gVGhpcyB3aWxsIGV4ZWN1dGUgYWxsXG5cdFx0ICogYm91bmQgZXZlbnQgaGFuZGxlcnMuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGZpcmVcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSBOYW1lIG9mIHRoZSBldmVudCB0byBmaXJlLlxuXHRcdCAqIEBwYXJhbSB7T2JqZWN0fSBbYXJnc10gQXJndW1lbnRzIHRvIHBhc3MgdG8gdGhlIGV2ZW50LlxuXHRcdCAqIEBwYXJhbSB7Qm9vbGVhbn0gW2J1YmJsZV0gVmFsdWUgdG8gY29udHJvbCBidWJibGluZy4gRGVmYXVsdHMgdG8gdHJ1ZS5cblx0XHQgKiBAcmV0dXJuIHtPYmplY3R9IEN1cnJlbnQgYXJndW1lbnRzIG9iamVjdC5cblx0XHQgKi9cblx0XHRmaXJlOiBmdW5jdGlvbihuYW1lLCBhcmdzLCBidWJibGUpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0YXJncyA9IGFyZ3MgfHwge307XG5cblx0XHRcdGlmICghYXJncy5jb250cm9sKSB7XG5cdFx0XHRcdGFyZ3MuY29udHJvbCA9IHNlbGY7XG5cdFx0XHR9XG5cblx0XHRcdGFyZ3MgPSBnZXRFdmVudERpc3BhdGNoZXIoc2VsZikuZmlyZShuYW1lLCBhcmdzKTtcblxuXHRcdFx0Ly8gQnViYmxlIGV2ZW50IHVwIHRvIHBhcmVudHNcblx0XHRcdGlmIChidWJibGUgIT09IGZhbHNlICYmIHNlbGYucGFyZW50KSB7XG5cdFx0XHRcdHZhciBwYXJlbnQgPSBzZWxmLnBhcmVudCgpO1xuXHRcdFx0XHR3aGlsZSAocGFyZW50ICYmICFhcmdzLmlzUHJvcGFnYXRpb25TdG9wcGVkKCkpIHtcblx0XHRcdFx0XHRwYXJlbnQuZmlyZShuYW1lLCBhcmdzLCBmYWxzZSk7XG5cdFx0XHRcdFx0cGFyZW50ID0gcGFyZW50LnBhcmVudCgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBhcmdzO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZXR1cm5zIHRydWUvZmFsc2UgaWYgdGhlIHNwZWNpZmllZCBldmVudCBoYXMgYW55IGxpc3RlbmVycy5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgaGFzRXZlbnRMaXN0ZW5lcnNcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSBOYW1lIG9mIHRoZSBldmVudCB0byBjaGVjayBmb3IuXG5cdFx0ICogQHJldHVybiB7Qm9vbGVhbn0gVHJ1ZS9mYWxzZSBzdGF0ZSBpZiB0aGUgZXZlbnQgaGFzIGxpc3RlbmVycy5cblx0XHQgKi9cblx0XHRoYXNFdmVudExpc3RlbmVyczogZnVuY3Rpb24obmFtZSkge1xuXHRcdFx0cmV0dXJuIGdldEV2ZW50RGlzcGF0Y2hlcih0aGlzKS5oYXMobmFtZSk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFJldHVybnMgYSBjb250cm9sIGNvbGxlY3Rpb24gd2l0aCBhbGwgcGFyZW50IGNvbnRyb2xzLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBwYXJlbnRzXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IHNlbGVjdG9yIE9wdGlvbmFsIHNlbGVjdG9yIGV4cHJlc3Npb24gdG8gZmluZCBwYXJlbnRzLlxuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UudWkuQ29sbGVjdGlvbn0gQ29sbGVjdGlvbiB3aXRoIGFsbCBwYXJlbnQgY29udHJvbHMuXG5cdFx0ICovXG5cdFx0cGFyZW50czogZnVuY3Rpb24oc2VsZWN0b3IpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgY3RybCwgcGFyZW50cyA9IG5ldyBDb2xsZWN0aW9uKCk7XG5cblx0XHRcdC8vIEFkZCBlYWNoIHBhcmVudCB0byBjb2xsZWN0aW9uXG5cdFx0XHRmb3IgKGN0cmwgPSBzZWxmLnBhcmVudCgpOyBjdHJsOyBjdHJsID0gY3RybC5wYXJlbnQoKSkge1xuXHRcdFx0XHRwYXJlbnRzLmFkZChjdHJsKTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gRmlsdGVyIGF3YXkgZXZlcnl0aGluZyB0aGF0IGRvZXNuJ3QgbWF0Y2ggdGhlIHNlbGVjdG9yXG5cdFx0XHRpZiAoc2VsZWN0b3IpIHtcblx0XHRcdFx0cGFyZW50cyA9IHBhcmVudHMuZmlsdGVyKHNlbGVjdG9yKTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHBhcmVudHM7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFJldHVybnMgdGhlIGN1cnJlbnQgY29udHJvbCBhbmQgaXQncyBwYXJlbnRzLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBwYXJlbnRzQW5kU2VsZlxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBzZWxlY3RvciBPcHRpb25hbCBzZWxlY3RvciBleHByZXNzaW9uIHRvIGZpbmQgcGFyZW50cy5cblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLnVpLkNvbGxlY3Rpb259IENvbGxlY3Rpb24gd2l0aCBhbGwgcGFyZW50IGNvbnRyb2xzLlxuXHRcdCAqL1xuXHRcdHBhcmVudHNBbmRTZWxmOiBmdW5jdGlvbihzZWxlY3Rvcikge1xuXHRcdFx0cmV0dXJuIG5ldyBDb2xsZWN0aW9uKHRoaXMpLmFkZCh0aGlzLnBhcmVudHMoc2VsZWN0b3IpKTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyB0aGUgY29udHJvbCBuZXh0IHRvIHRoZSBjdXJyZW50IGNvbnRyb2wuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIG5leHRcblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLnVpLkNvbnRyb2x9IE5leHQgY29udHJvbCBpbnN0YW5jZS5cblx0XHQgKi9cblx0XHRuZXh0OiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBwYXJlbnRDb250cm9scyA9IHRoaXMucGFyZW50KCkuaXRlbXMoKTtcblxuXHRcdFx0cmV0dXJuIHBhcmVudENvbnRyb2xzW3BhcmVudENvbnRyb2xzLmluZGV4T2YodGhpcykgKyAxXTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyB0aGUgY29udHJvbCBwcmV2aW91cyB0byB0aGUgY3VycmVudCBjb250cm9sLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBwcmV2XG5cdFx0ICogQHJldHVybiB7dGlueW1jZS51aS5Db250cm9sfSBQcmV2aW91cyBjb250cm9sIGluc3RhbmNlLlxuXHRcdCAqL1xuXHRcdHByZXY6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHBhcmVudENvbnRyb2xzID0gdGhpcy5wYXJlbnQoKS5pdGVtcygpO1xuXG5cdFx0XHRyZXR1cm4gcGFyZW50Q29udHJvbHNbcGFyZW50Q29udHJvbHMuaW5kZXhPZih0aGlzKSAtIDFdO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBTZXRzIHRoZSBpbm5lciBIVE1MIG9mIHRoZSBjb250cm9sIGVsZW1lbnQuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGlubmVySHRtbFxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBodG1sIEh0bWwgc3RyaW5nIHRvIHNldCBhcyBpbm5lciBodG1sLlxuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UudWkuQ29udHJvbH0gQ3VycmVudCBjb250cm9sIG9iamVjdC5cblx0XHQgKi9cblx0XHRpbm5lckh0bWw6IGZ1bmN0aW9uKGh0bWwpIHtcblx0XHRcdHRoaXMuJGVsLmh0bWwoaHRtbCk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyB0aGUgY29udHJvbCBET00gZWxlbWVudCBvciBzdWIgZWxlbWVudC5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgZ2V0RWxcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gW3N1ZmZpeF0gU3VmZml4IHRvIGdldCBlbGVtZW50IGJ5LlxuXHRcdCAqIEByZXR1cm4ge0VsZW1lbnR9IEhUTUwgRE9NIGVsZW1lbnQgZm9yIHRoZSBjdXJyZW50IGNvbnRyb2wgb3IgaXQncyBjaGlsZHJlbi5cblx0XHQgKi9cblx0XHRnZXRFbDogZnVuY3Rpb24oc3VmZml4KSB7XG5cdFx0XHR2YXIgaWQgPSBzdWZmaXggPyB0aGlzLl9pZCArICctJyArIHN1ZmZpeCA6IHRoaXMuX2lkO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2VsbUNhY2hlW2lkXSkge1xuXHRcdFx0XHR0aGlzLl9lbG1DYWNoZVtpZF0gPSAkKCcjJyArIGlkKVswXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHRoaXMuX2VsbUNhY2hlW2lkXTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogU2V0cyB0aGUgdmlzaWJsZSBzdGF0ZSB0byB0cnVlLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBzaG93XG5cdFx0ICogQHJldHVybiB7dGlueW1jZS51aS5Db250cm9sfSBDdXJyZW50IGNvbnRyb2wgaW5zdGFuY2UuXG5cdFx0ICovXG5cdFx0c2hvdzogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy52aXNpYmxlKHRydWUpO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBTZXRzIHRoZSB2aXNpYmxlIHN0YXRlIHRvIGZhbHNlLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBoaWRlXG5cdFx0ICogQHJldHVybiB7dGlueW1jZS51aS5Db250cm9sfSBDdXJyZW50IGNvbnRyb2wgaW5zdGFuY2UuXG5cdFx0ICovXG5cdFx0aGlkZTogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy52aXNpYmxlKGZhbHNlKTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogRm9jdXNlcyB0aGUgY3VycmVudCBjb250cm9sLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBmb2N1c1xuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UudWkuQ29udHJvbH0gQ3VycmVudCBjb250cm9sIGluc3RhbmNlLlxuXHRcdCAqL1xuXHRcdGZvY3VzOiBmdW5jdGlvbigpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHRoaXMuZ2V0RWwoKS5mb2N1cygpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0Ly8gSWdub3JlIElFIGVycm9yXG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBCbHVycyB0aGUgY3VycmVudCBjb250cm9sLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBibHVyXG5cdFx0ICogQHJldHVybiB7dGlueW1jZS51aS5Db250cm9sfSBDdXJyZW50IGNvbnRyb2wgaW5zdGFuY2UuXG5cdFx0ICovXG5cdFx0Ymx1cjogZnVuY3Rpb24oKSB7XG5cdFx0XHR0aGlzLmdldEVsKCkuYmx1cigpO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogU2V0cyB0aGUgc3BlY2lmaWVkIGFyaWEgcHJvcGVydHkuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGFyaWFcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSBOYW1lIG9mIHRoZSBhcmlhIHByb3BlcnR5IHRvIHNldC5cblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gdmFsdWUgVmFsdWUgb2YgdGhlIGFyaWEgcHJvcGVydHkuXG5cdFx0ICogQHJldHVybiB7dGlueW1jZS51aS5Db250cm9sfSBDdXJyZW50IGNvbnRyb2wgaW5zdGFuY2UuXG5cdFx0ICovXG5cdFx0YXJpYTogZnVuY3Rpb24obmFtZSwgdmFsdWUpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgZWxtID0gc2VsZi5nZXRFbChzZWxmLmFyaWFUYXJnZXQpO1xuXG5cdFx0XHRpZiAodHlwZW9mIHZhbHVlID09PSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0XHRcdHJldHVybiBzZWxmLl9hcmlhW25hbWVdO1xuXHRcdFx0fVxuXG5cdFx0XHRzZWxmLl9hcmlhW25hbWVdID0gdmFsdWU7XG5cblx0XHRcdGlmIChzZWxmLnN0YXRlLmdldCgncmVuZGVyZWQnKSkge1xuXHRcdFx0XHRlbG0uc2V0QXR0cmlidXRlKG5hbWUgPT0gJ3JvbGUnID8gbmFtZSA6ICdhcmlhLScgKyBuYW1lLCB2YWx1ZSk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBzZWxmO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBFbmNvZGVzIHRoZSBzcGVjaWZpZWQgc3RyaW5nIHdpdGggSFRNTCBlbnRpdGllcy4gSXQgd2lsbCBhbHNvXG5cdFx0ICogdHJhbnNsYXRlIHRoZSBzdHJpbmcgdG8gZGlmZmVyZW50IGxhbmd1YWdlcy5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgZW5jb2RlXG5cdFx0ICogQHBhcmFtIHtTdHJpbmcvT2JqZWN0L0FycmF5fSB0ZXh0IFRleHQgdG8gZW50aXR5IGVuY29kZS5cblx0XHQgKiBAcGFyYW0ge0Jvb2xlYW59IFt0cmFuc2xhdGU9dHJ1ZV0gRmFsc2UgaWYgdGhlIGNvbnRlbnRzIHNob3VsZG4ndCBiZSB0cmFuc2xhdGVkLlxuXHRcdCAqIEByZXR1cm4ge1N0cmluZ30gRW5jb2RlZCBhbmQgcG9zc2libGUgdHJhc2xhdGVkIHN0cmluZy5cblx0XHQgKi9cblx0XHRlbmNvZGU6IGZ1bmN0aW9uKHRleHQsIHRyYW5zbGF0ZSkge1xuXHRcdFx0aWYgKHRyYW5zbGF0ZSAhPT0gZmFsc2UpIHtcblx0XHRcdFx0dGV4dCA9IHRoaXMudHJhbnNsYXRlKHRleHQpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gKHRleHQgfHwgJycpLnJlcGxhY2UoL1smPD5cIl0vZywgZnVuY3Rpb24obWF0Y2gpIHtcblx0XHRcdFx0cmV0dXJuICcmIycgKyBtYXRjaC5jaGFyQ29kZUF0KDApICsgJzsnO1xuXHRcdFx0fSk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFJldHVybnMgdGhlIHRyYW5zbGF0ZWQgc3RyaW5nLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCB0cmFuc2xhdGVcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gdGV4dCBUZXh0IHRvIHRyYW5zbGF0ZS5cblx0XHQgKiBAcmV0dXJuIHtTdHJpbmd9IFRyYW5zbGF0ZWQgc3RyaW5nIG9yIHRoZSBzYW1lIGFzIHRoZSBpbnB1dC5cblx0XHQgKi9cblx0XHR0cmFuc2xhdGU6IGZ1bmN0aW9uKHRleHQpIHtcblx0XHRcdHJldHVybiBDb250cm9sLnRyYW5zbGF0ZSA/IENvbnRyb2wudHJhbnNsYXRlKHRleHQpIDogdGV4dDtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogQWRkcyBpdGVtcyBiZWZvcmUgdGhlIGN1cnJlbnQgY29udHJvbC5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgYmVmb3JlXG5cdFx0ICogQHBhcmFtIHtBcnJheS90aW55bWNlLnVpLkNvbGxlY3Rpb259IGl0ZW1zIEFycmF5IG9mIGl0ZW1zIHRvIHByZXBlbmQgYmVmb3JlIHRoaXMgY29udHJvbC5cblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLnVpLkNvbnRyb2x9IEN1cnJlbnQgY29udHJvbCBpbnN0YW5jZS5cblx0XHQgKi9cblx0XHRiZWZvcmU6IGZ1bmN0aW9uKGl0ZW1zKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIHBhcmVudCA9IHNlbGYucGFyZW50KCk7XG5cblx0XHRcdGlmIChwYXJlbnQpIHtcblx0XHRcdFx0cGFyZW50Lmluc2VydChpdGVtcywgcGFyZW50Lml0ZW1zKCkuaW5kZXhPZihzZWxmKSwgdHJ1ZSk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBzZWxmO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBBZGRzIGl0ZW1zIGFmdGVyIHRoZSBjdXJyZW50IGNvbnRyb2wuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGFmdGVyXG5cdFx0ICogQHBhcmFtIHtBcnJheS90aW55bWNlLnVpLkNvbGxlY3Rpb259IGl0ZW1zIEFycmF5IG9mIGl0ZW1zIHRvIGFwcGVuZCBhZnRlciB0aGlzIGNvbnRyb2wuXG5cdFx0ICogQHJldHVybiB7dGlueW1jZS51aS5Db250cm9sfSBDdXJyZW50IGNvbnRyb2wgaW5zdGFuY2UuXG5cdFx0ICovXG5cdFx0YWZ0ZXI6IGZ1bmN0aW9uKGl0ZW1zKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIHBhcmVudCA9IHNlbGYucGFyZW50KCk7XG5cblx0XHRcdGlmIChwYXJlbnQpIHtcblx0XHRcdFx0cGFyZW50Lmluc2VydChpdGVtcywgcGFyZW50Lml0ZW1zKCkuaW5kZXhPZihzZWxmKSk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBzZWxmO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZW1vdmVzIHRoZSBjdXJyZW50IGNvbnRyb2wgZnJvbSBET00gYW5kIGZyb20gVUkgY29sbGVjdGlvbnMuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHJlbW92ZVxuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UudWkuQ29udHJvbH0gQ3VycmVudCBjb250cm9sIGluc3RhbmNlLlxuXHRcdCAqL1xuXHRcdHJlbW92ZTogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIGVsbSA9IHNlbGYuZ2V0RWwoKSwgcGFyZW50ID0gc2VsZi5wYXJlbnQoKSwgbmV3SXRlbXMsIGk7XG5cblx0XHRcdGlmIChzZWxmLml0ZW1zKSB7XG5cdFx0XHRcdHZhciBjb250cm9scyA9IHNlbGYuaXRlbXMoKS50b0FycmF5KCk7XG5cdFx0XHRcdGkgPSBjb250cm9scy5sZW5ndGg7XG5cdFx0XHRcdHdoaWxlIChpLS0pIHtcblx0XHRcdFx0XHRjb250cm9sc1tpXS5yZW1vdmUoKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAocGFyZW50ICYmIHBhcmVudC5pdGVtcykge1xuXHRcdFx0XHRuZXdJdGVtcyA9IFtdO1xuXG5cdFx0XHRcdHBhcmVudC5pdGVtcygpLmVhY2goZnVuY3Rpb24oaXRlbSkge1xuXHRcdFx0XHRcdGlmIChpdGVtICE9PSBzZWxmKSB7XG5cdFx0XHRcdFx0XHRuZXdJdGVtcy5wdXNoKGl0ZW0pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0cGFyZW50Lml0ZW1zKCkuc2V0KG5ld0l0ZW1zKTtcblx0XHRcdFx0cGFyZW50Ll9sYXN0UmVjdCA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChzZWxmLl9ldmVudHNSb290ICYmIHNlbGYuX2V2ZW50c1Jvb3QgPT0gc2VsZikge1xuXHRcdFx0XHQkKGVsbSkub2ZmKCk7XG5cdFx0XHR9XG5cblx0XHRcdHZhciBsb29rdXAgPSBzZWxmLmdldFJvb3QoKS5jb250cm9sSWRMb29rdXA7XG5cdFx0XHRpZiAobG9va3VwKSB7XG5cdFx0XHRcdGRlbGV0ZSBsb29rdXBbc2VsZi5faWRdO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoZWxtICYmIGVsbS5wYXJlbnROb2RlKSB7XG5cdFx0XHRcdGVsbS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGVsbSk7XG5cdFx0XHR9XG5cblx0XHRcdHNlbGYuc3RhdGUuc2V0KCdyZW5kZXJlZCcsIGZhbHNlKTtcblx0XHRcdHNlbGYuc3RhdGUuZGVzdHJveSgpO1xuXG5cdFx0XHRzZWxmLmZpcmUoJ3JlbW92ZScpO1xuXG5cdFx0XHRyZXR1cm4gc2VsZjtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmVuZGVycyB0aGUgY29udHJvbCBiZWZvcmUgdGhlIHNwZWNpZmllZCBlbGVtZW50LlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCByZW5kZXJCZWZvcmVcblx0XHQgKiBAcGFyYW0ge0VsZW1lbnR9IGVsbSBFbGVtZW50IHRvIHJlbmRlciBiZWZvcmUuXG5cdFx0ICogQHJldHVybiB7dGlueW1jZS51aS5Db250cm9sfSBDdXJyZW50IGNvbnRyb2wgaW5zdGFuY2UuXG5cdFx0ICovXG5cdFx0cmVuZGVyQmVmb3JlOiBmdW5jdGlvbihlbG0pIHtcblx0XHRcdCQoZWxtKS5iZWZvcmUodGhpcy5yZW5kZXJIdG1sKCkpO1xuXHRcdFx0dGhpcy5wb3N0UmVuZGVyKCk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmVuZGVycyB0aGUgY29udHJvbCB0byB0aGUgc3BlY2lmaWVkIGVsZW1lbnQuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHJlbmRlckJlZm9yZVxuXHRcdCAqIEBwYXJhbSB7RWxlbWVudH0gZWxtIEVsZW1lbnQgdG8gcmVuZGVyIHRvLlxuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UudWkuQ29udHJvbH0gQ3VycmVudCBjb250cm9sIGluc3RhbmNlLlxuXHRcdCAqL1xuXHRcdHJlbmRlclRvOiBmdW5jdGlvbihlbG0pIHtcblx0XHRcdCQoZWxtIHx8IHRoaXMuZ2V0Q29udGFpbmVyRWxtKCkpLmFwcGVuZCh0aGlzLnJlbmRlckh0bWwoKSk7XG5cdFx0XHR0aGlzLnBvc3RSZW5kZXIoKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cblx0XHRwcmVSZW5kZXI6IGZ1bmN0aW9uKCkge1xuXHRcdH0sXG5cblx0XHRyZW5kZXI6IGZ1bmN0aW9uKCkge1xuXHRcdH0sXG5cblx0XHRyZW5kZXJIdG1sOiBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiAnPGRpdiBpZD1cIicgKyB0aGlzLl9pZCArICdcIiBjbGFzcz1cIicgKyB0aGlzLmNsYXNzZXMgKyAnXCI+PC9kaXY+Jztcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUG9zdCByZW5kZXIgbWV0aG9kLiBDYWxsZWQgYWZ0ZXIgdGhlIGNvbnRyb2wgaGFzIGJlZW4gcmVuZGVyZWQgdG8gdGhlIHRhcmdldC5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgcG9zdFJlbmRlclxuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UudWkuQ29udHJvbH0gQ3VycmVudCBjb250cm9sIGluc3RhbmNlLlxuXHRcdCAqL1xuXHRcdHBvc3RSZW5kZXI6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLCBzZXR0aW5ncyA9IHNlbGYuc2V0dGluZ3MsIGVsbSwgYm94LCBwYXJlbnQsIG5hbWUsIHBhcmVudEV2ZW50c1Jvb3Q7XG5cblx0XHRcdHNlbGYuJGVsID0gJChzZWxmLmdldEVsKCkpO1xuXHRcdFx0c2VsZi5zdGF0ZS5zZXQoJ3JlbmRlcmVkJywgdHJ1ZSk7XG5cblx0XHRcdC8vIEJpbmQgb248ZXZlbnQ+IHNldHRpbmdzXG5cdFx0XHRmb3IgKG5hbWUgaW4gc2V0dGluZ3MpIHtcblx0XHRcdFx0aWYgKG5hbWUuaW5kZXhPZihcIm9uXCIpID09PSAwKSB7XG5cdFx0XHRcdFx0c2VsZi5vbihuYW1lLnN1YnN0cigyKSwgc2V0dGluZ3NbbmFtZV0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmIChzZWxmLl9ldmVudHNSb290KSB7XG5cdFx0XHRcdGZvciAocGFyZW50ID0gc2VsZi5wYXJlbnQoKTsgIXBhcmVudEV2ZW50c1Jvb3QgJiYgcGFyZW50OyBwYXJlbnQgPSBwYXJlbnQucGFyZW50KCkpIHtcblx0XHRcdFx0XHRwYXJlbnRFdmVudHNSb290ID0gcGFyZW50Ll9ldmVudHNSb290O1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHBhcmVudEV2ZW50c1Jvb3QpIHtcblx0XHRcdFx0XHRmb3IgKG5hbWUgaW4gcGFyZW50RXZlbnRzUm9vdC5fbmF0aXZlRXZlbnRzKSB7XG5cdFx0XHRcdFx0XHRzZWxmLl9uYXRpdmVFdmVudHNbbmFtZV0gPSB0cnVlO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRiaW5kUGVuZGluZ0V2ZW50cyhzZWxmKTtcblxuXHRcdFx0aWYgKHNldHRpbmdzLnN0eWxlKSB7XG5cdFx0XHRcdGVsbSA9IHNlbGYuZ2V0RWwoKTtcblx0XHRcdFx0aWYgKGVsbSkge1xuXHRcdFx0XHRcdGVsbS5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgc2V0dGluZ3Muc3R5bGUpO1xuXHRcdFx0XHRcdGVsbS5zdHlsZS5jc3NUZXh0ID0gc2V0dGluZ3Muc3R5bGU7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHNlbGYuc2V0dGluZ3MuYm9yZGVyKSB7XG5cdFx0XHRcdGJveCA9IHNlbGYuYm9yZGVyQm94O1xuXHRcdFx0XHRzZWxmLiRlbC5jc3Moe1xuXHRcdFx0XHRcdCdib3JkZXItdG9wLXdpZHRoJzogYm94LnRvcCxcblx0XHRcdFx0XHQnYm9yZGVyLXJpZ2h0LXdpZHRoJzogYm94LnJpZ2h0LFxuXHRcdFx0XHRcdCdib3JkZXItYm90dG9tLXdpZHRoJzogYm94LmJvdHRvbSxcblx0XHRcdFx0XHQnYm9yZGVyLWxlZnQtd2lkdGgnOiBib3gubGVmdFxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gQWRkIGluc3RhbmNlIHRvIGxvb2t1cFxuXHRcdFx0dmFyIHJvb3QgPSBzZWxmLmdldFJvb3QoKTtcblx0XHRcdGlmICghcm9vdC5jb250cm9sSWRMb29rdXApIHtcblx0XHRcdFx0cm9vdC5jb250cm9sSWRMb29rdXAgPSB7fTtcblx0XHRcdH1cblxuXHRcdFx0cm9vdC5jb250cm9sSWRMb29rdXBbc2VsZi5faWRdID0gc2VsZjtcblxuXHRcdFx0Zm9yICh2YXIga2V5IGluIHNlbGYuX2FyaWEpIHtcblx0XHRcdFx0c2VsZi5hcmlhKGtleSwgc2VsZi5fYXJpYVtrZXldKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHNlbGYuc3RhdGUuZ2V0KCd2aXNpYmxlJykgPT09IGZhbHNlKSB7XG5cdFx0XHRcdHNlbGYuZ2V0RWwoKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuXHRcdFx0fVxuXG5cdFx0XHRzZWxmLmJpbmRTdGF0ZXMoKTtcblxuXHRcdFx0c2VsZi5zdGF0ZS5vbignY2hhbmdlOnZpc2libGUnLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdHZhciBzdGF0ZSA9IGUudmFsdWUsIHBhcmVudEN0cmw7XG5cblx0XHRcdFx0aWYgKHNlbGYuc3RhdGUuZ2V0KCdyZW5kZXJlZCcpKSB7XG5cdFx0XHRcdFx0c2VsZi5nZXRFbCgpLnN0eWxlLmRpc3BsYXkgPSBzdGF0ZSA9PT0gZmFsc2UgPyAnbm9uZScgOiAnJztcblxuXHRcdFx0XHRcdC8vIE5lZWQgdG8gZm9yY2UgYSByZWZsb3cgaGVyZSBvbiBJRSA4XG5cdFx0XHRcdFx0c2VsZi5nZXRFbCgpLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gUGFyZW50IGNvbnRhaW5lciBuZWVkcyB0byByZWZsb3dcblx0XHRcdFx0cGFyZW50Q3RybCA9IHNlbGYucGFyZW50KCk7XG5cdFx0XHRcdGlmIChwYXJlbnRDdHJsKSB7XG5cdFx0XHRcdFx0cGFyZW50Q3RybC5fbGFzdFJlY3QgPSBudWxsO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0c2VsZi5maXJlKHN0YXRlID8gJ3Nob3cnIDogJ2hpZGUnKTtcblxuXHRcdFx0XHRSZWZsb3dRdWV1ZS5hZGQoc2VsZik7XG5cdFx0XHR9KTtcblxuXHRcdFx0c2VsZi5maXJlKCdwb3N0cmVuZGVyJywge30sIGZhbHNlKTtcblx0XHR9LFxuXG5cdFx0YmluZFN0YXRlczogZnVuY3Rpb24oKSB7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFNjcm9sbHMgdGhlIGN1cnJlbnQgY29udHJvbCBpbnRvIHZpZXcuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHNjcm9sbEludG9WaWV3XG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IGFsaWduIEFsaWdubWVudCBpbiB2aWV3IHRvcHxjZW50ZXJ8Ym90dG9tLlxuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UudWkuQ29udHJvbH0gQ3VycmVudCBjb250cm9sIGluc3RhbmNlLlxuXHRcdCAqL1xuXHRcdHNjcm9sbEludG9WaWV3OiBmdW5jdGlvbihhbGlnbikge1xuXHRcdFx0ZnVuY3Rpb24gZ2V0T2Zmc2V0KGVsbSwgcm9vdEVsbSkge1xuXHRcdFx0XHR2YXIgeCwgeSwgcGFyZW50ID0gZWxtO1xuXG5cdFx0XHRcdHggPSB5ID0gMDtcblx0XHRcdFx0d2hpbGUgKHBhcmVudCAmJiBwYXJlbnQgIT0gcm9vdEVsbSAmJiBwYXJlbnQubm9kZVR5cGUpIHtcblx0XHRcdFx0XHR4ICs9IHBhcmVudC5vZmZzZXRMZWZ0IHx8IDA7XG5cdFx0XHRcdFx0eSArPSBwYXJlbnQub2Zmc2V0VG9wIHx8IDA7XG5cdFx0XHRcdFx0cGFyZW50ID0gcGFyZW50Lm9mZnNldFBhcmVudDtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiB7eDogeCwgeTogeX07XG5cdFx0XHR9XG5cblx0XHRcdHZhciBlbG0gPSB0aGlzLmdldEVsKCksIHBhcmVudEVsbSA9IGVsbS5wYXJlbnROb2RlO1xuXHRcdFx0dmFyIHgsIHksIHdpZHRoLCBoZWlnaHQsIHBhcmVudFdpZHRoLCBwYXJlbnRIZWlnaHQ7XG5cdFx0XHR2YXIgcG9zID0gZ2V0T2Zmc2V0KGVsbSwgcGFyZW50RWxtKTtcblxuXHRcdFx0eCA9IHBvcy54O1xuXHRcdFx0eSA9IHBvcy55O1xuXHRcdFx0d2lkdGggPSBlbG0ub2Zmc2V0V2lkdGg7XG5cdFx0XHRoZWlnaHQgPSBlbG0ub2Zmc2V0SGVpZ2h0O1xuXHRcdFx0cGFyZW50V2lkdGggPSBwYXJlbnRFbG0uY2xpZW50V2lkdGg7XG5cdFx0XHRwYXJlbnRIZWlnaHQgPSBwYXJlbnRFbG0uY2xpZW50SGVpZ2h0O1xuXG5cdFx0XHRpZiAoYWxpZ24gPT0gXCJlbmRcIikge1xuXHRcdFx0XHR4IC09IHBhcmVudFdpZHRoIC0gd2lkdGg7XG5cdFx0XHRcdHkgLT0gcGFyZW50SGVpZ2h0IC0gaGVpZ2h0O1xuXHRcdFx0fSBlbHNlIGlmIChhbGlnbiA9PSBcImNlbnRlclwiKSB7XG5cdFx0XHRcdHggLT0gKHBhcmVudFdpZHRoIC8gMikgLSAod2lkdGggLyAyKTtcblx0XHRcdFx0eSAtPSAocGFyZW50SGVpZ2h0IC8gMikgLSAoaGVpZ2h0IC8gMik7XG5cdFx0XHR9XG5cblx0XHRcdHBhcmVudEVsbS5zY3JvbGxMZWZ0ID0geDtcblx0XHRcdHBhcmVudEVsbS5zY3JvbGxUb3AgPSB5O1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXG5cdFx0Z2V0Um9vdDogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgY3RybCA9IHRoaXMsIHJvb3RDb250cm9sLCBwYXJlbnRzID0gW107XG5cblx0XHRcdHdoaWxlIChjdHJsKSB7XG5cdFx0XHRcdGlmIChjdHJsLnJvb3RDb250cm9sKSB7XG5cdFx0XHRcdFx0cm9vdENvbnRyb2wgPSBjdHJsLnJvb3RDb250cm9sO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cGFyZW50cy5wdXNoKGN0cmwpO1xuXHRcdFx0XHRyb290Q29udHJvbCA9IGN0cmw7XG5cdFx0XHRcdGN0cmwgPSBjdHJsLnBhcmVudCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoIXJvb3RDb250cm9sKSB7XG5cdFx0XHRcdHJvb3RDb250cm9sID0gdGhpcztcblx0XHRcdH1cblxuXHRcdFx0dmFyIGkgPSBwYXJlbnRzLmxlbmd0aDtcblx0XHRcdHdoaWxlIChpLS0pIHtcblx0XHRcdFx0cGFyZW50c1tpXS5yb290Q29udHJvbCA9IHJvb3RDb250cm9sO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gcm9vdENvbnRyb2w7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFJlZmxvd3MgdGhlIGN1cnJlbnQgY29udHJvbCBhbmQgaXQncyBwYXJlbnRzLlxuXHRcdCAqIFRoaXMgc2hvdWxkIGJlIHVzZWQgYWZ0ZXIgeW91IGZvciBleGFtcGxlIGFwcGVuZCBjaGlsZHJlbiB0byB0aGUgY3VycmVudCBjb250cm9sIHNvXG5cdFx0ICogdGhhdCB0aGUgbGF5b3V0IG1hbmFnZXJzIGtub3cgdGhhdCB0aGV5IG5lZWQgdG8gcmVwb3NpdGlvbiBldmVyeXRoaW5nLlxuXHRcdCAqXG5cdFx0ICogQGV4YW1wbGVcblx0XHQgKiBjb250YWluZXIuYXBwZW5kKHt0eXBlOiAnYnV0dG9uJywgdGV4dDogJ015IGJ1dHRvbid9KS5yZWZsb3coKTtcblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgcmVmbG93XG5cdFx0ICogQHJldHVybiB7dGlueW1jZS51aS5Db250cm9sfSBDdXJyZW50IGNvbnRyb2wgaW5zdGFuY2UuXG5cdFx0ICovXG5cdFx0cmVmbG93OiBmdW5jdGlvbigpIHtcblx0XHRcdFJlZmxvd1F1ZXVlLnJlbW92ZSh0aGlzKTtcblxuXHRcdFx0dmFyIHBhcmVudCA9IHRoaXMucGFyZW50KCk7XG5cdFx0XHRpZiAocGFyZW50Ll9sYXlvdXQgJiYgIXBhcmVudC5fbGF5b3V0LmlzTmF0aXZlKCkpIHtcblx0XHRcdFx0cGFyZW50LnJlZmxvdygpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQvKipcblx0XHQgKiBTZXRzL2dldHMgdGhlIHBhcmVudCBjb250YWluZXIgZm9yIHRoZSBjb250cm9sLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBwYXJlbnRcblx0XHQgKiBAcGFyYW0ge3RpbnltY2UudWkuQ29udGFpbmVyfSBwYXJlbnQgT3B0aW9uYWwgcGFyZW50IHRvIHNldC5cblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLnVpLkNvbnRyb2x9IFBhcmVudCBjb250cm9sIG9yIHRoZSBjdXJyZW50IGNvbnRyb2wgb24gYSBzZXQgYWN0aW9uLlxuXHRcdCAqL1xuXHRcdC8vIHBhcmVudDogZnVuY3Rpb24ocGFyZW50KSB7fSAtLSBHZW5lcmF0ZWRcblxuXHRcdC8qKlxuXHRcdCAqIFNldHMvZ2V0cyB0aGUgdGV4dCBmb3IgdGhlIGNvbnRyb2wuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHRleHRcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gdmFsdWUgVmFsdWUgdG8gc2V0IHRvIGNvbnRyb2wuXG5cdFx0ICogQHJldHVybiB7U3RyaW5nL3RpbnltY2UudWkuQ29udHJvbH0gQ3VycmVudCBjb250cm9sIG9uIGEgc2V0IG9wZXJhdGlvbiBvciBjdXJyZW50IHZhbHVlIG9uIGEgZ2V0LlxuXHRcdCAqL1xuXHRcdC8vIHRleHQ6IGZ1bmN0aW9uKHZhbHVlKSB7fSAtLSBHZW5lcmF0ZWRcblxuXHRcdC8qKlxuXHRcdCAqIFNldHMvZ2V0cyB0aGUgZGlzYWJsZWQgc3RhdGUgb24gdGhlIGNvbnRyb2wuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGRpc2FibGVkXG5cdFx0ICogQHBhcmFtIHtCb29sZWFufSBzdGF0ZSBWYWx1ZSB0byBzZXQgdG8gY29udHJvbC5cblx0XHQgKiBAcmV0dXJuIHtCb29sZWFuL3RpbnltY2UudWkuQ29udHJvbH0gQ3VycmVudCBjb250cm9sIG9uIGEgc2V0IG9wZXJhdGlvbiBvciBjdXJyZW50IHN0YXRlIG9uIGEgZ2V0LlxuXHRcdCAqL1xuXHRcdC8vIGRpc2FibGVkOiBmdW5jdGlvbihzdGF0ZSkge30gLS0gR2VuZXJhdGVkXG5cblx0XHQvKipcblx0XHQgKiBTZXRzL2dldHMgdGhlIGFjdGl2ZSBmb3IgdGhlIGNvbnRyb2wuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGFjdGl2ZVxuXHRcdCAqIEBwYXJhbSB7Qm9vbGVhbn0gc3RhdGUgVmFsdWUgdG8gc2V0IHRvIGNvbnRyb2wuXG5cdFx0ICogQHJldHVybiB7Qm9vbGVhbi90aW55bWNlLnVpLkNvbnRyb2x9IEN1cnJlbnQgY29udHJvbCBvbiBhIHNldCBvcGVyYXRpb24gb3IgY3VycmVudCBzdGF0ZSBvbiBhIGdldC5cblx0XHQgKi9cblx0XHQvLyBhY3RpdmU6IGZ1bmN0aW9uKHN0YXRlKSB7fSAtLSBHZW5lcmF0ZWRcblxuXHRcdC8qKlxuXHRcdCAqIFNldHMvZ2V0cyB0aGUgbmFtZSBmb3IgdGhlIGNvbnRyb2wuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIG5hbWVcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gdmFsdWUgVmFsdWUgdG8gc2V0IHRvIGNvbnRyb2wuXG5cdFx0ICogQHJldHVybiB7U3RyaW5nL3RpbnltY2UudWkuQ29udHJvbH0gQ3VycmVudCBjb250cm9sIG9uIGEgc2V0IG9wZXJhdGlvbiBvciBjdXJyZW50IHZhbHVlIG9uIGEgZ2V0LlxuXHRcdCAqL1xuXHRcdC8vIG5hbWU6IGZ1bmN0aW9uKHZhbHVlKSB7fSAtLSBHZW5lcmF0ZWRcblxuXHRcdC8qKlxuXHRcdCAqIFNldHMvZ2V0cyB0aGUgdGl0bGUgZm9yIHRoZSBjb250cm9sLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCB0aXRsZVxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSB2YWx1ZSBWYWx1ZSB0byBzZXQgdG8gY29udHJvbC5cblx0XHQgKiBAcmV0dXJuIHtTdHJpbmcvdGlueW1jZS51aS5Db250cm9sfSBDdXJyZW50IGNvbnRyb2wgb24gYSBzZXQgb3BlcmF0aW9uIG9yIGN1cnJlbnQgdmFsdWUgb24gYSBnZXQuXG5cdFx0ICovXG5cdFx0Ly8gdGl0bGU6IGZ1bmN0aW9uKHZhbHVlKSB7fSAtLSBHZW5lcmF0ZWRcblxuXHRcdC8qKlxuXHRcdCAqIFNldHMvZ2V0cyB0aGUgdmlzaWJsZSBmb3IgdGhlIGNvbnRyb2wuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHZpc2libGVcblx0XHQgKiBAcGFyYW0ge0Jvb2xlYW59IHN0YXRlIFZhbHVlIHRvIHNldCB0byBjb250cm9sLlxuXHRcdCAqIEByZXR1cm4ge0Jvb2xlYW4vdGlueW1jZS51aS5Db250cm9sfSBDdXJyZW50IGNvbnRyb2wgb24gYSBzZXQgb3BlcmF0aW9uIG9yIGN1cnJlbnQgc3RhdGUgb24gYSBnZXQuXG5cdFx0ICovXG5cdFx0Ly8gdmlzaWJsZTogZnVuY3Rpb24odmFsdWUpIHt9IC0tIEdlbmVyYXRlZFxuXHR9O1xuXG5cdC8qKlxuXHQgKiBTZXR1cCBzdGF0ZSBwcm9wZXJ0aWVzLlxuXHQgKi9cblx0VG9vbHMuZWFjaCgndGV4dCB0aXRsZSB2aXNpYmxlIGRpc2FibGVkIGFjdGl2ZSB2YWx1ZScuc3BsaXQoJyAnKSwgZnVuY3Rpb24obmFtZSkge1xuXHRcdHByb3RvW25hbWVdID0gZnVuY3Rpb24odmFsdWUpIHtcblx0XHRcdGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAwKSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0YXRlLmdldChuYW1lKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZiB2YWx1ZSAhPSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0XHRcdHRoaXMuc3RhdGUuc2V0KG5hbWUsIHZhbHVlKTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fTtcblx0fSk7XG5cblx0Q29udHJvbCA9IENsYXNzLmV4dGVuZChwcm90byk7XG5cblx0ZnVuY3Rpb24gZ2V0RXZlbnREaXNwYXRjaGVyKG9iaikge1xuXHRcdGlmICghb2JqLl9ldmVudERpc3BhdGNoZXIpIHtcblx0XHRcdG9iai5fZXZlbnREaXNwYXRjaGVyID0gbmV3IEV2ZW50RGlzcGF0Y2hlcih7XG5cdFx0XHRcdHNjb3BlOiBvYmosXG5cdFx0XHRcdHRvZ2dsZUV2ZW50OiBmdW5jdGlvbihuYW1lLCBzdGF0ZSkge1xuXHRcdFx0XHRcdGlmIChzdGF0ZSAmJiBFdmVudERpc3BhdGNoZXIuaXNOYXRpdmUobmFtZSkpIHtcblx0XHRcdFx0XHRcdGlmICghb2JqLl9uYXRpdmVFdmVudHMpIHtcblx0XHRcdFx0XHRcdFx0b2JqLl9uYXRpdmVFdmVudHMgPSB7fTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0b2JqLl9uYXRpdmVFdmVudHNbbmFtZV0gPSB0cnVlO1xuXG5cdFx0XHRcdFx0XHRpZiAob2JqLnN0YXRlLmdldCgncmVuZGVyZWQnKSkge1xuXHRcdFx0XHRcdFx0XHRiaW5kUGVuZGluZ0V2ZW50cyhvYmopO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIG9iai5fZXZlbnREaXNwYXRjaGVyO1xuXHR9XG5cblx0ZnVuY3Rpb24gYmluZFBlbmRpbmdFdmVudHMoZXZlbnRDdHJsKSB7XG5cdFx0dmFyIGksIGwsIHBhcmVudHMsIGV2ZW50Um9vdEN0cmwsIG5hdGl2ZUV2ZW50cywgbmFtZTtcblxuXHRcdGZ1bmN0aW9uIGRlbGVnYXRlKGUpIHtcblx0XHRcdHZhciBjb250cm9sID0gZXZlbnRDdHJsLmdldFBhcmVudEN0cmwoZS50YXJnZXQpO1xuXG5cdFx0XHRpZiAoY29udHJvbCkge1xuXHRcdFx0XHRjb250cm9sLmZpcmUoZS50eXBlLCBlKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRmdW5jdGlvbiBtb3VzZUxlYXZlSGFuZGxlcigpIHtcblx0XHRcdHZhciBjdHJsID0gZXZlbnRSb290Q3RybC5fbGFzdEhvdmVyQ3RybDtcblxuXHRcdFx0aWYgKGN0cmwpIHtcblx0XHRcdFx0Y3RybC5maXJlKFwibW91c2VsZWF2ZVwiLCB7dGFyZ2V0OiBjdHJsLmdldEVsKCl9KTtcblxuXHRcdFx0XHRjdHJsLnBhcmVudHMoKS5lYWNoKGZ1bmN0aW9uKGN0cmwpIHtcblx0XHRcdFx0XHRjdHJsLmZpcmUoXCJtb3VzZWxlYXZlXCIsIHt0YXJnZXQ6IGN0cmwuZ2V0RWwoKX0pO1xuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHRldmVudFJvb3RDdHJsLl9sYXN0SG92ZXJDdHJsID0gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRmdW5jdGlvbiBtb3VzZUVudGVySGFuZGxlcihlKSB7XG5cdFx0XHR2YXIgY3RybCA9IGV2ZW50Q3RybC5nZXRQYXJlbnRDdHJsKGUudGFyZ2V0KSwgbGFzdEN0cmwgPSBldmVudFJvb3RDdHJsLl9sYXN0SG92ZXJDdHJsLCBpZHggPSAwLCBpLCBwYXJlbnRzLCBsYXN0UGFyZW50cztcblxuXHRcdFx0Ly8gT3ZlciBvbiBhIG5ldyBjb250cm9sXG5cdFx0XHRpZiAoY3RybCAhPT0gbGFzdEN0cmwpIHtcblx0XHRcdFx0ZXZlbnRSb290Q3RybC5fbGFzdEhvdmVyQ3RybCA9IGN0cmw7XG5cblx0XHRcdFx0cGFyZW50cyA9IGN0cmwucGFyZW50cygpLnRvQXJyYXkoKS5yZXZlcnNlKCk7XG5cdFx0XHRcdHBhcmVudHMucHVzaChjdHJsKTtcblxuXHRcdFx0XHRpZiAobGFzdEN0cmwpIHtcblx0XHRcdFx0XHRsYXN0UGFyZW50cyA9IGxhc3RDdHJsLnBhcmVudHMoKS50b0FycmF5KCkucmV2ZXJzZSgpO1xuXHRcdFx0XHRcdGxhc3RQYXJlbnRzLnB1c2gobGFzdEN0cmwpO1xuXG5cdFx0XHRcdFx0Zm9yIChpZHggPSAwOyBpZHggPCBsYXN0UGFyZW50cy5sZW5ndGg7IGlkeCsrKSB7XG5cdFx0XHRcdFx0XHRpZiAocGFyZW50c1tpZHhdICE9PSBsYXN0UGFyZW50c1tpZHhdKSB7XG5cdFx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGZvciAoaSA9IGxhc3RQYXJlbnRzLmxlbmd0aCAtIDE7IGkgPj0gaWR4OyBpLS0pIHtcblx0XHRcdFx0XHRcdGxhc3RDdHJsID0gbGFzdFBhcmVudHNbaV07XG5cdFx0XHRcdFx0XHRsYXN0Q3RybC5maXJlKFwibW91c2VsZWF2ZVwiLCB7XG5cdFx0XHRcdFx0XHRcdHRhcmdldDogbGFzdEN0cmwuZ2V0RWwoKVxuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0Zm9yIChpID0gaWR4OyBpIDwgcGFyZW50cy5sZW5ndGg7IGkrKykge1xuXHRcdFx0XHRcdGN0cmwgPSBwYXJlbnRzW2ldO1xuXHRcdFx0XHRcdGN0cmwuZmlyZShcIm1vdXNlZW50ZXJcIiwge1xuXHRcdFx0XHRcdFx0dGFyZ2V0OiBjdHJsLmdldEVsKClcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIGZpeFdoZWVsRXZlbnQoZSkge1xuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdFx0XHRpZiAoZS50eXBlID09IFwibW91c2V3aGVlbFwiKSB7XG5cdFx0XHRcdGUuZGVsdGFZID0gLTEgLyA0MCAqIGUud2hlZWxEZWx0YTtcblxuXHRcdFx0XHRpZiAoZS53aGVlbERlbHRhWCkge1xuXHRcdFx0XHRcdGUuZGVsdGFYID0gLTEgLyA0MCAqIGUud2hlZWxEZWx0YVg7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGUuZGVsdGFYID0gMDtcblx0XHRcdFx0ZS5kZWx0YVkgPSBlLmRldGFpbDtcblx0XHRcdH1cblxuXHRcdFx0ZSA9IGV2ZW50Q3RybC5maXJlKFwid2hlZWxcIiwgZSk7XG5cdFx0fVxuXG5cdFx0bmF0aXZlRXZlbnRzID0gZXZlbnRDdHJsLl9uYXRpdmVFdmVudHM7XG5cdFx0aWYgKG5hdGl2ZUV2ZW50cykge1xuXHRcdFx0Ly8gRmluZCBldmVudCByb290IGVsZW1lbnQgaWYgaXQgZXhpc3RzXG5cdFx0XHRwYXJlbnRzID0gZXZlbnRDdHJsLnBhcmVudHMoKS50b0FycmF5KCk7XG5cdFx0XHRwYXJlbnRzLnVuc2hpZnQoZXZlbnRDdHJsKTtcblx0XHRcdGZvciAoaSA9IDAsIGwgPSBwYXJlbnRzLmxlbmd0aDsgIWV2ZW50Um9vdEN0cmwgJiYgaSA8IGw7IGkrKykge1xuXHRcdFx0XHRldmVudFJvb3RDdHJsID0gcGFyZW50c1tpXS5fZXZlbnRzUm9vdDtcblx0XHRcdH1cblxuXHRcdFx0Ly8gRXZlbnQgcm9vdCB3YXNuJ3QgZm91bmQgdGhlIHVzZSB0aGUgcm9vdCBjb250cm9sXG5cdFx0XHRpZiAoIWV2ZW50Um9vdEN0cmwpIHtcblx0XHRcdFx0ZXZlbnRSb290Q3RybCA9IHBhcmVudHNbcGFyZW50cy5sZW5ndGggLSAxXSB8fCBldmVudEN0cmw7XG5cdFx0XHR9XG5cblx0XHRcdC8vIFNldCB0aGUgZXZlbnRzUm9vdCBwcm9wZXJ0eSBvbiBjaGlsZHJlbiB0aGF0IGRpZG4ndCBoYXZlIGl0XG5cdFx0XHRldmVudEN0cmwuX2V2ZW50c1Jvb3QgPSBldmVudFJvb3RDdHJsO1xuXHRcdFx0Zm9yIChsID0gaSwgaSA9IDA7IGkgPCBsOyBpKyspIHtcblx0XHRcdFx0cGFyZW50c1tpXS5fZXZlbnRzUm9vdCA9IGV2ZW50Um9vdEN0cmw7XG5cdFx0XHR9XG5cblx0XHRcdHZhciBldmVudFJvb3REZWxlZ2F0ZXMgPSBldmVudFJvb3RDdHJsLl9kZWxlZ2F0ZXM7XG5cdFx0XHRpZiAoIWV2ZW50Um9vdERlbGVnYXRlcykge1xuXHRcdFx0XHRldmVudFJvb3REZWxlZ2F0ZXMgPSBldmVudFJvb3RDdHJsLl9kZWxlZ2F0ZXMgPSB7fTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gQmluZCBuYXRpdmUgZXZlbnQgZGVsZWdhdGVzXG5cdFx0XHRmb3IgKG5hbWUgaW4gbmF0aXZlRXZlbnRzKSB7XG5cdFx0XHRcdGlmICghbmF0aXZlRXZlbnRzKSB7XG5cdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKG5hbWUgPT09IFwid2hlZWxcIiAmJiAhaGFzV2hlZWxFdmVudFN1cHBvcnQpIHtcblx0XHRcdFx0XHRpZiAoaGFzTW91c2VXaGVlbEV2ZW50U3VwcG9ydCkge1xuXHRcdFx0XHRcdFx0JChldmVudEN0cmwuZ2V0RWwoKSkub24oXCJtb3VzZXdoZWVsXCIsIGZpeFdoZWVsRXZlbnQpO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHQkKGV2ZW50Q3RybC5nZXRFbCgpKS5vbihcIkRPTU1vdXNlU2Nyb2xsXCIsIGZpeFdoZWVsRXZlbnQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gU3BlY2lhbCB0cmVhdG1lbnQgZm9yIG1vdXNlbnRlci9tb3VzZWxlYXZlIHNpbmNlIHRoZXNlIGRvZXNuJ3QgYnViYmxlXG5cdFx0XHRcdGlmIChuYW1lID09PSBcIm1vdXNlZW50ZXJcIiB8fCBuYW1lID09PSBcIm1vdXNlbGVhdmVcIikge1xuXHRcdFx0XHRcdC8vIEZha2UgbW91c2VudGVyL21vdXNlbGVhdmVcblx0XHRcdFx0XHRpZiAoIWV2ZW50Um9vdEN0cmwuX2hhc01vdXNlRW50ZXIpIHtcblx0XHRcdFx0XHRcdCQoZXZlbnRSb290Q3RybC5nZXRFbCgpKS5vbihcIm1vdXNlbGVhdmVcIiwgbW91c2VMZWF2ZUhhbmRsZXIpLm9uKFwibW91c2VvdmVyXCIsIG1vdXNlRW50ZXJIYW5kbGVyKTtcblx0XHRcdFx0XHRcdGV2ZW50Um9vdEN0cmwuX2hhc01vdXNlRW50ZXIgPSAxO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIGlmICghZXZlbnRSb290RGVsZWdhdGVzW25hbWVdKSB7XG5cdFx0XHRcdFx0JChldmVudFJvb3RDdHJsLmdldEVsKCkpLm9uKG5hbWUsIGRlbGVnYXRlKTtcblx0XHRcdFx0XHRldmVudFJvb3REZWxlZ2F0ZXNbbmFtZV0gPSB0cnVlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gUmVtb3ZlIHRoZSBldmVudCBvbmNlIGl0J3MgYm91bmRcblx0XHRcdFx0bmF0aXZlRXZlbnRzW25hbWVdID0gZmFsc2U7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0cmV0dXJuIENvbnRyb2w7XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL3VpL0ZhY3RvcnkuanNcblxuLyoqXG4gKiBGYWN0b3J5LmpzXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgTEdQTCBMaWNlbnNlLlxuICogQ29weXJpZ2h0IChjKSAxOTk5LTIwMTUgRXBob3ggQ29ycC4gQWxsIHJpZ2h0cyByZXNlcnZlZFxuICpcbiAqIExpY2Vuc2U6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vbGljZW5zZVxuICogQ29udHJpYnV0aW5nOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2NvbnRyaWJ1dGluZ1xuICovXG5cbi8qZ2xvYmFsIHRpbnltY2U6dHJ1ZSAqL1xuXG4vKipcbiAqIFRoaXMgY2xhc3MgaXMgYSBmYWN0b3J5IGZvciBjb250cm9sIGluc3RhbmNlcy4gVGhpcyBlbmFibGVzIHlvdVxuICogdG8gY3JlYXRlIGluc3RhbmNlcyBvZiBjb250cm9scyB3aXRob3V0IGhhdmluZyB0byByZXF1aXJlIHRoZSBVSSBjb250cm9scyBkaXJlY3RseS5cbiAqXG4gKiBJdCBhbHNvIGFsbG93IHlvdSB0byBvdmVycmlkZSBvciBhZGQgbmV3IGNvbnRyb2wgdHlwZXMuXG4gKlxuICogQGNsYXNzIHRpbnltY2UudWkuRmFjdG9yeVxuICovXG5kZWZpbmUoXCJ0aW55bWNlL3VpL0ZhY3RvcnlcIiwgW10sIGZ1bmN0aW9uKCkge1xuXHRcInVzZSBzdHJpY3RcIjtcblxuXHR2YXIgdHlwZXMgPSB7fSwgbmFtZXNwYWNlSW5pdDtcblxuXHRyZXR1cm4ge1xuXHRcdC8qKlxuXHRcdCAqIEFkZHMgYSBuZXcgY29udHJvbCBpbnN0YW5jZSB0eXBlIHRvIHRoZSBmYWN0b3J5LlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBhZGRcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gdHlwZSBUeXBlIG5hbWUgZm9yIGV4YW1wbGUgXCJidXR0b25cIi5cblx0XHQgKiBAcGFyYW0ge2Z1bmN0aW9ufSB0eXBlQ2xhc3MgQ2xhc3MgdHlwZSBmdW5jdGlvbi5cblx0XHQgKi9cblx0XHRhZGQ6IGZ1bmN0aW9uKHR5cGUsIHR5cGVDbGFzcykge1xuXHRcdFx0dHlwZXNbdHlwZS50b0xvd2VyQ2FzZSgpXSA9IHR5cGVDbGFzcztcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyB0cnVlL2ZhbHNlIGlmIHRoZSBzcGVjaWZpZWQgdHlwZSBleGlzdHMgb3Igbm90LlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBoYXNcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gdHlwZSBUeXBlIHRvIGxvb2sgZm9yLlxuXHRcdCAqIEByZXR1cm4ge0Jvb2xlYW59IHRydWUvZmFsc2UgaWYgdGhlIGNvbnRyb2wgYnkgbmFtZSBleGlzdHMuXG5cdFx0ICovXG5cdFx0aGFzOiBmdW5jdGlvbih0eXBlKSB7XG5cdFx0XHRyZXR1cm4gISF0eXBlc1t0eXBlLnRvTG93ZXJDYXNlKCldO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBDcmVhdGVzIGEgbmV3IGNvbnRyb2wgaW5zdGFuY2UgYmFzZWQgb24gdGhlIHNldHRpbmdzIHByb3ZpZGVkLiBUaGUgaW5zdGFuY2UgY3JlYXRlZCB3aWxsIGJlXG5cdFx0ICogYmFzZWQgb24gdGhlIHNwZWNpZmllZCB0eXBlIHByb3BlcnR5IGl0IGNhbiBhbHNvIGNyZWF0ZSB3aG9sZSBzdHJ1Y3R1cmVzIG9mIGNvbXBvbmVudHMgb3V0IG9mXG5cdFx0ICogdGhlIHNwZWNpZmllZCBKU09OIG9iamVjdC5cblx0XHQgKlxuXHRcdCAqIEBleGFtcGxlXG5cdFx0ICogdGlueW1jZS51aS5GYWN0b3J5LmNyZWF0ZSh7XG5cdFx0ICogICAgIHR5cGU6ICdidXR0b24nLFxuXHRcdCAqICAgICB0ZXh0OiAnSGVsbG8gd29ybGQhJ1xuXHRcdCAqIH0pO1xuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBjcmVhdGVcblx0XHQgKiBAcGFyYW0ge09iamVjdC9TdHJpbmd9IHNldHRpbmdzIE5hbWUvVmFsdWUgb2JqZWN0IHdpdGggaXRlbXMgdXNlZCB0byBjcmVhdGUgdGhlIHR5cGUuXG5cdFx0ICogQHJldHVybiB7dGlueW1jZS51aS5Db250cm9sfSBDb250cm9sIGluc3RhbmNlIGJhc2VkIG9uIHRoZSBzcGVjaWZpZWQgdHlwZS5cblx0XHQgKi9cblx0XHRjcmVhdGU6IGZ1bmN0aW9uKHR5cGUsIHNldHRpbmdzKSB7XG5cdFx0XHR2YXIgQ29udHJvbFR5cGUsIG5hbWUsIG5hbWVzcGFjZTtcblxuXHRcdFx0Ly8gQnVpbGQgdHlwZSBsb29rdXBcblx0XHRcdGlmICghbmFtZXNwYWNlSW5pdCkge1xuXHRcdFx0XHRuYW1lc3BhY2UgPSB0aW55bWNlLnVpO1xuXG5cdFx0XHRcdGZvciAobmFtZSBpbiBuYW1lc3BhY2UpIHtcblx0XHRcdFx0XHR0eXBlc1tuYW1lLnRvTG93ZXJDYXNlKCldID0gbmFtZXNwYWNlW25hbWVdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0bmFtZXNwYWNlSW5pdCA9IHRydWU7XG5cdFx0XHR9XG5cblx0XHRcdC8vIElmIHN0cmluZyBpcyBzcGVjaWZpZWQgdGhlbiB1c2UgaXQgYXMgdGhlIHR5cGVcblx0XHRcdGlmICh0eXBlb2YgdHlwZSA9PSAnc3RyaW5nJykge1xuXHRcdFx0XHRzZXR0aW5ncyA9IHNldHRpbmdzIHx8IHt9O1xuXHRcdFx0XHRzZXR0aW5ncy50eXBlID0gdHlwZTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHNldHRpbmdzID0gdHlwZTtcblx0XHRcdFx0dHlwZSA9IHNldHRpbmdzLnR5cGU7XG5cdFx0XHR9XG5cblx0XHRcdC8vIEZpbmQgY29udHJvbCB0eXBlXG5cdFx0XHR0eXBlID0gdHlwZS50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0Q29udHJvbFR5cGUgPSB0eXBlc1t0eXBlXTtcblxuXHRcdFx0Ly8gI2lmIGRlYnVnXG5cblx0XHRcdGlmICghQ29udHJvbFR5cGUpIHtcblx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiQ291bGQgbm90IGZpbmQgY29udHJvbCBieSB0eXBlOiBcIiArIHR5cGUpO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyAjZW5kaWZcblxuXHRcdFx0Q29udHJvbFR5cGUgPSBuZXcgQ29udHJvbFR5cGUoc2V0dGluZ3MpO1xuXHRcdFx0Q29udHJvbFR5cGUudHlwZSA9IHR5cGU7IC8vIFNldCB0aGUgdHlwZSBvbiB0aGUgaW5zdGFuY2UsIHRoaXMgd2lsbCBiZSB1c2VkIGJ5IHRoZSBTZWxlY3RvciBlbmdpbmVcblxuXHRcdFx0cmV0dXJuIENvbnRyb2xUeXBlO1xuXHRcdH1cblx0fTtcbn0pO1xuXG4vLyBJbmNsdWRlZCBmcm9tOiBqcy90aW55bWNlL2NsYXNzZXMvdWkvS2V5Ym9hcmROYXZpZ2F0aW9uLmpzXG5cbi8qKlxuICogS2V5Ym9hcmROYXZpZ2F0aW9uLmpzXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgTEdQTCBMaWNlbnNlLlxuICogQ29weXJpZ2h0IChjKSAxOTk5LTIwMTUgRXBob3ggQ29ycC4gQWxsIHJpZ2h0cyByZXNlcnZlZFxuICpcbiAqIExpY2Vuc2U6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vbGljZW5zZVxuICogQ29udHJpYnV0aW5nOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2NvbnRyaWJ1dGluZ1xuICovXG5cbi8qKlxuICogVGhpcyBjbGFzcyBoYW5kbGVzIGtleWJvYXJkIG5hdmlnYXRpb24gb2YgY29udHJvbHMgYW5kIGVsZW1lbnRzLlxuICpcbiAqIEBjbGFzcyB0aW55bWNlLnVpLktleWJvYXJkTmF2aWdhdGlvblxuICovXG5kZWZpbmUoXCJ0aW55bWNlL3VpL0tleWJvYXJkTmF2aWdhdGlvblwiLCBbXG5dLCBmdW5jdGlvbigpIHtcblx0XCJ1c2Ugc3RyaWN0XCI7XG5cblx0LyoqXG5cdCAqIFRoaXMgY2xhc3MgaGFuZGxlcyBhbGwga2V5Ym9hcmQgbmF2aWdhdGlvbiBmb3IgV0FJLUFSSUEgc3VwcG9ydC4gRWFjaCByb290IGNvbnRhaW5lclxuXHQgKiBnZXRzIGFuIGluc3RhbmNlIG9mIHRoaXMgY2xhc3MuXG5cdCAqXG5cdCAqIEBjb25zdHJ1Y3RvclxuXHQgKi9cblx0cmV0dXJuIGZ1bmN0aW9uKHNldHRpbmdzKSB7XG5cdFx0dmFyIHJvb3QgPSBzZXR0aW5ncy5yb290LCBmb2N1c2VkRWxlbWVudCwgZm9jdXNlZENvbnRyb2w7XG5cblx0XHRmdW5jdGlvbiBpc0VsZW1lbnQobm9kZSkge1xuXHRcdFx0cmV0dXJuIG5vZGUgJiYgbm9kZS5ub2RlVHlwZSA9PT0gMTtcblx0XHR9XG5cblx0XHR0cnkge1xuXHRcdFx0Zm9jdXNlZEVsZW1lbnQgPSBkb2N1bWVudC5hY3RpdmVFbGVtZW50O1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHQvLyBJRSBzb21ldGltZXMgZmFpbHMgdG8gcmV0dXJuIGEgcHJvcGVyIGVsZW1lbnRcblx0XHRcdGZvY3VzZWRFbGVtZW50ID0gZG9jdW1lbnQuYm9keTtcblx0XHR9XG5cblx0XHRmb2N1c2VkQ29udHJvbCA9IHJvb3QuZ2V0UGFyZW50Q3RybChmb2N1c2VkRWxlbWVudCk7XG5cblx0XHQvKipcblx0XHQgKiBSZXR1cm5zIHRoZSBjdXJyZW50bHkgZm9jdXNlZCBlbGVtZW50cyB3YWkgYXJpYSByb2xlIG9mIHRoZSBjdXJyZW50bHlcblx0XHQgKiBmb2N1c2VkIGVsZW1lbnQgb3Igc3BlY2lmaWVkIGVsZW1lbnQuXG5cdFx0ICpcblx0XHQgKiBAcHJpdmF0ZVxuXHRcdCAqIEBwYXJhbSB7RWxlbWVudH0gZWxtIE9wdGlvbmFsIGVsZW1lbnQgdG8gZ2V0IHJvbGUgZnJvbS5cblx0XHQgKiBAcmV0dXJuIHtTdHJpbmd9IFJvbGUgb2Ygc3BlY2lmaWVkIGVsZW1lbnQuXG5cdFx0ICovXG5cdFx0ZnVuY3Rpb24gZ2V0Um9sZShlbG0pIHtcblx0XHRcdGVsbSA9IGVsbSB8fCBmb2N1c2VkRWxlbWVudDtcblxuXHRcdFx0aWYgKGlzRWxlbWVudChlbG0pKSB7XG5cdFx0XHRcdHJldHVybiBlbG0uZ2V0QXR0cmlidXRlKCdyb2xlJyk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblxuXHRcdC8qKlxuXHRcdCAqIFJldHVybnMgdGhlIHdhaSByb2xlIG9mIHRoZSBwYXJlbnQgZWxlbWVudCBvZiB0aGUgY3VycmVudGx5XG5cdFx0ICogZm9jdXNlZCBlbGVtZW50IG9yIHNwZWNpZmllZCBlbGVtZW50LlxuXHRcdCAqXG5cdFx0ICogQHByaXZhdGVcblx0XHQgKiBAcGFyYW0ge0VsZW1lbnR9IGVsbSBPcHRpb25hbCBlbGVtZW50IHRvIGdldCBwYXJlbnQgcm9sZSBmcm9tLlxuXHRcdCAqIEByZXR1cm4ge1N0cmluZ30gUm9sZSBvZiB0aGUgZmlyc3QgcGFyZW50IHRoYXQgaGFzIGEgcm9sZS5cblx0XHQgKi9cblx0XHRmdW5jdGlvbiBnZXRQYXJlbnRSb2xlKGVsbSkge1xuXHRcdFx0dmFyIHJvbGUsIHBhcmVudCA9IGVsbSB8fCBmb2N1c2VkRWxlbWVudDtcblxuXHRcdFx0d2hpbGUgKChwYXJlbnQgPSBwYXJlbnQucGFyZW50Tm9kZSkpIHtcblx0XHRcdFx0aWYgKChyb2xlID0gZ2V0Um9sZShwYXJlbnQpKSkge1xuXHRcdFx0XHRcdHJldHVybiByb2xlO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyBhIHdhaSBhcmlhIHByb3BlcnR5IGJ5IG5hbWUgZm9yIGV4YW1wbGUgYXJpYS1zZWxlY3RlZC5cblx0XHQgKlxuXHRcdCAqIEBwcml2YXRlXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IG5hbWUgTmFtZSBvZiB0aGUgYXJpYSBwcm9wZXJ0eSB0byBnZXQgZm9yIGV4YW1wbGUgXCJkaXNhYmxlZFwiLlxuXHRcdCAqIEByZXR1cm4ge1N0cmluZ30gQXJpYSBwcm9wZXJ0eSB2YWx1ZS5cblx0XHQgKi9cblx0XHRmdW5jdGlvbiBnZXRBcmlhUHJvcChuYW1lKSB7XG5cdFx0XHR2YXIgZWxtID0gZm9jdXNlZEVsZW1lbnQ7XG5cblx0XHRcdGlmIChpc0VsZW1lbnQoZWxtKSkge1xuXHRcdFx0XHRyZXR1cm4gZWxtLmdldEF0dHJpYnV0ZSgnYXJpYS0nICsgbmFtZSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0LyoqXG5cdFx0ICogSXMgdGhlIGVsZW1lbnQgYSB0ZXh0IGlucHV0IGVsZW1lbnQgb3Igbm90LlxuXHRcdCAqXG5cdFx0ICogQHByaXZhdGVcblx0XHQgKiBAcGFyYW0ge0VsZW1lbnR9IGVsbSBFbGVtZW50IHRvIGNoZWNrIGlmIGl0J3MgYW4gdGV4dCBpbnB1dCBlbGVtZW50IG9yIG5vdC5cblx0XHQgKiBAcmV0dXJuIHtCb29sZWFufSBUcnVlL2ZhbHNlIGlmIHRoZSBlbGVtZW50IGlzIGEgdGV4dCBlbGVtZW50IG9yIG5vdC5cblx0XHQgKi9cblx0XHRmdW5jdGlvbiBpc1RleHRJbnB1dEVsZW1lbnQoZWxtKSB7XG5cdFx0XHR2YXIgdGFnTmFtZSA9IGVsbS50YWdOYW1lLnRvVXBwZXJDYXNlKCk7XG5cblx0XHRcdC8vIE5vdGljZTogc2luY2UgdHlwZSBjYW4gYmUgXCJlbWFpbFwiIGV0YyB3ZSBkb24ndCBjaGVjayB0aGUgdHlwZVxuXHRcdFx0Ly8gU28gYWxsIGlucHV0IGVsZW1lbnRzIGdldHMgdHJlYXRlZCBhcyB0ZXh0IGlucHV0IGVsZW1lbnRzXG5cdFx0XHRyZXR1cm4gdGFnTmFtZSA9PSBcIklOUFVUXCIgfHwgdGFnTmFtZSA9PSBcIlRFWFRBUkVBXCIgfHwgdGFnTmFtZSA9PSBcIlNFTEVDVFwiO1xuXHRcdH1cblxuXHRcdC8qKlxuXHRcdCAqIFJldHVybnMgdHJ1ZS9mYWxzZSBpZiB0aGUgc3BlY2lmaWVkIGVsZW1lbnQgY2FuIGJlIGZvY3VzZWQgb3Igbm90LlxuXHRcdCAqXG5cdFx0ICogQHByaXZhdGVcblx0XHQgKiBAcGFyYW0ge0VsZW1lbnR9IGVsbSBET00gZWxlbWVudCB0byBjaGVjayBpZiBpdCBjYW4gYmUgZm9jdXNlZCBvciBub3QuXG5cdFx0ICogQHJldHVybiB7Qm9vbGVhbn0gVHJ1ZS9mYWxzZSBpZiB0aGUgZWxlbWVudCBjYW4gaGF2ZSBmb2N1cy5cblx0XHQgKi9cblx0XHRmdW5jdGlvbiBjYW5Gb2N1cyhlbG0pIHtcblx0XHRcdGlmIChpc1RleHRJbnB1dEVsZW1lbnQoZWxtKSAmJiAhZWxtLmhpZGRlbikge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKC9eKGJ1dHRvbnxtZW51aXRlbXxjaGVja2JveHx0YWJ8bWVudWl0ZW1jaGVja2JveHxvcHRpb258Z3JpZGNlbGx8c2xpZGVyKSQvLnRlc3QoZ2V0Um9sZShlbG0pKSkge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblxuXHRcdC8qKlxuXHRcdCAqIFJldHVybnMgYW4gYXJyYXkgb2YgZm9jdXNhYmxlIHZpc2libGUgZWxlbWVudHMgd2l0aGluIHRoZSBzcGVjaWZpZWQgY29udGFpbmVyIGVsZW1lbnQuXG5cdFx0ICpcblx0XHQgKiBAcHJpdmF0ZVxuXHRcdCAqIEBwYXJhbSB7RWxlbWVudH0gZWxtIERPTSBlbGVtZW50IHRvIGZpbmQgZm9jdXNhYmxlIGVsZW1lbnRzIHdpdGhpbi5cblx0XHQgKiBAcmV0dXJuIHtBcnJheX0gQXJyYXkgb2YgZm9jdXNhYmxlIGVsZW1lbnRzLlxuXHRcdCAqL1xuXHRcdGZ1bmN0aW9uIGdldEZvY3VzRWxlbWVudHMoZWxtKSB7XG5cdFx0XHR2YXIgZWxlbWVudHMgPSBbXTtcblxuXHRcdFx0ZnVuY3Rpb24gY29sbGVjdChlbG0pIHtcblx0XHRcdFx0aWYgKGVsbS5ub2RlVHlwZSAhPSAxIHx8IGVsbS5zdHlsZS5kaXNwbGF5ID09ICdub25lJyB8fCBlbG0uZGlzYWJsZWQpIHtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoY2FuRm9jdXMoZWxtKSkge1xuXHRcdFx0XHRcdGVsZW1lbnRzLnB1c2goZWxtKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGZvciAodmFyIGkgPSAwOyBpIDwgZWxtLmNoaWxkTm9kZXMubGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0XHRjb2xsZWN0KGVsbS5jaGlsZE5vZGVzW2ldKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRjb2xsZWN0KGVsbSB8fCByb290LmdldEVsKCkpO1xuXG5cdFx0XHRyZXR1cm4gZWxlbWVudHM7XG5cdFx0fVxuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyB0aGUgbmF2aWdhdGlvbiByb290IGNvbnRyb2wgZm9yIHRoZSBzcGVjaWZpZWQgY29udHJvbC4gVGhlIG5hdmlnYXRpb24gcm9vdFxuXHRcdCAqIGlzIHRoZSBjb250cm9sIHRoYXQgdGhlIGtleWJvYXJkIG5hdmlnYXRpb24gZ2V0cyBzY29wZWQgdG8gZm9yIGV4YW1wbGUgYSBtZW51YmFyIG9yIHRvb2xiYXIgZ3JvdXAuXG5cdFx0ICogSXQgd2lsbCBsb29rIGZvciBwYXJlbnRzIG9mIHRoZSBzcGVjaWZpZWQgdGFyZ2V0IGNvbnRyb2wgb3IgdGhlIGN1cnJlbnRseSBmb2N1c2VkIGNvbnRyb2wgaWYgdGhpcyBvcHRpb24gaXMgb21pdHRlZC5cblx0XHQgKlxuXHRcdCAqIEBwcml2YXRlXG5cdFx0ICogQHBhcmFtIHt0aW55bWNlLnVpLkNvbnRyb2x9IHRhcmdldENvbnRyb2wgT3B0aW9uYWwgdGFyZ2V0IGNvbnRyb2wgdG8gZmluZCByb290IG9mLlxuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UudWkuQ29udHJvbH0gTmF2aWdhdGlvbiByb290IGNvbnRyb2wuXG5cdFx0ICovXG5cdFx0ZnVuY3Rpb24gZ2V0TmF2aWdhdGlvblJvb3QodGFyZ2V0Q29udHJvbCkge1xuXHRcdFx0dmFyIG5hdmlnYXRpb25Sb290LCBjb250cm9scztcblxuXHRcdFx0dGFyZ2V0Q29udHJvbCA9IHRhcmdldENvbnRyb2wgfHwgZm9jdXNlZENvbnRyb2w7XG5cdFx0XHRjb250cm9scyA9IHRhcmdldENvbnRyb2wucGFyZW50cygpLnRvQXJyYXkoKTtcblx0XHRcdGNvbnRyb2xzLnVuc2hpZnQodGFyZ2V0Q29udHJvbCk7XG5cblx0XHRcdGZvciAodmFyIGkgPSAwOyBpIDwgY29udHJvbHMubGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0bmF2aWdhdGlvblJvb3QgPSBjb250cm9sc1tpXTtcblxuXHRcdFx0XHRpZiAobmF2aWdhdGlvblJvb3Quc2V0dGluZ3MuYXJpYVJvb3QpIHtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbmF2aWdhdGlvblJvb3Q7XG5cdFx0fVxuXG5cdFx0LyoqXG5cdFx0ICogRm9jdXNlcyB0aGUgZmlyc3QgaXRlbSBpbiB0aGUgc3BlY2lmaWVkIHRhcmdldENvbnRyb2wgZWxlbWVudCBvciB0aGUgbGFzdCBhcmlhIGluZGV4IGlmIHRoZVxuXHRcdCAqIG5hdmlnYXRpb24gcm9vdCBoYXMgdGhlIGFyaWFSZW1lbWJlciBvcHRpb24gZW5hYmxlZC5cblx0XHQgKlxuXHRcdCAqIEBwcml2YXRlXG5cdFx0ICogQHBhcmFtIHt0aW55bWNlLnVpLkNvbnRyb2x9IHRhcmdldENvbnRyb2wgVGFyZ2V0IGNvbnRyb2wgdG8gZm9jdXMgdGhlIGZpcnN0IGl0ZW0gaW4uXG5cdFx0ICovXG5cdFx0ZnVuY3Rpb24gZm9jdXNGaXJzdCh0YXJnZXRDb250cm9sKSB7XG5cdFx0XHR2YXIgbmF2aWdhdGlvblJvb3QgPSBnZXROYXZpZ2F0aW9uUm9vdCh0YXJnZXRDb250cm9sKTtcblx0XHRcdHZhciBmb2N1c0VsZW1lbnRzID0gZ2V0Rm9jdXNFbGVtZW50cyhuYXZpZ2F0aW9uUm9vdC5nZXRFbCgpKTtcblxuXHRcdFx0aWYgKG5hdmlnYXRpb25Sb290LnNldHRpbmdzLmFyaWFSZW1lbWJlciAmJiBcImxhc3RBcmlhSW5kZXhcIiBpbiBuYXZpZ2F0aW9uUm9vdCkge1xuXHRcdFx0XHRtb3ZlRm9jdXNUb0luZGV4KG5hdmlnYXRpb25Sb290Lmxhc3RBcmlhSW5kZXgsIGZvY3VzRWxlbWVudHMpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0bW92ZUZvY3VzVG9JbmRleCgwLCBmb2N1c0VsZW1lbnRzKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHQvKipcblx0XHQgKiBNb3ZlcyB0aGUgZm9jdXMgdG8gdGhlIHNwZWNpZmllZCBpbmRleCB3aXRoaW4gdGhlIGVsZW1lbnRzIGxpc3QuXG5cdFx0ICogVGhpcyB3aWxsIHNjb3BlIHRoZSBpbmRleCB0byB0aGUgc2l6ZSBvZiB0aGUgZWxlbWVudCBsaXN0IGlmIGl0IGNoYW5nZWQuXG5cdFx0ICpcblx0XHQgKiBAcHJpdmF0ZVxuXHRcdCAqIEBwYXJhbSB7TnVtYmVyfSBpZHggU3BlY2lmaWVkIGluZGV4IHRvIG1vdmUgdG8uXG5cdFx0ICogQHBhcmFtIHtBcnJheX0gZWxlbWVudHMgQXJyYXkgd2l0aCBkb20gZWxlbWVudHMgdG8gbW92ZSBmb2N1cyB3aXRoaW4uXG5cdFx0ICogQHJldHVybiB7TnVtYmVyfSBJbnB1dCBpbmRleCBvciBhIGNoYW5nZWQgaW5kZXggaWYgaXQgd2FzIG91dCBvZiByYW5nZS5cblx0XHQgKi9cblx0XHRmdW5jdGlvbiBtb3ZlRm9jdXNUb0luZGV4KGlkeCwgZWxlbWVudHMpIHtcblx0XHRcdGlmIChpZHggPCAwKSB7XG5cdFx0XHRcdGlkeCA9IGVsZW1lbnRzLmxlbmd0aCAtIDE7XG5cdFx0XHR9IGVsc2UgaWYgKGlkeCA+PSBlbGVtZW50cy5sZW5ndGgpIHtcblx0XHRcdFx0aWR4ID0gMDtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGVsZW1lbnRzW2lkeF0pIHtcblx0XHRcdFx0ZWxlbWVudHNbaWR4XS5mb2N1cygpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gaWR4O1xuXHRcdH1cblxuXHRcdC8qKlxuXHRcdCAqIE1vdmVzIHRoZSBmb2N1cyBmb3J3YXJkcyBvciBiYWNrd2FyZHMuXG5cdFx0ICpcblx0XHQgKiBAcHJpdmF0ZVxuXHRcdCAqIEBwYXJhbSB7TnVtYmVyfSBkaXIgRGlyZWN0aW9uIHRvIG1vdmUgaW4gcG9zaXRpdmUgbWVhbnMgZm9yd2FyZCwgbmVnYXRpdmUgbWVhbnMgYmFja3dhcmRzLlxuXHRcdCAqIEBwYXJhbSB7QXJyYXl9IGVsZW1lbnRzIE9wdGlvbmFsIGFycmF5IG9mIGVsZW1lbnRzIHRvIG1vdmUgd2l0aGluIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IG5hdmlnYXRpb24gcm9vdHMgZWxlbWVudHMuXG5cdFx0ICovXG5cdFx0ZnVuY3Rpb24gbW92ZUZvY3VzKGRpciwgZWxlbWVudHMpIHtcblx0XHRcdHZhciBpZHggPSAtMSwgbmF2aWdhdGlvblJvb3QgPSBnZXROYXZpZ2F0aW9uUm9vdCgpO1xuXG5cdFx0XHRlbGVtZW50cyA9IGVsZW1lbnRzIHx8IGdldEZvY3VzRWxlbWVudHMobmF2aWdhdGlvblJvb3QuZ2V0RWwoKSk7XG5cblx0XHRcdGZvciAodmFyIGkgPSAwOyBpIDwgZWxlbWVudHMubGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0aWYgKGVsZW1lbnRzW2ldID09PSBmb2N1c2VkRWxlbWVudCkge1xuXHRcdFx0XHRcdGlkeCA9IGk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWR4ICs9IGRpcjtcblx0XHRcdG5hdmlnYXRpb25Sb290Lmxhc3RBcmlhSW5kZXggPSBtb3ZlRm9jdXNUb0luZGV4KGlkeCwgZWxlbWVudHMpO1xuXHRcdH1cblxuXHRcdC8qKlxuXHRcdCAqIE1vdmVzIHRoZSBmb2N1cyB0byB0aGUgbGVmdCB0aGlzIGlzIGNhbGxlZCBieSB0aGUgbGVmdCBrZXkuXG5cdFx0ICpcblx0XHQgKiBAcHJpdmF0ZVxuXHRcdCAqL1xuXHRcdGZ1bmN0aW9uIGxlZnQoKSB7XG5cdFx0XHR2YXIgcGFyZW50Um9sZSA9IGdldFBhcmVudFJvbGUoKTtcblxuXHRcdFx0aWYgKHBhcmVudFJvbGUgPT0gXCJ0YWJsaXN0XCIpIHtcblx0XHRcdFx0bW92ZUZvY3VzKC0xLCBnZXRGb2N1c0VsZW1lbnRzKGZvY3VzZWRFbGVtZW50LnBhcmVudE5vZGUpKTtcblx0XHRcdH0gZWxzZSBpZiAoZm9jdXNlZENvbnRyb2wucGFyZW50KCkuc3VibWVudSkge1xuXHRcdFx0XHRjYW5jZWwoKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdG1vdmVGb2N1cygtMSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0LyoqXG5cdFx0ICogTW92ZXMgdGhlIGZvY3VzIHRvIHRoZSByaWdodCB0aGlzIGlzIGNhbGxlZCBieSB0aGUgcmlnaHQga2V5LlxuXHRcdCAqXG5cdFx0ICogQHByaXZhdGVcblx0XHQgKi9cblx0XHRmdW5jdGlvbiByaWdodCgpIHtcblx0XHRcdHZhciByb2xlID0gZ2V0Um9sZSgpLCBwYXJlbnRSb2xlID0gZ2V0UGFyZW50Um9sZSgpO1xuXG5cdFx0XHRpZiAocGFyZW50Um9sZSA9PSBcInRhYmxpc3RcIikge1xuXHRcdFx0XHRtb3ZlRm9jdXMoMSwgZ2V0Rm9jdXNFbGVtZW50cyhmb2N1c2VkRWxlbWVudC5wYXJlbnROb2RlKSk7XG5cdFx0XHR9IGVsc2UgaWYgKHJvbGUgPT0gXCJtZW51aXRlbVwiICYmIHBhcmVudFJvbGUgPT0gXCJtZW51XCIgJiYgZ2V0QXJpYVByb3AoJ2hhc3BvcHVwJykpIHtcblx0XHRcdFx0ZW50ZXIoKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdG1vdmVGb2N1cygxKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHQvKipcblx0XHQgKiBNb3ZlcyB0aGUgZm9jdXMgdG8gdGhlIHVwIHRoaXMgaXMgY2FsbGVkIGJ5IHRoZSB1cCBrZXkuXG5cdFx0ICpcblx0XHQgKiBAcHJpdmF0ZVxuXHRcdCAqL1xuXHRcdGZ1bmN0aW9uIHVwKCkge1xuXHRcdFx0bW92ZUZvY3VzKC0xKTtcblx0XHR9XG5cblx0XHQvKipcblx0XHQgKiBNb3ZlcyB0aGUgZm9jdXMgdG8gdGhlIHVwIHRoaXMgaXMgY2FsbGVkIGJ5IHRoZSBkb3duIGtleS5cblx0XHQgKlxuXHRcdCAqIEBwcml2YXRlXG5cdFx0ICovXG5cdFx0ZnVuY3Rpb24gZG93bigpIHtcblx0XHRcdHZhciByb2xlID0gZ2V0Um9sZSgpLCBwYXJlbnRSb2xlID0gZ2V0UGFyZW50Um9sZSgpO1xuXG5cdFx0XHRpZiAocm9sZSA9PSBcIm1lbnVpdGVtXCIgJiYgcGFyZW50Um9sZSA9PSBcIm1lbnViYXJcIikge1xuXHRcdFx0XHRlbnRlcigpO1xuXHRcdFx0fSBlbHNlIGlmIChyb2xlID09IFwiYnV0dG9uXCIgJiYgZ2V0QXJpYVByb3AoJ2hhc3BvcHVwJykpIHtcblx0XHRcdFx0ZW50ZXIoe2tleTogJ2Rvd24nfSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRtb3ZlRm9jdXMoMSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0LyoqXG5cdFx0ICogTW92ZXMgdGhlIGZvY3VzIHRvIHRoZSBuZXh0IGl0ZW0gb3IgcHJldmlvdXMgaXRlbSBkZXBlbmRpbmcgb24gc2hpZnQga2V5LlxuXHRcdCAqXG5cdFx0ICogQHByaXZhdGVcblx0XHQgKiBAcGFyYW0ge0RPTUV2ZW50fSBlIERPTSBldmVudCBvYmplY3QuXG5cdFx0ICovXG5cdFx0ZnVuY3Rpb24gdGFiKGUpIHtcblx0XHRcdHZhciBwYXJlbnRSb2xlID0gZ2V0UGFyZW50Um9sZSgpO1xuXG5cdFx0XHRpZiAocGFyZW50Um9sZSA9PSBcInRhYmxpc3RcIikge1xuXHRcdFx0XHR2YXIgZWxtID0gZ2V0Rm9jdXNFbGVtZW50cyhmb2N1c2VkQ29udHJvbC5nZXRFbCgnYm9keScpKVswXTtcblxuXHRcdFx0XHRpZiAoZWxtKSB7XG5cdFx0XHRcdFx0ZWxtLmZvY3VzKCk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdG1vdmVGb2N1cyhlLnNoaWZ0S2V5ID8gLTEgOiAxKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHQvKipcblx0XHQgKiBDYWxscyB0aGUgY2FuY2VsIGV2ZW50IG9uIHRoZSBjdXJyZW50bHkgZm9jdXNlZCBjb250cm9sLiBUaGlzIGlzIG5vcm1hbGx5IGRvbmUgdXNpbmcgdGhlIEVzYyBrZXkuXG5cdFx0ICpcblx0XHQgKiBAcHJpdmF0ZVxuXHRcdCAqL1xuXHRcdGZ1bmN0aW9uIGNhbmNlbCgpIHtcblx0XHRcdGZvY3VzZWRDb250cm9sLmZpcmUoJ2NhbmNlbCcpO1xuXHRcdH1cblxuXHRcdC8qKlxuXHRcdCAqIENhbGxzIHRoZSBjbGljayBldmVudCBvbiB0aGUgY3VycmVudGx5IGZvY3VzZWQgY29udHJvbC4gVGhpcyBpcyBub3JtYWxseSBkb25lIHVzaW5nIHRoZSBFbnRlci9TcGFjZSBrZXlzLlxuXHRcdCAqXG5cdFx0ICogQHByaXZhdGVcblx0XHQgKiBAcGFyYW0ge09iamVjdH0gYXJpYSBPcHRpb25hbCBhcmlhIGRhdGEgdG8gcGFzcyBhbG9uZyB3aXRoIHRoZSBlbnRlciBldmVudC5cblx0XHQgKi9cblx0XHRmdW5jdGlvbiBlbnRlcihhcmlhKSB7XG5cdFx0XHRhcmlhID0gYXJpYSB8fCB7fTtcblx0XHRcdGZvY3VzZWRDb250cm9sLmZpcmUoJ2NsaWNrJywge3RhcmdldDogZm9jdXNlZEVsZW1lbnQsIGFyaWE6IGFyaWF9KTtcblx0XHR9XG5cblx0XHRyb290Lm9uKCdrZXlkb3duJywgZnVuY3Rpb24oZSkge1xuXHRcdFx0ZnVuY3Rpb24gaGFuZGxlTm9uVGFiT3JFc2NFdmVudChlLCBoYW5kbGVyKSB7XG5cdFx0XHRcdC8vIElnbm9yZSBub24gdGFiIGtleXMgZm9yIHRleHQgZWxlbWVudHNcblx0XHRcdFx0aWYgKGlzVGV4dElucHV0RWxlbWVudChmb2N1c2VkRWxlbWVudCkpIHtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoZ2V0Um9sZShmb2N1c2VkRWxlbWVudCkgPT09ICdzbGlkZXInKSB7XG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKGhhbmRsZXIoZSkgIT09IGZhbHNlKSB7XG5cdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmIChlLmlzRGVmYXVsdFByZXZlbnRlZCgpKSB7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0c3dpdGNoIChlLmtleUNvZGUpIHtcblx0XHRcdFx0Y2FzZSAzNzogLy8gRE9NX1ZLX0xFRlRcblx0XHRcdFx0XHRoYW5kbGVOb25UYWJPckVzY0V2ZW50KGUsIGxlZnQpO1xuXHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdGNhc2UgMzk6IC8vIERPTV9WS19SSUdIVFxuXHRcdFx0XHRcdGhhbmRsZU5vblRhYk9yRXNjRXZlbnQoZSwgcmlnaHQpO1xuXHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdGNhc2UgMzg6IC8vIERPTV9WS19VUFxuXHRcdFx0XHRcdGhhbmRsZU5vblRhYk9yRXNjRXZlbnQoZSwgdXApO1xuXHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdGNhc2UgNDA6IC8vIERPTV9WS19ET1dOXG5cdFx0XHRcdFx0aGFuZGxlTm9uVGFiT3JFc2NFdmVudChlLCBkb3duKTtcblx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRjYXNlIDI3OiAvLyBET01fVktfRVNDQVBFXG5cdFx0XHRcdFx0Y2FuY2VsKCk7XG5cdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0Y2FzZSAxNDogLy8gRE9NX1ZLX0VOVEVSXG5cdFx0XHRcdGNhc2UgMTM6IC8vIERPTV9WS19SRVRVUk5cblx0XHRcdFx0Y2FzZSAzMjogLy8gRE9NX1ZLX1NQQUNFXG5cdFx0XHRcdFx0aGFuZGxlTm9uVGFiT3JFc2NFdmVudChlLCBlbnRlcik7XG5cdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0Y2FzZSA5OiAvLyBET01fVktfVEFCXG5cdFx0XHRcdFx0aWYgKHRhYihlKSAhPT0gZmFsc2UpIHtcblx0XHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRyb290Lm9uKCdmb2N1c2luJywgZnVuY3Rpb24oZSkge1xuXHRcdFx0Zm9jdXNlZEVsZW1lbnQgPSBlLnRhcmdldDtcblx0XHRcdGZvY3VzZWRDb250cm9sID0gZS5jb250cm9sO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHtcblx0XHRcdGZvY3VzRmlyc3Q6IGZvY3VzRmlyc3Rcblx0XHR9O1xuXHR9O1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy91aS9Db250YWluZXIuanNcblxuLyoqXG4gKiBDb250YWluZXIuanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBDb250YWluZXIgY29udHJvbC4gVGhpcyBpcyBleHRlbmRlZCBieSBhbGwgY29udHJvbHMgdGhhdCBjYW4gaGF2ZVxuICogY2hpbGRyZW4gc3VjaCBhcyBwYW5lbHMgZXRjLiBZb3UgY2FuIGFsc28gdXNlIHRoaXMgY2xhc3MgZGlyZWN0bHkgYXMgYW5cbiAqIGdlbmVyaWMgY29udGFpbmVyIGluc3RhbmNlLiBUaGUgY29udGFpbmVyIGRvZXNuJ3QgaGF2ZSBhbnkgc3BlY2lmaWMgcm9sZSBvciBzdHlsZS5cbiAqXG4gKiBALXgtbGVzcyBDb250YWluZXIubGVzc1xuICogQGNsYXNzIHRpbnltY2UudWkuQ29udGFpbmVyXG4gKiBAZXh0ZW5kcyB0aW55bWNlLnVpLkNvbnRyb2xcbiAqL1xuZGVmaW5lKFwidGlueW1jZS91aS9Db250YWluZXJcIiwgW1xuXHRcInRpbnltY2UvdWkvQ29udHJvbFwiLFxuXHRcInRpbnltY2UvdWkvQ29sbGVjdGlvblwiLFxuXHRcInRpbnltY2UvdWkvU2VsZWN0b3JcIixcblx0XCJ0aW55bWNlL3VpL0ZhY3RvcnlcIixcblx0XCJ0aW55bWNlL3VpL0tleWJvYXJkTmF2aWdhdGlvblwiLFxuXHRcInRpbnltY2UvdXRpbC9Ub29sc1wiLFxuXHRcInRpbnltY2UvZG9tL0RvbVF1ZXJ5XCIsXG5cdFwidGlueW1jZS91aS9DbGFzc0xpc3RcIixcblx0XCJ0aW55bWNlL3VpL1JlZmxvd1F1ZXVlXCJcbl0sIGZ1bmN0aW9uKENvbnRyb2wsIENvbGxlY3Rpb24sIFNlbGVjdG9yLCBGYWN0b3J5LCBLZXlib2FyZE5hdmlnYXRpb24sIFRvb2xzLCAkLCBDbGFzc0xpc3QsIFJlZmxvd1F1ZXVlKSB7XG5cdFwidXNlIHN0cmljdFwiO1xuXG5cdHZhciBzZWxlY3RvckNhY2hlID0ge307XG5cblx0cmV0dXJuIENvbnRyb2wuZXh0ZW5kKHtcblx0XHQvKipcblx0XHQgKiBDb25zdHJ1Y3RzIGEgbmV3IGNvbnRyb2wgaW5zdGFuY2Ugd2l0aCB0aGUgc3BlY2lmaWVkIHNldHRpbmdzLlxuXHRcdCAqXG5cdFx0ICogQGNvbnN0cnVjdG9yXG5cdFx0ICogQHBhcmFtIHtPYmplY3R9IHNldHRpbmdzIE5hbWUvdmFsdWUgb2JqZWN0IHdpdGggc2V0dGluZ3MuXG5cdFx0ICogQHNldHRpbmcge0FycmF5fSBpdGVtcyBJdGVtcyB0byBhZGQgdG8gY29udGFpbmVyIGluIEpTT04gZm9ybWF0IG9yIGNvbnRyb2wgaW5zdGFuY2VzLlxuXHRcdCAqIEBzZXR0aW5nIHtTdHJpbmd9IGxheW91dCBMYXlvdXQgbWFuYWdlciBieSBuYW1lIHRvIHVzZS5cblx0XHQgKiBAc2V0dGluZyB7T2JqZWN0fSBkZWZhdWx0cyBEZWZhdWx0IHNldHRpbmdzIHRvIGFwcGx5IHRvIGFsbCBpdGVtcy5cblx0XHQgKi9cblx0XHRpbml0OiBmdW5jdGlvbihzZXR0aW5ncykge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHRzZWxmLl9zdXBlcihzZXR0aW5ncyk7XG5cdFx0XHRzZXR0aW5ncyA9IHNlbGYuc2V0dGluZ3M7XG5cblx0XHRcdGlmIChzZXR0aW5ncy5maXhlZCkge1xuXHRcdFx0XHRzZWxmLnN0YXRlLnNldCgnZml4ZWQnLCB0cnVlKTtcblx0XHRcdH1cblxuXHRcdFx0c2VsZi5faXRlbXMgPSBuZXcgQ29sbGVjdGlvbigpO1xuXG5cdFx0XHRpZiAoc2VsZi5pc1J0bCgpKSB7XG5cdFx0XHRcdHNlbGYuY2xhc3Nlcy5hZGQoJ3J0bCcpO1xuXHRcdFx0fVxuXG5cdFx0XHRzZWxmLmJvZHlDbGFzc2VzID0gbmV3IENsYXNzTGlzdChmdW5jdGlvbigpIHtcblx0XHRcdFx0aWYgKHNlbGYuc3RhdGUuZ2V0KCdyZW5kZXJlZCcpKSB7XG5cdFx0XHRcdFx0c2VsZi5nZXRFbCgnYm9keScpLmNsYXNzTmFtZSA9IHRoaXMudG9TdHJpbmcoKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0XHRzZWxmLmJvZHlDbGFzc2VzLnByZWZpeCA9IHNlbGYuY2xhc3NQcmVmaXg7XG5cblx0XHRcdHNlbGYuY2xhc3Nlcy5hZGQoJ2NvbnRhaW5lcicpO1xuXHRcdFx0c2VsZi5ib2R5Q2xhc3Nlcy5hZGQoJ2NvbnRhaW5lci1ib2R5Jyk7XG5cblx0XHRcdGlmIChzZXR0aW5ncy5jb250YWluZXJDbHMpIHtcblx0XHRcdFx0c2VsZi5jbGFzc2VzLmFkZChzZXR0aW5ncy5jb250YWluZXJDbHMpO1xuXHRcdFx0fVxuXG5cdFx0XHRzZWxmLl9sYXlvdXQgPSBGYWN0b3J5LmNyZWF0ZSgoc2V0dGluZ3MubGF5b3V0IHx8ICcnKSArICdsYXlvdXQnKTtcblxuXHRcdFx0aWYgKHNlbGYuc2V0dGluZ3MuaXRlbXMpIHtcblx0XHRcdFx0c2VsZi5hZGQoc2VsZi5zZXR0aW5ncy5pdGVtcyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRzZWxmLmFkZChzZWxmLnJlbmRlcigpKTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gVE9ETzogRml4IHRoaXMhXG5cdFx0XHRzZWxmLl9oYXNCb2R5ID0gdHJ1ZTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyBhIGNvbGxlY3Rpb24gb2YgY2hpbGQgaXRlbXMgdGhhdCB0aGUgY29udGFpbmVyIGN1cnJlbnRseSBoYXZlLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBpdGVtc1xuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UudWkuQ29sbGVjdGlvbn0gQ29udHJvbCBjb2xsZWN0aW9uIGRpcmVjdCBjaGlsZCBjb250cm9scy5cblx0XHQgKi9cblx0XHRpdGVtczogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5faXRlbXM7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIEZpbmQgY2hpbGQgY29udHJvbHMgYnkgc2VsZWN0b3IuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGZpbmRcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gc2VsZWN0b3IgU2VsZWN0b3IgQ1NTIHBhdHRlcm4gdG8gZmluZCBjaGlsZHJlbiBieS5cblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLnVpLkNvbGxlY3Rpb259IENvbnRyb2wgY29sbGVjdGlvbiB3aXRoIGNoaWxkIGNvbnRyb2xzLlxuXHRcdCAqL1xuXHRcdGZpbmQ6IGZ1bmN0aW9uKHNlbGVjdG9yKSB7XG5cdFx0XHRzZWxlY3RvciA9IHNlbGVjdG9yQ2FjaGVbc2VsZWN0b3JdID0gc2VsZWN0b3JDYWNoZVtzZWxlY3Rvcl0gfHwgbmV3IFNlbGVjdG9yKHNlbGVjdG9yKTtcblxuXHRcdFx0cmV0dXJuIHNlbGVjdG9yLmZpbmQodGhpcyk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIEFkZHMgb25lIG9yIG1hbnkgaXRlbXMgdG8gdGhlIGN1cnJlbnQgY29udGFpbmVyLiBUaGlzIHdpbGwgY3JlYXRlIGluc3RhbmNlcyBvZlxuXHRcdCAqIHRoZSBvYmplY3QgcmVwcmVzZW50YXRpb25zIGlmIG5lZWRlZC5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgYWRkXG5cdFx0ICogQHBhcmFtIHtBcnJheS9PYmplY3QvdGlueW1jZS51aS5Db250cm9sfSBpdGVtcyBBcnJheSBvciBpdGVtIHRoYXQgd2lsbCBiZSBhZGRlZCB0byB0aGUgY29udGFpbmVyLlxuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UudWkuQ29sbGVjdGlvbn0gQ3VycmVudCBjb2xsZWN0aW9uIGNvbnRyb2wuXG5cdFx0ICovXG5cdFx0YWRkOiBmdW5jdGlvbihpdGVtcykge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHRzZWxmLml0ZW1zKCkuYWRkKHNlbGYuY3JlYXRlKGl0ZW1zKSkucGFyZW50KHNlbGYpO1xuXG5cdFx0XHRyZXR1cm4gc2VsZjtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogRm9jdXNlcyB0aGUgY3VycmVudCBjb250YWluZXIgaW5zdGFuY2UuIFRoaXMgd2lsbCBsb29rXG5cdFx0ICogZm9yIHRoZSBmaXJzdCBjb250cm9sIGluIHRoZSBjb250YWluZXIgYW5kIGZvY3VzIHRoYXQuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGZvY3VzXG5cdFx0ICogQHBhcmFtIHtCb29sZWFufSBrZXlib2FyZCBPcHRpb25hbCB0cnVlL2ZhbHNlIGlmIHRoZSBmb2N1cyB3YXMgYSBrZXlib2FyZCBmb2N1cyBvciBub3QuXG5cdFx0ICogQHJldHVybiB7dGlueW1jZS51aS5Db2xsZWN0aW9ufSBDdXJyZW50IGluc3RhbmNlLlxuXHRcdCAqL1xuXHRcdGZvY3VzOiBmdW5jdGlvbihrZXlib2FyZCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLCBmb2N1c0N0cmwsIGtleWJvYXJkTmF2LCBpdGVtcztcblxuXHRcdFx0aWYgKGtleWJvYXJkKSB7XG5cdFx0XHRcdGtleWJvYXJkTmF2ID0gc2VsZi5rZXlib2FyZE5hdiB8fCBzZWxmLnBhcmVudHMoKS5lcSgtMSlbMF0ua2V5Ym9hcmROYXY7XG5cblx0XHRcdFx0aWYgKGtleWJvYXJkTmF2KSB7XG5cdFx0XHRcdFx0a2V5Ym9hcmROYXYuZm9jdXNGaXJzdChzZWxmKTtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aXRlbXMgPSBzZWxmLmZpbmQoJyonKTtcblxuXHRcdFx0Ly8gVE9ETzogRmlndXJlIG91dCBhIGJldHRlciB3YXkgdG8gYXV0byBmb2N1cyBhbGVydCBkaWFsb2cgYnV0dG9uc1xuXHRcdFx0aWYgKHNlbGYuc3RhdHVzYmFyKSB7XG5cdFx0XHRcdGl0ZW1zLmFkZChzZWxmLnN0YXR1c2Jhci5pdGVtcygpKTtcblx0XHRcdH1cblxuXHRcdFx0aXRlbXMuZWFjaChmdW5jdGlvbihjdHJsKSB7XG5cdFx0XHRcdGlmIChjdHJsLnNldHRpbmdzLmF1dG9mb2N1cykge1xuXHRcdFx0XHRcdGZvY3VzQ3RybCA9IG51bGw7XG5cdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKGN0cmwuY2FuRm9jdXMpIHtcblx0XHRcdFx0XHRmb2N1c0N0cmwgPSBmb2N1c0N0cmwgfHwgY3RybDtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdGlmIChmb2N1c0N0cmwpIHtcblx0XHRcdFx0Zm9jdXNDdHJsLmZvY3VzKCk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBzZWxmO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZXBsYWNlcyB0aGUgc3BlY2lmaWVkIGNoaWxkIGNvbnRyb2wgd2l0aCBhIG5ldyBjb250cm9sLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCByZXBsYWNlXG5cdFx0ICogQHBhcmFtIHt0aW55bWNlLnVpLkNvbnRyb2x9IG9sZEl0ZW0gT2xkIGl0ZW0gdG8gYmUgcmVwbGFjZWQuXG5cdFx0ICogQHBhcmFtIHt0aW55bWNlLnVpLkNvbnRyb2x9IG5ld0l0ZW0gTmV3IGl0ZW0gdG8gYmUgaW5zZXJ0ZWQuXG5cdFx0ICovXG5cdFx0cmVwbGFjZTogZnVuY3Rpb24ob2xkSXRlbSwgbmV3SXRlbSkge1xuXHRcdFx0dmFyIGN0cmxFbG0sIGl0ZW1zID0gdGhpcy5pdGVtcygpLCBpID0gaXRlbXMubGVuZ3RoO1xuXG5cdFx0XHQvLyBSZXBsYWNlIHRoZSBpdGVtIGluIGNvbGxlY3Rpb25cblx0XHRcdHdoaWxlIChpLS0pIHtcblx0XHRcdFx0aWYgKGl0ZW1zW2ldID09PSBvbGRJdGVtKSB7XG5cdFx0XHRcdFx0aXRlbXNbaV0gPSBuZXdJdGVtO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmIChpID49IDApIHtcblx0XHRcdFx0Ly8gUmVtb3ZlIG5ldyBpdGVtIGZyb20gRE9NXG5cdFx0XHRcdGN0cmxFbG0gPSBuZXdJdGVtLmdldEVsKCk7XG5cdFx0XHRcdGlmIChjdHJsRWxtKSB7XG5cdFx0XHRcdFx0Y3RybEVsbS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGN0cmxFbG0pO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gUmVtb3ZlIG9sZCBpdGVtIGZyb20gRE9NXG5cdFx0XHRcdGN0cmxFbG0gPSBvbGRJdGVtLmdldEVsKCk7XG5cdFx0XHRcdGlmIChjdHJsRWxtKSB7XG5cdFx0XHRcdFx0Y3RybEVsbS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGN0cmxFbG0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdC8vIEFkb3B0IHRoZSBpdGVtXG5cdFx0XHRuZXdJdGVtLnBhcmVudCh0aGlzKTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogQ3JlYXRlcyB0aGUgc3BlY2lmaWVkIGl0ZW1zLiBJZiBhbnkgb2YgdGhlIGl0ZW1zIGlzIHBsYWluIEpTT04gc3R5bGUgb2JqZWN0c1xuXHRcdCAqIGl0IHdpbGwgY29udmVydCB0aGVzZSBpbnRvIHJlYWwgdGlueW1jZS51aS5Db250cm9sIGluc3RhbmNlcy5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgY3JlYXRlXG5cdFx0ICogQHBhcmFtIHtBcnJheX0gaXRlbXMgQXJyYXkgb2YgaXRlbXMgdG8gY29udmVydCBpbnRvIGNvbnRyb2wgaW5zdGFuY2VzLlxuXHRcdCAqIEByZXR1cm4ge0FycmF5fSBBcnJheSB3aXRoIGNvbnRyb2wgaW5zdGFuY2VzLlxuXHRcdCAqL1xuXHRcdGNyZWF0ZTogZnVuY3Rpb24oaXRlbXMpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgc2V0dGluZ3MsIGN0cmxJdGVtcyA9IFtdO1xuXG5cdFx0XHQvLyBOb24gYXJyYXkgc3RydWN0dXJlLCB0aGVuIGZvcmNlIGl0IGludG8gYW4gYXJyYXlcblx0XHRcdGlmICghVG9vbHMuaXNBcnJheShpdGVtcykpIHtcblx0XHRcdFx0aXRlbXMgPSBbaXRlbXNdO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBBZGQgZGVmYXVsdCB0eXBlIHRvIGVhY2ggY2hpbGQgY29udHJvbFxuXHRcdFx0VG9vbHMuZWFjaChpdGVtcywgZnVuY3Rpb24oaXRlbSkge1xuXHRcdFx0XHRpZiAoaXRlbSkge1xuXHRcdFx0XHRcdC8vIENvbnN0cnVjdCBpdGVtIGlmIG5lZWRlZFxuXHRcdFx0XHRcdGlmICghKGl0ZW0gaW5zdGFuY2VvZiBDb250cm9sKSkge1xuXHRcdFx0XHRcdFx0Ly8gTmFtZSBvbmx5IHRoZW4gY29udmVydCBpdCB0byBhbiBvYmplY3Rcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YgaXRlbSA9PSBcInN0cmluZ1wiKSB7XG5cdFx0XHRcdFx0XHRcdGl0ZW0gPSB7dHlwZTogaXRlbX07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdC8vIENyZWF0ZSBjb250cm9sIGluc3RhbmNlIGJhc2VkIG9uIGlucHV0IHNldHRpbmdzIGFuZCBkZWZhdWx0IHNldHRpbmdzXG5cdFx0XHRcdFx0XHRzZXR0aW5ncyA9IFRvb2xzLmV4dGVuZCh7fSwgc2VsZi5zZXR0aW5ncy5kZWZhdWx0cywgaXRlbSk7XG5cdFx0XHRcdFx0XHRpdGVtLnR5cGUgPSBzZXR0aW5ncy50eXBlID0gc2V0dGluZ3MudHlwZSB8fCBpdGVtLnR5cGUgfHwgc2VsZi5zZXR0aW5ncy5kZWZhdWx0VHlwZSB8fFxuXHRcdFx0XHRcdFx0XHQoc2V0dGluZ3MuZGVmYXVsdHMgPyBzZXR0aW5ncy5kZWZhdWx0cy50eXBlIDogbnVsbCk7XG5cdFx0XHRcdFx0XHRpdGVtID0gRmFjdG9yeS5jcmVhdGUoc2V0dGluZ3MpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGN0cmxJdGVtcy5wdXNoKGl0ZW0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0cmV0dXJuIGN0cmxJdGVtcztcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmVuZGVycyBuZXcgY29udHJvbCBpbnN0YW5jZXMuXG5cdFx0ICpcblx0XHQgKiBAcHJpdmF0ZVxuXHRcdCAqL1xuXHRcdHJlbmRlck5ldzogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdC8vIFJlbmRlciBhbnkgbmV3IGl0ZW1zXG5cdFx0XHRzZWxmLml0ZW1zKCkuZWFjaChmdW5jdGlvbihjdHJsLCBpbmRleCkge1xuXHRcdFx0XHR2YXIgY29udGFpbmVyRWxtO1xuXG5cdFx0XHRcdGN0cmwucGFyZW50KHNlbGYpO1xuXG5cdFx0XHRcdGlmICghY3RybC5zdGF0ZS5nZXQoJ3JlbmRlcmVkJykpIHtcblx0XHRcdFx0XHRjb250YWluZXJFbG0gPSBzZWxmLmdldEVsKCdib2R5Jyk7XG5cblx0XHRcdFx0XHQvLyBJbnNlcnQgb3IgYXBwZW5kIHRoZSBpdGVtXG5cdFx0XHRcdFx0aWYgKGNvbnRhaW5lckVsbS5oYXNDaGlsZE5vZGVzKCkgJiYgaW5kZXggPD0gY29udGFpbmVyRWxtLmNoaWxkTm9kZXMubGVuZ3RoIC0gMSkge1xuXHRcdFx0XHRcdFx0JChjb250YWluZXJFbG0uY2hpbGROb2Rlc1tpbmRleF0pLmJlZm9yZShjdHJsLnJlbmRlckh0bWwoKSk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdCQoY29udGFpbmVyRWxtKS5hcHBlbmQoY3RybC5yZW5kZXJIdG1sKCkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGN0cmwucG9zdFJlbmRlcigpO1xuXHRcdFx0XHRcdFJlZmxvd1F1ZXVlLmFkZChjdHJsKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdHNlbGYuX2xheW91dC5hcHBseUNsYXNzZXMoc2VsZi5pdGVtcygpLmZpbHRlcignOnZpc2libGUnKSk7XG5cdFx0XHRzZWxmLl9sYXN0UmVjdCA9IG51bGw7XG5cblx0XHRcdHJldHVybiBzZWxmO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBBcHBlbmRzIG5ldyBpbnN0YW5jZXMgdG8gdGhlIGN1cnJlbnQgY29udGFpbmVyLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBhcHBlbmRcblx0XHQgKiBAcGFyYW0ge0FycmF5L3RpbnltY2UudWkuQ29sbGVjdGlvbn0gaXRlbXMgQXJyYXkgaWYgY29udHJvbHMgdG8gYXBwZW5kLlxuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UudWkuQ29udGFpbmVyfSBDdXJyZW50IGNvbnRhaW5lciBpbnN0YW5jZS5cblx0XHQgKi9cblx0XHRhcHBlbmQ6IGZ1bmN0aW9uKGl0ZW1zKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5hZGQoaXRlbXMpLnJlbmRlck5ldygpO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBQcmVwZW5kcyBuZXcgaW5zdGFuY2VzIHRvIHRoZSBjdXJyZW50IGNvbnRhaW5lci5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgcHJlcGVuZFxuXHRcdCAqIEBwYXJhbSB7QXJyYXkvdGlueW1jZS51aS5Db2xsZWN0aW9ufSBpdGVtcyBBcnJheSBpZiBjb250cm9scyB0byBwcmVwZW5kLlxuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UudWkuQ29udGFpbmVyfSBDdXJyZW50IGNvbnRhaW5lciBpbnN0YW5jZS5cblx0XHQgKi9cblx0XHRwcmVwZW5kOiBmdW5jdGlvbihpdGVtcykge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHRzZWxmLml0ZW1zKCkuc2V0KHNlbGYuY3JlYXRlKGl0ZW1zKS5jb25jYXQoc2VsZi5pdGVtcygpLnRvQXJyYXkoKSkpO1xuXG5cdFx0XHRyZXR1cm4gc2VsZi5yZW5kZXJOZXcoKTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogSW5zZXJ0cyBhbiBjb250cm9sIGF0IGEgc3BlY2lmaWMgaW5kZXguXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGluc2VydFxuXHRcdCAqIEBwYXJhbSB7QXJyYXkvdGlueW1jZS51aS5Db2xsZWN0aW9ufSBpdGVtcyBBcnJheSBpZiBjb250cm9scyB0byBpbnNlcnQuXG5cdFx0ICogQHBhcmFtIHtOdW1iZXJ9IGluZGV4IEluZGV4IHRvIGluc2VydCBjb250cm9scyBhdC5cblx0XHQgKiBAcGFyYW0ge0Jvb2xlYW59IFtiZWZvcmU9ZmFsc2VdIEluc2VydHMgY29udHJvbHMgYmVmb3JlIHRoZSBpbmRleC5cblx0XHQgKi9cblx0XHRpbnNlcnQ6IGZ1bmN0aW9uKGl0ZW1zLCBpbmRleCwgYmVmb3JlKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIGN1ckl0ZW1zLCBiZWZvcmVJdGVtcywgYWZ0ZXJJdGVtcztcblxuXHRcdFx0aXRlbXMgPSBzZWxmLmNyZWF0ZShpdGVtcyk7XG5cdFx0XHRjdXJJdGVtcyA9IHNlbGYuaXRlbXMoKTtcblxuXHRcdFx0aWYgKCFiZWZvcmUgJiYgaW5kZXggPCBjdXJJdGVtcy5sZW5ndGggLSAxKSB7XG5cdFx0XHRcdGluZGV4ICs9IDE7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChpbmRleCA+PSAwICYmIGluZGV4IDwgY3VySXRlbXMubGVuZ3RoKSB7XG5cdFx0XHRcdGJlZm9yZUl0ZW1zID0gY3VySXRlbXMuc2xpY2UoMCwgaW5kZXgpLnRvQXJyYXkoKTtcblx0XHRcdFx0YWZ0ZXJJdGVtcyA9IGN1ckl0ZW1zLnNsaWNlKGluZGV4KS50b0FycmF5KCk7XG5cdFx0XHRcdGN1ckl0ZW1zLnNldChiZWZvcmVJdGVtcy5jb25jYXQoaXRlbXMsIGFmdGVySXRlbXMpKTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHNlbGYucmVuZGVyTmV3KCk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFBvcHVsYXRlcyB0aGUgZm9ybSBmaWVsZHMgZnJvbSB0aGUgc3BlY2lmaWVkIEpTT04gZGF0YSBvYmplY3QuXG5cdFx0ICpcblx0XHQgKiBDb250cm9sIGl0ZW1zIGluIHRoZSBmb3JtIHRoYXQgbWF0Y2hlcyB0aGUgZGF0YSB3aWxsIGhhdmUgaXQncyB2YWx1ZSBzZXQuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGZyb21KU09OXG5cdFx0ICogQHBhcmFtIHtPYmplY3R9IGRhdGEgSlNPTiBkYXRhIG9iamVjdCB0byBzZXQgY29udHJvbCB2YWx1ZXMgYnkuXG5cdFx0ICogQHJldHVybiB7dGlueW1jZS51aS5Db250YWluZXJ9IEN1cnJlbnQgZm9ybSBpbnN0YW5jZS5cblx0XHQgKi9cblx0XHRmcm9tSlNPTjogZnVuY3Rpb24oZGF0YSkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHRmb3IgKHZhciBuYW1lIGluIGRhdGEpIHtcblx0XHRcdFx0c2VsZi5maW5kKCcjJyArIG5hbWUpLnZhbHVlKGRhdGFbbmFtZV0pO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gc2VsZjtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogU2VyaWFsaXplcyB0aGUgZm9ybSBpbnRvIGEgSlNPTiBvYmplY3QgYnkgZ2V0dGluZyBhbGwgaXRlbXNcblx0XHQgKiB0aGF0IGhhcyBhIG5hbWUgYW5kIGEgdmFsdWUuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHRvSlNPTlxuXHRcdCAqIEByZXR1cm4ge09iamVjdH0gSlNPTiBvYmplY3Qgd2l0aCBmb3JtIGRhdGEuXG5cdFx0ICovXG5cdFx0dG9KU09OOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgZGF0YSA9IHt9O1xuXG5cdFx0XHRzZWxmLmZpbmQoJyonKS5lYWNoKGZ1bmN0aW9uKGN0cmwpIHtcblx0XHRcdFx0dmFyIG5hbWUgPSBjdHJsLm5hbWUoKSwgdmFsdWUgPSBjdHJsLnZhbHVlKCk7XG5cblx0XHRcdFx0aWYgKG5hbWUgJiYgdHlwZW9mIHZhbHVlICE9IFwidW5kZWZpbmVkXCIpIHtcblx0XHRcdFx0XHRkYXRhW25hbWVdID0gdmFsdWU7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRyZXR1cm4gZGF0YTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmVuZGVycyB0aGUgY29udHJvbCBhcyBhIEhUTUwgc3RyaW5nLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCByZW5kZXJIdG1sXG5cdFx0ICogQHJldHVybiB7U3RyaW5nfSBIVE1MIHJlcHJlc2VudGluZyB0aGUgY29udHJvbC5cblx0XHQgKi9cblx0XHRyZW5kZXJIdG1sOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgbGF5b3V0ID0gc2VsZi5fbGF5b3V0LCByb2xlID0gdGhpcy5zZXR0aW5ncy5yb2xlO1xuXG5cdFx0XHRzZWxmLnByZVJlbmRlcigpO1xuXHRcdFx0bGF5b3V0LnByZVJlbmRlcihzZWxmKTtcblxuXHRcdFx0cmV0dXJuIChcblx0XHRcdFx0JzxkaXYgaWQ9XCInICsgc2VsZi5faWQgKyAnXCIgY2xhc3M9XCInICsgc2VsZi5jbGFzc2VzICsgJ1wiJyArIChyb2xlID8gJyByb2xlPVwiJyArIHRoaXMuc2V0dGluZ3Mucm9sZSArICdcIicgOiAnJykgKyAnPicgK1xuXHRcdFx0XHRcdCc8ZGl2IGlkPVwiJyArIHNlbGYuX2lkICsgJy1ib2R5XCIgY2xhc3M9XCInICsgc2VsZi5ib2R5Q2xhc3NlcyArICdcIj4nICtcblx0XHRcdFx0XHRcdChzZWxmLnNldHRpbmdzLmh0bWwgfHwgJycpICsgbGF5b3V0LnJlbmRlckh0bWwoc2VsZikgK1xuXHRcdFx0XHRcdCc8L2Rpdj4nICtcblx0XHRcdFx0JzwvZGl2Pidcblx0XHRcdCk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFBvc3QgcmVuZGVyIG1ldGhvZC4gQ2FsbGVkIGFmdGVyIHRoZSBjb250cm9sIGhhcyBiZWVuIHJlbmRlcmVkIHRvIHRoZSB0YXJnZXQuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHBvc3RSZW5kZXJcblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLnVpLkNvbnRhaW5lcn0gQ3VycmVudCBjb21ib2JveCBpbnN0YW5jZS5cblx0XHQgKi9cblx0XHRwb3N0UmVuZGVyOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgYm94O1xuXG5cdFx0XHRzZWxmLml0ZW1zKCkuZXhlYygncG9zdFJlbmRlcicpO1xuXHRcdFx0c2VsZi5fc3VwZXIoKTtcblxuXHRcdFx0c2VsZi5fbGF5b3V0LnBvc3RSZW5kZXIoc2VsZik7XG5cdFx0XHRzZWxmLnN0YXRlLnNldCgncmVuZGVyZWQnLCB0cnVlKTtcblxuXHRcdFx0aWYgKHNlbGYuc2V0dGluZ3Muc3R5bGUpIHtcblx0XHRcdFx0c2VsZi4kZWwuY3NzKHNlbGYuc2V0dGluZ3Muc3R5bGUpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoc2VsZi5zZXR0aW5ncy5ib3JkZXIpIHtcblx0XHRcdFx0Ym94ID0gc2VsZi5ib3JkZXJCb3g7XG5cdFx0XHRcdHNlbGYuJGVsLmNzcyh7XG5cdFx0XHRcdFx0J2JvcmRlci10b3Atd2lkdGgnOiBib3gudG9wLFxuXHRcdFx0XHRcdCdib3JkZXItcmlnaHQtd2lkdGgnOiBib3gucmlnaHQsXG5cdFx0XHRcdFx0J2JvcmRlci1ib3R0b20td2lkdGgnOiBib3guYm90dG9tLFxuXHRcdFx0XHRcdCdib3JkZXItbGVmdC13aWR0aCc6IGJveC5sZWZ0XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoIXNlbGYucGFyZW50KCkpIHtcblx0XHRcdFx0c2VsZi5rZXlib2FyZE5hdiA9IG5ldyBLZXlib2FyZE5hdmlnYXRpb24oe1xuXHRcdFx0XHRcdHJvb3Q6IHNlbGZcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBzZWxmO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBJbml0aWFsaXplcyB0aGUgY3VycmVudCBjb250cm9scyBsYXlvdXQgcmVjdC5cblx0XHQgKiBUaGlzIHdpbGwgYmUgZXhlY3V0ZWQgYnkgdGhlIGxheW91dCBtYW5hZ2VycyB0byBkZXRlcm1pbmUgdGhlXG5cdFx0ICogZGVmYXVsdCBtaW5XaWR0aC9taW5IZWlnaHQgZXRjLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBpbml0TGF5b3V0UmVjdFxuXHRcdCAqIEByZXR1cm4ge09iamVjdH0gTGF5b3V0IHJlY3QgaW5zdGFuY2UuXG5cdFx0ICovXG5cdFx0aW5pdExheW91dFJlY3Q6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLCBsYXlvdXRSZWN0ID0gc2VsZi5fc3VwZXIoKTtcblxuXHRcdFx0Ly8gUmVjYWxjIGNvbnRhaW5lciBzaXplIGJ5IGFza2luZyBsYXlvdXQgbWFuYWdlclxuXHRcdFx0c2VsZi5fbGF5b3V0LnJlY2FsYyhzZWxmKTtcblxuXHRcdFx0cmV0dXJuIGxheW91dFJlY3Q7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFJlY2FsY3VsYXRlcyB0aGUgcG9zaXRpb25zIG9mIHRoZSBjb250cm9scyBpbiB0aGUgY3VycmVudCBjb250YWluZXIuXG5cdFx0ICogVGhpcyBpcyBpbnZva2VkIGJ5IHRoZSByZWZsb3cgbWV0aG9kIGFuZCBzaG91bGRuJ3QgYmUgY2FsbGVkIGRpcmVjdGx5LlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCByZWNhbGNcblx0XHQgKi9cblx0XHRyZWNhbGM6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLCByZWN0ID0gc2VsZi5fbGF5b3V0UmVjdCwgbGFzdFJlY3QgPSBzZWxmLl9sYXN0UmVjdDtcblxuXHRcdFx0aWYgKCFsYXN0UmVjdCB8fCBsYXN0UmVjdC53ICE9IHJlY3QudyB8fCBsYXN0UmVjdC5oICE9IHJlY3QuaCkge1xuXHRcdFx0XHRzZWxmLl9sYXlvdXQucmVjYWxjKHNlbGYpO1xuXHRcdFx0XHRyZWN0ID0gc2VsZi5sYXlvdXRSZWN0KCk7XG5cdFx0XHRcdHNlbGYuX2xhc3RSZWN0ID0ge3g6IHJlY3QueCwgeTogcmVjdC55LCB3OiByZWN0LncsIGg6IHJlY3QuaH07XG5cdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZWZsb3dzIHRoZSBjdXJyZW50IGNvbnRhaW5lciBhbmQgaXQncyBjaGlsZHJlbiBhbmQgcG9zc2libGUgcGFyZW50cy5cblx0XHQgKiBUaGlzIHNob3VsZCBiZSB1c2VkIGFmdGVyIHlvdSBmb3IgZXhhbXBsZSBhcHBlbmQgY2hpbGRyZW4gdG8gdGhlIGN1cnJlbnQgY29udHJvbCBzb1xuXHRcdCAqIHRoYXQgdGhlIGxheW91dCBtYW5hZ2VycyBrbm93IHRoYXQgdGhleSBuZWVkIHRvIHJlcG9zaXRpb24gZXZlcnl0aGluZy5cblx0XHQgKlxuXHRcdCAqIEBleGFtcGxlXG5cdFx0ICogY29udGFpbmVyLmFwcGVuZCh7dHlwZTogJ2J1dHRvbicsIHRleHQ6ICdNeSBidXR0b24nfSkucmVmbG93KCk7XG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHJlZmxvd1xuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UudWkuQ29udGFpbmVyfSBDdXJyZW50IGNvbnRhaW5lciBpbnN0YW5jZS5cblx0XHQgKi9cblx0XHRyZWZsb3c6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIGk7XG5cblx0XHRcdFJlZmxvd1F1ZXVlLnJlbW92ZSh0aGlzKTtcblxuXHRcdFx0aWYgKHRoaXMudmlzaWJsZSgpKSB7XG5cdFx0XHRcdENvbnRyb2wucmVwYWludENvbnRyb2xzID0gW107XG5cdFx0XHRcdENvbnRyb2wucmVwYWludENvbnRyb2xzLm1hcCA9IHt9O1xuXG5cdFx0XHRcdHRoaXMucmVjYWxjKCk7XG5cdFx0XHRcdGkgPSBDb250cm9sLnJlcGFpbnRDb250cm9scy5sZW5ndGg7XG5cblx0XHRcdFx0d2hpbGUgKGktLSkge1xuXHRcdFx0XHRcdENvbnRyb2wucmVwYWludENvbnRyb2xzW2ldLnJlcGFpbnQoKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIFRPRE86IEZpeCBtZSFcblx0XHRcdFx0aWYgKHRoaXMuc2V0dGluZ3MubGF5b3V0ICE9PSBcImZsb3dcIiAmJiB0aGlzLnNldHRpbmdzLmxheW91dCAhPT0gXCJzdGFja1wiKSB7XG5cdFx0XHRcdFx0dGhpcy5yZXBhaW50KCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRDb250cm9sLnJlcGFpbnRDb250cm9scyA9IFtdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cdH0pO1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy91aS9EcmFnSGVscGVyLmpzXG5cbi8qKlxuICogRHJhZ0hlbHBlci5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE1IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKipcbiAqIERyYWcvZHJvcCBoZWxwZXIgY2xhc3MuXG4gKlxuICogQGV4YW1wbGVcbiAqIHZhciBkcmFnSGVscGVyID0gbmV3IHRpbnltY2UudWkuRHJhZ0hlbHBlcignbXlkaXYnLCB7XG4gKiAgICAgc3RhcnQ6IGZ1bmN0aW9uKGV2dCkge1xuICogICAgIH0sXG4gKlxuICogICAgIGRyYWc6IGZ1bmN0aW9uKGV2dCkge1xuICogICAgIH0sXG4gKlxuICogICAgIGVuZDogZnVuY3Rpb24oZXZ0KSB7XG4gKiAgICAgfVxuICogfSk7XG4gKlxuICogQGNsYXNzIHRpbnltY2UudWkuRHJhZ0hlbHBlclxuICovXG5kZWZpbmUoXCJ0aW55bWNlL3VpL0RyYWdIZWxwZXJcIiwgW1xuXHRcInRpbnltY2UvZG9tL0RvbVF1ZXJ5XCJcbl0sIGZ1bmN0aW9uKCQpIHtcblx0XCJ1c2Ugc3RyaWN0XCI7XG5cblx0ZnVuY3Rpb24gZ2V0RG9jdW1lbnRTaXplKGRvYykge1xuXHRcdHZhciBkb2N1bWVudEVsZW1lbnQsIGJvZHksIHNjcm9sbFdpZHRoLCBjbGllbnRXaWR0aDtcblx0XHR2YXIgb2Zmc2V0V2lkdGgsIHNjcm9sbEhlaWdodCwgY2xpZW50SGVpZ2h0LCBvZmZzZXRIZWlnaHQsIG1heCA9IE1hdGgubWF4O1xuXG5cdFx0ZG9jdW1lbnRFbGVtZW50ID0gZG9jLmRvY3VtZW50RWxlbWVudDtcblx0XHRib2R5ID0gZG9jLmJvZHk7XG5cblx0XHRzY3JvbGxXaWR0aCA9IG1heChkb2N1bWVudEVsZW1lbnQuc2Nyb2xsV2lkdGgsIGJvZHkuc2Nyb2xsV2lkdGgpO1xuXHRcdGNsaWVudFdpZHRoID0gbWF4KGRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCwgYm9keS5jbGllbnRXaWR0aCk7XG5cdFx0b2Zmc2V0V2lkdGggPSBtYXgoZG9jdW1lbnRFbGVtZW50Lm9mZnNldFdpZHRoLCBib2R5Lm9mZnNldFdpZHRoKTtcblxuXHRcdHNjcm9sbEhlaWdodCA9IG1heChkb2N1bWVudEVsZW1lbnQuc2Nyb2xsSGVpZ2h0LCBib2R5LnNjcm9sbEhlaWdodCk7XG5cdFx0Y2xpZW50SGVpZ2h0ID0gbWF4KGRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQsIGJvZHkuY2xpZW50SGVpZ2h0KTtcblx0XHRvZmZzZXRIZWlnaHQgPSBtYXgoZG9jdW1lbnRFbGVtZW50Lm9mZnNldEhlaWdodCwgYm9keS5vZmZzZXRIZWlnaHQpO1xuXG5cdFx0cmV0dXJuIHtcblx0XHRcdHdpZHRoOiBzY3JvbGxXaWR0aCA8IG9mZnNldFdpZHRoID8gY2xpZW50V2lkdGggOiBzY3JvbGxXaWR0aCxcblx0XHRcdGhlaWdodDogc2Nyb2xsSGVpZ2h0IDwgb2Zmc2V0SGVpZ2h0ID8gY2xpZW50SGVpZ2h0IDogc2Nyb2xsSGVpZ2h0XG5cdFx0fTtcblx0fVxuXG5cdGZ1bmN0aW9uIHVwZGF0ZVdpdGhUb3VjaERhdGEoZSkge1xuXHRcdHZhciBrZXlzLCBpO1xuXG5cdFx0aWYgKGUuY2hhbmdlZFRvdWNoZXMpIHtcblx0XHRcdGtleXMgPSBcInNjcmVlblggc2NyZWVuWSBwYWdlWCBwYWdlWSBjbGllbnRYIGNsaWVudFlcIi5zcGxpdCgnICcpO1xuXHRcdFx0Zm9yIChpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0ZVtrZXlzW2ldXSA9IGUuY2hhbmdlZFRvdWNoZXNbMF1ba2V5c1tpXV07XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0cmV0dXJuIGZ1bmN0aW9uKGlkLCBzZXR0aW5ncykge1xuXHRcdHZhciAkZXZlbnRPdmVybGF5LCBkb2MgPSBzZXR0aW5ncy5kb2N1bWVudCB8fCBkb2N1bWVudCwgZG93bkJ1dHRvbiwgc3RhcnQsIHN0b3AsIGRyYWcsIHN0YXJ0WCwgc3RhcnRZO1xuXG5cdFx0c2V0dGluZ3MgPSBzZXR0aW5ncyB8fCB7fTtcblxuXHRcdGZ1bmN0aW9uIGdldEhhbmRsZUVsbSgpIHtcblx0XHRcdHJldHVybiBkb2MuZ2V0RWxlbWVudEJ5SWQoc2V0dGluZ3MuaGFuZGxlIHx8IGlkKTtcblx0XHR9XG5cblx0XHRzdGFydCA9IGZ1bmN0aW9uKGUpIHtcblx0XHRcdHZhciBkb2NTaXplID0gZ2V0RG9jdW1lbnRTaXplKGRvYyksIGhhbmRsZUVsbSwgY3Vyc29yO1xuXG5cdFx0XHR1cGRhdGVXaXRoVG91Y2hEYXRhKGUpO1xuXG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRkb3duQnV0dG9uID0gZS5idXR0b247XG5cdFx0XHRoYW5kbGVFbG0gPSBnZXRIYW5kbGVFbG0oKTtcblx0XHRcdHN0YXJ0WCA9IGUuc2NyZWVuWDtcblx0XHRcdHN0YXJ0WSA9IGUuc2NyZWVuWTtcblxuXHRcdFx0Ly8gR3JhYiBjdXJzb3IgZnJvbSBoYW5kbGUgc28gd2UgY2FuIHBsYWNlIGl0IG9uIG92ZXJsYXlcblx0XHRcdGlmICh3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSkge1xuXHRcdFx0XHRjdXJzb3IgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShoYW5kbGVFbG0sIG51bGwpLmdldFByb3BlcnR5VmFsdWUoXCJjdXJzb3JcIik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjdXJzb3IgPSBoYW5kbGVFbG0ucnVudGltZVN0eWxlLmN1cnNvcjtcblx0XHRcdH1cblxuXHRcdFx0JGV2ZW50T3ZlcmxheSA9ICQoJzxkaXY+PC9kaXY+JykuY3NzKHtcblx0XHRcdFx0cG9zaXRpb246IFwiYWJzb2x1dGVcIixcblx0XHRcdFx0dG9wOiAwLCBsZWZ0OiAwLFxuXHRcdFx0XHR3aWR0aDogZG9jU2l6ZS53aWR0aCxcblx0XHRcdFx0aGVpZ2h0OiBkb2NTaXplLmhlaWdodCxcblx0XHRcdFx0ekluZGV4OiAweDdGRkZGRkZGLFxuXHRcdFx0XHRvcGFjaXR5OiAwLjAwMDEsXG5cdFx0XHRcdGN1cnNvcjogY3Vyc29yXG5cdFx0XHR9KS5hcHBlbmRUbyhkb2MuYm9keSk7XG5cblx0XHRcdCQoZG9jKS5vbignbW91c2Vtb3ZlIHRvdWNobW92ZScsIGRyYWcpLm9uKCdtb3VzZXVwIHRvdWNoZW5kJywgc3RvcCk7XG5cblx0XHRcdHNldHRpbmdzLnN0YXJ0KGUpO1xuXHRcdH07XG5cblx0XHRkcmFnID0gZnVuY3Rpb24oZSkge1xuXHRcdFx0dXBkYXRlV2l0aFRvdWNoRGF0YShlKTtcblxuXHRcdFx0aWYgKGUuYnV0dG9uICE9PSBkb3duQnV0dG9uKSB7XG5cdFx0XHRcdHJldHVybiBzdG9wKGUpO1xuXHRcdFx0fVxuXG5cdFx0XHRlLmRlbHRhWCA9IGUuc2NyZWVuWCAtIHN0YXJ0WDtcblx0XHRcdGUuZGVsdGFZID0gZS5zY3JlZW5ZIC0gc3RhcnRZO1xuXG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRzZXR0aW5ncy5kcmFnKGUpO1xuXHRcdH07XG5cblx0XHRzdG9wID0gZnVuY3Rpb24oZSkge1xuXHRcdFx0dXBkYXRlV2l0aFRvdWNoRGF0YShlKTtcblxuXHRcdFx0JChkb2MpLm9mZignbW91c2Vtb3ZlIHRvdWNobW92ZScsIGRyYWcpLm9mZignbW91c2V1cCB0b3VjaGVuZCcsIHN0b3ApO1xuXG5cdFx0XHQkZXZlbnRPdmVybGF5LnJlbW92ZSgpO1xuXG5cdFx0XHRpZiAoc2V0dGluZ3Muc3RvcCkge1xuXHRcdFx0XHRzZXR0aW5ncy5zdG9wKGUpO1xuXHRcdFx0fVxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBEZXN0cm95cyB0aGUgZHJhZy9kcm9wIGhlbHBlciBpbnN0YW5jZS5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgZGVzdHJveVxuXHRcdCAqL1xuXHRcdHRoaXMuZGVzdHJveSA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0JChnZXRIYW5kbGVFbG0oKSkub2ZmKCk7XG5cdFx0fTtcblxuXHRcdCQoZ2V0SGFuZGxlRWxtKCkpLm9uKCdtb3VzZWRvd24gdG91Y2hzdGFydCcsIHN0YXJ0KTtcblx0fTtcbn0pO1xuXG4vLyBJbmNsdWRlZCBmcm9tOiBqcy90aW55bWNlL2NsYXNzZXMvdWkvU2Nyb2xsYWJsZS5qc1xuXG4vKipcbiAqIFNjcm9sbGFibGUuanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBUaGlzIG1peGluIG1ha2VzIGNvbnRyb2xzIHNjcm9sbGFibGUgdXNpbmcgY3VzdG9tIHNjcm9sbGJhcnMuXG4gKlxuICogQC14LWxlc3MgU2Nyb2xsYWJsZS5sZXNzXG4gKiBAbWl4aW4gdGlueW1jZS51aS5TY3JvbGxhYmxlXG4gKi9cbmRlZmluZShcInRpbnltY2UvdWkvU2Nyb2xsYWJsZVwiLCBbXG5cdFwidGlueW1jZS9kb20vRG9tUXVlcnlcIixcblx0XCJ0aW55bWNlL3VpL0RyYWdIZWxwZXJcIlxuXSwgZnVuY3Rpb24oJCwgRHJhZ0hlbHBlcikge1xuXHRcInVzZSBzdHJpY3RcIjtcblxuXHRyZXR1cm4ge1xuXHRcdGluaXQ6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXHRcdFx0c2VsZi5vbigncmVwYWludCcsIHNlbGYucmVuZGVyU2Nyb2xsKTtcblx0XHR9LFxuXG5cdFx0cmVuZGVyU2Nyb2xsOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgbWFyZ2luID0gMjtcblxuXHRcdFx0ZnVuY3Rpb24gcmVwYWludFNjcm9sbCgpIHtcblx0XHRcdFx0dmFyIGhhc1Njcm9sbEgsIGhhc1Njcm9sbFYsIGJvZHlFbG07XG5cblx0XHRcdFx0ZnVuY3Rpb24gcmVwYWludEF4aXMoYXhpc05hbWUsIHBvc05hbWUsIHNpemVOYW1lLCBjb250ZW50U2l6ZU5hbWUsIGhhc1Njcm9sbCwgYXgpIHtcblx0XHRcdFx0XHR2YXIgY29udGFpbmVyRWxtLCBzY3JvbGxCYXJFbG0sIHNjcm9sbFRodW1iRWxtO1xuXHRcdFx0XHRcdHZhciBjb250YWluZXJTaXplLCBzY3JvbGxTaXplLCByYXRpbywgcmVjdDtcblx0XHRcdFx0XHR2YXIgcG9zTmFtZUxvd2VyLCBzaXplTmFtZUxvd2VyO1xuXG5cdFx0XHRcdFx0c2Nyb2xsQmFyRWxtID0gc2VsZi5nZXRFbCgnc2Nyb2xsJyArIGF4aXNOYW1lKTtcblx0XHRcdFx0XHRpZiAoc2Nyb2xsQmFyRWxtKSB7XG5cdFx0XHRcdFx0XHRwb3NOYW1lTG93ZXIgPSBwb3NOYW1lLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdFx0XHRzaXplTmFtZUxvd2VyID0gc2l6ZU5hbWUudG9Mb3dlckNhc2UoKTtcblxuXHRcdFx0XHRcdFx0JChzZWxmLmdldEVsKCdhYnNlbmQnKSkuY3NzKHBvc05hbWVMb3dlciwgc2VsZi5sYXlvdXRSZWN0KClbY29udGVudFNpemVOYW1lXSAtIDEpO1xuXG5cdFx0XHRcdFx0XHRpZiAoIWhhc1Njcm9sbCkge1xuXHRcdFx0XHRcdFx0XHQkKHNjcm9sbEJhckVsbSkuY3NzKCdkaXNwbGF5JywgJ25vbmUnKTtcblx0XHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHQkKHNjcm9sbEJhckVsbSkuY3NzKCdkaXNwbGF5JywgJ2Jsb2NrJyk7XG5cdFx0XHRcdFx0XHRjb250YWluZXJFbG0gPSBzZWxmLmdldEVsKCdib2R5Jyk7XG5cdFx0XHRcdFx0XHRzY3JvbGxUaHVtYkVsbSA9IHNlbGYuZ2V0RWwoJ3Njcm9sbCcgKyBheGlzTmFtZSArIFwidFwiKTtcblx0XHRcdFx0XHRcdGNvbnRhaW5lclNpemUgPSBjb250YWluZXJFbG1bXCJjbGllbnRcIiArIHNpemVOYW1lXSAtIChtYXJnaW4gKiAyKTtcblx0XHRcdFx0XHRcdGNvbnRhaW5lclNpemUgLT0gaGFzU2Nyb2xsSCAmJiBoYXNTY3JvbGxWID8gc2Nyb2xsQmFyRWxtW1wiY2xpZW50XCIgKyBheF0gOiAwO1xuXHRcdFx0XHRcdFx0c2Nyb2xsU2l6ZSA9IGNvbnRhaW5lckVsbVtcInNjcm9sbFwiICsgc2l6ZU5hbWVdO1xuXHRcdFx0XHRcdFx0cmF0aW8gPSBjb250YWluZXJTaXplIC8gc2Nyb2xsU2l6ZTtcblxuXHRcdFx0XHRcdFx0cmVjdCA9IHt9O1xuXHRcdFx0XHRcdFx0cmVjdFtwb3NOYW1lTG93ZXJdID0gY29udGFpbmVyRWxtW1wib2Zmc2V0XCIgKyBwb3NOYW1lXSArIG1hcmdpbjtcblx0XHRcdFx0XHRcdHJlY3Rbc2l6ZU5hbWVMb3dlcl0gPSBjb250YWluZXJTaXplO1xuXHRcdFx0XHRcdFx0JChzY3JvbGxCYXJFbG0pLmNzcyhyZWN0KTtcblxuXHRcdFx0XHRcdFx0cmVjdCA9IHt9O1xuXHRcdFx0XHRcdFx0cmVjdFtwb3NOYW1lTG93ZXJdID0gY29udGFpbmVyRWxtW1wic2Nyb2xsXCIgKyBwb3NOYW1lXSAqIHJhdGlvO1xuXHRcdFx0XHRcdFx0cmVjdFtzaXplTmFtZUxvd2VyXSA9IGNvbnRhaW5lclNpemUgKiByYXRpbztcblx0XHRcdFx0XHRcdCQoc2Nyb2xsVGh1bWJFbG0pLmNzcyhyZWN0KTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRib2R5RWxtID0gc2VsZi5nZXRFbCgnYm9keScpO1xuXHRcdFx0XHRoYXNTY3JvbGxIID0gYm9keUVsbS5zY3JvbGxXaWR0aCA+IGJvZHlFbG0uY2xpZW50V2lkdGg7XG5cdFx0XHRcdGhhc1Njcm9sbFYgPSBib2R5RWxtLnNjcm9sbEhlaWdodCA+IGJvZHlFbG0uY2xpZW50SGVpZ2h0O1xuXG5cdFx0XHRcdHJlcGFpbnRBeGlzKFwiaFwiLCBcIkxlZnRcIiwgXCJXaWR0aFwiLCBcImNvbnRlbnRXXCIsIGhhc1Njcm9sbEgsIFwiSGVpZ2h0XCIpO1xuXHRcdFx0XHRyZXBhaW50QXhpcyhcInZcIiwgXCJUb3BcIiwgXCJIZWlnaHRcIiwgXCJjb250ZW50SFwiLCBoYXNTY3JvbGxWLCBcIldpZHRoXCIpO1xuXHRcdFx0fVxuXG5cdFx0XHRmdW5jdGlvbiBhZGRTY3JvbGwoKSB7XG5cdFx0XHRcdGZ1bmN0aW9uIGFkZFNjcm9sbEF4aXMoYXhpc05hbWUsIHBvc05hbWUsIHNpemVOYW1lLCBkZWx0YVBvc05hbWUsIGF4KSB7XG5cdFx0XHRcdFx0dmFyIHNjcm9sbFN0YXJ0LCBheGlzSWQgPSBzZWxmLl9pZCArICctc2Nyb2xsJyArIGF4aXNOYW1lLCBwcmVmaXggPSBzZWxmLmNsYXNzUHJlZml4O1xuXG5cdFx0XHRcdFx0JChzZWxmLmdldEVsKCkpLmFwcGVuZChcblx0XHRcdFx0XHRcdCc8ZGl2IGlkPVwiJyArIGF4aXNJZCArICdcIiBjbGFzcz1cIicgKyBwcmVmaXggKyAnc2Nyb2xsYmFyICcgKyBwcmVmaXggKyAnc2Nyb2xsYmFyLScgKyBheGlzTmFtZSArICdcIj4nICtcblx0XHRcdFx0XHRcdFx0JzxkaXYgaWQ9XCInICsgYXhpc0lkICsgJ3RcIiBjbGFzcz1cIicgKyBwcmVmaXggKyAnc2Nyb2xsYmFyLXRodW1iXCI+PC9kaXY+JyArXG5cdFx0XHRcdFx0XHQnPC9kaXY+J1xuXHRcdFx0XHRcdCk7XG5cblx0XHRcdFx0XHRzZWxmLmRyYWdoZWxwZXIgPSBuZXcgRHJhZ0hlbHBlcihheGlzSWQgKyAndCcsIHtcblx0XHRcdFx0XHRcdHN0YXJ0OiBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRcdFx0c2Nyb2xsU3RhcnQgPSBzZWxmLmdldEVsKCdib2R5JylbXCJzY3JvbGxcIiArIHBvc05hbWVdO1xuXHRcdFx0XHRcdFx0XHQkKCcjJyArIGF4aXNJZCkuYWRkQ2xhc3MocHJlZml4ICsgJ2FjdGl2ZScpO1xuXHRcdFx0XHRcdFx0fSxcblxuXHRcdFx0XHRcdFx0ZHJhZzogZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRcdFx0XHR2YXIgcmF0aW8sIGhhc1Njcm9sbEgsIGhhc1Njcm9sbFYsIGNvbnRhaW5lclNpemUsIGxheW91dFJlY3QgPSBzZWxmLmxheW91dFJlY3QoKTtcblxuXHRcdFx0XHRcdFx0XHRoYXNTY3JvbGxIID0gbGF5b3V0UmVjdC5jb250ZW50VyA+IGxheW91dFJlY3QuaW5uZXJXO1xuXHRcdFx0XHRcdFx0XHRoYXNTY3JvbGxWID0gbGF5b3V0UmVjdC5jb250ZW50SCA+IGxheW91dFJlY3QuaW5uZXJIO1xuXHRcdFx0XHRcdFx0XHRjb250YWluZXJTaXplID0gc2VsZi5nZXRFbCgnYm9keScpW1wiY2xpZW50XCIgKyBzaXplTmFtZV0gLSAobWFyZ2luICogMik7XG5cdFx0XHRcdFx0XHRcdGNvbnRhaW5lclNpemUgLT0gaGFzU2Nyb2xsSCAmJiBoYXNTY3JvbGxWID8gc2VsZi5nZXRFbCgnc2Nyb2xsJyArIGF4aXNOYW1lKVtcImNsaWVudFwiICsgYXhdIDogMDtcblxuXHRcdFx0XHRcdFx0XHRyYXRpbyA9IGNvbnRhaW5lclNpemUgLyBzZWxmLmdldEVsKCdib2R5JylbXCJzY3JvbGxcIiArIHNpemVOYW1lXTtcblx0XHRcdFx0XHRcdFx0c2VsZi5nZXRFbCgnYm9keScpW1wic2Nyb2xsXCIgKyBwb3NOYW1lXSA9IHNjcm9sbFN0YXJ0ICsgKGVbXCJkZWx0YVwiICsgZGVsdGFQb3NOYW1lXSAvIHJhdGlvKTtcblx0XHRcdFx0XHRcdH0sXG5cblx0XHRcdFx0XHRcdHN0b3A6IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdFx0XHQkKCcjJyArIGF4aXNJZCkucmVtb3ZlQ2xhc3MocHJlZml4ICsgJ2FjdGl2ZScpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0c2VsZi5jbGFzc2VzLmFkZCgnc2Nyb2xsJyk7XG5cblx0XHRcdFx0YWRkU2Nyb2xsQXhpcyhcInZcIiwgXCJUb3BcIiwgXCJIZWlnaHRcIiwgXCJZXCIsIFwiV2lkdGhcIik7XG5cdFx0XHRcdGFkZFNjcm9sbEF4aXMoXCJoXCIsIFwiTGVmdFwiLCBcIldpZHRoXCIsIFwiWFwiLCBcIkhlaWdodFwiKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHNlbGYuc2V0dGluZ3MuYXV0b1Njcm9sbCkge1xuXHRcdFx0XHRpZiAoIXNlbGYuX2hhc1Njcm9sbCkge1xuXHRcdFx0XHRcdHNlbGYuX2hhc1Njcm9sbCA9IHRydWU7XG5cdFx0XHRcdFx0YWRkU2Nyb2xsKCk7XG5cblx0XHRcdFx0XHRzZWxmLm9uKCd3aGVlbCcsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0XHRcdHZhciBib2R5RWwgPSBzZWxmLmdldEVsKCdib2R5Jyk7XG5cblx0XHRcdFx0XHRcdGJvZHlFbC5zY3JvbGxMZWZ0ICs9IChlLmRlbHRhWCB8fCAwKSAqIDEwO1xuXHRcdFx0XHRcdFx0Ym9keUVsLnNjcm9sbFRvcCArPSBlLmRlbHRhWSAqIDEwO1xuXG5cdFx0XHRcdFx0XHRyZXBhaW50U2Nyb2xsKCk7XG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHQkKHNlbGYuZ2V0RWwoJ2JvZHknKSkub24oXCJzY3JvbGxcIiwgcmVwYWludFNjcm9sbCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXBhaW50U2Nyb2xsKCk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy91aS9QYW5lbC5qc1xuXG4vKipcbiAqIFBhbmVsLmpzXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgTEdQTCBMaWNlbnNlLlxuICogQ29weXJpZ2h0IChjKSAxOTk5LTIwMTUgRXBob3ggQ29ycC4gQWxsIHJpZ2h0cyByZXNlcnZlZFxuICpcbiAqIExpY2Vuc2U6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vbGljZW5zZVxuICogQ29udHJpYnV0aW5nOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2NvbnRyaWJ1dGluZ1xuICovXG5cbi8qKlxuICogQ3JlYXRlcyBhIG5ldyBwYW5lbC5cbiAqXG4gKiBALXgtbGVzcyBQYW5lbC5sZXNzXG4gKiBAY2xhc3MgdGlueW1jZS51aS5QYW5lbFxuICogQGV4dGVuZHMgdGlueW1jZS51aS5Db250YWluZXJcbiAqIEBtaXhlcyB0aW55bWNlLnVpLlNjcm9sbGFibGVcbiAqL1xuZGVmaW5lKFwidGlueW1jZS91aS9QYW5lbFwiLCBbXG5cdFwidGlueW1jZS91aS9Db250YWluZXJcIixcblx0XCJ0aW55bWNlL3VpL1Njcm9sbGFibGVcIlxuXSwgZnVuY3Rpb24oQ29udGFpbmVyLCBTY3JvbGxhYmxlKSB7XG5cdFwidXNlIHN0cmljdFwiO1xuXG5cdHJldHVybiBDb250YWluZXIuZXh0ZW5kKHtcblx0XHREZWZhdWx0czoge1xuXHRcdFx0bGF5b3V0OiAnZml0Jyxcblx0XHRcdGNvbnRhaW5lckNsczogJ3BhbmVsJ1xuXHRcdH0sXG5cblx0XHRNaXhpbnM6IFtTY3JvbGxhYmxlXSxcblxuXHRcdC8qKlxuXHRcdCAqIFJlbmRlcnMgdGhlIGNvbnRyb2wgYXMgYSBIVE1MIHN0cmluZy5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgcmVuZGVySHRtbFxuXHRcdCAqIEByZXR1cm4ge1N0cmluZ30gSFRNTCByZXByZXNlbnRpbmcgdGhlIGNvbnRyb2wuXG5cdFx0ICovXG5cdFx0cmVuZGVySHRtbDogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIGxheW91dCA9IHNlbGYuX2xheW91dCwgaW5uZXJIdG1sID0gc2VsZi5zZXR0aW5ncy5odG1sO1xuXG5cdFx0XHRzZWxmLnByZVJlbmRlcigpO1xuXHRcdFx0bGF5b3V0LnByZVJlbmRlcihzZWxmKTtcblxuXHRcdFx0aWYgKHR5cGVvZiBpbm5lckh0bWwgPT0gXCJ1bmRlZmluZWRcIikge1xuXHRcdFx0XHRpbm5lckh0bWwgPSAoXG5cdFx0XHRcdFx0JzxkaXYgaWQ9XCInICsgc2VsZi5faWQgKyAnLWJvZHlcIiBjbGFzcz1cIicgKyBzZWxmLmJvZHlDbGFzc2VzICsgJ1wiPicgK1xuXHRcdFx0XHRcdFx0bGF5b3V0LnJlbmRlckh0bWwoc2VsZikgK1xuXHRcdFx0XHRcdCc8L2Rpdj4nXG5cdFx0XHRcdCk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRpZiAodHlwZW9mIGlubmVySHRtbCA9PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0aW5uZXJIdG1sID0gaW5uZXJIdG1sLmNhbGwoc2VsZik7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRzZWxmLl9oYXNCb2R5ID0gZmFsc2U7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiAoXG5cdFx0XHRcdCc8ZGl2IGlkPVwiJyArIHNlbGYuX2lkICsgJ1wiIGNsYXNzPVwiJyArIHNlbGYuY2xhc3NlcyArICdcIiBoaWRlZm9jdXM9XCIxXCIgdGFiaW5kZXg9XCItMVwiIHJvbGU9XCJncm91cFwiPicgK1xuXHRcdFx0XHRcdChzZWxmLl9wcmVCb2R5SHRtbCB8fCAnJykgK1xuXHRcdFx0XHRcdGlubmVySHRtbCArXG5cdFx0XHRcdCc8L2Rpdj4nXG5cdFx0XHQpO1xuXHRcdH1cblx0fSk7XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL3VpL01vdmFibGUuanNcblxuLyoqXG4gKiBNb3ZhYmxlLmpzXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgTEdQTCBMaWNlbnNlLlxuICogQ29weXJpZ2h0IChjKSAxOTk5LTIwMTUgRXBob3ggQ29ycC4gQWxsIHJpZ2h0cyByZXNlcnZlZFxuICpcbiAqIExpY2Vuc2U6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vbGljZW5zZVxuICogQ29udHJpYnV0aW5nOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2NvbnRyaWJ1dGluZ1xuICovXG5cbi8qKlxuICogTW92YWJsZSBtaXhpbi4gTWFrZXMgY29udHJvbHMgbW92YWJsZSBhYnNvbHV0ZSBhbmQgcmVsYXRpdmUgdG8gb3RoZXIgZWxlbWVudHMuXG4gKlxuICogQG1peGluIHRpbnltY2UudWkuTW92YWJsZVxuICovXG5kZWZpbmUoXCJ0aW55bWNlL3VpL01vdmFibGVcIiwgW1xuXHRcInRpbnltY2UvdWkvRG9tVXRpbHNcIlxuXSwgZnVuY3Rpb24oRG9tVXRpbHMpIHtcblx0XCJ1c2Ugc3RyaWN0XCI7XG5cblx0ZnVuY3Rpb24gY2FsY3VsYXRlUmVsYXRpdmVQb3NpdGlvbihjdHJsLCB0YXJnZXRFbG0sIHJlbCkge1xuXHRcdHZhciBjdHJsRWxtLCBwb3MsIHgsIHksIHNlbGZXLCBzZWxmSCwgdGFyZ2V0VywgdGFyZ2V0SCwgdmlld3BvcnQsIHNpemU7XG5cblx0XHR2aWV3cG9ydCA9IERvbVV0aWxzLmdldFZpZXdQb3J0KCk7XG5cblx0XHQvLyBHZXQgcG9zIG9mIHRhcmdldFxuXHRcdHBvcyA9IERvbVV0aWxzLmdldFBvcyh0YXJnZXRFbG0pO1xuXHRcdHggPSBwb3MueDtcblx0XHR5ID0gcG9zLnk7XG5cblx0XHRpZiAoY3RybC5zdGF0ZS5nZXQoJ2ZpeGVkJykgJiYgRG9tVXRpbHMuZ2V0UnVudGltZVN0eWxlKGRvY3VtZW50LmJvZHksICdwb3NpdGlvbicpID09ICdzdGF0aWMnKSB7XG5cdFx0XHR4IC09IHZpZXdwb3J0Lng7XG5cdFx0XHR5IC09IHZpZXdwb3J0Lnk7XG5cdFx0fVxuXG5cdFx0Ly8gR2V0IHNpemUgb2Ygc2VsZlxuXHRcdGN0cmxFbG0gPSBjdHJsLmdldEVsKCk7XG5cdFx0c2l6ZSA9IERvbVV0aWxzLmdldFNpemUoY3RybEVsbSk7XG5cdFx0c2VsZlcgPSBzaXplLndpZHRoO1xuXHRcdHNlbGZIID0gc2l6ZS5oZWlnaHQ7XG5cblx0XHQvLyBHZXQgc2l6ZSBvZiB0YXJnZXRcblx0XHRzaXplID0gRG9tVXRpbHMuZ2V0U2l6ZSh0YXJnZXRFbG0pO1xuXHRcdHRhcmdldFcgPSBzaXplLndpZHRoO1xuXHRcdHRhcmdldEggPSBzaXplLmhlaWdodDtcblxuXHRcdC8vIFBhcnNlIGFsaWduIHN0cmluZ1xuXHRcdHJlbCA9IChyZWwgfHwgJycpLnNwbGl0KCcnKTtcblxuXHRcdC8vIFRhcmdldCBjb3JuZXJzXG5cdFx0aWYgKHJlbFswXSA9PT0gJ2InKSB7XG5cdFx0XHR5ICs9IHRhcmdldEg7XG5cdFx0fVxuXG5cdFx0aWYgKHJlbFsxXSA9PT0gJ3InKSB7XG5cdFx0XHR4ICs9IHRhcmdldFc7XG5cdFx0fVxuXG5cdFx0aWYgKHJlbFswXSA9PT0gJ2MnKSB7XG5cdFx0XHR5ICs9IE1hdGgucm91bmQodGFyZ2V0SCAvIDIpO1xuXHRcdH1cblxuXHRcdGlmIChyZWxbMV0gPT09ICdjJykge1xuXHRcdFx0eCArPSBNYXRoLnJvdW5kKHRhcmdldFcgLyAyKTtcblx0XHR9XG5cblx0XHQvLyBTZWxmIGNvcm5lcnNcblx0XHRpZiAocmVsWzNdID09PSAnYicpIHtcblx0XHRcdHkgLT0gc2VsZkg7XG5cdFx0fVxuXG5cdFx0aWYgKHJlbFs0XSA9PT0gJ3InKSB7XG5cdFx0XHR4IC09IHNlbGZXO1xuXHRcdH1cblxuXHRcdGlmIChyZWxbM10gPT09ICdjJykge1xuXHRcdFx0eSAtPSBNYXRoLnJvdW5kKHNlbGZIIC8gMik7XG5cdFx0fVxuXG5cdFx0aWYgKHJlbFs0XSA9PT0gJ2MnKSB7XG5cdFx0XHR4IC09IE1hdGgucm91bmQoc2VsZlcgLyAyKTtcblx0XHR9XG5cblx0XHRyZXR1cm4ge1xuXHRcdFx0eDogeCxcblx0XHRcdHk6IHksXG5cdFx0XHR3OiBzZWxmVyxcblx0XHRcdGg6IHNlbGZIXG5cdFx0fTtcblx0fVxuXG5cdHJldHVybiB7XG5cdFx0LyoqXG5cdFx0ICogVGVzdHMgdmFyaW91cyBwb3NpdGlvbnMgdG8gZ2V0IHRoZSBtb3N0IHN1aXRhYmxlIG9uZS5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgdGVzdE1vdmVSZWxcblx0XHQgKiBAcGFyYW0ge0RPTUVsZW1lbnR9IGVsbSBFbGVtZW50IHRvIHBvc2l0aW9uIGFnYWluc3QuXG5cdFx0ICogQHBhcmFtIHtBcnJheX0gcmVscyBBcnJheSB3aXRoIHJlbGF0aXZlIHBvc2l0aW9ucy5cblx0XHQgKiBAcmV0dXJuIHtTdHJpbmd9IEJlc3Qgc3VpdGFibGUgcmVsYXRpdmUgcG9zaXRpb24uXG5cdFx0ICovXG5cdFx0dGVzdE1vdmVSZWw6IGZ1bmN0aW9uKGVsbSwgcmVscykge1xuXHRcdFx0dmFyIHZpZXdQb3J0UmVjdCA9IERvbVV0aWxzLmdldFZpZXdQb3J0KCk7XG5cblx0XHRcdGZvciAodmFyIGkgPSAwOyBpIDwgcmVscy5sZW5ndGg7IGkrKykge1xuXHRcdFx0XHR2YXIgcG9zID0gY2FsY3VsYXRlUmVsYXRpdmVQb3NpdGlvbih0aGlzLCBlbG0sIHJlbHNbaV0pO1xuXG5cdFx0XHRcdGlmICh0aGlzLnN0YXRlLmdldCgnZml4ZWQnKSkge1xuXHRcdFx0XHRcdGlmIChwb3MueCA+IDAgJiYgcG9zLnggKyBwb3MudyA8IHZpZXdQb3J0UmVjdC53ICYmIHBvcy55ID4gMCAmJiBwb3MueSArIHBvcy5oIDwgdmlld1BvcnRSZWN0LmgpIHtcblx0XHRcdFx0XHRcdHJldHVybiByZWxzW2ldO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRpZiAocG9zLnggPiB2aWV3UG9ydFJlY3QueCAmJiBwb3MueCArIHBvcy53IDwgdmlld1BvcnRSZWN0LncgKyB2aWV3UG9ydFJlY3QueCAmJlxuXHRcdFx0XHRcdFx0cG9zLnkgPiB2aWV3UG9ydFJlY3QueSAmJiBwb3MueSArIHBvcy5oIDwgdmlld1BvcnRSZWN0LmggKyB2aWV3UG9ydFJlY3QueSkge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHJlbHNbaV07XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiByZWxzWzBdO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBNb3ZlIHJlbGF0aXZlIHRvIHRoZSBzcGVjaWZpZWQgZWxlbWVudC5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgbW92ZVJlbFxuXHRcdCAqIEBwYXJhbSB7RWxlbWVudH0gZWxtIEVsZW1lbnQgdG8gbW92ZSByZWxhdGl2ZSB0by5cblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gcmVsIFJlbGF0aXZlIG1vZGUuIEZvciBleGFtcGxlOiBici10bC5cblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLnVpLkNvbnRyb2x9IEN1cnJlbnQgY29udHJvbCBpbnN0YW5jZS5cblx0XHQgKi9cblx0XHRtb3ZlUmVsOiBmdW5jdGlvbihlbG0sIHJlbCkge1xuXHRcdFx0aWYgKHR5cGVvZiByZWwgIT0gJ3N0cmluZycpIHtcblx0XHRcdFx0cmVsID0gdGhpcy50ZXN0TW92ZVJlbChlbG0sIHJlbCk7XG5cdFx0XHR9XG5cblx0XHRcdHZhciBwb3MgPSBjYWxjdWxhdGVSZWxhdGl2ZVBvc2l0aW9uKHRoaXMsIGVsbSwgcmVsKTtcblx0XHRcdHJldHVybiB0aGlzLm1vdmVUbyhwb3MueCwgcG9zLnkpO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBNb3ZlIGJ5IGEgcmVsYXRpdmUgeCwgeSB2YWx1ZXMuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIG1vdmVCeVxuXHRcdCAqIEBwYXJhbSB7TnVtYmVyfSBkeCBSZWxhdGl2ZSB4IHBvc2l0aW9uLlxuXHRcdCAqIEBwYXJhbSB7TnVtYmVyfSBkeSBSZWxhdGl2ZSB5IHBvc2l0aW9uLlxuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UudWkuQ29udHJvbH0gQ3VycmVudCBjb250cm9sIGluc3RhbmNlLlxuXHRcdCAqL1xuXHRcdG1vdmVCeTogZnVuY3Rpb24oZHgsIGR5KSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIHJlY3QgPSBzZWxmLmxheW91dFJlY3QoKTtcblxuXHRcdFx0c2VsZi5tb3ZlVG8ocmVjdC54ICsgZHgsIHJlY3QueSArIGR5KTtcblxuXHRcdFx0cmV0dXJuIHNlbGY7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIE1vdmUgdG8gYWJzb2x1dGUgcG9zaXRpb24uXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIG1vdmVUb1xuXHRcdCAqIEBwYXJhbSB7TnVtYmVyfSB4IEFic29sdXRlIHggcG9zaXRpb24uXG5cdFx0ICogQHBhcmFtIHtOdW1iZXJ9IHkgQWJzb2x1dGUgeSBwb3NpdGlvbi5cblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLnVpLkNvbnRyb2x9IEN1cnJlbnQgY29udHJvbCBpbnN0YW5jZS5cblx0XHQgKi9cblx0XHRtb3ZlVG86IGZ1bmN0aW9uKHgsIHkpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0Ly8gVE9ETzogTW92ZSB0aGlzIHRvIHNvbWUgZ2xvYmFsIGNsYXNzXG5cdFx0XHRmdW5jdGlvbiBjb25zdHJhaW4odmFsdWUsIG1heCwgc2l6ZSkge1xuXHRcdFx0XHRpZiAodmFsdWUgPCAwKSB7XG5cdFx0XHRcdFx0cmV0dXJuIDA7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodmFsdWUgKyBzaXplID4gbWF4KSB7XG5cdFx0XHRcdFx0dmFsdWUgPSBtYXggLSBzaXplO1xuXHRcdFx0XHRcdHJldHVybiB2YWx1ZSA8IDAgPyAwIDogdmFsdWU7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChzZWxmLnNldHRpbmdzLmNvbnN0cmFpblRvVmlld3BvcnQpIHtcblx0XHRcdFx0dmFyIHZpZXdQb3J0UmVjdCA9IERvbVV0aWxzLmdldFZpZXdQb3J0KHdpbmRvdyk7XG5cdFx0XHRcdHZhciBsYXlvdXRSZWN0ID0gc2VsZi5sYXlvdXRSZWN0KCk7XG5cblx0XHRcdFx0eCA9IGNvbnN0cmFpbih4LCB2aWV3UG9ydFJlY3QudyArIHZpZXdQb3J0UmVjdC54LCBsYXlvdXRSZWN0LncpO1xuXHRcdFx0XHR5ID0gY29uc3RyYWluKHksIHZpZXdQb3J0UmVjdC5oICsgdmlld1BvcnRSZWN0LnksIGxheW91dFJlY3QuaCk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChzZWxmLnN0YXRlLmdldCgncmVuZGVyZWQnKSkge1xuXHRcdFx0XHRzZWxmLmxheW91dFJlY3Qoe3g6IHgsIHk6IHl9KS5yZXBhaW50KCk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRzZWxmLnNldHRpbmdzLnggPSB4O1xuXHRcdFx0XHRzZWxmLnNldHRpbmdzLnkgPSB5O1xuXHRcdFx0fVxuXG5cdFx0XHRzZWxmLmZpcmUoJ21vdmUnLCB7eDogeCwgeTogeX0pO1xuXG5cdFx0XHRyZXR1cm4gc2VsZjtcblx0XHR9XG5cdH07XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL3VpL1Jlc2l6YWJsZS5qc1xuXG4vKipcbiAqIFJlc2l6YWJsZS5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE1IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKipcbiAqIFJlc2l6YWJsZSBtaXhpbi4gRW5hYmxlcyBjb250cm9scyB0byBiZSByZXNpemVkLlxuICpcbiAqIEBtaXhpbiB0aW55bWNlLnVpLlJlc2l6YWJsZVxuICovXG5kZWZpbmUoXCJ0aW55bWNlL3VpL1Jlc2l6YWJsZVwiLCBbXG5cdFwidGlueW1jZS91aS9Eb21VdGlsc1wiXG5dLCBmdW5jdGlvbihEb21VdGlscykge1xuXHRcInVzZSBzdHJpY3RcIjtcblxuXHRyZXR1cm4ge1xuXHRcdC8qKlxuXHRcdCAqIFJlc2l6ZXMgdGhlIGNvbnRyb2wgdG8gY29udGVudHMuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHJlc2l6ZVRvQ29udGVudFxuXHRcdCAqL1xuXHRcdHJlc2l6ZVRvQ29udGVudDogZnVuY3Rpb24oKSB7XG5cdFx0XHR0aGlzLl9sYXlvdXRSZWN0LmF1dG9SZXNpemUgPSB0cnVlO1xuXHRcdFx0dGhpcy5fbGFzdFJlY3QgPSBudWxsO1xuXHRcdFx0dGhpcy5yZWZsb3coKTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmVzaXplcyB0aGUgY29udHJvbCB0byBhIHNwZWNpZmljIHdpZHRoL2hlaWdodC5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgcmVzaXplVG9cblx0XHQgKiBAcGFyYW0ge051bWJlcn0gdyBDb250cm9sIHdpZHRoLlxuXHRcdCAqIEBwYXJhbSB7TnVtYmVyfSBoIENvbnRyb2wgaGVpZ2h0LlxuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UudWkuQ29udHJvbH0gQ3VycmVudCBjb250cm9sIGluc3RhbmNlLlxuXHRcdCAqL1xuXHRcdHJlc2l6ZVRvOiBmdW5jdGlvbih3LCBoKSB7XG5cdFx0XHQvLyBUT0RPOiBGaXggaGFja1xuXHRcdFx0aWYgKHcgPD0gMSB8fCBoIDw9IDEpIHtcblx0XHRcdFx0dmFyIHJlY3QgPSBEb21VdGlscy5nZXRXaW5kb3dTaXplKCk7XG5cblx0XHRcdFx0dyA9IHcgPD0gMSA/IHcgKiByZWN0LncgOiB3O1xuXHRcdFx0XHRoID0gaCA8PSAxID8gaCAqIHJlY3QuaCA6IGg7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMuX2xheW91dFJlY3QuYXV0b1Jlc2l6ZSA9IGZhbHNlO1xuXHRcdFx0cmV0dXJuIHRoaXMubGF5b3V0UmVjdCh7bWluVzogdywgbWluSDogaCwgdzogdywgaDogaH0pLnJlZmxvdygpO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZXNpemVzIHRoZSBjb250cm9sIHRvIGEgc3BlY2lmaWMgcmVsYXRpdmUgd2lkdGgvaGVpZ2h0LlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCByZXNpemVCeVxuXHRcdCAqIEBwYXJhbSB7TnVtYmVyfSBkdyBSZWxhdGl2ZSBjb250cm9sIHdpZHRoLlxuXHRcdCAqIEBwYXJhbSB7TnVtYmVyfSBkaCBSZWxhdGl2ZSBjb250cm9sIGhlaWdodC5cblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLnVpLkNvbnRyb2x9IEN1cnJlbnQgY29udHJvbCBpbnN0YW5jZS5cblx0XHQgKi9cblx0XHRyZXNpemVCeTogZnVuY3Rpb24oZHcsIGRoKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIHJlY3QgPSBzZWxmLmxheW91dFJlY3QoKTtcblxuXHRcdFx0cmV0dXJuIHNlbGYucmVzaXplVG8ocmVjdC53ICsgZHcsIHJlY3QuaCArIGRoKTtcblx0XHR9XG5cdH07XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL3VpL0Zsb2F0UGFuZWwuanNcblxuLyoqXG4gKiBGbG9hdFBhbmVsLmpzXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgTEdQTCBMaWNlbnNlLlxuICogQ29weXJpZ2h0IChjKSAxOTk5LTIwMTUgRXBob3ggQ29ycC4gQWxsIHJpZ2h0cyByZXNlcnZlZFxuICpcbiAqIExpY2Vuc2U6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vbGljZW5zZVxuICogQ29udHJpYnV0aW5nOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2NvbnRyaWJ1dGluZ1xuICovXG5cbi8qKlxuICogVGhpcyBjbGFzcyBjcmVhdGVzIGEgZmxvYXRpbmcgcGFuZWwuXG4gKlxuICogQC14LWxlc3MgRmxvYXRQYW5lbC5sZXNzXG4gKiBAY2xhc3MgdGlueW1jZS51aS5GbG9hdFBhbmVsXG4gKiBAZXh0ZW5kcyB0aW55bWNlLnVpLlBhbmVsXG4gKiBAbWl4ZXMgdGlueW1jZS51aS5Nb3ZhYmxlXG4gKiBAbWl4ZXMgdGlueW1jZS51aS5SZXNpemFibGVcbiAqL1xuZGVmaW5lKFwidGlueW1jZS91aS9GbG9hdFBhbmVsXCIsIFtcblx0XCJ0aW55bWNlL3VpL1BhbmVsXCIsXG5cdFwidGlueW1jZS91aS9Nb3ZhYmxlXCIsXG5cdFwidGlueW1jZS91aS9SZXNpemFibGVcIixcblx0XCJ0aW55bWNlL3VpL0RvbVV0aWxzXCIsXG5cdFwidGlueW1jZS9kb20vRG9tUXVlcnlcIixcblx0XCJ0aW55bWNlL3V0aWwvRGVsYXlcIlxuXSwgZnVuY3Rpb24oUGFuZWwsIE1vdmFibGUsIFJlc2l6YWJsZSwgRG9tVXRpbHMsICQsIERlbGF5KSB7XG5cdFwidXNlIHN0cmljdFwiO1xuXG5cdHZhciBkb2N1bWVudENsaWNrSGFuZGxlciwgZG9jdW1lbnRTY3JvbGxIYW5kbGVyLCB3aW5kb3dSZXNpemVIYW5kbGVyLCB2aXNpYmxlUGFuZWxzID0gW107XG5cdHZhciB6T3JkZXIgPSBbXSwgaGFzTW9kYWw7XG5cblx0ZnVuY3Rpb24gaXNDaGlsZE9mKGN0cmwsIHBhcmVudCkge1xuXHRcdHdoaWxlIChjdHJsKSB7XG5cdFx0XHRpZiAoY3RybCA9PSBwYXJlbnQpIHtcblx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHR9XG5cblx0XHRcdGN0cmwgPSBjdHJsLnBhcmVudCgpO1xuXHRcdH1cblx0fVxuXG5cdGZ1bmN0aW9uIHNraXBPckhpZGVQYW5lbHMoZSkge1xuXHRcdC8vIEhpZGUgYW55IGZsb2F0IHBhbmVsIHdoZW4gYSBjbGljay9mb2N1cyBvdXQgaXMgb3V0IHNpZGUgdGhhdCBmbG9hdCBwYW5lbCBhbmQgdGhlXG5cdFx0Ly8gZmxvYXQgcGFuZWxzIGRpcmVjdCBwYXJlbnQgZm9yIGV4YW1wbGUgYSBjbGljayBvbiBhIG1lbnUgYnV0dG9uXG5cdFx0dmFyIGkgPSB2aXNpYmxlUGFuZWxzLmxlbmd0aDtcblxuXHRcdHdoaWxlIChpLS0pIHtcblx0XHRcdHZhciBwYW5lbCA9IHZpc2libGVQYW5lbHNbaV0sIGNsaWNrQ3RybCA9IHBhbmVsLmdldFBhcmVudEN0cmwoZS50YXJnZXQpO1xuXG5cdFx0XHRpZiAocGFuZWwuc2V0dGluZ3MuYXV0b2hpZGUpIHtcblx0XHRcdFx0aWYgKGNsaWNrQ3RybCkge1xuXHRcdFx0XHRcdGlmIChpc0NoaWxkT2YoY2xpY2tDdHJsLCBwYW5lbCkgfHwgcGFuZWwucGFyZW50KCkgPT09IGNsaWNrQ3RybCkge1xuXHRcdFx0XHRcdFx0Y29udGludWU7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0ZSA9IHBhbmVsLmZpcmUoJ2F1dG9oaWRlJywge3RhcmdldDogZS50YXJnZXR9KTtcblx0XHRcdFx0aWYgKCFlLmlzRGVmYXVsdFByZXZlbnRlZCgpKSB7XG5cdFx0XHRcdFx0cGFuZWwuaGlkZSgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0ZnVuY3Rpb24gYmluZERvY3VtZW50Q2xpY2tIYW5kbGVyKCkge1xuXG5cdFx0aWYgKCFkb2N1bWVudENsaWNrSGFuZGxlcikge1xuXHRcdFx0ZG9jdW1lbnRDbGlja0hhbmRsZXIgPSBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdC8vIEdlY2tvIGZpcmVzIGNsaWNrIGV2ZW50IGFuZCBpbiB0aGUgd3Jvbmcgb3JkZXIgb24gTWFjIHNvIGxldHMgbm9ybWFsaXplXG5cdFx0XHRcdGlmIChlLmJ1dHRvbiA9PSAyKSB7XG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0c2tpcE9ySGlkZVBhbmVscyhlKTtcblx0XHRcdH07XG5cblx0XHRcdCQoZG9jdW1lbnQpLm9uKCdjbGljayB0b3VjaHN0YXJ0JywgZG9jdW1lbnRDbGlja0hhbmRsZXIpO1xuXHRcdH1cblx0fVxuXG5cdGZ1bmN0aW9uIGJpbmREb2N1bWVudFNjcm9sbEhhbmRsZXIoKSB7XG5cdFx0aWYgKCFkb2N1bWVudFNjcm9sbEhhbmRsZXIpIHtcblx0XHRcdGRvY3VtZW50U2Nyb2xsSGFuZGxlciA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR2YXIgaTtcblxuXHRcdFx0XHRpID0gdmlzaWJsZVBhbmVscy5sZW5ndGg7XG5cdFx0XHRcdHdoaWxlIChpLS0pIHtcblx0XHRcdFx0XHRyZXBvc2l0aW9uUGFuZWwodmlzaWJsZVBhbmVsc1tpXSk7XG5cdFx0XHRcdH1cblx0XHRcdH07XG5cblx0XHRcdCQod2luZG93KS5vbignc2Nyb2xsJywgZG9jdW1lbnRTY3JvbGxIYW5kbGVyKTtcblx0XHR9XG5cdH1cblxuXHRmdW5jdGlvbiBiaW5kV2luZG93UmVzaXplSGFuZGxlcigpIHtcblx0XHRpZiAoIXdpbmRvd1Jlc2l6ZUhhbmRsZXIpIHtcblx0XHRcdHZhciBkb2NFbG0gPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsIGNsaWVudFdpZHRoID0gZG9jRWxtLmNsaWVudFdpZHRoLCBjbGllbnRIZWlnaHQgPSBkb2NFbG0uY2xpZW50SGVpZ2h0O1xuXG5cdFx0XHR3aW5kb3dSZXNpemVIYW5kbGVyID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRcdC8vIFdvcmthcm91bmQgZm9yICM3MDY1IElFIDcgZmlyZXMgcmVzaXplIGV2ZW50cyBldmVudCB0aG91Z2ggdGhlIHdpbmRvdyB3YXNuJ3QgcmVzaXplZFxuXHRcdFx0XHRpZiAoIWRvY3VtZW50LmFsbCB8fCBjbGllbnRXaWR0aCAhPSBkb2NFbG0uY2xpZW50V2lkdGggfHwgY2xpZW50SGVpZ2h0ICE9IGRvY0VsbS5jbGllbnRIZWlnaHQpIHtcblx0XHRcdFx0XHRjbGllbnRXaWR0aCA9IGRvY0VsbS5jbGllbnRXaWR0aDtcblx0XHRcdFx0XHRjbGllbnRIZWlnaHQgPSBkb2NFbG0uY2xpZW50SGVpZ2h0O1xuXHRcdFx0XHRcdEZsb2F0UGFuZWwuaGlkZUFsbCgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9O1xuXG5cdFx0XHQkKHdpbmRvdykub24oJ3Jlc2l6ZScsIHdpbmRvd1Jlc2l6ZUhhbmRsZXIpO1xuXHRcdH1cblx0fVxuXG5cdC8qKlxuXHQgKiBSZXBvc2l0aW9ucyB0aGUgcGFuZWwgdG8gdGhlIHRvcCBvZiBwYWdlIGlmIHRoZSBwYW5lbCBpcyBvdXRzaWRlIG9mIHRoZSB2aXN1YWwgdmlld3BvcnQuIEl0IHdpbGxcblx0ICogYWxzbyByZXBvc2l0aW9uIGFsbCBjaGlsZCBwYW5lbHMgb2YgdGhlIGN1cnJlbnQgcGFuZWwuXG5cdCAqL1xuXHRmdW5jdGlvbiByZXBvc2l0aW9uUGFuZWwocGFuZWwpIHtcblx0XHR2YXIgc2Nyb2xsWSA9IERvbVV0aWxzLmdldFZpZXdQb3J0KCkueTtcblxuXHRcdGZ1bmN0aW9uIHRvZ2dsZUZpeGVkQ2hpbGRQYW5lbHMoZml4ZWQsIGRlbHRhWSkge1xuXHRcdFx0dmFyIHBhcmVudDtcblxuXHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCB2aXNpYmxlUGFuZWxzLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRcdGlmICh2aXNpYmxlUGFuZWxzW2ldICE9IHBhbmVsKSB7XG5cdFx0XHRcdFx0cGFyZW50ID0gdmlzaWJsZVBhbmVsc1tpXS5wYXJlbnQoKTtcblxuXHRcdFx0XHRcdHdoaWxlIChwYXJlbnQgJiYgKHBhcmVudCA9IHBhcmVudC5wYXJlbnQoKSkpIHtcblx0XHRcdFx0XHRcdGlmIChwYXJlbnQgPT0gcGFuZWwpIHtcblx0XHRcdFx0XHRcdFx0dmlzaWJsZVBhbmVsc1tpXS5maXhlZChmaXhlZCkubW92ZUJ5KDAsIGRlbHRhWSkucmVwYWludCgpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmIChwYW5lbC5zZXR0aW5ncy5hdXRvZml4KSB7XG5cdFx0XHRpZiAoIXBhbmVsLnN0YXRlLmdldCgnZml4ZWQnKSkge1xuXHRcdFx0XHRwYW5lbC5fYXV0b0ZpeFkgPSBwYW5lbC5sYXlvdXRSZWN0KCkueTtcblxuXHRcdFx0XHRpZiAocGFuZWwuX2F1dG9GaXhZIDwgc2Nyb2xsWSkge1xuXHRcdFx0XHRcdHBhbmVsLmZpeGVkKHRydWUpLmxheW91dFJlY3Qoe3k6IDB9KS5yZXBhaW50KCk7XG5cdFx0XHRcdFx0dG9nZ2xlRml4ZWRDaGlsZFBhbmVscyh0cnVlLCBzY3JvbGxZIC0gcGFuZWwuX2F1dG9GaXhZKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0aWYgKHBhbmVsLl9hdXRvRml4WSA+IHNjcm9sbFkpIHtcblx0XHRcdFx0XHRwYW5lbC5maXhlZChmYWxzZSkubGF5b3V0UmVjdCh7eTogcGFuZWwuX2F1dG9GaXhZfSkucmVwYWludCgpO1xuXHRcdFx0XHRcdHRvZ2dsZUZpeGVkQ2hpbGRQYW5lbHMoZmFsc2UsIHBhbmVsLl9hdXRvRml4WSAtIHNjcm9sbFkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0ZnVuY3Rpb24gYWRkUmVtb3ZlKGFkZCwgY3RybCkge1xuXHRcdHZhciBpLCB6SW5kZXggPSBGbG9hdFBhbmVsLnpJbmRleCB8fCAweEZGRkYsIHRvcE1vZGFsO1xuXG5cdFx0aWYgKGFkZCkge1xuXHRcdFx0ek9yZGVyLnB1c2goY3RybCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGkgPSB6T3JkZXIubGVuZ3RoO1xuXG5cdFx0XHR3aGlsZSAoaS0tKSB7XG5cdFx0XHRcdGlmICh6T3JkZXJbaV0gPT09IGN0cmwpIHtcblx0XHRcdFx0XHR6T3JkZXIuc3BsaWNlKGksIDEpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHpPcmRlci5sZW5ndGgpIHtcblx0XHRcdGZvciAoaSA9IDA7IGkgPCB6T3JkZXIubGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0aWYgKHpPcmRlcltpXS5tb2RhbCkge1xuXHRcdFx0XHRcdHpJbmRleCsrO1xuXHRcdFx0XHRcdHRvcE1vZGFsID0gek9yZGVyW2ldO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0ek9yZGVyW2ldLmdldEVsKCkuc3R5bGUuekluZGV4ID0gekluZGV4O1xuXHRcdFx0XHR6T3JkZXJbaV0uekluZGV4ID0gekluZGV4O1xuXHRcdFx0XHR6SW5kZXgrKztcblx0XHRcdH1cblx0XHR9XG5cblx0XHR2YXIgbW9kYWxCbG9ja0VsID0gJCgnIycgKyBjdHJsLmNsYXNzUHJlZml4ICsgJ21vZGFsLWJsb2NrJywgY3RybC5nZXRDb250YWluZXJFbG0oKSlbMF07XG5cblx0XHRpZiAodG9wTW9kYWwpIHtcblx0XHRcdCQobW9kYWxCbG9ja0VsKS5jc3MoJ3otaW5kZXgnLCB0b3BNb2RhbC56SW5kZXggLSAxKTtcblx0XHR9IGVsc2UgaWYgKG1vZGFsQmxvY2tFbCkge1xuXHRcdFx0bW9kYWxCbG9ja0VsLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobW9kYWxCbG9ja0VsKTtcblx0XHRcdGhhc01vZGFsID0gZmFsc2U7XG5cdFx0fVxuXG5cdFx0RmxvYXRQYW5lbC5jdXJyZW50WkluZGV4ID0gekluZGV4O1xuXHR9XG5cblx0dmFyIEZsb2F0UGFuZWwgPSBQYW5lbC5leHRlbmQoe1xuXHRcdE1peGluczogW01vdmFibGUsIFJlc2l6YWJsZV0sXG5cblx0XHQvKipcblx0XHQgKiBDb25zdHJ1Y3RzIGEgbmV3IGNvbnRyb2wgaW5zdGFuY2Ugd2l0aCB0aGUgc3BlY2lmaWVkIHNldHRpbmdzLlxuXHRcdCAqXG5cdFx0ICogQGNvbnN0cnVjdG9yXG5cdFx0ICogQHBhcmFtIHtPYmplY3R9IHNldHRpbmdzIE5hbWUvdmFsdWUgb2JqZWN0IHdpdGggc2V0dGluZ3MuXG5cdFx0ICogQHNldHRpbmcge0Jvb2xlYW59IGF1dG9oaWRlIEF1dG9tYXRpY2FsbHkgaGlkZSB0aGUgcGFuZWwuXG5cdFx0ICovXG5cdFx0aW5pdDogZnVuY3Rpb24oc2V0dGluZ3MpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0c2VsZi5fc3VwZXIoc2V0dGluZ3MpO1xuXHRcdFx0c2VsZi5fZXZlbnRzUm9vdCA9IHNlbGY7XG5cblx0XHRcdHNlbGYuY2xhc3Nlcy5hZGQoJ2Zsb2F0cGFuZWwnKTtcblxuXHRcdFx0Ly8gSGlkZSBmbG9hdHBhbmVzIG9uIGNsaWNrIG91dCBzaWRlIHRoZSByb290IGJ1dHRvblxuXHRcdFx0aWYgKHNldHRpbmdzLmF1dG9oaWRlKSB7XG5cdFx0XHRcdGJpbmREb2N1bWVudENsaWNrSGFuZGxlcigpO1xuXHRcdFx0XHRiaW5kV2luZG93UmVzaXplSGFuZGxlcigpO1xuXHRcdFx0XHR2aXNpYmxlUGFuZWxzLnB1c2goc2VsZik7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChzZXR0aW5ncy5hdXRvZml4KSB7XG5cdFx0XHRcdGJpbmREb2N1bWVudFNjcm9sbEhhbmRsZXIoKTtcblxuXHRcdFx0XHRzZWxmLm9uKCdtb3ZlJywgZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0cmVwb3NpdGlvblBhbmVsKHRoaXMpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0c2VsZi5vbigncG9zdHJlbmRlciBzaG93JywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRpZiAoZS5jb250cm9sID09IHNlbGYpIHtcblx0XHRcdFx0XHR2YXIgJG1vZGFsQmxvY2tFbCwgcHJlZml4ID0gc2VsZi5jbGFzc1ByZWZpeDtcblxuXHRcdFx0XHRcdGlmIChzZWxmLm1vZGFsICYmICFoYXNNb2RhbCkge1xuXHRcdFx0XHRcdFx0JG1vZGFsQmxvY2tFbCA9ICQoJyMnICsgcHJlZml4ICsgJ21vZGFsLWJsb2NrJywgc2VsZi5nZXRDb250YWluZXJFbG0oKSk7XG5cdFx0XHRcdFx0XHRpZiAoISRtb2RhbEJsb2NrRWxbMF0pIHtcblx0XHRcdFx0XHRcdFx0JG1vZGFsQmxvY2tFbCA9ICQoXG5cdFx0XHRcdFx0XHRcdFx0JzxkaXYgaWQ9XCInICsgcHJlZml4ICsgJ21vZGFsLWJsb2NrXCIgY2xhc3M9XCInICsgcHJlZml4ICsgJ3Jlc2V0ICcgKyBwcmVmaXggKyAnZmFkZVwiPjwvZGl2Pidcblx0XHRcdFx0XHRcdFx0KS5hcHBlbmRUbyhzZWxmLmdldENvbnRhaW5lckVsbSgpKTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0RGVsYXkuc2V0VGltZW91dChmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRcdFx0JG1vZGFsQmxvY2tFbC5hZGRDbGFzcyhwcmVmaXggKyAnaW4nKTtcblx0XHRcdFx0XHRcdFx0JChzZWxmLmdldEVsKCkpLmFkZENsYXNzKHByZWZpeCArICdpbicpO1xuXHRcdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRcdGhhc01vZGFsID0gdHJ1ZTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRhZGRSZW1vdmUodHJ1ZSwgc2VsZik7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRzZWxmLm9uKCdzaG93JywgZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHNlbGYucGFyZW50cygpLmVhY2goZnVuY3Rpb24oY3RybCkge1xuXHRcdFx0XHRcdGlmIChjdHJsLnN0YXRlLmdldCgnZml4ZWQnKSkge1xuXHRcdFx0XHRcdFx0c2VsZi5maXhlZCh0cnVlKTtcblx0XHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSk7XG5cblx0XHRcdGlmIChzZXR0aW5ncy5wb3BvdmVyKSB7XG5cdFx0XHRcdHNlbGYuX3ByZUJvZHlIdG1sID0gJzxkaXYgY2xhc3M9XCInICsgc2VsZi5jbGFzc1ByZWZpeCArICdhcnJvd1wiPjwvZGl2Pic7XG5cdFx0XHRcdHNlbGYuY2xhc3Nlcy5hZGQoJ3BvcG92ZXInKS5hZGQoJ2JvdHRvbScpLmFkZChzZWxmLmlzUnRsKCkgPyAnZW5kJyA6ICdzdGFydCcpO1xuXHRcdFx0fVxuXG5cdFx0XHRzZWxmLmFyaWEoJ2xhYmVsJywgc2V0dGluZ3MuYXJpYUxhYmVsKTtcblx0XHRcdHNlbGYuYXJpYSgnbGFiZWxsZWRieScsIHNlbGYuX2lkKTtcblx0XHRcdHNlbGYuYXJpYSgnZGVzY3JpYmVkYnknLCBzZWxmLmRlc2NyaWJlZEJ5IHx8IHNlbGYuX2lkICsgJy1ub25lJyk7XG5cdFx0fSxcblxuXHRcdGZpeGVkOiBmdW5jdGlvbihzdGF0ZSkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHRpZiAoc2VsZi5zdGF0ZS5nZXQoJ2ZpeGVkJykgIT0gc3RhdGUpIHtcblx0XHRcdFx0aWYgKHNlbGYuc3RhdGUuZ2V0KCdyZW5kZXJlZCcpKSB7XG5cdFx0XHRcdFx0dmFyIHZpZXdwb3J0ID0gRG9tVXRpbHMuZ2V0Vmlld1BvcnQoKTtcblxuXHRcdFx0XHRcdGlmIChzdGF0ZSkge1xuXHRcdFx0XHRcdFx0c2VsZi5sYXlvdXRSZWN0KCkueSAtPSB2aWV3cG9ydC55O1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRzZWxmLmxheW91dFJlY3QoKS55ICs9IHZpZXdwb3J0Lnk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0c2VsZi5jbGFzc2VzLnRvZ2dsZSgnZml4ZWQnLCBzdGF0ZSk7XG5cdFx0XHRcdHNlbGYuc3RhdGUuc2V0KCdmaXhlZCcsIHN0YXRlKTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHNlbGY7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFNob3dzIHRoZSBjdXJyZW50IGZsb2F0IHBhbmVsLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBzaG93XG5cdFx0ICogQHJldHVybiB7dGlueW1jZS51aS5GbG9hdFBhbmVsfSBDdXJyZW50IGZsb2F0cGFuZWwgaW5zdGFuY2UuXG5cdFx0ICovXG5cdFx0c2hvdzogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIGksIHN0YXRlID0gc2VsZi5fc3VwZXIoKTtcblxuXHRcdFx0aSA9IHZpc2libGVQYW5lbHMubGVuZ3RoO1xuXHRcdFx0d2hpbGUgKGktLSkge1xuXHRcdFx0XHRpZiAodmlzaWJsZVBhbmVsc1tpXSA9PT0gc2VsZikge1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmIChpID09PSAtMSkge1xuXHRcdFx0XHR2aXNpYmxlUGFuZWxzLnB1c2goc2VsZik7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBzdGF0ZTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogSGlkZXMgdGhlIGN1cnJlbnQgZmxvYXQgcGFuZWwuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGhpZGVcblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLnVpLkZsb2F0UGFuZWx9IEN1cnJlbnQgZmxvYXRwYW5lbCBpbnN0YW5jZS5cblx0XHQgKi9cblx0XHRoaWRlOiBmdW5jdGlvbigpIHtcblx0XHRcdHJlbW92ZVZpc2libGVQYW5lbCh0aGlzKTtcblx0XHRcdGFkZFJlbW92ZShmYWxzZSwgdGhpcyk7XG5cblx0XHRcdHJldHVybiB0aGlzLl9zdXBlcigpO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBIaWRlIGFsbCB2aXNpYmxlIGZsb2F0IHBhbmVscyB3aXRoIGhlIGF1dG9oaWRlIHNldHRpbmcgZW5hYmxlZC4gVGhpcyBpcyBmb3Jcblx0XHQgKiBtYW51YWxseSBoaWRpbmcgZmxvYXRpbmcgbWVudXMgb3IgcGFuZWxzLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBoaWRlQWxsXG5cdFx0ICovXG5cdFx0aGlkZUFsbDogZnVuY3Rpb24oKSB7XG5cdFx0XHRGbG9hdFBhbmVsLmhpZGVBbGwoKTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogQ2xvc2VzIHRoZSBmbG9hdCBwYW5lbC4gVGhpcyB3aWxsIHJlbW92ZSB0aGUgZmxvYXQgcGFuZWwgZnJvbSBwYWdlIGFuZCBmaXJlIHRoZSBjbG9zZSBldmVudC5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgY2xvc2Vcblx0XHQgKi9cblx0XHRjbG9zZTogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdGlmICghc2VsZi5maXJlKCdjbG9zZScpLmlzRGVmYXVsdFByZXZlbnRlZCgpKSB7XG5cdFx0XHRcdHNlbGYucmVtb3ZlKCk7XG5cdFx0XHRcdGFkZFJlbW92ZShmYWxzZSwgc2VsZik7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBzZWxmO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZW1vdmVzIHRoZSBmbG9hdCBwYW5lbCBmcm9tIHBhZ2UuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHJlbW92ZVxuXHRcdCAqL1xuXHRcdHJlbW92ZTogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZW1vdmVWaXNpYmxlUGFuZWwodGhpcyk7XG5cdFx0XHR0aGlzLl9zdXBlcigpO1xuXHRcdH0sXG5cblx0XHRwb3N0UmVuZGVyOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0aWYgKHNlbGYuc2V0dGluZ3MuYm9keVJvbGUpIHtcblx0XHRcdFx0dGhpcy5nZXRFbCgnYm9keScpLnNldEF0dHJpYnV0ZSgncm9sZScsIHNlbGYuc2V0dGluZ3MuYm9keVJvbGUpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gc2VsZi5fc3VwZXIoKTtcblx0XHR9XG5cdH0pO1xuXG5cdC8qKlxuXHQgKiBIaWRlIGFsbCB2aXNpYmxlIGZsb2F0IHBhbmVscyB3aXRoIGhlIGF1dG9oaWRlIHNldHRpbmcgZW5hYmxlZC4gVGhpcyBpcyBmb3Jcblx0ICogbWFudWFsbHkgaGlkaW5nIGZsb2F0aW5nIG1lbnVzIG9yIHBhbmVscy5cblx0ICpcblx0ICogQHN0YXRpY1xuXHQgKiBAbWV0aG9kIGhpZGVBbGxcblx0ICovXG5cdEZsb2F0UGFuZWwuaGlkZUFsbCA9IGZ1bmN0aW9uKCkge1xuXHRcdHZhciBpID0gdmlzaWJsZVBhbmVscy5sZW5ndGg7XG5cblx0XHR3aGlsZSAoaS0tKSB7XG5cdFx0XHR2YXIgcGFuZWwgPSB2aXNpYmxlUGFuZWxzW2ldO1xuXG5cdFx0XHRpZiAocGFuZWwgJiYgcGFuZWwuc2V0dGluZ3MuYXV0b2hpZGUpIHtcblx0XHRcdFx0cGFuZWwuaGlkZSgpO1xuXHRcdFx0XHR2aXNpYmxlUGFuZWxzLnNwbGljZShpLCAxKTtcblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0ZnVuY3Rpb24gcmVtb3ZlVmlzaWJsZVBhbmVsKHBhbmVsKSB7XG5cdFx0dmFyIGk7XG5cblx0XHRpID0gdmlzaWJsZVBhbmVscy5sZW5ndGg7XG5cdFx0d2hpbGUgKGktLSkge1xuXHRcdFx0aWYgKHZpc2libGVQYW5lbHNbaV0gPT09IHBhbmVsKSB7XG5cdFx0XHRcdHZpc2libGVQYW5lbHMuc3BsaWNlKGksIDEpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGkgPSB6T3JkZXIubGVuZ3RoO1xuXHRcdHdoaWxlIChpLS0pIHtcblx0XHRcdGlmICh6T3JkZXJbaV0gPT09IHBhbmVsKSB7XG5cdFx0XHRcdHpPcmRlci5zcGxpY2UoaSwgMSk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0cmV0dXJuIEZsb2F0UGFuZWw7XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL3VpL1dpbmRvdy5qc1xuXG4vKipcbiAqIFdpbmRvdy5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE1IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKipcbiAqIENyZWF0ZXMgYSBuZXcgd2luZG93LlxuICpcbiAqIEAteC1sZXNzIFdpbmRvdy5sZXNzXG4gKiBAY2xhc3MgdGlueW1jZS51aS5XaW5kb3dcbiAqIEBleHRlbmRzIHRpbnltY2UudWkuRmxvYXRQYW5lbFxuICovXG5kZWZpbmUoXCJ0aW55bWNlL3VpL1dpbmRvd1wiLCBbXG5cdFwidGlueW1jZS91aS9GbG9hdFBhbmVsXCIsXG5cdFwidGlueW1jZS91aS9QYW5lbFwiLFxuXHRcInRpbnltY2UvdWkvRG9tVXRpbHNcIixcblx0XCJ0aW55bWNlL2RvbS9Eb21RdWVyeVwiLFxuXHRcInRpbnltY2UvdWkvRHJhZ0hlbHBlclwiLFxuXHRcInRpbnltY2UvdWkvQm94VXRpbHNcIixcblx0XCJ0aW55bWNlL0VudlwiLFxuXHRcInRpbnltY2UvdXRpbC9EZWxheVwiXG5dLCBmdW5jdGlvbihGbG9hdFBhbmVsLCBQYW5lbCwgRG9tVXRpbHMsICQsIERyYWdIZWxwZXIsIEJveFV0aWxzLCBFbnYsIERlbGF5KSB7XG5cdFwidXNlIHN0cmljdFwiO1xuXG5cdHZhciB3aW5kb3dzID0gW10sIG9sZE1ldGFWYWx1ZSA9ICcnO1xuXG5cdGZ1bmN0aW9uIHRvZ2dsZUZ1bGxTY3JlZW5TdGF0ZShzdGF0ZSkge1xuXHRcdHZhciBub1NjYWxlTWV0YVZhbHVlID0gJ3dpZHRoPWRldmljZS13aWR0aCxpbml0aWFsLXNjYWxlPTEuMCx1c2VyLXNjYWxhYmxlPTAsbWluaW11bS1zY2FsZT0xLjAsbWF4aW11bS1zY2FsZT0xLjAnLFxuXHRcdFx0dmlld3BvcnQgPSAkKFwibWV0YVtuYW1lPXZpZXdwb3J0XVwiKVswXSxcblx0XHRcdGNvbnRlbnRWYWx1ZTtcblxuXHRcdGlmIChFbnYub3ZlcnJpZGVWaWV3UG9ydCA9PT0gZmFsc2UpIHtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHRpZiAoIXZpZXdwb3J0KSB7XG5cdFx0XHR2aWV3cG9ydCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ21ldGEnKTtcblx0XHRcdHZpZXdwb3J0LnNldEF0dHJpYnV0ZSgnbmFtZScsICd2aWV3cG9ydCcpO1xuXHRcdFx0ZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2hlYWQnKVswXS5hcHBlbmRDaGlsZCh2aWV3cG9ydCk7XG5cdFx0fVxuXG5cdFx0Y29udGVudFZhbHVlID0gdmlld3BvcnQuZ2V0QXR0cmlidXRlKCdjb250ZW50Jyk7XG5cdFx0aWYgKGNvbnRlbnRWYWx1ZSAmJiB0eXBlb2Ygb2xkTWV0YVZhbHVlICE9ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRvbGRNZXRhVmFsdWUgPSBjb250ZW50VmFsdWU7XG5cdFx0fVxuXG5cdFx0dmlld3BvcnQuc2V0QXR0cmlidXRlKCdjb250ZW50Jywgc3RhdGUgPyBub1NjYWxlTWV0YVZhbHVlIDogb2xkTWV0YVZhbHVlKTtcblx0fVxuXG5cdGZ1bmN0aW9uIHRvZ2dsZUJvZHlGdWxsU2NyZWVuQ2xhc3NlcyhjbGFzc1ByZWZpeCwgc3RhdGUpIHtcblx0XHRpZiAoY2hlY2tGdWxsc2NyZWVuV2luZG93cygpICYmIHN0YXRlID09PSBmYWxzZSkge1xuXHRcdFx0JChbZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LCBkb2N1bWVudC5ib2R5XSkucmVtb3ZlQ2xhc3MoY2xhc3NQcmVmaXggKyAnZnVsbHNjcmVlbicpO1xuXHRcdH1cblx0fVxuXG5cdGZ1bmN0aW9uIGNoZWNrRnVsbHNjcmVlbldpbmRvd3MoKSB7XG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCB3aW5kb3dzLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRpZiAod2luZG93c1tpXS5fZnVsbHNjcmVlbikge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9XG5cblx0ZnVuY3Rpb24gaGFuZGxlV2luZG93UmVzaXplKCkge1xuXHRcdGlmICghRW52LmRlc2t0b3ApIHtcblx0XHRcdHZhciBsYXN0U2l6ZSA9IHtcblx0XHRcdFx0dzogd2luZG93LmlubmVyV2lkdGgsXG5cdFx0XHRcdGg6IHdpbmRvdy5pbm5lckhlaWdodFxuXHRcdFx0fTtcblxuXHRcdFx0RGVsYXkuc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHZhciB3ID0gd2luZG93LmlubmVyV2lkdGgsXG5cdFx0XHRcdFx0aCA9IHdpbmRvdy5pbm5lckhlaWdodDtcblxuXHRcdFx0XHRpZiAobGFzdFNpemUudyAhPSB3IHx8IGxhc3RTaXplLmggIT0gaCkge1xuXHRcdFx0XHRcdGxhc3RTaXplID0ge1xuXHRcdFx0XHRcdFx0dzogdyxcblx0XHRcdFx0XHRcdGg6IGhcblx0XHRcdFx0XHR9O1xuXG5cdFx0XHRcdFx0JCh3aW5kb3cpLnRyaWdnZXIoJ3Jlc2l6ZScpO1xuXHRcdFx0XHR9XG5cdFx0XHR9LCAxMDApO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIHJlcG9zaXRpb24oKSB7XG5cdFx0XHR2YXIgaSwgcmVjdCA9IERvbVV0aWxzLmdldFdpbmRvd1NpemUoKSwgbGF5b3V0UmVjdDtcblxuXHRcdFx0Zm9yIChpID0gMDsgaSA8IHdpbmRvd3MubGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0bGF5b3V0UmVjdCA9IHdpbmRvd3NbaV0ubGF5b3V0UmVjdCgpO1xuXG5cdFx0XHRcdHdpbmRvd3NbaV0ubW92ZVRvKFxuXHRcdFx0XHRcdHdpbmRvd3NbaV0uc2V0dGluZ3MueCB8fCBNYXRoLm1heCgwLCByZWN0LncgLyAyIC0gbGF5b3V0UmVjdC53IC8gMiksXG5cdFx0XHRcdFx0d2luZG93c1tpXS5zZXR0aW5ncy55IHx8IE1hdGgubWF4KDAsIHJlY3QuaCAvIDIgLSBsYXlvdXRSZWN0LmggLyAyKVxuXHRcdFx0XHQpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdCQod2luZG93KS5vbigncmVzaXplJywgcmVwb3NpdGlvbik7XG5cdH1cblxuXHR2YXIgV2luZG93ID0gRmxvYXRQYW5lbC5leHRlbmQoe1xuXHRcdG1vZGFsOiB0cnVlLFxuXG5cdFx0RGVmYXVsdHM6IHtcblx0XHRcdGJvcmRlcjogMSxcblx0XHRcdGxheW91dDogJ2ZsZXgnLFxuXHRcdFx0Y29udGFpbmVyQ2xzOiAncGFuZWwnLFxuXHRcdFx0cm9sZTogJ2RpYWxvZycsXG5cdFx0XHRjYWxsYmFja3M6IHtcblx0XHRcdFx0c3VibWl0OiBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHR0aGlzLmZpcmUoJ3N1Ym1pdCcsIHtkYXRhOiB0aGlzLnRvSlNPTigpfSk7XG5cdFx0XHRcdH0sXG5cblx0XHRcdFx0Y2xvc2U6IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdHRoaXMuY2xvc2UoKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBDb25zdHJ1Y3RzIGEgaW5zdGFuY2Ugd2l0aCB0aGUgc3BlY2lmaWVkIHNldHRpbmdzLlxuXHRcdCAqXG5cdFx0ICogQGNvbnN0cnVjdG9yXG5cdFx0ICogQHBhcmFtIHtPYmplY3R9IHNldHRpbmdzIE5hbWUvdmFsdWUgb2JqZWN0IHdpdGggc2V0dGluZ3MuXG5cdFx0ICovXG5cdFx0aW5pdDogZnVuY3Rpb24oc2V0dGluZ3MpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0c2VsZi5fc3VwZXIoc2V0dGluZ3MpO1xuXG5cdFx0XHRpZiAoc2VsZi5pc1J0bCgpKSB7XG5cdFx0XHRcdHNlbGYuY2xhc3Nlcy5hZGQoJ3J0bCcpO1xuXHRcdFx0fVxuXG5cdFx0XHRzZWxmLmNsYXNzZXMuYWRkKCd3aW5kb3cnKTtcblx0XHRcdHNlbGYuYm9keUNsYXNzZXMuYWRkKCd3aW5kb3ctYm9keScpO1xuXHRcdFx0c2VsZi5zdGF0ZS5zZXQoJ2ZpeGVkJywgdHJ1ZSk7XG5cblx0XHRcdC8vIENyZWF0ZSBzdGF0dXNiYXJcblx0XHRcdGlmIChzZXR0aW5ncy5idXR0b25zKSB7XG5cdFx0XHRcdHNlbGYuc3RhdHVzYmFyID0gbmV3IFBhbmVsKHtcblx0XHRcdFx0XHRsYXlvdXQ6ICdmbGV4Jyxcblx0XHRcdFx0XHRib3JkZXI6ICcxIDAgMCAwJyxcblx0XHRcdFx0XHRzcGFjaW5nOiAzLFxuXHRcdFx0XHRcdHBhZGRpbmc6IDEwLFxuXHRcdFx0XHRcdGFsaWduOiAnY2VudGVyJyxcblx0XHRcdFx0XHRwYWNrOiBzZWxmLmlzUnRsKCkgPyAnc3RhcnQnIDogJ2VuZCcsXG5cdFx0XHRcdFx0ZGVmYXVsdHM6IHtcblx0XHRcdFx0XHRcdHR5cGU6ICdidXR0b24nXG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRpdGVtczogc2V0dGluZ3MuYnV0dG9uc1xuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHRzZWxmLnN0YXR1c2Jhci5jbGFzc2VzLmFkZCgnZm9vdCcpO1xuXHRcdFx0XHRzZWxmLnN0YXR1c2Jhci5wYXJlbnQoc2VsZik7XG5cdFx0XHR9XG5cblx0XHRcdHNlbGYub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHR2YXIgY2xvc2VDbGFzcyA9IHNlbGYuY2xhc3NQcmVmaXggKyAnY2xvc2UnO1xuXG5cdFx0XHRcdGlmIChEb21VdGlscy5oYXNDbGFzcyhlLnRhcmdldCwgY2xvc2VDbGFzcykgfHwgRG9tVXRpbHMuaGFzQ2xhc3MoZS50YXJnZXQucGFyZW50Tm9kZSwgY2xvc2VDbGFzcykpIHtcblx0XHRcdFx0XHRzZWxmLmNsb3NlKCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRzZWxmLm9uKCdjYW5jZWwnLCBmdW5jdGlvbigpIHtcblx0XHRcdFx0c2VsZi5jbG9zZSgpO1xuXHRcdFx0fSk7XG5cblx0XHRcdHNlbGYuYXJpYSgnZGVzY3JpYmVkYnknLCBzZWxmLmRlc2NyaWJlZEJ5IHx8IHNlbGYuX2lkICsgJy1ub25lJyk7XG5cdFx0XHRzZWxmLmFyaWEoJ2xhYmVsJywgc2V0dGluZ3MudGl0bGUpO1xuXHRcdFx0c2VsZi5fZnVsbHNjcmVlbiA9IGZhbHNlO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZWNhbGN1bGF0ZXMgdGhlIHBvc2l0aW9ucyBvZiB0aGUgY29udHJvbHMgaW4gdGhlIGN1cnJlbnQgY29udGFpbmVyLlxuXHRcdCAqIFRoaXMgaXMgaW52b2tlZCBieSB0aGUgcmVmbG93IG1ldGhvZCBhbmQgc2hvdWxkbid0IGJlIGNhbGxlZCBkaXJlY3RseS5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgcmVjYWxjXG5cdFx0ICovXG5cdFx0cmVjYWxjOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgc3RhdHVzYmFyID0gc2VsZi5zdGF0dXNiYXIsIGxheW91dFJlY3QsIHdpZHRoLCB4LCBuZWVkc1JlY2FsYztcblxuXHRcdFx0aWYgKHNlbGYuX2Z1bGxzY3JlZW4pIHtcblx0XHRcdFx0c2VsZi5sYXlvdXRSZWN0KERvbVV0aWxzLmdldFdpbmRvd1NpemUoKSk7XG5cdFx0XHRcdHNlbGYubGF5b3V0UmVjdCgpLmNvbnRlbnRIID0gc2VsZi5sYXlvdXRSZWN0KCkuaW5uZXJIO1xuXHRcdFx0fVxuXG5cdFx0XHRzZWxmLl9zdXBlcigpO1xuXG5cdFx0XHRsYXlvdXRSZWN0ID0gc2VsZi5sYXlvdXRSZWN0KCk7XG5cblx0XHRcdC8vIFJlc2l6ZSB3aW5kb3cgYmFzZWQgb24gdGl0bGUgd2lkdGhcblx0XHRcdGlmIChzZWxmLnNldHRpbmdzLnRpdGxlICYmICFzZWxmLl9mdWxsc2NyZWVuKSB7XG5cdFx0XHRcdHdpZHRoID0gbGF5b3V0UmVjdC5oZWFkZXJXO1xuXHRcdFx0XHRpZiAod2lkdGggPiBsYXlvdXRSZWN0LncpIHtcblx0XHRcdFx0XHR4ID0gbGF5b3V0UmVjdC54IC0gTWF0aC5tYXgoMCwgd2lkdGggLyAyKTtcblx0XHRcdFx0XHRzZWxmLmxheW91dFJlY3Qoe3c6IHdpZHRoLCB4OiB4fSk7XG5cdFx0XHRcdFx0bmVlZHNSZWNhbGMgPSB0cnVlO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdC8vIFJlc2l6ZSB3aW5kb3cgYmFzZWQgb24gc3RhdHVzYmFyIHdpZHRoXG5cdFx0XHRpZiAoc3RhdHVzYmFyKSB7XG5cdFx0XHRcdHN0YXR1c2Jhci5sYXlvdXRSZWN0KHt3OiBzZWxmLmxheW91dFJlY3QoKS5pbm5lcld9KS5yZWNhbGMoKTtcblxuXHRcdFx0XHR3aWR0aCA9IHN0YXR1c2Jhci5sYXlvdXRSZWN0KCkubWluVyArIGxheW91dFJlY3QuZGVsdGFXO1xuXHRcdFx0XHRpZiAod2lkdGggPiBsYXlvdXRSZWN0LncpIHtcblx0XHRcdFx0XHR4ID0gbGF5b3V0UmVjdC54IC0gTWF0aC5tYXgoMCwgd2lkdGggLSBsYXlvdXRSZWN0LncpO1xuXHRcdFx0XHRcdHNlbGYubGF5b3V0UmVjdCh7dzogd2lkdGgsIHg6IHh9KTtcblx0XHRcdFx0XHRuZWVkc1JlY2FsYyA9IHRydWU7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0Ly8gUmVjYWxjIGJvZHkgYW5kIGRpc2FibGUgYXV0byByZXNpemVcblx0XHRcdGlmIChuZWVkc1JlY2FsYykge1xuXHRcdFx0XHRzZWxmLnJlY2FsYygpO1xuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBJbml0aWFsaXplcyB0aGUgY3VycmVudCBjb250cm9scyBsYXlvdXQgcmVjdC5cblx0XHQgKiBUaGlzIHdpbGwgYmUgZXhlY3V0ZWQgYnkgdGhlIGxheW91dCBtYW5hZ2VycyB0byBkZXRlcm1pbmUgdGhlXG5cdFx0ICogZGVmYXVsdCBtaW5XaWR0aC9taW5IZWlnaHQgZXRjLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBpbml0TGF5b3V0UmVjdFxuXHRcdCAqIEByZXR1cm4ge09iamVjdH0gTGF5b3V0IHJlY3QgaW5zdGFuY2UuXG5cdFx0ICovXG5cdFx0aW5pdExheW91dFJlY3Q6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLCBsYXlvdXRSZWN0ID0gc2VsZi5fc3VwZXIoKSwgZGVsdGFIID0gMCwgaGVhZEVsO1xuXG5cdFx0XHQvLyBSZXNlcnZlIHZlcnRpY2FsIHNwYWNlIGZvciB0aXRsZVxuXHRcdFx0aWYgKHNlbGYuc2V0dGluZ3MudGl0bGUgJiYgIXNlbGYuX2Z1bGxzY3JlZW4pIHtcblx0XHRcdFx0aGVhZEVsID0gc2VsZi5nZXRFbCgnaGVhZCcpO1xuXG5cdFx0XHRcdHZhciBzaXplID0gRG9tVXRpbHMuZ2V0U2l6ZShoZWFkRWwpO1xuXG5cdFx0XHRcdGxheW91dFJlY3QuaGVhZGVyVyA9IHNpemUud2lkdGg7XG5cdFx0XHRcdGxheW91dFJlY3QuaGVhZGVySCA9IHNpemUuaGVpZ2h0O1xuXG5cdFx0XHRcdGRlbHRhSCArPSBsYXlvdXRSZWN0LmhlYWRlckg7XG5cdFx0XHR9XG5cblx0XHRcdC8vIFJlc2VydmUgdmVydGljYWwgc3BhY2UgZm9yIHN0YXR1c2JhclxuXHRcdFx0aWYgKHNlbGYuc3RhdHVzYmFyKSB7XG5cdFx0XHRcdGRlbHRhSCArPSBzZWxmLnN0YXR1c2Jhci5sYXlvdXRSZWN0KCkuaDtcblx0XHRcdH1cblxuXHRcdFx0bGF5b3V0UmVjdC5kZWx0YUggKz0gZGVsdGFIO1xuXHRcdFx0bGF5b3V0UmVjdC5taW5IICs9IGRlbHRhSDtcblx0XHRcdC8vbGF5b3V0UmVjdC5pbm5lckggLT0gZGVsdGFIO1xuXHRcdFx0bGF5b3V0UmVjdC5oICs9IGRlbHRhSDtcblxuXHRcdFx0dmFyIHJlY3QgPSBEb21VdGlscy5nZXRXaW5kb3dTaXplKCk7XG5cblx0XHRcdGxheW91dFJlY3QueCA9IHNlbGYuc2V0dGluZ3MueCB8fCBNYXRoLm1heCgwLCByZWN0LncgLyAyIC0gbGF5b3V0UmVjdC53IC8gMik7XG5cdFx0XHRsYXlvdXRSZWN0LnkgPSBzZWxmLnNldHRpbmdzLnkgfHwgTWF0aC5tYXgoMCwgcmVjdC5oIC8gMiAtIGxheW91dFJlY3QuaCAvIDIpO1xuXG5cdFx0XHRyZXR1cm4gbGF5b3V0UmVjdDtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmVuZGVycyB0aGUgY29udHJvbCBhcyBhIEhUTUwgc3RyaW5nLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCByZW5kZXJIdG1sXG5cdFx0ICogQHJldHVybiB7U3RyaW5nfSBIVE1MIHJlcHJlc2VudGluZyB0aGUgY29udHJvbC5cblx0XHQgKi9cblx0XHRyZW5kZXJIdG1sOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgbGF5b3V0ID0gc2VsZi5fbGF5b3V0LCBpZCA9IHNlbGYuX2lkLCBwcmVmaXggPSBzZWxmLmNsYXNzUHJlZml4O1xuXHRcdFx0dmFyIHNldHRpbmdzID0gc2VsZi5zZXR0aW5ncywgaGVhZGVySHRtbCA9ICcnLCBmb290ZXJIdG1sID0gJycsIGh0bWwgPSBzZXR0aW5ncy5odG1sO1xuXG5cdFx0XHRzZWxmLnByZVJlbmRlcigpO1xuXHRcdFx0bGF5b3V0LnByZVJlbmRlcihzZWxmKTtcblxuXHRcdFx0aWYgKHNldHRpbmdzLnRpdGxlKSB7XG5cdFx0XHRcdGhlYWRlckh0bWwgPSAoXG5cdFx0XHRcdFx0JzxkaXYgaWQ9XCInICsgaWQgKyAnLWhlYWRcIiBjbGFzcz1cIicgKyBwcmVmaXggKyAnd2luZG93LWhlYWRcIj4nICtcblx0XHRcdFx0XHRcdCc8ZGl2IGlkPVwiJyArIGlkICsgJy10aXRsZVwiIGNsYXNzPVwiJyArIHByZWZpeCArICd0aXRsZVwiPicgKyBzZWxmLmVuY29kZShzZXR0aW5ncy50aXRsZSkgKyAnPC9kaXY+JyArXG5cdFx0XHRcdFx0XHQnPGRpdiBpZD1cIicgKyBpZCArICctZHJhZ2hcIiBjbGFzcz1cIicgKyBwcmVmaXggKyAnZHJhZ2hcIj48L2Rpdj4nICtcblx0XHRcdFx0XHRcdCc8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBjbGFzcz1cIicgKyBwcmVmaXggKyAnY2xvc2VcIiBhcmlhLWhpZGRlbj1cInRydWVcIj4nICtcblx0XHRcdFx0XHRcdFx0JzxpIGNsYXNzPVwibWNlLWljbyBtY2UtaS1yZW1vdmVcIj48L2k+JyArXG5cdFx0XHRcdFx0XHQnPC9idXR0b24+JyArXG5cdFx0XHRcdFx0JzwvZGl2Pidcblx0XHRcdFx0KTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHNldHRpbmdzLnVybCkge1xuXHRcdFx0XHRodG1sID0gJzxpZnJhbWUgc3JjPVwiJyArIHNldHRpbmdzLnVybCArICdcIiB0YWJpbmRleD1cIi0xXCI+PC9pZnJhbWU+Jztcblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZiBodG1sID09IFwidW5kZWZpbmVkXCIpIHtcblx0XHRcdFx0aHRtbCA9IGxheW91dC5yZW5kZXJIdG1sKHNlbGYpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoc2VsZi5zdGF0dXNiYXIpIHtcblx0XHRcdFx0Zm9vdGVySHRtbCA9IHNlbGYuc3RhdHVzYmFyLnJlbmRlckh0bWwoKTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIChcblx0XHRcdFx0JzxkaXYgaWQ9XCInICsgaWQgKyAnXCIgY2xhc3M9XCInICsgc2VsZi5jbGFzc2VzICsgJ1wiIGhpZGVmb2N1cz1cIjFcIj4nICtcblx0XHRcdFx0XHQnPGRpdiBjbGFzcz1cIicgKyBzZWxmLmNsYXNzUHJlZml4ICsgJ3Jlc2V0XCIgcm9sZT1cImFwcGxpY2F0aW9uXCI+JyArXG5cdFx0XHRcdFx0XHRoZWFkZXJIdG1sICtcblx0XHRcdFx0XHRcdCc8ZGl2IGlkPVwiJyArIGlkICsgJy1ib2R5XCIgY2xhc3M9XCInICsgc2VsZi5ib2R5Q2xhc3NlcyArICdcIj4nICtcblx0XHRcdFx0XHRcdFx0aHRtbCArXG5cdFx0XHRcdFx0XHQnPC9kaXY+JyArXG5cdFx0XHRcdFx0XHRmb290ZXJIdG1sICtcblx0XHRcdFx0XHQnPC9kaXY+JyArXG5cdFx0XHRcdCc8L2Rpdj4nXG5cdFx0XHQpO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBTd2l0Y2hlcyB0aGUgd2luZG93IGZ1bGxzY3JlZW4gbW9kZS5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgZnVsbHNjcmVlblxuXHRcdCAqIEBwYXJhbSB7Qm9vbGVhbn0gc3RhdGUgVHJ1ZS9mYWxzZSBzdGF0ZS5cblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLnVpLldpbmRvd30gQ3VycmVudCB3aW5kb3cgaW5zdGFuY2UuXG5cdFx0ICovXG5cdFx0ZnVsbHNjcmVlbjogZnVuY3Rpb24oc3RhdGUpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgZG9jdW1lbnRFbGVtZW50ID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LCBzbG93UmVuZGVyaW5nLCBwcmVmaXggPSBzZWxmLmNsYXNzUHJlZml4LCBsYXlvdXRSZWN0O1xuXG5cdFx0XHRpZiAoc3RhdGUgIT0gc2VsZi5fZnVsbHNjcmVlbikge1xuXHRcdFx0XHQkKHdpbmRvdykub24oJ3Jlc2l6ZScsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdHZhciB0aW1lO1xuXG5cdFx0XHRcdFx0aWYgKHNlbGYuX2Z1bGxzY3JlZW4pIHtcblx0XHRcdFx0XHRcdC8vIFRpbWUgdGhlIGxheW91dCB0aW1lIGlmIGl0J3MgdG8gc2xvdyB1c2UgYSB0aW1lb3V0IHRvIG5vdCBob2cgdGhlIENQVVxuXHRcdFx0XHRcdFx0aWYgKCFzbG93UmVuZGVyaW5nKSB7XG5cdFx0XHRcdFx0XHRcdHRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcblxuXHRcdFx0XHRcdFx0XHR2YXIgcmVjdCA9IERvbVV0aWxzLmdldFdpbmRvd1NpemUoKTtcblx0XHRcdFx0XHRcdFx0c2VsZi5tb3ZlVG8oMCwgMCkucmVzaXplVG8ocmVjdC53LCByZWN0LmgpO1xuXG5cdFx0XHRcdFx0XHRcdGlmICgobmV3IERhdGUoKS5nZXRUaW1lKCkpIC0gdGltZSA+IDUwKSB7XG5cdFx0XHRcdFx0XHRcdFx0c2xvd1JlbmRlcmluZyA9IHRydWU7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdGlmICghc2VsZi5fdGltZXIpIHtcblx0XHRcdFx0XHRcdFx0XHRzZWxmLl90aW1lciA9IERlbGF5LnNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHR2YXIgcmVjdCA9IERvbVV0aWxzLmdldFdpbmRvd1NpemUoKTtcblx0XHRcdFx0XHRcdFx0XHRcdHNlbGYubW92ZVRvKDAsIDApLnJlc2l6ZVRvKHJlY3QudywgcmVjdC5oKTtcblxuXHRcdFx0XHRcdFx0XHRcdFx0c2VsZi5fdGltZXIgPSAwO1xuXHRcdFx0XHRcdFx0XHRcdH0sIDUwKTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0bGF5b3V0UmVjdCA9IHNlbGYubGF5b3V0UmVjdCgpO1xuXHRcdFx0XHRzZWxmLl9mdWxsc2NyZWVuID0gc3RhdGU7XG5cblx0XHRcdFx0aWYgKCFzdGF0ZSkge1xuXHRcdFx0XHRcdHNlbGYuYm9yZGVyQm94ID0gQm94VXRpbHMucGFyc2VCb3goc2VsZi5zZXR0aW5ncy5ib3JkZXIpO1xuXHRcdFx0XHRcdHNlbGYuZ2V0RWwoJ2hlYWQnKS5zdHlsZS5kaXNwbGF5ID0gJyc7XG5cdFx0XHRcdFx0bGF5b3V0UmVjdC5kZWx0YUggKz0gbGF5b3V0UmVjdC5oZWFkZXJIO1xuXHRcdFx0XHRcdCQoW2RvY3VtZW50RWxlbWVudCwgZG9jdW1lbnQuYm9keV0pLnJlbW92ZUNsYXNzKHByZWZpeCArICdmdWxsc2NyZWVuJyk7XG5cdFx0XHRcdFx0c2VsZi5jbGFzc2VzLnJlbW92ZSgnZnVsbHNjcmVlbicpO1xuXHRcdFx0XHRcdHNlbGYubW92ZVRvKHNlbGYuX2luaXRpYWwueCwgc2VsZi5faW5pdGlhbC55KS5yZXNpemVUbyhzZWxmLl9pbml0aWFsLncsIHNlbGYuX2luaXRpYWwuaCk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0c2VsZi5faW5pdGlhbCA9IHt4OiBsYXlvdXRSZWN0LngsIHk6IGxheW91dFJlY3QueSwgdzogbGF5b3V0UmVjdC53LCBoOiBsYXlvdXRSZWN0Lmh9O1xuXG5cdFx0XHRcdFx0c2VsZi5ib3JkZXJCb3ggPSBCb3hVdGlscy5wYXJzZUJveCgnMCcpO1xuXHRcdFx0XHRcdHNlbGYuZ2V0RWwoJ2hlYWQnKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuXHRcdFx0XHRcdGxheW91dFJlY3QuZGVsdGFIIC09IGxheW91dFJlY3QuaGVhZGVySCArIDI7XG5cdFx0XHRcdFx0JChbZG9jdW1lbnRFbGVtZW50LCBkb2N1bWVudC5ib2R5XSkuYWRkQ2xhc3MocHJlZml4ICsgJ2Z1bGxzY3JlZW4nKTtcblx0XHRcdFx0XHRzZWxmLmNsYXNzZXMuYWRkKCdmdWxsc2NyZWVuJyk7XG5cblx0XHRcdFx0XHR2YXIgcmVjdCA9IERvbVV0aWxzLmdldFdpbmRvd1NpemUoKTtcblx0XHRcdFx0XHRzZWxmLm1vdmVUbygwLCAwKS5yZXNpemVUbyhyZWN0LncsIHJlY3QuaCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHNlbGYucmVmbG93KCk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIENhbGxlZCBhZnRlciB0aGUgY29udHJvbCBoYXMgYmVlbiByZW5kZXJlZC5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgcG9zdFJlbmRlclxuXHRcdCAqL1xuXHRcdHBvc3RSZW5kZXI6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLCBzdGFydFBvcztcblxuXHRcdFx0c2V0VGltZW91dChmdW5jdGlvbigpIHtcblx0XHRcdFx0c2VsZi5jbGFzc2VzLmFkZCgnaW4nKTtcblx0XHRcdFx0c2VsZi5maXJlKCdvcGVuJyk7XG5cdFx0XHR9LCAwKTtcblxuXHRcdFx0c2VsZi5fc3VwZXIoKTtcblxuXHRcdFx0aWYgKHNlbGYuc3RhdHVzYmFyKSB7XG5cdFx0XHRcdHNlbGYuc3RhdHVzYmFyLnBvc3RSZW5kZXIoKTtcblx0XHRcdH1cblxuXHRcdFx0c2VsZi5mb2N1cygpO1xuXG5cdFx0XHR0aGlzLmRyYWdIZWxwZXIgPSBuZXcgRHJhZ0hlbHBlcihzZWxmLl9pZCArICctZHJhZ2gnLCB7XG5cdFx0XHRcdHN0YXJ0OiBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRzdGFydFBvcyA9IHtcblx0XHRcdFx0XHRcdHg6IHNlbGYubGF5b3V0UmVjdCgpLngsXG5cdFx0XHRcdFx0XHR5OiBzZWxmLmxheW91dFJlY3QoKS55XG5cdFx0XHRcdFx0fTtcblx0XHRcdFx0fSxcblxuXHRcdFx0XHRkcmFnOiBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdFx0c2VsZi5tb3ZlVG8oc3RhcnRQb3MueCArIGUuZGVsdGFYLCBzdGFydFBvcy55ICsgZS5kZWx0YVkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0c2VsZi5vbignc3VibWl0JywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRpZiAoIWUuaXNEZWZhdWx0UHJldmVudGVkKCkpIHtcblx0XHRcdFx0XHRzZWxmLmNsb3NlKCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHR3aW5kb3dzLnB1c2goc2VsZik7XG5cdFx0XHR0b2dnbGVGdWxsU2NyZWVuU3RhdGUodHJ1ZSk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIEZpcmVzIGEgc3VibWl0IGV2ZW50IHdpdGggdGhlIHNlcmlhbGl6ZWQgZm9ybS5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2Qgc3VibWl0XG5cdFx0ICogQHJldHVybiB7T2JqZWN0fSBFdmVudCBhcmd1bWVudHMgb2JqZWN0LlxuXHRcdCAqL1xuXHRcdHN1Ym1pdDogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5maXJlKCdzdWJtaXQnLCB7ZGF0YTogdGhpcy50b0pTT04oKX0pO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZW1vdmVzIHRoZSBjdXJyZW50IGNvbnRyb2wgZnJvbSBET00gYW5kIGZyb20gVUkgY29sbGVjdGlvbnMuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHJlbW92ZVxuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UudWkuQ29udHJvbH0gQ3VycmVudCBjb250cm9sIGluc3RhbmNlLlxuXHRcdCAqL1xuXHRcdHJlbW92ZTogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIGk7XG5cblx0XHRcdHNlbGYuZHJhZ0hlbHBlci5kZXN0cm95KCk7XG5cdFx0XHRzZWxmLl9zdXBlcigpO1xuXG5cdFx0XHRpZiAoc2VsZi5zdGF0dXNiYXIpIHtcblx0XHRcdFx0dGhpcy5zdGF0dXNiYXIucmVtb3ZlKCk7XG5cdFx0XHR9XG5cblx0XHRcdHRvZ2dsZUJvZHlGdWxsU2NyZWVuQ2xhc3NlcyhzZWxmLmNsYXNzUHJlZml4LCBmYWxzZSk7XG5cblx0XHRcdGkgPSB3aW5kb3dzLmxlbmd0aDtcblx0XHRcdHdoaWxlIChpLS0pIHtcblx0XHRcdFx0aWYgKHdpbmRvd3NbaV0gPT09IHNlbGYpIHtcblx0XHRcdFx0XHR3aW5kb3dzLnNwbGljZShpLCAxKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHR0b2dnbGVGdWxsU2NyZWVuU3RhdGUod2luZG93cy5sZW5ndGggPiAwKTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyB0aGUgY29udGVudFdpbmRvdyBvYmplY3Qgb2YgdGhlIGlmcmFtZSBpZiBpdCBleGlzdHMuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGdldENvbnRlbnRXaW5kb3dcblx0XHQgKiBAcmV0dXJuIHtXaW5kb3d9IHdpbmRvdyBvYmplY3Qgb3IgbnVsbC5cblx0XHQgKi9cblx0XHRnZXRDb250ZW50V2luZG93OiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBpZnIgPSB0aGlzLmdldEVsKCkuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2lmcmFtZScpWzBdO1xuXHRcdFx0cmV0dXJuIGlmciA/IGlmci5jb250ZW50V2luZG93IDogbnVsbDtcblx0XHR9XG5cdH0pO1xuXG5cdGhhbmRsZVdpbmRvd1Jlc2l6ZSgpO1xuXG5cdHJldHVybiBXaW5kb3c7XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL3VpL01lc3NhZ2VCb3guanNcblxuLyoqXG4gKiBNZXNzYWdlQm94LmpzXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgTEdQTCBMaWNlbnNlLlxuICogQ29weXJpZ2h0IChjKSAxOTk5LTIwMTUgRXBob3ggQ29ycC4gQWxsIHJpZ2h0cyByZXNlcnZlZFxuICpcbiAqIExpY2Vuc2U6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vbGljZW5zZVxuICogQ29udHJpYnV0aW5nOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2NvbnRyaWJ1dGluZ1xuICovXG5cbi8qKlxuICogVGhpcyBjbGFzcyBpcyB1c2VkIHRvIGNyZWF0ZSBNZXNzYWdlQm94ZXMgbGlrZSBhbGVydHMvY29uZmlybXMgZXRjLlxuICpcbiAqIEBjbGFzcyB0aW55bWNlLnVpLk1lc3NhZ2VCb3hcbiAqIEBleHRlbmRzIHRpbnltY2UudWkuRmxvYXRQYW5lbFxuICovXG5kZWZpbmUoXCJ0aW55bWNlL3VpL01lc3NhZ2VCb3hcIiwgW1xuXHRcInRpbnltY2UvdWkvV2luZG93XCJcbl0sIGZ1bmN0aW9uKFdpbmRvdykge1xuXHRcInVzZSBzdHJpY3RcIjtcblxuXHR2YXIgTWVzc2FnZUJveCA9IFdpbmRvdy5leHRlbmQoe1xuXHRcdC8qKlxuXHRcdCAqIENvbnN0cnVjdHMgYSBpbnN0YW5jZSB3aXRoIHRoZSBzcGVjaWZpZWQgc2V0dGluZ3MuXG5cdFx0ICpcblx0XHQgKiBAY29uc3RydWN0b3Jcblx0XHQgKiBAcGFyYW0ge09iamVjdH0gc2V0dGluZ3MgTmFtZS92YWx1ZSBvYmplY3Qgd2l0aCBzZXR0aW5ncy5cblx0XHQgKi9cblx0XHRpbml0OiBmdW5jdGlvbihzZXR0aW5ncykge1xuXHRcdFx0c2V0dGluZ3MgPSB7XG5cdFx0XHRcdGJvcmRlcjogMSxcblx0XHRcdFx0cGFkZGluZzogMjAsXG5cdFx0XHRcdGxheW91dDogJ2ZsZXgnLFxuXHRcdFx0XHRwYWNrOiBcImNlbnRlclwiLFxuXHRcdFx0XHRhbGlnbjogXCJjZW50ZXJcIixcblx0XHRcdFx0Y29udGFpbmVyQ2xzOiAncGFuZWwnLFxuXHRcdFx0XHRhdXRvU2Nyb2xsOiB0cnVlLFxuXHRcdFx0XHRidXR0b25zOiB7dHlwZTogXCJidXR0b25cIiwgdGV4dDogXCJPa1wiLCBhY3Rpb246IFwib2tcIn0sXG5cdFx0XHRcdGl0ZW1zOiB7XG5cdFx0XHRcdFx0dHlwZTogXCJsYWJlbFwiLFxuXHRcdFx0XHRcdG11bHRpbGluZTogdHJ1ZSxcblx0XHRcdFx0XHRtYXhXaWR0aDogNTAwLFxuXHRcdFx0XHRcdG1heEhlaWdodDogMjAwXG5cdFx0XHRcdH1cblx0XHRcdH07XG5cblx0XHRcdHRoaXMuX3N1cGVyKHNldHRpbmdzKTtcblx0XHR9LFxuXG5cdFx0U3RhdGljczoge1xuXHRcdFx0LyoqXG5cdFx0XHQgKiBPayBidXR0b25zIGNvbnN0YW50LlxuXHRcdFx0ICpcblx0XHRcdCAqIEBzdGF0aWNcblx0XHRcdCAqIEBmaW5hbFxuXHRcdFx0ICogQGZpZWxkIHtOdW1iZXJ9IE9LXG5cdFx0XHQgKi9cblx0XHRcdE9LOiAxLFxuXG5cdFx0XHQvKipcblx0XHRcdCAqIE9rL2NhbmNlbCBidXR0b25zIGNvbnN0YW50LlxuXHRcdFx0ICpcblx0XHRcdCAqIEBzdGF0aWNcblx0XHRcdCAqIEBmaW5hbFxuXHRcdFx0ICogQGZpZWxkIHtOdW1iZXJ9IE9LX0NBTkNFTFxuXHRcdFx0ICovXG5cdFx0XHRPS19DQU5DRUw6IDIsXG5cblx0XHRcdC8qKlxuXHRcdFx0ICogeWVzL25vIGJ1dHRvbnMgY29uc3RhbnQuXG5cdFx0XHQgKlxuXHRcdFx0ICogQHN0YXRpY1xuXHRcdFx0ICogQGZpbmFsXG5cdFx0XHQgKiBAZmllbGQge051bWJlcn0gWUVTX05PXG5cdFx0XHQgKi9cblx0XHRcdFlFU19OTzogMyxcblxuXHRcdFx0LyoqXG5cdFx0XHQgKiB5ZXMvbm8vY2FuY2VsIGJ1dHRvbnMgY29uc3RhbnQuXG5cdFx0XHQgKlxuXHRcdFx0ICogQHN0YXRpY1xuXHRcdFx0ICogQGZpbmFsXG5cdFx0XHQgKiBAZmllbGQge051bWJlcn0gWUVTX05PX0NBTkNFTFxuXHRcdFx0ICovXG5cdFx0XHRZRVNfTk9fQ0FOQ0VMOiA0LFxuXG5cdFx0XHQvKipcblx0XHRcdCAqIENvbnN0cnVjdHMgYSBuZXcgbWVzc2FnZSBib3ggYW5kIHJlbmRlcnMgaXQgdG8gdGhlIGJvZHkgZWxlbWVudC5cblx0XHRcdCAqXG5cdFx0XHQgKiBAc3RhdGljXG5cdFx0XHQgKiBAbWV0aG9kIG1zZ0JveFxuXHRcdFx0ICogQHBhcmFtIHtPYmplY3R9IHNldHRpbmdzIE5hbWUvdmFsdWUgb2JqZWN0IHdpdGggc2V0dGluZ3MuXG5cdFx0XHQgKi9cblx0XHRcdG1zZ0JveDogZnVuY3Rpb24oc2V0dGluZ3MpIHtcblx0XHRcdFx0dmFyIGJ1dHRvbnMsIGNhbGxiYWNrID0gc2V0dGluZ3MuY2FsbGJhY2sgfHwgZnVuY3Rpb24oKSB7fTtcblxuXHRcdFx0XHRmdW5jdGlvbiBjcmVhdGVCdXR0b24odGV4dCwgc3RhdHVzLCBwcmltYXJ5KSB7XG5cdFx0XHRcdFx0cmV0dXJuIHtcblx0XHRcdFx0XHRcdHR5cGU6IFwiYnV0dG9uXCIsXG5cdFx0XHRcdFx0XHR0ZXh0OiB0ZXh0LFxuXHRcdFx0XHRcdFx0c3VidHlwZTogcHJpbWFyeSA/ICdwcmltYXJ5JyA6ICcnLFxuXHRcdFx0XHRcdFx0b25DbGljazogZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRcdFx0XHRlLmNvbnRyb2wucGFyZW50cygpWzFdLmNsb3NlKCk7XG5cdFx0XHRcdFx0XHRcdGNhbGxiYWNrKHN0YXR1cyk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHN3aXRjaCAoc2V0dGluZ3MuYnV0dG9ucykge1xuXHRcdFx0XHRcdGNhc2UgTWVzc2FnZUJveC5PS19DQU5DRUw6XG5cdFx0XHRcdFx0XHRidXR0b25zID0gW1xuXHRcdFx0XHRcdFx0XHRjcmVhdGVCdXR0b24oJ09rJywgdHJ1ZSwgdHJ1ZSksXG5cdFx0XHRcdFx0XHRcdGNyZWF0ZUJ1dHRvbignQ2FuY2VsJywgZmFsc2UpXG5cdFx0XHRcdFx0XHRdO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRjYXNlIE1lc3NhZ2VCb3guWUVTX05POlxuXHRcdFx0XHRcdGNhc2UgTWVzc2FnZUJveC5ZRVNfTk9fQ0FOQ0VMOlxuXHRcdFx0XHRcdFx0YnV0dG9ucyA9IFtcblx0XHRcdFx0XHRcdFx0Y3JlYXRlQnV0dG9uKCdZZXMnLCAxLCB0cnVlKSxcblx0XHRcdFx0XHRcdFx0Y3JlYXRlQnV0dG9uKCdObycsIDApXG5cdFx0XHRcdFx0XHRdO1xuXG5cdFx0XHRcdFx0XHRpZiAoc2V0dGluZ3MuYnV0dG9ucyA9PSBNZXNzYWdlQm94LllFU19OT19DQU5DRUwpIHtcblx0XHRcdFx0XHRcdFx0YnV0dG9ucy5wdXNoKGNyZWF0ZUJ1dHRvbignQ2FuY2VsJywgLTEpKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0XHRcdGJ1dHRvbnMgPSBbXG5cdFx0XHRcdFx0XHRcdGNyZWF0ZUJ1dHRvbignT2snLCB0cnVlLCB0cnVlKVxuXHRcdFx0XHRcdFx0XTtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG5ldyBXaW5kb3coe1xuXHRcdFx0XHRcdHBhZGRpbmc6IDIwLFxuXHRcdFx0XHRcdHg6IHNldHRpbmdzLngsXG5cdFx0XHRcdFx0eTogc2V0dGluZ3MueSxcblx0XHRcdFx0XHRtaW5XaWR0aDogMzAwLFxuXHRcdFx0XHRcdG1pbkhlaWdodDogMTAwLFxuXHRcdFx0XHRcdGxheW91dDogXCJmbGV4XCIsXG5cdFx0XHRcdFx0cGFjazogXCJjZW50ZXJcIixcblx0XHRcdFx0XHRhbGlnbjogXCJjZW50ZXJcIixcblx0XHRcdFx0XHRidXR0b25zOiBidXR0b25zLFxuXHRcdFx0XHRcdHRpdGxlOiBzZXR0aW5ncy50aXRsZSxcblx0XHRcdFx0XHRyb2xlOiAnYWxlcnRkaWFsb2cnLFxuXHRcdFx0XHRcdGl0ZW1zOiB7XG5cdFx0XHRcdFx0XHR0eXBlOiBcImxhYmVsXCIsXG5cdFx0XHRcdFx0XHRtdWx0aWxpbmU6IHRydWUsXG5cdFx0XHRcdFx0XHRtYXhXaWR0aDogNTAwLFxuXHRcdFx0XHRcdFx0bWF4SGVpZ2h0OiAyMDAsXG5cdFx0XHRcdFx0XHR0ZXh0OiBzZXR0aW5ncy50ZXh0XG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRvblBvc3RSZW5kZXI6IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdFx0dGhpcy5hcmlhKCdkZXNjcmliZWRieScsIHRoaXMuaXRlbXMoKVswXS5faWQpO1xuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0b25DbG9zZTogc2V0dGluZ3Mub25DbG9zZSxcblx0XHRcdFx0XHRvbkNhbmNlbDogZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0XHRjYWxsYmFjayhmYWxzZSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KS5yZW5kZXJUbyhkb2N1bWVudC5ib2R5KS5yZWZsb3coKTtcblx0XHRcdH0sXG5cblx0XHRcdC8qKlxuXHRcdFx0ICogQ3JlYXRlcyBhIG5ldyBhbGVydCBkaWFsb2cuXG5cdFx0XHQgKlxuXHRcdFx0ICogQG1ldGhvZCBhbGVydFxuXHRcdFx0ICogQHBhcmFtIHtPYmplY3R9IHNldHRpbmdzIFNldHRpbmdzIGZvciB0aGUgYWxlcnQgZGlhbG9nLlxuXHRcdFx0ICogQHBhcmFtIHtmdW5jdGlvbn0gW2NhbGxiYWNrXSBDYWxsYmFjayB0byBleGVjdXRlIHdoZW4gdGhlIHVzZXIgbWFrZXMgYSBjaG9pY2UuXG5cdFx0XHQgKi9cblx0XHRcdGFsZXJ0OiBmdW5jdGlvbihzZXR0aW5ncywgY2FsbGJhY2spIHtcblx0XHRcdFx0aWYgKHR5cGVvZiBzZXR0aW5ncyA9PSBcInN0cmluZ1wiKSB7XG5cdFx0XHRcdFx0c2V0dGluZ3MgPSB7dGV4dDogc2V0dGluZ3N9O1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0c2V0dGluZ3MuY2FsbGJhY2sgPSBjYWxsYmFjaztcblx0XHRcdFx0cmV0dXJuIE1lc3NhZ2VCb3gubXNnQm94KHNldHRpbmdzKTtcblx0XHRcdH0sXG5cblx0XHRcdC8qKlxuXHRcdFx0ICogQ3JlYXRlcyBhIG5ldyBjb25maXJtIGRpYWxvZy5cblx0XHRcdCAqXG5cdFx0XHQgKiBAbWV0aG9kIGNvbmZpcm1cblx0XHRcdCAqIEBwYXJhbSB7T2JqZWN0fSBzZXR0aW5ncyBTZXR0aW5ncyBmb3IgdGhlIGNvbmZpcm0gZGlhbG9nLlxuXHRcdFx0ICogQHBhcmFtIHtmdW5jdGlvbn0gW2NhbGxiYWNrXSBDYWxsYmFjayB0byBleGVjdXRlIHdoZW4gdGhlIHVzZXIgbWFrZXMgYSBjaG9pY2UuXG5cdFx0XHQgKi9cblx0XHRcdGNvbmZpcm06IGZ1bmN0aW9uKHNldHRpbmdzLCBjYWxsYmFjaykge1xuXHRcdFx0XHRpZiAodHlwZW9mIHNldHRpbmdzID09IFwic3RyaW5nXCIpIHtcblx0XHRcdFx0XHRzZXR0aW5ncyA9IHt0ZXh0OiBzZXR0aW5nc307XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRzZXR0aW5ncy5jYWxsYmFjayA9IGNhbGxiYWNrO1xuXHRcdFx0XHRzZXR0aW5ncy5idXR0b25zID0gTWVzc2FnZUJveC5PS19DQU5DRUw7XG5cblx0XHRcdFx0cmV0dXJuIE1lc3NhZ2VCb3gubXNnQm94KHNldHRpbmdzKTtcblx0XHRcdH1cblx0XHR9XG5cdH0pO1xuXG5cdHJldHVybiBNZXNzYWdlQm94O1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy9XaW5kb3dNYW5hZ2VyLmpzXG5cbi8qKlxuICogV2luZG93TWFuYWdlci5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE1IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKipcbiAqIFRoaXMgY2xhc3MgaGFuZGxlcyB0aGUgY3JlYXRpb24gb2YgbmF0aXZlIHdpbmRvd3MgYW5kIGRpYWxvZ3MuIFRoaXMgY2xhc3MgY2FuIGJlIGV4dGVuZGVkIHRvIHByb3ZpZGUgZm9yIGV4YW1wbGUgaW5saW5lIGRpYWxvZ3MuXG4gKlxuICogQGNsYXNzIHRpbnltY2UuV2luZG93TWFuYWdlclxuICogQGV4YW1wbGVcbiAqIC8vIE9wZW5zIGEgbmV3IGRpYWxvZyB3aXRoIHRoZSBmaWxlLmh0bSBmaWxlIGFuZCB0aGUgc2l6ZSAzMjB4MjQwXG4gKiAvLyBJdCBhbHNvIGFkZHMgYSBjdXN0b20gcGFyYW1ldGVyIHRoaXMgY2FuIGJlIHJldHJpZXZlZCBieSB1c2luZyB0aW55TUNFUG9wdXAuZ2V0V2luZG93QXJnIGluc2lkZSB0aGUgZGlhbG9nLlxuICogdGlueW1jZS5hY3RpdmVFZGl0b3Iud2luZG93TWFuYWdlci5vcGVuKHtcbiAqICAgIHVybDogJ2ZpbGUuaHRtJyxcbiAqICAgIHdpZHRoOiAzMjAsXG4gKiAgICBoZWlnaHQ6IDI0MFxuICogfSwge1xuICogICAgY3VzdG9tX3BhcmFtOiAxXG4gKiB9KTtcbiAqXG4gKiAvLyBEaXNwbGF5cyBhbiBhbGVydCBib3ggdXNpbmcgdGhlIGFjdGl2ZSBlZGl0b3JzIHdpbmRvdyBtYW5hZ2VyIGluc3RhbmNlXG4gKiB0aW55bWNlLmFjdGl2ZUVkaXRvci53aW5kb3dNYW5hZ2VyLmFsZXJ0KCdIZWxsbyB3b3JsZCEnKTtcbiAqXG4gKiAvLyBEaXNwbGF5cyBhbiBjb25maXJtIGJveCBhbmQgYW4gYWxlcnQgbWVzc2FnZSB3aWxsIGJlIGRpc3BsYXllZCBkZXBlbmRpbmcgb24gd2hhdCB5b3UgY2hvb3NlIGluIHRoZSBjb25maXJtXG4gKiB0aW55bWNlLmFjdGl2ZUVkaXRvci53aW5kb3dNYW5hZ2VyLmNvbmZpcm0oXCJEbyB5b3Ugd2FudCB0byBkbyBzb21ldGhpbmdcIiwgZnVuY3Rpb24ocykge1xuICogICAgaWYgKHMpXG4gKiAgICAgICB0aW55bWNlLmFjdGl2ZUVkaXRvci53aW5kb3dNYW5hZ2VyLmFsZXJ0KFwiT2tcIik7XG4gKiAgICBlbHNlXG4gKiAgICAgICB0aW55bWNlLmFjdGl2ZUVkaXRvci53aW5kb3dNYW5hZ2VyLmFsZXJ0KFwiQ2FuY2VsXCIpO1xuICogfSk7XG4gKi9cbmRlZmluZShcInRpbnltY2UvV2luZG93TWFuYWdlclwiLCBbXG5cdFwidGlueW1jZS91aS9XaW5kb3dcIixcblx0XCJ0aW55bWNlL3VpL01lc3NhZ2VCb3hcIlxuXSwgZnVuY3Rpb24oV2luZG93LCBNZXNzYWdlQm94KSB7XG5cdHJldHVybiBmdW5jdGlvbihlZGl0b3IpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsIHdpbmRvd3MgPSBbXTtcblxuXHRcdGZ1bmN0aW9uIGdldFRvcE1vc3RXaW5kb3coKSB7XG5cdFx0XHRpZiAod2luZG93cy5sZW5ndGgpIHtcblx0XHRcdFx0cmV0dXJuIHdpbmRvd3Nbd2luZG93cy5sZW5ndGggLSAxXTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRmdW5jdGlvbiBmaXJlT3BlbkV2ZW50KHdpbikge1xuXHRcdFx0ZWRpdG9yLmZpcmUoJ09wZW5XaW5kb3cnLCB7XG5cdFx0XHRcdHdpbjogd2luXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRmdW5jdGlvbiBmaXJlQ2xvc2VFdmVudCh3aW4pIHtcblx0XHRcdGVkaXRvci5maXJlKCdDbG9zZVdpbmRvdycsIHtcblx0XHRcdFx0d2luOiB3aW5cblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdHNlbGYud2luZG93cyA9IHdpbmRvd3M7XG5cblx0XHRlZGl0b3Iub24oJ3JlbW92ZScsIGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIGkgPSB3aW5kb3dzLmxlbmd0aDtcblxuXHRcdFx0d2hpbGUgKGktLSkge1xuXHRcdFx0XHR3aW5kb3dzW2ldLmNsb3NlKCk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHQvKipcblx0XHQgKiBPcGVucyBhIG5ldyB3aW5kb3cuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIG9wZW5cblx0XHQgKiBAcGFyYW0ge09iamVjdH0gYXJncyBPcHRpb25hbCBuYW1lL3ZhbHVlIHNldHRpbmdzIGNvbGxlY3Rpb24gY29udGFpbnMgdGhpbmdzIGxpa2Ugd2lkdGgvaGVpZ2h0L3VybCBldGMuXG5cdFx0ICogQHBhcmFtIHtPYmplY3R9IHBhcmFtcyBPcHRpb25zIGxpa2UgdGl0bGUsIGZpbGUsIHdpZHRoLCBoZWlnaHQgZXRjLlxuXHRcdCAqIEBvcHRpb24ge1N0cmluZ30gdGl0bGUgV2luZG93IHRpdGxlLlxuXHRcdCAqIEBvcHRpb24ge1N0cmluZ30gZmlsZSBVUkwgb2YgdGhlIGZpbGUgdG8gb3BlbiBpbiB0aGUgd2luZG93LlxuXHRcdCAqIEBvcHRpb24ge051bWJlcn0gd2lkdGggV2lkdGggaW4gcGl4ZWxzLlxuXHRcdCAqIEBvcHRpb24ge051bWJlcn0gaGVpZ2h0IEhlaWdodCBpbiBwaXhlbHMuXG5cdFx0ICogQG9wdGlvbiB7Qm9vbGVhbn0gYXV0b1Njcm9sbCBTcGVjaWZpZXMgd2hldGhlciB0aGUgcG9wdXAgd2luZG93IGNhbiBoYXZlIHNjcm9sbGJhcnMgaWYgcmVxdWlyZWQgKGkuZS4gY29udGVudFxuXHRcdCAqIGxhcmdlciB0aGFuIHRoZSBwb3B1cCBzaXplIHNwZWNpZmllZCkuXG5cdFx0ICovXG5cdFx0c2VsZi5vcGVuID0gZnVuY3Rpb24oYXJncywgcGFyYW1zKSB7XG5cdFx0XHR2YXIgd2luO1xuXG5cdFx0XHRlZGl0b3IuZWRpdG9yTWFuYWdlci5zZXRBY3RpdmUoZWRpdG9yKTtcblxuXHRcdFx0YXJncy50aXRsZSA9IGFyZ3MudGl0bGUgfHwgJyAnO1xuXG5cdFx0XHQvLyBIYW5kbGUgVVJMXG5cdFx0XHRhcmdzLnVybCA9IGFyZ3MudXJsIHx8IGFyZ3MuZmlsZTsgLy8gTGVnYWN5XG5cdFx0XHRpZiAoYXJncy51cmwpIHtcblx0XHRcdFx0YXJncy53aWR0aCA9IHBhcnNlSW50KGFyZ3Mud2lkdGggfHwgMzIwLCAxMCk7XG5cdFx0XHRcdGFyZ3MuaGVpZ2h0ID0gcGFyc2VJbnQoYXJncy5oZWlnaHQgfHwgMjQwLCAxMCk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIEhhbmRsZSBib2R5XG5cdFx0XHRpZiAoYXJncy5ib2R5KSB7XG5cdFx0XHRcdGFyZ3MuaXRlbXMgPSB7XG5cdFx0XHRcdFx0ZGVmYXVsdHM6IGFyZ3MuZGVmYXVsdHMsXG5cdFx0XHRcdFx0dHlwZTogYXJncy5ib2R5VHlwZSB8fCAnZm9ybScsXG5cdFx0XHRcdFx0aXRlbXM6IGFyZ3MuYm9keSxcblx0XHRcdFx0XHRkYXRhOiBhcmdzLmRhdGEsXG5cdFx0XHRcdFx0Y2FsbGJhY2tzOiBhcmdzLmNvbW1hbmRzXG5cdFx0XHRcdH07XG5cdFx0XHR9XG5cblx0XHRcdGlmICghYXJncy51cmwgJiYgIWFyZ3MuYnV0dG9ucykge1xuXHRcdFx0XHRhcmdzLmJ1dHRvbnMgPSBbXG5cdFx0XHRcdFx0e3RleHQ6ICdPaycsIHN1YnR5cGU6ICdwcmltYXJ5Jywgb25jbGljazogZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0XHR3aW4uZmluZCgnZm9ybScpWzBdLnN1Ym1pdCgpO1xuXHRcdFx0XHRcdH19LFxuXG5cdFx0XHRcdFx0e3RleHQ6ICdDYW5jZWwnLCBvbmNsaWNrOiBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRcdHdpbi5jbG9zZSgpO1xuXHRcdFx0XHRcdH19XG5cdFx0XHRcdF07XG5cdFx0XHR9XG5cblx0XHRcdHdpbiA9IG5ldyBXaW5kb3coYXJncyk7XG5cdFx0XHR3aW5kb3dzLnB1c2god2luKTtcblxuXHRcdFx0d2luLm9uKCdjbG9zZScsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR2YXIgaSA9IHdpbmRvd3MubGVuZ3RoO1xuXG5cdFx0XHRcdHdoaWxlIChpLS0pIHtcblx0XHRcdFx0XHRpZiAod2luZG93c1tpXSA9PT0gd2luKSB7XG5cdFx0XHRcdFx0XHR3aW5kb3dzLnNwbGljZShpLCAxKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoIXdpbmRvd3MubGVuZ3RoKSB7XG5cdFx0XHRcdFx0ZWRpdG9yLmZvY3VzKCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRmaXJlQ2xvc2VFdmVudCh3aW4pO1xuXHRcdFx0fSk7XG5cblx0XHRcdC8vIEhhbmRsZSBkYXRhXG5cdFx0XHRpZiAoYXJncy5kYXRhKSB7XG5cdFx0XHRcdHdpbi5vbigncG9zdFJlbmRlcicsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdHRoaXMuZmluZCgnKicpLmVhY2goZnVuY3Rpb24oY3RybCkge1xuXHRcdFx0XHRcdFx0dmFyIG5hbWUgPSBjdHJsLm5hbWUoKTtcblxuXHRcdFx0XHRcdFx0aWYgKG5hbWUgaW4gYXJncy5kYXRhKSB7XG5cdFx0XHRcdFx0XHRcdGN0cmwudmFsdWUoYXJncy5kYXRhW25hbWVdKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIHN0b3JlIGFyZ3MgYW5kIHBhcmFtZXRlcnNcblx0XHRcdHdpbi5mZWF0dXJlcyA9IGFyZ3MgfHwge307XG5cdFx0XHR3aW4ucGFyYW1zID0gcGFyYW1zIHx8IHt9O1xuXG5cdFx0XHQvLyBUYWtlcyBhIHNuYXBzaG90IGluIHRoZSBGb2N1c01hbmFnZXIgb2YgdGhlIHNlbGVjdGlvbiBiZWZvcmUgZm9jdXMgaXMgbG9zdCB0byBkaWFsb2dcblx0XHRcdGlmICh3aW5kb3dzLmxlbmd0aCA9PT0gMSkge1xuXHRcdFx0XHRlZGl0b3Iubm9kZUNoYW5nZWQoKTtcblx0XHRcdH1cblxuXHRcdFx0d2luID0gd2luLnJlbmRlclRvKCkucmVmbG93KCk7XG5cblx0XHRcdGZpcmVPcGVuRXZlbnQod2luKTtcblxuXHRcdFx0cmV0dXJuIHdpbjtcblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogQ3JlYXRlcyBhIGFsZXJ0IGRpYWxvZy4gUGxlYXNlIGRvbid0IHVzZSB0aGUgYmxvY2tpbmcgYmVoYXZpb3Igb2YgdGhpc1xuXHRcdCAqIG5hdGl2ZSB2ZXJzaW9uIHVzZSB0aGUgY2FsbGJhY2sgbWV0aG9kIGluc3RlYWQgdGhlbiBpdCBjYW4gYmUgZXh0ZW5kZWQuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGFsZXJ0XG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IG1lc3NhZ2UgVGV4dCB0byBkaXNwbGF5IGluIHRoZSBuZXcgYWxlcnQgZGlhbG9nLlxuXHRcdCAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIGFmdGVyIHRoZSB1c2VyIGhhcyBzZWxlY3RlZCBvay5cblx0XHQgKiBAcGFyYW0ge09iamVjdH0gc2NvcGUgT3B0aW9uYWwgc2NvcGUgdG8gZXhlY3V0ZSB0aGUgY2FsbGJhY2sgaW4uXG5cdFx0ICogQGV4YW1wbGVcblx0XHQgKiAvLyBEaXNwbGF5cyBhbiBhbGVydCBib3ggdXNpbmcgdGhlIGFjdGl2ZSBlZGl0b3JzIHdpbmRvdyBtYW5hZ2VyIGluc3RhbmNlXG5cdFx0ICogdGlueW1jZS5hY3RpdmVFZGl0b3Iud2luZG93TWFuYWdlci5hbGVydCgnSGVsbG8gd29ybGQhJyk7XG5cdFx0ICovXG5cdFx0c2VsZi5hbGVydCA9IGZ1bmN0aW9uKG1lc3NhZ2UsIGNhbGxiYWNrLCBzY29wZSkge1xuXHRcdFx0dmFyIHdpbjtcblxuXHRcdFx0d2luID0gTWVzc2FnZUJveC5hbGVydChtZXNzYWdlLCBmdW5jdGlvbigpIHtcblx0XHRcdFx0aWYgKGNhbGxiYWNrKSB7XG5cdFx0XHRcdFx0Y2FsbGJhY2suY2FsbChzY29wZSB8fCB0aGlzKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRlZGl0b3IuZm9jdXMoKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdHdpbi5vbignY2xvc2UnLCBmdW5jdGlvbigpIHtcblx0XHRcdFx0ZmlyZUNsb3NlRXZlbnQod2luKTtcblx0XHRcdH0pO1xuXG5cdFx0XHRmaXJlT3BlbkV2ZW50KHdpbik7XG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIENyZWF0ZXMgYSBjb25maXJtIGRpYWxvZy4gUGxlYXNlIGRvbid0IHVzZSB0aGUgYmxvY2tpbmcgYmVoYXZpb3Igb2YgdGhpc1xuXHRcdCAqIG5hdGl2ZSB2ZXJzaW9uIHVzZSB0aGUgY2FsbGJhY2sgbWV0aG9kIGluc3RlYWQgdGhlbiBpdCBjYW4gYmUgZXh0ZW5kZWQuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGNvbmZpcm1cblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gbWVzc2FnZSBUZXh0IHRvIGRpc3BsYXkgaW4gdGhlIG5ldyBjb25maXJtIGRpYWxvZy5cblx0XHQgKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCBhZnRlciB0aGUgdXNlciBoYXMgc2VsZWN0ZWQgb2sgb3IgY2FuY2VsLlxuXHRcdCAqIEBwYXJhbSB7T2JqZWN0fSBzY29wZSBPcHRpb25hbCBzY29wZSB0byBleGVjdXRlIHRoZSBjYWxsYmFjayBpbi5cblx0XHQgKiBAZXhhbXBsZVxuXHRcdCAqIC8vIERpc3BsYXlzIGFuIGNvbmZpcm0gYm94IGFuZCBhbiBhbGVydCBtZXNzYWdlIHdpbGwgYmUgZGlzcGxheWVkIGRlcGVuZGluZyBvbiB3aGF0IHlvdSBjaG9vc2UgaW4gdGhlIGNvbmZpcm1cblx0XHQgKiB0aW55bWNlLmFjdGl2ZUVkaXRvci53aW5kb3dNYW5hZ2VyLmNvbmZpcm0oXCJEbyB5b3Ugd2FudCB0byBkbyBzb21ldGhpbmdcIiwgZnVuY3Rpb24ocykge1xuXHRcdCAqICAgIGlmIChzKVxuXHRcdCAqICAgICAgIHRpbnltY2UuYWN0aXZlRWRpdG9yLndpbmRvd01hbmFnZXIuYWxlcnQoXCJPa1wiKTtcblx0XHQgKiAgICBlbHNlXG5cdFx0ICogICAgICAgdGlueW1jZS5hY3RpdmVFZGl0b3Iud2luZG93TWFuYWdlci5hbGVydChcIkNhbmNlbFwiKTtcblx0XHQgKiB9KTtcblx0XHQgKi9cblx0XHRzZWxmLmNvbmZpcm0gPSBmdW5jdGlvbihtZXNzYWdlLCBjYWxsYmFjaywgc2NvcGUpIHtcblx0XHRcdHZhciB3aW47XG5cblx0XHRcdHdpbiA9IE1lc3NhZ2VCb3guY29uZmlybShtZXNzYWdlLCBmdW5jdGlvbihzdGF0ZSkge1xuXHRcdFx0XHRjYWxsYmFjay5jYWxsKHNjb3BlIHx8IHRoaXMsIHN0YXRlKTtcblx0XHRcdH0pO1xuXG5cdFx0XHR3aW4ub24oJ2Nsb3NlJywgZnVuY3Rpb24oKSB7XG5cdFx0XHRcdGZpcmVDbG9zZUV2ZW50KHdpbik7XG5cdFx0XHR9KTtcblxuXHRcdFx0ZmlyZU9wZW5FdmVudCh3aW4pO1xuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBDbG9zZXMgdGhlIHRvcCBtb3N0IHdpbmRvdy5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgY2xvc2Vcblx0XHQgKi9cblx0XHRzZWxmLmNsb3NlID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRpZiAoZ2V0VG9wTW9zdFdpbmRvdygpKSB7XG5cdFx0XHRcdGdldFRvcE1vc3RXaW5kb3coKS5jbG9zZSgpO1xuXHRcdFx0fVxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBSZXR1cm5zIHRoZSBwYXJhbXMgb2YgdGhlIGxhc3Qgd2luZG93IG9wZW4gY2FsbC4gVGhpcyBjYW4gYmUgdXNlZCBpbiBpZnJhbWUgYmFzZWRcblx0XHQgKiBkaWFsb2cgdG8gZ2V0IHBhcmFtcyBwYXNzZWQgZnJvbSB0aGUgdGlueW1jZSBwbHVnaW4uXG5cdFx0ICpcblx0XHQgKiBAZXhhbXBsZVxuXHRcdCAqIHZhciBkaWFsb2dBcmd1bWVudHMgPSB0b3AudGlueW1jZS5hY3RpdmVFZGl0b3Iud2luZG93TWFuYWdlci5nZXRQYXJhbXMoKTtcblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgZ2V0UGFyYW1zXG5cdFx0ICogQHJldHVybiB7T2JqZWN0fSBOYW1lL3ZhbHVlIG9iamVjdCB3aXRoIHBhcmFtZXRlcnMgcGFzc2VkIGZyb20gd2luZG93TWFuYWdlci5vcGVuIGNhbGwuXG5cdFx0ICovXG5cdFx0c2VsZi5nZXRQYXJhbXMgPSBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiBnZXRUb3BNb3N0V2luZG93KCkgPyBnZXRUb3BNb3N0V2luZG93KCkucGFyYW1zIDogbnVsbDtcblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogU2V0cyB0aGUgcGFyYW1zIG9mIHRoZSBsYXN0IG9wZW5lZCB3aW5kb3cuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHNldFBhcmFtc1xuXHRcdCAqIEBwYXJhbSB7T2JqZWN0fSBwYXJhbXMgUGFyYW1zIG9iamVjdCB0byBzZXQgZm9yIHRoZSBsYXN0IG9wZW5lZCB3aW5kb3cuXG5cdFx0ICovXG5cdFx0c2VsZi5zZXRQYXJhbXMgPSBmdW5jdGlvbihwYXJhbXMpIHtcblx0XHRcdGlmIChnZXRUb3BNb3N0V2luZG93KCkpIHtcblx0XHRcdFx0Z2V0VG9wTW9zdFdpbmRvdygpLnBhcmFtcyA9IHBhcmFtcztcblx0XHRcdH1cblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyB0aGUgY3VycmVudGx5IG9wZW5lZCB3aW5kb3cgb2JqZWN0cy5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgZ2V0V2luZG93c1xuXHRcdCAqIEByZXR1cm4ge0FycmF5fSBBcnJheSBvZiB0aGUgY3VycmVudGx5IG9wZW5lZCB3aW5kb3dzLlxuXHRcdCAqL1xuXHRcdHNlbGYuZ2V0V2luZG93cyA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHdpbmRvd3M7XG5cdFx0fTtcblx0fTtcbn0pO1xuXG4vLyBJbmNsdWRlZCBmcm9tOiBqcy90aW55bWNlL2NsYXNzZXMvdWkvVG9vbHRpcC5qc1xuXG4vKipcbiAqIFRvb2x0aXAuanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBDcmVhdGVzIGEgdG9vbHRpcCBpbnN0YW5jZS5cbiAqXG4gKiBALXgtbGVzcyBUb29sVGlwLmxlc3NcbiAqIEBjbGFzcyB0aW55bWNlLnVpLlRvb2xUaXBcbiAqIEBleHRlbmRzIHRpbnltY2UudWkuQ29udHJvbFxuICogQG1peGVzIHRpbnltY2UudWkuTW92YWJsZVxuICovXG5kZWZpbmUoXCJ0aW55bWNlL3VpL1Rvb2x0aXBcIiwgW1xuXHRcInRpbnltY2UvdWkvQ29udHJvbFwiLFxuXHRcInRpbnltY2UvdWkvTW92YWJsZVwiXG5dLCBmdW5jdGlvbihDb250cm9sLCBNb3ZhYmxlKSB7XG5cdHJldHVybiBDb250cm9sLmV4dGVuZCh7XG5cdFx0TWl4aW5zOiBbTW92YWJsZV0sXG5cblx0XHREZWZhdWx0czoge1xuXHRcdFx0Y2xhc3NlczogJ3dpZGdldCB0b29sdGlwIHRvb2x0aXAtbidcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmVuZGVycyB0aGUgY29udHJvbCBhcyBhIEhUTUwgc3RyaW5nLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCByZW5kZXJIdG1sXG5cdFx0ICogQHJldHVybiB7U3RyaW5nfSBIVE1MIHJlcHJlc2VudGluZyB0aGUgY29udHJvbC5cblx0XHQgKi9cblx0XHRyZW5kZXJIdG1sOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgcHJlZml4ID0gc2VsZi5jbGFzc1ByZWZpeDtcblxuXHRcdFx0cmV0dXJuIChcblx0XHRcdFx0JzxkaXYgaWQ9XCInICsgc2VsZi5faWQgKyAnXCIgY2xhc3M9XCInICsgc2VsZi5jbGFzc2VzICsgJ1wiIHJvbGU9XCJwcmVzZW50YXRpb25cIj4nICtcblx0XHRcdFx0XHQnPGRpdiBjbGFzcz1cIicgKyBwcmVmaXggKyAndG9vbHRpcC1hcnJvd1wiPjwvZGl2PicgK1xuXHRcdFx0XHRcdCc8ZGl2IGNsYXNzPVwiJyArIHByZWZpeCArICd0b29sdGlwLWlubmVyXCI+JyArIHNlbGYuZW5jb2RlKHNlbGYuc3RhdGUuZ2V0KCd0ZXh0JykpICsgJzwvZGl2PicgK1xuXHRcdFx0XHQnPC9kaXY+J1xuXHRcdFx0KTtcblx0XHR9LFxuXG5cdFx0YmluZFN0YXRlczogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdHNlbGYuc3RhdGUub24oJ2NoYW5nZTp0ZXh0JywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRzZWxmLmdldEVsKCkubGFzdENoaWxkLmlubmVySFRNTCA9IHNlbGYuZW5jb2RlKGUudmFsdWUpO1xuXHRcdFx0fSk7XG5cblx0XHRcdHJldHVybiBzZWxmLl9zdXBlcigpO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZXBhaW50cyB0aGUgY29udHJvbCBhZnRlciBhIGxheW91dCBvcGVyYXRpb24uXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHJlcGFpbnRcblx0XHQgKi9cblx0XHRyZXBhaW50OiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgc3R5bGUsIHJlY3Q7XG5cblx0XHRcdHN0eWxlID0gc2VsZi5nZXRFbCgpLnN0eWxlO1xuXHRcdFx0cmVjdCA9IHNlbGYuX2xheW91dFJlY3Q7XG5cblx0XHRcdHN0eWxlLmxlZnQgPSByZWN0LnggKyAncHgnO1xuXHRcdFx0c3R5bGUudG9wID0gcmVjdC55ICsgJ3B4Jztcblx0XHRcdHN0eWxlLnpJbmRleCA9IDB4RkZGRiArIDB4RkZGRjtcblx0XHR9XG5cdH0pO1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy91aS9XaWRnZXQuanNcblxuLyoqXG4gKiBXaWRnZXQuanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBXaWRnZXQgYmFzZSBjbGFzcyBhIHdpZGdldCBpcyBhIGNvbnRyb2wgdGhhdCBoYXMgYSB0b29sdGlwIGFuZCBzb21lIGJhc2ljIHN0YXRlcy5cbiAqXG4gKiBAY2xhc3MgdGlueW1jZS51aS5XaWRnZXRcbiAqIEBleHRlbmRzIHRpbnltY2UudWkuQ29udHJvbFxuICovXG5kZWZpbmUoXCJ0aW55bWNlL3VpL1dpZGdldFwiLCBbXG5cdFwidGlueW1jZS91aS9Db250cm9sXCIsXG5cdFwidGlueW1jZS91aS9Ub29sdGlwXCJcbl0sIGZ1bmN0aW9uKENvbnRyb2wsIFRvb2x0aXApIHtcblx0XCJ1c2Ugc3RyaWN0XCI7XG5cblx0dmFyIHRvb2x0aXA7XG5cblx0dmFyIFdpZGdldCA9IENvbnRyb2wuZXh0ZW5kKHtcblx0XHQvKipcblx0XHQgKiBDb25zdHJ1Y3RzIGEgaW5zdGFuY2Ugd2l0aCB0aGUgc3BlY2lmaWVkIHNldHRpbmdzLlxuXHRcdCAqXG5cdFx0ICogQGNvbnN0cnVjdG9yXG5cdFx0ICogQHBhcmFtIHtPYmplY3R9IHNldHRpbmdzIE5hbWUvdmFsdWUgb2JqZWN0IHdpdGggc2V0dGluZ3MuXG5cdFx0ICogQHNldHRpbmcge1N0cmluZ30gdG9vbHRpcCBUb29sdGlwIHRleHQgdG8gZGlzcGxheSB3aGVuIGhvdmVyaW5nLlxuXHRcdCAqIEBzZXR0aW5nIHtCb29sZWFufSBhdXRvZm9jdXMgVHJ1ZSBpZiB0aGUgY29udHJvbCBzaG91bGQgYmUgZm9jdXNlZCB3aGVuIHJlbmRlcmVkLlxuXHRcdCAqIEBzZXR0aW5nIHtTdHJpbmd9IHRleHQgVGV4dCB0byBkaXNwbGF5IGluc2lkZSB3aWRnZXQuXG5cdFx0ICovXG5cdFx0aW5pdDogZnVuY3Rpb24oc2V0dGluZ3MpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0c2VsZi5fc3VwZXIoc2V0dGluZ3MpO1xuXHRcdFx0c2V0dGluZ3MgPSBzZWxmLnNldHRpbmdzO1xuXHRcdFx0c2VsZi5jYW5Gb2N1cyA9IHRydWU7XG5cblx0XHRcdGlmIChzZXR0aW5ncy50b29sdGlwICYmIFdpZGdldC50b29sdGlwcyAhPT0gZmFsc2UpIHtcblx0XHRcdFx0c2VsZi5vbignbW91c2VlbnRlcicsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0XHR2YXIgdG9vbHRpcCA9IHNlbGYudG9vbHRpcCgpLm1vdmVUbygtMHhGRkZGKTtcblxuXHRcdFx0XHRcdGlmIChlLmNvbnRyb2wgPT0gc2VsZikge1xuXHRcdFx0XHRcdFx0dmFyIHJlbCA9IHRvb2x0aXAudGV4dChzZXR0aW5ncy50b29sdGlwKS5zaG93KCkudGVzdE1vdmVSZWwoc2VsZi5nZXRFbCgpLCBbJ2JjLXRjJywgJ2JjLXRsJywgJ2JjLXRyJ10pO1xuXG5cdFx0XHRcdFx0XHR0b29sdGlwLmNsYXNzZXMudG9nZ2xlKCd0b29sdGlwLW4nLCByZWwgPT0gJ2JjLXRjJyk7XG5cdFx0XHRcdFx0XHR0b29sdGlwLmNsYXNzZXMudG9nZ2xlKCd0b29sdGlwLW53JywgcmVsID09ICdiYy10bCcpO1xuXHRcdFx0XHRcdFx0dG9vbHRpcC5jbGFzc2VzLnRvZ2dsZSgndG9vbHRpcC1uZScsIHJlbCA9PSAnYmMtdHInKTtcblxuXHRcdFx0XHRcdFx0dG9vbHRpcC5tb3ZlUmVsKHNlbGYuZ2V0RWwoKSwgcmVsKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0dG9vbHRpcC5oaWRlKCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHRzZWxmLm9uKCdtb3VzZWxlYXZlIG1vdXNlZG93biBjbGljaycsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdHNlbGYudG9vbHRpcCgpLmhpZGUoKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdHNlbGYuYXJpYSgnbGFiZWwnLCBzZXR0aW5ncy5hcmlhTGFiZWwgfHwgc2V0dGluZ3MudG9vbHRpcCk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFJldHVybnMgdGhlIGN1cnJlbnQgdG9vbHRpcCBpbnN0YW5jZS5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgdG9vbHRpcFxuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UudWkuVG9vbHRpcH0gVG9vbHRpcCBpbnN0YW5jZS5cblx0XHQgKi9cblx0XHR0b29sdGlwOiBmdW5jdGlvbigpIHtcblx0XHRcdGlmICghdG9vbHRpcCkge1xuXHRcdFx0XHR0b29sdGlwID0gbmV3IFRvb2x0aXAoe3R5cGU6ICd0b29sdGlwJ30pO1xuXHRcdFx0XHR0b29sdGlwLnJlbmRlclRvKCk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiB0b29sdGlwO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBDYWxsZWQgYWZ0ZXIgdGhlIGNvbnRyb2wgaGFzIGJlZW4gcmVuZGVyZWQuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHBvc3RSZW5kZXJcblx0XHQgKi9cblx0XHRwb3N0UmVuZGVyOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgc2V0dGluZ3MgPSBzZWxmLnNldHRpbmdzO1xuXG5cdFx0XHRzZWxmLl9zdXBlcigpO1xuXG5cdFx0XHRpZiAoIXNlbGYucGFyZW50KCkgJiYgKHNldHRpbmdzLndpZHRoIHx8IHNldHRpbmdzLmhlaWdodCkpIHtcblx0XHRcdFx0c2VsZi5pbml0TGF5b3V0UmVjdCgpO1xuXHRcdFx0XHRzZWxmLnJlcGFpbnQoKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHNldHRpbmdzLmF1dG9mb2N1cykge1xuXHRcdFx0XHRzZWxmLmZvY3VzKCk7XG5cdFx0XHR9XG5cdFx0fSxcblxuXHRcdGJpbmRTdGF0ZXM6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHRmdW5jdGlvbiBkaXNhYmxlKHN0YXRlKSB7XG5cdFx0XHRcdHNlbGYuYXJpYSgnZGlzYWJsZWQnLCBzdGF0ZSk7XG5cdFx0XHRcdHNlbGYuY2xhc3Nlcy50b2dnbGUoJ2Rpc2FibGVkJywgc3RhdGUpO1xuXHRcdFx0fVxuXG5cdFx0XHRmdW5jdGlvbiBhY3RpdmUoc3RhdGUpIHtcblx0XHRcdFx0c2VsZi5hcmlhKCdwcmVzc2VkJywgc3RhdGUpO1xuXHRcdFx0XHRzZWxmLmNsYXNzZXMudG9nZ2xlKCdhY3RpdmUnLCBzdGF0ZSk7XG5cdFx0XHR9XG5cblx0XHRcdHNlbGYuc3RhdGUub24oJ2NoYW5nZTpkaXNhYmxlZCcsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0ZGlzYWJsZShlLnZhbHVlKTtcblx0XHRcdH0pO1xuXG5cdFx0XHRzZWxmLnN0YXRlLm9uKCdjaGFuZ2U6YWN0aXZlJywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRhY3RpdmUoZS52YWx1ZSk7XG5cdFx0XHR9KTtcblxuXHRcdFx0aWYgKHNlbGYuc3RhdGUuZ2V0KCdkaXNhYmxlZCcpKSB7XG5cdFx0XHRcdGRpc2FibGUodHJ1ZSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChzZWxmLnN0YXRlLmdldCgnYWN0aXZlJykpIHtcblx0XHRcdFx0YWN0aXZlKHRydWUpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gc2VsZi5fc3VwZXIoKTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmVtb3ZlcyB0aGUgY3VycmVudCBjb250cm9sIGZyb20gRE9NIGFuZCBmcm9tIFVJIGNvbGxlY3Rpb25zLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCByZW1vdmVcblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLnVpLkNvbnRyb2x9IEN1cnJlbnQgY29udHJvbCBpbnN0YW5jZS5cblx0XHQgKi9cblx0XHRyZW1vdmU6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dGhpcy5fc3VwZXIoKTtcblxuXHRcdFx0aWYgKHRvb2x0aXApIHtcblx0XHRcdFx0dG9vbHRpcC5yZW1vdmUoKTtcblx0XHRcdFx0dG9vbHRpcCA9IG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHR9KTtcblxuXHRyZXR1cm4gV2lkZ2V0O1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy91aS9Qcm9ncmVzcy5qc1xuXG4vKipcbiAqIFByb2dyZXNzLmpzXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgTEdQTCBMaWNlbnNlLlxuICogQ29weXJpZ2h0IChjKSAxOTk5LTIwMTUgRXBob3ggQ29ycC4gQWxsIHJpZ2h0cyByZXNlcnZlZFxuICpcbiAqIExpY2Vuc2U6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vbGljZW5zZVxuICogQ29udHJpYnV0aW5nOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2NvbnRyaWJ1dGluZ1xuICovXG5cbi8qKlxuICogUHJvZ3Jlc3MgY29udHJvbC5cbiAqXG4gKiBALXgtbGVzcyBQcm9ncmVzcy5sZXNzXG4gKiBAY2xhc3MgdGlueW1jZS51aS5Qcm9ncmVzc1xuICogQGV4dGVuZHMgdGlueW1jZS51aS5Db250cm9sXG4gKi9cbmRlZmluZShcInRpbnltY2UvdWkvUHJvZ3Jlc3NcIiwgW1xuXHRcInRpbnltY2UvdWkvV2lkZ2V0XCJcbl0sIGZ1bmN0aW9uKFdpZGdldCkge1xuXHRcInVzZSBzdHJpY3RcIjtcblxuXHRyZXR1cm4gV2lkZ2V0LmV4dGVuZCh7XG5cdFx0RGVmYXVsdHM6IHtcblx0XHRcdHZhbHVlOiAwXG5cdFx0fSxcblxuXHRcdGluaXQ6IGZ1bmN0aW9uKHNldHRpbmdzKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdHNlbGYuX3N1cGVyKHNldHRpbmdzKTtcblx0XHRcdHNlbGYuY2xhc3Nlcy5hZGQoJ3Byb2dyZXNzJyk7XG5cblx0XHRcdGlmICghc2VsZi5zZXR0aW5ncy5maWx0ZXIpIHtcblx0XHRcdFx0c2VsZi5zZXR0aW5ncy5maWx0ZXIgPSBmdW5jdGlvbih2YWx1ZSkge1xuXHRcdFx0XHRcdHJldHVybiBNYXRoLnJvdW5kKHZhbHVlKTtcblx0XHRcdFx0fTtcblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0cmVuZGVySHRtbDogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIGlkID0gc2VsZi5faWQsIHByZWZpeCA9IHRoaXMuY2xhc3NQcmVmaXg7XG5cblx0XHRcdHJldHVybiAoXG5cdFx0XHRcdCc8ZGl2IGlkPVwiJyArIGlkICsgJ1wiIGNsYXNzPVwiJyArIHNlbGYuY2xhc3NlcyArICdcIj4nICtcblx0XHRcdFx0XHQnPGRpdiBjbGFzcz1cIicgKyBwcmVmaXggKyAnYmFyLWNvbnRhaW5lclwiPicgK1xuXHRcdFx0XHRcdFx0JzxkaXYgY2xhc3M9XCInICsgcHJlZml4ICsgJ2JhclwiPjwvZGl2PicgK1xuXHRcdFx0XHRcdCc8L2Rpdj4nICtcblx0XHRcdFx0XHQnPGRpdiBjbGFzcz1cIicgKyBwcmVmaXggKyAndGV4dFwiPjAlPC9kaXY+JyArXG5cdFx0XHRcdCc8L2Rpdj4nXG5cdFx0XHQpO1xuXHRcdH0sXG5cblx0XHRwb3N0UmVuZGVyOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0c2VsZi5fc3VwZXIoKTtcblx0XHRcdHNlbGYudmFsdWUoc2VsZi5zZXR0aW5ncy52YWx1ZSk7XG5cblx0XHRcdHJldHVybiBzZWxmO1xuXHRcdH0sXG5cblx0XHRiaW5kU3RhdGVzOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0ZnVuY3Rpb24gc2V0VmFsdWUodmFsdWUpIHtcblx0XHRcdFx0dmFsdWUgPSBzZWxmLnNldHRpbmdzLmZpbHRlcih2YWx1ZSk7XG5cdFx0XHRcdHNlbGYuZ2V0RWwoKS5sYXN0Q2hpbGQuaW5uZXJIVE1MID0gdmFsdWUgKyAnJSc7XG5cdFx0XHRcdHNlbGYuZ2V0RWwoKS5maXJzdENoaWxkLmZpcnN0Q2hpbGQuc3R5bGUud2lkdGggPSB2YWx1ZSArICclJztcblx0XHRcdH1cblxuXHRcdFx0c2VsZi5zdGF0ZS5vbignY2hhbmdlOnZhbHVlJywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRzZXRWYWx1ZShlLnZhbHVlKTtcblx0XHRcdH0pO1xuXG5cdFx0XHRzZXRWYWx1ZShzZWxmLnN0YXRlLmdldCgndmFsdWUnKSk7XG5cblx0XHRcdHJldHVybiBzZWxmLl9zdXBlcigpO1xuXHRcdH1cblx0fSk7XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL3VpL05vdGlmaWNhdGlvbi5qc1xuXG4vKipcbiAqIE5vdGlmaWNhdGlvbi5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE1IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKipcbiAqIENyZWF0ZXMgYSBub3RpZmljYXRpb24gaW5zdGFuY2UuXG4gKlxuICogQC14LWxlc3MgTm90aWZpY2F0aW9uLmxlc3NcbiAqIEBjbGFzcyB0aW55bWNlLnVpLk5vdGlmaWNhdGlvblxuICogQGV4dGVuZHMgdGlueW1jZS51aS5Db250YWluZXJcbiAqIEBtaXhlcyB0aW55bWNlLnVpLk1vdmFibGVcbiAqL1xuZGVmaW5lKFwidGlueW1jZS91aS9Ob3RpZmljYXRpb25cIiwgW1xuXHRcInRpbnltY2UvdWkvQ29udHJvbFwiLFxuXHRcInRpbnltY2UvdWkvTW92YWJsZVwiLFxuXHRcInRpbnltY2UvdWkvUHJvZ3Jlc3NcIixcblx0XCJ0aW55bWNlL3V0aWwvRGVsYXlcIlxuXSwgZnVuY3Rpb24oQ29udHJvbCwgTW92YWJsZSwgUHJvZ3Jlc3MsIERlbGF5KSB7XG5cdHJldHVybiBDb250cm9sLmV4dGVuZCh7XG5cdFx0TWl4aW5zOiBbTW92YWJsZV0sXG5cblx0XHREZWZhdWx0czoge1xuXHRcdFx0Y2xhc3NlczogJ3dpZGdldCBub3RpZmljYXRpb24nXG5cdFx0fSxcblxuXHRcdGluaXQ6IGZ1bmN0aW9uKHNldHRpbmdzKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdHNlbGYuX3N1cGVyKHNldHRpbmdzKTtcblxuXHRcdFx0aWYgKHNldHRpbmdzLnRleHQpIHtcblx0XHRcdFx0c2VsZi50ZXh0KHNldHRpbmdzLnRleHQpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoc2V0dGluZ3MuaWNvbikge1xuXHRcdFx0XHRzZWxmLmljb24gPSBzZXR0aW5ncy5pY29uO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoc2V0dGluZ3MuY29sb3IpIHtcblx0XHRcdFx0c2VsZi5jb2xvciA9IHNldHRpbmdzLmNvbG9yO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoc2V0dGluZ3MudHlwZSkge1xuXHRcdFx0XHRzZWxmLmNsYXNzZXMuYWRkKCdub3RpZmljYXRpb24tJyArIHNldHRpbmdzLnR5cGUpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoc2V0dGluZ3MudGltZW91dCAmJiAoc2V0dGluZ3MudGltZW91dCA8IDAgfHwgc2V0dGluZ3MudGltZW91dCA+IDApICYmICFzZXR0aW5ncy5jbG9zZUJ1dHRvbikge1xuXHRcdFx0XHRzZWxmLmNsb3NlQnV0dG9uID0gZmFsc2U7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRzZWxmLmNsYXNzZXMuYWRkKCdoYXMtY2xvc2UnKTtcblx0XHRcdFx0c2VsZi5jbG9zZUJ1dHRvbiA9IHRydWU7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChzZXR0aW5ncy5wcm9ncmVzc0Jhcikge1xuXHRcdFx0XHRzZWxmLnByb2dyZXNzQmFyID0gbmV3IFByb2dyZXNzKCk7XG5cdFx0XHR9XG5cblx0XHRcdHNlbGYub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRpZiAoZS50YXJnZXQuY2xhc3NOYW1lLmluZGV4T2Yoc2VsZi5jbGFzc1ByZWZpeCArICdjbG9zZScpICE9IC0xKSB7XG5cdFx0XHRcdFx0c2VsZi5jbG9zZSgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmVuZGVycyB0aGUgY29udHJvbCBhcyBhIEhUTUwgc3RyaW5nLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCByZW5kZXJIdG1sXG5cdFx0ICogQHJldHVybiB7U3RyaW5nfSBIVE1MIHJlcHJlc2VudGluZyB0aGUgY29udHJvbC5cblx0XHQgKi9cblx0XHRyZW5kZXJIdG1sOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgcHJlZml4ID0gc2VsZi5jbGFzc1ByZWZpeCwgaWNvbiA9ICcnLCBjbG9zZUJ1dHRvbiA9ICcnLCBwcm9ncmVzc0JhciA9ICcnLCBub3RpZmljYXRpb25TdHlsZSA9ICcnO1xuXG5cdFx0XHRpZiAoc2VsZi5pY29uKSB7XG5cdFx0XHRcdGljb24gPSAnPGkgY2xhc3M9XCInICsgcHJlZml4ICsgJ2ljbycgKyAnICcgKyBwcmVmaXggKyAnaS0nICsgc2VsZi5pY29uICsgJ1wiPjwvaT4nO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoc2VsZi5jb2xvcikge1xuXHRcdFx0XHRub3RpZmljYXRpb25TdHlsZSA9ICcgc3R5bGU9XCJiYWNrZ3JvdW5kLWNvbG9yOiAnICsgc2VsZi5jb2xvciArICdcIic7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChzZWxmLmNsb3NlQnV0dG9uKSB7XG5cdFx0XHRcdGNsb3NlQnV0dG9uID0gJzxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwiJyArIHByZWZpeCArICdjbG9zZVwiIGFyaWEtaGlkZGVuPVwidHJ1ZVwiPlxcdTAwZDc8L2J1dHRvbj4nO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoc2VsZi5wcm9ncmVzc0Jhcikge1xuXHRcdFx0XHRwcm9ncmVzc0JhciA9IHNlbGYucHJvZ3Jlc3NCYXIucmVuZGVySHRtbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gKFxuXHRcdFx0XHQnPGRpdiBpZD1cIicgKyBzZWxmLl9pZCArICdcIiBjbGFzcz1cIicgKyBzZWxmLmNsYXNzZXMgKyAnXCInICsgbm90aWZpY2F0aW9uU3R5bGUgKyAnIHJvbGU9XCJwcmVzZW50YXRpb25cIj4nICtcblx0XHRcdFx0XHRpY29uICtcblx0XHRcdFx0XHQnPGRpdiBjbGFzcz1cIicgKyBwcmVmaXggKyAnbm90aWZpY2F0aW9uLWlubmVyXCI+JyArIHNlbGYuc3RhdGUuZ2V0KCd0ZXh0JykgKyAnPC9kaXY+JyArXG5cdFx0XHRcdFx0cHJvZ3Jlc3NCYXIgK1xuXHRcdFx0XHRcdGNsb3NlQnV0dG9uICtcblx0XHRcdFx0JzwvZGl2Pidcblx0XHRcdCk7XG5cdFx0fSxcblxuXHRcdHBvc3RSZW5kZXI6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHREZWxheS5zZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRzZWxmLiRlbC5hZGRDbGFzcyhzZWxmLmNsYXNzUHJlZml4ICsgJ2luJyk7XG5cdFx0XHR9KTtcblxuXHRcdFx0cmV0dXJuIHNlbGYuX3N1cGVyKCk7XG5cdFx0fSxcblxuXHRcdGJpbmRTdGF0ZXM6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHRzZWxmLnN0YXRlLm9uKCdjaGFuZ2U6dGV4dCcsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0c2VsZi5nZXRFbCgpLmNoaWxkTm9kZXNbMV0uaW5uZXJIVE1MID0gZS52YWx1ZTtcblx0XHRcdH0pO1xuXHRcdFx0aWYgKHNlbGYucHJvZ3Jlc3NCYXIpIHtcblx0XHRcdFx0c2VsZi5wcm9ncmVzc0Jhci5iaW5kU3RhdGVzKCk7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gc2VsZi5fc3VwZXIoKTtcblx0XHR9LFxuXG5cdFx0Y2xvc2U6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHRpZiAoIXNlbGYuZmlyZSgnY2xvc2UnKS5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkge1xuXHRcdFx0XHRzZWxmLnJlbW92ZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gc2VsZjtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmVwYWludHMgdGhlIGNvbnRyb2wgYWZ0ZXIgYSBsYXlvdXQgb3BlcmF0aW9uLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCByZXBhaW50XG5cdFx0ICovXG5cdFx0cmVwYWludDogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIHN0eWxlLCByZWN0O1xuXG5cdFx0XHRzdHlsZSA9IHNlbGYuZ2V0RWwoKS5zdHlsZTtcblx0XHRcdHJlY3QgPSBzZWxmLl9sYXlvdXRSZWN0O1xuXG5cdFx0XHRzdHlsZS5sZWZ0ID0gcmVjdC54ICsgJ3B4Jztcblx0XHRcdHN0eWxlLnRvcCA9IHJlY3QueSArICdweCc7XG5cblx0XHRcdC8vIEhhcmRjb2RlZCBhcmJpdHJhcnkgei12YWx1ZSBiZWNhdXNlIHdlIHdhbnQgdGhlXG5cdFx0XHQvLyBub3RpZmljYXRpb25zIHVuZGVyIHRoZSBvdGhlciB3aW5kb3dzXG5cdFx0XHRzdHlsZS56SW5kZXggPSAweEZGRkYgLSAxO1xuXHRcdH1cblx0fSk7XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL05vdGlmaWNhdGlvbk1hbmFnZXIuanNcblxuLyoqXG4gKiBOb3RpZmljYXRpb25NYW5hZ2VyLmpzXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgTEdQTCBMaWNlbnNlLlxuICogQ29weXJpZ2h0IChjKSAxOTk5LTIwMTUgRXBob3ggQ29ycC4gQWxsIHJpZ2h0cyByZXNlcnZlZFxuICpcbiAqIExpY2Vuc2U6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vbGljZW5zZVxuICogQ29udHJpYnV0aW5nOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2NvbnRyaWJ1dGluZ1xuICovXG5cbi8qKlxuICogVGhpcyBjbGFzcyBoYW5kbGVzIHRoZSBjcmVhdGlvbiBvZiBUaW55TUNFJ3Mgbm90aWZpY2F0aW9ucy5cbiAqXG4gKiBAY2xhc3MgdGlueW1jZS5ub3RpZmljYXRpb25NYW5hZ2VyXG4gKiBAZXhhbXBsZVxuICogLy8gT3BlbnMgYSBuZXcgbm90aWZpY2F0aW9uIG9mIHR5cGUgXCJlcnJvclwiIHdpdGggdGV4dCBcIkFuIGVycm9yIG9jY3VycmVkLlwiXG4gKiB0aW55bWNlLmFjdGl2ZUVkaXRvci5ub3RpZmljYXRpb25NYW5hZ2VyLm9wZW4oe1xuICogICAgdGV4dDogJ0FuIGVycm9yIG9jY3VycmVkLicsXG4gKiAgICB0eXBlOiAnZXJyb3InXG4gKiB9KTtcbiAqL1xuZGVmaW5lKFwidGlueW1jZS9Ob3RpZmljYXRpb25NYW5hZ2VyXCIsIFtcblx0XCJ0aW55bWNlL3VpL05vdGlmaWNhdGlvblwiLFxuXHRcInRpbnltY2UvdXRpbC9EZWxheVwiLFxuXHRcInRpbnltY2UvdXRpbC9Ub29sc1wiXG5dLCBmdW5jdGlvbihOb3RpZmljYXRpb24sIERlbGF5LCBUb29scykge1xuXHRyZXR1cm4gZnVuY3Rpb24oZWRpdG9yKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLCBub3RpZmljYXRpb25zID0gW107XG5cblx0XHRmdW5jdGlvbiBnZXRMYXN0Tm90aWZpY2F0aW9uKCkge1xuXHRcdFx0aWYgKG5vdGlmaWNhdGlvbnMubGVuZ3RoKSB7XG5cdFx0XHRcdHJldHVybiBub3RpZmljYXRpb25zW25vdGlmaWNhdGlvbnMubGVuZ3RoIC0gMV07XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0c2VsZi5ub3RpZmljYXRpb25zID0gbm90aWZpY2F0aW9ucztcblxuXHRcdGZ1bmN0aW9uIHJlc2l6ZVdpbmRvd0V2ZW50KCkge1xuXHRcdFx0RGVsYXkucmVxdWVzdEFuaW1hdGlvbkZyYW1lKGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRwcmVQb3NpdGlvbk5vdGlmaWNhdGlvbnMoKTtcblx0XHRcdFx0cG9zaXRpb25Ob3RpZmljYXRpb25zKCk7XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHQvLyBTaW5jZSB0aGUgdmlld3BvcnQgd2lsbCBjaGFuZ2UgYmFzZWQgb24gdGhlIHByZXNlbnQgbm90aWZpY2F0aW9ucywgd2UgbmVlZCB0byBtb3ZlIHRoZW0gYWxsIHRvIHRoZVxuXHRcdC8vIHRvcCBsZWZ0IG9mIHRoZSB2aWV3cG9ydCB0byBnaXZlIGFuIGFjY3VyYXRlIHNpemUgbWVhc3VyZW1lbnQgc28gd2UgY2FuIHBvc2l0aW9uIHRoZW0gbGF0ZXIuXG5cdFx0ZnVuY3Rpb24gcHJlUG9zaXRpb25Ob3RpZmljYXRpb25zKCkge1xuXHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBub3RpZmljYXRpb25zLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRcdG5vdGlmaWNhdGlvbnNbaV0ubW92ZVRvKDAsIDApO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIHBvc2l0aW9uTm90aWZpY2F0aW9ucygpIHtcblx0XHRcdGlmIChub3RpZmljYXRpb25zLmxlbmd0aCA+IDApIHtcblx0XHRcdFx0dmFyIGZpcnN0SXRlbSA9IG5vdGlmaWNhdGlvbnMuc2xpY2UoMCwgMSlbMF07XG5cdFx0XHRcdHZhciBjb250YWluZXIgPSBlZGl0b3IuaW5saW5lID8gZWRpdG9yLmdldEVsZW1lbnQoKSA6IGVkaXRvci5nZXRDb250ZW50QXJlYUNvbnRhaW5lcigpO1xuXHRcdFx0XHRmaXJzdEl0ZW0ubW92ZVJlbChjb250YWluZXIsICd0Yy10YycpO1xuXHRcdFx0XHRpZiAobm90aWZpY2F0aW9ucy5sZW5ndGggPiAxKSB7XG5cdFx0XHRcdFx0Zm9yICh2YXIgaSA9IDE7IGkgPCBub3RpZmljYXRpb25zLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRcdFx0XHRub3RpZmljYXRpb25zW2ldLm1vdmVSZWwobm90aWZpY2F0aW9uc1tpIC0gMV0uZ2V0RWwoKSwgJ2JjLXRjJyk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0ZWRpdG9yLm9uKCdyZW1vdmUnLCBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBpID0gbm90aWZpY2F0aW9ucy5sZW5ndGg7XG5cblx0XHRcdHdoaWxlIChpLS0pIHtcblx0XHRcdFx0bm90aWZpY2F0aW9uc1tpXS5jbG9zZSgpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0ZWRpdG9yLm9uKCdSZXNpemVFZGl0b3InLCBwb3NpdGlvbk5vdGlmaWNhdGlvbnMpO1xuXHRcdGVkaXRvci5vbignUmVzaXplV2luZG93JywgcmVzaXplV2luZG93RXZlbnQpO1xuXG5cdFx0LyoqXG5cdFx0ICogT3BlbnMgYSBuZXcgbm90aWZpY2F0aW9uLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBvcGVuXG5cdFx0ICogQHBhcmFtIHtPYmplY3R9IGFyZ3MgT3B0aW9uYWwgbmFtZS92YWx1ZSBzZXR0aW5ncyBjb2xsZWN0aW9uIGNvbnRhaW5zIHRoaW5ncyBsaWtlIHRpbWVvdXQvY29sb3IvbWVzc2FnZSBldGMuXG5cdFx0ICovXG5cdFx0c2VsZi5vcGVuID0gZnVuY3Rpb24oYXJncykge1xuXHRcdFx0Ly8gTmV2ZXIgb3BlbiBub3RpZmljYXRpb24gaWYgZWRpdG9yIGhhcyBiZWVuIHJlbW92ZWQuXG5cdFx0XHRpZiAoZWRpdG9yLnJlbW92ZWQpIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHR2YXIgbm90aWY7XG5cblx0XHRcdGVkaXRvci5lZGl0b3JNYW5hZ2VyLnNldEFjdGl2ZShlZGl0b3IpO1xuXG5cdFx0XHR2YXIgZHVwbGljYXRlID0gZmluZER1cGxpY2F0ZU1lc3NhZ2Uobm90aWZpY2F0aW9ucywgYXJncyk7XG5cblx0XHRcdGlmIChkdXBsaWNhdGUgPT09IG51bGwpIHtcblx0XHRcdFx0bm90aWYgPSBuZXcgTm90aWZpY2F0aW9uKGFyZ3MpO1xuXHRcdFx0XHRub3RpZmljYXRpb25zLnB1c2gobm90aWYpO1xuXG5cdFx0XHRcdC8vSWYgd2UgaGF2ZSBhIHRpbWVvdXQgdmFsdWVcblx0XHRcdFx0aWYgKGFyZ3MudGltZW91dCA+IDApIHtcblx0XHRcdFx0XHRcdG5vdGlmLnRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRcdFx0bm90aWYuY2xvc2UoKTtcblx0XHRcdFx0XHRcdH0sIGFyZ3MudGltZW91dCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRub3RpZi5vbignY2xvc2UnLCBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHR2YXIgaSA9IG5vdGlmaWNhdGlvbnMubGVuZ3RoO1xuXG5cdFx0XHRcdFx0aWYgKG5vdGlmLnRpbWVyKSB7XG5cdFx0XHRcdFx0XHRlZGl0b3IuZ2V0V2luKCkuY2xlYXJUaW1lb3V0KG5vdGlmLnRpbWVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHR3aGlsZSAoaS0tKSB7XG5cdFx0XHRcdFx0XHRpZiAobm90aWZpY2F0aW9uc1tpXSA9PT0gbm90aWYpIHtcblx0XHRcdFx0XHRcdFx0bm90aWZpY2F0aW9ucy5zcGxpY2UoaSwgMSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cG9zaXRpb25Ob3RpZmljYXRpb25zKCk7XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdG5vdGlmLnJlbmRlclRvKCk7XG5cblx0XHRcdFx0cG9zaXRpb25Ob3RpZmljYXRpb25zKCk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRub3RpZiA9IGR1cGxpY2F0ZTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG5vdGlmO1xuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBDbG9zZXMgdGhlIHRvcCBtb3N0IG5vdGlmaWNhdGlvbi5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgY2xvc2Vcblx0XHQgKi9cblx0XHRzZWxmLmNsb3NlID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRpZiAoZ2V0TGFzdE5vdGlmaWNhdGlvbigpKSB7XG5cdFx0XHRcdGdldExhc3ROb3RpZmljYXRpb24oKS5jbG9zZSgpO1xuXHRcdFx0fVxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBSZXR1cm5zIHRoZSBjdXJyZW50bHkgb3BlbmVkIG5vdGlmaWNhdGlvbiBvYmplY3RzLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBnZXROb3RpZmljYXRpb25zXG5cdFx0ICogQHJldHVybiB7QXJyYXl9IEFycmF5IG9mIHRoZSBjdXJyZW50bHkgb3BlbmVkIG5vdGlmaWNhdGlvbnMuXG5cdFx0ICovXG5cdFx0c2VsZi5nZXROb3RpZmljYXRpb25zID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gbm90aWZpY2F0aW9ucztcblx0XHR9O1xuXG5cdFx0ZWRpdG9yLm9uKCdTa2luTG9hZGVkJywgZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VydmljZU1lc3NhZ2UgPSBlZGl0b3Iuc2V0dGluZ3Muc2VydmljZV9tZXNzYWdlO1xuXG5cdFx0XHRpZiAoc2VydmljZU1lc3NhZ2UpIHtcblx0XHRcdFx0ZWRpdG9yLm5vdGlmaWNhdGlvbk1hbmFnZXIub3Blbih7XG5cdFx0XHRcdFx0dGV4dDogc2VydmljZU1lc3NhZ2UsXG5cdFx0XHRcdFx0dHlwZTogJ3dhcm5pbmcnLFxuXHRcdFx0XHRcdHRpbWVvdXQ6IDAsXG5cdFx0XHRcdFx0aWNvbjogJydcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHQvKipcblx0XHQgKiBGaW5kcyBhbnkgZXhpc3Rpbmcgbm90aWZpY2F0aW9uIHdpdGggdGhlIHNhbWUgcHJvcGVydGllcyBhcyB0aGUgbmV3IG9uZS5cblx0XHQgKiBSZXR1cm5zIGVpdGhlciB0aGUgZm91bmQgbm90aWZpY2F0aW9uIG9yIG51bGwuXG5cdFx0ICpcblx0XHQgKiBAcGFyYW0ge05vdGlmaWNhdGlvbltdfSBub3RpZmljYXRpb25BcnJheSAtIEFycmF5IG9mIGN1cnJlbnQgbm90aWZpY2F0aW9uc1xuXHRcdCAqIEBwYXJhbSB7dHlwZTogc3RyaW5nLCB9IG5ld05vdGlmaWNhdGlvbiAtIE5ldyBub3RpZmljYXRpb24gb2JqZWN0XG5cdFx0ICogQHJldHVybnMgez9Ob3RpZmljYXRpb259XG5cdFx0ICovXG5cdFx0ZnVuY3Rpb24gZmluZER1cGxpY2F0ZU1lc3NhZ2Uobm90aWZpY2F0aW9uQXJyYXksIG5ld05vdGlmaWNhdGlvbikge1xuXHRcdFx0aWYgKCFpc1BsYWluVGV4dE5vdGlmaWNhdGlvbihuZXdOb3RpZmljYXRpb24pKSB7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXG5cdFx0XHR2YXIgZmlsdGVyZWROb3RpZmljYXRpb25zID0gVG9vbHMuZ3JlcChub3RpZmljYXRpb25BcnJheSwgZnVuY3Rpb24gKG5vdGlmaWNhdGlvbikge1xuXHRcdFx0XHRyZXR1cm4gaXNTYW1lTm90aWZpY2F0aW9uKG5ld05vdGlmaWNhdGlvbiwgbm90aWZpY2F0aW9uKTtcblx0XHRcdH0pO1xuXG5cdFx0XHRyZXR1cm4gZmlsdGVyZWROb3RpZmljYXRpb25zLmxlbmd0aCA9PT0gMCA/IG51bGwgOiBmaWx0ZXJlZE5vdGlmaWNhdGlvbnNbMF07XG5cdFx0fVxuXG5cdFx0LyoqXG5cdFx0ICogQ2hlY2tzIGlmIHRoZSBwYXNzZWQgaW4gYXJncyBvYmplY3QgaGFzIHRoZSBzYW1lXG5cdFx0ICogdHlwZSBhbmQgdGV4dCBwcm9wZXJ0aWVzIGFzIHRoZSBzZW50IGluIG5vdGlmaWNhdGlvbi5cblx0XHQgKlxuXHRcdCAqIEBwYXJhbSB7dHlwZTogc3RyaW5nLCB0ZXh0OiBzdHJpbmd9IGEgLSBOZXcgbm90aWZpY2F0aW9uIGFyZ3Mgb2JqZWN0XG5cdFx0ICogQHBhcmFtIHtOb3RpZmljYXRpb259IGIgLSBPbGQgbm90aWZpY2F0aW9uXG5cdFx0ICogQHJldHVybnMge2Jvb2xlYW59XG5cdFx0ICovXG5cdFx0ZnVuY3Rpb24gaXNTYW1lTm90aWZpY2F0aW9uKGEsIGIpIHtcblx0XHRcdHJldHVybiBhLnR5cGUgPT09IGIuc2V0dGluZ3MudHlwZSAmJiBhLnRleHQgPT09IGIuc2V0dGluZ3MudGV4dDtcblx0XHR9XG5cblx0XHQvKipcblx0XHQgKiBDaGVja3MgdGhhdCB0aGUgbm90aWZpY2F0aW9uIGRvZXMgbm90IGhhdmUgYSBwcm9ncmVzc0JhclxuXHRcdCAqIG9yIHRpbWVvdXIgcHJvcGVydHkuXG5cdFx0ICpcblx0XHQgKiBAcGFyYW0ge05vdGlmaWNhdGlvbn0gbm90aWZpY2F0aW9uIC0gTm90aWZpY2F0aW9uIHRvIGNoZWNrXG5cdFx0ICogQHJldHVybnMge2Jvb2xlYW59XG5cdFx0ICovXG5cdFx0ZnVuY3Rpb24gaXNQbGFpblRleHROb3RpZmljYXRpb24obm90aWZpY2F0aW9uKSB7XG5cdFx0XHRyZXR1cm4gIW5vdGlmaWNhdGlvbi5wcm9ncmVzc0JhciAmJiAhbm90aWZpY2F0aW9uLnRpbWVvdXQ7XG5cdFx0fVxuXG5cdFx0Ly9zZWxmLnBvc2l0aW9uTm90aWZpY2F0aW9ucyA9IHBvc2l0aW9uTm90aWZpY2F0aW9ucztcblx0fTtcbn0pO1xuXG4vLyBJbmNsdWRlZCBmcm9tOiBqcy90aW55bWNlL2NsYXNzZXMvZG9tL05vZGVQYXRoLmpzXG5cbi8qKlxuICogTm9kZVBhdGguanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBIYW5kbGVzIHBhdGhzIG9mIG5vZGVzIHdpdGhpbiBhbiBlbGVtZW50LlxuICpcbiAqIEBwcml2YXRlXG4gKiBAY2xhc3MgdGlueW1jZS5kb20uTm9kZVBhdGhcbiAqL1xuZGVmaW5lKFwidGlueW1jZS9kb20vTm9kZVBhdGhcIiwgW1xuXHRcInRpbnltY2UvZG9tL0RPTVV0aWxzXCJcbl0sIGZ1bmN0aW9uKERPTVV0aWxzKSB7XG5cdGZ1bmN0aW9uIGNyZWF0ZShyb290Tm9kZSwgdGFyZ2V0Tm9kZSwgbm9ybWFsaXplZCkge1xuXHRcdHZhciBwYXRoID0gW107XG5cblx0XHRmb3IgKDsgdGFyZ2V0Tm9kZSAmJiB0YXJnZXROb2RlICE9IHJvb3ROb2RlOyB0YXJnZXROb2RlID0gdGFyZ2V0Tm9kZS5wYXJlbnROb2RlKSB7XG5cdFx0XHRwYXRoLnB1c2goRE9NVXRpbHMubm9kZUluZGV4KHRhcmdldE5vZGUsIG5vcm1hbGl6ZWQpKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gcGF0aDtcblx0fVxuXG5cdGZ1bmN0aW9uIHJlc29sdmUocm9vdE5vZGUsIHBhdGgpIHtcblx0XHR2YXIgaSwgbm9kZSwgY2hpbGRyZW47XG5cblx0XHRmb3IgKG5vZGUgPSByb290Tm9kZSwgaSA9IHBhdGgubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcblx0XHRcdGNoaWxkcmVuID0gbm9kZS5jaGlsZE5vZGVzO1xuXG5cdFx0XHRpZiAocGF0aFtpXSA+IGNoaWxkcmVuLmxlbmd0aCAtIDEpIHtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cblx0XHRcdG5vZGUgPSBjaGlsZHJlbltwYXRoW2ldXTtcblx0XHR9XG5cblx0XHRyZXR1cm4gbm9kZTtcblx0fVxuXG5cdHJldHVybiB7XG5cdFx0Y3JlYXRlOiBjcmVhdGUsXG5cdFx0cmVzb2x2ZTogcmVzb2x2ZVxuXHR9O1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy91dGlsL1F1aXJrcy5qc1xuXG4vKipcbiAqIFF1aXJrcy5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE1IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqXG4gKiBAaWdub3JlLWZpbGVcbiAqL1xuXG4vKipcbiAqIFRoaXMgZmlsZSBpbmNsdWRlcyBmaXhlcyBmb3IgdmFyaW91cyBicm93c2VyIHF1aXJrcyBpdCdzIG1hZGUgdG8gbWFrZSBpdCBlYXN5IHRvIGFkZC9yZW1vdmUgYnJvd3NlciBzcGVjaWZpYyBmaXhlcy5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQGNsYXNzIHRpbnltY2UudXRpbC5RdWlya3NcbiAqL1xuZGVmaW5lKFwidGlueW1jZS91dGlsL1F1aXJrc1wiLCBbXG5cdFwidGlueW1jZS91dGlsL1ZLXCIsXG5cdFwidGlueW1jZS9kb20vUmFuZ2VVdGlsc1wiLFxuXHRcInRpbnltY2UvZG9tL1RyZWVXYWxrZXJcIixcblx0XCJ0aW55bWNlL2RvbS9Ob2RlUGF0aFwiLFxuXHRcInRpbnltY2UvaHRtbC9Ob2RlXCIsXG5cdFwidGlueW1jZS9odG1sL0VudGl0aWVzXCIsXG5cdFwidGlueW1jZS9FbnZcIixcblx0XCJ0aW55bWNlL3V0aWwvVG9vbHNcIixcblx0XCJ0aW55bWNlL3V0aWwvRGVsYXlcIixcblx0XCJ0aW55bWNlL2NhcmV0L0NhcmV0Q29udGFpbmVyXCIsXG5cdFwidGlueW1jZS9jYXJldC9DYXJldFBvc2l0aW9uXCIsXG5cdFwidGlueW1jZS9jYXJldC9DYXJldFdhbGtlclwiXG5dLCBmdW5jdGlvbihWSywgUmFuZ2VVdGlscywgVHJlZVdhbGtlciwgTm9kZVBhdGgsIE5vZGUsIEVudGl0aWVzLCBFbnYsIFRvb2xzLCBEZWxheSwgQ2FyZXRDb250YWluZXIsIENhcmV0UG9zaXRpb24sIENhcmV0V2Fsa2VyKSB7XG5cdHJldHVybiBmdW5jdGlvbihlZGl0b3IpIHtcblx0XHR2YXIgZWFjaCA9IFRvb2xzLmVhY2gsICQgPSBlZGl0b3IuJDtcblx0XHR2YXIgQkFDS1NQQUNFID0gVksuQkFDS1NQQUNFLCBERUxFVEUgPSBWSy5ERUxFVEUsIGRvbSA9IGVkaXRvci5kb20sIHNlbGVjdGlvbiA9IGVkaXRvci5zZWxlY3Rpb24sXG5cdFx0XHRzZXR0aW5ncyA9IGVkaXRvci5zZXR0aW5ncywgcGFyc2VyID0gZWRpdG9yLnBhcnNlciwgc2VyaWFsaXplciA9IGVkaXRvci5zZXJpYWxpemVyO1xuXHRcdHZhciBpc0dlY2tvID0gRW52LmdlY2tvLCBpc0lFID0gRW52LmllLCBpc1dlYktpdCA9IEVudi53ZWJraXQ7XG5cdFx0dmFyIG1jZUludGVybmFsVXJsUHJlZml4ID0gJ2RhdGE6dGV4dC9tY2UtaW50ZXJuYWwsJztcblx0XHR2YXIgbWNlSW50ZXJuYWxEYXRhVHlwZSA9IGlzSUUgPyAnVGV4dCcgOiAnVVJMJztcblxuXHRcdC8qKlxuXHRcdCAqIEV4ZWN1dGVzIGEgY29tbWFuZCB3aXRoIGEgc3BlY2lmaWMgc3RhdGUgdGhpcyBjYW4gYmUgdG8gZW5hYmxlL2Rpc2FibGUgYnJvd3NlciBlZGl0aW5nIGZlYXR1cmVzLlxuXHRcdCAqL1xuXHRcdGZ1bmN0aW9uIHNldEVkaXRvckNvbW1hbmRTdGF0ZShjbWQsIHN0YXRlKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRlZGl0b3IuZ2V0RG9jKCkuZXhlY0NvbW1hbmQoY21kLCBmYWxzZSwgc3RhdGUpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0Ly8gSWdub3JlXG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyBjdXJyZW50IElFIGRvY3VtZW50IG1vZGUuXG5cdFx0ICovXG5cdFx0ZnVuY3Rpb24gZ2V0RG9jdW1lbnRNb2RlKCkge1xuXHRcdFx0dmFyIGRvY3VtZW50TW9kZSA9IGVkaXRvci5nZXREb2MoKS5kb2N1bWVudE1vZGU7XG5cblx0XHRcdHJldHVybiBkb2N1bWVudE1vZGUgPyBkb2N1bWVudE1vZGUgOiA2O1xuXHRcdH1cblxuXHRcdC8qKlxuXHRcdCAqIFJldHVybnMgdHJ1ZS9mYWxzZSBpZiB0aGUgZXZlbnQgaXMgcHJldmVudGVkIG9yIG5vdC5cblx0XHQgKlxuXHRcdCAqIEBwcml2YXRlXG5cdFx0ICogQHBhcmFtIHtFdmVudH0gZSBFdmVudCBvYmplY3QuXG5cdFx0ICogQHJldHVybiB7Qm9vbGVhbn0gdHJ1ZS9mYWxzZSBpZiB0aGUgZXZlbnQgaXMgcHJldmVudGVkIG9yIG5vdC5cblx0XHQgKi9cblx0XHRmdW5jdGlvbiBpc0RlZmF1bHRQcmV2ZW50ZWQoZSkge1xuXHRcdFx0cmV0dXJuIGUuaXNEZWZhdWx0UHJldmVudGVkKCk7XG5cdFx0fVxuXG5cdFx0LyoqXG5cdFx0ICogU2V0cyBUZXh0L1VSTCBkYXRhIG9uIHRoZSBldmVudCdzIGRhdGFUcmFuc2ZlciBvYmplY3QgdG8gYSBzcGVjaWFsIGRhdGE6dGV4dC9tY2UtaW50ZXJuYWwgdXJsLlxuXHRcdCAqIFRoaXMgaXMgdG8gd29ya2Fyb3VuZCB0aGUgaW5hYmlsaXR5IHRvIHNldCBjdXN0b20gY29udGVudFR5cGUgb24gSUUgYW5kIFNhZmFyaS5cblx0XHQgKiBUaGUgZWRpdG9yJ3Mgc2VsZWN0ZWQgY29udGVudCBpcyBlbmNvZGVkIGludG8gdGhpcyB1cmwgc28gZHJhZyBhbmQgZHJvcCBiZXR3ZWVuIGVkaXRvcnMgd2lsbCB3b3JrLlxuXHRcdCAqXG5cdFx0ICogQHByaXZhdGVcblx0XHQgKiBAcGFyYW0ge0RyYWdFdmVudH0gZSBFdmVudCBvYmplY3Rcblx0XHQgKi9cblx0XHRmdW5jdGlvbiBzZXRNY2VJbnRlcm5hbENvbnRlbnQoZSkge1xuXHRcdFx0dmFyIHNlbGVjdGlvbkh0bWwsIGludGVybmFsQ29udGVudDtcblxuXHRcdFx0aWYgKGUuZGF0YVRyYW5zZmVyKSB7XG5cdFx0XHRcdGlmIChlZGl0b3Iuc2VsZWN0aW9uLmlzQ29sbGFwc2VkKCkgJiYgZS50YXJnZXQudGFnTmFtZSA9PSAnSU1HJykge1xuXHRcdFx0XHRcdHNlbGVjdGlvbi5zZWxlY3QoZS50YXJnZXQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0c2VsZWN0aW9uSHRtbCA9IGVkaXRvci5zZWxlY3Rpb24uZ2V0Q29udGVudCgpO1xuXG5cdFx0XHRcdC8vIFNhZmFyaS9JRSBkb2Vzbid0IHN1cHBvcnQgY3VzdG9tIGRhdGFUcmFuc2ZlciBpdGVtcyBzbyB3ZSBjYW4gb25seSB1c2UgVVJMIGFuZCBUZXh0XG5cdFx0XHRcdGlmIChzZWxlY3Rpb25IdG1sLmxlbmd0aCA+IDApIHtcblx0XHRcdFx0XHRpbnRlcm5hbENvbnRlbnQgPSBtY2VJbnRlcm5hbFVybFByZWZpeCArIGVzY2FwZShlZGl0b3IuaWQpICsgJywnICsgZXNjYXBlKHNlbGVjdGlvbkh0bWwpO1xuXHRcdFx0XHRcdGUuZGF0YVRyYW5zZmVyLnNldERhdGEobWNlSW50ZXJuYWxEYXRhVHlwZSwgaW50ZXJuYWxDb250ZW50KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8qKlxuXHRcdCAqIEdldHMgY29udGVudCBvZiBzcGVjaWFsIGRhdGE6dGV4dC9tY2UtaW50ZXJuYWwgdXJsIG9uIHRoZSBldmVudCdzIGRhdGFUcmFuc2ZlciBvYmplY3QuXG5cdFx0ICogVGhpcyBpcyB0byB3b3JrYXJvdW5kIHRoZSBpbmFiaWxpdHkgdG8gc2V0IGN1c3RvbSBjb250ZW50VHlwZSBvbiBJRSBhbmQgU2FmYXJpLlxuXHRcdCAqIFRoZSBlZGl0b3IncyBzZWxlY3RlZCBjb250ZW50IGlzIGVuY29kZWQgaW50byB0aGlzIHVybCBzbyBkcmFnIGFuZCBkcm9wIGJldHdlZW4gZWRpdG9ycyB3aWxsIHdvcmsuXG5cdFx0ICpcblx0XHQgKiBAcHJpdmF0ZVxuXHRcdCAqIEBwYXJhbSB7RHJhZ0V2ZW50fSBlIEV2ZW50IG9iamVjdFxuXHRcdCAqIEByZXR1cm5zIHtTdHJpbmd9IG1jZS1pbnRlcm5hbCBjb250ZW50XG5cdFx0ICovXG5cdFx0ZnVuY3Rpb24gZ2V0TWNlSW50ZXJuYWxDb250ZW50KGUpIHtcblx0XHRcdHZhciBpbnRlcm5hbENvbnRlbnQ7XG5cblx0XHRcdGlmIChlLmRhdGFUcmFuc2Zlcikge1xuXHRcdFx0XHRpbnRlcm5hbENvbnRlbnQgPSBlLmRhdGFUcmFuc2Zlci5nZXREYXRhKG1jZUludGVybmFsRGF0YVR5cGUpO1xuXG5cdFx0XHRcdGlmIChpbnRlcm5hbENvbnRlbnQgJiYgaW50ZXJuYWxDb250ZW50LmluZGV4T2YobWNlSW50ZXJuYWxVcmxQcmVmaXgpID49IDApIHtcblx0XHRcdFx0XHRpbnRlcm5hbENvbnRlbnQgPSBpbnRlcm5hbENvbnRlbnQuc3Vic3RyKG1jZUludGVybmFsVXJsUHJlZml4Lmxlbmd0aCkuc3BsaXQoJywnKTtcblxuXHRcdFx0XHRcdHJldHVybiB7XG5cdFx0XHRcdFx0XHRpZDogdW5lc2NhcGUoaW50ZXJuYWxDb250ZW50WzBdKSxcblx0XHRcdFx0XHRcdGh0bWw6IHVuZXNjYXBlKGludGVybmFsQ29udGVudFsxXSlcblx0XHRcdFx0XHR9O1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblxuXHRcdC8qKlxuXHRcdCAqIEluc2VydHMgY29udGVudHMgdXNpbmcgdGhlIHBhc3RlIGNsaXBib2FyZCBjb21tYW5kIGlmIGl0J3MgYXZhaWxhYmxlIGlmIGl0IGlzbid0IGl0IHdpbGwgZmFsbGJhY2tcblx0XHQgKiB0byB0aGUgY29yZSBjb21tYW5kLlxuXHRcdCAqXG5cdFx0ICogQHByaXZhdGVcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gY29udGVudCBDb250ZW50IHRvIGluc2VydCBhdCBzZWxlY3Rpb24uXG5cdFx0ICovXG5cdFx0ZnVuY3Rpb24gaW5zZXJ0Q2xpcGJvYXJkQ29udGVudHMoY29udGVudCkge1xuXHRcdFx0aWYgKGVkaXRvci5xdWVyeUNvbW1hbmRTdXBwb3J0ZWQoJ21jZUluc2VydENsaXBib2FyZENvbnRlbnQnKSkge1xuXHRcdFx0XHRlZGl0b3IuZXhlY0NvbW1hbmQoJ21jZUluc2VydENsaXBib2FyZENvbnRlbnQnLCBmYWxzZSwge2NvbnRlbnQ6IGNvbnRlbnR9KTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGVkaXRvci5leGVjQ29tbWFuZCgnbWNlSW5zZXJ0Q29udGVudCcsIGZhbHNlLCBjb250ZW50KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHQvKipcblx0XHQgKiBGaXhlcyBhIFdlYktpdCBidWcgd2hlbiBkZWxldGluZyBjb250ZW50cyB1c2luZyBiYWNrc3BhY2Ugb3IgZGVsZXRlIGtleS5cblx0XHQgKiBXZWJLaXQgd2lsbCBwcm9kdWNlIGEgc3BhbiBlbGVtZW50IGlmIHlvdSBkZWxldGUgYWNyb3NzIHR3byBibG9jayBlbGVtZW50cy5cblx0XHQgKlxuXHRcdCAqIEV4YW1wbGU6XG5cdFx0ICogPGgxPmE8L2gxPjxwPnxiPC9wPlxuXHRcdCAqXG5cdFx0ICogV2lsbCBwcm9kdWNlIHRoaXMgb24gYmFja3NwYWNlOlxuXHRcdCAqIDxoMT5hPHNwYW4gc3R5bGU9XCI8YWxsIHJ1bnRpbWUgc3R5bGVzPlwiPmI8L3NwYW4+PC9wPlxuXHRcdCAqXG5cdFx0ICogVGhpcyBmaXhlcyB0aGUgYmFja3NwYWNlIHRvIHByb2R1Y2U6XG5cdFx0ICogPGgxPmF8YjwvcD5cblx0XHQgKlxuXHRcdCAqIFNlZSBidWc6IGh0dHBzOi8vYnVncy53ZWJraXQub3JnL3Nob3dfYnVnLmNnaT9pZD00NTc4NFxuXHRcdCAqXG5cdFx0ICogVGhpcyBmaXhlcyB0aGUgZm9sbG93aW5nIGRlbGV0ZSBzY2VuYXJpb3M6XG5cdFx0ICogIDEuIERlbGV0ZSBieSBwcmVzc2luZyBiYWNrc3BhY2Uga2V5LlxuXHRcdCAqICAyLiBEZWxldGUgYnkgcHJlc3NpbmcgZGVsZXRlIGtleS5cblx0XHQgKiAgMy4gRGVsZXRlIGJ5IHByZXNzaW5nIGJhY2tzcGFjZSBrZXkgd2l0aCBjdHJsL2NtZCAoV29yZCBkZWxldGUpLlxuXHRcdCAqICA0LiBEZWxldGUgYnkgcHJlc3NpbmcgZGVsZXRlIGtleSB3aXRoIGN0cmwvY21kIChXb3JkIGRlbGV0ZSkuXG5cdFx0ICogIDUuIERlbGV0ZSBieSBkcmFnL2Ryb3BwaW5nIGNvbnRlbnRzIGluc2lkZSB0aGUgZWRpdG9yLlxuXHRcdCAqICA2LiBEZWxldGUgYnkgdXNpbmcgQ3V0IEN0cmwrWC9DbWQrWC5cblx0XHQgKiAgNy4gRGVsZXRlIGJ5IHNlbGVjdGluZyBjb250ZW50cyBhbmQgd3JpdGluZyBhIGNoYXJhY3Rlci5cblx0XHQgKlxuXHRcdCAqIFRoaXMgY29kZSBpcyBhIHVnbHkgaGFjayBzaW5jZSB3cml0aW5nIGZ1bGwgY3VzdG9tIGRlbGV0ZSBsb2dpYyBmb3IganVzdCB0aGlzIGJ1Z1xuXHRcdCAqIGZpeCBzZWVtZWQgbGlrZSBhIGh1Z2UgdGFzay4gSSBob3BlIHdlIGNhbiByZW1vdmUgdGhpcyBiZWZvcmUgdGhlIHllYXIgMjAzMC5cblx0XHQgKi9cblx0XHRmdW5jdGlvbiBjbGVhbnVwU3R5bGVzV2hlbkRlbGV0aW5nKCkge1xuXHRcdFx0dmFyIGRvYyA9IGVkaXRvci5nZXREb2MoKSwgZG9tID0gZWRpdG9yLmRvbSwgc2VsZWN0aW9uID0gZWRpdG9yLnNlbGVjdGlvbjtcblx0XHRcdHZhciBNdXRhdGlvbk9ic2VydmVyID0gd2luZG93Lk11dGF0aW9uT2JzZXJ2ZXIsIG9sZGVyV2ViS2l0LCBkcmFnU3RhcnRSbmc7XG5cblx0XHRcdC8vIEFkZCBtaW5pIHBvbHlmaWxsIGZvciBvbGRlciBXZWJLaXRzXG5cdFx0XHQvLyBUT0RPOiBSZW1vdmUgdGhpcyB3aGVuIG9sZCBTYWZhcmkgdmVyc2lvbnMgZ2V0cyB1cGRhdGVkXG5cdFx0XHRpZiAoIU11dGF0aW9uT2JzZXJ2ZXIpIHtcblx0XHRcdFx0b2xkZXJXZWJLaXQgPSB0cnVlO1xuXG5cdFx0XHRcdE11dGF0aW9uT2JzZXJ2ZXIgPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHR2YXIgcmVjb3JkcyA9IFtdLCB0YXJnZXQ7XG5cblx0XHRcdFx0XHRmdW5jdGlvbiBub2RlSW5zZXJ0KGUpIHtcblx0XHRcdFx0XHRcdHZhciB0YXJnZXQgPSBlLnJlbGF0ZWROb2RlIHx8IGUudGFyZ2V0O1xuXHRcdFx0XHRcdFx0cmVjb3Jkcy5wdXNoKHt0YXJnZXQ6IHRhcmdldCwgYWRkZWROb2RlczogW3RhcmdldF19KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRmdW5jdGlvbiBhdHRyTW9kaWZpZWQoZSkge1xuXHRcdFx0XHRcdFx0dmFyIHRhcmdldCA9IGUucmVsYXRlZE5vZGUgfHwgZS50YXJnZXQ7XG5cdFx0XHRcdFx0XHRyZWNvcmRzLnB1c2goe3RhcmdldDogdGFyZ2V0LCBhdHRyaWJ1dGVOYW1lOiBlLmF0dHJOYW1lfSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0dGhpcy5vYnNlcnZlID0gZnVuY3Rpb24obm9kZSkge1xuXHRcdFx0XHRcdFx0dGFyZ2V0ID0gbm9kZTtcblx0XHRcdFx0XHRcdHRhcmdldC5hZGRFdmVudExpc3RlbmVyKCdET01TdWJ0cmVlTW9kaWZpZWQnLCBub2RlSW5zZXJ0LCBmYWxzZSk7XG5cdFx0XHRcdFx0XHR0YXJnZXQuYWRkRXZlbnRMaXN0ZW5lcignRE9NTm9kZUluc2VydGVkSW50b0RvY3VtZW50Jywgbm9kZUluc2VydCwgZmFsc2UpO1xuXHRcdFx0XHRcdFx0dGFyZ2V0LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTU5vZGVJbnNlcnRlZCcsIG5vZGVJbnNlcnQsIGZhbHNlKTtcblx0XHRcdFx0XHRcdHRhcmdldC5hZGRFdmVudExpc3RlbmVyKCdET01BdHRyTW9kaWZpZWQnLCBhdHRyTW9kaWZpZWQsIGZhbHNlKTtcblx0XHRcdFx0XHR9O1xuXG5cdFx0XHRcdFx0dGhpcy5kaXNjb25uZWN0ID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0XHR0YXJnZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcignRE9NU3VidHJlZU1vZGlmaWVkJywgbm9kZUluc2VydCwgZmFsc2UpO1xuXHRcdFx0XHRcdFx0dGFyZ2V0LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ0RPTU5vZGVJbnNlcnRlZEludG9Eb2N1bWVudCcsIG5vZGVJbnNlcnQsIGZhbHNlKTtcblx0XHRcdFx0XHRcdHRhcmdldC5yZW1vdmVFdmVudExpc3RlbmVyKCdET01Ob2RlSW5zZXJ0ZWQnLCBub2RlSW5zZXJ0LCBmYWxzZSk7XG5cdFx0XHRcdFx0XHR0YXJnZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcignRE9NQXR0ck1vZGlmaWVkJywgYXR0ck1vZGlmaWVkLCBmYWxzZSk7XG5cdFx0XHRcdFx0fTtcblxuXHRcdFx0XHRcdHRoaXMudGFrZVJlY29yZHMgPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRcdHJldHVybiByZWNvcmRzO1xuXHRcdFx0XHRcdH07XG5cdFx0XHRcdH07XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIGlzVHJhaWxpbmdCcihub2RlKSB7XG5cdFx0XHRcdHZhciBibG9ja0VsZW1lbnRzID0gZG9tLnNjaGVtYS5nZXRCbG9ja0VsZW1lbnRzKCksIHJvb3ROb2RlID0gZWRpdG9yLmdldEJvZHkoKTtcblxuXHRcdFx0XHRpZiAobm9kZS5ub2RlTmFtZSAhPSAnQlInKSB7XG5cdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Zm9yICg7IG5vZGUgIT0gcm9vdE5vZGUgJiYgIWJsb2NrRWxlbWVudHNbbm9kZS5ub2RlTmFtZV07IG5vZGUgPSBub2RlLnBhcmVudE5vZGUpIHtcblx0XHRcdFx0XHRpZiAobm9kZS5uZXh0U2libGluZykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0fVxuXG5cdFx0XHRmdW5jdGlvbiBpc1NpYmxpbmdzSWdub3JlV2hpdGVTcGFjZShub2RlMSwgbm9kZTIpIHtcblx0XHRcdFx0dmFyIG5vZGU7XG5cblx0XHRcdFx0Zm9yIChub2RlID0gbm9kZTEubmV4dFNpYmxpbmc7IG5vZGUgJiYgbm9kZSAhPSBub2RlMjsgbm9kZSA9IG5vZGUubmV4dFNpYmxpbmcpIHtcblx0XHRcdFx0XHRpZiAobm9kZS5ub2RlVHlwZSA9PSAzICYmICQudHJpbShub2RlLmRhdGEpLmxlbmd0aCA9PT0gMCkge1xuXHRcdFx0XHRcdFx0Y29udGludWU7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKG5vZGUgIT09IG5vZGUyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG5vZGUgPT09IG5vZGUyO1xuXHRcdFx0fVxuXG5cdFx0XHRmdW5jdGlvbiBmaW5kQ2FyZXROb2RlKG5vZGUsIGZvcndhcmQsIHN0YXJ0Tm9kZSkge1xuXHRcdFx0XHR2YXIgd2Fsa2VyLCBjdXJyZW50LCBub25FbXB0eUVsZW1lbnRzO1xuXG5cdFx0XHRcdC8vIFByb3RlY3QgYWdhaW5zdCB0aGUgcG9zc2liaWxpdHkgd2UgYXJlIGFza2VkIHRvIGZpbmQgYSBjYXJldCBub2RlIHJlbGF0aXZlXG5cdFx0XHRcdC8vIHRvIGEgbm9kZSB0aGF0IGlzIG5vIGxvbmdlciBpbiB0aGUgRE9NIHRyZWUuIEluIHRoaXMgY2FzZSBhdHRlbXB0aW5nIHRvXG5cdFx0XHRcdC8vIHNlbGVjdCBvbiBhbnkgbWF0Y2ggbGVhZHMgdG8gYSBzY2VuYXJpbyB3aGVyZSBzZWxlY3Rpb24gaXMgY29tcGxldGVseSByZW1vdmVkXG5cdFx0XHRcdC8vIGZyb20gdGhlIGVkaXRvci4gVGhpcyBzY2VuYXJpbyBpcyBtZXQgaW4gcmVhbCB3b3JsZCBhdCBhIG1pbmltdW0gb25cblx0XHRcdFx0Ly8gV2ViS2l0IGJyb3dzZXJzIHdoZW4gc2VsZWN0aW5nIGFsbCBhbmQgQ21kLVggY3V0dGluZyB0byBkZWxldGUgY29udGVudC5cblx0XHRcdFx0aWYgKCFkb20uaXNDaGlsZE9mKG5vZGUsIGVkaXRvci5nZXRCb2R5KCkpKSB7XG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0bm9uRW1wdHlFbGVtZW50cyA9IGRvbS5zY2hlbWEuZ2V0Tm9uRW1wdHlFbGVtZW50cygpO1xuXG5cdFx0XHRcdHdhbGtlciA9IG5ldyBUcmVlV2Fsa2VyKHN0YXJ0Tm9kZSB8fCBub2RlLCBub2RlKTtcblxuXHRcdFx0XHR3aGlsZSAoKGN1cnJlbnQgPSB3YWxrZXJbZm9yd2FyZCA/ICduZXh0JyA6ICdwcmV2J10oKSkpIHtcblx0XHRcdFx0XHRpZiAobm9uRW1wdHlFbGVtZW50c1tjdXJyZW50Lm5vZGVOYW1lXSAmJiAhaXNUcmFpbGluZ0JyKGN1cnJlbnQpKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gY3VycmVudDtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoY3VycmVudC5ub2RlVHlwZSA9PSAzICYmIGN1cnJlbnQuZGF0YS5sZW5ndGggPiAwKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gY3VycmVudDtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gZGVsZXRlUmFuZ2VCZXR3ZWVuVGV4dEJsb2NrcyhybmcpIHtcblx0XHRcdFx0dmFyIHN0YXJ0QmxvY2ssIGVuZEJsb2NrLCBjYXJldE5vZGVCZWZvcmUsIGNhcmV0Tm9kZUFmdGVyLCB0ZXh0QmxvY2tFbGVtZW50cztcblxuXHRcdFx0XHRpZiAocm5nLmNvbGxhcHNlZCkge1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHN0YXJ0QmxvY2sgPSBkb20uZ2V0UGFyZW50KFJhbmdlVXRpbHMuZ2V0Tm9kZShybmcuc3RhcnRDb250YWluZXIsIHJuZy5zdGFydE9mZnNldCksIGRvbS5pc0Jsb2NrKTtcblx0XHRcdFx0ZW5kQmxvY2sgPSBkb20uZ2V0UGFyZW50KFJhbmdlVXRpbHMuZ2V0Tm9kZShybmcuZW5kQ29udGFpbmVyLCBybmcuZW5kT2Zmc2V0KSwgZG9tLmlzQmxvY2spO1xuXHRcdFx0XHR0ZXh0QmxvY2tFbGVtZW50cyA9IGVkaXRvci5zY2hlbWEuZ2V0VGV4dEJsb2NrRWxlbWVudHMoKTtcblxuXHRcdFx0XHRpZiAoc3RhcnRCbG9jayA9PSBlbmRCbG9jaykge1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICghdGV4dEJsb2NrRWxlbWVudHNbc3RhcnRCbG9jay5ub2RlTmFtZV0gfHwgIXRleHRCbG9ja0VsZW1lbnRzW2VuZEJsb2NrLm5vZGVOYW1lXSkge1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChkb20uZ2V0Q29udGVudEVkaXRhYmxlKHN0YXJ0QmxvY2spID09PSBcImZhbHNlXCIgfHwgZG9tLmdldENvbnRlbnRFZGl0YWJsZShlbmRCbG9jaykgPT09IFwiZmFsc2VcIikge1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJuZy5kZWxldGVDb250ZW50cygpO1xuXG5cdFx0XHRcdGNhcmV0Tm9kZUJlZm9yZSA9IGZpbmRDYXJldE5vZGUoc3RhcnRCbG9jaywgZmFsc2UpO1xuXHRcdFx0XHRjYXJldE5vZGVBZnRlciA9IGZpbmRDYXJldE5vZGUoZW5kQmxvY2ssIHRydWUpO1xuXG5cdFx0XHRcdGlmICghZG9tLmlzRW1wdHkoZW5kQmxvY2spKSB7XG5cdFx0XHRcdFx0JChzdGFydEJsb2NrKS5hcHBlbmQoZW5kQmxvY2suY2hpbGROb2Rlcyk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQkKGVuZEJsb2NrKS5yZW1vdmUoKTtcblxuXHRcdFx0XHRpZiAoY2FyZXROb2RlQmVmb3JlKSB7XG5cdFx0XHRcdFx0aWYgKGNhcmV0Tm9kZUJlZm9yZS5ub2RlVHlwZSA9PSAxKSB7XG5cdFx0XHRcdFx0XHRpZiAoY2FyZXROb2RlQmVmb3JlLm5vZGVOYW1lID09IFwiQlJcIikge1xuXHRcdFx0XHRcdFx0XHRybmcuc2V0U3RhcnRCZWZvcmUoY2FyZXROb2RlQmVmb3JlKTtcblx0XHRcdFx0XHRcdFx0cm5nLnNldEVuZEJlZm9yZShjYXJldE5vZGVCZWZvcmUpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0cm5nLnNldFN0YXJ0QWZ0ZXIoY2FyZXROb2RlQmVmb3JlKTtcblx0XHRcdFx0XHRcdFx0cm5nLnNldEVuZEFmdGVyKGNhcmV0Tm9kZUJlZm9yZSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdHJuZy5zZXRTdGFydChjYXJldE5vZGVCZWZvcmUsIGNhcmV0Tm9kZUJlZm9yZS5kYXRhLmxlbmd0aCk7XG5cdFx0XHRcdFx0XHRybmcuc2V0RW5kKGNhcmV0Tm9kZUJlZm9yZSwgY2FyZXROb2RlQmVmb3JlLmRhdGEubGVuZ3RoKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gZWxzZSBpZiAoY2FyZXROb2RlQWZ0ZXIpIHtcblx0XHRcdFx0XHRpZiAoY2FyZXROb2RlQWZ0ZXIubm9kZVR5cGUgPT0gMSkge1xuXHRcdFx0XHRcdFx0cm5nLnNldFN0YXJ0QmVmb3JlKGNhcmV0Tm9kZUFmdGVyKTtcblx0XHRcdFx0XHRcdHJuZy5zZXRFbmRCZWZvcmUoY2FyZXROb2RlQWZ0ZXIpO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRybmcuc2V0U3RhcnQoY2FyZXROb2RlQWZ0ZXIsIDApO1xuXHRcdFx0XHRcdFx0cm5nLnNldEVuZChjYXJldE5vZGVBZnRlciwgMCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0c2VsZWN0aW9uLnNldFJuZyhybmcpO1xuXG5cdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0fVxuXG5cdFx0XHRmdW5jdGlvbiBleHBhbmRCZXR3ZWVuQmxvY2tzKHJuZywgaXNGb3J3YXJkKSB7XG5cdFx0XHRcdHZhciBjYXJldE5vZGUsIHRhcmdldENhcmV0Tm9kZSwgdGV4dEJsb2NrLCB0YXJnZXRUZXh0QmxvY2ssIGNvbnRhaW5lciwgb2Zmc2V0O1xuXG5cdFx0XHRcdGlmICghcm5nLmNvbGxhcHNlZCkge1xuXHRcdFx0XHRcdHJldHVybiBybmc7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRjb250YWluZXIgPSBybmcuc3RhcnRDb250YWluZXI7XG5cdFx0XHRcdG9mZnNldCA9IHJuZy5zdGFydE9mZnNldDtcblxuXHRcdFx0XHRpZiAoY29udGFpbmVyLm5vZGVUeXBlID09IDMpIHtcblx0XHRcdFx0XHRpZiAoaXNGb3J3YXJkKSB7XG5cdFx0XHRcdFx0XHRpZiAob2Zmc2V0IDwgY29udGFpbmVyLmRhdGEubGVuZ3RoKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiBybmc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGlmIChvZmZzZXQgPiAwKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiBybmc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0Y2FyZXROb2RlID0gUmFuZ2VVdGlscy5nZXROb2RlKGNvbnRhaW5lciwgb2Zmc2V0KTtcblx0XHRcdFx0dGV4dEJsb2NrID0gZG9tLmdldFBhcmVudChjYXJldE5vZGUsIGRvbS5pc0Jsb2NrKTtcblx0XHRcdFx0dGFyZ2V0Q2FyZXROb2RlID0gZmluZENhcmV0Tm9kZShlZGl0b3IuZ2V0Qm9keSgpLCBpc0ZvcndhcmQsIGNhcmV0Tm9kZSk7XG5cdFx0XHRcdHRhcmdldFRleHRCbG9jayA9IGRvbS5nZXRQYXJlbnQodGFyZ2V0Q2FyZXROb2RlLCBkb20uaXNCbG9jayk7XG5cdFx0XHRcdHZhciBpc0FmdGVyID0gY29udGFpbmVyLm5vZGVUeXBlID09PSAxICYmIG9mZnNldCA+IGNvbnRhaW5lci5jaGlsZE5vZGVzLmxlbmd0aCAtIDE7XG5cblx0XHRcdFx0aWYgKCFjYXJldE5vZGUgfHwgIXRhcmdldENhcmV0Tm9kZSkge1xuXHRcdFx0XHRcdHJldHVybiBybmc7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodGFyZ2V0VGV4dEJsb2NrICYmIHRleHRCbG9jayAhPSB0YXJnZXRUZXh0QmxvY2spIHtcblx0XHRcdFx0XHRpZiAoIWlzRm9yd2FyZCkge1xuXHRcdFx0XHRcdFx0aWYgKCFpc1NpYmxpbmdzSWdub3JlV2hpdGVTcGFjZSh0YXJnZXRUZXh0QmxvY2ssIHRleHRCbG9jaykpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJuZztcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0aWYgKHRhcmdldENhcmV0Tm9kZS5ub2RlVHlwZSA9PSAxKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0YXJnZXRDYXJldE5vZGUubm9kZU5hbWUgPT0gXCJCUlwiKSB7XG5cdFx0XHRcdFx0XHRcdFx0cm5nLnNldFN0YXJ0QmVmb3JlKHRhcmdldENhcmV0Tm9kZSk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0cm5nLnNldFN0YXJ0QWZ0ZXIodGFyZ2V0Q2FyZXROb2RlKTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0cm5nLnNldFN0YXJ0KHRhcmdldENhcmV0Tm9kZSwgdGFyZ2V0Q2FyZXROb2RlLmRhdGEubGVuZ3RoKTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0aWYgKGNhcmV0Tm9kZS5ub2RlVHlwZSA9PSAxKSB7XG5cdFx0XHRcdFx0XHRcdGlmIChpc0FmdGVyKSB7XG5cdFx0XHRcdFx0XHRcdFx0cm5nLnNldEVuZEFmdGVyKGNhcmV0Tm9kZSk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0cm5nLnNldEVuZEJlZm9yZShjYXJldE5vZGUpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRybmcuc2V0RW5kQmVmb3JlKGNhcmV0Tm9kZSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGlmICghaXNTaWJsaW5nc0lnbm9yZVdoaXRlU3BhY2UodGV4dEJsb2NrLCB0YXJnZXRUZXh0QmxvY2spKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiBybmc7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGlmIChjYXJldE5vZGUubm9kZVR5cGUgPT0gMSkge1xuXHRcdFx0XHRcdFx0XHRpZiAoY2FyZXROb2RlLm5vZGVOYW1lID09IFwiQlJcIikge1xuXHRcdFx0XHRcdFx0XHRcdHJuZy5zZXRTdGFydEJlZm9yZShjYXJldE5vZGUpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRcdHJuZy5zZXRTdGFydEFmdGVyKGNhcmV0Tm9kZSk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdHJuZy5zZXRTdGFydChjYXJldE5vZGUsIGNhcmV0Tm9kZS5kYXRhLmxlbmd0aCk7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGlmICh0YXJnZXRDYXJldE5vZGUubm9kZVR5cGUgPT0gMSkge1xuXHRcdFx0XHRcdFx0XHRybmcuc2V0RW5kKHRhcmdldENhcmV0Tm9kZSwgMCk7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRybmcuc2V0RW5kQmVmb3JlKHRhcmdldENhcmV0Tm9kZSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJuZztcblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gaGFuZGxlVGV4dEJsb2NrTWVyZ2VEZWxldGUoaXNGb3J3YXJkKSB7XG5cdFx0XHRcdHZhciBybmcgPSBzZWxlY3Rpb24uZ2V0Um5nKCk7XG5cblx0XHRcdFx0cm5nID0gZXhwYW5kQmV0d2VlbkJsb2NrcyhybmcsIGlzRm9yd2FyZCk7XG5cblx0XHRcdFx0aWYgKGRlbGV0ZVJhbmdlQmV0d2VlblRleHRCbG9ja3Mocm5nKSkge1xuXHRcdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdC8qKlxuXHRcdFx0ICogVGhpcyByZXRhaW5zIHRoZSBmb3JtYXR0aW5nIGlmIHRoZSBsYXN0IGNoYXJhY3RlciBpcyB0byBiZSBkZWxldGVkLlxuXHRcdFx0ICpcblx0XHRcdCAqIEJhY2tzcGFjZSBvbiB0aGlzOiA8cD48Yj48aT5hfDwvaT48L2I+PC9wPiB3b3VsZCBiZWNvbWUgPHA+fDwvcD4gaW4gV2ViS2l0LlxuXHRcdFx0ICogV2l0aCB0aGlzIHBhdGNoOiA8cD48Yj48aT58PGJyPjwvaT48L2I+PC9wPlxuXHRcdFx0ICovXG5cdFx0XHRmdW5jdGlvbiBoYW5kbGVMYXN0QmxvY2tDaGFyYWN0ZXJEZWxldGUoaXNGb3J3YXJkLCBybmcpIHtcblx0XHRcdFx0dmFyIHBhdGgsIGJsb2NrRWxtLCBuZXdCbG9ja0VsbSwgY2xvbmVkQmxvY2tFbG0sIHNpYmxpbmcsXG5cdFx0XHRcdFx0Y29udGFpbmVyLCBvZmZzZXQsIGJyLCBjdXJyZW50Rm9ybWF0Tm9kZXM7XG5cblx0XHRcdFx0ZnVuY3Rpb24gY2xvbmVUZXh0QmxvY2tXaXRoRm9ybWF0cyhibG9ja0VsbSwgbm9kZSkge1xuXHRcdFx0XHRcdGN1cnJlbnRGb3JtYXROb2RlcyA9ICQobm9kZSkucGFyZW50cygpLmZpbHRlcihmdW5jdGlvbihpZHgsIG5vZGUpIHtcblx0XHRcdFx0XHRcdHJldHVybiAhIWVkaXRvci5zY2hlbWEuZ2V0VGV4dElubGluZUVsZW1lbnRzKClbbm9kZS5ub2RlTmFtZV07XG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRuZXdCbG9ja0VsbSA9IGJsb2NrRWxtLmNsb25lTm9kZShmYWxzZSk7XG5cblx0XHRcdFx0XHRjdXJyZW50Rm9ybWF0Tm9kZXMgPSBUb29scy5tYXAoY3VycmVudEZvcm1hdE5vZGVzLCBmdW5jdGlvbihmb3JtYXROb2RlKSB7XG5cdFx0XHRcdFx0XHRmb3JtYXROb2RlID0gZm9ybWF0Tm9kZS5jbG9uZU5vZGUoZmFsc2UpO1xuXG5cdFx0XHRcdFx0XHRpZiAobmV3QmxvY2tFbG0uaGFzQ2hpbGROb2RlcygpKSB7XG5cdFx0XHRcdFx0XHRcdGZvcm1hdE5vZGUuYXBwZW5kQ2hpbGQobmV3QmxvY2tFbG0uZmlyc3RDaGlsZCk7XG5cdFx0XHRcdFx0XHRcdG5ld0Jsb2NrRWxtLmFwcGVuZENoaWxkKGZvcm1hdE5vZGUpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0bmV3QmxvY2tFbG0uYXBwZW5kQ2hpbGQoZm9ybWF0Tm9kZSk7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdG5ld0Jsb2NrRWxtLmFwcGVuZENoaWxkKGZvcm1hdE5vZGUpO1xuXG5cdFx0XHRcdFx0XHRyZXR1cm4gZm9ybWF0Tm9kZTtcblx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdGlmIChjdXJyZW50Rm9ybWF0Tm9kZXMubGVuZ3RoKSB7XG5cdFx0XHRcdFx0XHRiciA9IGRvbS5jcmVhdGUoJ2JyJyk7XG5cdFx0XHRcdFx0XHRjdXJyZW50Rm9ybWF0Tm9kZXNbMF0uYXBwZW5kQ2hpbGQoYnIpO1xuXHRcdFx0XHRcdFx0ZG9tLnJlcGxhY2UobmV3QmxvY2tFbG0sIGJsb2NrRWxtKTtcblxuXHRcdFx0XHRcdFx0cm5nLnNldFN0YXJ0QmVmb3JlKGJyKTtcblx0XHRcdFx0XHRcdHJuZy5zZXRFbmRCZWZvcmUoYnIpO1xuXHRcdFx0XHRcdFx0ZWRpdG9yLnNlbGVjdGlvbi5zZXRSbmcocm5nKTtcblxuXHRcdFx0XHRcdFx0cmV0dXJuIGJyO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0ZnVuY3Rpb24gaXNUZXh0QmxvY2sobm9kZSkge1xuXHRcdFx0XHRcdHJldHVybiBub2RlICYmIGVkaXRvci5zY2hlbWEuZ2V0VGV4dEJsb2NrRWxlbWVudHMoKVtub2RlLnRhZ05hbWVdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKCFybmcuY29sbGFwc2VkKSB7XG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Y29udGFpbmVyID0gcm5nLnN0YXJ0Q29udGFpbmVyO1xuXHRcdFx0XHRvZmZzZXQgPSBybmcuc3RhcnRPZmZzZXQ7XG5cdFx0XHRcdGJsb2NrRWxtID0gZG9tLmdldFBhcmVudChjb250YWluZXIsIGRvbS5pc0Jsb2NrKTtcblx0XHRcdFx0aWYgKCFpc1RleHRCbG9jayhibG9ja0VsbSkpIHtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoY29udGFpbmVyLm5vZGVUeXBlID09IDEpIHtcblx0XHRcdFx0XHRjb250YWluZXIgPSBjb250YWluZXIuY2hpbGROb2Rlc1tvZmZzZXRdO1xuXHRcdFx0XHRcdGlmIChjb250YWluZXIgJiYgY29udGFpbmVyLnRhZ05hbWUgIT0gJ0JSJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmIChpc0ZvcndhcmQpIHtcblx0XHRcdFx0XHRcdHNpYmxpbmcgPSBibG9ja0VsbS5uZXh0U2libGluZztcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0c2libGluZyA9IGJsb2NrRWxtLnByZXZpb3VzU2libGluZztcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoZG9tLmlzRW1wdHkoYmxvY2tFbG0pICYmIGlzVGV4dEJsb2NrKHNpYmxpbmcpICYmIGRvbS5pc0VtcHR5KHNpYmxpbmcpKSB7XG5cdFx0XHRcdFx0XHRpZiAoY2xvbmVUZXh0QmxvY2tXaXRoRm9ybWF0cyhibG9ja0VsbSwgY29udGFpbmVyKSkge1xuXHRcdFx0XHRcdFx0XHRkb20ucmVtb3ZlKHNpYmxpbmcpO1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gZWxzZSBpZiAoY29udGFpbmVyLm5vZGVUeXBlID09IDMpIHtcblx0XHRcdFx0XHRwYXRoID0gTm9kZVBhdGguY3JlYXRlKGJsb2NrRWxtLCBjb250YWluZXIpO1xuXHRcdFx0XHRcdGNsb25lZEJsb2NrRWxtID0gYmxvY2tFbG0uY2xvbmVOb2RlKHRydWUpO1xuXHRcdFx0XHRcdGNvbnRhaW5lciA9IE5vZGVQYXRoLnJlc29sdmUoY2xvbmVkQmxvY2tFbG0sIHBhdGgpO1xuXG5cdFx0XHRcdFx0aWYgKGlzRm9yd2FyZCkge1xuXHRcdFx0XHRcdFx0aWYgKG9mZnNldCA+PSBjb250YWluZXIuZGF0YS5sZW5ndGgpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRjb250YWluZXIuZGVsZXRlRGF0YShvZmZzZXQsIDEpO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRpZiAob2Zmc2V0IDw9IDApIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRjb250YWluZXIuZGVsZXRlRGF0YShvZmZzZXQgLSAxLCAxKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoZG9tLmlzRW1wdHkoY2xvbmVkQmxvY2tFbG0pKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gY2xvbmVUZXh0QmxvY2tXaXRoRm9ybWF0cyhibG9ja0VsbSwgY29udGFpbmVyKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gY3VzdG9tRGVsZXRlKGlzRm9yd2FyZCkge1xuXHRcdFx0XHR2YXIgbXV0YXRpb25PYnNlcnZlciwgcm5nLCBjYXJldEVsZW1lbnQ7XG5cblx0XHRcdFx0aWYgKGhhbmRsZVRleHRCbG9ja01lcmdlRGVsZXRlKGlzRm9yd2FyZCkpIHtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRUb29scy5lYWNoKGVkaXRvci5nZXRCb2R5KCkuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJyonKSwgZnVuY3Rpb24oZWxtKSB7XG5cdFx0XHRcdFx0Ly8gTWFyayBleGlzdGluZyBzcGFuc1xuXHRcdFx0XHRcdGlmIChlbG0udGFnTmFtZSA9PSAnU1BBTicpIHtcblx0XHRcdFx0XHRcdGVsbS5zZXRBdHRyaWJ1dGUoJ21jZS1kYXRhLW1hcmtlZCcsIDEpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdC8vIE1ha2Ugc3VyZSBhbGwgZWxlbWVudHMgaGFzIGEgZGF0YS1tY2Utc3R5bGUgYXR0cmlidXRlXG5cdFx0XHRcdFx0aWYgKCFlbG0uaGFzQXR0cmlidXRlKCdkYXRhLW1jZS1zdHlsZScpICYmIGVsbS5oYXNBdHRyaWJ1dGUoJ3N0eWxlJykpIHtcblx0XHRcdFx0XHRcdGVkaXRvci5kb20uc2V0QXR0cmliKGVsbSwgJ3N0eWxlJywgZWRpdG9yLmRvbS5nZXRBdHRyaWIoZWxtLCAnc3R5bGUnKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHQvLyBPYnNlcnZlIGFkZGVkIG5vZGVzIGFuZCBzdHlsZSBhdHRyaWJ1dGUgY2hhbmdlc1xuXHRcdFx0XHRtdXRhdGlvbk9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoZnVuY3Rpb24oKSB7fSk7XG5cdFx0XHRcdG11dGF0aW9uT2JzZXJ2ZXIub2JzZXJ2ZShlZGl0b3IuZ2V0RG9jKCksIHtcblx0XHRcdFx0XHRjaGlsZExpc3Q6IHRydWUsXG5cdFx0XHRcdFx0YXR0cmlidXRlczogdHJ1ZSxcblx0XHRcdFx0XHRzdWJ0cmVlOiB0cnVlLFxuXHRcdFx0XHRcdGF0dHJpYnV0ZUZpbHRlcjogWydzdHlsZSddXG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdGVkaXRvci5nZXREb2MoKS5leGVjQ29tbWFuZChpc0ZvcndhcmQgPyAnRm9yd2FyZERlbGV0ZScgOiAnRGVsZXRlJywgZmFsc2UsIG51bGwpO1xuXG5cdFx0XHRcdHJuZyA9IGVkaXRvci5zZWxlY3Rpb24uZ2V0Um5nKCk7XG5cdFx0XHRcdGNhcmV0RWxlbWVudCA9IHJuZy5zdGFydENvbnRhaW5lci5wYXJlbnROb2RlO1xuXG5cdFx0XHRcdFRvb2xzLmVhY2gobXV0YXRpb25PYnNlcnZlci50YWtlUmVjb3JkcygpLCBmdW5jdGlvbihyZWNvcmQpIHtcblx0XHRcdFx0XHRpZiAoIWRvbS5pc0NoaWxkT2YocmVjb3JkLnRhcmdldCwgZWRpdG9yLmdldEJvZHkoKSkpIHtcblx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHQvLyBSZXN0b3JlIHN0eWxlIGF0dHJpYnV0ZSB0byBwcmV2aW91cyB2YWx1ZVxuXHRcdFx0XHRcdGlmIChyZWNvcmQuYXR0cmlidXRlTmFtZSA9PSBcInN0eWxlXCIpIHtcblx0XHRcdFx0XHRcdHZhciBvbGRWYWx1ZSA9IHJlY29yZC50YXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLW1jZS1zdHlsZScpO1xuXG5cdFx0XHRcdFx0XHRpZiAob2xkVmFsdWUpIHtcblx0XHRcdFx0XHRcdFx0cmVjb3JkLnRhcmdldC5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCBvbGRWYWx1ZSk7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRyZWNvcmQudGFyZ2V0LnJlbW92ZUF0dHJpYnV0ZShcInN0eWxlXCIpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdC8vIFJlbW92ZSBhbGwgc3BhbnMgdGhhdCBhcmVuJ3QgbWFya2VkIGFuZCByZXRhaW4gc2VsZWN0aW9uXG5cdFx0XHRcdFx0VG9vbHMuZWFjaChyZWNvcmQuYWRkZWROb2RlcywgZnVuY3Rpb24obm9kZSkge1xuXHRcdFx0XHRcdFx0aWYgKG5vZGUubm9kZU5hbWUgPT0gXCJTUEFOXCIgJiYgIW5vZGUuZ2V0QXR0cmlidXRlKCdtY2UtZGF0YS1tYXJrZWQnKSkge1xuXHRcdFx0XHRcdFx0XHR2YXIgb2Zmc2V0LCBjb250YWluZXI7XG5cblx0XHRcdFx0XHRcdFx0aWYgKG5vZGUgPT0gY2FyZXRFbGVtZW50KSB7XG5cdFx0XHRcdFx0XHRcdFx0b2Zmc2V0ID0gcm5nLnN0YXJ0T2Zmc2V0O1xuXHRcdFx0XHRcdFx0XHRcdGNvbnRhaW5lciA9IG5vZGUuZmlyc3RDaGlsZDtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdGRvbS5yZW1vdmUobm9kZSwgdHJ1ZSk7XG5cblx0XHRcdFx0XHRcdFx0aWYgKGNvbnRhaW5lcikge1xuXHRcdFx0XHRcdFx0XHRcdHJuZy5zZXRTdGFydChjb250YWluZXIsIG9mZnNldCk7XG5cdFx0XHRcdFx0XHRcdFx0cm5nLnNldEVuZChjb250YWluZXIsIG9mZnNldCk7XG5cdFx0XHRcdFx0XHRcdFx0ZWRpdG9yLnNlbGVjdGlvbi5zZXRSbmcocm5nKTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHRtdXRhdGlvbk9ic2VydmVyLmRpc2Nvbm5lY3QoKTtcblxuXHRcdFx0XHQvLyBSZW1vdmUgYW55IGxlZnQgb3ZlciBtYXJrc1xuXHRcdFx0XHRUb29scy5lYWNoKGVkaXRvci5kb20uc2VsZWN0KCdzcGFuW21jZS1kYXRhLW1hcmtlZF0nKSwgZnVuY3Rpb24oc3Bhbikge1xuXHRcdFx0XHRcdHNwYW4ucmVtb3ZlQXR0cmlidXRlKCdtY2UtZGF0YS1tYXJrZWQnKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIHRyYW5zYWN0Q3VzdG9tRGVsZXRlKGlzRm9yd2FyZCkge1xuXHRcdFx0XHRlZGl0b3IudW5kb01hbmFnZXIudHJhbnNhY3QoZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdGN1c3RvbURlbGV0ZShpc0ZvcndhcmQpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0ZWRpdG9yLm9uKCdrZXlkb3duJywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHR2YXIgaXNGb3J3YXJkID0gZS5rZXlDb2RlID09IERFTEVURSwgaXNNZXRhT3JDdHJsID0gZS5jdHJsS2V5IHx8IGUubWV0YUtleTtcblxuXHRcdFx0XHRpZiAoIWlzRGVmYXVsdFByZXZlbnRlZChlKSAmJiAoaXNGb3J3YXJkIHx8IGUua2V5Q29kZSA9PSBCQUNLU1BBQ0UpKSB7XG5cdFx0XHRcdFx0dmFyIHJuZyA9IGVkaXRvci5zZWxlY3Rpb24uZ2V0Um5nKCksIGNvbnRhaW5lciA9IHJuZy5zdGFydENvbnRhaW5lciwgb2Zmc2V0ID0gcm5nLnN0YXJ0T2Zmc2V0O1xuXG5cdFx0XHRcdFx0Ly8gU2hpZnQrRGVsZXRlIGlzIGN1dFxuXHRcdFx0XHRcdGlmIChpc0ZvcndhcmQgJiYgZS5zaGlmdEtleSkge1xuXHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmIChoYW5kbGVMYXN0QmxvY2tDaGFyYWN0ZXJEZWxldGUoaXNGb3J3YXJkLCBybmcpKSB7XG5cdFx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Ly8gSWdub3JlIG5vbiBtZXRhIGRlbGV0ZSBpbiB0aGUgd2hlcmUgdGhlcmUgaXMgdGV4dCBiZWZvcmUvYWZ0ZXIgdGhlIGNhcmV0XG5cdFx0XHRcdFx0aWYgKCFpc01ldGFPckN0cmwgJiYgcm5nLmNvbGxhcHNlZCAmJiBjb250YWluZXIubm9kZVR5cGUgPT0gMykge1xuXHRcdFx0XHRcdFx0aWYgKGlzRm9yd2FyZCA/IG9mZnNldCA8IGNvbnRhaW5lci5kYXRhLmxlbmd0aCA6IG9mZnNldCA+IDApIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdFx0XHRcdGlmIChpc01ldGFPckN0cmwpIHtcblx0XHRcdFx0XHRcdGVkaXRvci5zZWxlY3Rpb24uZ2V0U2VsKCkubW9kaWZ5KFwiZXh0ZW5kXCIsIGlzRm9yd2FyZCA/IFwiZm9yd2FyZFwiIDogXCJiYWNrd2FyZFwiLCBlLm1ldGFLZXkgPyBcImxpbmVib3VuZGFyeVwiIDogXCJ3b3JkXCIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGN1c3RvbURlbGV0ZShpc0ZvcndhcmQpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0Ly8gSGFuZGxlIGNhc2Ugd2hlcmUgdGV4dCBpcyBkZWxldGVkIGJ5IHR5cGluZyBvdmVyXG5cdFx0XHRlZGl0b3Iub24oJ2tleXByZXNzJywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRpZiAoIWlzRGVmYXVsdFByZXZlbnRlZChlKSAmJiAhc2VsZWN0aW9uLmlzQ29sbGFwc2VkKCkgJiYgZS5jaGFyQ29kZSA+IDMxICYmICFWSy5tZXRhS2V5UHJlc3NlZChlKSkge1xuXHRcdFx0XHRcdHZhciBybmcsIGN1cnJlbnRGb3JtYXROb2RlcywgZnJhZ21lbnROb2RlLCBibG9ja1BhcmVudCwgY2FyZXROb2RlLCBjaGFyVGV4dDtcblxuXHRcdFx0XHRcdHJuZyA9IGVkaXRvci5zZWxlY3Rpb24uZ2V0Um5nKCk7XG5cdFx0XHRcdFx0Y2hhclRleHQgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGUuY2hhckNvZGUpO1xuXHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdFx0XHRcdC8vIEtlZXAgdHJhY2sgb2YgY3VycmVudCBmb3JtYXQgbm9kZXNcblx0XHRcdFx0XHRjdXJyZW50Rm9ybWF0Tm9kZXMgPSAkKHJuZy5zdGFydENvbnRhaW5lcikucGFyZW50cygpLmZpbHRlcihmdW5jdGlvbihpZHgsIG5vZGUpIHtcblx0XHRcdFx0XHRcdHJldHVybiAhIWVkaXRvci5zY2hlbWEuZ2V0VGV4dElubGluZUVsZW1lbnRzKClbbm9kZS5ub2RlTmFtZV07XG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRjdXN0b21EZWxldGUodHJ1ZSk7XG5cblx0XHRcdFx0XHQvLyBDaGVjayBpZiB0aGUgYnJvd3NlciByZW1vdmVkIHRoZW1cblx0XHRcdFx0XHRjdXJyZW50Rm9ybWF0Tm9kZXMgPSBjdXJyZW50Rm9ybWF0Tm9kZXMuZmlsdGVyKGZ1bmN0aW9uKGlkeCwgbm9kZSkge1xuXHRcdFx0XHRcdFx0cmV0dXJuICEkLmNvbnRhaW5zKGVkaXRvci5nZXRCb2R5KCksIG5vZGUpO1xuXHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0Ly8gVGhlbiByZS1hZGQgdGhlbVxuXHRcdFx0XHRcdGlmIChjdXJyZW50Rm9ybWF0Tm9kZXMubGVuZ3RoKSB7XG5cdFx0XHRcdFx0XHRmcmFnbWVudE5vZGUgPSBkb20uY3JlYXRlRnJhZ21lbnQoKTtcblxuXHRcdFx0XHRcdFx0Y3VycmVudEZvcm1hdE5vZGVzLmVhY2goZnVuY3Rpb24oaWR4LCBmb3JtYXROb2RlKSB7XG5cdFx0XHRcdFx0XHRcdGZvcm1hdE5vZGUgPSBmb3JtYXROb2RlLmNsb25lTm9kZShmYWxzZSk7XG5cblx0XHRcdFx0XHRcdFx0aWYgKGZyYWdtZW50Tm9kZS5oYXNDaGlsZE5vZGVzKCkpIHtcblx0XHRcdFx0XHRcdFx0XHRmb3JtYXROb2RlLmFwcGVuZENoaWxkKGZyYWdtZW50Tm9kZS5maXJzdENoaWxkKTtcblx0XHRcdFx0XHRcdFx0XHRmcmFnbWVudE5vZGUuYXBwZW5kQ2hpbGQoZm9ybWF0Tm9kZSk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0Y2FyZXROb2RlID0gZm9ybWF0Tm9kZTtcblx0XHRcdFx0XHRcdFx0XHRmcmFnbWVudE5vZGUuYXBwZW5kQ2hpbGQoZm9ybWF0Tm9kZSk7XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRmcmFnbWVudE5vZGUuYXBwZW5kQ2hpbGQoZm9ybWF0Tm9kZSk7XG5cdFx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdFx0Y2FyZXROb2RlLmFwcGVuZENoaWxkKGVkaXRvci5nZXREb2MoKS5jcmVhdGVUZXh0Tm9kZShjaGFyVGV4dCkpO1xuXG5cdFx0XHRcdFx0XHQvLyBQcmV2ZW50IGVkZ2UgY2FzZSB3aGVyZSBvbGRlciBXZWJLaXQgd291bGQgYWRkIGFuIGV4dHJhIEJSIGVsZW1lbnRcblx0XHRcdFx0XHRcdGJsb2NrUGFyZW50ID0gZG9tLmdldFBhcmVudChybmcuc3RhcnRDb250YWluZXIsIGRvbS5pc0Jsb2NrKTtcblx0XHRcdFx0XHRcdGlmIChkb20uaXNFbXB0eShibG9ja1BhcmVudCkpIHtcblx0XHRcdFx0XHRcdFx0JChibG9ja1BhcmVudCkuZW1wdHkoKS5hcHBlbmQoZnJhZ21lbnROb2RlKTtcblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdHJuZy5pbnNlcnROb2RlKGZyYWdtZW50Tm9kZSk7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJuZy5zZXRTdGFydChjYXJldE5vZGUuZmlyc3RDaGlsZCwgMSk7XG5cdFx0XHRcdFx0XHRybmcuc2V0RW5kKGNhcmV0Tm9kZS5maXJzdENoaWxkLCAxKTtcblx0XHRcdFx0XHRcdGVkaXRvci5zZWxlY3Rpb24uc2V0Um5nKHJuZyk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGVkaXRvci5zZWxlY3Rpb24uc2V0Q29udGVudChjaGFyVGV4dCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0ZWRpdG9yLmFkZENvbW1hbmQoJ0RlbGV0ZScsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRjdXN0b21EZWxldGUoKTtcblx0XHRcdH0pO1xuXG5cdFx0XHRlZGl0b3IuYWRkQ29tbWFuZCgnRm9yd2FyZERlbGV0ZScsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRjdXN0b21EZWxldGUodHJ1ZSk7XG5cdFx0XHR9KTtcblxuXHRcdFx0Ly8gT2xkZXIgV2ViS2l0cyBkb2Vzbid0IHByb3Blcmx5IGhhbmRsZSB0aGUgY2xpcGJvYXJkIHNvIHdlIGNhbid0IGFkZCB0aGUgcmVzdFxuXHRcdFx0aWYgKG9sZGVyV2ViS2l0KSB7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0ZWRpdG9yLm9uKCdkcmFnc3RhcnQnLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdGRyYWdTdGFydFJuZyA9IHNlbGVjdGlvbi5nZXRSbmcoKTtcblx0XHRcdFx0c2V0TWNlSW50ZXJuYWxDb250ZW50KGUpO1xuXHRcdFx0fSk7XG5cblx0XHRcdGVkaXRvci5vbignZHJvcCcsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0aWYgKCFpc0RlZmF1bHRQcmV2ZW50ZWQoZSkpIHtcblx0XHRcdFx0XHR2YXIgaW50ZXJuYWxDb250ZW50ID0gZ2V0TWNlSW50ZXJuYWxDb250ZW50KGUpO1xuXG5cdFx0XHRcdFx0aWYgKGludGVybmFsQ29udGVudCkge1xuXHRcdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdFx0XHRcdFx0XHQvLyBTYWZhcmkgaGFzIGEgd2VpcmQgaXNzdWUgd2hlcmUgZHJhZy9kcm9wcGluZyBpbWFnZXMgc29tZXRpbWVzXG5cdFx0XHRcdFx0XHQvLyBwcm9kdWNlcyBhIGdyZWVuIHBsdXMgaWNvbi4gV2hlbiB0aGlzIGhhcHBlbnMgdGhlIGNhcmV0UmFuZ2VGcm9tUG9pbnRcblx0XHRcdFx0XHRcdC8vIHdpbGwgcmV0dXJuIFwibnVsbFwiIGV2ZW4gdGhvdWdoIHRoZSB4LCB5IGNvb3JkaW5hdGUgaXMgY29ycmVjdC5cblx0XHRcdFx0XHRcdC8vIEJ1dCBpZiB3ZSBkZXRhY2ggdGhlIGluc2VydCBmcm9tIHRoZSBkcm9wIGV2ZW50IHdlIHdpbGwgZ2V0IGEgcHJvcGVyIHJhbmdlXG5cdFx0XHRcdFx0XHREZWxheS5zZXRFZGl0b3JUaW1lb3V0KGVkaXRvciwgZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0XHRcdHZhciBwb2ludFJuZyA9IFJhbmdlVXRpbHMuZ2V0Q2FyZXRSYW5nZUZyb21Qb2ludChlLngsIGUueSwgZG9jKTtcblxuXHRcdFx0XHRcdFx0XHRpZiAoZHJhZ1N0YXJ0Um5nKSB7XG5cdFx0XHRcdFx0XHRcdFx0c2VsZWN0aW9uLnNldFJuZyhkcmFnU3RhcnRSbmcpO1xuXHRcdFx0XHRcdFx0XHRcdGRyYWdTdGFydFJuZyA9IG51bGw7XG5cdFx0XHRcdFx0XHRcdFx0dHJhbnNhY3RDdXN0b21EZWxldGUoKTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHNlbGVjdGlvbi5zZXRSbmcocG9pbnRSbmcpO1xuXHRcdFx0XHRcdFx0XHRpbnNlcnRDbGlwYm9hcmRDb250ZW50cyhpbnRlcm5hbENvbnRlbnQuaHRtbCk7XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRlZGl0b3Iub24oJ2N1dCcsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0aWYgKCFpc0RlZmF1bHRQcmV2ZW50ZWQoZSkgJiYgZS5jbGlwYm9hcmREYXRhICYmICFlZGl0b3Iuc2VsZWN0aW9uLmlzQ29sbGFwc2VkKCkpIHtcblx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdFx0ZS5jbGlwYm9hcmREYXRhLmNsZWFyRGF0YSgpO1xuXHRcdFx0XHRcdGUuY2xpcGJvYXJkRGF0YS5zZXREYXRhKCd0ZXh0L2h0bWwnLCBlZGl0b3Iuc2VsZWN0aW9uLmdldENvbnRlbnQoKSk7XG5cdFx0XHRcdFx0ZS5jbGlwYm9hcmREYXRhLnNldERhdGEoJ3RleHQvcGxhaW4nLCBlZGl0b3Iuc2VsZWN0aW9uLmdldENvbnRlbnQoe2Zvcm1hdDogJ3RleHQnfSkpO1xuXG5cdFx0XHRcdFx0Ly8gTmVlZGVkIGRlbGF5IGZvciBodHRwczovL2NvZGUuZ29vZ2xlLmNvbS9wL2Nocm9taXVtL2lzc3Vlcy9kZXRhaWw/aWQ9MzYzMjg4I2MzXG5cdFx0XHRcdFx0Ly8gTmVzdGVkIGRlbGV0ZS9mb3J3YXJkRGVsZXRlIG5vdCBhbGxvd2VkIG9uIGV4ZWNDb21tYW5kKFwiY3V0XCIpXG5cdFx0XHRcdFx0Ly8gVGhpcyBpcyB1Z2x5IGJ1dCBub3Qgc3VyZSBob3cgdG8gd29yayBhcm91bmQgaXQgb3RoZXJ3aXNlXG5cdFx0XHRcdFx0RGVsYXkuc2V0RWRpdG9yVGltZW91dChlZGl0b3IsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdFx0dHJhbnNhY3RDdXN0b21EZWxldGUodHJ1ZSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdC8qKlxuXHRcdCAqIE1ha2VzIHN1cmUgdGhhdCB0aGUgZWRpdG9yIGJvZHkgYmVjb21lcyBlbXB0eSB3aGVuIGJhY2tzcGFjZSBvciBkZWxldGUgaXMgcHJlc3NlZCBpbiBlbXB0eSBlZGl0b3JzLlxuXHRcdCAqXG5cdFx0ICogRm9yIGV4YW1wbGU6XG5cdFx0ICogPHA+PGI+fDwvYj48L3A+XG5cdFx0ICpcblx0XHQgKiBPcjpcblx0XHQgKiA8aDE+fDwvaDE+XG5cdFx0ICpcblx0XHQgKiBPcjpcblx0XHQgKiBbPGgxPjwvaDE+XVxuXHRcdCAqL1xuXHRcdGZ1bmN0aW9uIGVtcHR5RWRpdG9yV2hlbkRlbGV0aW5nKCkge1xuXHRcdFx0ZnVuY3Rpb24gc2VyaWFsaXplUm5nKHJuZykge1xuXHRcdFx0XHR2YXIgYm9keSA9IGRvbS5jcmVhdGUoXCJib2R5XCIpO1xuXHRcdFx0XHR2YXIgY29udGVudHMgPSBybmcuY2xvbmVDb250ZW50cygpO1xuXHRcdFx0XHRib2R5LmFwcGVuZENoaWxkKGNvbnRlbnRzKTtcblx0XHRcdFx0cmV0dXJuIHNlbGVjdGlvbi5zZXJpYWxpemVyLnNlcmlhbGl6ZShib2R5LCB7Zm9ybWF0OiAnaHRtbCd9KTtcblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gYWxsQ29udGVudHNTZWxlY3RlZChybmcpIHtcblx0XHRcdFx0aWYgKCFybmcuc2V0U3RhcnQpIHtcblx0XHRcdFx0XHRpZiAocm5nLml0ZW0pIHtcblx0XHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHR2YXIgYm9keVJuZyA9IHJuZy5kdXBsaWNhdGUoKTtcblx0XHRcdFx0XHRib2R5Um5nLm1vdmVUb0VsZW1lbnRUZXh0KGVkaXRvci5nZXRCb2R5KCkpO1xuXHRcdFx0XHRcdHJldHVybiBSYW5nZVV0aWxzLmNvbXBhcmVSYW5nZXMocm5nLCBib2R5Um5nKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHZhciBzZWxlY3Rpb24gPSBzZXJpYWxpemVSbmcocm5nKTtcblxuXHRcdFx0XHR2YXIgYWxsUm5nID0gZG9tLmNyZWF0ZVJuZygpO1xuXHRcdFx0XHRhbGxSbmcuc2VsZWN0Tm9kZShlZGl0b3IuZ2V0Qm9keSgpKTtcblxuXHRcdFx0XHR2YXIgYWxsU2VsZWN0aW9uID0gc2VyaWFsaXplUm5nKGFsbFJuZyk7XG5cdFx0XHRcdHJldHVybiBzZWxlY3Rpb24gPT09IGFsbFNlbGVjdGlvbjtcblx0XHRcdH1cblxuXHRcdFx0ZWRpdG9yLm9uKCdrZXlkb3duJywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHR2YXIga2V5Q29kZSA9IGUua2V5Q29kZSwgaXNDb2xsYXBzZWQsIGJvZHk7XG5cblx0XHRcdFx0Ly8gRW1wdHkgdGhlIGVkaXRvciBpZiBpdCdzIG5lZWRlZCBmb3IgZXhhbXBsZSBiYWNrc3BhY2UgYXQgPHA+PGI+fDwvYj48L3A+XG5cdFx0XHRcdGlmICghaXNEZWZhdWx0UHJldmVudGVkKGUpICYmIChrZXlDb2RlID09IERFTEVURSB8fCBrZXlDb2RlID09IEJBQ0tTUEFDRSkpIHtcblx0XHRcdFx0XHRpc0NvbGxhcHNlZCA9IGVkaXRvci5zZWxlY3Rpb24uaXNDb2xsYXBzZWQoKTtcblx0XHRcdFx0XHRib2R5ID0gZWRpdG9yLmdldEJvZHkoKTtcblxuXHRcdFx0XHRcdC8vIFNlbGVjdGlvbiBpcyBjb2xsYXBzZWQgYnV0IHRoZSBlZGl0b3IgaXNuJ3QgZW1wdHlcblx0XHRcdFx0XHRpZiAoaXNDb2xsYXBzZWQgJiYgIWRvbS5pc0VtcHR5KGJvZHkpKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Ly8gU2VsZWN0aW9uIGlzbid0IGNvbGxhcHNlZCBidXQgbm90IGFsbCB0aGUgY29udGVudHMgaXMgc2VsZWN0ZWRcblx0XHRcdFx0XHRpZiAoIWlzQ29sbGFwc2VkICYmICFhbGxDb250ZW50c1NlbGVjdGVkKGVkaXRvci5zZWxlY3Rpb24uZ2V0Um5nKCkpKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Ly8gTWFudWFsbHkgZW1wdHkgdGhlIGVkaXRvclxuXHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHRlZGl0b3Iuc2V0Q29udGVudCgnJyk7XG5cblx0XHRcdFx0XHRpZiAoYm9keS5maXJzdENoaWxkICYmIGRvbS5pc0Jsb2NrKGJvZHkuZmlyc3RDaGlsZCkpIHtcblx0XHRcdFx0XHRcdGVkaXRvci5zZWxlY3Rpb24uc2V0Q3Vyc29yTG9jYXRpb24oYm9keS5maXJzdENoaWxkLCAwKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0ZWRpdG9yLnNlbGVjdGlvbi5zZXRDdXJzb3JMb2NhdGlvbihib2R5LCAwKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRlZGl0b3Iubm9kZUNoYW5nZWQoKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0LyoqXG5cdFx0ICogV2ViS2l0IGRvZXNuJ3Qgc2VsZWN0IGFsbCB0aGUgbm9kZXMgaW4gdGhlIGJvZHkgd2hlbiB5b3UgcHJlc3MgQ3RybCtBLlxuXHRcdCAqIElFIHNlbGVjdHMgbW9yZSB0aGFuIHRoZSBjb250ZW50cyA8Ym9keT5bPHA+YTwvcD5dPC9ib2R5PiBpbnN0ZWFkIG9mIDxib2R5PjxwPlthXTwvcF08L2JvZHk+IHNlZSBidWcgIzY0Mzhcblx0XHQgKiBUaGlzIHNlbGVjdHMgdGhlIHdob2xlIGJvZHkgc28gdGhhdCBiYWNrc3BhY2UvZGVsZXRlIGxvZ2ljIHdpbGwgZGVsZXRlIGV2ZXJ5dGhpbmdcblx0XHQgKi9cblx0XHRmdW5jdGlvbiBzZWxlY3RBbGwoKSB7XG5cdFx0XHRlZGl0b3Iuc2hvcnRjdXRzLmFkZCgnbWV0YSthJywgbnVsbCwgJ1NlbGVjdEFsbCcpO1xuXHRcdH1cblxuXHRcdC8qKlxuXHRcdCAqIFdlYktpdCBoYXMgYSB3ZWlyZCBpc3N1ZSB3aGVyZSBpdCBzb21lIHRpbWVzIGZhaWxzIHRvIHByb3Blcmx5IGNvbnZlcnQga2V5cHJlc3NlcyB0byBpbnB1dCBtZXRob2Qga2V5c3Ryb2tlcy5cblx0XHQgKiBUaGUgSU1FIG9uIE1hYyBkb2Vzbid0IGluaXRpYWxpemUgd2hlbiBpdCBkb2Vzbid0IGZpcmUgYSBwcm9wZXIgZm9jdXMgZXZlbnQuXG5cdFx0ICpcblx0XHQgKiBUaGlzIHNlZW1zIHRvIGhhcHBlbiB3aGVuIHRoZSB1c2VyIG1hbmFnZXMgdG8gY2xpY2sgdGhlIGRvY3VtZW50RWxlbWVudCBlbGVtZW50IHRoZW4gdGhlIHdpbmRvdyBkb2Vzbid0IGdldCBwcm9wZXIgZm9jdXMgdW50aWxcblx0XHQgKiB5b3UgZW50ZXIgYSBjaGFyYWN0ZXIgaW50byB0aGUgZWRpdG9yLlxuXHRcdCAqXG5cdFx0ICogSXQgYWxzbyBoYXBwZW5zIHdoZW4gdGhlIGZpcnN0IGZvY3VzIGluIG1hZGUgdG8gdGhlIGJvZHkuXG5cdFx0ICpcblx0XHQgKiBTZWU6IGh0dHBzOi8vYnVncy53ZWJraXQub3JnL3Nob3dfYnVnLmNnaT9pZD04MzU2NlxuXHRcdCAqL1xuXHRcdGZ1bmN0aW9uIGlucHV0TWV0aG9kRm9jdXMoKSB7XG5cdFx0XHRpZiAoIWVkaXRvci5zZXR0aW5ncy5jb250ZW50X2VkaXRhYmxlKSB7XG5cdFx0XHRcdC8vIENhc2UgMSBJTUUgZG9lc24ndCBpbml0aWFsaXplIGlmIHlvdSBmb2N1cyB0aGUgZG9jdW1lbnRcblx0XHRcdFx0Ly8gRGlzYWJsZWQgc2luY2UgaXQgd2FzIGludGVyZmVycmluZyB3aXRoIHRoZSBjRT1mYWxzZSBsb2dpY1xuXHRcdFx0XHQvLyBBbHNvIGNvdWx0bid0IHJlcHJvZHVjZSB0aGUgaXNzdWUgb24gU2FmYXJpIDlcblx0XHRcdFx0Lypkb20uYmluZChlZGl0b3IuZ2V0RG9jKCksICdmb2N1c2luJywgZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0c2VsZWN0aW9uLnNldFJuZyhzZWxlY3Rpb24uZ2V0Um5nKCkpO1xuXHRcdFx0XHR9KTsqL1xuXG5cdFx0XHRcdC8vIENhc2UgMiBJTUUgZG9lc24ndCBpbml0aWFsaXplIGlmIHlvdSBjbGljayB0aGUgZG9jdW1lbnRFbGVtZW50IGl0IGFsc28gZG9lc24ndCBwcm9wZXJseSBmaXJlIHRoZSBmb2N1c2luIGV2ZW50XG5cdFx0XHRcdC8vIE5lZWRzIHRvIGJlIGJvdGggZG93bi91cCBkdWUgdG8gd2VpcmQgcmVuZGVyaW5nIGJ1ZyBvbiBDaHJvbWUgV2luZG93c1xuXHRcdFx0XHRkb20uYmluZChlZGl0b3IuZ2V0RG9jKCksICdtb3VzZWRvd24gbW91c2V1cCcsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0XHR2YXIgcm5nO1xuXG5cdFx0XHRcdFx0aWYgKGUudGFyZ2V0ID09IGVkaXRvci5nZXREb2MoKS5kb2N1bWVudEVsZW1lbnQpIHtcblx0XHRcdFx0XHRcdHJuZyA9IHNlbGVjdGlvbi5nZXRSbmcoKTtcblx0XHRcdFx0XHRcdGVkaXRvci5nZXRCb2R5KCkuZm9jdXMoKTtcblxuXHRcdFx0XHRcdFx0aWYgKGUudHlwZSA9PSAnbW91c2Vkb3duJykge1xuXHRcdFx0XHRcdFx0XHRpZiAoQ2FyZXRDb250YWluZXIuaXNDYXJldENvbnRhaW5lcihybmcuc3RhcnRDb250YWluZXIpKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0Ly8gRWRnZSBjYXNlIGZvciBtb3VzZWRvd24sIGRyYWcgc2VsZWN0IGFuZCBtb3VzZWRvd24gYWdhaW4gd2l0aGluIHNlbGVjdGlvbiBvbiBDaHJvbWUgV2luZG93cyB0byByZW5kZXIgY2FyZXRcblx0XHRcdFx0XHRcdFx0c2VsZWN0aW9uLnBsYWNlQ2FyZXRBdChlLmNsaWVudFgsIGUuY2xpZW50WSk7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRzZWxlY3Rpb24uc2V0Um5nKHJuZyk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHQvKipcblx0XHQgKiBCYWNrc3BhY2luZyBpbiBGaXJlRm94L0lFIGZyb20gYSBwYXJhZ3JhcGggaW50byBhIGhvcml6b250YWwgcnVsZSByZXN1bHRzIGluIGEgZmxvYXRpbmcgdGV4dCBub2RlIGJlY2F1c2UgdGhlXG5cdFx0ICogYnJvd3NlciBqdXN0IGRlbGV0ZXMgdGhlIHBhcmFncmFwaCAtIHRoZSBicm93c2VyIGZhaWxzIHRvIG1lcmdlIHRoZSB0ZXh0IG5vZGUgd2l0aCBhIGhvcml6b250YWwgcnVsZSBzbyBpdCBpc1xuXHRcdCAqIGxlZnQgdGhlcmUuIFRpbnlNQ0Ugc2VlcyBhIGZsb2F0aW5nIHRleHQgbm9kZSBhbmQgd3JhcHMgaXQgaW4gYSBwYXJhZ3JhcGggb24gdGhlIGtleSB1cCBldmVudCAoRm9yY2VCbG9ja3MuanNcblx0XHQgKiBhZGRSb290QmxvY2tzKSwgbWVhbmluZyB0aGUgYWN0aW9uIGRvZXMgbm90aGluZy4gV2l0aCB0aGlzIGNvZGUsIEZpcmVGb3gvSUUgbWF0Y2hlIHRoZSBiZWhhdmlvdXIgb2Ygb3RoZXJcblx0XHQgKiBicm93c2Vycy5cblx0XHQgKlxuXHRcdCAqIEl0IGFsc28gZml4ZXMgYSBidWcgb24gRmlyZWZveCB3aGVyZSBpdCdzIGltcG9zc2libGUgdG8gZGVsZXRlIEhSIGVsZW1lbnRzLlxuXHRcdCAqL1xuXHRcdGZ1bmN0aW9uIHJlbW92ZUhyT25CYWNrc3BhY2UoKSB7XG5cdFx0XHRlZGl0b3Iub24oJ2tleWRvd24nLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdGlmICghaXNEZWZhdWx0UHJldmVudGVkKGUpICYmIGUua2V5Q29kZSA9PT0gQkFDS1NQQUNFKSB7XG5cdFx0XHRcdFx0Ly8gQ2hlY2sgaWYgdGhlcmUgaXMgYW55IEhSIGVsZW1lbnRzIHRoaXMgaXMgZmFzdGVyIHNpbmNlIGdldFJuZyBvbiBJRSA3ICYgOCBpcyBzbG93XG5cdFx0XHRcdFx0aWYgKCFlZGl0b3IuZ2V0Qm9keSgpLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdocicpLmxlbmd0aCkge1xuXHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmIChzZWxlY3Rpb24uaXNDb2xsYXBzZWQoKSAmJiBzZWxlY3Rpb24uZ2V0Um5nKHRydWUpLnN0YXJ0T2Zmc2V0ID09PSAwKSB7XG5cdFx0XHRcdFx0XHR2YXIgbm9kZSA9IHNlbGVjdGlvbi5nZXROb2RlKCk7XG5cdFx0XHRcdFx0XHR2YXIgcHJldmlvdXNTaWJsaW5nID0gbm9kZS5wcmV2aW91c1NpYmxpbmc7XG5cblx0XHRcdFx0XHRcdGlmIChub2RlLm5vZGVOYW1lID09ICdIUicpIHtcblx0XHRcdFx0XHRcdFx0ZG9tLnJlbW92ZShub2RlKTtcblx0XHRcdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGlmIChwcmV2aW91c1NpYmxpbmcgJiYgcHJldmlvdXNTaWJsaW5nLm5vZGVOYW1lICYmIHByZXZpb3VzU2libGluZy5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSBcImhyXCIpIHtcblx0XHRcdFx0XHRcdFx0ZG9tLnJlbW92ZShwcmV2aW91c1NpYmxpbmcpO1xuXHRcdFx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHQvKipcblx0XHQgKiBGaXJlZm94IDMueCBoYXMgYW4gaXNzdWUgd2hlcmUgdGhlIGJvZHkgZWxlbWVudCB3b24ndCBnZXQgcHJvcGVyIGZvY3VzIGlmIHlvdSBjbGljayBvdXRcblx0XHQgKiBzaWRlIGl0J3MgcmVjdGFuZ2xlLlxuXHRcdCAqL1xuXHRcdGZ1bmN0aW9uIGZvY3VzQm9keSgpIHtcblx0XHRcdC8vIEZpeCBmb3IgYSBmb2N1cyBidWcgaW4gRkYgMy54IHdoZXJlIHRoZSBib2R5IGVsZW1lbnRcblx0XHRcdC8vIHdvdWxkbid0IGdldCBwcm9wZXIgZm9jdXMgaWYgdGhlIHVzZXIgY2xpY2tlZCBvbiB0aGUgSFRNTCBlbGVtZW50XG5cdFx0XHRpZiAoIXdpbmRvdy5SYW5nZS5wcm90b3R5cGUuZ2V0Q2xpZW50UmVjdHMpIHsgLy8gRGV0ZWN0IGdldENsaWVudFJlY3RzIGdvdCBpbnRyb2R1Y2VkIGluIEZGIDRcblx0XHRcdFx0ZWRpdG9yLm9uKCdtb3VzZWRvd24nLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdFx0aWYgKCFpc0RlZmF1bHRQcmV2ZW50ZWQoZSkgJiYgZS50YXJnZXQubm9kZU5hbWUgPT09IFwiSFRNTFwiKSB7XG5cdFx0XHRcdFx0XHR2YXIgYm9keSA9IGVkaXRvci5nZXRCb2R5KCk7XG5cblx0XHRcdFx0XHRcdC8vIEJsdXIgdGhlIGJvZHkgaXQncyBmb2N1c2VkIGJ1dCBub3QgY29ycmVjdGx5IGZvY3VzZWRcblx0XHRcdFx0XHRcdGJvZHkuYmx1cigpO1xuXG5cdFx0XHRcdFx0XHQvLyBSZWZvY3VzIHRoZSBib2R5IGFmdGVyIGEgbGl0dGxlIHdoaWxlXG5cdFx0XHRcdFx0XHREZWxheS5zZXRFZGl0b3JUaW1lb3V0KGVkaXRvciwgZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0XHRcdGJvZHkuZm9jdXMoKTtcblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0LyoqXG5cdFx0ICogV2ViS2l0IGhhcyBhIGJ1ZyB3aGVyZSBpdCBpc24ndCBwb3NzaWJsZSB0byBzZWxlY3QgaW1hZ2UsIGhyIG9yIGFuY2hvciBlbGVtZW50c1xuXHRcdCAqIGJ5IGNsaWNraW5nIG9uIHRoZW0gc28gd2UgbmVlZCB0byBmYWtlIHRoYXQuXG5cdFx0ICovXG5cdFx0ZnVuY3Rpb24gc2VsZWN0Q29udHJvbEVsZW1lbnRzKCkge1xuXHRcdFx0ZWRpdG9yLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0dmFyIHRhcmdldCA9IGUudGFyZ2V0O1xuXG5cdFx0XHRcdC8vIFdvcmthcm91bmQgZm9yIGJ1ZywgaHR0cDovL2J1Z3Mud2Via2l0Lm9yZy9zaG93X2J1Zy5jZ2k/aWQ9MTIyNTBcblx0XHRcdFx0Ly8gV2ViS2l0IGNhbid0IGV2ZW4gZG8gc2ltcGxlIHRoaW5ncyBsaWtlIHNlbGVjdGluZyBhbiBpbWFnZVxuXHRcdFx0XHQvLyBOZWVkcyB0byBiZSB0aGUgc2V0QmFzZUFuZEV4dGVuZCBvciBpdCB3aWxsIGZhaWwgdG8gc2VsZWN0IGZsb2F0ZWQgaW1hZ2VzXG5cdFx0XHRcdGlmICgvXihJTUd8SFIpJC8udGVzdCh0YXJnZXQubm9kZU5hbWUpICYmIGRvbS5nZXRDb250ZW50RWRpdGFibGVQYXJlbnQodGFyZ2V0KSAhPT0gXCJmYWxzZVwiKSB7XG5cdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRcdHNlbGVjdGlvbi5nZXRTZWwoKS5zZXRCYXNlQW5kRXh0ZW50KHRhcmdldCwgMCwgdGFyZ2V0LCAxKTtcblx0XHRcdFx0XHRlZGl0b3Iubm9kZUNoYW5nZWQoKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0YXJnZXQubm9kZU5hbWUgPT0gJ0EnICYmIGRvbS5oYXNDbGFzcyh0YXJnZXQsICdtY2UtaXRlbS1hbmNob3InKSkge1xuXHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHRzZWxlY3Rpb24uc2VsZWN0KHRhcmdldCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdC8qKlxuXHRcdCAqIEZpeGVzIGEgR2Vja28gYnVnIHdoZXJlIHRoZSBzdHlsZSBhdHRyaWJ1dGUgZ2V0cyBhZGRlZCB0byB0aGUgd3JvbmcgZWxlbWVudCB3aGVuIGRlbGV0aW5nIGJldHdlZW4gdHdvIGJsb2NrIGVsZW1lbnRzLlxuXHRcdCAqXG5cdFx0ICogRml4ZXMgZG8gYmFja3NwYWNlL2RlbGV0ZSBvbiB0aGlzOlxuXHRcdCAqIDxwPmJsYVtjazwvcD48cCBzdHlsZT1cImNvbG9yOnJlZFwiPnJdZWQ8L3A+XG5cdFx0ICpcblx0XHQgKiBXb3VsZCBiZWNvbWU6XG5cdFx0ICogPHA+YmxhfGVkPC9wPlxuXHRcdCAqXG5cdFx0ICogSW5zdGVhZCBvZjpcblx0XHQgKiA8cCBzdHlsZT1cImNvbG9yOnJlZFwiPmJsYXxlZDwvcD5cblx0XHQgKi9cblx0XHRmdW5jdGlvbiByZW1vdmVTdHlsZXNXaGVuRGVsZXRpbmdBY3Jvc3NCbG9ja0VsZW1lbnRzKCkge1xuXHRcdFx0ZnVuY3Rpb24gZ2V0QXR0cmlidXRlQXBwbHlGdW5jdGlvbigpIHtcblx0XHRcdFx0dmFyIHRlbXBsYXRlID0gZG9tLmdldEF0dHJpYnMoc2VsZWN0aW9uLmdldFN0YXJ0KCkuY2xvbmVOb2RlKGZhbHNlKSk7XG5cblx0XHRcdFx0cmV0dXJuIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdHZhciB0YXJnZXQgPSBzZWxlY3Rpb24uZ2V0U3RhcnQoKTtcblxuXHRcdFx0XHRcdGlmICh0YXJnZXQgIT09IGVkaXRvci5nZXRCb2R5KCkpIHtcblx0XHRcdFx0XHRcdGRvbS5zZXRBdHRyaWIodGFyZ2V0LCBcInN0eWxlXCIsIG51bGwpO1xuXG5cdFx0XHRcdFx0XHRlYWNoKHRlbXBsYXRlLCBmdW5jdGlvbihhdHRyKSB7XG5cdFx0XHRcdFx0XHRcdHRhcmdldC5zZXRBdHRyaWJ1dGVOb2RlKGF0dHIuY2xvbmVOb2RlKHRydWUpKTtcblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fTtcblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gaXNTZWxlY3Rpb25BY3Jvc3NFbGVtZW50cygpIHtcblx0XHRcdFx0cmV0dXJuICFzZWxlY3Rpb24uaXNDb2xsYXBzZWQoKSAmJlxuXHRcdFx0XHRcdGRvbS5nZXRQYXJlbnQoc2VsZWN0aW9uLmdldFN0YXJ0KCksIGRvbS5pc0Jsb2NrKSAhPSBkb20uZ2V0UGFyZW50KHNlbGVjdGlvbi5nZXRFbmQoKSwgZG9tLmlzQmxvY2spO1xuXHRcdFx0fVxuXG5cdFx0XHRlZGl0b3Iub24oJ2tleXByZXNzJywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHR2YXIgYXBwbHlBdHRyaWJ1dGVzO1xuXG5cdFx0XHRcdGlmICghaXNEZWZhdWx0UHJldmVudGVkKGUpICYmIChlLmtleUNvZGUgPT0gOCB8fCBlLmtleUNvZGUgPT0gNDYpICYmIGlzU2VsZWN0aW9uQWNyb3NzRWxlbWVudHMoKSkge1xuXHRcdFx0XHRcdGFwcGx5QXR0cmlidXRlcyA9IGdldEF0dHJpYnV0ZUFwcGx5RnVuY3Rpb24oKTtcblx0XHRcdFx0XHRlZGl0b3IuZ2V0RG9jKCkuZXhlY0NvbW1hbmQoJ2RlbGV0ZScsIGZhbHNlLCBudWxsKTtcblx0XHRcdFx0XHRhcHBseUF0dHJpYnV0ZXMoKTtcblx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0ZG9tLmJpbmQoZWRpdG9yLmdldERvYygpLCAnY3V0JywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHR2YXIgYXBwbHlBdHRyaWJ1dGVzO1xuXG5cdFx0XHRcdGlmICghaXNEZWZhdWx0UHJldmVudGVkKGUpICYmIGlzU2VsZWN0aW9uQWNyb3NzRWxlbWVudHMoKSkge1xuXHRcdFx0XHRcdGFwcGx5QXR0cmlidXRlcyA9IGdldEF0dHJpYnV0ZUFwcGx5RnVuY3Rpb24oKTtcblxuXHRcdFx0XHRcdERlbGF5LnNldEVkaXRvclRpbWVvdXQoZWRpdG9yLCBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRcdGFwcGx5QXR0cmlidXRlcygpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHQvKipcblx0XHQgKiBTY3JlZW4gcmVhZGVycyBvbiBJRSBuZWVkcyB0byBoYXZlIHRoZSByb2xlIGFwcGxpY2F0aW9uIHNldCBvbiB0aGUgYm9keS5cblx0XHQgKi9cblx0XHRmdW5jdGlvbiBlbnN1cmVCb2R5SGFzUm9sZUFwcGxpY2F0aW9uKCkge1xuXHRcdFx0ZG9jdW1lbnQuYm9keS5zZXRBdHRyaWJ1dGUoXCJyb2xlXCIsIFwiYXBwbGljYXRpb25cIik7XG5cdFx0fVxuXG5cdFx0LyoqXG5cdFx0ICogQmFja3NwYWNpbmcgaW50byBhIHRhYmxlIGJlaGF2ZXMgZGlmZmVyZW50bHkgZGVwZW5kaW5nIHVwb24gYnJvd3NlciB0eXBlLlxuXHRcdCAqIFRoZXJlZm9yZSwgZGlzYWJsZSBCYWNrc3BhY2Ugd2hlbiBjdXJzb3IgaW1tZWRpYXRlbHkgZm9sbG93cyBhIHRhYmxlLlxuXHRcdCAqL1xuXHRcdGZ1bmN0aW9uIGRpc2FibGVCYWNrc3BhY2VJbnRvQVRhYmxlKCkge1xuXHRcdFx0ZWRpdG9yLm9uKCdrZXlkb3duJywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRpZiAoIWlzRGVmYXVsdFByZXZlbnRlZChlKSAmJiBlLmtleUNvZGUgPT09IEJBQ0tTUEFDRSkge1xuXHRcdFx0XHRcdGlmIChzZWxlY3Rpb24uaXNDb2xsYXBzZWQoKSAmJiBzZWxlY3Rpb24uZ2V0Um5nKHRydWUpLnN0YXJ0T2Zmc2V0ID09PSAwKSB7XG5cdFx0XHRcdFx0XHR2YXIgcHJldmlvdXNTaWJsaW5nID0gc2VsZWN0aW9uLmdldE5vZGUoKS5wcmV2aW91c1NpYmxpbmc7XG5cdFx0XHRcdFx0XHRpZiAocHJldmlvdXNTaWJsaW5nICYmIHByZXZpb3VzU2libGluZy5ub2RlTmFtZSAmJiBwcmV2aW91c1NpYmxpbmcubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gXCJ0YWJsZVwiKSB7XG5cdFx0XHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0LyoqXG5cdFx0ICogT2xkIElFIHZlcnNpb25zIGNhbid0IHByb3Blcmx5IHJlbmRlciBCUiBlbGVtZW50cyBpbiBQUkUgdGFncyB3aGl0ZSBpbiBjb250ZW50RWRpdGFibGUgbW9kZS4gU28gdGhpc1xuXHRcdCAqIGxvZ2ljIGFkZHMgYSBcXG4gYmVmb3JlIHRoZSBCUiBzbyB0aGF0IGl0IHdpbGwgZ2V0IHJlbmRlcmVkLlxuXHRcdCAqL1xuXHRcdGZ1bmN0aW9uIGFkZE5ld0xpbmVzQmVmb3JlQnJJblByZSgpIHtcblx0XHRcdC8vIElFOCsgcmVuZGVyaW5nIG1vZGUgZG9lcyB0aGUgcmlnaHQgdGhpbmcgd2l0aCBCUiBpbiBQUkVcblx0XHRcdGlmIChnZXREb2N1bWVudE1vZGUoKSA+IDcpIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBFbmFibGUgZGlzcGxheTogbm9uZSBpbiBhcmVhIGFuZCBhZGQgYSBzcGVjaWZpYyBjbGFzcyB0aGF0IGhpZGVzIGFsbCBCUiBlbGVtZW50cyBpbiBQUkUgdG9cblx0XHRcdC8vIGF2b2lkIHRoZSBjYXJldCBmcm9tIGdldHRpbmcgc3R1Y2sgYXQgdGhlIEJSIGVsZW1lbnRzIHdoaWxlIHByZXNzaW5nIHRoZSByaWdodCBhcnJvdyBrZXlcblx0XHRcdHNldEVkaXRvckNvbW1hbmRTdGF0ZSgnUmVzcGVjdFZpc2liaWxpdHlJbkRlc2lnbicsIHRydWUpO1xuXHRcdFx0ZWRpdG9yLmNvbnRlbnRTdHlsZXMucHVzaCgnLm1jZUhpZGVCckluUHJlIHByZSBiciB7ZGlzcGxheTogbm9uZX0nKTtcblx0XHRcdGRvbS5hZGRDbGFzcyhlZGl0b3IuZ2V0Qm9keSgpLCAnbWNlSGlkZUJySW5QcmUnKTtcblxuXHRcdFx0Ly8gQWRkcyBhIFxcbiBiZWZvcmUgYWxsIEJSIGVsZW1lbnRzIGluIFBSRSB0byBnZXQgdGhlbSB2aXN1YWxcblx0XHRcdHBhcnNlci5hZGROb2RlRmlsdGVyKCdwcmUnLCBmdW5jdGlvbihub2Rlcykge1xuXHRcdFx0XHR2YXIgaSA9IG5vZGVzLmxlbmd0aCwgYnJOb2RlcywgaiwgYnJFbG0sIHNpYmxpbmc7XG5cblx0XHRcdFx0d2hpbGUgKGktLSkge1xuXHRcdFx0XHRcdGJyTm9kZXMgPSBub2Rlc1tpXS5nZXRBbGwoJ2JyJyk7XG5cdFx0XHRcdFx0aiA9IGJyTm9kZXMubGVuZ3RoO1xuXHRcdFx0XHRcdHdoaWxlIChqLS0pIHtcblx0XHRcdFx0XHRcdGJyRWxtID0gYnJOb2Rlc1tqXTtcblxuXHRcdFx0XHRcdFx0Ly8gQWRkIFxcbiBiZWZvcmUgQlIgaW4gUFJFIGVsZW1lbnRzIG9uIG9sZGVyIElFOnMgc28gdGhlIG5ldyBsaW5lcyBnZXQgcmVuZGVyZWRcblx0XHRcdFx0XHRcdHNpYmxpbmcgPSBickVsbS5wcmV2O1xuXHRcdFx0XHRcdFx0aWYgKHNpYmxpbmcgJiYgc2libGluZy50eXBlID09PSAzICYmIHNpYmxpbmcudmFsdWUuY2hhckF0KHNpYmxpbmcudmFsdWUgLSAxKSAhPSAnXFxuJykge1xuXHRcdFx0XHRcdFx0XHRzaWJsaW5nLnZhbHVlICs9ICdcXG4nO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0YnJFbG0ucGFyZW50Lmluc2VydChuZXcgTm9kZSgnI3RleHQnLCAzKSwgYnJFbG0sIHRydWUpLnZhbHVlID0gJ1xcbic7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0Ly8gUmVtb3ZlcyBhbnkgXFxuIGJlZm9yZSBCUiBlbGVtZW50cyBpbiBQUkUgc2luY2Ugb3RoZXIgYnJvd3NlcnMgYW5kIGluIGNvbnRlbnRFZGl0YWJsZT1mYWxzZSBtb2RlIHRoZXkgd2lsbCBiZSB2aXNpYmxlXG5cdFx0XHRzZXJpYWxpemVyLmFkZE5vZGVGaWx0ZXIoJ3ByZScsIGZ1bmN0aW9uKG5vZGVzKSB7XG5cdFx0XHRcdHZhciBpID0gbm9kZXMubGVuZ3RoLCBick5vZGVzLCBqLCBickVsbSwgc2libGluZztcblxuXHRcdFx0XHR3aGlsZSAoaS0tKSB7XG5cdFx0XHRcdFx0YnJOb2RlcyA9IG5vZGVzW2ldLmdldEFsbCgnYnInKTtcblx0XHRcdFx0XHRqID0gYnJOb2Rlcy5sZW5ndGg7XG5cdFx0XHRcdFx0d2hpbGUgKGotLSkge1xuXHRcdFx0XHRcdFx0YnJFbG0gPSBick5vZGVzW2pdO1xuXHRcdFx0XHRcdFx0c2libGluZyA9IGJyRWxtLnByZXY7XG5cdFx0XHRcdFx0XHRpZiAoc2libGluZyAmJiBzaWJsaW5nLnR5cGUgPT0gMykge1xuXHRcdFx0XHRcdFx0XHRzaWJsaW5nLnZhbHVlID0gc2libGluZy52YWx1ZS5yZXBsYWNlKC9cXHI/XFxuJC8sICcnKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdC8qKlxuXHRcdCAqIE1vdmVzIHN0eWxlIHdpZHRoL2hlaWdodCB0byBhdHRyaWJ1dGUgd2lkdGgvaGVpZ2h0IHdoZW4gdGhlIHVzZXIgcmVzaXplcyBhbiBpbWFnZSBvbiBJRS5cblx0XHQgKi9cblx0XHRmdW5jdGlvbiByZW1vdmVQcmVTZXJpYWxpemVkU3R5bGVzV2hlblNlbGVjdGluZ0NvbnRyb2xzKCkge1xuXHRcdFx0ZG9tLmJpbmQoZWRpdG9yLmdldEJvZHkoKSwgJ21vdXNldXAnLCBmdW5jdGlvbigpIHtcblx0XHRcdFx0dmFyIHZhbHVlLCBub2RlID0gc2VsZWN0aW9uLmdldE5vZGUoKTtcblxuXHRcdFx0XHQvLyBNb3ZlZCBzdHlsZXMgdG8gYXR0cmlidXRlcyBvbiBJTUcgZWVtZW50c1xuXHRcdFx0XHRpZiAobm9kZS5ub2RlTmFtZSA9PSAnSU1HJykge1xuXHRcdFx0XHRcdC8vIENvbnZlcnQgc3R5bGUgd2lkdGggdG8gd2lkdGggYXR0cmlidXRlXG5cdFx0XHRcdFx0aWYgKCh2YWx1ZSA9IGRvbS5nZXRTdHlsZShub2RlLCAnd2lkdGgnKSkpIHtcblx0XHRcdFx0XHRcdGRvbS5zZXRBdHRyaWIobm9kZSwgJ3dpZHRoJywgdmFsdWUucmVwbGFjZSgvW14wLTklXSsvZywgJycpKTtcblx0XHRcdFx0XHRcdGRvbS5zZXRTdHlsZShub2RlLCAnd2lkdGgnLCAnJyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Ly8gQ29udmVydCBzdHlsZSBoZWlnaHQgdG8gaGVpZ2h0IGF0dHJpYnV0ZVxuXHRcdFx0XHRcdGlmICgodmFsdWUgPSBkb20uZ2V0U3R5bGUobm9kZSwgJ2hlaWdodCcpKSkge1xuXHRcdFx0XHRcdFx0ZG9tLnNldEF0dHJpYihub2RlLCAnaGVpZ2h0JywgdmFsdWUucmVwbGFjZSgvW14wLTklXSsvZywgJycpKTtcblx0XHRcdFx0XHRcdGRvbS5zZXRTdHlsZShub2RlLCAnaGVpZ2h0JywgJycpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0LyoqXG5cdFx0ICogUmVtb3ZlcyBhIGJsb2NrcXVvdGUgd2hlbiBiYWNrc3BhY2UgaXMgcHJlc3NlZCBhdCB0aGUgYmVnaW5uaW5nIG9mIGl0LlxuXHRcdCAqXG5cdFx0ICogRm9yIGV4YW1wbGU6XG5cdFx0ICogPGJsb2NrcXVvdGU+PHA+fHg8L3A+PC9ibG9ja3F1b3RlPlxuXHRcdCAqXG5cdFx0ICogQmVjb21lczpcblx0XHQgKiA8cD58eDwvcD5cblx0XHQgKi9cblx0XHRmdW5jdGlvbiByZW1vdmVCbG9ja1F1b3RlT25CYWNrU3BhY2UoKSB7XG5cdFx0XHQvLyBBZGQgYmxvY2sgcXVvdGUgZGVsZXRpb24gaGFuZGxlclxuXHRcdFx0ZWRpdG9yLm9uKCdrZXlkb3duJywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHR2YXIgcm5nLCBjb250YWluZXIsIG9mZnNldCwgcm9vdCwgcGFyZW50O1xuXG5cdFx0XHRcdGlmIChpc0RlZmF1bHRQcmV2ZW50ZWQoZSkgfHwgZS5rZXlDb2RlICE9IFZLLkJBQ0tTUEFDRSkge1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJuZyA9IHNlbGVjdGlvbi5nZXRSbmcoKTtcblx0XHRcdFx0Y29udGFpbmVyID0gcm5nLnN0YXJ0Q29udGFpbmVyO1xuXHRcdFx0XHRvZmZzZXQgPSBybmcuc3RhcnRPZmZzZXQ7XG5cdFx0XHRcdHJvb3QgPSBkb20uZ2V0Um9vdCgpO1xuXHRcdFx0XHRwYXJlbnQgPSBjb250YWluZXI7XG5cblx0XHRcdFx0aWYgKCFybmcuY29sbGFwc2VkIHx8IG9mZnNldCAhPT0gMCkge1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHdoaWxlIChwYXJlbnQgJiYgcGFyZW50LnBhcmVudE5vZGUgJiYgcGFyZW50LnBhcmVudE5vZGUuZmlyc3RDaGlsZCA9PSBwYXJlbnQgJiYgcGFyZW50LnBhcmVudE5vZGUgIT0gcm9vdCkge1xuXHRcdFx0XHRcdHBhcmVudCA9IHBhcmVudC5wYXJlbnROb2RlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gSXMgdGhlIGN1cnNvciBhdCB0aGUgYmVnaW5uaW5nIG9mIGEgYmxvY2txdW90ZT9cblx0XHRcdFx0aWYgKHBhcmVudC50YWdOYW1lID09PSAnQkxPQ0tRVU9URScpIHtcblx0XHRcdFx0XHQvLyBSZW1vdmUgdGhlIGJsb2NrcXVvdGVcblx0XHRcdFx0XHRlZGl0b3IuZm9ybWF0dGVyLnRvZ2dsZSgnYmxvY2txdW90ZScsIG51bGwsIHBhcmVudCk7XG5cblx0XHRcdFx0XHQvLyBNb3ZlIHRoZSBjYXJldCB0byB0aGUgYmVnaW5uaW5nIG9mIGNvbnRhaW5lclxuXHRcdFx0XHRcdHJuZyA9IGRvbS5jcmVhdGVSbmcoKTtcblx0XHRcdFx0XHRybmcuc2V0U3RhcnQoY29udGFpbmVyLCAwKTtcblx0XHRcdFx0XHRybmcuc2V0RW5kKGNvbnRhaW5lciwgMCk7XG5cdFx0XHRcdFx0c2VsZWN0aW9uLnNldFJuZyhybmcpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHQvKipcblx0XHQgKiBTZXRzIHZhcmlvdXMgR2Vja28gZWRpdGluZyBvcHRpb25zIG9uIG1vdXNlIGRvd24gYW5kIGJlZm9yZSBhIGV4ZWNDb21tYW5kIHRvIGRpc2FibGUgaW5saW5lIHRhYmxlIGVkaXRpbmcgdGhhdCBpcyBicm9rZW4gZXRjLlxuXHRcdCAqL1xuXHRcdGZ1bmN0aW9uIHNldEdlY2tvRWRpdGluZ09wdGlvbnMoKSB7XG5cdFx0XHRmdW5jdGlvbiBzZXRPcHRzKCkge1xuXHRcdFx0XHRyZWZyZXNoQ29udGVudEVkaXRhYmxlKCk7XG5cblx0XHRcdFx0c2V0RWRpdG9yQ29tbWFuZFN0YXRlKFwiU3R5bGVXaXRoQ1NTXCIsIGZhbHNlKTtcblx0XHRcdFx0c2V0RWRpdG9yQ29tbWFuZFN0YXRlKFwiZW5hYmxlSW5saW5lVGFibGVFZGl0aW5nXCIsIGZhbHNlKTtcblxuXHRcdFx0XHRpZiAoIXNldHRpbmdzLm9iamVjdF9yZXNpemluZykge1xuXHRcdFx0XHRcdHNldEVkaXRvckNvbW1hbmRTdGF0ZShcImVuYWJsZU9iamVjdFJlc2l6aW5nXCIsIGZhbHNlKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAoIXNldHRpbmdzLnJlYWRvbmx5KSB7XG5cdFx0XHRcdGVkaXRvci5vbignQmVmb3JlRXhlY0NvbW1hbmQgTW91c2VEb3duJywgc2V0T3B0cyk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0LyoqXG5cdFx0ICogRml4ZXMgYSBnZWNrbyBsaW5rIGJ1Zywgd2hlbiBhIGxpbmsgaXMgcGxhY2VkIGF0IHRoZSBlbmQgb2YgYmxvY2sgZWxlbWVudHMgdGhlcmUgaXNcblx0XHQgKiBubyB3YXkgdG8gbW92ZSB0aGUgY2FyZXQgYmVoaW5kIHRoZSBsaW5rLiBUaGlzIGZpeCBhZGRzIGEgYm9ndXMgYnIgZWxlbWVudCBhZnRlciB0aGUgbGluay5cblx0XHQgKlxuXHRcdCAqIEZvciBleGFtcGxlIHRoaXM6XG5cdFx0ICogPHA+PGI+PGEgaHJlZj1cIiNcIj54PC9hPjwvYj48L3A+XG5cdFx0ICpcblx0XHQgKiBCZWNvbWVzIHRoaXM6XG5cdFx0ICogPHA+PGI+PGEgaHJlZj1cIiNcIj54PC9hPjwvYj48YnI+PC9wPlxuXHRcdCAqL1xuXHRcdGZ1bmN0aW9uIGFkZEJyQWZ0ZXJMYXN0TGlua3MoKSB7XG5cdFx0XHRmdW5jdGlvbiBmaXhMaW5rcygpIHtcblx0XHRcdFx0ZWFjaChkb20uc2VsZWN0KCdhJyksIGZ1bmN0aW9uKG5vZGUpIHtcblx0XHRcdFx0XHR2YXIgcGFyZW50Tm9kZSA9IG5vZGUucGFyZW50Tm9kZSwgcm9vdCA9IGRvbS5nZXRSb290KCk7XG5cblx0XHRcdFx0XHRpZiAocGFyZW50Tm9kZS5sYXN0Q2hpbGQgPT09IG5vZGUpIHtcblx0XHRcdFx0XHRcdHdoaWxlIChwYXJlbnROb2RlICYmICFkb20uaXNCbG9jayhwYXJlbnROb2RlKSkge1xuXHRcdFx0XHRcdFx0XHRpZiAocGFyZW50Tm9kZS5wYXJlbnROb2RlLmxhc3RDaGlsZCAhPT0gcGFyZW50Tm9kZSB8fCBwYXJlbnROb2RlID09PSByb290KSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cGFyZW50Tm9kZSA9IHBhcmVudE5vZGUucGFyZW50Tm9kZTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0ZG9tLmFkZChwYXJlbnROb2RlLCAnYnInLCB7J2RhdGEtbWNlLWJvZ3VzJzogMX0pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdGVkaXRvci5vbignU2V0Q29udGVudCBFeGVjQ29tbWFuZCcsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0aWYgKGUudHlwZSA9PSBcInNldGNvbnRlbnRcIiB8fCBlLmNvbW1hbmQgPT09ICdtY2VJbnNlcnRMaW5rJykge1xuXHRcdFx0XHRcdGZpeExpbmtzKCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdC8qKlxuXHRcdCAqIFdlYktpdCB3aWxsIHByb2R1Y2UgRElWIGVsZW1lbnRzIGhlcmUgYW5kIHRoZXJlIGJ5IGRlZmF1bHQuIEJ1dCBzaW5jZSBUaW55TUNFIHVzZXMgcGFyYWdyYXBocyBieVxuXHRcdCAqIGRlZmF1bHQgd2Ugd2FudCB0byBjaGFuZ2UgdGhhdCBiZWhhdmlvci5cblx0XHQgKi9cblx0XHRmdW5jdGlvbiBzZXREZWZhdWx0QmxvY2tUeXBlKCkge1xuXHRcdFx0aWYgKHNldHRpbmdzLmZvcmNlZF9yb290X2Jsb2NrKSB7XG5cdFx0XHRcdGVkaXRvci5vbignaW5pdCcsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdHNldEVkaXRvckNvbW1hbmRTdGF0ZSgnRGVmYXVsdFBhcmFncmFwaFNlcGFyYXRvcicsIHNldHRpbmdzLmZvcmNlZF9yb290X2Jsb2NrKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0LyoqXG5cdFx0ICogRGVsZXRlcyB0aGUgc2VsZWN0ZWQgaW1hZ2Ugb24gSUUgaW5zdGVhZCBvZiBuYXZpZ2F0aW5nIHRvIHByZXZpb3VzIHBhZ2UuXG5cdFx0ICovXG5cdFx0ZnVuY3Rpb24gZGVsZXRlQ29udHJvbEl0ZW1PbkJhY2tTcGFjZSgpIHtcblx0XHRcdGVkaXRvci5vbigna2V5ZG93bicsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0dmFyIHJuZztcblxuXHRcdFx0XHRpZiAoIWlzRGVmYXVsdFByZXZlbnRlZChlKSAmJiBlLmtleUNvZGUgPT0gQkFDS1NQQUNFKSB7XG5cdFx0XHRcdFx0cm5nID0gZWRpdG9yLmdldERvYygpLnNlbGVjdGlvbi5jcmVhdGVSYW5nZSgpO1xuXHRcdFx0XHRcdGlmIChybmcgJiYgcm5nLml0ZW0pIHtcblx0XHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHRcdGVkaXRvci51bmRvTWFuYWdlci5iZWZvcmVDaGFuZ2UoKTtcblx0XHRcdFx0XHRcdGRvbS5yZW1vdmUocm5nLml0ZW0oMCkpO1xuXHRcdFx0XHRcdFx0ZWRpdG9yLnVuZG9NYW5hZ2VyLmFkZCgpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0LyoqXG5cdFx0ICogSUUxMCBkb2Vzbid0IHByb3Blcmx5IHJlbmRlciBibG9jayBlbGVtZW50cyB3aXRoIHRoZSByaWdodCBoZWlnaHQgdW50aWwgeW91IGFkZCBjb250ZW50cyB0byB0aGVtLlxuXHRcdCAqIFRoaXMgZml4ZXMgdGhhdCBieSBhZGRpbmcgYSBwYWRkaW5nLXJpZ2h0IHRvIGFsbCBlbXB0eSB0ZXh0IGJsb2NrIGVsZW1lbnRzLlxuXHRcdCAqIFNlZTogaHR0cHM6Ly9jb25uZWN0Lm1pY3Jvc29mdC5jb20vSUUvZmVlZGJhY2svZGV0YWlscy83NDM4ODFcblx0XHQgKi9cblx0XHRmdW5jdGlvbiByZW5kZXJFbXB0eUJsb2Nrc0ZpeCgpIHtcblx0XHRcdHZhciBlbXB0eUJsb2Nrc0NTUztcblxuXHRcdFx0Ly8gSUUxMCtcblx0XHRcdGlmIChnZXREb2N1bWVudE1vZGUoKSA+PSAxMCkge1xuXHRcdFx0XHRlbXB0eUJsb2Nrc0NTUyA9ICcnO1xuXHRcdFx0XHRlYWNoKCdwIGRpdiBoMSBoMiBoMyBoNCBoNSBoNicuc3BsaXQoJyAnKSwgZnVuY3Rpb24obmFtZSwgaSkge1xuXHRcdFx0XHRcdGVtcHR5QmxvY2tzQ1NTICs9IChpID4gMCA/ICcsJyA6ICcnKSArIG5hbWUgKyAnOmVtcHR5Jztcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0ZWRpdG9yLmNvbnRlbnRTdHlsZXMucHVzaChlbXB0eUJsb2Nrc0NTUyArICd7cGFkZGluZy1yaWdodDogMXB4ICFpbXBvcnRhbnR9Jyk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0LyoqXG5cdFx0ICogT2xkIElFIHZlcnNpb25zIGNhbid0IHJldGFpbiBjb250ZW50cyB3aXRoaW4gbm9zY3JpcHQgZWxlbWVudHMgc28gdGhpcyBsb2dpYyB3aWxsIHN0b3JlIHRoZSBjb250ZW50c1xuXHRcdCAqIGFzIGEgYXR0cmlidXRlIGFuZCB0aGUgaW5zZXJ0IHRoYXQgdmFsdWUgYXMgaXQncyByYXcgdGV4dCB3aGVuIHRoZSBET00gaXMgc2VyaWFsaXplZC5cblx0XHQgKi9cblx0XHRmdW5jdGlvbiBrZWVwTm9TY3JpcHRDb250ZW50cygpIHtcblx0XHRcdGlmIChnZXREb2N1bWVudE1vZGUoKSA8IDkpIHtcblx0XHRcdFx0cGFyc2VyLmFkZE5vZGVGaWx0ZXIoJ25vc2NyaXB0JywgZnVuY3Rpb24obm9kZXMpIHtcblx0XHRcdFx0XHR2YXIgaSA9IG5vZGVzLmxlbmd0aCwgbm9kZSwgdGV4dE5vZGU7XG5cblx0XHRcdFx0XHR3aGlsZSAoaS0tKSB7XG5cdFx0XHRcdFx0XHRub2RlID0gbm9kZXNbaV07XG5cdFx0XHRcdFx0XHR0ZXh0Tm9kZSA9IG5vZGUuZmlyc3RDaGlsZDtcblxuXHRcdFx0XHRcdFx0aWYgKHRleHROb2RlKSB7XG5cdFx0XHRcdFx0XHRcdG5vZGUuYXR0cignZGF0YS1tY2UtaW5uZXJ0ZXh0JywgdGV4dE5vZGUudmFsdWUpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0c2VyaWFsaXplci5hZGROb2RlRmlsdGVyKCdub3NjcmlwdCcsIGZ1bmN0aW9uKG5vZGVzKSB7XG5cdFx0XHRcdFx0dmFyIGkgPSBub2Rlcy5sZW5ndGgsIG5vZGUsIHRleHROb2RlLCB2YWx1ZTtcblxuXHRcdFx0XHRcdHdoaWxlIChpLS0pIHtcblx0XHRcdFx0XHRcdG5vZGUgPSBub2Rlc1tpXTtcblx0XHRcdFx0XHRcdHRleHROb2RlID0gbm9kZXNbaV0uZmlyc3RDaGlsZDtcblxuXHRcdFx0XHRcdFx0aWYgKHRleHROb2RlKSB7XG5cdFx0XHRcdFx0XHRcdHRleHROb2RlLnZhbHVlID0gRW50aXRpZXMuZGVjb2RlKHRleHROb2RlLnZhbHVlKTtcblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdC8vIE9sZCBJRSBjYW4ndCByZXRhaW4gbm9zY3JpcHQgdmFsdWUgc28gYW4gYXR0cmlidXRlIGlzIHVzZWQgdG8gc3RvcmUgaXRcblx0XHRcdFx0XHRcdFx0dmFsdWUgPSBub2RlLmF0dHJpYnV0ZXMubWFwWydkYXRhLW1jZS1pbm5lcnRleHQnXTtcblx0XHRcdFx0XHRcdFx0aWYgKHZhbHVlKSB7XG5cdFx0XHRcdFx0XHRcdFx0bm9kZS5hdHRyKCdkYXRhLW1jZS1pbm5lcnRleHQnLCBudWxsKTtcblx0XHRcdFx0XHRcdFx0XHR0ZXh0Tm9kZSA9IG5ldyBOb2RlKCcjdGV4dCcsIDMpO1xuXHRcdFx0XHRcdFx0XHRcdHRleHROb2RlLnZhbHVlID0gdmFsdWU7XG5cdFx0XHRcdFx0XHRcdFx0dGV4dE5vZGUucmF3ID0gdHJ1ZTtcblx0XHRcdFx0XHRcdFx0XHRub2RlLmFwcGVuZCh0ZXh0Tm9kZSk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8qKlxuXHRcdCAqIElFIGhhcyBhbiBpc3N1ZSB3aGVyZSB5b3UgY2FuJ3Qgc2VsZWN0L21vdmUgdGhlIGNhcmV0IGJ5IGNsaWNraW5nIG91dHNpZGUgdGhlIGJvZHkgaWYgdGhlIGRvY3VtZW50IGlzIGluIHN0YW5kYXJkcyBtb2RlLlxuXHRcdCAqL1xuXHRcdGZ1bmN0aW9uIGZpeENhcmV0U2VsZWN0aW9uT2ZEb2N1bWVudEVsZW1lbnRPbkllKCkge1xuXHRcdFx0dmFyIGRvYyA9IGRvbS5kb2MsIGJvZHkgPSBkb2MuYm9keSwgc3RhcnRlZCwgc3RhcnRSbmcsIGh0bWxFbG07XG5cblx0XHRcdC8vIFJldHVybiByYW5nZSBmcm9tIHBvaW50IG9yIG51bGwgaWYgaXQgZmFpbGVkXG5cdFx0XHRmdW5jdGlvbiBybmdGcm9tUG9pbnQoeCwgeSkge1xuXHRcdFx0XHR2YXIgcm5nID0gYm9keS5jcmVhdGVUZXh0UmFuZ2UoKTtcblxuXHRcdFx0XHR0cnkge1xuXHRcdFx0XHRcdHJuZy5tb3ZlVG9Qb2ludCh4LCB5KTtcblx0XHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0XHQvLyBJRSBzb21ldGltZXMgdGhyb3dzIGFuZCBleGNlcHRpb24sIHNvIGxldHMganVzdCBpZ25vcmUgaXRcblx0XHRcdFx0XHRybmcgPSBudWxsO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJuZztcblx0XHRcdH1cblxuXHRcdFx0Ly8gRmlyZXMgd2hpbGUgdGhlIHNlbGVjdGlvbiBpcyBjaGFuZ2luZ1xuXHRcdFx0ZnVuY3Rpb24gc2VsZWN0aW9uQ2hhbmdlKGUpIHtcblx0XHRcdFx0dmFyIHBvaW50Um5nO1xuXG5cdFx0XHRcdC8vIENoZWNrIGlmIHRoZSBidXR0b24gaXMgZG93biBvciBub3Rcblx0XHRcdFx0aWYgKGUuYnV0dG9uKSB7XG5cdFx0XHRcdFx0Ly8gQ3JlYXRlIHJhbmdlIGZyb20gbW91c2UgcG9zaXRpb25cblx0XHRcdFx0XHRwb2ludFJuZyA9IHJuZ0Zyb21Qb2ludChlLngsIGUueSk7XG5cblx0XHRcdFx0XHRpZiAocG9pbnRSbmcpIHtcblx0XHRcdFx0XHRcdC8vIENoZWNrIGlmIHBvaW50UmFuZ2UgaXMgYmVmb3JlL2FmdGVyIHNlbGVjdGlvbiB0aGVuIGNoYW5nZSB0aGUgZW5kUG9pbnRcblx0XHRcdFx0XHRcdGlmIChwb2ludFJuZy5jb21wYXJlRW5kUG9pbnRzKCdTdGFydFRvU3RhcnQnLCBzdGFydFJuZykgPiAwKSB7XG5cdFx0XHRcdFx0XHRcdHBvaW50Um5nLnNldEVuZFBvaW50KCdTdGFydFRvU3RhcnQnLCBzdGFydFJuZyk7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRwb2ludFJuZy5zZXRFbmRQb2ludCgnRW5kVG9FbmQnLCBzdGFydFJuZyk7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHBvaW50Um5nLnNlbGVjdCgpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRlbmRTZWxlY3Rpb24oKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHQvLyBSZW1vdmVzIGxpc3RlbmVyc1xuXHRcdFx0ZnVuY3Rpb24gZW5kU2VsZWN0aW9uKCkge1xuXHRcdFx0XHR2YXIgcm5nID0gZG9jLnNlbGVjdGlvbi5jcmVhdGVSYW5nZSgpO1xuXG5cdFx0XHRcdC8vIElmIHRoZSByYW5nZSBpcyBjb2xsYXBzZWQgdGhlbiB1c2UgdGhlIGxhc3Qgc3RhcnQgcmFuZ2Vcblx0XHRcdFx0aWYgKHN0YXJ0Um5nICYmICFybmcuaXRlbSAmJiBybmcuY29tcGFyZUVuZFBvaW50cygnU3RhcnRUb0VuZCcsIHJuZykgPT09IDApIHtcblx0XHRcdFx0XHRzdGFydFJuZy5zZWxlY3QoKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGRvbS51bmJpbmQoZG9jLCAnbW91c2V1cCcsIGVuZFNlbGVjdGlvbik7XG5cdFx0XHRcdGRvbS51bmJpbmQoZG9jLCAnbW91c2Vtb3ZlJywgc2VsZWN0aW9uQ2hhbmdlKTtcblx0XHRcdFx0c3RhcnRSbmcgPSBzdGFydGVkID0gMDtcblx0XHRcdH1cblxuXHRcdFx0Ly8gTWFrZSBIVE1MIGVsZW1lbnQgdW5zZWxlY3RhYmxlIHNpbmNlIHdlIGFyZSBnb2luZyB0byBoYW5kbGUgc2VsZWN0aW9uIGJ5IGhhbmRcblx0XHRcdGRvYy5kb2N1bWVudEVsZW1lbnQudW5zZWxlY3RhYmxlID0gdHJ1ZTtcblxuXHRcdFx0Ly8gRGV0ZWN0IHdoZW4gdXNlciBzZWxlY3RzIG91dHNpZGUgQk9EWVxuXHRcdFx0ZG9tLmJpbmQoZG9jLCAnbW91c2Vkb3duIGNvbnRleHRtZW51JywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRpZiAoZS50YXJnZXQubm9kZU5hbWUgPT09ICdIVE1MJykge1xuXHRcdFx0XHRcdGlmIChzdGFydGVkKSB7XG5cdFx0XHRcdFx0XHRlbmRTZWxlY3Rpb24oKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHQvLyBEZXRlY3QgdmVydGljYWwgc2Nyb2xsYmFyLCBzaW5jZSBJRSB3aWxsIGZpcmUgYSBtb3VzZWRvd24gb24gdGhlIHNjcm9sbGJhciBhbmQgaGF2ZSB0YXJnZXQgc2V0IGFzIEhUTUxcblx0XHRcdFx0XHRodG1sRWxtID0gZG9jLmRvY3VtZW50RWxlbWVudDtcblx0XHRcdFx0XHRpZiAoaHRtbEVsbS5zY3JvbGxIZWlnaHQgPiBodG1sRWxtLmNsaWVudEhlaWdodCkge1xuXHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHN0YXJ0ZWQgPSAxO1xuXHRcdFx0XHRcdC8vIFNldHVwIHN0YXJ0IHBvc2l0aW9uXG5cdFx0XHRcdFx0c3RhcnRSbmcgPSBybmdGcm9tUG9pbnQoZS54LCBlLnkpO1xuXHRcdFx0XHRcdGlmIChzdGFydFJuZykge1xuXHRcdFx0XHRcdFx0Ly8gTGlzdGVuIGZvciBzZWxlY3Rpb24gY2hhbmdlIGV2ZW50c1xuXHRcdFx0XHRcdFx0ZG9tLmJpbmQoZG9jLCAnbW91c2V1cCcsIGVuZFNlbGVjdGlvbik7XG5cdFx0XHRcdFx0XHRkb20uYmluZChkb2MsICdtb3VzZW1vdmUnLCBzZWxlY3Rpb25DaGFuZ2UpO1xuXG5cdFx0XHRcdFx0XHRkb20uZ2V0Um9vdCgpLmZvY3VzKCk7XG5cdFx0XHRcdFx0XHRzdGFydFJuZy5zZWxlY3QoKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdC8qKlxuXHRcdCAqIEZpeGVzIHNlbGVjdGlvbiBpc3N1ZXMgd2hlcmUgdGhlIGNhcmV0IGNhbiBiZSBwbGFjZWQgYmV0d2VlbiB0d28gaW5saW5lIGVsZW1lbnRzIGxpa2UgPGI+YTwvYj58PGI+YjwvYj5cblx0XHQgKiB0aGlzIGZpeCB3aWxsIGxlYW4gdGhlIGNhcmV0IHJpZ2h0IGludG8gdGhlIGNsb3Nlc3QgaW5saW5lIGVsZW1lbnQuXG5cdFx0ICovXG5cdFx0ZnVuY3Rpb24gbm9ybWFsaXplU2VsZWN0aW9uKCkge1xuXHRcdFx0Ly8gTm9ybWFsaXplIHNlbGVjdGlvbiBmb3IgZXhhbXBsZSA8Yj5hPC9iPjxpPnxhPC9pPiBiZWNvbWVzIDxiPmF8PC9iPjxpPmE8L2k+IGV4Y2VwdCBmb3IgQ3RybCtBIHNpbmNlIGl0IHNlbGVjdHMgZXZlcnl0aGluZ1xuXHRcdFx0ZWRpdG9yLm9uKCdrZXl1cCBmb2N1c2luIG1vdXNldXAnLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdGlmIChlLmtleUNvZGUgIT0gNjUgfHwgIVZLLm1ldGFLZXlQcmVzc2VkKGUpKSB7XG5cdFx0XHRcdFx0c2VsZWN0aW9uLm5vcm1hbGl6ZSgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9LCB0cnVlKTtcblx0XHR9XG5cblx0XHQvKipcblx0XHQgKiBGb3JjZXMgR2Vja28gdG8gcmVuZGVyIGEgYnJva2VuIGltYWdlIGljb24gaWYgaXQgZmFpbHMgdG8gbG9hZCBhbiBpbWFnZS5cblx0XHQgKi9cblx0XHRmdW5jdGlvbiBzaG93QnJva2VuSW1hZ2VJY29uKCkge1xuXHRcdFx0ZWRpdG9yLmNvbnRlbnRTdHlsZXMucHVzaChcblx0XHRcdFx0J2ltZzotbW96LWJyb2tlbiB7JyArXG5cdFx0XHRcdFx0Jy1tb3otZm9yY2UtYnJva2VuLWltYWdlLWljb246MTsnICtcblx0XHRcdFx0XHQnbWluLXdpZHRoOjI0cHg7JyArXG5cdFx0XHRcdFx0J21pbi1oZWlnaHQ6MjRweCcgK1xuXHRcdFx0XHQnfSdcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0LyoqXG5cdFx0ICogaU9TIGhhcyBhIGJ1ZyB3aGVyZSBpdCdzIGltcG9zc2libGUgdG8gdHlwZSBpZiB0aGUgZG9jdW1lbnQgaGFzIGEgdG91Y2hzdGFydCBldmVudFxuXHRcdCAqIGJvdW5kIGFuZCB0aGUgdXNlciB0b3VjaGVzIHRoZSBkb2N1bWVudCB3aGlsZSBoYXZpbmcgdGhlIG9uIHNjcmVlbiBrZXlib2FyZCB2aXNpYmxlLlxuXHRcdCAqXG5cdFx0ICogVGhlIHRvdWNoIGV2ZW50IG1vdmVzIHRoZSBmb2N1cyB0byB0aGUgcGFyZW50IGRvY3VtZW50IHdoaWxlIGhhdmluZyB0aGUgY2FyZXQgaW5zaWRlIHRoZSBpZnJhbWVcblx0XHQgKiB0aGlzIGZpeCBtb3ZlcyB0aGUgZm9jdXMgYmFjayBpbnRvIHRoZSBpZnJhbWUgZG9jdW1lbnQuXG5cdFx0ICovXG5cdFx0ZnVuY3Rpb24gcmVzdG9yZUZvY3VzT25LZXlEb3duKCkge1xuXHRcdFx0aWYgKCFlZGl0b3IuaW5saW5lKSB7XG5cdFx0XHRcdGVkaXRvci5vbigna2V5ZG93bicsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdGlmIChkb2N1bWVudC5hY3RpdmVFbGVtZW50ID09IGRvY3VtZW50LmJvZHkpIHtcblx0XHRcdFx0XHRcdGVkaXRvci5nZXRXaW4oKS5mb2N1cygpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0LyoqXG5cdFx0ICogSUUgMTEgaGFzIGFuIGFubm95aW5nIGlzc3VlIHdoZXJlIHlvdSBjYW4ndCBtb3ZlIGZvY3VzIGludG8gdGhlIGVkaXRvclxuXHRcdCAqIGJ5IGNsaWNraW5nIG9uIHRoZSB3aGl0ZSBhcmVhIEhUTUwgZWxlbWVudC4gV2UgdXNlZCB0byBiZSBhYmxlIHRvIHRvIGZpeCB0aGlzIHdpdGhcblx0XHQgKiB0aGUgZml4Q2FyZXRTZWxlY3Rpb25PZkRvY3VtZW50RWxlbWVudE9uSWUgZml4LiBCdXQgc2luY2UgTSQgcmVtb3ZlZCB0aGUgc2VsZWN0aW9uXG5cdFx0ICogb2JqZWN0IGl0J3Mgbm90IHBvc3NpYmxlIGFueW1vcmUuIFNvIHdlIG5lZWQgdG8gaGFjayBpbiBhIHVuZ2x5IENTUyB0byBmb3JjZSB0aGVcblx0XHQgKiBib2R5IHRvIGJlIGF0IGxlYXN0IDE1MHB4LiBJZiB0aGUgdXNlciBjbGlja3MgdGhlIEhUTUwgZWxlbWVudCBvdXQgc2lkZSB0aGlzIDE1MHB4IHJlZ2lvblxuXHRcdCAqIHdlIHNpbXBseSBtb3ZlIHRoZSBmb2N1cyBpbnRvIHRoZSBmaXJzdCBwYXJhZ3JhcGguIE5vdCBpZGVhbCBzaW5jZSB5b3UgbG9vc2UgdGhlXG5cdFx0ICogcG9zaXRpb25pbmcgb2YgdGhlIGNhcmV0IGJ1dCBnb290IGVub3VnaCBmb3IgbW9zdCBjYXNlcy5cblx0XHQgKi9cblx0XHRmdW5jdGlvbiBib2R5SGVpZ2h0KCkge1xuXHRcdFx0aWYgKCFlZGl0b3IuaW5saW5lKSB7XG5cdFx0XHRcdGVkaXRvci5jb250ZW50U3R5bGVzLnB1c2goJ2JvZHkge21pbi1oZWlnaHQ6IDE1MHB4fScpO1xuXHRcdFx0XHRlZGl0b3Iub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRcdHZhciBybmc7XG5cblx0XHRcdFx0XHRpZiAoZS50YXJnZXQubm9kZU5hbWUgPT0gJ0hUTUwnKSB7XG5cdFx0XHRcdFx0XHQvLyBFZGdlIHNlZW1zIHRvIG9ubHkgbmVlZCBmb2N1cyBpZiB3ZSBzZXQgdGhlIHJhbmdlXG5cdFx0XHRcdFx0XHQvLyB0aGUgY2FyZXQgd2lsbCBiZWNvbWUgaW52aXNpYmxlIGFuZCBtb3ZlZCBvdXQgb2YgdGhlIGlmcmFtZSEhXG5cdFx0XHRcdFx0XHRpZiAoRW52LmllID4gMTEpIHtcblx0XHRcdFx0XHRcdFx0ZWRpdG9yLmdldEJvZHkoKS5mb2N1cygpO1xuXHRcdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdC8vIE5lZWQgdG8gc3RvcmUgYXdheSBub24gY29sbGFwc2VkIHJhbmdlcyBzaW5jZSB0aGUgZm9jdXMgY2FsbCB3aWxsIG1lc3MgdGhhdCB1cCBzZWUgIzczODJcblx0XHRcdFx0XHRcdHJuZyA9IGVkaXRvci5zZWxlY3Rpb24uZ2V0Um5nKCk7XG5cdFx0XHRcdFx0XHRlZGl0b3IuZ2V0Qm9keSgpLmZvY3VzKCk7XG5cdFx0XHRcdFx0XHRlZGl0b3Iuc2VsZWN0aW9uLnNldFJuZyhybmcpO1xuXHRcdFx0XHRcdFx0ZWRpdG9yLnNlbGVjdGlvbi5ub3JtYWxpemUoKTtcblx0XHRcdFx0XHRcdGVkaXRvci5ub2RlQ2hhbmdlZCgpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0LyoqXG5cdFx0ICogRmlyZWZveCBvbiBNYWMgT1Mgd2lsbCBtb3ZlIHRoZSBicm93c2VyIGJhY2sgdG8gdGhlIHByZXZpb3VzIHBhZ2UgaWYgeW91IHByZXNzIENNRCtMZWZ0IGFycm93LlxuXHRcdCAqIFlvdSBtaWdodCB0aGVuIGxvb3NlIGFsbCB5b3VyIHdvcmsgc28gd2UgbmVlZCB0byBibG9jayB0aGF0IGJlaGF2aW9yIGFuZCByZXBsYWNlIGl0IHdpdGggb3VyIG93bi5cblx0XHQgKi9cblx0XHRmdW5jdGlvbiBibG9ja0NtZEFycm93TmF2aWdhdGlvbigpIHtcblx0XHRcdGlmIChFbnYubWFjKSB7XG5cdFx0XHRcdGVkaXRvci5vbigna2V5ZG93bicsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0XHRpZiAoVksubWV0YUtleVByZXNzZWQoZSkgJiYgIWUuc2hpZnRLZXkgJiYgKGUua2V5Q29kZSA9PSAzNyB8fCBlLmtleUNvZGUgPT0gMzkpKSB7XG5cdFx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdFx0XHRlZGl0b3Iuc2VsZWN0aW9uLmdldFNlbCgpLm1vZGlmeSgnbW92ZScsIGUua2V5Q29kZSA9PSAzNyA/ICdiYWNrd2FyZCcgOiAnZm9yd2FyZCcsICdsaW5lYm91bmRhcnknKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8qKlxuXHRcdCAqIERpc2FibGVzIHRoZSBhdXRvbGlua2luZyBpbiBJRSA5KyB0aGlzIGlzIHRoZW4gcmUtZW5hYmxlZCBieSB0aGUgYXV0b2xpbmsgcGx1Z2luLlxuXHRcdCAqL1xuXHRcdGZ1bmN0aW9uIGRpc2FibGVBdXRvVXJsRGV0ZWN0KCkge1xuXHRcdFx0c2V0RWRpdG9yQ29tbWFuZFN0YXRlKFwiQXV0b1VybERldGVjdFwiLCBmYWxzZSk7XG5cdFx0fVxuXG5cdFx0LyoqXG5cdFx0ICogaU9TIDcuMSBpbnRyb2R1Y2VkIHR3byBuZXcgYnVnczpcblx0XHQgKiAxKSBJdCdzIHBvc3NpYmxlIHRvIG9wZW4gbGlua3Mgd2l0aGluIGEgY29udGVudEVkaXRhYmxlIGFyZWEgYnkgY2xpY2tpbmcgb24gdGhlbS5cblx0XHQgKiAyKSBJZiB5b3UgaG9sZCBkb3duIHRoZSBmaW5nZXIgaXQgd2lsbCBkaXNwbGF5IHRoZSBsaW5rL2ltYWdlIHRvdWNoIGNhbGxvdXQgbWVudS5cblx0XHQgKi9cblx0XHRmdW5jdGlvbiB0YXBMaW5rc0FuZEltYWdlcygpIHtcblx0XHRcdGVkaXRvci5vbignY2xpY2snLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdHZhciBlbG0gPSBlLnRhcmdldDtcblxuXHRcdFx0XHRkbyB7XG5cdFx0XHRcdFx0aWYgKGVsbS50YWdOYW1lID09PSAnQScpIHtcblx0XHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gd2hpbGUgKChlbG0gPSBlbG0ucGFyZW50Tm9kZSkpO1xuXHRcdFx0fSk7XG5cblx0XHRcdGVkaXRvci5jb250ZW50U3R5bGVzLnB1c2goJy5tY2UtY29udGVudC1ib2R5IHstd2Via2l0LXRvdWNoLWNhbGxvdXQ6IG5vbmV9Jyk7XG5cdFx0fVxuXG5cdFx0LyoqXG5cdFx0ICogaU9TIFNhZmFyaSBhbmQgcG9zc2libGUgb3RoZXIgYnJvd3NlcnMgaGF2ZSBhIGJ1ZyB3aGVyZSBpdCB3b24ndCBmaXJlXG5cdFx0ICogYSBjbGljayBldmVudCB3aGVuIGEgY29udGVudEVkaXRhYmxlIGlzIGZvY3VzZWQuIFRoaXMgZnVuY3Rpb24gZmFrZXMgY2xpY2sgZXZlbnRzXG5cdFx0ICogYnkgdXNpbmcgdG91Y2hzdGFydC90b3VjaGVuZCBhbmQgbWVhc3VyaW5nIHRoZSB0aW1lIGFuZCBkaXN0YW5jZSB0cmF2ZWxsZWQuXG5cdFx0ICovXG5cdFx0Lypcblx0XHRmdW5jdGlvbiB0b3VjaENsaWNrRXZlbnQoKSB7XG5cdFx0XHRlZGl0b3Iub24oJ3RvdWNoc3RhcnQnLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdHZhciBlbG0sIHRpbWUsIHN0YXJ0VG91Y2gsIGNoYW5nZWRUb3VjaGVzO1xuXG5cdFx0XHRcdGVsbSA9IGUudGFyZ2V0O1xuXHRcdFx0XHR0aW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG5cdFx0XHRcdGNoYW5nZWRUb3VjaGVzID0gZS5jaGFuZ2VkVG91Y2hlcztcblxuXHRcdFx0XHRpZiAoIWNoYW5nZWRUb3VjaGVzIHx8IGNoYW5nZWRUb3VjaGVzLmxlbmd0aCA+IDEpIHtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRzdGFydFRvdWNoID0gY2hhbmdlZFRvdWNoZXNbMF07XG5cblx0XHRcdFx0ZWRpdG9yLm9uY2UoJ3RvdWNoZW5kJywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRcdHZhciBlbmRUb3VjaCA9IGUuY2hhbmdlZFRvdWNoZXNbMF0sIGFyZ3M7XG5cblx0XHRcdFx0XHRpZiAobmV3IERhdGUoKS5nZXRUaW1lKCkgLSB0aW1lID4gNTAwKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKE1hdGguYWJzKHN0YXJ0VG91Y2guY2xpZW50WCAtIGVuZFRvdWNoLmNsaWVudFgpID4gNSkge1xuXHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmIChNYXRoLmFicyhzdGFydFRvdWNoLmNsaWVudFkgLSBlbmRUb3VjaC5jbGllbnRZKSA+IDUpIHtcblx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRhcmdzID0ge1xuXHRcdFx0XHRcdFx0dGFyZ2V0OiBlbG1cblx0XHRcdFx0XHR9O1xuXG5cdFx0XHRcdFx0ZWFjaCgncGFnZVggcGFnZVkgY2xpZW50WCBjbGllbnRZIHNjcmVlblggc2NyZWVuWScuc3BsaXQoJyAnKSwgZnVuY3Rpb24oa2V5KSB7XG5cdFx0XHRcdFx0XHRhcmdzW2tleV0gPSBlbmRUb3VjaFtrZXldO1xuXHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0YXJncyA9IGVkaXRvci5maXJlKCdjbGljaycsIGFyZ3MpO1xuXG5cdFx0XHRcdFx0aWYgKCFhcmdzLmlzRGVmYXVsdFByZXZlbnRlZCgpKSB7XG5cdFx0XHRcdFx0XHQvLyBpT1MgV2ViS2l0IGNhbid0IHBsYWNlIHRoZSBjYXJldCBwcm9wZXJseSBvbmNlXG5cdFx0XHRcdFx0XHQvLyB5b3UgYmluZCB0b3VjaCBldmVudHMgc28gd2UgbmVlZCB0byBkbyB0aGlzIG1hbnVhbGx5XG5cdFx0XHRcdFx0XHQvLyBUT0RPOiBFeHBhbmQgdG8gdGhlIGNsb3Nlc3Qgd29yZD8gVG91YmxlIHRhcCBzdGlsbCB3b3Jrcy5cblx0XHRcdFx0XHRcdGVkaXRvci5zZWxlY3Rpb24ucGxhY2VDYXJldEF0KGVuZFRvdWNoLmNsaWVudFgsIGVuZFRvdWNoLmNsaWVudFkpO1xuXHRcdFx0XHRcdFx0ZWRpdG9yLm5vZGVDaGFuZ2VkKCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblx0XHRcdH0pO1xuXHRcdH1cblx0XHQqL1xuXG5cdFx0LyoqXG5cdFx0ICogV2ViS2l0IGhhcyBhIGJ1ZyB3aGVyZSBpdCB3aWxsIGFsbG93IGZvcm1zIHRvIGJlIHN1Ym1pdHRlZCBpZiB0aGV5IGFyZSBpbnNpZGUgYSBjb250ZW50RWRpdGFibGUgZWxlbWVudC5cblx0XHQgKiBGb3IgZXhhbXBsZSB0aGlzOiA8Zm9ybT48YnV0dG9uPjwvZm9ybT5cblx0XHQgKi9cblx0XHRmdW5jdGlvbiBibG9ja0Zvcm1TdWJtaXRJbnNpZGVFZGl0b3IoKSB7XG5cdFx0XHRlZGl0b3Iub24oJ2luaXQnLCBmdW5jdGlvbigpIHtcblx0XHRcdFx0ZWRpdG9yLmRvbS5iaW5kKGVkaXRvci5nZXRCb2R5KCksICdzdWJtaXQnLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdC8qKlxuXHRcdCAqIFNvbWV0aW1lcyBXZWJLaXQvQmxpbmsgZ2VuZXJhdGVzIEJSIGVsZW1lbnRzIHdpdGggdGhlIEFwcGxlLWludGVyY2hhbmdlLW5ld2xpbmUgY2xhc3MuXG5cdFx0ICpcblx0XHQgKiBTY2VuYXJpbzpcblx0XHQgKiAgMSkgQ3JlYXRlIGEgdGFibGUgMngyLlxuXHRcdCAqICAyKSBTZWxlY3QgYW5kIGNvcHkgY2VsbHMgQTItQjIuXG5cdFx0ICogIDMpIFBhc3RlIGFuZCBpdCB3aWxsIGFkZCBCUiBlbGVtZW50IHRvIHRhYmxlIGNlbGwuXG5cdFx0ICovXG5cdFx0ZnVuY3Rpb24gcmVtb3ZlQXBwbGVJbnRlcmNoYW5nZUJycygpIHtcblx0XHRcdHBhcnNlci5hZGROb2RlRmlsdGVyKCdicicsIGZ1bmN0aW9uKG5vZGVzKSB7XG5cdFx0XHRcdHZhciBpID0gbm9kZXMubGVuZ3RoO1xuXG5cdFx0XHRcdHdoaWxlIChpLS0pIHtcblx0XHRcdFx0XHRpZiAobm9kZXNbaV0uYXR0cignY2xhc3MnKSA9PSAnQXBwbGUtaW50ZXJjaGFuZ2UtbmV3bGluZScpIHtcblx0XHRcdFx0XHRcdG5vZGVzW2ldLnJlbW92ZSgpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0LyoqXG5cdFx0ICogSUUgY2Fubm90IHNldCBjdXN0b20gY29udGVudFR5cGUncyBvbiBkcmFnIGV2ZW50cywgYW5kIGFsc28gZG9lcyBub3QgcHJvcGVybHkgZHJhZy9kcm9wIGJldHdlZW5cblx0XHQgKiBlZGl0b3JzLiBUaGlzIHVzZXMgYSBzcGVjaWFsIGRhdGE6dGV4dC9tY2UtaW50ZXJuYWwgVVJMIHRvIHBhc3MgZGF0YSB3aGVuIGRyYWcvZHJvcCBiZXR3ZWVuIGVkaXRvcnMuXG5cdFx0ICovXG5cdFx0ZnVuY3Rpb24gaWVJbnRlcm5hbERyYWdBbmREcm9wKCkge1xuXHRcdFx0ZWRpdG9yLm9uKCdkcmFnc3RhcnQnLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdHNldE1jZUludGVybmFsQ29udGVudChlKTtcblx0XHRcdH0pO1xuXG5cdFx0XHRlZGl0b3Iub24oJ2Ryb3AnLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdGlmICghaXNEZWZhdWx0UHJldmVudGVkKGUpKSB7XG5cdFx0XHRcdFx0dmFyIGludGVybmFsQ29udGVudCA9IGdldE1jZUludGVybmFsQ29udGVudChlKTtcblxuXHRcdFx0XHRcdGlmIChpbnRlcm5hbENvbnRlbnQgJiYgaW50ZXJuYWxDb250ZW50LmlkICE9IGVkaXRvci5pZCkge1xuXHRcdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdFx0XHRcdFx0XHR2YXIgcm5nID0gUmFuZ2VVdGlscy5nZXRDYXJldFJhbmdlRnJvbVBvaW50KGUueCwgZS55LCBlZGl0b3IuZ2V0RG9jKCkpO1xuXHRcdFx0XHRcdFx0c2VsZWN0aW9uLnNldFJuZyhybmcpO1xuXHRcdFx0XHRcdFx0aW5zZXJ0Q2xpcGJvYXJkQ29udGVudHMoaW50ZXJuYWxDb250ZW50Lmh0bWwpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gcmVmcmVzaENvbnRlbnRFZGl0YWJsZSgpIHtcblx0XHRcdC8vIE5vLW9wIHNpbmNlIE1vemlsbGEgc2VlbXMgdG8gaGF2ZSBmaXhlZCB0aGUgY2FyZXQgcmVwYWludCBpc3N1ZXNcblx0XHR9XG5cblx0XHRmdW5jdGlvbiBpc0hpZGRlbigpIHtcblx0XHRcdHZhciBzZWw7XG5cblx0XHRcdGlmICghaXNHZWNrbykge1xuXHRcdFx0XHRyZXR1cm4gMDtcblx0XHRcdH1cblxuXHRcdFx0Ly8gV2VpcmQsIHdoZXJlcyB0aGF0IGN1cnNvciBzZWxlY3Rpb24/XG5cdFx0XHRzZWwgPSBlZGl0b3Iuc2VsZWN0aW9uLmdldFNlbCgpO1xuXHRcdFx0cmV0dXJuICghc2VsIHx8ICFzZWwucmFuZ2VDb3VudCB8fCBzZWwucmFuZ2VDb3VudCA9PT0gMCk7XG5cdFx0fVxuXG5cdFx0LyoqXG5cdFx0ICogUHJvcGVybHkgZW1wdGllcyB0aGUgZWRpdG9yIGlmIGFsbCBjb250ZW50cyBpcyBzZWxlY3RlZCBhbmQgZGVsZXRlZCB0aGlzIHRvXG5cdFx0ICogcHJldmVudCBlbXB0eSBwYXJhZ3JhcGhzIGZyb20gYmVpbmcgcHJvZHVjZWQgYXQgYmVnaW5uaW5nL2VuZCBvZiBjb250ZW50cy5cblx0XHQgKi9cblx0XHRmdW5jdGlvbiBlbXB0eUVkaXRvck9uRGVsZXRlRXZlcnl0aGluZygpIHtcblx0XHRcdGZ1bmN0aW9uIGlzRXZlcnl0aGluZ1NlbGVjdGVkKGVkaXRvcikge1xuXHRcdFx0XHR2YXIgY2FyZXRXYWxrZXIgPSBuZXcgQ2FyZXRXYWxrZXIoZWRpdG9yLmdldEJvZHkoKSk7XG5cdFx0XHRcdHZhciBybmcgPSBlZGl0b3Iuc2VsZWN0aW9uLmdldFJuZygpO1xuXHRcdFx0XHR2YXIgc3RhcnRDYXJldFBvcyA9IENhcmV0UG9zaXRpb24uZnJvbVJhbmdlU3RhcnQocm5nKTtcblx0XHRcdFx0dmFyIGVuZENhcmV0UG9zID0gQ2FyZXRQb3NpdGlvbi5mcm9tUmFuZ2VFbmQocm5nKTtcblxuXHRcdFx0XHRyZXR1cm4gIWVkaXRvci5zZWxlY3Rpb24uaXNDb2xsYXBzZWQoKSAmJiAhY2FyZXRXYWxrZXIucHJldihzdGFydENhcmV0UG9zKSAmJiAhY2FyZXRXYWxrZXIubmV4dChlbmRDYXJldFBvcyk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIFR5cGUgb3ZlciBjYXNlIGRlbGV0ZSBhbmQgaW5zZXJ0IHRoaXMgd29uJ3QgY292ZXIgdHlwZW92ZXIgd2l0aCBhIElNRSBidXQgYXQgbGVhc3QgaXQgY292ZXJzIHRoZSBjb21tb24gY2FzZVxuXHRcdFx0ZWRpdG9yLm9uKCdrZXlwcmVzcycsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdGlmICghaXNEZWZhdWx0UHJldmVudGVkKGUpICYmICFzZWxlY3Rpb24uaXNDb2xsYXBzZWQoKSAmJiBlLmNoYXJDb2RlID4gMzEgJiYgIVZLLm1ldGFLZXlQcmVzc2VkKGUpKSB7XG5cdFx0XHRcdFx0aWYgKGlzRXZlcnl0aGluZ1NlbGVjdGVkKGVkaXRvcikpIHtcblx0XHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHRcdGVkaXRvci5zZXRDb250ZW50KFN0cmluZy5mcm9tQ2hhckNvZGUoZS5jaGFyQ29kZSkpO1xuXHRcdFx0XHRcdFx0ZWRpdG9yLnNlbGVjdGlvbi5zZWxlY3QoZWRpdG9yLmdldEJvZHkoKSwgdHJ1ZSk7XG5cdFx0XHRcdFx0XHRlZGl0b3Iuc2VsZWN0aW9uLmNvbGxhcHNlKGZhbHNlKTtcblx0XHRcdFx0XHRcdGVkaXRvci5ub2RlQ2hhbmdlZCgpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdGVkaXRvci5vbigna2V5ZG93bicsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdHZhciBrZXlDb2RlID0gZS5rZXlDb2RlO1xuXG5cdFx0XHRcdGlmICghaXNEZWZhdWx0UHJldmVudGVkKGUpICYmIChrZXlDb2RlID09IERFTEVURSB8fCBrZXlDb2RlID09IEJBQ0tTUEFDRSkpIHtcblx0XHRcdFx0XHRpZiAoaXNFdmVyeXRoaW5nU2VsZWN0ZWQoZWRpdG9yKSkge1xuXHRcdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRcdFx0ZWRpdG9yLnNldENvbnRlbnQoJycpO1xuXHRcdFx0XHRcdFx0ZWRpdG9yLm5vZGVDaGFuZ2VkKCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHQvLyBBbGwgYnJvd3NlcnNcblx0XHRyZW1vdmVCbG9ja1F1b3RlT25CYWNrU3BhY2UoKTtcblx0XHRlbXB0eUVkaXRvcldoZW5EZWxldGluZygpO1xuXG5cdFx0Ly8gV2luZG93cyBwaG9uZSB3aWxsIHJldHVybiBhIHJhbmdlIGxpa2UgW2JvZHksIDBdIG9uIG1vdXNlZG93biBzb1xuXHRcdC8vIGl0IHdpbGwgYWx3YXlzIG5vcm1hbGl6ZSB0byB0aGUgd3JvbmcgbG9jYXRpb25cblx0XHRpZiAoIUVudi53aW5kb3dzUGhvbmUpIHtcblx0XHRcdG5vcm1hbGl6ZVNlbGVjdGlvbigpO1xuXHRcdH1cblxuXHRcdC8vIFdlYktpdFxuXHRcdGlmIChpc1dlYktpdCkge1xuXHRcdFx0ZW1wdHlFZGl0b3JPbkRlbGV0ZUV2ZXJ5dGhpbmcoKTtcblx0XHRcdGNsZWFudXBTdHlsZXNXaGVuRGVsZXRpbmcoKTtcblx0XHRcdGlucHV0TWV0aG9kRm9jdXMoKTtcblx0XHRcdHNlbGVjdENvbnRyb2xFbGVtZW50cygpO1xuXHRcdFx0c2V0RGVmYXVsdEJsb2NrVHlwZSgpO1xuXHRcdFx0YmxvY2tGb3JtU3VibWl0SW5zaWRlRWRpdG9yKCk7XG5cdFx0XHRkaXNhYmxlQmFja3NwYWNlSW50b0FUYWJsZSgpO1xuXHRcdFx0cmVtb3ZlQXBwbGVJbnRlcmNoYW5nZUJycygpO1xuXG5cdFx0XHQvL3RvdWNoQ2xpY2tFdmVudCgpO1xuXG5cdFx0XHQvLyBpT1Ncblx0XHRcdGlmIChFbnYuaU9TKSB7XG5cdFx0XHRcdHJlc3RvcmVGb2N1c09uS2V5RG93bigpO1xuXHRcdFx0XHRib2R5SGVpZ2h0KCk7XG5cdFx0XHRcdHRhcExpbmtzQW5kSW1hZ2VzKCk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRzZWxlY3RBbGwoKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHQvLyBJRVxuXHRcdGlmIChpc0lFICYmIEVudi5pZSA8IDExKSB7XG5cdFx0XHRyZW1vdmVIck9uQmFja3NwYWNlKCk7XG5cdFx0XHRlbnN1cmVCb2R5SGFzUm9sZUFwcGxpY2F0aW9uKCk7XG5cdFx0XHRhZGROZXdMaW5lc0JlZm9yZUJySW5QcmUoKTtcblx0XHRcdHJlbW92ZVByZVNlcmlhbGl6ZWRTdHlsZXNXaGVuU2VsZWN0aW5nQ29udHJvbHMoKTtcblx0XHRcdGRlbGV0ZUNvbnRyb2xJdGVtT25CYWNrU3BhY2UoKTtcblx0XHRcdHJlbmRlckVtcHR5QmxvY2tzRml4KCk7XG5cdFx0XHRrZWVwTm9TY3JpcHRDb250ZW50cygpO1xuXHRcdFx0Zml4Q2FyZXRTZWxlY3Rpb25PZkRvY3VtZW50RWxlbWVudE9uSWUoKTtcblx0XHR9XG5cblx0XHRpZiAoRW52LmllID49IDExKSB7XG5cdFx0XHRib2R5SGVpZ2h0KCk7XG5cdFx0XHRkaXNhYmxlQmFja3NwYWNlSW50b0FUYWJsZSgpO1xuXHRcdH1cblxuXHRcdGlmIChFbnYuaWUpIHtcblx0XHRcdHNlbGVjdEFsbCgpO1xuXHRcdFx0ZGlzYWJsZUF1dG9VcmxEZXRlY3QoKTtcblx0XHRcdGllSW50ZXJuYWxEcmFnQW5kRHJvcCgpO1xuXHRcdH1cblxuXHRcdC8vIEdlY2tvXG5cdFx0aWYgKGlzR2Vja28pIHtcblx0XHRcdGVtcHR5RWRpdG9yT25EZWxldGVFdmVyeXRoaW5nKCk7XG5cdFx0XHRyZW1vdmVIck9uQmFja3NwYWNlKCk7XG5cdFx0XHRmb2N1c0JvZHkoKTtcblx0XHRcdHJlbW92ZVN0eWxlc1doZW5EZWxldGluZ0Fjcm9zc0Jsb2NrRWxlbWVudHMoKTtcblx0XHRcdHNldEdlY2tvRWRpdGluZ09wdGlvbnMoKTtcblx0XHRcdGFkZEJyQWZ0ZXJMYXN0TGlua3MoKTtcblx0XHRcdHNob3dCcm9rZW5JbWFnZUljb24oKTtcblx0XHRcdGJsb2NrQ21kQXJyb3dOYXZpZ2F0aW9uKCk7XG5cdFx0XHRkaXNhYmxlQmFja3NwYWNlSW50b0FUYWJsZSgpO1xuXHRcdH1cblxuXHRcdHJldHVybiB7XG5cdFx0XHRyZWZyZXNoQ29udGVudEVkaXRhYmxlOiByZWZyZXNoQ29udGVudEVkaXRhYmxlLFxuXHRcdFx0aXNIaWRkZW46IGlzSGlkZGVuXG5cdFx0fTtcblx0fTtcbn0pO1xuXG4vLyBJbmNsdWRlZCBmcm9tOiBqcy90aW55bWNlL2NsYXNzZXMvRWRpdG9yT2JzZXJ2YWJsZS5qc1xuXG4vKipcbiAqIEVkaXRvck9ic2VydmFibGUuanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBUaGlzIG1peGluIGNvbnRhaW5zIHRoZSBldmVudCBsb2dpYyBmb3IgdGhlIHRpbnltY2UuRWRpdG9yIGNsYXNzLlxuICpcbiAqIEBtaXhpbiB0aW55bWNlLkVkaXRvck9ic2VydmFibGVcbiAqIEBleHRlbmRzIHRpbnltY2UudXRpbC5PYnNlcnZhYmxlXG4gKi9cbmRlZmluZShcInRpbnltY2UvRWRpdG9yT2JzZXJ2YWJsZVwiLCBbXG5cdFwidGlueW1jZS91dGlsL09ic2VydmFibGVcIixcblx0XCJ0aW55bWNlL2RvbS9ET01VdGlsc1wiLFxuXHRcInRpbnltY2UvdXRpbC9Ub29sc1wiXG5dLCBmdW5jdGlvbihPYnNlcnZhYmxlLCBET01VdGlscywgVG9vbHMpIHtcblx0dmFyIERPTSA9IERPTVV0aWxzLkRPTSwgY3VzdG9tRXZlbnRSb290RGVsZWdhdGVzO1xuXG5cdC8qKlxuXHQgKiBSZXR1cm5zIHRoZSBldmVudCB0YXJnZXQgc28gZm9yIHRoZSBzcGVjaWZpZWQgZXZlbnQuIFNvbWUgZXZlbnRzIGZpcmVcblx0ICogb25seSBvbiBkb2N1bWVudCwgc29tZSBmaXJlIG9uIGRvY3VtZW50RWxlbWVudCBldGMuIFRoaXMgYWxzbyBoYW5kbGVzIHRoZVxuXHQgKiBjdXN0b20gZXZlbnQgcm9vdCBzZXR0aW5nIHdoZXJlIGl0IHJldHVybnMgdGhhdCBlbGVtZW50IGluc3RlYWQgb2YgdGhlIGJvZHkuXG5cdCAqXG5cdCAqIEBwcml2YXRlXG5cdCAqIEBwYXJhbSB7dGlueW1jZS5FZGl0b3J9IGVkaXRvciBFZGl0b3IgaW5zdGFuY2UgdG8gZ2V0IGV2ZW50IHRhcmdldCBmcm9tLlxuXHQgKiBAcGFyYW0ge1N0cmluZ30gZXZlbnROYW1lIE5hbWUgb2YgdGhlIGV2ZW50IGZvciBleGFtcGxlIFwiY2xpY2tcIi5cblx0ICogQHJldHVybiB7RWxlbWVudC9Eb2N1bWVudH0gSFRNTCBFbGVtZW50IG9yIGRvY3VtZW50IHRhcmdldCB0byBiaW5kIG9uLlxuXHQgKi9cblx0ZnVuY3Rpb24gZ2V0RXZlbnRUYXJnZXQoZWRpdG9yLCBldmVudE5hbWUpIHtcblx0XHRpZiAoZXZlbnROYW1lID09ICdzZWxlY3Rpb25jaGFuZ2UnKSB7XG5cdFx0XHRyZXR1cm4gZWRpdG9yLmdldERvYygpO1xuXHRcdH1cblxuXHRcdC8vIE5lZWQgdG8gYmluZCBtb3VzZWRvd24vbW91c2V1cCBldGMgdG8gZG9jdW1lbnQgbm90IGJvZHkgaW4gaWZyYW1lIG1vZGVcblx0XHQvLyBTaW5jZSB0aGUgdXNlciBtaWdodCBjbGljayBvbiB0aGUgSFRNTCBlbGVtZW50IG5vdCB0aGUgQk9EWVxuXHRcdGlmICghZWRpdG9yLmlubGluZSAmJiAvXm1vdXNlfHRvdWNofGNsaWNrfGNvbnRleHRtZW51fGRyb3B8ZHJhZ292ZXJ8ZHJhZ2VuZC8udGVzdChldmVudE5hbWUpKSB7XG5cdFx0XHRyZXR1cm4gZWRpdG9yLmdldERvYygpLmRvY3VtZW50RWxlbWVudDtcblx0XHR9XG5cblx0XHQvLyBCaW5kIHRvIGV2ZW50IHJvb3QgaW5zdGVhZCBvZiBib2R5IGlmIGl0J3MgZGVmaW5lZFxuXHRcdGlmIChlZGl0b3Iuc2V0dGluZ3MuZXZlbnRfcm9vdCkge1xuXHRcdFx0aWYgKCFlZGl0b3IuZXZlbnRSb290KSB7XG5cdFx0XHRcdGVkaXRvci5ldmVudFJvb3QgPSBET00uc2VsZWN0KGVkaXRvci5zZXR0aW5ncy5ldmVudF9yb290KVswXTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIGVkaXRvci5ldmVudFJvb3Q7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGVkaXRvci5nZXRCb2R5KCk7XG5cdH1cblxuXHQvKipcblx0ICogQmluZHMgYSBldmVudCBkZWxlZ2F0ZSBmb3IgdGhlIHNwZWNpZmllZCBuYW1lIHRoaXMgZGVsZWdhdGUgd2lsbCBmaXJlXG5cdCAqIHRoZSBldmVudCB0byB0aGUgZWRpdG9yIGRpc3BhdGNoZXIuXG5cdCAqXG5cdCAqIEBwcml2YXRlXG5cdCAqIEBwYXJhbSB7dGlueW1jZS5FZGl0b3J9IGVkaXRvciBFZGl0b3IgaW5zdGFuY2UgdG8gZ2V0IGV2ZW50IHRhcmdldCBmcm9tLlxuXHQgKiBAcGFyYW0ge1N0cmluZ30gZXZlbnROYW1lIE5hbWUgb2YgdGhlIGV2ZW50IGZvciBleGFtcGxlIFwiY2xpY2tcIi5cblx0ICovXG5cdGZ1bmN0aW9uIGJpbmRFdmVudERlbGVnYXRlKGVkaXRvciwgZXZlbnROYW1lKSB7XG5cdFx0dmFyIGV2ZW50Um9vdEVsbSA9IGdldEV2ZW50VGFyZ2V0KGVkaXRvciwgZXZlbnROYW1lKSwgZGVsZWdhdGU7XG5cblx0XHRmdW5jdGlvbiBpc0xpc3RlbmluZyhlZGl0b3IpIHtcblx0XHRcdHJldHVybiAhZWRpdG9yLmhpZGRlbiAmJiAhZWRpdG9yLnJlYWRvbmx5O1xuXHRcdH1cblxuXHRcdGlmICghZWRpdG9yLmRlbGVnYXRlcykge1xuXHRcdFx0ZWRpdG9yLmRlbGVnYXRlcyA9IHt9O1xuXHRcdH1cblxuXHRcdGlmIChlZGl0b3IuZGVsZWdhdGVzW2V2ZW50TmFtZV0pIHtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHRpZiAoZWRpdG9yLnNldHRpbmdzLmV2ZW50X3Jvb3QpIHtcblx0XHRcdGlmICghY3VzdG9tRXZlbnRSb290RGVsZWdhdGVzKSB7XG5cdFx0XHRcdGN1c3RvbUV2ZW50Um9vdERlbGVnYXRlcyA9IHt9O1xuXHRcdFx0XHRlZGl0b3IuZWRpdG9yTWFuYWdlci5vbigncmVtb3ZlRWRpdG9yJywgZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0dmFyIG5hbWU7XG5cblx0XHRcdFx0XHRpZiAoIWVkaXRvci5lZGl0b3JNYW5hZ2VyLmFjdGl2ZUVkaXRvcikge1xuXHRcdFx0XHRcdFx0aWYgKGN1c3RvbUV2ZW50Um9vdERlbGVnYXRlcykge1xuXHRcdFx0XHRcdFx0XHRmb3IgKG5hbWUgaW4gY3VzdG9tRXZlbnRSb290RGVsZWdhdGVzKSB7XG5cdFx0XHRcdFx0XHRcdFx0ZWRpdG9yLmRvbS51bmJpbmQoZ2V0RXZlbnRUYXJnZXQoZWRpdG9yLCBuYW1lKSk7XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRjdXN0b21FdmVudFJvb3REZWxlZ2F0ZXMgPSBudWxsO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChjdXN0b21FdmVudFJvb3REZWxlZ2F0ZXNbZXZlbnROYW1lXSkge1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdGRlbGVnYXRlID0gZnVuY3Rpb24oZSkge1xuXHRcdFx0XHR2YXIgdGFyZ2V0ID0gZS50YXJnZXQsIGVkaXRvcnMgPSBlZGl0b3IuZWRpdG9yTWFuYWdlci5lZGl0b3JzLCBpID0gZWRpdG9ycy5sZW5ndGg7XG5cblx0XHRcdFx0d2hpbGUgKGktLSkge1xuXHRcdFx0XHRcdHZhciBib2R5ID0gZWRpdG9yc1tpXS5nZXRCb2R5KCk7XG5cblx0XHRcdFx0XHRpZiAoYm9keSA9PT0gdGFyZ2V0IHx8IERPTS5pc0NoaWxkT2YodGFyZ2V0LCBib2R5KSkge1xuXHRcdFx0XHRcdFx0aWYgKGlzTGlzdGVuaW5nKGVkaXRvcnNbaV0pKSB7XG5cdFx0XHRcdFx0XHRcdGVkaXRvcnNbaV0uZmlyZShldmVudE5hbWUsIGUpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fTtcblxuXHRcdFx0Y3VzdG9tRXZlbnRSb290RGVsZWdhdGVzW2V2ZW50TmFtZV0gPSBkZWxlZ2F0ZTtcblx0XHRcdERPTS5iaW5kKGV2ZW50Um9vdEVsbSwgZXZlbnROYW1lLCBkZWxlZ2F0ZSk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGRlbGVnYXRlID0gZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRpZiAoaXNMaXN0ZW5pbmcoZWRpdG9yKSkge1xuXHRcdFx0XHRcdGVkaXRvci5maXJlKGV2ZW50TmFtZSwgZSk7XG5cdFx0XHRcdH1cblx0XHRcdH07XG5cblx0XHRcdERPTS5iaW5kKGV2ZW50Um9vdEVsbSwgZXZlbnROYW1lLCBkZWxlZ2F0ZSk7XG5cdFx0XHRlZGl0b3IuZGVsZWdhdGVzW2V2ZW50TmFtZV0gPSBkZWxlZ2F0ZTtcblx0XHR9XG5cdH1cblxuXHR2YXIgRWRpdG9yT2JzZXJ2YWJsZSA9IHtcblx0XHQvKipcblx0XHQgKiBCaW5kIGFueSBwZW5kaW5nIGV2ZW50IGRlbGVnYXRlcy4gVGhpcyBnZXRzIGV4ZWN1dGVkIGFmdGVyIHRoZSB0YXJnZXQgYm9keS9kb2N1bWVudCBpcyBjcmVhdGVkLlxuXHRcdCAqXG5cdFx0ICogQHByaXZhdGVcblx0XHQgKi9cblx0XHRiaW5kUGVuZGluZ0V2ZW50RGVsZWdhdGVzOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0VG9vbHMuZWFjaChzZWxmLl9wZW5kaW5nTmF0aXZlRXZlbnRzLCBmdW5jdGlvbihuYW1lKSB7XG5cdFx0XHRcdGJpbmRFdmVudERlbGVnYXRlKHNlbGYsIG5hbWUpO1xuXHRcdFx0fSk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFRvZ2dsZXMgYSBuYXRpdmUgZXZlbnQgb24vb2ZmIHRoaXMgaXMgY2FsbGVkIGJ5IHRoZSBFdmVudERpc3BhdGNoZXIgd2hlblxuXHRcdCAqIHRoZSBmaXJzdCBuYXRpdmUgZXZlbnQgaGFuZGxlciBpcyBhZGRlZCBhbmQgd2hlbiB0aGUgbGFzdCBuYXRpdmUgZXZlbnQgaGFuZGxlciBpcyByZW1vdmVkLlxuXHRcdCAqXG5cdFx0ICogQHByaXZhdGVcblx0XHQgKi9cblx0XHR0b2dnbGVOYXRpdmVFdmVudDogZnVuY3Rpb24obmFtZSwgc3RhdGUpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0Ly8gTmV2ZXIgYmluZCBmb2N1cy9ibHVyIHNpbmNlIHRoZSBGb2N1c01hbmFnZXIgZmFrZXMgdGhvc2Vcblx0XHRcdGlmIChuYW1lID09IFwiZm9jdXNcIiB8fCBuYW1lID09IFwiYmx1clwiKSB7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHN0YXRlKSB7XG5cdFx0XHRcdGlmIChzZWxmLmluaXRpYWxpemVkKSB7XG5cdFx0XHRcdFx0YmluZEV2ZW50RGVsZWdhdGUoc2VsZiwgbmFtZSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0aWYgKCFzZWxmLl9wZW5kaW5nTmF0aXZlRXZlbnRzKSB7XG5cdFx0XHRcdFx0XHRzZWxmLl9wZW5kaW5nTmF0aXZlRXZlbnRzID0gW25hbWVdO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRzZWxmLl9wZW5kaW5nTmF0aXZlRXZlbnRzLnB1c2gobmFtZSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKHNlbGYuaW5pdGlhbGl6ZWQpIHtcblx0XHRcdFx0c2VsZi5kb20udW5iaW5kKGdldEV2ZW50VGFyZ2V0KHNlbGYsIG5hbWUpLCBuYW1lLCBzZWxmLmRlbGVnYXRlc1tuYW1lXSk7XG5cdFx0XHRcdGRlbGV0ZSBzZWxmLmRlbGVnYXRlc1tuYW1lXTtcblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogVW5iaW5kcyBhbGwgbmF0aXZlIGV2ZW50IGhhbmRsZXJzIHRoYXQgbWVhbnMgZGVsZWdhdGVzLCBjdXN0b20gZXZlbnRzIGJvdW5kIHVzaW5nIHRoZSBFdmVudHMgQVBJIGV0Yy5cblx0XHQgKlxuXHRcdCAqIEBwcml2YXRlXG5cdFx0ICovXG5cdFx0dW5iaW5kQWxsTmF0aXZlRXZlbnRzOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgbmFtZTtcblxuXHRcdFx0aWYgKHNlbGYuZGVsZWdhdGVzKSB7XG5cdFx0XHRcdGZvciAobmFtZSBpbiBzZWxmLmRlbGVnYXRlcykge1xuXHRcdFx0XHRcdHNlbGYuZG9tLnVuYmluZChnZXRFdmVudFRhcmdldChzZWxmLCBuYW1lKSwgbmFtZSwgc2VsZi5kZWxlZ2F0ZXNbbmFtZV0pO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0ZGVsZXRlIHNlbGYuZGVsZWdhdGVzO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoIXNlbGYuaW5saW5lKSB7XG5cdFx0XHRcdHNlbGYuZ2V0Qm9keSgpLm9ubG9hZCA9IG51bGw7XG5cdFx0XHRcdHNlbGYuZG9tLnVuYmluZChzZWxmLmdldFdpbigpKTtcblx0XHRcdFx0c2VsZi5kb20udW5iaW5kKHNlbGYuZ2V0RG9jKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRzZWxmLmRvbS51bmJpbmQoc2VsZi5nZXRCb2R5KCkpO1xuXHRcdFx0c2VsZi5kb20udW5iaW5kKHNlbGYuZ2V0Q29udGFpbmVyKCkpO1xuXHRcdH1cblx0fTtcblxuXHRFZGl0b3JPYnNlcnZhYmxlID0gVG9vbHMuZXh0ZW5kKHt9LCBPYnNlcnZhYmxlLCBFZGl0b3JPYnNlcnZhYmxlKTtcblxuXHRyZXR1cm4gRWRpdG9yT2JzZXJ2YWJsZTtcbn0pO1xuXG4vLyBJbmNsdWRlZCBmcm9tOiBqcy90aW55bWNlL2NsYXNzZXMvTW9kZS5qc1xuXG4vKipcbiAqIE1vZGUuanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBNb2RlIHN3aXRjaGVyIGxvZ2ljLlxuICpcbiAqIEBwcml2YXRlXG4gKiBAY2xhc3MgdGlueW1jZS5Nb2RlXG4gKi9cbmRlZmluZShcInRpbnltY2UvTW9kZVwiLCBbXSwgZnVuY3Rpb24oKSB7XG5cdGZ1bmN0aW9uIHNldEVkaXRvckNvbW1hbmRTdGF0ZShlZGl0b3IsIGNtZCwgc3RhdGUpIHtcblx0XHR0cnkge1xuXHRcdFx0ZWRpdG9yLmdldERvYygpLmV4ZWNDb21tYW5kKGNtZCwgZmFsc2UsIHN0YXRlKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0Ly8gSWdub3JlXG5cdFx0fVxuXHR9XG5cblx0ZnVuY3Rpb24gY2xpY2tCbG9ja2VyKGVkaXRvcikge1xuXHRcdHZhciB0YXJnZXQsIGhhbmRsZXI7XG5cblx0XHR0YXJnZXQgPSBlZGl0b3IuZ2V0Qm9keSgpO1xuXG5cdFx0aGFuZGxlciA9IGZ1bmN0aW9uKGUpIHtcblx0XHRcdGlmIChlZGl0b3IuZG9tLmdldFBhcmVudHMoZS50YXJnZXQsICdhJykubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHR9XG5cdFx0fTtcblxuXHRcdGVkaXRvci5kb20uYmluZCh0YXJnZXQsICdjbGljaycsIGhhbmRsZXIpO1xuXG5cdFx0cmV0dXJuIHtcblx0XHRcdHVuYmluZDogZnVuY3Rpb24oKSB7XG5cdFx0XHRcdGVkaXRvci5kb20udW5iaW5kKHRhcmdldCwgJ2NsaWNrJywgaGFuZGxlcik7XG5cdFx0XHR9XG5cdFx0fTtcblx0fVxuXG5cdGZ1bmN0aW9uIHRvZ2dsZVJlYWRPbmx5KGVkaXRvciwgc3RhdGUpIHtcblx0XHRpZiAoZWRpdG9yLl9jbGlja0Jsb2NrZXIpIHtcblx0XHRcdGVkaXRvci5fY2xpY2tCbG9ja2VyLnVuYmluZCgpO1xuXHRcdFx0ZWRpdG9yLl9jbGlja0Jsb2NrZXIgPSBudWxsO1xuXHRcdH1cblxuXHRcdGlmIChzdGF0ZSkge1xuXHRcdFx0ZWRpdG9yLl9jbGlja0Jsb2NrZXIgPSBjbGlja0Jsb2NrZXIoZWRpdG9yKTtcblx0XHRcdGVkaXRvci5zZWxlY3Rpb24uY29udHJvbFNlbGVjdGlvbi5oaWRlUmVzaXplUmVjdCgpO1xuXHRcdFx0ZWRpdG9yLnJlYWRvbmx5ID0gdHJ1ZTtcblx0XHRcdGVkaXRvci5nZXRCb2R5KCkuY29udGVudEVkaXRhYmxlID0gZmFsc2U7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGVkaXRvci5yZWFkb25seSA9IGZhbHNlO1xuXHRcdFx0ZWRpdG9yLmdldEJvZHkoKS5jb250ZW50RWRpdGFibGUgPSB0cnVlO1xuXHRcdFx0c2V0RWRpdG9yQ29tbWFuZFN0YXRlKGVkaXRvciwgXCJTdHlsZVdpdGhDU1NcIiwgZmFsc2UpO1xuXHRcdFx0c2V0RWRpdG9yQ29tbWFuZFN0YXRlKGVkaXRvciwgXCJlbmFibGVJbmxpbmVUYWJsZUVkaXRpbmdcIiwgZmFsc2UpO1xuXHRcdFx0c2V0RWRpdG9yQ29tbWFuZFN0YXRlKGVkaXRvciwgXCJlbmFibGVPYmplY3RSZXNpemluZ1wiLCBmYWxzZSk7XG5cdFx0XHRlZGl0b3IuZm9jdXMoKTtcblx0XHRcdGVkaXRvci5ub2RlQ2hhbmdlZCgpO1xuXHRcdH1cblx0fVxuXG5cdGZ1bmN0aW9uIHNldE1vZGUoZWRpdG9yLCBtb2RlKSB7XG5cdFx0dmFyIGN1cnJlbnRNb2RlID0gZWRpdG9yLnJlYWRvbmx5ID8gJ3JlYWRvbmx5JyA6ICdkZXNpZ24nO1xuXG5cdFx0aWYgKG1vZGUgPT0gY3VycmVudE1vZGUpIHtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHRpZiAoZWRpdG9yLmluaXRpYWxpemVkKSB7XG5cdFx0XHR0b2dnbGVSZWFkT25seShlZGl0b3IsIG1vZGUgPT0gJ3JlYWRvbmx5Jyk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGVkaXRvci5vbignaW5pdCcsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0b2dnbGVSZWFkT25seShlZGl0b3IsIG1vZGUgPT0gJ3JlYWRvbmx5Jyk7XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHQvLyBFdmVudCBpcyBOT1QgcHJldmVudGFibGVcblx0XHRlZGl0b3IuZmlyZSgnU3dpdGNoTW9kZScsIHttb2RlOiBtb2RlfSk7XG5cdH1cblxuXHRyZXR1cm4ge1xuXHRcdHNldE1vZGU6IHNldE1vZGVcblx0fTtcbn0pO1xuXG4vLyBJbmNsdWRlZCBmcm9tOiBqcy90aW55bWNlL2NsYXNzZXMvU2hvcnRjdXRzLmpzXG5cbi8qKlxuICogU2hvcnRjdXRzLmpzXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgTEdQTCBMaWNlbnNlLlxuICogQ29weXJpZ2h0IChjKSAxOTk5LTIwMTUgRXBob3ggQ29ycC4gQWxsIHJpZ2h0cyByZXNlcnZlZFxuICpcbiAqIExpY2Vuc2U6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vbGljZW5zZVxuICogQ29udHJpYnV0aW5nOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2NvbnRyaWJ1dGluZ1xuICovXG5cbi8qKlxuICogQ29udGFpbnMgYWxsIGxvZ2ljIGZvciBoYW5kbGluZyBvZiBrZXlib2FyZCBzaG9ydGN1dHMuXG4gKlxuICogQGNsYXNzIHRpbnltY2UuU2hvcnRjdXRzXG4gKiBAZXhhbXBsZVxuICogZWRpdG9yLnNob3J0Y3V0cy5hZGQoJ2N0cmwrYScsIGZ1bmN0aW9uKCkge30pO1xuICogZWRpdG9yLnNob3J0Y3V0cy5hZGQoJ21ldGErYScsIGZ1bmN0aW9uKCkge30pOyAvLyBcIm1ldGFcIiBtYXBzIHRvIENvbW1hbmQgb24gTWFjIGFuZCBDdHJsIG9uIFBDXG4gKiBlZGl0b3Iuc2hvcnRjdXRzLmFkZCgnY3RybCthbHQrYScsIGZ1bmN0aW9uKCkge30pO1xuICogZWRpdG9yLnNob3J0Y3V0cy5hZGQoJ2FjY2VzcythJywgZnVuY3Rpb24oKSB7fSk7IC8vIFwiYWNjZXNzXCIgbWFwcyB0byBjdHJsK2FsdCBvbiBNYWMgYW5kIHNoaWZ0K2FsdCBvbiBQQ1xuICovXG5kZWZpbmUoXCJ0aW55bWNlL1Nob3J0Y3V0c1wiLCBbXG5cdFwidGlueW1jZS91dGlsL1Rvb2xzXCIsXG5cdFwidGlueW1jZS9FbnZcIlxuXSwgZnVuY3Rpb24oVG9vbHMsIEVudikge1xuXHR2YXIgZWFjaCA9IFRvb2xzLmVhY2gsIGV4cGxvZGUgPSBUb29scy5leHBsb2RlO1xuXG5cdHZhciBrZXlDb2RlTG9va3VwID0ge1xuXHRcdFwiZjlcIjogMTIwLFxuXHRcdFwiZjEwXCI6IDEyMSxcblx0XHRcImYxMVwiOiAxMjJcblx0fTtcblxuXHR2YXIgbW9kaWZpZXJOYW1lcyA9IFRvb2xzLm1ha2VNYXAoJ2FsdCxjdHJsLHNoaWZ0LG1ldGEsYWNjZXNzJyk7XG5cblx0cmV0dXJuIGZ1bmN0aW9uKGVkaXRvcikge1xuXHRcdHZhciBzZWxmID0gdGhpcywgc2hvcnRjdXRzID0ge30sIHBlbmRpbmdQYXR0ZXJucyA9IFtdO1xuXG5cdFx0ZnVuY3Rpb24gcGFyc2VTaG9ydGN1dChwYXR0ZXJuKSB7XG5cdFx0XHR2YXIgaWQsIGtleSwgc2hvcnRjdXQgPSB7fTtcblxuXHRcdFx0Ly8gUGFyc2UgbW9kaWZpZXJzIGFuZCBrZXlzIGN0cmwrYWx0K2IgZm9yIGV4YW1wbGVcblx0XHRcdGVhY2goZXhwbG9kZShwYXR0ZXJuLCAnKycpLCBmdW5jdGlvbih2YWx1ZSkge1xuXHRcdFx0XHRpZiAodmFsdWUgaW4gbW9kaWZpZXJOYW1lcykge1xuXHRcdFx0XHRcdHNob3J0Y3V0W3ZhbHVlXSA9IHRydWU7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Ly8gQWxsb3cgbnVtZXJpYyBrZXljb2RlcyBsaWtlIGN0cmwrMjE5IGZvciBjdHJsK1tcblx0XHRcdFx0XHRpZiAoL15bMC05XXsyLH0kLy50ZXN0KHZhbHVlKSkge1xuXHRcdFx0XHRcdFx0c2hvcnRjdXQua2V5Q29kZSA9IHBhcnNlSW50KHZhbHVlLCAxMCk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdHNob3J0Y3V0LmNoYXJDb2RlID0gdmFsdWUuY2hhckNvZGVBdCgwKTtcblx0XHRcdFx0XHRcdHNob3J0Y3V0LmtleUNvZGUgPSBrZXlDb2RlTG9va3VwW3ZhbHVlXSB8fCB2YWx1ZS50b1VwcGVyQ2FzZSgpLmNoYXJDb2RlQXQoMCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0Ly8gR2VuZXJhdGUgdW5pcXVlIGlkIGZvciBtb2RpZmllciBjb21iaW5hdGlvbiBhbmQgc2V0IGRlZmF1bHQgc3RhdGUgZm9yIHVudXNlZCBtb2RpZmllcnNcblx0XHRcdGlkID0gW3Nob3J0Y3V0LmtleUNvZGVdO1xuXHRcdFx0Zm9yIChrZXkgaW4gbW9kaWZpZXJOYW1lcykge1xuXHRcdFx0XHRpZiAoc2hvcnRjdXRba2V5XSkge1xuXHRcdFx0XHRcdGlkLnB1c2goa2V5KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRzaG9ydGN1dFtrZXldID0gZmFsc2U7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdHNob3J0Y3V0LmlkID0gaWQuam9pbignLCcpO1xuXG5cdFx0XHQvLyBIYW5kbGUgc3BlY2lhbCBhY2Nlc3MgbW9kaWZpZXIgZGlmZmVyZW50bHkgZGVwZW5kaW5nIG9uIE1hYy9XaW5cblx0XHRcdGlmIChzaG9ydGN1dC5hY2Nlc3MpIHtcblx0XHRcdFx0c2hvcnRjdXQuYWx0ID0gdHJ1ZTtcblxuXHRcdFx0XHRpZiAoRW52Lm1hYykge1xuXHRcdFx0XHRcdHNob3J0Y3V0LmN0cmwgPSB0cnVlO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHNob3J0Y3V0LnNoaWZ0ID0gdHJ1ZTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHQvLyBIYW5kbGUgc3BlY2lhbCBtZXRhIG1vZGlmaWVyIGRpZmZlcmVudGx5IGRlcGVuZGluZyBvbiBNYWMvV2luXG5cdFx0XHRpZiAoc2hvcnRjdXQubWV0YSkge1xuXHRcdFx0XHRpZiAoRW52Lm1hYykge1xuXHRcdFx0XHRcdHNob3J0Y3V0Lm1ldGEgPSB0cnVlO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHNob3J0Y3V0LmN0cmwgPSB0cnVlO1xuXHRcdFx0XHRcdHNob3J0Y3V0Lm1ldGEgPSBmYWxzZTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gc2hvcnRjdXQ7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gY3JlYXRlU2hvcnRjdXQocGF0dGVybiwgZGVzYywgY21kRnVuYywgc2NvcGUpIHtcblx0XHRcdHZhciBzaG9ydGN1dHM7XG5cblx0XHRcdHNob3J0Y3V0cyA9IFRvb2xzLm1hcChleHBsb2RlKHBhdHRlcm4sICc+JyksIHBhcnNlU2hvcnRjdXQpO1xuXHRcdFx0c2hvcnRjdXRzW3Nob3J0Y3V0cy5sZW5ndGggLSAxXSA9IFRvb2xzLmV4dGVuZChzaG9ydGN1dHNbc2hvcnRjdXRzLmxlbmd0aCAtIDFdLCB7XG5cdFx0XHRcdGZ1bmM6IGNtZEZ1bmMsXG5cdFx0XHRcdHNjb3BlOiBzY29wZSB8fCBlZGl0b3Jcblx0XHRcdH0pO1xuXG5cdFx0XHRyZXR1cm4gVG9vbHMuZXh0ZW5kKHNob3J0Y3V0c1swXSwge1xuXHRcdFx0XHRkZXNjOiBlZGl0b3IudHJhbnNsYXRlKGRlc2MpLFxuXHRcdFx0XHRzdWJwYXR0ZXJuczogc2hvcnRjdXRzLnNsaWNlKDEpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRmdW5jdGlvbiBoYXNNb2RpZmllcihlKSB7XG5cdFx0XHRyZXR1cm4gZS5hbHRLZXkgfHwgZS5jdHJsS2V5IHx8IGUubWV0YUtleTtcblx0XHR9XG5cblx0XHRmdW5jdGlvbiBpc0Z1bmN0aW9uS2V5KGUpIHtcblx0XHRcdHJldHVybiBlLnR5cGUgPT09IFwia2V5ZG93blwiICYmIGUua2V5Q29kZSA+PSAxMTIgJiYgZS5rZXlDb2RlIDw9IDEyMztcblx0XHR9XG5cblx0XHRmdW5jdGlvbiBtYXRjaFNob3J0Y3V0KGUsIHNob3J0Y3V0KSB7XG5cdFx0XHRpZiAoIXNob3J0Y3V0KSB7XG5cdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHNob3J0Y3V0LmN0cmwgIT0gZS5jdHJsS2V5IHx8IHNob3J0Y3V0Lm1ldGEgIT0gZS5tZXRhS2V5KSB7XG5cdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHNob3J0Y3V0LmFsdCAhPSBlLmFsdEtleSB8fCBzaG9ydGN1dC5zaGlmdCAhPSBlLnNoaWZ0S2V5KSB7XG5cdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGUua2V5Q29kZSA9PSBzaG9ydGN1dC5rZXlDb2RlIHx8IChlLmNoYXJDb2RlICYmIGUuY2hhckNvZGUgPT0gc2hvcnRjdXQuY2hhckNvZGUpKSB7XG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cblx0XHRmdW5jdGlvbiBleGVjdXRlU2hvcnRjdXRBY3Rpb24oc2hvcnRjdXQpIHtcblx0XHRcdHJldHVybiBzaG9ydGN1dC5mdW5jID8gc2hvcnRjdXQuZnVuYy5jYWxsKHNob3J0Y3V0LnNjb3BlKSA6IG51bGw7XG5cdFx0fVxuXG5cdFx0ZWRpdG9yLm9uKCdrZXl1cCBrZXlwcmVzcyBrZXlkb3duJywgZnVuY3Rpb24oZSkge1xuXHRcdFx0aWYgKChoYXNNb2RpZmllcihlKSB8fCBpc0Z1bmN0aW9uS2V5KGUpKSAmJiAhZS5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkge1xuXHRcdFx0XHRlYWNoKHNob3J0Y3V0cywgZnVuY3Rpb24oc2hvcnRjdXQpIHtcblx0XHRcdFx0XHRpZiAobWF0Y2hTaG9ydGN1dChlLCBzaG9ydGN1dCkpIHtcblx0XHRcdFx0XHRcdHBlbmRpbmdQYXR0ZXJucyA9IHNob3J0Y3V0LnN1YnBhdHRlcm5zLnNsaWNlKDApO1xuXG5cdFx0XHRcdFx0XHRpZiAoZS50eXBlID09IFwia2V5ZG93blwiKSB7XG5cdFx0XHRcdFx0XHRcdGV4ZWN1dGVTaG9ydGN1dEFjdGlvbihzaG9ydGN1dCk7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0aWYgKG1hdGNoU2hvcnRjdXQoZSwgcGVuZGluZ1BhdHRlcm5zWzBdKSkge1xuXHRcdFx0XHRcdGlmIChwZW5kaW5nUGF0dGVybnMubGVuZ3RoID09PSAxKSB7XG5cdFx0XHRcdFx0XHRpZiAoZS50eXBlID09IFwia2V5ZG93blwiKSB7XG5cdFx0XHRcdFx0XHRcdGV4ZWN1dGVTaG9ydGN1dEFjdGlvbihwZW5kaW5nUGF0dGVybnNbMF0pO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHBlbmRpbmdQYXR0ZXJucy5zaGlmdCgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHQvKipcblx0XHQgKiBBZGRzIGEga2V5Ym9hcmQgc2hvcnRjdXQgZm9yIHNvbWUgY29tbWFuZCBvciBmdW5jdGlvbi5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgYWRkXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IHBhdHRlcm4gU2hvcnRjdXQgcGF0dGVybi4gTGlrZSBmb3IgZXhhbXBsZTogY3RybCthbHQrby5cblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gZGVzYyBUZXh0IGRlc2NyaXB0aW9uIGZvciB0aGUgY29tbWFuZC5cblx0XHQgKiBAcGFyYW0ge1N0cmluZy9GdW5jdGlvbn0gY21kRnVuYyBDb21tYW5kIG5hbWUgc3RyaW5nIG9yIGZ1bmN0aW9uIHRvIGV4ZWN1dGUgd2hlbiB0aGUga2V5IGlzIHByZXNzZWQuXG5cdFx0ICogQHBhcmFtIHtPYmplY3R9IHNjb3BlIE9wdGlvbmFsIHNjb3BlIHRvIGV4ZWN1dGUgdGhlIGZ1bmN0aW9uIGluLlxuXHRcdCAqIEByZXR1cm4ge0Jvb2xlYW59IHRydWUvZmFsc2Ugc3RhdGUgaWYgdGhlIHNob3J0Y3V0IHdhcyBhZGRlZCBvciBub3QuXG5cdFx0ICovXG5cdFx0c2VsZi5hZGQgPSBmdW5jdGlvbihwYXR0ZXJuLCBkZXNjLCBjbWRGdW5jLCBzY29wZSkge1xuXHRcdFx0dmFyIGNtZDtcblxuXHRcdFx0Y21kID0gY21kRnVuYztcblxuXHRcdFx0aWYgKHR5cGVvZiBjbWRGdW5jID09PSAnc3RyaW5nJykge1xuXHRcdFx0XHRjbWRGdW5jID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0ZWRpdG9yLmV4ZWNDb21tYW5kKGNtZCwgZmFsc2UsIG51bGwpO1xuXHRcdFx0XHR9O1xuXHRcdFx0fSBlbHNlIGlmIChUb29scy5pc0FycmF5KGNtZCkpIHtcblx0XHRcdFx0Y21kRnVuYyA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdGVkaXRvci5leGVjQ29tbWFuZChjbWRbMF0sIGNtZFsxXSwgY21kWzJdKTtcblx0XHRcdFx0fTtcblx0XHRcdH1cblxuXHRcdFx0ZWFjaChleHBsb2RlKFRvb2xzLnRyaW0ocGF0dGVybi50b0xvd2VyQ2FzZSgpKSksIGZ1bmN0aW9uKHBhdHRlcm4pIHtcblx0XHRcdFx0dmFyIHNob3J0Y3V0ID0gY3JlYXRlU2hvcnRjdXQocGF0dGVybiwgZGVzYywgY21kRnVuYywgc2NvcGUpO1xuXHRcdFx0XHRzaG9ydGN1dHNbc2hvcnRjdXQuaWRdID0gc2hvcnRjdXQ7XG5cdFx0XHR9KTtcblxuXHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIFJlbW92ZSBhIGtleWJvYXJkIHNob3J0Y3V0IGJ5IHBhdHRlcm4uXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHJlbW92ZVxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBwYXR0ZXJuIFNob3J0Y3V0IHBhdHRlcm4uIExpa2UgZm9yIGV4YW1wbGU6IGN0cmwrYWx0K28uXG5cdFx0ICogQHJldHVybiB7Qm9vbGVhbn0gdHJ1ZS9mYWxzZSBzdGF0ZSBpZiB0aGUgc2hvcnRjdXQgd2FzIHJlbW92ZWQgb3Igbm90LlxuXHRcdCAqL1xuXHRcdHNlbGYucmVtb3ZlID0gZnVuY3Rpb24ocGF0dGVybikge1xuXHRcdFx0dmFyIHNob3J0Y3V0ID0gY3JlYXRlU2hvcnRjdXQocGF0dGVybik7XG5cblx0XHRcdGlmIChzaG9ydGN1dHNbc2hvcnRjdXQuaWRdKSB7XG5cdFx0XHRcdGRlbGV0ZSBzaG9ydGN1dHNbc2hvcnRjdXQuaWRdO1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH07XG5cdH07XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL2ZpbGUvVXBsb2FkZXIuanNcblxuLyoqXG4gKiBVcGxvYWRlci5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE1IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKipcbiAqIFVwbG9hZCBibG9icyBvciBibG9iIGluZm9zIHRvIHRoZSBzcGVjaWZpZWQgVVJMIG9yIGhhbmRsZXIuXG4gKlxuICogQHByaXZhdGVcbiAqIEBjbGFzcyB0aW55bWNlLmZpbGUuVXBsb2FkZXJcbiAqIEBleGFtcGxlXG4gKiB2YXIgdXBsb2FkZXIgPSBuZXcgVXBsb2FkZXIoe1xuICogICAgIHVybDogJy91cGxvYWQucGhwJyxcbiAqICAgICBiYXNlUGF0aDogJy9iYXNlL3BhdGgnLFxuICogICAgIGNyZWRlbnRpYWxzOiB0cnVlLFxuICogICAgIGhhbmRsZXI6IGZ1bmN0aW9uKGRhdGEsIHN1Y2Nlc3MsIGZhaWx1cmUpIHtcbiAqICAgICAgICAgLi4uXG4gKiAgICAgfVxuICogfSk7XG4gKlxuICogdXBsb2FkZXIudXBsb2FkKGJsb2JJbmZvcykudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcbiAqICAgICAuLi5cbiAqIH0pO1xuICovXG5kZWZpbmUoXCJ0aW55bWNlL2ZpbGUvVXBsb2FkZXJcIiwgW1xuXHRcInRpbnltY2UvdXRpbC9Qcm9taXNlXCIsXG5cdFwidGlueW1jZS91dGlsL1Rvb2xzXCIsXG5cdFwidGlueW1jZS91dGlsL0Z1blwiXG5dLCBmdW5jdGlvbihQcm9taXNlLCBUb29scywgRnVuKSB7XG5cdHJldHVybiBmdW5jdGlvbih1cGxvYWRTdGF0dXMsIHNldHRpbmdzKSB7XG5cdFx0dmFyIHBlbmRpbmdQcm9taXNlcyA9IHt9O1xuXG5cdFx0ZnVuY3Rpb24gZmlsZW5hbWUoYmxvYkluZm8pIHtcblx0XHRcdHZhciBleHQsIGV4dGVuc2lvbnM7XG5cblx0XHRcdGV4dGVuc2lvbnMgPSB7XG5cdFx0XHRcdCdpbWFnZS9qcGVnJzogJ2pwZycsXG5cdFx0XHRcdCdpbWFnZS9qcGcnOiAnanBnJyxcblx0XHRcdFx0J2ltYWdlL2dpZic6ICdnaWYnLFxuXHRcdFx0XHQnaW1hZ2UvcG5nJzogJ3BuZydcblx0XHRcdH07XG5cblx0XHRcdGV4dCA9IGV4dGVuc2lvbnNbYmxvYkluZm8uYmxvYigpLnR5cGUudG9Mb3dlckNhc2UoKV0gfHwgJ2RhdCc7XG5cblx0XHRcdHJldHVybiBibG9iSW5mby5maWxlbmFtZSgpICsgJy4nICsgZXh0O1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIHBhdGhKb2luKHBhdGgxLCBwYXRoMikge1xuXHRcdFx0aWYgKHBhdGgxKSB7XG5cdFx0XHRcdHJldHVybiBwYXRoMS5yZXBsYWNlKC9cXC8kLywgJycpICsgJy8nICsgcGF0aDIucmVwbGFjZSgvXlxcLy8sICcnKTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHBhdGgyO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIGJsb2JJbmZvVG9EYXRhKGJsb2JJbmZvKSB7XG5cdFx0XHRyZXR1cm4ge1xuXHRcdFx0XHRpZDogYmxvYkluZm8uaWQsXG5cdFx0XHRcdGJsb2I6IGJsb2JJbmZvLmJsb2IsXG5cdFx0XHRcdGJhc2U2NDogYmxvYkluZm8uYmFzZTY0LFxuXHRcdFx0XHRmaWxlbmFtZTogRnVuLmNvbnN0YW50KGZpbGVuYW1lKGJsb2JJbmZvKSlcblx0XHRcdH07XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gZGVmYXVsdEhhbmRsZXIoYmxvYkluZm8sIHN1Y2Nlc3MsIGZhaWx1cmUsIHByb2dyZXNzKSB7XG5cdFx0XHR2YXIgeGhyLCBmb3JtRGF0YTtcblxuXHRcdFx0eGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG5cdFx0XHR4aHIub3BlbignUE9TVCcsIHNldHRpbmdzLnVybCk7XG5cdFx0XHR4aHIud2l0aENyZWRlbnRpYWxzID0gc2V0dGluZ3MuY3JlZGVudGlhbHM7XG5cblx0XHRcdHhoci51cGxvYWQub25wcm9ncmVzcyA9IGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0cHJvZ3Jlc3MoZS5sb2FkZWQgLyBlLnRvdGFsICogMTAwKTtcblx0XHRcdH07XG5cblx0XHRcdHhoci5vbmVycm9yID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRcdGZhaWx1cmUoXCJJbWFnZSB1cGxvYWQgZmFpbGVkIGR1ZSB0byBhIFhIUiBUcmFuc3BvcnQgZXJyb3IuIENvZGU6IFwiICsgeGhyLnN0YXR1cyk7XG5cdFx0XHR9O1xuXG5cdFx0XHR4aHIub25sb2FkID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHZhciBqc29uO1xuXG5cdFx0XHRcdGlmICh4aHIuc3RhdHVzICE9IDIwMCkge1xuXHRcdFx0XHRcdGZhaWx1cmUoXCJIVFRQIEVycm9yOiBcIiArIHhoci5zdGF0dXMpO1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGpzb24gPSBKU09OLnBhcnNlKHhoci5yZXNwb25zZVRleHQpO1xuXG5cdFx0XHRcdGlmICghanNvbiB8fCB0eXBlb2YganNvbi5sb2NhdGlvbiAhPSBcInN0cmluZ1wiKSB7XG5cdFx0XHRcdFx0ZmFpbHVyZShcIkludmFsaWQgSlNPTjogXCIgKyB4aHIucmVzcG9uc2VUZXh0KTtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRzdWNjZXNzKHBhdGhKb2luKHNldHRpbmdzLmJhc2VQYXRoLCBqc29uLmxvY2F0aW9uKSk7XG5cdFx0XHR9O1xuXG5cdFx0XHRmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xuXHRcdFx0Zm9ybURhdGEuYXBwZW5kKCdmaWxlJywgYmxvYkluZm8uYmxvYigpLCBibG9iSW5mby5maWxlbmFtZSgpKTtcblxuXHRcdFx0eGhyLnNlbmQoZm9ybURhdGEpO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIG5vVXBsb2FkKCkge1xuXHRcdFx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUpIHtcblx0XHRcdFx0cmVzb2x2ZShbXSk7XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRmdW5jdGlvbiBoYW5kbGVyU3VjY2VzcyhibG9iSW5mbywgdXJsKSB7XG5cdFx0XHRyZXR1cm4ge1xuXHRcdFx0XHR1cmw6IHVybCxcblx0XHRcdFx0YmxvYkluZm86IGJsb2JJbmZvLFxuXHRcdFx0XHRzdGF0dXM6IHRydWVcblx0XHRcdH07XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gaGFuZGxlckZhaWx1cmUoYmxvYkluZm8sIGVycm9yKSB7XG5cdFx0XHRyZXR1cm4ge1xuXHRcdFx0XHR1cmw6ICcnLFxuXHRcdFx0XHRibG9iSW5mbzogYmxvYkluZm8sXG5cdFx0XHRcdHN0YXR1czogZmFsc2UsXG5cdFx0XHRcdGVycm9yOiBlcnJvclxuXHRcdFx0fTtcblx0XHR9XG5cblx0XHRmdW5jdGlvbiByZXNvbHZlUGVuZGluZyhibG9iVXJpLCByZXN1bHQpIHtcblx0XHRcdFRvb2xzLmVhY2gocGVuZGluZ1Byb21pc2VzW2Jsb2JVcmldLCBmdW5jdGlvbihyZXNvbHZlKSB7XG5cdFx0XHRcdHJlc29sdmUocmVzdWx0KTtcblx0XHRcdH0pO1xuXG5cdFx0XHRkZWxldGUgcGVuZGluZ1Byb21pc2VzW2Jsb2JVcmldO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIHVwbG9hZEJsb2JJbmZvKGJsb2JJbmZvLCBoYW5kbGVyLCBvcGVuTm90aWZpY2F0aW9uKSB7XG5cdFx0XHR1cGxvYWRTdGF0dXMubWFya1BlbmRpbmcoYmxvYkluZm8uYmxvYlVyaSgpKTtcblxuXHRcdFx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUpIHtcblx0XHRcdFx0dmFyIG5vdGlmaWNhdGlvbiwgcHJvZ3Jlc3M7XG5cblx0XHRcdFx0dmFyIG5vb3AgPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0fTtcblxuXHRcdFx0XHR0cnkge1xuXHRcdFx0XHRcdHZhciBjbG9zZU5vdGlmaWNhdGlvbiA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdFx0aWYgKG5vdGlmaWNhdGlvbikge1xuXHRcdFx0XHRcdFx0XHRub3RpZmljYXRpb24uY2xvc2UoKTtcblx0XHRcdFx0XHRcdFx0cHJvZ3Jlc3MgPSBub29wOyAvLyBPbmNlIGl0J3MgY2xvc2VkIGl0J3MgY2xvc2VkXG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fTtcblxuXHRcdFx0XHRcdHZhciBzdWNjZXNzID0gZnVuY3Rpb24odXJsKSB7XG5cdFx0XHRcdFx0XHRjbG9zZU5vdGlmaWNhdGlvbigpO1xuXHRcdFx0XHRcdFx0dXBsb2FkU3RhdHVzLm1hcmtVcGxvYWRlZChibG9iSW5mby5ibG9iVXJpKCksIHVybCk7XG5cdFx0XHRcdFx0XHRyZXNvbHZlUGVuZGluZyhibG9iSW5mby5ibG9iVXJpKCksIGhhbmRsZXJTdWNjZXNzKGJsb2JJbmZvLCB1cmwpKTtcblx0XHRcdFx0XHRcdHJlc29sdmUoaGFuZGxlclN1Y2Nlc3MoYmxvYkluZm8sIHVybCkpO1xuXHRcdFx0XHRcdH07XG5cblx0XHRcdFx0XHR2YXIgZmFpbHVyZSA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdFx0Y2xvc2VOb3RpZmljYXRpb24oKTtcblx0XHRcdFx0XHRcdHVwbG9hZFN0YXR1cy5yZW1vdmVGYWlsZWQoYmxvYkluZm8uYmxvYlVyaSgpKTtcblx0XHRcdFx0XHRcdHJlc29sdmVQZW5kaW5nKGJsb2JJbmZvLmJsb2JVcmkoKSwgaGFuZGxlckZhaWx1cmUoYmxvYkluZm8sIGZhaWx1cmUpKTtcblx0XHRcdFx0XHRcdHJlc29sdmUoaGFuZGxlckZhaWx1cmUoYmxvYkluZm8sIGZhaWx1cmUpKTtcblx0XHRcdFx0XHR9O1xuXG5cdFx0XHRcdFx0cHJvZ3Jlc3MgPSBmdW5jdGlvbihwZXJjZW50KSB7XG5cdFx0XHRcdFx0XHRpZiAocGVyY2VudCA8IDAgfHwgcGVyY2VudCA+IDEwMCkge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGlmICghbm90aWZpY2F0aW9uKSB7XG5cdFx0XHRcdFx0XHRcdG5vdGlmaWNhdGlvbiA9IG9wZW5Ob3RpZmljYXRpb24oKTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0bm90aWZpY2F0aW9uLnByb2dyZXNzQmFyLnZhbHVlKHBlcmNlbnQpO1xuXHRcdFx0XHRcdH07XG5cblx0XHRcdFx0XHRoYW5kbGVyKGJsb2JJbmZvVG9EYXRhKGJsb2JJbmZvKSwgc3VjY2VzcywgZmFpbHVyZSwgcHJvZ3Jlc3MpO1xuXHRcdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRcdHJlc29sdmUoaGFuZGxlckZhaWx1cmUoYmxvYkluZm8sIGV4Lm1lc3NhZ2UpKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gaXNEZWZhdWx0SGFuZGxlcihoYW5kbGVyKSB7XG5cdFx0XHRyZXR1cm4gaGFuZGxlciA9PT0gZGVmYXVsdEhhbmRsZXI7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gcGVuZGluZ1VwbG9hZEJsb2JJbmZvKGJsb2JJbmZvKSB7XG5cdFx0XHR2YXIgYmxvYlVyaSA9IGJsb2JJbmZvLmJsb2JVcmkoKTtcblxuXHRcdFx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUpIHtcblx0XHRcdFx0cGVuZGluZ1Byb21pc2VzW2Jsb2JVcmldID0gcGVuZGluZ1Byb21pc2VzW2Jsb2JVcmldIHx8IFtdO1xuXHRcdFx0XHRwZW5kaW5nUHJvbWlzZXNbYmxvYlVyaV0ucHVzaChyZXNvbHZlKTtcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIHVwbG9hZEJsb2JzKGJsb2JJbmZvcywgb3Blbk5vdGlmaWNhdGlvbikge1xuXHRcdFx0YmxvYkluZm9zID0gVG9vbHMuZ3JlcChibG9iSW5mb3MsIGZ1bmN0aW9uKGJsb2JJbmZvKSB7XG5cdFx0XHRcdHJldHVybiAhdXBsb2FkU3RhdHVzLmlzVXBsb2FkZWQoYmxvYkluZm8uYmxvYlVyaSgpKTtcblx0XHRcdH0pO1xuXG5cdFx0XHRyZXR1cm4gUHJvbWlzZS5hbGwoVG9vbHMubWFwKGJsb2JJbmZvcywgZnVuY3Rpb24oYmxvYkluZm8pIHtcblx0XHRcdFx0cmV0dXJuIHVwbG9hZFN0YXR1cy5pc1BlbmRpbmcoYmxvYkluZm8uYmxvYlVyaSgpKSA/XG5cdFx0XHRcdFx0cGVuZGluZ1VwbG9hZEJsb2JJbmZvKGJsb2JJbmZvKSA6IHVwbG9hZEJsb2JJbmZvKGJsb2JJbmZvLCBzZXR0aW5ncy5oYW5kbGVyLCBvcGVuTm90aWZpY2F0aW9uKTtcblx0XHRcdH0pKTtcblx0XHR9XG5cblx0XHRmdW5jdGlvbiB1cGxvYWQoYmxvYkluZm9zLCBvcGVuTm90aWZpY2F0aW9uKSB7XG5cdFx0XHRyZXR1cm4gKCFzZXR0aW5ncy51cmwgJiYgaXNEZWZhdWx0SGFuZGxlcihzZXR0aW5ncy5oYW5kbGVyKSkgPyBub1VwbG9hZCgpIDogdXBsb2FkQmxvYnMoYmxvYkluZm9zLCBvcGVuTm90aWZpY2F0aW9uKTtcblx0XHR9XG5cblx0XHRzZXR0aW5ncyA9IFRvb2xzLmV4dGVuZCh7XG5cdFx0XHRjcmVkZW50aWFsczogZmFsc2UsXG5cdFx0XHQvLyBXZSBhcmUgYWRkaW5nIGEgbm90aWZ5IGFyZ3VtZW50IHRvIHRoaXMgKGF0IHRoZSBtb21lbnQsIHVudGlsIGl0IGRvZXNuJ3Qgd29yaylcblx0XHRcdGhhbmRsZXI6IGRlZmF1bHRIYW5kbGVyXG5cdFx0fSwgc2V0dGluZ3MpO1xuXG5cdFx0cmV0dXJuIHtcblx0XHRcdHVwbG9hZDogdXBsb2FkXG5cdFx0fTtcblx0fTtcbn0pO1xuXG4vLyBJbmNsdWRlZCBmcm9tOiBqcy90aW55bWNlL2NsYXNzZXMvZmlsZS9Db252ZXJzaW9ucy5qc1xuXG4vKipcbiAqIENvbnZlcnNpb25zLmpzXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgTEdQTCBMaWNlbnNlLlxuICogQ29weXJpZ2h0IChjKSAxOTk5LTIwMTUgRXBob3ggQ29ycC4gQWxsIHJpZ2h0cyByZXNlcnZlZFxuICpcbiAqIExpY2Vuc2U6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vbGljZW5zZVxuICogQ29udHJpYnV0aW5nOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2NvbnRyaWJ1dGluZ1xuICovXG5cbi8qKlxuICogQ29udmVydHMgYmxvYi91cmlzIGJhY2sgYW5kIGZvcnRoLlxuICpcbiAqIEBwcml2YXRlXG4gKiBAY2xhc3MgdGlueW1jZS5maWxlLkNvbnZlcnNpb25zXG4gKi9cbmRlZmluZShcInRpbnltY2UvZmlsZS9Db252ZXJzaW9uc1wiLCBbXG5cdFwidGlueW1jZS91dGlsL1Byb21pc2VcIlxuXSwgZnVuY3Rpb24oUHJvbWlzZSkge1xuXHRmdW5jdGlvbiBibG9iVXJpVG9CbG9iKHVybCkge1xuXHRcdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlKSB7XG5cdFx0XHR2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG5cblx0XHRcdHhoci5vcGVuKCdHRVQnLCB1cmwsIHRydWUpO1xuXHRcdFx0eGhyLnJlc3BvbnNlVHlwZSA9ICdibG9iJztcblxuXHRcdFx0eGhyLm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRpZiAodGhpcy5zdGF0dXMgPT0gMjAwKSB7XG5cdFx0XHRcdFx0cmVzb2x2ZSh0aGlzLnJlc3BvbnNlKTtcblx0XHRcdFx0fVxuXHRcdFx0fTtcblxuXHRcdFx0eGhyLnNlbmQoKTtcblx0XHR9KTtcblx0fVxuXG5cdGZ1bmN0aW9uIHBhcnNlRGF0YVVyaSh1cmkpIHtcblx0XHR2YXIgdHlwZSwgbWF0Y2hlcztcblxuXHRcdHVyaSA9IGRlY29kZVVSSUNvbXBvbmVudCh1cmkpLnNwbGl0KCcsJyk7XG5cblx0XHRtYXRjaGVzID0gL2RhdGE6KFteO10rKS8uZXhlYyh1cmlbMF0pO1xuXHRcdGlmIChtYXRjaGVzKSB7XG5cdFx0XHR0eXBlID0gbWF0Y2hlc1sxXTtcblx0XHR9XG5cblx0XHRyZXR1cm4ge1xuXHRcdFx0dHlwZTogdHlwZSxcblx0XHRcdGRhdGE6IHVyaVsxXVxuXHRcdH07XG5cdH1cblxuXHRmdW5jdGlvbiBkYXRhVXJpVG9CbG9iKHVyaSkge1xuXHRcdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlKSB7XG5cdFx0XHR2YXIgc3RyLCBhcnIsIGk7XG5cblx0XHRcdHVyaSA9IHBhcnNlRGF0YVVyaSh1cmkpO1xuXG5cdFx0XHQvLyBNaWdodCB0aHJvdyBlcnJvciBpZiBkYXRhIGlzbid0IHByb3BlciBiYXNlNjRcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHN0ciA9IGF0b2IodXJpLmRhdGEpO1xuXHRcdFx0fSBjYXRjaCAoZSkge1xuXHRcdFx0XHRyZXNvbHZlKG5ldyBCbG9iKFtdKSk7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0YXJyID0gbmV3IFVpbnQ4QXJyYXkoc3RyLmxlbmd0aCk7XG5cblx0XHRcdGZvciAoaSA9IDA7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0YXJyW2ldID0gc3RyLmNoYXJDb2RlQXQoaSk7XG5cdFx0XHR9XG5cblx0XHRcdHJlc29sdmUobmV3IEJsb2IoW2Fycl0sIHt0eXBlOiB1cmkudHlwZX0pKTtcblx0XHR9KTtcblx0fVxuXG5cdGZ1bmN0aW9uIHVyaVRvQmxvYih1cmwpIHtcblx0XHRpZiAodXJsLmluZGV4T2YoJ2Jsb2I6JykgPT09IDApIHtcblx0XHRcdHJldHVybiBibG9iVXJpVG9CbG9iKHVybCk7XG5cdFx0fVxuXG5cdFx0aWYgKHVybC5pbmRleE9mKCdkYXRhOicpID09PSAwKSB7XG5cdFx0XHRyZXR1cm4gZGF0YVVyaVRvQmxvYih1cmwpO1xuXHRcdH1cblxuXHRcdHJldHVybiBudWxsO1xuXHR9XG5cblx0ZnVuY3Rpb24gYmxvYlRvRGF0YVVyaShibG9iKSB7XG5cdFx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUpIHtcblx0XHRcdHZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xuXG5cdFx0XHRyZWFkZXIub25sb2FkZW5kID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHJlc29sdmUocmVhZGVyLnJlc3VsdCk7XG5cdFx0XHR9O1xuXG5cdFx0XHRyZWFkZXIucmVhZEFzRGF0YVVSTChibG9iKTtcblx0XHR9KTtcblx0fVxuXG5cdHJldHVybiB7XG5cdFx0dXJpVG9CbG9iOiB1cmlUb0Jsb2IsXG5cdFx0YmxvYlRvRGF0YVVyaTogYmxvYlRvRGF0YVVyaSxcblx0XHRwYXJzZURhdGFVcmk6IHBhcnNlRGF0YVVyaVxuXHR9O1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy9maWxlL0ltYWdlU2Nhbm5lci5qc1xuXG4vKipcbiAqIEltYWdlU2Nhbm5lci5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE1IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKipcbiAqIEZpbmRzIGltYWdlcyB3aXRoIGRhdGEgdXJpcyBvciBibG9iIHVyaXMuIElmIGRhdGEgdXJpcyBhcmUgZm91bmQgaXQgd2lsbCBjb252ZXJ0IHRoZW0gaW50byBibG9iIHVyaXMuXG4gKlxuICogQHByaXZhdGVcbiAqIEBjbGFzcyB0aW55bWNlLmZpbGUuSW1hZ2VTY2FubmVyXG4gKi9cbmRlZmluZShcInRpbnltY2UvZmlsZS9JbWFnZVNjYW5uZXJcIiwgW1xuXHRcInRpbnltY2UvdXRpbC9Qcm9taXNlXCIsXG5cdFwidGlueW1jZS91dGlsL0FyclwiLFxuXHRcInRpbnltY2UvdXRpbC9GdW5cIixcblx0XCJ0aW55bWNlL2ZpbGUvQ29udmVyc2lvbnNcIixcblx0XCJ0aW55bWNlL0VudlwiXG5dLCBmdW5jdGlvbihQcm9taXNlLCBBcnIsIEZ1biwgQ29udmVyc2lvbnMsIEVudikge1xuXHR2YXIgY291bnQgPSAwO1xuXG5cdHJldHVybiBmdW5jdGlvbih1cGxvYWRTdGF0dXMsIGJsb2JDYWNoZSkge1xuXHRcdHZhciBjYWNoZWRQcm9taXNlcyA9IHt9O1xuXG5cdFx0ZnVuY3Rpb24gZmluZEFsbChlbG0sIHByZWRpY2F0ZSkge1xuXHRcdFx0dmFyIGltYWdlcywgcHJvbWlzZXM7XG5cblx0XHRcdGZ1bmN0aW9uIGltYWdlVG9CbG9iSW5mbyhpbWcsIHJlc29sdmUpIHtcblx0XHRcdFx0dmFyIGJhc2U2NCwgYmxvYkluZm87XG5cblx0XHRcdFx0aWYgKGltZy5zcmMuaW5kZXhPZignYmxvYjonKSA9PT0gMCkge1xuXHRcdFx0XHRcdGJsb2JJbmZvID0gYmxvYkNhY2hlLmdldEJ5VXJpKGltZy5zcmMpO1xuXG5cdFx0XHRcdFx0aWYgKGJsb2JJbmZvKSB7XG5cdFx0XHRcdFx0XHRyZXNvbHZlKHtcblx0XHRcdFx0XHRcdFx0aW1hZ2U6IGltZyxcblx0XHRcdFx0XHRcdFx0YmxvYkluZm86IGJsb2JJbmZvXG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRiYXNlNjQgPSBDb252ZXJzaW9ucy5wYXJzZURhdGFVcmkoaW1nLnNyYykuZGF0YTtcblx0XHRcdFx0YmxvYkluZm8gPSBibG9iQ2FjaGUuZmluZEZpcnN0KGZ1bmN0aW9uKGNhY2hlZEJsb2JJbmZvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIGNhY2hlZEJsb2JJbmZvLmJhc2U2NCgpID09PSBiYXNlNjQ7XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdGlmIChibG9iSW5mbykge1xuXHRcdFx0XHRcdHJlc29sdmUoe1xuXHRcdFx0XHRcdFx0aW1hZ2U6IGltZyxcblx0XHRcdFx0XHRcdGJsb2JJbmZvOiBibG9iSW5mb1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdENvbnZlcnNpb25zLnVyaVRvQmxvYihpbWcuc3JjKS50aGVuKGZ1bmN0aW9uKGJsb2IpIHtcblx0XHRcdFx0XHRcdHZhciBibG9iSW5mb0lkID0gJ2Jsb2JpZCcgKyAoY291bnQrKyksXG5cdFx0XHRcdFx0XHRcdGJsb2JJbmZvID0gYmxvYkNhY2hlLmNyZWF0ZShibG9iSW5mb0lkLCBibG9iLCBiYXNlNjQpO1xuXG5cdFx0XHRcdFx0XHRibG9iQ2FjaGUuYWRkKGJsb2JJbmZvKTtcblxuXHRcdFx0XHRcdFx0cmVzb2x2ZSh7XG5cdFx0XHRcdFx0XHRcdGltYWdlOiBpbWcsXG5cdFx0XHRcdFx0XHRcdGJsb2JJbmZvOiBibG9iSW5mb1xuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKCFwcmVkaWNhdGUpIHtcblx0XHRcdFx0cHJlZGljYXRlID0gRnVuLmNvbnN0YW50KHRydWUpO1xuXHRcdFx0fVxuXG5cdFx0XHRpbWFnZXMgPSBBcnIuZmlsdGVyKGVsbS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaW1nJyksIGZ1bmN0aW9uKGltZykge1xuXHRcdFx0XHR2YXIgc3JjID0gaW1nLnNyYztcblxuXHRcdFx0XHRpZiAoIUVudi5maWxlQXBpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKGltZy5oYXNBdHRyaWJ1dGUoJ2RhdGEtbWNlLWJvZ3VzJykpIHtcblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoaW1nLmhhc0F0dHJpYnV0ZSgnZGF0YS1tY2UtcGxhY2Vob2xkZXInKSkge1xuXHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICghc3JjIHx8IHNyYyA9PSBFbnYudHJhbnNwYXJlbnRTcmMpIHtcblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoc3JjLmluZGV4T2YoJ2Jsb2I6JykgPT09IDApIHtcblx0XHRcdFx0XHRyZXR1cm4gIXVwbG9hZFN0YXR1cy5pc1VwbG9hZGVkKHNyYyk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoc3JjLmluZGV4T2YoJ2RhdGE6JykgPT09IDApIHtcblx0XHRcdFx0XHRyZXR1cm4gcHJlZGljYXRlKGltZyk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHR9KTtcblxuXHRcdFx0cHJvbWlzZXMgPSBBcnIubWFwKGltYWdlcywgZnVuY3Rpb24oaW1nKSB7XG5cdFx0XHRcdHZhciBuZXdQcm9taXNlO1xuXG5cdFx0XHRcdGlmIChjYWNoZWRQcm9taXNlc1tpbWcuc3JjXSkge1xuXHRcdFx0XHRcdC8vIFNpbmNlIHRoZSBjYWNoZWQgcHJvbWlzZSB3aWxsIHJldHVybiB0aGUgY2FjaGVkIGltYWdlXG5cdFx0XHRcdFx0Ly8gV2UgbmVlZCB0byB3cmFwIGl0IGFuZCByZXNvbHZlIHdpdGggdGhlIGFjdHVhbCBpbWFnZVxuXHRcdFx0XHRcdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlKSB7XG5cdFx0XHRcdFx0XHRjYWNoZWRQcm9taXNlc1tpbWcuc3JjXS50aGVuKGZ1bmN0aW9uKGltYWdlSW5mbykge1xuXHRcdFx0XHRcdFx0XHRyZXNvbHZlKHtcblx0XHRcdFx0XHRcdFx0XHRpbWFnZTogaW1nLFxuXHRcdFx0XHRcdFx0XHRcdGJsb2JJbmZvOiBpbWFnZUluZm8uYmxvYkluZm9cblx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdG5ld1Byb21pc2UgPSBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlKSB7XG5cdFx0XHRcdFx0aW1hZ2VUb0Jsb2JJbmZvKGltZywgcmVzb2x2ZSk7XG5cdFx0XHRcdH0pLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XG5cdFx0XHRcdFx0ZGVsZXRlIGNhY2hlZFByb21pc2VzW3Jlc3VsdC5pbWFnZS5zcmNdO1xuXHRcdFx0XHRcdHJldHVybiByZXN1bHQ7XG5cdFx0XHRcdH0pWydjYXRjaCddKGZ1bmN0aW9uKGVycm9yKSB7XG5cdFx0XHRcdFx0ZGVsZXRlIGNhY2hlZFByb21pc2VzW2ltZy5zcmNdO1xuXHRcdFx0XHRcdHJldHVybiBlcnJvcjtcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0Y2FjaGVkUHJvbWlzZXNbaW1nLnNyY10gPSBuZXdQcm9taXNlO1xuXG5cdFx0XHRcdHJldHVybiBuZXdQcm9taXNlO1xuXHRcdFx0fSk7XG5cblx0XHRcdHJldHVybiBQcm9taXNlLmFsbChwcm9taXNlcyk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHtcblx0XHRcdGZpbmRBbGw6IGZpbmRBbGxcblx0XHR9O1xuXHR9O1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy9maWxlL0Jsb2JDYWNoZS5qc1xuXG4vKipcbiAqIEJsb2JDYWNoZS5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE1IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKipcbiAqIEhvbGQgYmxvYiBpbmZvIG9iamVjdHMgd2hlcmUgYSBibG9iIGhhcyBleHRyYSBpbnRlcm5hbCBpbmZvcm1hdGlvbi5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQGNsYXNzIHRpbnltY2UuZmlsZS5CbG9iQ2FjaGVcbiAqL1xuZGVmaW5lKFwidGlueW1jZS9maWxlL0Jsb2JDYWNoZVwiLCBbXG5cdFwidGlueW1jZS91dGlsL0FyclwiLFxuXHRcInRpbnltY2UvdXRpbC9GdW5cIlxuXSwgZnVuY3Rpb24oQXJyLCBGdW4pIHtcblx0cmV0dXJuIGZ1bmN0aW9uKCkge1xuXHRcdHZhciBjYWNoZSA9IFtdLCBjb25zdGFudCA9IEZ1bi5jb25zdGFudDtcblxuXHRcdGZ1bmN0aW9uIGNyZWF0ZShpZCwgYmxvYiwgYmFzZTY0LCBmaWxlbmFtZSkge1xuXHRcdFx0cmV0dXJuIHtcblx0XHRcdFx0aWQ6IGNvbnN0YW50KGlkKSxcblx0XHRcdFx0ZmlsZW5hbWU6IGNvbnN0YW50KGZpbGVuYW1lIHx8IGlkKSxcblx0XHRcdFx0YmxvYjogY29uc3RhbnQoYmxvYiksXG5cdFx0XHRcdGJhc2U2NDogY29uc3RhbnQoYmFzZTY0KSxcblx0XHRcdFx0YmxvYlVyaTogY29uc3RhbnQoVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKSlcblx0XHRcdH07XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gYWRkKGJsb2JJbmZvKSB7XG5cdFx0XHRpZiAoIWdldChibG9iSW5mby5pZCgpKSkge1xuXHRcdFx0XHRjYWNoZS5wdXNoKGJsb2JJbmZvKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRmdW5jdGlvbiBnZXQoaWQpIHtcblx0XHRcdHJldHVybiBmaW5kRmlyc3QoZnVuY3Rpb24oY2FjaGVkQmxvYkluZm8pIHtcblx0XHRcdFx0cmV0dXJuIGNhY2hlZEJsb2JJbmZvLmlkKCkgPT09IGlkO1xuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gZmluZEZpcnN0KHByZWRpY2F0ZSkge1xuXHRcdFx0cmV0dXJuIEFyci5maWx0ZXIoY2FjaGUsIHByZWRpY2F0ZSlbMF07XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gZ2V0QnlVcmkoYmxvYlVyaSkge1xuXHRcdFx0cmV0dXJuIGZpbmRGaXJzdChmdW5jdGlvbihibG9iSW5mbykge1xuXHRcdFx0XHRyZXR1cm4gYmxvYkluZm8uYmxvYlVyaSgpID09IGJsb2JVcmk7XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRmdW5jdGlvbiByZW1vdmVCeVVyaShibG9iVXJpKSB7XG5cdFx0XHRjYWNoZSA9IEFyci5maWx0ZXIoY2FjaGUsIGZ1bmN0aW9uKGJsb2JJbmZvKSB7XG5cdFx0XHRcdGlmIChibG9iSW5mby5ibG9iVXJpKCkgPT09IGJsb2JVcmkpIHtcblx0XHRcdFx0XHRVUkwucmV2b2tlT2JqZWN0VVJMKGJsb2JJbmZvLmJsb2JVcmkoKSk7XG5cdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRmdW5jdGlvbiBkZXN0cm95KCkge1xuXHRcdFx0QXJyLmVhY2goY2FjaGUsIGZ1bmN0aW9uKGNhY2hlZEJsb2JJbmZvKSB7XG5cdFx0XHRcdFVSTC5yZXZva2VPYmplY3RVUkwoY2FjaGVkQmxvYkluZm8uYmxvYlVyaSgpKTtcblx0XHRcdH0pO1xuXG5cdFx0XHRjYWNoZSA9IFtdO1xuXHRcdH1cblxuXHRcdHJldHVybiB7XG5cdFx0XHRjcmVhdGU6IGNyZWF0ZSxcblx0XHRcdGFkZDogYWRkLFxuXHRcdFx0Z2V0OiBnZXQsXG5cdFx0XHRnZXRCeVVyaTogZ2V0QnlVcmksXG5cdFx0XHRmaW5kRmlyc3Q6IGZpbmRGaXJzdCxcblx0XHRcdHJlbW92ZUJ5VXJpOiByZW1vdmVCeVVyaSxcblx0XHRcdGRlc3Ryb3k6IGRlc3Ryb3lcblx0XHR9O1xuXHR9O1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy9maWxlL1VwbG9hZFN0YXR1cy5qc1xuXG4vKipcbiAqIFVwbG9hZFN0YXR1cy5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE2IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKipcbiAqIEhvbGRzIHRoZSBjdXJyZW50IHN0YXR1cyBvZiBhIGJsb2IgdXJpLCBpZiBpdCdzIHBlbmRpbmcgb3IgdXBsb2FkZWQgYW5kIHdoYXQgdGhlIHJlc3VsdCB1cmxzIHdhcy5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQGNsYXNzIHRpbnltY2UuZmlsZS5VcGxvYWRTdGF0dXNcbiAqL1xuZGVmaW5lKFwidGlueW1jZS9maWxlL1VwbG9hZFN0YXR1c1wiLCBbXG5dLCBmdW5jdGlvbigpIHtcblx0cmV0dXJuIGZ1bmN0aW9uKCkge1xuXHRcdHZhciBQRU5ESU5HID0gMSwgVVBMT0FERUQgPSAyO1xuXHRcdHZhciBibG9iVXJpU3RhdHVzZXMgPSB7fTtcblxuXHRcdGZ1bmN0aW9uIGNyZWF0ZVN0YXR1cyhzdGF0dXMsIHJlc3VsdFVyaSkge1xuXHRcdFx0cmV0dXJuIHtcblx0XHRcdFx0c3RhdHVzOiBzdGF0dXMsXG5cdFx0XHRcdHJlc3VsdFVyaTogcmVzdWx0VXJpXG5cdFx0XHR9O1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIGhhc0Jsb2JVcmkoYmxvYlVyaSkge1xuXHRcdFx0cmV0dXJuIGJsb2JVcmkgaW4gYmxvYlVyaVN0YXR1c2VzO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIGdldFJlc3VsdFVyaShibG9iVXJpKSB7XG5cdFx0XHR2YXIgcmVzdWx0ID0gYmxvYlVyaVN0YXR1c2VzW2Jsb2JVcmldO1xuXG5cdFx0XHRyZXR1cm4gcmVzdWx0ID8gcmVzdWx0LnJlc3VsdFVyaSA6IG51bGw7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gaXNQZW5kaW5nKGJsb2JVcmkpIHtcblx0XHRcdHJldHVybiBoYXNCbG9iVXJpKGJsb2JVcmkpID8gYmxvYlVyaVN0YXR1c2VzW2Jsb2JVcmldLnN0YXR1cyA9PT0gUEVORElORyA6IGZhbHNlO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIGlzVXBsb2FkZWQoYmxvYlVyaSkge1xuXHRcdFx0cmV0dXJuIGhhc0Jsb2JVcmkoYmxvYlVyaSkgPyBibG9iVXJpU3RhdHVzZXNbYmxvYlVyaV0uc3RhdHVzID09PSBVUExPQURFRCA6IGZhbHNlO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIG1hcmtQZW5kaW5nKGJsb2JVcmkpIHtcblx0XHRcdGJsb2JVcmlTdGF0dXNlc1tibG9iVXJpXSA9IGNyZWF0ZVN0YXR1cyhQRU5ESU5HLCBudWxsKTtcblx0XHR9XG5cblx0XHRmdW5jdGlvbiBtYXJrVXBsb2FkZWQoYmxvYlVyaSwgcmVzdWx0VXJpKSB7XG5cdFx0XHRibG9iVXJpU3RhdHVzZXNbYmxvYlVyaV0gPSBjcmVhdGVTdGF0dXMoVVBMT0FERUQsIHJlc3VsdFVyaSk7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gcmVtb3ZlRmFpbGVkKGJsb2JVcmkpIHtcblx0XHRcdGRlbGV0ZSBibG9iVXJpU3RhdHVzZXNbYmxvYlVyaV07XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gZGVzdHJveSgpIHtcblx0XHRcdGJsb2JVcmlTdGF0dXNlcyA9IHt9O1xuXHRcdH1cblxuXHRcdHJldHVybiB7XG5cdFx0XHRoYXNCbG9iVXJpOiBoYXNCbG9iVXJpLFxuXHRcdFx0Z2V0UmVzdWx0VXJpOiBnZXRSZXN1bHRVcmksXG5cdFx0XHRpc1BlbmRpbmc6IGlzUGVuZGluZyxcblx0XHRcdGlzVXBsb2FkZWQ6IGlzVXBsb2FkZWQsXG5cdFx0XHRtYXJrUGVuZGluZzogbWFya1BlbmRpbmcsXG5cdFx0XHRtYXJrVXBsb2FkZWQ6IG1hcmtVcGxvYWRlZCxcblx0XHRcdHJlbW92ZUZhaWxlZDogcmVtb3ZlRmFpbGVkLFxuXHRcdFx0ZGVzdHJveTogZGVzdHJveVxuXHRcdH07XG5cdH07XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL0VkaXRvclVwbG9hZC5qc1xuXG4vKipcbiAqIEVkaXRvclVwbG9hZC5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE1IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKipcbiAqIEhhbmRsZXMgaW1hZ2UgdXBsb2FkcywgdXBkYXRlcyB1bmRvIHN0YWNrIGFuZCBwYXRjaGVzIG92ZXIgdmFyaW91cyBpbnRlcm5hbCBmdW5jdGlvbnMuXG4gKlxuICogQHByaXZhdGVcbiAqIEBjbGFzcyB0aW55bWNlLkVkaXRvclVwbG9hZFxuICovXG5kZWZpbmUoXCJ0aW55bWNlL0VkaXRvclVwbG9hZFwiLCBbXG5cdFwidGlueW1jZS91dGlsL0FyclwiLFxuXHRcInRpbnltY2UvZmlsZS9VcGxvYWRlclwiLFxuXHRcInRpbnltY2UvZmlsZS9JbWFnZVNjYW5uZXJcIixcblx0XCJ0aW55bWNlL2ZpbGUvQmxvYkNhY2hlXCIsXG5cdFwidGlueW1jZS9maWxlL1VwbG9hZFN0YXR1c1wiXG5dLCBmdW5jdGlvbihBcnIsIFVwbG9hZGVyLCBJbWFnZVNjYW5uZXIsIEJsb2JDYWNoZSwgVXBsb2FkU3RhdHVzKSB7XG5cdHJldHVybiBmdW5jdGlvbihlZGl0b3IpIHtcblx0XHR2YXIgYmxvYkNhY2hlID0gbmV3IEJsb2JDYWNoZSgpLCB1cGxvYWRlciwgaW1hZ2VTY2FubmVyLCBzZXR0aW5ncyA9IGVkaXRvci5zZXR0aW5ncztcblx0XHR2YXIgdXBsb2FkU3RhdHVzID0gbmV3IFVwbG9hZFN0YXR1cygpO1xuXG5cdFx0ZnVuY3Rpb24gYWxpdmVHdWFyZChjYWxsYmFjaykge1xuXHRcdFx0cmV0dXJuIGZ1bmN0aW9uKHJlc3VsdCkge1xuXHRcdFx0XHRpZiAoZWRpdG9yLnNlbGVjdGlvbikge1xuXHRcdFx0XHRcdHJldHVybiBjYWxsYmFjayhyZXN1bHQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIFtdO1xuXHRcdFx0fTtcblx0XHR9XG5cblx0XHRmdW5jdGlvbiBjYWNoZUludmFsaWRhdG9yKCkge1xuXHRcdFx0cmV0dXJuICc/JyArIChuZXcgRGF0ZSgpKS5nZXRUaW1lKCk7XG5cdFx0fVxuXG5cdFx0Ly8gUmVwbGFjZXMgc3RyaW5ncyB3aXRob3V0IHJlZ2V4cHMgdG8gYXZvaWQgRkYgcmVnZXhwIHRvIGJpZyBpc3N1ZVxuXHRcdGZ1bmN0aW9uIHJlcGxhY2VTdHJpbmcoY29udGVudCwgc2VhcmNoLCByZXBsYWNlKSB7XG5cdFx0XHR2YXIgaW5kZXggPSAwO1xuXG5cdFx0XHRkbyB7XG5cdFx0XHRcdGluZGV4ID0gY29udGVudC5pbmRleE9mKHNlYXJjaCwgaW5kZXgpO1xuXG5cdFx0XHRcdGlmIChpbmRleCAhPT0gLTEpIHtcblx0XHRcdFx0XHRjb250ZW50ID0gY29udGVudC5zdWJzdHJpbmcoMCwgaW5kZXgpICsgcmVwbGFjZSArIGNvbnRlbnQuc3Vic3RyKGluZGV4ICsgc2VhcmNoLmxlbmd0aCk7XG5cdFx0XHRcdFx0aW5kZXggKz0gcmVwbGFjZS5sZW5ndGggLSBzZWFyY2gubGVuZ3RoICsgMTtcblx0XHRcdFx0fVxuXHRcdFx0fSB3aGlsZSAoaW5kZXggIT09IC0xKTtcblxuXHRcdFx0cmV0dXJuIGNvbnRlbnQ7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gcmVwbGFjZUltYWdlVXJsKGNvbnRlbnQsIHRhcmdldFVybCwgcmVwbGFjZW1lbnRVcmwpIHtcblx0XHRcdGNvbnRlbnQgPSByZXBsYWNlU3RyaW5nKGNvbnRlbnQsICdzcmM9XCInICsgdGFyZ2V0VXJsICsgJ1wiJywgJ3NyYz1cIicgKyByZXBsYWNlbWVudFVybCArICdcIicpO1xuXHRcdFx0Y29udGVudCA9IHJlcGxhY2VTdHJpbmcoY29udGVudCwgJ2RhdGEtbWNlLXNyYz1cIicgKyB0YXJnZXRVcmwgKyAnXCInLCAnZGF0YS1tY2Utc3JjPVwiJyArIHJlcGxhY2VtZW50VXJsICsgJ1wiJyk7XG5cblx0XHRcdHJldHVybiBjb250ZW50O1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIHJlcGxhY2VVcmxJblVuZG9TdGFjayh0YXJnZXRVcmwsIHJlcGxhY2VtZW50VXJsKSB7XG5cdFx0XHRBcnIuZWFjaChlZGl0b3IudW5kb01hbmFnZXIuZGF0YSwgZnVuY3Rpb24obGV2ZWwpIHtcblx0XHRcdFx0aWYgKGxldmVsLnR5cGUgPT09ICdmcmFnbWVudGVkJykge1xuXHRcdFx0XHRcdGxldmVsLmZyYWdtZW50cyA9IEFyci5tYXAobGV2ZWwuZnJhZ21lbnRzLCBmdW5jdGlvbiAoZnJhZ21lbnQpIHtcblx0XHRcdFx0XHRcdHJldHVybiByZXBsYWNlSW1hZ2VVcmwoZnJhZ21lbnQsIHRhcmdldFVybCwgcmVwbGFjZW1lbnRVcmwpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGxldmVsLmNvbnRlbnQgPSByZXBsYWNlSW1hZ2VVcmwobGV2ZWwuY29udGVudCwgdGFyZ2V0VXJsLCByZXBsYWNlbWVudFVybCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIG9wZW5Ob3RpZmljYXRpb24oKSB7XG5cdFx0XHRyZXR1cm4gZWRpdG9yLm5vdGlmaWNhdGlvbk1hbmFnZXIub3Blbih7XG5cdFx0XHRcdHRleHQ6IGVkaXRvci50cmFuc2xhdGUoJ0ltYWdlIHVwbG9hZGluZy4uLicpLFxuXHRcdFx0XHR0eXBlOiAnaW5mbycsXG5cdFx0XHRcdHRpbWVvdXQ6IC0xLFxuXHRcdFx0XHRwcm9ncmVzc0JhcjogdHJ1ZVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gcmVwbGFjZUltYWdlVXJpKGltYWdlLCByZXN1bHRVcmkpIHtcblx0XHRcdGJsb2JDYWNoZS5yZW1vdmVCeVVyaShpbWFnZS5zcmMpO1xuXHRcdFx0cmVwbGFjZVVybEluVW5kb1N0YWNrKGltYWdlLnNyYywgcmVzdWx0VXJpKTtcblxuXHRcdFx0ZWRpdG9yLiQoaW1hZ2UpLmF0dHIoe1xuXHRcdFx0XHRzcmM6IHNldHRpbmdzLmltYWdlc19yZXVzZV9maWxlbmFtZSA/IHJlc3VsdFVyaSArIGNhY2hlSW52YWxpZGF0b3IoKSA6IHJlc3VsdFVyaSxcblx0XHRcdFx0J2RhdGEtbWNlLXNyYyc6IGVkaXRvci5jb252ZXJ0VVJMKHJlc3VsdFVyaSwgJ3NyYycpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRmdW5jdGlvbiB1cGxvYWRJbWFnZXMoY2FsbGJhY2spIHtcblx0XHRcdGlmICghdXBsb2FkZXIpIHtcblx0XHRcdFx0dXBsb2FkZXIgPSBuZXcgVXBsb2FkZXIodXBsb2FkU3RhdHVzLCB7XG5cdFx0XHRcdFx0dXJsOiBzZXR0aW5ncy5pbWFnZXNfdXBsb2FkX3VybCxcblx0XHRcdFx0XHRiYXNlUGF0aDogc2V0dGluZ3MuaW1hZ2VzX3VwbG9hZF9iYXNlX3BhdGgsXG5cdFx0XHRcdFx0Y3JlZGVudGlhbHM6IHNldHRpbmdzLmltYWdlc191cGxvYWRfY3JlZGVudGlhbHMsXG5cdFx0XHRcdFx0aGFuZGxlcjogc2V0dGluZ3MuaW1hZ2VzX3VwbG9hZF9oYW5kbGVyXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gc2NhbkZvckltYWdlcygpLnRoZW4oYWxpdmVHdWFyZChmdW5jdGlvbihpbWFnZUluZm9zKSB7XG5cdFx0XHRcdHZhciBibG9iSW5mb3M7XG5cblx0XHRcdFx0YmxvYkluZm9zID0gQXJyLm1hcChpbWFnZUluZm9zLCBmdW5jdGlvbihpbWFnZUluZm8pIHtcblx0XHRcdFx0XHRyZXR1cm4gaW1hZ2VJbmZvLmJsb2JJbmZvO1xuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHRyZXR1cm4gdXBsb2FkZXIudXBsb2FkKGJsb2JJbmZvcywgb3Blbk5vdGlmaWNhdGlvbikudGhlbihhbGl2ZUd1YXJkKGZ1bmN0aW9uKHJlc3VsdCkge1xuXHRcdFx0XHRcdHJlc3VsdCA9IEFyci5tYXAocmVzdWx0LCBmdW5jdGlvbih1cGxvYWRJbmZvLCBpbmRleCkge1xuXHRcdFx0XHRcdFx0dmFyIGltYWdlID0gaW1hZ2VJbmZvc1tpbmRleF0uaW1hZ2U7XG5cblx0XHRcdFx0XHRcdGlmICh1cGxvYWRJbmZvLnN0YXR1cyAmJiBlZGl0b3Iuc2V0dGluZ3MuaW1hZ2VzX3JlcGxhY2VfYmxvYl91cmlzICE9PSBmYWxzZSkge1xuXHRcdFx0XHRcdFx0XHRyZXBsYWNlSW1hZ2VVcmkoaW1hZ2UsIHVwbG9hZEluZm8udXJsKTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHtcblx0XHRcdFx0XHRcdFx0ZWxlbWVudDogaW1hZ2UsXG5cdFx0XHRcdFx0XHRcdHN0YXR1czogdXBsb2FkSW5mby5zdGF0dXNcblx0XHRcdFx0XHRcdH07XG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRpZiAoY2FsbGJhY2spIHtcblx0XHRcdFx0XHRcdGNhbGxiYWNrKHJlc3VsdCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJlc3VsdDtcblx0XHRcdFx0fSkpO1xuXHRcdFx0fSkpO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIHVwbG9hZEltYWdlc0F1dG8oY2FsbGJhY2spIHtcblx0XHRcdGlmIChzZXR0aW5ncy5hdXRvbWF0aWNfdXBsb2FkcyAhPT0gZmFsc2UpIHtcblx0XHRcdFx0cmV0dXJuIHVwbG9hZEltYWdlcyhjYWxsYmFjayk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gaXNWYWxpZERhdGFVcmlJbWFnZShpbWdFbG0pIHtcblx0XHRcdHJldHVybiBzZXR0aW5ncy5pbWFnZXNfZGF0YWltZ19maWx0ZXIgPyBzZXR0aW5ncy5pbWFnZXNfZGF0YWltZ19maWx0ZXIoaW1nRWxtKSA6IHRydWU7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gc2NhbkZvckltYWdlcygpIHtcblx0XHRcdGlmICghaW1hZ2VTY2FubmVyKSB7XG5cdFx0XHRcdGltYWdlU2Nhbm5lciA9IG5ldyBJbWFnZVNjYW5uZXIodXBsb2FkU3RhdHVzLCBibG9iQ2FjaGUpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gaW1hZ2VTY2FubmVyLmZpbmRBbGwoZWRpdG9yLmdldEJvZHkoKSwgaXNWYWxpZERhdGFVcmlJbWFnZSkudGhlbihhbGl2ZUd1YXJkKGZ1bmN0aW9uKHJlc3VsdCkge1xuXHRcdFx0XHRBcnIuZWFjaChyZXN1bHQsIGZ1bmN0aW9uKHJlc3VsdEl0ZW0pIHtcblx0XHRcdFx0XHRyZXBsYWNlVXJsSW5VbmRvU3RhY2socmVzdWx0SXRlbS5pbWFnZS5zcmMsIHJlc3VsdEl0ZW0uYmxvYkluZm8uYmxvYlVyaSgpKTtcblx0XHRcdFx0XHRyZXN1bHRJdGVtLmltYWdlLnNyYyA9IHJlc3VsdEl0ZW0uYmxvYkluZm8uYmxvYlVyaSgpO1xuXHRcdFx0XHRcdHJlc3VsdEl0ZW0uaW1hZ2UucmVtb3ZlQXR0cmlidXRlKCdkYXRhLW1jZS1zcmMnKTtcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0cmV0dXJuIHJlc3VsdDtcblx0XHRcdH0pKTtcblx0XHR9XG5cblx0XHRmdW5jdGlvbiBkZXN0cm95KCkge1xuXHRcdFx0YmxvYkNhY2hlLmRlc3Ryb3koKTtcblx0XHRcdHVwbG9hZFN0YXR1cy5kZXN0cm95KCk7XG5cdFx0XHRpbWFnZVNjYW5uZXIgPSB1cGxvYWRlciA9IG51bGw7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gcmVwbGFjZUJsb2JVcmlzKGNvbnRlbnQpIHtcblx0XHRcdHJldHVybiBjb250ZW50LnJlcGxhY2UoL3NyYz1cIihibG9iOlteXCJdKylcIi9nLCBmdW5jdGlvbihtYXRjaCwgYmxvYlVyaSkge1xuXHRcdFx0XHR2YXIgcmVzdWx0VXJpID0gdXBsb2FkU3RhdHVzLmdldFJlc3VsdFVyaShibG9iVXJpKTtcblxuXHRcdFx0XHRpZiAocmVzdWx0VXJpKSB7XG5cdFx0XHRcdFx0cmV0dXJuICdzcmM9XCInICsgcmVzdWx0VXJpICsgJ1wiJztcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHZhciBibG9iSW5mbyA9IGJsb2JDYWNoZS5nZXRCeVVyaShibG9iVXJpKTtcblxuXHRcdFx0XHRpZiAoIWJsb2JJbmZvKSB7XG5cdFx0XHRcdFx0YmxvYkluZm8gPSBBcnIucmVkdWNlKGVkaXRvci5lZGl0b3JNYW5hZ2VyLmVkaXRvcnMsIGZ1bmN0aW9uKHJlc3VsdCwgZWRpdG9yKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmVzdWx0IHx8IGVkaXRvci5lZGl0b3JVcGxvYWQuYmxvYkNhY2hlLmdldEJ5VXJpKGJsb2JVcmkpO1xuXHRcdFx0XHRcdH0sIG51bGwpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKGJsb2JJbmZvKSB7XG5cdFx0XHRcdFx0cmV0dXJuICdzcmM9XCJkYXRhOicgKyBibG9iSW5mby5ibG9iKCkudHlwZSArICc7YmFzZTY0LCcgKyBibG9iSW5mby5iYXNlNjQoKSArICdcIic7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbWF0Y2g7XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRlZGl0b3Iub24oJ3NldENvbnRlbnQnLCBmdW5jdGlvbigpIHtcblx0XHRcdGlmIChlZGl0b3Iuc2V0dGluZ3MuYXV0b21hdGljX3VwbG9hZHMgIT09IGZhbHNlKSB7XG5cdFx0XHRcdHVwbG9hZEltYWdlc0F1dG8oKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHNjYW5Gb3JJbWFnZXMoKTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGVkaXRvci5vbignUmF3U2F2ZUNvbnRlbnQnLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRlLmNvbnRlbnQgPSByZXBsYWNlQmxvYlVyaXMoZS5jb250ZW50KTtcblx0XHR9KTtcblxuXHRcdGVkaXRvci5vbignZ2V0Q29udGVudCcsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdGlmIChlLnNvdXJjZV92aWV3IHx8IGUuZm9ybWF0ID09ICdyYXcnKSB7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0ZS5jb250ZW50ID0gcmVwbGFjZUJsb2JVcmlzKGUuY29udGVudCk7XG5cdFx0fSk7XG5cblx0XHRlZGl0b3Iub24oJ1Bvc3RSZW5kZXInLCBmdW5jdGlvbigpIHtcblx0XHRcdGVkaXRvci5wYXJzZXIuYWRkTm9kZUZpbHRlcignaW1nJywgZnVuY3Rpb24oaW1hZ2VzKSB7XG5cdFx0XHRcdEFyci5lYWNoKGltYWdlcywgZnVuY3Rpb24oaW1nKSB7XG5cdFx0XHRcdFx0dmFyIHNyYyA9IGltZy5hdHRyKCdzcmMnKTtcblxuXHRcdFx0XHRcdGlmIChibG9iQ2FjaGUuZ2V0QnlVcmkoc3JjKSkge1xuXHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHZhciByZXN1bHRVcmkgPSB1cGxvYWRTdGF0dXMuZ2V0UmVzdWx0VXJpKHNyYyk7XG5cdFx0XHRcdFx0aWYgKHJlc3VsdFVyaSkge1xuXHRcdFx0XHRcdFx0aW1nLmF0dHIoJ3NyYycsIHJlc3VsdFVyaSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblx0XHRcdH0pO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHtcblx0XHRcdGJsb2JDYWNoZTogYmxvYkNhY2hlLFxuXHRcdFx0dXBsb2FkSW1hZ2VzOiB1cGxvYWRJbWFnZXMsXG5cdFx0XHR1cGxvYWRJbWFnZXNBdXRvOiB1cGxvYWRJbWFnZXNBdXRvLFxuXHRcdFx0c2NhbkZvckltYWdlczogc2NhbkZvckltYWdlcyxcblx0XHRcdGRlc3Ryb3k6IGRlc3Ryb3lcblx0XHR9O1xuXHR9O1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy9jYXJldC9GYWtlQ2FyZXQuanNcblxuLyoqXG4gKiBGYWtlQ2FyZXQuanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBUaGlzIG1vZHVsZSBjb250YWlucyBsb2dpYyBmb3IgcmVuZGVyaW5nIGEgZmFrZSB2aXN1YWwgY2FyZXQuXG4gKlxuICogQHByaXZhdGVcbiAqIEBjbGFzcyB0aW55bWNlLmNhcmV0LkZha2VDYXJldFxuICovXG5kZWZpbmUoXCJ0aW55bWNlL2NhcmV0L0Zha2VDYXJldFwiLCBbXG5cdFwidGlueW1jZS9jYXJldC9DYXJldENvbnRhaW5lclwiLFxuXHRcInRpbnltY2UvY2FyZXQvQ2FyZXRQb3NpdGlvblwiLFxuXHRcInRpbnltY2UvZG9tL05vZGVUeXBlXCIsXG5cdFwidGlueW1jZS9kb20vUmFuZ2VVdGlsc1wiLFxuXHRcInRpbnltY2UvZG9tL0RvbVF1ZXJ5XCIsXG5cdFwidGlueW1jZS9nZW9tL0NsaWVudFJlY3RcIixcblx0XCJ0aW55bWNlL3V0aWwvRGVsYXlcIlxuXSwgZnVuY3Rpb24oQ2FyZXRDb250YWluZXIsIENhcmV0UG9zaXRpb24sIE5vZGVUeXBlLCBSYW5nZVV0aWxzLCAkLCBDbGllbnRSZWN0LCBEZWxheSkge1xuXHR2YXIgaXNDb250ZW50RWRpdGFibGVGYWxzZSA9IE5vZGVUeXBlLmlzQ29udGVudEVkaXRhYmxlRmFsc2U7XG5cblx0cmV0dXJuIGZ1bmN0aW9uKHJvb3ROb2RlLCBpc0Jsb2NrKSB7XG5cdFx0dmFyIGN1cnNvckludGVydmFsLCAkbGFzdFZpc3VhbENhcmV0LCBjYXJldENvbnRhaW5lck5vZGU7XG5cblx0XHRmdW5jdGlvbiBnZXRBYnNvbHV0ZUNsaWVudFJlY3Qobm9kZSwgYmVmb3JlKSB7XG5cdFx0XHR2YXIgY2xpZW50UmVjdCA9IENsaWVudFJlY3QuY29sbGFwc2Uobm9kZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSwgYmVmb3JlKSxcblx0XHRcdFx0ZG9jRWxtLCBzY3JvbGxYLCBzY3JvbGxZLCBtYXJnaW4sIHJvb3RSZWN0O1xuXG5cdFx0XHRpZiAocm9vdE5vZGUudGFnTmFtZSA9PSAnQk9EWScpIHtcblx0XHRcdFx0ZG9jRWxtID0gcm9vdE5vZGUub3duZXJEb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7XG5cdFx0XHRcdHNjcm9sbFggPSByb290Tm9kZS5zY3JvbGxMZWZ0IHx8IGRvY0VsbS5zY3JvbGxMZWZ0O1xuXHRcdFx0XHRzY3JvbGxZID0gcm9vdE5vZGUuc2Nyb2xsVG9wIHx8IGRvY0VsbS5zY3JvbGxUb3A7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRyb290UmVjdCA9IHJvb3ROb2RlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuXHRcdFx0XHRzY3JvbGxYID0gcm9vdE5vZGUuc2Nyb2xsTGVmdCAtIHJvb3RSZWN0LmxlZnQ7XG5cdFx0XHRcdHNjcm9sbFkgPSByb290Tm9kZS5zY3JvbGxUb3AgLSByb290UmVjdC50b3A7XG5cdFx0XHR9XG5cblx0XHRcdGNsaWVudFJlY3QubGVmdCArPSBzY3JvbGxYO1xuXHRcdFx0Y2xpZW50UmVjdC5yaWdodCArPSBzY3JvbGxYO1xuXHRcdFx0Y2xpZW50UmVjdC50b3AgKz0gc2Nyb2xsWTtcblx0XHRcdGNsaWVudFJlY3QuYm90dG9tICs9IHNjcm9sbFk7XG5cdFx0XHRjbGllbnRSZWN0LndpZHRoID0gMTtcblxuXHRcdFx0bWFyZ2luID0gbm9kZS5vZmZzZXRXaWR0aCAtIG5vZGUuY2xpZW50V2lkdGg7XG5cblx0XHRcdGlmIChtYXJnaW4gPiAwKSB7XG5cdFx0XHRcdGlmIChiZWZvcmUpIHtcblx0XHRcdFx0XHRtYXJnaW4gKj0gLTE7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRjbGllbnRSZWN0LmxlZnQgKz0gbWFyZ2luO1xuXHRcdFx0XHRjbGllbnRSZWN0LnJpZ2h0ICs9IG1hcmdpbjtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIGNsaWVudFJlY3Q7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gdHJpbUlubGluZUNhcmV0Q29udGFpbmVycygpIHtcblx0XHRcdHZhciBjb250ZW50RWRpdGFibGVGYWxzZU5vZGVzLCBub2RlLCBzaWJsaW5nLCBpLCBkYXRhO1xuXG5cdFx0XHRjb250ZW50RWRpdGFibGVGYWxzZU5vZGVzID0gJCgnKltjb250ZW50RWRpdGFibGU9ZmFsc2VdJywgcm9vdE5vZGUpO1xuXHRcdFx0Zm9yIChpID0gMDsgaSA8IGNvbnRlbnRFZGl0YWJsZUZhbHNlTm9kZXMubGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0bm9kZSA9IGNvbnRlbnRFZGl0YWJsZUZhbHNlTm9kZXNbaV07XG5cblx0XHRcdFx0c2libGluZyA9IG5vZGUucHJldmlvdXNTaWJsaW5nO1xuXHRcdFx0XHRpZiAoQ2FyZXRDb250YWluZXIuZW5kc1dpdGhDYXJldENvbnRhaW5lcihzaWJsaW5nKSkge1xuXHRcdFx0XHRcdGRhdGEgPSBzaWJsaW5nLmRhdGE7XG5cblx0XHRcdFx0XHRpZiAoZGF0YS5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdFx0c2libGluZy5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHNpYmxpbmcpO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRzaWJsaW5nLmRlbGV0ZURhdGEoZGF0YS5sZW5ndGggLSAxLCAxKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRzaWJsaW5nID0gbm9kZS5uZXh0U2libGluZztcblx0XHRcdFx0aWYgKENhcmV0Q29udGFpbmVyLnN0YXJ0c1dpdGhDYXJldENvbnRhaW5lcihzaWJsaW5nKSkge1xuXHRcdFx0XHRcdGRhdGEgPSBzaWJsaW5nLmRhdGE7XG5cblx0XHRcdFx0XHRpZiAoZGF0YS5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdFx0c2libGluZy5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHNpYmxpbmcpO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRzaWJsaW5nLmRlbGV0ZURhdGEoMCwgMSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIHNob3coYmVmb3JlLCBub2RlKSB7XG5cdFx0XHR2YXIgY2xpZW50UmVjdCwgcm5nO1xuXG5cdFx0XHRoaWRlKCk7XG5cblx0XHRcdGlmIChpc0Jsb2NrKG5vZGUpKSB7XG5cdFx0XHRcdGNhcmV0Q29udGFpbmVyTm9kZSA9IENhcmV0Q29udGFpbmVyLmluc2VydEJsb2NrKCdwJywgbm9kZSwgYmVmb3JlKTtcblx0XHRcdFx0Y2xpZW50UmVjdCA9IGdldEFic29sdXRlQ2xpZW50UmVjdChub2RlLCBiZWZvcmUpO1xuXHRcdFx0XHQkKGNhcmV0Q29udGFpbmVyTm9kZSkuY3NzKCd0b3AnLCBjbGllbnRSZWN0LnRvcCk7XG5cblx0XHRcdFx0JGxhc3RWaXN1YWxDYXJldCA9ICQoJzxkaXYgY2xhc3M9XCJtY2UtdmlzdWFsLWNhcmV0XCIgZGF0YS1tY2UtYm9ndXM9XCJhbGxcIj48L2Rpdj4nKS5jc3MoY2xpZW50UmVjdCkuYXBwZW5kVG8ocm9vdE5vZGUpO1xuXG5cdFx0XHRcdGlmIChiZWZvcmUpIHtcblx0XHRcdFx0XHQkbGFzdFZpc3VhbENhcmV0LmFkZENsYXNzKCdtY2UtdmlzdWFsLWNhcmV0LWJlZm9yZScpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0c3RhcnRCbGluaygpO1xuXG5cdFx0XHRcdHJuZyA9IG5vZGUub3duZXJEb2N1bWVudC5jcmVhdGVSYW5nZSgpO1xuXHRcdFx0XHRybmcuc2V0U3RhcnQoY2FyZXRDb250YWluZXJOb2RlLCAwKTtcblx0XHRcdFx0cm5nLnNldEVuZChjYXJldENvbnRhaW5lck5vZGUsIDApO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y2FyZXRDb250YWluZXJOb2RlID0gQ2FyZXRDb250YWluZXIuaW5zZXJ0SW5saW5lKG5vZGUsIGJlZm9yZSk7XG5cdFx0XHRcdHJuZyA9IG5vZGUub3duZXJEb2N1bWVudC5jcmVhdGVSYW5nZSgpO1xuXG5cdFx0XHRcdGlmIChpc0NvbnRlbnRFZGl0YWJsZUZhbHNlKGNhcmV0Q29udGFpbmVyTm9kZS5uZXh0U2libGluZykpIHtcblx0XHRcdFx0XHRybmcuc2V0U3RhcnQoY2FyZXRDb250YWluZXJOb2RlLCAwKTtcblx0XHRcdFx0XHRybmcuc2V0RW5kKGNhcmV0Q29udGFpbmVyTm9kZSwgMCk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0cm5nLnNldFN0YXJ0KGNhcmV0Q29udGFpbmVyTm9kZSwgMSk7XG5cdFx0XHRcdFx0cm5nLnNldEVuZChjYXJldENvbnRhaW5lck5vZGUsIDEpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJuZztcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHJuZztcblx0XHR9XG5cblx0XHRmdW5jdGlvbiBoaWRlKCkge1xuXHRcdFx0dHJpbUlubGluZUNhcmV0Q29udGFpbmVycygpO1xuXG5cdFx0XHRpZiAoY2FyZXRDb250YWluZXJOb2RlKSB7XG5cdFx0XHRcdENhcmV0Q29udGFpbmVyLnJlbW92ZShjYXJldENvbnRhaW5lck5vZGUpO1xuXHRcdFx0XHRjYXJldENvbnRhaW5lck5vZGUgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoJGxhc3RWaXN1YWxDYXJldCkge1xuXHRcdFx0XHQkbGFzdFZpc3VhbENhcmV0LnJlbW92ZSgpO1xuXHRcdFx0XHQkbGFzdFZpc3VhbENhcmV0ID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdFx0Y2xlYXJJbnRlcnZhbChjdXJzb3JJbnRlcnZhbCk7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gc3RhcnRCbGluaygpIHtcblx0XHRcdGN1cnNvckludGVydmFsID0gRGVsYXkuc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7XG5cdFx0XHRcdCQoJ2Rpdi5tY2UtdmlzdWFsLWNhcmV0Jywgcm9vdE5vZGUpLnRvZ2dsZUNsYXNzKCdtY2UtdmlzdWFsLWNhcmV0LWhpZGRlbicpO1xuXHRcdFx0fSwgNTAwKTtcblx0XHR9XG5cblx0XHRmdW5jdGlvbiBkZXN0cm95KCkge1xuXHRcdFx0RGVsYXkuY2xlYXJJbnRlcnZhbChjdXJzb3JJbnRlcnZhbCk7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gZ2V0Q3NzKCkge1xuXHRcdFx0cmV0dXJuIChcblx0XHRcdFx0Jy5tY2UtdmlzdWFsLWNhcmV0IHsnICtcblx0XHRcdFx0XHQncG9zaXRpb246IGFic29sdXRlOycgK1xuXHRcdFx0XHRcdCdiYWNrZ3JvdW5kLWNvbG9yOiBibGFjazsnICtcblx0XHRcdFx0XHQnYmFja2dyb3VuZC1jb2xvcjogY3VycmVudGNvbG9yOycgK1xuXHRcdFx0XHQnfScgK1xuXHRcdFx0XHQnLm1jZS12aXN1YWwtY2FyZXQtaGlkZGVuIHsnICtcblx0XHRcdFx0XHQnZGlzcGxheTogbm9uZTsnICtcblx0XHRcdFx0J30nICtcblx0XHRcdFx0JypbZGF0YS1tY2UtY2FyZXRdIHsnICtcblx0XHRcdFx0XHQncG9zaXRpb246IGFic29sdXRlOycgK1xuXHRcdFx0XHRcdCdsZWZ0OiAtMTAwMHB4OycgK1xuXHRcdFx0XHRcdCdyaWdodDogYXV0bzsnICtcblx0XHRcdFx0XHQndG9wOiAwOycgK1xuXHRcdFx0XHRcdCdtYXJnaW46IDA7JyArXG5cdFx0XHRcdFx0J3BhZGRpbmc6IDA7JyArXG5cdFx0XHRcdCd9J1xuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRyZXR1cm4ge1xuXHRcdFx0c2hvdzogc2hvdyxcblx0XHRcdGhpZGU6IGhpZGUsXG5cdFx0XHRnZXRDc3M6IGdldENzcyxcblx0XHRcdGRlc3Ryb3k6IGRlc3Ryb3lcblx0XHR9O1xuXHR9O1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy9kb20vRGltZW5zaW9ucy5qc1xuXG4vKipcbiAqIERpbWVuc2lvbnMuanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBUaGlzIG1vZHVsZSBtZWFzdXJlcyBub2RlcyBhbmQgcmV0dXJucyBjbGllbnQgcmVjdHMuIFRoZSBjbGllbnQgcmVjdHMgaGFzIGFuXG4gKiBleHRyYSBub2RlIHByb3BlcnR5LlxuICpcbiAqIEBwcml2YXRlXG4gKiBAY2xhc3MgdGlueW1jZS5kb20uRGltZW5zaW9uc1xuICovXG5kZWZpbmUoXCJ0aW55bWNlL2RvbS9EaW1lbnNpb25zXCIsIFtcblx0XCJ0aW55bWNlL3V0aWwvQXJyXCIsXG5cdFwidGlueW1jZS9kb20vTm9kZVR5cGVcIixcblx0XCJ0aW55bWNlL2dlb20vQ2xpZW50UmVjdFwiXG5dLCBmdW5jdGlvbihBcnIsIE5vZGVUeXBlLCBDbGllbnRSZWN0KSB7XG5cblx0ZnVuY3Rpb24gZ2V0Q2xpZW50UmVjdHMobm9kZSkge1xuXHRcdGZ1bmN0aW9uIHRvQXJyYXlXaXRoTm9kZShjbGllbnRSZWN0cykge1xuXHRcdFx0cmV0dXJuIEFyci5tYXAoY2xpZW50UmVjdHMsIGZ1bmN0aW9uKGNsaWVudFJlY3QpIHtcblx0XHRcdFx0Y2xpZW50UmVjdCA9IENsaWVudFJlY3QuY2xvbmUoY2xpZW50UmVjdCk7XG5cdFx0XHRcdGNsaWVudFJlY3Qubm9kZSA9IG5vZGU7XG5cblx0XHRcdFx0cmV0dXJuIGNsaWVudFJlY3Q7XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRpZiAoQXJyLmlzQXJyYXkobm9kZSkpIHtcblx0XHRcdHJldHVybiBBcnIucmVkdWNlKG5vZGUsIGZ1bmN0aW9uKHJlc3VsdCwgbm9kZSkge1xuXHRcdFx0XHRyZXR1cm4gcmVzdWx0LmNvbmNhdChnZXRDbGllbnRSZWN0cyhub2RlKSk7XG5cdFx0XHR9LCBbXSk7XG5cdFx0fVxuXG5cdFx0aWYgKE5vZGVUeXBlLmlzRWxlbWVudChub2RlKSkge1xuXHRcdFx0cmV0dXJuIHRvQXJyYXlXaXRoTm9kZShub2RlLmdldENsaWVudFJlY3RzKCkpO1xuXHRcdH1cblxuXHRcdGlmIChOb2RlVHlwZS5pc1RleHQobm9kZSkpIHtcblx0XHRcdHZhciBybmcgPSBub2RlLm93bmVyRG9jdW1lbnQuY3JlYXRlUmFuZ2UoKTtcblxuXHRcdFx0cm5nLnNldFN0YXJ0KG5vZGUsIDApO1xuXHRcdFx0cm5nLnNldEVuZChub2RlLCBub2RlLmRhdGEubGVuZ3RoKTtcblxuXHRcdFx0cmV0dXJuIHRvQXJyYXlXaXRoTm9kZShybmcuZ2V0Q2xpZW50UmVjdHMoKSk7XG5cdFx0fVxuXHR9XG5cblx0cmV0dXJuIHtcblx0XHQvKipcblx0XHQgKiBSZXR1cm5zIHRoZSBjbGllbnQgcmVjdHMgZm9yIGEgc3BlY2lmaWMgbm9kZS5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgZ2V0Q2xpZW50UmVjdHNcblx0XHQgKiBAcGFyYW0ge0FycmF5L0RPTU5vZGV9IG5vZGUgTm9kZSBvciBhcnJheSBvZiBub2RlcyB0byBnZXQgY2xpZW50IHJlY3RzIG9uLlxuXHRcdCAqIEBwYXJhbSB7QXJyYXl9IEFycmF5IG9mIGNsaWVudCByZWN0cyB3aXRoIGEgZXh0cmEgbm9kZSBwcm9wZXJ0eS5cblx0XHQgKi9cblx0XHRnZXRDbGllbnRSZWN0czogZ2V0Q2xpZW50UmVjdHNcblx0fTtcbn0pO1xuXG4vLyBJbmNsdWRlZCBmcm9tOiBqcy90aW55bWNlL2NsYXNzZXMvY2FyZXQvTGluZVdhbGtlci5qc1xuXG4vKipcbiAqIExpbmVXYWxrZXIuanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBUaGlzIG1vZHVsZSBsZXRzIHlvdSB3YWxrIHRoZSBkb2N1bWVudCBsaW5lIGJ5IGxpbmVcbiAqIHJldHVyaW5nIG5vZGVzIGFuZCBjbGllbnQgcmVjdHMgZm9yIGVhY2ggbGluZS5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQGNsYXNzIHRpbnltY2UuY2FyZXQuTGluZVdhbGtlclxuICovXG5kZWZpbmUoXCJ0aW55bWNlL2NhcmV0L0xpbmVXYWxrZXJcIiwgW1xuXHRcInRpbnltY2UvdXRpbC9GdW5cIixcblx0XCJ0aW55bWNlL3V0aWwvQXJyXCIsXG5cdFwidGlueW1jZS9kb20vRGltZW5zaW9uc1wiLFxuXHRcInRpbnltY2UvY2FyZXQvQ2FyZXRDYW5kaWRhdGVcIixcblx0XCJ0aW55bWNlL2NhcmV0L0NhcmV0VXRpbHNcIixcblx0XCJ0aW55bWNlL2NhcmV0L0NhcmV0V2Fsa2VyXCIsXG5cdFwidGlueW1jZS9jYXJldC9DYXJldFBvc2l0aW9uXCIsXG5cdFwidGlueW1jZS9nZW9tL0NsaWVudFJlY3RcIlxuXSwgZnVuY3Rpb24oRnVuLCBBcnIsIERpbWVuc2lvbnMsIENhcmV0Q2FuZGlkYXRlLCBDYXJldFV0aWxzLCBDYXJldFdhbGtlciwgQ2FyZXRQb3NpdGlvbiwgQ2xpZW50UmVjdCkge1xuXHR2YXIgY3VycnkgPSBGdW4uY3Vycnk7XG5cblx0ZnVuY3Rpb24gZmluZFVudGlsKGRpcmVjdGlvbiwgcm9vdE5vZGUsIHByZWRpY2F0ZUZuLCBub2RlKSB7XG5cdFx0d2hpbGUgKChub2RlID0gQ2FyZXRVdGlscy5maW5kTm9kZShub2RlLCBkaXJlY3Rpb24sIENhcmV0Q2FuZGlkYXRlLmlzRWRpdGFibGVDYXJldENhbmRpZGF0ZSwgcm9vdE5vZGUpKSkge1xuXHRcdFx0aWYgKHByZWRpY2F0ZUZuKG5vZGUpKSB7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRmdW5jdGlvbiB3YWxrVW50aWwoZGlyZWN0aW9uLCBpc0Fib3ZlRm4sIGlzQmVmbG93Rm4sIHJvb3ROb2RlLCBwcmVkaWNhdGVGbiwgY2FyZXRQb3NpdGlvbikge1xuXHRcdHZhciBsaW5lID0gMCwgbm9kZSwgcmVzdWx0ID0gW10sIHRhcmdldENsaWVudFJlY3Q7XG5cblx0XHRmdW5jdGlvbiBhZGQobm9kZSkge1xuXHRcdFx0dmFyIGksIGNsaWVudFJlY3QsIGNsaWVudFJlY3RzO1xuXG5cdFx0XHRjbGllbnRSZWN0cyA9IERpbWVuc2lvbnMuZ2V0Q2xpZW50UmVjdHMobm9kZSk7XG5cdFx0XHRpZiAoZGlyZWN0aW9uID09IC0xKSB7XG5cdFx0XHRcdGNsaWVudFJlY3RzID0gY2xpZW50UmVjdHMucmV2ZXJzZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRmb3IgKGkgPSAwOyBpIDwgY2xpZW50UmVjdHMubGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0Y2xpZW50UmVjdCA9IGNsaWVudFJlY3RzW2ldO1xuXHRcdFx0XHRpZiAoaXNCZWZsb3dGbihjbGllbnRSZWN0LCB0YXJnZXRDbGllbnRSZWN0KSkge1xuXHRcdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHJlc3VsdC5sZW5ndGggPiAwICYmIGlzQWJvdmVGbihjbGllbnRSZWN0LCBBcnIubGFzdChyZXN1bHQpKSkge1xuXHRcdFx0XHRcdGxpbmUrKztcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGNsaWVudFJlY3QubGluZSA9IGxpbmU7XG5cblx0XHRcdFx0aWYgKHByZWRpY2F0ZUZuKGNsaWVudFJlY3QpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXN1bHQucHVzaChjbGllbnRSZWN0KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHR0YXJnZXRDbGllbnRSZWN0ID0gQXJyLmxhc3QoY2FyZXRQb3NpdGlvbi5nZXRDbGllbnRSZWN0cygpKTtcblx0XHRpZiAoIXRhcmdldENsaWVudFJlY3QpIHtcblx0XHRcdHJldHVybiByZXN1bHQ7XG5cdFx0fVxuXG5cdFx0bm9kZSA9IGNhcmV0UG9zaXRpb24uZ2V0Tm9kZSgpO1xuXHRcdGFkZChub2RlKTtcblx0XHRmaW5kVW50aWwoZGlyZWN0aW9uLCByb290Tm9kZSwgYWRkLCBub2RlKTtcblxuXHRcdHJldHVybiByZXN1bHQ7XG5cdH1cblxuXHRmdW5jdGlvbiBhYm92ZUxpbmVOdW1iZXIobGluZU51bWJlciwgY2xpZW50UmVjdCkge1xuXHRcdHJldHVybiBjbGllbnRSZWN0LmxpbmUgPiBsaW5lTnVtYmVyO1xuXHR9XG5cblx0ZnVuY3Rpb24gaXNMaW5lKGxpbmVOdW1iZXIsIGNsaWVudFJlY3QpIHtcblx0XHRyZXR1cm4gY2xpZW50UmVjdC5saW5lID09PSBsaW5lTnVtYmVyO1xuXHR9XG5cblx0dmFyIHVwVW50aWwgPSBjdXJyeSh3YWxrVW50aWwsIC0xLCBDbGllbnRSZWN0LmlzQWJvdmUsIENsaWVudFJlY3QuaXNCZWxvdyk7XG5cdHZhciBkb3duVW50aWwgPSBjdXJyeSh3YWxrVW50aWwsIDEsIENsaWVudFJlY3QuaXNCZWxvdywgQ2xpZW50UmVjdC5pc0Fib3ZlKTtcblxuXHRmdW5jdGlvbiBwb3NpdGlvbnNVbnRpbChkaXJlY3Rpb24sIHJvb3ROb2RlLCBwcmVkaWNhdGVGbiwgbm9kZSkge1xuXHRcdHZhciBjYXJldFdhbGtlciA9IG5ldyBDYXJldFdhbGtlcihyb290Tm9kZSksIHdhbGtGbiwgaXNCZWxvd0ZuLCBpc0Fib3ZlRm4sXG5cdFx0XHRjYXJldFBvc2l0aW9uLCByZXN1bHQgPSBbXSwgbGluZSA9IDAsIGNsaWVudFJlY3QsIHRhcmdldENsaWVudFJlY3Q7XG5cblx0XHRmdW5jdGlvbiBnZXRDbGllbnRSZWN0KGNhcmV0UG9zaXRpb24pIHtcblx0XHRcdGlmIChkaXJlY3Rpb24gPT0gMSkge1xuXHRcdFx0XHRyZXR1cm4gQXJyLmxhc3QoY2FyZXRQb3NpdGlvbi5nZXRDbGllbnRSZWN0cygpKTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIEFyci5sYXN0KGNhcmV0UG9zaXRpb24uZ2V0Q2xpZW50UmVjdHMoKSk7XG5cdFx0fVxuXG5cdFx0aWYgKGRpcmVjdGlvbiA9PSAxKSB7XG5cdFx0XHR3YWxrRm4gPSBjYXJldFdhbGtlci5uZXh0O1xuXHRcdFx0aXNCZWxvd0ZuID0gQ2xpZW50UmVjdC5pc0JlbG93O1xuXHRcdFx0aXNBYm92ZUZuID0gQ2xpZW50UmVjdC5pc0Fib3ZlO1xuXHRcdFx0Y2FyZXRQb3NpdGlvbiA9IENhcmV0UG9zaXRpb24uYWZ0ZXIobm9kZSk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHdhbGtGbiA9IGNhcmV0V2Fsa2VyLnByZXY7XG5cdFx0XHRpc0JlbG93Rm4gPSBDbGllbnRSZWN0LmlzQWJvdmU7XG5cdFx0XHRpc0Fib3ZlRm4gPSBDbGllbnRSZWN0LmlzQmVsb3c7XG5cdFx0XHRjYXJldFBvc2l0aW9uID0gQ2FyZXRQb3NpdGlvbi5iZWZvcmUobm9kZSk7XG5cdFx0fVxuXG5cdFx0dGFyZ2V0Q2xpZW50UmVjdCA9IGdldENsaWVudFJlY3QoY2FyZXRQb3NpdGlvbik7XG5cblx0XHRkbyB7XG5cdFx0XHRpZiAoIWNhcmV0UG9zaXRpb24uaXNWaXNpYmxlKCkpIHtcblx0XHRcdFx0Y29udGludWU7XG5cdFx0XHR9XG5cblx0XHRcdGNsaWVudFJlY3QgPSBnZXRDbGllbnRSZWN0KGNhcmV0UG9zaXRpb24pO1xuXG5cdFx0XHRpZiAoaXNBYm92ZUZuKGNsaWVudFJlY3QsIHRhcmdldENsaWVudFJlY3QpKSB7XG5cdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAocmVzdWx0Lmxlbmd0aCA+IDAgJiYgaXNCZWxvd0ZuKGNsaWVudFJlY3QsIEFyci5sYXN0KHJlc3VsdCkpKSB7XG5cdFx0XHRcdGxpbmUrKztcblx0XHRcdH1cblxuXHRcdFx0Y2xpZW50UmVjdCA9IENsaWVudFJlY3QuY2xvbmUoY2xpZW50UmVjdCk7XG5cdFx0XHRjbGllbnRSZWN0LnBvc2l0aW9uID0gY2FyZXRQb3NpdGlvbjtcblx0XHRcdGNsaWVudFJlY3QubGluZSA9IGxpbmU7XG5cblx0XHRcdGlmIChwcmVkaWNhdGVGbihjbGllbnRSZWN0KSkge1xuXHRcdFx0XHRyZXR1cm4gcmVzdWx0O1xuXHRcdFx0fVxuXG5cdFx0XHRyZXN1bHQucHVzaChjbGllbnRSZWN0KTtcblx0XHR9IHdoaWxlICgoY2FyZXRQb3NpdGlvbiA9IHdhbGtGbihjYXJldFBvc2l0aW9uKSkpO1xuXG5cdFx0cmV0dXJuIHJlc3VsdDtcblx0fVxuXG5cdHJldHVybiB7XG5cdFx0dXBVbnRpbDogdXBVbnRpbCxcblx0XHRkb3duVW50aWw6IGRvd25VbnRpbCxcblxuXHRcdC8qKlxuXHRcdCAqIEZpbmQgY2xpZW50IHJlY3RzIHdpdGggbGluZSBhbmQgY2FyZXQgcG9zaXRpb24gdW50aWwgdGhlIHByZWRpY2F0ZSByZXR1cm5zIHRydWUuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHBvc2l0aW9uc1VudGlsXG5cdFx0ICogQHBhcmFtIHtOdW1iZXJ9IGRpcmVjdGlvbiBEaXJlY3Rpb24gZm9yd2FyZC9iYWNrd2FyZCAxLy0xLlxuXHRcdCAqIEBwYXJhbSB7RE9NTm9kZX0gcm9vdE5vZGUgUm9vdCBub2RlIHRvIHdhbGsgd2l0aGluLlxuXHRcdCAqIEBwYXJhbSB7ZnVuY3Rpb259IHByZWRpY2F0ZUZuIEdldHMgdGhlIGNsaWVudCByZWN0IGFzIGl0J3MgaW5wdXQuXG5cdFx0ICogQHBhcmFtIHtET01Ob2RlfSBub2RlIE5vZGUgdG8gc3RhcnQgd2Fsa2luZyBmcm9tLlxuXHRcdCAqIEByZXR1cm4ge0FycmF5fSBBcnJheSBvZiBjbGllbnQgcmVjdHMgd2l0aCBsaW5lIGFuZCBwb3NpdGlvbiBwcm9wZXJ0aWVzLlxuXHRcdCAqL1xuXHRcdHBvc2l0aW9uc1VudGlsOiBwb3NpdGlvbnNVbnRpbCxcblxuXHRcdGlzQWJvdmVMaW5lOiBjdXJyeShhYm92ZUxpbmVOdW1iZXIpLFxuXHRcdGlzTGluZTogY3VycnkoaXNMaW5lKVxuXHR9O1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy9jYXJldC9MaW5lVXRpbHMuanNcblxuLyoqXG4gKiBMaW5lVXRpbHMuanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBVdGlsaXR5IGZ1bmN0aW9ucyBmb3Igd29ya2luZyB3aXRoIGxpbmVzLlxuICpcbiAqIEBwcml2YXRlXG4gKiBAY2xhc3MgdGlueW1jZS5jYXJldC5MaW5lVXRpbHNcbiAqL1xuZGVmaW5lKFwidGlueW1jZS9jYXJldC9MaW5lVXRpbHNcIiwgW1xuXHRcInRpbnltY2UvdXRpbC9GdW5cIixcblx0XCJ0aW55bWNlL3V0aWwvQXJyXCIsXG5cdFwidGlueW1jZS9kb20vTm9kZVR5cGVcIixcblx0XCJ0aW55bWNlL2RvbS9EaW1lbnNpb25zXCIsXG5cdFwidGlueW1jZS9nZW9tL0NsaWVudFJlY3RcIixcblx0XCJ0aW55bWNlL2NhcmV0L0NhcmV0VXRpbHNcIixcblx0XCJ0aW55bWNlL2NhcmV0L0NhcmV0Q2FuZGlkYXRlXCJcbl0sIGZ1bmN0aW9uKEZ1biwgQXJyLCBOb2RlVHlwZSwgRGltZW5zaW9ucywgQ2xpZW50UmVjdCwgQ2FyZXRVdGlscywgQ2FyZXRDYW5kaWRhdGUpIHtcblx0dmFyIGlzQ29udGVudEVkaXRhYmxlRmFsc2UgPSBOb2RlVHlwZS5pc0NvbnRlbnRFZGl0YWJsZUZhbHNlLFxuXHRcdGZpbmROb2RlID0gQ2FyZXRVdGlscy5maW5kTm9kZSxcblx0XHRjdXJyeSA9IEZ1bi5jdXJyeTtcblxuXHRmdW5jdGlvbiBkaXN0YW5jZVRvUmVjdExlZnQoY2xpZW50UmVjdCwgY2xpZW50WCkge1xuXHRcdHJldHVybiBNYXRoLmFicyhjbGllbnRSZWN0LmxlZnQgLSBjbGllbnRYKTtcblx0fVxuXG5cdGZ1bmN0aW9uIGRpc3RhbmNlVG9SZWN0UmlnaHQoY2xpZW50UmVjdCwgY2xpZW50WCkge1xuXHRcdHJldHVybiBNYXRoLmFicyhjbGllbnRSZWN0LnJpZ2h0IC0gY2xpZW50WCk7XG5cdH1cblxuXHRmdW5jdGlvbiBmaW5kQ2xvc2VzdENsaWVudFJlY3QoY2xpZW50UmVjdHMsIGNsaWVudFgpIHtcblx0XHRmdW5jdGlvbiBpc0luc2lkZShjbGllbnRYLCBjbGllbnRSZWN0KSB7XG5cdFx0XHRyZXR1cm4gY2xpZW50WCA+PSBjbGllbnRSZWN0LmxlZnQgJiYgY2xpZW50WCA8PSBjbGllbnRSZWN0LnJpZ2h0O1xuXHRcdH1cblxuXHRcdHJldHVybiBBcnIucmVkdWNlKGNsaWVudFJlY3RzLCBmdW5jdGlvbihvbGRDbGllbnRSZWN0LCBjbGllbnRSZWN0KSB7XG5cdFx0XHR2YXIgb2xkRGlzdGFuY2UsIG5ld0Rpc3RhbmNlO1xuXG5cdFx0XHRvbGREaXN0YW5jZSA9IE1hdGgubWluKGRpc3RhbmNlVG9SZWN0TGVmdChvbGRDbGllbnRSZWN0LCBjbGllbnRYKSwgZGlzdGFuY2VUb1JlY3RSaWdodChvbGRDbGllbnRSZWN0LCBjbGllbnRYKSk7XG5cdFx0XHRuZXdEaXN0YW5jZSA9IE1hdGgubWluKGRpc3RhbmNlVG9SZWN0TGVmdChjbGllbnRSZWN0LCBjbGllbnRYKSwgZGlzdGFuY2VUb1JlY3RSaWdodChjbGllbnRSZWN0LCBjbGllbnRYKSk7XG5cblx0XHRcdGlmIChpc0luc2lkZShjbGllbnRYLCBjbGllbnRSZWN0KSkge1xuXHRcdFx0XHRyZXR1cm4gY2xpZW50UmVjdDtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGlzSW5zaWRlKGNsaWVudFgsIG9sZENsaWVudFJlY3QpKSB7XG5cdFx0XHRcdHJldHVybiBvbGRDbGllbnRSZWN0O1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBjRT1mYWxzZSBoYXMgaGlnaGVyIHByaW9yaXR5XG5cdFx0XHRpZiAobmV3RGlzdGFuY2UgPT0gb2xkRGlzdGFuY2UgJiYgaXNDb250ZW50RWRpdGFibGVGYWxzZShjbGllbnRSZWN0Lm5vZGUpKSB7XG5cdFx0XHRcdHJldHVybiBjbGllbnRSZWN0O1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAobmV3RGlzdGFuY2UgPCBvbGREaXN0YW5jZSkge1xuXHRcdFx0XHRyZXR1cm4gY2xpZW50UmVjdDtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG9sZENsaWVudFJlY3Q7XG5cdFx0fSk7XG5cdH1cblxuXHRmdW5jdGlvbiB3YWxrVW50aWwoZGlyZWN0aW9uLCByb290Tm9kZSwgcHJlZGljYXRlRm4sIG5vZGUpIHtcblx0XHR3aGlsZSAoKG5vZGUgPSBmaW5kTm9kZShub2RlLCBkaXJlY3Rpb24sIENhcmV0Q2FuZGlkYXRlLmlzRWRpdGFibGVDYXJldENhbmRpZGF0ZSwgcm9vdE5vZGUpKSkge1xuXHRcdFx0aWYgKHByZWRpY2F0ZUZuKG5vZGUpKSB7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRmdW5jdGlvbiBmaW5kTGluZU5vZGVSZWN0cyhyb290Tm9kZSwgdGFyZ2V0Tm9kZVJlY3QpIHtcblx0XHR2YXIgY2xpZW50UmVjdHMgPSBbXTtcblxuXHRcdGZ1bmN0aW9uIGNvbGxlY3QoY2hlY2tQb3NGbiwgbm9kZSkge1xuXHRcdFx0dmFyIGxpbmVSZWN0cztcblxuXHRcdFx0bGluZVJlY3RzID0gQXJyLmZpbHRlcihEaW1lbnNpb25zLmdldENsaWVudFJlY3RzKG5vZGUpLCBmdW5jdGlvbihjbGllbnRSZWN0KSB7XG5cdFx0XHRcdHJldHVybiAhY2hlY2tQb3NGbihjbGllbnRSZWN0LCB0YXJnZXROb2RlUmVjdCk7XG5cdFx0XHR9KTtcblxuXHRcdFx0Y2xpZW50UmVjdHMgPSBjbGllbnRSZWN0cy5jb25jYXQobGluZVJlY3RzKTtcblxuXHRcdFx0cmV0dXJuIGxpbmVSZWN0cy5sZW5ndGggPT09IDA7XG5cdFx0fVxuXG5cdFx0Y2xpZW50UmVjdHMucHVzaCh0YXJnZXROb2RlUmVjdCk7XG5cdFx0d2Fsa1VudGlsKC0xLCByb290Tm9kZSwgY3VycnkoY29sbGVjdCwgQ2xpZW50UmVjdC5pc0Fib3ZlKSwgdGFyZ2V0Tm9kZVJlY3Qubm9kZSk7XG5cdFx0d2Fsa1VudGlsKDEsIHJvb3ROb2RlLCBjdXJyeShjb2xsZWN0LCBDbGllbnRSZWN0LmlzQmVsb3cpLCB0YXJnZXROb2RlUmVjdC5ub2RlKTtcblxuXHRcdHJldHVybiBjbGllbnRSZWN0cztcblx0fVxuXG5cdGZ1bmN0aW9uIGdldENvbnRlbnRFZGl0YWJsZUZhbHNlQ2hpbGRyZW4ocm9vdE5vZGUpIHtcblx0XHRyZXR1cm4gQXJyLmZpbHRlcihBcnIudG9BcnJheShyb290Tm9kZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnKicpKSwgaXNDb250ZW50RWRpdGFibGVGYWxzZSk7XG5cdH1cblxuXHRmdW5jdGlvbiBjYXJldEluZm8oY2xpZW50UmVjdCwgY2xpZW50WCkge1xuXHRcdHJldHVybiB7XG5cdFx0XHRub2RlOiBjbGllbnRSZWN0Lm5vZGUsXG5cdFx0XHRiZWZvcmU6IGRpc3RhbmNlVG9SZWN0TGVmdChjbGllbnRSZWN0LCBjbGllbnRYKSA8IGRpc3RhbmNlVG9SZWN0UmlnaHQoY2xpZW50UmVjdCwgY2xpZW50WClcblx0XHR9O1xuXHR9XG5cblx0ZnVuY3Rpb24gY2xvc2VzdENhcmV0KHJvb3ROb2RlLCBjbGllbnRYLCBjbGllbnRZKSB7XG5cdFx0dmFyIGNvbnRlbnRFZGl0YWJsZUZhbHNlTm9kZVJlY3RzLCBjbG9zZXN0Tm9kZVJlY3Q7XG5cblx0XHRjb250ZW50RWRpdGFibGVGYWxzZU5vZGVSZWN0cyA9IERpbWVuc2lvbnMuZ2V0Q2xpZW50UmVjdHMoZ2V0Q29udGVudEVkaXRhYmxlRmFsc2VDaGlsZHJlbihyb290Tm9kZSkpO1xuXHRcdGNvbnRlbnRFZGl0YWJsZUZhbHNlTm9kZVJlY3RzID0gQXJyLmZpbHRlcihjb250ZW50RWRpdGFibGVGYWxzZU5vZGVSZWN0cywgZnVuY3Rpb24oY2xpZW50UmVjdCkge1xuXHRcdFx0cmV0dXJuIGNsaWVudFkgPj0gY2xpZW50UmVjdC50b3AgJiYgY2xpZW50WSA8PSBjbGllbnRSZWN0LmJvdHRvbTtcblx0XHR9KTtcblxuXHRcdGNsb3Nlc3ROb2RlUmVjdCA9IGZpbmRDbG9zZXN0Q2xpZW50UmVjdChjb250ZW50RWRpdGFibGVGYWxzZU5vZGVSZWN0cywgY2xpZW50WCk7XG5cdFx0aWYgKGNsb3Nlc3ROb2RlUmVjdCkge1xuXHRcdFx0Y2xvc2VzdE5vZGVSZWN0ID0gZmluZENsb3Nlc3RDbGllbnRSZWN0KGZpbmRMaW5lTm9kZVJlY3RzKHJvb3ROb2RlLCBjbG9zZXN0Tm9kZVJlY3QpLCBjbGllbnRYKTtcblx0XHRcdGlmIChjbG9zZXN0Tm9kZVJlY3QgJiYgaXNDb250ZW50RWRpdGFibGVGYWxzZShjbG9zZXN0Tm9kZVJlY3Qubm9kZSkpIHtcblx0XHRcdFx0cmV0dXJuIGNhcmV0SW5mbyhjbG9zZXN0Tm9kZVJlY3QsIGNsaWVudFgpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiBudWxsO1xuXHR9XG5cblx0cmV0dXJuIHtcblx0XHRmaW5kQ2xvc2VzdENsaWVudFJlY3Q6IGZpbmRDbG9zZXN0Q2xpZW50UmVjdCxcblx0XHRmaW5kTGluZU5vZGVSZWN0czogZmluZExpbmVOb2RlUmVjdHMsXG5cdFx0Y2xvc2VzdENhcmV0OiBjbG9zZXN0Q2FyZXRcblx0fTtcbn0pO1xuXG4vLyBJbmNsdWRlZCBmcm9tOiBqcy90aW55bWNlL2NsYXNzZXMvZG9tL01vdXNlUG9zaXRpb24uanNcblxuLyoqXG4gKiBNb3VzZVBvc2l0aW9uLmpzXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgTEdQTCBMaWNlbnNlLlxuICogQ29weXJpZ2h0IChjKSAxOTk5LTIwMTYgRXBob3ggQ29ycC4gQWxsIHJpZ2h0cyByZXNlcnZlZFxuICpcbiAqIExpY2Vuc2U6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vbGljZW5zZVxuICogQ29udHJpYnV0aW5nOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2NvbnRyaWJ1dGluZ1xuICovXG5cbi8qKlxuICogVGhpcyBtb2R1bGUgY2FsY3VsYXRlcyBhbiBhYnNvbHV0ZSBjb29yZGluYXRlIGluc2lkZSB0aGUgZWRpdG9yIGJvZHkgZm9yIGJvdGggbG9jYWwgYW5kIGdsb2JhbCBtb3VzZSBldmVudHMuXG4gKlxuICogQHByaXZhdGVcbiAqIEBjbGFzcyB0aW55bWNlLmRvbS5Nb3VzZVBvc2l0aW9uXG4gKi9cbmRlZmluZShcInRpbnltY2UvZG9tL01vdXNlUG9zaXRpb25cIiwgW1xuXSwgZnVuY3Rpb24oKSB7XG5cdHZhciBnZXRBYnNvbHV0ZVBvc2l0aW9uID0gZnVuY3Rpb24gKGVsbSkge1xuXHRcdHZhciBkb2MsIGRvY0VsZW0sIHdpbiwgY2xpZW50UmVjdDtcblxuXHRcdGNsaWVudFJlY3QgPSBlbG0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG5cdFx0ZG9jID0gZWxtLm93bmVyRG9jdW1lbnQ7XG5cdFx0ZG9jRWxlbSA9IGRvYy5kb2N1bWVudEVsZW1lbnQ7XG5cdFx0d2luID0gZG9jLmRlZmF1bHRWaWV3O1xuXG5cdFx0cmV0dXJuIHtcblx0XHRcdHRvcDogY2xpZW50UmVjdC50b3AgKyB3aW4ucGFnZVlPZmZzZXQgLSBkb2NFbGVtLmNsaWVudFRvcCxcblx0XHRcdGxlZnQ6IGNsaWVudFJlY3QubGVmdCArIHdpbi5wYWdlWE9mZnNldCAtIGRvY0VsZW0uY2xpZW50TGVmdFxuXHRcdH07XG5cdH07XG5cblx0dmFyIGdldEJvZHlQb3NpdGlvbiA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcblx0XHRyZXR1cm4gZWRpdG9yLmlubGluZSA/IGdldEFic29sdXRlUG9zaXRpb24oZWRpdG9yLmdldEJvZHkoKSkgOiB7bGVmdDogMCwgdG9wOiAwfTtcblx0fTtcblxuXHR2YXIgZ2V0U2Nyb2xsUG9zaXRpb24gPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG5cdFx0dmFyIGJvZHkgPSBlZGl0b3IuZ2V0Qm9keSgpO1xuXHRcdHJldHVybiBlZGl0b3IuaW5saW5lID8ge2xlZnQ6IGJvZHkuc2Nyb2xsTGVmdCwgdG9wOiBib2R5LnNjcm9sbFRvcH0gOiB7bGVmdDogMCwgdG9wOiAwfTtcblx0fTtcblxuXHR2YXIgZ2V0Qm9keVNjcm9sbCA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcblx0XHR2YXIgYm9keSA9IGVkaXRvci5nZXRCb2R5KCksIGRvY0VsbSA9IGVkaXRvci5nZXREb2MoKS5kb2N1bWVudEVsZW1lbnQ7XG5cdFx0dmFyIGlubGluZVNjcm9sbCA9IHtsZWZ0OiBib2R5LnNjcm9sbExlZnQsIHRvcDogYm9keS5zY3JvbGxUb3B9O1xuXHRcdHZhciBpZnJhbWVTY3JvbGwgPSB7bGVmdDogYm9keS5zY3JvbGxMZWZ0IHx8IGRvY0VsbS5zY3JvbGxMZWZ0LCB0b3A6IGJvZHkuc2Nyb2xsVG9wIHx8IGRvY0VsbS5zY3JvbGxUb3B9O1xuXG5cdFx0cmV0dXJuIGVkaXRvci5pbmxpbmUgPyBpbmxpbmVTY3JvbGwgOiBpZnJhbWVTY3JvbGw7XG5cdH07XG5cblx0dmFyIGdldE1vdXNlUG9zaXRpb24gPSBmdW5jdGlvbiAoZWRpdG9yLCBldmVudCkge1xuXHRcdGlmIChldmVudC50YXJnZXQub3duZXJEb2N1bWVudCAhPT0gZWRpdG9yLmdldERvYygpKSB7XG5cdFx0XHR2YXIgaWZyYW1lUG9zaXRpb24gPSBnZXRBYnNvbHV0ZVBvc2l0aW9uKGVkaXRvci5nZXRDb250ZW50QXJlYUNvbnRhaW5lcigpKTtcblx0XHRcdHZhciBzY3JvbGxQb3NpdGlvbiA9IGdldEJvZHlTY3JvbGwoZWRpdG9yKTtcblxuXHRcdFx0cmV0dXJuIHtcblx0XHRcdFx0bGVmdDogZXZlbnQucGFnZVggLSBpZnJhbWVQb3NpdGlvbi5sZWZ0ICsgc2Nyb2xsUG9zaXRpb24ubGVmdCxcblx0XHRcdFx0dG9wOiBldmVudC5wYWdlWSAtIGlmcmFtZVBvc2l0aW9uLnRvcCArIHNjcm9sbFBvc2l0aW9uLnRvcFxuXHRcdFx0fTtcblx0XHR9XG5cblx0XHRyZXR1cm4ge1xuXHRcdFx0bGVmdDogZXZlbnQucGFnZVgsXG5cdFx0XHR0b3A6IGV2ZW50LnBhZ2VZXG5cdFx0fTtcblx0fTtcblxuXHR2YXIgY2FsY3VsYXRlUG9zaXRpb24gPSBmdW5jdGlvbiAoYm9keVBvc2l0aW9uLCBzY3JvbGxQb3NpdGlvbiwgbW91c2VQb3NpdGlvbikge1xuXHRcdHJldHVybiB7XG5cdFx0XHRwYWdlWDogKG1vdXNlUG9zaXRpb24ubGVmdCAtIGJvZHlQb3NpdGlvbi5sZWZ0KSArIHNjcm9sbFBvc2l0aW9uLmxlZnQsXG5cdFx0XHRwYWdlWTogKG1vdXNlUG9zaXRpb24udG9wIC0gYm9keVBvc2l0aW9uLnRvcCkgKyBzY3JvbGxQb3NpdGlvbi50b3Bcblx0XHR9O1xuXHR9O1xuXG5cdHZhciBjYWxjID0gZnVuY3Rpb24gKGVkaXRvciwgZXZlbnQpIHtcblx0XHRyZXR1cm4gY2FsY3VsYXRlUG9zaXRpb24oZ2V0Qm9keVBvc2l0aW9uKGVkaXRvciksIGdldFNjcm9sbFBvc2l0aW9uKGVkaXRvciksIGdldE1vdXNlUG9zaXRpb24oZWRpdG9yLCBldmVudCkpO1xuXHR9O1xuXG5cdHJldHVybiB7XG5cdFx0Y2FsYzogY2FsY1xuXHR9O1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy9EcmFnRHJvcE92ZXJyaWRlcy5qc1xuXG4vKipcbiAqIERyYWdEcm9wT3ZlcnJpZGVzLmpzXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgTEdQTCBMaWNlbnNlLlxuICogQ29weXJpZ2h0IChjKSAxOTk5LTIwMTUgRXBob3ggQ29ycC4gQWxsIHJpZ2h0cyByZXNlcnZlZFxuICpcbiAqIExpY2Vuc2U6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vbGljZW5zZVxuICogQ29udHJpYnV0aW5nOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2NvbnRyaWJ1dGluZ1xuICovXG5cbi8qKlxuICogVGhpcyBtb2R1bGUgY29udGFpbnMgbG9naWMgb3ZlcnJpZGluZyB0aGUgZHJhZy9kcm9wIGxvZ2ljIG9mIHRoZSBlZGl0b3IuXG4gKlxuICogQHByaXZhdGVcbiAqIEBjbGFzcyB0aW55bWNlLkRyYWdEcm9wT3ZlcnJpZGVzXG4gKi9cbmRlZmluZShcInRpbnltY2UvRHJhZ0Ryb3BPdmVycmlkZXNcIiwgW1xuXHRcInRpbnltY2UvZG9tL05vZGVUeXBlXCIsXG5cdFwidGlueW1jZS91dGlsL0FyclwiLFxuXHRcInRpbnltY2UvdXRpbC9GdW5cIixcblx0XCJ0aW55bWNlL3V0aWwvRGVsYXlcIixcblx0XCJ0aW55bWNlL2RvbS9ET01VdGlsc1wiLFxuXHRcInRpbnltY2UvZG9tL01vdXNlUG9zaXRpb25cIlxuXSwgZnVuY3Rpb24oXG5cdE5vZGVUeXBlLCBBcnIsIEZ1biwgRGVsYXksIERPTVV0aWxzLCBNb3VzZVBvc2l0aW9uXG4pIHtcblx0dmFyIGlzQ29udGVudEVkaXRhYmxlRmFsc2UgPSBOb2RlVHlwZS5pc0NvbnRlbnRFZGl0YWJsZUZhbHNlLFxuXHRcdGlzQ29udGVudEVkaXRhYmxlVHJ1ZSA9IE5vZGVUeXBlLmlzQ29udGVudEVkaXRhYmxlVHJ1ZTtcblxuXHR2YXIgaXNEcmFnZ2FibGUgPSBmdW5jdGlvbiAoZWxtKSB7XG5cdFx0cmV0dXJuIGlzQ29udGVudEVkaXRhYmxlRmFsc2UoZWxtKTtcblx0fTtcblxuXHR2YXIgaXNWYWxpZERyb3BUYXJnZXQgPSBmdW5jdGlvbiAoZWRpdG9yLCB0YXJnZXRFbGVtZW50LCBkcmFnRWxlbWVudCkge1xuXHRcdGlmICh0YXJnZXRFbGVtZW50ID09PSBkcmFnRWxlbWVudCB8fCBlZGl0b3IuZG9tLmlzQ2hpbGRPZih0YXJnZXRFbGVtZW50LCBkcmFnRWxlbWVudCkpIHtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cblx0XHRpZiAoaXNDb250ZW50RWRpdGFibGVGYWxzZSh0YXJnZXRFbGVtZW50KSkge1xuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblxuXHRcdHJldHVybiB0cnVlO1xuXHR9O1xuXG5cdHZhciBjbG9uZUVsZW1lbnQgPSBmdW5jdGlvbiAoZWxtKSB7XG5cdFx0dmFyIGNsb25lRWxtID0gZWxtLmNsb25lTm9kZSh0cnVlKTtcblx0XHRjbG9uZUVsbS5yZW1vdmVBdHRyaWJ1dGUoJ2RhdGEtbWNlLXNlbGVjdGVkJyk7XG5cdFx0cmV0dXJuIGNsb25lRWxtO1xuXHR9O1xuXG5cdHZhciBjcmVhdGVHaG9zdCA9IGZ1bmN0aW9uIChlZGl0b3IsIGVsbSwgd2lkdGgsIGhlaWdodCkge1xuXHRcdHZhciBjbG9uZWRFbG0gPSBlbG0uY2xvbmVOb2RlKHRydWUpO1xuXG5cdFx0ZWRpdG9yLmRvbS5zZXRTdHlsZXMoY2xvbmVkRWxtLCB7d2lkdGg6IHdpZHRoLCBoZWlnaHQ6IGhlaWdodH0pO1xuXHRcdGVkaXRvci5kb20uc2V0QXR0cmliKGNsb25lZEVsbSwgJ2RhdGEtbWNlLXNlbGVjdGVkJywgbnVsbCk7XG5cblx0XHR2YXIgZ2hvc3RFbG0gPSBlZGl0b3IuZG9tLmNyZWF0ZSgnZGl2Jywge1xuXHRcdFx0J2NsYXNzJzogJ21jZS1kcmFnLWNvbnRhaW5lcicsXG5cdFx0XHQnZGF0YS1tY2UtYm9ndXMnOiAnYWxsJyxcblx0XHRcdHVuc2VsZWN0YWJsZTogJ29uJyxcblx0XHRcdGNvbnRlbnRlZGl0YWJsZTogJ2ZhbHNlJ1xuXHRcdH0pO1xuXG5cdFx0ZWRpdG9yLmRvbS5zZXRTdHlsZXMoZ2hvc3RFbG0sIHtcblx0XHRcdHBvc2l0aW9uOiAnYWJzb2x1dGUnLFxuXHRcdFx0b3BhY2l0eTogMC41LFxuXHRcdFx0b3ZlcmZsb3c6ICdoaWRkZW4nLFxuXHRcdFx0Ym9yZGVyOiAwLFxuXHRcdFx0cGFkZGluZzogMCxcblx0XHRcdG1hcmdpbjogMCxcblx0XHRcdHdpZHRoOiB3aWR0aCxcblx0XHRcdGhlaWdodDogaGVpZ2h0XG5cdFx0fSk7XG5cblx0XHRlZGl0b3IuZG9tLnNldFN0eWxlcyhjbG9uZWRFbG0sIHtcblx0XHRcdG1hcmdpbjogMCxcblx0XHRcdGJveFNpemluZzogJ2JvcmRlci1ib3gnXG5cdFx0fSk7XG5cblx0XHRnaG9zdEVsbS5hcHBlbmRDaGlsZChjbG9uZWRFbG0pO1xuXG5cdFx0cmV0dXJuIGdob3N0RWxtO1xuXHR9O1xuXG5cdHZhciBhcHBlbmRHaG9zdFRvQm9keSA9IGZ1bmN0aW9uIChnaG9zdEVsbSwgYm9keUVsbSkge1xuXHRcdGlmIChnaG9zdEVsbS5wYXJlbnROb2RlICE9PSBib2R5RWxtKSB7XG5cdFx0XHRib2R5RWxtLmFwcGVuZENoaWxkKGdob3N0RWxtKTtcblx0XHR9XG5cdH07XG5cblx0dmFyIG1vdmVHaG9zdCA9IGZ1bmN0aW9uIChnaG9zdEVsbSwgcG9zaXRpb24sIHdpZHRoLCBoZWlnaHQsIG1heFgsIG1heFkpIHtcblx0XHR2YXIgb3ZlcmZsb3dYID0gMCwgb3ZlcmZsb3dZID0gMDtcblxuXHRcdGdob3N0RWxtLnN0eWxlLmxlZnQgPSBwb3NpdGlvbi5wYWdlWCArICdweCc7XG5cdFx0Z2hvc3RFbG0uc3R5bGUudG9wID0gcG9zaXRpb24ucGFnZVkgKyAncHgnO1xuXG5cdFx0aWYgKHBvc2l0aW9uLnBhZ2VYICsgd2lkdGggPiBtYXhYKSB7XG5cdFx0XHRvdmVyZmxvd1ggPSAocG9zaXRpb24ucGFnZVggKyB3aWR0aCkgLSBtYXhYO1xuXHRcdH1cblxuXHRcdGlmIChwb3NpdGlvbi5wYWdlWSArIGhlaWdodCA+IG1heFkpIHtcblx0XHRcdG92ZXJmbG93WSA9IChwb3NpdGlvbi5wYWdlWSArIGhlaWdodCkgLSBtYXhZO1xuXHRcdH1cblxuXHRcdGdob3N0RWxtLnN0eWxlLndpZHRoID0gKHdpZHRoIC0gb3ZlcmZsb3dYKSArICdweCc7XG5cdFx0Z2hvc3RFbG0uc3R5bGUuaGVpZ2h0ID0gKGhlaWdodCAtIG92ZXJmbG93WSkgKyAncHgnO1xuXHR9O1xuXG5cdHZhciByZW1vdmVFbGVtZW50ID0gZnVuY3Rpb24gKGVsbSkge1xuXHRcdGlmIChlbG0gJiYgZWxtLnBhcmVudE5vZGUpIHtcblx0XHRcdGVsbS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGVsbSk7XG5cdFx0fVxuXHR9O1xuXG5cdHZhciBpc0xlZnRNb3VzZUJ1dHRvblByZXNzZWQgPSBmdW5jdGlvbiAoZSkge1xuXHRcdHJldHVybiBlLmJ1dHRvbiA9PT0gMDtcblx0fTtcblxuXHR2YXIgaGFzRHJhZ2dhYmxlRWxlbWVudCA9IGZ1bmN0aW9uIChzdGF0ZSkge1xuXHRcdHJldHVybiBzdGF0ZS5lbGVtZW50O1xuXHR9O1xuXG5cdHZhciBhcHBseVJlbFBvcyA9IGZ1bmN0aW9uIChzdGF0ZSwgcG9zaXRpb24pIHtcblx0XHRyZXR1cm4ge1xuXHRcdFx0cGFnZVg6IHBvc2l0aW9uLnBhZ2VYIC0gc3RhdGUucmVsWCxcblx0XHRcdHBhZ2VZOiBwb3NpdGlvbi5wYWdlWSArIDVcblx0XHR9O1xuXHR9O1xuXG5cdHZhciBzdGFydCA9IGZ1bmN0aW9uIChzdGF0ZSwgZWRpdG9yKSB7XG5cdFx0cmV0dXJuIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRpZiAoaXNMZWZ0TW91c2VCdXR0b25QcmVzc2VkKGUpKSB7XG5cdFx0XHRcdHZhciBjZUVsbSA9IEFyci5maW5kKGVkaXRvci5kb20uZ2V0UGFyZW50cyhlLnRhcmdldCksIEZ1bi5vcihpc0NvbnRlbnRFZGl0YWJsZUZhbHNlLCBpc0NvbnRlbnRFZGl0YWJsZVRydWUpKTtcblxuXHRcdFx0XHRpZiAoaXNEcmFnZ2FibGUoY2VFbG0pKSB7XG5cdFx0XHRcdFx0dmFyIGVsbVBvcyA9IGVkaXRvci5kb20uZ2V0UG9zKGNlRWxtKTtcblx0XHRcdFx0XHR2YXIgYm9keUVsbSA9IGVkaXRvci5nZXRCb2R5KCk7XG5cdFx0XHRcdFx0dmFyIGRvY0VsbSA9IGVkaXRvci5nZXREb2MoKS5kb2N1bWVudEVsZW1lbnQ7XG5cblx0XHRcdFx0XHRzdGF0ZS5lbGVtZW50ID0gY2VFbG07XG5cdFx0XHRcdFx0c3RhdGUuc2NyZWVuWCA9IGUuc2NyZWVuWDtcblx0XHRcdFx0XHRzdGF0ZS5zY3JlZW5ZID0gZS5zY3JlZW5ZO1xuXHRcdFx0XHRcdHN0YXRlLm1heFggPSAoZWRpdG9yLmlubGluZSA/IGJvZHlFbG0uc2Nyb2xsV2lkdGggOiBkb2NFbG0ub2Zmc2V0V2lkdGgpIC0gMjtcblx0XHRcdFx0XHRzdGF0ZS5tYXhZID0gKGVkaXRvci5pbmxpbmUgPyBib2R5RWxtLnNjcm9sbEhlaWdodCA6IGRvY0VsbS5vZmZzZXRIZWlnaHQpIC0gMjtcblx0XHRcdFx0XHRzdGF0ZS5yZWxYID0gZS5wYWdlWCAtIGVsbVBvcy54O1xuXHRcdFx0XHRcdHN0YXRlLnJlbFkgPSBlLnBhZ2VZIC0gZWxtUG9zLnk7XG5cdFx0XHRcdFx0c3RhdGUud2lkdGggPSBjZUVsbS5vZmZzZXRXaWR0aDtcblx0XHRcdFx0XHRzdGF0ZS5oZWlnaHQgPSBjZUVsbS5vZmZzZXRIZWlnaHQ7XG5cdFx0XHRcdFx0c3RhdGUuZ2hvc3QgPSBjcmVhdGVHaG9zdChlZGl0b3IsIGNlRWxtLCBzdGF0ZS53aWR0aCwgc3RhdGUuaGVpZ2h0KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH07XG5cdH07XG5cblx0dmFyIG1vdmUgPSBmdW5jdGlvbiAoc3RhdGUsIGVkaXRvcikge1xuXHRcdC8vIFJlZHVjZXMgbGFnZ3kgZHJhZyBiZWhhdmlvciBvbiBHZWNrb1xuXHRcdHZhciB0aHJvdHRsZWRQbGFjZUNhcmV0QXQgPSBEZWxheS50aHJvdHRsZShmdW5jdGlvbiAoY2xpZW50WCwgY2xpZW50WSkge1xuXHRcdFx0ZWRpdG9yLl9zZWxlY3Rpb25PdmVycmlkZXMuaGlkZUZha2VDYXJldCgpO1xuXHRcdFx0ZWRpdG9yLnNlbGVjdGlvbi5wbGFjZUNhcmV0QXQoY2xpZW50WCwgY2xpZW50WSk7XG5cdFx0fSwgMCk7XG5cblx0XHRyZXR1cm4gZnVuY3Rpb24gKGUpIHtcblx0XHRcdHZhciBtb3ZlbWVudCA9IE1hdGgubWF4KE1hdGguYWJzKGUuc2NyZWVuWCAtIHN0YXRlLnNjcmVlblgpLCBNYXRoLmFicyhlLnNjcmVlblkgLSBzdGF0ZS5zY3JlZW5ZKSk7XG5cblx0XHRcdGlmIChoYXNEcmFnZ2FibGVFbGVtZW50KHN0YXRlKSAmJiAhc3RhdGUuZHJhZ2dpbmcgJiYgbW92ZW1lbnQgPiAxMCkge1xuXHRcdFx0XHR2YXIgYXJncyA9IGVkaXRvci5maXJlKCdkcmFnc3RhcnQnLCB7dGFyZ2V0OiBzdGF0ZS5lbGVtZW50fSk7XG5cdFx0XHRcdGlmIChhcmdzLmlzRGVmYXVsdFByZXZlbnRlZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0c3RhdGUuZHJhZ2dpbmcgPSB0cnVlO1xuXHRcdFx0XHRlZGl0b3IuZm9jdXMoKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHN0YXRlLmRyYWdnaW5nKSB7XG5cdFx0XHRcdHZhciB0YXJnZXRQb3MgPSBhcHBseVJlbFBvcyhzdGF0ZSwgTW91c2VQb3NpdGlvbi5jYWxjKGVkaXRvciwgZSkpO1xuXG5cdFx0XHRcdGFwcGVuZEdob3N0VG9Cb2R5KHN0YXRlLmdob3N0LCBlZGl0b3IuZ2V0Qm9keSgpKTtcblx0XHRcdFx0bW92ZUdob3N0KHN0YXRlLmdob3N0LCB0YXJnZXRQb3MsIHN0YXRlLndpZHRoLCBzdGF0ZS5oZWlnaHQsIHN0YXRlLm1heFgsIHN0YXRlLm1heFkpO1xuXG5cdFx0XHRcdHRocm90dGxlZFBsYWNlQ2FyZXRBdChlLmNsaWVudFgsIGUuY2xpZW50WSk7XG5cdFx0XHR9XG5cdFx0fTtcblx0fTtcblxuXHQvLyBSZXR1cm5zIHRoZSByYXcgZWxlbWVudCBpbnN0ZWFkIG9mIHRoZSBmYWtlIGNFPWZhbHNlIGVsZW1lbnRcblx0dmFyIGdldFJhd1RhcmdldCA9IGZ1bmN0aW9uIChzZWxlY3Rpb24pIHtcblx0XHR2YXIgcm5nID0gc2VsZWN0aW9uLmdldFNlbCgpLmdldFJhbmdlQXQoMCk7XG5cdFx0dmFyIHN0YXJ0Q29udGFpbmVyID0gcm5nLnN0YXJ0Q29udGFpbmVyO1xuXHRcdHJldHVybiBzdGFydENvbnRhaW5lci5ub2RlVHlwZSA9PT0gMyA/IHN0YXJ0Q29udGFpbmVyLnBhcmVudE5vZGUgOiBzdGFydENvbnRhaW5lcjtcblx0fTtcblxuXHR2YXIgZHJvcCA9IGZ1bmN0aW9uIChzdGF0ZSwgZWRpdG9yKSB7XG5cdFx0cmV0dXJuIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRpZiAoc3RhdGUuZHJhZ2dpbmcpIHtcblx0XHRcdFx0aWYgKGlzVmFsaWREcm9wVGFyZ2V0KGVkaXRvciwgZ2V0UmF3VGFyZ2V0KGVkaXRvci5zZWxlY3Rpb24pLCBzdGF0ZS5lbGVtZW50KSkge1xuXHRcdFx0XHRcdHZhciB0YXJnZXRDbG9uZSA9IGNsb25lRWxlbWVudChzdGF0ZS5lbGVtZW50KTtcblxuXHRcdFx0XHRcdHZhciBhcmdzID0gZWRpdG9yLmZpcmUoJ2Ryb3AnLCB7XG5cdFx0XHRcdFx0XHR0YXJnZXRDbG9uZTogdGFyZ2V0Q2xvbmUsXG5cdFx0XHRcdFx0XHRjbGllbnRYOiBlLmNsaWVudFgsXG5cdFx0XHRcdFx0XHRjbGllbnRZOiBlLmNsaWVudFlcblx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdGlmICghYXJncy5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkge1xuXHRcdFx0XHRcdFx0dGFyZ2V0Q2xvbmUgPSBhcmdzLnRhcmdldENsb25lO1xuXG5cdFx0XHRcdFx0XHRlZGl0b3IudW5kb01hbmFnZXIudHJhbnNhY3QoZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0XHRcdHJlbW92ZUVsZW1lbnQoc3RhdGUuZWxlbWVudCk7XG5cdFx0XHRcdFx0XHRcdGVkaXRvci5pbnNlcnRDb250ZW50KGVkaXRvci5kb20uZ2V0T3V0ZXJIVE1MKHRhcmdldENsb25lKSk7XG5cdFx0XHRcdFx0XHRcdGVkaXRvci5fc2VsZWN0aW9uT3ZlcnJpZGVzLmhpZGVGYWtlQ2FyZXQoKTtcblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRyZW1vdmVEcmFnU3RhdGUoc3RhdGUpO1xuXHRcdH07XG5cdH07XG5cblx0dmFyIHN0b3AgPSBmdW5jdGlvbiAoc3RhdGUsIGVkaXRvcikge1xuXHRcdHJldHVybiBmdW5jdGlvbiAoKSB7XG5cdFx0XHRyZW1vdmVEcmFnU3RhdGUoc3RhdGUpO1xuXHRcdFx0aWYgKHN0YXRlLmRyYWdnaW5nKSB7XG5cdFx0XHRcdGVkaXRvci5maXJlKCdkcmFnZW5kJyk7XG5cdFx0XHR9XG5cdFx0fTtcblx0fTtcblxuXHR2YXIgcmVtb3ZlRHJhZ1N0YXRlID0gZnVuY3Rpb24gKHN0YXRlKSB7XG5cdFx0c3RhdGUuZHJhZ2dpbmcgPSBmYWxzZTtcblx0XHRzdGF0ZS5lbGVtZW50ID0gbnVsbDtcblx0XHRyZW1vdmVFbGVtZW50KHN0YXRlLmdob3N0KTtcblx0fTtcblxuXHR2YXIgYmluZEZha2VEcmFnRXZlbnRzID0gZnVuY3Rpb24gKGVkaXRvcikge1xuXHRcdHZhciBzdGF0ZSA9IHt9LCBwYWdlRG9tLCBkcmFnU3RhcnRIYW5kbGVyLCBkcmFnSGFuZGxlciwgZHJvcEhhbmRsZXIsIGRyYWdFbmRIYW5kbGVyLCByb290RG9jdW1lbnQ7XG5cblx0XHRwYWdlRG9tID0gRE9NVXRpbHMuRE9NO1xuXHRcdHJvb3REb2N1bWVudCA9IGRvY3VtZW50O1xuXHRcdGRyYWdTdGFydEhhbmRsZXIgPSBzdGFydChzdGF0ZSwgZWRpdG9yKTtcblx0XHRkcmFnSGFuZGxlciA9IG1vdmUoc3RhdGUsIGVkaXRvcik7XG5cdFx0ZHJvcEhhbmRsZXIgPSBkcm9wKHN0YXRlLCBlZGl0b3IpO1xuXHRcdGRyYWdFbmRIYW5kbGVyID0gc3RvcChzdGF0ZSwgZWRpdG9yKTtcblxuXHRcdGVkaXRvci5vbignbW91c2Vkb3duJywgZHJhZ1N0YXJ0SGFuZGxlcik7XG5cdFx0ZWRpdG9yLm9uKCdtb3VzZW1vdmUnLCBkcmFnSGFuZGxlcik7XG5cdFx0ZWRpdG9yLm9uKCdtb3VzZXVwJywgZHJvcEhhbmRsZXIpO1xuXG5cdFx0cGFnZURvbS5iaW5kKHJvb3REb2N1bWVudCwgJ21vdXNlbW92ZScsIGRyYWdIYW5kbGVyKTtcblx0XHRwYWdlRG9tLmJpbmQocm9vdERvY3VtZW50LCAnbW91c2V1cCcsIGRyYWdFbmRIYW5kbGVyKTtcblxuXHRcdGVkaXRvci5vbigncmVtb3ZlJywgZnVuY3Rpb24gKCkge1xuXHRcdFx0cGFnZURvbS51bmJpbmQocm9vdERvY3VtZW50LCAnbW91c2Vtb3ZlJywgZHJhZ0hhbmRsZXIpO1xuXHRcdFx0cGFnZURvbS51bmJpbmQocm9vdERvY3VtZW50LCAnbW91c2V1cCcsIGRyYWdFbmRIYW5kbGVyKTtcblx0XHR9KTtcblx0fTtcblxuXHR2YXIgYmxvY2tJZURyb3AgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG5cdFx0ZWRpdG9yLm9uKCdkcm9wJywgZnVuY3Rpb24oZSkge1xuXHRcdFx0Ly8gRkYgZG9lc24ndCBwYXNzIG91dCBjbGllbnRYL2NsaWVudFkgZm9yIGRyb3Agc2luY2UgdGhpcyBpcyBmb3IgSUUgd2UganVzdCB1c2UgbnVsbCBpbnN0ZWFkXG5cdFx0XHR2YXIgcmVhbFRhcmdldCA9IHR5cGVvZiBlLmNsaWVudFggIT09ICd1bmRlZmluZWQnID8gZWRpdG9yLmdldERvYygpLmVsZW1lbnRGcm9tUG9pbnQoZS5jbGllbnRYLCBlLmNsaWVudFkpIDogbnVsbDtcblxuXHRcdFx0aWYgKGlzQ29udGVudEVkaXRhYmxlRmFsc2UocmVhbFRhcmdldCkgfHwgaXNDb250ZW50RWRpdGFibGVGYWxzZShlZGl0b3IuZG9tLmdldENvbnRlbnRFZGl0YWJsZVBhcmVudChyZWFsVGFyZ2V0KSkpIHtcblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9O1xuXG5cdHZhciBpbml0ID0gZnVuY3Rpb24gKGVkaXRvcikge1xuXHRcdGJpbmRGYWtlRHJhZ0V2ZW50cyhlZGl0b3IpO1xuXHRcdGJsb2NrSWVEcm9wKGVkaXRvcik7XG5cdH07XG5cblx0cmV0dXJuIHtcblx0XHRpbml0OiBpbml0XG5cdH07XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL1NlbGVjdGlvbk92ZXJyaWRlcy5qc1xuXG4vKipcbiAqIFNlbGVjdGlvbk92ZXJyaWRlcy5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE1IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKipcbiAqIFRoaXMgbW9kdWxlIGNvbnRhaW5zIGxvZ2ljIG92ZXJyaWRpbmcgdGhlIHNlbGVjdGlvbiB3aXRoIGtleWJvYXJkL21vdXNlXG4gKiBhcm91bmQgY29udGVudEVkaXRhYmxlPWZhbHNlIHJlZ2lvbnMuXG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIERpc2FibGUgdGhlIGRlZmF1bHQgY0U9ZmFsc2Ugc2VsZWN0aW9uXG4gKiB0aW55bWNlLmFjdGl2ZUVkaXRvci5vbignU2hvd0NhcmV0IEJlZm9yZU9iamVjdFNlbGVjdGVkJywgZnVuY3Rpb24oZSkge1xuICogICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAqIH0pO1xuICpcbiAqIEBwcml2YXRlXG4gKiBAY2xhc3MgdGlueW1jZS5TZWxlY3Rpb25PdmVycmlkZXNcbiAqL1xuZGVmaW5lKFwidGlueW1jZS9TZWxlY3Rpb25PdmVycmlkZXNcIiwgW1xuXHRcInRpbnltY2UvRW52XCIsXG5cdFwidGlueW1jZS9jYXJldC9DYXJldFdhbGtlclwiLFxuXHRcInRpbnltY2UvY2FyZXQvQ2FyZXRQb3NpdGlvblwiLFxuXHRcInRpbnltY2UvY2FyZXQvQ2FyZXRDb250YWluZXJcIixcblx0XCJ0aW55bWNlL2NhcmV0L0NhcmV0VXRpbHNcIixcblx0XCJ0aW55bWNlL2NhcmV0L0Zha2VDYXJldFwiLFxuXHRcInRpbnltY2UvY2FyZXQvTGluZVdhbGtlclwiLFxuXHRcInRpbnltY2UvY2FyZXQvTGluZVV0aWxzXCIsXG5cdFwidGlueW1jZS9kb20vTm9kZVR5cGVcIixcblx0XCJ0aW55bWNlL2RvbS9SYW5nZVV0aWxzXCIsXG5cdFwidGlueW1jZS9nZW9tL0NsaWVudFJlY3RcIixcblx0XCJ0aW55bWNlL3V0aWwvVktcIixcblx0XCJ0aW55bWNlL3V0aWwvRnVuXCIsXG5cdFwidGlueW1jZS91dGlsL0FyclwiLFxuXHRcInRpbnltY2UvdXRpbC9EZWxheVwiLFxuXHRcInRpbnltY2UvRHJhZ0Ryb3BPdmVycmlkZXNcIlxuXSwgZnVuY3Rpb24oXG5cdEVudiwgQ2FyZXRXYWxrZXIsIENhcmV0UG9zaXRpb24sIENhcmV0Q29udGFpbmVyLCBDYXJldFV0aWxzLCBGYWtlQ2FyZXQsIExpbmVXYWxrZXIsXG5cdExpbmVVdGlscywgTm9kZVR5cGUsIFJhbmdlVXRpbHMsIENsaWVudFJlY3QsIFZLLCBGdW4sIEFyciwgRGVsYXksIERyYWdEcm9wT3ZlcnJpZGVzXG4pIHtcblx0dmFyIGN1cnJ5ID0gRnVuLmN1cnJ5LFxuXHRcdGlzQ29udGVudEVkaXRhYmxlVHJ1ZSA9IE5vZGVUeXBlLmlzQ29udGVudEVkaXRhYmxlVHJ1ZSxcblx0XHRpc0NvbnRlbnRFZGl0YWJsZUZhbHNlID0gTm9kZVR5cGUuaXNDb250ZW50RWRpdGFibGVGYWxzZSxcblx0XHRpc0VsZW1lbnQgPSBOb2RlVHlwZS5pc0VsZW1lbnQsXG5cdFx0aXNBZnRlckNvbnRlbnRFZGl0YWJsZUZhbHNlID0gQ2FyZXRVdGlscy5pc0FmdGVyQ29udGVudEVkaXRhYmxlRmFsc2UsXG5cdFx0aXNCZWZvcmVDb250ZW50RWRpdGFibGVGYWxzZSA9IENhcmV0VXRpbHMuaXNCZWZvcmVDb250ZW50RWRpdGFibGVGYWxzZSxcblx0XHRnZXRTZWxlY3RlZE5vZGUgPSBSYW5nZVV0aWxzLmdldFNlbGVjdGVkTm9kZTtcblxuXHRmdW5jdGlvbiBnZXRWaXN1YWxDYXJldFBvc2l0aW9uKHdhbGtGbiwgY2FyZXRQb3NpdGlvbikge1xuXHRcdHdoaWxlICgoY2FyZXRQb3NpdGlvbiA9IHdhbGtGbihjYXJldFBvc2l0aW9uKSkpIHtcblx0XHRcdGlmIChjYXJldFBvc2l0aW9uLmlzVmlzaWJsZSgpKSB7XG5cdFx0XHRcdHJldHVybiBjYXJldFBvc2l0aW9uO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiBjYXJldFBvc2l0aW9uO1xuXHR9XG5cblx0ZnVuY3Rpb24gU2VsZWN0aW9uT3ZlcnJpZGVzKGVkaXRvcikge1xuXHRcdHZhciByb290Tm9kZSA9IGVkaXRvci5nZXRCb2R5KCksIGNhcmV0V2Fsa2VyID0gbmV3IENhcmV0V2Fsa2VyKHJvb3ROb2RlKTtcblx0XHR2YXIgZ2V0TmV4dFZpc3VhbENhcmV0UG9zaXRpb24gPSBjdXJyeShnZXRWaXN1YWxDYXJldFBvc2l0aW9uLCBjYXJldFdhbGtlci5uZXh0KTtcblx0XHR2YXIgZ2V0UHJldlZpc3VhbENhcmV0UG9zaXRpb24gPSBjdXJyeShnZXRWaXN1YWxDYXJldFBvc2l0aW9uLCBjYXJldFdhbGtlci5wcmV2KSxcblx0XHRcdGZha2VDYXJldCA9IG5ldyBGYWtlQ2FyZXQoZWRpdG9yLmdldEJvZHkoKSwgaXNCbG9jayksXG5cdFx0XHRyZWFsU2VsZWN0aW9uSWQgPSAnc2VsLScgKyBlZGl0b3IuZG9tLnVuaXF1ZUlkKCksXG5cdFx0XHRzZWxlY3RlZENvbnRlbnRFZGl0YWJsZU5vZGUsICQgPSBlZGl0b3IuJDtcblxuXHRcdGZ1bmN0aW9uIGlzRmFrZVNlbGVjdGlvbkVsZW1lbnQoZWxtKSB7XG5cdFx0XHRyZXR1cm4gZWRpdG9yLmRvbS5oYXNDbGFzcyhlbG0sICdtY2Utb2Zmc2NyZWVuLXNlbGVjdGlvbicpO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIGdldFJlYWxTZWxlY3Rpb25FbGVtZW50KCkge1xuXHRcdFx0dmFyIGNvbnRhaW5lciA9IGVkaXRvci5kb20uZ2V0KHJlYWxTZWxlY3Rpb25JZCk7XG5cdFx0XHRyZXR1cm4gY29udGFpbmVyID8gY29udGFpbmVyLmdldEVsZW1lbnRzQnlUYWdOYW1lKCcqJylbMF0gOiBjb250YWluZXI7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gaXNCbG9jayhub2RlKSB7XG5cdFx0XHRyZXR1cm4gZWRpdG9yLmRvbS5pc0Jsb2NrKG5vZGUpO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIHNldFJhbmdlKHJhbmdlKSB7XG5cdFx0XHQvL2NvbnNvbGUubG9nKCdzZXRSYW5nZScsIHJhbmdlKTtcblx0XHRcdGlmIChyYW5nZSkge1xuXHRcdFx0XHRlZGl0b3Iuc2VsZWN0aW9uLnNldFJuZyhyYW5nZSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gZ2V0UmFuZ2UoKSB7XG5cdFx0XHRyZXR1cm4gZWRpdG9yLnNlbGVjdGlvbi5nZXRSbmcoKTtcblx0XHR9XG5cblx0XHRmdW5jdGlvbiBzY3JvbGxJbnRvVmlldyhub2RlLCBhbGlnblRvVG9wKSB7XG5cdFx0XHRlZGl0b3Iuc2VsZWN0aW9uLnNjcm9sbEludG9WaWV3KG5vZGUsIGFsaWduVG9Ub3ApO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIHNob3dDYXJldChkaXJlY3Rpb24sIG5vZGUsIGJlZm9yZSkge1xuXHRcdFx0dmFyIGU7XG5cblx0XHRcdGUgPSBlZGl0b3IuZmlyZSgnU2hvd0NhcmV0Jywge1xuXHRcdFx0XHR0YXJnZXQ6IG5vZGUsXG5cdFx0XHRcdGRpcmVjdGlvbjogZGlyZWN0aW9uLFxuXHRcdFx0XHRiZWZvcmU6IGJlZm9yZVxuXHRcdFx0fSk7XG5cblx0XHRcdGlmIChlLmlzRGVmYXVsdFByZXZlbnRlZCgpKSB7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXG5cdFx0XHRzY3JvbGxJbnRvVmlldyhub2RlLCBkaXJlY3Rpb24gPT09IC0xKTtcblxuXHRcdFx0cmV0dXJuIGZha2VDYXJldC5zaG93KGJlZm9yZSwgbm9kZSk7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gc2VsZWN0Tm9kZShub2RlKSB7XG5cdFx0XHR2YXIgZTtcblxuXHRcdFx0ZSA9IGVkaXRvci5maXJlKCdCZWZvcmVPYmplY3RTZWxlY3RlZCcsIHt0YXJnZXQ6IG5vZGV9KTtcblx0XHRcdGlmIChlLmlzRGVmYXVsdFByZXZlbnRlZCgpKSB7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gZ2V0Tm9kZVJhbmdlKG5vZGUpO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIGdldE5vZGVSYW5nZShub2RlKSB7XG5cdFx0XHR2YXIgcm5nID0gbm9kZS5vd25lckRvY3VtZW50LmNyZWF0ZVJhbmdlKCk7XG5cblx0XHRcdHJuZy5zZWxlY3ROb2RlKG5vZGUpO1xuXG5cdFx0XHRyZXR1cm4gcm5nO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIGlzTW92ZUluc2lkZVNhbWVCbG9jayhmcm9tQ2FyZXRQb3NpdGlvbiwgdG9DYXJldFBvc2l0aW9uKSB7XG5cdFx0XHR2YXIgaW5TYW1lQmxvY2sgPSBDYXJldFV0aWxzLmlzSW5TYW1lQmxvY2soZnJvbUNhcmV0UG9zaXRpb24sIHRvQ2FyZXRQb3NpdGlvbik7XG5cblx0XHRcdC8vIEhhbmRsZSBib2d1cyBCUiA8cD5hYmN8PGJyPjwvcD5cblx0XHRcdGlmICghaW5TYW1lQmxvY2sgJiYgTm9kZVR5cGUuaXNCcihmcm9tQ2FyZXRQb3NpdGlvbi5nZXROb2RlKCkpKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gaW5TYW1lQmxvY2s7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gZ2V0Tm9ybWFsaXplZFJhbmdlRW5kUG9pbnQoZGlyZWN0aW9uLCByYW5nZSkge1xuXHRcdFx0cmFuZ2UgPSBDYXJldFV0aWxzLm5vcm1hbGl6ZVJhbmdlKGRpcmVjdGlvbiwgcm9vdE5vZGUsIHJhbmdlKTtcblxuXHRcdFx0aWYgKGRpcmVjdGlvbiA9PSAtMSkge1xuXHRcdFx0XHRyZXR1cm4gQ2FyZXRQb3NpdGlvbi5mcm9tUmFuZ2VTdGFydChyYW5nZSk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBDYXJldFBvc2l0aW9uLmZyb21SYW5nZUVuZChyYW5nZSk7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gaXNSYW5nZUluQ2FyZXRDb250YWluZXJCbG9jayhyYW5nZSkge1xuXHRcdFx0cmV0dXJuIENhcmV0Q29udGFpbmVyLmlzQ2FyZXRDb250YWluZXJCbG9jayhyYW5nZS5zdGFydENvbnRhaW5lcik7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gbW92ZVRvQ2VGYWxzZUhvcml6b250YWxseShkaXJlY3Rpb24sIGdldE5leHRQb3NGbiwgaXNCZWZvcmVDb250ZW50RWRpdGFibGVGYWxzZUZuLCByYW5nZSkge1xuXHRcdFx0dmFyIG5vZGUsIGNhcmV0UG9zaXRpb24sIHBlZWtDYXJldFBvc2l0aW9uLCByYW5nZUlzSW5Db250YWluZXJCbG9jaztcblxuXHRcdFx0aWYgKCFyYW5nZS5jb2xsYXBzZWQpIHtcblx0XHRcdFx0bm9kZSA9IGdldFNlbGVjdGVkTm9kZShyYW5nZSk7XG5cdFx0XHRcdGlmIChpc0NvbnRlbnRFZGl0YWJsZUZhbHNlKG5vZGUpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHNob3dDYXJldChkaXJlY3Rpb24sIG5vZGUsIGRpcmVjdGlvbiA9PSAtMSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0cmFuZ2VJc0luQ29udGFpbmVyQmxvY2sgPSBpc1JhbmdlSW5DYXJldENvbnRhaW5lckJsb2NrKHJhbmdlKTtcblx0XHRcdGNhcmV0UG9zaXRpb24gPSBnZXROb3JtYWxpemVkUmFuZ2VFbmRQb2ludChkaXJlY3Rpb24sIHJhbmdlKTtcblxuXHRcdFx0aWYgKGlzQmVmb3JlQ29udGVudEVkaXRhYmxlRmFsc2VGbihjYXJldFBvc2l0aW9uKSkge1xuXHRcdFx0XHRyZXR1cm4gc2VsZWN0Tm9kZShjYXJldFBvc2l0aW9uLmdldE5vZGUoZGlyZWN0aW9uID09IC0xKSk7XG5cdFx0XHR9XG5cblx0XHRcdGNhcmV0UG9zaXRpb24gPSBnZXROZXh0UG9zRm4oY2FyZXRQb3NpdGlvbik7XG5cdFx0XHRpZiAoIWNhcmV0UG9zaXRpb24pIHtcblx0XHRcdFx0aWYgKHJhbmdlSXNJbkNvbnRhaW5lckJsb2NrKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHJhbmdlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChpc0JlZm9yZUNvbnRlbnRFZGl0YWJsZUZhbHNlRm4oY2FyZXRQb3NpdGlvbikpIHtcblx0XHRcdFx0cmV0dXJuIHNob3dDYXJldChkaXJlY3Rpb24sIGNhcmV0UG9zaXRpb24uZ2V0Tm9kZShkaXJlY3Rpb24gPT0gLTEpLCBkaXJlY3Rpb24gPT0gMSk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIFBlZWsgYWhlYWQgZm9yIGhhbmRsaW5nIG9mIGFifGM8c3BhbiBjRT1mYWxzZT4gLT4gYWJjfDxzcGFuIGNFPWZhbHNlPlxuXHRcdFx0cGVla0NhcmV0UG9zaXRpb24gPSBnZXROZXh0UG9zRm4oY2FyZXRQb3NpdGlvbik7XG5cdFx0XHRpZiAoaXNCZWZvcmVDb250ZW50RWRpdGFibGVGYWxzZUZuKHBlZWtDYXJldFBvc2l0aW9uKSkge1xuXHRcdFx0XHRpZiAoaXNNb3ZlSW5zaWRlU2FtZUJsb2NrKGNhcmV0UG9zaXRpb24sIHBlZWtDYXJldFBvc2l0aW9uKSkge1xuXHRcdFx0XHRcdHJldHVybiBzaG93Q2FyZXQoZGlyZWN0aW9uLCBwZWVrQ2FyZXRQb3NpdGlvbi5nZXROb2RlKGRpcmVjdGlvbiA9PSAtMSksIGRpcmVjdGlvbiA9PSAxKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAocmFuZ2VJc0luQ29udGFpbmVyQmxvY2spIHtcblx0XHRcdFx0cmV0dXJuIHJlbmRlclJhbmdlQ2FyZXQoY2FyZXRQb3NpdGlvbi50b1JhbmdlKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cblx0XHRmdW5jdGlvbiBtb3ZlVG9DZUZhbHNlVmVydGljYWxseShkaXJlY3Rpb24sIHdhbGtlckZuLCByYW5nZSkge1xuXHRcdFx0dmFyIGNhcmV0UG9zaXRpb24sIGxpbmVQb3NpdGlvbnMsIG5leHRMaW5lUG9zaXRpb25zLFxuXHRcdFx0XHRjbG9zZXN0TmV4dExpbmVSZWN0LCBjYXJldENsaWVudFJlY3QsIGNsaWVudFgsXG5cdFx0XHRcdGRpc3QxLCBkaXN0MiwgY29udGVudEVkaXRhYmxlRmFsc2VOb2RlO1xuXG5cdFx0XHRjb250ZW50RWRpdGFibGVGYWxzZU5vZGUgPSBnZXRTZWxlY3RlZE5vZGUocmFuZ2UpO1xuXHRcdFx0Y2FyZXRQb3NpdGlvbiA9IGdldE5vcm1hbGl6ZWRSYW5nZUVuZFBvaW50KGRpcmVjdGlvbiwgcmFuZ2UpO1xuXHRcdFx0bGluZVBvc2l0aW9ucyA9IHdhbGtlckZuKHJvb3ROb2RlLCBMaW5lV2Fsa2VyLmlzQWJvdmVMaW5lKDEpLCBjYXJldFBvc2l0aW9uKTtcblx0XHRcdG5leHRMaW5lUG9zaXRpb25zID0gQXJyLmZpbHRlcihsaW5lUG9zaXRpb25zLCBMaW5lV2Fsa2VyLmlzTGluZSgxKSk7XG5cdFx0XHRjYXJldENsaWVudFJlY3QgPSBBcnIubGFzdChjYXJldFBvc2l0aW9uLmdldENsaWVudFJlY3RzKCkpO1xuXG5cdFx0XHRpZiAoaXNCZWZvcmVDb250ZW50RWRpdGFibGVGYWxzZShjYXJldFBvc2l0aW9uKSkge1xuXHRcdFx0XHRjb250ZW50RWRpdGFibGVGYWxzZU5vZGUgPSBjYXJldFBvc2l0aW9uLmdldE5vZGUoKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGlzQWZ0ZXJDb250ZW50RWRpdGFibGVGYWxzZShjYXJldFBvc2l0aW9uKSkge1xuXHRcdFx0XHRjb250ZW50RWRpdGFibGVGYWxzZU5vZGUgPSBjYXJldFBvc2l0aW9uLmdldE5vZGUodHJ1ZSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmICghY2FyZXRDbGllbnRSZWN0KSB7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXG5cdFx0XHRjbGllbnRYID0gY2FyZXRDbGllbnRSZWN0LmxlZnQ7XG5cblx0XHRcdGNsb3Nlc3ROZXh0TGluZVJlY3QgPSBMaW5lVXRpbHMuZmluZENsb3Nlc3RDbGllbnRSZWN0KG5leHRMaW5lUG9zaXRpb25zLCBjbGllbnRYKTtcblx0XHRcdGlmIChjbG9zZXN0TmV4dExpbmVSZWN0KSB7XG5cdFx0XHRcdGlmIChpc0NvbnRlbnRFZGl0YWJsZUZhbHNlKGNsb3Nlc3ROZXh0TGluZVJlY3Qubm9kZSkpIHtcblx0XHRcdFx0XHRkaXN0MSA9IE1hdGguYWJzKGNsaWVudFggLSBjbG9zZXN0TmV4dExpbmVSZWN0LmxlZnQpO1xuXHRcdFx0XHRcdGRpc3QyID0gTWF0aC5hYnMoY2xpZW50WCAtIGNsb3Nlc3ROZXh0TGluZVJlY3QucmlnaHQpO1xuXG5cdFx0XHRcdFx0cmV0dXJuIHNob3dDYXJldChkaXJlY3Rpb24sIGNsb3Nlc3ROZXh0TGluZVJlY3Qubm9kZSwgZGlzdDEgPCBkaXN0Mik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKGNvbnRlbnRFZGl0YWJsZUZhbHNlTm9kZSkge1xuXHRcdFx0XHR2YXIgY2FyZXRQb3NpdGlvbnMgPSBMaW5lV2Fsa2VyLnBvc2l0aW9uc1VudGlsKGRpcmVjdGlvbiwgcm9vdE5vZGUsIExpbmVXYWxrZXIuaXNBYm92ZUxpbmUoMSksIGNvbnRlbnRFZGl0YWJsZUZhbHNlTm9kZSk7XG5cblx0XHRcdFx0Y2xvc2VzdE5leHRMaW5lUmVjdCA9IExpbmVVdGlscy5maW5kQ2xvc2VzdENsaWVudFJlY3QoQXJyLmZpbHRlcihjYXJldFBvc2l0aW9ucywgTGluZVdhbGtlci5pc0xpbmUoMSkpLCBjbGllbnRYKTtcblx0XHRcdFx0aWYgKGNsb3Nlc3ROZXh0TGluZVJlY3QpIHtcblx0XHRcdFx0XHRyZXR1cm4gcmVuZGVyUmFuZ2VDYXJldChjbG9zZXN0TmV4dExpbmVSZWN0LnBvc2l0aW9uLnRvUmFuZ2UoKSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRjbG9zZXN0TmV4dExpbmVSZWN0ID0gQXJyLmxhc3QoQXJyLmZpbHRlcihjYXJldFBvc2l0aW9ucywgTGluZVdhbGtlci5pc0xpbmUoMCkpKTtcblx0XHRcdFx0aWYgKGNsb3Nlc3ROZXh0TGluZVJlY3QpIHtcblx0XHRcdFx0XHRyZXR1cm4gcmVuZGVyUmFuZ2VDYXJldChjbG9zZXN0TmV4dExpbmVSZWN0LnBvc2l0aW9uLnRvUmFuZ2UoKSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRmdW5jdGlvbiBleGl0UHJlQmxvY2soZGlyZWN0aW9uLCByYW5nZSkge1xuXHRcdFx0dmFyIHByZSwgY2FyZXRQb3MsIG5ld0Jsb2NrO1xuXG5cdFx0XHRmdW5jdGlvbiBjcmVhdGVUZXh0QmxvY2soKSB7XG5cdFx0XHRcdHZhciB0ZXh0QmxvY2sgPSBlZGl0b3IuZG9tLmNyZWF0ZShlZGl0b3Iuc2V0dGluZ3MuZm9yY2VkX3Jvb3RfYmxvY2spO1xuXG5cdFx0XHRcdGlmICghRW52LmllIHx8IEVudi5pZSA+PSAxMSkge1xuXHRcdFx0XHRcdHRleHRCbG9jay5pbm5lckhUTUwgPSAnPGJyIGRhdGEtbWNlLWJvZ3VzPVwiMVwiPic7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gdGV4dEJsb2NrO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAocmFuZ2UuY29sbGFwc2VkICYmIGVkaXRvci5zZXR0aW5ncy5mb3JjZWRfcm9vdF9ibG9jaykge1xuXHRcdFx0XHRwcmUgPSBlZGl0b3IuZG9tLmdldFBhcmVudChyYW5nZS5zdGFydENvbnRhaW5lciwgJ1BSRScpO1xuXHRcdFx0XHRpZiAoIXByZSkge1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChkaXJlY3Rpb24gPT0gMSkge1xuXHRcdFx0XHRcdGNhcmV0UG9zID0gZ2V0TmV4dFZpc3VhbENhcmV0UG9zaXRpb24oQ2FyZXRQb3NpdGlvbi5mcm9tUmFuZ2VTdGFydChyYW5nZSkpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNhcmV0UG9zID0gZ2V0UHJldlZpc3VhbENhcmV0UG9zaXRpb24oQ2FyZXRQb3NpdGlvbi5mcm9tUmFuZ2VTdGFydChyYW5nZSkpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKCFjYXJldFBvcykge1xuXHRcdFx0XHRcdG5ld0Jsb2NrID0gY3JlYXRlVGV4dEJsb2NrKCk7XG5cblx0XHRcdFx0XHRpZiAoZGlyZWN0aW9uID09IDEpIHtcblx0XHRcdFx0XHRcdGVkaXRvci4kKHByZSkuYWZ0ZXIobmV3QmxvY2spO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRlZGl0b3IuJChwcmUpLmJlZm9yZShuZXdCbG9jayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0ZWRpdG9yLnNlbGVjdGlvbi5zZWxlY3QobmV3QmxvY2ssIHRydWUpO1xuXHRcdFx0XHRcdGVkaXRvci5zZWxlY3Rpb24uY29sbGFwc2UoKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIG1vdmVIKGRpcmVjdGlvbiwgZ2V0TmV4dFBvc0ZuLCBpc0JlZm9yZUNvbnRlbnRFZGl0YWJsZUZhbHNlRm4sIHJhbmdlKSB7XG5cdFx0XHR2YXIgbmV3UmFuZ2U7XG5cblx0XHRcdG5ld1JhbmdlID0gbW92ZVRvQ2VGYWxzZUhvcml6b250YWxseShkaXJlY3Rpb24sIGdldE5leHRQb3NGbiwgaXNCZWZvcmVDb250ZW50RWRpdGFibGVGYWxzZUZuLCByYW5nZSk7XG5cdFx0XHRpZiAobmV3UmFuZ2UpIHtcblx0XHRcdFx0cmV0dXJuIG5ld1JhbmdlO1xuXHRcdFx0fVxuXG5cdFx0XHRuZXdSYW5nZSA9IGV4aXRQcmVCbG9jayhkaXJlY3Rpb24sIHJhbmdlKTtcblx0XHRcdGlmIChuZXdSYW5nZSkge1xuXHRcdFx0XHRyZXR1cm4gbmV3UmFuZ2U7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIG1vdmVWKGRpcmVjdGlvbiwgd2Fsa2VyRm4sIHJhbmdlKSB7XG5cdFx0XHR2YXIgbmV3UmFuZ2U7XG5cblx0XHRcdG5ld1JhbmdlID0gbW92ZVRvQ2VGYWxzZVZlcnRpY2FsbHkoZGlyZWN0aW9uLCB3YWxrZXJGbiwgcmFuZ2UpO1xuXHRcdFx0aWYgKG5ld1JhbmdlKSB7XG5cdFx0XHRcdHJldHVybiBuZXdSYW5nZTtcblx0XHRcdH1cblxuXHRcdFx0bmV3UmFuZ2UgPSBleGl0UHJlQmxvY2soZGlyZWN0aW9uLCByYW5nZSk7XG5cdFx0XHRpZiAobmV3UmFuZ2UpIHtcblx0XHRcdFx0cmV0dXJuIG5ld1JhbmdlO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cblx0XHRmdW5jdGlvbiBnZXRCbG9ja0NhcmV0Q29udGFpbmVyKCkge1xuXHRcdFx0cmV0dXJuICQoJypbZGF0YS1tY2UtY2FyZXRdJylbMF07XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gc2hvd0Jsb2NrQ2FyZXRDb250YWluZXIoYmxvY2tDYXJldENvbnRhaW5lcikge1xuXHRcdFx0aWYgKGJsb2NrQ2FyZXRDb250YWluZXIuaGFzQXR0cmlidXRlKCdkYXRhLW1jZS1jYXJldCcpKSB7XG5cdFx0XHRcdENhcmV0Q29udGFpbmVyLnNob3dDYXJldENvbnRhaW5lckJsb2NrKGJsb2NrQ2FyZXRDb250YWluZXIpO1xuXHRcdFx0XHRzZXRSYW5nZShnZXRSYW5nZSgpKTsgLy8gUmVtb3ZlcyBjb250cm9sIHJlY3Qgb24gSUVcblx0XHRcdFx0c2Nyb2xsSW50b1ZpZXcoYmxvY2tDYXJldENvbnRhaW5lclswXSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gcmVuZGVyQ2FyZXRBdFJhbmdlKHJhbmdlKSB7XG5cdFx0XHR2YXIgY2FyZXRQb3NpdGlvbiwgY2VSb290O1xuXG5cdFx0XHRyYW5nZSA9IENhcmV0VXRpbHMubm9ybWFsaXplUmFuZ2UoMSwgcm9vdE5vZGUsIHJhbmdlKTtcblx0XHRcdGNhcmV0UG9zaXRpb24gPSBDYXJldFBvc2l0aW9uLmZyb21SYW5nZVN0YXJ0KHJhbmdlKTtcblxuXHRcdFx0aWYgKGlzQ29udGVudEVkaXRhYmxlRmFsc2UoY2FyZXRQb3NpdGlvbi5nZXROb2RlKCkpKSB7XG5cdFx0XHRcdHJldHVybiBzaG93Q2FyZXQoMSwgY2FyZXRQb3NpdGlvbi5nZXROb2RlKCksICFjYXJldFBvc2l0aW9uLmlzQXRFbmQoKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChpc0NvbnRlbnRFZGl0YWJsZUZhbHNlKGNhcmV0UG9zaXRpb24uZ2V0Tm9kZSh0cnVlKSkpIHtcblx0XHRcdFx0cmV0dXJuIHNob3dDYXJldCgxLCBjYXJldFBvc2l0aW9uLmdldE5vZGUodHJ1ZSksIGZhbHNlKTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gVE9ETzogU2hvdWxkIHJlbmRlciBjYXJldCBiZWZvcmUvYWZ0ZXIgZGVwZW5kaW5nIG9uIHdoZXJlIHlvdSBjbGljayBvbiB0aGUgcGFnZSBmb3JjZXMgYWZ0ZXIgbm93XG5cdFx0XHRjZVJvb3QgPSBlZGl0b3IuZG9tLmdldFBhcmVudChjYXJldFBvc2l0aW9uLmdldE5vZGUoKSwgRnVuLm9yKGlzQ29udGVudEVkaXRhYmxlRmFsc2UsIGlzQ29udGVudEVkaXRhYmxlVHJ1ZSkpO1xuXHRcdFx0aWYgKGlzQ29udGVudEVkaXRhYmxlRmFsc2UoY2VSb290KSkge1xuXHRcdFx0XHRyZXR1cm4gc2hvd0NhcmV0KDEsIGNlUm9vdCwgZmFsc2UpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cblx0XHRmdW5jdGlvbiByZW5kZXJSYW5nZUNhcmV0KHJhbmdlKSB7XG5cdFx0XHR2YXIgY2FyZXRSYW5nZTtcblxuXHRcdFx0aWYgKCFyYW5nZSB8fCAhcmFuZ2UuY29sbGFwc2VkKSB7XG5cdFx0XHRcdHJldHVybiByYW5nZTtcblx0XHRcdH1cblxuXHRcdFx0Y2FyZXRSYW5nZSA9IHJlbmRlckNhcmV0QXRSYW5nZShyYW5nZSk7XG5cdFx0XHRpZiAoY2FyZXRSYW5nZSkge1xuXHRcdFx0XHRyZXR1cm4gY2FyZXRSYW5nZTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHJhbmdlO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIGRlbGV0ZUNvbnRlbnRFZGl0YWJsZU5vZGUobm9kZSkge1xuXHRcdFx0dmFyIG5leHRDYXJldFBvc2l0aW9uLCBwcmV2Q2FyZXRQb3NpdGlvbiwgcHJldkNlRmFsc2VFbG0sIG5leHRFbGVtZW50O1xuXG5cdFx0XHRpZiAoIWlzQ29udGVudEVkaXRhYmxlRmFsc2Uobm9kZSkpIHtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChpc0NvbnRlbnRFZGl0YWJsZUZhbHNlKG5vZGUucHJldmlvdXNTaWJsaW5nKSkge1xuXHRcdFx0XHRwcmV2Q2VGYWxzZUVsbSA9IG5vZGUucHJldmlvdXNTaWJsaW5nO1xuXHRcdFx0fVxuXG5cdFx0XHRwcmV2Q2FyZXRQb3NpdGlvbiA9IGdldFByZXZWaXN1YWxDYXJldFBvc2l0aW9uKENhcmV0UG9zaXRpb24uYmVmb3JlKG5vZGUpKTtcblx0XHRcdGlmICghcHJldkNhcmV0UG9zaXRpb24pIHtcblx0XHRcdFx0bmV4dENhcmV0UG9zaXRpb24gPSBnZXROZXh0VmlzdWFsQ2FyZXRQb3NpdGlvbihDYXJldFBvc2l0aW9uLmFmdGVyKG5vZGUpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKG5leHRDYXJldFBvc2l0aW9uICYmIGlzRWxlbWVudChuZXh0Q2FyZXRQb3NpdGlvbi5nZXROb2RlKCkpKSB7XG5cdFx0XHRcdG5leHRFbGVtZW50ID0gbmV4dENhcmV0UG9zaXRpb24uZ2V0Tm9kZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRDYXJldENvbnRhaW5lci5yZW1vdmUobm9kZS5wcmV2aW91c1NpYmxpbmcpO1xuXHRcdFx0Q2FyZXRDb250YWluZXIucmVtb3ZlKG5vZGUubmV4dFNpYmxpbmcpO1xuXHRcdFx0ZWRpdG9yLmRvbS5yZW1vdmUobm9kZSk7XG5cblx0XHRcdGlmIChlZGl0b3IuZG9tLmlzRW1wdHkoZWRpdG9yLmdldEJvZHkoKSkpIHtcblx0XHRcdFx0ZWRpdG9yLnNldENvbnRlbnQoJycpO1xuXHRcdFx0XHRlZGl0b3IuZm9jdXMoKTtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAocHJldkNlRmFsc2VFbG0pIHtcblx0XHRcdFx0cmV0dXJuIENhcmV0UG9zaXRpb24uYWZ0ZXIocHJldkNlRmFsc2VFbG0pLnRvUmFuZ2UoKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKG5leHRFbGVtZW50KSB7XG5cdFx0XHRcdHJldHVybiBDYXJldFBvc2l0aW9uLmJlZm9yZShuZXh0RWxlbWVudCkudG9SYW5nZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAocHJldkNhcmV0UG9zaXRpb24pIHtcblx0XHRcdFx0cmV0dXJuIHByZXZDYXJldFBvc2l0aW9uLnRvUmFuZ2UoKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKG5leHRDYXJldFBvc2l0aW9uKSB7XG5cdFx0XHRcdHJldHVybiBuZXh0Q2FyZXRQb3NpdGlvbi50b1JhbmdlKCk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIGlzVGV4dEJsb2NrKG5vZGUpIHtcblx0XHRcdHZhciB0ZXh0QmxvY2tzID0gZWRpdG9yLnNjaGVtYS5nZXRUZXh0QmxvY2tFbGVtZW50cygpO1xuXHRcdFx0cmV0dXJuIG5vZGUubm9kZU5hbWUgaW4gdGV4dEJsb2Nrcztcblx0XHR9XG5cblx0XHRmdW5jdGlvbiBpc0VtcHR5KGVsbSkge1xuXHRcdFx0cmV0dXJuIGVkaXRvci5kb20uaXNFbXB0eShlbG0pO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIG1lcmdlVGV4dEJsb2NrcyhkaXJlY3Rpb24sIGZyb21DYXJldFBvc2l0aW9uLCB0b0NhcmV0UG9zaXRpb24pIHtcblx0XHRcdHZhciBkb20gPSBlZGl0b3IuZG9tLCBmcm9tQmxvY2ssIHRvQmxvY2ssIG5vZGUsIGNlVGFyZ2V0O1xuXG5cdFx0XHRmcm9tQmxvY2sgPSBkb20uZ2V0UGFyZW50KGZyb21DYXJldFBvc2l0aW9uLmdldE5vZGUoKSwgZG9tLmlzQmxvY2spO1xuXHRcdFx0dG9CbG9jayA9IGRvbS5nZXRQYXJlbnQodG9DYXJldFBvc2l0aW9uLmdldE5vZGUoKSwgZG9tLmlzQmxvY2spO1xuXG5cdFx0XHRpZiAoZGlyZWN0aW9uID09PSAtMSkge1xuXHRcdFx0XHRjZVRhcmdldCA9IHRvQ2FyZXRQb3NpdGlvbi5nZXROb2RlKHRydWUpO1xuXHRcdFx0XHRpZiAoaXNBZnRlckNvbnRlbnRFZGl0YWJsZUZhbHNlKHRvQ2FyZXRQb3NpdGlvbikgJiYgaXNCbG9jayhjZVRhcmdldCkpIHtcblx0XHRcdFx0XHRpZiAoaXNUZXh0QmxvY2soZnJvbUJsb2NrKSkge1xuXHRcdFx0XHRcdFx0aWYgKGlzRW1wdHkoZnJvbUJsb2NrKSkge1xuXHRcdFx0XHRcdFx0XHRkb20ucmVtb3ZlKGZyb21CbG9jayk7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBDYXJldFBvc2l0aW9uLmFmdGVyKGNlVGFyZ2V0KS50b1JhbmdlKCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIGRlbGV0ZUNvbnRlbnRFZGl0YWJsZU5vZGUodG9DYXJldFBvc2l0aW9uLmdldE5vZGUodHJ1ZSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjZVRhcmdldCA9IGZyb21DYXJldFBvc2l0aW9uLmdldE5vZGUoKTtcblx0XHRcdFx0aWYgKGlzQmVmb3JlQ29udGVudEVkaXRhYmxlRmFsc2UoZnJvbUNhcmV0UG9zaXRpb24pICYmIGlzQmxvY2soY2VUYXJnZXQpKSB7XG5cdFx0XHRcdFx0aWYgKGlzVGV4dEJsb2NrKHRvQmxvY2spKSB7XG5cdFx0XHRcdFx0XHRpZiAoaXNFbXB0eSh0b0Jsb2NrKSkge1xuXHRcdFx0XHRcdFx0XHRkb20ucmVtb3ZlKHRvQmxvY2spO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gQ2FyZXRQb3NpdGlvbi5iZWZvcmUoY2VUYXJnZXQpLnRvUmFuZ2UoKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gZGVsZXRlQ29udGVudEVkaXRhYmxlTm9kZShmcm9tQ2FyZXRQb3NpdGlvbi5nZXROb2RlKCkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdC8vIFZlcmlmeSB0aGF0IGJvdGggYmxvY2tzIGFyZSB0ZXh0IGJsb2Nrc1xuXHRcdFx0aWYgKGZyb21CbG9jayA9PT0gdG9CbG9jayB8fCAhaXNUZXh0QmxvY2soZnJvbUJsb2NrKSB8fCAhaXNUZXh0QmxvY2sodG9CbG9jaykpIHtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cblx0XHRcdHdoaWxlICgobm9kZSA9IGZyb21CbG9jay5maXJzdENoaWxkKSkge1xuXHRcdFx0XHR0b0Jsb2NrLmFwcGVuZENoaWxkKG5vZGUpO1xuXHRcdFx0fVxuXG5cdFx0XHRlZGl0b3IuZG9tLnJlbW92ZShmcm9tQmxvY2spO1xuXG5cdFx0XHRyZXR1cm4gdG9DYXJldFBvc2l0aW9uLnRvUmFuZ2UoKTtcblx0XHR9XG5cblx0XHRmdW5jdGlvbiBiYWNrc3BhY2VEZWxldGUoZGlyZWN0aW9uLCBiZWZvcmVGbiwgYWZ0ZXJGbiwgcmFuZ2UpIHtcblx0XHRcdHZhciBub2RlLCBjYXJldFBvc2l0aW9uLCBwZWVrQ2FyZXRQb3NpdGlvbiwgbmV3Q2FyZXRQb3NpdGlvbjtcblxuXHRcdFx0aWYgKCFyYW5nZS5jb2xsYXBzZWQpIHtcblx0XHRcdFx0bm9kZSA9IGdldFNlbGVjdGVkTm9kZShyYW5nZSk7XG5cdFx0XHRcdGlmIChpc0NvbnRlbnRFZGl0YWJsZUZhbHNlKG5vZGUpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHJlbmRlclJhbmdlQ2FyZXQoZGVsZXRlQ29udGVudEVkaXRhYmxlTm9kZShub2RlKSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0Y2FyZXRQb3NpdGlvbiA9IGdldE5vcm1hbGl6ZWRSYW5nZUVuZFBvaW50KGRpcmVjdGlvbiwgcmFuZ2UpO1xuXG5cdFx0XHRpZiAoYWZ0ZXJGbihjYXJldFBvc2l0aW9uKSAmJiBDYXJldENvbnRhaW5lci5pc0NhcmV0Q29udGFpbmVyQmxvY2socmFuZ2Uuc3RhcnRDb250YWluZXIpKSB7XG5cdFx0XHRcdG5ld0NhcmV0UG9zaXRpb24gPSBkaXJlY3Rpb24gPT0gLTEgPyBjYXJldFdhbGtlci5wcmV2KGNhcmV0UG9zaXRpb24pIDogY2FyZXRXYWxrZXIubmV4dChjYXJldFBvc2l0aW9uKTtcblx0XHRcdFx0cmV0dXJuIG5ld0NhcmV0UG9zaXRpb24gPyByZW5kZXJSYW5nZUNhcmV0KG5ld0NhcmV0UG9zaXRpb24udG9SYW5nZSgpKSA6IHJhbmdlO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYmVmb3JlRm4oY2FyZXRQb3NpdGlvbikpIHtcblx0XHRcdFx0cmV0dXJuIHJlbmRlclJhbmdlQ2FyZXQoZGVsZXRlQ29udGVudEVkaXRhYmxlTm9kZShjYXJldFBvc2l0aW9uLmdldE5vZGUoZGlyZWN0aW9uID09IC0xKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRwZWVrQ2FyZXRQb3NpdGlvbiA9IGRpcmVjdGlvbiA9PSAtMSA/IGNhcmV0V2Fsa2VyLnByZXYoY2FyZXRQb3NpdGlvbikgOiBjYXJldFdhbGtlci5uZXh0KGNhcmV0UG9zaXRpb24pO1xuXHRcdFx0aWYgKGJlZm9yZUZuKHBlZWtDYXJldFBvc2l0aW9uKSkge1xuXHRcdFx0XHRpZiAoZGlyZWN0aW9uID09PSAtMSkge1xuXHRcdFx0XHRcdHJldHVybiBtZXJnZVRleHRCbG9ja3MoZGlyZWN0aW9uLCBjYXJldFBvc2l0aW9uLCBwZWVrQ2FyZXRQb3NpdGlvbik7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbWVyZ2VUZXh0QmxvY2tzKGRpcmVjdGlvbiwgcGVla0NhcmV0UG9zaXRpb24sIGNhcmV0UG9zaXRpb24pO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIHJlZ2lzdGVyRXZlbnRzKCkge1xuXHRcdFx0dmFyIHJpZ2h0ID0gY3VycnkobW92ZUgsIDEsIGdldE5leHRWaXN1YWxDYXJldFBvc2l0aW9uLCBpc0JlZm9yZUNvbnRlbnRFZGl0YWJsZUZhbHNlKTtcblx0XHRcdHZhciBsZWZ0ID0gY3VycnkobW92ZUgsIC0xLCBnZXRQcmV2VmlzdWFsQ2FyZXRQb3NpdGlvbiwgaXNBZnRlckNvbnRlbnRFZGl0YWJsZUZhbHNlKTtcblx0XHRcdHZhciBkZWxldGVGb3J3YXJkID0gY3VycnkoYmFja3NwYWNlRGVsZXRlLCAxLCBpc0JlZm9yZUNvbnRlbnRFZGl0YWJsZUZhbHNlLCBpc0FmdGVyQ29udGVudEVkaXRhYmxlRmFsc2UpO1xuXHRcdFx0dmFyIGJhY2tzcGFjZSA9IGN1cnJ5KGJhY2tzcGFjZURlbGV0ZSwgLTEsIGlzQWZ0ZXJDb250ZW50RWRpdGFibGVGYWxzZSwgaXNCZWZvcmVDb250ZW50RWRpdGFibGVGYWxzZSk7XG5cdFx0XHR2YXIgdXAgPSBjdXJyeShtb3ZlViwgLTEsIExpbmVXYWxrZXIudXBVbnRpbCk7XG5cdFx0XHR2YXIgZG93biA9IGN1cnJ5KG1vdmVWLCAxLCBMaW5lV2Fsa2VyLmRvd25VbnRpbCk7XG5cblx0XHRcdGZ1bmN0aW9uIG92ZXJyaWRlKGV2dCwgbW92ZUZuKSB7XG5cdFx0XHRcdHZhciByYW5nZSA9IG1vdmVGbihnZXRSYW5nZSgpKTtcblxuXHRcdFx0XHRpZiAocmFuZ2UgJiYgIWV2dC5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkge1xuXHRcdFx0XHRcdGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRcdHNldFJhbmdlKHJhbmdlKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRmdW5jdGlvbiBnZXRDb250ZW50RWRpdGFibGVSb290KG5vZGUpIHtcblx0XHRcdFx0dmFyIHJvb3QgPSBlZGl0b3IuZ2V0Qm9keSgpO1xuXG5cdFx0XHRcdHdoaWxlIChub2RlICYmIG5vZGUgIT0gcm9vdCkge1xuXHRcdFx0XHRcdGlmIChpc0NvbnRlbnRFZGl0YWJsZVRydWUobm9kZSkgfHwgaXNDb250ZW50RWRpdGFibGVGYWxzZShub2RlKSkge1xuXHRcdFx0XHRcdFx0cmV0dXJuIG5vZGU7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0bm9kZSA9IG5vZGUucGFyZW50Tm9kZTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXG5cdFx0XHRmdW5jdGlvbiBpc1hZV2l0aGluUmFuZ2UoY2xpZW50WCwgY2xpZW50WSwgcmFuZ2UpIHtcblx0XHRcdFx0aWYgKHJhbmdlLmNvbGxhcHNlZCkge1xuXHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBBcnIucmVkdWNlKHJhbmdlLmdldENsaWVudFJlY3RzKCksIGZ1bmN0aW9uKHN0YXRlLCByZWN0KSB7XG5cdFx0XHRcdFx0cmV0dXJuIHN0YXRlIHx8IENsaWVudFJlY3QuY29udGFpbnNYWShyZWN0LCBjbGllbnRYLCBjbGllbnRZKTtcblx0XHRcdFx0fSwgZmFsc2UpO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBTb21lIGJyb3dzZXJzIChDaHJvbWUpIGxldHMgeW91IHBsYWNlIHRoZSBjYXJldCBhZnRlciBhIGNFPWZhbHNlXG5cdFx0XHQvLyBNYWtlIHN1cmUgd2UgcmVuZGVyIHRoZSBjYXJldCBjb250YWluZXIgaW4gdGhpcyBjYXNlXG5cdFx0XHRlZGl0b3Iub24oJ21vdXNldXAnLCBmdW5jdGlvbigpIHtcblx0XHRcdFx0dmFyIHJhbmdlID0gZ2V0UmFuZ2UoKTtcblxuXHRcdFx0XHRpZiAocmFuZ2UuY29sbGFwc2VkKSB7XG5cdFx0XHRcdFx0c2V0UmFuZ2UocmVuZGVyQ2FyZXRBdFJhbmdlKHJhbmdlKSk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRlZGl0b3Iub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHR2YXIgY29udGVudEVkaXRhYmxlUm9vdDtcblxuXHRcdFx0XHRjb250ZW50RWRpdGFibGVSb290XHQ9IGdldENvbnRlbnRFZGl0YWJsZVJvb3QoZS50YXJnZXQpO1xuXHRcdFx0XHRpZiAoY29udGVudEVkaXRhYmxlUm9vdCkge1xuXHRcdFx0XHRcdC8vIFByZXZlbnQgY2xpY2tzIG9uIGxpbmtzIGluIGEgY0U9ZmFsc2UgZWxlbWVudFxuXHRcdFx0XHRcdGlmIChpc0NvbnRlbnRFZGl0YWJsZUZhbHNlKGNvbnRlbnRFZGl0YWJsZVJvb3QpKSB7XG5cdFx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdFx0XHRlZGl0b3IuZm9jdXMoKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHQvLyBSZW1vdmVzIGZha2Ugc2VsZWN0aW9uIGlmIGEgY0U9dHJ1ZSBpcyBjbGlja2VkIHdpdGhpbiBhIGNFPWZhbHNlIGxpa2UgdGhlIHRvYyB0aXRsZVxuXHRcdFx0XHRcdGlmIChpc0NvbnRlbnRFZGl0YWJsZVRydWUoY29udGVudEVkaXRhYmxlUm9vdCkpIHtcblx0XHRcdFx0XHRcdGlmIChlZGl0b3IuZG9tLmlzQ2hpbGRPZihjb250ZW50RWRpdGFibGVSb290LCBlZGl0b3Iuc2VsZWN0aW9uLmdldE5vZGUoKSkpIHtcblx0XHRcdFx0XHRcdFx0cmVtb3ZlQ29udGVudEVkaXRhYmxlU2VsZWN0aW9uKCk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0ZWRpdG9yLm9uKCdibHVyIE5ld0Jsb2NrJywgZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRyZW1vdmVDb250ZW50RWRpdGFibGVTZWxlY3Rpb24oKTtcblx0XHRcdFx0aGlkZUZha2VDYXJldCgpO1xuXHRcdFx0fSk7XG5cblx0XHRcdGZ1bmN0aW9uIGhhbmRsZVRvdWNoU2VsZWN0KGVkaXRvcikge1xuXHRcdFx0XHR2YXIgbW92ZWQgPSBmYWxzZTtcblxuXHRcdFx0XHRlZGl0b3Iub24oJ3RvdWNoc3RhcnQnLCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0bW92ZWQgPSBmYWxzZTtcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0ZWRpdG9yLm9uKCd0b3VjaG1vdmUnLCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0bW92ZWQgPSB0cnVlO1xuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHRlZGl0b3Iub24oJ3RvdWNoZW5kJywgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0XHR2YXIgY29udGVudEVkaXRhYmxlUm9vdFx0PSBnZXRDb250ZW50RWRpdGFibGVSb290KGUudGFyZ2V0KTtcblxuXHRcdFx0XHRcdGlmIChpc0NvbnRlbnRFZGl0YWJsZUZhbHNlKGNvbnRlbnRFZGl0YWJsZVJvb3QpKSB7XG5cdFx0XHRcdFx0XHRpZiAoIW1vdmVkKSB7XG5cdFx0XHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHRcdFx0c2V0Q29udGVudEVkaXRhYmxlU2VsZWN0aW9uKHNlbGVjdE5vZGUoY29udGVudEVkaXRhYmxlUm9vdCkpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdHZhciBoYXNOb3JtYWxDYXJldFBvc2l0aW9uID0gZnVuY3Rpb24gKGVsbSkge1xuXHRcdFx0XHR2YXIgY2FyZXRXYWxrZXIgPSBuZXcgQ2FyZXRXYWxrZXIoZWxtKTtcblxuXHRcdFx0XHRpZiAoIWVsbS5maXJzdENoaWxkKSB7XG5cdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0dmFyIHN0YXJ0UG9zID0gQ2FyZXRQb3NpdGlvbi5iZWZvcmUoZWxtLmZpcnN0Q2hpbGQpO1xuXHRcdFx0XHR2YXIgbmV3UG9zID0gY2FyZXRXYWxrZXIubmV4dChzdGFydFBvcyk7XG5cblx0XHRcdFx0cmV0dXJuIG5ld1BvcyAmJiAhaXNCZWZvcmVDb250ZW50RWRpdGFibGVGYWxzZShuZXdQb3MpICYmICFpc0FmdGVyQ29udGVudEVkaXRhYmxlRmFsc2UobmV3UG9zKTtcblx0XHRcdH07XG5cblx0XHRcdHZhciBpc0luU2FtZUJsb2NrID0gZnVuY3Rpb24gKG5vZGUxLCBub2RlMikge1xuXHRcdFx0XHR2YXIgYmxvY2sxID0gZWRpdG9yLmRvbS5nZXRQYXJlbnQobm9kZTEsIGVkaXRvci5kb20uaXNCbG9jayk7XG5cdFx0XHRcdHZhciBibG9jazIgPSBlZGl0b3IuZG9tLmdldFBhcmVudChub2RlMiwgZWRpdG9yLmRvbS5pc0Jsb2NrKTtcblx0XHRcdFx0cmV0dXJuIGJsb2NrMSA9PT0gYmxvY2syO1xuXHRcdFx0fTtcblxuXHRcdFx0dmFyIGlzQ29udGVudEtleSA9IGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdGlmIChlLmtleUNvZGUgPj0gMTEyICYmIGUua2V5Q29kZSA8PSAxMjMpIHtcblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdH07XG5cblx0XHRcdC8vIENoZWNrcyBpZiB0aGUgdGFyZ2V0IG5vZGUgaXMgaW4gYSBibG9jayBhbmQgaWYgdGhhdCBibG9jayBoYXMgYSBjYXJldCBwb3NpdGlvbiBiZXR0ZXIgdGhhbiB0aGVcblx0XHRcdC8vIHN1Z2dlc3RlZCBjYXJldE5vZGUgdGhpcyBpcyB0byBwcmV2ZW50IHRoZSBjYXJldCBmcm9tIGJlaW5nIHN1Y2tlZCBpbiB0b3dhcmRzIGEgY0U9ZmFsc2UgYmxvY2sgaWZcblx0XHRcdC8vIHRoZXkgYXJlIGFkamFjZW50IG9uIHRoZSB2ZXJ0aWNhbCBheGlzXG5cdFx0XHR2YXIgaGFzQmV0dGVyTW91c2VUYXJnZXQgPSBmdW5jdGlvbiAodGFyZ2V0Tm9kZSwgY2FyZXROb2RlKSB7XG5cdFx0XHRcdHZhciB0YXJnZXRCbG9jayA9IGVkaXRvci5kb20uZ2V0UGFyZW50KHRhcmdldE5vZGUsIGVkaXRvci5kb20uaXNCbG9jayk7XG5cdFx0XHRcdHZhciBjYXJldEJsb2NrID0gZWRpdG9yLmRvbS5nZXRQYXJlbnQoY2FyZXROb2RlLCBlZGl0b3IuZG9tLmlzQmxvY2spO1xuXG5cdFx0XHRcdHJldHVybiB0YXJnZXRCbG9jayAmJiAhaXNJblNhbWVCbG9jayh0YXJnZXRCbG9jaywgY2FyZXRCbG9jaykgJiYgaGFzTm9ybWFsQ2FyZXRQb3NpdGlvbih0YXJnZXRCbG9jayk7XG5cdFx0XHR9O1xuXG5cdFx0XHRoYW5kbGVUb3VjaFNlbGVjdChlZGl0b3IpO1xuXG5cdFx0XHRlZGl0b3Iub24oJ21vdXNlZG93bicsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0dmFyIGNvbnRlbnRFZGl0YWJsZVJvb3Q7XG5cblx0XHRcdFx0Y29udGVudEVkaXRhYmxlUm9vdFx0PSBnZXRDb250ZW50RWRpdGFibGVSb290KGUudGFyZ2V0KTtcblx0XHRcdFx0aWYgKGNvbnRlbnRFZGl0YWJsZVJvb3QpIHtcblx0XHRcdFx0XHRpZiAoaXNDb250ZW50RWRpdGFibGVGYWxzZShjb250ZW50RWRpdGFibGVSb290KSkge1xuXHRcdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRcdFx0c2V0Q29udGVudEVkaXRhYmxlU2VsZWN0aW9uKHNlbGVjdE5vZGUoY29udGVudEVkaXRhYmxlUm9vdCkpO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRpZiAoIWlzWFlXaXRoaW5SYW5nZShlLmNsaWVudFgsIGUuY2xpZW50WSwgZWRpdG9yLnNlbGVjdGlvbi5nZXRSbmcoKSkpIHtcblx0XHRcdFx0XHRcdFx0ZWRpdG9yLnNlbGVjdGlvbi5wbGFjZUNhcmV0QXQoZS5jbGllbnRYLCBlLmNsaWVudFkpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHQvLyBSZW1vdmUgbmVlZHMgdG8gYmUgY2FsbGVkIGhlcmUgc2luY2UgdGhlIG1vdXNlZG93biBtaWdodCBhbHRlciB0aGUgc2VsZWN0aW9uIHdpdGhvdXQgY2FsbGluZyBzZWxlY3Rpb24uc2V0Um5nXG5cdFx0XHRcdFx0Ly8gYW5kIHRoZXJlZm9yZSBub3QgZmlyZSB0aGUgQWZ0ZXJTZXRTZWxlY3Rpb25SYW5nZSBldmVudC5cblx0XHRcdFx0XHRyZW1vdmVDb250ZW50RWRpdGFibGVTZWxlY3Rpb24oKTtcblx0XHRcdFx0XHRoaWRlRmFrZUNhcmV0KCk7XG5cblx0XHRcdFx0XHR2YXIgY2FyZXRJbmZvID0gTGluZVV0aWxzLmNsb3Nlc3RDYXJldChyb290Tm9kZSwgZS5jbGllbnRYLCBlLmNsaWVudFkpO1xuXHRcdFx0XHRcdGlmIChjYXJldEluZm8pIHtcblx0XHRcdFx0XHRcdGlmICghaGFzQmV0dGVyTW91c2VUYXJnZXQoZS50YXJnZXQsIGNhcmV0SW5mby5ub2RlKSkge1xuXHRcdFx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdFx0XHRcdGVkaXRvci5nZXRCb2R5KCkuZm9jdXMoKTtcblx0XHRcdFx0XHRcdFx0c2V0UmFuZ2Uoc2hvd0NhcmV0KDEsIGNhcmV0SW5mby5ub2RlLCBjYXJldEluZm8uYmVmb3JlKSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0ZWRpdG9yLm9uKCdrZXlkb3duJywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRpZiAoVksubW9kaWZpZXJQcmVzc2VkKGUpKSB7XG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0c3dpdGNoIChlLmtleUNvZGUpIHtcblx0XHRcdFx0XHRjYXNlIFZLLlJJR0hUOlxuXHRcdFx0XHRcdFx0b3ZlcnJpZGUoZSwgcmlnaHQpO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRjYXNlIFZLLkRPV046XG5cdFx0XHRcdFx0XHRvdmVycmlkZShlLCBkb3duKTtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0Y2FzZSBWSy5MRUZUOlxuXHRcdFx0XHRcdFx0b3ZlcnJpZGUoZSwgbGVmdCk7XG5cdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdGNhc2UgVksuVVA6XG5cdFx0XHRcdFx0XHRvdmVycmlkZShlLCB1cCk7XG5cdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdGNhc2UgVksuREVMRVRFOlxuXHRcdFx0XHRcdFx0b3ZlcnJpZGUoZSwgZGVsZXRlRm9yd2FyZCk7XG5cdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdGNhc2UgVksuQkFDS1NQQUNFOlxuXHRcdFx0XHRcdFx0b3ZlcnJpZGUoZSwgYmFja3NwYWNlKTtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0XHRcdGlmIChpc0NvbnRlbnRFZGl0YWJsZUZhbHNlKGVkaXRvci5zZWxlY3Rpb24uZ2V0Tm9kZSgpKSAmJiBpc0NvbnRlbnRLZXkoZSkpIHtcblx0XHRcdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRmdW5jdGlvbiBwYWRkRW1wdHlDb250ZW50RWRpdGFibGVBcmVhKCkge1xuXHRcdFx0XHR2YXIgYnIsIGNlUm9vdCA9IGdldENvbnRlbnRFZGl0YWJsZVJvb3QoZWRpdG9yLnNlbGVjdGlvbi5nZXROb2RlKCkpO1xuXG5cdFx0XHRcdGlmIChpc0NvbnRlbnRFZGl0YWJsZVRydWUoY2VSb290KSAmJiBpc0Jsb2NrKGNlUm9vdCkgJiYgZWRpdG9yLmRvbS5pc0VtcHR5KGNlUm9vdCkpIHtcblx0XHRcdFx0XHRiciA9IGVkaXRvci5kb20uY3JlYXRlKCdicicsIHtcImRhdGEtbWNlLWJvZ3VzXCI6IFwiMVwifSk7XG5cdFx0XHRcdFx0ZWRpdG9yLiQoY2VSb290KS5lbXB0eSgpLmFwcGVuZChicik7XG5cdFx0XHRcdFx0ZWRpdG9yLnNlbGVjdGlvbi5zZXRSbmcoQ2FyZXRQb3NpdGlvbi5iZWZvcmUoYnIpLnRvUmFuZ2UoKSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gaGFuZGxlQmxvY2tDb250YWluZXIoZSkge1xuXHRcdFx0XHR2YXIgYmxvY2tDYXJldENvbnRhaW5lciA9IGdldEJsb2NrQ2FyZXRDb250YWluZXIoKTtcblxuXHRcdFx0XHRpZiAoIWJsb2NrQ2FyZXRDb250YWluZXIpIHtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoZS50eXBlID09ICdjb21wb3NpdGlvbnN0YXJ0Jykge1xuXHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRcdHNob3dCbG9ja0NhcmV0Q29udGFpbmVyKGJsb2NrQ2FyZXRDb250YWluZXIpO1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChDYXJldENvbnRhaW5lci5oYXNDb250ZW50KGJsb2NrQ2FyZXRDb250YWluZXIpKSB7XG5cdFx0XHRcdFx0c2hvd0Jsb2NrQ2FyZXRDb250YWluZXIoYmxvY2tDYXJldENvbnRhaW5lcik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gaGFuZGxlRW1wdHlCYWNrc3BhY2VEZWxldGUoZSkge1xuXHRcdFx0XHR2YXIgcHJldmVudDtcblxuXHRcdFx0XHRzd2l0Y2ggKGUua2V5Q29kZSkge1xuXHRcdFx0XHRcdGNhc2UgVksuREVMRVRFOlxuXHRcdFx0XHRcdFx0cHJldmVudCA9IHBhZGRFbXB0eUNvbnRlbnRFZGl0YWJsZUFyZWEoKTtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0Y2FzZSBWSy5CQUNLU1BBQ0U6XG5cdFx0XHRcdFx0XHRwcmV2ZW50ID0gcGFkZEVtcHR5Q29udGVudEVkaXRhYmxlQXJlYSgpO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAocHJldmVudCkge1xuXHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHQvLyBNdXN0IGJlIGFkZGVkIHRvIFwidG9wXCIgc2luY2UgdW5kb01hbmFnZXIgbmVlZHMgdG8gYmUgZXhlY3V0ZWQgYWZ0ZXJcblx0XHRcdGVkaXRvci5vbigna2V5dXAgY29tcG9zaXRpb25zdGFydCcsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0aGFuZGxlQmxvY2tDb250YWluZXIoZSk7XG5cdFx0XHRcdGhhbmRsZUVtcHR5QmFja3NwYWNlRGVsZXRlKGUpO1xuXHRcdFx0fSwgdHJ1ZSk7XG5cblx0XHRcdGVkaXRvci5vbignY3V0JywgZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHZhciBub2RlID0gZWRpdG9yLnNlbGVjdGlvbi5nZXROb2RlKCk7XG5cblx0XHRcdFx0aWYgKGlzQ29udGVudEVkaXRhYmxlRmFsc2Uobm9kZSkpIHtcblx0XHRcdFx0XHREZWxheS5zZXRFZGl0b3JUaW1lb3V0KGVkaXRvciwgZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0XHRzZXRSYW5nZShyZW5kZXJSYW5nZUNhcmV0KGRlbGV0ZUNvbnRlbnRFZGl0YWJsZU5vZGUobm9kZSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdGVkaXRvci5vbignZ2V0U2VsZWN0aW9uUmFuZ2UnLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdHZhciBybmcgPSBlLnJhbmdlO1xuXG5cdFx0XHRcdGlmIChzZWxlY3RlZENvbnRlbnRFZGl0YWJsZU5vZGUpIHtcblx0XHRcdFx0XHRpZiAoIXNlbGVjdGVkQ29udGVudEVkaXRhYmxlTm9kZS5wYXJlbnROb2RlKSB7XG5cdFx0XHRcdFx0XHRzZWxlY3RlZENvbnRlbnRFZGl0YWJsZU5vZGUgPSBudWxsO1xuXHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJuZyA9IHJuZy5jbG9uZVJhbmdlKCk7XG5cdFx0XHRcdFx0cm5nLnNlbGVjdE5vZGUoc2VsZWN0ZWRDb250ZW50RWRpdGFibGVOb2RlKTtcblx0XHRcdFx0XHRlLnJhbmdlID0gcm5nO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0ZWRpdG9yLm9uKCdzZXRTZWxlY3Rpb25SYW5nZScsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0dmFyIHJuZztcblxuXHRcdFx0XHRybmcgPSBzZXRDb250ZW50RWRpdGFibGVTZWxlY3Rpb24oZS5yYW5nZSk7XG5cdFx0XHRcdGlmIChybmcpIHtcblx0XHRcdFx0XHRlLnJhbmdlID0gcm5nO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0ZWRpdG9yLm9uKCdBZnRlclNldFNlbGVjdGlvblJhbmdlJywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHR2YXIgcm5nID0gZS5yYW5nZTtcblxuXHRcdFx0XHRpZiAoIWlzUmFuZ2VJbkNhcmV0Q29udGFpbmVyKHJuZykpIHtcblx0XHRcdFx0XHRoaWRlRmFrZUNhcmV0KCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoIWlzRmFrZVNlbGVjdGlvbkVsZW1lbnQocm5nLnN0YXJ0Q29udGFpbmVyLnBhcmVudE5vZGUpKSB7XG5cdFx0XHRcdFx0cmVtb3ZlQ29udGVudEVkaXRhYmxlU2VsZWN0aW9uKCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRlZGl0b3Iub24oJ2ZvY3VzJywgZnVuY3Rpb24oKSB7XG5cdFx0XHRcdC8vIE1ha2Ugc3VyZSB3ZSBoYXZlIGEgcHJvcGVyIGZha2UgY2FyZXQgb24gZm9jdXNcblx0XHRcdFx0RGVsYXkuc2V0RWRpdG9yVGltZW91dChlZGl0b3IsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdGVkaXRvci5zZWxlY3Rpb24uc2V0Um5nKHJlbmRlclJhbmdlQ2FyZXQoZWRpdG9yLnNlbGVjdGlvbi5nZXRSbmcoKSkpO1xuXHRcdFx0XHR9LCAwKTtcblx0XHRcdH0pO1xuXG5cdFx0XHRlZGl0b3Iub24oJ2NvcHknLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHR2YXIgY2xpcGJvYXJkRGF0YSA9IGUuY2xpcGJvYXJkRGF0YTtcblxuXHRcdFx0XHQvLyBNYWtlIHN1cmUgd2UgZ2V0IHByb3BlciBodG1sL3RleHQgZm9yIHRoZSBmYWtlIGNFPWZhbHNlIHNlbGVjdGlvblxuXHRcdFx0XHQvLyBEb2Vzbid0IHdvcmsgYXQgYWxsIG9uIEVkZ2Ugc2luY2UgaXQgZG9lc24ndCBoYXZlIHByb3BlciBjbGlwYm9hcmREYXRhIHN1cHBvcnRcblx0XHRcdFx0aWYgKCFlLmlzRGVmYXVsdFByZXZlbnRlZCgpICYmIGUuY2xpcGJvYXJkRGF0YSAmJiAhRW52LmllKSB7XG5cdFx0XHRcdFx0dmFyIHJlYWxTZWxlY3Rpb25FbGVtZW50ID0gZ2V0UmVhbFNlbGVjdGlvbkVsZW1lbnQoKTtcblx0XHRcdFx0XHRpZiAocmVhbFNlbGVjdGlvbkVsZW1lbnQpIHtcblx0XHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHRcdGNsaXBib2FyZERhdGEuY2xlYXJEYXRhKCk7XG5cdFx0XHRcdFx0XHRjbGlwYm9hcmREYXRhLnNldERhdGEoJ3RleHQvaHRtbCcsIHJlYWxTZWxlY3Rpb25FbGVtZW50Lm91dGVySFRNTCk7XG5cdFx0XHRcdFx0XHRjbGlwYm9hcmREYXRhLnNldERhdGEoJ3RleHQvcGxhaW4nLCByZWFsU2VsZWN0aW9uRWxlbWVudC5vdXRlclRleHQpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdERyYWdEcm9wT3ZlcnJpZGVzLmluaXQoZWRpdG9yKTtcblx0XHR9XG5cblx0XHRmdW5jdGlvbiBhZGRDc3MoKSB7XG5cdFx0XHR2YXIgc3R5bGVzID0gZWRpdG9yLmNvbnRlbnRTdHlsZXMsIHJvb3RDbGFzcyA9ICcubWNlLWNvbnRlbnQtYm9keSc7XG5cblx0XHRcdHN0eWxlcy5wdXNoKGZha2VDYXJldC5nZXRDc3MoKSk7XG5cdFx0XHRzdHlsZXMucHVzaChcblx0XHRcdFx0cm9vdENsYXNzICsgJyAubWNlLW9mZnNjcmVlbi1zZWxlY3Rpb24geycgK1xuXHRcdFx0XHRcdCdwb3NpdGlvbjogYWJzb2x1dGU7JyArXG5cdFx0XHRcdFx0J2xlZnQ6IC05OTk5OTk5OTk5cHg7JyArXG5cdFx0XHRcdFx0J21heC13aWR0aDogMTAwMDAwMHB4OycgK1xuXHRcdFx0XHQnfScgK1xuXHRcdFx0XHRyb290Q2xhc3MgKyAnICpbY29udGVudEVkaXRhYmxlPWZhbHNlXSB7JyArXG5cdFx0XHRcdFx0J2N1cnNvcjogZGVmYXVsdDsnICtcblx0XHRcdFx0J30nICtcblx0XHRcdFx0cm9vdENsYXNzICsgJyAqW2NvbnRlbnRFZGl0YWJsZT10cnVlXSB7JyArXG5cdFx0XHRcdFx0J2N1cnNvcjogdGV4dDsnICtcblx0XHRcdFx0J30nXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIGlzUmFuZ2VJbkNhcmV0Q29udGFpbmVyKHJuZykge1xuXHRcdFx0cmV0dXJuIENhcmV0Q29udGFpbmVyLmlzQ2FyZXRDb250YWluZXIocm5nLnN0YXJ0Q29udGFpbmVyKSB8fCBDYXJldENvbnRhaW5lci5pc0NhcmV0Q29udGFpbmVyKHJuZy5lbmRDb250YWluZXIpO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIHNldENvbnRlbnRFZGl0YWJsZVNlbGVjdGlvbihyYW5nZSkge1xuXHRcdFx0dmFyIG5vZGUsICQgPSBlZGl0b3IuJCwgZG9tID0gZWRpdG9yLmRvbSwgJHJlYWxTZWxlY3Rpb25Db250YWluZXIsIHNlbCxcblx0XHRcdFx0c3RhcnRDb250YWluZXIsIHN0YXJ0T2Zmc2V0LCBlbmRPZmZzZXQsIGUsIGNhcmV0UG9zaXRpb24sIHRhcmdldENsb25lLCBvcmlnVGFyZ2V0Q2xvbmU7XG5cblx0XHRcdGlmICghcmFuZ2UpIHtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChyYW5nZS5jb2xsYXBzZWQpIHtcblx0XHRcdFx0aWYgKCFpc1JhbmdlSW5DYXJldENvbnRhaW5lcihyYW5nZSkpIHtcblx0XHRcdFx0XHRjYXJldFBvc2l0aW9uID0gZ2V0Tm9ybWFsaXplZFJhbmdlRW5kUG9pbnQoMSwgcmFuZ2UpO1xuXG5cdFx0XHRcdFx0aWYgKGlzQ29udGVudEVkaXRhYmxlRmFsc2UoY2FyZXRQb3NpdGlvbi5nZXROb2RlKCkpKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gc2hvd0NhcmV0KDEsIGNhcmV0UG9zaXRpb24uZ2V0Tm9kZSgpLCAhY2FyZXRQb3NpdGlvbi5pc0F0RW5kKCkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmIChpc0NvbnRlbnRFZGl0YWJsZUZhbHNlKGNhcmV0UG9zaXRpb24uZ2V0Tm9kZSh0cnVlKSkpIHtcblx0XHRcdFx0XHRcdHJldHVybiBzaG93Q2FyZXQoMSwgY2FyZXRQb3NpdGlvbi5nZXROb2RlKHRydWUpLCBmYWxzZSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cblx0XHRcdHN0YXJ0Q29udGFpbmVyID0gcmFuZ2Uuc3RhcnRDb250YWluZXI7XG5cdFx0XHRzdGFydE9mZnNldCA9IHJhbmdlLnN0YXJ0T2Zmc2V0O1xuXHRcdFx0ZW5kT2Zmc2V0ID0gcmFuZ2UuZW5kT2Zmc2V0O1xuXG5cdFx0XHQvLyBOb3JtYWxpemVzIDxzcGFuIGNFPWZhbHNlPls8L3NwYW4+XSB0byBbPHNwYW4gY0U9ZmFsc2U+PC9zcGFuPl1cblx0XHRcdGlmIChzdGFydENvbnRhaW5lci5ub2RlVHlwZSA9PSAzICYmIHN0YXJ0T2Zmc2V0ID09IDAgJiYgaXNDb250ZW50RWRpdGFibGVGYWxzZShzdGFydENvbnRhaW5lci5wYXJlbnROb2RlKSkge1xuXHRcdFx0XHRzdGFydENvbnRhaW5lciA9IHN0YXJ0Q29udGFpbmVyLnBhcmVudE5vZGU7XG5cdFx0XHRcdHN0YXJ0T2Zmc2V0ID0gZG9tLm5vZGVJbmRleChzdGFydENvbnRhaW5lcik7XG5cdFx0XHRcdHN0YXJ0Q29udGFpbmVyID0gc3RhcnRDb250YWluZXIucGFyZW50Tm9kZTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHN0YXJ0Q29udGFpbmVyLm5vZGVUeXBlICE9IDEpIHtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChlbmRPZmZzZXQgPT0gc3RhcnRPZmZzZXQgKyAxKSB7XG5cdFx0XHRcdG5vZGUgPSBzdGFydENvbnRhaW5lci5jaGlsZE5vZGVzW3N0YXJ0T2Zmc2V0XTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKCFpc0NvbnRlbnRFZGl0YWJsZUZhbHNlKG5vZGUpKSB7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXG5cdFx0XHR0YXJnZXRDbG9uZSA9IG9yaWdUYXJnZXRDbG9uZSA9IG5vZGUuY2xvbmVOb2RlKHRydWUpO1xuXHRcdFx0ZSA9IGVkaXRvci5maXJlKCdPYmplY3RTZWxlY3RlZCcsIHt0YXJnZXQ6IG5vZGUsIHRhcmdldENsb25lOiB0YXJnZXRDbG9uZX0pO1xuXHRcdFx0aWYgKGUuaXNEZWZhdWx0UHJldmVudGVkKCkpIHtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cblx0XHRcdHRhcmdldENsb25lID0gZS50YXJnZXRDbG9uZTtcblx0XHRcdCRyZWFsU2VsZWN0aW9uQ29udGFpbmVyID0gJCgnIycgKyByZWFsU2VsZWN0aW9uSWQpO1xuXHRcdFx0aWYgKCRyZWFsU2VsZWN0aW9uQ29udGFpbmVyLmxlbmd0aCA9PT0gMCkge1xuXHRcdFx0XHQkcmVhbFNlbGVjdGlvbkNvbnRhaW5lciA9ICQoXG5cdFx0XHRcdFx0JzxkaXYgZGF0YS1tY2UtYm9ndXM9XCJhbGxcIiBjbGFzcz1cIm1jZS1vZmZzY3JlZW4tc2VsZWN0aW9uXCI+PC9kaXY+J1xuXHRcdFx0XHQpLmF0dHIoJ2lkJywgcmVhbFNlbGVjdGlvbklkKTtcblxuXHRcdFx0XHQkcmVhbFNlbGVjdGlvbkNvbnRhaW5lci5hcHBlbmRUbyhlZGl0b3IuZ2V0Qm9keSgpKTtcblx0XHRcdH1cblxuXHRcdFx0cmFuZ2UgPSBlZGl0b3IuZG9tLmNyZWF0ZVJuZygpO1xuXG5cdFx0XHQvLyBXSFkgaXMgSUUgbWFraW5nIHRoaW5ncyBzbyBoYXJkISBDb3B5IG9uIDxpIGNvbnRlbnRFZGl0YWJsZT1cImZhbHNlXCI+eDwvaT4gcHJvZHVjZXM6IDxlbT54PC9lbT5cblx0XHRcdC8vIFRoaXMgaXMgYSByaWRpY3Vsb3VzIGhhY2sgd2hlcmUgd2UgcGxhY2UgdGhlIHNlbGVjdGlvbiBmcm9tIGEgYmxvY2sgb3ZlciB0aGUgaW5saW5lIGVsZW1lbnRcblx0XHRcdC8vIHNvIHRoYXQganVzdCB0aGUgaW5saW5lIGVsZW1lbnQgaXMgY29waWVkIGFzIGlzIGFuZCBub3QgY29udmVydGVkLlxuXHRcdFx0aWYgKHRhcmdldENsb25lID09PSBvcmlnVGFyZ2V0Q2xvbmUgJiYgRW52LmllKSB7XG5cdFx0XHRcdCRyZWFsU2VsZWN0aW9uQ29udGFpbmVyLmVtcHR5KCkuYXBwZW5kKCc8cCBzdHlsZT1cImZvbnQtc2l6ZTogMFwiIGRhdGEtbWNlLWJvZ3VzPVwiYWxsXCI+XFx1MDBhMDwvcD4nKS5hcHBlbmQodGFyZ2V0Q2xvbmUpO1xuXHRcdFx0XHRyYW5nZS5zZXRTdGFydEFmdGVyKCRyZWFsU2VsZWN0aW9uQ29udGFpbmVyWzBdLmZpcnN0Q2hpbGQuZmlyc3RDaGlsZCk7XG5cdFx0XHRcdHJhbmdlLnNldEVuZEFmdGVyKHRhcmdldENsb25lKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCRyZWFsU2VsZWN0aW9uQ29udGFpbmVyLmVtcHR5KCkuYXBwZW5kKCdcXHUwMGEwJykuYXBwZW5kKHRhcmdldENsb25lKS5hcHBlbmQoJ1xcdTAwYTAnKTtcblx0XHRcdFx0cmFuZ2Uuc2V0U3RhcnQoJHJlYWxTZWxlY3Rpb25Db250YWluZXJbMF0uZmlyc3RDaGlsZCwgMSk7XG5cdFx0XHRcdHJhbmdlLnNldEVuZCgkcmVhbFNlbGVjdGlvbkNvbnRhaW5lclswXS5sYXN0Q2hpbGQsIDApO1xuXHRcdFx0fVxuXG5cdFx0XHQkcmVhbFNlbGVjdGlvbkNvbnRhaW5lci5jc3Moe1xuXHRcdFx0XHR0b3A6IGRvbS5nZXRQb3Mobm9kZSwgZWRpdG9yLmdldEJvZHkoKSkueVxuXHRcdFx0fSk7XG5cblx0XHRcdCRyZWFsU2VsZWN0aW9uQ29udGFpbmVyWzBdLmZvY3VzKCk7XG5cdFx0XHRzZWwgPSBlZGl0b3Iuc2VsZWN0aW9uLmdldFNlbCgpO1xuXHRcdFx0c2VsLnJlbW92ZUFsbFJhbmdlcygpO1xuXHRcdFx0c2VsLmFkZFJhbmdlKHJhbmdlKTtcblxuXHRcdFx0ZWRpdG9yLiQoJypbZGF0YS1tY2Utc2VsZWN0ZWRdJykucmVtb3ZlQXR0cignZGF0YS1tY2Utc2VsZWN0ZWQnKTtcblx0XHRcdG5vZGUuc2V0QXR0cmlidXRlKCdkYXRhLW1jZS1zZWxlY3RlZCcsIDEpO1xuXHRcdFx0c2VsZWN0ZWRDb250ZW50RWRpdGFibGVOb2RlID0gbm9kZTtcblxuXHRcdFx0cmV0dXJuIHJhbmdlO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIHJlbW92ZUNvbnRlbnRFZGl0YWJsZVNlbGVjdGlvbigpIHtcblx0XHRcdGlmIChzZWxlY3RlZENvbnRlbnRFZGl0YWJsZU5vZGUpIHtcblx0XHRcdFx0c2VsZWN0ZWRDb250ZW50RWRpdGFibGVOb2RlLnJlbW92ZUF0dHJpYnV0ZSgnZGF0YS1tY2Utc2VsZWN0ZWQnKTtcblx0XHRcdFx0ZWRpdG9yLiQoJyMnICsgcmVhbFNlbGVjdGlvbklkKS5yZW1vdmUoKTtcblx0XHRcdFx0c2VsZWN0ZWRDb250ZW50RWRpdGFibGVOb2RlID0gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRmdW5jdGlvbiBkZXN0cm95KCkge1xuXHRcdFx0ZmFrZUNhcmV0LmRlc3Ryb3koKTtcblx0XHRcdHNlbGVjdGVkQ29udGVudEVkaXRhYmxlTm9kZSA9IG51bGw7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gaGlkZUZha2VDYXJldCgpIHtcblx0XHRcdGZha2VDYXJldC5oaWRlKCk7XG5cdFx0fVxuXG5cdFx0aWYgKEVudi5jZUZhbHNlKSB7XG5cdFx0XHRyZWdpc3RlckV2ZW50cygpO1xuXHRcdFx0YWRkQ3NzKCk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHtcblx0XHRcdHNob3dCbG9ja0NhcmV0Q29udGFpbmVyOiBzaG93QmxvY2tDYXJldENvbnRhaW5lcixcblx0XHRcdGhpZGVGYWtlQ2FyZXQ6IGhpZGVGYWtlQ2FyZXQsXG5cdFx0XHRkZXN0cm95OiBkZXN0cm95XG5cdFx0fTtcblx0fVxuXG5cdHJldHVybiBTZWxlY3Rpb25PdmVycmlkZXM7XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL3V0aWwvVXVpZC5qc1xuXG4vKipcbiAqIFV1aWQuanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNiBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBHZW5lcmF0ZXMgdW5pcXVlIGlkcy5cbiAqXG4gKiBAY2xhc3MgdGlueW1jZS51dGlsLlV1aWRcbiAqIEBwcml2YXRlXG4gKi9cbmRlZmluZShcInRpbnltY2UvdXRpbC9VdWlkXCIsIFtcbl0sIGZ1bmN0aW9uKCkge1xuXHR2YXIgY291bnQgPSAwO1xuXG5cdHZhciBzZWVkID0gZnVuY3Rpb24gKCkge1xuXHRcdHZhciBybmQgPSBmdW5jdGlvbiAoKSB7XG5cdFx0XHRyZXR1cm4gTWF0aC5yb3VuZChNYXRoLnJhbmRvbSgpICogMHhGRkZGRkZGRikudG9TdHJpbmcoMzYpO1xuXHRcdH07XG5cblx0XHR2YXIgbm93ID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG5cdFx0cmV0dXJuICdzJyArIG5vdy50b1N0cmluZygzNikgKyBybmQoKSArIHJuZCgpICsgcm5kKCk7XG5cdH07XG5cblx0dmFyIHV1aWQgPSBmdW5jdGlvbiAocHJlZml4KSB7XG5cdFx0cmV0dXJuIHByZWZpeCArIChjb3VudCsrKSArIHNlZWQoKTtcblx0fTtcblxuXHRyZXR1cm4ge1xuXHRcdHV1aWQ6IHV1aWRcblx0fTtcbn0pO1xuXG4vLyBJbmNsdWRlZCBmcm9tOiBqcy90aW55bWNlL2NsYXNzZXMvdWkvU2lkZWJhci5qc1xuXG4vKipcbiAqIFNpZGViYXIuanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBUaGlzIG1vZHVsZSBoYW5kbGUgc2lkZWJhciBpbnN0YW5jZXMgZm9yIHRoZSBlZGl0b3IuXG4gKlxuICogQGNsYXNzIHRpbnltY2UudWkuU2lkZWJhclxuICogQHByaXZhdGVcbiAqL1xuZGVmaW5lKFwidGlueW1jZS91aS9TaWRlYmFyXCIsIFtcbl0sIGZ1bmN0aW9uKFxuKSB7XG5cdHZhciBhZGQgPSBmdW5jdGlvbiAoZWRpdG9yLCBuYW1lLCBzZXR0aW5ncykge1xuXHRcdHZhciBzaWRlYmFycyA9IGVkaXRvci5zaWRlYmFycyA/IGVkaXRvci5zaWRlYmFycyA6IFtdO1xuXHRcdHNpZGViYXJzLnB1c2goe25hbWU6IG5hbWUsIHNldHRpbmdzOiBzZXR0aW5nc30pO1xuXHRcdGVkaXRvci5zaWRlYmFycyA9IHNpZGViYXJzO1xuXHR9O1xuXG5cdHJldHVybiB7XG5cdFx0YWRkOiBhZGRcblx0fTtcbn0pO1xuXG4vLyBJbmNsdWRlZCBmcm9tOiBqcy90aW55bWNlL2NsYXNzZXMvRWRpdG9yLmpzXG5cbi8qKlxuICogRWRpdG9yLmpzXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgTEdQTCBMaWNlbnNlLlxuICogQ29weXJpZ2h0IChjKSAxOTk5LTIwMTUgRXBob3ggQ29ycC4gQWxsIHJpZ2h0cyByZXNlcnZlZFxuICpcbiAqIExpY2Vuc2U6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vbGljZW5zZVxuICogQ29udHJpYnV0aW5nOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2NvbnRyaWJ1dGluZ1xuICovXG5cbi8qanNoaW50IHNjcmlwdHVybDp0cnVlICovXG5cbi8qKlxuICogSW5jbHVkZSB0aGUgYmFzZSBldmVudCBjbGFzcyBkb2N1bWVudGF0aW9uLlxuICpcbiAqIEBpbmNsdWRlIC4uLy4uLy4uL3Rvb2xzL2RvY3MvdGlueW1jZS5FdmVudC5qc1xuICovXG5cbi8qKlxuICogVGhpcyBjbGFzcyBjb250YWlucyB0aGUgY29yZSBsb2dpYyBmb3IgYSBUaW55TUNFIGVkaXRvci5cbiAqXG4gKiBAY2xhc3MgdGlueW1jZS5FZGl0b3JcbiAqIEBtaXhlcyB0aW55bWNlLnV0aWwuT2JzZXJ2YWJsZVxuICogQGV4YW1wbGVcbiAqIC8vIEFkZCBhIGNsYXNzIHRvIGFsbCBwYXJhZ3JhcGhzIGluIHRoZSBlZGl0b3IuXG4gKiB0aW55bWNlLmFjdGl2ZUVkaXRvci5kb20uYWRkQ2xhc3ModGlueW1jZS5hY3RpdmVFZGl0b3IuZG9tLnNlbGVjdCgncCcpLCAnc29tZWNsYXNzJyk7XG4gKlxuICogLy8gR2V0cyB0aGUgY3VycmVudCBlZGl0b3JzIHNlbGVjdGlvbiBhcyB0ZXh0XG4gKiB0aW55bWNlLmFjdGl2ZUVkaXRvci5zZWxlY3Rpb24uZ2V0Q29udGVudCh7Zm9ybWF0OiAndGV4dCd9KTtcbiAqXG4gKiAvLyBDcmVhdGVzIGEgbmV3IGVkaXRvciBpbnN0YW5jZVxuICogdmFyIGVkID0gbmV3IHRpbnltY2UuRWRpdG9yKCd0ZXh0YXJlYWlkJywge1xuICogICAgIHNvbWVfc2V0dGluZzogMVxuICogfSwgdGlueW1jZS5FZGl0b3JNYW5hZ2VyKTtcbiAqXG4gKiAvLyBTZWxlY3QgZWFjaCBpdGVtIHRoZSB1c2VyIGNsaWNrcyBvblxuICogZWQub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuICogICAgIGVkLnNlbGVjdGlvbi5zZWxlY3QoZS50YXJnZXQpO1xuICogfSk7XG4gKlxuICogZWQucmVuZGVyKCk7XG4gKi9cbmRlZmluZShcInRpbnltY2UvRWRpdG9yXCIsIFtcblx0XCJ0aW55bWNlL2RvbS9ET01VdGlsc1wiLFxuXHRcInRpbnltY2UvZG9tL0RvbVF1ZXJ5XCIsXG5cdFwidGlueW1jZS9BZGRPbk1hbmFnZXJcIixcblx0XCJ0aW55bWNlL05vZGVDaGFuZ2VcIixcblx0XCJ0aW55bWNlL2h0bWwvTm9kZVwiLFxuXHRcInRpbnltY2UvZG9tL1NlcmlhbGl6ZXJcIixcblx0XCJ0aW55bWNlL2h0bWwvU2VyaWFsaXplclwiLFxuXHRcInRpbnltY2UvZG9tL1NlbGVjdGlvblwiLFxuXHRcInRpbnltY2UvRm9ybWF0dGVyXCIsXG5cdFwidGlueW1jZS9VbmRvTWFuYWdlclwiLFxuXHRcInRpbnltY2UvRW50ZXJLZXlcIixcblx0XCJ0aW55bWNlL0ZvcmNlQmxvY2tzXCIsXG5cdFwidGlueW1jZS9FZGl0b3JDb21tYW5kc1wiLFxuXHRcInRpbnltY2UvdXRpbC9VUklcIixcblx0XCJ0aW55bWNlL2RvbS9TY3JpcHRMb2FkZXJcIixcblx0XCJ0aW55bWNlL2RvbS9FdmVudFV0aWxzXCIsXG5cdFwidGlueW1jZS9XaW5kb3dNYW5hZ2VyXCIsXG5cdFwidGlueW1jZS9Ob3RpZmljYXRpb25NYW5hZ2VyXCIsXG5cdFwidGlueW1jZS9odG1sL1NjaGVtYVwiLFxuXHRcInRpbnltY2UvaHRtbC9Eb21QYXJzZXJcIixcblx0XCJ0aW55bWNlL3V0aWwvUXVpcmtzXCIsXG5cdFwidGlueW1jZS9FbnZcIixcblx0XCJ0aW55bWNlL3V0aWwvVG9vbHNcIixcblx0XCJ0aW55bWNlL3V0aWwvRGVsYXlcIixcblx0XCJ0aW55bWNlL0VkaXRvck9ic2VydmFibGVcIixcblx0XCJ0aW55bWNlL01vZGVcIixcblx0XCJ0aW55bWNlL1Nob3J0Y3V0c1wiLFxuXHRcInRpbnltY2UvRWRpdG9yVXBsb2FkXCIsXG5cdFwidGlueW1jZS9TZWxlY3Rpb25PdmVycmlkZXNcIixcblx0XCJ0aW55bWNlL3V0aWwvVXVpZFwiLFxuXHRcInRpbnltY2UvdWkvU2lkZWJhclwiXG5dLCBmdW5jdGlvbihcblx0RE9NVXRpbHMsIERvbVF1ZXJ5LCBBZGRPbk1hbmFnZXIsIE5vZGVDaGFuZ2UsIE5vZGUsIERvbVNlcmlhbGl6ZXIsIFNlcmlhbGl6ZXIsXG5cdFNlbGVjdGlvbiwgRm9ybWF0dGVyLCBVbmRvTWFuYWdlciwgRW50ZXJLZXksIEZvcmNlQmxvY2tzLCBFZGl0b3JDb21tYW5kcyxcblx0VVJJLCBTY3JpcHRMb2FkZXIsIEV2ZW50VXRpbHMsIFdpbmRvd01hbmFnZXIsIE5vdGlmaWNhdGlvbk1hbmFnZXIsXG5cdFNjaGVtYSwgRG9tUGFyc2VyLCBRdWlya3MsIEVudiwgVG9vbHMsIERlbGF5LCBFZGl0b3JPYnNlcnZhYmxlLCBNb2RlLCBTaG9ydGN1dHMsIEVkaXRvclVwbG9hZCxcblx0U2VsZWN0aW9uT3ZlcnJpZGVzLCBVdWlkLCBTaWRlYmFyXG4pIHtcblx0Ly8gU2hvcnRlbiB0aGVzZSBuYW1lc1xuXHR2YXIgRE9NID0gRE9NVXRpbHMuRE9NLCBUaGVtZU1hbmFnZXIgPSBBZGRPbk1hbmFnZXIuVGhlbWVNYW5hZ2VyLCBQbHVnaW5NYW5hZ2VyID0gQWRkT25NYW5hZ2VyLlBsdWdpbk1hbmFnZXI7XG5cdHZhciBleHRlbmQgPSBUb29scy5leHRlbmQsIGVhY2ggPSBUb29scy5lYWNoLCBleHBsb2RlID0gVG9vbHMuZXhwbG9kZTtcblx0dmFyIGluQXJyYXkgPSBUb29scy5pbkFycmF5LCB0cmltID0gVG9vbHMudHJpbSwgcmVzb2x2ZSA9IFRvb2xzLnJlc29sdmU7XG5cdHZhciBFdmVudCA9IEV2ZW50VXRpbHMuRXZlbnQ7XG5cdHZhciBpc0dlY2tvID0gRW52LmdlY2tvLCBpZSA9IEVudi5pZTtcblxuXHQvKipcblx0ICogSW5jbHVkZSBkb2N1bWVudGF0aW9uIGZvciBhbGwgdGhlIGV2ZW50cy5cblx0ICpcblx0ICogQGluY2x1ZGUgLi4vLi4vLi4vdG9vbHMvZG9jcy90aW55bWNlLkVkaXRvci5qc1xuXHQgKi9cblxuXHQvKipcblx0ICogQ29uc3RydWN0cyBhIGVkaXRvciBpbnN0YW5jZSBieSBpZC5cblx0ICpcblx0ICogQGNvbnN0cnVjdG9yXG5cdCAqIEBtZXRob2QgRWRpdG9yXG5cdCAqIEBwYXJhbSB7U3RyaW5nfSBpZCBVbmlxdWUgaWQgZm9yIHRoZSBlZGl0b3IuXG5cdCAqIEBwYXJhbSB7T2JqZWN0fSBzZXR0aW5ncyBTZXR0aW5ncyBmb3IgdGhlIGVkaXRvci5cblx0ICogQHBhcmFtIHt0aW55bWNlLkVkaXRvck1hbmFnZXJ9IGVkaXRvck1hbmFnZXIgRWRpdG9yTWFuYWdlciBpbnN0YW5jZS5cblx0ICovXG5cdGZ1bmN0aW9uIEVkaXRvcihpZCwgc2V0dGluZ3MsIGVkaXRvck1hbmFnZXIpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsIGRvY3VtZW50QmFzZVVybCwgYmFzZVVyaSwgZGVmYXVsdFNldHRpbmdzO1xuXG5cdFx0ZG9jdW1lbnRCYXNlVXJsID0gc2VsZi5kb2N1bWVudEJhc2VVcmwgPSBlZGl0b3JNYW5hZ2VyLmRvY3VtZW50QmFzZVVSTDtcblx0XHRiYXNlVXJpID0gZWRpdG9yTWFuYWdlci5iYXNlVVJJO1xuXHRcdGRlZmF1bHRTZXR0aW5ncyA9IGVkaXRvck1hbmFnZXIuZGVmYXVsdFNldHRpbmdzO1xuXG5cdFx0LyoqXG5cdFx0ICogTmFtZS92YWx1ZSBjb2xsZWN0aW9uIHdpdGggZWRpdG9yIHNldHRpbmdzLlxuXHRcdCAqXG5cdFx0ICogQHByb3BlcnR5IHNldHRpbmdzXG5cdFx0ICogQHR5cGUgT2JqZWN0XG5cdFx0ICogQGV4YW1wbGVcblx0XHQgKiAvLyBHZXQgdGhlIHZhbHVlIG9mIHRoZSB0aGVtZSBzZXR0aW5nXG5cdFx0ICogdGlueW1jZS5hY3RpdmVFZGl0b3Iud2luZG93TWFuYWdlci5hbGVydChcIllvdSBhcmUgdXNpbmcgdGhlIFwiICsgdGlueW1jZS5hY3RpdmVFZGl0b3Iuc2V0dGluZ3MudGhlbWUgKyBcIiB0aGVtZVwiKTtcblx0XHQgKi9cblx0XHRzZXR0aW5ncyA9IGV4dGVuZCh7XG5cdFx0XHRpZDogaWQsXG5cdFx0XHR0aGVtZTogJ21vZGVybicsXG5cdFx0XHRkZWx0YV93aWR0aDogMCxcblx0XHRcdGRlbHRhX2hlaWdodDogMCxcblx0XHRcdHBvcHVwX2NzczogJycsXG5cdFx0XHRwbHVnaW5zOiAnJyxcblx0XHRcdGRvY3VtZW50X2Jhc2VfdXJsOiBkb2N1bWVudEJhc2VVcmwsXG5cdFx0XHRhZGRfZm9ybV9zdWJtaXRfdHJpZ2dlcjogdHJ1ZSxcblx0XHRcdHN1Ym1pdF9wYXRjaDogdHJ1ZSxcblx0XHRcdGFkZF91bmxvYWRfdHJpZ2dlcjogdHJ1ZSxcblx0XHRcdGNvbnZlcnRfdXJsczogdHJ1ZSxcblx0XHRcdHJlbGF0aXZlX3VybHM6IHRydWUsXG5cdFx0XHRyZW1vdmVfc2NyaXB0X2hvc3Q6IHRydWUsXG5cdFx0XHRvYmplY3RfcmVzaXppbmc6IHRydWUsXG5cdFx0XHRkb2N0eXBlOiAnPCFET0NUWVBFIGh0bWw+Jyxcblx0XHRcdHZpc3VhbDogdHJ1ZSxcblx0XHRcdGZvbnRfc2l6ZV9zdHlsZV92YWx1ZXM6ICd4eC1zbWFsbCx4LXNtYWxsLHNtYWxsLG1lZGl1bSxsYXJnZSx4LWxhcmdlLHh4LWxhcmdlJyxcblxuXHRcdFx0Ly8gU2VlOiBodHRwOi8vd3d3LnczLm9yZy9UUi9DU1MyL2ZvbnRzLmh0bWwjcHJvcGRlZi1mb250LXNpemVcblx0XHRcdGZvbnRfc2l6ZV9sZWdhY3lfdmFsdWVzOiAneHgtc21hbGwsc21hbGwsbWVkaXVtLGxhcmdlLHgtbGFyZ2UseHgtbGFyZ2UsMzAwJScsXG5cdFx0XHRmb3JjZWRfcm9vdF9ibG9jazogJ3AnLFxuXHRcdFx0aGlkZGVuX2lucHV0OiB0cnVlLFxuXHRcdFx0cGFkZF9lbXB0eV9lZGl0b3I6IHRydWUsXG5cdFx0XHRyZW5kZXJfdWk6IHRydWUsXG5cdFx0XHRpbmRlbnRhdGlvbjogJzMwcHgnLFxuXHRcdFx0aW5saW5lX3N0eWxlczogdHJ1ZSxcblx0XHRcdGNvbnZlcnRfZm9udHNfdG9fc3BhbnM6IHRydWUsXG5cdFx0XHRpbmRlbnQ6ICdzaW1wbGUnLFxuXHRcdFx0aW5kZW50X2JlZm9yZTogJ3AsaDEsaDIsaDMsaDQsaDUsaDYsYmxvY2txdW90ZSxkaXYsdGl0bGUsc3R5bGUscHJlLHNjcmlwdCx0ZCx0aCx1bCxvbCxsaSxkbCxkdCxkZCxhcmVhLHRhYmxlLHRoZWFkLCcgK1xuXHRcdFx0XHQndGZvb3QsdGJvZHksdHIsc2VjdGlvbixhcnRpY2xlLGhncm91cCxhc2lkZSxmaWd1cmUsZmlnY2FwdGlvbixvcHRpb24sb3B0Z3JvdXAsZGF0YWxpc3QnLFxuXHRcdFx0aW5kZW50X2FmdGVyOiAncCxoMSxoMixoMyxoNCxoNSxoNixibG9ja3F1b3RlLGRpdix0aXRsZSxzdHlsZSxwcmUsc2NyaXB0LHRkLHRoLHVsLG9sLGxpLGRsLGR0LGRkLGFyZWEsdGFibGUsdGhlYWQsJyArXG5cdFx0XHRcdCd0Zm9vdCx0Ym9keSx0cixzZWN0aW9uLGFydGljbGUsaGdyb3VwLGFzaWRlLGZpZ3VyZSxmaWdjYXB0aW9uLG9wdGlvbixvcHRncm91cCxkYXRhbGlzdCcsXG5cdFx0XHR2YWxpZGF0ZTogdHJ1ZSxcblx0XHRcdGVudGl0eV9lbmNvZGluZzogJ25hbWVkJyxcblx0XHRcdHVybF9jb252ZXJ0ZXI6IHNlbGYuY29udmVydFVSTCxcblx0XHRcdHVybF9jb252ZXJ0ZXJfc2NvcGU6IHNlbGYsXG5cdFx0XHRpZTdfY29tcGF0OiB0cnVlXG5cdFx0fSwgZGVmYXVsdFNldHRpbmdzLCBzZXR0aW5ncyk7XG5cblx0XHQvLyBNZXJnZSBleHRlcm5hbF9wbHVnaW5zXG5cdFx0aWYgKGRlZmF1bHRTZXR0aW5ncyAmJiBkZWZhdWx0U2V0dGluZ3MuZXh0ZXJuYWxfcGx1Z2lucyAmJiBzZXR0aW5ncy5leHRlcm5hbF9wbHVnaW5zKSB7XG5cdFx0XHRzZXR0aW5ncy5leHRlcm5hbF9wbHVnaW5zID0gZXh0ZW5kKHt9LCBkZWZhdWx0U2V0dGluZ3MuZXh0ZXJuYWxfcGx1Z2lucywgc2V0dGluZ3MuZXh0ZXJuYWxfcGx1Z2lucyk7XG5cdFx0fVxuXG5cdFx0c2VsZi5zZXR0aW5ncyA9IHNldHRpbmdzO1xuXHRcdEFkZE9uTWFuYWdlci5sYW5ndWFnZSA9IHNldHRpbmdzLmxhbmd1YWdlIHx8ICdlbic7XG5cdFx0QWRkT25NYW5hZ2VyLmxhbmd1YWdlTG9hZCA9IHNldHRpbmdzLmxhbmd1YWdlX2xvYWQ7XG5cdFx0QWRkT25NYW5hZ2VyLmJhc2VVUkwgPSBlZGl0b3JNYW5hZ2VyLmJhc2VVUkw7XG5cblx0XHQvKipcblx0XHQgKiBFZGl0b3IgaW5zdGFuY2UgaWQsIG5vcm1hbGx5IHRoZSBzYW1lIGFzIHRoZSBkaXYvdGV4dGFyZWEgdGhhdCB3YXMgcmVwbGFjZWQuXG5cdFx0ICpcblx0XHQgKiBAcHJvcGVydHkgaWRcblx0XHQgKiBAdHlwZSBTdHJpbmdcblx0XHQgKi9cblx0XHRzZWxmLmlkID0gc2V0dGluZ3MuaWQgPSBpZDtcblxuXHRcdC8qKlxuXHRcdCAqIFN0YXRlIHRvIGZvcmNlIHRoZSBlZGl0b3IgdG8gcmV0dXJuIGZhbHNlIG9uIGEgaXNEaXJ0eSBjYWxsLlxuXHRcdCAqXG5cdFx0ICogQHByb3BlcnR5IGlzTm90RGlydHlcblx0XHQgKiBAdHlwZSBCb29sZWFuXG5cdFx0ICogQGRlcHJlY2F0ZWQgVXNlIGVkaXRvci5zZXREaXJ0eSBpbnN0ZWFkLlxuXHRcdCAqL1xuXHRcdHNlbGYuc2V0RGlydHkoZmFsc2UpO1xuXG5cdFx0LyoqXG5cdFx0ICogTmFtZS9WYWx1ZSBvYmplY3QgY29udGFpbmluZyBwbHVnaW4gaW5zdGFuY2VzLlxuXHRcdCAqXG5cdFx0ICogQHByb3BlcnR5IHBsdWdpbnNcblx0XHQgKiBAdHlwZSBPYmplY3Rcblx0XHQgKiBAZXhhbXBsZVxuXHRcdCAqIC8vIEV4ZWN1dGUgYSBtZXRob2QgaW5zaWRlIGEgcGx1Z2luIGRpcmVjdGx5XG5cdFx0ICogdGlueW1jZS5hY3RpdmVFZGl0b3IucGx1Z2lucy5zb21lcGx1Z2luLnNvbWVNZXRob2QoKTtcblx0XHQgKi9cblx0XHRzZWxmLnBsdWdpbnMgPSB7fTtcblxuXHRcdC8qKlxuXHRcdCAqIFVSSSBvYmplY3QgdG8gZG9jdW1lbnQgY29uZmlndXJlZCBmb3IgdGhlIFRpbnlNQ0UgaW5zdGFuY2UuXG5cdFx0ICpcblx0XHQgKiBAcHJvcGVydHkgZG9jdW1lbnRCYXNlVVJJXG5cdFx0ICogQHR5cGUgdGlueW1jZS51dGlsLlVSSVxuXHRcdCAqIEBleGFtcGxlXG5cdFx0ICogLy8gR2V0IHJlbGF0aXZlIFVSTCBmcm9tIHRoZSBsb2NhdGlvbiBvZiBkb2N1bWVudF9iYXNlX3VybFxuXHRcdCAqIHRpbnltY2UuYWN0aXZlRWRpdG9yLmRvY3VtZW50QmFzZVVSSS50b1JlbGF0aXZlKCcvc29tZWRpci9zb21lZmlsZS5odG0nKTtcblx0XHQgKlxuXHRcdCAqIC8vIEdldCBhYnNvbHV0ZSBVUkwgZnJvbSB0aGUgbG9jYXRpb24gb2YgZG9jdW1lbnRfYmFzZV91cmxcblx0XHQgKiB0aW55bWNlLmFjdGl2ZUVkaXRvci5kb2N1bWVudEJhc2VVUkkudG9BYnNvbHV0ZSgnc29tZWZpbGUuaHRtJyk7XG5cdFx0ICovXG5cdFx0c2VsZi5kb2N1bWVudEJhc2VVUkkgPSBuZXcgVVJJKHNldHRpbmdzLmRvY3VtZW50X2Jhc2VfdXJsIHx8IGRvY3VtZW50QmFzZVVybCwge1xuXHRcdFx0YmFzZV91cmk6IGJhc2VVcmlcblx0XHR9KTtcblxuXHRcdC8qKlxuXHRcdCAqIFVSSSBvYmplY3QgdG8gY3VycmVudCBkb2N1bWVudCB0aGF0IGhvbGRzIHRoZSBUaW55TUNFIGVkaXRvciBpbnN0YW5jZS5cblx0XHQgKlxuXHRcdCAqIEBwcm9wZXJ0eSBiYXNlVVJJXG5cdFx0ICogQHR5cGUgdGlueW1jZS51dGlsLlVSSVxuXHRcdCAqIEBleGFtcGxlXG5cdFx0ICogLy8gR2V0IHJlbGF0aXZlIFVSTCBmcm9tIHRoZSBsb2NhdGlvbiBvZiB0aGUgQVBJXG5cdFx0ICogdGlueW1jZS5hY3RpdmVFZGl0b3IuYmFzZVVSSS50b1JlbGF0aXZlKCcvc29tZWRpci9zb21lZmlsZS5odG0nKTtcblx0XHQgKlxuXHRcdCAqIC8vIEdldCBhYnNvbHV0ZSBVUkwgZnJvbSB0aGUgbG9jYXRpb24gb2YgdGhlIEFQSVxuXHRcdCAqIHRpbnltY2UuYWN0aXZlRWRpdG9yLmJhc2VVUkkudG9BYnNvbHV0ZSgnc29tZWZpbGUuaHRtJyk7XG5cdFx0ICovXG5cdFx0c2VsZi5iYXNlVVJJID0gYmFzZVVyaTtcblxuXHRcdC8qKlxuXHRcdCAqIEFycmF5IHdpdGggQ1NTIGZpbGVzIHRvIGxvYWQgaW50byB0aGUgaWZyYW1lLlxuXHRcdCAqXG5cdFx0ICogQHByb3BlcnR5IGNvbnRlbnRDU1Ncblx0XHQgKiBAdHlwZSBBcnJheVxuXHRcdCAqL1xuXHRcdHNlbGYuY29udGVudENTUyA9IFtdO1xuXG5cdFx0LyoqXG5cdFx0ICogQXJyYXkgb2YgQ1NTIHN0eWxlcyB0byBhZGQgdG8gaGVhZCBvZiBkb2N1bWVudCB3aGVuIHRoZSBlZGl0b3IgbG9hZHMuXG5cdFx0ICpcblx0XHQgKiBAcHJvcGVydHkgY29udGVudFN0eWxlc1xuXHRcdCAqIEB0eXBlIEFycmF5XG5cdFx0ICovXG5cdFx0c2VsZi5jb250ZW50U3R5bGVzID0gW107XG5cblx0XHQvLyBDcmVhdGVzIGFsbCBldmVudHMgbGlrZSBvbkNsaWNrLCBvblNldENvbnRlbnQgZXRjIHNlZSBFZGl0b3IuRXZlbnRzLmpzIGZvciB0aGUgYWN0dWFsIGxvZ2ljXG5cdFx0c2VsZi5zaG9ydGN1dHMgPSBuZXcgU2hvcnRjdXRzKHNlbGYpO1xuXHRcdHNlbGYubG9hZGVkQ1NTID0ge307XG5cdFx0c2VsZi5lZGl0b3JDb21tYW5kcyA9IG5ldyBFZGl0b3JDb21tYW5kcyhzZWxmKTtcblx0XHRzZWxmLnN1ZmZpeCA9IGVkaXRvck1hbmFnZXIuc3VmZml4O1xuXHRcdHNlbGYuZWRpdG9yTWFuYWdlciA9IGVkaXRvck1hbmFnZXI7XG5cdFx0c2VsZi5pbmxpbmUgPSBzZXR0aW5ncy5pbmxpbmU7XG5cdFx0c2VsZi5zZXR0aW5ncy5jb250ZW50X2VkaXRhYmxlID0gc2VsZi5pbmxpbmU7XG5cblx0XHRpZiAoc2V0dGluZ3MuY2FjaGVfc3VmZml4KSB7XG5cdFx0XHRFbnYuY2FjaGVTdWZmaXggPSBzZXR0aW5ncy5jYWNoZV9zdWZmaXgucmVwbGFjZSgvXltcXD9cXCZdKy8sICcnKTtcblx0XHR9XG5cblx0XHRpZiAoc2V0dGluZ3Mub3ZlcnJpZGVfdmlld3BvcnQgPT09IGZhbHNlKSB7XG5cdFx0XHRFbnYub3ZlcnJpZGVWaWV3UG9ydCA9IGZhbHNlO1xuXHRcdH1cblxuXHRcdC8vIENhbGwgc2V0dXBcblx0XHRlZGl0b3JNYW5hZ2VyLmZpcmUoJ1NldHVwRWRpdG9yJywgc2VsZik7XG5cdFx0c2VsZi5leGVjQ2FsbGJhY2soJ3NldHVwJywgc2VsZik7XG5cblx0XHQvKipcblx0XHQgKiBEb20gcXVlcnkgaW5zdGFuY2Ugd2l0aCBkZWZhdWx0IHNjb3BlIHRvIHRoZSBlZGl0b3IgZG9jdW1lbnQgYW5kIGRlZmF1bHQgZWxlbWVudCBpcyB0aGUgYm9keSBvZiB0aGUgZWRpdG9yLlxuXHRcdCAqXG5cdFx0ICogQHByb3BlcnR5ICRcblx0XHQgKiBAdHlwZSB0aW55bWNlLmRvbS5Eb21RdWVyeVxuXHRcdCAqIEBleGFtcGxlXG5cdFx0ICogdGlueW1jZS5hY3RpdmVFZGl0b3IuJCgncCcpLmNzcygnY29sb3InLCAncmVkJyk7XG5cdFx0ICogdGlueW1jZS5hY3RpdmVFZGl0b3IuJCgpLmFwcGVuZCgnPHA+bmV3PC9wPicpO1xuXHRcdCAqL1xuXHRcdHNlbGYuJCA9IERvbVF1ZXJ5Lm92ZXJyaWRlRGVmYXVsdHMoZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4ge1xuXHRcdFx0XHRjb250ZXh0OiBzZWxmLmlubGluZSA/IHNlbGYuZ2V0Qm9keSgpIDogc2VsZi5nZXREb2MoKSxcblx0XHRcdFx0ZWxlbWVudDogc2VsZi5nZXRCb2R5KClcblx0XHRcdH07XG5cdFx0fSk7XG5cdH1cblxuXHRFZGl0b3IucHJvdG90eXBlID0ge1xuXHRcdC8qKlxuXHRcdCAqIFJlbmRlcnMgdGhlIGVkaXRvci9hZGRzIGl0IHRvIHRoZSBwYWdlLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCByZW5kZXJcblx0XHQgKi9cblx0XHRyZW5kZXI6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLCBzZXR0aW5ncyA9IHNlbGYuc2V0dGluZ3MsIGlkID0gc2VsZi5pZCwgc3VmZml4ID0gc2VsZi5zdWZmaXg7XG5cblx0XHRcdGZ1bmN0aW9uIHJlYWR5SGFuZGxlcigpIHtcblx0XHRcdFx0RE9NLnVuYmluZCh3aW5kb3csICdyZWFkeScsIHJlYWR5SGFuZGxlcik7XG5cdFx0XHRcdHNlbGYucmVuZGVyKCk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIFBhZ2UgaXMgbm90IGxvYWRlZCB5ZXQsIHdhaXQgZm9yIGl0XG5cdFx0XHRpZiAoIUV2ZW50LmRvbUxvYWRlZCkge1xuXHRcdFx0XHRET00uYmluZCh3aW5kb3csICdyZWFkeScsIHJlYWR5SGFuZGxlcik7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0Ly8gRWxlbWVudCBub3QgZm91bmQsIHRoZW4gc2tpcCBpbml0aWFsaXphdGlvblxuXHRcdFx0aWYgKCFzZWxmLmdldEVsZW1lbnQoKSkge1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdC8vIE5vIGVkaXRhYmxlIHN1cHBvcnQgb2xkIGlPUyB2ZXJzaW9ucyBldGNcblx0XHRcdGlmICghRW52LmNvbnRlbnRFZGl0YWJsZSkge1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdC8vIEhpZGUgdGFyZ2V0IGVsZW1lbnQgZWFybHkgdG8gcHJldmVudCBjb250ZW50IGZsYXNoaW5nXG5cdFx0XHRpZiAoIXNldHRpbmdzLmlubGluZSkge1xuXHRcdFx0XHRzZWxmLm9yZ1Zpc2liaWxpdHkgPSBzZWxmLmdldEVsZW1lbnQoKS5zdHlsZS52aXNpYmlsaXR5O1xuXHRcdFx0XHRzZWxmLmdldEVsZW1lbnQoKS5zdHlsZS52aXNpYmlsaXR5ID0gJ2hpZGRlbic7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRzZWxmLmlubGluZSA9IHRydWU7XG5cdFx0XHR9XG5cblx0XHRcdHZhciBmb3JtID0gc2VsZi5nZXRFbGVtZW50KCkuZm9ybSB8fCBET00uZ2V0UGFyZW50KGlkLCAnZm9ybScpO1xuXHRcdFx0aWYgKGZvcm0pIHtcblx0XHRcdFx0c2VsZi5mb3JtRWxlbWVudCA9IGZvcm07XG5cblx0XHRcdFx0Ly8gQWRkIGhpZGRlbiBpbnB1dCBmb3Igbm9uIGlucHV0IGVsZW1lbnRzIGluc2lkZSBmb3JtIGVsZW1lbnRzXG5cdFx0XHRcdGlmIChzZXR0aW5ncy5oaWRkZW5faW5wdXQgJiYgIS9URVhUQVJFQXxJTlBVVC9pLnRlc3Qoc2VsZi5nZXRFbGVtZW50KCkubm9kZU5hbWUpKSB7XG5cdFx0XHRcdFx0RE9NLmluc2VydEFmdGVyKERPTS5jcmVhdGUoJ2lucHV0Jywge3R5cGU6ICdoaWRkZW4nLCBuYW1lOiBpZH0pLCBpZCk7XG5cdFx0XHRcdFx0c2VsZi5oYXNIaWRkZW5JbnB1dCA9IHRydWU7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBQYXNzIHN1Ym1pdC9yZXNldCBmcm9tIGZvcm0gdG8gZWRpdG9yIGluc3RhbmNlXG5cdFx0XHRcdHNlbGYuZm9ybUV2ZW50RGVsZWdhdGUgPSBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdFx0c2VsZi5maXJlKGUudHlwZSwgZSk7XG5cdFx0XHRcdH07XG5cblx0XHRcdFx0RE9NLmJpbmQoZm9ybSwgJ3N1Ym1pdCByZXNldCcsIHNlbGYuZm9ybUV2ZW50RGVsZWdhdGUpO1xuXG5cdFx0XHRcdC8vIFJlc2V0IGNvbnRlbnRzIGluIGVkaXRvciB3aGVuIHRoZSBmb3JtIGlzIHJlc2V0XG5cdFx0XHRcdHNlbGYub24oJ3Jlc2V0JywgZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0c2VsZi5zZXRDb250ZW50KHNlbGYuc3RhcnRDb250ZW50LCB7Zm9ybWF0OiAncmF3J30pO1xuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHQvLyBDaGVjayBwYWdlIHVzZXMgaWQ9XCJzdWJtaXRcIiBvciBuYW1lPVwic3VibWl0XCIgZm9yIGl0J3Mgc3VibWl0IGJ1dHRvblxuXHRcdFx0XHRpZiAoc2V0dGluZ3Muc3VibWl0X3BhdGNoICYmICFmb3JtLnN1Ym1pdC5ub2RlVHlwZSAmJiAhZm9ybS5zdWJtaXQubGVuZ3RoICYmICFmb3JtLl9tY2VPbGRTdWJtaXQpIHtcblx0XHRcdFx0XHRmb3JtLl9tY2VPbGRTdWJtaXQgPSBmb3JtLnN1Ym1pdDtcblx0XHRcdFx0XHRmb3JtLnN1Ym1pdCA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdFx0c2VsZi5lZGl0b3JNYW5hZ2VyLnRyaWdnZXJTYXZlKCk7XG5cdFx0XHRcdFx0XHRzZWxmLnNldERpcnR5KGZhbHNlKTtcblxuXHRcdFx0XHRcdFx0cmV0dXJuIGZvcm0uX21jZU9sZFN1Ym1pdChmb3JtKTtcblx0XHRcdFx0XHR9O1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdC8qKlxuXHRcdFx0ICogV2luZG93IG1hbmFnZXIgcmVmZXJlbmNlLCB1c2UgdGhpcyB0byBvcGVuIG5ldyB3aW5kb3dzIGFuZCBkaWFsb2dzLlxuXHRcdFx0ICpcblx0XHRcdCAqIEBwcm9wZXJ0eSB3aW5kb3dNYW5hZ2VyXG5cdFx0XHQgKiBAdHlwZSB0aW55bWNlLldpbmRvd01hbmFnZXJcblx0XHRcdCAqIEBleGFtcGxlXG5cdFx0XHQgKiAvLyBTaG93cyBhbiBhbGVydCBtZXNzYWdlXG5cdFx0XHQgKiB0aW55bWNlLmFjdGl2ZUVkaXRvci53aW5kb3dNYW5hZ2VyLmFsZXJ0KCdIZWxsbyB3b3JsZCEnKTtcblx0XHRcdCAqXG5cdFx0XHQgKiAvLyBPcGVucyBhIG5ldyBkaWFsb2cgd2l0aCB0aGUgZmlsZS5odG0gZmlsZSBhbmQgdGhlIHNpemUgMzIweDI0MFxuXHRcdFx0ICogLy8gSXQgYWxzbyBhZGRzIGEgY3VzdG9tIHBhcmFtZXRlciB0aGlzIGNhbiBiZSByZXRyaWV2ZWQgYnkgdXNpbmcgdGlueU1DRVBvcHVwLmdldFdpbmRvd0FyZyBpbnNpZGUgdGhlIGRpYWxvZy5cblx0XHRcdCAqIHRpbnltY2UuYWN0aXZlRWRpdG9yLndpbmRvd01hbmFnZXIub3Blbih7XG5cdFx0XHQgKiAgICB1cmw6ICdmaWxlLmh0bScsXG5cdFx0XHQgKiAgICB3aWR0aDogMzIwLFxuXHRcdFx0ICogICAgaGVpZ2h0OiAyNDBcblx0XHRcdCAqIH0sIHtcblx0XHRcdCAqICAgIGN1c3RvbV9wYXJhbTogMVxuXHRcdFx0ICogfSk7XG5cdFx0XHQgKi9cblx0XHRcdHNlbGYud2luZG93TWFuYWdlciA9IG5ldyBXaW5kb3dNYW5hZ2VyKHNlbGYpO1xuXG5cdFx0XHQvKipcblx0XHRcdCAqIE5vdGlmaWNhdGlvbiBtYW5hZ2VyIHJlZmVyZW5jZSwgdXNlIHRoaXMgdG8gb3BlbiBuZXcgd2luZG93cyBhbmQgZGlhbG9ncy5cblx0XHRcdCAqXG5cdFx0XHQgKiBAcHJvcGVydHkgbm90aWZpY2F0aW9uTWFuYWdlclxuXHRcdFx0ICogQHR5cGUgdGlueW1jZS5Ob3RpZmljYXRpb25NYW5hZ2VyXG5cdFx0XHQgKiBAZXhhbXBsZVxuXHRcdFx0ICogLy8gU2hvd3MgYSBub3RpZmljYXRpb24gaW5mbyBtZXNzYWdlLlxuXHRcdFx0ICogdGlueW1jZS5hY3RpdmVFZGl0b3Iubm90aWZpY2F0aW9uTWFuYWdlci5vcGVuKHt0ZXh0OiAnSGVsbG8gd29ybGQhJywgdHlwZTogJ2luZm8nfSk7XG5cdFx0XHQgKi9cblx0XHRcdHNlbGYubm90aWZpY2F0aW9uTWFuYWdlciA9IG5ldyBOb3RpZmljYXRpb25NYW5hZ2VyKHNlbGYpO1xuXG5cdFx0XHRpZiAoc2V0dGluZ3MuZW5jb2RpbmcgPT0gJ3htbCcpIHtcblx0XHRcdFx0c2VsZi5vbignR2V0Q29udGVudCcsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0XHRpZiAoZS5zYXZlKSB7XG5cdFx0XHRcdFx0XHRlLmNvbnRlbnQgPSBET00uZW5jb2RlKGUuY29udGVudCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHNldHRpbmdzLmFkZF9mb3JtX3N1Ym1pdF90cmlnZ2VyKSB7XG5cdFx0XHRcdHNlbGYub24oJ3N1Ym1pdCcsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdGlmIChzZWxmLmluaXRpYWxpemVkKSB7XG5cdFx0XHRcdFx0XHRzZWxmLnNhdmUoKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoc2V0dGluZ3MuYWRkX3VubG9hZF90cmlnZ2VyKSB7XG5cdFx0XHRcdHNlbGYuX2JlZm9yZVVubG9hZCA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdGlmIChzZWxmLmluaXRpYWxpemVkICYmICFzZWxmLmRlc3Ryb3llZCAmJiAhc2VsZi5pc0hpZGRlbigpKSB7XG5cdFx0XHRcdFx0XHRzZWxmLnNhdmUoe2Zvcm1hdDogJ3JhdycsIG5vX2V2ZW50czogdHJ1ZSwgc2V0X2RpcnR5OiBmYWxzZX0pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fTtcblxuXHRcdFx0XHRzZWxmLmVkaXRvck1hbmFnZXIub24oJ0JlZm9yZVVubG9hZCcsIHNlbGYuX2JlZm9yZVVubG9hZCk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIExvYWQgc2NyaXB0c1xuXHRcdFx0ZnVuY3Rpb24gbG9hZFNjcmlwdHMoKSB7XG5cdFx0XHRcdHZhciBzY3JpcHRMb2FkZXIgPSBTY3JpcHRMb2FkZXIuU2NyaXB0TG9hZGVyO1xuXG5cdFx0XHRcdGlmIChzZXR0aW5ncy5sYW5ndWFnZSAmJiBzZXR0aW5ncy5sYW5ndWFnZSAhPSAnZW4nICYmICFzZXR0aW5ncy5sYW5ndWFnZV91cmwpIHtcblx0XHRcdFx0XHRzZXR0aW5ncy5sYW5ndWFnZV91cmwgPSBzZWxmLmVkaXRvck1hbmFnZXIuYmFzZVVSTCArICcvbGFuZ3MvJyArIHNldHRpbmdzLmxhbmd1YWdlICsgJy5qcyc7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoc2V0dGluZ3MubGFuZ3VhZ2VfdXJsKSB7XG5cdFx0XHRcdFx0c2NyaXB0TG9hZGVyLmFkZChzZXR0aW5ncy5sYW5ndWFnZV91cmwpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHNldHRpbmdzLnRoZW1lICYmIHR5cGVvZiBzZXR0aW5ncy50aGVtZSAhPSBcImZ1bmN0aW9uXCIgJiZcblx0XHRcdFx0XHRzZXR0aW5ncy50aGVtZS5jaGFyQXQoMCkgIT0gJy0nICYmICFUaGVtZU1hbmFnZXIudXJsc1tzZXR0aW5ncy50aGVtZV0pIHtcblx0XHRcdFx0XHR2YXIgdGhlbWVVcmwgPSBzZXR0aW5ncy50aGVtZV91cmw7XG5cblx0XHRcdFx0XHRpZiAodGhlbWVVcmwpIHtcblx0XHRcdFx0XHRcdHRoZW1lVXJsID0gc2VsZi5kb2N1bWVudEJhc2VVUkkudG9BYnNvbHV0ZSh0aGVtZVVybCk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdHRoZW1lVXJsID0gJ3RoZW1lcy8nICsgc2V0dGluZ3MudGhlbWUgKyAnL3RoZW1lJyArIHN1ZmZpeCArICcuanMnO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFRoZW1lTWFuYWdlci5sb2FkKHNldHRpbmdzLnRoZW1lLCB0aGVtZVVybCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoVG9vbHMuaXNBcnJheShzZXR0aW5ncy5wbHVnaW5zKSkge1xuXHRcdFx0XHRcdHNldHRpbmdzLnBsdWdpbnMgPSBzZXR0aW5ncy5wbHVnaW5zLmpvaW4oJyAnKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGVhY2goc2V0dGluZ3MuZXh0ZXJuYWxfcGx1Z2lucywgZnVuY3Rpb24odXJsLCBuYW1lKSB7XG5cdFx0XHRcdFx0UGx1Z2luTWFuYWdlci5sb2FkKG5hbWUsIHVybCk7XG5cdFx0XHRcdFx0c2V0dGluZ3MucGx1Z2lucyArPSAnICcgKyBuYW1lO1xuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHRlYWNoKHNldHRpbmdzLnBsdWdpbnMuc3BsaXQoL1sgLF0vKSwgZnVuY3Rpb24ocGx1Z2luKSB7XG5cdFx0XHRcdFx0cGx1Z2luID0gdHJpbShwbHVnaW4pO1xuXG5cdFx0XHRcdFx0aWYgKHBsdWdpbiAmJiAhUGx1Z2luTWFuYWdlci51cmxzW3BsdWdpbl0pIHtcblx0XHRcdFx0XHRcdGlmIChwbHVnaW4uY2hhckF0KDApID09ICctJykge1xuXHRcdFx0XHRcdFx0XHRwbHVnaW4gPSBwbHVnaW4uc3Vic3RyKDEsIHBsdWdpbi5sZW5ndGgpO1xuXG5cdFx0XHRcdFx0XHRcdHZhciBkZXBlbmRlbmNpZXMgPSBQbHVnaW5NYW5hZ2VyLmRlcGVuZGVuY2llcyhwbHVnaW4pO1xuXG5cdFx0XHRcdFx0XHRcdGVhY2goZGVwZW5kZW5jaWVzLCBmdW5jdGlvbihkZXApIHtcblx0XHRcdFx0XHRcdFx0XHR2YXIgZGVmYXVsdFNldHRpbmdzID0ge1xuXHRcdFx0XHRcdFx0XHRcdFx0cHJlZml4OiAncGx1Z2lucy8nLFxuXHRcdFx0XHRcdFx0XHRcdFx0cmVzb3VyY2U6IGRlcCxcblx0XHRcdFx0XHRcdFx0XHRcdHN1ZmZpeDogJy9wbHVnaW4nICsgc3VmZml4ICsgJy5qcydcblx0XHRcdFx0XHRcdFx0XHR9O1xuXG5cdFx0XHRcdFx0XHRcdFx0ZGVwID0gUGx1Z2luTWFuYWdlci5jcmVhdGVVcmwoZGVmYXVsdFNldHRpbmdzLCBkZXApO1xuXHRcdFx0XHRcdFx0XHRcdFBsdWdpbk1hbmFnZXIubG9hZChkZXAucmVzb3VyY2UsIGRlcCk7XG5cdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0UGx1Z2luTWFuYWdlci5sb2FkKHBsdWdpbiwge1xuXHRcdFx0XHRcdFx0XHRcdHByZWZpeDogJ3BsdWdpbnMvJyxcblx0XHRcdFx0XHRcdFx0XHRyZXNvdXJjZTogcGx1Z2luLFxuXHRcdFx0XHRcdFx0XHRcdHN1ZmZpeDogJy9wbHVnaW4nICsgc3VmZml4ICsgJy5qcydcblx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHRzY3JpcHRMb2FkZXIubG9hZFF1ZXVlKGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdGlmICghc2VsZi5yZW1vdmVkKSB7XG5cdFx0XHRcdFx0XHRzZWxmLmluaXQoKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRzZWxmLmVkaXRvck1hbmFnZXIuYWRkKHNlbGYpO1xuXHRcdFx0bG9hZFNjcmlwdHMoKTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogSW5pdGlhbGl6ZXMgdGhlIGVkaXRvciB0aGlzIHdpbGwgYmUgY2FsbGVkIGF1dG9tYXRpY2FsbHkgd2hlblxuXHRcdCAqIGFsbCBwbHVnaW5zL3RoZW1lcyBhbmQgbGFuZ3VhZ2UgcGFja3MgYXJlIGxvYWRlZCBieSB0aGUgcmVuZGVyZWQgbWV0aG9kLlxuXHRcdCAqIFRoaXMgbWV0aG9kIHdpbGwgc2V0dXAgdGhlIGlmcmFtZSBhbmQgY3JlYXRlIHRoZSB0aGVtZSBhbmQgcGx1Z2luIGluc3RhbmNlcy5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgaW5pdFxuXHRcdCAqL1xuXHRcdGluaXQ6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLCBzZXR0aW5ncyA9IHNlbGYuc2V0dGluZ3MsIGVsbSA9IHNlbGYuZ2V0RWxlbWVudCgpO1xuXHRcdFx0dmFyIHcsIGgsIG1pbkhlaWdodCwgbiwgbywgVGhlbWUsIHVybCwgYm9keUlkLCBib2R5Q2xhc3MsIHJlLCBpLCBpbml0aWFsaXplZFBsdWdpbnMgPSBbXTtcblxuXHRcdFx0c2VsZi5ydGwgPSBzZXR0aW5ncy5ydGxfdWkgfHwgc2VsZi5lZGl0b3JNYW5hZ2VyLmkxOG4ucnRsO1xuXHRcdFx0c2VsZi5lZGl0b3JNYW5hZ2VyLmkxOG4uc2V0Q29kZShzZXR0aW5ncy5sYW5ndWFnZSk7XG5cdFx0XHRzZXR0aW5ncy5hcmlhX2xhYmVsID0gc2V0dGluZ3MuYXJpYV9sYWJlbCB8fCBET00uZ2V0QXR0cmliKGVsbSwgJ2FyaWEtbGFiZWwnLCBzZWxmLmdldExhbmcoJ2FyaWEucmljaF90ZXh0X2FyZWEnKSk7XG5cblx0XHRcdHNlbGYuZmlyZSgnU2NyaXB0c0xvYWRlZCcpO1xuXG5cdFx0XHQvKipcblx0XHRcdCAqIFJlZmVyZW5jZSB0byB0aGUgdGhlbWUgaW5zdGFuY2UgdGhhdCB3YXMgdXNlZCB0byBnZW5lcmF0ZSB0aGUgVUkuXG5cdFx0XHQgKlxuXHRcdFx0ICogQHByb3BlcnR5IHRoZW1lXG5cdFx0XHQgKiBAdHlwZSB0aW55bWNlLlRoZW1lXG5cdFx0XHQgKiBAZXhhbXBsZVxuXHRcdFx0ICogLy8gRXhlY3V0ZXMgYSBtZXRob2Qgb24gdGhlIHRoZW1lIGRpcmVjdGx5XG5cdFx0XHQgKiB0aW55bWNlLmFjdGl2ZUVkaXRvci50aGVtZS5zb21lTWV0aG9kKCk7XG5cdFx0XHQgKi9cblx0XHRcdGlmIChzZXR0aW5ncy50aGVtZSkge1xuXHRcdFx0XHRpZiAodHlwZW9mIHNldHRpbmdzLnRoZW1lICE9IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdHNldHRpbmdzLnRoZW1lID0gc2V0dGluZ3MudGhlbWUucmVwbGFjZSgvLS8sICcnKTtcblx0XHRcdFx0XHRUaGVtZSA9IFRoZW1lTWFuYWdlci5nZXQoc2V0dGluZ3MudGhlbWUpO1xuXHRcdFx0XHRcdHNlbGYudGhlbWUgPSBuZXcgVGhlbWUoc2VsZiwgVGhlbWVNYW5hZ2VyLnVybHNbc2V0dGluZ3MudGhlbWVdKTtcblxuXHRcdFx0XHRcdGlmIChzZWxmLnRoZW1lLmluaXQpIHtcblx0XHRcdFx0XHRcdHNlbGYudGhlbWUuaW5pdChzZWxmLCBUaGVtZU1hbmFnZXIudXJsc1tzZXR0aW5ncy50aGVtZV0gfHwgc2VsZi5kb2N1bWVudEJhc2VVcmwucmVwbGFjZSgvXFwvJC8sICcnKSwgc2VsZi4kKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0c2VsZi50aGVtZSA9IHNldHRpbmdzLnRoZW1lO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIGluaXRQbHVnaW4ocGx1Z2luKSB7XG5cdFx0XHRcdHZhciBQbHVnaW4gPSBQbHVnaW5NYW5hZ2VyLmdldChwbHVnaW4pLCBwbHVnaW5VcmwsIHBsdWdpbkluc3RhbmNlO1xuXG5cdFx0XHRcdHBsdWdpblVybCA9IFBsdWdpbk1hbmFnZXIudXJsc1twbHVnaW5dIHx8IHNlbGYuZG9jdW1lbnRCYXNlVXJsLnJlcGxhY2UoL1xcLyQvLCAnJyk7XG5cdFx0XHRcdHBsdWdpbiA9IHRyaW0ocGx1Z2luKTtcblx0XHRcdFx0aWYgKFBsdWdpbiAmJiBpbkFycmF5KGluaXRpYWxpemVkUGx1Z2lucywgcGx1Z2luKSA9PT0gLTEpIHtcblx0XHRcdFx0XHRlYWNoKFBsdWdpbk1hbmFnZXIuZGVwZW5kZW5jaWVzKHBsdWdpbiksIGZ1bmN0aW9uKGRlcCkge1xuXHRcdFx0XHRcdFx0aW5pdFBsdWdpbihkZXApO1xuXHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0aWYgKHNlbGYucGx1Z2luc1twbHVnaW5dKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cGx1Z2luSW5zdGFuY2UgPSBuZXcgUGx1Z2luKHNlbGYsIHBsdWdpblVybCwgc2VsZi4kKTtcblxuXHRcdFx0XHRcdHNlbGYucGx1Z2luc1twbHVnaW5dID0gcGx1Z2luSW5zdGFuY2U7XG5cblx0XHRcdFx0XHRpZiAocGx1Z2luSW5zdGFuY2UuaW5pdCkge1xuXHRcdFx0XHRcdFx0cGx1Z2luSW5zdGFuY2UuaW5pdChzZWxmLCBwbHVnaW5VcmwpO1xuXHRcdFx0XHRcdFx0aW5pdGlhbGl6ZWRQbHVnaW5zLnB1c2gocGx1Z2luKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0Ly8gQ3JlYXRlIGFsbCBwbHVnaW5zXG5cdFx0XHRlYWNoKHNldHRpbmdzLnBsdWdpbnMucmVwbGFjZSgvXFwtL2csICcnKS5zcGxpdCgvWyAsXS8pLCBpbml0UGx1Z2luKTtcblxuXHRcdFx0Ly8gTWVhc3VyZSBib3hcblx0XHRcdGlmIChzZXR0aW5ncy5yZW5kZXJfdWkgJiYgc2VsZi50aGVtZSkge1xuXHRcdFx0XHRzZWxmLm9yZ0Rpc3BsYXkgPSBlbG0uc3R5bGUuZGlzcGxheTtcblxuXHRcdFx0XHRpZiAodHlwZW9mIHNldHRpbmdzLnRoZW1lICE9IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdHcgPSBzZXR0aW5ncy53aWR0aCB8fCBlbG0uc3R5bGUud2lkdGggfHwgZWxtLm9mZnNldFdpZHRoO1xuXHRcdFx0XHRcdGggPSBzZXR0aW5ncy5oZWlnaHQgfHwgZWxtLnN0eWxlLmhlaWdodCB8fCBlbG0ub2Zmc2V0SGVpZ2h0O1xuXHRcdFx0XHRcdG1pbkhlaWdodCA9IHNldHRpbmdzLm1pbl9oZWlnaHQgfHwgMTAwO1xuXHRcdFx0XHRcdHJlID0gL15bMC05XFwuXSsofHB4KSQvaTtcblxuXHRcdFx0XHRcdGlmIChyZS50ZXN0KCcnICsgdykpIHtcblx0XHRcdFx0XHRcdHcgPSBNYXRoLm1heChwYXJzZUludCh3LCAxMCksIDEwMCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHJlLnRlc3QoJycgKyBoKSkge1xuXHRcdFx0XHRcdFx0aCA9IE1hdGgubWF4KHBhcnNlSW50KGgsIDEwKSwgbWluSGVpZ2h0KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHQvLyBSZW5kZXIgVUlcblx0XHRcdFx0XHRvID0gc2VsZi50aGVtZS5yZW5kZXJVSSh7XG5cdFx0XHRcdFx0XHR0YXJnZXROb2RlOiBlbG0sXG5cdFx0XHRcdFx0XHR3aWR0aDogdyxcblx0XHRcdFx0XHRcdGhlaWdodDogaCxcblx0XHRcdFx0XHRcdGRlbHRhV2lkdGg6IHNldHRpbmdzLmRlbHRhX3dpZHRoLFxuXHRcdFx0XHRcdFx0ZGVsdGFIZWlnaHQ6IHNldHRpbmdzLmRlbHRhX2hlaWdodFxuXHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0Ly8gUmVzaXplIGVkaXRvclxuXHRcdFx0XHRcdGlmICghc2V0dGluZ3MuY29udGVudF9lZGl0YWJsZSkge1xuXHRcdFx0XHRcdFx0aCA9IChvLmlmcmFtZUhlaWdodCB8fCBoKSArICh0eXBlb2YgaCA9PSAnbnVtYmVyJyA/IChvLmRlbHRhSGVpZ2h0IHx8IDApIDogJycpO1xuXHRcdFx0XHRcdFx0aWYgKGggPCBtaW5IZWlnaHQpIHtcblx0XHRcdFx0XHRcdFx0aCA9IG1pbkhlaWdodDtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0byA9IHNldHRpbmdzLnRoZW1lKHNlbGYsIGVsbSk7XG5cblx0XHRcdFx0XHRpZiAoby5lZGl0b3JDb250YWluZXIubm9kZVR5cGUpIHtcblx0XHRcdFx0XHRcdG8uZWRpdG9yQ29udGFpbmVyLmlkID0gby5lZGl0b3JDb250YWluZXIuaWQgfHwgc2VsZi5pZCArIFwiX3BhcmVudFwiO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmIChvLmlmcmFtZUNvbnRhaW5lci5ub2RlVHlwZSkge1xuXHRcdFx0XHRcdFx0by5pZnJhbWVDb250YWluZXIuaWQgPSBvLmlmcmFtZUNvbnRhaW5lci5pZCB8fCBzZWxmLmlkICsgXCJfaWZyYW1lY29udGFpbmVyXCI7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Ly8gVXNlIHNwZWNpZmllZCBpZnJhbWUgaGVpZ2h0IG9yIHRoZSB0YXJnZXRzIG9mZnNldEhlaWdodFxuXHRcdFx0XHRcdGggPSBvLmlmcmFtZUhlaWdodCB8fCBlbG0ub2Zmc2V0SGVpZ2h0O1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0c2VsZi5lZGl0b3JDb250YWluZXIgPSBvLmVkaXRvckNvbnRhaW5lcjtcblx0XHRcdH1cblxuXHRcdFx0Ly8gTG9hZCBzcGVjaWZpZWQgY29udGVudCBDU1MgbGFzdFxuXHRcdFx0aWYgKHNldHRpbmdzLmNvbnRlbnRfY3NzKSB7XG5cdFx0XHRcdGVhY2goZXhwbG9kZShzZXR0aW5ncy5jb250ZW50X2NzcyksIGZ1bmN0aW9uKHUpIHtcblx0XHRcdFx0XHRzZWxmLmNvbnRlbnRDU1MucHVzaChzZWxmLmRvY3VtZW50QmFzZVVSSS50b0Fic29sdXRlKHUpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIExvYWQgc3BlY2lmaWVkIGNvbnRlbnQgQ1NTIGxhc3Rcblx0XHRcdGlmIChzZXR0aW5ncy5jb250ZW50X3N0eWxlKSB7XG5cdFx0XHRcdHNlbGYuY29udGVudFN0eWxlcy5wdXNoKHNldHRpbmdzLmNvbnRlbnRfc3R5bGUpO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBDb250ZW50IGVkaXRhYmxlIG1vZGUgZW5kcyBoZXJlXG5cdFx0XHRpZiAoc2V0dGluZ3MuY29udGVudF9lZGl0YWJsZSkge1xuXHRcdFx0XHRlbG0gPSBuID0gbyA9IG51bGw7IC8vIEZpeCBJRSBsZWFrXG5cdFx0XHRcdHJldHVybiBzZWxmLmluaXRDb250ZW50Qm9keSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRzZWxmLmlmcmFtZUhUTUwgPSBzZXR0aW5ncy5kb2N0eXBlICsgJzxodG1sPjxoZWFkPic7XG5cblx0XHRcdC8vIFdlIG9ubHkgbmVlZCB0byBvdmVycmlkZSBwYXRocyBpZiB3ZSBoYXZlIHRvXG5cdFx0XHQvLyBJRSBoYXMgYSBidWcgd2hlcmUgaXQgcmVtb3ZlIHNpdGUgYWJzb2x1dGUgdXJscyB0byByZWxhdGl2ZSBvbmVzIGlmIHRoaXMgaXMgc3BlY2lmaWVkXG5cdFx0XHRpZiAoc2V0dGluZ3MuZG9jdW1lbnRfYmFzZV91cmwgIT0gc2VsZi5kb2N1bWVudEJhc2VVcmwpIHtcblx0XHRcdFx0c2VsZi5pZnJhbWVIVE1MICs9ICc8YmFzZSBocmVmPVwiJyArIHNlbGYuZG9jdW1lbnRCYXNlVVJJLmdldFVSSSgpICsgJ1wiIC8+Jztcblx0XHRcdH1cblxuXHRcdFx0Ly8gSUU4IGRvZXNuJ3Qgc3VwcG9ydCBjYXJldHMgYmVoaW5kIGltYWdlcyBzZXR0aW5nIGllN19jb21wYXQgd291bGQgZm9yY2UgSUU4KyB0byBydW4gaW4gSUU3IGNvbXBhdCBtb2RlLlxuXHRcdFx0aWYgKCFFbnYuY2FyZXRBZnRlciAmJiBzZXR0aW5ncy5pZTdfY29tcGF0KSB7XG5cdFx0XHRcdHNlbGYuaWZyYW1lSFRNTCArPSAnPG1ldGEgaHR0cC1lcXVpdj1cIlgtVUEtQ29tcGF0aWJsZVwiIGNvbnRlbnQ9XCJJRT03XCIgLz4nO1xuXHRcdFx0fVxuXG5cdFx0XHRzZWxmLmlmcmFtZUhUTUwgKz0gJzxtZXRhIGh0dHAtZXF1aXY9XCJDb250ZW50LVR5cGVcIiBjb250ZW50PVwidGV4dC9odG1sOyBjaGFyc2V0PVVURi04XCIgLz4nO1xuXG5cdFx0XHQvLyBMb2FkIHRoZSBDU1MgYnkgaW5qZWN0aW5nIHRoZW0gaW50byB0aGUgSFRNTCB0aGlzIHdpbGwgcmVkdWNlIFwiZmxpY2tlclwiXG5cdFx0XHQvLyBIb3dldmVyIHdlIGNhbid0IGRvIHRoYXQgb24gQ2hyb21lIHNpbmNlICMgd2lsbCBzY3JvbGwgdG8gdGhlIGVkaXRvciBmb3Igc29tZSBvZGQgcmVhc29uIHNlZSAjMjQyN1xuXHRcdFx0aWYgKCEvIyQvLnRlc3QoZG9jdW1lbnQubG9jYXRpb24uaHJlZikpIHtcblx0XHRcdFx0Zm9yIChpID0gMDsgaSA8IHNlbGYuY29udGVudENTUy5sZW5ndGg7IGkrKykge1xuXHRcdFx0XHRcdHZhciBjc3NVcmwgPSBzZWxmLmNvbnRlbnRDU1NbaV07XG5cdFx0XHRcdFx0c2VsZi5pZnJhbWVIVE1MICs9IChcblx0XHRcdFx0XHRcdCc8bGluayB0eXBlPVwidGV4dC9jc3NcIiAnICtcblx0XHRcdFx0XHRcdFx0J3JlbD1cInN0eWxlc2hlZXRcIiAnICtcblx0XHRcdFx0XHRcdFx0J2hyZWY9XCInICsgVG9vbHMuX2FkZENhY2hlU3VmZml4KGNzc1VybCkgKyAnXCIgLz4nXG5cdFx0XHRcdFx0KTtcblx0XHRcdFx0XHRzZWxmLmxvYWRlZENTU1tjc3NVcmxdID0gdHJ1ZTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRib2R5SWQgPSBzZXR0aW5ncy5ib2R5X2lkIHx8ICd0aW55bWNlJztcblx0XHRcdGlmIChib2R5SWQuaW5kZXhPZignPScpICE9IC0xKSB7XG5cdFx0XHRcdGJvZHlJZCA9IHNlbGYuZ2V0UGFyYW0oJ2JvZHlfaWQnLCAnJywgJ2hhc2gnKTtcblx0XHRcdFx0Ym9keUlkID0gYm9keUlkW3NlbGYuaWRdIHx8IGJvZHlJZDtcblx0XHRcdH1cblxuXHRcdFx0Ym9keUNsYXNzID0gc2V0dGluZ3MuYm9keV9jbGFzcyB8fCAnJztcblx0XHRcdGlmIChib2R5Q2xhc3MuaW5kZXhPZignPScpICE9IC0xKSB7XG5cdFx0XHRcdGJvZHlDbGFzcyA9IHNlbGYuZ2V0UGFyYW0oJ2JvZHlfY2xhc3MnLCAnJywgJ2hhc2gnKTtcblx0XHRcdFx0Ym9keUNsYXNzID0gYm9keUNsYXNzW3NlbGYuaWRdIHx8ICcnO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoc2V0dGluZ3MuY29udGVudF9zZWN1cml0eV9wb2xpY3kpIHtcblx0XHRcdFx0c2VsZi5pZnJhbWVIVE1MICs9ICc8bWV0YSBodHRwLWVxdWl2PVwiQ29udGVudC1TZWN1cml0eS1Qb2xpY3lcIiBjb250ZW50PVwiJyArIHNldHRpbmdzLmNvbnRlbnRfc2VjdXJpdHlfcG9saWN5ICsgJ1wiIC8+Jztcblx0XHRcdH1cblxuXHRcdFx0c2VsZi5pZnJhbWVIVE1MICs9ICc8L2hlYWQ+PGJvZHkgaWQ9XCInICsgYm9keUlkICtcblx0XHRcdFx0J1wiIGNsYXNzPVwibWNlLWNvbnRlbnQtYm9keSAnICsgYm9keUNsYXNzICtcblx0XHRcdFx0J1wiIGRhdGEtaWQ9XCInICsgc2VsZi5pZCArICdcIj48YnI+PC9ib2R5PjwvaHRtbD4nO1xuXG5cdFx0XHQvKmVzbGludCBuby1zY3JpcHQtdXJsOjAgKi9cblx0XHRcdHZhciBkb21haW5SZWxheFVybCA9ICdqYXZhc2NyaXB0OihmdW5jdGlvbigpeycgK1xuXHRcdFx0XHQnZG9jdW1lbnQub3BlbigpO2RvY3VtZW50LmRvbWFpbj1cIicgKyBkb2N1bWVudC5kb21haW4gKyAnXCI7JyArXG5cdFx0XHRcdCd2YXIgZWQgPSB3aW5kb3cucGFyZW50LnRpbnltY2UuZ2V0KFwiJyArIHNlbGYuaWQgKyAnXCIpO2RvY3VtZW50LndyaXRlKGVkLmlmcmFtZUhUTUwpOycgK1xuXHRcdFx0XHQnZG9jdW1lbnQuY2xvc2UoKTtlZC5pbml0Q29udGVudEJvZHkodHJ1ZSk7fSkoKSc7XG5cblx0XHRcdC8vIERvbWFpbiByZWxheGluZyBpcyByZXF1aXJlZCBzaW5jZSB0aGUgdXNlciBoYXMgbWVzc2VkIGFyb3VuZCB3aXRoIGRvY3VtZW50LmRvbWFpblxuXHRcdFx0aWYgKGRvY3VtZW50LmRvbWFpbiAhPSBsb2NhdGlvbi5ob3N0bmFtZSkge1xuXHRcdFx0XHQvLyBFZGdlIHNlZW1zIHRvIGJlIGFibGUgdG8gaGFuZGxlIGRvbWFpbiByZWxheGluZ1xuXHRcdFx0XHRpZiAoRW52LmllICYmIEVudi5pZSA8IDEyKSB7XG5cdFx0XHRcdFx0dXJsID0gZG9tYWluUmVsYXhVcmw7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0Ly8gQ3JlYXRlIGlmcmFtZVxuXHRcdFx0Ly8gVE9ETzogQUNDIGFkZCB0aGUgYXBwcm9wcmlhdGUgZGVzY3JpcHRpb24gb24gdGhpcy5cblx0XHRcdHZhciBpZnIgPSBET00uY3JlYXRlKCdpZnJhbWUnLCB7XG5cdFx0XHRcdGlkOiBzZWxmLmlkICsgXCJfaWZyXCIsXG5cdFx0XHRcdC8vc3JjOiB1cmwgfHwgJ2phdmFzY3JpcHQ6XCJcIicsIC8vIFdvcmthcm91bmQgZm9yIEhUVFBTIHdhcm5pbmcgaW4gSUU2Lzdcblx0XHRcdFx0ZnJhbWVCb3JkZXI6ICcwJyxcblx0XHRcdFx0YWxsb3dUcmFuc3BhcmVuY3k6IFwidHJ1ZVwiLFxuXHRcdFx0XHR0aXRsZTogc2VsZi5lZGl0b3JNYW5hZ2VyLnRyYW5zbGF0ZShcblx0XHRcdFx0XHRcdFwiUmljaCBUZXh0IEFyZWEuIFByZXNzIEFMVC1GOSBmb3IgbWVudS4gXCIgK1xuXHRcdFx0XHRcdFx0XCJQcmVzcyBBTFQtRjEwIGZvciB0b29sYmFyLiBQcmVzcyBBTFQtMCBmb3IgaGVscFwiXG5cdFx0XHRcdCksXG5cdFx0XHRcdHN0eWxlOiB7XG5cdFx0XHRcdFx0d2lkdGg6ICcxMDAlJyxcblx0XHRcdFx0XHRoZWlnaHQ6IGgsXG5cdFx0XHRcdFx0ZGlzcGxheTogJ2Jsb2NrJyAvLyBJbXBvcnRhbnQgZm9yIEdlY2tvIHRvIHJlbmRlciB0aGUgaWZyYW1lIGNvcnJlY3RseVxuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0aWZyLm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRpZnIub25sb2FkID0gbnVsbDtcblx0XHRcdFx0c2VsZi5maXJlKFwibG9hZFwiKTtcblx0XHRcdH07XG5cblx0XHRcdERPTS5zZXRBdHRyaWIoaWZyLCBcInNyY1wiLCB1cmwgfHwgJ2phdmFzY3JpcHQ6XCJcIicpO1xuXG5cdFx0XHRzZWxmLmNvbnRlbnRBcmVhQ29udGFpbmVyID0gby5pZnJhbWVDb250YWluZXI7XG5cdFx0XHRzZWxmLmlmcmFtZUVsZW1lbnQgPSBpZnI7XG5cblx0XHRcdG4gPSBET00uYWRkKG8uaWZyYW1lQ29udGFpbmVyLCBpZnIpO1xuXG5cdFx0XHQvLyBUcnkgYWNjZXNzaW5nIHRoZSBkb2N1bWVudCB0aGlzIHdpbGwgZmFpbCBvbiBJRSB3aGVuIGRvY3VtZW50LmRvbWFpbiBpcyBzZXQgdG8gdGhlIHNhbWUgYXMgbG9jYXRpb24uaG9zdG5hbWVcblx0XHRcdC8vIFRoZW4gd2UgaGF2ZSB0byBmb3JjZSBkb21haW4gcmVsYXhpbmcgdXNpbmcgdGhlIGRvbWFpblJlbGF4VXJsIGFwcHJvYWNoIHZlcnkgdWdseSEhXG5cdFx0XHRpZiAoaWUpIHtcblx0XHRcdFx0dHJ5IHtcblx0XHRcdFx0XHRzZWxmLmdldERvYygpO1xuXHRcdFx0XHR9IGNhdGNoIChlKSB7XG5cdFx0XHRcdFx0bi5zcmMgPSB1cmwgPSBkb21haW5SZWxheFVybDtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAoby5lZGl0b3JDb250YWluZXIpIHtcblx0XHRcdFx0RE9NLmdldChvLmVkaXRvckNvbnRhaW5lcikuc3R5bGUuZGlzcGxheSA9IHNlbGYub3JnRGlzcGxheTtcblx0XHRcdFx0c2VsZi5oaWRkZW4gPSBET00uaXNIaWRkZW4oby5lZGl0b3JDb250YWluZXIpO1xuXHRcdFx0fVxuXG5cdFx0XHRzZWxmLmdldEVsZW1lbnQoKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuXHRcdFx0RE9NLnNldEF0dHJpYihzZWxmLmlkLCAnYXJpYS1oaWRkZW4nLCB0cnVlKTtcblxuXHRcdFx0aWYgKCF1cmwpIHtcblx0XHRcdFx0c2VsZi5pbml0Q29udGVudEJvZHkoKTtcblx0XHRcdH1cblxuXHRcdFx0ZWxtID0gbiA9IG8gPSBudWxsOyAvLyBDbGVhbnVwXG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFRoaXMgbWV0aG9kIGdldCBjYWxsZWQgYnkgdGhlIGluaXQgbWV0aG9kIG9uY2UgdGhlIGlmcmFtZSBpcyBsb2FkZWQuXG5cdFx0ICogSXQgd2lsbCBmaWxsIHRoZSBpZnJhbWUgd2l0aCBjb250ZW50cywgc2V0cyB1cCBET00gYW5kIHNlbGVjdGlvbiBvYmplY3RzIGZvciB0aGUgaWZyYW1lLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBpbml0Q29udGVudEJvZHlcblx0XHQgKiBAcHJpdmF0ZVxuXHRcdCAqL1xuXHRcdGluaXRDb250ZW50Qm9keTogZnVuY3Rpb24oc2tpcFdyaXRlKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIHNldHRpbmdzID0gc2VsZi5zZXR0aW5ncywgdGFyZ2V0RWxtID0gc2VsZi5nZXRFbGVtZW50KCksIGRvYyA9IHNlbGYuZ2V0RG9jKCksIGJvZHksIGNvbnRlbnRDc3NUZXh0O1xuXG5cdFx0XHQvLyBSZXN0b3JlIHZpc2liaWxpdHkgb24gdGFyZ2V0IGVsZW1lbnRcblx0XHRcdGlmICghc2V0dGluZ3MuaW5saW5lKSB7XG5cdFx0XHRcdHNlbGYuZ2V0RWxlbWVudCgpLnN0eWxlLnZpc2liaWxpdHkgPSBzZWxmLm9yZ1Zpc2liaWxpdHk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIFNldHVwIGlmcmFtZSBib2R5XG5cdFx0XHRpZiAoIXNraXBXcml0ZSAmJiAhc2V0dGluZ3MuY29udGVudF9lZGl0YWJsZSkge1xuXHRcdFx0XHRkb2Mub3BlbigpO1xuXHRcdFx0XHRkb2Mud3JpdGUoc2VsZi5pZnJhbWVIVE1MKTtcblx0XHRcdFx0ZG9jLmNsb3NlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChzZXR0aW5ncy5jb250ZW50X2VkaXRhYmxlKSB7XG5cdFx0XHRcdHNlbGYub24oJ3JlbW92ZScsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdHZhciBib2R5RWwgPSB0aGlzLmdldEJvZHkoKTtcblxuXHRcdFx0XHRcdERPTS5yZW1vdmVDbGFzcyhib2R5RWwsICdtY2UtY29udGVudC1ib2R5Jyk7XG5cdFx0XHRcdFx0RE9NLnJlbW92ZUNsYXNzKGJvZHlFbCwgJ21jZS1lZGl0LWZvY3VzJyk7XG5cdFx0XHRcdFx0RE9NLnNldEF0dHJpYihib2R5RWwsICdjb250ZW50RWRpdGFibGUnLCBudWxsKTtcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0RE9NLmFkZENsYXNzKHRhcmdldEVsbSwgJ21jZS1jb250ZW50LWJvZHknKTtcblx0XHRcdFx0c2VsZi5jb250ZW50RG9jdW1lbnQgPSBkb2MgPSBzZXR0aW5ncy5jb250ZW50X2RvY3VtZW50IHx8IGRvY3VtZW50O1xuXHRcdFx0XHRzZWxmLmNvbnRlbnRXaW5kb3cgPSBzZXR0aW5ncy5jb250ZW50X3dpbmRvdyB8fCB3aW5kb3c7XG5cdFx0XHRcdHNlbGYuYm9keUVsZW1lbnQgPSB0YXJnZXRFbG07XG5cblx0XHRcdFx0Ly8gUHJldmVudCBsZWFrIGluIElFXG5cdFx0XHRcdHNldHRpbmdzLmNvbnRlbnRfZG9jdW1lbnQgPSBzZXR0aW5ncy5jb250ZW50X3dpbmRvdyA9IG51bGw7XG5cblx0XHRcdFx0Ly8gVE9ETzogRml4IHRoaXNcblx0XHRcdFx0c2V0dGluZ3Mucm9vdF9uYW1lID0gdGFyZ2V0RWxtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIEl0IHdpbGwgbm90IHN0ZWFsIGZvY3VzIHdoaWxlIHNldHRpbmcgY29udGVudEVkaXRhYmxlXG5cdFx0XHRib2R5ID0gc2VsZi5nZXRCb2R5KCk7XG5cdFx0XHRib2R5LmRpc2FibGVkID0gdHJ1ZTtcblx0XHRcdHNlbGYucmVhZG9ubHkgPSBzZXR0aW5ncy5yZWFkb25seTtcblxuXHRcdFx0aWYgKCFzZWxmLnJlYWRvbmx5KSB7XG5cdFx0XHRcdGlmIChzZWxmLmlubGluZSAmJiBET00uZ2V0U3R5bGUoYm9keSwgJ3Bvc2l0aW9uJywgdHJ1ZSkgPT0gJ3N0YXRpYycpIHtcblx0XHRcdFx0XHRib2R5LnN0eWxlLnBvc2l0aW9uID0gJ3JlbGF0aXZlJztcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGJvZHkuY29udGVudEVkaXRhYmxlID0gc2VsZi5nZXRQYXJhbSgnY29udGVudF9lZGl0YWJsZV9zdGF0ZScsIHRydWUpO1xuXHRcdFx0fVxuXG5cdFx0XHRib2R5LmRpc2FibGVkID0gZmFsc2U7XG5cblx0XHRcdHNlbGYuZWRpdG9yVXBsb2FkID0gbmV3IEVkaXRvclVwbG9hZChzZWxmKTtcblxuXHRcdFx0LyoqXG5cdFx0XHQgKiBTY2hlbWEgaW5zdGFuY2UsIGVuYWJsZXMgeW91IHRvIHZhbGlkYXRlIGVsZW1lbnRzIGFuZCBpdHMgY2hpbGRyZW4uXG5cdFx0XHQgKlxuXHRcdFx0ICogQHByb3BlcnR5IHNjaGVtYVxuXHRcdFx0ICogQHR5cGUgdGlueW1jZS5odG1sLlNjaGVtYVxuXHRcdFx0ICovXG5cdFx0XHRzZWxmLnNjaGVtYSA9IG5ldyBTY2hlbWEoc2V0dGluZ3MpO1xuXG5cdFx0XHQvKipcblx0XHRcdCAqIERPTSBpbnN0YW5jZSBmb3IgdGhlIGVkaXRvci5cblx0XHRcdCAqXG5cdFx0XHQgKiBAcHJvcGVydHkgZG9tXG5cdFx0XHQgKiBAdHlwZSB0aW55bWNlLmRvbS5ET01VdGlsc1xuXHRcdFx0ICogQGV4YW1wbGVcblx0XHRcdCAqIC8vIEFkZHMgYSBjbGFzcyB0byBhbGwgcGFyYWdyYXBocyB3aXRoaW4gdGhlIGVkaXRvclxuXHRcdFx0ICogdGlueW1jZS5hY3RpdmVFZGl0b3IuZG9tLmFkZENsYXNzKHRpbnltY2UuYWN0aXZlRWRpdG9yLmRvbS5zZWxlY3QoJ3AnKSwgJ3NvbWVjbGFzcycpO1xuXHRcdFx0ICovXG5cdFx0XHRzZWxmLmRvbSA9IG5ldyBET01VdGlscyhkb2MsIHtcblx0XHRcdFx0a2VlcF92YWx1ZXM6IHRydWUsXG5cdFx0XHRcdHVybF9jb252ZXJ0ZXI6IHNlbGYuY29udmVydFVSTCxcblx0XHRcdFx0dXJsX2NvbnZlcnRlcl9zY29wZTogc2VsZixcblx0XHRcdFx0aGV4X2NvbG9yczogc2V0dGluZ3MuZm9yY2VfaGV4X3N0eWxlX2NvbG9ycyxcblx0XHRcdFx0Y2xhc3NfZmlsdGVyOiBzZXR0aW5ncy5jbGFzc19maWx0ZXIsXG5cdFx0XHRcdHVwZGF0ZV9zdHlsZXM6IHRydWUsXG5cdFx0XHRcdHJvb3RfZWxlbWVudDogc2VsZi5pbmxpbmUgPyBzZWxmLmdldEJvZHkoKSA6IG51bGwsXG5cdFx0XHRcdGNvbGxlY3Q6IHNldHRpbmdzLmNvbnRlbnRfZWRpdGFibGUsXG5cdFx0XHRcdHNjaGVtYTogc2VsZi5zY2hlbWEsXG5cdFx0XHRcdG9uU2V0QXR0cmliOiBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdFx0c2VsZi5maXJlKCdTZXRBdHRyaWInLCBlKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdC8qKlxuXHRcdFx0ICogSFRNTCBwYXJzZXIgd2lsbCBiZSB1c2VkIHdoZW4gY29udGVudHMgaXMgaW5zZXJ0ZWQgaW50byB0aGUgZWRpdG9yLlxuXHRcdFx0ICpcblx0XHRcdCAqIEBwcm9wZXJ0eSBwYXJzZXJcblx0XHRcdCAqIEB0eXBlIHRpbnltY2UuaHRtbC5Eb21QYXJzZXJcblx0XHRcdCAqL1xuXHRcdFx0c2VsZi5wYXJzZXIgPSBuZXcgRG9tUGFyc2VyKHNldHRpbmdzLCBzZWxmLnNjaGVtYSk7XG5cblx0XHRcdC8vIENvbnZlcnQgc3JjIGFuZCBocmVmIGludG8gZGF0YS1tY2Utc3JjLCBkYXRhLW1jZS1ocmVmIGFuZCBkYXRhLW1jZS1zdHlsZVxuXHRcdFx0c2VsZi5wYXJzZXIuYWRkQXR0cmlidXRlRmlsdGVyKCdzcmMsaHJlZixzdHlsZSx0YWJpbmRleCcsIGZ1bmN0aW9uKG5vZGVzLCBuYW1lKSB7XG5cdFx0XHRcdHZhciBpID0gbm9kZXMubGVuZ3RoLCBub2RlLCBkb20gPSBzZWxmLmRvbSwgdmFsdWUsIGludGVybmFsTmFtZTtcblxuXHRcdFx0XHR3aGlsZSAoaS0tKSB7XG5cdFx0XHRcdFx0bm9kZSA9IG5vZGVzW2ldO1xuXHRcdFx0XHRcdHZhbHVlID0gbm9kZS5hdHRyKG5hbWUpO1xuXHRcdFx0XHRcdGludGVybmFsTmFtZSA9ICdkYXRhLW1jZS0nICsgbmFtZTtcblxuXHRcdFx0XHRcdC8vIEFkZCBpbnRlcm5hbCBhdHRyaWJ1dGUgaWYgd2UgbmVlZCB0byB3ZSBkb24ndCBvbiBhIHJlZnJlc2ggb2YgdGhlIGRvY3VtZW50XG5cdFx0XHRcdFx0aWYgKCFub2RlLmF0dHJpYnV0ZXMubWFwW2ludGVybmFsTmFtZV0pIHtcblx0XHRcdFx0XHRcdC8vIERvbid0IGR1cGxpY2F0ZSB0aGVzZSBzaW5jZSB0aGV5IHdvbid0IGdldCBtb2RpZmllZCBieSBhbnkgYnJvd3NlclxuXHRcdFx0XHRcdFx0aWYgKHZhbHVlLmluZGV4T2YoJ2RhdGE6JykgPT09IDAgfHwgdmFsdWUuaW5kZXhPZignYmxvYjonKSA9PT0gMCkge1xuXHRcdFx0XHRcdFx0XHRjb250aW51ZTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0aWYgKG5hbWUgPT09IFwic3R5bGVcIikge1xuXHRcdFx0XHRcdFx0XHR2YWx1ZSA9IGRvbS5zZXJpYWxpemVTdHlsZShkb20ucGFyc2VTdHlsZSh2YWx1ZSksIG5vZGUubmFtZSk7XG5cblx0XHRcdFx0XHRcdFx0aWYgKCF2YWx1ZS5sZW5ndGgpIHtcblx0XHRcdFx0XHRcdFx0XHR2YWx1ZSA9IG51bGw7XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRub2RlLmF0dHIoaW50ZXJuYWxOYW1lLCB2YWx1ZSk7XG5cdFx0XHRcdFx0XHRcdG5vZGUuYXR0cihuYW1lLCB2YWx1ZSk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKG5hbWUgPT09IFwidGFiaW5kZXhcIikge1xuXHRcdFx0XHRcdFx0XHRub2RlLmF0dHIoaW50ZXJuYWxOYW1lLCB2YWx1ZSk7XG5cdFx0XHRcdFx0XHRcdG5vZGUuYXR0cihuYW1lLCBudWxsKTtcblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdG5vZGUuYXR0cihpbnRlcm5hbE5hbWUsIHNlbGYuY29udmVydFVSTCh2YWx1ZSwgbmFtZSwgbm9kZS5uYW1lKSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0Ly8gS2VlcCBzY3JpcHRzIGZyb20gZXhlY3V0aW5nXG5cdFx0XHRzZWxmLnBhcnNlci5hZGROb2RlRmlsdGVyKCdzY3JpcHQnLCBmdW5jdGlvbihub2Rlcykge1xuXHRcdFx0XHR2YXIgaSA9IG5vZGVzLmxlbmd0aCwgbm9kZSwgdHlwZTtcblxuXHRcdFx0XHR3aGlsZSAoaS0tKSB7XG5cdFx0XHRcdFx0bm9kZSA9IG5vZGVzW2ldO1xuXHRcdFx0XHRcdHR5cGUgPSBub2RlLmF0dHIoJ3R5cGUnKSB8fCAnbm8vdHlwZSc7XG5cdFx0XHRcdFx0aWYgKHR5cGUuaW5kZXhPZignbWNlLScpICE9PSAwKSB7XG5cdFx0XHRcdFx0XHRub2RlLmF0dHIoJ3R5cGUnLCAnbWNlLScgKyB0eXBlKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRzZWxmLnBhcnNlci5hZGROb2RlRmlsdGVyKCcjY2RhdGEnLCBmdW5jdGlvbihub2Rlcykge1xuXHRcdFx0XHR2YXIgaSA9IG5vZGVzLmxlbmd0aCwgbm9kZTtcblxuXHRcdFx0XHR3aGlsZSAoaS0tKSB7XG5cdFx0XHRcdFx0bm9kZSA9IG5vZGVzW2ldO1xuXHRcdFx0XHRcdG5vZGUudHlwZSA9IDg7XG5cdFx0XHRcdFx0bm9kZS5uYW1lID0gJyNjb21tZW50Jztcblx0XHRcdFx0XHRub2RlLnZhbHVlID0gJ1tDREFUQVsnICsgbm9kZS52YWx1ZSArICddXSc7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRzZWxmLnBhcnNlci5hZGROb2RlRmlsdGVyKCdwLGgxLGgyLGgzLGg0LGg1LGg2LGRpdicsIGZ1bmN0aW9uKG5vZGVzKSB7XG5cdFx0XHRcdHZhciBpID0gbm9kZXMubGVuZ3RoLCBub2RlLCBub25FbXB0eUVsZW1lbnRzID0gc2VsZi5zY2hlbWEuZ2V0Tm9uRW1wdHlFbGVtZW50cygpO1xuXG5cdFx0XHRcdHdoaWxlIChpLS0pIHtcblx0XHRcdFx0XHRub2RlID0gbm9kZXNbaV07XG5cblx0XHRcdFx0XHRpZiAobm9kZS5pc0VtcHR5KG5vbkVtcHR5RWxlbWVudHMpKSB7XG5cdFx0XHRcdFx0XHRub2RlLmFwcGVuZChuZXcgTm9kZSgnYnInLCAxKSkuc2hvcnRFbmRlZCA9IHRydWU7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0LyoqXG5cdFx0XHQgKiBET00gc2VyaWFsaXplciBmb3IgdGhlIGVkaXRvci4gV2lsbCBiZSB1c2VkIHdoZW4gY29udGVudHMgaXMgZXh0cmFjdGVkIGZyb20gdGhlIGVkaXRvci5cblx0XHRcdCAqXG5cdFx0XHQgKiBAcHJvcGVydHkgc2VyaWFsaXplclxuXHRcdFx0ICogQHR5cGUgdGlueW1jZS5kb20uU2VyaWFsaXplclxuXHRcdFx0ICogQGV4YW1wbGVcblx0XHRcdCAqIC8vIFNlcmlhbGl6ZXMgdGhlIGZpcnN0IHBhcmFncmFwaCBpbiB0aGUgZWRpdG9yIGludG8gYSBzdHJpbmdcblx0XHRcdCAqIHRpbnltY2UuYWN0aXZlRWRpdG9yLnNlcmlhbGl6ZXIuc2VyaWFsaXplKHRpbnltY2UuYWN0aXZlRWRpdG9yLmRvbS5zZWxlY3QoJ3AnKVswXSk7XG5cdFx0XHQgKi9cblx0XHRcdHNlbGYuc2VyaWFsaXplciA9IG5ldyBEb21TZXJpYWxpemVyKHNldHRpbmdzLCBzZWxmKTtcblxuXHRcdFx0LyoqXG5cdFx0XHQgKiBTZWxlY3Rpb24gaW5zdGFuY2UgZm9yIHRoZSBlZGl0b3IuXG5cdFx0XHQgKlxuXHRcdFx0ICogQHByb3BlcnR5IHNlbGVjdGlvblxuXHRcdFx0ICogQHR5cGUgdGlueW1jZS5kb20uU2VsZWN0aW9uXG5cdFx0XHQgKiBAZXhhbXBsZVxuXHRcdFx0ICogLy8gU2V0cyBzb21lIGNvbnRlbnRzIHRvIHRoZSBjdXJyZW50IHNlbGVjdGlvbiBpbiB0aGUgZWRpdG9yXG5cdFx0XHQgKiB0aW55bWNlLmFjdGl2ZUVkaXRvci5zZWxlY3Rpb24uc2V0Q29udGVudCgnU29tZSBjb250ZW50cycpO1xuXHRcdFx0ICpcblx0XHRcdCAqIC8vIEdldHMgdGhlIGN1cnJlbnQgc2VsZWN0aW9uXG5cdFx0XHQgKiBhbGVydCh0aW55bWNlLmFjdGl2ZUVkaXRvci5zZWxlY3Rpb24uZ2V0Q29udGVudCgpKTtcblx0XHRcdCAqXG5cdFx0XHQgKiAvLyBTZWxlY3RzIHRoZSBmaXJzdCBwYXJhZ3JhcGggZm91bmRcblx0XHRcdCAqIHRpbnltY2UuYWN0aXZlRWRpdG9yLnNlbGVjdGlvbi5zZWxlY3QodGlueW1jZS5hY3RpdmVFZGl0b3IuZG9tLnNlbGVjdCgncCcpWzBdKTtcblx0XHRcdCAqL1xuXHRcdFx0c2VsZi5zZWxlY3Rpb24gPSBuZXcgU2VsZWN0aW9uKHNlbGYuZG9tLCBzZWxmLmdldFdpbigpLCBzZWxmLnNlcmlhbGl6ZXIsIHNlbGYpO1xuXG5cdFx0XHQvKipcblx0XHRcdCAqIEZvcm1hdHRlciBpbnN0YW5jZS5cblx0XHRcdCAqXG5cdFx0XHQgKiBAcHJvcGVydHkgZm9ybWF0dGVyXG5cdFx0XHQgKiBAdHlwZSB0aW55bWNlLkZvcm1hdHRlclxuXHRcdFx0ICovXG5cdFx0XHRzZWxmLmZvcm1hdHRlciA9IG5ldyBGb3JtYXR0ZXIoc2VsZik7XG5cblx0XHRcdC8qKlxuXHRcdFx0ICogVW5kbyBtYW5hZ2VyIGluc3RhbmNlLCByZXNwb25zaWJsZSBmb3IgaGFuZGxpbmcgdW5kbyBsZXZlbHMuXG5cdFx0XHQgKlxuXHRcdFx0ICogQHByb3BlcnR5IHVuZG9NYW5hZ2VyXG5cdFx0XHQgKiBAdHlwZSB0aW55bWNlLlVuZG9NYW5hZ2VyXG5cdFx0XHQgKiBAZXhhbXBsZVxuXHRcdFx0ICogLy8gVW5kb2VzIHRoZSBsYXN0IG1vZGlmaWNhdGlvbiB0byB0aGUgZWRpdG9yXG5cdFx0XHQgKiB0aW55bWNlLmFjdGl2ZUVkaXRvci51bmRvTWFuYWdlci51bmRvKCk7XG5cdFx0XHQgKi9cblx0XHRcdHNlbGYudW5kb01hbmFnZXIgPSBuZXcgVW5kb01hbmFnZXIoc2VsZik7XG5cblx0XHRcdHNlbGYuZm9yY2VCbG9ja3MgPSBuZXcgRm9yY2VCbG9ja3Moc2VsZik7XG5cdFx0XHRzZWxmLmVudGVyS2V5ID0gbmV3IEVudGVyS2V5KHNlbGYpO1xuXHRcdFx0c2VsZi5fbm9kZUNoYW5nZURpc3BhdGNoZXIgPSBuZXcgTm9kZUNoYW5nZShzZWxmKTtcblx0XHRcdHNlbGYuX3NlbGVjdGlvbk92ZXJyaWRlcyA9IG5ldyBTZWxlY3Rpb25PdmVycmlkZXMoc2VsZik7XG5cblx0XHRcdHNlbGYuZmlyZSgnUHJlSW5pdCcpO1xuXG5cdFx0XHRpZiAoIXNldHRpbmdzLmJyb3dzZXJfc3BlbGxjaGVjayAmJiAhc2V0dGluZ3MuZ2Vja29fc3BlbGxjaGVjaykge1xuXHRcdFx0XHRkb2MuYm9keS5zcGVsbGNoZWNrID0gZmFsc2U7IC8vIEdlY2tvXG5cdFx0XHRcdERPTS5zZXRBdHRyaWIoYm9keSwgXCJzcGVsbGNoZWNrXCIsIFwiZmFsc2VcIik7XG5cdFx0XHR9XG5cblx0XHRcdHNlbGYucXVpcmtzID0gbmV3IFF1aXJrcyhzZWxmKTtcblx0XHRcdHNlbGYuZmlyZSgnUG9zdFJlbmRlcicpO1xuXG5cdFx0XHRpZiAoc2V0dGluZ3MuZGlyZWN0aW9uYWxpdHkpIHtcblx0XHRcdFx0Ym9keS5kaXIgPSBzZXR0aW5ncy5kaXJlY3Rpb25hbGl0eTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHNldHRpbmdzLm5vd3JhcCkge1xuXHRcdFx0XHRib2R5LnN0eWxlLndoaXRlU3BhY2UgPSBcIm5vd3JhcFwiO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoc2V0dGluZ3MucHJvdGVjdCkge1xuXHRcdFx0XHRzZWxmLm9uKCdCZWZvcmVTZXRDb250ZW50JywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRcdGVhY2goc2V0dGluZ3MucHJvdGVjdCwgZnVuY3Rpb24ocGF0dGVybikge1xuXHRcdFx0XHRcdFx0ZS5jb250ZW50ID0gZS5jb250ZW50LnJlcGxhY2UocGF0dGVybiwgZnVuY3Rpb24oc3RyKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiAnPCEtLW1jZTpwcm90ZWN0ZWQgJyArIGVzY2FwZShzdHIpICsgJy0tPic7XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdHNlbGYub24oJ1NldENvbnRlbnQnLCBmdW5jdGlvbigpIHtcblx0XHRcdFx0c2VsZi5hZGRWaXN1YWwoc2VsZi5nZXRCb2R5KCkpO1xuXHRcdFx0fSk7XG5cblx0XHRcdC8vIFJlbW92ZSBlbXB0eSBjb250ZW50c1xuXHRcdFx0aWYgKHNldHRpbmdzLnBhZGRfZW1wdHlfZWRpdG9yKSB7XG5cdFx0XHRcdHNlbGYub24oJ1Bvc3RQcm9jZXNzJywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRcdGUuY29udGVudCA9IGUuY29udGVudC5yZXBsYWNlKC9eKDxwW14+XSo+KCZuYnNwO3wmIzE2MDt8XFxzfFxcdTAwYTB8KTxcXC9wPltcXHJcXG5dKnw8YnIgXFwvPltcXHJcXG5dKikkLywgJycpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0c2VsZi5sb2FkKHtpbml0aWFsOiB0cnVlLCBmb3JtYXQ6ICdodG1sJ30pO1xuXHRcdFx0c2VsZi5zdGFydENvbnRlbnQgPSBzZWxmLmdldENvbnRlbnQoe2Zvcm1hdDogJ3Jhdyd9KTtcblxuXHRcdFx0LyoqXG5cdFx0XHQgKiBJcyBzZXQgdG8gdHJ1ZSBhZnRlciB0aGUgZWRpdG9yIGluc3RhbmNlIGhhcyBiZWVuIGluaXRpYWxpemVkXG5cdFx0XHQgKlxuXHRcdFx0ICogQHByb3BlcnR5IGluaXRpYWxpemVkXG5cdFx0XHQgKiBAdHlwZSBCb29sZWFuXG5cdFx0XHQgKiBAZXhhbXBsZVxuXHRcdFx0ICogZnVuY3Rpb24gaXNFZGl0b3JJbml0aWFsaXplZChlZGl0b3IpIHtcblx0XHRcdCAqICAgICByZXR1cm4gZWRpdG9yICYmIGVkaXRvci5pbml0aWFsaXplZDtcblx0XHRcdCAqIH1cblx0XHRcdCAqL1xuXHRcdFx0c2VsZi5pbml0aWFsaXplZCA9IHRydWU7XG5cdFx0XHRzZWxmLmJpbmRQZW5kaW5nRXZlbnREZWxlZ2F0ZXMoKTtcblxuXHRcdFx0c2VsZi5maXJlKCdpbml0Jyk7XG5cdFx0XHRzZWxmLmZvY3VzKHRydWUpO1xuXHRcdFx0c2VsZi5ub2RlQ2hhbmdlZCh7aW5pdGlhbDogdHJ1ZX0pO1xuXHRcdFx0c2VsZi5leGVjQ2FsbGJhY2soJ2luaXRfaW5zdGFuY2VfY2FsbGJhY2snLCBzZWxmKTtcblxuXHRcdFx0c2VsZi5vbignY29tcG9zaXRpb25zdGFydCBjb21wb3NpdGlvbmVuZCcsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0c2VsZi5jb21wb3NpbmcgPSBlLnR5cGUgPT09ICdjb21wb3NpdGlvbnN0YXJ0Jztcblx0XHRcdH0pO1xuXG5cdFx0XHQvLyBBZGQgZWRpdG9yIHNwZWNpZmljIENTUyBzdHlsZXNcblx0XHRcdGlmIChzZWxmLmNvbnRlbnRTdHlsZXMubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRjb250ZW50Q3NzVGV4dCA9ICcnO1xuXG5cdFx0XHRcdGVhY2goc2VsZi5jb250ZW50U3R5bGVzLCBmdW5jdGlvbihzdHlsZSkge1xuXHRcdFx0XHRcdGNvbnRlbnRDc3NUZXh0ICs9IHN0eWxlICsgXCJcXHJcXG5cIjtcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0c2VsZi5kb20uYWRkU3R5bGUoY29udGVudENzc1RleHQpO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBMb2FkIHNwZWNpZmllZCBjb250ZW50IENTUyBsYXN0XG5cdFx0XHRlYWNoKHNlbGYuY29udGVudENTUywgZnVuY3Rpb24oY3NzVXJsKSB7XG5cdFx0XHRcdGlmICghc2VsZi5sb2FkZWRDU1NbY3NzVXJsXSkge1xuXHRcdFx0XHRcdHNlbGYuZG9tLmxvYWRDU1MoY3NzVXJsKTtcblx0XHRcdFx0XHRzZWxmLmxvYWRlZENTU1tjc3NVcmxdID0gdHJ1ZTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdC8vIEhhbmRsZSBhdXRvIGZvY3VzXG5cdFx0XHRpZiAoc2V0dGluZ3MuYXV0b19mb2N1cykge1xuXHRcdFx0XHREZWxheS5zZXRFZGl0b3JUaW1lb3V0KHNlbGYsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdHZhciBlZGl0b3I7XG5cblx0XHRcdFx0XHRpZiAoc2V0dGluZ3MuYXV0b19mb2N1cyA9PT0gdHJ1ZSkge1xuXHRcdFx0XHRcdFx0ZWRpdG9yID0gc2VsZjtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0ZWRpdG9yID0gc2VsZi5lZGl0b3JNYW5hZ2VyLmdldChzZXR0aW5ncy5hdXRvX2ZvY3VzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoIWVkaXRvci5kZXN0cm95ZWQpIHtcblx0XHRcdFx0XHRcdGVkaXRvci5mb2N1cygpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSwgMTAwKTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gQ2xlYW4gdXAgcmVmZXJlbmNlcyBmb3IgSUVcblx0XHRcdHRhcmdldEVsbSA9IGRvYyA9IGJvZHkgPSBudWxsO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBGb2N1c2VzL2FjdGl2YXRlcyB0aGUgZWRpdG9yLiBUaGlzIHdpbGwgc2V0IHRoaXMgZWRpdG9yIGFzIHRoZSBhY3RpdmVFZGl0b3IgaW4gdGhlIHRpbnltY2UgY29sbGVjdGlvblxuXHRcdCAqIGl0IHdpbGwgYWxzbyBwbGFjZSBET00gZm9jdXMgaW5zaWRlIHRoZSBlZGl0b3IuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGZvY3VzXG5cdFx0ICogQHBhcmFtIHtCb29sZWFufSBza2lwRm9jdXMgU2tpcCBET00gZm9jdXMuIEp1c3Qgc2V0IGlzIGFzIHRoZSBhY3RpdmUgZWRpdG9yLlxuXHRcdCAqL1xuXHRcdGZvY3VzOiBmdW5jdGlvbihza2lwRm9jdXMpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgc2VsZWN0aW9uID0gc2VsZi5zZWxlY3Rpb24sIGNvbnRlbnRFZGl0YWJsZSA9IHNlbGYuc2V0dGluZ3MuY29udGVudF9lZGl0YWJsZSwgcm5nO1xuXHRcdFx0dmFyIGNvbnRyb2xFbG0sIGRvYyA9IHNlbGYuZ2V0RG9jKCksIGJvZHkgPSBzZWxmLmdldEJvZHkoKSwgY29udGVudEVkaXRhYmxlSG9zdDtcblxuXHRcdFx0ZnVuY3Rpb24gZ2V0Q29udGVudEVkaXRhYmxlSG9zdChub2RlKSB7XG5cdFx0XHRcdHJldHVybiBzZWxmLmRvbS5nZXRQYXJlbnQobm9kZSwgZnVuY3Rpb24obm9kZSkge1xuXHRcdFx0XHRcdHJldHVybiBzZWxmLmRvbS5nZXRDb250ZW50RWRpdGFibGUobm9kZSkgPT09IFwidHJ1ZVwiO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKCFza2lwRm9jdXMpIHtcblx0XHRcdFx0Ly8gR2V0IHNlbGVjdGVkIGNvbnRyb2wgZWxlbWVudFxuXHRcdFx0XHRybmcgPSBzZWxlY3Rpb24uZ2V0Um5nKCk7XG5cdFx0XHRcdGlmIChybmcuaXRlbSkge1xuXHRcdFx0XHRcdGNvbnRyb2xFbG0gPSBybmcuaXRlbSgwKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHNlbGYucXVpcmtzLnJlZnJlc2hDb250ZW50RWRpdGFibGUoKTtcblxuXHRcdFx0XHQvLyBNb3ZlIGZvY3VzIHRvIGNvbnRlbnRFZGl0YWJsZT10cnVlIGNoaWxkIGlmIG5lZWRlZFxuXHRcdFx0XHRjb250ZW50RWRpdGFibGVIb3N0ID0gZ2V0Q29udGVudEVkaXRhYmxlSG9zdChzZWxlY3Rpb24uZ2V0Tm9kZSgpKTtcblx0XHRcdFx0aWYgKHNlbGYuJC5jb250YWlucyhib2R5LCBjb250ZW50RWRpdGFibGVIb3N0KSkge1xuXHRcdFx0XHRcdGNvbnRlbnRFZGl0YWJsZUhvc3QuZm9jdXMoKTtcblx0XHRcdFx0XHRzZWxlY3Rpb24ubm9ybWFsaXplKCk7XG5cdFx0XHRcdFx0c2VsZi5lZGl0b3JNYW5hZ2VyLnNldEFjdGl2ZShzZWxmKTtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBGb2N1cyB0aGUgd2luZG93IGlmcmFtZVxuXHRcdFx0XHRpZiAoIWNvbnRlbnRFZGl0YWJsZSkge1xuXHRcdFx0XHRcdC8vIFdlYktpdCBuZWVkcyB0aGlzIGNhbGwgdG8gZmlyZSBmb2N1c2luIGV2ZW50IHByb3Blcmx5IHNlZSAjNTk0OFxuXHRcdFx0XHRcdC8vIEJ1dCBPcGVyYSBwcmUgQmxpbmsgZW5naW5lIHdpbGwgcHJvZHVjZSBhbiBlbXB0eSBzZWxlY3Rpb24gc28gc2tpcCBPcGVyYVxuXHRcdFx0XHRcdGlmICghRW52Lm9wZXJhKSB7XG5cdFx0XHRcdFx0XHRzZWxmLmdldEJvZHkoKS5mb2N1cygpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHNlbGYuZ2V0V2luKCkuZm9jdXMoKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIEZvY3VzIHRoZSBib2R5IGFzIHdlbGwgc2luY2UgaXQncyBjb250ZW50RWRpdGFibGVcblx0XHRcdFx0aWYgKGlzR2Vja28gfHwgY29udGVudEVkaXRhYmxlKSB7XG5cdFx0XHRcdFx0Ly8gQ2hlY2sgZm9yIHNldEFjdGl2ZSBzaW5jZSBpdCBkb2Vzbid0IHNjcm9sbCB0byB0aGUgZWxlbWVudFxuXHRcdFx0XHRcdGlmIChib2R5LnNldEFjdGl2ZSkge1xuXHRcdFx0XHRcdFx0Ly8gSUUgMTEgc29tZXRpbWVzIHRocm93cyBcIkludmFsaWQgZnVuY3Rpb25cIiB0aGVuIGZhbGxiYWNrIHRvIGZvY3VzXG5cdFx0XHRcdFx0XHR0cnkge1xuXHRcdFx0XHRcdFx0XHRib2R5LnNldEFjdGl2ZSgpO1xuXHRcdFx0XHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0XHRcdFx0Ym9keS5mb2N1cygpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRib2R5LmZvY3VzKCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKGNvbnRlbnRFZGl0YWJsZSkge1xuXHRcdFx0XHRcdFx0c2VsZWN0aW9uLm5vcm1hbGl6ZSgpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIFJlc3RvcmUgc2VsZWN0ZWQgY29udHJvbCBlbGVtZW50XG5cdFx0XHRcdC8vIFRoaXMgaXMgbmVlZGVkIHdoZW4gZm9yIGV4YW1wbGUgYW4gaW1hZ2UgaXMgc2VsZWN0ZWQgd2l0aGluIGFcblx0XHRcdFx0Ly8gbGF5ZXIgYSBjYWxsIHRvIGZvY3VzIHdpbGwgdGhlbiByZW1vdmUgdGhlIGNvbnRyb2wgc2VsZWN0aW9uXG5cdFx0XHRcdGlmIChjb250cm9sRWxtICYmIGNvbnRyb2xFbG0ub3duZXJEb2N1bWVudCA9PSBkb2MpIHtcblx0XHRcdFx0XHRybmcgPSBkb2MuYm9keS5jcmVhdGVDb250cm9sUmFuZ2UoKTtcblx0XHRcdFx0XHRybmcuYWRkRWxlbWVudChjb250cm9sRWxtKTtcblx0XHRcdFx0XHRybmcuc2VsZWN0KCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0c2VsZi5lZGl0b3JNYW5hZ2VyLnNldEFjdGl2ZShzZWxmKTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogRXhlY3V0ZXMgYSBsZWdhY3kgY2FsbGJhY2suIFRoaXMgbWV0aG9kIGlzIHVzZWZ1bCB0byBjYWxsIG9sZCAyLnggb3B0aW9uIGNhbGxiYWNrcy5cblx0XHQgKiBUaGVyZSBuZXcgZXZlbnQgbW9kZWwgaXMgYSBiZXR0ZXIgd2F5IHRvIGFkZCBjYWxsYmFjayBzbyB0aGlzIG1ldGhvZCBtaWdodCBiZSByZW1vdmVkIGluIHRoZSBmdXR1cmUuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGV4ZWNDYWxsYmFja1xuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIE5hbWUgb2YgdGhlIGNhbGxiYWNrIHRvIGV4ZWN1dGUuXG5cdFx0ICogQHJldHVybiB7T2JqZWN0fSBSZXR1cm4gdmFsdWUgcGFzc2VkIGZyb20gY2FsbGJhY2sgZnVuY3Rpb24uXG5cdFx0ICovXG5cdFx0ZXhlY0NhbGxiYWNrOiBmdW5jdGlvbihuYW1lKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIGNhbGxiYWNrID0gc2VsZi5zZXR0aW5nc1tuYW1lXSwgc2NvcGU7XG5cblx0XHRcdGlmICghY2FsbGJhY2spIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBMb29rIHRocm91Z2ggbG9va3VwXG5cdFx0XHRpZiAoc2VsZi5jYWxsYmFja0xvb2t1cCAmJiAoc2NvcGUgPSBzZWxmLmNhbGxiYWNrTG9va3VwW25hbWVdKSkge1xuXHRcdFx0XHRjYWxsYmFjayA9IHNjb3BlLmZ1bmM7XG5cdFx0XHRcdHNjb3BlID0gc2NvcGUuc2NvcGU7XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YgY2FsbGJhY2sgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRcdHNjb3BlID0gY2FsbGJhY2sucmVwbGFjZSgvXFwuXFx3KyQvLCAnJyk7XG5cdFx0XHRcdHNjb3BlID0gc2NvcGUgPyByZXNvbHZlKHNjb3BlKSA6IDA7XG5cdFx0XHRcdGNhbGxiYWNrID0gcmVzb2x2ZShjYWxsYmFjayk7XG5cdFx0XHRcdHNlbGYuY2FsbGJhY2tMb29rdXAgPSBzZWxmLmNhbGxiYWNrTG9va3VwIHx8IHt9O1xuXHRcdFx0XHRzZWxmLmNhbGxiYWNrTG9va3VwW25hbWVdID0ge2Z1bmM6IGNhbGxiYWNrLCBzY29wZTogc2NvcGV9O1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gY2FsbGJhY2suYXBwbHkoc2NvcGUgfHwgc2VsZiwgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFRyYW5zbGF0ZXMgdGhlIHNwZWNpZmllZCBzdHJpbmcgYnkgcmVwbGFjaW5nIHZhcmlhYmxlcyB3aXRoIGxhbmd1YWdlIHBhY2sgaXRlbXMgaXQgd2lsbCBhbHNvIGNoZWNrIGlmIHRoZXJlIGlzXG5cdFx0ICogYSBrZXkgbWF0Y2hpbmcgdGhlIGlucHV0LlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCB0cmFuc2xhdGVcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gdGV4dCBTdHJpbmcgdG8gdHJhbnNsYXRlIGJ5IHRoZSBsYW5ndWFnZSBwYWNrIGRhdGEuXG5cdFx0ICogQHJldHVybiB7U3RyaW5nfSBUcmFuc2xhdGVkIHN0cmluZy5cblx0XHQgKi9cblx0XHR0cmFuc2xhdGU6IGZ1bmN0aW9uKHRleHQpIHtcblx0XHRcdHZhciBsYW5nID0gdGhpcy5zZXR0aW5ncy5sYW5ndWFnZSB8fCAnZW4nLCBpMThuID0gdGhpcy5lZGl0b3JNYW5hZ2VyLmkxOG47XG5cblx0XHRcdGlmICghdGV4dCkge1xuXHRcdFx0XHRyZXR1cm4gJyc7XG5cdFx0XHR9XG5cblx0XHRcdHRleHQgPSBpMThuLmRhdGFbbGFuZyArICcuJyArIHRleHRdIHx8IHRleHQucmVwbGFjZSgvXFx7XFwjKFteXFx9XSspXFx9L2csIGZ1bmN0aW9uKGEsIGIpIHtcblx0XHRcdFx0cmV0dXJuIGkxOG4uZGF0YVtsYW5nICsgJy4nICsgYl0gfHwgJ3sjJyArIGIgKyAnfSc7XG5cdFx0XHR9KTtcblxuXHRcdFx0cmV0dXJuIHRoaXMuZWRpdG9yTWFuYWdlci50cmFuc2xhdGUodGV4dCk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFJldHVybnMgYSBsYW5ndWFnZSBwYWNrIGl0ZW0gYnkgbmFtZS9rZXkuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGdldExhbmdcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSBOYW1lL2tleSB0byBnZXQgZnJvbSB0aGUgbGFuZ3VhZ2UgcGFjay5cblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gZGVmYXVsdFZhbCBPcHRpb25hbCBkZWZhdWx0IHZhbHVlIHRvIHJldHJpZXZlLlxuXHRcdCAqL1xuXHRcdGdldExhbmc6IGZ1bmN0aW9uKG5hbWUsIGRlZmF1bHRWYWwpIHtcblx0XHRcdHJldHVybiAoXG5cdFx0XHRcdHRoaXMuZWRpdG9yTWFuYWdlci5pMThuLmRhdGFbKHRoaXMuc2V0dGluZ3MubGFuZ3VhZ2UgfHwgJ2VuJykgKyAnLicgKyBuYW1lXSB8fFxuXHRcdFx0XHQoZGVmYXVsdFZhbCAhPT0gdW5kZWZpbmVkID8gZGVmYXVsdFZhbCA6ICd7IycgKyBuYW1lICsgJ30nKVxuXHRcdFx0KTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyBhIGNvbmZpZ3VyYXRpb24gcGFyYW1ldGVyIGJ5IG5hbWUuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGdldFBhcmFtXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IG5hbWUgQ29uZmlncnVhdGlvbiBwYXJhbWV0ZXIgdG8gcmV0cmlldmUuXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IGRlZmF1bHRWYWwgT3B0aW9uYWwgZGVmYXVsdCB2YWx1ZSB0byByZXR1cm4uXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IHR5cGUgT3B0aW9uYWwgdHlwZSBwYXJhbWV0ZXIuXG5cdFx0ICogQHJldHVybiB7U3RyaW5nfSBDb25maWd1cmF0aW9uIHBhcmFtZXRlciB2YWx1ZSBvciBkZWZhdWx0IHZhbHVlLlxuXHRcdCAqIEBleGFtcGxlXG5cdFx0ICogLy8gUmV0dXJucyBhIHNwZWNpZmljIGNvbmZpZyB2YWx1ZSBmcm9tIHRoZSBjdXJyZW50bHkgYWN0aXZlIGVkaXRvclxuXHRcdCAqIHZhciBzb21ldmFsID0gdGlueW1jZS5hY3RpdmVFZGl0b3IuZ2V0UGFyYW0oJ215dmFsdWUnKTtcblx0XHQgKlxuXHRcdCAqIC8vIFJldHVybnMgYSBzcGVjaWZpYyBjb25maWcgdmFsdWUgZnJvbSBhIHNwZWNpZmljIGVkaXRvciBpbnN0YW5jZSBieSBpZFxuXHRcdCAqIHZhciBzb21ldmFsMiA9IHRpbnltY2UuZ2V0KCdteV9lZGl0b3InKS5nZXRQYXJhbSgnbXl2YWx1ZScpO1xuXHRcdCAqL1xuXHRcdGdldFBhcmFtOiBmdW5jdGlvbihuYW1lLCBkZWZhdWx0VmFsLCB0eXBlKSB7XG5cdFx0XHR2YXIgdmFsdWUgPSBuYW1lIGluIHRoaXMuc2V0dGluZ3MgPyB0aGlzLnNldHRpbmdzW25hbWVdIDogZGVmYXVsdFZhbCwgb3V0cHV0O1xuXG5cdFx0XHRpZiAodHlwZSA9PT0gJ2hhc2gnKSB7XG5cdFx0XHRcdG91dHB1dCA9IHt9O1xuXG5cdFx0XHRcdGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRcdFx0ZWFjaCh2YWx1ZS5pbmRleE9mKCc9JykgPiAwID8gdmFsdWUuc3BsaXQoL1s7LF0oPyFbXj07LF0qKD86WzssXXwkKSkvKSA6IHZhbHVlLnNwbGl0KCcsJyksIGZ1bmN0aW9uKHZhbHVlKSB7XG5cdFx0XHRcdFx0XHR2YWx1ZSA9IHZhbHVlLnNwbGl0KCc9Jyk7XG5cblx0XHRcdFx0XHRcdGlmICh2YWx1ZS5sZW5ndGggPiAxKSB7XG5cdFx0XHRcdFx0XHRcdG91dHB1dFt0cmltKHZhbHVlWzBdKV0gPSB0cmltKHZhbHVlWzFdKTtcblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdG91dHB1dFt0cmltKHZhbHVlWzBdKV0gPSB0cmltKHZhbHVlKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvdXRwdXQgPSB2YWx1ZTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBvdXRwdXQ7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogRGlzcGF0Y2hlcyBvdXQgYSBvbk5vZGVDaGFuZ2UgZXZlbnQgdG8gYWxsIG9ic2VydmVycy4gVGhpcyBtZXRob2Qgc2hvdWxkIGJlIGNhbGxlZCB3aGVuIHlvdVxuXHRcdCAqIG5lZWQgdG8gdXBkYXRlIHRoZSBVSSBzdGF0ZXMgb3IgZWxlbWVudCBwYXRoIGV0Yy5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2Qgbm9kZUNoYW5nZWRcblx0XHQgKiBAcGFyYW0ge09iamVjdH0gYXJncyBPcHRpb25hbCBhcmdzIHRvIHBhc3MgdG8gTm9kZUNoYW5nZSBldmVudCBoYW5kbGVycy5cblx0XHQgKi9cblx0XHRub2RlQ2hhbmdlZDogZnVuY3Rpb24oYXJncykge1xuXHRcdFx0dGhpcy5fbm9kZUNoYW5nZURpc3BhdGNoZXIubm9kZUNoYW5nZWQoYXJncyk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIEFkZHMgYSBidXR0b24gdGhhdCBsYXRlciBnZXRzIGNyZWF0ZWQgYnkgdGhlIHRoZW1lIGluIHRoZSBlZGl0b3JzIHRvb2xiYXJzLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBhZGRCdXR0b25cblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSBCdXR0b24gbmFtZSB0byBhZGQuXG5cdFx0ICogQHBhcmFtIHtPYmplY3R9IHNldHRpbmdzIFNldHRpbmdzIG9iamVjdCB3aXRoIHRpdGxlLCBjbWQgZXRjLlxuXHRcdCAqIEBleGFtcGxlXG5cdFx0ICogLy8gQWRkcyBhIGN1c3RvbSBidXR0b24gdG8gdGhlIGVkaXRvciB0aGF0IGluc2VydHMgY29udGVudHMgd2hlbiBjbGlja2VkXG5cdFx0ICogdGlueW1jZS5pbml0KHtcblx0XHQgKiAgICAuLi5cblx0XHQgKlxuXHRcdCAqICAgIHRvb2xiYXI6ICdleGFtcGxlJ1xuXHRcdCAqXG5cdFx0ICogICAgc2V0dXA6IGZ1bmN0aW9uKGVkKSB7XG5cdFx0ICogICAgICAgZWQuYWRkQnV0dG9uKCdleGFtcGxlJywge1xuXHRcdCAqICAgICAgICAgIHRpdGxlOiAnTXkgdGl0bGUnLFxuXHRcdCAqICAgICAgICAgIGltYWdlOiAnLi4vanMvdGlueW1jZS9wbHVnaW5zL2V4YW1wbGUvaW1nL2V4YW1wbGUuZ2lmJyxcblx0XHQgKiAgICAgICAgICBvbmNsaWNrOiBmdW5jdGlvbigpIHtcblx0XHQgKiAgICAgICAgICAgICBlZC5pbnNlcnRDb250ZW50KCdIZWxsbyB3b3JsZCEhJyk7XG5cdFx0ICogICAgICAgICAgfVxuXHRcdCAqICAgICAgIH0pO1xuXHRcdCAqICAgIH1cblx0XHQgKiB9KTtcblx0XHQgKi9cblx0XHRhZGRCdXR0b246IGZ1bmN0aW9uKG5hbWUsIHNldHRpbmdzKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdGlmIChzZXR0aW5ncy5jbWQpIHtcblx0XHRcdFx0c2V0dGluZ3Mub25jbGljayA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdHNlbGYuZXhlY0NvbW1hbmQoc2V0dGluZ3MuY21kKTtcblx0XHRcdFx0fTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKCFzZXR0aW5ncy50ZXh0ICYmICFzZXR0aW5ncy5pY29uKSB7XG5cdFx0XHRcdHNldHRpbmdzLmljb24gPSBuYW1lO1xuXHRcdFx0fVxuXG5cdFx0XHRzZWxmLmJ1dHRvbnMgPSBzZWxmLmJ1dHRvbnMgfHwge307XG5cdFx0XHRzZXR0aW5ncy50b29sdGlwID0gc2V0dGluZ3MudG9vbHRpcCB8fCBzZXR0aW5ncy50aXRsZTtcblx0XHRcdHNlbGYuYnV0dG9uc1tuYW1lXSA9IHNldHRpbmdzO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBBZGRzIGEgc2lkZWJhciBmb3IgdGhlIGVkaXRvciBpbnN0YW5jZS5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgYWRkU2lkZWJhclxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIFNpZGViYXIgbmFtZSB0byBhZGQuXG5cdFx0ICogQHBhcmFtIHtPYmplY3R9IHNldHRpbmdzIFNldHRpbmdzIG9iamVjdCB3aXRoIGljb24sIG9uc2hvdyBldGMuXG5cdFx0ICogQGV4YW1wbGVcblx0XHQgKiAvLyBBZGRzIGEgY3VzdG9tIHNpZGViYXIgdGhhdCB3aGVuIGNsaWNrZWQgbG9ncyB0aGUgcGFuZWwgZWxlbWVudFxuXHRcdCAqIHRpbnltY2UuaW5pdCh7XG5cdFx0ICogICAgLi4uXG5cdFx0ICogICAgc2V0dXA6IGZ1bmN0aW9uKGVkKSB7XG5cdFx0ICogICAgICAgZWQuYWRkU2lkZWJhcignZXhhbXBsZScsIHtcblx0XHQgKiAgICAgICAgICB0b29sdGlwOiAnTXkgc2lkZWJhcicsXG5cdFx0ICogICAgICAgICAgaWNvbjogJ215LXNpZGUtYmFyJyxcblx0XHQgKiAgICAgICAgICBvbnNob3c6IGZ1bmN0aW9uKGFwaSkge1xuXHRcdCAqICAgICAgICAgICAgIGNvbnNvbGUubG9nKGFwaS5lbGVtZW50KCkpO1xuXHRcdCAqICAgICAgICAgIH1cblx0XHQgKiAgICAgICB9KTtcblx0XHQgKiAgICB9XG5cdFx0ICogfSk7XG5cdFx0ICovXG5cdFx0YWRkU2lkZWJhcjogZnVuY3Rpb24gKG5hbWUsIHNldHRpbmdzKSB7XG5cdFx0XHRyZXR1cm4gU2lkZWJhci5hZGQodGhpcywgbmFtZSwgc2V0dGluZ3MpO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBBZGRzIGEgbWVudSBpdGVtIHRvIGJlIHVzZWQgaW4gdGhlIG1lbnVzIG9mIHRoZSB0aGVtZS4gVGhlcmUgbWlnaHQgYmUgbXVsdGlwbGUgaW5zdGFuY2VzXG5cdFx0ICogb2YgdGhpcyBtZW51IGl0ZW0gZm9yIGV4YW1wbGUgaXQgbWlnaHQgYmUgdXNlZCBpbiB0aGUgbWFpbiBtZW51cyBvZiB0aGUgdGhlbWUgYnV0IGFsc28gaW5cblx0XHQgKiB0aGUgY29udGV4dCBtZW51IHNvIG1ha2Ugc3VyZSB0aGF0IGl0J3Mgc2VsZiBjb250YWluZWQgYW5kIHN1cHBvcnRzIG11bHRpcGxlIGluc3RhbmNlcy5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgYWRkTWVudUl0ZW1cblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSBNZW51IGl0ZW0gbmFtZSB0byBhZGQuXG5cdFx0ICogQHBhcmFtIHtPYmplY3R9IHNldHRpbmdzIFNldHRpbmdzIG9iamVjdCB3aXRoIHRpdGxlLCBjbWQgZXRjLlxuXHRcdCAqIEBleGFtcGxlXG5cdFx0ICogLy8gQWRkcyBhIGN1c3RvbSBtZW51IGl0ZW0gdG8gdGhlIGVkaXRvciB0aGF0IGluc2VydHMgY29udGVudHMgd2hlbiBjbGlja2VkXG5cdFx0ICogLy8gVGhlIGNvbnRleHQgb3B0aW9uIGFsbG93cyB5b3UgdG8gYWRkIHRoZSBtZW51IGl0ZW0gdG8gYW4gZXhpc3RpbmcgZGVmYXVsdCBtZW51XG5cdFx0ICogdGlueW1jZS5pbml0KHtcblx0XHQgKiAgICAuLi5cblx0XHQgKlxuXHRcdCAqICAgIHNldHVwOiBmdW5jdGlvbihlZCkge1xuXHRcdCAqICAgICAgIGVkLmFkZE1lbnVJdGVtKCdleGFtcGxlJywge1xuXHRcdCAqICAgICAgICAgIHRleHQ6ICdNeSBtZW51IGl0ZW0nLFxuXHRcdCAqICAgICAgICAgIGNvbnRleHQ6ICd0b29scycsXG5cdFx0ICogICAgICAgICAgb25jbGljazogZnVuY3Rpb24oKSB7XG5cdFx0ICogICAgICAgICAgICAgZWQuaW5zZXJ0Q29udGVudCgnSGVsbG8gd29ybGQhIScpO1xuXHRcdCAqICAgICAgICAgIH1cblx0XHQgKiAgICAgICB9KTtcblx0XHQgKiAgICB9XG5cdFx0ICogfSk7XG5cdFx0ICovXG5cdFx0YWRkTWVudUl0ZW06IGZ1bmN0aW9uKG5hbWUsIHNldHRpbmdzKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdGlmIChzZXR0aW5ncy5jbWQpIHtcblx0XHRcdFx0c2V0dGluZ3Mub25jbGljayA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdHNlbGYuZXhlY0NvbW1hbmQoc2V0dGluZ3MuY21kKTtcblx0XHRcdFx0fTtcblx0XHRcdH1cblxuXHRcdFx0c2VsZi5tZW51SXRlbXMgPSBzZWxmLm1lbnVJdGVtcyB8fCB7fTtcblx0XHRcdHNlbGYubWVudUl0ZW1zW25hbWVdID0gc2V0dGluZ3M7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIEFkZHMgYSBjb250ZXh0dWFsIHRvb2xiYXIgdG8gYmUgcmVuZGVyZWQgd2hlbiB0aGUgc2VsZWN0b3IgbWF0Y2hlcy5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgYWRkQ29udGV4dFRvb2xiYXJcblx0XHQgKiBAcGFyYW0ge2Z1bmN0aW9uL3N0cmluZ30gcHJlZGljYXRlIFByZWRpY2F0ZSB0aGF0IG5lZWRzIHRvIHJldHVybiB0cnVlIGlmIHByb3ZpZGVkIHN0cmluZ3MgZ2V0IGNvbnZlcnRlZCBpbnRvIENTUyBwcmVkaWNhdGVzLlxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nL0FycmF5fSBpdGVtcyBTdHJpbmcgb3IgYXJyYXkgd2l0aCBpdGVtcyB0byBhZGQgdG8gdGhlIGNvbnRleHQgdG9vbGJhci5cblx0XHQgKi9cblx0XHRhZGRDb250ZXh0VG9vbGJhcjogZnVuY3Rpb24ocHJlZGljYXRlLCBpdGVtcykge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLCBzZWxlY3RvcjtcblxuXHRcdFx0c2VsZi5jb250ZXh0VG9vbGJhcnMgPSBzZWxmLmNvbnRleHRUb29sYmFycyB8fCBbXTtcblxuXHRcdFx0Ly8gQ29udmVydCBzZWxlY3RvciB0byBwcmVkaWNhdGVcblx0XHRcdGlmICh0eXBlb2YgcHJlZGljYXRlID09IFwic3RyaW5nXCIpIHtcblx0XHRcdFx0c2VsZWN0b3IgPSBwcmVkaWNhdGU7XG5cdFx0XHRcdHByZWRpY2F0ZSA9IGZ1bmN0aW9uKGVsbSkge1xuXHRcdFx0XHRcdHJldHVybiBzZWxmLmRvbS5pcyhlbG0sIHNlbGVjdG9yKTtcblx0XHRcdFx0fTtcblx0XHRcdH1cblxuXHRcdFx0c2VsZi5jb250ZXh0VG9vbGJhcnMucHVzaCh7XG5cdFx0XHRcdGlkOiBVdWlkLnV1aWQoJ21jZXQnKSxcblx0XHRcdFx0cHJlZGljYXRlOiBwcmVkaWNhdGUsXG5cdFx0XHRcdGl0ZW1zOiBpdGVtc1xuXHRcdFx0fSk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIEFkZHMgYSBjdXN0b20gY29tbWFuZCB0byB0aGUgZWRpdG9yLCB5b3UgY2FuIGFsc28gb3ZlcnJpZGUgZXhpc3RpbmcgY29tbWFuZHMgd2l0aCB0aGlzIG1ldGhvZC5cblx0XHQgKiBUaGUgY29tbWFuZCB0aGF0IHlvdSBhZGQgY2FuIGJlIGV4ZWN1dGVkIHdpdGggZXhlY0NvbW1hbmQuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGFkZENvbW1hbmRcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSBDb21tYW5kIG5hbWUgdG8gYWRkL292ZXJyaWRlLlxuXHRcdCAqIEBwYXJhbSB7YWRkQ29tbWFuZENhbGxiYWNrfSBjYWxsYmFjayBGdW5jdGlvbiB0byBleGVjdXRlIHdoZW4gdGhlIGNvbW1hbmQgb2NjdXJzLlxuXHRcdCAqIEBwYXJhbSB7T2JqZWN0fSBzY29wZSBPcHRpb25hbCBzY29wZSB0byBleGVjdXRlIHRoZSBmdW5jdGlvbiBpbi5cblx0XHQgKiBAZXhhbXBsZVxuXHRcdCAqIC8vIEFkZHMgYSBjdXN0b20gY29tbWFuZCB0aGF0IGxhdGVyIGNhbiBiZSBleGVjdXRlZCB1c2luZyBleGVjQ29tbWFuZFxuXHRcdCAqIHRpbnltY2UuaW5pdCh7XG5cdFx0ICogICAgLi4uXG5cdFx0ICpcblx0XHQgKiAgICBzZXR1cDogZnVuY3Rpb24oZWQpIHtcblx0XHQgKiAgICAgICAvLyBSZWdpc3RlciBleGFtcGxlIGNvbW1hbmRcblx0XHQgKiAgICAgICBlZC5hZGRDb21tYW5kKCdteWNvbW1hbmQnLCBmdW5jdGlvbih1aSwgdikge1xuXHRcdCAqICAgICAgICAgIGVkLndpbmRvd01hbmFnZXIuYWxlcnQoJ0hlbGxvIHdvcmxkISEgU2VsZWN0aW9uOiAnICsgZWQuc2VsZWN0aW9uLmdldENvbnRlbnQoe2Zvcm1hdDogJ3RleHQnfSkpO1xuXHRcdCAqICAgICAgIH0pO1xuXHRcdCAqICAgIH1cblx0XHQgKiB9KTtcblx0XHQgKi9cblx0XHRhZGRDb21tYW5kOiBmdW5jdGlvbihuYW1lLCBjYWxsYmFjaywgc2NvcGUpIHtcblx0XHRcdC8qKlxuXHRcdFx0ICogQ2FsbGJhY2sgZnVuY3Rpb24gdGhhdCBnZXRzIGNhbGxlZCB3aGVuIGEgY29tbWFuZCBpcyBleGVjdXRlZC5cblx0XHRcdCAqXG5cdFx0XHQgKiBAY2FsbGJhY2sgYWRkQ29tbWFuZENhbGxiYWNrXG5cdFx0XHQgKiBAcGFyYW0ge0Jvb2xlYW59IHVpIERpc3BsYXkgVUkgc3RhdGUgdHJ1ZS9mYWxzZS5cblx0XHRcdCAqIEBwYXJhbSB7T2JqZWN0fSB2YWx1ZSBPcHRpb25hbCB2YWx1ZSBmb3IgY29tbWFuZC5cblx0XHRcdCAqIEByZXR1cm4ge0Jvb2xlYW59IFRydWUvZmFsc2Ugc3RhdGUgaWYgdGhlIGNvbW1hbmQgd2FzIGhhbmRsZWQgb3Igbm90LlxuXHRcdFx0ICovXG5cdFx0XHR0aGlzLmVkaXRvckNvbW1hbmRzLmFkZENvbW1hbmQobmFtZSwgY2FsbGJhY2ssIHNjb3BlKTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogQWRkcyBhIGN1c3RvbSBxdWVyeSBzdGF0ZSBjb21tYW5kIHRvIHRoZSBlZGl0b3IsIHlvdSBjYW4gYWxzbyBvdmVycmlkZSBleGlzdGluZyBjb21tYW5kcyB3aXRoIHRoaXMgbWV0aG9kLlxuXHRcdCAqIFRoZSBjb21tYW5kIHRoYXQgeW91IGFkZCBjYW4gYmUgZXhlY3V0ZWQgd2l0aCBxdWVyeUNvbW1hbmRTdGF0ZSBmdW5jdGlvbi5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgYWRkUXVlcnlTdGF0ZUhhbmRsZXJcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSBDb21tYW5kIG5hbWUgdG8gYWRkL292ZXJyaWRlLlxuXHRcdCAqIEBwYXJhbSB7YWRkUXVlcnlTdGF0ZUhhbmRsZXJDYWxsYmFja30gY2FsbGJhY2sgRnVuY3Rpb24gdG8gZXhlY3V0ZSB3aGVuIHRoZSBjb21tYW5kIHN0YXRlIHJldHJpZXZhbCBvY2N1cnMuXG5cdFx0ICogQHBhcmFtIHtPYmplY3R9IHNjb3BlIE9wdGlvbmFsIHNjb3BlIHRvIGV4ZWN1dGUgdGhlIGZ1bmN0aW9uIGluLlxuXHRcdCAqL1xuXHRcdGFkZFF1ZXJ5U3RhdGVIYW5kbGVyOiBmdW5jdGlvbihuYW1lLCBjYWxsYmFjaywgc2NvcGUpIHtcblx0XHRcdC8qKlxuXHRcdFx0ICogQ2FsbGJhY2sgZnVuY3Rpb24gdGhhdCBnZXRzIGNhbGxlZCB3aGVuIGEgcXVlcnlDb21tYW5kU3RhdGUgaXMgZXhlY3V0ZWQuXG5cdFx0XHQgKlxuXHRcdFx0ICogQGNhbGxiYWNrIGFkZFF1ZXJ5U3RhdGVIYW5kbGVyQ2FsbGJhY2tcblx0XHRcdCAqIEByZXR1cm4ge0Jvb2xlYW59IFRydWUvZmFsc2Ugc3RhdGUgaWYgdGhlIGNvbW1hbmQgaXMgZW5hYmxlZCBvciBub3QgbGlrZSBpcyBpdCBib2xkLlxuXHRcdFx0ICovXG5cdFx0XHR0aGlzLmVkaXRvckNvbW1hbmRzLmFkZFF1ZXJ5U3RhdGVIYW5kbGVyKG5hbWUsIGNhbGxiYWNrLCBzY29wZSk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIEFkZHMgYSBjdXN0b20gcXVlcnkgdmFsdWUgY29tbWFuZCB0byB0aGUgZWRpdG9yLCB5b3UgY2FuIGFsc28gb3ZlcnJpZGUgZXhpc3RpbmcgY29tbWFuZHMgd2l0aCB0aGlzIG1ldGhvZC5cblx0XHQgKiBUaGUgY29tbWFuZCB0aGF0IHlvdSBhZGQgY2FuIGJlIGV4ZWN1dGVkIHdpdGggcXVlcnlDb21tYW5kVmFsdWUgZnVuY3Rpb24uXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGFkZFF1ZXJ5VmFsdWVIYW5kbGVyXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IG5hbWUgQ29tbWFuZCBuYW1lIHRvIGFkZC9vdmVycmlkZS5cblx0XHQgKiBAcGFyYW0ge2FkZFF1ZXJ5VmFsdWVIYW5kbGVyQ2FsbGJhY2t9IGNhbGxiYWNrIEZ1bmN0aW9uIHRvIGV4ZWN1dGUgd2hlbiB0aGUgY29tbWFuZCB2YWx1ZSByZXRyaWV2YWwgb2NjdXJzLlxuXHRcdCAqIEBwYXJhbSB7T2JqZWN0fSBzY29wZSBPcHRpb25hbCBzY29wZSB0byBleGVjdXRlIHRoZSBmdW5jdGlvbiBpbi5cblx0XHQgKi9cblx0XHRhZGRRdWVyeVZhbHVlSGFuZGxlcjogZnVuY3Rpb24obmFtZSwgY2FsbGJhY2ssIHNjb3BlKSB7XG5cdFx0XHQvKipcblx0XHRcdCAqIENhbGxiYWNrIGZ1bmN0aW9uIHRoYXQgZ2V0cyBjYWxsZWQgd2hlbiBhIHF1ZXJ5Q29tbWFuZFZhbHVlIGlzIGV4ZWN1dGVkLlxuXHRcdFx0ICpcblx0XHRcdCAqIEBjYWxsYmFjayBhZGRRdWVyeVZhbHVlSGFuZGxlckNhbGxiYWNrXG5cdFx0XHQgKiBAcmV0dXJuIHtPYmplY3R9IFZhbHVlIG9mIHRoZSBjb21tYW5kIG9yIHVuZGVmaW5lZC5cblx0XHRcdCAqL1xuXHRcdFx0dGhpcy5lZGl0b3JDb21tYW5kcy5hZGRRdWVyeVZhbHVlSGFuZGxlcihuYW1lLCBjYWxsYmFjaywgc2NvcGUpO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBBZGRzIGEga2V5Ym9hcmQgc2hvcnRjdXQgZm9yIHNvbWUgY29tbWFuZCBvciBmdW5jdGlvbi5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgYWRkU2hvcnRjdXRcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gcGF0dGVybiBTaG9ydGN1dCBwYXR0ZXJuLiBMaWtlIGZvciBleGFtcGxlOiBjdHJsK2FsdCtvLlxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBkZXNjIFRleHQgZGVzY3JpcHRpb24gZm9yIHRoZSBjb21tYW5kLlxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nL0Z1bmN0aW9ufSBjbWRGdW5jIENvbW1hbmQgbmFtZSBzdHJpbmcgb3IgZnVuY3Rpb24gdG8gZXhlY3V0ZSB3aGVuIHRoZSBrZXkgaXMgcHJlc3NlZC5cblx0XHQgKiBAcGFyYW0ge09iamVjdH0gc2MgT3B0aW9uYWwgc2NvcGUgdG8gZXhlY3V0ZSB0aGUgZnVuY3Rpb24gaW4uXG5cdFx0ICogQHJldHVybiB7Qm9vbGVhbn0gdHJ1ZS9mYWxzZSBzdGF0ZSBpZiB0aGUgc2hvcnRjdXQgd2FzIGFkZGVkIG9yIG5vdC5cblx0XHQgKi9cblx0XHRhZGRTaG9ydGN1dDogZnVuY3Rpb24ocGF0dGVybiwgZGVzYywgY21kRnVuYywgc2NvcGUpIHtcblx0XHRcdHRoaXMuc2hvcnRjdXRzLmFkZChwYXR0ZXJuLCBkZXNjLCBjbWRGdW5jLCBzY29wZSk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIEV4ZWN1dGVzIGEgY29tbWFuZCBvbiB0aGUgY3VycmVudCBpbnN0YW5jZS4gVGhlc2UgY29tbWFuZHMgY2FuIGJlIFRpbnlNQ0UgaW50ZXJuYWwgY29tbWFuZHMgcHJlZml4ZWQgd2l0aCBcIm1jZVwiIG9yXG5cdFx0ICogdGhleSBjYW4gYmUgYnVpbGQgaW4gYnJvd3NlciBjb21tYW5kcyBzdWNoIGFzIFwiQm9sZFwiLiBBIGNvbXBsZWF0ZSBsaXN0IG9mIGJyb3dzZXIgY29tbWFuZHMgaXMgYXZhaWxhYmxlIG9uIE1TRE4gb3IgTW96aWxsYS5vcmcuXG5cdFx0ICogVGhpcyBmdW5jdGlvbiB3aWxsIGRpc3BhdGNoIHRoZSBleGVjQ29tbWFuZCBmdW5jdGlvbiBvbiBlYWNoIHBsdWdpbiwgdGhlbWUgb3IgdGhlIGV4ZWNjb21tYW5kX2NhbGxiYWNrIG9wdGlvbiBpZiBub25lIG9mIHRoZXNlXG5cdFx0ICogcmV0dXJuIHRydWUgaXQgd2lsbCBoYW5kbGUgdGhlIGNvbW1hbmQgYXMgYSBpbnRlcm5hbCBicm93c2VyIGNvbW1hbmQuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGV4ZWNDb21tYW5kXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IGNtZCBDb21tYW5kIG5hbWUgdG8gZXhlY3V0ZSwgZm9yIGV4YW1wbGUgbWNlTGluayBvciBCb2xkLlxuXHRcdCAqIEBwYXJhbSB7Qm9vbGVhbn0gdWkgVHJ1ZS9mYWxzZSBzdGF0ZSBpZiBhIFVJIChkaWFsb2cpIHNob3VsZCBiZSBwcmVzZW50ZWQgb3Igbm90LlxuXHRcdCAqIEBwYXJhbSB7bWl4ZWR9IHZhbHVlIE9wdGlvbmFsIGNvbW1hbmQgdmFsdWUsIHRoaXMgY2FuIGJlIGFueXRoaW5nLlxuXHRcdCAqIEBwYXJhbSB7T2JqZWN0fSBhcmdzIE9wdGlvbmFsIGFyZ3VtZW50cyBvYmplY3QuXG5cdFx0ICovXG5cdFx0ZXhlY0NvbW1hbmQ6IGZ1bmN0aW9uKGNtZCwgdWksIHZhbHVlLCBhcmdzKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5lZGl0b3JDb21tYW5kcy5leGVjQ29tbWFuZChjbWQsIHVpLCB2YWx1ZSwgYXJncyk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFJldHVybnMgYSBjb21tYW5kIHNwZWNpZmljIHN0YXRlLCBmb3IgZXhhbXBsZSBpZiBib2xkIGlzIGVuYWJsZWQgb3Igbm90LlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBxdWVyeUNvbW1hbmRTdGF0ZVxuXHRcdCAqIEBwYXJhbSB7c3RyaW5nfSBjbWQgQ29tbWFuZCB0byBxdWVyeSBzdGF0ZSBmcm9tLlxuXHRcdCAqIEByZXR1cm4ge0Jvb2xlYW59IENvbW1hbmQgc3BlY2lmaWMgc3RhdGUsIGZvciBleGFtcGxlIGlmIGJvbGQgaXMgZW5hYmxlZCBvciBub3QuXG5cdFx0ICovXG5cdFx0cXVlcnlDb21tYW5kU3RhdGU6IGZ1bmN0aW9uKGNtZCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuZWRpdG9yQ29tbWFuZHMucXVlcnlDb21tYW5kU3RhdGUoY21kKTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyBhIGNvbW1hbmQgc3BlY2lmaWMgdmFsdWUsIGZvciBleGFtcGxlIHRoZSBjdXJyZW50IGZvbnQgc2l6ZS5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgcXVlcnlDb21tYW5kVmFsdWVcblx0XHQgKiBAcGFyYW0ge3N0cmluZ30gY21kIENvbW1hbmQgdG8gcXVlcnkgdmFsdWUgZnJvbS5cblx0XHQgKiBAcmV0dXJuIHtPYmplY3R9IENvbW1hbmQgc3BlY2lmaWMgdmFsdWUsIGZvciBleGFtcGxlIHRoZSBjdXJyZW50IGZvbnQgc2l6ZS5cblx0XHQgKi9cblx0XHRxdWVyeUNvbW1hbmRWYWx1ZTogZnVuY3Rpb24oY21kKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5lZGl0b3JDb21tYW5kcy5xdWVyeUNvbW1hbmRWYWx1ZShjbWQpO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZXR1cm5zIHRydWUvZmFsc2UgaWYgdGhlIGNvbW1hbmQgaXMgc3VwcG9ydGVkIG9yIG5vdC5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgcXVlcnlDb21tYW5kU3VwcG9ydGVkXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IGNtZCBDb21tYW5kIHRoYXQgd2UgY2hlY2sgc3VwcG9ydCBmb3IuXG5cdFx0ICogQHJldHVybiB7Qm9vbGVhbn0gdHJ1ZS9mYWxzZSBpZiB0aGUgY29tbWFuZCBpcyBzdXBwb3J0ZWQgb3Igbm90LlxuXHRcdCAqL1xuXHRcdHF1ZXJ5Q29tbWFuZFN1cHBvcnRlZDogZnVuY3Rpb24oY21kKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5lZGl0b3JDb21tYW5kcy5xdWVyeUNvbW1hbmRTdXBwb3J0ZWQoY21kKTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogU2hvd3MgdGhlIGVkaXRvciBhbmQgaGlkZXMgYW55IHRleHRhcmVhL2RpdiB0aGF0IHRoZSBlZGl0b3IgaXMgc3VwcG9zZWQgdG8gcmVwbGFjZS5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2Qgc2hvd1xuXHRcdCAqL1xuXHRcdHNob3c6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHRpZiAoc2VsZi5oaWRkZW4pIHtcblx0XHRcdFx0c2VsZi5oaWRkZW4gPSBmYWxzZTtcblxuXHRcdFx0XHRpZiAoc2VsZi5pbmxpbmUpIHtcblx0XHRcdFx0XHRzZWxmLmdldEJvZHkoKS5jb250ZW50RWRpdGFibGUgPSB0cnVlO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdERPTS5zaG93KHNlbGYuZ2V0Q29udGFpbmVyKCkpO1xuXHRcdFx0XHRcdERPTS5oaWRlKHNlbGYuaWQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0c2VsZi5sb2FkKCk7XG5cdFx0XHRcdHNlbGYuZmlyZSgnc2hvdycpO1xuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBIaWRlcyB0aGUgZWRpdG9yIGFuZCBzaG93cyBhbnkgdGV4dGFyZWEvZGl2IHRoYXQgdGhlIGVkaXRvciBpcyBzdXBwb3NlZCB0byByZXBsYWNlLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBoaWRlXG5cdFx0ICovXG5cdFx0aGlkZTogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIGRvYyA9IHNlbGYuZ2V0RG9jKCk7XG5cblx0XHRcdGlmICghc2VsZi5oaWRkZW4pIHtcblx0XHRcdFx0Ly8gRml4ZWQgYnVnIHdoZXJlIElFIGhhcyBhIGJsaW5raW5nIGN1cnNvciBsZWZ0IGZyb20gdGhlIGVkaXRvclxuXHRcdFx0XHRpZiAoaWUgJiYgZG9jICYmICFzZWxmLmlubGluZSkge1xuXHRcdFx0XHRcdGRvYy5leGVjQ29tbWFuZCgnU2VsZWN0QWxsJyk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBXZSBtdXN0IHNhdmUgYmVmb3JlIHdlIGhpZGUgc28gU2FmYXJpIGRvZXNuJ3QgY3Jhc2hcblx0XHRcdFx0c2VsZi5zYXZlKCk7XG5cblx0XHRcdFx0aWYgKHNlbGYuaW5saW5lKSB7XG5cdFx0XHRcdFx0c2VsZi5nZXRCb2R5KCkuY29udGVudEVkaXRhYmxlID0gZmFsc2U7XG5cblx0XHRcdFx0XHQvLyBNYWtlIHN1cmUgdGhlIGVkaXRvciBnZXRzIGJsdXJyZWRcblx0XHRcdFx0XHRpZiAoc2VsZiA9PSBzZWxmLmVkaXRvck1hbmFnZXIuZm9jdXNlZEVkaXRvcikge1xuXHRcdFx0XHRcdFx0c2VsZi5lZGl0b3JNYW5hZ2VyLmZvY3VzZWRFZGl0b3IgPSBudWxsO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRET00uaGlkZShzZWxmLmdldENvbnRhaW5lcigpKTtcblx0XHRcdFx0XHRET00uc2V0U3R5bGUoc2VsZi5pZCwgJ2Rpc3BsYXknLCBzZWxmLm9yZ0Rpc3BsYXkpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0c2VsZi5oaWRkZW4gPSB0cnVlO1xuXHRcdFx0XHRzZWxmLmZpcmUoJ2hpZGUnKTtcblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyB0cnVlL2ZhbHNlIGlmIHRoZSBlZGl0b3IgaXMgaGlkZGVuIG9yIG5vdC5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgaXNIaWRkZW5cblx0XHQgKiBAcmV0dXJuIHtCb29sZWFufSBUcnVlL2ZhbHNlIGlmIHRoZSBlZGl0b3IgaXMgaGlkZGVuIG9yIG5vdC5cblx0XHQgKi9cblx0XHRpc0hpZGRlbjogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gISF0aGlzLmhpZGRlbjtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogU2V0cyB0aGUgcHJvZ3Jlc3Mgc3RhdGUsIHRoaXMgd2lsbCBkaXNwbGF5IGEgdGhyb2JiZXIvcHJvZ2VzcyBmb3IgdGhlIGVkaXRvci5cblx0XHQgKiBUaGlzIGlzIGlkZWFsIGZvciBhc3luY2hyb25vdXMgb3BlcmF0aW9ucyBsaWtlIGFuIEFKQVggc2F2ZSBjYWxsLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBzZXRQcm9ncmVzc1N0YXRlXG5cdFx0ICogQHBhcmFtIHtCb29sZWFufSBzdGF0ZSBCb29sZWFuIHN0YXRlIGlmIHRoZSBwcm9ncmVzcyBzaG91bGQgYmUgc2hvd24gb3IgaGlkZGVuLlxuXHRcdCAqIEBwYXJhbSB7TnVtYmVyfSB0aW1lIE9wdGlvbmFsIHRpbWUgdG8gd2FpdCBiZWZvcmUgdGhlIHByb2dyZXNzIGdldHMgc2hvd24uXG5cdFx0ICogQHJldHVybiB7Qm9vbGVhbn0gU2FtZSBhcyB0aGUgaW5wdXQgc3RhdGUuXG5cdFx0ICogQGV4YW1wbGVcblx0XHQgKiAvLyBTaG93IHByb2dyZXNzIGZvciB0aGUgYWN0aXZlIGVkaXRvclxuXHRcdCAqIHRpbnltY2UuYWN0aXZlRWRpdG9yLnNldFByb2dyZXNzU3RhdGUodHJ1ZSk7XG5cdFx0ICpcblx0XHQgKiAvLyBIaWRlIHByb2dyZXNzIGZvciB0aGUgYWN0aXZlIGVkaXRvclxuXHRcdCAqIHRpbnltY2UuYWN0aXZlRWRpdG9yLnNldFByb2dyZXNzU3RhdGUoZmFsc2UpO1xuXHRcdCAqXG5cdFx0ICogLy8gU2hvdyBwcm9ncmVzcyBhZnRlciAzIHNlY29uZHNcblx0XHQgKiB0aW55bWNlLmFjdGl2ZUVkaXRvci5zZXRQcm9ncmVzc1N0YXRlKHRydWUsIDMwMDApO1xuXHRcdCAqL1xuXHRcdHNldFByb2dyZXNzU3RhdGU6IGZ1bmN0aW9uKHN0YXRlLCB0aW1lKSB7XG5cdFx0XHR0aGlzLmZpcmUoJ1Byb2dyZXNzU3RhdGUnLCB7c3RhdGU6IHN0YXRlLCB0aW1lOiB0aW1lfSk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIExvYWRzIGNvbnRlbnRzIGZyb20gdGhlIHRleHRhcmVhIG9yIGRpdiBlbGVtZW50IHRoYXQgZ290IGNvbnZlcnRlZCBpbnRvIGFuIGVkaXRvciBpbnN0YW5jZS5cblx0XHQgKiBUaGlzIG1ldGhvZCB3aWxsIG1vdmUgdGhlIGNvbnRlbnRzIGZyb20gdGhhdCB0ZXh0YXJlYSBvciBkaXYgaW50byB0aGUgZWRpdG9yIGJ5IHVzaW5nIHNldENvbnRlbnRcblx0XHQgKiBzbyBhbGwgZXZlbnRzIGV0YyB0aGF0IG1ldGhvZCBoYXMgd2lsbCBnZXQgZGlzcGF0Y2hlZCBhcyB3ZWxsLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBsb2FkXG5cdFx0ICogQHBhcmFtIHtPYmplY3R9IGFyZ3MgT3B0aW9uYWwgY29udGVudCBvYmplY3QsIHRoaXMgZ2V0cyBwYXNzZWQgYXJvdW5kIHRocm91Z2ggdGhlIHdob2xlIGxvYWQgcHJvY2Vzcy5cblx0XHQgKiBAcmV0dXJuIHtTdHJpbmd9IEhUTUwgc3RyaW5nIHRoYXQgZ290IHNldCBpbnRvIHRoZSBlZGl0b3IuXG5cdFx0ICovXG5cdFx0bG9hZDogZnVuY3Rpb24oYXJncykge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLCBlbG0gPSBzZWxmLmdldEVsZW1lbnQoKSwgaHRtbDtcblxuXHRcdFx0aWYgKGVsbSkge1xuXHRcdFx0XHRhcmdzID0gYXJncyB8fCB7fTtcblx0XHRcdFx0YXJncy5sb2FkID0gdHJ1ZTtcblxuXHRcdFx0XHRodG1sID0gc2VsZi5zZXRDb250ZW50KGVsbS52YWx1ZSAhPT0gdW5kZWZpbmVkID8gZWxtLnZhbHVlIDogZWxtLmlubmVySFRNTCwgYXJncyk7XG5cdFx0XHRcdGFyZ3MuZWxlbWVudCA9IGVsbTtcblxuXHRcdFx0XHRpZiAoIWFyZ3Mubm9fZXZlbnRzKSB7XG5cdFx0XHRcdFx0c2VsZi5maXJlKCdMb2FkQ29udGVudCcsIGFyZ3MpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0YXJncy5lbGVtZW50ID0gZWxtID0gbnVsbDtcblxuXHRcdFx0XHRyZXR1cm4gaHRtbDtcblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogU2F2ZXMgdGhlIGNvbnRlbnRzIGZyb20gYSBlZGl0b3Igb3V0IHRvIHRoZSB0ZXh0YXJlYSBvciBkaXYgZWxlbWVudCB0aGF0IGdvdCBjb252ZXJ0ZWQgaW50byBhbiBlZGl0b3IgaW5zdGFuY2UuXG5cdFx0ICogVGhpcyBtZXRob2Qgd2lsbCBtb3ZlIHRoZSBIVE1MIGNvbnRlbnRzIGZyb20gdGhlIGVkaXRvciBpbnRvIHRoYXQgdGV4dGFyZWEgb3IgZGl2IGJ5IGdldENvbnRlbnRcblx0XHQgKiBzbyBhbGwgZXZlbnRzIGV0YyB0aGF0IG1ldGhvZCBoYXMgd2lsbCBnZXQgZGlzcGF0Y2hlZCBhcyB3ZWxsLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBzYXZlXG5cdFx0ICogQHBhcmFtIHtPYmplY3R9IGFyZ3MgT3B0aW9uYWwgY29udGVudCBvYmplY3QsIHRoaXMgZ2V0cyBwYXNzZWQgYXJvdW5kIHRocm91Z2ggdGhlIHdob2xlIHNhdmUgcHJvY2Vzcy5cblx0XHQgKiBAcmV0dXJuIHtTdHJpbmd9IEhUTUwgc3RyaW5nIHRoYXQgZ290IHNldCBpbnRvIHRoZSB0ZXh0YXJlYS9kaXYuXG5cdFx0ICovXG5cdFx0c2F2ZTogZnVuY3Rpb24oYXJncykge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLCBlbG0gPSBzZWxmLmdldEVsZW1lbnQoKSwgaHRtbCwgZm9ybTtcblxuXHRcdFx0aWYgKCFlbG0gfHwgIXNlbGYuaW5pdGlhbGl6ZWQpIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHRhcmdzID0gYXJncyB8fCB7fTtcblx0XHRcdGFyZ3Muc2F2ZSA9IHRydWU7XG5cblx0XHRcdGFyZ3MuZWxlbWVudCA9IGVsbTtcblx0XHRcdGh0bWwgPSBhcmdzLmNvbnRlbnQgPSBzZWxmLmdldENvbnRlbnQoYXJncyk7XG5cblx0XHRcdGlmICghYXJncy5ub19ldmVudHMpIHtcblx0XHRcdFx0c2VsZi5maXJlKCdTYXZlQ29udGVudCcsIGFyZ3MpO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBBbHdheXMgcnVuIHRoaXMgaW50ZXJuYWwgZXZlbnRcblx0XHRcdGlmIChhcmdzLmZvcm1hdCA9PSAncmF3Jykge1xuXHRcdFx0XHRzZWxmLmZpcmUoJ1Jhd1NhdmVDb250ZW50JywgYXJncyk7XG5cdFx0XHR9XG5cblx0XHRcdGh0bWwgPSBhcmdzLmNvbnRlbnQ7XG5cblx0XHRcdGlmICghL1RFWFRBUkVBfElOUFVUL2kudGVzdChlbG0ubm9kZU5hbWUpKSB7XG5cdFx0XHRcdC8vIFVwZGF0ZSBESVYgZWxlbWVudCB3aGVuIG5vdCBpbiBpbmxpbmUgbW9kZVxuXHRcdFx0XHRpZiAoIXNlbGYuaW5saW5lKSB7XG5cdFx0XHRcdFx0ZWxtLmlubmVySFRNTCA9IGh0bWw7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBVcGRhdGUgaGlkZGVuIGZvcm0gZWxlbWVudFxuXHRcdFx0XHRpZiAoKGZvcm0gPSBET00uZ2V0UGFyZW50KHNlbGYuaWQsICdmb3JtJykpKSB7XG5cdFx0XHRcdFx0ZWFjaChmb3JtLmVsZW1lbnRzLCBmdW5jdGlvbihlbG0pIHtcblx0XHRcdFx0XHRcdGlmIChlbG0ubmFtZSA9PSBzZWxmLmlkKSB7XG5cdFx0XHRcdFx0XHRcdGVsbS52YWx1ZSA9IGh0bWw7XG5cdFx0XHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0ZWxtLnZhbHVlID0gaHRtbDtcblx0XHRcdH1cblxuXHRcdFx0YXJncy5lbGVtZW50ID0gZWxtID0gbnVsbDtcblxuXHRcdFx0aWYgKGFyZ3Muc2V0X2RpcnR5ICE9PSBmYWxzZSkge1xuXHRcdFx0XHRzZWxmLnNldERpcnR5KGZhbHNlKTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIGh0bWw7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFNldHMgdGhlIHNwZWNpZmllZCBjb250ZW50IHRvIHRoZSBlZGl0b3IgaW5zdGFuY2UsIHRoaXMgd2lsbCBjbGVhbnVwIHRoZSBjb250ZW50IGJlZm9yZSBpdCBnZXRzIHNldCB1c2luZ1xuXHRcdCAqIHRoZSBkaWZmZXJlbnQgY2xlYW51cCBydWxlcyBvcHRpb25zLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBzZXRDb250ZW50XG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IGNvbnRlbnQgQ29udGVudCB0byBzZXQgdG8gZWRpdG9yLCBub3JtYWxseSBIVE1MIGNvbnRlbnRzIGJ1dCBjYW4gYmUgb3RoZXIgZm9ybWF0cyBhcyB3ZWxsLlxuXHRcdCAqIEBwYXJhbSB7T2JqZWN0fSBhcmdzIE9wdGlvbmFsIGNvbnRlbnQgb2JqZWN0LCB0aGlzIGdldHMgcGFzc2VkIGFyb3VuZCB0aHJvdWdoIHRoZSB3aG9sZSBzZXQgcHJvY2Vzcy5cblx0XHQgKiBAcmV0dXJuIHtTdHJpbmd9IEhUTUwgc3RyaW5nIHRoYXQgZ290IHNldCBpbnRvIHRoZSBlZGl0b3IuXG5cdFx0ICogQGV4YW1wbGVcblx0XHQgKiAvLyBTZXRzIHRoZSBIVE1MIGNvbnRlbnRzIG9mIHRoZSBhY3RpdmVFZGl0b3IgZWRpdG9yXG5cdFx0ICogdGlueW1jZS5hY3RpdmVFZGl0b3Iuc2V0Q29udGVudCgnPHNwYW4+c29tZTwvc3Bhbj4gaHRtbCcpO1xuXHRcdCAqXG5cdFx0ICogLy8gU2V0cyB0aGUgcmF3IGNvbnRlbnRzIG9mIHRoZSBhY3RpdmVFZGl0b3IgZWRpdG9yXG5cdFx0ICogdGlueW1jZS5hY3RpdmVFZGl0b3Iuc2V0Q29udGVudCgnPHNwYW4+c29tZTwvc3Bhbj4gaHRtbCcsIHtmb3JtYXQ6ICdyYXcnfSk7XG5cdFx0ICpcblx0XHQgKiAvLyBTZXRzIHRoZSBjb250ZW50IG9mIGEgc3BlY2lmaWMgZWRpdG9yIChteV9lZGl0b3IgaW4gdGhpcyBleGFtcGxlKVxuXHRcdCAqIHRpbnltY2UuZ2V0KCdteV9lZGl0b3InKS5zZXRDb250ZW50KGRhdGEpO1xuXHRcdCAqXG5cdFx0ICogLy8gU2V0cyB0aGUgYmJjb2RlIGNvbnRlbnRzIG9mIHRoZSBhY3RpdmVFZGl0b3IgZWRpdG9yIGlmIHRoZSBiYmNvZGUgcGx1Z2luIHdhcyBhZGRlZFxuXHRcdCAqIHRpbnltY2UuYWN0aXZlRWRpdG9yLnNldENvbnRlbnQoJ1tiXXNvbWVbL2JdIGh0bWwnLCB7Zm9ybWF0OiAnYmJjb2RlJ30pO1xuXHRcdCAqL1xuXHRcdHNldENvbnRlbnQ6IGZ1bmN0aW9uKGNvbnRlbnQsIGFyZ3MpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgYm9keSA9IHNlbGYuZ2V0Qm9keSgpLCBmb3JjZWRSb290QmxvY2tOYW1lLCBwYWRkO1xuXG5cdFx0XHQvLyBTZXR1cCBhcmdzIG9iamVjdFxuXHRcdFx0YXJncyA9IGFyZ3MgfHwge307XG5cdFx0XHRhcmdzLmZvcm1hdCA9IGFyZ3MuZm9ybWF0IHx8ICdodG1sJztcblx0XHRcdGFyZ3Muc2V0ID0gdHJ1ZTtcblx0XHRcdGFyZ3MuY29udGVudCA9IGNvbnRlbnQ7XG5cblx0XHRcdC8vIERvIHByZXByb2Nlc3Npbmdcblx0XHRcdGlmICghYXJncy5ub19ldmVudHMpIHtcblx0XHRcdFx0c2VsZi5maXJlKCdCZWZvcmVTZXRDb250ZW50JywgYXJncyk7XG5cdFx0XHR9XG5cblx0XHRcdGNvbnRlbnQgPSBhcmdzLmNvbnRlbnQ7XG5cblx0XHRcdC8vIFBhZGQgZW1wdHkgY29udGVudCBpbiBHZWNrbyBhbmQgU2FmYXJpLiBDb21tYW5kcyB3aWxsIG90aGVyd2lzZSBmYWlsIG9uIHRoZSBjb250ZW50XG5cdFx0XHQvLyBJdCB3aWxsIGFsc28gYmUgaW1wb3NzaWJsZSB0byBwbGFjZSB0aGUgY2FyZXQgaW4gdGhlIGVkaXRvciB1bmxlc3MgdGhlcmUgaXMgYSBCUiBlbGVtZW50IHByZXNlbnRcblx0XHRcdGlmIChjb250ZW50Lmxlbmd0aCA9PT0gMCB8fCAvXlxccyskLy50ZXN0KGNvbnRlbnQpKSB7XG5cdFx0XHRcdHBhZGQgPSBpZSAmJiBpZSA8IDExID8gJycgOiAnPGJyIGRhdGEtbWNlLWJvZ3VzPVwiMVwiPic7XG5cblx0XHRcdFx0Ly8gVG9kbzogVGhlcmUgaXMgYSBsb3QgbW9yZSByb290IGVsZW1lbnRzIHRoYXQgbmVlZCBzcGVjaWFsIHBhZGRpbmdcblx0XHRcdFx0Ly8gc28gc2VwYXJhdGUgdGhpcyBhbmQgYWRkIGFsbCBvZiB0aGVtIGF0IHNvbWUgcG9pbnQuXG5cdFx0XHRcdGlmIChib2R5Lm5vZGVOYW1lID09ICdUQUJMRScpIHtcblx0XHRcdFx0XHRjb250ZW50ID0gJzx0cj48dGQ+JyArIHBhZGQgKyAnPC90ZD48L3RyPic7XG5cdFx0XHRcdH0gZWxzZSBpZiAoL14oVUx8T0wpJC8udGVzdChib2R5Lm5vZGVOYW1lKSkge1xuXHRcdFx0XHRcdGNvbnRlbnQgPSAnPGxpPicgKyBwYWRkICsgJzwvbGk+Jztcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGZvcmNlZFJvb3RCbG9ja05hbWUgPSBzZWxmLnNldHRpbmdzLmZvcmNlZF9yb290X2Jsb2NrO1xuXG5cdFx0XHRcdC8vIENoZWNrIGlmIGZvcmNlZFJvb3RCbG9jayBpcyBjb25maWd1cmVkIGFuZCB0aGF0IHRoZSBibG9jayBpcyBhIHZhbGlkIGNoaWxkIG9mIHRoZSBib2R5XG5cdFx0XHRcdGlmIChmb3JjZWRSb290QmxvY2tOYW1lICYmIHNlbGYuc2NoZW1hLmlzVmFsaWRDaGlsZChib2R5Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCksIGZvcmNlZFJvb3RCbG9ja05hbWUudG9Mb3dlckNhc2UoKSkpIHtcblx0XHRcdFx0XHQvLyBQYWRkIHdpdGggYm9ndXMgQlIgZWxlbWVudHMgb24gbW9kZXJuIGJyb3dzZXJzIGFuZCBJRSA3IGFuZCA4IHNpbmNlIHRoZXkgZG9uJ3QgcmVuZGVyIGVtcHR5IFAgdGFncyBwcm9wZXJseVxuXHRcdFx0XHRcdGNvbnRlbnQgPSBwYWRkO1xuXHRcdFx0XHRcdGNvbnRlbnQgPSBzZWxmLmRvbS5jcmVhdGVIVE1MKGZvcmNlZFJvb3RCbG9ja05hbWUsIHNlbGYuc2V0dGluZ3MuZm9yY2VkX3Jvb3RfYmxvY2tfYXR0cnMsIGNvbnRlbnQpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCFpZSAmJiAhY29udGVudCkge1xuXHRcdFx0XHRcdC8vIFdlIG5lZWQgdG8gYWRkIGEgQlIgd2hlbiBmb3JjZWRfcm9vdF9ibG9jayBpcyBkaXNhYmxlZCBvbiBub24gSUUgYnJvd3NlcnMgdG8gcGxhY2UgdGhlIGNhcmV0XG5cdFx0XHRcdFx0Y29udGVudCA9ICc8YnIgZGF0YS1tY2UtYm9ndXM9XCIxXCI+Jztcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHNlbGYuZG9tLnNldEhUTUwoYm9keSwgY29udGVudCk7XG5cblx0XHRcdFx0c2VsZi5maXJlKCdTZXRDb250ZW50JywgYXJncyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQvLyBQYXJzZSBhbmQgc2VyaWFsaXplIHRoZSBodG1sXG5cdFx0XHRcdGlmIChhcmdzLmZvcm1hdCAhPT0gJ3JhdycpIHtcblx0XHRcdFx0XHRjb250ZW50ID0gbmV3IFNlcmlhbGl6ZXIoe1xuXHRcdFx0XHRcdFx0dmFsaWRhdGU6IHNlbGYudmFsaWRhdGVcblx0XHRcdFx0XHR9LCBzZWxmLnNjaGVtYSkuc2VyaWFsaXplKFxuXHRcdFx0XHRcdFx0c2VsZi5wYXJzZXIucGFyc2UoY29udGVudCwge2lzUm9vdENvbnRlbnQ6IHRydWV9KVxuXHRcdFx0XHRcdCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBTZXQgdGhlIG5ldyBjbGVhbmVkIGNvbnRlbnRzIHRvIHRoZSBlZGl0b3Jcblx0XHRcdFx0YXJncy5jb250ZW50ID0gdHJpbShjb250ZW50KTtcblx0XHRcdFx0c2VsZi5kb20uc2V0SFRNTChib2R5LCBhcmdzLmNvbnRlbnQpO1xuXG5cdFx0XHRcdC8vIERvIHBvc3QgcHJvY2Vzc2luZ1xuXHRcdFx0XHRpZiAoIWFyZ3Mubm9fZXZlbnRzKSB7XG5cdFx0XHRcdFx0c2VsZi5maXJlKCdTZXRDb250ZW50JywgYXJncyk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBEb24ndCBub3JtYWxpemUgc2VsZWN0aW9uIGlmIHRoZSBmb2N1c2VkIGVsZW1lbnQgaXNuJ3QgdGhlIGJvZHkgaW5cblx0XHRcdFx0Ly8gY29udGVudCBlZGl0YWJsZSBtb2RlIHNpbmNlIGl0IHdpbGwgc3RlYWwgZm9jdXMgb3RoZXJ3aXNlXG5cdFx0XHRcdC8qaWYgKCFzZWxmLnNldHRpbmdzLmNvbnRlbnRfZWRpdGFibGUgfHwgZG9jdW1lbnQuYWN0aXZlRWxlbWVudCA9PT0gc2VsZi5nZXRCb2R5KCkpIHtcblx0XHRcdFx0XHRzZWxmLnNlbGVjdGlvbi5ub3JtYWxpemUoKTtcblx0XHRcdFx0fSovXG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBhcmdzLmNvbnRlbnQ7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIEdldHMgdGhlIGNvbnRlbnQgZnJvbSB0aGUgZWRpdG9yIGluc3RhbmNlLCB0aGlzIHdpbGwgY2xlYW51cCB0aGUgY29udGVudCBiZWZvcmUgaXQgZ2V0cyByZXR1cm5lZCB1c2luZ1xuXHRcdCAqIHRoZSBkaWZmZXJlbnQgY2xlYW51cCBydWxlcyBvcHRpb25zLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBnZXRDb250ZW50XG5cdFx0ICogQHBhcmFtIHtPYmplY3R9IGFyZ3MgT3B0aW9uYWwgY29udGVudCBvYmplY3QsIHRoaXMgZ2V0cyBwYXNzZWQgYXJvdW5kIHRocm91Z2ggdGhlIHdob2xlIGdldCBwcm9jZXNzLlxuXHRcdCAqIEByZXR1cm4ge1N0cmluZ30gQ2xlYW5lZCBjb250ZW50IHN0cmluZywgbm9ybWFsbHkgSFRNTCBjb250ZW50cy5cblx0XHQgKiBAZXhhbXBsZVxuXHRcdCAqIC8vIEdldCB0aGUgSFRNTCBjb250ZW50cyBvZiB0aGUgY3VycmVudGx5IGFjdGl2ZSBlZGl0b3Jcblx0XHQgKiBjb25zb2xlLmRlYnVnKHRpbnltY2UuYWN0aXZlRWRpdG9yLmdldENvbnRlbnQoKSk7XG5cdFx0ICpcblx0XHQgKiAvLyBHZXQgdGhlIHJhdyBjb250ZW50cyBvZiB0aGUgY3VycmVudGx5IGFjdGl2ZSBlZGl0b3Jcblx0XHQgKiB0aW55bWNlLmFjdGl2ZUVkaXRvci5nZXRDb250ZW50KHtmb3JtYXQ6ICdyYXcnfSk7XG5cdFx0ICpcblx0XHQgKiAvLyBHZXQgY29udGVudCBvZiBhIHNwZWNpZmljIGVkaXRvcjpcblx0XHQgKiB0aW55bWNlLmdldCgnY29udGVudCBpZCcpLmdldENvbnRlbnQoKVxuXHRcdCAqL1xuXHRcdGdldENvbnRlbnQ6IGZ1bmN0aW9uKGFyZ3MpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgY29udGVudCwgYm9keSA9IHNlbGYuZ2V0Qm9keSgpO1xuXG5cdFx0XHQvLyBTZXR1cCBhcmdzIG9iamVjdFxuXHRcdFx0YXJncyA9IGFyZ3MgfHwge307XG5cdFx0XHRhcmdzLmZvcm1hdCA9IGFyZ3MuZm9ybWF0IHx8ICdodG1sJztcblx0XHRcdGFyZ3MuZ2V0ID0gdHJ1ZTtcblx0XHRcdGFyZ3MuZ2V0SW5uZXIgPSB0cnVlO1xuXG5cdFx0XHQvLyBEbyBwcmVwcm9jZXNzaW5nXG5cdFx0XHRpZiAoIWFyZ3Mubm9fZXZlbnRzKSB7XG5cdFx0XHRcdHNlbGYuZmlyZSgnQmVmb3JlR2V0Q29udGVudCcsIGFyZ3MpO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBHZXQgcmF3IGNvbnRlbnRzIG9yIGJ5IGRlZmF1bHQgdGhlIGNsZWFuZWQgY29udGVudHNcblx0XHRcdGlmIChhcmdzLmZvcm1hdCA9PSAncmF3Jykge1xuXHRcdFx0XHRjb250ZW50ID0gc2VsZi5zZXJpYWxpemVyLmdldFRyaW1tZWRDb250ZW50KCk7XG5cdFx0XHR9IGVsc2UgaWYgKGFyZ3MuZm9ybWF0ID09ICd0ZXh0Jykge1xuXHRcdFx0XHRjb250ZW50ID0gYm9keS5pbm5lclRleHQgfHwgYm9keS50ZXh0Q29udGVudDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvbnRlbnQgPSBzZWxmLnNlcmlhbGl6ZXIuc2VyaWFsaXplKGJvZHksIGFyZ3MpO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBUcmltIHdoaXRlc3BhY2UgaW4gYmVnaW5uaW5nL2VuZCBvZiBIVE1MXG5cdFx0XHRpZiAoYXJncy5mb3JtYXQgIT0gJ3RleHQnKSB7XG5cdFx0XHRcdGFyZ3MuY29udGVudCA9IHRyaW0oY29udGVudCk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRhcmdzLmNvbnRlbnQgPSBjb250ZW50O1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBEbyBwb3N0IHByb2Nlc3Npbmdcblx0XHRcdGlmICghYXJncy5ub19ldmVudHMpIHtcblx0XHRcdFx0c2VsZi5maXJlKCdHZXRDb250ZW50JywgYXJncyk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBhcmdzLmNvbnRlbnQ7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIEluc2VydHMgY29udGVudCBhdCBjYXJldCBwb3NpdGlvbi5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgaW5zZXJ0Q29udGVudFxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBjb250ZW50IENvbnRlbnQgdG8gaW5zZXJ0LlxuXHRcdCAqIEBwYXJhbSB7T2JqZWN0fSBhcmdzIE9wdGlvbmFsIGFyZ3MgdG8gcGFzcyB0byBpbnNlcnQgY2FsbC5cblx0XHQgKi9cblx0XHRpbnNlcnRDb250ZW50OiBmdW5jdGlvbihjb250ZW50LCBhcmdzKSB7XG5cdFx0XHRpZiAoYXJncykge1xuXHRcdFx0XHRjb250ZW50ID0gZXh0ZW5kKHtjb250ZW50OiBjb250ZW50fSwgYXJncyk7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMuZXhlY0NvbW1hbmQoJ21jZUluc2VydENvbnRlbnQnLCBmYWxzZSwgY29udGVudCk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFJldHVybnMgdHJ1ZS9mYWxzZSBpZiB0aGUgZWRpdG9yIGlzIGRpcnR5IG9yIG5vdC4gSXQgd2lsbCBnZXQgZGlydHkgaWYgdGhlIHVzZXIgaGFzIG1hZGUgbW9kaWZpY2F0aW9ucyB0byB0aGUgY29udGVudHMuXG5cdFx0ICpcblx0XHQgKiBUaGUgZGlydHkgc3RhdGUgaXMgYXV0b21hdGljYWxseSBzZXQgdG8gdHJ1ZSBpZiB5b3UgZG8gbW9kaWZpY2F0aW9ucyB0byB0aGUgY29udGVudCBpbiBvdGhlclxuXHRcdCAqIHdvcmRzIHdoZW4gbmV3IHVuZG8gbGV2ZWxzIGlzIGNyZWF0ZWQgb3IgaWYgeW91IHVuZG8vcmVkbyB0byB1cGRhdGUgdGhlIGNvbnRlbnRzIG9mIHRoZSBlZGl0b3IuIEl0IHdpbGwgYWxzbyBiZSBzZXRcblx0XHQgKiB0byBmYWxzZSBpZiB5b3UgY2FsbCBlZGl0b3Iuc2F2ZSgpLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBpc0RpcnR5XG5cdFx0ICogQHJldHVybiB7Qm9vbGVhbn0gVHJ1ZS9mYWxzZSBpZiB0aGUgZWRpdG9yIGlzIGRpcnR5IG9yIG5vdC4gSXQgd2lsbCBnZXQgZGlydHkgaWYgdGhlIHVzZXIgaGFzIG1hZGUgbW9kaWZpY2F0aW9ucyB0byB0aGUgY29udGVudHMuXG5cdFx0ICogQGV4YW1wbGVcblx0XHQgKiBpZiAodGlueW1jZS5hY3RpdmVFZGl0b3IuaXNEaXJ0eSgpKVxuXHRcdCAqICAgICBhbGVydChcIllvdSBtdXN0IHNhdmUgeW91ciBjb250ZW50cy5cIik7XG5cdFx0ICovXG5cdFx0aXNEaXJ0eTogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gIXRoaXMuaXNOb3REaXJ0eTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogRXhwbGljaXRseSBzZXRzIHRoZSBkaXJ0eSBzdGF0ZS4gVGhpcyB3aWxsIGZpcmUgdGhlIGRpcnR5IGV2ZW50IGlmIHRoZSBlZGl0b3IgZGlydHkgc3RhdGUgaXMgY2hhbmdlZCBmcm9tIGZhbHNlIHRvIHRydWVcblx0XHQgKiBieSBpbnZva2luZyB0aGlzIG1ldGhvZC5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2Qgc2V0RGlydHlcblx0XHQgKiBAcGFyYW0ge0Jvb2xlYW59IHN0YXRlIFRydWUvZmFsc2UgaWYgdGhlIGVkaXRvciBpcyBjb25zaWRlcmVkIGRpcnR5LlxuXHRcdCAqIEBleGFtcGxlXG5cdFx0ICogZnVuY3Rpb24gYWpheFNhdmUoKSB7XG5cdFx0ICogICAgIHZhciBlZGl0b3IgPSB0aW55bWNlLmdldCgnZWxtMScpO1xuXHRcdCAqXG5cdFx0ICogICAgIC8vIFNhdmUgY29udGVudHMgdXNpbmcgc29tZSBYSFIgY2FsbFxuXHRcdCAqICAgICBhbGVydChlZGl0b3IuZ2V0Q29udGVudCgpKTtcblx0XHQgKlxuXHRcdCAqICAgICBlZGl0b3Iuc2V0RGlydHkoZmFsc2UpOyAvLyBGb3JjZSBub3QgZGlydHkgc3RhdGVcblx0XHQgKiB9XG5cdFx0ICovXG5cdFx0c2V0RGlydHk6IGZ1bmN0aW9uKHN0YXRlKSB7XG5cdFx0XHR2YXIgb2xkU3RhdGUgPSAhdGhpcy5pc05vdERpcnR5O1xuXG5cdFx0XHR0aGlzLmlzTm90RGlydHkgPSAhc3RhdGU7XG5cblx0XHRcdGlmIChzdGF0ZSAmJiBzdGF0ZSAhPSBvbGRTdGF0ZSkge1xuXHRcdFx0XHR0aGlzLmZpcmUoJ2RpcnR5Jyk7XG5cdFx0XHR9XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFNldHMgdGhlIGVkaXRvciBtb2RlLiBNb2RlIGNhbiBiZSBmb3IgZXhhbXBsZSBcImRlc2lnblwiLCBcImNvZGVcIiBvciBcInJlYWRvbmx5XCIuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHNldE1vZGVcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gbW9kZSBNb2RlIHRvIHNldCB0aGUgZWRpdG9yIGluLlxuXHRcdCAqL1xuXHRcdHNldE1vZGU6IGZ1bmN0aW9uKG1vZGUpIHtcblx0XHRcdE1vZGUuc2V0TW9kZSh0aGlzLCBtb2RlKTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyB0aGUgZWRpdG9ycyBjb250YWluZXIgZWxlbWVudC4gVGhlIGNvbnRhaW5lciBlbGVtZW50IHdyYXBwZXMgaW5cblx0XHQgKiBhbGwgdGhlIGVsZW1lbnRzIGFkZGVkIHRvIHRoZSBwYWdlIGZvciB0aGUgZWRpdG9yLiBTdWNoIGFzIFVJLCBpZnJhbWUgZXRjLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBnZXRDb250YWluZXJcblx0XHQgKiBAcmV0dXJuIHtFbGVtZW50fSBIVE1MIERPTSBlbGVtZW50IGZvciB0aGUgZWRpdG9yIGNvbnRhaW5lci5cblx0XHQgKi9cblx0XHRnZXRDb250YWluZXI6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHRpZiAoIXNlbGYuY29udGFpbmVyKSB7XG5cdFx0XHRcdHNlbGYuY29udGFpbmVyID0gRE9NLmdldChzZWxmLmVkaXRvckNvbnRhaW5lciB8fCBzZWxmLmlkICsgJ19wYXJlbnQnKTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHNlbGYuY29udGFpbmVyO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZXR1cm5zIHRoZSBlZGl0b3JzIGNvbnRlbnQgYXJlYSBjb250YWluZXIgZWxlbWVudC4gVGhlIHRoaXMgZWxlbWVudCBpcyB0aGUgb25lIHdob1xuXHRcdCAqIGhvbGRzIHRoZSBpZnJhbWUgb3IgdGhlIGVkaXRhYmxlIGVsZW1lbnQuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGdldENvbnRlbnRBcmVhQ29udGFpbmVyXG5cdFx0ICogQHJldHVybiB7RWxlbWVudH0gSFRNTCBET00gZWxlbWVudCBmb3IgdGhlIGVkaXRvciBhcmVhIGNvbnRhaW5lci5cblx0XHQgKi9cblx0XHRnZXRDb250ZW50QXJlYUNvbnRhaW5lcjogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5jb250ZW50QXJlYUNvbnRhaW5lcjtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyB0aGUgdGFyZ2V0IGVsZW1lbnQvdGV4dGFyZWEgdGhhdCBnb3QgcmVwbGFjZWQgd2l0aCBhIFRpbnlNQ0UgZWRpdG9yIGluc3RhbmNlLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBnZXRFbGVtZW50XG5cdFx0ICogQHJldHVybiB7RWxlbWVudH0gSFRNTCBET00gZWxlbWVudCBmb3IgdGhlIHJlcGxhY2VkIGVsZW1lbnQuXG5cdFx0ICovXG5cdFx0Z2V0RWxlbWVudDogZnVuY3Rpb24oKSB7XG5cdFx0XHRpZiAoIXRoaXMudGFyZ2V0RWxtKSB7XG5cdFx0XHRcdHRoaXMudGFyZ2V0RWxtID0gRE9NLmdldCh0aGlzLmlkKTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHRoaXMudGFyZ2V0RWxtO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZXR1cm5zIHRoZSBpZnJhbWVzIHdpbmRvdyBvYmplY3QuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGdldFdpblxuXHRcdCAqIEByZXR1cm4ge1dpbmRvd30gSWZyYW1lIERPTSB3aW5kb3cgb2JqZWN0LlxuXHRcdCAqL1xuXHRcdGdldFdpbjogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIGVsbTtcblxuXHRcdFx0aWYgKCFzZWxmLmNvbnRlbnRXaW5kb3cpIHtcblx0XHRcdFx0ZWxtID0gc2VsZi5pZnJhbWVFbGVtZW50O1xuXG5cdFx0XHRcdGlmIChlbG0pIHtcblx0XHRcdFx0XHRzZWxmLmNvbnRlbnRXaW5kb3cgPSBlbG0uY29udGVudFdpbmRvdztcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gc2VsZi5jb250ZW50V2luZG93O1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZXR1cm5zIHRoZSBpZnJhbWVzIGRvY3VtZW50IG9iamVjdC5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgZ2V0RG9jXG5cdFx0ICogQHJldHVybiB7RG9jdW1lbnR9IElmcmFtZSBET00gZG9jdW1lbnQgb2JqZWN0LlxuXHRcdCAqL1xuXHRcdGdldERvYzogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIHdpbjtcblxuXHRcdFx0aWYgKCFzZWxmLmNvbnRlbnREb2N1bWVudCkge1xuXHRcdFx0XHR3aW4gPSBzZWxmLmdldFdpbigpO1xuXG5cdFx0XHRcdGlmICh3aW4pIHtcblx0XHRcdFx0XHRzZWxmLmNvbnRlbnREb2N1bWVudCA9IHdpbi5kb2N1bWVudDtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gc2VsZi5jb250ZW50RG9jdW1lbnQ7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFJldHVybnMgdGhlIHJvb3QgZWxlbWVudCBvZiB0aGUgZWRpdGFibGUgYXJlYS5cblx0XHQgKiBGb3IgYSBub24taW5saW5lIGlmcmFtZS1iYXNlZCBlZGl0b3IsIHJldHVybnMgdGhlIGlmcmFtZSdzIGJvZHkgZWxlbWVudC5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgZ2V0Qm9keVxuXHRcdCAqIEByZXR1cm4ge0VsZW1lbnR9IFRoZSByb290IGVsZW1lbnQgb2YgdGhlIGVkaXRhYmxlIGFyZWEuXG5cdFx0ICovXG5cdFx0Z2V0Qm9keTogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgZG9jID0gdGhpcy5nZXREb2MoKTtcblx0XHRcdHJldHVybiB0aGlzLmJvZHlFbGVtZW50IHx8IChkb2MgPyBkb2MuYm9keSA6IG51bGwpO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBVUkwgY29udmVydGVyIGZ1bmN0aW9uIHRoaXMgZ2V0cyBleGVjdXRlZCBlYWNoIHRpbWUgYSB1c2VyIGFkZHMgYW4gaW1nLCBhIG9yXG5cdFx0ICogYW55IG90aGVyIGVsZW1lbnQgdGhhdCBoYXMgYSBVUkwgaW4gaXQuIFRoaXMgd2lsbCBiZSBjYWxsZWQgYm90aCBieSB0aGUgRE9NIGFuZCBIVE1MXG5cdFx0ICogbWFuaXB1bGF0aW9uIGZ1bmN0aW9ucy5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgY29udmVydFVSTFxuXHRcdCAqIEBwYXJhbSB7c3RyaW5nfSB1cmwgVVJMIHRvIGNvbnZlcnQuXG5cdFx0ICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgQXR0cmlidXRlIG5hbWUgc3JjLCBocmVmIGV0Yy5cblx0XHQgKiBAcGFyYW0ge3N0cmluZy9IVE1MRWxlbWVudH0gZWxtIFRhZyBuYW1lIG9yIEhUTUwgRE9NIGVsZW1lbnQgZGVwZW5kaW5nIG9uIEhUTUwgb3IgRE9NIGluc2VydC5cblx0XHQgKiBAcmV0dXJuIHtzdHJpbmd9IENvbnZlcnRlZCBVUkwgc3RyaW5nLlxuXHRcdCAqL1xuXHRcdGNvbnZlcnRVUkw6IGZ1bmN0aW9uKHVybCwgbmFtZSwgZWxtKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIHNldHRpbmdzID0gc2VsZi5zZXR0aW5ncztcblxuXHRcdFx0Ly8gVXNlIGNhbGxiYWNrIGluc3RlYWRcblx0XHRcdGlmIChzZXR0aW5ncy51cmxjb252ZXJ0ZXJfY2FsbGJhY2spIHtcblx0XHRcdFx0cmV0dXJuIHNlbGYuZXhlY0NhbGxiYWNrKCd1cmxjb252ZXJ0ZXJfY2FsbGJhY2snLCB1cmwsIGVsbSwgdHJ1ZSwgbmFtZSk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIERvbid0IGNvbnZlcnQgbGluayBocmVmIHNpbmNlIHRoYXRzIHRoZSBDU1MgZmlsZXMgdGhhdCBnZXRzIGxvYWRlZCBpbnRvIHRoZSBlZGl0b3IgYWxzbyBza2lwIGxvY2FsIGZpbGUgVVJMc1xuXHRcdFx0aWYgKCFzZXR0aW5ncy5jb252ZXJ0X3VybHMgfHwgKGVsbSAmJiBlbG0ubm9kZU5hbWUgPT0gJ0xJTksnKSB8fCB1cmwuaW5kZXhPZignZmlsZTonKSA9PT0gMCB8fCB1cmwubGVuZ3RoID09PSAwKSB7XG5cdFx0XHRcdHJldHVybiB1cmw7XG5cdFx0XHR9XG5cblx0XHRcdC8vIENvbnZlcnQgdG8gcmVsYXRpdmVcblx0XHRcdGlmIChzZXR0aW5ncy5yZWxhdGl2ZV91cmxzKSB7XG5cdFx0XHRcdHJldHVybiBzZWxmLmRvY3VtZW50QmFzZVVSSS50b1JlbGF0aXZlKHVybCk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIENvbnZlcnQgdG8gYWJzb2x1dGVcblx0XHRcdHVybCA9IHNlbGYuZG9jdW1lbnRCYXNlVVJJLnRvQWJzb2x1dGUodXJsLCBzZXR0aW5ncy5yZW1vdmVfc2NyaXB0X2hvc3QpO1xuXG5cdFx0XHRyZXR1cm4gdXJsO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBBZGRzIHZpc3VhbCBhaWQgZm9yIHRhYmxlcywgYW5jaG9ycyBldGMgc28gdGhleSBjYW4gYmUgbW9yZSBlYXNpbHkgZWRpdGVkIGluc2lkZSB0aGUgZWRpdG9yLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBhZGRWaXN1YWxcblx0XHQgKiBAcGFyYW0ge0VsZW1lbnR9IGVsbSBPcHRpb25hbCByb290IGVsZW1lbnQgdG8gbG9vcCB0aG91Z2ggdG8gZmluZCB0YWJsZXMgZXRjIHRoYXQgbmVlZHMgdGhlIHZpc3VhbCBhaWQuXG5cdFx0ICovXG5cdFx0YWRkVmlzdWFsOiBmdW5jdGlvbihlbG0pIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgc2V0dGluZ3MgPSBzZWxmLnNldHRpbmdzLCBkb20gPSBzZWxmLmRvbSwgY2xzO1xuXG5cdFx0XHRlbG0gPSBlbG0gfHwgc2VsZi5nZXRCb2R5KCk7XG5cblx0XHRcdGlmIChzZWxmLmhhc1Zpc3VhbCA9PT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRcdHNlbGYuaGFzVmlzdWFsID0gc2V0dGluZ3MudmlzdWFsO1xuXHRcdFx0fVxuXG5cdFx0XHRlYWNoKGRvbS5zZWxlY3QoJ3RhYmxlLGEnLCBlbG0pLCBmdW5jdGlvbihlbG0pIHtcblx0XHRcdFx0dmFyIHZhbHVlO1xuXG5cdFx0XHRcdHN3aXRjaCAoZWxtLm5vZGVOYW1lKSB7XG5cdFx0XHRcdFx0Y2FzZSAnVEFCTEUnOlxuXHRcdFx0XHRcdFx0Y2xzID0gc2V0dGluZ3MudmlzdWFsX3RhYmxlX2NsYXNzIHx8ICdtY2UtaXRlbS10YWJsZSc7XG5cdFx0XHRcdFx0XHR2YWx1ZSA9IGRvbS5nZXRBdHRyaWIoZWxtLCAnYm9yZGVyJyk7XG5cblx0XHRcdFx0XHRcdGlmICgoIXZhbHVlIHx8IHZhbHVlID09ICcwJykgJiYgc2VsZi5oYXNWaXN1YWwpIHtcblx0XHRcdFx0XHRcdFx0ZG9tLmFkZENsYXNzKGVsbSwgY2xzKTtcblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdGRvbS5yZW1vdmVDbGFzcyhlbG0sIGNscyk7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybjtcblxuXHRcdFx0XHRcdGNhc2UgJ0EnOlxuXHRcdFx0XHRcdFx0aWYgKCFkb20uZ2V0QXR0cmliKGVsbSwgJ2hyZWYnLCBmYWxzZSkpIHtcblx0XHRcdFx0XHRcdFx0dmFsdWUgPSBkb20uZ2V0QXR0cmliKGVsbSwgJ25hbWUnKSB8fCBlbG0uaWQ7XG5cdFx0XHRcdFx0XHRcdGNscyA9IHNldHRpbmdzLnZpc3VhbF9hbmNob3JfY2xhc3MgfHwgJ21jZS1pdGVtLWFuY2hvcic7XG5cblx0XHRcdFx0XHRcdFx0aWYgKHZhbHVlICYmIHNlbGYuaGFzVmlzdWFsKSB7XG5cdFx0XHRcdFx0XHRcdFx0ZG9tLmFkZENsYXNzKGVsbSwgY2xzKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRkb20ucmVtb3ZlQ2xhc3MoZWxtLCBjbHMpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdHNlbGYuZmlyZSgnVmlzdWFsQWlkJywge2VsZW1lbnQ6IGVsbSwgaGFzVmlzdWFsOiBzZWxmLmhhc1Zpc3VhbH0pO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZW1vdmVzIHRoZSBlZGl0b3IgZnJvbSB0aGUgZG9tIGFuZCB0aW55bWNlIGNvbGxlY3Rpb24uXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHJlbW92ZVxuXHRcdCAqL1xuXHRcdHJlbW92ZTogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdGlmICghc2VsZi5yZW1vdmVkKSB7XG5cdFx0XHRcdHNlbGYuc2F2ZSgpO1xuXHRcdFx0XHRzZWxmLnJlbW92ZWQgPSAxO1xuXHRcdFx0XHRzZWxmLnVuYmluZEFsbE5hdGl2ZUV2ZW50cygpO1xuXG5cdFx0XHRcdC8vIFJlbW92ZSBhbnkgaGlkZGVuIGlucHV0XG5cdFx0XHRcdGlmIChzZWxmLmhhc0hpZGRlbklucHV0KSB7XG5cdFx0XHRcdFx0RE9NLnJlbW92ZShzZWxmLmdldEVsZW1lbnQoKS5uZXh0U2libGluZyk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoIXNlbGYuaW5saW5lKSB7XG5cdFx0XHRcdFx0Ly8gSUUgOSBoYXMgYSBidWcgd2hlcmUgdGhlIHNlbGVjdGlvbiBzdG9wcyB3b3JraW5nIGlmIHlvdSBwbGFjZSB0aGVcblx0XHRcdFx0XHQvLyBjYXJldCBpbnNpZGUgdGhlIGVkaXRvciB0aGVuIHJlbW92ZSB0aGUgaWZyYW1lXG5cdFx0XHRcdFx0aWYgKGllICYmIGllIDwgMTApIHtcblx0XHRcdFx0XHRcdHNlbGYuZ2V0RG9jKCkuZXhlY0NvbW1hbmQoJ1NlbGVjdEFsbCcsIGZhbHNlLCBudWxsKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRET00uc2V0U3R5bGUoc2VsZi5pZCwgJ2Rpc3BsYXknLCBzZWxmLm9yZ0Rpc3BsYXkpO1xuXHRcdFx0XHRcdHNlbGYuZ2V0Qm9keSgpLm9ubG9hZCA9IG51bGw7IC8vIFByZXZlbnQgIzY4MTZcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHNlbGYuZmlyZSgncmVtb3ZlJyk7XG5cblx0XHRcdFx0c2VsZi5lZGl0b3JNYW5hZ2VyLnJlbW92ZShzZWxmKTtcblx0XHRcdFx0RE9NLnJlbW92ZShzZWxmLmdldENvbnRhaW5lcigpKTtcblx0XHRcdFx0c2VsZi5fc2VsZWN0aW9uT3ZlcnJpZGVzLmRlc3Ryb3koKTtcblx0XHRcdFx0c2VsZi5lZGl0b3JVcGxvYWQuZGVzdHJveSgpO1xuXHRcdFx0XHRzZWxmLmRlc3Ryb3koKTtcblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogRGVzdHJveXMgdGhlIGVkaXRvciBpbnN0YW5jZSBieSByZW1vdmluZyBhbGwgZXZlbnRzLCBlbGVtZW50IHJlZmVyZW5jZXMgb3Igb3RoZXIgcmVzb3VyY2VzXG5cdFx0ICogdGhhdCBjb3VsZCBsZWFrIG1lbW9yeS4gVGhpcyBtZXRob2Qgd2lsbCBiZSBjYWxsZWQgYXV0b21hdGljYWxseSB3aGVuIHRoZSBwYWdlIGlzIHVubG9hZGVkXG5cdFx0ICogYnV0IHlvdSBjYW4gYWxzbyBjYWxsIGl0IGRpcmVjdGx5IGlmIHlvdSBrbm93IHdoYXQgeW91IGFyZSBkb2luZy5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgZGVzdHJveVxuXHRcdCAqIEBwYXJhbSB7Qm9vbGVhbn0gYXV0b21hdGljIE9wdGlvbmFsIHN0YXRlIGlmIHRoZSBkZXN0cm95IGlzIGFuIGF1dG9tYXRpYyBkZXN0cm95IG9yIHVzZXIgY2FsbGVkIG9uZS5cblx0XHQgKi9cblx0XHRkZXN0cm95OiBmdW5jdGlvbihhdXRvbWF0aWMpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgZm9ybTtcblxuXHRcdFx0Ly8gT25lIHRpbWUgaXMgZW5vdWdoXG5cdFx0XHRpZiAoc2VsZi5kZXN0cm95ZWQpIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBJZiB1c2VyIG1hbnVhbGx5IGNhbGxzIGRlc3Ryb3kgYW5kIG5vdCByZW1vdmVcblx0XHRcdC8vIFVzZXJzIHNlZW1zIHRvIGhhdmUgbG9naWMgdGhhdCBjYWxscyBkZXN0cm95IGluc3RlYWQgb2YgcmVtb3ZlXG5cdFx0XHRpZiAoIWF1dG9tYXRpYyAmJiAhc2VsZi5yZW1vdmVkKSB7XG5cdFx0XHRcdHNlbGYucmVtb3ZlKCk7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0aWYgKCFhdXRvbWF0aWMpIHtcblx0XHRcdFx0c2VsZi5lZGl0b3JNYW5hZ2VyLm9mZignYmVmb3JldW5sb2FkJywgc2VsZi5fYmVmb3JlVW5sb2FkKTtcblxuXHRcdFx0XHQvLyBNYW51YWwgZGVzdHJveVxuXHRcdFx0XHRpZiAoc2VsZi50aGVtZSAmJiBzZWxmLnRoZW1lLmRlc3Ryb3kpIHtcblx0XHRcdFx0XHRzZWxmLnRoZW1lLmRlc3Ryb3koKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIERlc3Ryb3kgY29udHJvbHMsIHNlbGVjdGlvbiBhbmQgZG9tXG5cdFx0XHRcdHNlbGYuc2VsZWN0aW9uLmRlc3Ryb3koKTtcblx0XHRcdFx0c2VsZi5kb20uZGVzdHJveSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRmb3JtID0gc2VsZi5mb3JtRWxlbWVudDtcblx0XHRcdGlmIChmb3JtKSB7XG5cdFx0XHRcdGlmIChmb3JtLl9tY2VPbGRTdWJtaXQpIHtcblx0XHRcdFx0XHRmb3JtLnN1Ym1pdCA9IGZvcm0uX21jZU9sZFN1Ym1pdDtcblx0XHRcdFx0XHRmb3JtLl9tY2VPbGRTdWJtaXQgPSBudWxsO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0RE9NLnVuYmluZChmb3JtLCAnc3VibWl0IHJlc2V0Jywgc2VsZi5mb3JtRXZlbnREZWxlZ2F0ZSk7XG5cdFx0XHR9XG5cblx0XHRcdHNlbGYuY29udGVudEFyZWFDb250YWluZXIgPSBzZWxmLmZvcm1FbGVtZW50ID0gc2VsZi5jb250YWluZXIgPSBzZWxmLmVkaXRvckNvbnRhaW5lciA9IG51bGw7XG5cdFx0XHRzZWxmLmJvZHlFbGVtZW50ID0gc2VsZi5jb250ZW50RG9jdW1lbnQgPSBzZWxmLmNvbnRlbnRXaW5kb3cgPSBudWxsO1xuXHRcdFx0c2VsZi5pZnJhbWVFbGVtZW50ID0gc2VsZi50YXJnZXRFbG0gPSBudWxsO1xuXG5cdFx0XHRpZiAoc2VsZi5zZWxlY3Rpb24pIHtcblx0XHRcdFx0c2VsZi5zZWxlY3Rpb24gPSBzZWxmLnNlbGVjdGlvbi53aW4gPSBzZWxmLnNlbGVjdGlvbi5kb20gPSBzZWxmLnNlbGVjdGlvbi5kb20uZG9jID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdFx0c2VsZi5kZXN0cm95ZWQgPSAxO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBVcGxvYWRzIGFsbCBkYXRhIHVyaS9ibG9iIHVyaSBpbWFnZXMgaW4gdGhlIGVkaXRvciBjb250ZW50cyB0byBzZXJ2ZXIuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHVwbG9hZEltYWdlc1xuXHRcdCAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrIE9wdGlvbmFsIGNhbGxiYWNrIHdpdGggaW1hZ2VzIGFuZCBzdGF0dXMgZm9yIGVhY2ggaW1hZ2UuXG5cdFx0ICogQHJldHVybiB7dGlueW1jZS51dGlsLlByb21pc2V9IFByb21pc2UgaW5zdGFuY2UuXG5cdFx0ICovXG5cdFx0dXBsb2FkSW1hZ2VzOiBmdW5jdGlvbihjYWxsYmFjaykge1xuXHRcdFx0cmV0dXJuIHRoaXMuZWRpdG9yVXBsb2FkLnVwbG9hZEltYWdlcyhjYWxsYmFjayk7XG5cdFx0fSxcblxuXHRcdC8vIEludGVybmFsIGZ1bmN0aW9uc1xuXG5cdFx0X3NjYW5Gb3JJbWFnZXM6IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuZWRpdG9yVXBsb2FkLnNjYW5Gb3JJbWFnZXMoKTtcblx0XHR9XG5cdH07XG5cblx0ZXh0ZW5kKEVkaXRvci5wcm90b3R5cGUsIEVkaXRvck9ic2VydmFibGUpO1xuXG5cdHJldHVybiBFZGl0b3I7XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL3V0aWwvSTE4bi5qc1xuXG4vKipcbiAqIEkxOG4uanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBJMThuIGNsYXNzIHRoYXQgaGFuZGxlcyB0cmFuc2xhdGlvbiBvZiBUaW55TUNFIFVJLlxuICogVXNlcyBwbyBzdHlsZSB3aXRoIGNzaGFycCBzdHlsZSBwYXJhbWV0ZXJzLlxuICpcbiAqIEBjbGFzcyB0aW55bWNlLnV0aWwuSTE4blxuICovXG5kZWZpbmUoXCJ0aW55bWNlL3V0aWwvSTE4blwiLCBbXG5cdFwidGlueW1jZS91dGlsL1Rvb2xzXCJcbl0sIGZ1bmN0aW9uKFRvb2xzKSB7XG5cdFwidXNlIHN0cmljdFwiO1xuXG5cdHZhciBkYXRhID0ge30sIGNvZGUgPSBcImVuXCI7XG5cblx0cmV0dXJuIHtcblx0XHQvKipcblx0XHQgKiBTZXRzIHRoZSBjdXJyZW50IGxhbmd1YWdlIGNvZGUuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHNldENvZGVcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gbmV3Q29kZSBDdXJyZW50IGxhbmd1YWdlIGNvZGUuXG5cdFx0ICovXG5cdFx0c2V0Q29kZTogZnVuY3Rpb24obmV3Q29kZSkge1xuXHRcdFx0aWYgKG5ld0NvZGUpIHtcblx0XHRcdFx0Y29kZSA9IG5ld0NvZGU7XG5cdFx0XHRcdHRoaXMucnRsID0gdGhpcy5kYXRhW25ld0NvZGVdID8gdGhpcy5kYXRhW25ld0NvZGVdLl9kaXIgPT09ICdydGwnIDogZmFsc2U7XG5cdFx0XHR9XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFJldHVybnMgdGhlIGN1cnJlbnQgbGFuZ3VhZ2UgY29kZS5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgZ2V0Q29kZVxuXHRcdCAqIEByZXR1cm4ge1N0cmluZ30gQ3VycmVudCBsYW5ndWFnZSBjb2RlLlxuXHRcdCAqL1xuXHRcdGdldENvZGU6IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIGNvZGU7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFByb3BlcnR5IGdldHMgc2V0IHRvIHRydWUgaWYgYSBSVEwgbGFuZ3VhZ2UgcGFjayB3YXMgbG9hZGVkLlxuXHRcdCAqXG5cdFx0ICogQHByb3BlcnR5IHJ0bFxuXHRcdCAqIEB0eXBlIEJvb2xlYW5cblx0XHQgKi9cblx0XHRydGw6IGZhbHNlLFxuXG5cdFx0LyoqXG5cdFx0ICogQWRkcyB0cmFuc2xhdGlvbnMgZm9yIGEgc3BlY2lmaWMgbGFuZ3VhZ2UgY29kZS5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgYWRkXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IGNvZGUgTGFuZ3VhZ2UgY29kZSBsaWtlIHN2X1NFLlxuXHRcdCAqIEBwYXJhbSB7QXJyYXl9IGl0ZW1zIE5hbWUvdmFsdWUgYXJyYXkgd2l0aCBFbmdsaXNoIGVuX1VTIHRvIHN2X1NFLlxuXHRcdCAqL1xuXHRcdGFkZDogZnVuY3Rpb24oY29kZSwgaXRlbXMpIHtcblx0XHRcdHZhciBsYW5nRGF0YSA9IGRhdGFbY29kZV07XG5cblx0XHRcdGlmICghbGFuZ0RhdGEpIHtcblx0XHRcdFx0ZGF0YVtjb2RlXSA9IGxhbmdEYXRhID0ge307XG5cdFx0XHR9XG5cblx0XHRcdGZvciAodmFyIG5hbWUgaW4gaXRlbXMpIHtcblx0XHRcdFx0bGFuZ0RhdGFbbmFtZV0gPSBpdGVtc1tuYW1lXTtcblx0XHRcdH1cblxuXHRcdFx0dGhpcy5zZXRDb2RlKGNvZGUpO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBUcmFuc2xhdGVzIHRoZSBzcGVjaWZpZWQgdGV4dC5cblx0XHQgKlxuXHRcdCAqIEl0IGhhcyBhIGZldyBmb3JtYXRzOlxuXHRcdCAqIEkxOG4udHJhbnNsYXRlKFwiVGV4dFwiKTtcblx0XHQgKiBJMThuLnRyYW5zbGF0ZShbXCJUZXh0IHswfS97MX1cIiwgMCwgMV0pO1xuXHRcdCAqIEkxOG4udHJhbnNsYXRlKHtyYXc6IFwiUmF3IHN0cmluZ1wifSk7XG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHRyYW5zbGF0ZVxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nL09iamVjdC9BcnJheX0gdGV4dCBUZXh0IHRvIHRyYW5zbGF0ZS5cblx0XHQgKiBAcmV0dXJuIHtTdHJpbmd9IFN0cmluZyB0aGF0IGdvdCB0cmFuc2xhdGVkLlxuXHRcdCAqL1xuXHRcdHRyYW5zbGF0ZTogZnVuY3Rpb24odGV4dCkge1xuXHRcdFx0dmFyIGxhbmdEYXRhID0gZGF0YVtjb2RlXSB8fCB7fTtcblxuXHRcdFx0LyoqXG5cdFx0XHQgKiBudW1iZXIgLSBzdHJpbmdcblx0XHRcdCAqIG51bGwsIHVuZGVmaW5lZCBhbmQgZW1wdHkgc3RyaW5nIC0gZW1wdHkgc3RyaW5nXG5cdFx0XHQgKiBhcnJheSAtIGNvbW1hLWRlbGltaXRlZCBzdHJpbmdcblx0XHRcdCAqIG9iamVjdCAtIGluIFtvYmplY3QgT2JqZWN0XVxuXHRcdFx0ICogZnVuY3Rpb24gLSBpbiBbb2JqZWN0IEZ1bmN0aW9uXVxuXHRcdFx0ICpcblx0XHRcdCAqIEBwYXJhbSBvYmpcblx0XHRcdCAqIEByZXR1cm5zIHtzdHJpbmd9XG5cdFx0XHQgKi9cblx0XHRcdGZ1bmN0aW9uIHRvU3RyaW5nKG9iaikge1xuXHRcdFx0XHRpZiAoVG9vbHMuaXMob2JqLCAnZnVuY3Rpb24nKSkge1xuXHRcdFx0XHRcdHJldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwob2JqKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gIWlzRW1wdHkob2JqKSA/ICcnICsgb2JqIDogJyc7XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIGlzRW1wdHkodGV4dCkge1xuXHRcdFx0XHRyZXR1cm4gdGV4dCA9PT0gJycgfHwgdGV4dCA9PT0gbnVsbCB8fCBUb29scy5pcyh0ZXh0LCAndW5kZWZpbmVkJyk7XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIGdldExhbmdEYXRhKHRleHQpIHtcblx0XHRcdFx0Ly8gbWFrZSBzdXJlIHdlIHdvcmsgb24gYSBzdHJpbmcgYW5kIHJldHVybiBhIHN0cmluZ1xuXHRcdFx0XHR0ZXh0ID0gdG9TdHJpbmcodGV4dCk7XG5cdFx0XHRcdHJldHVybiBUb29scy5oYXNPd24obGFuZ0RhdGEsIHRleHQpID8gdG9TdHJpbmcobGFuZ0RhdGFbdGV4dF0pIDogdGV4dDtcblx0XHRcdH1cblxuXG5cdFx0XHRpZiAoaXNFbXB0eSh0ZXh0KSkge1xuXHRcdFx0XHRyZXR1cm4gJyc7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChUb29scy5pcyh0ZXh0LCAnb2JqZWN0JykgJiYgVG9vbHMuaGFzT3duKHRleHQsICdyYXcnKSkge1xuXHRcdFx0XHRyZXR1cm4gdG9TdHJpbmcodGV4dC5yYXcpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoVG9vbHMuaXModGV4dCwgJ2FycmF5JykpIHtcblx0XHRcdFx0dmFyIHZhbHVlcyA9IHRleHQuc2xpY2UoMSk7XG5cdFx0XHRcdHRleHQgPSBnZXRMYW5nRGF0YSh0ZXh0WzBdKS5yZXBsYWNlKC9cXHsoWzAtOV0rKVxcfS9nLCBmdW5jdGlvbigkMSwgJDIpIHtcblx0XHRcdFx0XHRyZXR1cm4gVG9vbHMuaGFzT3duKHZhbHVlcywgJDIpID8gdG9TdHJpbmcodmFsdWVzWyQyXSkgOiAkMTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBnZXRMYW5nRGF0YSh0ZXh0KS5yZXBsYWNlKC97Y29udGV4dDpcXHcrfSQvLCAnJyk7XG5cdFx0fSxcblxuXHRcdGRhdGE6IGRhdGFcblx0fTtcbn0pO1xuXG4vLyBJbmNsdWRlZCBmcm9tOiBqcy90aW55bWNlL2NsYXNzZXMvRm9jdXNNYW5hZ2VyLmpzXG5cbi8qKlxuICogRm9jdXNNYW5hZ2VyLmpzXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgTEdQTCBMaWNlbnNlLlxuICogQ29weXJpZ2h0IChjKSAxOTk5LTIwMTUgRXBob3ggQ29ycC4gQWxsIHJpZ2h0cyByZXNlcnZlZFxuICpcbiAqIExpY2Vuc2U6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vbGljZW5zZVxuICogQ29udHJpYnV0aW5nOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2NvbnRyaWJ1dGluZ1xuICovXG5cbi8qKlxuICogVGhpcyBjbGFzcyBtYW5hZ2VzIHRoZSBmb2N1cy9ibHVyIHN0YXRlIG9mIHRoZSBlZGl0b3IuIFRoaXMgY2xhc3MgaXMgbmVlZGVkIHNpbmNlIHNvbWVcbiAqIGJyb3dzZXJzIGZpcmUgZmFsc2UgZm9jdXMvYmx1ciBzdGF0ZXMgd2hlbiB0aGUgc2VsZWN0aW9uIGlzIG1vdmVkIHRvIGEgVUkgZGlhbG9nIG9yIHNpbWlsYXIuXG4gKlxuICogVGhpcyBjbGFzcyB3aWxsIGZpcmUgdHdvIGV2ZW50cyBmb2N1cyBhbmQgYmx1ciBvbiB0aGUgZWRpdG9yIGluc3RhbmNlcyB0aGF0IGdvdCBhZmZlY3RlZC5cbiAqIEl0IHdpbGwgYWxzbyBoYW5kbGUgdGhlIHJlc3RvcmUgb2Ygc2VsZWN0aW9uIHdoZW4gdGhlIGZvY3VzIGlzIGxvc3QgYW5kIHJldHVybmVkLlxuICpcbiAqIEBjbGFzcyB0aW55bWNlLkZvY3VzTWFuYWdlclxuICovXG5kZWZpbmUoXCJ0aW55bWNlL0ZvY3VzTWFuYWdlclwiLCBbXG5cdFwidGlueW1jZS9kb20vRE9NVXRpbHNcIixcblx0XCJ0aW55bWNlL3V0aWwvRGVsYXlcIixcblx0XCJ0aW55bWNlL0VudlwiXG5dLCBmdW5jdGlvbihET01VdGlscywgRGVsYXksIEVudikge1xuXHR2YXIgc2VsZWN0aW9uQ2hhbmdlSGFuZGxlciwgZG9jdW1lbnRGb2N1c0luSGFuZGxlciwgZG9jdW1lbnRNb3VzZVVwSGFuZGxlciwgRE9NID0gRE9NVXRpbHMuRE9NO1xuXG5cdC8qKlxuXHQgKiBDb25zdHJ1Y3RzIGEgbmV3IGZvY3VzIG1hbmFnZXIgaW5zdGFuY2UuXG5cdCAqXG5cdCAqIEBjb25zdHJ1Y3RvciBGb2N1c01hbmFnZXJcblx0ICogQHBhcmFtIHt0aW55bWNlLkVkaXRvck1hbmFnZXJ9IGVkaXRvck1hbmFnZXIgRWRpdG9yIG1hbmFnZXIgaW5zdGFuY2UgdG8gaGFuZGxlIGZvY3VzIGZvci5cblx0ICovXG5cdGZ1bmN0aW9uIEZvY3VzTWFuYWdlcihlZGl0b3JNYW5hZ2VyKSB7XG5cdFx0ZnVuY3Rpb24gZ2V0QWN0aXZlRWxlbWVudCgpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJldHVybiBkb2N1bWVudC5hY3RpdmVFbGVtZW50O1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0Ly8gSUUgc29tZXRpbWVzIGZhaWxzIHRvIGdldCB0aGUgYWN0aXZlRWxlbWVudCB3aGVuIHJlc2l6aW5nIHRhYmxlXG5cdFx0XHRcdC8vIFRPRE86IEludmVzdGlnYXRlIHRoaXNcblx0XHRcdFx0cmV0dXJuIGRvY3VtZW50LmJvZHk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0Ly8gV2UgY2FuJ3Qgc3RvcmUgYSByZWFsIHJhbmdlIG9uIElFIDExIHNpbmNlIGl0IGdldHMgbXV0YXRlZCBzbyB3ZSBuZWVkIHRvIHVzZSBhIGJvb2ttYXJrIG9iamVjdFxuXHRcdC8vIFRPRE86IE1vdmUgdGhpcyB0byBhIHNlcGFyYXRlIHJhbmdlIHV0aWxzIGNsYXNzIHNpbmNlIGl0J3MgaXQncyBsb2dpYyBpcyBwcmVzZW50IGluIFNlbGVjdGlvbiBhcyB3ZWxsLlxuXHRcdGZ1bmN0aW9uIGNyZWF0ZUJvb2ttYXJrKGRvbSwgcm5nKSB7XG5cdFx0XHRpZiAocm5nICYmIHJuZy5zdGFydENvbnRhaW5lcikge1xuXHRcdFx0XHQvLyBWZXJpZnkgdGhhdCB0aGUgcmFuZ2UgaXMgd2l0aGluIHRoZSByb290IG9mIHRoZSBlZGl0b3Jcblx0XHRcdFx0aWYgKCFkb20uaXNDaGlsZE9mKHJuZy5zdGFydENvbnRhaW5lciwgZG9tLmdldFJvb3QoKSkgfHwgIWRvbS5pc0NoaWxkT2Yocm5nLmVuZENvbnRhaW5lciwgZG9tLmdldFJvb3QoKSkpIHtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4ge1xuXHRcdFx0XHRcdHN0YXJ0Q29udGFpbmVyOiBybmcuc3RhcnRDb250YWluZXIsXG5cdFx0XHRcdFx0c3RhcnRPZmZzZXQ6IHJuZy5zdGFydE9mZnNldCxcblx0XHRcdFx0XHRlbmRDb250YWluZXI6IHJuZy5lbmRDb250YWluZXIsXG5cdFx0XHRcdFx0ZW5kT2Zmc2V0OiBybmcuZW5kT2Zmc2V0XG5cdFx0XHRcdH07XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBybmc7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gYm9va21hcmtUb1JuZyhlZGl0b3IsIGJvb2ttYXJrKSB7XG5cdFx0XHR2YXIgcm5nO1xuXG5cdFx0XHRpZiAoYm9va21hcmsuc3RhcnRDb250YWluZXIpIHtcblx0XHRcdFx0cm5nID0gZWRpdG9yLmdldERvYygpLmNyZWF0ZVJhbmdlKCk7XG5cdFx0XHRcdHJuZy5zZXRTdGFydChib29rbWFyay5zdGFydENvbnRhaW5lciwgYm9va21hcmsuc3RhcnRPZmZzZXQpO1xuXHRcdFx0XHRybmcuc2V0RW5kKGJvb2ttYXJrLmVuZENvbnRhaW5lciwgYm9va21hcmsuZW5kT2Zmc2V0KTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHJuZyA9IGJvb2ttYXJrO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gcm5nO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIGlzVUlFbGVtZW50KGVsbSkge1xuXHRcdFx0cmV0dXJuICEhRE9NLmdldFBhcmVudChlbG0sIEZvY3VzTWFuYWdlci5pc0VkaXRvclVJRWxlbWVudCk7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gcmVnaXN0ZXJFdmVudHMoZSkge1xuXHRcdFx0dmFyIGVkaXRvciA9IGUuZWRpdG9yO1xuXG5cdFx0XHRlZGl0b3Iub24oJ2luaXQnLCBmdW5jdGlvbigpIHtcblx0XHRcdFx0Ly8gR2Vja28vV2ViS2l0IGhhcyBnaG9zdCBzZWxlY3Rpb25zIGluIGlmcmFtZXMgYW5kIElFIG9ubHkgaGFzIG9uZSBzZWxlY3Rpb24gcGVyIGJyb3dzZXIgdGFiXG5cdFx0XHRcdGlmIChlZGl0b3IuaW5saW5lIHx8IEVudi5pZSkge1xuXHRcdFx0XHRcdC8vIFVzZSB0aGUgb25iZWZvcmVkZWFjdGl2YXRlIGV2ZW50IHdoZW4gYXZhaWxhYmxlIHNpbmNlIGl0IHdvcmtzIGJldHRlciBzZWUgIzcwMjNcblx0XHRcdFx0XHRpZiAoXCJvbmJlZm9yZWRlYWN0aXZhdGVcIiBpbiBkb2N1bWVudCAmJiBFbnYuaWUgPCA5KSB7XG5cdFx0XHRcdFx0XHRlZGl0b3IuZG9tLmJpbmQoZWRpdG9yLmdldEJvZHkoKSwgJ2JlZm9yZWRlYWN0aXZhdGUnLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdFx0XHRcdGlmIChlLnRhcmdldCAhPSBlZGl0b3IuZ2V0Qm9keSgpKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0dHJ5IHtcblx0XHRcdFx0XHRcdFx0XHRlZGl0b3IubGFzdFJuZyA9IGVkaXRvci5zZWxlY3Rpb24uZ2V0Um5nKCk7XG5cdFx0XHRcdFx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdFx0XHRcdFx0Ly8gSUUgdGhyb3dzIFwiVW5leGNwZWN0ZWQgY2FsbCB0byBtZXRob2Qgb3IgcHJvcGVydHkgYWNjZXNzXCIgc29tZSB0aW1lcyBzbyBsZXRzIGlnbm9yZSBpdFxuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0Ly8gT24gb3RoZXIgYnJvd3NlcnMgdGFrZSBzbmFwc2hvdCBvbiBub2RlY2hhbmdlIGluIGlubGluZSBtb2RlIHNpbmNlIHRoZXkgaGF2ZSBHaG9zdCBzZWxlY3Rpb25zIGZvciBpZnJhbWVzXG5cdFx0XHRcdFx0XHRlZGl0b3Iub24oJ25vZGVjaGFuZ2UgbW91c2V1cCBrZXl1cCcsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0XHRcdFx0dmFyIG5vZGUgPSBnZXRBY3RpdmVFbGVtZW50KCk7XG5cblx0XHRcdFx0XHRcdFx0Ly8gT25seSBhY3Qgb24gbWFudWFsIG5vZGVjaGFuZ2VzXG5cdFx0XHRcdFx0XHRcdGlmIChlLnR5cGUgPT0gJ25vZGVjaGFuZ2UnICYmIGUuc2VsZWN0aW9uQ2hhbmdlKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0Ly8gSUUgMTEgcmVwb3J0cyBhY3RpdmUgZWxlbWVudCBhcyBpZnJhbWUgbm90IGJvZHkgb2YgaWZyYW1lXG5cdFx0XHRcdFx0XHRcdGlmIChub2RlICYmIG5vZGUuaWQgPT0gZWRpdG9yLmlkICsgJ19pZnInKSB7XG5cdFx0XHRcdFx0XHRcdFx0bm9kZSA9IGVkaXRvci5nZXRCb2R5KCk7XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRpZiAoZWRpdG9yLmRvbS5pc0NoaWxkT2Yobm9kZSwgZWRpdG9yLmdldEJvZHkoKSkpIHtcblx0XHRcdFx0XHRcdFx0XHRlZGl0b3IubGFzdFJuZyA9IGVkaXRvci5zZWxlY3Rpb24uZ2V0Um5nKCk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdC8vIEhhbmRsZXMgdGhlIGlzc3VlIHdpdGggV2ViS2l0IG5vdCByZXRhaW5pbmcgc2VsZWN0aW9uIHdpdGhpbiBpbmxpbmUgZG9jdW1lbnRcblx0XHRcdFx0XHQvLyBJZiB0aGUgdXNlciByZWxlYXNlcyB0aGUgbW91c2Ugb3V0IHNpZGUgdGhlIGJvZHkgc2luY2UgYSBtb3VzZSB1cCBldmVudCB3b250IG9jY3VyIG9uIHRoZSBib2R5XG5cdFx0XHRcdFx0aWYgKEVudi53ZWJraXQgJiYgIXNlbGVjdGlvbkNoYW5nZUhhbmRsZXIpIHtcblx0XHRcdFx0XHRcdHNlbGVjdGlvbkNoYW5nZUhhbmRsZXIgPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRcdFx0dmFyIGFjdGl2ZUVkaXRvciA9IGVkaXRvck1hbmFnZXIuYWN0aXZlRWRpdG9yO1xuXG5cdFx0XHRcdFx0XHRcdGlmIChhY3RpdmVFZGl0b3IgJiYgYWN0aXZlRWRpdG9yLnNlbGVjdGlvbikge1xuXHRcdFx0XHRcdFx0XHRcdHZhciBybmcgPSBhY3RpdmVFZGl0b3Iuc2VsZWN0aW9uLmdldFJuZygpO1xuXG5cdFx0XHRcdFx0XHRcdFx0Ly8gU3RvcmUgd2hlbiBpdCdzIG5vbiBjb2xsYXBzZWRcblx0XHRcdFx0XHRcdFx0XHRpZiAocm5nICYmICFybmcuY29sbGFwc2VkKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRlZGl0b3IubGFzdFJuZyA9IHJuZztcblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH07XG5cblx0XHRcdFx0XHRcdERPTS5iaW5kKGRvY3VtZW50LCAnc2VsZWN0aW9uY2hhbmdlJywgc2VsZWN0aW9uQ2hhbmdlSGFuZGxlcik7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0ZWRpdG9yLm9uKCdzZXRjb250ZW50JywgZnVuY3Rpb24oKSB7XG5cdFx0XHRcdGVkaXRvci5sYXN0Um5nID0gbnVsbDtcblx0XHRcdH0pO1xuXG5cdFx0XHQvLyBSZW1vdmUgbGFzdCBzZWxlY3Rpb24gYm9va21hcmsgb24gbW91c2Vkb3duIHNlZSAjNjMwNVxuXHRcdFx0ZWRpdG9yLm9uKCdtb3VzZWRvd24nLCBmdW5jdGlvbigpIHtcblx0XHRcdFx0ZWRpdG9yLnNlbGVjdGlvbi5sYXN0Rm9jdXNCb29rbWFyayA9IG51bGw7XG5cdFx0XHR9KTtcblxuXHRcdFx0ZWRpdG9yLm9uKCdmb2N1c2luJywgZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHZhciBmb2N1c2VkRWRpdG9yID0gZWRpdG9yTWFuYWdlci5mb2N1c2VkRWRpdG9yLCBsYXN0Um5nO1xuXG5cdFx0XHRcdGlmIChlZGl0b3Iuc2VsZWN0aW9uLmxhc3RGb2N1c0Jvb2ttYXJrKSB7XG5cdFx0XHRcdFx0bGFzdFJuZyA9IGJvb2ttYXJrVG9SbmcoZWRpdG9yLCBlZGl0b3Iuc2VsZWN0aW9uLmxhc3RGb2N1c0Jvb2ttYXJrKTtcblx0XHRcdFx0XHRlZGl0b3Iuc2VsZWN0aW9uLmxhc3RGb2N1c0Jvb2ttYXJrID0gbnVsbDtcblx0XHRcdFx0XHRlZGl0b3Iuc2VsZWN0aW9uLnNldFJuZyhsYXN0Um5nKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChmb2N1c2VkRWRpdG9yICE9IGVkaXRvcikge1xuXHRcdFx0XHRcdGlmIChmb2N1c2VkRWRpdG9yKSB7XG5cdFx0XHRcdFx0XHRmb2N1c2VkRWRpdG9yLmZpcmUoJ2JsdXInLCB7Zm9jdXNlZEVkaXRvcjogZWRpdG9yfSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0ZWRpdG9yTWFuYWdlci5zZXRBY3RpdmUoZWRpdG9yKTtcblx0XHRcdFx0XHRlZGl0b3JNYW5hZ2VyLmZvY3VzZWRFZGl0b3IgPSBlZGl0b3I7XG5cdFx0XHRcdFx0ZWRpdG9yLmZpcmUoJ2ZvY3VzJywge2JsdXJyZWRFZGl0b3I6IGZvY3VzZWRFZGl0b3J9KTtcblx0XHRcdFx0XHRlZGl0b3IuZm9jdXModHJ1ZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRlZGl0b3IubGFzdFJuZyA9IG51bGw7XG5cdFx0XHR9KTtcblxuXHRcdFx0ZWRpdG9yLm9uKCdmb2N1c291dCcsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHREZWxheS5zZXRFZGl0b3JUaW1lb3V0KGVkaXRvciwgZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0dmFyIGZvY3VzZWRFZGl0b3IgPSBlZGl0b3JNYW5hZ2VyLmZvY3VzZWRFZGl0b3I7XG5cblx0XHRcdFx0XHQvLyBTdGlsbCB0aGUgc2FtZSBlZGl0b3IgdGhlIGJsdXIgd2FzIG91dHNpZGUgYW55IGVkaXRvciBVSVxuXHRcdFx0XHRcdGlmICghaXNVSUVsZW1lbnQoZ2V0QWN0aXZlRWxlbWVudCgpKSAmJiBmb2N1c2VkRWRpdG9yID09IGVkaXRvcikge1xuXHRcdFx0XHRcdFx0ZWRpdG9yLmZpcmUoJ2JsdXInLCB7Zm9jdXNlZEVkaXRvcjogbnVsbH0pO1xuXHRcdFx0XHRcdFx0ZWRpdG9yTWFuYWdlci5mb2N1c2VkRWRpdG9yID0gbnVsbDtcblxuXHRcdFx0XHRcdFx0Ly8gTWFrZSBzdXJlIHNlbGVjdGlvbiBpcyB2YWxpZCBjb3VsZCBiZSBpbnZhbGlkIGlmIHRoZSBlZGl0b3IgaXMgYmx1cmVkIGFuZCByZW1vdmVkIGJlZm9yZSB0aGUgdGltZW91dCBvY2N1cnNcblx0XHRcdFx0XHRcdGlmIChlZGl0b3Iuc2VsZWN0aW9uKSB7XG5cdFx0XHRcdFx0XHRcdGVkaXRvci5zZWxlY3Rpb24ubGFzdEZvY3VzQm9va21hcmsgPSBudWxsO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHR9KTtcblxuXHRcdFx0Ly8gQ2hlY2sgaWYgZm9jdXMgaXMgbW92ZWQgdG8gYW4gZWxlbWVudCBvdXRzaWRlIHRoZSBhY3RpdmUgZWRpdG9yIGJ5IGNoZWNraW5nIGlmIHRoZSB0YXJnZXQgbm9kZVxuXHRcdFx0Ly8gaXNuJ3Qgd2l0aGluIHRoZSBib2R5IG9mIHRoZSBhY3RpdmVFZGl0b3Igbm9yIGEgVUkgZWxlbWVudCBzdWNoIGFzIGEgZGlhbG9nIGNoaWxkIGNvbnRyb2xcblx0XHRcdGlmICghZG9jdW1lbnRGb2N1c0luSGFuZGxlcikge1xuXHRcdFx0XHRkb2N1bWVudEZvY3VzSW5IYW5kbGVyID0gZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRcdHZhciBhY3RpdmVFZGl0b3IgPSBlZGl0b3JNYW5hZ2VyLmFjdGl2ZUVkaXRvciwgdGFyZ2V0O1xuXG5cdFx0XHRcdFx0dGFyZ2V0ID0gZS50YXJnZXQ7XG5cblx0XHRcdFx0XHRpZiAoYWN0aXZlRWRpdG9yICYmIHRhcmdldC5vd25lckRvY3VtZW50ID09IGRvY3VtZW50KSB7XG5cdFx0XHRcdFx0XHQvLyBDaGVjayB0byBtYWtlIHN1cmUgd2UgaGF2ZSBhIHZhbGlkIHNlbGVjdGlvbiBkb24ndCB1cGRhdGUgdGhlIGJvb2ttYXJrIGlmIGl0J3Ncblx0XHRcdFx0XHRcdC8vIGEgZm9jdXNpbiB0byB0aGUgYm9keSBvZiB0aGUgZWRpdG9yIHNlZSAjNzAyNVxuXHRcdFx0XHRcdFx0aWYgKGFjdGl2ZUVkaXRvci5zZWxlY3Rpb24gJiYgdGFyZ2V0ICE9IGFjdGl2ZUVkaXRvci5nZXRCb2R5KCkpIHtcblx0XHRcdFx0XHRcdFx0YWN0aXZlRWRpdG9yLnNlbGVjdGlvbi5sYXN0Rm9jdXNCb29rbWFyayA9IGNyZWF0ZUJvb2ttYXJrKGFjdGl2ZUVkaXRvci5kb20sIGFjdGl2ZUVkaXRvci5sYXN0Um5nKTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0Ly8gRmlyZSBhIGJsdXIgZXZlbnQgaWYgdGhlIGVsZW1lbnQgaXNuJ3QgYSBVSSBlbGVtZW50XG5cdFx0XHRcdFx0XHRpZiAodGFyZ2V0ICE9IGRvY3VtZW50LmJvZHkgJiYgIWlzVUlFbGVtZW50KHRhcmdldCkgJiYgZWRpdG9yTWFuYWdlci5mb2N1c2VkRWRpdG9yID09IGFjdGl2ZUVkaXRvcikge1xuXHRcdFx0XHRcdFx0XHRhY3RpdmVFZGl0b3IuZmlyZSgnYmx1cicsIHtmb2N1c2VkRWRpdG9yOiBudWxsfSk7XG5cdFx0XHRcdFx0XHRcdGVkaXRvck1hbmFnZXIuZm9jdXNlZEVkaXRvciA9IG51bGw7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9O1xuXG5cdFx0XHRcdERPTS5iaW5kKGRvY3VtZW50LCAnZm9jdXNpbicsIGRvY3VtZW50Rm9jdXNJbkhhbmRsZXIpO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBIYW5kbGUgZWRnZSBjYXNlIHdoZW4gdXNlciBzdGFydHMgdGhlIHNlbGVjdGlvbiBpbnNpZGUgdGhlIGVkaXRvciBhbmQgcmVsZWFzZXNcblx0XHRcdC8vIHRoZSBtb3VzZSBvdXRzaWRlIHRoZSBlZGl0b3IgcHJvZHVjaW5nIGEgbmV3IHNlbGVjdGlvbi4gVGhpcyB3ZWlyZCB3b3JrYXJvdW5kIGlzIG5lZWRlZCBzaW5jZVxuXHRcdFx0Ly8gR2Vja28gZG9lc24ndCBoYXZlIHRoZSBcInNlbGVjdGlvbmNoYW5nZVwiIGV2ZW50IHdlIG5lZWQgdG8gZG8gdGhpcy4gRml4ZXM6ICM2ODQzXG5cdFx0XHRpZiAoZWRpdG9yLmlubGluZSAmJiAhZG9jdW1lbnRNb3VzZVVwSGFuZGxlcikge1xuXHRcdFx0XHRkb2N1bWVudE1vdXNlVXBIYW5kbGVyID0gZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRcdHZhciBhY3RpdmVFZGl0b3IgPSBlZGl0b3JNYW5hZ2VyLmFjdGl2ZUVkaXRvciwgZG9tID0gYWN0aXZlRWRpdG9yLmRvbTtcblxuXHRcdFx0XHRcdGlmIChhY3RpdmVFZGl0b3IuaW5saW5lICYmIGRvbSAmJiAhZG9tLmlzQ2hpbGRPZihlLnRhcmdldCwgYWN0aXZlRWRpdG9yLmdldEJvZHkoKSkpIHtcblx0XHRcdFx0XHRcdHZhciBybmcgPSBhY3RpdmVFZGl0b3Iuc2VsZWN0aW9uLmdldFJuZygpO1xuXG5cdFx0XHRcdFx0XHRpZiAoIXJuZy5jb2xsYXBzZWQpIHtcblx0XHRcdFx0XHRcdFx0YWN0aXZlRWRpdG9yLmxhc3RSbmcgPSBybmc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9O1xuXG5cdFx0XHRcdERPTS5iaW5kKGRvY3VtZW50LCAnbW91c2V1cCcsIGRvY3VtZW50TW91c2VVcEhhbmRsZXIpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIHVucmVnaXN0ZXJEb2N1bWVudEV2ZW50cyhlKSB7XG5cdFx0XHRpZiAoZWRpdG9yTWFuYWdlci5mb2N1c2VkRWRpdG9yID09IGUuZWRpdG9yKSB7XG5cdFx0XHRcdGVkaXRvck1hbmFnZXIuZm9jdXNlZEVkaXRvciA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHRcdGlmICghZWRpdG9yTWFuYWdlci5hY3RpdmVFZGl0b3IpIHtcblx0XHRcdFx0RE9NLnVuYmluZChkb2N1bWVudCwgJ3NlbGVjdGlvbmNoYW5nZScsIHNlbGVjdGlvbkNoYW5nZUhhbmRsZXIpO1xuXHRcdFx0XHRET00udW5iaW5kKGRvY3VtZW50LCAnZm9jdXNpbicsIGRvY3VtZW50Rm9jdXNJbkhhbmRsZXIpO1xuXHRcdFx0XHRET00udW5iaW5kKGRvY3VtZW50LCAnbW91c2V1cCcsIGRvY3VtZW50TW91c2VVcEhhbmRsZXIpO1xuXHRcdFx0XHRzZWxlY3Rpb25DaGFuZ2VIYW5kbGVyID0gZG9jdW1lbnRGb2N1c0luSGFuZGxlciA9IGRvY3VtZW50TW91c2VVcEhhbmRsZXIgPSBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGVkaXRvck1hbmFnZXIub24oJ0FkZEVkaXRvcicsIHJlZ2lzdGVyRXZlbnRzKTtcblx0XHRlZGl0b3JNYW5hZ2VyLm9uKCdSZW1vdmVFZGl0b3InLCB1bnJlZ2lzdGVyRG9jdW1lbnRFdmVudHMpO1xuXHR9XG5cblx0LyoqXG5cdCAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgc3BlY2lmaWVkIGVsZW1lbnQgaXMgcGFydCBvZiB0aGUgVUkgZm9yIGV4YW1wbGUgYW4gYnV0dG9uIG9yIHRleHQgaW5wdXQuXG5cdCAqXG5cdCAqIEBtZXRob2QgaXNFZGl0b3JVSUVsZW1lbnRcblx0ICogQHBhcmFtICB7RWxlbWVudH0gZWxtIEVsZW1lbnQgdG8gY2hlY2sgaWYgaXQncyBwYXJ0IG9mIHRoZSBVSSBvciBub3QuXG5cdCAqIEByZXR1cm4ge0Jvb2xlYW59IFRydWUvZmFsc2Ugc3RhdGUgaWYgdGhlIGVsZW1lbnQgaXMgcGFydCBvZiB0aGUgVUkgb3Igbm90LlxuXHQgKi9cblx0Rm9jdXNNYW5hZ2VyLmlzRWRpdG9yVUlFbGVtZW50ID0gZnVuY3Rpb24oZWxtKSB7XG5cdFx0Ly8gTmVlZHMgdG8gYmUgY29udmVydGVkIHRvIHN0cmluZyBzaW5jZSBzdmcgY2FuIGhhdmUgZm9jdXM6ICM2Nzc2XG5cdFx0cmV0dXJuIGVsbS5jbGFzc05hbWUudG9TdHJpbmcoKS5pbmRleE9mKCdtY2UtJykgIT09IC0xO1xuXHR9O1xuXG5cdHJldHVybiBGb2N1c01hbmFnZXI7XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL0VkaXRvck1hbmFnZXIuanNcblxuLyoqXG4gKiBFZGl0b3JNYW5hZ2VyLmpzXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgTEdQTCBMaWNlbnNlLlxuICogQ29weXJpZ2h0IChjKSAxOTk5LTIwMTUgRXBob3ggQ29ycC4gQWxsIHJpZ2h0cyByZXNlcnZlZFxuICpcbiAqIExpY2Vuc2U6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vbGljZW5zZVxuICogQ29udHJpYnV0aW5nOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2NvbnRyaWJ1dGluZ1xuICovXG5cbi8qKlxuICogVGhpcyBjbGFzcyB1c2VkIGFzIGEgZmFjdG9yeSBmb3IgbWFuYWdlciBmb3IgdGlueW1jZS5FZGl0b3IgaW5zdGFuY2VzLlxuICpcbiAqIEBleGFtcGxlXG4gKiB0aW55bWNlLkVkaXRvck1hbmFnZXIuaW5pdCh7fSk7XG4gKlxuICogQGNsYXNzIHRpbnltY2UuRWRpdG9yTWFuYWdlclxuICogQG1peGVzIHRpbnltY2UudXRpbC5PYnNlcnZhYmxlXG4gKiBAc3RhdGljXG4gKi9cbmRlZmluZShcInRpbnltY2UvRWRpdG9yTWFuYWdlclwiLCBbXG5cdFwidGlueW1jZS9FZGl0b3JcIixcblx0XCJ0aW55bWNlL2RvbS9Eb21RdWVyeVwiLFxuXHRcInRpbnltY2UvZG9tL0RPTVV0aWxzXCIsXG5cdFwidGlueW1jZS91dGlsL1VSSVwiLFxuXHRcInRpbnltY2UvRW52XCIsXG5cdFwidGlueW1jZS91dGlsL1Rvb2xzXCIsXG5cdFwidGlueW1jZS91dGlsL1Byb21pc2VcIixcblx0XCJ0aW55bWNlL3V0aWwvT2JzZXJ2YWJsZVwiLFxuXHRcInRpbnltY2UvdXRpbC9JMThuXCIsXG5cdFwidGlueW1jZS9Gb2N1c01hbmFnZXJcIixcblx0XCJ0aW55bWNlL0FkZE9uTWFuYWdlclwiXG5dLCBmdW5jdGlvbihFZGl0b3IsICQsIERPTVV0aWxzLCBVUkksIEVudiwgVG9vbHMsIFByb21pc2UsIE9ic2VydmFibGUsIEkxOG4sIEZvY3VzTWFuYWdlciwgQWRkT25NYW5hZ2VyKSB7XG5cdHZhciBET00gPSBET01VdGlscy5ET007XG5cdHZhciBleHBsb2RlID0gVG9vbHMuZXhwbG9kZSwgZWFjaCA9IFRvb2xzLmVhY2gsIGV4dGVuZCA9IFRvb2xzLmV4dGVuZDtcblx0dmFyIGluc3RhbmNlQ291bnRlciA9IDAsIGJlZm9yZVVubG9hZERlbGVnYXRlLCBFZGl0b3JNYW5hZ2VyLCBib3VuZEdsb2JhbEV2ZW50cyA9IGZhbHNlO1xuXG5cdGZ1bmN0aW9uIGdsb2JhbEV2ZW50RGVsZWdhdGUoZSkge1xuXHRcdGVhY2goRWRpdG9yTWFuYWdlci5lZGl0b3JzLCBmdW5jdGlvbihlZGl0b3IpIHtcblx0XHRcdGlmIChlLnR5cGUgPT09ICdzY3JvbGwnKSB7XG5cdFx0XHRcdGVkaXRvci5maXJlKCdTY3JvbGxXaW5kb3cnLCBlKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGVkaXRvci5maXJlKCdSZXNpemVXaW5kb3cnLCBlKTtcblx0XHRcdH1cblx0XHR9KTtcblx0fVxuXG5cdGZ1bmN0aW9uIHRvZ2dsZUdsb2JhbEV2ZW50cyhlZGl0b3JzLCBzdGF0ZSkge1xuXHRcdGlmIChzdGF0ZSAhPT0gYm91bmRHbG9iYWxFdmVudHMpIHtcblx0XHRcdGlmIChzdGF0ZSkge1xuXHRcdFx0XHQkKHdpbmRvdykub24oJ3Jlc2l6ZSBzY3JvbGwnLCBnbG9iYWxFdmVudERlbGVnYXRlKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCQod2luZG93KS5vZmYoJ3Jlc2l6ZSBzY3JvbGwnLCBnbG9iYWxFdmVudERlbGVnYXRlKTtcblx0XHRcdH1cblxuXHRcdFx0Ym91bmRHbG9iYWxFdmVudHMgPSBzdGF0ZTtcblx0XHR9XG5cdH1cblxuXHRmdW5jdGlvbiByZW1vdmVFZGl0b3JGcm9tTGlzdChlZGl0b3IpIHtcblx0XHR2YXIgZWRpdG9ycyA9IEVkaXRvck1hbmFnZXIuZWRpdG9ycywgcmVtb3ZlZEZyb21MaXN0O1xuXG5cdFx0ZGVsZXRlIGVkaXRvcnNbZWRpdG9yLmlkXTtcblxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgZWRpdG9ycy5sZW5ndGg7IGkrKykge1xuXHRcdFx0aWYgKGVkaXRvcnNbaV0gPT0gZWRpdG9yKSB7XG5cdFx0XHRcdGVkaXRvcnMuc3BsaWNlKGksIDEpO1xuXHRcdFx0XHRyZW1vdmVkRnJvbUxpc3QgPSB0cnVlO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdH1cblx0XHR9XG5cblx0XHQvLyBTZWxlY3QgYW5vdGhlciBlZGl0b3Igc2luY2UgdGhlIGFjdGl2ZSBvbmUgd2FzIHJlbW92ZWRcblx0XHRpZiAoRWRpdG9yTWFuYWdlci5hY3RpdmVFZGl0b3IgPT0gZWRpdG9yKSB7XG5cdFx0XHRFZGl0b3JNYW5hZ2VyLmFjdGl2ZUVkaXRvciA9IGVkaXRvcnNbMF07XG5cdFx0fVxuXG5cdFx0Ly8gQ2xlYXIgZm9jdXNlZEVkaXRvciBpZiBuZWNlc3NhcnksIHNvIHRoYXQgd2UgZG9uJ3QgdHJ5IHRvIGJsdXIgdGhlIGRlc3Ryb3llZCBlZGl0b3Jcblx0XHRpZiAoRWRpdG9yTWFuYWdlci5mb2N1c2VkRWRpdG9yID09IGVkaXRvcikge1xuXHRcdFx0RWRpdG9yTWFuYWdlci5mb2N1c2VkRWRpdG9yID0gbnVsbDtcblx0XHR9XG5cblx0XHRyZXR1cm4gcmVtb3ZlZEZyb21MaXN0O1xuXHR9XG5cblx0ZnVuY3Rpb24gcHVyZ2VEZXN0cm95ZWRFZGl0b3IoZWRpdG9yKSB7XG5cdFx0Ly8gVXNlciBoYXMgbWFudWFsbHkgZGVzdHJveWVkIHRoZSBlZGl0b3IgbGV0cyBjbGVhbiB1cCB0aGUgbWVzc1xuXHRcdGlmIChlZGl0b3IgJiYgZWRpdG9yLmluaXRpYWxpemVkICYmICEoZWRpdG9yLmdldENvbnRhaW5lcigpIHx8IGVkaXRvci5nZXRCb2R5KCkpLnBhcmVudE5vZGUpIHtcblx0XHRcdHJlbW92ZUVkaXRvckZyb21MaXN0KGVkaXRvcik7XG5cdFx0XHRlZGl0b3IudW5iaW5kQWxsTmF0aXZlRXZlbnRzKCk7XG5cdFx0XHRlZGl0b3IuZGVzdHJveSh0cnVlKTtcblx0XHRcdGVkaXRvci5yZW1vdmVkID0gdHJ1ZTtcblx0XHRcdGVkaXRvciA9IG51bGw7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGVkaXRvcjtcblx0fVxuXG5cdEVkaXRvck1hbmFnZXIgPSB7XG5cdFx0LyoqXG5cdFx0ICogRG9tIHF1ZXJ5IGluc3RhbmNlLlxuXHRcdCAqXG5cdFx0ICogQHByb3BlcnR5ICRcblx0XHQgKiBAdHlwZSB0aW55bWNlLmRvbS5Eb21RdWVyeVxuXHRcdCAqL1xuXHRcdCQ6ICQsXG5cblx0XHQvKipcblx0XHQgKiBNYWpvciB2ZXJzaW9uIG9mIFRpbnlNQ0UgYnVpbGQuXG5cdFx0ICpcblx0XHQgKiBAcHJvcGVydHkgbWFqb3JWZXJzaW9uXG5cdFx0ICogQHR5cGUgU3RyaW5nXG5cdFx0ICovXG5cdFx0bWFqb3JWZXJzaW9uOiAnNCcsXG5cblx0XHQvKipcblx0XHQgKiBNaW5vciB2ZXJzaW9uIG9mIFRpbnlNQ0UgYnVpbGQuXG5cdFx0ICpcblx0XHQgKiBAcHJvcGVydHkgbWlub3JWZXJzaW9uXG5cdFx0ICogQHR5cGUgU3RyaW5nXG5cdFx0ICovXG5cdFx0bWlub3JWZXJzaW9uOiAnNS4xJyxcblxuXHRcdC8qKlxuXHRcdCAqIFJlbGVhc2UgZGF0ZSBvZiBUaW55TUNFIGJ1aWxkLlxuXHRcdCAqXG5cdFx0ICogQHByb3BlcnR5IHJlbGVhc2VEYXRlXG5cdFx0ICogQHR5cGUgU3RyaW5nXG5cdFx0ICovXG5cdFx0cmVsZWFzZURhdGU6ICcyMDE2LTEyLTA3JyxcblxuXHRcdC8qKlxuXHRcdCAqIENvbGxlY3Rpb24gb2YgZWRpdG9yIGluc3RhbmNlcy5cblx0XHQgKlxuXHRcdCAqIEBwcm9wZXJ0eSBlZGl0b3JzXG5cdFx0ICogQHR5cGUgT2JqZWN0XG5cdFx0ICogQGV4YW1wbGVcblx0XHQgKiBmb3IgKGVkSWQgaW4gdGlueW1jZS5lZGl0b3JzKVxuXHRcdCAqICAgICB0aW55bWNlLmVkaXRvcnNbZWRJZF0uc2F2ZSgpO1xuXHRcdCAqL1xuXHRcdGVkaXRvcnM6IFtdLFxuXG5cdFx0LyoqXG5cdFx0ICogQ29sbGVjdGlvbiBvZiBsYW5ndWFnZSBwYWNrIGRhdGEuXG5cdFx0ICpcblx0XHQgKiBAcHJvcGVydHkgaTE4blxuXHRcdCAqIEB0eXBlIE9iamVjdFxuXHRcdCAqL1xuXHRcdGkxOG46IEkxOG4sXG5cblx0XHQvKipcblx0XHQgKiBDdXJyZW50bHkgYWN0aXZlIGVkaXRvciBpbnN0YW5jZS5cblx0XHQgKlxuXHRcdCAqIEBwcm9wZXJ0eSBhY3RpdmVFZGl0b3Jcblx0XHQgKiBAdHlwZSB0aW55bWNlLkVkaXRvclxuXHRcdCAqIEBleGFtcGxlXG5cdFx0ICogdGlueU1DRS5hY3RpdmVFZGl0b3Iuc2VsZWN0aW9uLmdldENvbnRlbnQoKTtcblx0XHQgKiB0aW55bWNlLkVkaXRvck1hbmFnZXIuYWN0aXZlRWRpdG9yLnNlbGVjdGlvbi5nZXRDb250ZW50KCk7XG5cdFx0ICovXG5cdFx0YWN0aXZlRWRpdG9yOiBudWxsLFxuXG5cdFx0c2V0dXA6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLCBiYXNlVVJMLCBkb2N1bWVudEJhc2VVUkwsIHN1ZmZpeCA9IFwiXCIsIHByZUluaXQsIHNyYztcblxuXHRcdFx0Ly8gR2V0IGJhc2UgVVJMIGZvciB0aGUgY3VycmVudCBkb2N1bWVudFxuXHRcdFx0ZG9jdW1lbnRCYXNlVVJMID0gVVJJLmdldERvY3VtZW50QmFzZVVybChkb2N1bWVudC5sb2NhdGlvbik7XG5cblx0XHRcdC8vIENoZWNrIGlmIHRoZSBVUkwgaXMgYSBkb2N1bWVudCBiYXNlZCBmb3JtYXQgbGlrZTogaHR0cDovL3NpdGUvZGlyL2ZpbGUgYW5kIGZpbGU6Ly8vXG5cdFx0XHQvLyBsZWF2ZSBvdGhlciBmb3JtYXRzIGxpa2UgYXBwbGV3ZWJkYXRhOi8vLi4uIGludGFjdFxuXHRcdFx0aWYgKC9eW146XSs6XFwvXFwvXFwvP1teXFwvXStcXC8vLnRlc3QoZG9jdW1lbnRCYXNlVVJMKSkge1xuXHRcdFx0XHRkb2N1bWVudEJhc2VVUkwgPSBkb2N1bWVudEJhc2VVUkwucmVwbGFjZSgvW1xcPyNdLiokLywgJycpLnJlcGxhY2UoL1tcXC9cXFxcXVteXFwvXSskLywgJycpO1xuXG5cdFx0XHRcdGlmICghL1tcXC9cXFxcXSQvLnRlc3QoZG9jdW1lbnRCYXNlVVJMKSkge1xuXHRcdFx0XHRcdGRvY3VtZW50QmFzZVVSTCArPSAnLyc7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0Ly8gSWYgdGlueW1jZSBpcyBkZWZpbmVkIGFuZCBoYXMgYSBiYXNlIHVzZSB0aGF0IG9yIHVzZSB0aGUgb2xkIHRpbnlNQ0VQcmVJbml0XG5cdFx0XHRwcmVJbml0ID0gd2luZG93LnRpbnltY2UgfHwgd2luZG93LnRpbnlNQ0VQcmVJbml0O1xuXHRcdFx0aWYgKHByZUluaXQpIHtcblx0XHRcdFx0YmFzZVVSTCA9IHByZUluaXQuYmFzZSB8fCBwcmVJbml0LmJhc2VVUkw7XG5cdFx0XHRcdHN1ZmZpeCA9IHByZUluaXQuc3VmZml4O1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Ly8gR2V0IGJhc2Ugd2hlcmUgdGhlIHRpbnltY2Ugc2NyaXB0IGlzIGxvY2F0ZWRcblx0XHRcdFx0dmFyIHNjcmlwdHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc2NyaXB0Jyk7XG5cdFx0XHRcdGZvciAodmFyIGkgPSAwOyBpIDwgc2NyaXB0cy5sZW5ndGg7IGkrKykge1xuXHRcdFx0XHRcdHNyYyA9IHNjcmlwdHNbaV0uc3JjO1xuXG5cdFx0XHRcdFx0Ly8gU2NyaXB0IHR5cGVzIHN1cHBvcnRlZDpcblx0XHRcdFx0XHQvLyB0aW55bWNlLmpzIHRpbnltY2UubWluLmpzIHRpbnltY2UuZGV2LmpzXG5cdFx0XHRcdFx0Ly8gdGlueW1jZS5qcXVlcnkuanMgdGlueW1jZS5qcXVlcnkubWluLmpzIHRpbnltY2UuanF1ZXJ5LmRldi5qc1xuXHRcdFx0XHRcdC8vIHRpbnltY2UuZnVsbC5qcyB0aW55bWNlLmZ1bGwubWluLmpzIHRpbnltY2UuZnVsbC5kZXYuanNcblx0XHRcdFx0XHR2YXIgc3JjU2NyaXB0ID0gc3JjLnN1YnN0cmluZyhzcmMubGFzdEluZGV4T2YoJy8nKSk7XG5cdFx0XHRcdFx0aWYgKC90aW55bWNlKFxcLmZ1bGx8XFwuanF1ZXJ5fCkoXFwubWlufFxcLmRldnwpXFwuanMvLnRlc3Qoc3JjKSkge1xuXHRcdFx0XHRcdFx0aWYgKHNyY1NjcmlwdC5pbmRleE9mKCcubWluJykgIT0gLTEpIHtcblx0XHRcdFx0XHRcdFx0c3VmZml4ID0gJy5taW4nO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRiYXNlVVJMID0gc3JjLnN1YnN0cmluZygwLCBzcmMubGFzdEluZGV4T2YoJy8nKSk7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBXZSBkaWRuJ3QgZmluZCBhbnkgYmFzZVVSTCBieSBsb29raW5nIGF0IHRoZSBzY3JpcHQgZWxlbWVudHNcblx0XHRcdFx0Ly8gVHJ5IHRvIHVzZSB0aGUgZG9jdW1lbnQuY3VycmVudFNjcmlwdCBhcyBhIGZhbGxiYWNrXG5cdFx0XHRcdGlmICghYmFzZVVSTCAmJiBkb2N1bWVudC5jdXJyZW50U2NyaXB0KSB7XG5cdFx0XHRcdFx0c3JjID0gZG9jdW1lbnQuY3VycmVudFNjcmlwdC5zcmM7XG5cblx0XHRcdFx0XHRpZiAoc3JjLmluZGV4T2YoJy5taW4nKSAhPSAtMSkge1xuXHRcdFx0XHRcdFx0c3VmZml4ID0gJy5taW4nO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGJhc2VVUkwgPSBzcmMuc3Vic3RyaW5nKDAsIHNyYy5sYXN0SW5kZXhPZignLycpKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHQvKipcblx0XHRcdCAqIEJhc2UgVVJMIHdoZXJlIHRoZSByb290IGRpcmVjdG9yeSBpZiBUaW55TUNFIGlzIGxvY2F0ZWQuXG5cdFx0XHQgKlxuXHRcdFx0ICogQHByb3BlcnR5IGJhc2VVUkxcblx0XHRcdCAqIEB0eXBlIFN0cmluZ1xuXHRcdFx0ICovXG5cdFx0XHRzZWxmLmJhc2VVUkwgPSBuZXcgVVJJKGRvY3VtZW50QmFzZVVSTCkudG9BYnNvbHV0ZShiYXNlVVJMKTtcblxuXHRcdFx0LyoqXG5cdFx0XHQgKiBEb2N1bWVudCBiYXNlIFVSTCB3aGVyZSB0aGUgY3VycmVudCBkb2N1bWVudCBpcyBsb2NhdGVkLlxuXHRcdFx0ICpcblx0XHRcdCAqIEBwcm9wZXJ0eSBkb2N1bWVudEJhc2VVUkxcblx0XHRcdCAqIEB0eXBlIFN0cmluZ1xuXHRcdFx0ICovXG5cdFx0XHRzZWxmLmRvY3VtZW50QmFzZVVSTCA9IGRvY3VtZW50QmFzZVVSTDtcblxuXHRcdFx0LyoqXG5cdFx0XHQgKiBBYnNvbHV0ZSBiYXNlVVJJIGZvciB0aGUgaW5zdGFsbGF0aW9uIHBhdGggb2YgVGlueU1DRS5cblx0XHRcdCAqXG5cdFx0XHQgKiBAcHJvcGVydHkgYmFzZVVSSVxuXHRcdFx0ICogQHR5cGUgdGlueW1jZS51dGlsLlVSSVxuXHRcdFx0ICovXG5cdFx0XHRzZWxmLmJhc2VVUkkgPSBuZXcgVVJJKHNlbGYuYmFzZVVSTCk7XG5cblx0XHRcdC8qKlxuXHRcdFx0ICogQ3VycmVudCBzdWZmaXggdG8gYWRkIHRvIGVhY2ggcGx1Z2luL3RoZW1lIHRoYXQgZ2V0cyBsb2FkZWQgZm9yIGV4YW1wbGUgXCIubWluXCIuXG5cdFx0XHQgKlxuXHRcdFx0ICogQHByb3BlcnR5IHN1ZmZpeFxuXHRcdFx0ICogQHR5cGUgU3RyaW5nXG5cdFx0XHQgKi9cblx0XHRcdHNlbGYuc3VmZml4ID0gc3VmZml4O1xuXG5cdFx0XHRzZWxmLmZvY3VzTWFuYWdlciA9IG5ldyBGb2N1c01hbmFnZXIoc2VsZik7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIE92ZXJyaWRlcyB0aGUgZGVmYXVsdCBzZXR0aW5ncyBmb3IgZWRpdG9yIGluc3RhbmNlcy5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2Qgb3ZlcnJpZGVEZWZhdWx0c1xuXHRcdCAqIEBwYXJhbSB7T2JqZWN0fSBkZWZhdWx0U2V0dGluZ3MgRGVmYXVsdHMgc2V0dGluZ3Mgb2JqZWN0LlxuXHRcdCAqL1xuXHRcdG92ZXJyaWRlRGVmYXVsdHM6IGZ1bmN0aW9uKGRlZmF1bHRTZXR0aW5ncykge1xuXHRcdFx0dmFyIGJhc2VVcmwsIHN1ZmZpeDtcblxuXHRcdFx0YmFzZVVybCA9IGRlZmF1bHRTZXR0aW5ncy5iYXNlX3VybDtcblx0XHRcdGlmIChiYXNlVXJsKSB7XG5cdFx0XHRcdHRoaXMuYmFzZVVSTCA9IG5ldyBVUkkodGhpcy5kb2N1bWVudEJhc2VVUkwpLnRvQWJzb2x1dGUoYmFzZVVybC5yZXBsYWNlKC9cXC8rJC8sICcnKSk7XG5cdFx0XHRcdHRoaXMuYmFzZVVSSSA9IG5ldyBVUkkodGhpcy5iYXNlVVJMKTtcblx0XHRcdH1cblxuXHRcdFx0c3VmZml4ID0gZGVmYXVsdFNldHRpbmdzLnN1ZmZpeDtcblx0XHRcdGlmIChkZWZhdWx0U2V0dGluZ3Muc3VmZml4KSB7XG5cdFx0XHRcdHRoaXMuc3VmZml4ID0gc3VmZml4O1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLmRlZmF1bHRTZXR0aW5ncyA9IGRlZmF1bHRTZXR0aW5ncztcblxuXHRcdFx0dmFyIHBsdWdpbkJhc2VVcmxzID0gZGVmYXVsdFNldHRpbmdzLnBsdWdpbl9iYXNlX3VybHM7XG5cdFx0XHRmb3IgKHZhciBuYW1lIGluIHBsdWdpbkJhc2VVcmxzKSB7XG5cdFx0XHRcdEFkZE9uTWFuYWdlci5QbHVnaW5NYW5hZ2VyLnVybHNbbmFtZV0gPSBwbHVnaW5CYXNlVXJsc1tuYW1lXTtcblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogSW5pdGlhbGl6ZXMgYSBzZXQgb2YgZWRpdG9ycy4gVGhpcyBtZXRob2Qgd2lsbCBjcmVhdGUgZWRpdG9ycyBiYXNlZCBvbiB2YXJpb3VzIHNldHRpbmdzLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBpbml0XG5cdFx0ICogQHBhcmFtIHtPYmplY3R9IHNldHRpbmdzIFNldHRpbmdzIG9iamVjdCB0byBiZSBwYXNzZWQgdG8gZWFjaCBlZGl0b3IgaW5zdGFuY2UuXG5cdFx0ICogQHJldHVybiB7dGlueW1jZS51dGlsLlByb21pc2V9IFByb21pc2UgdGhhdCBnZXRzIHJlc29sdmVkIHdpdGggYW4gYXJyYXkgb2YgZWRpdG9ycyB3aGVuIGFsbCBlZGl0b3IgaW5zdGFuY2VzIGFyZSBpbml0aWFsaXplZC5cblx0XHQgKiBAZXhhbXBsZVxuXHRcdCAqIC8vIEluaXRpYWxpemVzIGEgZWRpdG9yIHVzaW5nIHRoZSBsb25nZXIgbWV0aG9kXG5cdFx0ICogdGlueW1jZS5FZGl0b3JNYW5hZ2VyLmluaXQoe1xuXHRcdCAqICAgIHNvbWVfc2V0dGluZ3MgOiAnc29tZSB2YWx1ZSdcblx0XHQgKiB9KTtcblx0XHQgKlxuXHRcdCAqIC8vIEluaXRpYWxpemVzIGEgZWRpdG9yIGluc3RhbmNlIHVzaW5nIHRoZSBzaG9ydGVyIHZlcnNpb24gYW5kIHdpdGggYSBwcm9taXNlXG5cdFx0ICogdGlueW1jZS5pbml0KHtcblx0XHQgKiAgICBzb21lX3NldHRpbmdzIDogJ3NvbWUgdmFsdWUnXG5cdFx0ICogfSkudGhlbihmdW5jdGlvbihlZGl0b3JzKSB7XG5cdFx0ICogICAgLi4uXG5cdFx0ICogfSk7XG5cdFx0ICovXG5cdFx0aW5pdDogZnVuY3Rpb24oc2V0dGluZ3MpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgcmVzdWx0LCBpbnZhbGlkSW5saW5lVGFyZ2V0cztcblxuXHRcdFx0aW52YWxpZElubGluZVRhcmdldHMgPSBUb29scy5tYWtlTWFwKFxuXHRcdFx0XHQnYXJlYSBiYXNlIGJhc2Vmb250IGJyIGNvbCBmcmFtZSBociBpbWcgaW5wdXQgaXNpbmRleCBsaW5rIG1ldGEgcGFyYW0gZW1iZWQgc291cmNlIHdiciB0cmFjayAnICtcblx0XHRcdFx0J2NvbGdyb3VwIG9wdGlvbiB0Ym9keSB0Zm9vdCB0aGVhZCB0ciBzY3JpcHQgbm9zY3JpcHQgc3R5bGUgdGV4dGFyZWEgdmlkZW8gYXVkaW8gaWZyYW1lIG9iamVjdCBtZW51Jyxcblx0XHRcdFx0JyAnXG5cdFx0XHQpO1xuXG5cdFx0XHRmdW5jdGlvbiBpc0ludmFsaWRJbmxpbmVUYXJnZXQoc2V0dGluZ3MsIGVsbSkge1xuXHRcdFx0XHRyZXR1cm4gc2V0dGluZ3MuaW5saW5lICYmIGVsbS50YWdOYW1lLnRvTG93ZXJDYXNlKCkgaW4gaW52YWxpZElubGluZVRhcmdldHM7XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIHJlcG9ydChtc2csIGVsbSkge1xuXHRcdFx0XHQvLyBMb2cgaW4gYSBub24gdGVzdCBlbnZpcm9ubWVudFxuXHRcdFx0XHRpZiAod2luZG93LmNvbnNvbGUgJiYgIXdpbmRvdy50ZXN0KSB7XG5cdFx0XHRcdFx0d2luZG93LmNvbnNvbGUubG9nKG1zZywgZWxtKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRmdW5jdGlvbiBjcmVhdGVJZChlbG0pIHtcblx0XHRcdFx0dmFyIGlkID0gZWxtLmlkO1xuXG5cdFx0XHRcdC8vIFVzZSBlbGVtZW50IGlkLCBvciB1bmlxdWUgbmFtZSBvciBnZW5lcmF0ZSBhIHVuaXF1ZSBpZFxuXHRcdFx0XHRpZiAoIWlkKSB7XG5cdFx0XHRcdFx0aWQgPSBlbG0ubmFtZTtcblxuXHRcdFx0XHRcdGlmIChpZCAmJiAhRE9NLmdldChpZCkpIHtcblx0XHRcdFx0XHRcdGlkID0gZWxtLm5hbWU7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdC8vIEdlbmVyYXRlIHVuaXF1ZSBuYW1lXG5cdFx0XHRcdFx0XHRpZCA9IERPTS51bmlxdWVJZCgpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGVsbS5zZXRBdHRyaWJ1dGUoJ2lkJywgaWQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIGlkO1xuXHRcdFx0fVxuXG5cdFx0XHRmdW5jdGlvbiBleGVjQ2FsbGJhY2sobmFtZSkge1xuXHRcdFx0XHR2YXIgY2FsbGJhY2sgPSBzZXR0aW5nc1tuYW1lXTtcblxuXHRcdFx0XHRpZiAoIWNhbGxiYWNrKSB7XG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIGNhbGxiYWNrLmFwcGx5KHNlbGYsIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMikpO1xuXHRcdFx0fVxuXG5cdFx0XHRmdW5jdGlvbiBoYXNDbGFzcyhlbG0sIGNsYXNzTmFtZSkge1xuXHRcdFx0XHRyZXR1cm4gY2xhc3NOYW1lLmNvbnN0cnVjdG9yID09PSBSZWdFeHAgPyBjbGFzc05hbWUudGVzdChlbG0uY2xhc3NOYW1lKSA6IERPTS5oYXNDbGFzcyhlbG0sIGNsYXNzTmFtZSk7XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIGZpbmRUYXJnZXRzKHNldHRpbmdzKSB7XG5cdFx0XHRcdHZhciBsLCB0YXJnZXRzID0gW107XG5cblx0XHRcdFx0aWYgKHNldHRpbmdzLnR5cGVzKSB7XG5cdFx0XHRcdFx0ZWFjaChzZXR0aW5ncy50eXBlcywgZnVuY3Rpb24odHlwZSkge1xuXHRcdFx0XHRcdFx0dGFyZ2V0cyA9IHRhcmdldHMuY29uY2F0KERPTS5zZWxlY3QodHlwZS5zZWxlY3RvcikpO1xuXHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0cmV0dXJuIHRhcmdldHM7XG5cdFx0XHRcdH0gZWxzZSBpZiAoc2V0dGluZ3Muc2VsZWN0b3IpIHtcblx0XHRcdFx0XHRyZXR1cm4gRE9NLnNlbGVjdChzZXR0aW5ncy5zZWxlY3Rvcik7XG5cdFx0XHRcdH0gZWxzZSBpZiAoc2V0dGluZ3MudGFyZ2V0KSB7XG5cdFx0XHRcdFx0cmV0dXJuIFtzZXR0aW5ncy50YXJnZXRdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gRmFsbGJhY2sgdG8gb2xkIHNldHRpbmdcblx0XHRcdFx0c3dpdGNoIChzZXR0aW5ncy5tb2RlKSB7XG5cdFx0XHRcdFx0Y2FzZSBcImV4YWN0XCI6XG5cdFx0XHRcdFx0XHRsID0gc2V0dGluZ3MuZWxlbWVudHMgfHwgJyc7XG5cblx0XHRcdFx0XHRcdGlmIChsLmxlbmd0aCA+IDApIHtcblx0XHRcdFx0XHRcdFx0ZWFjaChleHBsb2RlKGwpLCBmdW5jdGlvbihpZCkge1xuXHRcdFx0XHRcdFx0XHRcdHZhciBlbG07XG5cblx0XHRcdFx0XHRcdFx0XHRpZiAoKGVsbSA9IERPTS5nZXQoaWQpKSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0dGFyZ2V0cy5wdXNoKGVsbSk7XG5cdFx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRcdGVhY2goZG9jdW1lbnQuZm9ybXMsIGZ1bmN0aW9uKGYpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0ZWFjaChmLmVsZW1lbnRzLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKGUubmFtZSA9PT0gaWQpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGlkID0gJ21jZV9lZGl0b3JfJyArIGluc3RhbmNlQ291bnRlcisrO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0RE9NLnNldEF0dHJpYihlLCAnaWQnLCBpZCk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHR0YXJnZXRzLnB1c2goZSk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdGNhc2UgXCJ0ZXh0YXJlYXNcIjpcblx0XHRcdFx0XHRjYXNlIFwic3BlY2lmaWNfdGV4dGFyZWFzXCI6XG5cdFx0XHRcdFx0XHRlYWNoKERPTS5zZWxlY3QoJ3RleHRhcmVhJyksIGZ1bmN0aW9uKGVsbSkge1xuXHRcdFx0XHRcdFx0XHRpZiAoc2V0dGluZ3MuZWRpdG9yX2Rlc2VsZWN0b3IgJiYgaGFzQ2xhc3MoZWxtLCBzZXR0aW5ncy5lZGl0b3JfZGVzZWxlY3RvcikpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRpZiAoIXNldHRpbmdzLmVkaXRvcl9zZWxlY3RvciB8fCBoYXNDbGFzcyhlbG0sIHNldHRpbmdzLmVkaXRvcl9zZWxlY3RvcikpIHtcblx0XHRcdFx0XHRcdFx0XHR0YXJnZXRzLnB1c2goZWxtKTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiB0YXJnZXRzO1xuXHRcdFx0fVxuXG5cdFx0XHR2YXIgcHJvdmlkZVJlc3VsdHMgPSBmdW5jdGlvbihlZGl0b3JzKSB7XG5cdFx0XHRcdHJlc3VsdCA9IGVkaXRvcnM7XG5cdFx0XHR9O1xuXG5cdFx0XHRmdW5jdGlvbiBpbml0RWRpdG9ycygpIHtcblx0XHRcdFx0dmFyIGluaXRDb3VudCA9IDAsIGVkaXRvcnMgPSBbXSwgdGFyZ2V0cztcblxuXHRcdFx0XHRmdW5jdGlvbiBjcmVhdGVFZGl0b3IoaWQsIHNldHRpbmdzLCB0YXJnZXRFbG0pIHtcblx0XHRcdFx0XHR2YXIgZWRpdG9yID0gbmV3IEVkaXRvcihpZCwgc2V0dGluZ3MsIHNlbGYpO1xuXG5cdFx0XHRcdFx0ZWRpdG9ycy5wdXNoKGVkaXRvcik7XG5cblx0XHRcdFx0XHRlZGl0b3Iub24oJ2luaXQnLCBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRcdGlmICgrK2luaXRDb3VudCA9PT0gdGFyZ2V0cy5sZW5ndGgpIHtcblx0XHRcdFx0XHRcdFx0cHJvdmlkZVJlc3VsdHMoZWRpdG9ycyk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRlZGl0b3IudGFyZ2V0RWxtID0gZWRpdG9yLnRhcmdldEVsbSB8fCB0YXJnZXRFbG07XG5cdFx0XHRcdFx0ZWRpdG9yLnJlbmRlcigpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0RE9NLnVuYmluZCh3aW5kb3csICdyZWFkeScsIGluaXRFZGl0b3JzKTtcblx0XHRcdFx0ZXhlY0NhbGxiYWNrKCdvbnBhZ2Vsb2FkJyk7XG5cblx0XHRcdFx0dGFyZ2V0cyA9ICQudW5pcXVlKGZpbmRUYXJnZXRzKHNldHRpbmdzKSk7XG5cblx0XHRcdFx0Ly8gVE9ETzogRGVwcmVjYXRlIHRoaXMgb25lXG5cdFx0XHRcdGlmIChzZXR0aW5ncy50eXBlcykge1xuXHRcdFx0XHRcdGVhY2goc2V0dGluZ3MudHlwZXMsIGZ1bmN0aW9uKHR5cGUpIHtcblx0XHRcdFx0XHRcdFRvb2xzLmVhY2godGFyZ2V0cywgZnVuY3Rpb24oZWxtKSB7XG5cdFx0XHRcdFx0XHRcdGlmIChET00uaXMoZWxtLCB0eXBlLnNlbGVjdG9yKSkge1xuXHRcdFx0XHRcdFx0XHRcdGNyZWF0ZUVkaXRvcihjcmVhdGVJZChlbG0pLCBleHRlbmQoe30sIHNldHRpbmdzLCB0eXBlKSwgZWxtKTtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0VG9vbHMuZWFjaCh0YXJnZXRzLCBmdW5jdGlvbihlbG0pIHtcblx0XHRcdFx0XHRwdXJnZURlc3Ryb3llZEVkaXRvcihzZWxmLmdldChlbG0uaWQpKTtcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0dGFyZ2V0cyA9IFRvb2xzLmdyZXAodGFyZ2V0cywgZnVuY3Rpb24oZWxtKSB7XG5cdFx0XHRcdFx0cmV0dXJuICFzZWxmLmdldChlbG0uaWQpO1xuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHRlYWNoKHRhcmdldHMsIGZ1bmN0aW9uKGVsbSkge1xuXHRcdFx0XHRcdGlmIChpc0ludmFsaWRJbmxpbmVUYXJnZXQoc2V0dGluZ3MsIGVsbSkpIHtcblx0XHRcdFx0XHRcdHJlcG9ydCgnQ291bGQgbm90IGluaXRpYWxpemUgaW5saW5lIGVkaXRvciBvbiBpbnZhbGlkIGlubGluZSB0YXJnZXQgZWxlbWVudCcsIGVsbSk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGNyZWF0ZUVkaXRvcihjcmVhdGVJZChlbG0pLCBzZXR0aW5ncywgZWxtKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRzZWxmLnNldHRpbmdzID0gc2V0dGluZ3M7XG5cdFx0XHRET00uYmluZCh3aW5kb3csICdyZWFkeScsIGluaXRFZGl0b3JzKTtcblxuXHRcdFx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUpIHtcblx0XHRcdFx0aWYgKHJlc3VsdCkge1xuXHRcdFx0XHRcdHJlc29sdmUocmVzdWx0KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRwcm92aWRlUmVzdWx0cyA9IGZ1bmN0aW9uKGVkaXRvcnMpIHtcblx0XHRcdFx0XHRcdHJlc29sdmUoZWRpdG9ycyk7XG5cdFx0XHRcdFx0fTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFJldHVybnMgYSBlZGl0b3IgaW5zdGFuY2UgYnkgaWQuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGdldFxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nL051bWJlcn0gaWQgRWRpdG9yIGluc3RhbmNlIGlkIG9yIGluZGV4IHRvIHJldHVybi5cblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLkVkaXRvcn0gRWRpdG9yIGluc3RhbmNlIHRvIHJldHVybi5cblx0XHQgKiBAZXhhbXBsZVxuXHRcdCAqIC8vIEFkZHMgYW4gb25jbGljayBldmVudCB0byBhbiBlZGl0b3IgYnkgaWQgKHNob3J0ZXIgdmVyc2lvbilcblx0XHQgKiB0aW55bWNlLmdldCgnbXl0ZXh0Ym94Jykub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuXHRcdCAqICAgIGVkLndpbmRvd01hbmFnZXIuYWxlcnQoJ0hlbGxvIHdvcmxkIScpO1xuXHRcdCAqIH0pO1xuXHRcdCAqXG5cdFx0ICogLy8gQWRkcyBhbiBvbmNsaWNrIGV2ZW50IHRvIGFuIGVkaXRvciBieSBpZCAobG9uZ2VyIHZlcnNpb24pXG5cdFx0ICogdGlueW1jZS5FZGl0b3JNYW5hZ2VyLmdldCgnbXl0ZXh0Ym94Jykub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuXHRcdCAqICAgIGVkLndpbmRvd01hbmFnZXIuYWxlcnQoJ0hlbGxvIHdvcmxkIScpO1xuXHRcdCAqIH0pO1xuXHRcdCAqL1xuXHRcdGdldDogZnVuY3Rpb24oaWQpIHtcblx0XHRcdGlmICghYXJndW1lbnRzLmxlbmd0aCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5lZGl0b3JzO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gaWQgaW4gdGhpcy5lZGl0b3JzID8gdGhpcy5lZGl0b3JzW2lkXSA6IG51bGw7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIEFkZHMgYW4gZWRpdG9yIGluc3RhbmNlIHRvIHRoZSBlZGl0b3IgY29sbGVjdGlvbi4gVGhpcyB3aWxsIGFsc28gc2V0IGl0IGFzIHRoZSBhY3RpdmUgZWRpdG9yLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBhZGRcblx0XHQgKiBAcGFyYW0ge3RpbnltY2UuRWRpdG9yfSBlZGl0b3IgRWRpdG9yIGluc3RhbmNlIHRvIGFkZCB0byB0aGUgY29sbGVjdGlvbi5cblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLkVkaXRvcn0gVGhlIHNhbWUgaW5zdGFuY2UgdGhhdCBnb3QgcGFzc2VkIGluLlxuXHRcdCAqL1xuXHRcdGFkZDogZnVuY3Rpb24oZWRpdG9yKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIGVkaXRvcnMgPSBzZWxmLmVkaXRvcnM7XG5cblx0XHRcdC8vIEFkZCBuYW1lZCBhbmQgaW5kZXggZWRpdG9yIGluc3RhbmNlXG5cdFx0XHRlZGl0b3JzW2VkaXRvci5pZF0gPSBlZGl0b3I7XG5cdFx0XHRlZGl0b3JzLnB1c2goZWRpdG9yKTtcblxuXHRcdFx0dG9nZ2xlR2xvYmFsRXZlbnRzKGVkaXRvcnMsIHRydWUpO1xuXG5cdFx0XHQvLyBEb2Vzbid0IGNhbGwgc2V0QWN0aXZlIG1ldGhvZCBzaW5jZSB3ZSBkb24ndCB3YW50XG5cdFx0XHQvLyB0byBmaXJlIGEgYnVuY2ggb2YgYWN0aXZhdGUvZGVhY3RpdmF0ZSBjYWxscyB3aGlsZSBpbml0aWFsaXppbmdcblx0XHRcdHNlbGYuYWN0aXZlRWRpdG9yID0gZWRpdG9yO1xuXG5cdFx0XHRzZWxmLmZpcmUoJ0FkZEVkaXRvcicsIHtlZGl0b3I6IGVkaXRvcn0pO1xuXG5cdFx0XHRpZiAoIWJlZm9yZVVubG9hZERlbGVnYXRlKSB7XG5cdFx0XHRcdGJlZm9yZVVubG9hZERlbGVnYXRlID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0c2VsZi5maXJlKCdCZWZvcmVVbmxvYWQnKTtcblx0XHRcdFx0fTtcblxuXHRcdFx0XHRET00uYmluZCh3aW5kb3csICdiZWZvcmV1bmxvYWQnLCBiZWZvcmVVbmxvYWREZWxlZ2F0ZSk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBlZGl0b3I7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIENyZWF0ZXMgYW4gZWRpdG9yIGluc3RhbmNlIGFuZCBhZGRzIGl0IHRvIHRoZSBFZGl0b3JNYW5hZ2VyIGNvbGxlY3Rpb24uXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGNyZWF0ZUVkaXRvclxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBpZCBJbnN0YW5jZSBpZCB0byB1c2UgZm9yIGVkaXRvci5cblx0XHQgKiBAcGFyYW0ge09iamVjdH0gc2V0dGluZ3MgRWRpdG9yIGluc3RhbmNlIHNldHRpbmdzLlxuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UuRWRpdG9yfSBFZGl0b3IgaW5zdGFuY2UgdGhhdCBnb3QgY3JlYXRlZC5cblx0XHQgKi9cblx0XHRjcmVhdGVFZGl0b3I6IGZ1bmN0aW9uKGlkLCBzZXR0aW5ncykge1xuXHRcdFx0cmV0dXJuIHRoaXMuYWRkKG5ldyBFZGl0b3IoaWQsIHNldHRpbmdzLCB0aGlzKSk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFJlbW92ZXMgYSBlZGl0b3Igb3IgZWRpdG9ycyBmb3JtIHBhZ2UuXG5cdFx0ICpcblx0XHQgKiBAZXhhbXBsZVxuXHRcdCAqIC8vIFJlbW92ZSBhbGwgZWRpdG9ycyBib3VuZCB0byBkaXZzXG5cdFx0ICogdGlueW1jZS5yZW1vdmUoJ2RpdicpO1xuXHRcdCAqXG5cdFx0ICogLy8gUmVtb3ZlIGFsbCBlZGl0b3JzIGJvdW5kIHRvIHRleHRhcmVhc1xuXHRcdCAqIHRpbnltY2UucmVtb3ZlKCd0ZXh0YXJlYScpO1xuXHRcdCAqXG5cdFx0ICogLy8gUmVtb3ZlIGFsbCBlZGl0b3JzXG5cdFx0ICogdGlueW1jZS5yZW1vdmUoKTtcblx0XHQgKlxuXHRcdCAqIC8vIFJlbW92ZSBzcGVjaWZpYyBpbnN0YW5jZSBieSBpZFxuXHRcdCAqIHRpbnltY2UucmVtb3ZlKCcjaWQnKTtcblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgcmVtb3ZlXG5cdFx0ICogQHBhcmFtIHt0aW55bWNlLkVkaXRvci9TdHJpbmcvT2JqZWN0fSBbc2VsZWN0b3JdIENTUyBzZWxlY3RvciBvciBlZGl0b3IgaW5zdGFuY2UgdG8gcmVtb3ZlLlxuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UuRWRpdG9yfSBUaGUgZWRpdG9yIHRoYXQgZ290IHBhc3NlZCBpbiB3aWxsIGJlIHJldHVybiBpZiBpdCB3YXMgZm91bmQgb3RoZXJ3aXNlIG51bGwuXG5cdFx0ICovXG5cdFx0cmVtb3ZlOiBmdW5jdGlvbihzZWxlY3Rvcikge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLCBpLCBlZGl0b3JzID0gc2VsZi5lZGl0b3JzLCBlZGl0b3I7XG5cblx0XHRcdC8vIFJlbW92ZSBhbGwgZWRpdG9yc1xuXHRcdFx0aWYgKCFzZWxlY3Rvcikge1xuXHRcdFx0XHRmb3IgKGkgPSBlZGl0b3JzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG5cdFx0XHRcdFx0c2VsZi5yZW1vdmUoZWRpdG9yc1tpXSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdC8vIFJlbW92ZSBlZGl0b3JzIGJ5IHNlbGVjdG9yXG5cdFx0XHRpZiAodHlwZW9mIHNlbGVjdG9yID09IFwic3RyaW5nXCIpIHtcblx0XHRcdFx0c2VsZWN0b3IgPSBzZWxlY3Rvci5zZWxlY3RvciB8fCBzZWxlY3RvcjtcblxuXHRcdFx0XHRlYWNoKERPTS5zZWxlY3Qoc2VsZWN0b3IpLCBmdW5jdGlvbihlbG0pIHtcblx0XHRcdFx0XHRlZGl0b3IgPSBlZGl0b3JzW2VsbS5pZF07XG5cblx0XHRcdFx0XHRpZiAoZWRpdG9yKSB7XG5cdFx0XHRcdFx0XHRzZWxmLnJlbW92ZShlZGl0b3IpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBSZW1vdmUgc3BlY2lmaWMgZWRpdG9yXG5cdFx0XHRlZGl0b3IgPSBzZWxlY3RvcjtcblxuXHRcdFx0Ly8gTm90IGluIHRoZSBjb2xsZWN0aW9uXG5cdFx0XHRpZiAoIWVkaXRvcnNbZWRpdG9yLmlkXSkge1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHJlbW92ZUVkaXRvckZyb21MaXN0KGVkaXRvcikpIHtcblx0XHRcdFx0c2VsZi5maXJlKCdSZW1vdmVFZGl0b3InLCB7ZWRpdG9yOiBlZGl0b3J9KTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKCFlZGl0b3JzLmxlbmd0aCkge1xuXHRcdFx0XHRET00udW5iaW5kKHdpbmRvdywgJ2JlZm9yZXVubG9hZCcsIGJlZm9yZVVubG9hZERlbGVnYXRlKTtcblx0XHRcdH1cblxuXHRcdFx0ZWRpdG9yLnJlbW92ZSgpO1xuXG5cdFx0XHR0b2dnbGVHbG9iYWxFdmVudHMoZWRpdG9ycywgZWRpdG9ycy5sZW5ndGggPiAwKTtcblxuXHRcdFx0cmV0dXJuIGVkaXRvcjtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogRXhlY3V0ZXMgYSBzcGVjaWZpYyBjb21tYW5kIG9uIHRoZSBjdXJyZW50bHkgYWN0aXZlIGVkaXRvci5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgZXhlY0NvbW1hbmRcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gY21kIENvbW1hbmQgdG8gcGVyZm9ybSBmb3IgZXhhbXBsZSBCb2xkLlxuXHRcdCAqIEBwYXJhbSB7Qm9vbGVhbn0gdWkgT3B0aW9uYWwgYm9vbGVhbiBzdGF0ZSBpZiBhIFVJIHNob3VsZCBiZSBwcmVzZW50ZWQgZm9yIHRoZSBjb21tYW5kIG9yIG5vdC5cblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gdmFsdWUgT3B0aW9uYWwgdmFsdWUgcGFyYW1ldGVyIGxpa2UgZm9yIGV4YW1wbGUgYW4gVVJMIHRvIGEgbGluay5cblx0XHQgKiBAcmV0dXJuIHtCb29sZWFufSB0cnVlL2ZhbHNlIGlmIHRoZSBjb21tYW5kIHdhcyBleGVjdXRlZCBvciBub3QuXG5cdFx0ICovXG5cdFx0ZXhlY0NvbW1hbmQ6IGZ1bmN0aW9uKGNtZCwgdWksIHZhbHVlKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIGVkaXRvciA9IHNlbGYuZ2V0KHZhbHVlKTtcblxuXHRcdFx0Ly8gTWFuYWdlciBjb21tYW5kc1xuXHRcdFx0c3dpdGNoIChjbWQpIHtcblx0XHRcdFx0Y2FzZSBcIm1jZUFkZEVkaXRvclwiOlxuXHRcdFx0XHRcdGlmICghc2VsZi5nZXQodmFsdWUpKSB7XG5cdFx0XHRcdFx0XHRuZXcgRWRpdG9yKHZhbHVlLCBzZWxmLnNldHRpbmdzLCBzZWxmKS5yZW5kZXIoKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblxuXHRcdFx0XHRjYXNlIFwibWNlUmVtb3ZlRWRpdG9yXCI6XG5cdFx0XHRcdFx0aWYgKGVkaXRvcikge1xuXHRcdFx0XHRcdFx0ZWRpdG9yLnJlbW92ZSgpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiB0cnVlO1xuXG5cdFx0XHRcdGNhc2UgJ21jZVRvZ2dsZUVkaXRvcic6XG5cdFx0XHRcdFx0aWYgKCFlZGl0b3IpIHtcblx0XHRcdFx0XHRcdHNlbGYuZXhlY0NvbW1hbmQoJ21jZUFkZEVkaXRvcicsIDAsIHZhbHVlKTtcblx0XHRcdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmIChlZGl0b3IuaXNIaWRkZW4oKSkge1xuXHRcdFx0XHRcdFx0ZWRpdG9yLnNob3coKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0ZWRpdG9yLmhpZGUoKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gUnVuIGNvbW1hbmQgb24gYWN0aXZlIGVkaXRvclxuXHRcdFx0aWYgKHNlbGYuYWN0aXZlRWRpdG9yKSB7XG5cdFx0XHRcdHJldHVybiBzZWxmLmFjdGl2ZUVkaXRvci5leGVjQ29tbWFuZChjbWQsIHVpLCB2YWx1ZSk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogQ2FsbHMgdGhlIHNhdmUgbWV0aG9kIG9uIGFsbCBlZGl0b3IgaW5zdGFuY2VzIGluIHRoZSBjb2xsZWN0aW9uLiBUaGlzIGNhbiBiZSB1c2VmdWwgd2hlbiBhIGZvcm0gaXMgdG8gYmUgc3VibWl0dGVkLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCB0cmlnZ2VyU2F2ZVxuXHRcdCAqIEBleGFtcGxlXG5cdFx0ICogLy8gU2F2ZXMgYWxsIGNvbnRlbnRzXG5cdFx0ICogdGlueU1DRS50cmlnZ2VyU2F2ZSgpO1xuXHRcdCAqL1xuXHRcdHRyaWdnZXJTYXZlOiBmdW5jdGlvbigpIHtcblx0XHRcdGVhY2godGhpcy5lZGl0b3JzLCBmdW5jdGlvbihlZGl0b3IpIHtcblx0XHRcdFx0ZWRpdG9yLnNhdmUoKTtcblx0XHRcdH0pO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBBZGRzIGEgbGFuZ3VhZ2UgcGFjaywgdGhpcyBnZXRzIGNhbGxlZCBieSB0aGUgbG9hZGVkIGxhbmd1YWdlIGZpbGVzIGxpa2UgZW4uanMuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGFkZEkxOG5cblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gY29kZSBPcHRpb25hbCBsYW5ndWFnZSBjb2RlLlxuXHRcdCAqIEBwYXJhbSB7T2JqZWN0fSBpdGVtcyBOYW1lL3ZhbHVlIG9iamVjdCB3aXRoIHRyYW5zbGF0aW9ucy5cblx0XHQgKi9cblx0XHRhZGRJMThuOiBmdW5jdGlvbihjb2RlLCBpdGVtcykge1xuXHRcdFx0STE4bi5hZGQoY29kZSwgaXRlbXMpO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBUcmFuc2xhdGVzIHRoZSBzcGVjaWZpZWQgc3RyaW5nIHVzaW5nIHRoZSBsYW5ndWFnZSBwYWNrIGl0ZW1zLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCB0cmFuc2xhdGVcblx0XHQgKiBAcGFyYW0ge1N0cmluZy9BcnJheS9PYmplY3R9IHRleHQgU3RyaW5nIHRvIHRyYW5zbGF0ZVxuXHRcdCAqIEByZXR1cm4ge1N0cmluZ30gVHJhbnNsYXRlZCBzdHJpbmcuXG5cdFx0ICovXG5cdFx0dHJhbnNsYXRlOiBmdW5jdGlvbih0ZXh0KSB7XG5cdFx0XHRyZXR1cm4gSTE4bi50cmFuc2xhdGUodGV4dCk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFNldHMgdGhlIGFjdGl2ZSBlZGl0b3IgaW5zdGFuY2UgYW5kIGZpcmVzIHRoZSBkZWFjdGl2YXRlL2FjdGl2YXRlIGV2ZW50cy5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2Qgc2V0QWN0aXZlXG5cdFx0ICogQHBhcmFtIHt0aW55bWNlLkVkaXRvcn0gZWRpdG9yIEVkaXRvciBpbnN0YW5jZSB0byBzZXQgYXMgdGhlIGFjdGl2ZSBpbnN0YW5jZS5cblx0XHQgKi9cblx0XHRzZXRBY3RpdmU6IGZ1bmN0aW9uKGVkaXRvcikge1xuXHRcdFx0dmFyIGFjdGl2ZUVkaXRvciA9IHRoaXMuYWN0aXZlRWRpdG9yO1xuXG5cdFx0XHRpZiAodGhpcy5hY3RpdmVFZGl0b3IgIT0gZWRpdG9yKSB7XG5cdFx0XHRcdGlmIChhY3RpdmVFZGl0b3IpIHtcblx0XHRcdFx0XHRhY3RpdmVFZGl0b3IuZmlyZSgnZGVhY3RpdmF0ZScsIHtyZWxhdGVkVGFyZ2V0OiBlZGl0b3J9KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGVkaXRvci5maXJlKCdhY3RpdmF0ZScsIHtyZWxhdGVkVGFyZ2V0OiBhY3RpdmVFZGl0b3J9KTtcblx0XHRcdH1cblxuXHRcdFx0dGhpcy5hY3RpdmVFZGl0b3IgPSBlZGl0b3I7XG5cdFx0fVxuXHR9O1xuXG5cdGV4dGVuZChFZGl0b3JNYW5hZ2VyLCBPYnNlcnZhYmxlKTtcblxuXHRFZGl0b3JNYW5hZ2VyLnNldHVwKCk7XG5cblx0Ly8gRXhwb3J0IEVkaXRvck1hbmFnZXIgYXMgdGlueW1jZS90aW55bWNlIGluIGdsb2JhbCBuYW1lc3BhY2Vcblx0d2luZG93LnRpbnltY2UgPSB3aW5kb3cudGlueU1DRSA9IEVkaXRvck1hbmFnZXI7XG5cblx0cmV0dXJuIEVkaXRvck1hbmFnZXI7XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL0xlZ2FjeUlucHV0LmpzXG5cbi8qKlxuICogTGVnYWN5SW5wdXQuanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBDb252ZXJ0cyBsZWdhY3kgaW5wdXQgdG8gbW9kZXJuIEhUTUwuXG4gKlxuICogQGNsYXNzIHRpbnltY2UuTGVnYWN5SW5wdXRcbiAqIEBwcml2YXRlXG4gKi9cbmRlZmluZShcInRpbnltY2UvTGVnYWN5SW5wdXRcIiwgW1xuXHRcInRpbnltY2UvRWRpdG9yTWFuYWdlclwiLFxuXHRcInRpbnltY2UvdXRpbC9Ub29sc1wiXG5dLCBmdW5jdGlvbihFZGl0b3JNYW5hZ2VyLCBUb29scykge1xuXHR2YXIgZWFjaCA9IFRvb2xzLmVhY2gsIGV4cGxvZGUgPSBUb29scy5leHBsb2RlO1xuXG5cdEVkaXRvck1hbmFnZXIub24oJ0FkZEVkaXRvcicsIGZ1bmN0aW9uKGUpIHtcblx0XHR2YXIgZWRpdG9yID0gZS5lZGl0b3I7XG5cblx0XHRlZGl0b3Iub24oJ3ByZUluaXQnLCBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBmaWx0ZXJzLCBmb250U2l6ZXMsIGRvbSwgc2V0dGluZ3MgPSBlZGl0b3Iuc2V0dGluZ3M7XG5cblx0XHRcdGZ1bmN0aW9uIHJlcGxhY2VXaXRoU3Bhbihub2RlLCBzdHlsZXMpIHtcblx0XHRcdFx0ZWFjaChzdHlsZXMsIGZ1bmN0aW9uKHZhbHVlLCBuYW1lKSB7XG5cdFx0XHRcdFx0aWYgKHZhbHVlKSB7XG5cdFx0XHRcdFx0XHRkb20uc2V0U3R5bGUobm9kZSwgbmFtZSwgdmFsdWUpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0ZG9tLnJlbmFtZShub2RlLCAnc3BhbicpO1xuXHRcdFx0fVxuXG5cdFx0XHRmdW5jdGlvbiBjb252ZXJ0KGUpIHtcblx0XHRcdFx0ZG9tID0gZWRpdG9yLmRvbTtcblxuXHRcdFx0XHRpZiAoc2V0dGluZ3MuY29udmVydF9mb250c190b19zcGFucykge1xuXHRcdFx0XHRcdGVhY2goZG9tLnNlbGVjdCgnZm9udCx1LHN0cmlrZScsIGUubm9kZSksIGZ1bmN0aW9uKG5vZGUpIHtcblx0XHRcdFx0XHRcdGZpbHRlcnNbbm9kZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpXShkb20sIG5vZGUpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmIChzZXR0aW5ncy5pbmxpbmVfc3R5bGVzKSB7XG5cdFx0XHRcdGZvbnRTaXplcyA9IGV4cGxvZGUoc2V0dGluZ3MuZm9udF9zaXplX2xlZ2FjeV92YWx1ZXMpO1xuXG5cdFx0XHRcdGZpbHRlcnMgPSB7XG5cdFx0XHRcdFx0Zm9udDogZnVuY3Rpb24oZG9tLCBub2RlKSB7XG5cdFx0XHRcdFx0XHRyZXBsYWNlV2l0aFNwYW4obm9kZSwge1xuXHRcdFx0XHRcdFx0XHRiYWNrZ3JvdW5kQ29sb3I6IG5vZGUuc3R5bGUuYmFja2dyb3VuZENvbG9yLFxuXHRcdFx0XHRcdFx0XHRjb2xvcjogbm9kZS5jb2xvcixcblx0XHRcdFx0XHRcdFx0Zm9udEZhbWlseTogbm9kZS5mYWNlLFxuXHRcdFx0XHRcdFx0XHRmb250U2l6ZTogZm9udFNpemVzW3BhcnNlSW50KG5vZGUuc2l6ZSwgMTApIC0gMV1cblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdH0sXG5cblx0XHRcdFx0XHR1OiBmdW5jdGlvbihkb20sIG5vZGUpIHtcblx0XHRcdFx0XHRcdC8vIEhUTUw1IGFsbG93cyBVIGVsZW1lbnRcblx0XHRcdFx0XHRcdGlmIChlZGl0b3Iuc2V0dGluZ3Muc2NoZW1hID09PSBcImh0bWw0XCIpIHtcblx0XHRcdFx0XHRcdFx0cmVwbGFjZVdpdGhTcGFuKG5vZGUsIHtcblx0XHRcdFx0XHRcdFx0XHR0ZXh0RGVjb3JhdGlvbjogJ3VuZGVybGluZSdcblx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSxcblxuXHRcdFx0XHRcdHN0cmlrZTogZnVuY3Rpb24oZG9tLCBub2RlKSB7XG5cdFx0XHRcdFx0XHRyZXBsYWNlV2l0aFNwYW4obm9kZSwge1xuXHRcdFx0XHRcdFx0XHR0ZXh0RGVjb3JhdGlvbjogJ2xpbmUtdGhyb3VnaCdcblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fTtcblxuXHRcdFx0XHRlZGl0b3Iub24oJ1ByZVByb2Nlc3MgU2V0Q29udGVudCcsIGNvbnZlcnQpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9KTtcbn0pO1xuXG4vLyBJbmNsdWRlZCBmcm9tOiBqcy90aW55bWNlL2NsYXNzZXMvdXRpbC9YSFIuanNcblxuLyoqXG4gKiBYSFIuanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBUaGlzIGNsYXNzIGVuYWJsZXMgeW91IHRvIHNlbmQgWE1MSFRUUFJlcXVlc3RzIGNyb3NzIGJyb3dzZXIuXG4gKiBAY2xhc3MgdGlueW1jZS51dGlsLlhIUlxuICogQG1peGVzIHRpbnltY2UudXRpbC5PYnNlcnZhYmxlXG4gKiBAc3RhdGljXG4gKiBAZXhhbXBsZVxuICogLy8gU2VuZHMgYSBsb3cgbGV2ZWwgQWpheCByZXF1ZXN0XG4gKiB0aW55bWNlLnV0aWwuWEhSLnNlbmQoe1xuICogICAgdXJsOiAnc29tZXVybCcsXG4gKiAgICBzdWNjZXNzOiBmdW5jdGlvbih0ZXh0KSB7XG4gKiAgICAgICBjb25zb2xlLmRlYnVnKHRleHQpO1xuICogICAgfVxuICogfSk7XG4gKlxuICogLy8gQWRkIGN1c3RvbSBoZWFkZXIgdG8gWEhSIHJlcXVlc3RcbiAqIHRpbnltY2UudXRpbC5YSFIub24oJ2JlZm9yZVNlbmQnLCBmdW5jdGlvbihlKSB7XG4gKiAgICAgZS54aHIuc2V0UmVxdWVzdEhlYWRlcignWC1SZXF1ZXN0ZWQtV2l0aCcsICdTb21ldGhpbmcnKTtcbiAqIH0pO1xuICovXG5kZWZpbmUoXCJ0aW55bWNlL3V0aWwvWEhSXCIsIFtcblx0XCJ0aW55bWNlL3V0aWwvT2JzZXJ2YWJsZVwiLFxuXHRcInRpbnltY2UvdXRpbC9Ub29sc1wiXG5dLCBmdW5jdGlvbihPYnNlcnZhYmxlLCBUb29scykge1xuXHR2YXIgWEhSID0ge1xuXHRcdC8qKlxuXHRcdCAqIFNlbmRzIGEgWE1MSFRUUFJlcXVlc3QuXG5cdFx0ICogQ29uc3VsdCB0aGUgV2lraSBmb3IgZGV0YWlscyBvbiB3aGF0IHNldHRpbmdzIHRoaXMgbWV0aG9kIHRha2VzLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBzZW5kXG5cdFx0ICogQHBhcmFtIHtPYmplY3R9IHNldHRpbmdzIE9iamVjdCB3aWxsIHRhcmdldCBVUkwsIGNhbGxiYWNrcyBhbmQgb3RoZXIgaW5mbyBuZWVkZWQgdG8gbWFrZSB0aGUgcmVxdWVzdC5cblx0XHQgKi9cblx0XHRzZW5kOiBmdW5jdGlvbihzZXR0aW5ncykge1xuXHRcdFx0dmFyIHhociwgY291bnQgPSAwO1xuXG5cdFx0XHRmdW5jdGlvbiByZWFkeSgpIHtcblx0XHRcdFx0aWYgKCFzZXR0aW5ncy5hc3luYyB8fCB4aHIucmVhZHlTdGF0ZSA9PSA0IHx8IGNvdW50KysgPiAxMDAwMCkge1xuXHRcdFx0XHRcdGlmIChzZXR0aW5ncy5zdWNjZXNzICYmIGNvdW50IDwgMTAwMDAgJiYgeGhyLnN0YXR1cyA9PSAyMDApIHtcblx0XHRcdFx0XHRcdHNldHRpbmdzLnN1Y2Nlc3MuY2FsbChzZXR0aW5ncy5zdWNjZXNzX3Njb3BlLCAnJyArIHhoci5yZXNwb25zZVRleHQsIHhociwgc2V0dGluZ3MpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAoc2V0dGluZ3MuZXJyb3IpIHtcblx0XHRcdFx0XHRcdHNldHRpbmdzLmVycm9yLmNhbGwoc2V0dGluZ3MuZXJyb3Jfc2NvcGUsIGNvdW50ID4gMTAwMDAgPyAnVElNRURfT1VUJyA6ICdHRU5FUkFMJywgeGhyLCBzZXR0aW5ncyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0eGhyID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRzZXRUaW1lb3V0KHJlYWR5LCAxMCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0Ly8gRGVmYXVsdCBzZXR0aW5nc1xuXHRcdFx0c2V0dGluZ3Muc2NvcGUgPSBzZXR0aW5ncy5zY29wZSB8fCB0aGlzO1xuXHRcdFx0c2V0dGluZ3Muc3VjY2Vzc19zY29wZSA9IHNldHRpbmdzLnN1Y2Nlc3Nfc2NvcGUgfHwgc2V0dGluZ3Muc2NvcGU7XG5cdFx0XHRzZXR0aW5ncy5lcnJvcl9zY29wZSA9IHNldHRpbmdzLmVycm9yX3Njb3BlIHx8IHNldHRpbmdzLnNjb3BlO1xuXHRcdFx0c2V0dGluZ3MuYXN5bmMgPSBzZXR0aW5ncy5hc3luYyA9PT0gZmFsc2UgPyBmYWxzZSA6IHRydWU7XG5cdFx0XHRzZXR0aW5ncy5kYXRhID0gc2V0dGluZ3MuZGF0YSB8fCAnJztcblxuXHRcdFx0WEhSLmZpcmUoJ2JlZm9yZUluaXRpYWxpemUnLCB7c2V0dGluZ3M6IHNldHRpbmdzfSk7XG5cblx0XHRcdHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuXG5cdFx0XHRpZiAoeGhyKSB7XG5cdFx0XHRcdGlmICh4aHIub3ZlcnJpZGVNaW1lVHlwZSkge1xuXHRcdFx0XHRcdHhoci5vdmVycmlkZU1pbWVUeXBlKHNldHRpbmdzLmNvbnRlbnRfdHlwZSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHR4aHIub3BlbihzZXR0aW5ncy50eXBlIHx8IChzZXR0aW5ncy5kYXRhID8gJ1BPU1QnIDogJ0dFVCcpLCBzZXR0aW5ncy51cmwsIHNldHRpbmdzLmFzeW5jKTtcblxuXHRcdFx0XHRpZiAoc2V0dGluZ3MuY3Jvc3NEb21haW4pIHtcblx0XHRcdFx0XHR4aHIud2l0aENyZWRlbnRpYWxzID0gdHJ1ZTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChzZXR0aW5ncy5jb250ZW50X3R5cGUpIHtcblx0XHRcdFx0XHR4aHIuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgc2V0dGluZ3MuY29udGVudF90eXBlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChzZXR0aW5ncy5yZXF1ZXN0aGVhZGVycykge1xuXHRcdFx0XHRcdFRvb2xzLmVhY2goc2V0dGluZ3MucmVxdWVzdGhlYWRlcnMsIGZ1bmN0aW9uKGhlYWRlcikge1xuXHRcdFx0XHRcdFx0eGhyLnNldFJlcXVlc3RIZWFkZXIoaGVhZGVyLmtleSwgaGVhZGVyLnZhbHVlKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHhoci5zZXRSZXF1ZXN0SGVhZGVyKCdYLVJlcXVlc3RlZC1XaXRoJywgJ1hNTEh0dHBSZXF1ZXN0Jyk7XG5cblx0XHRcdFx0eGhyID0gWEhSLmZpcmUoJ2JlZm9yZVNlbmQnLCB7eGhyOiB4aHIsIHNldHRpbmdzOiBzZXR0aW5nc30pLnhocjtcblx0XHRcdFx0eGhyLnNlbmQoc2V0dGluZ3MuZGF0YSk7XG5cblx0XHRcdFx0Ly8gU3luY3Jvbm91cyByZXF1ZXN0XG5cdFx0XHRcdGlmICghc2V0dGluZ3MuYXN5bmMpIHtcblx0XHRcdFx0XHRyZXR1cm4gcmVhZHkoKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIFdhaXQgZm9yIHJlc3BvbnNlLCBvblJlYWR5U3RhdGVDaGFuZ2UgY2FuIG5vdCBiZSB1c2VkIHNpbmNlIGl0IGxlYWtzIG1lbW9yeSBpbiBJRVxuXHRcdFx0XHRzZXRUaW1lb3V0KHJlYWR5LCAxMCk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdFRvb2xzLmV4dGVuZChYSFIsIE9ic2VydmFibGUpO1xuXG5cdHJldHVybiBYSFI7XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL3V0aWwvSlNPTi5qc1xuXG4vKipcbiAqIEpTT04uanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBKU09OIHBhcnNlciBhbmQgc2VyaWFsaXplciBjbGFzcy5cbiAqXG4gKiBAY2xhc3MgdGlueW1jZS51dGlsLkpTT05cbiAqIEBzdGF0aWNcbiAqIEBleGFtcGxlXG4gKiAvLyBKU09OIHBhcnNlIGEgc3RyaW5nIGludG8gYW4gb2JqZWN0XG4gKiB2YXIgb2JqID0gdGlueW1jZS51dGlsLkpTT04ucGFyc2Uoc29tZXN0cmluZyk7XG4gKlxuICogLy8gSlNPTiBzZXJpYWxpemUgYSBvYmplY3QgaW50byBhbiBzdHJpbmdcbiAqIHZhciBzdHIgPSB0aW55bWNlLnV0aWwuSlNPTi5zZXJpYWxpemUob2JqKTtcbiAqL1xuZGVmaW5lKFwidGlueW1jZS91dGlsL0pTT05cIiwgW10sIGZ1bmN0aW9uKCkge1xuXHRmdW5jdGlvbiBzZXJpYWxpemUobywgcXVvdGUpIHtcblx0XHR2YXIgaSwgdiwgdCwgbmFtZTtcblxuXHRcdHF1b3RlID0gcXVvdGUgfHwgJ1wiJztcblxuXHRcdGlmIChvID09PSBudWxsKSB7XG5cdFx0XHRyZXR1cm4gJ251bGwnO1xuXHRcdH1cblxuXHRcdHQgPSB0eXBlb2YgbztcblxuXHRcdGlmICh0ID09ICdzdHJpbmcnKSB7XG5cdFx0XHR2ID0gJ1xcYmJcXHR0XFxublxcZmZcXHJyXFxcIlwiXFwnXFwnXFxcXFxcXFwnO1xuXG5cdFx0XHQvKmVzbGludCBuby1jb250cm9sLXJlZ2V4OjAgKi9cblx0XHRcdHJldHVybiBxdW90ZSArIG8ucmVwbGFjZSgvKFtcXHUwMDgwLVxcdUZGRkZcXHgwMC1cXHgxZlxcXCJcXCdcXFxcXSkvZywgZnVuY3Rpb24oYSwgYikge1xuXHRcdFx0XHQvLyBNYWtlIHN1cmUgc2luZ2xlIHF1b3RlcyBuZXZlciBnZXQgZW5jb2RlZCBpbnNpZGUgZG91YmxlIHF1b3RlcyBmb3IgSlNPTiBjb21wYXRpYmlsaXR5XG5cdFx0XHRcdGlmIChxdW90ZSA9PT0gJ1wiJyAmJiBhID09PSBcIidcIikge1xuXHRcdFx0XHRcdHJldHVybiBhO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aSA9IHYuaW5kZXhPZihiKTtcblxuXHRcdFx0XHRpZiAoaSArIDEpIHtcblx0XHRcdFx0XHRyZXR1cm4gJ1xcXFwnICsgdi5jaGFyQXQoaSArIDEpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0YSA9IGIuY2hhckNvZGVBdCgpLnRvU3RyaW5nKDE2KTtcblxuXHRcdFx0XHRyZXR1cm4gJ1xcXFx1JyArICcwMDAwJy5zdWJzdHJpbmcoYS5sZW5ndGgpICsgYTtcblx0XHRcdH0pICsgcXVvdGU7XG5cdFx0fVxuXG5cdFx0aWYgKHQgPT0gJ29iamVjdCcpIHtcblx0XHRcdGlmIChvLmhhc093blByb3BlcnR5ICYmIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvKSA9PT0gJ1tvYmplY3QgQXJyYXldJykge1xuXHRcdFx0XHRmb3IgKGkgPSAwLCB2ID0gJ1snOyBpIDwgby5sZW5ndGg7IGkrKykge1xuXHRcdFx0XHRcdHYgKz0gKGkgPiAwID8gJywnIDogJycpICsgc2VyaWFsaXplKG9baV0sIHF1b3RlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiB2ICsgJ10nO1xuXHRcdFx0fVxuXG5cdFx0XHR2ID0gJ3snO1xuXG5cdFx0XHRmb3IgKG5hbWUgaW4gbykge1xuXHRcdFx0XHRpZiAoby5oYXNPd25Qcm9wZXJ0eShuYW1lKSkge1xuXHRcdFx0XHRcdHYgKz0gdHlwZW9mIG9bbmFtZV0gIT0gJ2Z1bmN0aW9uJyA/ICh2Lmxlbmd0aCA+IDEgPyAnLCcgKyBxdW90ZSA6IHF1b3RlKSArIG5hbWUgK1xuXHRcdFx0XHRcdFx0cXVvdGUgKyAnOicgKyBzZXJpYWxpemUob1tuYW1lXSwgcXVvdGUpIDogJyc7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHYgKyAnfSc7XG5cdFx0fVxuXG5cdFx0cmV0dXJuICcnICsgbztcblx0fVxuXG5cdHJldHVybiB7XG5cdFx0LyoqXG5cdFx0ICogU2VyaWFsaXplcyB0aGUgc3BlY2lmaWVkIG9iamVjdCBhcyBhIEpTT04gc3RyaW5nLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBzZXJpYWxpemVcblx0XHQgKiBAcGFyYW0ge09iamVjdH0gb2JqIE9iamVjdCB0byBzZXJpYWxpemUgYXMgYSBKU09OIHN0cmluZy5cblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gcXVvdGUgT3B0aW9uYWwgcXVvdGUgc3RyaW5nIGRlZmF1bHRzIHRvIFwiLlxuXHRcdCAqIEByZXR1cm4ge3N0cmluZ30gSlNPTiBzdHJpbmcgc2VyaWFsaXplZCBmcm9tIGlucHV0LlxuXHRcdCAqL1xuXHRcdHNlcmlhbGl6ZTogc2VyaWFsaXplLFxuXG5cdFx0LyoqXG5cdFx0ICogVW5zZXJpYWxpemVzL3BhcnNlcyB0aGUgc3BlY2lmaWVkIEpTT04gc3RyaW5nIGludG8gYSBvYmplY3QuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHBhcnNlXG5cdFx0ICogQHBhcmFtIHtzdHJpbmd9IHMgSlNPTiBTdHJpbmcgdG8gcGFyc2UgaW50byBhIEphdmFTY3JpcHQgb2JqZWN0LlxuXHRcdCAqIEByZXR1cm4ge09iamVjdH0gT2JqZWN0IGZyb20gaW5wdXQgSlNPTiBzdHJpbmcgb3IgdW5kZWZpbmVkIGlmIGl0IGZhaWxlZC5cblx0XHQgKi9cblx0XHRwYXJzZTogZnVuY3Rpb24odGV4dCkge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0Ly8gVHJpY2sgdWdsaWZ5IEpTXG5cdFx0XHRcdHJldHVybiB3aW5kb3dbU3RyaW5nLmZyb21DaGFyQ29kZSgxMDEpICsgJ3ZhbCddKCcoJyArIHRleHQgKyAnKScpO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0Ly8gSWdub3JlXG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0LyoqI0AtKi9cblx0fTtcbn0pO1xuXG4vLyBJbmNsdWRlZCBmcm9tOiBqcy90aW55bWNlL2NsYXNzZXMvdXRpbC9KU09OUmVxdWVzdC5qc1xuXG4vKipcbiAqIEpTT05SZXF1ZXN0LmpzXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgTEdQTCBMaWNlbnNlLlxuICogQ29weXJpZ2h0IChjKSAxOTk5LTIwMTUgRXBob3ggQ29ycC4gQWxsIHJpZ2h0cyByZXNlcnZlZFxuICpcbiAqIExpY2Vuc2U6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vbGljZW5zZVxuICogQ29udHJpYnV0aW5nOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2NvbnRyaWJ1dGluZ1xuICovXG5cbi8qKlxuICogVGhpcyBjbGFzcyBlbmFibGVzIHlvdSB0byB1c2UgSlNPTi1SUEMgdG8gY2FsbCBiYWNrZW5kIG1ldGhvZHMuXG4gKlxuICogQGNsYXNzIHRpbnltY2UudXRpbC5KU09OUmVxdWVzdFxuICogQGV4YW1wbGVcbiAqIHZhciBqc29uID0gbmV3IHRpbnltY2UudXRpbC5KU09OUmVxdWVzdCh7XG4gKiAgICAgdXJsOiAnc29tZWJhY2tlbmQucGhwJ1xuICogfSk7XG4gKlxuICogLy8gU2VuZCBSUEMgY2FsbCAxXG4gKiBqc29uLnNlbmQoe1xuICogICAgIG1ldGhvZDogJ3NvbWVNZXRob2QxJyxcbiAqICAgICBwYXJhbXM6IFsnYScsICdiJ10sXG4gKiAgICAgc3VjY2VzczogZnVuY3Rpb24ocmVzdWx0KSB7XG4gKiAgICAgICAgIGNvbnNvbGUuZGlyKHJlc3VsdCk7XG4gKiAgICAgfVxuICogfSk7XG4gKlxuICogLy8gU2VuZCBSUEMgY2FsbCAyXG4gKiBqc29uLnNlbmQoe1xuICogICAgIG1ldGhvZDogJ3NvbWVNZXRob2QyJyxcbiAqICAgICBwYXJhbXM6IFsnYScsICdiJ10sXG4gKiAgICAgc3VjY2VzczogZnVuY3Rpb24ocmVzdWx0KSB7XG4gKiAgICAgICAgIGNvbnNvbGUuZGlyKHJlc3VsdCk7XG4gKiAgICAgfVxuICogfSk7XG4gKi9cbmRlZmluZShcInRpbnltY2UvdXRpbC9KU09OUmVxdWVzdFwiLCBbXG5cdFwidGlueW1jZS91dGlsL0pTT05cIixcblx0XCJ0aW55bWNlL3V0aWwvWEhSXCIsXG5cdFwidGlueW1jZS91dGlsL1Rvb2xzXCJcbl0sIGZ1bmN0aW9uKEpTT04sIFhIUiwgVG9vbHMpIHtcblx0dmFyIGV4dGVuZCA9IFRvb2xzLmV4dGVuZDtcblxuXHRmdW5jdGlvbiBKU09OUmVxdWVzdChzZXR0aW5ncykge1xuXHRcdHRoaXMuc2V0dGluZ3MgPSBleHRlbmQoe30sIHNldHRpbmdzKTtcblx0XHR0aGlzLmNvdW50ID0gMDtcblx0fVxuXG5cdC8qKlxuXHQgKiBTaW1wbGUgaGVscGVyIGZ1bmN0aW9uIHRvIHNlbmQgYSBKU09OLVJQQyByZXF1ZXN0IHdpdGhvdXQgdGhlIG5lZWQgdG8gaW5pdGlhbGl6ZSBhbiBvYmplY3QuXG5cdCAqIENvbnN1bHQgdGhlIFdpa2kgQVBJIGRvY3VtZW50YXRpb24gZm9yIG1vcmUgZGV0YWlscyBvbiB3aGF0IHlvdSBjYW4gcGFzcyB0byB0aGlzIGZ1bmN0aW9uLlxuXHQgKlxuXHQgKiBAbWV0aG9kIHNlbmRSUENcblx0ICogQHN0YXRpY1xuXHQgKiBAcGFyYW0ge09iamVjdH0gbyBDYWxsIG9iamVjdCB3aGVyZSB0aGVyZSBhcmUgdGhyZWUgZmllbGQgaWQsIG1ldGhvZCBhbmQgcGFyYW1zIHRoaXMgb2JqZWN0IHNob3VsZCBhbHNvIGNvbnRhaW4gY2FsbGJhY2tzIGV0Yy5cblx0ICovXG5cdEpTT05SZXF1ZXN0LnNlbmRSUEMgPSBmdW5jdGlvbihvKSB7XG5cdFx0cmV0dXJuIG5ldyBKU09OUmVxdWVzdCgpLnNlbmQobyk7XG5cdH07XG5cblx0SlNPTlJlcXVlc3QucHJvdG90eXBlID0ge1xuXHRcdC8qKlxuXHRcdCAqIFNlbmRzIGEgSlNPTi1SUEMgY2FsbC4gQ29uc3VsdCB0aGUgV2lraSBBUEkgZG9jdW1lbnRhdGlvbiBmb3IgbW9yZSBkZXRhaWxzIG9uIHdoYXQgeW91IGNhbiBwYXNzIHRvIHRoaXMgZnVuY3Rpb24uXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHNlbmRcblx0XHQgKiBAcGFyYW0ge09iamVjdH0gYXJncyBDYWxsIG9iamVjdCB3aGVyZSB0aGVyZSBhcmUgdGhyZWUgZmllbGQgaWQsIG1ldGhvZCBhbmQgcGFyYW1zIHRoaXMgb2JqZWN0IHNob3VsZCBhbHNvIGNvbnRhaW4gY2FsbGJhY2tzIGV0Yy5cblx0XHQgKi9cblx0XHRzZW5kOiBmdW5jdGlvbihhcmdzKSB7XG5cdFx0XHR2YXIgZWNiID0gYXJncy5lcnJvciwgc2NiID0gYXJncy5zdWNjZXNzO1xuXG5cdFx0XHRhcmdzID0gZXh0ZW5kKHRoaXMuc2V0dGluZ3MsIGFyZ3MpO1xuXG5cdFx0XHRhcmdzLnN1Y2Nlc3MgPSBmdW5jdGlvbihjLCB4KSB7XG5cdFx0XHRcdGMgPSBKU09OLnBhcnNlKGMpO1xuXG5cdFx0XHRcdGlmICh0eXBlb2YgYyA9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdGMgPSB7XG5cdFx0XHRcdFx0XHRlcnJvcjogJ0pTT04gUGFyc2UgZXJyb3IuJ1xuXHRcdFx0XHRcdH07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoYy5lcnJvcikge1xuXHRcdFx0XHRcdGVjYi5jYWxsKGFyZ3MuZXJyb3Jfc2NvcGUgfHwgYXJncy5zY29wZSwgYy5lcnJvciwgeCk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0c2NiLmNhbGwoYXJncy5zdWNjZXNzX3Njb3BlIHx8IGFyZ3Muc2NvcGUsIGMucmVzdWx0KTtcblx0XHRcdFx0fVxuXHRcdFx0fTtcblxuXHRcdFx0YXJncy5lcnJvciA9IGZ1bmN0aW9uKHR5LCB4KSB7XG5cdFx0XHRcdGlmIChlY2IpIHtcblx0XHRcdFx0XHRlY2IuY2FsbChhcmdzLmVycm9yX3Njb3BlIHx8IGFyZ3Muc2NvcGUsIHR5LCB4KTtcblx0XHRcdFx0fVxuXHRcdFx0fTtcblxuXHRcdFx0YXJncy5kYXRhID0gSlNPTi5zZXJpYWxpemUoe1xuXHRcdFx0XHRpZDogYXJncy5pZCB8fCAnYycgKyAodGhpcy5jb3VudCsrKSxcblx0XHRcdFx0bWV0aG9kOiBhcmdzLm1ldGhvZCxcblx0XHRcdFx0cGFyYW1zOiBhcmdzLnBhcmFtc1xuXHRcdFx0fSk7XG5cblx0XHRcdC8vIEpTT04gY29udGVudCB0eXBlIGZvciBSdWJ5IG9uIHJhaWxzLiBCdWc6ICMxODgzMjg3XG5cdFx0XHRhcmdzLmNvbnRlbnRfdHlwZSA9ICdhcHBsaWNhdGlvbi9qc29uJztcblxuXHRcdFx0WEhSLnNlbmQoYXJncyk7XG5cdFx0fVxuXHR9O1xuXG5cdHJldHVybiBKU09OUmVxdWVzdDtcbn0pO1xuXG4vLyBJbmNsdWRlZCBmcm9tOiBqcy90aW55bWNlL2NsYXNzZXMvdXRpbC9KU09OUC5qc1xuXG4vKipcbiAqIEpTT05QLmpzXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgTEdQTCBMaWNlbnNlLlxuICogQ29weXJpZ2h0IChjKSAxOTk5LTIwMTUgRXBob3ggQ29ycC4gQWxsIHJpZ2h0cyByZXNlcnZlZFxuICpcbiAqIExpY2Vuc2U6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vbGljZW5zZVxuICogQ29udHJpYnV0aW5nOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2NvbnRyaWJ1dGluZ1xuICovXG5cbmRlZmluZShcInRpbnltY2UvdXRpbC9KU09OUFwiLCBbXG5cdFwidGlueW1jZS9kb20vRE9NVXRpbHNcIlxuXSwgZnVuY3Rpb24oRE9NVXRpbHMpIHtcblx0cmV0dXJuIHtcblx0XHRjYWxsYmFja3M6IHt9LFxuXHRcdGNvdW50OiAwLFxuXG5cdFx0c2VuZDogZnVuY3Rpb24oc2V0dGluZ3MpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgZG9tID0gRE9NVXRpbHMuRE9NLCBjb3VudCA9IHNldHRpbmdzLmNvdW50ICE9PSB1bmRlZmluZWQgPyBzZXR0aW5ncy5jb3VudCA6IHNlbGYuY291bnQ7XG5cdFx0XHR2YXIgaWQgPSAndGlueW1jZV9qc29ucF8nICsgY291bnQ7XG5cblx0XHRcdHNlbGYuY2FsbGJhY2tzW2NvdW50XSA9IGZ1bmN0aW9uKGpzb24pIHtcblx0XHRcdFx0ZG9tLnJlbW92ZShpZCk7XG5cdFx0XHRcdGRlbGV0ZSBzZWxmLmNhbGxiYWNrc1tjb3VudF07XG5cblx0XHRcdFx0c2V0dGluZ3MuY2FsbGJhY2soanNvbik7XG5cdFx0XHR9O1xuXG5cdFx0XHRkb20uYWRkKGRvbS5kb2MuYm9keSwgJ3NjcmlwdCcsIHtcblx0XHRcdFx0aWQ6IGlkLFxuXHRcdFx0XHRzcmM6IHNldHRpbmdzLnVybCxcblx0XHRcdFx0dHlwZTogJ3RleHQvamF2YXNjcmlwdCdcblx0XHRcdH0pO1xuXG5cdFx0XHRzZWxmLmNvdW50Kys7XG5cdFx0fVxuXHR9O1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy91dGlsL0xvY2FsU3RvcmFnZS5qc1xuXG4vKipcbiAqIExvY2FsU3RvcmFnZS5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE1IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKipcbiAqIFRoaXMgY2xhc3Mgd2lsbCBzaW11bGF0ZSBMb2NhbFN0b3JhZ2Ugb24gSUUgNyBhbmQgcmV0dXJuIHRoZSBuYXRpdmUgdmVyc2lvbiBvbiBtb2Rlcm4gYnJvd3NlcnMuXG4gKiBTdG9yYWdlIGlzIGRvbmUgdXNpbmcgdXNlckRhdGEgb24gSUUgNyBhbmQgYSBzcGVjaWFsIHNlcmlhbGl6YXRpb24gZm9ybWF0LiBUaGUgZm9ybWF0IGlzIGRlc2lnbmVkXG4gKiB0byBiZSBhcyBzbWFsbCBhcyBwb3NzaWJsZSBieSBtYWtpbmcgc3VyZSB0aGF0IHRoZSBrZXlzIGFuZCB2YWx1ZXMgZG9lc24ndCBuZWVkIHRvIGJlIGVuY29kZWQuIFRoaXNcbiAqIG1ha2VzIGl0IHBvc3NpYmxlIHRvIHN0b3JlIGZvciBleGFtcGxlIEhUTUwgZGF0YS5cbiAqXG4gKiBTdG9yYWdlIGZvcm1hdCBmb3IgdXNlckRhdGE6XG4gKiA8YmFzZSAzMiBrZXkgbGVuZ3RoPiw8a2V5IHN0cmluZz4sPGJhc2UgMzIgdmFsdWUgbGVuZ3RoPiw8dmFsdWU+LC4uLlxuICpcbiAqIEZvciBleGFtcGxlIHRoaXMgZGF0YSBrZXkxPXZhbHVlMSxrZXkyPXZhbHVlMiB3b3VsZCBiZTpcbiAqIDQsa2V5MSw2LHZhbHVlMSw0LGtleTIsNix2YWx1ZTJcbiAqXG4gKiBAY2xhc3MgdGlueW1jZS51dGlsLkxvY2FsU3RvcmFnZVxuICogQHN0YXRpY1xuICogQHZlcnNpb24gNC4wXG4gKiBAZXhhbXBsZVxuICogdGlueW1jZS51dGlsLkxvY2FsU3RvcmFnZS5zZXRJdGVtKCdrZXknLCAndmFsdWUnKTtcbiAqIHZhciB2YWx1ZSA9IHRpbnltY2UudXRpbC5Mb2NhbFN0b3JhZ2UuZ2V0SXRlbSgna2V5Jyk7XG4gKi9cbmRlZmluZShcInRpbnltY2UvdXRpbC9Mb2NhbFN0b3JhZ2VcIiwgW10sIGZ1bmN0aW9uKCkge1xuXHR2YXIgTG9jYWxTdG9yYWdlLCBzdG9yYWdlRWxtLCBpdGVtcywga2V5cywgdXNlckRhdGFLZXksIGhhc09sZElFRGF0YVN1cHBvcnQ7XG5cblx0Ly8gQ2hlY2sgZm9yIG5hdGl2ZSBzdXBwb3J0XG5cdHRyeSB7XG5cdFx0aWYgKHdpbmRvdy5sb2NhbFN0b3JhZ2UpIHtcblx0XHRcdHJldHVybiBsb2NhbFN0b3JhZ2U7XG5cdFx0fVxuXHR9IGNhdGNoIChleCkge1xuXHRcdC8vIElnbm9yZVxuXHR9XG5cblx0dXNlckRhdGFLZXkgPSBcInRpbnltY2VcIjtcblx0c3RvcmFnZUVsbSA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDtcblx0aGFzT2xkSUVEYXRhU3VwcG9ydCA9ICEhc3RvcmFnZUVsbS5hZGRCZWhhdmlvcjtcblxuXHRpZiAoaGFzT2xkSUVEYXRhU3VwcG9ydCkge1xuXHRcdHN0b3JhZ2VFbG0uYWRkQmVoYXZpb3IoJyNkZWZhdWx0I3VzZXJEYXRhJyk7XG5cdH1cblxuXHQvKipcblx0ICogR2V0cyB0aGUga2V5cyBuYW1lcyBhbmQgdXBkYXRlcyBMb2NhbFN0b3JhZ2UubGVuZ3RoIHByb3BlcnR5LiBTaW5jZSBJRTcgZG9lc24ndCBoYXZlIGFueSBnZXR0ZXJzL3NldHRlcnMuXG5cdCAqL1xuXHRmdW5jdGlvbiB1cGRhdGVLZXlzKCkge1xuXHRcdGtleXMgPSBbXTtcblxuXHRcdGZvciAodmFyIGtleSBpbiBpdGVtcykge1xuXHRcdFx0a2V5cy5wdXNoKGtleSk7XG5cdFx0fVxuXG5cdFx0TG9jYWxTdG9yYWdlLmxlbmd0aCA9IGtleXMubGVuZ3RoO1xuXHR9XG5cblx0LyoqXG5cdCAqIExvYWRzIHRoZSB1c2VyRGF0YSBzdHJpbmcgYW5kIHBhcnNlcyBpdCBpbnRvIHRoZSBpdGVtcyBzdHJ1Y3R1cmUuXG5cdCAqL1xuXHRmdW5jdGlvbiBsb2FkKCkge1xuXHRcdHZhciBrZXksIGRhdGEsIHZhbHVlLCBwb3MgPSAwO1xuXG5cdFx0aXRlbXMgPSB7fTtcblxuXHRcdC8vIGxvY2FsU3RvcmFnZSBjYW4gYmUgZGlzYWJsZWQgb24gV2ViS2l0L0dlY2tvIHNvIG1ha2UgYSBkdW1teSBzdG9yYWdlXG5cdFx0aWYgKCFoYXNPbGRJRURhdGFTdXBwb3J0KSB7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gbmV4dChlbmQpIHtcblx0XHRcdHZhciB2YWx1ZSwgbmV4dFBvcztcblxuXHRcdFx0bmV4dFBvcyA9IGVuZCAhPT0gdW5kZWZpbmVkID8gcG9zICsgZW5kIDogZGF0YS5pbmRleE9mKCcsJywgcG9zKTtcblx0XHRcdGlmIChuZXh0UG9zID09PSAtMSB8fCBuZXh0UG9zID4gZGF0YS5sZW5ndGgpIHtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cblx0XHRcdHZhbHVlID0gZGF0YS5zdWJzdHJpbmcocG9zLCBuZXh0UG9zKTtcblx0XHRcdHBvcyA9IG5leHRQb3MgKyAxO1xuXG5cdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0fVxuXG5cdFx0c3RvcmFnZUVsbS5sb2FkKHVzZXJEYXRhS2V5KTtcblx0XHRkYXRhID0gc3RvcmFnZUVsbS5nZXRBdHRyaWJ1dGUodXNlckRhdGFLZXkpIHx8ICcnO1xuXG5cdFx0ZG8ge1xuXHRcdFx0dmFyIG9mZnNldCA9IG5leHQoKTtcblx0XHRcdGlmIChvZmZzZXQgPT09IG51bGwpIHtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHR9XG5cblx0XHRcdGtleSA9IG5leHQocGFyc2VJbnQob2Zmc2V0LCAzMikgfHwgMCk7XG5cdFx0XHRpZiAoa2V5ICE9PSBudWxsKSB7XG5cdFx0XHRcdG9mZnNldCA9IG5leHQoKTtcblx0XHRcdFx0aWYgKG9mZnNldCA9PT0gbnVsbCkge1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0dmFsdWUgPSBuZXh0KHBhcnNlSW50KG9mZnNldCwgMzIpIHx8IDApO1xuXG5cdFx0XHRcdGlmIChrZXkpIHtcblx0XHRcdFx0XHRpdGVtc1trZXldID0gdmFsdWU7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9IHdoaWxlIChrZXkgIT09IG51bGwpO1xuXG5cdFx0dXBkYXRlS2V5cygpO1xuXHR9XG5cblx0LyoqXG5cdCAqIFNhdmVzIHRoZSBpdGVtcyBzdHJ1Y3R1cmUgaW50byBhIHRoZSB1c2VyRGF0YSBmb3JtYXQuXG5cdCAqL1xuXHRmdW5jdGlvbiBzYXZlKCkge1xuXHRcdHZhciB2YWx1ZSwgZGF0YSA9ICcnO1xuXG5cdFx0Ly8gbG9jYWxTdG9yYWdlIGNhbiBiZSBkaXNhYmxlZCBvbiBXZWJLaXQvR2Vja28gc28gbWFrZSBhIGR1bW15IHN0b3JhZ2Vcblx0XHRpZiAoIWhhc09sZElFRGF0YVN1cHBvcnQpIHtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHRmb3IgKHZhciBrZXkgaW4gaXRlbXMpIHtcblx0XHRcdHZhbHVlID0gaXRlbXNba2V5XTtcblx0XHRcdGRhdGEgKz0gKGRhdGEgPyAnLCcgOiAnJykgKyBrZXkubGVuZ3RoLnRvU3RyaW5nKDMyKSArICcsJyArIGtleSArICcsJyArIHZhbHVlLmxlbmd0aC50b1N0cmluZygzMikgKyAnLCcgKyB2YWx1ZTtcblx0XHR9XG5cblx0XHRzdG9yYWdlRWxtLnNldEF0dHJpYnV0ZSh1c2VyRGF0YUtleSwgZGF0YSk7XG5cblx0XHR0cnkge1xuXHRcdFx0c3RvcmFnZUVsbS5zYXZlKHVzZXJEYXRhS2V5KTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0Ly8gSWdub3JlIGRpc2sgZnVsbFxuXHRcdH1cblxuXHRcdHVwZGF0ZUtleXMoKTtcblx0fVxuXG5cdExvY2FsU3RvcmFnZSA9IHtcblx0XHQvKipcblx0XHQgKiBMZW5ndGggb2YgdGhlIG51bWJlciBvZiBpdGVtcyBpbiBzdG9yYWdlLlxuXHRcdCAqXG5cdFx0ICogQHByb3BlcnR5IGxlbmd0aFxuXHRcdCAqIEB0eXBlIE51bWJlclxuXHRcdCAqIEByZXR1cm4ge051bWJlcn0gTnVtYmVyIG9mIGl0ZW1zIGluIHN0b3JhZ2UuXG5cdFx0ICovXG5cdFx0Ly9sZW5ndGg6MCxcblxuXHRcdC8qKlxuXHRcdCAqIFJldHVybnMgdGhlIGtleSBuYW1lIGJ5IGluZGV4LlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBrZXlcblx0XHQgKiBAcGFyYW0ge051bWJlcn0gaW5kZXggSW5kZXggb2Yga2V5IHRvIHJldHVybi5cblx0XHQgKiBAcmV0dXJuIHtTdHJpbmd9IEtleSB2YWx1ZSBvciBudWxsIGlmIGl0IHdhc24ndCBmb3VuZC5cblx0XHQgKi9cblx0XHRrZXk6IGZ1bmN0aW9uKGluZGV4KSB7XG5cdFx0XHRyZXR1cm4ga2V5c1tpbmRleF07XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFJldHVybnMgdGhlIHZhbHVlIGlmIHRoZSBzcGVjaWZpZWQga2V5IG9yIG51bGwgaWYgaXQgd2Fzbid0IGZvdW5kLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBnZXRJdGVtXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IGtleSBLZXkgb2YgaXRlbSB0byByZXRyaWV2ZS5cblx0XHQgKiBAcmV0dXJuIHtTdHJpbmd9IFZhbHVlIG9mIHRoZSBzcGVjaWZpZWQgaXRlbSBvciBudWxsIGlmIGl0IHdhc24ndCBmb3VuZC5cblx0XHQgKi9cblx0XHRnZXRJdGVtOiBmdW5jdGlvbihrZXkpIHtcblx0XHRcdHJldHVybiBrZXkgaW4gaXRlbXMgPyBpdGVtc1trZXldIDogbnVsbDtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogU2V0cyB0aGUgdmFsdWUgb2YgdGhlIHNwZWNpZmllZCBpdGVtIGJ5IGl0J3Mga2V5LlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBzZXRJdGVtXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IGtleSBLZXkgb2YgdGhlIGl0ZW0gdG8gc2V0LlxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSB2YWx1ZSBWYWx1ZSBvZiB0aGUgaXRlbSB0byBzZXQuXG5cdFx0ICovXG5cdFx0c2V0SXRlbTogZnVuY3Rpb24oa2V5LCB2YWx1ZSkge1xuXHRcdFx0aXRlbXNba2V5XSA9IFwiXCIgKyB2YWx1ZTtcblx0XHRcdHNhdmUoKTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmVtb3ZlcyB0aGUgc3BlY2lmaWVkIGl0ZW0gYnkga2V5LlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCByZW1vdmVJdGVtXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IGtleSBLZXkgb2YgaXRlbSB0byByZW1vdmUuXG5cdFx0ICovXG5cdFx0cmVtb3ZlSXRlbTogZnVuY3Rpb24oa2V5KSB7XG5cdFx0XHRkZWxldGUgaXRlbXNba2V5XTtcblx0XHRcdHNhdmUoKTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmVtb3ZlcyBhbGwgaXRlbXMuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGNsZWFyXG5cdFx0ICovXG5cdFx0Y2xlYXI6IGZ1bmN0aW9uKCkge1xuXHRcdFx0aXRlbXMgPSB7fTtcblx0XHRcdHNhdmUoKTtcblx0XHR9XG5cdH07XG5cblx0bG9hZCgpO1xuXG5cdHJldHVybiBMb2NhbFN0b3JhZ2U7XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL0NvbXBhdC5qc1xuXG4vKipcbiAqIENvbXBhdC5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE1IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKipcbiAqIFRpbnlNQ0UgY29yZSBjbGFzcy5cbiAqXG4gKiBAc3RhdGljXG4gKiBAY2xhc3MgdGlueW1jZVxuICogQGJvcnJvdy1tZW1iZXJzIHRpbnltY2UuRWRpdG9yTWFuYWdlclxuICogQGJvcnJvdy1tZW1iZXJzIHRpbnltY2UudXRpbC5Ub29sc1xuICovXG5kZWZpbmUoXCJ0aW55bWNlL0NvbXBhdFwiLCBbXG5cdFwidGlueW1jZS9kb20vRE9NVXRpbHNcIixcblx0XCJ0aW55bWNlL2RvbS9FdmVudFV0aWxzXCIsXG5cdFwidGlueW1jZS9kb20vU2NyaXB0TG9hZGVyXCIsXG5cdFwidGlueW1jZS9BZGRPbk1hbmFnZXJcIixcblx0XCJ0aW55bWNlL3V0aWwvVG9vbHNcIixcblx0XCJ0aW55bWNlL0VudlwiXG5dLCBmdW5jdGlvbihET01VdGlscywgRXZlbnRVdGlscywgU2NyaXB0TG9hZGVyLCBBZGRPbk1hbmFnZXIsIFRvb2xzLCBFbnYpIHtcblx0dmFyIHRpbnltY2UgPSB3aW5kb3cudGlueW1jZTtcblxuXHQvKipcblx0ICogQHByb3BlcnR5IHt0aW55bWNlLmRvbS5ET01VdGlsc30gRE9NIEdsb2JhbCBET00gaW5zdGFuY2UuXG5cdCAqIEBwcm9wZXJ0eSB7dGlueW1jZS5kb20uU2NyaXB0TG9hZGVyfSBTY3JpcHRMb2FkZXIgR2xvYmFsIFNjcmlwdExvYWRlciBpbnN0YW5jZS5cblx0ICogQHByb3BlcnR5IHt0aW55bWNlLkFkZE9uTWFuYWdlcn0gUGx1Z2luTWFuYWdlciBHbG9iYWwgUGx1Z2luTWFuYWdlciBpbnN0YW5jZS5cblx0ICogQHByb3BlcnR5IHt0aW55bWNlLkFkZE9uTWFuYWdlcn0gVGhlbWVNYW5hZ2VyIEdsb2JhbCBUaGVtZU1hbmFnZXIgaW5zdGFuY2UuXG5cdCAqL1xuXHR0aW55bWNlLkRPTSA9IERPTVV0aWxzLkRPTTtcblx0dGlueW1jZS5TY3JpcHRMb2FkZXIgPSBTY3JpcHRMb2FkZXIuU2NyaXB0TG9hZGVyO1xuXHR0aW55bWNlLlBsdWdpbk1hbmFnZXIgPSBBZGRPbk1hbmFnZXIuUGx1Z2luTWFuYWdlcjtcblx0dGlueW1jZS5UaGVtZU1hbmFnZXIgPSBBZGRPbk1hbmFnZXIuVGhlbWVNYW5hZ2VyO1xuXG5cdHRpbnltY2UuZG9tID0gdGlueW1jZS5kb20gfHwge307XG5cdHRpbnltY2UuZG9tLkV2ZW50ID0gRXZlbnRVdGlscy5FdmVudDtcblxuXHRUb29scy5lYWNoKFxuXHRcdCd0cmltIGlzQXJyYXkgaXMgdG9BcnJheSBtYWtlTWFwIGVhY2ggbWFwIGdyZXAgaW5BcnJheSBleHRlbmQgY3JlYXRlIHdhbGsgY3JlYXRlTlMgcmVzb2x2ZSBleHBsb2RlIF9hZGRDYWNoZVN1ZmZpeCcuc3BsaXQoJyAnKSxcblx0XHRmdW5jdGlvbihrZXkpIHtcblx0XHRcdHRpbnltY2Vba2V5XSA9IFRvb2xzW2tleV07XG5cdFx0fVxuXHQpO1xuXG5cdFRvb2xzLmVhY2goJ2lzT3BlcmEgaXNXZWJLaXQgaXNJRSBpc0dlY2tvIGlzTWFjJy5zcGxpdCgnICcpLCBmdW5jdGlvbihuYW1lKSB7XG5cdFx0dGlueW1jZVtuYW1lXSA9IEVudltuYW1lLnN1YnN0cigyKS50b0xvd2VyQ2FzZSgpXTtcblx0fSk7XG5cblx0cmV0dXJuIHt9O1xufSk7XG5cbi8vIERlc2NyaWJlIHRoZSBkaWZmZXJlbnQgbmFtZXNwYWNlc1xuXG4vKipcbiAqIFJvb3QgbGV2ZWwgbmFtZXNwYWNlIHRoaXMgY29udGFpbnMgY2xhc3NlcyBkaXJlY3RseSByZWxhdGVkIHRvIHRoZSBUaW55TUNFIGVkaXRvci5cbiAqXG4gKiBAbmFtZXNwYWNlIHRpbnltY2VcbiAqL1xuXG4vKipcbiAqIENvbnRhaW5zIGNsYXNzZXMgZm9yIGhhbmRsaW5nIHRoZSBicm93c2VycyBET00uXG4gKlxuICogQG5hbWVzcGFjZSB0aW55bWNlLmRvbVxuICovXG5cbi8qKlxuICogQ29udGFpbnMgaHRtbCBwYXJzZXIgYW5kIHNlcmlhbGl6ZXIgbG9naWMuXG4gKlxuICogQG5hbWVzcGFjZSB0aW55bWNlLmh0bWxcbiAqL1xuXG4vKipcbiAqIENvbnRhaW5zIHRoZSBkaWZmZXJlbnQgVUkgdHlwZXMgc3VjaCBhcyBidXR0b25zLCBsaXN0Ym94ZXMgZXRjLlxuICpcbiAqIEBuYW1lc3BhY2UgdGlueW1jZS51aVxuICovXG5cbi8qKlxuICogQ29udGFpbnMgdmFyaW91cyB1dGlsaXR5IGNsYXNzZXMgc3VjaCBhcyBqc29uIHBhcnNlciwgY29va2llcyBldGMuXG4gKlxuICogQG5hbWVzcGFjZSB0aW55bWNlLnV0aWxcbiAqL1xuXG4vKipcbiAqIENvbnRhaW5zIG1vZHVsZXMgdG8gaGFuZGxlIGRhdGEgYmluZGluZy5cbiAqXG4gKiBAbmFtZXNwYWNlIHRpbnltY2UuZGF0YVxuICovXG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy91aS9MYXlvdXQuanNcblxuLyoqXG4gKiBMYXlvdXQuanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBCYXNlIGxheW91dCBtYW5hZ2VyIGNsYXNzLlxuICpcbiAqIEBjbGFzcyB0aW55bWNlLnVpLkxheW91dFxuICovXG5kZWZpbmUoXCJ0aW55bWNlL3VpL0xheW91dFwiLCBbXG5cdFwidGlueW1jZS91dGlsL0NsYXNzXCIsXG5cdFwidGlueW1jZS91dGlsL1Rvb2xzXCJcbl0sIGZ1bmN0aW9uKENsYXNzLCBUb29scykge1xuXHRcInVzZSBzdHJpY3RcIjtcblxuXHRyZXR1cm4gQ2xhc3MuZXh0ZW5kKHtcblx0XHREZWZhdWx0czoge1xuXHRcdFx0Zmlyc3RDb250cm9sQ2xhc3M6ICdmaXJzdCcsXG5cdFx0XHRsYXN0Q29udHJvbENsYXNzOiAnbGFzdCdcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogQ29uc3RydWN0cyBhIGxheW91dCBpbnN0YW5jZSB3aXRoIHRoZSBzcGVjaWZpZWQgc2V0dGluZ3MuXG5cdFx0ICpcblx0XHQgKiBAY29uc3RydWN0b3Jcblx0XHQgKiBAcGFyYW0ge09iamVjdH0gc2V0dGluZ3MgTmFtZS92YWx1ZSBvYmplY3Qgd2l0aCBzZXR0aW5ncy5cblx0XHQgKi9cblx0XHRpbml0OiBmdW5jdGlvbihzZXR0aW5ncykge1xuXHRcdFx0dGhpcy5zZXR0aW5ncyA9IFRvb2xzLmV4dGVuZCh7fSwgdGhpcy5EZWZhdWx0cywgc2V0dGluZ3MpO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBUaGlzIG1ldGhvZCBnZXRzIGludm9rZWQgYmVmb3JlIHRoZSBsYXlvdXQgcmVuZGVycyB0aGUgY29udHJvbHMuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHByZVJlbmRlclxuXHRcdCAqIEBwYXJhbSB7dGlueW1jZS51aS5Db250YWluZXJ9IGNvbnRhaW5lciBDb250YWluZXIgaW5zdGFuY2UgdG8gcHJlUmVuZGVyLlxuXHRcdCAqL1xuXHRcdHByZVJlbmRlcjogZnVuY3Rpb24oY29udGFpbmVyKSB7XG5cdFx0XHRjb250YWluZXIuYm9keUNsYXNzZXMuYWRkKHRoaXMuc2V0dGluZ3MuY29udGFpbmVyQ2xhc3MpO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBBcHBsaWVzIGxheW91dCBjbGFzc2VzIHRvIHRoZSBjb250YWluZXIuXG5cdFx0ICpcblx0XHQgKiBAcHJpdmF0ZVxuXHRcdCAqL1xuXHRcdGFwcGx5Q2xhc3NlczogZnVuY3Rpb24oaXRlbXMpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgc2V0dGluZ3MgPSBzZWxmLnNldHRpbmdzLCBmaXJzdENsYXNzLCBsYXN0Q2xhc3MsIGZpcnN0SXRlbSwgbGFzdEl0ZW07XG5cblx0XHRcdGZpcnN0Q2xhc3MgPSBzZXR0aW5ncy5maXJzdENvbnRyb2xDbGFzcztcblx0XHRcdGxhc3RDbGFzcyA9IHNldHRpbmdzLmxhc3RDb250cm9sQ2xhc3M7XG5cblx0XHRcdGl0ZW1zLmVhY2goZnVuY3Rpb24oaXRlbSkge1xuXHRcdFx0XHRpdGVtLmNsYXNzZXMucmVtb3ZlKGZpcnN0Q2xhc3MpLnJlbW92ZShsYXN0Q2xhc3MpLmFkZChzZXR0aW5ncy5jb250cm9sQ2xhc3MpO1xuXG5cdFx0XHRcdGlmIChpdGVtLnZpc2libGUoKSkge1xuXHRcdFx0XHRcdGlmICghZmlyc3RJdGVtKSB7XG5cdFx0XHRcdFx0XHRmaXJzdEl0ZW0gPSBpdGVtO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGxhc3RJdGVtID0gaXRlbTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdGlmIChmaXJzdEl0ZW0pIHtcblx0XHRcdFx0Zmlyc3RJdGVtLmNsYXNzZXMuYWRkKGZpcnN0Q2xhc3MpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAobGFzdEl0ZW0pIHtcblx0XHRcdFx0bGFzdEl0ZW0uY2xhc3Nlcy5hZGQobGFzdENsYXNzKTtcblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmVuZGVycyB0aGUgc3BlY2lmaWVkIGNvbnRhaW5lciBhbmQgYW55IGxheW91dCBzcGVjaWZpYyBIVE1MLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCByZW5kZXJIdG1sXG5cdFx0ICogQHBhcmFtIHt0aW55bWNlLnVpLkNvbnRhaW5lcn0gY29udGFpbmVyIENvbnRhaW5lciB0byByZW5kZXIgSFRNTCBmb3IuXG5cdFx0ICovXG5cdFx0cmVuZGVySHRtbDogZnVuY3Rpb24oY29udGFpbmVyKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIGh0bWwgPSAnJztcblxuXHRcdFx0c2VsZi5hcHBseUNsYXNzZXMoY29udGFpbmVyLml0ZW1zKCkpO1xuXG5cdFx0XHRjb250YWluZXIuaXRlbXMoKS5lYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcblx0XHRcdFx0aHRtbCArPSBpdGVtLnJlbmRlckh0bWwoKTtcblx0XHRcdH0pO1xuXG5cdFx0XHRyZXR1cm4gaHRtbDtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmVjYWxjdWxhdGVzIHRoZSBwb3NpdGlvbnMgb2YgdGhlIGNvbnRyb2xzIGluIHRoZSBzcGVjaWZpZWQgY29udGFpbmVyLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCByZWNhbGNcblx0XHQgKiBAcGFyYW0ge3RpbnltY2UudWkuQ29udGFpbmVyfSBjb250YWluZXIgQ29udGFpbmVyIGluc3RhbmNlIHRvIHJlY2FsYy5cblx0XHQgKi9cblx0XHRyZWNhbGM6IGZ1bmN0aW9uKCkge1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBUaGlzIG1ldGhvZCBnZXRzIGludm9rZWQgYWZ0ZXIgdGhlIGxheW91dCByZW5kZXJzIHRoZSBjb250cm9scy5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgcG9zdFJlbmRlclxuXHRcdCAqIEBwYXJhbSB7dGlueW1jZS51aS5Db250YWluZXJ9IGNvbnRhaW5lciBDb250YWluZXIgaW5zdGFuY2UgdG8gcG9zdFJlbmRlci5cblx0XHQgKi9cblx0XHRwb3N0UmVuZGVyOiBmdW5jdGlvbigpIHtcblx0XHR9LFxuXG5cdFx0aXNOYXRpdmU6IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblx0fSk7XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL3VpL0Fic29sdXRlTGF5b3V0LmpzXG5cbi8qKlxuICogQWJzb2x1dGVMYXlvdXQuanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBMYXlvdXRNYW5hZ2VyIGZvciBhYnNvbHV0ZSBwb3NpdGlvbmluZy4gVGhpcyBsYXlvdXQgbWFuYWdlciBpcyBtb3JlIG9mXG4gKiBhIGJhc2UgY2xhc3MgZm9yIG90aGVyIGxheW91dHMgYnV0IGNhbiBiZSBjcmVhdGVkIGFuZCB1c2VkIGRpcmVjdGx5LlxuICpcbiAqIEAteC1sZXNzIEFic29sdXRlTGF5b3V0Lmxlc3NcbiAqIEBjbGFzcyB0aW55bWNlLnVpLkFic29sdXRlTGF5b3V0XG4gKiBAZXh0ZW5kcyB0aW55bWNlLnVpLkxheW91dFxuICovXG5kZWZpbmUoXCJ0aW55bWNlL3VpL0Fic29sdXRlTGF5b3V0XCIsIFtcblx0XCJ0aW55bWNlL3VpL0xheW91dFwiXG5dLCBmdW5jdGlvbihMYXlvdXQpIHtcblx0XCJ1c2Ugc3RyaWN0XCI7XG5cblx0cmV0dXJuIExheW91dC5leHRlbmQoe1xuXHRcdERlZmF1bHRzOiB7XG5cdFx0XHRjb250YWluZXJDbGFzczogJ2Ficy1sYXlvdXQnLFxuXHRcdFx0Y29udHJvbENsYXNzOiAnYWJzLWxheW91dC1pdGVtJ1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZWNhbGN1bGF0ZXMgdGhlIHBvc2l0aW9ucyBvZiB0aGUgY29udHJvbHMgaW4gdGhlIHNwZWNpZmllZCBjb250YWluZXIuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHJlY2FsY1xuXHRcdCAqIEBwYXJhbSB7dGlueW1jZS51aS5Db250YWluZXJ9IGNvbnRhaW5lciBDb250YWluZXIgaW5zdGFuY2UgdG8gcmVjYWxjLlxuXHRcdCAqL1xuXHRcdHJlY2FsYzogZnVuY3Rpb24oY29udGFpbmVyKSB7XG5cdFx0XHRjb250YWluZXIuaXRlbXMoKS5maWx0ZXIoJzp2aXNpYmxlJykuZWFjaChmdW5jdGlvbihjdHJsKSB7XG5cdFx0XHRcdHZhciBzZXR0aW5ncyA9IGN0cmwuc2V0dGluZ3M7XG5cblx0XHRcdFx0Y3RybC5sYXlvdXRSZWN0KHtcblx0XHRcdFx0XHR4OiBzZXR0aW5ncy54LFxuXHRcdFx0XHRcdHk6IHNldHRpbmdzLnksXG5cdFx0XHRcdFx0dzogc2V0dGluZ3Mudyxcblx0XHRcdFx0XHRoOiBzZXR0aW5ncy5oXG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdGlmIChjdHJsLnJlY2FsYykge1xuXHRcdFx0XHRcdGN0cmwucmVjYWxjKCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZW5kZXJzIHRoZSBzcGVjaWZpZWQgY29udGFpbmVyIGFuZCBhbnkgbGF5b3V0IHNwZWNpZmljIEhUTUwuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHJlbmRlckh0bWxcblx0XHQgKiBAcGFyYW0ge3RpbnltY2UudWkuQ29udGFpbmVyfSBjb250YWluZXIgQ29udGFpbmVyIHRvIHJlbmRlciBIVE1MIGZvci5cblx0XHQgKi9cblx0XHRyZW5kZXJIdG1sOiBmdW5jdGlvbihjb250YWluZXIpIHtcblx0XHRcdHJldHVybiAnPGRpdiBpZD1cIicgKyBjb250YWluZXIuX2lkICsgJy1hYnNlbmRcIiBjbGFzcz1cIicgKyBjb250YWluZXIuY2xhc3NQcmVmaXggKyAnYWJzLWVuZFwiPjwvZGl2PicgKyB0aGlzLl9zdXBlcihjb250YWluZXIpO1xuXHRcdH1cblx0fSk7XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL3VpL0J1dHRvbi5qc1xuXG4vKipcbiAqIEJ1dHRvbi5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE1IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKipcbiAqIFRoaXMgY2xhc3MgaXMgdXNlZCB0byBjcmVhdGUgYnV0dG9ucy4gWW91IGNhbiBjcmVhdGUgdGhlbSBkaXJlY3RseSBvciB0aHJvdWdoIHRoZSBGYWN0b3J5LlxuICpcbiAqIEBleGFtcGxlXG4gKiAvLyBDcmVhdGUgYW5kIHJlbmRlciBhIGJ1dHRvbiB0byB0aGUgYm9keSBlbGVtZW50XG4gKiB0aW55bWNlLnVpLkZhY3RvcnkuY3JlYXRlKHtcbiAqICAgICB0eXBlOiAnYnV0dG9uJyxcbiAqICAgICB0ZXh0OiAnTXkgYnV0dG9uJ1xuICogfSkucmVuZGVyVG8oZG9jdW1lbnQuYm9keSk7XG4gKlxuICogQC14LWxlc3MgQnV0dG9uLmxlc3NcbiAqIEBjbGFzcyB0aW55bWNlLnVpLkJ1dHRvblxuICogQGV4dGVuZHMgdGlueW1jZS51aS5XaWRnZXRcbiAqL1xuZGVmaW5lKFwidGlueW1jZS91aS9CdXR0b25cIiwgW1xuXHRcInRpbnltY2UvdWkvV2lkZ2V0XCJcbl0sIGZ1bmN0aW9uKFdpZGdldCkge1xuXHRcInVzZSBzdHJpY3RcIjtcblxuXHRyZXR1cm4gV2lkZ2V0LmV4dGVuZCh7XG5cdFx0RGVmYXVsdHM6IHtcblx0XHRcdGNsYXNzZXM6IFwid2lkZ2V0IGJ0blwiLFxuXHRcdFx0cm9sZTogXCJidXR0b25cIlxuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBDb25zdHJ1Y3RzIGEgbmV3IGJ1dHRvbiBpbnN0YW5jZSB3aXRoIHRoZSBzcGVjaWZpZWQgc2V0dGluZ3MuXG5cdFx0ICpcblx0XHQgKiBAY29uc3RydWN0b3Jcblx0XHQgKiBAcGFyYW0ge09iamVjdH0gc2V0dGluZ3MgTmFtZS92YWx1ZSBvYmplY3Qgd2l0aCBzZXR0aW5ncy5cblx0XHQgKiBAc2V0dGluZyB7U3RyaW5nfSBzaXplIFNpemUgb2YgdGhlIGJ1dHRvbiBzbWFsbHxtZWRpdW18bGFyZ2UuXG5cdFx0ICogQHNldHRpbmcge1N0cmluZ30gaW1hZ2UgSW1hZ2UgdG8gdXNlIGZvciBpY29uLlxuXHRcdCAqIEBzZXR0aW5nIHtTdHJpbmd9IGljb24gSWNvbiB0byB1c2UgZm9yIGJ1dHRvbi5cblx0XHQgKi9cblx0XHRpbml0OiBmdW5jdGlvbihzZXR0aW5ncykge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLCBzaXplO1xuXG5cdFx0XHRzZWxmLl9zdXBlcihzZXR0aW5ncyk7XG5cdFx0XHRzZXR0aW5ncyA9IHNlbGYuc2V0dGluZ3M7XG5cblx0XHRcdHNpemUgPSBzZWxmLnNldHRpbmdzLnNpemU7XG5cblx0XHRcdHNlbGYub24oJ2NsaWNrIG1vdXNlZG93bicsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0fSk7XG5cblx0XHRcdHNlbGYub24oJ3RvdWNoc3RhcnQnLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdHNlbGYuZmlyZSgnY2xpY2snLCBlKTtcblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0fSk7XG5cblx0XHRcdGlmIChzZXR0aW5ncy5zdWJ0eXBlKSB7XG5cdFx0XHRcdHNlbGYuY2xhc3Nlcy5hZGQoc2V0dGluZ3Muc3VidHlwZSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChzaXplKSB7XG5cdFx0XHRcdHNlbGYuY2xhc3Nlcy5hZGQoJ2J0bi0nICsgc2l6ZSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChzZXR0aW5ncy5pY29uKSB7XG5cdFx0XHRcdHNlbGYuaWNvbihzZXR0aW5ncy5pY29uKTtcblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogU2V0cy9nZXRzIHRoZSBjdXJyZW50IGJ1dHRvbiBpY29uLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBpY29uXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IFtpY29uXSBOZXcgaWNvbiBpZGVudGlmaWVyLlxuXHRcdCAqIEByZXR1cm4ge1N0cmluZ3x0aW55bWNlLnVpLk1lbnVCdXR0b259IEN1cnJlbnQgaWNvbiBvciBjdXJyZW50IE1lbnVCdXR0b24gaW5zdGFuY2UuXG5cdFx0ICovXG5cdFx0aWNvbjogZnVuY3Rpb24oaWNvbikge1xuXHRcdFx0aWYgKCFhcmd1bWVudHMubGVuZ3RoKSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0YXRlLmdldCgnaWNvbicpO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLnN0YXRlLnNldCgnaWNvbicsIGljb24pO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmVwYWludHMgdGhlIGJ1dHRvbiBmb3IgZXhhbXBsZSBhZnRlciBpdCdzIGJlZW4gcmVzaXplcyBieSBhIGxheW91dCBlbmdpbmUuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHJlcGFpbnRcblx0XHQgKi9cblx0XHRyZXBhaW50OiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBidG5FbG0gPSB0aGlzLmdldEVsKCkuZmlyc3RDaGlsZCxcblx0XHRcdFx0YnRuU3R5bGU7XG5cblx0XHRcdGlmIChidG5FbG0pIHtcblx0XHRcdFx0YnRuU3R5bGUgPSBidG5FbG0uc3R5bGU7XG5cdFx0XHRcdGJ0blN0eWxlLndpZHRoID0gYnRuU3R5bGUuaGVpZ2h0ID0gXCIxMDAlXCI7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMuX3N1cGVyKCk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFJlbmRlcnMgdGhlIGNvbnRyb2wgYXMgYSBIVE1MIHN0cmluZy5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgcmVuZGVySHRtbFxuXHRcdCAqIEByZXR1cm4ge1N0cmluZ30gSFRNTCByZXByZXNlbnRpbmcgdGhlIGNvbnRyb2wuXG5cdFx0ICovXG5cdFx0cmVuZGVySHRtbDogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIGlkID0gc2VsZi5faWQsIHByZWZpeCA9IHNlbGYuY2xhc3NQcmVmaXg7XG5cdFx0XHR2YXIgaWNvbiA9IHNlbGYuc3RhdGUuZ2V0KCdpY29uJyksIGltYWdlLCB0ZXh0ID0gc2VsZi5zdGF0ZS5nZXQoJ3RleHQnKSwgdGV4dEh0bWwgPSAnJztcblxuXHRcdFx0aW1hZ2UgPSBzZWxmLnNldHRpbmdzLmltYWdlO1xuXHRcdFx0aWYgKGltYWdlKSB7XG5cdFx0XHRcdGljb24gPSAnbm9uZSc7XG5cblx0XHRcdFx0Ly8gU3VwcG9ydCBmb3IgW2hpZ2ggZHBpLCBsb3cgZHBpXSBpbWFnZSBzb3VyY2VzXG5cdFx0XHRcdGlmICh0eXBlb2YgaW1hZ2UgIT0gXCJzdHJpbmdcIikge1xuXHRcdFx0XHRcdGltYWdlID0gd2luZG93LmdldFNlbGVjdGlvbiA/IGltYWdlWzBdIDogaW1hZ2VbMV07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpbWFnZSA9ICcgc3R5bGU9XCJiYWNrZ3JvdW5kLWltYWdlOiB1cmwoXFwnJyArIGltYWdlICsgJ1xcJylcIic7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRpbWFnZSA9ICcnO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAodGV4dCkge1xuXHRcdFx0XHRzZWxmLmNsYXNzZXMuYWRkKCdidG4taGFzLXRleHQnKTtcblx0XHRcdFx0dGV4dEh0bWwgPSAnPHNwYW4gY2xhc3M9XCInICsgcHJlZml4ICsgJ3R4dFwiPicgKyBzZWxmLmVuY29kZSh0ZXh0KSArICc8L3NwYW4+Jztcblx0XHRcdH1cblxuXHRcdFx0aWNvbiA9IGljb24gPyBwcmVmaXggKyAnaWNvICcgKyBwcmVmaXggKyAnaS0nICsgaWNvbiA6ICcnO1xuXG5cdFx0XHRyZXR1cm4gKFxuXHRcdFx0XHQnPGRpdiBpZD1cIicgKyBpZCArICdcIiBjbGFzcz1cIicgKyBzZWxmLmNsYXNzZXMgKyAnXCIgdGFiaW5kZXg9XCItMVwiIGFyaWEtbGFiZWxsZWRieT1cIicgKyBpZCArICdcIj4nICtcblx0XHRcdFx0XHQnPGJ1dHRvbiByb2xlPVwicHJlc2VudGF0aW9uXCIgdHlwZT1cImJ1dHRvblwiIHRhYmluZGV4PVwiLTFcIj4nICtcblx0XHRcdFx0XHRcdChpY29uID8gJzxpIGNsYXNzPVwiJyArIGljb24gKyAnXCInICsgaW1hZ2UgKyAnPjwvaT4nIDogJycpICtcblx0XHRcdFx0XHRcdHRleHRIdG1sICtcblx0XHRcdFx0XHQnPC9idXR0b24+JyArXG5cdFx0XHRcdCc8L2Rpdj4nXG5cdFx0XHQpO1xuXHRcdH0sXG5cblx0XHRiaW5kU3RhdGVzOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgJCA9IHNlbGYuJCwgdGV4dENscyA9IHNlbGYuY2xhc3NQcmVmaXggKyAndHh0JztcblxuXHRcdFx0ZnVuY3Rpb24gc2V0QnV0dG9uVGV4dCh0ZXh0KSB7XG5cdFx0XHRcdHZhciAkc3BhbiA9ICQoJ3NwYW4uJyArIHRleHRDbHMsIHNlbGYuZ2V0RWwoKSk7XG5cblx0XHRcdFx0aWYgKHRleHQpIHtcblx0XHRcdFx0XHRpZiAoISRzcGFuWzBdKSB7XG5cdFx0XHRcdFx0XHQkKCdidXR0b246Zmlyc3QnLCBzZWxmLmdldEVsKCkpLmFwcGVuZCgnPHNwYW4gY2xhc3M9XCInICsgdGV4dENscyArICdcIj48L3NwYW4+Jyk7XG5cdFx0XHRcdFx0XHQkc3BhbiA9ICQoJ3NwYW4uJyArIHRleHRDbHMsIHNlbGYuZ2V0RWwoKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0JHNwYW4uaHRtbChzZWxmLmVuY29kZSh0ZXh0KSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0JHNwYW4ucmVtb3ZlKCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRzZWxmLmNsYXNzZXMudG9nZ2xlKCdidG4taGFzLXRleHQnLCAhIXRleHQpO1xuXHRcdFx0fVxuXG5cdFx0XHRzZWxmLnN0YXRlLm9uKCdjaGFuZ2U6dGV4dCcsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0c2V0QnV0dG9uVGV4dChlLnZhbHVlKTtcblx0XHRcdH0pO1xuXG5cdFx0XHRzZWxmLnN0YXRlLm9uKCdjaGFuZ2U6aWNvbicsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0dmFyIGljb24gPSBlLnZhbHVlLCBwcmVmaXggPSBzZWxmLmNsYXNzUHJlZml4O1xuXG5cdFx0XHRcdHNlbGYuc2V0dGluZ3MuaWNvbiA9IGljb247XG5cdFx0XHRcdGljb24gPSBpY29uID8gcHJlZml4ICsgJ2ljbyAnICsgcHJlZml4ICsgJ2ktJyArIHNlbGYuc2V0dGluZ3MuaWNvbiA6ICcnO1xuXG5cdFx0XHRcdHZhciBidG5FbG0gPSBzZWxmLmdldEVsKCkuZmlyc3RDaGlsZCwgaWNvbkVsbSA9IGJ0bkVsbS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaScpWzBdO1xuXG5cdFx0XHRcdGlmIChpY29uKSB7XG5cdFx0XHRcdFx0aWYgKCFpY29uRWxtIHx8IGljb25FbG0gIT0gYnRuRWxtLmZpcnN0Q2hpbGQpIHtcblx0XHRcdFx0XHRcdGljb25FbG0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpJyk7XG5cdFx0XHRcdFx0XHRidG5FbG0uaW5zZXJ0QmVmb3JlKGljb25FbG0sIGJ0bkVsbS5maXJzdENoaWxkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpY29uRWxtLmNsYXNzTmFtZSA9IGljb247XG5cdFx0XHRcdH0gZWxzZSBpZiAoaWNvbkVsbSkge1xuXHRcdFx0XHRcdGJ0bkVsbS5yZW1vdmVDaGlsZChpY29uRWxtKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHNldEJ1dHRvblRleHQoc2VsZi5zdGF0ZS5nZXQoJ3RleHQnKSk7XG5cdFx0XHR9KTtcblxuXHRcdFx0cmV0dXJuIHNlbGYuX3N1cGVyKCk7XG5cdFx0fVxuXHR9KTtcbn0pO1xuXG4vLyBJbmNsdWRlZCBmcm9tOiBqcy90aW55bWNlL2NsYXNzZXMvdWkvQnV0dG9uR3JvdXAuanNcblxuLyoqXG4gKiBCdXR0b25Hcm91cC5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE1IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKipcbiAqIFRoaXMgY29udHJvbCBlbmFibGVzIHlvdSB0byBwdXQgbXVsdGlwbGUgYnV0dG9ucyBpbnRvIGEgZ3JvdXAuIFRoaXMgaXNcbiAqIHVzZWZ1bCB3aGVuIHlvdSB3YW50IHRvIGNvbWJpbmUgc2ltaWxhciB0b29sYmFyIGJ1dHRvbnMgaW50byBhIGdyb3VwLlxuICpcbiAqIEBleGFtcGxlXG4gKiAvLyBDcmVhdGUgYW5kIHJlbmRlciBhIGJ1dHRvbmdyb3VwIHdpdGggdHdvIGJ1dHRvbnMgdG8gdGhlIGJvZHkgZWxlbWVudFxuICogdGlueW1jZS51aS5GYWN0b3J5LmNyZWF0ZSh7XG4gKiAgICAgdHlwZTogJ2J1dHRvbmdyb3VwJyxcbiAqICAgICBpdGVtczogW1xuICogICAgICAgICB7dGV4dDogJ0J1dHRvbiBBJ30sXG4gKiAgICAgICAgIHt0ZXh0OiAnQnV0dG9uIEInfVxuICogICAgIF1cbiAqIH0pLnJlbmRlclRvKGRvY3VtZW50LmJvZHkpO1xuICpcbiAqIEAteC1sZXNzIEJ1dHRvbkdyb3VwLmxlc3NcbiAqIEBjbGFzcyB0aW55bWNlLnVpLkJ1dHRvbkdyb3VwXG4gKiBAZXh0ZW5kcyB0aW55bWNlLnVpLkNvbnRhaW5lclxuICovXG5kZWZpbmUoXCJ0aW55bWNlL3VpL0J1dHRvbkdyb3VwXCIsIFtcblx0XCJ0aW55bWNlL3VpL0NvbnRhaW5lclwiXG5dLCBmdW5jdGlvbihDb250YWluZXIpIHtcblx0XCJ1c2Ugc3RyaWN0XCI7XG5cblx0cmV0dXJuIENvbnRhaW5lci5leHRlbmQoe1xuXHRcdERlZmF1bHRzOiB7XG5cdFx0XHRkZWZhdWx0VHlwZTogJ2J1dHRvbicsXG5cdFx0XHRyb2xlOiAnZ3JvdXAnXG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFJlbmRlcnMgdGhlIGNvbnRyb2wgYXMgYSBIVE1MIHN0cmluZy5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgcmVuZGVySHRtbFxuXHRcdCAqIEByZXR1cm4ge1N0cmluZ30gSFRNTCByZXByZXNlbnRpbmcgdGhlIGNvbnRyb2wuXG5cdFx0ICovXG5cdFx0cmVuZGVySHRtbDogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIGxheW91dCA9IHNlbGYuX2xheW91dDtcblxuXHRcdFx0c2VsZi5jbGFzc2VzLmFkZCgnYnRuLWdyb3VwJyk7XG5cdFx0XHRzZWxmLnByZVJlbmRlcigpO1xuXHRcdFx0bGF5b3V0LnByZVJlbmRlcihzZWxmKTtcblxuXHRcdFx0cmV0dXJuIChcblx0XHRcdFx0JzxkaXYgaWQ9XCInICsgc2VsZi5faWQgKyAnXCIgY2xhc3M9XCInICsgc2VsZi5jbGFzc2VzICsgJ1wiPicgK1xuXHRcdFx0XHRcdCc8ZGl2IGlkPVwiJyArIHNlbGYuX2lkICsgJy1ib2R5XCI+JyArXG5cdFx0XHRcdFx0XHQoc2VsZi5zZXR0aW5ncy5odG1sIHx8ICcnKSArIGxheW91dC5yZW5kZXJIdG1sKHNlbGYpICtcblx0XHRcdFx0XHQnPC9kaXY+JyArXG5cdFx0XHRcdCc8L2Rpdj4nXG5cdFx0XHQpO1xuXHRcdH1cblx0fSk7XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL3VpL0NoZWNrYm94LmpzXG5cbi8qKlxuICogQ2hlY2tib3guanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBUaGlzIGNvbnRyb2wgY3JlYXRlcyBhIGN1c3RvbSBjaGVja2JveC5cbiAqXG4gKiBAZXhhbXBsZVxuICogLy8gQ3JlYXRlIGFuZCByZW5kZXIgYSBjaGVja2JveCB0byB0aGUgYm9keSBlbGVtZW50XG4gKiB0aW55bWNlLnVpLkZhY3RvcnkuY3JlYXRlKHtcbiAqICAgICB0eXBlOiAnY2hlY2tib3gnLFxuICogICAgIGNoZWNrZWQ6IHRydWUsXG4gKiAgICAgdGV4dDogJ015IGNoZWNrYm94J1xuICogfSkucmVuZGVyVG8oZG9jdW1lbnQuYm9keSk7XG4gKlxuICogQC14LWxlc3MgQ2hlY2tib3gubGVzc1xuICogQGNsYXNzIHRpbnltY2UudWkuQ2hlY2tib3hcbiAqIEBleHRlbmRzIHRpbnltY2UudWkuV2lkZ2V0XG4gKi9cbmRlZmluZShcInRpbnltY2UvdWkvQ2hlY2tib3hcIiwgW1xuXHRcInRpbnltY2UvdWkvV2lkZ2V0XCJcbl0sIGZ1bmN0aW9uKFdpZGdldCkge1xuXHRcInVzZSBzdHJpY3RcIjtcblxuXHRyZXR1cm4gV2lkZ2V0LmV4dGVuZCh7XG5cdFx0RGVmYXVsdHM6IHtcblx0XHRcdGNsYXNzZXM6IFwiY2hlY2tib3hcIixcblx0XHRcdHJvbGU6IFwiY2hlY2tib3hcIixcblx0XHRcdGNoZWNrZWQ6IGZhbHNlXG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIENvbnN0cnVjdHMgYSBuZXcgQ2hlY2tib3ggaW5zdGFuY2Ugd2l0aCB0aGUgc3BlY2lmaWVkIHNldHRpbmdzLlxuXHRcdCAqXG5cdFx0ICogQGNvbnN0cnVjdG9yXG5cdFx0ICogQHBhcmFtIHtPYmplY3R9IHNldHRpbmdzIE5hbWUvdmFsdWUgb2JqZWN0IHdpdGggc2V0dGluZ3MuXG5cdFx0ICogQHNldHRpbmcge0Jvb2xlYW59IGNoZWNrZWQgVHJ1ZSBpZiB0aGUgY2hlY2tib3ggc2hvdWxkIGJlIGNoZWNrZWQgYnkgZGVmYXVsdC5cblx0XHQgKi9cblx0XHRpbml0OiBmdW5jdGlvbihzZXR0aW5ncykge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHRzZWxmLl9zdXBlcihzZXR0aW5ncyk7XG5cblx0XHRcdHNlbGYub24oJ2NsaWNrIG1vdXNlZG93bicsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0fSk7XG5cblx0XHRcdHNlbGYub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cblx0XHRcdFx0aWYgKCFzZWxmLmRpc2FibGVkKCkpIHtcblx0XHRcdFx0XHRzZWxmLmNoZWNrZWQoIXNlbGYuY2hlY2tlZCgpKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdHNlbGYuY2hlY2tlZChzZWxmLnNldHRpbmdzLmNoZWNrZWQpO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBHZXR0ZXIvc2V0dGVyIGZ1bmN0aW9uIGZvciB0aGUgY2hlY2tlZCBzdGF0ZS5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgY2hlY2tlZFxuXHRcdCAqIEBwYXJhbSB7Qm9vbGVhbn0gW3N0YXRlXSBTdGF0ZSB0byBiZSBzZXQuXG5cdFx0ICogQHJldHVybiB7Qm9vbGVhbnx0aW55bWNlLnVpLkNoZWNrYm94fSBUcnVlL2ZhbHNlIG9yIGNoZWNrYm94IGlmIGl0J3MgYSBzZXQgb3BlcmF0aW9uLlxuXHRcdCAqL1xuXHRcdGNoZWNrZWQ6IGZ1bmN0aW9uKHN0YXRlKSB7XG5cdFx0XHRpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RhdGUuZ2V0KCdjaGVja2VkJyk7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMuc3RhdGUuc2V0KCdjaGVja2VkJywgc3RhdGUpO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogR2V0dGVyL3NldHRlciBmdW5jdGlvbiBmb3IgdGhlIHZhbHVlIHN0YXRlLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCB2YWx1ZVxuXHRcdCAqIEBwYXJhbSB7Qm9vbGVhbn0gW3N0YXRlXSBTdGF0ZSB0byBiZSBzZXQuXG5cdFx0ICogQHJldHVybiB7Qm9vbGVhbnx0aW55bWNlLnVpLkNoZWNrYm94fSBUcnVlL2ZhbHNlIG9yIGNoZWNrYm94IGlmIGl0J3MgYSBzZXQgb3BlcmF0aW9uLlxuXHRcdCAqL1xuXHRcdHZhbHVlOiBmdW5jdGlvbihzdGF0ZSkge1xuXHRcdFx0aWYgKCFhcmd1bWVudHMubGVuZ3RoKSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmNoZWNrZWQoKTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHRoaXMuY2hlY2tlZChzdGF0ZSk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFJlbmRlcnMgdGhlIGNvbnRyb2wgYXMgYSBIVE1MIHN0cmluZy5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgcmVuZGVySHRtbFxuXHRcdCAqIEByZXR1cm4ge1N0cmluZ30gSFRNTCByZXByZXNlbnRpbmcgdGhlIGNvbnRyb2wuXG5cdFx0ICovXG5cdFx0cmVuZGVySHRtbDogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIGlkID0gc2VsZi5faWQsIHByZWZpeCA9IHNlbGYuY2xhc3NQcmVmaXg7XG5cblx0XHRcdHJldHVybiAoXG5cdFx0XHRcdCc8ZGl2IGlkPVwiJyArIGlkICsgJ1wiIGNsYXNzPVwiJyArIHNlbGYuY2xhc3NlcyArICdcIiB1bnNlbGVjdGFibGU9XCJvblwiIGFyaWEtbGFiZWxsZWRieT1cIicgKyBpZCArICctYWxcIiB0YWJpbmRleD1cIi0xXCI+JyArXG5cdFx0XHRcdFx0JzxpIGNsYXNzPVwiJyArIHByZWZpeCArICdpY28gJyArIHByZWZpeCArICdpLWNoZWNrYm94XCI+PC9pPicgK1xuXHRcdFx0XHRcdCc8c3BhbiBpZD1cIicgKyBpZCArICctYWxcIiBjbGFzcz1cIicgKyBwcmVmaXggKyAnbGFiZWxcIj4nICsgc2VsZi5lbmNvZGUoc2VsZi5zdGF0ZS5nZXQoJ3RleHQnKSkgKyAnPC9zcGFuPicgK1xuXHRcdFx0XHQnPC9kaXY+J1xuXHRcdFx0KTtcblx0XHR9LFxuXG5cdFx0YmluZFN0YXRlczogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdGZ1bmN0aW9uIGNoZWNrZWQoc3RhdGUpIHtcblx0XHRcdFx0c2VsZi5jbGFzc2VzLnRvZ2dsZShcImNoZWNrZWRcIiwgc3RhdGUpO1xuXHRcdFx0XHRzZWxmLmFyaWEoJ2NoZWNrZWQnLCBzdGF0ZSk7XG5cdFx0XHR9XG5cblx0XHRcdHNlbGYuc3RhdGUub24oJ2NoYW5nZTp0ZXh0JywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRzZWxmLmdldEVsKCdhbCcpLmZpcnN0Q2hpbGQuZGF0YSA9IHNlbGYudHJhbnNsYXRlKGUudmFsdWUpO1xuXHRcdFx0fSk7XG5cblx0XHRcdHNlbGYuc3RhdGUub24oJ2NoYW5nZTpjaGVja2VkIGNoYW5nZTp2YWx1ZScsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0c2VsZi5maXJlKCdjaGFuZ2UnKTtcblx0XHRcdFx0Y2hlY2tlZChlLnZhbHVlKTtcblx0XHRcdH0pO1xuXG5cdFx0XHRzZWxmLnN0YXRlLm9uKCdjaGFuZ2U6aWNvbicsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0dmFyIGljb24gPSBlLnZhbHVlLCBwcmVmaXggPSBzZWxmLmNsYXNzUHJlZml4O1xuXG5cdFx0XHRcdGlmICh0eXBlb2YgaWNvbiA9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldHVybiBzZWxmLnNldHRpbmdzLmljb247XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRzZWxmLnNldHRpbmdzLmljb24gPSBpY29uO1xuXHRcdFx0XHRpY29uID0gaWNvbiA/IHByZWZpeCArICdpY28gJyArIHByZWZpeCArICdpLScgKyBzZWxmLnNldHRpbmdzLmljb24gOiAnJztcblxuXHRcdFx0XHR2YXIgYnRuRWxtID0gc2VsZi5nZXRFbCgpLmZpcnN0Q2hpbGQsIGljb25FbG0gPSBidG5FbG0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2knKVswXTtcblxuXHRcdFx0XHRpZiAoaWNvbikge1xuXHRcdFx0XHRcdGlmICghaWNvbkVsbSB8fCBpY29uRWxtICE9IGJ0bkVsbS5maXJzdENoaWxkKSB7XG5cdFx0XHRcdFx0XHRpY29uRWxtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaScpO1xuXHRcdFx0XHRcdFx0YnRuRWxtLmluc2VydEJlZm9yZShpY29uRWxtLCBidG5FbG0uZmlyc3RDaGlsZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWNvbkVsbS5jbGFzc05hbWUgPSBpY29uO1xuXHRcdFx0XHR9IGVsc2UgaWYgKGljb25FbG0pIHtcblx0XHRcdFx0XHRidG5FbG0ucmVtb3ZlQ2hpbGQoaWNvbkVsbSk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRpZiAoc2VsZi5zdGF0ZS5nZXQoJ2NoZWNrZWQnKSkge1xuXHRcdFx0XHRjaGVja2VkKHRydWUpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gc2VsZi5fc3VwZXIoKTtcblx0XHR9XG5cdH0pO1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy91aS9Db21ib0JveC5qc1xuXG4vKipcbiAqIENvbWJvQm94LmpzXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgTEdQTCBMaWNlbnNlLlxuICogQ29weXJpZ2h0IChjKSAxOTk5LTIwMTUgRXBob3ggQ29ycC4gQWxsIHJpZ2h0cyByZXNlcnZlZFxuICpcbiAqIExpY2Vuc2U6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vbGljZW5zZVxuICogQ29udHJpYnV0aW5nOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2NvbnRyaWJ1dGluZ1xuICovXG5cbi8qKlxuICogVGhpcyBjbGFzcyBjcmVhdGVzIGEgY29tYm9ib3ggY29udHJvbC4gU2VsZWN0IGJveCB0aGF0IHlvdSBzZWxlY3QgYSB2YWx1ZSBmcm9tIG9yXG4gKiB0eXBlIGEgdmFsdWUgaW50by5cbiAqXG4gKiBALXgtbGVzcyBDb21ib0JveC5sZXNzXG4gKiBAY2xhc3MgdGlueW1jZS51aS5Db21ib0JveFxuICogQGV4dGVuZHMgdGlueW1jZS51aS5XaWRnZXRcbiAqL1xuZGVmaW5lKFwidGlueW1jZS91aS9Db21ib0JveFwiLCBbXG5cdFwidGlueW1jZS91aS9XaWRnZXRcIixcblx0XCJ0aW55bWNlL3VpL0ZhY3RvcnlcIixcblx0XCJ0aW55bWNlL3VpL0RvbVV0aWxzXCIsXG5cdFwidGlueW1jZS9kb20vRG9tUXVlcnlcIixcblx0XCJ0aW55bWNlL3V0aWwvVktcIixcblx0XCJ0aW55bWNlL3V0aWwvVG9vbHNcIlxuXSwgZnVuY3Rpb24oV2lkZ2V0LCBGYWN0b3J5LCBEb21VdGlscywgJCwgVkssIFRvb2xzKSB7XG5cdFwidXNlIHN0cmljdFwiO1xuXG5cdHJldHVybiBXaWRnZXQuZXh0ZW5kKHtcblx0XHQvKipcblx0XHQgKiBDb25zdHJ1Y3RzIGEgbmV3IGNvbnRyb2wgaW5zdGFuY2Ugd2l0aCB0aGUgc3BlY2lmaWVkIHNldHRpbmdzLlxuXHRcdCAqXG5cdFx0ICogQGNvbnN0cnVjdG9yXG5cdFx0ICogQHBhcmFtIHtPYmplY3R9IHNldHRpbmdzIE5hbWUvdmFsdWUgb2JqZWN0IHdpdGggc2V0dGluZ3MuXG5cdFx0ICogQHNldHRpbmcge1N0cmluZ30gcGxhY2Vob2xkZXIgUGxhY2Vob2xkZXIgdGV4dCB0byBkaXNwbGF5LlxuXHRcdCAqL1xuXHRcdGluaXQ6IGZ1bmN0aW9uKHNldHRpbmdzKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdHNlbGYuX3N1cGVyKHNldHRpbmdzKTtcblx0XHRcdHNldHRpbmdzID0gc2VsZi5zZXR0aW5ncztcblxuXHRcdFx0c2VsZi5jbGFzc2VzLmFkZCgnY29tYm9ib3gnKTtcblx0XHRcdHNlbGYuc3ViaW5wdXQgPSB0cnVlO1xuXHRcdFx0c2VsZi5hcmlhVGFyZ2V0ID0gJ2lucCc7IC8vIFRPRE86IEZpZ3VyZSBvdXQgYSBiZXR0ZXIgd2F5XG5cblx0XHRcdHNldHRpbmdzLm1lbnUgPSBzZXR0aW5ncy5tZW51IHx8IHNldHRpbmdzLnZhbHVlcztcblxuXHRcdFx0aWYgKHNldHRpbmdzLm1lbnUpIHtcblx0XHRcdFx0c2V0dGluZ3MuaWNvbiA9ICdjYXJldCc7XG5cdFx0XHR9XG5cblx0XHRcdHNlbGYub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHR2YXIgZWxtID0gZS50YXJnZXQsIHJvb3QgPSBzZWxmLmdldEVsKCk7XG5cblx0XHRcdFx0aWYgKCEkLmNvbnRhaW5zKHJvb3QsIGVsbSkgJiYgZWxtICE9IHJvb3QpIHtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblxuXHRcdFx0XHR3aGlsZSAoZWxtICYmIGVsbSAhPSByb290KSB7XG5cdFx0XHRcdFx0aWYgKGVsbS5pZCAmJiBlbG0uaWQuaW5kZXhPZignLW9wZW4nKSAhPSAtMSkge1xuXHRcdFx0XHRcdFx0c2VsZi5maXJlKCdhY3Rpb24nKTtcblxuXHRcdFx0XHRcdFx0aWYgKHNldHRpbmdzLm1lbnUpIHtcblx0XHRcdFx0XHRcdFx0c2VsZi5zaG93TWVudSgpO1xuXG5cdFx0XHRcdFx0XHRcdGlmIChlLmFyaWEpIHtcblx0XHRcdFx0XHRcdFx0XHRzZWxmLm1lbnUuaXRlbXMoKVswXS5mb2N1cygpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0ZWxtID0gZWxtLnBhcmVudE5vZGU7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHQvLyBUT0RPOiBSZXdvcmsgdGhpc1xuXHRcdFx0c2VsZi5vbigna2V5ZG93bicsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0dmFyIHJvb3RDb250cm9sO1xuXG5cdFx0XHRcdGlmIChlLmtleUNvZGUgPT0gMTMgJiYgZS50YXJnZXQubm9kZU5hbWUgPT09ICdJTlBVVCcpIHtcblx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cblx0XHRcdFx0XHQvLyBGaW5kIHJvb3QgY29udHJvbCB0aGF0IHdlIGNhbiBkbyB0b0pTT04gb25cblx0XHRcdFx0XHRzZWxmLnBhcmVudHMoKS5yZXZlcnNlKCkuZWFjaChmdW5jdGlvbihjdHJsKSB7XG5cdFx0XHRcdFx0XHRpZiAoY3RybC50b0pTT04pIHtcblx0XHRcdFx0XHRcdFx0cm9vdENvbnRyb2wgPSBjdHJsO1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHQvLyBGaXJlIGV2ZW50IG9uIGN1cnJlbnQgdGV4dCBib3ggd2l0aCB0aGUgc2VyaWFsaXplZCBkYXRhIG9mIHRoZSB3aG9sZSBmb3JtXG5cdFx0XHRcdFx0c2VsZi5maXJlKCdzdWJtaXQnLCB7ZGF0YTogcm9vdENvbnRyb2wudG9KU09OKCl9KTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdHNlbGYub24oJ2tleXVwJywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRpZiAoZS50YXJnZXQubm9kZU5hbWUgPT0gXCJJTlBVVFwiKSB7XG5cdFx0XHRcdFx0dmFyIG9sZFZhbHVlID0gc2VsZi5zdGF0ZS5nZXQoJ3ZhbHVlJyk7XG5cdFx0XHRcdFx0dmFyIG5ld1ZhbHVlID0gZS50YXJnZXQudmFsdWU7XG5cblx0XHRcdFx0XHRpZiAobmV3VmFsdWUgIT09IG9sZFZhbHVlKSB7XG5cdFx0XHRcdFx0XHRzZWxmLnN0YXRlLnNldCgndmFsdWUnLCBuZXdWYWx1ZSk7XG5cdFx0XHRcdFx0XHRzZWxmLmZpcmUoJ2F1dG9jb21wbGV0ZScsIGUpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdHNlbGYub24oJ21vdXNlb3ZlcicsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0dmFyIHRvb2x0aXAgPSBzZWxmLnRvb2x0aXAoKS5tb3ZlVG8oLTB4RkZGRik7XG5cblx0XHRcdFx0aWYgKHNlbGYuc3RhdHVzTGV2ZWwoKSAmJiBlLnRhcmdldC5jbGFzc05hbWUuaW5kZXhPZihzZWxmLmNsYXNzUHJlZml4ICsgJ3N0YXR1cycpICE9PSAtMSkge1xuXHRcdFx0XHRcdHZhciBzdGF0dXNNZXNzYWdlID0gc2VsZi5zdGF0dXNNZXNzYWdlKCkgfHwgJ09rJztcblx0XHRcdFx0XHR2YXIgcmVsID0gdG9vbHRpcC50ZXh0KHN0YXR1c01lc3NhZ2UpLnNob3coKS50ZXN0TW92ZVJlbChlLnRhcmdldCwgWydiYy10YycsICdiYy10bCcsICdiYy10ciddKTtcblxuXHRcdFx0XHRcdHRvb2x0aXAuY2xhc3Nlcy50b2dnbGUoJ3Rvb2x0aXAtbicsIHJlbCA9PSAnYmMtdGMnKTtcblx0XHRcdFx0XHR0b29sdGlwLmNsYXNzZXMudG9nZ2xlKCd0b29sdGlwLW53JywgcmVsID09ICdiYy10bCcpO1xuXHRcdFx0XHRcdHRvb2x0aXAuY2xhc3Nlcy50b2dnbGUoJ3Rvb2x0aXAtbmUnLCByZWwgPT0gJ2JjLXRyJyk7XG5cblx0XHRcdFx0XHR0b29sdGlwLm1vdmVSZWwoZS50YXJnZXQsIHJlbCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH0sXG5cblx0XHRzdGF0dXNMZXZlbDogZnVuY3Rpb24gKHZhbHVlKSB7XG5cdFx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDApIHtcblx0XHRcdFx0dGhpcy5zdGF0ZS5zZXQoJ3N0YXR1c0xldmVsJywgdmFsdWUpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gdGhpcy5zdGF0ZS5nZXQoJ3N0YXR1c0xldmVsJyk7XG5cdFx0fSxcblxuXHRcdHN0YXR1c01lc3NhZ2U6IGZ1bmN0aW9uICh2YWx1ZSkge1xuXHRcdFx0aWYgKGFyZ3VtZW50cy5sZW5ndGggPiAwKSB7XG5cdFx0XHRcdHRoaXMuc3RhdGUuc2V0KCdzdGF0dXNNZXNzYWdlJywgdmFsdWUpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gdGhpcy5zdGF0ZS5nZXQoJ3N0YXR1c01lc3NhZ2UnKTtcblx0XHR9LFxuXG5cdFx0c2hvd01lbnU6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLCBzZXR0aW5ncyA9IHNlbGYuc2V0dGluZ3MsIG1lbnU7XG5cblx0XHRcdGlmICghc2VsZi5tZW51KSB7XG5cdFx0XHRcdG1lbnUgPSBzZXR0aW5ncy5tZW51IHx8IFtdO1xuXG5cdFx0XHRcdC8vIElzIG1lbnUgYXJyYXkgdGhlbiBhdXRvIGNvbnN0dWN0IG1lbnUgY29udHJvbFxuXHRcdFx0XHRpZiAobWVudS5sZW5ndGgpIHtcblx0XHRcdFx0XHRtZW51ID0ge1xuXHRcdFx0XHRcdFx0dHlwZTogJ21lbnUnLFxuXHRcdFx0XHRcdFx0aXRlbXM6IG1lbnVcblx0XHRcdFx0XHR9O1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG1lbnUudHlwZSA9IG1lbnUudHlwZSB8fCAnbWVudSc7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRzZWxmLm1lbnUgPSBGYWN0b3J5LmNyZWF0ZShtZW51KS5wYXJlbnQoc2VsZikucmVuZGVyVG8oc2VsZi5nZXRDb250YWluZXJFbG0oKSk7XG5cdFx0XHRcdHNlbGYuZmlyZSgnY3JlYXRlbWVudScpO1xuXHRcdFx0XHRzZWxmLm1lbnUucmVmbG93KCk7XG5cdFx0XHRcdHNlbGYubWVudS5vbignY2FuY2VsJywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRcdGlmIChlLmNvbnRyb2wgPT09IHNlbGYubWVudSkge1xuXHRcdFx0XHRcdFx0c2VsZi5mb2N1cygpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0c2VsZi5tZW51Lm9uKCdzaG93IGhpZGUnLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdFx0ZS5jb250cm9sLml0ZW1zKCkuZWFjaChmdW5jdGlvbihjdHJsKSB7XG5cdFx0XHRcdFx0XHRjdHJsLmFjdGl2ZShjdHJsLnZhbHVlKCkgPT0gc2VsZi52YWx1ZSgpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSkuZmlyZSgnc2hvdycpO1xuXG5cdFx0XHRcdHNlbGYubWVudS5vbignc2VsZWN0JywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRcdHNlbGYudmFsdWUoZS5jb250cm9sLnZhbHVlKCkpO1xuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHRzZWxmLm9uKCdmb2N1c2luJywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRcdGlmIChlLnRhcmdldC50YWdOYW1lLnRvVXBwZXJDYXNlKCkgPT0gJ0lOUFVUJykge1xuXHRcdFx0XHRcdFx0c2VsZi5tZW51LmhpZGUoKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdHNlbGYuYXJpYSgnZXhwYW5kZWQnLCB0cnVlKTtcblx0XHRcdH1cblxuXHRcdFx0c2VsZi5tZW51LnNob3coKTtcblx0XHRcdHNlbGYubWVudS5sYXlvdXRSZWN0KHt3OiBzZWxmLmxheW91dFJlY3QoKS53fSk7XG5cdFx0XHRzZWxmLm1lbnUubW92ZVJlbChzZWxmLmdldEVsKCksIHNlbGYuaXNSdGwoKSA/IFsnYnItdHInLCAndHItYnInXSA6IFsnYmwtdGwnLCAndGwtYmwnXSk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIEZvY3VzZXMgdGhlIGlucHV0IGFyZWEgb2YgdGhlIGNvbnRyb2wuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGZvY3VzXG5cdFx0ICovXG5cdFx0Zm9jdXM6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dGhpcy5nZXRFbCgnaW5wJykuZm9jdXMoKTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmVwYWludHMgdGhlIGNvbnRyb2wgYWZ0ZXIgYSBsYXlvdXQgb3BlcmF0aW9uLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCByZXBhaW50XG5cdFx0ICovXG5cdFx0cmVwYWludDogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIGVsbSA9IHNlbGYuZ2V0RWwoKSwgb3BlbkVsbSA9IHNlbGYuZ2V0RWwoJ29wZW4nKSwgcmVjdCA9IHNlbGYubGF5b3V0UmVjdCgpO1xuXHRcdFx0dmFyIHdpZHRoLCBsaW5lSGVpZ2h0LCBpbm5lclBhZGRpbmcgPSAwLCBpbnB1dEVsbSA9IGVsbS5maXJzdENoaWxkO1xuXG5cdFx0XHRpZiAoc2VsZi5zdGF0dXNMZXZlbCgpICYmIHNlbGYuc3RhdHVzTGV2ZWwoKSAhPT0gJ25vbmUnKSB7XG5cdFx0XHRcdGlubmVyUGFkZGluZyA9IChcblx0XHRcdFx0XHRwYXJzZUludChEb21VdGlscy5nZXRSdW50aW1lU3R5bGUoaW5wdXRFbG0sICdwYWRkaW5nLXJpZ2h0JyksIDEwKSAtXG5cdFx0XHRcdFx0cGFyc2VJbnQoRG9tVXRpbHMuZ2V0UnVudGltZVN0eWxlKGlucHV0RWxtLCAncGFkZGluZy1sZWZ0JyksIDEwKVxuXHRcdFx0XHQpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAob3BlbkVsbSkge1xuXHRcdFx0XHR3aWR0aCA9IHJlY3QudyAtIERvbVV0aWxzLmdldFNpemUob3BlbkVsbSkud2lkdGggLSAxMDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHdpZHRoID0gcmVjdC53IC0gMTA7XG5cdFx0XHR9XG5cblx0XHRcdC8vIERldGVjdCBvbGQgSUUgNys4IGFkZCBsaW5lSGVpZ2h0IHRvIGFsaWduIGNhcmV0IHZlcnRpY2FsbHkgaW4gdGhlIG1pZGRsZVxuXHRcdFx0dmFyIGRvYyA9IGRvY3VtZW50O1xuXHRcdFx0aWYgKGRvYy5hbGwgJiYgKCFkb2MuZG9jdW1lbnRNb2RlIHx8IGRvYy5kb2N1bWVudE1vZGUgPD0gOCkpIHtcblx0XHRcdFx0bGluZUhlaWdodCA9IChzZWxmLmxheW91dFJlY3QoKS5oIC0gMikgKyAncHgnO1xuXHRcdFx0fVxuXG5cdFx0XHQkKGlucHV0RWxtKS5jc3Moe1xuXHRcdFx0XHR3aWR0aDogd2lkdGggLSBpbm5lclBhZGRpbmcsXG5cdFx0XHRcdGxpbmVIZWlnaHQ6IGxpbmVIZWlnaHRcblx0XHRcdH0pO1xuXG5cdFx0XHRzZWxmLl9zdXBlcigpO1xuXG5cdFx0XHRyZXR1cm4gc2VsZjtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUG9zdCByZW5kZXIgbWV0aG9kLiBDYWxsZWQgYWZ0ZXIgdGhlIGNvbnRyb2wgaGFzIGJlZW4gcmVuZGVyZWQgdG8gdGhlIHRhcmdldC5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgcG9zdFJlbmRlclxuXHRcdCAqIEByZXR1cm4ge3RpbnltY2UudWkuQ29tYm9Cb3h9IEN1cnJlbnQgY29tYm9ib3ggaW5zdGFuY2UuXG5cdFx0ICovXG5cdFx0cG9zdFJlbmRlcjogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdCQodGhpcy5nZXRFbCgnaW5wJykpLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdHNlbGYuc3RhdGUuc2V0KCd2YWx1ZScsIGUudGFyZ2V0LnZhbHVlKTtcblx0XHRcdFx0c2VsZi5maXJlKCdjaGFuZ2UnLCBlKTtcblx0XHRcdH0pO1xuXG5cdFx0XHRyZXR1cm4gc2VsZi5fc3VwZXIoKTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmVuZGVycyB0aGUgY29udHJvbCBhcyBhIEhUTUwgc3RyaW5nLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCByZW5kZXJIdG1sXG5cdFx0ICogQHJldHVybiB7U3RyaW5nfSBIVE1MIHJlcHJlc2VudGluZyB0aGUgY29udHJvbC5cblx0XHQgKi9cblx0XHRyZW5kZXJIdG1sOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgaWQgPSBzZWxmLl9pZCwgc2V0dGluZ3MgPSBzZWxmLnNldHRpbmdzLCBwcmVmaXggPSBzZWxmLmNsYXNzUHJlZml4O1xuXHRcdFx0dmFyIHZhbHVlID0gc2VsZi5zdGF0ZS5nZXQoJ3ZhbHVlJykgfHwgJyc7XG5cdFx0XHR2YXIgaWNvbiwgdGV4dCwgb3BlbkJ0bkh0bWwgPSAnJywgZXh0cmFBdHRycyA9ICcnLCBzdGF0dXNIdG1sID0gJyc7XG5cblx0XHRcdGlmIChcInNwZWxsY2hlY2tcIiBpbiBzZXR0aW5ncykge1xuXHRcdFx0XHRleHRyYUF0dHJzICs9ICcgc3BlbGxjaGVjaz1cIicgKyBzZXR0aW5ncy5zcGVsbGNoZWNrICsgJ1wiJztcblx0XHRcdH1cblxuXHRcdFx0aWYgKHNldHRpbmdzLm1heExlbmd0aCkge1xuXHRcdFx0XHRleHRyYUF0dHJzICs9ICcgbWF4bGVuZ3RoPVwiJyArIHNldHRpbmdzLm1heExlbmd0aCArICdcIic7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChzZXR0aW5ncy5zaXplKSB7XG5cdFx0XHRcdGV4dHJhQXR0cnMgKz0gJyBzaXplPVwiJyArIHNldHRpbmdzLnNpemUgKyAnXCInO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoc2V0dGluZ3Muc3VidHlwZSkge1xuXHRcdFx0XHRleHRyYUF0dHJzICs9ICcgdHlwZT1cIicgKyBzZXR0aW5ncy5zdWJ0eXBlICsgJ1wiJztcblx0XHRcdH1cblxuXHRcdFx0c3RhdHVzSHRtbCA9ICc8aSBpZD1cIicgKyBpZCArICctc3RhdHVzXCIgY2xhc3M9XCJtY2Utc3RhdHVzIG1jZS1pY29cIiBzdHlsZT1cImRpc3BsYXk6IG5vbmVcIj48L2k+JztcblxuXHRcdFx0aWYgKHNlbGYuZGlzYWJsZWQoKSkge1xuXHRcdFx0XHRleHRyYUF0dHJzICs9ICcgZGlzYWJsZWQ9XCJkaXNhYmxlZFwiJztcblx0XHRcdH1cblxuXHRcdFx0aWNvbiA9IHNldHRpbmdzLmljb247XG5cdFx0XHRpZiAoaWNvbiAmJiBpY29uICE9ICdjYXJldCcpIHtcblx0XHRcdFx0aWNvbiA9IHByZWZpeCArICdpY28gJyArIHByZWZpeCArICdpLScgKyBzZXR0aW5ncy5pY29uO1xuXHRcdFx0fVxuXG5cdFx0XHR0ZXh0ID0gc2VsZi5zdGF0ZS5nZXQoJ3RleHQnKTtcblxuXHRcdFx0aWYgKGljb24gfHwgdGV4dCkge1xuXHRcdFx0XHRvcGVuQnRuSHRtbCA9IChcblx0XHRcdFx0XHQnPGRpdiBpZD1cIicgKyBpZCArICctb3BlblwiIGNsYXNzPVwiJyArIHByZWZpeCArICdidG4gJyArIHByZWZpeCArICdvcGVuXCIgdGFiSW5kZXg9XCItMVwiIHJvbGU9XCJidXR0b25cIj4nICtcblx0XHRcdFx0XHRcdCc8YnV0dG9uIGlkPVwiJyArIGlkICsgJy1hY3Rpb25cIiB0eXBlPVwiYnV0dG9uXCIgaGlkZWZvY3VzPVwiMVwiIHRhYmluZGV4PVwiLTFcIj4nICtcblx0XHRcdFx0XHRcdFx0KGljb24gIT0gJ2NhcmV0JyA/ICc8aSBjbGFzcz1cIicgKyBpY29uICsgJ1wiPjwvaT4nIDogJzxpIGNsYXNzPVwiJyArIHByZWZpeCArICdjYXJldFwiPjwvaT4nKSArXG5cdFx0XHRcdFx0XHRcdCh0ZXh0ID8gKGljb24gPyAnICcgOiAnJykgKyB0ZXh0IDogJycpICtcblx0XHRcdFx0XHRcdCc8L2J1dHRvbj4nICtcblx0XHRcdFx0XHQnPC9kaXY+J1xuXHRcdFx0XHQpO1xuXG5cdFx0XHRcdHNlbGYuY2xhc3Nlcy5hZGQoJ2hhcy1vcGVuJyk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiAoXG5cdFx0XHRcdCc8ZGl2IGlkPVwiJyArIGlkICsgJ1wiIGNsYXNzPVwiJyArIHNlbGYuY2xhc3NlcyArICdcIj4nICtcblx0XHRcdFx0XHQnPGlucHV0IGlkPVwiJyArIGlkICsgJy1pbnBcIiBjbGFzcz1cIicgKyBwcmVmaXggKyAndGV4dGJveFwiIHZhbHVlPVwiJyArXG5cdFx0XHRcdFx0c2VsZi5lbmNvZGUodmFsdWUsIGZhbHNlKSArICdcIiBoaWRlZm9jdXM9XCIxXCInICsgZXh0cmFBdHRycyArICcgcGxhY2Vob2xkZXI9XCInICtcblx0XHRcdFx0XHRzZWxmLmVuY29kZShzZXR0aW5ncy5wbGFjZWhvbGRlcikgKyAnXCIgLz4nICtcblx0XHRcdFx0XHRzdGF0dXNIdG1sICtcblx0XHRcdFx0XHRvcGVuQnRuSHRtbCArXG5cdFx0XHRcdCc8L2Rpdj4nXG5cdFx0XHQpO1xuXHRcdH0sXG5cblx0XHR2YWx1ZTogZnVuY3Rpb24odmFsdWUpIHtcblx0XHRcdGlmIChhcmd1bWVudHMubGVuZ3RoKSB7XG5cdFx0XHRcdHRoaXMuc3RhdGUuc2V0KCd2YWx1ZScsIHZhbHVlKTtcblx0XHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0XHR9XG5cblx0XHRcdC8vIE1ha2Ugc3VyZSB0aGUgcmVhbCBzdGF0ZSBpcyBpbiBzeW5jXG5cdFx0XHRpZiAodGhpcy5zdGF0ZS5nZXQoJ3JlbmRlcmVkJykpIHtcblx0XHRcdFx0dGhpcy5zdGF0ZS5zZXQoJ3ZhbHVlJywgdGhpcy5nZXRFbCgnaW5wJykudmFsdWUpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gdGhpcy5zdGF0ZS5nZXQoJ3ZhbHVlJyk7XG5cdFx0fSxcblxuXHRcdHNob3dBdXRvQ29tcGxldGU6IGZ1bmN0aW9uIChpdGVtcywgdGVybSkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHRpZiAoaXRlbXMubGVuZ3RoID09PSAwKSB7XG5cdFx0XHRcdHNlbGYuaGlkZU1lbnUoKTtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHR2YXIgaW5zZXJ0ID0gZnVuY3Rpb24gKHZhbHVlLCB0aXRsZSkge1xuXHRcdFx0XHRyZXR1cm4gZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdHNlbGYuZmlyZSgnc2VsZWN0aXRlbScsIHtcblx0XHRcdFx0XHRcdHRpdGxlOiB0aXRsZSxcblx0XHRcdFx0XHRcdHZhbHVlOiB2YWx1ZVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9O1xuXHRcdFx0fTtcblxuXHRcdFx0aWYgKHNlbGYubWVudSkge1xuXHRcdFx0XHRzZWxmLm1lbnUuaXRlbXMoKS5yZW1vdmUoKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHNlbGYubWVudSA9IEZhY3RvcnkuY3JlYXRlKHtcblx0XHRcdFx0XHR0eXBlOiAnbWVudScsXG5cdFx0XHRcdFx0Y2xhc3NlczogJ2NvbWJvYm94LW1lbnUnLFxuXHRcdFx0XHRcdGxheW91dDogJ2Zsb3cnXG5cdFx0XHRcdH0pLnBhcmVudChzZWxmKS5yZW5kZXJUbygpO1xuXHRcdFx0fVxuXG5cdFx0XHRUb29scy5lYWNoKGl0ZW1zLCBmdW5jdGlvbiAoaXRlbSkge1xuXHRcdFx0XHRzZWxmLm1lbnUuYWRkKHtcblx0XHRcdFx0XHR0ZXh0OiBpdGVtLnRpdGxlLFxuXHRcdFx0XHRcdHVybDogaXRlbS5wcmV2aWV3VXJsLFxuXHRcdFx0XHRcdG1hdGNoOiB0ZXJtLFxuXHRcdFx0XHRcdGNsYXNzZXM6ICdtZW51LWl0ZW0tZWxsaXBzaXMnLFxuXHRcdFx0XHRcdG9uY2xpY2s6IGluc2VydChpdGVtLnZhbHVlLCBpdGVtLnRpdGxlKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0pO1xuXG5cdFx0XHRzZWxmLm1lbnUucmVuZGVyTmV3KCk7XG5cdFx0XHRzZWxmLmhpZGVNZW51KCk7XG5cblx0XHRcdHNlbGYubWVudS5vbignY2FuY2VsJywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRpZiAoZS5jb250cm9sLnBhcmVudCgpID09PSBzZWxmLm1lbnUpIHtcblx0XHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRcdHNlbGYuZm9jdXMoKTtcblx0XHRcdFx0XHRzZWxmLmhpZGVNZW51KCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRzZWxmLm1lbnUub24oJ3NlbGVjdCcsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRzZWxmLmZvY3VzKCk7XG5cdFx0XHR9KTtcblxuXHRcdFx0dmFyIG1heFcgPSBzZWxmLmxheW91dFJlY3QoKS53O1xuXHRcdFx0c2VsZi5tZW51LmxheW91dFJlY3Qoe3c6IG1heFcsIG1pblc6IDAsIG1heFc6IG1heFd9KTtcblx0XHRcdHNlbGYubWVudS5yZWZsb3coKTtcblx0XHRcdHNlbGYubWVudS5zaG93KCk7XG5cdFx0XHRzZWxmLm1lbnUubW92ZVJlbChzZWxmLmdldEVsKCksIHNlbGYuaXNSdGwoKSA/IFsnYnItdHInLCAndHItYnInXSA6IFsnYmwtdGwnLCAndGwtYmwnXSk7XG5cdFx0fSxcblxuXHRcdGhpZGVNZW51OiBmdW5jdGlvbigpIHtcblx0XHRcdGlmICh0aGlzLm1lbnUpIHtcblx0XHRcdFx0dGhpcy5tZW51LmhpZGUoKTtcblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0YmluZFN0YXRlczogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdHNlbGYuc3RhdGUub24oJ2NoYW5nZTp2YWx1ZScsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0aWYgKHNlbGYuZ2V0RWwoJ2lucCcpLnZhbHVlICE9IGUudmFsdWUpIHtcblx0XHRcdFx0XHRzZWxmLmdldEVsKCdpbnAnKS52YWx1ZSA9IGUudmFsdWU7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRzZWxmLnN0YXRlLm9uKCdjaGFuZ2U6ZGlzYWJsZWQnLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdHNlbGYuZ2V0RWwoJ2lucCcpLmRpc2FibGVkID0gZS52YWx1ZTtcblx0XHRcdH0pO1xuXG5cdFx0XHRzZWxmLnN0YXRlLm9uKCdjaGFuZ2U6c3RhdHVzTGV2ZWwnLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdHZhciBzdGF0dXNJY29uRWxtID0gc2VsZi5nZXRFbCgnc3RhdHVzJyk7XG5cdFx0XHRcdHZhciBwcmVmaXggPSBzZWxmLmNsYXNzUHJlZml4LCB2YWx1ZSA9IGUudmFsdWU7XG5cblx0XHRcdFx0RG9tVXRpbHMuY3NzKHN0YXR1c0ljb25FbG0sICdkaXNwbGF5JywgdmFsdWUgPT09ICdub25lJyA/ICdub25lJyA6ICcnKTtcblx0XHRcdFx0RG9tVXRpbHMudG9nZ2xlQ2xhc3Moc3RhdHVzSWNvbkVsbSwgcHJlZml4ICsgJ2ktY2hlY2ttYXJrJywgdmFsdWUgPT09ICdvaycpO1xuXHRcdFx0XHREb21VdGlscy50b2dnbGVDbGFzcyhzdGF0dXNJY29uRWxtLCBwcmVmaXggKyAnaS13YXJuaW5nJywgdmFsdWUgPT09ICd3YXJuJyk7XG5cdFx0XHRcdERvbVV0aWxzLnRvZ2dsZUNsYXNzKHN0YXR1c0ljb25FbG0sIHByZWZpeCArICdpLWVycm9yJywgdmFsdWUgPT09ICdlcnJvcicpO1xuXHRcdFx0XHRzZWxmLmNsYXNzZXMudG9nZ2xlKCdoYXMtc3RhdHVzJywgdmFsdWUgIT09ICdub25lJyk7XG5cdFx0XHRcdHNlbGYucmVwYWludCgpO1xuXHRcdFx0fSk7XG5cblx0XHRcdERvbVV0aWxzLm9uKHNlbGYuZ2V0RWwoJ3N0YXR1cycpLCAnbW91c2VsZWF2ZScsIGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0c2VsZi50b29sdGlwKCkuaGlkZSgpO1xuXHRcdFx0fSk7XG5cblx0XHRcdHNlbGYub24oJ2NhbmNlbCcsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdGlmIChzZWxmLm1lbnUgJiYgc2VsZi5tZW51LnZpc2libGUoKSkge1xuXHRcdFx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdFx0c2VsZi5oaWRlTWVudSgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0dmFyIGZvY3VzSWR4ID0gZnVuY3Rpb24gKGlkeCwgbWVudSkge1xuXHRcdFx0XHRpZiAobWVudSAmJiBtZW51Lml0ZW1zKCkubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRcdG1lbnUuaXRlbXMoKS5lcShpZHgpWzBdLmZvY3VzKCk7XG5cdFx0XHRcdH1cblx0XHRcdH07XG5cblx0XHRcdHNlbGYub24oJ2tleWRvd24nLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHR2YXIga2V5Q29kZSA9IGUua2V5Q29kZTtcblxuXHRcdFx0XHRpZiAoZS50YXJnZXQubm9kZU5hbWUgPT09ICdJTlBVVCcpIHtcblx0XHRcdFx0XHRpZiAoa2V5Q29kZSA9PT0gVksuRE9XTikge1xuXHRcdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRcdFx0c2VsZi5maXJlKCdhdXRvY29tcGxldGUnKTtcblx0XHRcdFx0XHRcdGZvY3VzSWR4KDAsIHNlbGYubWVudSk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmIChrZXlDb2RlID09PSBWSy5VUCkge1xuXHRcdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRcdFx0Zm9jdXNJZHgoLTEsIHNlbGYubWVudSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0cmV0dXJuIHNlbGYuX3N1cGVyKCk7XG5cdFx0fSxcblxuXHRcdHJlbW92ZTogZnVuY3Rpb24oKSB7XG5cdFx0XHQkKHRoaXMuZ2V0RWwoJ2lucCcpKS5vZmYoKTtcblxuXHRcdFx0aWYgKHRoaXMubWVudSkge1xuXHRcdFx0XHR0aGlzLm1lbnUucmVtb3ZlKCk7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMuX3N1cGVyKCk7XG5cdFx0fVxuXHR9KTtcbn0pO1xuXG4vLyBJbmNsdWRlZCBmcm9tOiBqcy90aW55bWNlL2NsYXNzZXMvdWkvQ29sb3JCb3guanNcblxuLyoqXG4gKiBDb2xvckJveC5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE1IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKipcbiAqIFRoaXMgd2lkZ2V0IGxldHMgeW91IGVudGVyIGNvbG9ycyBhbmQgYnJvd3NlIGZvciBjb2xvcnMgYnkgcHJlc3NpbmcgdGhlIGNvbG9yIGJ1dHRvbi4gSXQgYWxzbyBkaXNwbGF5c1xuICogYSBwcmV2aWV3IG9mIHRoZSBjdXJyZW50IGNvbG9yLlxuICpcbiAqIEAteC1sZXNzIENvbG9yQm94Lmxlc3NcbiAqIEBjbGFzcyB0aW55bWNlLnVpLkNvbG9yQm94XG4gKiBAZXh0ZW5kcyB0aW55bWNlLnVpLkNvbWJvQm94XG4gKi9cbmRlZmluZShcInRpbnltY2UvdWkvQ29sb3JCb3hcIiwgW1xuXHRcInRpbnltY2UvdWkvQ29tYm9Cb3hcIlxuXSwgZnVuY3Rpb24oQ29tYm9Cb3gpIHtcblx0XCJ1c2Ugc3RyaWN0XCI7XG5cblx0cmV0dXJuIENvbWJvQm94LmV4dGVuZCh7XG5cdFx0LyoqXG5cdFx0ICogQ29uc3RydWN0cyBhIG5ldyBjb250cm9sIGluc3RhbmNlIHdpdGggdGhlIHNwZWNpZmllZCBzZXR0aW5ncy5cblx0XHQgKlxuXHRcdCAqIEBjb25zdHJ1Y3RvclxuXHRcdCAqIEBwYXJhbSB7T2JqZWN0fSBzZXR0aW5ncyBOYW1lL3ZhbHVlIG9iamVjdCB3aXRoIHNldHRpbmdzLlxuXHRcdCAqL1xuXHRcdGluaXQ6IGZ1bmN0aW9uKHNldHRpbmdzKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdHNldHRpbmdzLnNwZWxsY2hlY2sgPSBmYWxzZTtcblxuXHRcdFx0aWYgKHNldHRpbmdzLm9uYWN0aW9uKSB7XG5cdFx0XHRcdHNldHRpbmdzLmljb24gPSAnbm9uZSc7XG5cdFx0XHR9XG5cblx0XHRcdHNlbGYuX3N1cGVyKHNldHRpbmdzKTtcblxuXHRcdFx0c2VsZi5jbGFzc2VzLmFkZCgnY29sb3Jib3gnKTtcblx0XHRcdHNlbGYub24oJ2NoYW5nZSBrZXl1cCBwb3N0cmVuZGVyJywgZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHNlbGYucmVwYWludENvbG9yKHNlbGYudmFsdWUoKSk7XG5cdFx0XHR9KTtcblx0XHR9LFxuXG5cdFx0cmVwYWludENvbG9yOiBmdW5jdGlvbih2YWx1ZSkge1xuXHRcdFx0dmFyIG9wZW5FbG0gPSB0aGlzLmdldEVsKCdvcGVuJyk7XG5cdFx0XHR2YXIgZWxtID0gb3BlbkVsbSA/IG9wZW5FbG0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2knKVswXSA6IG51bGw7XG5cblx0XHRcdGlmIChlbG0pIHtcblx0XHRcdFx0dHJ5IHtcblx0XHRcdFx0XHRlbG0uc3R5bGUuYmFja2dyb3VuZCA9IHZhbHVlO1xuXHRcdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHRcdC8vIElnbm9yZVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSxcblxuXHRcdGJpbmRTdGF0ZXM6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHRzZWxmLnN0YXRlLm9uKCdjaGFuZ2U6dmFsdWUnLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdGlmIChzZWxmLnN0YXRlLmdldCgncmVuZGVyZWQnKSkge1xuXHRcdFx0XHRcdHNlbGYucmVwYWludENvbG9yKGUudmFsdWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0cmV0dXJuIHNlbGYuX3N1cGVyKCk7XG5cdFx0fVxuXHR9KTtcbn0pO1xuXG4vLyBJbmNsdWRlZCBmcm9tOiBqcy90aW55bWNlL2NsYXNzZXMvdWkvUGFuZWxCdXR0b24uanNcblxuLyoqXG4gKiBQYW5lbEJ1dHRvbi5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE1IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKipcbiAqIENyZWF0ZXMgYSBuZXcgcGFuZWwgYnV0dG9uLlxuICpcbiAqIEBjbGFzcyB0aW55bWNlLnVpLlBhbmVsQnV0dG9uXG4gKiBAZXh0ZW5kcyB0aW55bWNlLnVpLkJ1dHRvblxuICovXG5kZWZpbmUoXCJ0aW55bWNlL3VpL1BhbmVsQnV0dG9uXCIsIFtcblx0XCJ0aW55bWNlL3VpL0J1dHRvblwiLFxuXHRcInRpbnltY2UvdWkvRmxvYXRQYW5lbFwiXG5dLCBmdW5jdGlvbihCdXR0b24sIEZsb2F0UGFuZWwpIHtcblx0XCJ1c2Ugc3RyaWN0XCI7XG5cblx0cmV0dXJuIEJ1dHRvbi5leHRlbmQoe1xuXHRcdC8qKlxuXHRcdCAqIFNob3dzIHRoZSBwYW5lbCBmb3IgdGhlIGJ1dHRvbi5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2Qgc2hvd1BhbmVsXG5cdFx0ICovXG5cdFx0c2hvd1BhbmVsOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgc2V0dGluZ3MgPSBzZWxmLnNldHRpbmdzO1xuXG5cdFx0XHRzZWxmLmFjdGl2ZSh0cnVlKTtcblxuXHRcdFx0aWYgKCFzZWxmLnBhbmVsKSB7XG5cdFx0XHRcdHZhciBwYW5lbFNldHRpbmdzID0gc2V0dGluZ3MucGFuZWw7XG5cblx0XHRcdFx0Ly8gV3JhcCBwYW5lbCBpbiBncmlkIGxheW91dCBpZiB0eXBlIGlmIHNwZWNpZmllZFxuXHRcdFx0XHQvLyBUaGlzIG1ha2VzIGl0IHBvc3NpYmxlIHRvIGFkZCBmb3JtcyBvciBvdGhlciBjb250YWluZXJzIGRpcmVjdGx5IGluIHRoZSBwYW5lbCBvcHRpb25cblx0XHRcdFx0aWYgKHBhbmVsU2V0dGluZ3MudHlwZSkge1xuXHRcdFx0XHRcdHBhbmVsU2V0dGluZ3MgPSB7XG5cdFx0XHRcdFx0XHRsYXlvdXQ6ICdncmlkJyxcblx0XHRcdFx0XHRcdGl0ZW1zOiBwYW5lbFNldHRpbmdzXG5cdFx0XHRcdFx0fTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHBhbmVsU2V0dGluZ3Mucm9sZSA9IHBhbmVsU2V0dGluZ3Mucm9sZSB8fCAnZGlhbG9nJztcblx0XHRcdFx0cGFuZWxTZXR0aW5ncy5wb3BvdmVyID0gdHJ1ZTtcblx0XHRcdFx0cGFuZWxTZXR0aW5ncy5hdXRvaGlkZSA9IHRydWU7XG5cdFx0XHRcdHBhbmVsU2V0dGluZ3MuYXJpYVJvb3QgPSB0cnVlO1xuXG5cdFx0XHRcdHNlbGYucGFuZWwgPSBuZXcgRmxvYXRQYW5lbChwYW5lbFNldHRpbmdzKS5vbignaGlkZScsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdHNlbGYuYWN0aXZlKGZhbHNlKTtcblx0XHRcdFx0fSkub24oJ2NhbmNlbCcsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRcdHNlbGYuZm9jdXMoKTtcblx0XHRcdFx0XHRzZWxmLmhpZGVQYW5lbCgpO1xuXHRcdFx0XHR9KS5wYXJlbnQoc2VsZikucmVuZGVyVG8oc2VsZi5nZXRDb250YWluZXJFbG0oKSk7XG5cblx0XHRcdFx0c2VsZi5wYW5lbC5maXJlKCdzaG93Jyk7XG5cdFx0XHRcdHNlbGYucGFuZWwucmVmbG93KCk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRzZWxmLnBhbmVsLnNob3coKTtcblx0XHRcdH1cblxuXHRcdFx0c2VsZi5wYW5lbC5tb3ZlUmVsKHNlbGYuZ2V0RWwoKSwgc2V0dGluZ3MucG9wb3ZlckFsaWduIHx8IChzZWxmLmlzUnRsKCkgPyBbJ2JjLXRyJywgJ2JjLXRjJ10gOiBbJ2JjLXRsJywgJ2JjLXRjJ10pKTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogSGlkZXMgdGhlIHBhbmVsIGZvciB0aGUgYnV0dG9uLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBoaWRlUGFuZWxcblx0XHQgKi9cblx0XHRoaWRlUGFuZWw6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHRpZiAoc2VsZi5wYW5lbCkge1xuXHRcdFx0XHRzZWxmLnBhbmVsLmhpZGUoKTtcblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogQ2FsbGVkIGFmdGVyIHRoZSBjb250cm9sIGhhcyBiZWVuIHJlbmRlcmVkLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBwb3N0UmVuZGVyXG5cdFx0ICovXG5cdFx0cG9zdFJlbmRlcjogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdHNlbGYuYXJpYSgnaGFzcG9wdXAnLCB0cnVlKTtcblxuXHRcdFx0c2VsZi5vbignY2xpY2snLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdGlmIChlLmNvbnRyb2wgPT09IHNlbGYpIHtcblx0XHRcdFx0XHRpZiAoc2VsZi5wYW5lbCAmJiBzZWxmLnBhbmVsLnZpc2libGUoKSkge1xuXHRcdFx0XHRcdFx0c2VsZi5oaWRlUGFuZWwoKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0c2VsZi5zaG93UGFuZWwoKTtcblx0XHRcdFx0XHRcdHNlbGYucGFuZWwuZm9jdXMoISFlLmFyaWEpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdHJldHVybiBzZWxmLl9zdXBlcigpO1xuXHRcdH0sXG5cblx0XHRyZW1vdmU6IGZ1bmN0aW9uKCkge1xuXHRcdFx0aWYgKHRoaXMucGFuZWwpIHtcblx0XHRcdFx0dGhpcy5wYW5lbC5yZW1vdmUoKTtcblx0XHRcdFx0dGhpcy5wYW5lbCA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiB0aGlzLl9zdXBlcigpO1xuXHRcdH1cblx0fSk7XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL3VpL0NvbG9yQnV0dG9uLmpzXG5cbi8qKlxuICogQ29sb3JCdXR0b24uanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBUaGlzIGNsYXNzIGNyZWF0ZXMgYSBjb2xvciBidXR0b24gY29udHJvbC4gVGhpcyBpcyBhIHNwbGl0IGJ1dHRvbiBpbiB3aGljaCB0aGUgbWFpblxuICogYnV0dG9uIGhhcyBhIHZpc3VhbCByZXByZXNlbnRhdGlvbiBvZiB0aGUgY3VycmVudGx5IHNlbGVjdGVkIGNvbG9yLiBXaGVuIGNsaWNrZWRcbiAqIHRoZSBjYXJldCBidXR0b24gZGlzcGxheXMgYSBjb2xvciBwaWNrZXIsIGFsbG93aW5nIHRoZSB1c2VyIHRvIHNlbGVjdCBhIG5ldyBjb2xvci5cbiAqXG4gKiBALXgtbGVzcyBDb2xvckJ1dHRvbi5sZXNzXG4gKiBAY2xhc3MgdGlueW1jZS51aS5Db2xvckJ1dHRvblxuICogQGV4dGVuZHMgdGlueW1jZS51aS5QYW5lbEJ1dHRvblxuICovXG5kZWZpbmUoXCJ0aW55bWNlL3VpL0NvbG9yQnV0dG9uXCIsIFtcblx0XCJ0aW55bWNlL3VpL1BhbmVsQnV0dG9uXCIsXG5cdFwidGlueW1jZS9kb20vRE9NVXRpbHNcIlxuXSwgZnVuY3Rpb24oUGFuZWxCdXR0b24sIERvbVV0aWxzKSB7XG5cdFwidXNlIHN0cmljdFwiO1xuXG5cdHZhciBET00gPSBEb21VdGlscy5ET007XG5cblx0cmV0dXJuIFBhbmVsQnV0dG9uLmV4dGVuZCh7XG5cdFx0LyoqXG5cdFx0ICogQ29uc3RydWN0cyBhIG5ldyBDb2xvckJ1dHRvbiBpbnN0YW5jZSB3aXRoIHRoZSBzcGVjaWZpZWQgc2V0dGluZ3MuXG5cdFx0ICpcblx0XHQgKiBAY29uc3RydWN0b3Jcblx0XHQgKiBAcGFyYW0ge09iamVjdH0gc2V0dGluZ3MgTmFtZS92YWx1ZSBvYmplY3Qgd2l0aCBzZXR0aW5ncy5cblx0XHQgKi9cblx0XHRpbml0OiBmdW5jdGlvbihzZXR0aW5ncykge1xuXHRcdFx0dGhpcy5fc3VwZXIoc2V0dGluZ3MpO1xuXHRcdFx0dGhpcy5jbGFzc2VzLmFkZCgnY29sb3JidXR0b24nKTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogR2V0dGVyL3NldHRlciBmb3IgdGhlIGN1cnJlbnQgY29sb3IuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGNvbG9yXG5cdFx0ICogQHBhcmFtIHtTdHJpbmd9IFtjb2xvcl0gQ29sb3IgdG8gc2V0LlxuXHRcdCAqIEByZXR1cm4ge1N0cmluZ3x0aW55bWNlLnVpLkNvbG9yQnV0dG9ufSBDdXJyZW50IGNvbG9yIG9yIGN1cnJlbnQgaW5zdGFuY2UuXG5cdFx0ICovXG5cdFx0Y29sb3I6IGZ1bmN0aW9uKGNvbG9yKSB7XG5cdFx0XHRpZiAoY29sb3IpIHtcblx0XHRcdFx0dGhpcy5fY29sb3IgPSBjb2xvcjtcblx0XHRcdFx0dGhpcy5nZXRFbCgncHJldmlldycpLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGNvbG9yO1xuXHRcdFx0XHRyZXR1cm4gdGhpcztcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHRoaXMuX2NvbG9yO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZXNldHMgdGhlIGN1cnJlbnQgY29sb3IuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHJlc2V0Q29sb3Jcblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLnVpLkNvbG9yQnV0dG9ufSBDdXJyZW50IGluc3RhbmNlLlxuXHRcdCAqL1xuXHRcdHJlc2V0Q29sb3I6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dGhpcy5fY29sb3IgPSBudWxsO1xuXHRcdFx0dGhpcy5nZXRFbCgncHJldmlldycpLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IG51bGw7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmVuZGVycyB0aGUgY29udHJvbCBhcyBhIEhUTUwgc3RyaW5nLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCByZW5kZXJIdG1sXG5cdFx0ICogQHJldHVybiB7U3RyaW5nfSBIVE1MIHJlcHJlc2VudGluZyB0aGUgY29udHJvbC5cblx0XHQgKi9cblx0XHRyZW5kZXJIdG1sOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgaWQgPSBzZWxmLl9pZCwgcHJlZml4ID0gc2VsZi5jbGFzc1ByZWZpeCwgdGV4dCA9IHNlbGYuc3RhdGUuZ2V0KCd0ZXh0Jyk7XG5cdFx0XHR2YXIgaWNvbiA9IHNlbGYuc2V0dGluZ3MuaWNvbiA/IHByZWZpeCArICdpY28gJyArIHByZWZpeCArICdpLScgKyBzZWxmLnNldHRpbmdzLmljb24gOiAnJztcblx0XHRcdHZhciBpbWFnZSA9IHNlbGYuc2V0dGluZ3MuaW1hZ2UgPyAnIHN0eWxlPVwiYmFja2dyb3VuZC1pbWFnZTogdXJsKFxcJycgKyBzZWxmLnNldHRpbmdzLmltYWdlICsgJ1xcJylcIicgOiAnJyxcblx0XHRcdFx0dGV4dEh0bWwgPSAnJztcblxuXHRcdFx0aWYgKHRleHQpIHtcblx0XHRcdFx0c2VsZi5jbGFzc2VzLmFkZCgnYnRuLWhhcy10ZXh0Jyk7XG5cdFx0XHRcdHRleHRIdG1sID0gJzxzcGFuIGNsYXNzPVwiJyArIHByZWZpeCArICd0eHRcIj4nICsgc2VsZi5lbmNvZGUodGV4dCkgKyAnPC9zcGFuPic7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiAoXG5cdFx0XHRcdCc8ZGl2IGlkPVwiJyArIGlkICsgJ1wiIGNsYXNzPVwiJyArIHNlbGYuY2xhc3NlcyArICdcIiByb2xlPVwiYnV0dG9uXCIgdGFiaW5kZXg9XCItMVwiIGFyaWEtaGFzcG9wdXA9XCJ0cnVlXCI+JyArXG5cdFx0XHRcdFx0JzxidXR0b24gcm9sZT1cInByZXNlbnRhdGlvblwiIGhpZGVmb2N1cz1cIjFcIiB0eXBlPVwiYnV0dG9uXCIgdGFiaW5kZXg9XCItMVwiPicgK1xuXHRcdFx0XHRcdFx0KGljb24gPyAnPGkgY2xhc3M9XCInICsgaWNvbiArICdcIicgKyBpbWFnZSArICc+PC9pPicgOiAnJykgK1xuXHRcdFx0XHRcdFx0JzxzcGFuIGlkPVwiJyArIGlkICsgJy1wcmV2aWV3XCIgY2xhc3M9XCInICsgcHJlZml4ICsgJ3ByZXZpZXdcIj48L3NwYW4+JyArXG5cdFx0XHRcdFx0XHR0ZXh0SHRtbCArXG5cdFx0XHRcdFx0JzwvYnV0dG9uPicgK1xuXHRcdFx0XHRcdCc8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBjbGFzcz1cIicgKyBwcmVmaXggKyAnb3BlblwiIGhpZGVmb2N1cz1cIjFcIiB0YWJpbmRleD1cIi0xXCI+JyArXG5cdFx0XHRcdFx0XHQnIDxpIGNsYXNzPVwiJyArIHByZWZpeCArICdjYXJldFwiPjwvaT4nICtcblx0XHRcdFx0XHQnPC9idXR0b24+JyArXG5cdFx0XHRcdCc8L2Rpdj4nXG5cdFx0XHQpO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBDYWxsZWQgYWZ0ZXIgdGhlIGNvbnRyb2wgaGFzIGJlZW4gcmVuZGVyZWQuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHBvc3RSZW5kZXJcblx0XHQgKi9cblx0XHRwb3N0UmVuZGVyOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgb25DbGlja0hhbmRsZXIgPSBzZWxmLnNldHRpbmdzLm9uY2xpY2s7XG5cblx0XHRcdHNlbGYub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRpZiAoZS5hcmlhICYmIGUuYXJpYS5rZXkgPT0gJ2Rvd24nKSB7XG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKGUuY29udHJvbCA9PSBzZWxmICYmICFET00uZ2V0UGFyZW50KGUudGFyZ2V0LCAnLicgKyBzZWxmLmNsYXNzUHJlZml4ICsgJ29wZW4nKSkge1xuXHRcdFx0XHRcdGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdFx0b25DbGlja0hhbmRsZXIuY2FsbChzZWxmLCBlKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdGRlbGV0ZSBzZWxmLnNldHRpbmdzLm9uY2xpY2s7XG5cblx0XHRcdHJldHVybiBzZWxmLl9zdXBlcigpO1xuXHRcdH1cblx0fSk7XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL3V0aWwvQ29sb3IuanNcblxuLyoqXG4gKiBDb2xvci5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE1IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKipcbiAqIFRoaXMgY2xhc3MgbGV0cyB5b3UgcGFyc2Uvc2VyaWFsaXplIGNvbG9ycyBhbmQgY29udmVydCByZ2IvaHNiLlxuICpcbiAqIEBjbGFzcyB0aW55bWNlLnV0aWwuQ29sb3JcbiAqIEBleGFtcGxlXG4gKiB2YXIgd2hpdGUgPSBuZXcgdGlueW1jZS51dGlsLkNvbG9yKHtyOiAyNTUsIGc6IDI1NSwgYjogMjU1fSk7XG4gKiB2YXIgcmVkID0gbmV3IHRpbnltY2UudXRpbC5Db2xvcignI0ZGMDAwMCcpO1xuICpcbiAqIGNvbnNvbGUubG9nKHdoaXRlLnRvSGV4KCksIHJlZC50b0hzdigpKTtcbiAqL1xuZGVmaW5lKFwidGlueW1jZS91dGlsL0NvbG9yXCIsIFtdLCBmdW5jdGlvbigpIHtcblx0dmFyIG1pbiA9IE1hdGgubWluLCBtYXggPSBNYXRoLm1heCwgcm91bmQgPSBNYXRoLnJvdW5kO1xuXG5cdC8qKlxuXHQgKiBDb25zdHJ1Y3RzIGEgbmV3IGNvbG9yIGluc3RhbmNlLlxuXHQgKlxuXHQgKiBAY29uc3RydWN0b3Jcblx0ICogQG1ldGhvZCBDb2xvclxuXHQgKiBAcGFyYW0ge1N0cmluZ30gdmFsdWUgT3B0aW9uYWwgaW5pdGlhbCB2YWx1ZSB0byBwYXJzZS5cblx0ICovXG5cdGZ1bmN0aW9uIENvbG9yKHZhbHVlKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLCByID0gMCwgZyA9IDAsIGIgPSAwO1xuXG5cdFx0ZnVuY3Rpb24gcmdiMmhzdihyLCBnLCBiKSB7XG5cdFx0XHR2YXIgaCwgcywgdiwgZCwgbWluUkdCLCBtYXhSR0I7XG5cblx0XHRcdGggPSAwO1xuXHRcdFx0cyA9IDA7XG5cdFx0XHR2ID0gMDtcblx0XHRcdHIgPSByIC8gMjU1O1xuXHRcdFx0ZyA9IGcgLyAyNTU7XG5cdFx0XHRiID0gYiAvIDI1NTtcblxuXHRcdFx0bWluUkdCID0gbWluKHIsIG1pbihnLCBiKSk7XG5cdFx0XHRtYXhSR0IgPSBtYXgociwgbWF4KGcsIGIpKTtcblxuXHRcdFx0aWYgKG1pblJHQiA9PSBtYXhSR0IpIHtcblx0XHRcdFx0diA9IG1pblJHQjtcblxuXHRcdFx0XHRyZXR1cm4ge1xuXHRcdFx0XHRcdGg6IDAsXG5cdFx0XHRcdFx0czogMCxcblx0XHRcdFx0XHR2OiB2ICogMTAwXG5cdFx0XHRcdH07XG5cdFx0XHR9XG5cblx0XHRcdC8qZXNsaW50IG5vLW5lc3RlZC10ZXJuYXJ5OjAgKi9cblx0XHRcdGQgPSAociA9PSBtaW5SR0IpID8gZyAtIGIgOiAoKGIgPT0gbWluUkdCKSA/IHIgLSBnIDogYiAtIHIpO1xuXHRcdFx0aCA9IChyID09IG1pblJHQikgPyAzIDogKChiID09IG1pblJHQikgPyAxIDogNSk7XG5cdFx0XHRoID0gNjAgKiAoaCAtIGQgLyAobWF4UkdCIC0gbWluUkdCKSk7XG5cdFx0XHRzID0gKG1heFJHQiAtIG1pblJHQikgLyBtYXhSR0I7XG5cdFx0XHR2ID0gbWF4UkdCO1xuXG5cdFx0XHRyZXR1cm4ge1xuXHRcdFx0XHRoOiByb3VuZChoKSxcblx0XHRcdFx0czogcm91bmQocyAqIDEwMCksXG5cdFx0XHRcdHY6IHJvdW5kKHYgKiAxMDApXG5cdFx0XHR9O1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIGhzdlRvUmdiKGh1ZSwgc2F0dXJhdGlvbiwgYnJpZ2h0bmVzcykge1xuXHRcdFx0dmFyIHNpZGUsIGNocm9tYSwgeCwgbWF0Y2g7XG5cblx0XHRcdGh1ZSA9IChwYXJzZUludChodWUsIDEwKSB8fCAwKSAlIDM2MDtcblx0XHRcdHNhdHVyYXRpb24gPSBwYXJzZUludChzYXR1cmF0aW9uLCAxMCkgLyAxMDA7XG5cdFx0XHRicmlnaHRuZXNzID0gcGFyc2VJbnQoYnJpZ2h0bmVzcywgMTApIC8gMTAwO1xuXHRcdFx0c2F0dXJhdGlvbiA9IG1heCgwLCBtaW4oc2F0dXJhdGlvbiwgMSkpO1xuXHRcdFx0YnJpZ2h0bmVzcyA9IG1heCgwLCBtaW4oYnJpZ2h0bmVzcywgMSkpO1xuXG5cdFx0XHRpZiAoc2F0dXJhdGlvbiA9PT0gMCkge1xuXHRcdFx0XHRyID0gZyA9IGIgPSByb3VuZCgyNTUgKiBicmlnaHRuZXNzKTtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHRzaWRlID0gaHVlIC8gNjA7XG5cdFx0XHRjaHJvbWEgPSBicmlnaHRuZXNzICogc2F0dXJhdGlvbjtcblx0XHRcdHggPSBjaHJvbWEgKiAoMSAtIE1hdGguYWJzKHNpZGUgJSAyIC0gMSkpO1xuXHRcdFx0bWF0Y2ggPSBicmlnaHRuZXNzIC0gY2hyb21hO1xuXG5cdFx0XHRzd2l0Y2ggKE1hdGguZmxvb3Ioc2lkZSkpIHtcblx0XHRcdFx0Y2FzZSAwOlxuXHRcdFx0XHRcdHIgPSBjaHJvbWE7XG5cdFx0XHRcdFx0ZyA9IHg7XG5cdFx0XHRcdFx0YiA9IDA7XG5cdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0Y2FzZSAxOlxuXHRcdFx0XHRcdHIgPSB4O1xuXHRcdFx0XHRcdGcgPSBjaHJvbWE7XG5cdFx0XHRcdFx0YiA9IDA7XG5cdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0Y2FzZSAyOlxuXHRcdFx0XHRcdHIgPSAwO1xuXHRcdFx0XHRcdGcgPSBjaHJvbWE7XG5cdFx0XHRcdFx0YiA9IHg7XG5cdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0Y2FzZSAzOlxuXHRcdFx0XHRcdHIgPSAwO1xuXHRcdFx0XHRcdGcgPSB4O1xuXHRcdFx0XHRcdGIgPSBjaHJvbWE7XG5cdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0Y2FzZSA0OlxuXHRcdFx0XHRcdHIgPSB4O1xuXHRcdFx0XHRcdGcgPSAwO1xuXHRcdFx0XHRcdGIgPSBjaHJvbWE7XG5cdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0Y2FzZSA1OlxuXHRcdFx0XHRcdHIgPSBjaHJvbWE7XG5cdFx0XHRcdFx0ZyA9IDA7XG5cdFx0XHRcdFx0YiA9IHg7XG5cdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0XHRyID0gZyA9IGIgPSAwO1xuXHRcdFx0fVxuXG5cdFx0XHRyID0gcm91bmQoMjU1ICogKHIgKyBtYXRjaCkpO1xuXHRcdFx0ZyA9IHJvdW5kKDI1NSAqIChnICsgbWF0Y2gpKTtcblx0XHRcdGIgPSByb3VuZCgyNTUgKiAoYiArIG1hdGNoKSk7XG5cdFx0fVxuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyB0aGUgaGV4IHN0cmluZyBvZiB0aGUgY3VycmVudCBjb2xvci4gRm9yIGV4YW1wbGU6ICNmZjAwZmZcblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgdG9IZXhcblx0XHQgKiBAcmV0dXJuIHtTdHJpbmd9IEhleCBzdHJpbmcgb2YgY3VycmVudCBjb2xvci5cblx0XHQgKi9cblx0XHRmdW5jdGlvbiB0b0hleCgpIHtcblx0XHRcdGZ1bmN0aW9uIGhleCh2YWwpIHtcblx0XHRcdFx0dmFsID0gcGFyc2VJbnQodmFsLCAxMCkudG9TdHJpbmcoMTYpO1xuXG5cdFx0XHRcdHJldHVybiB2YWwubGVuZ3RoID4gMSA/IHZhbCA6ICcwJyArIHZhbDtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuICcjJyArIGhleChyKSArIGhleChnKSArIGhleChiKTtcblx0XHR9XG5cblx0XHQvKipcblx0XHQgKiBSZXR1cm5zIHRoZSByLCBnLCBiIHZhbHVlcyBvZiB0aGUgY29sb3IuIEVhY2ggY2hhbm5lbCBoYXMgYSByYW5nZSBmcm9tIDAtMjU1LlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCB0b1JnYlxuXHRcdCAqIEByZXR1cm4ge09iamVjdH0gT2JqZWN0IHdpdGggciwgZywgYiBmaWVsZHMuXG5cdFx0ICovXG5cdFx0ZnVuY3Rpb24gdG9SZ2IoKSB7XG5cdFx0XHRyZXR1cm4ge1xuXHRcdFx0XHRyOiByLFxuXHRcdFx0XHRnOiBnLFxuXHRcdFx0XHRiOiBiXG5cdFx0XHR9O1xuXHRcdH1cblxuXHRcdC8qKlxuXHRcdCAqIFJldHVybnMgdGhlIGgsIHMsIHYgdmFsdWVzIG9mIHRoZSBjb2xvci4gUmFuZ2VzOiBoPTAtMzYwLCBzPTAtMTAwLCB2PTAtMTAwLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCB0b0hzdlxuXHRcdCAqIEByZXR1cm4ge09iamVjdH0gT2JqZWN0IHdpdGggaCwgcywgdiBmaWVsZHMuXG5cdFx0ICovXG5cdFx0ZnVuY3Rpb24gdG9Ic3YoKSB7XG5cdFx0XHRyZXR1cm4gcmdiMmhzdihyLCBnLCBiKTtcblx0XHR9XG5cblx0XHQvKipcblx0XHQgKiBQYXJzZXMgdGhlIHNwZWNpZmllZCB2YWx1ZSBhbmQgcG9wdWxhdGVzIHRoZSBjb2xvciBpbnN0YW5jZS5cblx0XHQgKlxuXHRcdCAqIFN1cHBvcnRlZCBmb3JtYXQgZXhhbXBsZXM6XG5cdFx0ICogICogcmJnKDI1NSwwLDApXG5cdFx0ICogICogI2ZmMDAwMFxuXHRcdCAqICAqICNmZmZcblx0XHQgKiAgKiB7cjogMjU1LCBnOiAwLCBiOiAwfVxuXHRcdCAqICAqIHtoOiAzNjAsIHM6IDEwMCwgdjogMTAwfVxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBwYXJzZVxuXHRcdCAqIEBwYXJhbSB7T2JqZWN0L1N0cmluZ30gdmFsdWUgQ29sb3IgdmFsdWUgdG8gcGFyc2UuXG5cdFx0ICogQHJldHVybiB7dGlueW1jZS51dGlsLkNvbG9yfSBDdXJyZW50IGNvbG9yIGluc3RhbmNlLlxuXHRcdCAqL1xuXHRcdGZ1bmN0aW9uIHBhcnNlKHZhbHVlKSB7XG5cdFx0XHR2YXIgbWF0Y2hlcztcblxuXHRcdFx0aWYgKHR5cGVvZiB2YWx1ZSA9PSAnb2JqZWN0Jykge1xuXHRcdFx0XHRpZiAoXCJyXCIgaW4gdmFsdWUpIHtcblx0XHRcdFx0XHRyID0gdmFsdWUucjtcblx0XHRcdFx0XHRnID0gdmFsdWUuZztcblx0XHRcdFx0XHRiID0gdmFsdWUuYjtcblx0XHRcdFx0fSBlbHNlIGlmIChcInZcIiBpbiB2YWx1ZSkge1xuXHRcdFx0XHRcdGhzdlRvUmdiKHZhbHVlLmgsIHZhbHVlLnMsIHZhbHVlLnYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRpZiAoKG1hdGNoZXMgPSAvcmdiXFxzKlxcKFxccyooWzAtOV0rKVxccyosXFxzKihbMC05XSspXFxzKixcXHMqKFswLTldKylbXlxcKV0qXFwpL2dpLmV4ZWModmFsdWUpKSkge1xuXHRcdFx0XHRcdHIgPSBwYXJzZUludChtYXRjaGVzWzFdLCAxMCk7XG5cdFx0XHRcdFx0ZyA9IHBhcnNlSW50KG1hdGNoZXNbMl0sIDEwKTtcblx0XHRcdFx0XHRiID0gcGFyc2VJbnQobWF0Y2hlc1szXSwgMTApO1xuXHRcdFx0XHR9IGVsc2UgaWYgKChtYXRjaGVzID0gLyMoWzAtRl17Mn0pKFswLUZdezJ9KShbMC1GXXsyfSkvZ2kuZXhlYyh2YWx1ZSkpKSB7XG5cdFx0XHRcdFx0ciA9IHBhcnNlSW50KG1hdGNoZXNbMV0sIDE2KTtcblx0XHRcdFx0XHRnID0gcGFyc2VJbnQobWF0Y2hlc1syXSwgMTYpO1xuXHRcdFx0XHRcdGIgPSBwYXJzZUludChtYXRjaGVzWzNdLCAxNik7XG5cdFx0XHRcdH0gZWxzZSBpZiAoKG1hdGNoZXMgPSAvIyhbMC1GXSkoWzAtRl0pKFswLUZdKS9naS5leGVjKHZhbHVlKSkpIHtcblx0XHRcdFx0XHRyID0gcGFyc2VJbnQobWF0Y2hlc1sxXSArIG1hdGNoZXNbMV0sIDE2KTtcblx0XHRcdFx0XHRnID0gcGFyc2VJbnQobWF0Y2hlc1syXSArIG1hdGNoZXNbMl0sIDE2KTtcblx0XHRcdFx0XHRiID0gcGFyc2VJbnQobWF0Y2hlc1szXSArIG1hdGNoZXNbM10sIDE2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRyID0gciA8IDAgPyAwIDogKHIgPiAyNTUgPyAyNTUgOiByKTtcblx0XHRcdGcgPSBnIDwgMCA/IDAgOiAoZyA+IDI1NSA/IDI1NSA6IGcpO1xuXHRcdFx0YiA9IGIgPCAwID8gMCA6IChiID4gMjU1ID8gMjU1IDogYik7XG5cblx0XHRcdHJldHVybiBzZWxmO1xuXHRcdH1cblxuXHRcdGlmICh2YWx1ZSkge1xuXHRcdFx0cGFyc2UodmFsdWUpO1xuXHRcdH1cblxuXHRcdHNlbGYudG9SZ2IgPSB0b1JnYjtcblx0XHRzZWxmLnRvSHN2ID0gdG9Ic3Y7XG5cdFx0c2VsZi50b0hleCA9IHRvSGV4O1xuXHRcdHNlbGYucGFyc2UgPSBwYXJzZTtcblx0fVxuXG5cdHJldHVybiBDb2xvcjtcbn0pO1xuXG4vLyBJbmNsdWRlZCBmcm9tOiBqcy90aW55bWNlL2NsYXNzZXMvdWkvQ29sb3JQaWNrZXIuanNcblxuLyoqXG4gKiBDb2xvclBpY2tlci5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE1IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKipcbiAqIENvbG9yIHBpY2tlciB3aWRnZXQgbGV0cyB5b3Ugc2VsZWN0IGNvbG9ycy5cbiAqXG4gKiBALXgtbGVzcyBDb2xvclBpY2tlci5sZXNzXG4gKiBAY2xhc3MgdGlueW1jZS51aS5Db2xvclBpY2tlclxuICogQGV4dGVuZHMgdGlueW1jZS51aS5XaWRnZXRcbiAqL1xuZGVmaW5lKFwidGlueW1jZS91aS9Db2xvclBpY2tlclwiLCBbXG5cdFwidGlueW1jZS91aS9XaWRnZXRcIixcblx0XCJ0aW55bWNlL3VpL0RyYWdIZWxwZXJcIixcblx0XCJ0aW55bWNlL3VpL0RvbVV0aWxzXCIsXG5cdFwidGlueW1jZS91dGlsL0NvbG9yXCJcbl0sIGZ1bmN0aW9uKFdpZGdldCwgRHJhZ0hlbHBlciwgRG9tVXRpbHMsIENvbG9yKSB7XG5cdFwidXNlIHN0cmljdFwiO1xuXG5cdHJldHVybiBXaWRnZXQuZXh0ZW5kKHtcblx0XHREZWZhdWx0czoge1xuXHRcdFx0Y2xhc3NlczogXCJ3aWRnZXQgY29sb3JwaWNrZXJcIlxuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBDb25zdHJ1Y3RzIGEgbmV3IGNvbG9ycGlja2VyIGluc3RhbmNlIHdpdGggdGhlIHNwZWNpZmllZCBzZXR0aW5ncy5cblx0XHQgKlxuXHRcdCAqIEBjb25zdHJ1Y3RvclxuXHRcdCAqIEBwYXJhbSB7T2JqZWN0fSBzZXR0aW5ncyBOYW1lL3ZhbHVlIG9iamVjdCB3aXRoIHNldHRpbmdzLlxuXHRcdCAqIEBzZXR0aW5nIHtTdHJpbmd9IGNvbG9yIEluaXRpYWwgY29sb3IgdmFsdWUuXG5cdFx0ICovXG5cdFx0aW5pdDogZnVuY3Rpb24oc2V0dGluZ3MpIHtcblx0XHRcdHRoaXMuX3N1cGVyKHNldHRpbmdzKTtcblx0XHR9LFxuXG5cdFx0cG9zdFJlbmRlcjogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIGNvbG9yID0gc2VsZi5jb2xvcigpLCBoc3YsIGh1ZVJvb3RFbG0sIGh1ZVBvaW50RWxtLCBzdlJvb3RFbG0sIHN2UG9pbnRFbG07XG5cblx0XHRcdGh1ZVJvb3RFbG0gPSBzZWxmLmdldEVsKCdoJyk7XG5cdFx0XHRodWVQb2ludEVsbSA9IHNlbGYuZ2V0RWwoJ2hwJyk7XG5cdFx0XHRzdlJvb3RFbG0gPSBzZWxmLmdldEVsKCdzdicpO1xuXHRcdFx0c3ZQb2ludEVsbSA9IHNlbGYuZ2V0RWwoJ3N2cCcpO1xuXG5cdFx0XHRmdW5jdGlvbiBnZXRQb3MoZWxtLCBldmVudCkge1xuXHRcdFx0XHR2YXIgcG9zID0gRG9tVXRpbHMuZ2V0UG9zKGVsbSksIHgsIHk7XG5cblx0XHRcdFx0eCA9IGV2ZW50LnBhZ2VYIC0gcG9zLng7XG5cdFx0XHRcdHkgPSBldmVudC5wYWdlWSAtIHBvcy55O1xuXG5cdFx0XHRcdHggPSBNYXRoLm1heCgwLCBNYXRoLm1pbih4IC8gZWxtLmNsaWVudFdpZHRoLCAxKSk7XG5cdFx0XHRcdHkgPSBNYXRoLm1heCgwLCBNYXRoLm1pbih5IC8gZWxtLmNsaWVudEhlaWdodCwgMSkpO1xuXG5cdFx0XHRcdHJldHVybiB7XG5cdFx0XHRcdFx0eDogeCxcblx0XHRcdFx0XHR5OiB5XG5cdFx0XHRcdH07XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIHVwZGF0ZUNvbG9yKGhzdiwgaHVlVXBkYXRlKSB7XG5cdFx0XHRcdHZhciBodWUgPSAoMzYwIC0gaHN2LmgpIC8gMzYwO1xuXG5cdFx0XHRcdERvbVV0aWxzLmNzcyhodWVQb2ludEVsbSwge1xuXHRcdFx0XHRcdHRvcDogKGh1ZSAqIDEwMCkgKyAnJSdcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0aWYgKCFodWVVcGRhdGUpIHtcblx0XHRcdFx0XHREb21VdGlscy5jc3Moc3ZQb2ludEVsbSwge1xuXHRcdFx0XHRcdFx0bGVmdDogaHN2LnMgKyAnJScsXG5cdFx0XHRcdFx0XHR0b3A6ICgxMDAgLSBoc3YudikgKyAnJSdcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHN2Um9vdEVsbS5zdHlsZS5iYWNrZ3JvdW5kID0gbmV3IENvbG9yKHtzOiAxMDAsIHY6IDEwMCwgaDogaHN2Lmh9KS50b0hleCgpO1xuXHRcdFx0XHRzZWxmLmNvbG9yKCkucGFyc2Uoe3M6IGhzdi5zLCB2OiBoc3YudiwgaDogaHN2Lmh9KTtcblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gdXBkYXRlU2F0dXJhdGlvbkFuZFZhbHVlKGUpIHtcblx0XHRcdFx0dmFyIHBvcztcblxuXHRcdFx0XHRwb3MgPSBnZXRQb3Moc3ZSb290RWxtLCBlKTtcblx0XHRcdFx0aHN2LnMgPSBwb3MueCAqIDEwMDtcblx0XHRcdFx0aHN2LnYgPSAoMSAtIHBvcy55KSAqIDEwMDtcblxuXHRcdFx0XHR1cGRhdGVDb2xvcihoc3YpO1xuXHRcdFx0XHRzZWxmLmZpcmUoJ2NoYW5nZScpO1xuXHRcdFx0fVxuXG5cdFx0XHRmdW5jdGlvbiB1cGRhdGVIdWUoZSkge1xuXHRcdFx0XHR2YXIgcG9zO1xuXG5cdFx0XHRcdHBvcyA9IGdldFBvcyhodWVSb290RWxtLCBlKTtcblx0XHRcdFx0aHN2ID0gY29sb3IudG9Ic3YoKTtcblx0XHRcdFx0aHN2LmggPSAoMSAtIHBvcy55KSAqIDM2MDtcblx0XHRcdFx0dXBkYXRlQ29sb3IoaHN2LCB0cnVlKTtcblx0XHRcdFx0c2VsZi5maXJlKCdjaGFuZ2UnKTtcblx0XHRcdH1cblxuXHRcdFx0c2VsZi5fcmVwYWludCA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRoc3YgPSBjb2xvci50b0hzdigpO1xuXHRcdFx0XHR1cGRhdGVDb2xvcihoc3YpO1xuXHRcdFx0fTtcblxuXHRcdFx0c2VsZi5fc3VwZXIoKTtcblxuXHRcdFx0c2VsZi5fc3ZkcmFnaGVscGVyID0gbmV3IERyYWdIZWxwZXIoc2VsZi5faWQgKyAnLXN2Jywge1xuXHRcdFx0XHRzdGFydDogdXBkYXRlU2F0dXJhdGlvbkFuZFZhbHVlLFxuXHRcdFx0XHRkcmFnOiB1cGRhdGVTYXR1cmF0aW9uQW5kVmFsdWVcblx0XHRcdH0pO1xuXG5cdFx0XHRzZWxmLl9oZHJhZ2hlbHBlciA9IG5ldyBEcmFnSGVscGVyKHNlbGYuX2lkICsgJy1oJywge1xuXHRcdFx0XHRzdGFydDogdXBkYXRlSHVlLFxuXHRcdFx0XHRkcmFnOiB1cGRhdGVIdWVcblx0XHRcdH0pO1xuXG5cdFx0XHRzZWxmLl9yZXBhaW50KCk7XG5cdFx0fSxcblxuXHRcdHJnYjogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5jb2xvcigpLnRvUmdiKCk7XG5cdFx0fSxcblxuXHRcdHZhbHVlOiBmdW5jdGlvbih2YWx1ZSkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCkge1xuXHRcdFx0XHRzZWxmLmNvbG9yKCkucGFyc2UodmFsdWUpO1xuXG5cdFx0XHRcdGlmIChzZWxmLl9yZW5kZXJlZCkge1xuXHRcdFx0XHRcdHNlbGYuX3JlcGFpbnQoKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0cmV0dXJuIHNlbGYuY29sb3IoKS50b0hleCgpO1xuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHRjb2xvcjogZnVuY3Rpb24oKSB7XG5cdFx0XHRpZiAoIXRoaXMuX2NvbG9yKSB7XG5cdFx0XHRcdHRoaXMuX2NvbG9yID0gbmV3IENvbG9yKCk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiB0aGlzLl9jb2xvcjtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmVuZGVycyB0aGUgY29udHJvbCBhcyBhIEhUTUwgc3RyaW5nLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCByZW5kZXJIdG1sXG5cdFx0ICogQHJldHVybiB7U3RyaW5nfSBIVE1MIHJlcHJlc2VudGluZyB0aGUgY29udHJvbC5cblx0XHQgKi9cblx0XHRyZW5kZXJIdG1sOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgaWQgPSBzZWxmLl9pZCwgcHJlZml4ID0gc2VsZi5jbGFzc1ByZWZpeCwgaHVlSHRtbDtcblx0XHRcdHZhciBzdG9wcyA9ICcjZmYwMDAwLCNmZjAwODAsI2ZmMDBmZiwjODAwMGZmLCMwMDAwZmYsIzAwODBmZiwjMDBmZmZmLCMwMGZmODAsIzAwZmYwMCwjODBmZjAwLCNmZmZmMDAsI2ZmODAwMCwjZmYwMDAwJztcblxuXHRcdFx0ZnVuY3Rpb24gZ2V0T2xkSWVGYWxsYmFja0h0bWwoKSB7XG5cdFx0XHRcdHZhciBpLCBsLCBodG1sID0gJycsIGdyYWRpZW50UHJlZml4LCBzdG9wc0xpc3Q7XG5cblx0XHRcdFx0Z3JhZGllbnRQcmVmaXggPSAnZmlsdGVyOnByb2dpZDpEWEltYWdlVHJhbnNmb3JtLk1pY3Jvc29mdC5ncmFkaWVudChHcmFkaWVudFR5cGU9MCxzdGFydENvbG9yc3RyPSc7XG5cdFx0XHRcdHN0b3BzTGlzdCA9IHN0b3BzLnNwbGl0KCcsJyk7XG5cdFx0XHRcdGZvciAoaSA9IDAsIGwgPSBzdG9wc0xpc3QubGVuZ3RoIC0gMTsgaSA8IGw7IGkrKykge1xuXHRcdFx0XHRcdGh0bWwgKz0gKFxuXHRcdFx0XHRcdFx0JzxkaXYgY2xhc3M9XCInICsgcHJlZml4ICsgJ2NvbG9ycGlja2VyLWgtY2h1bmtcIiBzdHlsZT1cIicgK1xuXHRcdFx0XHRcdFx0XHQnaGVpZ2h0OicgKyAoMTAwIC8gbCkgKyAnJTsnICtcblx0XHRcdFx0XHRcdFx0Z3JhZGllbnRQcmVmaXggKyBzdG9wc0xpc3RbaV0gKyAnLGVuZENvbG9yc3RyPScgKyBzdG9wc0xpc3RbaSArIDFdICsgJyk7JyArXG5cdFx0XHRcdFx0XHRcdCctbXMtJyArIGdyYWRpZW50UHJlZml4ICsgc3RvcHNMaXN0W2ldICsgJyxlbmRDb2xvcnN0cj0nICsgc3RvcHNMaXN0W2kgKyAxXSArICcpJyArXG5cdFx0XHRcdFx0XHQnXCI+PC9kaXY+J1xuXHRcdFx0XHRcdCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gaHRtbDtcblx0XHRcdH1cblxuXHRcdFx0dmFyIGdyYWRpZW50Q3NzVGV4dCA9IChcblx0XHRcdFx0J2JhY2tncm91bmQ6IC1tcy1saW5lYXItZ3JhZGllbnQodG9wLCcgKyBzdG9wcyArICcpOycgK1xuXHRcdFx0XHQnYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KHRvIGJvdHRvbSwnICsgc3RvcHMgKyAnKTsnXG5cdFx0XHQpO1xuXG5cdFx0XHRodWVIdG1sID0gKFxuXHRcdFx0XHQnPGRpdiBpZD1cIicgKyBpZCArICctaFwiIGNsYXNzPVwiJyArIHByZWZpeCArICdjb2xvcnBpY2tlci1oXCIgc3R5bGU9XCInICsgZ3JhZGllbnRDc3NUZXh0ICsgJ1wiPicgK1xuXHRcdFx0XHRcdGdldE9sZEllRmFsbGJhY2tIdG1sKCkgK1xuXHRcdFx0XHRcdCc8ZGl2IGlkPVwiJyArIGlkICsgJy1ocFwiIGNsYXNzPVwiJyArIHByZWZpeCArICdjb2xvcnBpY2tlci1oLW1hcmtlclwiPjwvZGl2PicgK1xuXHRcdFx0XHQnPC9kaXY+J1xuXHRcdFx0KTtcblxuXHRcdFx0cmV0dXJuIChcblx0XHRcdFx0JzxkaXYgaWQ9XCInICsgaWQgKyAnXCIgY2xhc3M9XCInICsgc2VsZi5jbGFzc2VzICsgJ1wiPicgK1xuXHRcdFx0XHRcdCc8ZGl2IGlkPVwiJyArIGlkICsgJy1zdlwiIGNsYXNzPVwiJyArIHByZWZpeCArICdjb2xvcnBpY2tlci1zdlwiPicgK1xuXHRcdFx0XHRcdFx0JzxkaXYgY2xhc3M9XCInICsgcHJlZml4ICsgJ2NvbG9ycGlja2VyLW92ZXJsYXkxXCI+JyArXG5cdFx0XHRcdFx0XHRcdCc8ZGl2IGNsYXNzPVwiJyArIHByZWZpeCArICdjb2xvcnBpY2tlci1vdmVybGF5MlwiPicgK1xuXHRcdFx0XHRcdFx0XHRcdCc8ZGl2IGlkPVwiJyArIGlkICsgJy1zdnBcIiBjbGFzcz1cIicgKyBwcmVmaXggKyAnY29sb3JwaWNrZXItc2VsZWN0b3IxXCI+JyArXG5cdFx0XHRcdFx0XHRcdFx0XHQnPGRpdiBjbGFzcz1cIicgKyBwcmVmaXggKyAnY29sb3JwaWNrZXItc2VsZWN0b3IyXCI+PC9kaXY+JyArXG5cdFx0XHRcdFx0XHRcdFx0JzwvZGl2PicgK1xuXHRcdFx0XHRcdFx0XHQnPC9kaXY+JyArXG5cdFx0XHRcdFx0XHQnPC9kaXY+JyArXG5cdFx0XHRcdFx0JzwvZGl2PicgK1xuXHRcdFx0XHRcdGh1ZUh0bWwgK1xuXHRcdFx0XHQnPC9kaXY+J1xuXHRcdFx0KTtcblx0XHR9XG5cdH0pO1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy91aS9QYXRoLmpzXG5cbi8qKlxuICogUGF0aC5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE1IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKipcbiAqIENyZWF0ZXMgYSBuZXcgcGF0aCBjb250cm9sLlxuICpcbiAqIEAteC1sZXNzIFBhdGgubGVzc1xuICogQGNsYXNzIHRpbnltY2UudWkuUGF0aFxuICogQGV4dGVuZHMgdGlueW1jZS51aS5XaWRnZXRcbiAqL1xuZGVmaW5lKFwidGlueW1jZS91aS9QYXRoXCIsIFtcblx0XCJ0aW55bWNlL3VpL1dpZGdldFwiXG5dLCBmdW5jdGlvbihXaWRnZXQpIHtcblx0XCJ1c2Ugc3RyaWN0XCI7XG5cblx0cmV0dXJuIFdpZGdldC5leHRlbmQoe1xuXHRcdC8qKlxuXHRcdCAqIENvbnN0cnVjdHMgYSBpbnN0YW5jZSB3aXRoIHRoZSBzcGVjaWZpZWQgc2V0dGluZ3MuXG5cdFx0ICpcblx0XHQgKiBAY29uc3RydWN0b3Jcblx0XHQgKiBAcGFyYW0ge09iamVjdH0gc2V0dGluZ3MgTmFtZS92YWx1ZSBvYmplY3Qgd2l0aCBzZXR0aW5ncy5cblx0XHQgKiBAc2V0dGluZyB7U3RyaW5nfSBkZWxpbWl0ZXIgRGVsaW1pdGVyIHRvIGRpc3BsYXkgYmV0d2VlbiByb3cgaW4gcGF0aC5cblx0XHQgKi9cblx0XHRpbml0OiBmdW5jdGlvbihzZXR0aW5ncykge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHRpZiAoIXNldHRpbmdzLmRlbGltaXRlcikge1xuXHRcdFx0XHRzZXR0aW5ncy5kZWxpbWl0ZXIgPSAnXFx1MDBCQic7XG5cdFx0XHR9XG5cblx0XHRcdHNlbGYuX3N1cGVyKHNldHRpbmdzKTtcblx0XHRcdHNlbGYuY2xhc3Nlcy5hZGQoJ3BhdGgnKTtcblx0XHRcdHNlbGYuY2FuRm9jdXMgPSB0cnVlO1xuXG5cdFx0XHRzZWxmLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0dmFyIGluZGV4LCB0YXJnZXQgPSBlLnRhcmdldDtcblxuXHRcdFx0XHRpZiAoKGluZGV4ID0gdGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS1pbmRleCcpKSkge1xuXHRcdFx0XHRcdHNlbGYuZmlyZSgnc2VsZWN0Jywge3ZhbHVlOiBzZWxmLnJvdygpW2luZGV4XSwgaW5kZXg6IGluZGV4fSk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRzZWxmLnJvdyhzZWxmLnNldHRpbmdzLnJvdyk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIEZvY3VzZXMgdGhlIGN1cnJlbnQgY29udHJvbC5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgZm9jdXNcblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLnVpLkNvbnRyb2x9IEN1cnJlbnQgY29udHJvbCBpbnN0YW5jZS5cblx0XHQgKi9cblx0XHRmb2N1czogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdHNlbGYuZ2V0RWwoKS5maXJzdENoaWxkLmZvY3VzKCk7XG5cblx0XHRcdHJldHVybiBzZWxmO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBTZXRzL2dldHMgdGhlIGRhdGEgdG8gYmUgdXNlZCBmb3IgdGhlIHBhdGguXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHJvd1xuXHRcdCAqIEBwYXJhbSB7QXJyYXl9IHJvdyBBcnJheSB3aXRoIHJvdyBuYW1lIGlzIHJlbmRlcmVkIHRvIHBhdGguXG5cdFx0ICovXG5cdFx0cm93OiBmdW5jdGlvbihyb3cpIHtcblx0XHRcdGlmICghYXJndW1lbnRzLmxlbmd0aCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdGF0ZS5nZXQoJ3JvdycpO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLnN0YXRlLnNldCgncm93Jywgcm93KTtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFJlbmRlcnMgdGhlIGNvbnRyb2wgYXMgYSBIVE1MIHN0cmluZy5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgcmVuZGVySHRtbFxuXHRcdCAqIEByZXR1cm4ge1N0cmluZ30gSFRNTCByZXByZXNlbnRpbmcgdGhlIGNvbnRyb2wuXG5cdFx0ICovXG5cdFx0cmVuZGVySHRtbDogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdHJldHVybiAoXG5cdFx0XHRcdCc8ZGl2IGlkPVwiJyArIHNlbGYuX2lkICsgJ1wiIGNsYXNzPVwiJyArIHNlbGYuY2xhc3NlcyArICdcIj4nICtcblx0XHRcdFx0XHRzZWxmLl9nZXREYXRhUGF0aEh0bWwoc2VsZi5zdGF0ZS5nZXQoJ3JvdycpKSArXG5cdFx0XHRcdCc8L2Rpdj4nXG5cdFx0XHQpO1xuXHRcdH0sXG5cblx0XHRiaW5kU3RhdGVzOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0c2VsZi5zdGF0ZS5vbignY2hhbmdlOnJvdycsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0c2VsZi5pbm5lckh0bWwoc2VsZi5fZ2V0RGF0YVBhdGhIdG1sKGUudmFsdWUpKTtcblx0XHRcdH0pO1xuXG5cdFx0XHRyZXR1cm4gc2VsZi5fc3VwZXIoKTtcblx0XHR9LFxuXG5cdFx0X2dldERhdGFQYXRoSHRtbDogZnVuY3Rpb24oZGF0YSkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLCBwYXJ0cyA9IGRhdGEgfHwgW10sIGksIGwsIGh0bWwgPSAnJywgcHJlZml4ID0gc2VsZi5jbGFzc1ByZWZpeDtcblxuXHRcdFx0Zm9yIChpID0gMCwgbCA9IHBhcnRzLmxlbmd0aDsgaSA8IGw7IGkrKykge1xuXHRcdFx0XHRodG1sICs9IChcblx0XHRcdFx0XHQoaSA+IDAgPyAnPGRpdiBjbGFzcz1cIicgKyBwcmVmaXggKyAnZGl2aWRlclwiIGFyaWEtaGlkZGVuPVwidHJ1ZVwiPiAnICsgc2VsZi5zZXR0aW5ncy5kZWxpbWl0ZXIgKyAnIDwvZGl2PicgOiAnJykgK1xuXHRcdFx0XHRcdCc8ZGl2IHJvbGU9XCJidXR0b25cIiBjbGFzcz1cIicgKyBwcmVmaXggKyAncGF0aC1pdGVtJyArIChpID09IGwgLSAxID8gJyAnICsgcHJlZml4ICsgJ2xhc3QnIDogJycpICsgJ1wiIGRhdGEtaW5kZXg9XCInICtcblx0XHRcdFx0XHRpICsgJ1wiIHRhYmluZGV4PVwiLTFcIiBpZD1cIicgKyBzZWxmLl9pZCArICctJyArIGkgKyAnXCIgYXJpYS1sZXZlbD1cIicgKyAoaSArIDEpICsgJ1wiPicgKyBwYXJ0c1tpXS5uYW1lICsgJzwvZGl2Pidcblx0XHRcdFx0KTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKCFodG1sKSB7XG5cdFx0XHRcdGh0bWwgPSAnPGRpdiBjbGFzcz1cIicgKyBwcmVmaXggKyAncGF0aC1pdGVtXCI+XFx1MDBhMDwvZGl2Pic7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBodG1sO1xuXHRcdH1cblx0fSk7XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL3VpL0VsZW1lbnRQYXRoLmpzXG5cbi8qKlxuICogRWxlbWVudFBhdGguanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBUaGlzIGNvbnRyb2wgY3JlYXRlcyBhbiBwYXRoIGZvciB0aGUgY3VycmVudCBzZWxlY3Rpb25zIHBhcmVudCBlbGVtZW50cyBpbiBUaW55TUNFLlxuICpcbiAqIEBjbGFzcyB0aW55bWNlLnVpLkVsZW1lbnRQYXRoXG4gKiBAZXh0ZW5kcyB0aW55bWNlLnVpLlBhdGhcbiAqL1xuZGVmaW5lKFwidGlueW1jZS91aS9FbGVtZW50UGF0aFwiLCBbXG5cdFwidGlueW1jZS91aS9QYXRoXCJcbl0sIGZ1bmN0aW9uKFBhdGgpIHtcblx0cmV0dXJuIFBhdGguZXh0ZW5kKHtcblx0XHQvKipcblx0XHQgKiBQb3N0IHJlbmRlciBtZXRob2QuIENhbGxlZCBhZnRlciB0aGUgY29udHJvbCBoYXMgYmVlbiByZW5kZXJlZCB0byB0aGUgdGFyZ2V0LlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBwb3N0UmVuZGVyXG5cdFx0ICogQHJldHVybiB7dGlueW1jZS51aS5FbGVtZW50UGF0aH0gQ3VycmVudCBjb21ib2JveCBpbnN0YW5jZS5cblx0XHQgKi9cblx0XHRwb3N0UmVuZGVyOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgZWRpdG9yID0gc2VsZi5zZXR0aW5ncy5lZGl0b3I7XG5cblx0XHRcdGZ1bmN0aW9uIGlzSGlkZGVuKGVsbSkge1xuXHRcdFx0XHRpZiAoZWxtLm5vZGVUeXBlID09PSAxKSB7XG5cdFx0XHRcdFx0aWYgKGVsbS5ub2RlTmFtZSA9PSBcIkJSXCIgfHwgISFlbG0uZ2V0QXR0cmlidXRlKCdkYXRhLW1jZS1ib2d1cycpKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoZWxtLmdldEF0dHJpYnV0ZSgnZGF0YS1tY2UtdHlwZScpID09PSAnYm9va21hcmsnKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChlZGl0b3Iuc2V0dGluZ3MuZWxlbWVudHBhdGggIT09IGZhbHNlKSB7XG5cdFx0XHRcdHNlbGYub24oJ3NlbGVjdCcsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0XHRlZGl0b3IuZm9jdXMoKTtcblx0XHRcdFx0XHRlZGl0b3Iuc2VsZWN0aW9uLnNlbGVjdCh0aGlzLnJvdygpW2UuaW5kZXhdLmVsZW1lbnQpO1xuXHRcdFx0XHRcdGVkaXRvci5ub2RlQ2hhbmdlZCgpO1xuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHRlZGl0b3Iub24oJ25vZGVDaGFuZ2UnLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdFx0dmFyIG91dFBhcmVudHMgPSBbXSwgcGFyZW50cyA9IGUucGFyZW50cywgaSA9IHBhcmVudHMubGVuZ3RoO1xuXG5cdFx0XHRcdFx0d2hpbGUgKGktLSkge1xuXHRcdFx0XHRcdFx0aWYgKHBhcmVudHNbaV0ubm9kZVR5cGUgPT0gMSAmJiAhaXNIaWRkZW4ocGFyZW50c1tpXSkpIHtcblx0XHRcdFx0XHRcdFx0dmFyIGFyZ3MgPSBlZGl0b3IuZmlyZSgnUmVzb2x2ZU5hbWUnLCB7XG5cdFx0XHRcdFx0XHRcdFx0bmFtZTogcGFyZW50c1tpXS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpLFxuXHRcdFx0XHRcdFx0XHRcdHRhcmdldDogcGFyZW50c1tpXVxuXHRcdFx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdFx0XHRpZiAoIWFyZ3MuaXNEZWZhdWx0UHJldmVudGVkKCkpIHtcblx0XHRcdFx0XHRcdFx0XHRvdXRQYXJlbnRzLnB1c2goe25hbWU6IGFyZ3MubmFtZSwgZWxlbWVudDogcGFyZW50c1tpXX0pO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0aWYgKGFyZ3MuaXNQcm9wYWdhdGlvblN0b3BwZWQoKSkge1xuXHRcdFx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0c2VsZi5yb3cob3V0UGFyZW50cyk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gc2VsZi5fc3VwZXIoKTtcblx0XHR9XG5cdH0pO1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy91aS9Gb3JtSXRlbS5qc1xuXG4vKipcbiAqIEZvcm1JdGVtLmpzXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgTEdQTCBMaWNlbnNlLlxuICogQ29weXJpZ2h0IChjKSAxOTk5LTIwMTUgRXBob3ggQ29ycC4gQWxsIHJpZ2h0cyByZXNlcnZlZFxuICpcbiAqIExpY2Vuc2U6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vbGljZW5zZVxuICogQ29udHJpYnV0aW5nOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2NvbnRyaWJ1dGluZ1xuICovXG5cbi8qKlxuICogVGhpcyBjbGFzcyBpcyBhIGNvbnRhaW5lciBjcmVhdGVkIGJ5IHRoZSBmb3JtIGVsZW1lbnQgd2l0aFxuICogYSBsYWJlbCBhbmQgY29udHJvbCBpdGVtLlxuICpcbiAqIEBjbGFzcyB0aW55bWNlLnVpLkZvcm1JdGVtXG4gKiBAZXh0ZW5kcyB0aW55bWNlLnVpLkNvbnRhaW5lclxuICogQHNldHRpbmcge1N0cmluZ30gbGFiZWwgTGFiZWwgdG8gZGlzcGxheSBmb3IgdGhlIGZvcm0gaXRlbS5cbiAqL1xuZGVmaW5lKFwidGlueW1jZS91aS9Gb3JtSXRlbVwiLCBbXG5cdFwidGlueW1jZS91aS9Db250YWluZXJcIlxuXSwgZnVuY3Rpb24oQ29udGFpbmVyKSB7XG5cdFwidXNlIHN0cmljdFwiO1xuXG5cdHJldHVybiBDb250YWluZXIuZXh0ZW5kKHtcblx0XHREZWZhdWx0czoge1xuXHRcdFx0bGF5b3V0OiAnZmxleCcsXG5cdFx0XHRhbGlnbjogJ2NlbnRlcicsXG5cdFx0XHRkZWZhdWx0czoge1xuXHRcdFx0XHRmbGV4OiAxXG5cdFx0XHR9XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFJlbmRlcnMgdGhlIGNvbnRyb2wgYXMgYSBIVE1MIHN0cmluZy5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgcmVuZGVySHRtbFxuXHRcdCAqIEByZXR1cm4ge1N0cmluZ30gSFRNTCByZXByZXNlbnRpbmcgdGhlIGNvbnRyb2wuXG5cdFx0ICovXG5cdFx0cmVuZGVySHRtbDogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIGxheW91dCA9IHNlbGYuX2xheW91dCwgcHJlZml4ID0gc2VsZi5jbGFzc1ByZWZpeDtcblxuXHRcdFx0c2VsZi5jbGFzc2VzLmFkZCgnZm9ybWl0ZW0nKTtcblx0XHRcdGxheW91dC5wcmVSZW5kZXIoc2VsZik7XG5cblx0XHRcdHJldHVybiAoXG5cdFx0XHRcdCc8ZGl2IGlkPVwiJyArIHNlbGYuX2lkICsgJ1wiIGNsYXNzPVwiJyArIHNlbGYuY2xhc3NlcyArICdcIiBoaWRlZm9jdXM9XCIxXCIgdGFiaW5kZXg9XCItMVwiPicgK1xuXHRcdFx0XHRcdChzZWxmLnNldHRpbmdzLnRpdGxlID8gKCc8ZGl2IGlkPVwiJyArIHNlbGYuX2lkICsgJy10aXRsZVwiIGNsYXNzPVwiJyArIHByZWZpeCArICd0aXRsZVwiPicgK1xuXHRcdFx0XHRcdFx0c2VsZi5zZXR0aW5ncy50aXRsZSArICc8L2Rpdj4nKSA6ICcnKSArXG5cdFx0XHRcdFx0JzxkaXYgaWQ9XCInICsgc2VsZi5faWQgKyAnLWJvZHlcIiBjbGFzcz1cIicgKyBzZWxmLmJvZHlDbGFzc2VzICsgJ1wiPicgK1xuXHRcdFx0XHRcdFx0KHNlbGYuc2V0dGluZ3MuaHRtbCB8fCAnJykgKyBsYXlvdXQucmVuZGVySHRtbChzZWxmKSArXG5cdFx0XHRcdFx0JzwvZGl2PicgK1xuXHRcdFx0XHQnPC9kaXY+J1xuXHRcdFx0KTtcblx0XHR9XG5cdH0pO1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy91aS9Gb3JtLmpzXG5cbi8qKlxuICogRm9ybS5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE1IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKipcbiAqIFRoaXMgY2xhc3MgY3JlYXRlcyBhIGZvcm0gY29udGFpbmVyLiBBIGZvcm0gY29udGFpbmVyIGhhcyB0aGUgYWJpbGl0eVxuICogdG8gYXV0b21hdGljYWxseSB3cmFwIGl0ZW1zIGluIHRpbnltY2UudWkuRm9ybUl0ZW0gaW5zdGFuY2VzLlxuICpcbiAqIEVhY2ggRm9ybUl0ZW0gaW5zdGFuY2UgaXMgYSBjb250YWluZXIgZm9yIHRoZSBsYWJlbCBhbmQgdGhlIGl0ZW0uXG4gKlxuICogQGV4YW1wbGVcbiAqIHRpbnltY2UudWkuRmFjdG9yeS5jcmVhdGUoe1xuICogICAgIHR5cGU6ICdmb3JtJyxcbiAqICAgICBpdGVtczogW1xuICogICAgICAgICB7dHlwZTogJ3RleHRib3gnLCBsYWJlbDogJ015IHRleHQgYm94J31cbiAqICAgICBdXG4gKiB9KS5yZW5kZXJUbyhkb2N1bWVudC5ib2R5KTtcbiAqXG4gKiBAY2xhc3MgdGlueW1jZS51aS5Gb3JtXG4gKiBAZXh0ZW5kcyB0aW55bWNlLnVpLkNvbnRhaW5lclxuICovXG5kZWZpbmUoXCJ0aW55bWNlL3VpL0Zvcm1cIiwgW1xuXHRcInRpbnltY2UvdWkvQ29udGFpbmVyXCIsXG5cdFwidGlueW1jZS91aS9Gb3JtSXRlbVwiLFxuXHRcInRpbnltY2UvdXRpbC9Ub29sc1wiXG5dLCBmdW5jdGlvbihDb250YWluZXIsIEZvcm1JdGVtLCBUb29scykge1xuXHRcInVzZSBzdHJpY3RcIjtcblxuXHRyZXR1cm4gQ29udGFpbmVyLmV4dGVuZCh7XG5cdFx0RGVmYXVsdHM6IHtcblx0XHRcdGNvbnRhaW5lckNsczogJ2Zvcm0nLFxuXHRcdFx0bGF5b3V0OiAnZmxleCcsXG5cdFx0XHRkaXJlY3Rpb246ICdjb2x1bW4nLFxuXHRcdFx0YWxpZ246ICdzdHJldGNoJyxcblx0XHRcdGZsZXg6IDEsXG5cdFx0XHRwYWRkaW5nOiAyMCxcblx0XHRcdGxhYmVsR2FwOiAzMCxcblx0XHRcdHNwYWNpbmc6IDEwLFxuXHRcdFx0Y2FsbGJhY2tzOiB7XG5cdFx0XHRcdHN1Ym1pdDogZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0dGhpcy5zdWJtaXQoKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBUaGlzIG1ldGhvZCBnZXRzIGludm9rZWQgYmVmb3JlIHRoZSBjb250cm9sIGlzIHJlbmRlcmVkLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBwcmVSZW5kZXJcblx0XHQgKi9cblx0XHRwcmVSZW5kZXI6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLCBpdGVtcyA9IHNlbGYuaXRlbXMoKTtcblxuXHRcdFx0aWYgKCFzZWxmLnNldHRpbmdzLmZvcm1JdGVtRGVmYXVsdHMpIHtcblx0XHRcdFx0c2VsZi5zZXR0aW5ncy5mb3JtSXRlbURlZmF1bHRzID0ge1xuXHRcdFx0XHRcdGxheW91dDogJ2ZsZXgnLFxuXHRcdFx0XHRcdGF1dG9SZXNpemU6IFwib3ZlcmZsb3dcIixcblx0XHRcdFx0XHRkZWZhdWx0czoge2ZsZXg6IDF9XG5cdFx0XHRcdH07XG5cdFx0XHR9XG5cblx0XHRcdC8vIFdyYXAgYW55IGxhYmVsZWQgaXRlbXMgaW4gRm9ybUl0ZW1zXG5cdFx0XHRpdGVtcy5lYWNoKGZ1bmN0aW9uKGN0cmwpIHtcblx0XHRcdFx0dmFyIGZvcm1JdGVtLCBsYWJlbCA9IGN0cmwuc2V0dGluZ3MubGFiZWw7XG5cblx0XHRcdFx0aWYgKGxhYmVsKSB7XG5cdFx0XHRcdFx0Zm9ybUl0ZW0gPSBuZXcgRm9ybUl0ZW0oVG9vbHMuZXh0ZW5kKHtcblx0XHRcdFx0XHRcdGl0ZW1zOiB7XG5cdFx0XHRcdFx0XHRcdHR5cGU6ICdsYWJlbCcsXG5cdFx0XHRcdFx0XHRcdGlkOiBjdHJsLl9pZCArICctbCcsXG5cdFx0XHRcdFx0XHRcdHRleHQ6IGxhYmVsLFxuXHRcdFx0XHRcdFx0XHRmbGV4OiAwLFxuXHRcdFx0XHRcdFx0XHRmb3JJZDogY3RybC5faWQsXG5cdFx0XHRcdFx0XHRcdGRpc2FibGVkOiBjdHJsLmRpc2FibGVkKClcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9LCBzZWxmLnNldHRpbmdzLmZvcm1JdGVtRGVmYXVsdHMpKTtcblxuXHRcdFx0XHRcdGZvcm1JdGVtLnR5cGUgPSAnZm9ybWl0ZW0nO1xuXHRcdFx0XHRcdGN0cmwuYXJpYSgnbGFiZWxsZWRieScsIGN0cmwuX2lkICsgJy1sJyk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mIGN0cmwuc2V0dGluZ3MuZmxleCA9PSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0XHRcdFx0XHRjdHJsLnNldHRpbmdzLmZsZXggPSAxO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHNlbGYucmVwbGFjZShjdHJsLCBmb3JtSXRlbSk7XG5cdFx0XHRcdFx0Zm9ybUl0ZW0uYWRkKGN0cmwpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogRmlyZXMgYSBzdWJtaXQgZXZlbnQgd2l0aCB0aGUgc2VyaWFsaXplZCBmb3JtLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBzdWJtaXRcblx0XHQgKiBAcmV0dXJuIHtPYmplY3R9IEV2ZW50IGFyZ3VtZW50cyBvYmplY3QuXG5cdFx0ICovXG5cdFx0c3VibWl0OiBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiB0aGlzLmZpcmUoJ3N1Ym1pdCcsIHtkYXRhOiB0aGlzLnRvSlNPTigpfSk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFBvc3QgcmVuZGVyIG1ldGhvZC4gQ2FsbGVkIGFmdGVyIHRoZSBjb250cm9sIGhhcyBiZWVuIHJlbmRlcmVkIHRvIHRoZSB0YXJnZXQuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHBvc3RSZW5kZXJcblx0XHQgKiBAcmV0dXJuIHt0aW55bWNlLnVpLkNvbWJvQm94fSBDdXJyZW50IGNvbWJvYm94IGluc3RhbmNlLlxuXHRcdCAqL1xuXHRcdHBvc3RSZW5kZXI6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHRzZWxmLl9zdXBlcigpO1xuXHRcdFx0c2VsZi5mcm9tSlNPTihzZWxmLnNldHRpbmdzLmRhdGEpO1xuXHRcdH0sXG5cblx0XHRiaW5kU3RhdGVzOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0c2VsZi5fc3VwZXIoKTtcblxuXHRcdFx0ZnVuY3Rpb24gcmVjYWxjTGFiZWxzKCkge1xuXHRcdFx0XHR2YXIgbWF4TGFiZWxXaWR0aCA9IDAsIGxhYmVscyA9IFtdLCBpLCBsYWJlbEdhcCwgaXRlbXM7XG5cblx0XHRcdFx0aWYgKHNlbGYuc2V0dGluZ3MubGFiZWxHYXBDYWxjID09PSBmYWxzZSkge1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChzZWxmLnNldHRpbmdzLmxhYmVsR2FwQ2FsYyA9PSBcImNoaWxkcmVuXCIpIHtcblx0XHRcdFx0XHRpdGVtcyA9IHNlbGYuZmluZCgnZm9ybWl0ZW0nKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRpdGVtcyA9IHNlbGYuaXRlbXMoKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGl0ZW1zLmZpbHRlcignZm9ybWl0ZW0nKS5lYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcblx0XHRcdFx0XHR2YXIgbGFiZWxDdHJsID0gaXRlbS5pdGVtcygpWzBdLCBsYWJlbFdpZHRoID0gbGFiZWxDdHJsLmdldEVsKCkuY2xpZW50V2lkdGg7XG5cblx0XHRcdFx0XHRtYXhMYWJlbFdpZHRoID0gbGFiZWxXaWR0aCA+IG1heExhYmVsV2lkdGggPyBsYWJlbFdpZHRoIDogbWF4TGFiZWxXaWR0aDtcblx0XHRcdFx0XHRsYWJlbHMucHVzaChsYWJlbEN0cmwpO1xuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHRsYWJlbEdhcCA9IHNlbGYuc2V0dGluZ3MubGFiZWxHYXAgfHwgMDtcblxuXHRcdFx0XHRpID0gbGFiZWxzLmxlbmd0aDtcblx0XHRcdFx0d2hpbGUgKGktLSkge1xuXHRcdFx0XHRcdGxhYmVsc1tpXS5zZXR0aW5ncy5taW5XaWR0aCA9IG1heExhYmVsV2lkdGggKyBsYWJlbEdhcDtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRzZWxmLm9uKCdzaG93JywgcmVjYWxjTGFiZWxzKTtcblx0XHRcdHJlY2FsY0xhYmVscygpO1xuXHRcdH1cblx0fSk7XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL3VpL0ZpZWxkU2V0LmpzXG5cbi8qKlxuICogRmllbGRTZXQuanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBUaGlzIGNsYXNzIGNyZWF0ZXMgZmllbGRzZXQgY29udGFpbmVycy5cbiAqXG4gKiBALXgtbGVzcyBGaWVsZFNldC5sZXNzXG4gKiBAY2xhc3MgdGlueW1jZS51aS5GaWVsZFNldFxuICogQGV4dGVuZHMgdGlueW1jZS51aS5Gb3JtXG4gKi9cbmRlZmluZShcInRpbnltY2UvdWkvRmllbGRTZXRcIiwgW1xuXHRcInRpbnltY2UvdWkvRm9ybVwiXG5dLCBmdW5jdGlvbihGb3JtKSB7XG5cdFwidXNlIHN0cmljdFwiO1xuXG5cdHJldHVybiBGb3JtLmV4dGVuZCh7XG5cdFx0RGVmYXVsdHM6IHtcblx0XHRcdGNvbnRhaW5lckNsczogJ2ZpZWxkc2V0Jyxcblx0XHRcdGxheW91dDogJ2ZsZXgnLFxuXHRcdFx0ZGlyZWN0aW9uOiAnY29sdW1uJyxcblx0XHRcdGFsaWduOiAnc3RyZXRjaCcsXG5cdFx0XHRmbGV4OiAxLFxuXHRcdFx0cGFkZGluZzogXCIyNSAxNSA1IDE1XCIsXG5cdFx0XHRsYWJlbEdhcDogMzAsXG5cdFx0XHRzcGFjaW5nOiAxMCxcblx0XHRcdGJvcmRlcjogMVxuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZW5kZXJzIHRoZSBjb250cm9sIGFzIGEgSFRNTCBzdHJpbmcuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHJlbmRlckh0bWxcblx0XHQgKiBAcmV0dXJuIHtTdHJpbmd9IEhUTUwgcmVwcmVzZW50aW5nIHRoZSBjb250cm9sLlxuXHRcdCAqL1xuXHRcdHJlbmRlckh0bWw6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLCBsYXlvdXQgPSBzZWxmLl9sYXlvdXQsIHByZWZpeCA9IHNlbGYuY2xhc3NQcmVmaXg7XG5cblx0XHRcdHNlbGYucHJlUmVuZGVyKCk7XG5cdFx0XHRsYXlvdXQucHJlUmVuZGVyKHNlbGYpO1xuXG5cdFx0XHRyZXR1cm4gKFxuXHRcdFx0XHQnPGZpZWxkc2V0IGlkPVwiJyArIHNlbGYuX2lkICsgJ1wiIGNsYXNzPVwiJyArIHNlbGYuY2xhc3NlcyArICdcIiBoaWRlZm9jdXM9XCIxXCIgdGFiaW5kZXg9XCItMVwiPicgK1xuXHRcdFx0XHRcdChzZWxmLnNldHRpbmdzLnRpdGxlID8gKCc8bGVnZW5kIGlkPVwiJyArIHNlbGYuX2lkICsgJy10aXRsZVwiIGNsYXNzPVwiJyArIHByZWZpeCArICdmaWVsZHNldC10aXRsZVwiPicgK1xuXHRcdFx0XHRcdFx0c2VsZi5zZXR0aW5ncy50aXRsZSArICc8L2xlZ2VuZD4nKSA6ICcnKSArXG5cdFx0XHRcdFx0JzxkaXYgaWQ9XCInICsgc2VsZi5faWQgKyAnLWJvZHlcIiBjbGFzcz1cIicgKyBzZWxmLmJvZHlDbGFzc2VzICsgJ1wiPicgK1xuXHRcdFx0XHRcdFx0KHNlbGYuc2V0dGluZ3MuaHRtbCB8fCAnJykgKyBsYXlvdXQucmVuZGVySHRtbChzZWxmKSArXG5cdFx0XHRcdFx0JzwvZGl2PicgK1xuXHRcdFx0XHQnPC9maWVsZHNldD4nXG5cdFx0XHQpO1xuXHRcdH1cblx0fSk7XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL2NvbnRlbnQvTGlua1RhcmdldHMuanNcblxuLyoqXG4gKiBMaW5rVGFyZ2V0cy5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE2IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKipcbiAqIFRoaXMgbW9kdWxlIGlzIGVuYWJsZXMgeW91IHRvIGdldCBhbnl0aGluZyB0aGF0IHlvdSBjYW4gbGluayB0byBpbiBhIGVsZW1lbnQuXG4gKlxuICogQHByaXZhdGVcbiAqIEBjbGFzcyB0aW55bWNlLmNvbnRlbnQuTGlua1RhcmdldHNcbiAqL1xuZGVmaW5lKCd0aW55bWNlL2NvbnRlbnQvTGlua1RhcmdldHMnLCBbXG5cdCd0aW55bWNlL2RvbS9ET01VdGlscycsXG5cdCd0aW55bWNlL3V0aWwvRnVuJyxcblx0J3RpbnltY2UvdXRpbC9BcnInLFxuXHQndGlueW1jZS91dGlsL1V1aWQnLFxuXHQndGlueW1jZS91dGlsL1Rvb2xzJyxcblx0J3RpbnltY2UvZG9tL05vZGVUeXBlJ1xuXSwgZnVuY3Rpb24oXG5cdERPTVV0aWxzLFxuXHRGdW4sXG5cdEFycixcblx0VXVpZCxcblx0VG9vbHMsXG5cdE5vZGVUeXBlXG4pIHtcblx0dmFyIHRyaW0gPSBUb29scy50cmltO1xuXG5cdHZhciBjcmVhdGUgPSBmdW5jdGlvbiAodHlwZSwgdGl0bGUsIHVybCwgbGV2ZWwsIGF0dGFjaCkge1xuXHRcdHJldHVybiB7XG5cdFx0XHR0eXBlOiB0eXBlLFxuXHRcdFx0dGl0bGU6IHRpdGxlLFxuXHRcdFx0dXJsOiB1cmwsXG5cdFx0XHRsZXZlbDogbGV2ZWwsXG5cdFx0XHRhdHRhY2g6IGF0dGFjaFxuXHRcdH07XG5cdH07XG5cblx0dmFyIGlzQ2hpbGRPZkNvbnRlbnRFZGl0YWJsZVRydWUgPSBmdW5jdGlvbiAobm9kZSkge1xuXHRcdHdoaWxlICgobm9kZSA9IG5vZGUucGFyZW50Tm9kZSkpIHtcblx0XHRcdHZhciB2YWx1ZSA9IG5vZGUuY29udGVudEVkaXRhYmxlO1xuXHRcdFx0aWYgKHZhbHVlICYmIHZhbHVlICE9PSAnaW5oZXJpdCcpIHtcblx0XHRcdFx0cmV0dXJuIE5vZGVUeXBlLmlzQ29udGVudEVkaXRhYmxlVHJ1ZShub2RlKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gZmFsc2U7XG5cdH07XG5cblx0dmFyIHNlbGVjdCA9IGZ1bmN0aW9uIChzZWxlY3Rvciwgcm9vdCkge1xuXHRcdHJldHVybiBET01VdGlscy5ET00uc2VsZWN0KHNlbGVjdG9yLCByb290KTtcblx0fTtcblxuXHR2YXIgZ2V0RWxlbWVudFRleHQgPSBmdW5jdGlvbiAoZWxtKSB7XG5cdFx0cmV0dXJuIGVsbS5pbm5lclRleHQgfHwgZWxtLnRleHRDb250ZW50O1xuXHR9O1xuXG5cdHZhciBnZXRPckdlbmVyYXRlSWQgPSBmdW5jdGlvbiAoZWxtKSB7XG5cdFx0cmV0dXJuIGVsbS5pZCA/IGVsbS5pZCA6IFV1aWQudXVpZCgnaCcpO1xuXHR9O1xuXG5cdHZhciBpc0FuY2hvciA9IGZ1bmN0aW9uIChlbG0pIHtcblx0XHRyZXR1cm4gZWxtICYmIGVsbS5ub2RlTmFtZSA9PT0gJ0EnICYmIChlbG0uaWQgfHwgZWxtLm5hbWUpO1xuXHR9O1xuXG5cdHZhciBpc1ZhbGlkQW5jaG9yID0gZnVuY3Rpb24gKGVsbSkge1xuXHRcdHJldHVybiBpc0FuY2hvcihlbG0pICYmIGlzRWRpdGFibGUoZWxtKTtcblx0fTtcblxuXHR2YXIgaXNIZWFkZXIgPSBmdW5jdGlvbiAoZWxtKSB7XG5cdFx0cmV0dXJuIGVsbSAmJiAvXihIWzEtNl0pJC8udGVzdChlbG0ubm9kZU5hbWUpO1xuXHR9O1xuXG5cdHZhciBpc0VkaXRhYmxlID0gZnVuY3Rpb24gKGVsbSkge1xuXHRcdHJldHVybiBpc0NoaWxkT2ZDb250ZW50RWRpdGFibGVUcnVlKGVsbSkgJiYgIU5vZGVUeXBlLmlzQ29udGVudEVkaXRhYmxlRmFsc2UoZWxtKTtcblx0fTtcblxuXHR2YXIgaXNWYWxpZEhlYWRlciA9IGZ1bmN0aW9uIChlbG0pIHtcblx0XHRyZXR1cm4gaXNIZWFkZXIoZWxtKSAmJiBpc0VkaXRhYmxlKGVsbSk7XG5cdH07XG5cblx0dmFyIGdldExldmVsID0gZnVuY3Rpb24gKGVsbSkge1xuXHRcdHJldHVybiBpc0hlYWRlcihlbG0pID8gcGFyc2VJbnQoZWxtLm5vZGVOYW1lLnN1YnN0cigxKSwgMTApIDogMDtcblx0fTtcblxuXHR2YXIgaGVhZGVyVGFyZ2V0ID0gZnVuY3Rpb24gKGVsbSkge1xuXHRcdHZhciBoZWFkZXJJZCA9IGdldE9yR2VuZXJhdGVJZChlbG0pO1xuXG5cdFx0dmFyIGF0dGFjaCA9IGZ1bmN0aW9uICgpIHtcblx0XHRcdGVsbS5pZCA9IGhlYWRlcklkO1xuXHRcdH07XG5cblx0XHRyZXR1cm4gY3JlYXRlKCdoZWFkZXInLCBnZXRFbGVtZW50VGV4dChlbG0pLCAnIycgKyBoZWFkZXJJZCwgZ2V0TGV2ZWwoZWxtKSwgYXR0YWNoKTtcblx0fTtcblxuXHR2YXIgYW5jaG9yVGFyZ2V0ID0gZnVuY3Rpb24gKGVsbSkge1xuXHRcdHZhciBhbmNob3JJZCA9IGVsbS5pZCB8fCBlbG0ubmFtZTtcblx0XHR2YXIgYW5jaG9yVGV4dCA9IGdldEVsZW1lbnRUZXh0KGVsbSk7XG5cblx0XHRyZXR1cm4gY3JlYXRlKCdhbmNob3InLCBhbmNob3JUZXh0ID8gYW5jaG9yVGV4dCA6ICcjJyArIGFuY2hvcklkLCAnIycgKyBhbmNob3JJZCwgMCwgRnVuLm5vb3ApO1xuXHR9O1xuXG5cdHZhciBnZXRIZWFkZXJUYXJnZXRzID0gZnVuY3Rpb24gKGVsbXMpIHtcblx0XHRyZXR1cm4gQXJyLm1hcChBcnIuZmlsdGVyKGVsbXMsIGlzVmFsaWRIZWFkZXIpLCBoZWFkZXJUYXJnZXQpO1xuXHR9O1xuXG5cdHZhciBnZXRBbmNob3JUYXJnZXRzID0gZnVuY3Rpb24gKGVsbXMpIHtcblx0XHRyZXR1cm4gQXJyLm1hcChBcnIuZmlsdGVyKGVsbXMsIGlzVmFsaWRBbmNob3IpLCBhbmNob3JUYXJnZXQpO1xuXHR9O1xuXG5cdHZhciBnZXRUYXJnZXRFbGVtZW50cyA9IGZ1bmN0aW9uIChlbG0pIHtcblx0XHR2YXIgZWxtcyA9IHNlbGVjdCgnaDEsaDIsaDMsaDQsaDUsaDYsYTpub3QoW2hyZWZdKScsIGVsbSk7XG5cdFx0cmV0dXJuIGVsbXM7XG5cdH07XG5cblx0dmFyIGhhc1RpdGxlID0gZnVuY3Rpb24gKHRhcmdldCkge1xuXHRcdHJldHVybiB0cmltKHRhcmdldC50aXRsZSkubGVuZ3RoID4gMDtcblx0fTtcblxuXHR2YXIgZmluZCA9IGZ1bmN0aW9uIChlbG0pIHtcblx0XHR2YXIgZWxtcyA9IGdldFRhcmdldEVsZW1lbnRzKGVsbSk7XG5cdFx0cmV0dXJuIEFyci5maWx0ZXIoZ2V0SGVhZGVyVGFyZ2V0cyhlbG1zKS5jb25jYXQoZ2V0QW5jaG9yVGFyZ2V0cyhlbG1zKSksIGhhc1RpdGxlKTtcblx0fTtcblxuXHRyZXR1cm4ge1xuXHRcdGZpbmQ6IGZpbmRcblx0fTtcbn0pO1xuXG4vLyBJbmNsdWRlZCBmcm9tOiBqcy90aW55bWNlL2NsYXNzZXMvdWkvRmlsZVBpY2tlci5qc1xuXG4vKipcbiAqIEZpbGVQaWNrZXIuanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLypnbG9iYWwgdGlueW1jZTp0cnVlICovXG5cbi8qKlxuICogVGhpcyBjbGFzcyBjcmVhdGVzIGEgZmlsZSBwaWNrZXIgY29udHJvbC5cbiAqXG4gKiBAY2xhc3MgdGlueW1jZS51aS5GaWxlUGlja2VyXG4gKiBAZXh0ZW5kcyB0aW55bWNlLnVpLkNvbWJvQm94XG4gKi9cbmRlZmluZShcInRpbnltY2UvdWkvRmlsZVBpY2tlclwiLCBbXG5cdFwidGlueW1jZS91aS9Db21ib0JveFwiLFxuXHRcInRpbnltY2UvdXRpbC9Ub29sc1wiLFxuXHRcInRpbnltY2UvdXRpbC9BcnJcIixcblx0XCJ0aW55bWNlL3V0aWwvRnVuXCIsXG5cdFwidGlueW1jZS91dGlsL1ZLXCIsXG5cdFwidGlueW1jZS9jb250ZW50L0xpbmtUYXJnZXRzXCJcbl0sIGZ1bmN0aW9uKENvbWJvQm94LCBUb29scywgQXJyLCBGdW4sIFZLLCBMaW5rVGFyZ2V0cykge1xuXHRcInVzZSBzdHJpY3RcIjtcblxuXHR2YXIgaGlzdG9yeSA9IHt9O1xuXHR2YXIgSElTVE9SWV9MRU5HVEggPSA1O1xuXG5cdHZhciB0b01lbnVJdGVtID0gZnVuY3Rpb24gKHRhcmdldCkge1xuXHRcdHJldHVybiB7XG5cdFx0XHR0aXRsZTogdGFyZ2V0LnRpdGxlLFxuXHRcdFx0dmFsdWU6IHtcblx0XHRcdFx0dGl0bGU6IHtyYXc6IHRhcmdldC50aXRsZX0sXG5cdFx0XHRcdHVybDogdGFyZ2V0LnVybCxcblx0XHRcdFx0YXR0YWNoOiB0YXJnZXQuYXR0YWNoXG5cdFx0XHR9XG5cdFx0fTtcblx0fTtcblxuXHR2YXIgdG9NZW51SXRlbXMgPSBmdW5jdGlvbiAodGFyZ2V0cykge1xuXHRcdHJldHVybiBUb29scy5tYXAodGFyZ2V0cywgdG9NZW51SXRlbSk7XG5cdH07XG5cblx0dmFyIHN0YXRpY01lbnVJdGVtID0gZnVuY3Rpb24gKHRpdGxlLCB1cmwpIHtcblx0XHRyZXR1cm4ge1xuXHRcdFx0dGl0bGU6IHRpdGxlLFxuXHRcdFx0dmFsdWU6IHtcblx0XHRcdFx0dGl0bGU6IHRpdGxlLFxuXHRcdFx0XHR1cmw6IHVybCxcblx0XHRcdFx0YXR0YWNoOiBGdW4ubm9vcFxuXHRcdFx0fVxuXHRcdH07XG5cdH07XG5cblx0dmFyIGlzVW5pcXVlVXJsID0gZnVuY3Rpb24gKHVybCwgdGFyZ2V0cykge1xuXHRcdHZhciBmb3VuZFRhcmdldCA9IEFyci5maW5kKHRhcmdldHMsIGZ1bmN0aW9uICh0YXJnZXQpIHtcblx0XHRcdHJldHVybiB0YXJnZXQudXJsID09PSB1cmw7XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gIWZvdW5kVGFyZ2V0O1xuXHR9O1xuXG5cdHZhciBnZXRTZXR0aW5nID0gZnVuY3Rpb24gKGVkaXRvclNldHRpbmdzLCBuYW1lLCBkZWZhdWx0VmFsdWUpIHtcblx0XHR2YXIgdmFsdWUgPSBuYW1lIGluIGVkaXRvclNldHRpbmdzID8gZWRpdG9yU2V0dGluZ3NbbmFtZV0gOiBkZWZhdWx0VmFsdWU7XG5cdFx0cmV0dXJuIHZhbHVlID09PSBmYWxzZSA/IG51bGwgOiB2YWx1ZTtcblx0fTtcblxuXHR2YXIgY3JlYXRlTWVudUl0ZW1zID0gZnVuY3Rpb24gKHRlcm0sIHRhcmdldHMsIGZpbGVUeXBlLCBlZGl0b3JTZXR0aW5ncykge1xuXHRcdHZhciBzZXBhcmF0b3IgPSB7dGl0bGU6ICctJ307XG5cblx0XHR2YXIgZnJvbUhpc3RvcnlNZW51SXRlbXMgPSBmdW5jdGlvbiAoaGlzdG9yeSkge1xuXHRcdFx0dmFyIHVuaXF1ZUhpc3RvcnkgPSBBcnIuZmlsdGVyKGhpc3RvcnlbZmlsZVR5cGVdLCBmdW5jdGlvbiAodXJsKSB7XG5cdFx0XHRcdHJldHVybiBpc1VuaXF1ZVVybCh1cmwsIHRhcmdldHMpO1xuXHRcdFx0fSk7XG5cblx0XHRcdHJldHVybiBUb29scy5tYXAodW5pcXVlSGlzdG9yeSwgZnVuY3Rpb24gKHVybCkge1xuXHRcdFx0XHRyZXR1cm4ge1xuXHRcdFx0XHRcdHRpdGxlOiB1cmwsXG5cdFx0XHRcdFx0dmFsdWU6IHtcblx0XHRcdFx0XHRcdHRpdGxlOiB1cmwsXG5cdFx0XHRcdFx0XHR1cmw6IHVybCxcblx0XHRcdFx0XHRcdGF0dGFjaDogRnVuLm5vb3Bcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH07XG5cdFx0XHR9KTtcblx0XHR9O1xuXG5cdFx0dmFyIGZyb21NZW51SXRlbXMgPSBmdW5jdGlvbiAodHlwZSkge1xuXHRcdFx0dmFyIGZpbHRlcmVkVGFyZ2V0cyA9IEFyci5maWx0ZXIodGFyZ2V0cywgZnVuY3Rpb24gKHRhcmdldCkge1xuXHRcdFx0XHRyZXR1cm4gdGFyZ2V0LnR5cGUgPT0gdHlwZTtcblx0XHRcdH0pO1xuXG5cdFx0XHRyZXR1cm4gdG9NZW51SXRlbXMoZmlsdGVyZWRUYXJnZXRzKTtcblx0XHR9O1xuXG5cdFx0dmFyIGFuY2hvck1lbnVJdGVtcyA9IGZ1bmN0aW9uICgpIHtcblx0XHRcdHZhciBhbmNob3JNZW51SXRlbXMgPSBmcm9tTWVudUl0ZW1zKCdhbmNob3InKTtcblx0XHRcdHZhciB0b3BBbmNob3IgPSBnZXRTZXR0aW5nKGVkaXRvclNldHRpbmdzLCAnYW5jaG9yX3RvcCcsICcjdG9wJyk7XG5cdFx0XHR2YXIgYm90dG9tQWNob3IgPSBnZXRTZXR0aW5nKGVkaXRvclNldHRpbmdzLCAnYW5jaG9yX2JvdHRvbScsICcjYm90dG9tJyk7XG5cblx0XHRcdGlmICh0b3BBbmNob3IgIT09IG51bGwpIHtcblx0XHRcdFx0YW5jaG9yTWVudUl0ZW1zLnVuc2hpZnQoc3RhdGljTWVudUl0ZW0oJzx0b3A+JywgdG9wQW5jaG9yKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChib3R0b21BY2hvciAhPT0gbnVsbCkge1xuXHRcdFx0XHRhbmNob3JNZW51SXRlbXMucHVzaChzdGF0aWNNZW51SXRlbSgnPGJvdHRvbT4nLCBib3R0b21BY2hvcikpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gYW5jaG9yTWVudUl0ZW1zO1xuXHRcdH07XG5cblx0XHR2YXIgam9pbiA9IGZ1bmN0aW9uIChpdGVtcykge1xuXHRcdFx0cmV0dXJuIEFyci5yZWR1Y2UoaXRlbXMsIGZ1bmN0aW9uIChhLCBiKSB7XG5cdFx0XHRcdHZhciBib3RoRW1wdHkgPSBhLmxlbmd0aCA9PT0gMCB8fCBiLmxlbmd0aCA9PT0gMDtcblx0XHRcdFx0cmV0dXJuIGJvdGhFbXB0eSA/IGEuY29uY2F0KGIpIDogYS5jb25jYXQoc2VwYXJhdG9yLCBiKTtcblx0XHRcdH0sIFtdKTtcblx0XHR9O1xuXG5cdFx0aWYgKGVkaXRvclNldHRpbmdzLnR5cGVhaGVhZF91cmxzID09PSBmYWxzZSkge1xuXHRcdFx0cmV0dXJuIFtdO1xuXHRcdH1cblxuXHRcdHJldHVybiBmaWxlVHlwZSA9PT0gJ2ZpbGUnID8gam9pbihbXG5cdFx0XHRmaWx0ZXJCeVF1ZXJ5KHRlcm0sIGZyb21IaXN0b3J5TWVudUl0ZW1zKGhpc3RvcnkpKSxcblx0XHRcdGZpbHRlckJ5UXVlcnkodGVybSwgZnJvbU1lbnVJdGVtcygnaGVhZGVyJykpLFxuXHRcdFx0ZmlsdGVyQnlRdWVyeSh0ZXJtLCBhbmNob3JNZW51SXRlbXMoKSlcblx0XHRdKSA6IGZpbHRlckJ5UXVlcnkodGVybSwgZnJvbUhpc3RvcnlNZW51SXRlbXMoaGlzdG9yeSkpO1xuXHR9O1xuXG5cdHZhciBhZGRUb0hpc3RvcnkgPSBmdW5jdGlvbiAodXJsLCBmaWxlVHlwZSkge1xuXHRcdHZhciBpdGVtcyA9IGhpc3RvcnlbZmlsZVR5cGVdO1xuXG5cdFx0aWYgKCEvXmh0dHBzPy8udGVzdCh1cmwpKSB7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXG5cdFx0aWYgKGl0ZW1zKSB7XG5cdFx0XHRpZiAoQXJyLmluZGV4T2YoaXRlbXMsIHVybCkgPT09IC0xKSB7XG5cdFx0XHRcdGhpc3RvcnlbZmlsZVR5cGVdID0gaXRlbXMuc2xpY2UoMCwgSElTVE9SWV9MRU5HVEgpLmNvbmNhdCh1cmwpO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRoaXN0b3J5W2ZpbGVUeXBlXSA9IFt1cmxdO1xuXHRcdH1cblx0fTtcblxuXHR2YXIgZmlsdGVyQnlRdWVyeSA9IGZ1bmN0aW9uICh0ZXJtLCBtZW51SXRlbXMpIHtcblx0XHR2YXIgbG93ZXJDYXNlVGVybSA9IHRlcm0udG9Mb3dlckNhc2UoKTtcblx0XHR2YXIgcmVzdWx0ID0gVG9vbHMuZ3JlcChtZW51SXRlbXMsIGZ1bmN0aW9uIChpdGVtKSB7XG5cdFx0XHRyZXR1cm4gaXRlbS50aXRsZS50b0xvd2VyQ2FzZSgpLmluZGV4T2YobG93ZXJDYXNlVGVybSkgIT09IC0xO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJlc3VsdC5sZW5ndGggPT09IDEgJiYgcmVzdWx0WzBdLnRpdGxlID09PSB0ZXJtID8gW10gOiByZXN1bHQ7XG5cdH07XG5cblx0dmFyIGdldFRpdGxlID0gZnVuY3Rpb24gKGxpbmtEZXRhaWxzKSB7XG5cdFx0dmFyIHRpdGxlID0gbGlua0RldGFpbHMudGl0bGU7XG5cdFx0cmV0dXJuIHRpdGxlLnJhdyA/IHRpdGxlLnJhdyA6IHRpdGxlO1xuXHR9O1xuXG5cdHZhciBzZXR1cEF1dG9Db21wbGV0ZUhhbmRsZXIgPSBmdW5jdGlvbiAoY3RybCwgZWRpdG9yU2V0dGluZ3MsIGJvZHlFbG0sIGZpbGVUeXBlKSB7XG5cdFx0dmFyIGF1dG9jb21wbGV0ZSA9IGZ1bmN0aW9uICh0ZXJtKSB7XG5cdFx0XHR2YXIgbGlua1RhcmdldHMgPSBMaW5rVGFyZ2V0cy5maW5kKGJvZHlFbG0pO1xuXHRcdFx0dmFyIG1lbnVJdGVtcyA9IGNyZWF0ZU1lbnVJdGVtcyh0ZXJtLCBsaW5rVGFyZ2V0cywgZmlsZVR5cGUsIGVkaXRvclNldHRpbmdzKTtcblx0XHRcdGN0cmwuc2hvd0F1dG9Db21wbGV0ZShtZW51SXRlbXMsIHRlcm0pO1xuXHRcdH07XG5cblx0XHRjdHJsLm9uKCdhdXRvY29tcGxldGUnLCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRhdXRvY29tcGxldGUoY3RybC52YWx1ZSgpKTtcblx0XHR9KTtcblxuXHRcdGN0cmwub24oJ3NlbGVjdGl0ZW0nLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0dmFyIGxpbmtEZXRhaWxzID0gZS52YWx1ZTtcblxuXHRcdFx0Y3RybC52YWx1ZShsaW5rRGV0YWlscy51cmwpO1xuXHRcdFx0dmFyIHRpdGxlID0gZ2V0VGl0bGUobGlua0RldGFpbHMpO1xuXG5cdFx0XHRpZiAoZmlsZVR5cGUgPT09ICdpbWFnZScpIHtcblx0XHRcdFx0Y3RybC5maXJlKCdjaGFuZ2UnLCB7bWV0YToge2FsdDogdGl0bGUsIGF0dGFjaDogbGlua0RldGFpbHMuYXR0YWNofX0pO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y3RybC5maXJlKCdjaGFuZ2UnLCB7bWV0YToge3RleHQ6IHRpdGxlLCBhdHRhY2g6IGxpbmtEZXRhaWxzLmF0dGFjaH19KTtcblx0XHRcdH1cblxuXHRcdFx0Y3RybC5mb2N1cygpO1xuXHRcdH0pO1xuXG5cdFx0Y3RybC5vbignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0aWYgKGN0cmwudmFsdWUoKS5sZW5ndGggPT09IDAgJiYgZS50YXJnZXQubm9kZU5hbWUgPT09ICdJTlBVVCcpIHtcblx0XHRcdFx0YXV0b2NvbXBsZXRlKCcnKTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGN0cmwub24oJ1Bvc3RSZW5kZXInLCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRjdHJsLmdldFJvb3QoKS5vbignc3VibWl0JywgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0aWYgKCFlLmlzRGVmYXVsdFByZXZlbnRlZCgpKSB7XG5cdFx0XHRcdFx0YWRkVG9IaXN0b3J5KGN0cmwudmFsdWUoKSwgZmlsZVR5cGUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9KTtcblx0fTtcblxuXHR2YXIgc3RhdHVzVG9VaVN0YXRlID0gZnVuY3Rpb24gKHJlc3VsdCkge1xuXHRcdHZhciBzdGF0dXMgPSByZXN1bHQuc3RhdHVzLCBtZXNzYWdlID0gcmVzdWx0Lm1lc3NhZ2U7XG5cblx0XHRpZiAoc3RhdHVzID09PSAndmFsaWQnKSB7XG5cdFx0XHRyZXR1cm4ge3N0YXR1czogJ29rJywgbWVzc2FnZTogbWVzc2FnZX07XG5cdFx0fSBlbHNlIGlmIChzdGF0dXMgPT09ICd1bmtub3duJykge1xuXHRcdFx0cmV0dXJuIHtzdGF0dXM6ICd3YXJuJywgbWVzc2FnZTogbWVzc2FnZX07XG5cdFx0fSBlbHNlIGlmIChzdGF0dXMgPT09ICdpbnZhbGlkJykge1xuXHRcdFx0cmV0dXJuIHtzdGF0dXM6ICd3YXJuJywgbWVzc2FnZTogbWVzc2FnZX07XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB7c3RhdHVzOiAnbm9uZScsIG1lc3NhZ2U6ICcnfTtcblx0XHR9XG5cdH07XG5cblx0dmFyIHNldHVwTGlua1ZhbGlkYXRvckhhbmRsZXIgPSBmdW5jdGlvbiAoY3RybCwgZWRpdG9yU2V0dGluZ3MsIGZpbGVUeXBlKSB7XG5cdFx0dmFyIHZhbGlkYXRvckhhbmRsZXIgPSBlZGl0b3JTZXR0aW5ncy5maWxlcGlja2VyX3ZhbGlkYXRvcl9oYW5kbGVyO1xuXHRcdGlmICh2YWxpZGF0b3JIYW5kbGVyKSB7XG5cdFx0XHR2YXIgdmFsaWRhdGVVcmwgPSBmdW5jdGlvbiAodXJsKSB7XG5cdFx0XHRcdGlmICh1cmwubGVuZ3RoID09PSAwKSB7XG5cdFx0XHRcdFx0Y3RybC5zdGF0dXNMZXZlbCgnbm9uZScpO1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHZhbGlkYXRvckhhbmRsZXIoe1xuXHRcdFx0XHRcdHVybDogdXJsLFxuXHRcdFx0XHRcdHR5cGU6IGZpbGVUeXBlXG5cdFx0XHRcdH0sIGZ1bmN0aW9uIChyZXN1bHQpIHtcblx0XHRcdFx0XHR2YXIgdWlTdGF0ZSA9IHN0YXR1c1RvVWlTdGF0ZShyZXN1bHQpO1xuXG5cdFx0XHRcdFx0Y3RybC5zdGF0dXNNZXNzYWdlKHVpU3RhdGUubWVzc2FnZSk7XG5cdFx0XHRcdFx0Y3RybC5zdGF0dXNMZXZlbCh1aVN0YXRlLnN0YXR1cyk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fTtcblxuXHRcdFx0Y3RybC5zdGF0ZS5vbignY2hhbmdlOnZhbHVlJywgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0dmFsaWRhdGVVcmwoZS52YWx1ZSk7XG5cdFx0XHR9KTtcblx0XHR9XG5cdH07XG5cblx0cmV0dXJuIENvbWJvQm94LmV4dGVuZCh7XG5cdFx0LyoqXG5cdFx0ICogQ29uc3RydWN0cyBhIG5ldyBjb250cm9sIGluc3RhbmNlIHdpdGggdGhlIHNwZWNpZmllZCBzZXR0aW5ncy5cblx0XHQgKlxuXHRcdCAqIEBjb25zdHJ1Y3RvclxuXHRcdCAqIEBwYXJhbSB7T2JqZWN0fSBzZXR0aW5ncyBOYW1lL3ZhbHVlIG9iamVjdCB3aXRoIHNldHRpbmdzLlxuXHRcdCAqL1xuXHRcdGluaXQ6IGZ1bmN0aW9uKHNldHRpbmdzKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIGVkaXRvciA9IHRpbnltY2UuYWN0aXZlRWRpdG9yLCBlZGl0b3JTZXR0aW5ncyA9IGVkaXRvci5zZXR0aW5ncztcblx0XHRcdHZhciBhY3Rpb25DYWxsYmFjaywgZmlsZUJyb3dzZXJDYWxsYmFjaywgZmlsZUJyb3dzZXJDYWxsYmFja1R5cGVzO1xuXHRcdFx0dmFyIGZpbGVUeXBlID0gc2V0dGluZ3MuZmlsZXR5cGU7XG5cblx0XHRcdHNldHRpbmdzLnNwZWxsY2hlY2sgPSBmYWxzZTtcblxuXHRcdFx0ZmlsZUJyb3dzZXJDYWxsYmFja1R5cGVzID0gZWRpdG9yU2V0dGluZ3MuZmlsZV9waWNrZXJfdHlwZXMgfHwgZWRpdG9yU2V0dGluZ3MuZmlsZV9icm93c2VyX2NhbGxiYWNrX3R5cGVzO1xuXHRcdFx0aWYgKGZpbGVCcm93c2VyQ2FsbGJhY2tUeXBlcykge1xuXHRcdFx0XHRmaWxlQnJvd3NlckNhbGxiYWNrVHlwZXMgPSBUb29scy5tYWtlTWFwKGZpbGVCcm93c2VyQ2FsbGJhY2tUeXBlcywgL1ssIF0vKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKCFmaWxlQnJvd3NlckNhbGxiYWNrVHlwZXMgfHwgZmlsZUJyb3dzZXJDYWxsYmFja1R5cGVzW2ZpbGVUeXBlXSkge1xuXHRcdFx0XHRmaWxlQnJvd3NlckNhbGxiYWNrID0gZWRpdG9yU2V0dGluZ3MuZmlsZV9waWNrZXJfY2FsbGJhY2s7XG5cdFx0XHRcdGlmIChmaWxlQnJvd3NlckNhbGxiYWNrICYmICghZmlsZUJyb3dzZXJDYWxsYmFja1R5cGVzIHx8IGZpbGVCcm93c2VyQ2FsbGJhY2tUeXBlc1tmaWxlVHlwZV0pKSB7XG5cdFx0XHRcdFx0YWN0aW9uQ2FsbGJhY2sgPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRcdHZhciBtZXRhID0gc2VsZi5maXJlKCdiZWZvcmVjYWxsJykubWV0YTtcblxuXHRcdFx0XHRcdFx0bWV0YSA9IFRvb2xzLmV4dGVuZCh7ZmlsZXR5cGU6IGZpbGVUeXBlfSwgbWV0YSk7XG5cblx0XHRcdFx0XHRcdC8vIGZpbGVfcGlja2VyX2NhbGxiYWNrKGNhbGxiYWNrLCBjdXJyZW50VmFsdWUsIG1ldGFEYXRhKVxuXHRcdFx0XHRcdFx0ZmlsZUJyb3dzZXJDYWxsYmFjay5jYWxsKFxuXHRcdFx0XHRcdFx0XHRlZGl0b3IsXG5cdFx0XHRcdFx0XHRcdGZ1bmN0aW9uKHZhbHVlLCBtZXRhKSB7XG5cdFx0XHRcdFx0XHRcdFx0c2VsZi52YWx1ZSh2YWx1ZSkuZmlyZSgnY2hhbmdlJywge21ldGE6IG1ldGF9KTtcblx0XHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdFx0c2VsZi52YWx1ZSgpLFxuXHRcdFx0XHRcdFx0XHRtZXRhXG5cdFx0XHRcdFx0XHQpO1xuXHRcdFx0XHRcdH07XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Ly8gTGVnYWN5IGNhbGxiYWNrOiBmaWxlX3BpY2tlcl9jYWxsYmFjayhpZCwgY3VycmVudFZhbHVlLCBmaWxldHlwZSwgd2luZG93KVxuXHRcdFx0XHRcdGZpbGVCcm93c2VyQ2FsbGJhY2sgPSBlZGl0b3JTZXR0aW5ncy5maWxlX2Jyb3dzZXJfY2FsbGJhY2s7XG5cdFx0XHRcdFx0aWYgKGZpbGVCcm93c2VyQ2FsbGJhY2sgJiYgKCFmaWxlQnJvd3NlckNhbGxiYWNrVHlwZXMgfHwgZmlsZUJyb3dzZXJDYWxsYmFja1R5cGVzW2ZpbGVUeXBlXSkpIHtcblx0XHRcdFx0XHRcdGFjdGlvbkNhbGxiYWNrID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0XHRcdGZpbGVCcm93c2VyQ2FsbGJhY2soXG5cdFx0XHRcdFx0XHRcdFx0c2VsZi5nZXRFbCgnaW5wJykuaWQsXG5cdFx0XHRcdFx0XHRcdFx0c2VsZi52YWx1ZSgpLFxuXHRcdFx0XHRcdFx0XHRcdGZpbGVUeXBlLFxuXHRcdFx0XHRcdFx0XHRcdHdpbmRvd1xuXHRcdFx0XHRcdFx0XHQpO1xuXHRcdFx0XHRcdFx0fTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKGFjdGlvbkNhbGxiYWNrKSB7XG5cdFx0XHRcdHNldHRpbmdzLmljb24gPSAnYnJvd3NlJztcblx0XHRcdFx0c2V0dGluZ3Mub25hY3Rpb24gPSBhY3Rpb25DYWxsYmFjaztcblx0XHRcdH1cblxuXHRcdFx0c2VsZi5fc3VwZXIoc2V0dGluZ3MpO1xuXG5cdFx0XHRzZXR1cEF1dG9Db21wbGV0ZUhhbmRsZXIoc2VsZiwgZWRpdG9yU2V0dGluZ3MsIGVkaXRvci5nZXRCb2R5KCksIGZpbGVUeXBlKTtcblx0XHRcdHNldHVwTGlua1ZhbGlkYXRvckhhbmRsZXIoc2VsZiwgZWRpdG9yU2V0dGluZ3MsIGZpbGVUeXBlKTtcblx0XHR9XG5cdH0pO1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy91aS9GaXRMYXlvdXQuanNcblxuLyoqXG4gKiBGaXRMYXlvdXQuanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBUaGlzIGxheW91dCBtYW5hZ2VyIHdpbGwgcmVzaXplIHRoZSBjb250cm9sIHRvIGJlIHRoZSBzaXplIG9mIGl0J3MgcGFyZW50IGNvbnRhaW5lci5cbiAqIEluIG90aGVyIHdvcmRzIHdpZHRoOiAxMDAlIGFuZCBoZWlnaHQ6IDEwMCUuXG4gKlxuICogQC14LWxlc3MgRml0TGF5b3V0Lmxlc3NcbiAqIEBjbGFzcyB0aW55bWNlLnVpLkZpdExheW91dFxuICogQGV4dGVuZHMgdGlueW1jZS51aS5BYnNvbHV0ZUxheW91dFxuICovXG5kZWZpbmUoXCJ0aW55bWNlL3VpL0ZpdExheW91dFwiLCBbXG5cdFwidGlueW1jZS91aS9BYnNvbHV0ZUxheW91dFwiXG5dLCBmdW5jdGlvbihBYnNvbHV0ZUxheW91dCkge1xuXHRcInVzZSBzdHJpY3RcIjtcblxuXHRyZXR1cm4gQWJzb2x1dGVMYXlvdXQuZXh0ZW5kKHtcblx0XHQvKipcblx0XHQgKiBSZWNhbGN1bGF0ZXMgdGhlIHBvc2l0aW9ucyBvZiB0aGUgY29udHJvbHMgaW4gdGhlIHNwZWNpZmllZCBjb250YWluZXIuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHJlY2FsY1xuXHRcdCAqIEBwYXJhbSB7dGlueW1jZS51aS5Db250YWluZXJ9IGNvbnRhaW5lciBDb250YWluZXIgaW5zdGFuY2UgdG8gcmVjYWxjLlxuXHRcdCAqL1xuXHRcdHJlY2FsYzogZnVuY3Rpb24oY29udGFpbmVyKSB7XG5cdFx0XHR2YXIgY29udExheW91dFJlY3QgPSBjb250YWluZXIubGF5b3V0UmVjdCgpLCBwYWRkaW5nQm94ID0gY29udGFpbmVyLnBhZGRpbmdCb3g7XG5cblx0XHRcdGNvbnRhaW5lci5pdGVtcygpLmZpbHRlcignOnZpc2libGUnKS5lYWNoKGZ1bmN0aW9uKGN0cmwpIHtcblx0XHRcdFx0Y3RybC5sYXlvdXRSZWN0KHtcblx0XHRcdFx0XHR4OiBwYWRkaW5nQm94LmxlZnQsXG5cdFx0XHRcdFx0eTogcGFkZGluZ0JveC50b3AsXG5cdFx0XHRcdFx0dzogY29udExheW91dFJlY3QuaW5uZXJXIC0gcGFkZGluZ0JveC5yaWdodCAtIHBhZGRpbmdCb3gubGVmdCxcblx0XHRcdFx0XHRoOiBjb250TGF5b3V0UmVjdC5pbm5lckggLSBwYWRkaW5nQm94LnRvcCAtIHBhZGRpbmdCb3guYm90dG9tXG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdGlmIChjdHJsLnJlY2FsYykge1xuXHRcdFx0XHRcdGN0cmwucmVjYWxjKCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH1cblx0fSk7XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL3VpL0ZsZXhMYXlvdXQuanNcblxuLyoqXG4gKiBGbGV4TGF5b3V0LmpzXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgTEdQTCBMaWNlbnNlLlxuICogQ29weXJpZ2h0IChjKSAxOTk5LTIwMTUgRXBob3ggQ29ycC4gQWxsIHJpZ2h0cyByZXNlcnZlZFxuICpcbiAqIExpY2Vuc2U6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vbGljZW5zZVxuICogQ29udHJpYnV0aW5nOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2NvbnRyaWJ1dGluZ1xuICovXG5cbi8qKlxuICogVGhpcyBsYXlvdXQgbWFuYWdlciB3b3JrcyBzaW1pbGFyIHRvIHRoZSBDU1MgZmxleCBib3guXG4gKlxuICogQHNldHRpbmcge1N0cmluZ30gZGlyZWN0aW9uIHJvd3xyb3ctcmV2ZXJzZXxjb2x1bW58Y29sdW1uLXJldmVyc2VcbiAqIEBzZXR0aW5nIHtOdW1iZXJ9IGZsZXggQSBwb3NpdGl2ZS1udW1iZXIgdG8gZmxleCBieS5cbiAqIEBzZXR0aW5nIHtTdHJpbmd9IGFsaWduIHN0YXJ0fGVuZHxjZW50ZXJ8c3RyZXRjaFxuICogQHNldHRpbmcge1N0cmluZ30gcGFjayBzdGFydHxlbmR8anVzdGlmeVxuICpcbiAqIEBjbGFzcyB0aW55bWNlLnVpLkZsZXhMYXlvdXRcbiAqIEBleHRlbmRzIHRpbnltY2UudWkuQWJzb2x1dGVMYXlvdXRcbiAqL1xuZGVmaW5lKFwidGlueW1jZS91aS9GbGV4TGF5b3V0XCIsIFtcblx0XCJ0aW55bWNlL3VpL0Fic29sdXRlTGF5b3V0XCJcbl0sIGZ1bmN0aW9uKEFic29sdXRlTGF5b3V0KSB7XG5cdFwidXNlIHN0cmljdFwiO1xuXG5cdHJldHVybiBBYnNvbHV0ZUxheW91dC5leHRlbmQoe1xuXHRcdC8qKlxuXHRcdCAqIFJlY2FsY3VsYXRlcyB0aGUgcG9zaXRpb25zIG9mIHRoZSBjb250cm9scyBpbiB0aGUgc3BlY2lmaWVkIGNvbnRhaW5lci5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgcmVjYWxjXG5cdFx0ICogQHBhcmFtIHt0aW55bWNlLnVpLkNvbnRhaW5lcn0gY29udGFpbmVyIENvbnRhaW5lciBpbnN0YW5jZSB0byByZWNhbGMuXG5cdFx0ICovXG5cdFx0cmVjYWxjOiBmdW5jdGlvbihjb250YWluZXIpIHtcblx0XHRcdC8vIEEgdG9uIG9mIHZhcmlhYmxlcywgbmVlZHMgdG8gYmUgaW4gdGhlIHNhbWUgc2NvcGUgZm9yIHBlcmZvcm1hbmNlXG5cdFx0XHR2YXIgaSwgbCwgaXRlbXMsIGNvbnRMYXlvdXRSZWN0LCBjb250UGFkZGluZ0JveCwgY29udFNldHRpbmdzLCBhbGlnbiwgcGFjaywgc3BhY2luZywgdG90YWxGbGV4LCBhdmFpbGFibGVTcGFjZSwgZGlyZWN0aW9uO1xuXHRcdFx0dmFyIGN0cmwsIGN0cmxMYXlvdXRSZWN0LCBjdHJsU2V0dGluZ3MsIGZsZXgsIG1heFNpemVJdGVtcyA9IFtdLCBzaXplLCBtYXhTaXplLCByYXRpbywgcmVjdCwgcG9zLCBtYXhBbGlnbkVuZFBvcztcblx0XHRcdHZhciBzaXplTmFtZSwgbWluU2l6ZU5hbWUsIHBvc05hbWUsIG1heFNpemVOYW1lLCBiZWZvcmVOYW1lLCBpbm5lclNpemVOYW1lLCBkZWx0YVNpemVOYW1lLCBjb250ZW50U2l6ZU5hbWU7XG5cdFx0XHR2YXIgYWxpZ25BeGlzTmFtZSwgYWxpZ25Jbm5lclNpemVOYW1lLCBhbGlnblNpemVOYW1lLCBhbGlnbk1pblNpemVOYW1lLCBhbGlnbkJlZm9yZU5hbWUsIGFsaWduQWZ0ZXJOYW1lO1xuXHRcdFx0dmFyIGFsaWduRGVsdGFTaXplTmFtZSwgYWxpZ25Db250ZW50U2l6ZU5hbWU7XG5cdFx0XHR2YXIgbWF4ID0gTWF0aC5tYXgsIG1pbiA9IE1hdGgubWluO1xuXG5cdFx0XHQvLyBHZXQgY29udGFpbmVyIGl0ZW1zLCBwcm9wZXJ0aWVzIGFuZCBzZXR0aW5nc1xuXHRcdFx0aXRlbXMgPSBjb250YWluZXIuaXRlbXMoKS5maWx0ZXIoJzp2aXNpYmxlJyk7XG5cdFx0XHRjb250TGF5b3V0UmVjdCA9IGNvbnRhaW5lci5sYXlvdXRSZWN0KCk7XG5cdFx0XHRjb250UGFkZGluZ0JveCA9IGNvbnRhaW5lci5wYWRkaW5nQm94O1xuXHRcdFx0Y29udFNldHRpbmdzID0gY29udGFpbmVyLnNldHRpbmdzO1xuXHRcdFx0ZGlyZWN0aW9uID0gY29udGFpbmVyLmlzUnRsKCkgPyAoY29udFNldHRpbmdzLmRpcmVjdGlvbiB8fCAncm93LXJldmVyc2VkJykgOiBjb250U2V0dGluZ3MuZGlyZWN0aW9uO1xuXHRcdFx0YWxpZ24gPSBjb250U2V0dGluZ3MuYWxpZ247XG5cdFx0XHRwYWNrID0gY29udGFpbmVyLmlzUnRsKCkgPyAoY29udFNldHRpbmdzLnBhY2sgfHwgJ2VuZCcpIDogY29udFNldHRpbmdzLnBhY2s7XG5cdFx0XHRzcGFjaW5nID0gY29udFNldHRpbmdzLnNwYWNpbmcgfHwgMDtcblxuXHRcdFx0aWYgKGRpcmVjdGlvbiA9PSBcInJvdy1yZXZlcnNlZFwiIHx8IGRpcmVjdGlvbiA9PSBcImNvbHVtbi1yZXZlcnNlXCIpIHtcblx0XHRcdFx0aXRlbXMgPSBpdGVtcy5zZXQoaXRlbXMudG9BcnJheSgpLnJldmVyc2UoKSk7XG5cdFx0XHRcdGRpcmVjdGlvbiA9IGRpcmVjdGlvbi5zcGxpdCgnLScpWzBdO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBTZXR1cCBheGlzIHZhcmlhYmxlIG5hbWUgZm9yIHJvdy9jb2x1bW4gZGlyZWN0aW9uIHNpbmNlIHRoZSBjYWxjdWxhdGlvbnMgaXMgdGhlIHNhbWVcblx0XHRcdGlmIChkaXJlY3Rpb24gPT0gXCJjb2x1bW5cIikge1xuXHRcdFx0XHRwb3NOYW1lID0gXCJ5XCI7XG5cdFx0XHRcdHNpemVOYW1lID0gXCJoXCI7XG5cdFx0XHRcdG1pblNpemVOYW1lID0gXCJtaW5IXCI7XG5cdFx0XHRcdG1heFNpemVOYW1lID0gXCJtYXhIXCI7XG5cdFx0XHRcdGlubmVyU2l6ZU5hbWUgPSBcImlubmVySFwiO1xuXHRcdFx0XHRiZWZvcmVOYW1lID0gJ3RvcCc7XG5cdFx0XHRcdGRlbHRhU2l6ZU5hbWUgPSBcImRlbHRhSFwiO1xuXHRcdFx0XHRjb250ZW50U2l6ZU5hbWUgPSBcImNvbnRlbnRIXCI7XG5cblx0XHRcdFx0YWxpZ25CZWZvcmVOYW1lID0gXCJsZWZ0XCI7XG5cdFx0XHRcdGFsaWduU2l6ZU5hbWUgPSBcIndcIjtcblx0XHRcdFx0YWxpZ25BeGlzTmFtZSA9IFwieFwiO1xuXHRcdFx0XHRhbGlnbklubmVyU2l6ZU5hbWUgPSBcImlubmVyV1wiO1xuXHRcdFx0XHRhbGlnbk1pblNpemVOYW1lID0gXCJtaW5XXCI7XG5cdFx0XHRcdGFsaWduQWZ0ZXJOYW1lID0gXCJyaWdodFwiO1xuXHRcdFx0XHRhbGlnbkRlbHRhU2l6ZU5hbWUgPSBcImRlbHRhV1wiO1xuXHRcdFx0XHRhbGlnbkNvbnRlbnRTaXplTmFtZSA9IFwiY29udGVudFdcIjtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHBvc05hbWUgPSBcInhcIjtcblx0XHRcdFx0c2l6ZU5hbWUgPSBcIndcIjtcblx0XHRcdFx0bWluU2l6ZU5hbWUgPSBcIm1pbldcIjtcblx0XHRcdFx0bWF4U2l6ZU5hbWUgPSBcIm1heFdcIjtcblx0XHRcdFx0aW5uZXJTaXplTmFtZSA9IFwiaW5uZXJXXCI7XG5cdFx0XHRcdGJlZm9yZU5hbWUgPSAnbGVmdCc7XG5cdFx0XHRcdGRlbHRhU2l6ZU5hbWUgPSBcImRlbHRhV1wiO1xuXHRcdFx0XHRjb250ZW50U2l6ZU5hbWUgPSBcImNvbnRlbnRXXCI7XG5cblx0XHRcdFx0YWxpZ25CZWZvcmVOYW1lID0gXCJ0b3BcIjtcblx0XHRcdFx0YWxpZ25TaXplTmFtZSA9IFwiaFwiO1xuXHRcdFx0XHRhbGlnbkF4aXNOYW1lID0gXCJ5XCI7XG5cdFx0XHRcdGFsaWduSW5uZXJTaXplTmFtZSA9IFwiaW5uZXJIXCI7XG5cdFx0XHRcdGFsaWduTWluU2l6ZU5hbWUgPSBcIm1pbkhcIjtcblx0XHRcdFx0YWxpZ25BZnRlck5hbWUgPSBcImJvdHRvbVwiO1xuXHRcdFx0XHRhbGlnbkRlbHRhU2l6ZU5hbWUgPSBcImRlbHRhSFwiO1xuXHRcdFx0XHRhbGlnbkNvbnRlbnRTaXplTmFtZSA9IFwiY29udGVudEhcIjtcblx0XHRcdH1cblxuXHRcdFx0Ly8gRmlndXJlIG91dCB0b3RhbCBmbGV4LCBhdmFpbGFibGVTcGFjZSBhbmQgY29sbGVjdCBhbnkgbWF4IHNpemUgZWxlbWVudHNcblx0XHRcdGF2YWlsYWJsZVNwYWNlID0gY29udExheW91dFJlY3RbaW5uZXJTaXplTmFtZV0gLSBjb250UGFkZGluZ0JveFtiZWZvcmVOYW1lXSAtIGNvbnRQYWRkaW5nQm94W2JlZm9yZU5hbWVdO1xuXHRcdFx0bWF4QWxpZ25FbmRQb3MgPSB0b3RhbEZsZXggPSAwO1xuXHRcdFx0Zm9yIChpID0gMCwgbCA9IGl0ZW1zLmxlbmd0aDsgaSA8IGw7IGkrKykge1xuXHRcdFx0XHRjdHJsID0gaXRlbXNbaV07XG5cdFx0XHRcdGN0cmxMYXlvdXRSZWN0ID0gY3RybC5sYXlvdXRSZWN0KCk7XG5cdFx0XHRcdGN0cmxTZXR0aW5ncyA9IGN0cmwuc2V0dGluZ3M7XG5cdFx0XHRcdGZsZXggPSBjdHJsU2V0dGluZ3MuZmxleDtcblx0XHRcdFx0YXZhaWxhYmxlU3BhY2UgLT0gKGkgPCBsIC0gMSA/IHNwYWNpbmcgOiAwKTtcblxuXHRcdFx0XHRpZiAoZmxleCA+IDApIHtcblx0XHRcdFx0XHR0b3RhbEZsZXggKz0gZmxleDtcblxuXHRcdFx0XHRcdC8vIEZsZXhlZCBpdGVtIGhhcyBhIG1heCBzaXplIHRoZW4gd2UgbmVlZCB0byBjaGVjayBpZiB3ZSB3aWxsIGhpdCB0aGF0IHNpemVcblx0XHRcdFx0XHRpZiAoY3RybExheW91dFJlY3RbbWF4U2l6ZU5hbWVdKSB7XG5cdFx0XHRcdFx0XHRtYXhTaXplSXRlbXMucHVzaChjdHJsKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRjdHJsTGF5b3V0UmVjdC5mbGV4ID0gZmxleDtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGF2YWlsYWJsZVNwYWNlIC09IGN0cmxMYXlvdXRSZWN0W21pblNpemVOYW1lXTtcblxuXHRcdFx0XHQvLyBDYWxjdWxhdGUgdGhlIGFsaWduIGVuZCBwb3NpdGlvbiB0byBiZSB1c2VkIHRvIGNoZWNrIGZvciBvdmVyZmxvdy91bmRlcmZsb3dcblx0XHRcdFx0c2l6ZSA9IGNvbnRQYWRkaW5nQm94W2FsaWduQmVmb3JlTmFtZV0gKyBjdHJsTGF5b3V0UmVjdFthbGlnbk1pblNpemVOYW1lXSArIGNvbnRQYWRkaW5nQm94W2FsaWduQWZ0ZXJOYW1lXTtcblx0XHRcdFx0aWYgKHNpemUgPiBtYXhBbGlnbkVuZFBvcykge1xuXHRcdFx0XHRcdG1heEFsaWduRW5kUG9zID0gc2l6ZTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHQvLyBDYWxjdWxhdGUgbWluVy9taW5IXG5cdFx0XHRyZWN0ID0ge307XG5cdFx0XHRpZiAoYXZhaWxhYmxlU3BhY2UgPCAwKSB7XG5cdFx0XHRcdHJlY3RbbWluU2l6ZU5hbWVdID0gY29udExheW91dFJlY3RbbWluU2l6ZU5hbWVdIC0gYXZhaWxhYmxlU3BhY2UgKyBjb250TGF5b3V0UmVjdFtkZWx0YVNpemVOYW1lXTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHJlY3RbbWluU2l6ZU5hbWVdID0gY29udExheW91dFJlY3RbaW5uZXJTaXplTmFtZV0gLSBhdmFpbGFibGVTcGFjZSArIGNvbnRMYXlvdXRSZWN0W2RlbHRhU2l6ZU5hbWVdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZWN0W2FsaWduTWluU2l6ZU5hbWVdID0gbWF4QWxpZ25FbmRQb3MgKyBjb250TGF5b3V0UmVjdFthbGlnbkRlbHRhU2l6ZU5hbWVdO1xuXG5cdFx0XHRyZWN0W2NvbnRlbnRTaXplTmFtZV0gPSBjb250TGF5b3V0UmVjdFtpbm5lclNpemVOYW1lXSAtIGF2YWlsYWJsZVNwYWNlO1xuXHRcdFx0cmVjdFthbGlnbkNvbnRlbnRTaXplTmFtZV0gPSBtYXhBbGlnbkVuZFBvcztcblx0XHRcdHJlY3QubWluVyA9IG1pbihyZWN0Lm1pblcsIGNvbnRMYXlvdXRSZWN0Lm1heFcpO1xuXHRcdFx0cmVjdC5taW5IID0gbWluKHJlY3QubWluSCwgY29udExheW91dFJlY3QubWF4SCk7XG5cdFx0XHRyZWN0Lm1pblcgPSBtYXgocmVjdC5taW5XLCBjb250TGF5b3V0UmVjdC5zdGFydE1pbldpZHRoKTtcblx0XHRcdHJlY3QubWluSCA9IG1heChyZWN0Lm1pbkgsIGNvbnRMYXlvdXRSZWN0LnN0YXJ0TWluSGVpZ2h0KTtcblxuXHRcdFx0Ly8gUmVzaXplIGNvbnRhaW5lciBjb250YWluZXIgaWYgbWluU2l6ZSB3YXMgY2hhbmdlZFxuXHRcdFx0aWYgKGNvbnRMYXlvdXRSZWN0LmF1dG9SZXNpemUgJiYgKHJlY3QubWluVyAhPSBjb250TGF5b3V0UmVjdC5taW5XIHx8IHJlY3QubWluSCAhPSBjb250TGF5b3V0UmVjdC5taW5IKSkge1xuXHRcdFx0XHRyZWN0LncgPSByZWN0Lm1pblc7XG5cdFx0XHRcdHJlY3QuaCA9IHJlY3QubWluSDtcblxuXHRcdFx0XHRjb250YWluZXIubGF5b3V0UmVjdChyZWN0KTtcblx0XHRcdFx0dGhpcy5yZWNhbGMoY29udGFpbmVyKTtcblxuXHRcdFx0XHQvLyBGb3JjZWQgcmVjYWxjIGZvciBleGFtcGxlIGlmIGl0ZW1zIGFyZSBoaWRkZW4vc2hvd25cblx0XHRcdFx0aWYgKGNvbnRhaW5lci5fbGFzdFJlY3QgPT09IG51bGwpIHtcblx0XHRcdFx0XHR2YXIgcGFyZW50Q3RybCA9IGNvbnRhaW5lci5wYXJlbnQoKTtcblx0XHRcdFx0XHRpZiAocGFyZW50Q3RybCkge1xuXHRcdFx0XHRcdFx0cGFyZW50Q3RybC5fbGFzdFJlY3QgPSBudWxsO1xuXHRcdFx0XHRcdFx0cGFyZW50Q3RybC5yZWNhbGMoKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdC8vIEhhbmRsZSBtYXggc2l6ZSBlbGVtZW50cywgY2hlY2sgaWYgdGhleSB3aWxsIGJlY29tZSB0byB3aWRlIHdpdGggY3VycmVudCBvcHRpb25zXG5cdFx0XHRyYXRpbyA9IGF2YWlsYWJsZVNwYWNlIC8gdG90YWxGbGV4O1xuXHRcdFx0Zm9yIChpID0gMCwgbCA9IG1heFNpemVJdGVtcy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcblx0XHRcdFx0Y3RybCA9IG1heFNpemVJdGVtc1tpXTtcblx0XHRcdFx0Y3RybExheW91dFJlY3QgPSBjdHJsLmxheW91dFJlY3QoKTtcblx0XHRcdFx0bWF4U2l6ZSA9IGN0cmxMYXlvdXRSZWN0W21heFNpemVOYW1lXTtcblx0XHRcdFx0c2l6ZSA9IGN0cmxMYXlvdXRSZWN0W21pblNpemVOYW1lXSArIGN0cmxMYXlvdXRSZWN0LmZsZXggKiByYXRpbztcblxuXHRcdFx0XHRpZiAoc2l6ZSA+IG1heFNpemUpIHtcblx0XHRcdFx0XHRhdmFpbGFibGVTcGFjZSAtPSAoY3RybExheW91dFJlY3RbbWF4U2l6ZU5hbWVdIC0gY3RybExheW91dFJlY3RbbWluU2l6ZU5hbWVdKTtcblx0XHRcdFx0XHR0b3RhbEZsZXggLT0gY3RybExheW91dFJlY3QuZmxleDtcblx0XHRcdFx0XHRjdHJsTGF5b3V0UmVjdC5mbGV4ID0gMDtcblx0XHRcdFx0XHRjdHJsTGF5b3V0UmVjdC5tYXhGbGV4U2l6ZSA9IG1heFNpemU7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y3RybExheW91dFJlY3QubWF4RmxleFNpemUgPSAwO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdC8vIFNldHVwIG5ldyByYXRpbywgdGFyZ2V0IGxheW91dCByZWN0LCBzdGFydCBwb3NpdGlvblxuXHRcdFx0cmF0aW8gPSBhdmFpbGFibGVTcGFjZSAvIHRvdGFsRmxleDtcblx0XHRcdHBvcyA9IGNvbnRQYWRkaW5nQm94W2JlZm9yZU5hbWVdO1xuXHRcdFx0cmVjdCA9IHt9O1xuXG5cdFx0XHQvLyBIYW5kbGUgcGFjayBzZXR0aW5nIG1vdmVzIHRoZSBzdGFydCBwb3NpdGlvbiB0byBlbmQsIGNlbnRlclxuXHRcdFx0aWYgKHRvdGFsRmxleCA9PT0gMCkge1xuXHRcdFx0XHRpZiAocGFjayA9PSBcImVuZFwiKSB7XG5cdFx0XHRcdFx0cG9zID0gYXZhaWxhYmxlU3BhY2UgKyBjb250UGFkZGluZ0JveFtiZWZvcmVOYW1lXTtcblx0XHRcdFx0fSBlbHNlIGlmIChwYWNrID09IFwiY2VudGVyXCIpIHtcblx0XHRcdFx0XHRwb3MgPSBNYXRoLnJvdW5kKFxuXHRcdFx0XHRcdFx0KGNvbnRMYXlvdXRSZWN0W2lubmVyU2l6ZU5hbWVdIC8gMikgLSAoKGNvbnRMYXlvdXRSZWN0W2lubmVyU2l6ZU5hbWVdIC0gYXZhaWxhYmxlU3BhY2UpIC8gMilcblx0XHRcdFx0XHQpICsgY29udFBhZGRpbmdCb3hbYmVmb3JlTmFtZV07XG5cblx0XHRcdFx0XHRpZiAocG9zIDwgMCkge1xuXHRcdFx0XHRcdFx0cG9zID0gY29udFBhZGRpbmdCb3hbYmVmb3JlTmFtZV07XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGVsc2UgaWYgKHBhY2sgPT0gXCJqdXN0aWZ5XCIpIHtcblx0XHRcdFx0XHRwb3MgPSBjb250UGFkZGluZ0JveFtiZWZvcmVOYW1lXTtcblx0XHRcdFx0XHRzcGFjaW5nID0gTWF0aC5mbG9vcihhdmFpbGFibGVTcGFjZSAvIChpdGVtcy5sZW5ndGggLSAxKSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0Ly8gRGVmYXVsdCBhbGlnbmluZyAoc3RhcnQpIHRoZSBvdGhlciBvbmVzIG5lZWRzIHRvIGJlIGNhbGN1bGF0ZWQgd2hpbGUgZG9pbmcgdGhlIGxheW91dFxuXHRcdFx0cmVjdFthbGlnbkF4aXNOYW1lXSA9IGNvbnRQYWRkaW5nQm94W2FsaWduQmVmb3JlTmFtZV07XG5cblx0XHRcdC8vIFN0YXJ0IGxheWluZyBvdXQgY29udHJvbHNcblx0XHRcdGZvciAoaSA9IDAsIGwgPSBpdGVtcy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcblx0XHRcdFx0Y3RybCA9IGl0ZW1zW2ldO1xuXHRcdFx0XHRjdHJsTGF5b3V0UmVjdCA9IGN0cmwubGF5b3V0UmVjdCgpO1xuXHRcdFx0XHRzaXplID0gY3RybExheW91dFJlY3QubWF4RmxleFNpemUgfHwgY3RybExheW91dFJlY3RbbWluU2l6ZU5hbWVdO1xuXG5cdFx0XHRcdC8vIEFsaWduIHRoZSBjb250cm9sIG9uIHRoZSBvdGhlciBheGlzXG5cdFx0XHRcdGlmIChhbGlnbiA9PT0gXCJjZW50ZXJcIikge1xuXHRcdFx0XHRcdHJlY3RbYWxpZ25BeGlzTmFtZV0gPSBNYXRoLnJvdW5kKChjb250TGF5b3V0UmVjdFthbGlnbklubmVyU2l6ZU5hbWVdIC8gMikgLSAoY3RybExheW91dFJlY3RbYWxpZ25TaXplTmFtZV0gLyAyKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoYWxpZ24gPT09IFwic3RyZXRjaFwiKSB7XG5cdFx0XHRcdFx0cmVjdFthbGlnblNpemVOYW1lXSA9IG1heChcblx0XHRcdFx0XHRcdGN0cmxMYXlvdXRSZWN0W2FsaWduTWluU2l6ZU5hbWVdIHx8IDAsXG5cdFx0XHRcdFx0XHRjb250TGF5b3V0UmVjdFthbGlnbklubmVyU2l6ZU5hbWVdIC0gY29udFBhZGRpbmdCb3hbYWxpZ25CZWZvcmVOYW1lXSAtIGNvbnRQYWRkaW5nQm94W2FsaWduQWZ0ZXJOYW1lXVxuXHRcdFx0XHRcdCk7XG5cdFx0XHRcdFx0cmVjdFthbGlnbkF4aXNOYW1lXSA9IGNvbnRQYWRkaW5nQm94W2FsaWduQmVmb3JlTmFtZV07XG5cdFx0XHRcdH0gZWxzZSBpZiAoYWxpZ24gPT09IFwiZW5kXCIpIHtcblx0XHRcdFx0XHRyZWN0W2FsaWduQXhpc05hbWVdID0gY29udExheW91dFJlY3RbYWxpZ25Jbm5lclNpemVOYW1lXSAtIGN0cmxMYXlvdXRSZWN0W2FsaWduU2l6ZU5hbWVdIC0gY29udFBhZGRpbmdCb3gudG9wO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gQ2FsY3VsYXRlIG5ldyBzaXplIGJhc2VkIG9uIGZsZXhcblx0XHRcdFx0aWYgKGN0cmxMYXlvdXRSZWN0LmZsZXggPiAwKSB7XG5cdFx0XHRcdFx0c2l6ZSArPSBjdHJsTGF5b3V0UmVjdC5mbGV4ICogcmF0aW87XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZWN0W3NpemVOYW1lXSA9IHNpemU7XG5cdFx0XHRcdHJlY3RbcG9zTmFtZV0gPSBwb3M7XG5cdFx0XHRcdGN0cmwubGF5b3V0UmVjdChyZWN0KTtcblxuXHRcdFx0XHQvLyBSZWNhbGN1bGF0ZSBjb250YWluZXJzXG5cdFx0XHRcdGlmIChjdHJsLnJlY2FsYykge1xuXHRcdFx0XHRcdGN0cmwucmVjYWxjKCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBNb3ZlIHgveSBwb3NpdGlvblxuXHRcdFx0XHRwb3MgKz0gc2l6ZSArIHNwYWNpbmc7XG5cdFx0XHR9XG5cdFx0fVxuXHR9KTtcbn0pO1xuXG4vLyBJbmNsdWRlZCBmcm9tOiBqcy90aW55bWNlL2NsYXNzZXMvdWkvRmxvd0xheW91dC5qc1xuXG4vKipcbiAqIEZsb3dMYXlvdXQuanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBUaGlzIGxheW91dCBtYW5hZ2VyIHdpbGwgcGxhY2UgdGhlIGNvbnRyb2xzIGJ5IHVzaW5nIHRoZSBicm93c2VycyBuYXRpdmUgbGF5b3V0LlxuICpcbiAqIEAteC1sZXNzIEZsb3dMYXlvdXQubGVzc1xuICogQGNsYXNzIHRpbnltY2UudWkuRmxvd0xheW91dFxuICogQGV4dGVuZHMgdGlueW1jZS51aS5MYXlvdXRcbiAqL1xuZGVmaW5lKFwidGlueW1jZS91aS9GbG93TGF5b3V0XCIsIFtcblx0XCJ0aW55bWNlL3VpL0xheW91dFwiXG5dLCBmdW5jdGlvbihMYXlvdXQpIHtcblx0cmV0dXJuIExheW91dC5leHRlbmQoe1xuXHRcdERlZmF1bHRzOiB7XG5cdFx0XHRjb250YWluZXJDbGFzczogJ2Zsb3ctbGF5b3V0Jyxcblx0XHRcdGNvbnRyb2xDbGFzczogJ2Zsb3ctbGF5b3V0LWl0ZW0nLFxuXHRcdFx0ZW5kQ2xhc3M6ICdicmVhaydcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmVjYWxjdWxhdGVzIHRoZSBwb3NpdGlvbnMgb2YgdGhlIGNvbnRyb2xzIGluIHRoZSBzcGVjaWZpZWQgY29udGFpbmVyLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCByZWNhbGNcblx0XHQgKiBAcGFyYW0ge3RpbnltY2UudWkuQ29udGFpbmVyfSBjb250YWluZXIgQ29udGFpbmVyIGluc3RhbmNlIHRvIHJlY2FsYy5cblx0XHQgKi9cblx0XHRyZWNhbGM6IGZ1bmN0aW9uKGNvbnRhaW5lcikge1xuXHRcdFx0Y29udGFpbmVyLml0ZW1zKCkuZmlsdGVyKCc6dmlzaWJsZScpLmVhY2goZnVuY3Rpb24oY3RybCkge1xuXHRcdFx0XHRpZiAoY3RybC5yZWNhbGMpIHtcblx0XHRcdFx0XHRjdHJsLnJlY2FsYygpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9LFxuXG5cdFx0aXNOYXRpdmU6IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0fVxuXHR9KTtcbn0pO1xuXG4vLyBJbmNsdWRlZCBmcm9tOiBqcy90aW55bWNlL2NsYXNzZXMvdWkvRm9ybWF0Q29udHJvbHMuanNcblxuLyoqXG4gKiBGb3JtYXRDb250cm9scy5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE1IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKipcbiAqIEludGVybmFsIGNsYXNzIGNvbnRhaW5pbmcgYWxsIFRpbnlNQ0Ugc3BlY2lmaWMgY29udHJvbCB0eXBlcyBzdWNoIGFzXG4gKiBmb3JtYXQgbGlzdGJveGVzLCBmb250bGlzdCBib3hlcywgdG9vbGJhciBidXR0b25zIGV0Yy5cbiAqXG4gKiBAY2xhc3MgdGlueW1jZS51aS5Gb3JtYXRDb250cm9sc1xuICovXG5kZWZpbmUoXCJ0aW55bWNlL3VpL0Zvcm1hdENvbnRyb2xzXCIsIFtcblx0XCJ0aW55bWNlL3VpL0NvbnRyb2xcIixcblx0XCJ0aW55bWNlL3VpL1dpZGdldFwiLFxuXHRcInRpbnltY2UvdWkvRmxvYXRQYW5lbFwiLFxuXHRcInRpbnltY2UvdXRpbC9Ub29sc1wiLFxuXHRcInRpbnltY2UvdXRpbC9BcnJcIixcblx0XCJ0aW55bWNlL2RvbS9ET01VdGlsc1wiLFxuXHRcInRpbnltY2UvRWRpdG9yTWFuYWdlclwiLFxuXHRcInRpbnltY2UvRW52XCJcbl0sIGZ1bmN0aW9uKENvbnRyb2wsIFdpZGdldCwgRmxvYXRQYW5lbCwgVG9vbHMsIEFyciwgRE9NVXRpbHMsIEVkaXRvck1hbmFnZXIsIEVudikge1xuXHR2YXIgZWFjaCA9IFRvb2xzLmVhY2g7XG5cblx0dmFyIGZsYXR0ZW4gPSBmdW5jdGlvbiAoYXIpIHtcblx0XHRyZXR1cm4gQXJyLnJlZHVjZShhciwgZnVuY3Rpb24gKHJlc3VsdCwgaXRlbSkge1xuXHRcdFx0cmV0dXJuIHJlc3VsdC5jb25jYXQoaXRlbSk7XG5cdFx0fSwgW10pO1xuXHR9O1xuXG5cdEVkaXRvck1hbmFnZXIub24oJ0FkZEVkaXRvcicsIGZ1bmN0aW9uKGUpIHtcblx0XHR2YXIgZWRpdG9yID0gZS5lZGl0b3I7XG5cblx0XHRzZXR1cFJ0bE1vZGUoZWRpdG9yKTtcblx0XHRyZWdpc3RlckNvbnRyb2xzKGVkaXRvcik7XG5cdFx0c2V0dXBDb250YWluZXIoZWRpdG9yKTtcblx0fSk7XG5cblx0Q29udHJvbC50cmFuc2xhdGUgPSBmdW5jdGlvbih0ZXh0KSB7XG5cdFx0cmV0dXJuIEVkaXRvck1hbmFnZXIudHJhbnNsYXRlKHRleHQpO1xuXHR9O1xuXG5cdFdpZGdldC50b29sdGlwcyA9ICFFbnYuaU9TO1xuXG5cdGZ1bmN0aW9uIHNldHVwQ29udGFpbmVyKGVkaXRvcikge1xuXHRcdGlmIChlZGl0b3Iuc2V0dGluZ3MudWlfY29udGFpbmVyKSB7XG5cdFx0XHRFbnYuY29udGFpbmVyID0gRE9NVXRpbHMuRE9NLnNlbGVjdChlZGl0b3Iuc2V0dGluZ3MudWlfY29udGFpbmVyKVswXTtcblx0XHR9XG5cdH1cblxuXHRmdW5jdGlvbiBzZXR1cFJ0bE1vZGUoZWRpdG9yKSB7XG5cdFx0ZWRpdG9yLm9uKCdTY3JpcHRzTG9hZGVkJywgZnVuY3Rpb24gKCkge1xuXHRcdFx0aWYgKGVkaXRvci5ydGwpIHtcblx0XHRcdFx0Q29udHJvbC5ydGwgPSB0cnVlO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cblx0ZnVuY3Rpb24gcmVnaXN0ZXJDb250cm9scyhlZGl0b3IpIHtcblx0XHR2YXIgZm9ybWF0TWVudTtcblxuXHRcdGZ1bmN0aW9uIGNyZWF0ZUxpc3RCb3hDaGFuZ2VIYW5kbGVyKGl0ZW1zLCBmb3JtYXROYW1lKSB7XG5cdFx0XHRyZXR1cm4gZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0XHRlZGl0b3Iub24oJ25vZGVDaGFuZ2UnLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdFx0dmFyIGZvcm1hdHRlciA9IGVkaXRvci5mb3JtYXR0ZXI7XG5cdFx0XHRcdFx0dmFyIHZhbHVlID0gbnVsbDtcblxuXHRcdFx0XHRcdGVhY2goZS5wYXJlbnRzLCBmdW5jdGlvbihub2RlKSB7XG5cdFx0XHRcdFx0XHRlYWNoKGl0ZW1zLCBmdW5jdGlvbihpdGVtKSB7XG5cdFx0XHRcdFx0XHRcdGlmIChmb3JtYXROYW1lKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKGZvcm1hdHRlci5tYXRjaE5vZGUobm9kZSwgZm9ybWF0TmFtZSwge3ZhbHVlOiBpdGVtLnZhbHVlfSkpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHZhbHVlID0gaXRlbS52YWx1ZTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKGZvcm1hdHRlci5tYXRjaE5vZGUobm9kZSwgaXRlbS52YWx1ZSkpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHZhbHVlID0gaXRlbS52YWx1ZTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRpZiAodmFsdWUpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0XHRpZiAodmFsdWUpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0c2VsZi52YWx1ZSh2YWx1ZSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fTtcblx0XHR9XG5cblx0XHRmdW5jdGlvbiBjcmVhdGVGb3JtYXRzKGZvcm1hdHMpIHtcblx0XHRcdGZvcm1hdHMgPSBmb3JtYXRzLnJlcGxhY2UoLzskLywgJycpLnNwbGl0KCc7Jyk7XG5cblx0XHRcdHZhciBpID0gZm9ybWF0cy5sZW5ndGg7XG5cdFx0XHR3aGlsZSAoaS0tKSB7XG5cdFx0XHRcdGZvcm1hdHNbaV0gPSBmb3JtYXRzW2ldLnNwbGl0KCc9Jyk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBmb3JtYXRzO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIGNyZWF0ZUZvcm1hdE1lbnUoKSB7XG5cdFx0XHR2YXIgY291bnQgPSAwLCBuZXdGb3JtYXRzID0gW107XG5cblx0XHRcdHZhciBkZWZhdWx0U3R5bGVGb3JtYXRzID0gW1xuXHRcdFx0XHR7dGl0bGU6ICdIZWFkaW5ncycsIGl0ZW1zOiBbXG5cdFx0XHRcdFx0e3RpdGxlOiAnSGVhZGluZyAxJywgZm9ybWF0OiAnaDEnfSxcblx0XHRcdFx0XHR7dGl0bGU6ICdIZWFkaW5nIDInLCBmb3JtYXQ6ICdoMid9LFxuXHRcdFx0XHRcdHt0aXRsZTogJ0hlYWRpbmcgMycsIGZvcm1hdDogJ2gzJ30sXG5cdFx0XHRcdFx0e3RpdGxlOiAnSGVhZGluZyA0JywgZm9ybWF0OiAnaDQnfSxcblx0XHRcdFx0XHR7dGl0bGU6ICdIZWFkaW5nIDUnLCBmb3JtYXQ6ICdoNSd9LFxuXHRcdFx0XHRcdHt0aXRsZTogJ0hlYWRpbmcgNicsIGZvcm1hdDogJ2g2J31cblx0XHRcdFx0XX0sXG5cblx0XHRcdFx0e3RpdGxlOiAnSW5saW5lJywgaXRlbXM6IFtcblx0XHRcdFx0XHR7dGl0bGU6ICdCb2xkJywgaWNvbjogJ2JvbGQnLCBmb3JtYXQ6ICdib2xkJ30sXG5cdFx0XHRcdFx0e3RpdGxlOiAnSXRhbGljJywgaWNvbjogJ2l0YWxpYycsIGZvcm1hdDogJ2l0YWxpYyd9LFxuXHRcdFx0XHRcdHt0aXRsZTogJ1VuZGVybGluZScsIGljb246ICd1bmRlcmxpbmUnLCBmb3JtYXQ6ICd1bmRlcmxpbmUnfSxcblx0XHRcdFx0XHR7dGl0bGU6ICdTdHJpa2V0aHJvdWdoJywgaWNvbjogJ3N0cmlrZXRocm91Z2gnLCBmb3JtYXQ6ICdzdHJpa2V0aHJvdWdoJ30sXG5cdFx0XHRcdFx0e3RpdGxlOiAnU3VwZXJzY3JpcHQnLCBpY29uOiAnc3VwZXJzY3JpcHQnLCBmb3JtYXQ6ICdzdXBlcnNjcmlwdCd9LFxuXHRcdFx0XHRcdHt0aXRsZTogJ1N1YnNjcmlwdCcsIGljb246ICdzdWJzY3JpcHQnLCBmb3JtYXQ6ICdzdWJzY3JpcHQnfSxcblx0XHRcdFx0XHR7dGl0bGU6ICdDb2RlJywgaWNvbjogJ2NvZGUnLCBmb3JtYXQ6ICdjb2RlJ31cblx0XHRcdFx0XX0sXG5cblx0XHRcdFx0e3RpdGxlOiAnQmxvY2tzJywgaXRlbXM6IFtcblx0XHRcdFx0XHR7dGl0bGU6ICdQYXJhZ3JhcGgnLCBmb3JtYXQ6ICdwJ30sXG5cdFx0XHRcdFx0e3RpdGxlOiAnQmxvY2txdW90ZScsIGZvcm1hdDogJ2Jsb2NrcXVvdGUnfSxcblx0XHRcdFx0XHR7dGl0bGU6ICdEaXYnLCBmb3JtYXQ6ICdkaXYnfSxcblx0XHRcdFx0XHR7dGl0bGU6ICdQcmUnLCBmb3JtYXQ6ICdwcmUnfVxuXHRcdFx0XHRdfSxcblxuXHRcdFx0XHR7dGl0bGU6ICdBbGlnbm1lbnQnLCBpdGVtczogW1xuXHRcdFx0XHRcdHt0aXRsZTogJ0xlZnQnLCBpY29uOiAnYWxpZ25sZWZ0JywgZm9ybWF0OiAnYWxpZ25sZWZ0J30sXG5cdFx0XHRcdFx0e3RpdGxlOiAnQ2VudGVyJywgaWNvbjogJ2FsaWduY2VudGVyJywgZm9ybWF0OiAnYWxpZ25jZW50ZXInfSxcblx0XHRcdFx0XHR7dGl0bGU6ICdSaWdodCcsIGljb246ICdhbGlnbnJpZ2h0JywgZm9ybWF0OiAnYWxpZ25yaWdodCd9LFxuXHRcdFx0XHRcdHt0aXRsZTogJ0p1c3RpZnknLCBpY29uOiAnYWxpZ25qdXN0aWZ5JywgZm9ybWF0OiAnYWxpZ25qdXN0aWZ5J31cblx0XHRcdFx0XX1cblx0XHRcdF07XG5cblx0XHRcdGZ1bmN0aW9uIGNyZWF0ZU1lbnUoZm9ybWF0cykge1xuXHRcdFx0XHR2YXIgbWVudSA9IFtdO1xuXG5cdFx0XHRcdGlmICghZm9ybWF0cykge1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGVhY2goZm9ybWF0cywgZnVuY3Rpb24oZm9ybWF0KSB7XG5cdFx0XHRcdFx0dmFyIG1lbnVJdGVtID0ge1xuXHRcdFx0XHRcdFx0dGV4dDogZm9ybWF0LnRpdGxlLFxuXHRcdFx0XHRcdFx0aWNvbjogZm9ybWF0Lmljb25cblx0XHRcdFx0XHR9O1xuXG5cdFx0XHRcdFx0aWYgKGZvcm1hdC5pdGVtcykge1xuXHRcdFx0XHRcdFx0bWVudUl0ZW0ubWVudSA9IGNyZWF0ZU1lbnUoZm9ybWF0Lml0ZW1zKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0dmFyIGZvcm1hdE5hbWUgPSBmb3JtYXQuZm9ybWF0IHx8IFwiY3VzdG9tXCIgKyBjb3VudCsrO1xuXG5cdFx0XHRcdFx0XHRpZiAoIWZvcm1hdC5mb3JtYXQpIHtcblx0XHRcdFx0XHRcdFx0Zm9ybWF0Lm5hbWUgPSBmb3JtYXROYW1lO1xuXHRcdFx0XHRcdFx0XHRuZXdGb3JtYXRzLnB1c2goZm9ybWF0KTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0bWVudUl0ZW0uZm9ybWF0ID0gZm9ybWF0TmFtZTtcblx0XHRcdFx0XHRcdG1lbnVJdGVtLmNtZCA9IGZvcm1hdC5jbWQ7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0bWVudS5wdXNoKG1lbnVJdGVtKTtcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0cmV0dXJuIG1lbnU7XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIGNyZWF0ZVN0eWxlc01lbnUoKSB7XG5cdFx0XHRcdHZhciBtZW51O1xuXG5cdFx0XHRcdGlmIChlZGl0b3Iuc2V0dGluZ3Muc3R5bGVfZm9ybWF0c19tZXJnZSkge1xuXHRcdFx0XHRcdGlmIChlZGl0b3Iuc2V0dGluZ3Muc3R5bGVfZm9ybWF0cykge1xuXHRcdFx0XHRcdFx0bWVudSA9IGNyZWF0ZU1lbnUoZGVmYXVsdFN0eWxlRm9ybWF0cy5jb25jYXQoZWRpdG9yLnNldHRpbmdzLnN0eWxlX2Zvcm1hdHMpKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0bWVudSA9IGNyZWF0ZU1lbnUoZGVmYXVsdFN0eWxlRm9ybWF0cyk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG1lbnUgPSBjcmVhdGVNZW51KGVkaXRvci5zZXR0aW5ncy5zdHlsZV9mb3JtYXRzIHx8IGRlZmF1bHRTdHlsZUZvcm1hdHMpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG1lbnU7XG5cdFx0XHR9XG5cblx0XHRcdGVkaXRvci5vbignaW5pdCcsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRlYWNoKG5ld0Zvcm1hdHMsIGZ1bmN0aW9uKGZvcm1hdCkge1xuXHRcdFx0XHRcdGVkaXRvci5mb3JtYXR0ZXIucmVnaXN0ZXIoZm9ybWF0Lm5hbWUsIGZvcm1hdCk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSk7XG5cblx0XHRcdHJldHVybiB7XG5cdFx0XHRcdHR5cGU6ICdtZW51Jyxcblx0XHRcdFx0aXRlbXM6IGNyZWF0ZVN0eWxlc01lbnUoKSxcblx0XHRcdFx0b25Qb3N0UmVuZGVyOiBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdFx0ZWRpdG9yLmZpcmUoJ3JlbmRlckZvcm1hdHNNZW51Jywge2NvbnRyb2w6IGUuY29udHJvbH0pO1xuXHRcdFx0XHR9LFxuXHRcdFx0XHRpdGVtRGVmYXVsdHM6IHtcblx0XHRcdFx0XHRwcmV2aWV3OiB0cnVlLFxuXG5cdFx0XHRcdFx0dGV4dFN0eWxlOiBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRcdGlmICh0aGlzLnNldHRpbmdzLmZvcm1hdCkge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gZWRpdG9yLmZvcm1hdHRlci5nZXRDc3NUZXh0KHRoaXMuc2V0dGluZ3MuZm9ybWF0KTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9LFxuXG5cdFx0XHRcdFx0b25Qb3N0UmVuZGVyOiBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0XHRcdFx0c2VsZi5wYXJlbnQoKS5vbignc2hvdycsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdFx0XHR2YXIgZm9ybWF0TmFtZSwgY29tbWFuZDtcblxuXHRcdFx0XHRcdFx0XHRmb3JtYXROYW1lID0gc2VsZi5zZXR0aW5ncy5mb3JtYXQ7XG5cdFx0XHRcdFx0XHRcdGlmIChmb3JtYXROYW1lKSB7XG5cdFx0XHRcdFx0XHRcdFx0c2VsZi5kaXNhYmxlZCghZWRpdG9yLmZvcm1hdHRlci5jYW5BcHBseShmb3JtYXROYW1lKSk7XG5cdFx0XHRcdFx0XHRcdFx0c2VsZi5hY3RpdmUoZWRpdG9yLmZvcm1hdHRlci5tYXRjaChmb3JtYXROYW1lKSk7XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRjb21tYW5kID0gc2VsZi5zZXR0aW5ncy5jbWQ7XG5cdFx0XHRcdFx0XHRcdGlmIChjb21tYW5kKSB7XG5cdFx0XHRcdFx0XHRcdFx0c2VsZi5hY3RpdmUoZWRpdG9yLnF1ZXJ5Q29tbWFuZFN0YXRlKGNvbW1hbmQpKTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0fSxcblxuXHRcdFx0XHRcdG9uY2xpY2s6IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdFx0aWYgKHRoaXMuc2V0dGluZ3MuZm9ybWF0KSB7XG5cdFx0XHRcdFx0XHRcdHRvZ2dsZUZvcm1hdCh0aGlzLnNldHRpbmdzLmZvcm1hdCk7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGlmICh0aGlzLnNldHRpbmdzLmNtZCkge1xuXHRcdFx0XHRcdFx0XHRlZGl0b3IuZXhlY0NvbW1hbmQodGhpcy5zZXR0aW5ncy5jbWQpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fTtcblx0XHR9XG5cblx0XHRmb3JtYXRNZW51ID0gY3JlYXRlRm9ybWF0TWVudSgpO1xuXG5cdFx0ZnVuY3Rpb24gaW5pdE9uUG9zdFJlbmRlcihuYW1lKSB7XG5cdFx0XHRyZXR1cm4gZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0XHQvLyBUT0RPOiBGaXggdGhpc1xuXHRcdFx0XHRpZiAoZWRpdG9yLmZvcm1hdHRlcikge1xuXHRcdFx0XHRcdGVkaXRvci5mb3JtYXR0ZXIuZm9ybWF0Q2hhbmdlZChuYW1lLCBmdW5jdGlvbihzdGF0ZSkge1xuXHRcdFx0XHRcdFx0c2VsZi5hY3RpdmUoc3RhdGUpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGVkaXRvci5vbignaW5pdCcsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdFx0ZWRpdG9yLmZvcm1hdHRlci5mb3JtYXRDaGFuZ2VkKG5hbWUsIGZ1bmN0aW9uKHN0YXRlKSB7XG5cdFx0XHRcdFx0XHRcdHNlbGYuYWN0aXZlKHN0YXRlKTtcblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9O1xuXHRcdH1cblxuXHRcdC8vIFNpbXBsZSBmb3JtYXQgY29udHJvbHMgPGNvbnRyb2wvZm9ybWF0Pjo8VUkgdGV4dD5cblx0XHRlYWNoKHtcblx0XHRcdGJvbGQ6ICdCb2xkJyxcblx0XHRcdGl0YWxpYzogJ0l0YWxpYycsXG5cdFx0XHR1bmRlcmxpbmU6ICdVbmRlcmxpbmUnLFxuXHRcdFx0c3RyaWtldGhyb3VnaDogJ1N0cmlrZXRocm91Z2gnLFxuXHRcdFx0c3Vic2NyaXB0OiAnU3Vic2NyaXB0Jyxcblx0XHRcdHN1cGVyc2NyaXB0OiAnU3VwZXJzY3JpcHQnXG5cdFx0fSwgZnVuY3Rpb24odGV4dCwgbmFtZSkge1xuXHRcdFx0ZWRpdG9yLmFkZEJ1dHRvbihuYW1lLCB7XG5cdFx0XHRcdHRvb2x0aXA6IHRleHQsXG5cdFx0XHRcdG9uUG9zdFJlbmRlcjogaW5pdE9uUG9zdFJlbmRlcihuYW1lKSxcblx0XHRcdFx0b25jbGljazogZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0dG9nZ2xlRm9ybWF0KG5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9KTtcblxuXHRcdC8vIFNpbXBsZSBjb21tYW5kIGNvbnRyb2xzIDxjb250cm9sPjpbPFVJIHRleHQ+LDxDb21tYW5kPl1cblx0XHRlYWNoKHtcblx0XHRcdG91dGRlbnQ6IFsnRGVjcmVhc2UgaW5kZW50JywgJ091dGRlbnQnXSxcblx0XHRcdGluZGVudDogWydJbmNyZWFzZSBpbmRlbnQnLCAnSW5kZW50J10sXG5cdFx0XHRjdXQ6IFsnQ3V0JywgJ0N1dCddLFxuXHRcdFx0Y29weTogWydDb3B5JywgJ0NvcHknXSxcblx0XHRcdHBhc3RlOiBbJ1Bhc3RlJywgJ1Bhc3RlJ10sXG5cdFx0XHRoZWxwOiBbJ0hlbHAnLCAnbWNlSGVscCddLFxuXHRcdFx0c2VsZWN0YWxsOiBbJ1NlbGVjdCBhbGwnLCAnU2VsZWN0QWxsJ10sXG5cdFx0XHRyZW1vdmVmb3JtYXQ6IFsnQ2xlYXIgZm9ybWF0dGluZycsICdSZW1vdmVGb3JtYXQnXSxcblx0XHRcdHZpc3VhbGFpZDogWydWaXN1YWwgYWlkcycsICdtY2VUb2dnbGVWaXN1YWxBaWQnXSxcblx0XHRcdG5ld2RvY3VtZW50OiBbJ05ldyBkb2N1bWVudCcsICdtY2VOZXdEb2N1bWVudCddXG5cdFx0fSwgZnVuY3Rpb24oaXRlbSwgbmFtZSkge1xuXHRcdFx0ZWRpdG9yLmFkZEJ1dHRvbihuYW1lLCB7XG5cdFx0XHRcdHRvb2x0aXA6IGl0ZW1bMF0sXG5cdFx0XHRcdGNtZDogaXRlbVsxXVxuXHRcdFx0fSk7XG5cdFx0fSk7XG5cblx0XHQvLyBTaW1wbGUgY29tbWFuZCBjb250cm9scyB3aXRoIGZvcm1hdCBzdGF0ZVxuXHRcdGVhY2goe1xuXHRcdFx0YmxvY2txdW90ZTogWydCbG9ja3F1b3RlJywgJ21jZUJsb2NrUXVvdGUnXSxcblx0XHRcdHN1YnNjcmlwdDogWydTdWJzY3JpcHQnLCAnU3Vic2NyaXB0J10sXG5cdFx0XHRzdXBlcnNjcmlwdDogWydTdXBlcnNjcmlwdCcsICdTdXBlcnNjcmlwdCddLFxuXHRcdFx0YWxpZ25sZWZ0OiBbJ0FsaWduIGxlZnQnLCAnSnVzdGlmeUxlZnQnXSxcblx0XHRcdGFsaWduY2VudGVyOiBbJ0FsaWduIGNlbnRlcicsICdKdXN0aWZ5Q2VudGVyJ10sXG5cdFx0XHRhbGlnbnJpZ2h0OiBbJ0FsaWduIHJpZ2h0JywgJ0p1c3RpZnlSaWdodCddLFxuXHRcdFx0YWxpZ25qdXN0aWZ5OiBbJ0p1c3RpZnknLCAnSnVzdGlmeUZ1bGwnXSxcblx0XHRcdGFsaWdubm9uZTogWydObyBhbGlnbm1lbnQnLCAnSnVzdGlmeU5vbmUnXVxuXHRcdH0sIGZ1bmN0aW9uKGl0ZW0sIG5hbWUpIHtcblx0XHRcdGVkaXRvci5hZGRCdXR0b24obmFtZSwge1xuXHRcdFx0XHR0b29sdGlwOiBpdGVtWzBdLFxuXHRcdFx0XHRjbWQ6IGl0ZW1bMV0sXG5cdFx0XHRcdG9uUG9zdFJlbmRlcjogaW5pdE9uUG9zdFJlbmRlcihuYW1lKVxuXHRcdFx0fSk7XG5cdFx0fSk7XG5cblx0XHRmdW5jdGlvbiB0b2dnbGVVbmRvUmVkb1N0YXRlKHR5cGUpIHtcblx0XHRcdHJldHVybiBmdW5jdGlvbigpIHtcblx0XHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHRcdHR5cGUgPSB0eXBlID09ICdyZWRvJyA/ICdoYXNSZWRvJyA6ICdoYXNVbmRvJztcblxuXHRcdFx0XHRmdW5jdGlvbiBjaGVja1N0YXRlKCkge1xuXHRcdFx0XHRcdHJldHVybiBlZGl0b3IudW5kb01hbmFnZXIgPyBlZGl0b3IudW5kb01hbmFnZXJbdHlwZV0oKSA6IGZhbHNlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0c2VsZi5kaXNhYmxlZCghY2hlY2tTdGF0ZSgpKTtcblx0XHRcdFx0ZWRpdG9yLm9uKCdVbmRvIFJlZG8gQWRkVW5kbyBUeXBpbmdVbmRvIENsZWFyVW5kb3MgU3dpdGNoTW9kZScsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdHNlbGYuZGlzYWJsZWQoZWRpdG9yLnJlYWRvbmx5IHx8ICFjaGVja1N0YXRlKCkpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH07XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gdG9nZ2xlVmlzdWFsQWlkU3RhdGUoKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdGVkaXRvci5vbignVmlzdWFsQWlkJywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRzZWxmLmFjdGl2ZShlLmhhc1Zpc3VhbCk7XG5cdFx0XHR9KTtcblxuXHRcdFx0c2VsZi5hY3RpdmUoZWRpdG9yLmhhc1Zpc3VhbCk7XG5cdFx0fVxuXG5cdFx0dmFyIHRyaW1NZW51SXRlbXMgPSBmdW5jdGlvbiAobWVudUl0ZW1zKSB7XG5cdFx0XHR2YXIgb3V0cHV0TWVudUl0ZW1zID0gbWVudUl0ZW1zO1xuXG5cdFx0XHRpZiAob3V0cHV0TWVudUl0ZW1zLmxlbmd0aCA+IDAgJiYgb3V0cHV0TWVudUl0ZW1zWzBdLnRleHQgPT09ICctJykge1xuXHRcdFx0XHRvdXRwdXRNZW51SXRlbXMgPSBvdXRwdXRNZW51SXRlbXMuc2xpY2UoMSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChvdXRwdXRNZW51SXRlbXMubGVuZ3RoID4gMCAmJiBvdXRwdXRNZW51SXRlbXNbb3V0cHV0TWVudUl0ZW1zLmxlbmd0aCAtIDFdLnRleHQgPT09ICctJykge1xuXHRcdFx0XHRvdXRwdXRNZW51SXRlbXMgPSBvdXRwdXRNZW51SXRlbXMuc2xpY2UoMCwgb3V0cHV0TWVudUl0ZW1zLmxlbmd0aCAtIDEpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gb3V0cHV0TWVudUl0ZW1zO1xuXHRcdH07XG5cblx0XHR2YXIgY3JlYXRlQ3VzdG9tTWVudUl0ZW1zID0gZnVuY3Rpb24gKG5hbWVzKSB7XG5cdFx0XHR2YXIgaXRlbXMsIG5hbWVMaXN0O1xuXG5cdFx0XHRpZiAodHlwZW9mIG5hbWVzID09PSAnc3RyaW5nJykge1xuXHRcdFx0XHRuYW1lTGlzdCA9IG5hbWVzLnNwbGl0KCcgJyk7XG5cdFx0XHR9IGVsc2UgaWYgKFRvb2xzLmlzQXJyYXkobmFtZXMpKSB7XG5cdFx0XHRcdHJldHVybiBmbGF0dGVuKFRvb2xzLm1hcChuYW1lcywgY3JlYXRlQ3VzdG9tTWVudUl0ZW1zKSk7XG5cdFx0XHR9XG5cblx0XHRcdGl0ZW1zID0gVG9vbHMuZ3JlcChuYW1lTGlzdCwgZnVuY3Rpb24gKG5hbWUpIHtcblx0XHRcdFx0cmV0dXJuIG5hbWUgPT09ICd8JyB8fCBuYW1lIGluIGVkaXRvci5tZW51SXRlbXM7XG5cdFx0XHR9KTtcblxuXHRcdFx0cmV0dXJuIFRvb2xzLm1hcChpdGVtcywgZnVuY3Rpb24gKG5hbWUpIHtcblx0XHRcdFx0cmV0dXJuIG5hbWUgPT09ICd8JyA/IHt0ZXh0OiAnLSd9IDogZWRpdG9yLm1lbnVJdGVtc1tuYW1lXTtcblx0XHRcdH0pO1xuXHRcdH07XG5cblx0XHR2YXIgY3JlYXRlQ29udGV4dE1lbnVJdGVtcyA9IGZ1bmN0aW9uIChjb250ZXh0KSB7XG5cdFx0XHR2YXIgb3V0cHV0TWVudUl0ZW1zID0gW3t0ZXh0OiAnLSd9XTtcblx0XHRcdHZhciBtZW51SXRlbXMgPSBUb29scy5ncmVwKGVkaXRvci5tZW51SXRlbXMsIGZ1bmN0aW9uIChtZW51SXRlbSkge1xuXHRcdFx0XHRyZXR1cm4gbWVudUl0ZW0uY29udGV4dCA9PT0gY29udGV4dDtcblx0XHRcdH0pO1xuXG5cdFx0XHRUb29scy5lYWNoKG1lbnVJdGVtcywgZnVuY3Rpb24gKG1lbnVJdGVtKSB7XG5cdFx0XHRcdGlmIChtZW51SXRlbS5zZXBhcmF0b3IgPT0gJ2JlZm9yZScpIHtcblx0XHRcdFx0XHRvdXRwdXRNZW51SXRlbXMucHVzaCh7dGV4dDogJ3wnfSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAobWVudUl0ZW0ucHJlcGVuZFRvQ29udGV4dCkge1xuXHRcdFx0XHRcdG91dHB1dE1lbnVJdGVtcy51bnNoaWZ0KG1lbnVJdGVtKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvdXRwdXRNZW51SXRlbXMucHVzaChtZW51SXRlbSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAobWVudUl0ZW0uc2VwYXJhdG9yID09ICdhZnRlcicpIHtcblx0XHRcdFx0XHRvdXRwdXRNZW51SXRlbXMucHVzaCh7dGV4dDogJ3wnfSk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRyZXR1cm4gb3V0cHV0TWVudUl0ZW1zO1xuXHRcdH07XG5cblx0XHR2YXIgY3JlYXRlSW5zZXJ0TWVudSA9IGZ1bmN0aW9uIChlZGl0b3JTZXR0aW5ncykge1xuXHRcdFx0aWYgKGVkaXRvclNldHRpbmdzLmluc2VydF9idXR0b25faXRlbXMpIHtcblx0XHRcdFx0cmV0dXJuIHRyaW1NZW51SXRlbXMoY3JlYXRlQ3VzdG9tTWVudUl0ZW1zKGVkaXRvclNldHRpbmdzLmluc2VydF9idXR0b25faXRlbXMpKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHJldHVybiB0cmltTWVudUl0ZW1zKGNyZWF0ZUNvbnRleHRNZW51SXRlbXMoJ2luc2VydCcpKTtcblx0XHRcdH1cblx0XHR9O1xuXG5cdFx0ZWRpdG9yLmFkZEJ1dHRvbigndW5kbycsIHtcblx0XHRcdHRvb2x0aXA6ICdVbmRvJyxcblx0XHRcdG9uUG9zdFJlbmRlcjogdG9nZ2xlVW5kb1JlZG9TdGF0ZSgndW5kbycpLFxuXHRcdFx0Y21kOiAndW5kbydcblx0XHR9KTtcblxuXHRcdGVkaXRvci5hZGRCdXR0b24oJ3JlZG8nLCB7XG5cdFx0XHR0b29sdGlwOiAnUmVkbycsXG5cdFx0XHRvblBvc3RSZW5kZXI6IHRvZ2dsZVVuZG9SZWRvU3RhdGUoJ3JlZG8nKSxcblx0XHRcdGNtZDogJ3JlZG8nXG5cdFx0fSk7XG5cblx0XHRlZGl0b3IuYWRkTWVudUl0ZW0oJ25ld2RvY3VtZW50Jywge1xuXHRcdFx0dGV4dDogJ05ldyBkb2N1bWVudCcsXG5cdFx0XHRpY29uOiAnbmV3ZG9jdW1lbnQnLFxuXHRcdFx0Y21kOiAnbWNlTmV3RG9jdW1lbnQnXG5cdFx0fSk7XG5cblx0XHRlZGl0b3IuYWRkTWVudUl0ZW0oJ3VuZG8nLCB7XG5cdFx0XHR0ZXh0OiAnVW5kbycsXG5cdFx0XHRpY29uOiAndW5kbycsXG5cdFx0XHRzaG9ydGN1dDogJ01ldGErWicsXG5cdFx0XHRvblBvc3RSZW5kZXI6IHRvZ2dsZVVuZG9SZWRvU3RhdGUoJ3VuZG8nKSxcblx0XHRcdGNtZDogJ3VuZG8nXG5cdFx0fSk7XG5cblx0XHRlZGl0b3IuYWRkTWVudUl0ZW0oJ3JlZG8nLCB7XG5cdFx0XHR0ZXh0OiAnUmVkbycsXG5cdFx0XHRpY29uOiAncmVkbycsXG5cdFx0XHRzaG9ydGN1dDogJ01ldGErWScsXG5cdFx0XHRvblBvc3RSZW5kZXI6IHRvZ2dsZVVuZG9SZWRvU3RhdGUoJ3JlZG8nKSxcblx0XHRcdGNtZDogJ3JlZG8nXG5cdFx0fSk7XG5cblx0XHRlZGl0b3IuYWRkTWVudUl0ZW0oJ3Zpc3VhbGFpZCcsIHtcblx0XHRcdHRleHQ6ICdWaXN1YWwgYWlkcycsXG5cdFx0XHRzZWxlY3RhYmxlOiB0cnVlLFxuXHRcdFx0b25Qb3N0UmVuZGVyOiB0b2dnbGVWaXN1YWxBaWRTdGF0ZSxcblx0XHRcdGNtZDogJ21jZVRvZ2dsZVZpc3VhbEFpZCdcblx0XHR9KTtcblxuXHRcdGVkaXRvci5hZGRCdXR0b24oJ3JlbW92ZScsIHtcblx0XHRcdHRvb2x0aXA6ICdSZW1vdmUnLFxuXHRcdFx0aWNvbjogJ3JlbW92ZScsXG5cdFx0XHRjbWQ6ICdEZWxldGUnXG5cdFx0fSk7XG5cblx0XHRlZGl0b3IuYWRkQnV0dG9uKCdpbnNlcnQnLCB7XG5cdFx0XHR0eXBlOiAnbWVudWJ1dHRvbicsXG5cdFx0XHRpY29uOiAnaW5zZXJ0Jyxcblx0XHRcdG1lbnU6IFtdLFxuXHRcdFx0b25jcmVhdGVtZW51OiBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdHRoaXMubWVudS5hZGQoY3JlYXRlSW5zZXJ0TWVudShlZGl0b3Iuc2V0dGluZ3MpKTtcblx0XHRcdFx0dGhpcy5tZW51LnJlbmRlck5ldygpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0ZWFjaCh7XG5cdFx0XHRjdXQ6IFsnQ3V0JywgJ0N1dCcsICdNZXRhK1gnXSxcblx0XHRcdGNvcHk6IFsnQ29weScsICdDb3B5JywgJ01ldGErQyddLFxuXHRcdFx0cGFzdGU6IFsnUGFzdGUnLCAnUGFzdGUnLCAnTWV0YStWJ10sXG5cdFx0XHRzZWxlY3RhbGw6IFsnU2VsZWN0IGFsbCcsICdTZWxlY3RBbGwnLCAnTWV0YStBJ10sXG5cdFx0XHRib2xkOiBbJ0JvbGQnLCAnQm9sZCcsICdNZXRhK0InXSxcblx0XHRcdGl0YWxpYzogWydJdGFsaWMnLCAnSXRhbGljJywgJ01ldGErSSddLFxuXHRcdFx0dW5kZXJsaW5lOiBbJ1VuZGVybGluZScsICdVbmRlcmxpbmUnXSxcblx0XHRcdHN0cmlrZXRocm91Z2g6IFsnU3RyaWtldGhyb3VnaCcsICdTdHJpa2V0aHJvdWdoJ10sXG5cdFx0XHRzdWJzY3JpcHQ6IFsnU3Vic2NyaXB0JywgJ1N1YnNjcmlwdCddLFxuXHRcdFx0c3VwZXJzY3JpcHQ6IFsnU3VwZXJzY3JpcHQnLCAnU3VwZXJzY3JpcHQnXSxcblx0XHRcdHJlbW92ZWZvcm1hdDogWydDbGVhciBmb3JtYXR0aW5nJywgJ1JlbW92ZUZvcm1hdCddXG5cdFx0fSwgZnVuY3Rpb24oaXRlbSwgbmFtZSkge1xuXHRcdFx0ZWRpdG9yLmFkZE1lbnVJdGVtKG5hbWUsIHtcblx0XHRcdFx0dGV4dDogaXRlbVswXSxcblx0XHRcdFx0aWNvbjogbmFtZSxcblx0XHRcdFx0c2hvcnRjdXQ6IGl0ZW1bMl0sXG5cdFx0XHRcdGNtZDogaXRlbVsxXVxuXHRcdFx0fSk7XG5cdFx0fSk7XG5cblx0XHRlZGl0b3Iub24oJ21vdXNlZG93bicsIGZ1bmN0aW9uKCkge1xuXHRcdFx0RmxvYXRQYW5lbC5oaWRlQWxsKCk7XG5cdFx0fSk7XG5cblx0XHRmdW5jdGlvbiB0b2dnbGVGb3JtYXQoZm10KSB7XG5cdFx0XHRpZiAoZm10LmNvbnRyb2wpIHtcblx0XHRcdFx0Zm10ID0gZm10LmNvbnRyb2wudmFsdWUoKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGZtdCkge1xuXHRcdFx0XHRlZGl0b3IuZXhlY0NvbW1hbmQoJ21jZVRvZ2dsZUZvcm1hdCcsIGZhbHNlLCBmbXQpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIGhpZGVNZW51T2JqZWN0cyhtZW51KSB7XG5cdFx0XHR2YXIgY291bnQgPSBtZW51Lmxlbmd0aDtcblxuXHRcdFx0VG9vbHMuZWFjaChtZW51LCBmdW5jdGlvbiAoaXRlbSkge1xuXHRcdFx0XHRpZiAoaXRlbS5tZW51KSB7XG5cdFx0XHRcdFx0aXRlbS5oaWRkZW4gPSBoaWRlTWVudU9iamVjdHMoaXRlbS5tZW51KSA9PT0gMDtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHZhciBmb3JtYXROYW1lID0gaXRlbS5mb3JtYXQ7XG5cdFx0XHRcdGlmIChmb3JtYXROYW1lKSB7XG5cdFx0XHRcdFx0aXRlbS5oaWRkZW4gPSAhZWRpdG9yLmZvcm1hdHRlci5jYW5BcHBseShmb3JtYXROYW1lKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChpdGVtLmhpZGRlbikge1xuXHRcdFx0XHRcdGNvdW50LS07XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRyZXR1cm4gY291bnQ7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gaGlkZUZvcm1hdE1lbnVJdGVtcyhtZW51KSB7XG5cdFx0XHR2YXIgY291bnQgPSBtZW51Lml0ZW1zKCkubGVuZ3RoO1xuXG5cdFx0XHRtZW51Lml0ZW1zKCkuZWFjaChmdW5jdGlvbiAoaXRlbSkge1xuXHRcdFx0XHRpZiAoaXRlbS5tZW51KSB7XG5cdFx0XHRcdFx0aXRlbS52aXNpYmxlKGhpZGVGb3JtYXRNZW51SXRlbXMoaXRlbS5tZW51KSA+IDApO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKCFpdGVtLm1lbnUgJiYgaXRlbS5zZXR0aW5ncy5tZW51KSB7XG5cdFx0XHRcdFx0aXRlbS52aXNpYmxlKGhpZGVNZW51T2JqZWN0cyhpdGVtLnNldHRpbmdzLm1lbnUpID4gMCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHR2YXIgZm9ybWF0TmFtZSA9IGl0ZW0uc2V0dGluZ3MuZm9ybWF0O1xuXHRcdFx0XHRpZiAoZm9ybWF0TmFtZSkge1xuXHRcdFx0XHRcdGl0ZW0udmlzaWJsZShlZGl0b3IuZm9ybWF0dGVyLmNhbkFwcGx5KGZvcm1hdE5hbWUpKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICghaXRlbS52aXNpYmxlKCkpIHtcblx0XHRcdFx0XHRjb3VudC0tO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0cmV0dXJuIGNvdW50O1xuXHRcdH1cblxuXHRcdGVkaXRvci5hZGRCdXR0b24oJ3N0eWxlc2VsZWN0Jywge1xuXHRcdFx0dHlwZTogJ21lbnVidXR0b24nLFxuXHRcdFx0dGV4dDogJ0Zvcm1hdHMnLFxuXHRcdFx0bWVudTogZm9ybWF0TWVudSxcblx0XHRcdG9uU2hvd01lbnU6IGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0aWYgKGVkaXRvci5zZXR0aW5ncy5zdHlsZV9mb3JtYXRzX2F1dG9oaWRlKSB7XG5cdFx0XHRcdFx0aGlkZUZvcm1hdE1lbnVJdGVtcyh0aGlzLm1lbnUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRlZGl0b3IuYWRkQnV0dG9uKCdmb3JtYXRzZWxlY3QnLCBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBpdGVtcyA9IFtdLCBibG9ja3MgPSBjcmVhdGVGb3JtYXRzKGVkaXRvci5zZXR0aW5ncy5ibG9ja19mb3JtYXRzIHx8XG5cdFx0XHRcdCdQYXJhZ3JhcGg9cDsnICtcblx0XHRcdFx0J0hlYWRpbmcgMT1oMTsnICtcblx0XHRcdFx0J0hlYWRpbmcgMj1oMjsnICtcblx0XHRcdFx0J0hlYWRpbmcgMz1oMzsnICtcblx0XHRcdFx0J0hlYWRpbmcgND1oNDsnICtcblx0XHRcdFx0J0hlYWRpbmcgNT1oNTsnICtcblx0XHRcdFx0J0hlYWRpbmcgNj1oNjsnICtcblx0XHRcdFx0J1ByZWZvcm1hdHRlZD1wcmUnXG5cdFx0XHQpO1xuXG5cdFx0XHRlYWNoKGJsb2NrcywgZnVuY3Rpb24oYmxvY2spIHtcblx0XHRcdFx0aXRlbXMucHVzaCh7XG5cdFx0XHRcdFx0dGV4dDogYmxvY2tbMF0sXG5cdFx0XHRcdFx0dmFsdWU6IGJsb2NrWzFdLFxuXHRcdFx0XHRcdHRleHRTdHlsZTogZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gZWRpdG9yLmZvcm1hdHRlci5nZXRDc3NUZXh0KGJsb2NrWzFdKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSk7XG5cblx0XHRcdHJldHVybiB7XG5cdFx0XHRcdHR5cGU6ICdsaXN0Ym94Jyxcblx0XHRcdFx0dGV4dDogYmxvY2tzWzBdWzBdLFxuXHRcdFx0XHR2YWx1ZXM6IGl0ZW1zLFxuXHRcdFx0XHRmaXhlZFdpZHRoOiB0cnVlLFxuXHRcdFx0XHRvbnNlbGVjdDogdG9nZ2xlRm9ybWF0LFxuXHRcdFx0XHRvblBvc3RSZW5kZXI6IGNyZWF0ZUxpc3RCb3hDaGFuZ2VIYW5kbGVyKGl0ZW1zKVxuXHRcdFx0fTtcblx0XHR9KTtcblxuXHRcdGVkaXRvci5hZGRCdXR0b24oJ2ZvbnRzZWxlY3QnLCBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBkZWZhdWx0Rm9udHNGb3JtYXRzID1cblx0XHRcdFx0J0FuZGFsZSBNb25vPWFuZGFsZSBtb25vLG1vbm9zcGFjZTsnICtcblx0XHRcdFx0J0FyaWFsPWFyaWFsLGhlbHZldGljYSxzYW5zLXNlcmlmOycgK1xuXHRcdFx0XHQnQXJpYWwgQmxhY2s9YXJpYWwgYmxhY2ssc2Fucy1zZXJpZjsnICtcblx0XHRcdFx0J0Jvb2sgQW50aXF1YT1ib29rIGFudGlxdWEscGFsYXRpbm8sc2VyaWY7JyArXG5cdFx0XHRcdCdDb21pYyBTYW5zIE1TPWNvbWljIHNhbnMgbXMsc2Fucy1zZXJpZjsnICtcblx0XHRcdFx0J0NvdXJpZXIgTmV3PWNvdXJpZXIgbmV3LGNvdXJpZXIsbW9ub3NwYWNlOycgK1xuXHRcdFx0XHQnR2VvcmdpYT1nZW9yZ2lhLHBhbGF0aW5vLHNlcmlmOycgK1xuXHRcdFx0XHQnSGVsdmV0aWNhPWhlbHZldGljYSxhcmlhbCxzYW5zLXNlcmlmOycgK1xuXHRcdFx0XHQnSW1wYWN0PWltcGFjdCxzYW5zLXNlcmlmOycgK1xuXHRcdFx0XHQnU3ltYm9sPXN5bWJvbDsnICtcblx0XHRcdFx0J1RhaG9tYT10YWhvbWEsYXJpYWwsaGVsdmV0aWNhLHNhbnMtc2VyaWY7JyArXG5cdFx0XHRcdCdUZXJtaW5hbD10ZXJtaW5hbCxtb25hY28sbW9ub3NwYWNlOycgK1xuXHRcdFx0XHQnVGltZXMgTmV3IFJvbWFuPXRpbWVzIG5ldyByb21hbix0aW1lcyxzZXJpZjsnICtcblx0XHRcdFx0J1RyZWJ1Y2hldCBNUz10cmVidWNoZXQgbXMsZ2VuZXZhLHNhbnMtc2VyaWY7JyArXG5cdFx0XHRcdCdWZXJkYW5hPXZlcmRhbmEsZ2VuZXZhLHNhbnMtc2VyaWY7JyArXG5cdFx0XHRcdCdXZWJkaW5ncz13ZWJkaW5nczsnICtcblx0XHRcdFx0J1dpbmdkaW5ncz13aW5nZGluZ3MsemFwZiBkaW5nYmF0cyc7XG5cblx0XHRcdHZhciBpdGVtcyA9IFtdLCBmb250cyA9IGNyZWF0ZUZvcm1hdHMoZWRpdG9yLnNldHRpbmdzLmZvbnRfZm9ybWF0cyB8fCBkZWZhdWx0Rm9udHNGb3JtYXRzKTtcblxuXHRcdFx0ZWFjaChmb250cywgZnVuY3Rpb24oZm9udCkge1xuXHRcdFx0XHRpdGVtcy5wdXNoKHtcblx0XHRcdFx0XHR0ZXh0OiB7cmF3OiBmb250WzBdfSxcblx0XHRcdFx0XHR2YWx1ZTogZm9udFsxXSxcblx0XHRcdFx0XHR0ZXh0U3R5bGU6IGZvbnRbMV0uaW5kZXhPZignZGluZ3MnKSA9PSAtMSA/ICdmb250LWZhbWlseTonICsgZm9udFsxXSA6ICcnXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSk7XG5cblx0XHRcdHJldHVybiB7XG5cdFx0XHRcdHR5cGU6ICdsaXN0Ym94Jyxcblx0XHRcdFx0dGV4dDogJ0ZvbnQgRmFtaWx5Jyxcblx0XHRcdFx0dG9vbHRpcDogJ0ZvbnQgRmFtaWx5Jyxcblx0XHRcdFx0dmFsdWVzOiBpdGVtcyxcblx0XHRcdFx0Zml4ZWRXaWR0aDogdHJ1ZSxcblx0XHRcdFx0b25Qb3N0UmVuZGVyOiBjcmVhdGVMaXN0Qm94Q2hhbmdlSGFuZGxlcihpdGVtcywgJ2ZvbnRuYW1lJyksXG5cdFx0XHRcdG9uc2VsZWN0OiBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdFx0aWYgKGUuY29udHJvbC5zZXR0aW5ncy52YWx1ZSkge1xuXHRcdFx0XHRcdFx0ZWRpdG9yLmV4ZWNDb21tYW5kKCdGb250TmFtZScsIGZhbHNlLCBlLmNvbnRyb2wuc2V0dGluZ3MudmFsdWUpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fTtcblx0XHR9KTtcblxuXHRcdGVkaXRvci5hZGRCdXR0b24oJ2ZvbnRzaXplc2VsZWN0JywgZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgaXRlbXMgPSBbXSwgZGVmYXVsdEZvbnRzaXplRm9ybWF0cyA9ICc4cHQgMTBwdCAxMnB0IDE0cHQgMThwdCAyNHB0IDM2cHQnO1xuXHRcdFx0dmFyIGZvbnRzaXplX2Zvcm1hdHMgPSBlZGl0b3Iuc2V0dGluZ3MuZm9udHNpemVfZm9ybWF0cyB8fCBkZWZhdWx0Rm9udHNpemVGb3JtYXRzO1xuXG5cdFx0XHRlYWNoKGZvbnRzaXplX2Zvcm1hdHMuc3BsaXQoJyAnKSwgZnVuY3Rpb24oaXRlbSkge1xuXHRcdFx0XHR2YXIgdGV4dCA9IGl0ZW0sIHZhbHVlID0gaXRlbTtcblx0XHRcdFx0Ly8gQWxsb3cgdGV4dD12YWx1ZSBmb250IHNpemVzLlxuXHRcdFx0XHR2YXIgdmFsdWVzID0gaXRlbS5zcGxpdCgnPScpO1xuXHRcdFx0XHRpZiAodmFsdWVzLmxlbmd0aCA+IDEpIHtcblx0XHRcdFx0XHR0ZXh0ID0gdmFsdWVzWzBdO1xuXHRcdFx0XHRcdHZhbHVlID0gdmFsdWVzWzFdO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGl0ZW1zLnB1c2goe3RleHQ6IHRleHQsIHZhbHVlOiB2YWx1ZX0pO1xuXHRcdFx0fSk7XG5cblx0XHRcdHJldHVybiB7XG5cdFx0XHRcdHR5cGU6ICdsaXN0Ym94Jyxcblx0XHRcdFx0dGV4dDogJ0ZvbnQgU2l6ZXMnLFxuXHRcdFx0XHR0b29sdGlwOiAnRm9udCBTaXplcycsXG5cdFx0XHRcdHZhbHVlczogaXRlbXMsXG5cdFx0XHRcdGZpeGVkV2lkdGg6IHRydWUsXG5cdFx0XHRcdG9uUG9zdFJlbmRlcjogY3JlYXRlTGlzdEJveENoYW5nZUhhbmRsZXIoaXRlbXMsICdmb250c2l6ZScpLFxuXHRcdFx0XHRvbmNsaWNrOiBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdFx0aWYgKGUuY29udHJvbC5zZXR0aW5ncy52YWx1ZSkge1xuXHRcdFx0XHRcdFx0ZWRpdG9yLmV4ZWNDb21tYW5kKCdGb250U2l6ZScsIGZhbHNlLCBlLmNvbnRyb2wuc2V0dGluZ3MudmFsdWUpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fTtcblx0XHR9KTtcblxuXHRcdGVkaXRvci5hZGRNZW51SXRlbSgnZm9ybWF0cycsIHtcblx0XHRcdHRleHQ6ICdGb3JtYXRzJyxcblx0XHRcdG1lbnU6IGZvcm1hdE1lbnVcblx0XHR9KTtcblx0fVxufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy91aS9HcmlkTGF5b3V0LmpzXG5cbi8qKlxuICogR3JpZExheW91dC5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE1IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKipcbiAqIFRoaXMgbGF5b3V0IG1hbmFnZXIgcGxhY2VzIGNvbnRyb2xzIGluIGEgZ3JpZC5cbiAqXG4gKiBAc2V0dGluZyB7TnVtYmVyfSBzcGFjaW5nIFNwYWNpbmcgYmV0d2VlbiBjb250cm9scy5cbiAqIEBzZXR0aW5nIHtOdW1iZXJ9IHNwYWNpbmdIIEhvcml6b250YWwgc3BhY2luZyBiZXR3ZWVuIGNvbnRyb2xzLlxuICogQHNldHRpbmcge051bWJlcn0gc3BhY2luZ1YgVmVydGljYWwgc3BhY2luZyBiZXR3ZWVuIGNvbnRyb2xzLlxuICogQHNldHRpbmcge051bWJlcn0gY29sdW1ucyBOdW1iZXIgb2YgY29sdW1ucyB0byB1c2UuXG4gKiBAc2V0dGluZyB7U3RyaW5nL0FycmF5fSBhbGlnbkggc3RhcnR8ZW5kfGNlbnRlcnxzdHJldGNoIG9yIGFycmF5IG9mIHZhbHVlcyBmb3IgZWFjaCBjb2x1bW4uXG4gKiBAc2V0dGluZyB7U3RyaW5nL0FycmF5fSBhbGlnblYgc3RhcnR8ZW5kfGNlbnRlcnxzdHJldGNoIG9yIGFycmF5IG9mIHZhbHVlcyBmb3IgZWFjaCBjb2x1bW4uXG4gKiBAc2V0dGluZyB7U3RyaW5nfSBwYWNrIHN0YXJ0fGVuZFxuICpcbiAqIEBjbGFzcyB0aW55bWNlLnVpLkdyaWRMYXlvdXRcbiAqIEBleHRlbmRzIHRpbnltY2UudWkuQWJzb2x1dGVMYXlvdXRcbiAqL1xuZGVmaW5lKFwidGlueW1jZS91aS9HcmlkTGF5b3V0XCIsIFtcblx0XCJ0aW55bWNlL3VpL0Fic29sdXRlTGF5b3V0XCJcbl0sIGZ1bmN0aW9uKEFic29sdXRlTGF5b3V0KSB7XG5cdFwidXNlIHN0cmljdFwiO1xuXG5cdHJldHVybiBBYnNvbHV0ZUxheW91dC5leHRlbmQoe1xuXHRcdC8qKlxuXHRcdCAqIFJlY2FsY3VsYXRlcyB0aGUgcG9zaXRpb25zIG9mIHRoZSBjb250cm9scyBpbiB0aGUgc3BlY2lmaWVkIGNvbnRhaW5lci5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgcmVjYWxjXG5cdFx0ICogQHBhcmFtIHt0aW55bWNlLnVpLkNvbnRhaW5lcn0gY29udGFpbmVyIENvbnRhaW5lciBpbnN0YW5jZSB0byByZWNhbGMuXG5cdFx0ICovXG5cdFx0cmVjYWxjOiBmdW5jdGlvbihjb250YWluZXIpIHtcblx0XHRcdHZhciBzZXR0aW5ncywgcm93cywgY29scywgaXRlbXMsIGNvbnRMYXlvdXRSZWN0LCB3aWR0aCwgaGVpZ2h0LCByZWN0LFxuXHRcdFx0XHRjdHJsTGF5b3V0UmVjdCwgY3RybCwgeCwgeSwgcG9zWCwgcG9zWSwgY3RybFNldHRpbmdzLCBjb250UGFkZGluZ0JveCwgYWxpZ24sIHNwYWNpbmdILCBzcGFjaW5nViwgYWxpZ25ILCBhbGlnblYsIG1heFgsIG1heFksXG5cdFx0XHRcdGNvbFdpZHRocyA9IFtdLCByb3dIZWlnaHRzID0gW10sIGN0cmxNaW5XaWR0aCwgY3RybE1pbkhlaWdodCwgYXZhaWxhYmxlV2lkdGgsIGF2YWlsYWJsZUhlaWdodCwgcmV2ZXJzZVJvd3MsIGlkeDtcblxuXHRcdFx0Ly8gR2V0IGxheW91dCBzZXR0aW5nc1xuXHRcdFx0c2V0dGluZ3MgPSBjb250YWluZXIuc2V0dGluZ3M7XG5cdFx0XHRpdGVtcyA9IGNvbnRhaW5lci5pdGVtcygpLmZpbHRlcignOnZpc2libGUnKTtcblx0XHRcdGNvbnRMYXlvdXRSZWN0ID0gY29udGFpbmVyLmxheW91dFJlY3QoKTtcblx0XHRcdGNvbHMgPSBzZXR0aW5ncy5jb2x1bW5zIHx8IE1hdGguY2VpbChNYXRoLnNxcnQoaXRlbXMubGVuZ3RoKSk7XG5cdFx0XHRyb3dzID0gTWF0aC5jZWlsKGl0ZW1zLmxlbmd0aCAvIGNvbHMpO1xuXHRcdFx0c3BhY2luZ0ggPSBzZXR0aW5ncy5zcGFjaW5nSCB8fCBzZXR0aW5ncy5zcGFjaW5nIHx8IDA7XG5cdFx0XHRzcGFjaW5nViA9IHNldHRpbmdzLnNwYWNpbmdWIHx8IHNldHRpbmdzLnNwYWNpbmcgfHwgMDtcblx0XHRcdGFsaWduSCA9IHNldHRpbmdzLmFsaWduSCB8fCBzZXR0aW5ncy5hbGlnbjtcblx0XHRcdGFsaWduViA9IHNldHRpbmdzLmFsaWduViB8fCBzZXR0aW5ncy5hbGlnbjtcblx0XHRcdGNvbnRQYWRkaW5nQm94ID0gY29udGFpbmVyLnBhZGRpbmdCb3g7XG5cdFx0XHRyZXZlcnNlUm93cyA9ICdyZXZlcnNlUm93cycgaW4gc2V0dGluZ3MgPyBzZXR0aW5ncy5yZXZlcnNlUm93cyA6IGNvbnRhaW5lci5pc1J0bCgpO1xuXG5cdFx0XHRpZiAoYWxpZ25IICYmIHR5cGVvZiBhbGlnbkggPT0gXCJzdHJpbmdcIikge1xuXHRcdFx0XHRhbGlnbkggPSBbYWxpZ25IXTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFsaWduViAmJiB0eXBlb2YgYWxpZ25WID09IFwic3RyaW5nXCIpIHtcblx0XHRcdFx0YWxpZ25WID0gW2FsaWduVl07XG5cdFx0XHR9XG5cblx0XHRcdC8vIFplcm8gcGFkZCBjb2x1bW5XaWR0aHNcblx0XHRcdGZvciAoeCA9IDA7IHggPCBjb2xzOyB4KyspIHtcblx0XHRcdFx0Y29sV2lkdGhzLnB1c2goMCk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIFplcm8gcGFkZCByb3dIZWlnaHRzXG5cdFx0XHRmb3IgKHkgPSAwOyB5IDwgcm93czsgeSsrKSB7XG5cdFx0XHRcdHJvd0hlaWdodHMucHVzaCgwKTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gQ2FsY3VsYXRlIGNvbHVtbldpZHRocyBhbmQgcm93SGVpZ2h0c1xuXHRcdFx0Zm9yICh5ID0gMDsgeSA8IHJvd3M7IHkrKykge1xuXHRcdFx0XHRmb3IgKHggPSAwOyB4IDwgY29sczsgeCsrKSB7XG5cdFx0XHRcdFx0Y3RybCA9IGl0ZW1zW3kgKiBjb2xzICsgeF07XG5cblx0XHRcdFx0XHQvLyBPdXQgb2YgYm91bmRzXG5cdFx0XHRcdFx0aWYgKCFjdHJsKSB7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRjdHJsTGF5b3V0UmVjdCA9IGN0cmwubGF5b3V0UmVjdCgpO1xuXHRcdFx0XHRcdGN0cmxNaW5XaWR0aCA9IGN0cmxMYXlvdXRSZWN0Lm1pblc7XG5cdFx0XHRcdFx0Y3RybE1pbkhlaWdodCA9IGN0cmxMYXlvdXRSZWN0Lm1pbkg7XG5cblx0XHRcdFx0XHRjb2xXaWR0aHNbeF0gPSBjdHJsTWluV2lkdGggPiBjb2xXaWR0aHNbeF0gPyBjdHJsTWluV2lkdGggOiBjb2xXaWR0aHNbeF07XG5cdFx0XHRcdFx0cm93SGVpZ2h0c1t5XSA9IGN0cmxNaW5IZWlnaHQgPiByb3dIZWlnaHRzW3ldID8gY3RybE1pbkhlaWdodCA6IHJvd0hlaWdodHNbeV07XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0Ly8gQ2FsY3VsYXRlIG1heFhcblx0XHRcdGF2YWlsYWJsZVdpZHRoID0gY29udExheW91dFJlY3QuaW5uZXJXIC0gY29udFBhZGRpbmdCb3gubGVmdCAtIGNvbnRQYWRkaW5nQm94LnJpZ2h0O1xuXHRcdFx0Zm9yIChtYXhYID0gMCwgeCA9IDA7IHggPCBjb2xzOyB4KyspIHtcblx0XHRcdFx0bWF4WCArPSBjb2xXaWR0aHNbeF0gKyAoeCA+IDAgPyBzcGFjaW5nSCA6IDApO1xuXHRcdFx0XHRhdmFpbGFibGVXaWR0aCAtPSAoeCA+IDAgPyBzcGFjaW5nSCA6IDApICsgY29sV2lkdGhzW3hdO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBDYWxjdWxhdGUgbWF4WVxuXHRcdFx0YXZhaWxhYmxlSGVpZ2h0ID0gY29udExheW91dFJlY3QuaW5uZXJIIC0gY29udFBhZGRpbmdCb3gudG9wIC0gY29udFBhZGRpbmdCb3guYm90dG9tO1xuXHRcdFx0Zm9yIChtYXhZID0gMCwgeSA9IDA7IHkgPCByb3dzOyB5KyspIHtcblx0XHRcdFx0bWF4WSArPSByb3dIZWlnaHRzW3ldICsgKHkgPiAwID8gc3BhY2luZ1YgOiAwKTtcblx0XHRcdFx0YXZhaWxhYmxlSGVpZ2h0IC09ICh5ID4gMCA/IHNwYWNpbmdWIDogMCkgKyByb3dIZWlnaHRzW3ldO1xuXHRcdFx0fVxuXG5cdFx0XHRtYXhYICs9IGNvbnRQYWRkaW5nQm94LmxlZnQgKyBjb250UGFkZGluZ0JveC5yaWdodDtcblx0XHRcdG1heFkgKz0gY29udFBhZGRpbmdCb3gudG9wICsgY29udFBhZGRpbmdCb3guYm90dG9tO1xuXG5cdFx0XHQvLyBDYWxjdWxhdGUgbWluVy9taW5IXG5cdFx0XHRyZWN0ID0ge307XG5cdFx0XHRyZWN0Lm1pblcgPSBtYXhYICsgKGNvbnRMYXlvdXRSZWN0LncgLSBjb250TGF5b3V0UmVjdC5pbm5lclcpO1xuXHRcdFx0cmVjdC5taW5IID0gbWF4WSArIChjb250TGF5b3V0UmVjdC5oIC0gY29udExheW91dFJlY3QuaW5uZXJIKTtcblxuXHRcdFx0cmVjdC5jb250ZW50VyA9IHJlY3QubWluVyAtIGNvbnRMYXlvdXRSZWN0LmRlbHRhVztcblx0XHRcdHJlY3QuY29udGVudEggPSByZWN0Lm1pbkggLSBjb250TGF5b3V0UmVjdC5kZWx0YUg7XG5cdFx0XHRyZWN0Lm1pblcgPSBNYXRoLm1pbihyZWN0Lm1pblcsIGNvbnRMYXlvdXRSZWN0Lm1heFcpO1xuXHRcdFx0cmVjdC5taW5IID0gTWF0aC5taW4ocmVjdC5taW5ILCBjb250TGF5b3V0UmVjdC5tYXhIKTtcblx0XHRcdHJlY3QubWluVyA9IE1hdGgubWF4KHJlY3QubWluVywgY29udExheW91dFJlY3Quc3RhcnRNaW5XaWR0aCk7XG5cdFx0XHRyZWN0Lm1pbkggPSBNYXRoLm1heChyZWN0Lm1pbkgsIGNvbnRMYXlvdXRSZWN0LnN0YXJ0TWluSGVpZ2h0KTtcblxuXHRcdFx0Ly8gUmVzaXplIGNvbnRhaW5lciBjb250YWluZXIgaWYgbWluU2l6ZSB3YXMgY2hhbmdlZFxuXHRcdFx0aWYgKGNvbnRMYXlvdXRSZWN0LmF1dG9SZXNpemUgJiYgKHJlY3QubWluVyAhPSBjb250TGF5b3V0UmVjdC5taW5XIHx8IHJlY3QubWluSCAhPSBjb250TGF5b3V0UmVjdC5taW5IKSkge1xuXHRcdFx0XHRyZWN0LncgPSByZWN0Lm1pblc7XG5cdFx0XHRcdHJlY3QuaCA9IHJlY3QubWluSDtcblxuXHRcdFx0XHRjb250YWluZXIubGF5b3V0UmVjdChyZWN0KTtcblx0XHRcdFx0dGhpcy5yZWNhbGMoY29udGFpbmVyKTtcblxuXHRcdFx0XHQvLyBGb3JjZWQgcmVjYWxjIGZvciBleGFtcGxlIGlmIGl0ZW1zIGFyZSBoaWRkZW4vc2hvd25cblx0XHRcdFx0aWYgKGNvbnRhaW5lci5fbGFzdFJlY3QgPT09IG51bGwpIHtcblx0XHRcdFx0XHR2YXIgcGFyZW50Q3RybCA9IGNvbnRhaW5lci5wYXJlbnQoKTtcblx0XHRcdFx0XHRpZiAocGFyZW50Q3RybCkge1xuXHRcdFx0XHRcdFx0cGFyZW50Q3RybC5fbGFzdFJlY3QgPSBudWxsO1xuXHRcdFx0XHRcdFx0cGFyZW50Q3RybC5yZWNhbGMoKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdC8vIFVwZGF0ZSBjb250ZW50Vy9jb250ZW50SCBzbyBhYnNFbmQgbW92ZXMgY29ycmVjdGx5XG5cdFx0XHRpZiAoY29udExheW91dFJlY3QuYXV0b1Jlc2l6ZSkge1xuXHRcdFx0XHRyZWN0ID0gY29udGFpbmVyLmxheW91dFJlY3QocmVjdCk7XG5cdFx0XHRcdHJlY3QuY29udGVudFcgPSByZWN0Lm1pblcgLSBjb250TGF5b3V0UmVjdC5kZWx0YVc7XG5cdFx0XHRcdHJlY3QuY29udGVudEggPSByZWN0Lm1pbkggLSBjb250TGF5b3V0UmVjdC5kZWx0YUg7XG5cdFx0XHR9XG5cblx0XHRcdHZhciBmbGV4VjtcblxuXHRcdFx0aWYgKHNldHRpbmdzLnBhY2tWID09ICdzdGFydCcpIHtcblx0XHRcdFx0ZmxleFYgPSAwO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0ZmxleFYgPSBhdmFpbGFibGVIZWlnaHQgPiAwID8gTWF0aC5mbG9vcihhdmFpbGFibGVIZWlnaHQgLyByb3dzKSA6IDA7XG5cdFx0XHR9XG5cblx0XHRcdC8vIENhbGN1bGF0ZSB0b3RhbEZsZXhcblx0XHRcdHZhciB0b3RhbEZsZXggPSAwO1xuXHRcdFx0dmFyIGZsZXhXaWR0aHMgPSBzZXR0aW5ncy5mbGV4V2lkdGhzO1xuXHRcdFx0aWYgKGZsZXhXaWR0aHMpIHtcblx0XHRcdFx0Zm9yICh4ID0gMDsgeCA8IGZsZXhXaWR0aHMubGVuZ3RoOyB4KyspIHtcblx0XHRcdFx0XHR0b3RhbEZsZXggKz0gZmxleFdpZHRoc1t4XTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dG90YWxGbGV4ID0gY29scztcblx0XHRcdH1cblxuXHRcdFx0Ly8gQ2FsY3VsYXRlIG5ldyBjb2x1bW4gd2lkdGhzIGJhc2VkIG9uIGZsZXggdmFsdWVzXG5cdFx0XHR2YXIgcmF0aW8gPSBhdmFpbGFibGVXaWR0aCAvIHRvdGFsRmxleDtcblx0XHRcdGZvciAoeCA9IDA7IHggPCBjb2xzOyB4KyspIHtcblx0XHRcdFx0Y29sV2lkdGhzW3hdICs9IGZsZXhXaWR0aHMgPyBmbGV4V2lkdGhzW3hdICogcmF0aW8gOiByYXRpbztcblx0XHRcdH1cblxuXHRcdFx0Ly8gTW92ZS9yZXNpemUgY29udHJvbHNcblx0XHRcdHBvc1kgPSBjb250UGFkZGluZ0JveC50b3A7XG5cdFx0XHRmb3IgKHkgPSAwOyB5IDwgcm93czsgeSsrKSB7XG5cdFx0XHRcdHBvc1ggPSBjb250UGFkZGluZ0JveC5sZWZ0O1xuXHRcdFx0XHRoZWlnaHQgPSByb3dIZWlnaHRzW3ldICsgZmxleFY7XG5cblx0XHRcdFx0Zm9yICh4ID0gMDsgeCA8IGNvbHM7IHgrKykge1xuXHRcdFx0XHRcdGlmIChyZXZlcnNlUm93cykge1xuXHRcdFx0XHRcdFx0aWR4ID0geSAqIGNvbHMgKyBjb2xzIC0gMSAtIHg7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGlkeCA9IHkgKiBjb2xzICsgeDtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRjdHJsID0gaXRlbXNbaWR4XTtcblxuXHRcdFx0XHRcdC8vIE5vIG1vcmUgY29udHJvbHMgdG8gcmVuZGVyIHRoZW4gYnJlYWtcblx0XHRcdFx0XHRpZiAoIWN0cmwpIHtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdC8vIEdldCBjb250cm9sIHNldHRpbmdzIGFuZCBjYWxjdWxhdGUgeCwgeVxuXHRcdFx0XHRcdGN0cmxTZXR0aW5ncyA9IGN0cmwuc2V0dGluZ3M7XG5cdFx0XHRcdFx0Y3RybExheW91dFJlY3QgPSBjdHJsLmxheW91dFJlY3QoKTtcblx0XHRcdFx0XHR3aWR0aCA9IE1hdGgubWF4KGNvbFdpZHRoc1t4XSwgY3RybExheW91dFJlY3Quc3RhcnRNaW5XaWR0aCk7XG5cdFx0XHRcdFx0Y3RybExheW91dFJlY3QueCA9IHBvc1g7XG5cdFx0XHRcdFx0Y3RybExheW91dFJlY3QueSA9IHBvc1k7XG5cblx0XHRcdFx0XHQvLyBBbGlnbiBjb250cm9sIGhvcml6b250YWxcblx0XHRcdFx0XHRhbGlnbiA9IGN0cmxTZXR0aW5ncy5hbGlnbkggfHwgKGFsaWduSCA/IChhbGlnbkhbeF0gfHwgYWxpZ25IWzBdKSA6IG51bGwpO1xuXHRcdFx0XHRcdGlmIChhbGlnbiA9PSBcImNlbnRlclwiKSB7XG5cdFx0XHRcdFx0XHRjdHJsTGF5b3V0UmVjdC54ID0gcG9zWCArICh3aWR0aCAvIDIpIC0gKGN0cmxMYXlvdXRSZWN0LncgLyAyKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKGFsaWduID09IFwicmlnaHRcIikge1xuXHRcdFx0XHRcdFx0Y3RybExheW91dFJlY3QueCA9IHBvc1ggKyB3aWR0aCAtIGN0cmxMYXlvdXRSZWN0Lnc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmIChhbGlnbiA9PSBcInN0cmV0Y2hcIikge1xuXHRcdFx0XHRcdFx0Y3RybExheW91dFJlY3QudyA9IHdpZHRoO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdC8vIEFsaWduIGNvbnRyb2wgdmVydGljYWxcblx0XHRcdFx0XHRhbGlnbiA9IGN0cmxTZXR0aW5ncy5hbGlnblYgfHwgKGFsaWduViA/IChhbGlnblZbeF0gfHwgYWxpZ25WWzBdKSA6IG51bGwpO1xuXHRcdFx0XHRcdGlmIChhbGlnbiA9PSBcImNlbnRlclwiKSB7XG5cdFx0XHRcdFx0XHRjdHJsTGF5b3V0UmVjdC55ID0gcG9zWSArIChoZWlnaHQgLyAyKSAtIChjdHJsTGF5b3V0UmVjdC5oIC8gMik7XG5cdFx0XHRcdFx0fSBlbHNlIGlmIChhbGlnbiA9PSBcImJvdHRvbVwiKSB7XG5cdFx0XHRcdFx0XHRjdHJsTGF5b3V0UmVjdC55ID0gcG9zWSArIGhlaWdodCAtIGN0cmxMYXlvdXRSZWN0Lmg7XG5cdFx0XHRcdFx0fSBlbHNlIGlmIChhbGlnbiA9PSBcInN0cmV0Y2hcIikge1xuXHRcdFx0XHRcdFx0Y3RybExheW91dFJlY3QuaCA9IGhlaWdodDtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRjdHJsLmxheW91dFJlY3QoY3RybExheW91dFJlY3QpO1xuXG5cdFx0XHRcdFx0cG9zWCArPSB3aWR0aCArIHNwYWNpbmdIO1xuXG5cdFx0XHRcdFx0aWYgKGN0cmwucmVjYWxjKSB7XG5cdFx0XHRcdFx0XHRjdHJsLnJlY2FsYygpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdHBvc1kgKz0gaGVpZ2h0ICsgc3BhY2luZ1Y7XG5cdFx0XHR9XG5cdFx0fVxuXHR9KTtcbn0pO1xuXG4vLyBJbmNsdWRlZCBmcm9tOiBqcy90aW55bWNlL2NsYXNzZXMvdWkvSWZyYW1lLmpzXG5cbi8qKlxuICogSWZyYW1lLmpzXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgTEdQTCBMaWNlbnNlLlxuICogQ29weXJpZ2h0IChjKSAxOTk5LTIwMTUgRXBob3ggQ29ycC4gQWxsIHJpZ2h0cyByZXNlcnZlZFxuICpcbiAqIExpY2Vuc2U6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vbGljZW5zZVxuICogQ29udHJpYnV0aW5nOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2NvbnRyaWJ1dGluZ1xuICovXG5cbi8qanNoaW50IHNjcmlwdHVybDp0cnVlICovXG5cbi8qKlxuICogVGhpcyBjbGFzcyBjcmVhdGVzIGFuIGlmcmFtZS5cbiAqXG4gKiBAc2V0dGluZyB7U3RyaW5nfSB1cmwgVXJsIHRvIG9wZW4gaW4gdGhlIGlmcmFtZS5cbiAqXG4gKiBALXgtbGVzcyBJZnJhbWUubGVzc1xuICogQGNsYXNzIHRpbnltY2UudWkuSWZyYW1lXG4gKiBAZXh0ZW5kcyB0aW55bWNlLnVpLldpZGdldFxuICovXG5kZWZpbmUoXCJ0aW55bWNlL3VpL0lmcmFtZVwiLCBbXG5cdFwidGlueW1jZS91aS9XaWRnZXRcIixcblx0XCJ0aW55bWNlL3V0aWwvRGVsYXlcIlxuXSwgZnVuY3Rpb24oV2lkZ2V0LCBEZWxheSkge1xuXHRcInVzZSBzdHJpY3RcIjtcblxuXHRyZXR1cm4gV2lkZ2V0LmV4dGVuZCh7XG5cdFx0LyoqXG5cdFx0ICogUmVuZGVycyB0aGUgY29udHJvbCBhcyBhIEhUTUwgc3RyaW5nLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCByZW5kZXJIdG1sXG5cdFx0ICogQHJldHVybiB7U3RyaW5nfSBIVE1MIHJlcHJlc2VudGluZyB0aGUgY29udHJvbC5cblx0XHQgKi9cblx0XHRyZW5kZXJIdG1sOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0c2VsZi5jbGFzc2VzLmFkZCgnaWZyYW1lJyk7XG5cdFx0XHRzZWxmLmNhbkZvY3VzID0gZmFsc2U7XG5cblx0XHRcdC8qZXNsaW50IG5vLXNjcmlwdC11cmw6MCAqL1xuXHRcdFx0cmV0dXJuIChcblx0XHRcdFx0JzxpZnJhbWUgaWQ9XCInICsgc2VsZi5faWQgKyAnXCIgY2xhc3M9XCInICsgc2VsZi5jbGFzc2VzICsgJ1wiIHRhYmluZGV4PVwiLTFcIiBzcmM9XCInICtcblx0XHRcdFx0KHNlbGYuc2V0dGluZ3MudXJsIHx8IFwiamF2YXNjcmlwdDonJ1wiKSArICdcIiBmcmFtZWJvcmRlcj1cIjBcIj48L2lmcmFtZT4nXG5cdFx0XHQpO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBTZXR0ZXIgZm9yIHRoZSBpZnJhbWUgc291cmNlLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBzcmNcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gc3JjIFNvdXJjZSBVUkwgZm9yIGlmcmFtZS5cblx0XHQgKi9cblx0XHRzcmM6IGZ1bmN0aW9uKHNyYykge1xuXHRcdFx0dGhpcy5nZXRFbCgpLnNyYyA9IHNyYztcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogSW5uZXIgSFRNTCBmb3IgdGhlIGlmcmFtZS5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgaHRtbFxuXHRcdCAqIEBwYXJhbSB7U3RyaW5nfSBodG1sIEhUTUwgc3RyaW5nIHRvIHNldCBhcyBIVE1MIGluc2lkZSB0aGUgaWZyYW1lLlxuXHRcdCAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrIE9wdGlvbmFsIGNhbGxiYWNrIHRvIGV4ZWN1dGUgd2hlbiB0aGUgaWZyYW1lIGJvZHkgaXMgZmlsbGVkIHdpdGggY29udGVudHMuXG5cdFx0ICogQHJldHVybiB7dGlueW1jZS51aS5JZnJhbWV9IEN1cnJlbnQgaWZyYW1lIGNvbnRyb2wuXG5cdFx0ICovXG5cdFx0aHRtbDogZnVuY3Rpb24oaHRtbCwgY2FsbGJhY2spIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgYm9keSA9IHRoaXMuZ2V0RWwoKS5jb250ZW50V2luZG93LmRvY3VtZW50LmJvZHk7XG5cblx0XHRcdC8vIFdhaXQgZm9yIGlmcmFtZSB0byBpbml0aWFsaXplIElFIDEwIHRha2VzIHRpbWVcblx0XHRcdGlmICghYm9keSkge1xuXHRcdFx0XHREZWxheS5zZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdHNlbGYuaHRtbChodG1sKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRib2R5LmlubmVySFRNTCA9IGh0bWw7XG5cblx0XHRcdFx0aWYgKGNhbGxiYWNrKSB7XG5cdFx0XHRcdFx0Y2FsbGJhY2soKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cdH0pO1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy91aS9JbmZvQm94LmpzXG5cbi8qKlxuICogSW5mb0JveC5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE2IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKipcbiAqIC4uLi5cbiAqXG4gKiBALXgtbGVzcyBJbmZvQm94Lmxlc3NcbiAqIEBjbGFzcyB0aW55bWNlLnVpLkluZm9Cb3hcbiAqIEBleHRlbmRzIHRpbnltY2UudWkuV2lkZ2V0XG4gKi9cbmRlZmluZShcInRpbnltY2UvdWkvSW5mb0JveFwiLCBbXG5cdFwidGlueW1jZS91aS9XaWRnZXRcIlxuXSwgZnVuY3Rpb24oV2lkZ2V0KSB7XG5cdFwidXNlIHN0cmljdFwiO1xuXG5cdHJldHVybiBXaWRnZXQuZXh0ZW5kKHtcblx0XHQvKipcblx0XHQgKiBDb25zdHJ1Y3RzIGEgaW5zdGFuY2Ugd2l0aCB0aGUgc3BlY2lmaWVkIHNldHRpbmdzLlxuXHRcdCAqXG5cdFx0ICogQGNvbnN0cnVjdG9yXG5cdFx0ICogQHBhcmFtIHtPYmplY3R9IHNldHRpbmdzIE5hbWUvdmFsdWUgb2JqZWN0IHdpdGggc2V0dGluZ3MuXG5cdFx0ICogQHNldHRpbmcge0Jvb2xlYW59IG11bHRpbGluZSBNdWx0aWxpbmUgbGFiZWwuXG5cdFx0ICovXG5cdFx0aW5pdDogZnVuY3Rpb24oc2V0dGluZ3MpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0c2VsZi5fc3VwZXIoc2V0dGluZ3MpO1xuXHRcdFx0c2VsZi5jbGFzc2VzLmFkZCgnd2lkZ2V0JykuYWRkKCdpbmZvYm94Jyk7XG5cdFx0XHRzZWxmLmNhbkZvY3VzID0gZmFsc2U7XG5cdFx0fSxcblxuXHRcdHNldmVyaXR5OiBmdW5jdGlvbihsZXZlbCkge1xuXHRcdFx0dGhpcy5jbGFzc2VzLnJlbW92ZSgnZXJyb3InKTtcblx0XHRcdHRoaXMuY2xhc3Nlcy5yZW1vdmUoJ3dhcm5pbmcnKTtcblx0XHRcdHRoaXMuY2xhc3Nlcy5yZW1vdmUoJ3N1Y2Nlc3MnKTtcblx0XHRcdHRoaXMuY2xhc3Nlcy5hZGQobGV2ZWwpO1xuXHRcdH0sXG5cblx0XHRoZWxwOiBmdW5jdGlvbihzdGF0ZSkge1xuXHRcdFx0dGhpcy5zdGF0ZS5zZXQoJ2hlbHAnLCBzdGF0ZSk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFJlbmRlcnMgdGhlIGNvbnRyb2wgYXMgYSBIVE1MIHN0cmluZy5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgcmVuZGVySHRtbFxuXHRcdCAqIEByZXR1cm4ge1N0cmluZ30gSFRNTCByZXByZXNlbnRpbmcgdGhlIGNvbnRyb2wuXG5cdFx0ICovXG5cdFx0cmVuZGVySHRtbDogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIHByZWZpeCA9IHNlbGYuY2xhc3NQcmVmaXg7XG5cblx0XHRcdHJldHVybiAoXG5cdFx0XHRcdCc8ZGl2IGlkPVwiJyArIHNlbGYuX2lkICsgJ1wiIGNsYXNzPVwiJyArIHNlbGYuY2xhc3NlcyArICdcIj4nICtcblx0XHRcdFx0XHQnPGRpdiBpZD1cIicgKyBzZWxmLl9pZCArICctYm9keVwiPicgK1xuXHRcdFx0XHRcdFx0c2VsZi5lbmNvZGUoc2VsZi5zdGF0ZS5nZXQoJ3RleHQnKSkgK1xuXHRcdFx0XHRcdFx0JzxidXR0b24gcm9sZT1cImJ1dHRvblwiIHRhYmluZGV4PVwiLTFcIj4nICtcblx0XHRcdFx0XHRcdFx0JzxpIGNsYXNzPVwiJyArIHByZWZpeCArICdpY28gJyArIHByZWZpeCArICdpLWhlbHBcIj48L2k+JyArXG5cdFx0XHRcdFx0XHQnPC9idXR0b24+JyArXG5cdFx0XHRcdFx0JzwvZGl2PicgK1xuXHRcdFx0XHQnPC9kaXY+J1xuXHRcdFx0KTtcblx0XHR9LFxuXG5cdFx0YmluZFN0YXRlczogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdHNlbGYuc3RhdGUub24oJ2NoYW5nZTp0ZXh0JywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRzZWxmLmdldEVsKCdib2R5JykuZmlyc3RDaGlsZC5kYXRhID0gc2VsZi5lbmNvZGUoZS52YWx1ZSk7XG5cblx0XHRcdFx0aWYgKHNlbGYuc3RhdGUuZ2V0KCdyZW5kZXJlZCcpKSB7XG5cdFx0XHRcdFx0c2VsZi51cGRhdGVMYXlvdXRSZWN0KCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRzZWxmLnN0YXRlLm9uKCdjaGFuZ2U6aGVscCcsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0c2VsZi5jbGFzc2VzLnRvZ2dsZSgnaGFzLWhlbHAnLCBlLnZhbHVlKTtcblxuXHRcdFx0XHRpZiAoc2VsZi5zdGF0ZS5nZXQoJ3JlbmRlcmVkJykpIHtcblx0XHRcdFx0XHRzZWxmLnVwZGF0ZUxheW91dFJlY3QoKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdHJldHVybiBzZWxmLl9zdXBlcigpO1xuXHRcdH1cblx0fSk7XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL3VpL0xhYmVsLmpzXG5cbi8qKlxuICogTGFiZWwuanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBUaGlzIGNsYXNzIGNyZWF0ZXMgYSBsYWJlbCBlbGVtZW50LiBBIGxhYmVsIGlzIGEgc2ltcGxlIHRleHQgY29udHJvbFxuICogdGhhdCBjYW4gYmUgYm91bmQgdG8gb3RoZXIgY29udHJvbHMuXG4gKlxuICogQC14LWxlc3MgTGFiZWwubGVzc1xuICogQGNsYXNzIHRpbnltY2UudWkuTGFiZWxcbiAqIEBleHRlbmRzIHRpbnltY2UudWkuV2lkZ2V0XG4gKi9cbmRlZmluZShcInRpbnltY2UvdWkvTGFiZWxcIiwgW1xuXHRcInRpbnltY2UvdWkvV2lkZ2V0XCIsXG5cdFwidGlueW1jZS91aS9Eb21VdGlsc1wiXG5dLCBmdW5jdGlvbihXaWRnZXQsIERvbVV0aWxzKSB7XG5cdFwidXNlIHN0cmljdFwiO1xuXG5cdHJldHVybiBXaWRnZXQuZXh0ZW5kKHtcblx0XHQvKipcblx0XHQgKiBDb25zdHJ1Y3RzIGEgaW5zdGFuY2Ugd2l0aCB0aGUgc3BlY2lmaWVkIHNldHRpbmdzLlxuXHRcdCAqXG5cdFx0ICogQGNvbnN0cnVjdG9yXG5cdFx0ICogQHBhcmFtIHtPYmplY3R9IHNldHRpbmdzIE5hbWUvdmFsdWUgb2JqZWN0IHdpdGggc2V0dGluZ3MuXG5cdFx0ICogQHNldHRpbmcge0Jvb2xlYW59IG11bHRpbGluZSBNdWx0aWxpbmUgbGFiZWwuXG5cdFx0ICovXG5cdFx0aW5pdDogZnVuY3Rpb24oc2V0dGluZ3MpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0c2VsZi5fc3VwZXIoc2V0dGluZ3MpO1xuXHRcdFx0c2VsZi5jbGFzc2VzLmFkZCgnd2lkZ2V0JykuYWRkKCdsYWJlbCcpO1xuXHRcdFx0c2VsZi5jYW5Gb2N1cyA9IGZhbHNlO1xuXG5cdFx0XHRpZiAoc2V0dGluZ3MubXVsdGlsaW5lKSB7XG5cdFx0XHRcdHNlbGYuY2xhc3Nlcy5hZGQoJ2F1dG9zY3JvbGwnKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHNldHRpbmdzLnN0cm9uZykge1xuXHRcdFx0XHRzZWxmLmNsYXNzZXMuYWRkKCdzdHJvbmcnKTtcblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogSW5pdGlhbGl6ZXMgdGhlIGN1cnJlbnQgY29udHJvbHMgbGF5b3V0IHJlY3QuXG5cdFx0ICogVGhpcyB3aWxsIGJlIGV4ZWN1dGVkIGJ5IHRoZSBsYXlvdXQgbWFuYWdlcnMgdG8gZGV0ZXJtaW5lIHRoZVxuXHRcdCAqIGRlZmF1bHQgbWluV2lkdGgvbWluSGVpZ2h0IGV0Yy5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgaW5pdExheW91dFJlY3Rcblx0XHQgKiBAcmV0dXJuIHtPYmplY3R9IExheW91dCByZWN0IGluc3RhbmNlLlxuXHRcdCAqL1xuXHRcdGluaXRMYXlvdXRSZWN0OiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgbGF5b3V0UmVjdCA9IHNlbGYuX3N1cGVyKCk7XG5cblx0XHRcdGlmIChzZWxmLnNldHRpbmdzLm11bHRpbGluZSkge1xuXHRcdFx0XHR2YXIgc2l6ZSA9IERvbVV0aWxzLmdldFNpemUoc2VsZi5nZXRFbCgpKTtcblxuXHRcdFx0XHQvLyBDaGVjayBpZiB0aGUgdGV4dCBmaXRzIHdpdGhpbiBtYXhXIGlmIG5vdCB0aGVuIHRyeSB3b3JkIHdyYXBwaW5nIGl0XG5cdFx0XHRcdGlmIChzaXplLndpZHRoID4gbGF5b3V0UmVjdC5tYXhXKSB7XG5cdFx0XHRcdFx0bGF5b3V0UmVjdC5taW5XID0gbGF5b3V0UmVjdC5tYXhXO1xuXHRcdFx0XHRcdHNlbGYuY2xhc3Nlcy5hZGQoJ211bHRpbGluZScpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0c2VsZi5nZXRFbCgpLnN0eWxlLndpZHRoID0gbGF5b3V0UmVjdC5taW5XICsgJ3B4Jztcblx0XHRcdFx0bGF5b3V0UmVjdC5zdGFydE1pbkggPSBsYXlvdXRSZWN0LmggPSBsYXlvdXRSZWN0Lm1pbkggPSBNYXRoLm1pbihsYXlvdXRSZWN0Lm1heEgsIERvbVV0aWxzLmdldFNpemUoc2VsZi5nZXRFbCgpKS5oZWlnaHQpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbGF5b3V0UmVjdDtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmVwYWludHMgdGhlIGNvbnRyb2wgYWZ0ZXIgYSBsYXlvdXQgb3BlcmF0aW9uLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCByZXBhaW50XG5cdFx0ICovXG5cdFx0cmVwYWludDogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdGlmICghc2VsZi5zZXR0aW5ncy5tdWx0aWxpbmUpIHtcblx0XHRcdFx0c2VsZi5nZXRFbCgpLnN0eWxlLmxpbmVIZWlnaHQgPSBzZWxmLmxheW91dFJlY3QoKS5oICsgJ3B4Jztcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHNlbGYuX3N1cGVyKCk7XG5cdFx0fSxcblxuXHRcdHNldmVyaXR5OiBmdW5jdGlvbihsZXZlbCkge1xuXHRcdFx0dGhpcy5jbGFzc2VzLnJlbW92ZSgnZXJyb3InKTtcblx0XHRcdHRoaXMuY2xhc3Nlcy5yZW1vdmUoJ3dhcm5pbmcnKTtcblx0XHRcdHRoaXMuY2xhc3Nlcy5yZW1vdmUoJ3N1Y2Nlc3MnKTtcblx0XHRcdHRoaXMuY2xhc3Nlcy5hZGQobGV2ZWwpO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZW5kZXJzIHRoZSBjb250cm9sIGFzIGEgSFRNTCBzdHJpbmcuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHJlbmRlckh0bWxcblx0XHQgKiBAcmV0dXJuIHtTdHJpbmd9IEhUTUwgcmVwcmVzZW50aW5nIHRoZSBjb250cm9sLlxuXHRcdCAqL1xuXHRcdHJlbmRlckh0bWw6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLCB0YXJnZXRDdHJsLCBmb3JOYW1lLCBmb3JJZCA9IHNlbGYuc2V0dGluZ3MuZm9ySWQ7XG5cblx0XHRcdGlmICghZm9ySWQgJiYgKGZvck5hbWUgPSBzZWxmLnNldHRpbmdzLmZvck5hbWUpKSB7XG5cdFx0XHRcdHRhcmdldEN0cmwgPSBzZWxmLmdldFJvb3QoKS5maW5kKCcjJyArIGZvck5hbWUpWzBdO1xuXG5cdFx0XHRcdGlmICh0YXJnZXRDdHJsKSB7XG5cdFx0XHRcdFx0Zm9ySWQgPSB0YXJnZXRDdHJsLl9pZDtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAoZm9ySWQpIHtcblx0XHRcdFx0cmV0dXJuIChcblx0XHRcdFx0XHQnPGxhYmVsIGlkPVwiJyArIHNlbGYuX2lkICsgJ1wiIGNsYXNzPVwiJyArIHNlbGYuY2xhc3NlcyArICdcIicgKyAoZm9ySWQgPyAnIGZvcj1cIicgKyBmb3JJZCArICdcIicgOiAnJykgKyAnPicgK1xuXHRcdFx0XHRcdFx0c2VsZi5lbmNvZGUoc2VsZi5zdGF0ZS5nZXQoJ3RleHQnKSkgK1xuXHRcdFx0XHRcdCc8L2xhYmVsPidcblx0XHRcdFx0KTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIChcblx0XHRcdFx0JzxzcGFuIGlkPVwiJyArIHNlbGYuX2lkICsgJ1wiIGNsYXNzPVwiJyArIHNlbGYuY2xhc3NlcyArICdcIj4nICtcblx0XHRcdFx0XHRzZWxmLmVuY29kZShzZWxmLnN0YXRlLmdldCgndGV4dCcpKSArXG5cdFx0XHRcdCc8L3NwYW4+J1xuXHRcdFx0KTtcblx0XHR9LFxuXG5cdFx0YmluZFN0YXRlczogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdHNlbGYuc3RhdGUub24oJ2NoYW5nZTp0ZXh0JywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRzZWxmLmlubmVySHRtbChzZWxmLmVuY29kZShlLnZhbHVlKSk7XG5cblx0XHRcdFx0aWYgKHNlbGYuc3RhdGUuZ2V0KCdyZW5kZXJlZCcpKSB7XG5cdFx0XHRcdFx0c2VsZi51cGRhdGVMYXlvdXRSZWN0KCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRyZXR1cm4gc2VsZi5fc3VwZXIoKTtcblx0XHR9XG5cdH0pO1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy91aS9Ub29sYmFyLmpzXG5cbi8qKlxuICogVG9vbGJhci5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE1IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKipcbiAqIENyZWF0ZXMgYSBuZXcgdG9vbGJhci5cbiAqXG4gKiBAY2xhc3MgdGlueW1jZS51aS5Ub29sYmFyXG4gKiBAZXh0ZW5kcyB0aW55bWNlLnVpLkNvbnRhaW5lclxuICovXG5kZWZpbmUoXCJ0aW55bWNlL3VpL1Rvb2xiYXJcIiwgW1xuXHRcInRpbnltY2UvdWkvQ29udGFpbmVyXCJcbl0sIGZ1bmN0aW9uKENvbnRhaW5lcikge1xuXHRcInVzZSBzdHJpY3RcIjtcblxuXHRyZXR1cm4gQ29udGFpbmVyLmV4dGVuZCh7XG5cdFx0RGVmYXVsdHM6IHtcblx0XHRcdHJvbGU6ICd0b29sYmFyJyxcblx0XHRcdGxheW91dDogJ2Zsb3cnXG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIENvbnN0cnVjdHMgYSBpbnN0YW5jZSB3aXRoIHRoZSBzcGVjaWZpZWQgc2V0dGluZ3MuXG5cdFx0ICpcblx0XHQgKiBAY29uc3RydWN0b3Jcblx0XHQgKiBAcGFyYW0ge09iamVjdH0gc2V0dGluZ3MgTmFtZS92YWx1ZSBvYmplY3Qgd2l0aCBzZXR0aW5ncy5cblx0XHQgKi9cblx0XHRpbml0OiBmdW5jdGlvbihzZXR0aW5ncykge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHRzZWxmLl9zdXBlcihzZXR0aW5ncyk7XG5cdFx0XHRzZWxmLmNsYXNzZXMuYWRkKCd0b29sYmFyJyk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIENhbGxlZCBhZnRlciB0aGUgY29udHJvbCBoYXMgYmVlbiByZW5kZXJlZC5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgcG9zdFJlbmRlclxuXHRcdCAqL1xuXHRcdHBvc3RSZW5kZXI6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHRzZWxmLml0ZW1zKCkuZWFjaChmdW5jdGlvbihjdHJsKSB7XG5cdFx0XHRcdGN0cmwuY2xhc3Nlcy5hZGQoJ3Rvb2xiYXItaXRlbScpO1xuXHRcdFx0fSk7XG5cblx0XHRcdHJldHVybiBzZWxmLl9zdXBlcigpO1xuXHRcdH1cblx0fSk7XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL3VpL01lbnVCYXIuanNcblxuLyoqXG4gKiBNZW51QmFyLmpzXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgTEdQTCBMaWNlbnNlLlxuICogQ29weXJpZ2h0IChjKSAxOTk5LTIwMTUgRXBob3ggQ29ycC4gQWxsIHJpZ2h0cyByZXNlcnZlZFxuICpcbiAqIExpY2Vuc2U6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vbGljZW5zZVxuICogQ29udHJpYnV0aW5nOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2NvbnRyaWJ1dGluZ1xuICovXG5cbi8qKlxuICogQ3JlYXRlcyBhIG5ldyBtZW51YmFyLlxuICpcbiAqIEAteC1sZXNzIE1lbnVCYXIubGVzc1xuICogQGNsYXNzIHRpbnltY2UudWkuTWVudUJhclxuICogQGV4dGVuZHMgdGlueW1jZS51aS5Db250YWluZXJcbiAqL1xuZGVmaW5lKFwidGlueW1jZS91aS9NZW51QmFyXCIsIFtcblx0XCJ0aW55bWNlL3VpL1Rvb2xiYXJcIlxuXSwgZnVuY3Rpb24oVG9vbGJhcikge1xuXHRcInVzZSBzdHJpY3RcIjtcblxuXHRyZXR1cm4gVG9vbGJhci5leHRlbmQoe1xuXHRcdERlZmF1bHRzOiB7XG5cdFx0XHRyb2xlOiAnbWVudWJhcicsXG5cdFx0XHRjb250YWluZXJDbHM6ICdtZW51YmFyJyxcblx0XHRcdGFyaWFSb290OiB0cnVlLFxuXHRcdFx0ZGVmYXVsdHM6IHtcblx0XHRcdFx0dHlwZTogJ21lbnVidXR0b24nXG5cdFx0XHR9XG5cdFx0fVxuXHR9KTtcbn0pO1xuXG4vLyBJbmNsdWRlZCBmcm9tOiBqcy90aW55bWNlL2NsYXNzZXMvdWkvTWVudUJ1dHRvbi5qc1xuXG4vKipcbiAqIE1lbnVCdXR0b24uanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBDcmVhdGVzIGEgbmV3IG1lbnUgYnV0dG9uLlxuICpcbiAqIEAteC1sZXNzIE1lbnVCdXR0b24ubGVzc1xuICogQGNsYXNzIHRpbnltY2UudWkuTWVudUJ1dHRvblxuICogQGV4dGVuZHMgdGlueW1jZS51aS5CdXR0b25cbiAqL1xuZGVmaW5lKFwidGlueW1jZS91aS9NZW51QnV0dG9uXCIsIFtcblx0XCJ0aW55bWNlL3VpL0J1dHRvblwiLFxuXHRcInRpbnltY2UvdWkvRmFjdG9yeVwiLFxuXHRcInRpbnltY2UvdWkvTWVudUJhclwiXG5dLCBmdW5jdGlvbihCdXR0b24sIEZhY3RvcnksIE1lbnVCYXIpIHtcblx0XCJ1c2Ugc3RyaWN0XCI7XG5cblx0Ly8gVE9ETzogTWF5YmUgYWRkIGFzIHNvbWUgZ2xvYmFsIGZ1bmN0aW9uXG5cdGZ1bmN0aW9uIGlzQ2hpbGRPZihub2RlLCBwYXJlbnQpIHtcblx0XHR3aGlsZSAobm9kZSkge1xuXHRcdFx0aWYgKHBhcmVudCA9PT0gbm9kZSkge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdH1cblxuXHRcdFx0bm9kZSA9IG5vZGUucGFyZW50Tm9kZTtcblx0XHR9XG5cblx0XHRyZXR1cm4gZmFsc2U7XG5cdH1cblxuXHR2YXIgTWVudUJ1dHRvbiA9IEJ1dHRvbi5leHRlbmQoe1xuXHRcdC8qKlxuXHRcdCAqIENvbnN0cnVjdHMgYSBpbnN0YW5jZSB3aXRoIHRoZSBzcGVjaWZpZWQgc2V0dGluZ3MuXG5cdFx0ICpcblx0XHQgKiBAY29uc3RydWN0b3Jcblx0XHQgKiBAcGFyYW0ge09iamVjdH0gc2V0dGluZ3MgTmFtZS92YWx1ZSBvYmplY3Qgd2l0aCBzZXR0aW5ncy5cblx0XHQgKi9cblx0XHRpbml0OiBmdW5jdGlvbihzZXR0aW5ncykge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHRzZWxmLl9yZW5kZXJPcGVuID0gdHJ1ZTtcblxuXHRcdFx0c2VsZi5fc3VwZXIoc2V0dGluZ3MpO1xuXHRcdFx0c2V0dGluZ3MgPSBzZWxmLnNldHRpbmdzO1xuXG5cdFx0XHRzZWxmLmNsYXNzZXMuYWRkKCdtZW51YnRuJyk7XG5cblx0XHRcdGlmIChzZXR0aW5ncy5maXhlZFdpZHRoKSB7XG5cdFx0XHRcdHNlbGYuY2xhc3Nlcy5hZGQoJ2ZpeGVkLXdpZHRoJyk7XG5cdFx0XHR9XG5cblx0XHRcdHNlbGYuYXJpYSgnaGFzcG9wdXAnLCB0cnVlKTtcblxuXHRcdFx0c2VsZi5zdGF0ZS5zZXQoJ21lbnUnLCBzZXR0aW5ncy5tZW51IHx8IHNlbGYucmVuZGVyKCkpO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBTaG93cyB0aGUgbWVudSBmb3IgdGhlIGJ1dHRvbi5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2Qgc2hvd01lbnVcblx0XHQgKi9cblx0XHRzaG93TWVudTogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIG1lbnU7XG5cblx0XHRcdGlmIChzZWxmLm1lbnUgJiYgc2VsZi5tZW51LnZpc2libGUoKSkge1xuXHRcdFx0XHRyZXR1cm4gc2VsZi5oaWRlTWVudSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoIXNlbGYubWVudSkge1xuXHRcdFx0XHRtZW51ID0gc2VsZi5zdGF0ZS5nZXQoJ21lbnUnKSB8fCBbXTtcblxuXHRcdFx0XHQvLyBJcyBtZW51IGFycmF5IHRoZW4gYXV0byBjb25zdHVjdCBtZW51IGNvbnRyb2xcblx0XHRcdFx0aWYgKG1lbnUubGVuZ3RoKSB7XG5cdFx0XHRcdFx0bWVudSA9IHtcblx0XHRcdFx0XHRcdHR5cGU6ICdtZW51Jyxcblx0XHRcdFx0XHRcdGl0ZW1zOiBtZW51XG5cdFx0XHRcdFx0fTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRtZW51LnR5cGUgPSBtZW51LnR5cGUgfHwgJ21lbnUnO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKCFtZW51LnJlbmRlclRvKSB7XG5cdFx0XHRcdFx0c2VsZi5tZW51ID0gRmFjdG9yeS5jcmVhdGUobWVudSkucGFyZW50KHNlbGYpLnJlbmRlclRvKCk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0c2VsZi5tZW51ID0gbWVudS5wYXJlbnQoc2VsZikuc2hvdygpLnJlbmRlclRvKCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRzZWxmLmZpcmUoJ2NyZWF0ZW1lbnUnKTtcblx0XHRcdFx0c2VsZi5tZW51LnJlZmxvdygpO1xuXHRcdFx0XHRzZWxmLm1lbnUub24oJ2NhbmNlbCcsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0XHRpZiAoZS5jb250cm9sLnBhcmVudCgpID09PSBzZWxmLm1lbnUpIHtcblx0XHRcdFx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdFx0XHRzZWxmLmZvY3VzKCk7XG5cdFx0XHRcdFx0XHRzZWxmLmhpZGVNZW51KCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHQvLyBNb3ZlIGZvY3VzIHRvIGJ1dHRvbiB3aGVuIGEgbWVudSBpdGVtIGlzIHNlbGVjdGVkL2NsaWNrZWRcblx0XHRcdFx0c2VsZi5tZW51Lm9uKCdzZWxlY3QnLCBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRzZWxmLmZvY3VzKCk7XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdHNlbGYubWVudS5vbignc2hvdyBoaWRlJywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRcdGlmIChlLmNvbnRyb2wgPT0gc2VsZi5tZW51KSB7XG5cdFx0XHRcdFx0XHRzZWxmLmFjdGl2ZU1lbnUoZS50eXBlID09ICdzaG93Jyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0c2VsZi5hcmlhKCdleHBhbmRlZCcsIGUudHlwZSA9PSAnc2hvdycpO1xuXHRcdFx0XHR9KS5maXJlKCdzaG93Jyk7XG5cdFx0XHR9XG5cblx0XHRcdHNlbGYubWVudS5zaG93KCk7XG5cdFx0XHRzZWxmLm1lbnUubGF5b3V0UmVjdCh7dzogc2VsZi5sYXlvdXRSZWN0KCkud30pO1xuXHRcdFx0c2VsZi5tZW51Lm1vdmVSZWwoc2VsZi5nZXRFbCgpLCBzZWxmLmlzUnRsKCkgPyBbJ2JyLXRyJywgJ3RyLWJyJ10gOiBbJ2JsLXRsJywgJ3RsLWJsJ10pO1xuXHRcdFx0c2VsZi5maXJlKCdzaG93bWVudScpO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBIaWRlcyB0aGUgbWVudSBmb3IgdGhlIGJ1dHRvbi5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgaGlkZU1lbnVcblx0XHQgKi9cblx0XHRoaWRlTWVudTogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdGlmIChzZWxmLm1lbnUpIHtcblx0XHRcdFx0c2VsZi5tZW51Lml0ZW1zKCkuZWFjaChmdW5jdGlvbihpdGVtKSB7XG5cdFx0XHRcdFx0aWYgKGl0ZW0uaGlkZU1lbnUpIHtcblx0XHRcdFx0XHRcdGl0ZW0uaGlkZU1lbnUoKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdHNlbGYubWVudS5oaWRlKCk7XG5cdFx0XHR9XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFNldHMgdGhlIGFjdGl2ZSBtZW51IHN0YXRlLlxuXHRcdCAqXG5cdFx0ICogQHByaXZhdGVcblx0XHQgKi9cblx0XHRhY3RpdmVNZW51OiBmdW5jdGlvbihzdGF0ZSkge1xuXHRcdFx0dGhpcy5jbGFzc2VzLnRvZ2dsZSgnYWN0aXZlJywgc3RhdGUpO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZW5kZXJzIHRoZSBjb250cm9sIGFzIGEgSFRNTCBzdHJpbmcuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHJlbmRlckh0bWxcblx0XHQgKiBAcmV0dXJuIHtTdHJpbmd9IEhUTUwgcmVwcmVzZW50aW5nIHRoZSBjb250cm9sLlxuXHRcdCAqL1xuXHRcdHJlbmRlckh0bWw6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLCBpZCA9IHNlbGYuX2lkLCBwcmVmaXggPSBzZWxmLmNsYXNzUHJlZml4O1xuXHRcdFx0dmFyIGljb24gPSBzZWxmLnNldHRpbmdzLmljb24sIGltYWdlLCB0ZXh0ID0gc2VsZi5zdGF0ZS5nZXQoJ3RleHQnKSxcblx0XHRcdFx0dGV4dEh0bWwgPSAnJztcblxuXHRcdFx0aW1hZ2UgPSBzZWxmLnNldHRpbmdzLmltYWdlO1xuXHRcdFx0aWYgKGltYWdlKSB7XG5cdFx0XHRcdGljb24gPSAnbm9uZSc7XG5cblx0XHRcdFx0Ly8gU3VwcG9ydCBmb3IgW2hpZ2ggZHBpLCBsb3cgZHBpXSBpbWFnZSBzb3VyY2VzXG5cdFx0XHRcdGlmICh0eXBlb2YgaW1hZ2UgIT0gXCJzdHJpbmdcIikge1xuXHRcdFx0XHRcdGltYWdlID0gd2luZG93LmdldFNlbGVjdGlvbiA/IGltYWdlWzBdIDogaW1hZ2VbMV07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpbWFnZSA9ICcgc3R5bGU9XCJiYWNrZ3JvdW5kLWltYWdlOiB1cmwoXFwnJyArIGltYWdlICsgJ1xcJylcIic7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRpbWFnZSA9ICcnO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAodGV4dCkge1xuXHRcdFx0XHRzZWxmLmNsYXNzZXMuYWRkKCdidG4taGFzLXRleHQnKTtcblx0XHRcdFx0dGV4dEh0bWwgPSAnPHNwYW4gY2xhc3M9XCInICsgcHJlZml4ICsgJ3R4dFwiPicgKyBzZWxmLmVuY29kZSh0ZXh0KSArICc8L3NwYW4+Jztcblx0XHRcdH1cblxuXHRcdFx0aWNvbiA9IHNlbGYuc2V0dGluZ3MuaWNvbiA/IHByZWZpeCArICdpY28gJyArIHByZWZpeCArICdpLScgKyBpY29uIDogJyc7XG5cblx0XHRcdHNlbGYuYXJpYSgncm9sZScsIHNlbGYucGFyZW50KCkgaW5zdGFuY2VvZiBNZW51QmFyID8gJ21lbnVpdGVtJyA6ICdidXR0b24nKTtcblxuXHRcdFx0cmV0dXJuIChcblx0XHRcdFx0JzxkaXYgaWQ9XCInICsgaWQgKyAnXCIgY2xhc3M9XCInICsgc2VsZi5jbGFzc2VzICsgJ1wiIHRhYmluZGV4PVwiLTFcIiBhcmlhLWxhYmVsbGVkYnk9XCInICsgaWQgKyAnXCI+JyArXG5cdFx0XHRcdFx0JzxidXR0b24gaWQ9XCInICsgaWQgKyAnLW9wZW5cIiByb2xlPVwicHJlc2VudGF0aW9uXCIgdHlwZT1cImJ1dHRvblwiIHRhYmluZGV4PVwiLTFcIj4nICtcblx0XHRcdFx0XHRcdChpY29uID8gJzxpIGNsYXNzPVwiJyArIGljb24gKyAnXCInICsgaW1hZ2UgKyAnPjwvaT4nIDogJycpICtcblx0XHRcdFx0XHRcdHRleHRIdG1sICtcblx0XHRcdFx0XHRcdCcgPGkgY2xhc3M9XCInICsgcHJlZml4ICsgJ2NhcmV0XCI+PC9pPicgK1xuXHRcdFx0XHRcdCc8L2J1dHRvbj4nICtcblx0XHRcdFx0JzwvZGl2Pidcblx0XHRcdCk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIEdldHMgaW52b2tlZCBhZnRlciB0aGUgY29udHJvbCBoYXMgYmVlbiByZW5kZXJlZC5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgcG9zdFJlbmRlclxuXHRcdCAqL1xuXHRcdHBvc3RSZW5kZXI6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHRzZWxmLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0aWYgKGUuY29udHJvbCA9PT0gc2VsZiAmJiBpc0NoaWxkT2YoZS50YXJnZXQsIHNlbGYuZ2V0RWwoKSkpIHtcblx0XHRcdFx0XHRzZWxmLnNob3dNZW51KCk7XG5cblx0XHRcdFx0XHRpZiAoZS5hcmlhKSB7XG5cdFx0XHRcdFx0XHRzZWxmLm1lbnUuaXRlbXMoKS5maWx0ZXIoJzp2aXNpYmxlJylbMF0uZm9jdXMoKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRzZWxmLm9uKCdtb3VzZWVudGVyJywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHR2YXIgb3ZlckN0cmwgPSBlLmNvbnRyb2wsIHBhcmVudCA9IHNlbGYucGFyZW50KCksIGhhc1Zpc2libGVTaWJsaW5nTWVudTtcblxuXHRcdFx0XHRpZiAob3ZlckN0cmwgJiYgcGFyZW50ICYmIG92ZXJDdHJsIGluc3RhbmNlb2YgTWVudUJ1dHRvbiAmJiBvdmVyQ3RybC5wYXJlbnQoKSA9PSBwYXJlbnQpIHtcblx0XHRcdFx0XHRwYXJlbnQuaXRlbXMoKS5maWx0ZXIoJ01lbnVCdXR0b24nKS5lYWNoKGZ1bmN0aW9uKGN0cmwpIHtcblx0XHRcdFx0XHRcdGlmIChjdHJsLmhpZGVNZW51ICYmIGN0cmwgIT0gb3ZlckN0cmwpIHtcblx0XHRcdFx0XHRcdFx0aWYgKGN0cmwubWVudSAmJiBjdHJsLm1lbnUudmlzaWJsZSgpKSB7XG5cdFx0XHRcdFx0XHRcdFx0aGFzVmlzaWJsZVNpYmxpbmdNZW51ID0gdHJ1ZTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdGN0cmwuaGlkZU1lbnUoKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdGlmIChoYXNWaXNpYmxlU2libGluZ01lbnUpIHtcblx0XHRcdFx0XHRcdG92ZXJDdHJsLmZvY3VzKCk7IC8vIEZpeCBmb3I6ICM1ODg3XG5cdFx0XHRcdFx0XHRvdmVyQ3RybC5zaG93TWVudSgpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdHJldHVybiBzZWxmLl9zdXBlcigpO1xuXHRcdH0sXG5cblx0XHRiaW5kU3RhdGVzOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0c2VsZi5zdGF0ZS5vbignY2hhbmdlOm1lbnUnLCBmdW5jdGlvbigpIHtcblx0XHRcdFx0aWYgKHNlbGYubWVudSkge1xuXHRcdFx0XHRcdHNlbGYubWVudS5yZW1vdmUoKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHNlbGYubWVudSA9IG51bGw7XG5cdFx0XHR9KTtcblxuXHRcdFx0cmV0dXJuIHNlbGYuX3N1cGVyKCk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFJlbW92ZXMgdGhlIGNvbnRyb2wgYW5kIGl0J3MgbWVudXMuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHJlbW92ZVxuXHRcdCAqL1xuXHRcdHJlbW92ZTogZnVuY3Rpb24oKSB7XG5cdFx0XHR0aGlzLl9zdXBlcigpO1xuXG5cdFx0XHRpZiAodGhpcy5tZW51KSB7XG5cdFx0XHRcdHRoaXMubWVudS5yZW1vdmUoKTtcblx0XHRcdH1cblx0XHR9XG5cdH0pO1xuXG5cdHJldHVybiBNZW51QnV0dG9uO1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy91aS9NZW51SXRlbS5qc1xuXG4vKipcbiAqIE1lbnVJdGVtLmpzXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgTEdQTCBMaWNlbnNlLlxuICogQ29weXJpZ2h0IChjKSAxOTk5LTIwMTUgRXBob3ggQ29ycC4gQWxsIHJpZ2h0cyByZXNlcnZlZFxuICpcbiAqIExpY2Vuc2U6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vbGljZW5zZVxuICogQ29udHJpYnV0aW5nOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2NvbnRyaWJ1dGluZ1xuICovXG5cbi8qKlxuICogQ3JlYXRlcyBhIG5ldyBtZW51IGl0ZW0uXG4gKlxuICogQC14LWxlc3MgTWVudUl0ZW0ubGVzc1xuICogQGNsYXNzIHRpbnltY2UudWkuTWVudUl0ZW1cbiAqIEBleHRlbmRzIHRpbnltY2UudWkuQ29udHJvbFxuICovXG5kZWZpbmUoXCJ0aW55bWNlL3VpL01lbnVJdGVtXCIsIFtcblx0XCJ0aW55bWNlL3VpL1dpZGdldFwiLFxuXHRcInRpbnltY2UvdWkvRmFjdG9yeVwiLFxuXHRcInRpbnltY2UvRW52XCIsXG5cdFwidGlueW1jZS91dGlsL0RlbGF5XCJcbl0sIGZ1bmN0aW9uKFdpZGdldCwgRmFjdG9yeSwgRW52LCBEZWxheSkge1xuXHRcInVzZSBzdHJpY3RcIjtcblxuXHRyZXR1cm4gV2lkZ2V0LmV4dGVuZCh7XG5cdFx0RGVmYXVsdHM6IHtcblx0XHRcdGJvcmRlcjogMCxcblx0XHRcdHJvbGU6ICdtZW51aXRlbSdcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogQ29uc3RydWN0cyBhIGluc3RhbmNlIHdpdGggdGhlIHNwZWNpZmllZCBzZXR0aW5ncy5cblx0XHQgKlxuXHRcdCAqIEBjb25zdHJ1Y3RvclxuXHRcdCAqIEBwYXJhbSB7T2JqZWN0fSBzZXR0aW5ncyBOYW1lL3ZhbHVlIG9iamVjdCB3aXRoIHNldHRpbmdzLlxuXHRcdCAqIEBzZXR0aW5nIHtCb29sZWFufSBzZWxlY3RhYmxlIFNlbGVjdGFibGUgbWVudS5cblx0XHQgKiBAc2V0dGluZyB7QXJyYXl9IG1lbnUgU3VibWVudSBhcnJheSB3aXRoIGl0ZW1zLlxuXHRcdCAqIEBzZXR0aW5nIHtTdHJpbmd9IHNob3J0Y3V0IFNob3J0Y3V0IHRvIGRpc3BsYXkgZm9yIG1lbnUgaXRlbS4gRXhhbXBsZTogQ3RybCtYXG5cdFx0ICovXG5cdFx0aW5pdDogZnVuY3Rpb24oc2V0dGluZ3MpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgdGV4dDtcblxuXHRcdFx0c2VsZi5fc3VwZXIoc2V0dGluZ3MpO1xuXG5cdFx0XHRzZXR0aW5ncyA9IHNlbGYuc2V0dGluZ3M7XG5cblx0XHRcdHNlbGYuY2xhc3Nlcy5hZGQoJ21lbnUtaXRlbScpO1xuXG5cdFx0XHRpZiAoc2V0dGluZ3MubWVudSkge1xuXHRcdFx0XHRzZWxmLmNsYXNzZXMuYWRkKCdtZW51LWl0ZW0tZXhwYW5kJyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChzZXR0aW5ncy5wcmV2aWV3KSB7XG5cdFx0XHRcdHNlbGYuY2xhc3Nlcy5hZGQoJ21lbnUtaXRlbS1wcmV2aWV3Jyk7XG5cdFx0XHR9XG5cblx0XHRcdHRleHQgPSBzZWxmLnN0YXRlLmdldCgndGV4dCcpO1xuXHRcdFx0aWYgKHRleHQgPT09ICctJyB8fCB0ZXh0ID09PSAnfCcpIHtcblx0XHRcdFx0c2VsZi5jbGFzc2VzLmFkZCgnbWVudS1pdGVtLXNlcCcpO1xuXHRcdFx0XHRzZWxmLmFyaWEoJ3JvbGUnLCAnc2VwYXJhdG9yJyk7XG5cdFx0XHRcdHNlbGYuc3RhdGUuc2V0KCd0ZXh0JywgJy0nKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHNldHRpbmdzLnNlbGVjdGFibGUpIHtcblx0XHRcdFx0c2VsZi5hcmlhKCdyb2xlJywgJ21lbnVpdGVtY2hlY2tib3gnKTtcblx0XHRcdFx0c2VsZi5jbGFzc2VzLmFkZCgnbWVudS1pdGVtLWNoZWNrYm94Jyk7XG5cdFx0XHRcdHNldHRpbmdzLmljb24gPSAnc2VsZWN0ZWQnO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoIXNldHRpbmdzLnByZXZpZXcgJiYgIXNldHRpbmdzLnNlbGVjdGFibGUpIHtcblx0XHRcdFx0c2VsZi5jbGFzc2VzLmFkZCgnbWVudS1pdGVtLW5vcm1hbCcpO1xuXHRcdFx0fVxuXG5cdFx0XHRzZWxmLm9uKCdtb3VzZWRvd24nLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdH0pO1xuXG5cdFx0XHRpZiAoc2V0dGluZ3MubWVudSAmJiAhc2V0dGluZ3MuYXJpYUhpZGVNZW51KSB7XG5cdFx0XHRcdHNlbGYuYXJpYSgnaGFzcG9wdXAnLCB0cnVlKTtcblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyB0cnVlL2ZhbHNlIGlmIHRoZSBtZW51aXRlbSBoYXMgc3ViIG1lbnUuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGhhc01lbnVzXG5cdFx0ICogQHJldHVybiB7Qm9vbGVhbn0gVHJ1ZS9mYWxzZSBzdGF0ZSBpZiBpdCBoYXMgc3VibWVudS5cblx0XHQgKi9cblx0XHRoYXNNZW51czogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gISF0aGlzLnNldHRpbmdzLm1lbnU7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFNob3dzIHRoZSBtZW51IGZvciB0aGUgbWVudSBpdGVtLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBzaG93TWVudVxuXHRcdCAqL1xuXHRcdHNob3dNZW51OiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgc2V0dGluZ3MgPSBzZWxmLnNldHRpbmdzLCBtZW51LCBwYXJlbnQgPSBzZWxmLnBhcmVudCgpO1xuXG5cdFx0XHRwYXJlbnQuaXRlbXMoKS5lYWNoKGZ1bmN0aW9uKGN0cmwpIHtcblx0XHRcdFx0aWYgKGN0cmwgIT09IHNlbGYpIHtcblx0XHRcdFx0XHRjdHJsLmhpZGVNZW51KCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRpZiAoc2V0dGluZ3MubWVudSkge1xuXHRcdFx0XHRtZW51ID0gc2VsZi5tZW51O1xuXG5cdFx0XHRcdGlmICghbWVudSkge1xuXHRcdFx0XHRcdG1lbnUgPSBzZXR0aW5ncy5tZW51O1xuXG5cdFx0XHRcdFx0Ly8gSXMgbWVudSBhcnJheSB0aGVuIGF1dG8gY29uc3R1Y3QgbWVudSBjb250cm9sXG5cdFx0XHRcdFx0aWYgKG1lbnUubGVuZ3RoKSB7XG5cdFx0XHRcdFx0XHRtZW51ID0ge1xuXHRcdFx0XHRcdFx0XHR0eXBlOiAnbWVudScsXG5cdFx0XHRcdFx0XHRcdGl0ZW1zOiBtZW51XG5cdFx0XHRcdFx0XHR9O1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRtZW51LnR5cGUgPSBtZW51LnR5cGUgfHwgJ21lbnUnO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmIChwYXJlbnQuc2V0dGluZ3MuaXRlbURlZmF1bHRzKSB7XG5cdFx0XHRcdFx0XHRtZW51Lml0ZW1EZWZhdWx0cyA9IHBhcmVudC5zZXR0aW5ncy5pdGVtRGVmYXVsdHM7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0bWVudSA9IHNlbGYubWVudSA9IEZhY3RvcnkuY3JlYXRlKG1lbnUpLnBhcmVudChzZWxmKS5yZW5kZXJUbygpO1xuXHRcdFx0XHRcdG1lbnUucmVmbG93KCk7XG5cdFx0XHRcdFx0bWVudS5vbignY2FuY2VsJywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRcdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHRcdFx0XHRcdHNlbGYuZm9jdXMoKTtcblx0XHRcdFx0XHRcdG1lbnUuaGlkZSgpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdG1lbnUub24oJ3Nob3cgaGlkZScsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0XHRcdGlmIChlLmNvbnRyb2wuaXRlbXMpIHtcblx0XHRcdFx0XHRcdFx0ZS5jb250cm9sLml0ZW1zKCkuZWFjaChmdW5jdGlvbihjdHJsKSB7XG5cdFx0XHRcdFx0XHRcdFx0Y3RybC5hY3RpdmUoY3RybC5zZXR0aW5ncy5zZWxlY3RlZCk7XG5cdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pLmZpcmUoJ3Nob3cnKTtcblxuXHRcdFx0XHRcdG1lbnUub24oJ2hpZGUnLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdFx0XHRpZiAoZS5jb250cm9sID09PSBtZW51KSB7XG5cdFx0XHRcdFx0XHRcdHNlbGYuY2xhc3Nlcy5yZW1vdmUoJ3NlbGVjdGVkJyk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRtZW51LnN1Ym1lbnUgPSB0cnVlO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG1lbnUuc2hvdygpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0bWVudS5fcGFyZW50TWVudSA9IHBhcmVudDtcblxuXHRcdFx0XHRtZW51LmNsYXNzZXMuYWRkKCdtZW51LXN1YicpO1xuXG5cdFx0XHRcdHZhciByZWwgPSBtZW51LnRlc3RNb3ZlUmVsKFxuXHRcdFx0XHRcdHNlbGYuZ2V0RWwoKSxcblx0XHRcdFx0XHRzZWxmLmlzUnRsKCkgPyBbJ3RsLXRyJywgJ2JsLWJyJywgJ3RyLXRsJywgJ2JyLWJsJ10gOiBbJ3RyLXRsJywgJ2JyLWJsJywgJ3RsLXRyJywgJ2JsLWJyJ11cblx0XHRcdFx0KTtcblxuXHRcdFx0XHRtZW51Lm1vdmVSZWwoc2VsZi5nZXRFbCgpLCByZWwpO1xuXHRcdFx0XHRtZW51LnJlbCA9IHJlbDtcblxuXHRcdFx0XHRyZWwgPSAnbWVudS1zdWItJyArIHJlbDtcblx0XHRcdFx0bWVudS5jbGFzc2VzLnJlbW92ZShtZW51Ll9sYXN0UmVsKS5hZGQocmVsKTtcblx0XHRcdFx0bWVudS5fbGFzdFJlbCA9IHJlbDtcblxuXHRcdFx0XHRzZWxmLmNsYXNzZXMuYWRkKCdzZWxlY3RlZCcpO1xuXHRcdFx0XHRzZWxmLmFyaWEoJ2V4cGFuZGVkJywgdHJ1ZSk7XG5cdFx0XHR9XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIEhpZGVzIHRoZSBtZW51IGZvciB0aGUgbWVudSBpdGVtLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBoaWRlTWVudVxuXHRcdCAqL1xuXHRcdGhpZGVNZW51OiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0aWYgKHNlbGYubWVudSkge1xuXHRcdFx0XHRzZWxmLm1lbnUuaXRlbXMoKS5lYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcblx0XHRcdFx0XHRpZiAoaXRlbS5oaWRlTWVudSkge1xuXHRcdFx0XHRcdFx0aXRlbS5oaWRlTWVudSgpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0c2VsZi5tZW51LmhpZGUoKTtcblx0XHRcdFx0c2VsZi5hcmlhKCdleHBhbmRlZCcsIGZhbHNlKTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHNlbGY7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFJlbmRlcnMgdGhlIGNvbnRyb2wgYXMgYSBIVE1MIHN0cmluZy5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgcmVuZGVySHRtbFxuXHRcdCAqIEByZXR1cm4ge1N0cmluZ30gSFRNTCByZXByZXNlbnRpbmcgdGhlIGNvbnRyb2wuXG5cdFx0ICovXG5cdFx0cmVuZGVySHRtbDogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIGlkID0gc2VsZi5faWQsIHNldHRpbmdzID0gc2VsZi5zZXR0aW5ncywgcHJlZml4ID0gc2VsZi5jbGFzc1ByZWZpeCwgdGV4dCA9IHNlbGYuc3RhdGUuZ2V0KCd0ZXh0Jyk7XG5cdFx0XHR2YXIgaWNvbiA9IHNlbGYuc2V0dGluZ3MuaWNvbiwgaW1hZ2UgPSAnJywgc2hvcnRjdXQgPSBzZXR0aW5ncy5zaG9ydGN1dDtcblx0XHRcdHZhciB1cmwgPSBzZWxmLmVuY29kZShzZXR0aW5ncy51cmwpLCBpY29uSHRtbCA9ICcnO1xuXG5cdFx0XHQvLyBDb252ZXJ0cyBzaG9ydGN1dCBmb3JtYXQgdG8gTWFjL1BDIHZhcmlhbnRzXG5cdFx0XHRmdW5jdGlvbiBjb252ZXJ0U2hvcnRjdXQoc2hvcnRjdXQpIHtcblx0XHRcdFx0dmFyIGksIHZhbHVlLCByZXBsYWNlID0ge307XG5cblx0XHRcdFx0aWYgKEVudi5tYWMpIHtcblx0XHRcdFx0XHRyZXBsYWNlID0ge1xuXHRcdFx0XHRcdFx0YWx0OiAnJiN4MjMyNTsnLFxuXHRcdFx0XHRcdFx0Y3RybDogJyYjeDIzMTg7Jyxcblx0XHRcdFx0XHRcdHNoaWZ0OiAnJiN4MjFFNzsnLFxuXHRcdFx0XHRcdFx0bWV0YTogJyYjeDIzMTg7J1xuXHRcdFx0XHRcdH07XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0cmVwbGFjZSA9IHtcblx0XHRcdFx0XHRcdG1ldGE6ICdDdHJsJ1xuXHRcdFx0XHRcdH07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRzaG9ydGN1dCA9IHNob3J0Y3V0LnNwbGl0KCcrJyk7XG5cblx0XHRcdFx0Zm9yIChpID0gMDsgaSA8IHNob3J0Y3V0Lmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRcdFx0dmFsdWUgPSByZXBsYWNlW3Nob3J0Y3V0W2ldLnRvTG93ZXJDYXNlKCldO1xuXG5cdFx0XHRcdFx0aWYgKHZhbHVlKSB7XG5cdFx0XHRcdFx0XHRzaG9ydGN1dFtpXSA9IHZhbHVlO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBzaG9ydGN1dC5qb2luKCcrJyk7XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIGVzY2FwZVJlZ0V4cChzdHIpIHtcblx0XHRcdFx0cmV0dXJuIHN0ci5yZXBsYWNlKC9bLiorP14ke30oKXxbXFxdXFxcXF0vZywgXCJcXFxcJCZcIik7XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIG1hcmtNYXRjaGVzKHRleHQpIHtcblx0XHRcdFx0dmFyIG1hdGNoID0gc2V0dGluZ3MubWF0Y2ggfHwgJyc7XG5cblx0XHRcdFx0cmV0dXJuIG1hdGNoID8gdGV4dC5yZXBsYWNlKG5ldyBSZWdFeHAoZXNjYXBlUmVnRXhwKG1hdGNoKSwgJ2dpJyksIGZ1bmN0aW9uIChtYXRjaCkge1xuXHRcdFx0XHRcdHJldHVybiAnIW1jZX5tYXRjaFsnICsgbWF0Y2ggKyAnXW1jZX5tYXRjaCEnO1xuXHRcdFx0XHR9KSA6IHRleHQ7XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIGJvbGRNYXRjaGVzKHRleHQpIHtcblx0XHRcdFx0cmV0dXJuIHRleHQuXG5cdFx0XHRcdFx0cmVwbGFjZShuZXcgUmVnRXhwKGVzY2FwZVJlZ0V4cCgnIW1jZX5tYXRjaFsnKSwgJ2cnKSwgJzxiPicpLlxuXHRcdFx0XHRcdHJlcGxhY2UobmV3IFJlZ0V4cChlc2NhcGVSZWdFeHAoJ11tY2V+bWF0Y2ghJyksICdnJyksICc8L2I+Jyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChpY29uKSB7XG5cdFx0XHRcdHNlbGYucGFyZW50KCkuY2xhc3Nlcy5hZGQoJ21lbnUtaGFzLWljb25zJyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChzZXR0aW5ncy5pbWFnZSkge1xuXHRcdFx0XHRpbWFnZSA9ICcgc3R5bGU9XCJiYWNrZ3JvdW5kLWltYWdlOiB1cmwoXFwnJyArIHNldHRpbmdzLmltYWdlICsgJ1xcJylcIic7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChzaG9ydGN1dCkge1xuXHRcdFx0XHRzaG9ydGN1dCA9IGNvbnZlcnRTaG9ydGN1dChzaG9ydGN1dCk7XG5cdFx0XHR9XG5cblx0XHRcdGljb24gPSBwcmVmaXggKyAnaWNvICcgKyBwcmVmaXggKyAnaS0nICsgKHNlbGYuc2V0dGluZ3MuaWNvbiB8fCAnbm9uZScpO1xuXHRcdFx0aWNvbkh0bWwgPSAodGV4dCAhPT0gJy0nID8gJzxpIGNsYXNzPVwiJyArIGljb24gKyAnXCInICsgaW1hZ2UgKyAnPjwvaT5cXHUwMGEwJyA6ICcnKTtcblxuXHRcdFx0dGV4dCA9IGJvbGRNYXRjaGVzKHNlbGYuZW5jb2RlKG1hcmtNYXRjaGVzKHRleHQpKSk7XG5cdFx0XHR1cmwgPSBib2xkTWF0Y2hlcyhzZWxmLmVuY29kZShtYXJrTWF0Y2hlcyh1cmwpKSk7XG5cblx0XHRcdHJldHVybiAoXG5cdFx0XHRcdCc8ZGl2IGlkPVwiJyArIGlkICsgJ1wiIGNsYXNzPVwiJyArIHNlbGYuY2xhc3NlcyArICdcIiB0YWJpbmRleD1cIi0xXCI+JyArXG5cdFx0XHRcdFx0aWNvbkh0bWwgK1xuXHRcdFx0XHRcdCh0ZXh0ICE9PSAnLScgPyAnPHNwYW4gaWQ9XCInICsgaWQgKyAnLXRleHRcIiBjbGFzcz1cIicgKyBwcmVmaXggKyAndGV4dFwiPicgKyB0ZXh0ICsgJzwvc3Bhbj4nIDogJycpICtcblx0XHRcdFx0XHQoc2hvcnRjdXQgPyAnPGRpdiBpZD1cIicgKyBpZCArICctc2hvcnRjdXRcIiBjbGFzcz1cIicgKyBwcmVmaXggKyAnbWVudS1zaG9ydGN1dFwiPicgKyBzaG9ydGN1dCArICc8L2Rpdj4nIDogJycpICtcblx0XHRcdFx0XHQoc2V0dGluZ3MubWVudSA/ICc8ZGl2IGNsYXNzPVwiJyArIHByZWZpeCArICdjYXJldFwiPjwvZGl2PicgOiAnJykgK1xuXHRcdFx0XHRcdCh1cmwgPyAnPGRpdiBjbGFzcz1cIicgKyBwcmVmaXggKyAnbWVudS1pdGVtLWxpbmtcIj4nICsgdXJsICsgJzwvZGl2PicgOiAnJykgK1xuXHRcdFx0XHQnPC9kaXY+J1xuXHRcdFx0KTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogR2V0cyBpbnZva2VkIGFmdGVyIHRoZSBjb250cm9sIGhhcyBiZWVuIHJlbmRlcmVkLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBwb3N0UmVuZGVyXG5cdFx0ICovXG5cdFx0cG9zdFJlbmRlcjogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIHNldHRpbmdzID0gc2VsZi5zZXR0aW5ncztcblxuXHRcdFx0dmFyIHRleHRTdHlsZSA9IHNldHRpbmdzLnRleHRTdHlsZTtcblx0XHRcdGlmICh0eXBlb2YgdGV4dFN0eWxlID09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHR0ZXh0U3R5bGUgPSB0ZXh0U3R5bGUuY2FsbCh0aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHRleHRTdHlsZSkge1xuXHRcdFx0XHR2YXIgdGV4dEVsbSA9IHNlbGYuZ2V0RWwoJ3RleHQnKTtcblx0XHRcdFx0aWYgKHRleHRFbG0pIHtcblx0XHRcdFx0XHR0ZXh0RWxtLnNldEF0dHJpYnV0ZSgnc3R5bGUnLCB0ZXh0U3R5bGUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHNlbGYub24oJ21vdXNlZW50ZXIgY2xpY2snLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdGlmIChlLmNvbnRyb2wgPT09IHNlbGYpIHtcblx0XHRcdFx0XHRpZiAoIXNldHRpbmdzLm1lbnUgJiYgZS50eXBlID09PSAnY2xpY2snKSB7XG5cdFx0XHRcdFx0XHRzZWxmLmZpcmUoJ3NlbGVjdCcpO1xuXG5cdFx0XHRcdFx0XHQvLyBFZGdlIHdpbGwgY3Jhc2ggaWYgeW91IHN0cmVzcyBpdCBzZWUgIzI2NjBcblx0XHRcdFx0XHRcdERlbGF5LnJlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRcdFx0c2VsZi5wYXJlbnQoKS5oaWRlQWxsKCk7XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0c2VsZi5zaG93TWVudSgpO1xuXG5cdFx0XHRcdFx0XHRpZiAoZS5hcmlhKSB7XG5cdFx0XHRcdFx0XHRcdHNlbGYubWVudS5mb2N1cyh0cnVlKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRzZWxmLl9zdXBlcigpO1xuXG5cdFx0XHRyZXR1cm4gc2VsZjtcblx0XHR9LFxuXG5cdFx0aG92ZXI6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHRzZWxmLnBhcmVudCgpLml0ZW1zKCkuZWFjaChmdW5jdGlvbihjdHJsKSB7XG5cdFx0XHRcdGN0cmwuY2xhc3Nlcy5yZW1vdmUoJ3NlbGVjdGVkJyk7XG5cdFx0XHR9KTtcblxuXHRcdFx0c2VsZi5jbGFzc2VzLnRvZ2dsZSgnc2VsZWN0ZWQnLCB0cnVlKTtcblxuXHRcdFx0cmV0dXJuIHNlbGY7XG5cdFx0fSxcblxuXHRcdGFjdGl2ZTogZnVuY3Rpb24oc3RhdGUpIHtcblx0XHRcdGlmICh0eXBlb2Ygc3RhdGUgIT0gXCJ1bmRlZmluZWRcIikge1xuXHRcdFx0XHR0aGlzLmFyaWEoJ2NoZWNrZWQnLCBzdGF0ZSk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiB0aGlzLl9zdXBlcihzdGF0ZSk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFJlbW92ZXMgdGhlIGNvbnRyb2wgYW5kIGl0J3MgbWVudXMuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHJlbW92ZVxuXHRcdCAqL1xuXHRcdHJlbW92ZTogZnVuY3Rpb24oKSB7XG5cdFx0XHR0aGlzLl9zdXBlcigpO1xuXG5cdFx0XHRpZiAodGhpcy5tZW51KSB7XG5cdFx0XHRcdHRoaXMubWVudS5yZW1vdmUoKTtcblx0XHRcdH1cblx0XHR9XG5cdH0pO1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy91aS9UaHJvYmJlci5qc1xuXG4vKipcbiAqIFRocm9iYmVyLmpzXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgTEdQTCBMaWNlbnNlLlxuICogQ29weXJpZ2h0IChjKSAxOTk5LTIwMTUgRXBob3ggQ29ycC4gQWxsIHJpZ2h0cyByZXNlcnZlZFxuICpcbiAqIExpY2Vuc2U6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vbGljZW5zZVxuICogQ29udHJpYnV0aW5nOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2NvbnRyaWJ1dGluZ1xuICovXG5cbi8qKlxuICogVGhpcyBjbGFzcyBlbmFibGVzIHlvdSB0byBkaXNwbGF5IGEgVGhyb2JiZXIgZm9yIGFueSBlbGVtZW50LlxuICpcbiAqIEAteC1sZXNzIFRocm9iYmVyLmxlc3NcbiAqIEBjbGFzcyB0aW55bWNlLnVpLlRocm9iYmVyXG4gKi9cbmRlZmluZShcInRpbnltY2UvdWkvVGhyb2JiZXJcIiwgW1xuXHRcInRpbnltY2UvZG9tL0RvbVF1ZXJ5XCIsXG5cdFwidGlueW1jZS91aS9Db250cm9sXCIsXG5cdFwidGlueW1jZS91dGlsL0RlbGF5XCJcbl0sIGZ1bmN0aW9uKCQsIENvbnRyb2wsIERlbGF5KSB7XG5cdFwidXNlIHN0cmljdFwiO1xuXG5cdC8qKlxuXHQgKiBDb25zdHJ1Y3RzIGEgbmV3IHRocm9iYmVyLlxuXHQgKlxuXHQgKiBAY29uc3RydWN0b3Jcblx0ICogQHBhcmFtIHtFbGVtZW50fSBlbG0gRE9NIEh0bWwgZWxlbWVudCB0byBkaXNwbGF5IHRocm9iYmVyIGluLlxuXHQgKiBAcGFyYW0ge0Jvb2xlYW59IGlubGluZSBPcHRpb25hbCB0cnVlL2ZhbHNlIHN0YXRlIGlmIHRoZSB0aHJvYmJlciBzaG91bGQgYmUgYXBwZW5kZWQgdG8gZW5kIG9mIGVsZW1lbnQgZm9yIGluZmluaXRlIHNjcm9sbC5cblx0ICovXG5cdHJldHVybiBmdW5jdGlvbihlbG0sIGlubGluZSkge1xuXHRcdHZhciBzZWxmID0gdGhpcywgc3RhdGUsIGNsYXNzUHJlZml4ID0gQ29udHJvbC5jbGFzc1ByZWZpeCwgdGltZXI7XG5cblx0XHQvKipcblx0XHQgKiBTaG93cyB0aGUgdGhyb2JiZXIuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHNob3dcblx0XHQgKiBAcGFyYW0ge051bWJlcn0gW3RpbWVdIFRpbWUgdG8gd2FpdCBiZWZvcmUgc2hvd2luZy5cblx0XHQgKiBAcGFyYW0ge2Z1bmN0aW9ufSBbY2FsbGJhY2tdIE9wdGlvbmFsIGNhbGxiYWNrIHRvIGV4ZWN1dGUgd2hlbiB0aGUgdGhyb2JiZXIgaXMgc2hvd24uXG5cdFx0ICogQHJldHVybiB7dGlueW1jZS51aS5UaHJvYmJlcn0gQ3VycmVudCB0aHJvYmJlciBpbnN0YW5jZS5cblx0XHQgKi9cblx0XHRzZWxmLnNob3cgPSBmdW5jdGlvbih0aW1lLCBjYWxsYmFjaykge1xuXHRcdFx0ZnVuY3Rpb24gcmVuZGVyKCkge1xuXHRcdFx0XHRcdGlmIChzdGF0ZSkge1xuXHRcdFx0XHRcdFx0JChlbG0pLmFwcGVuZChcblx0XHRcdFx0XHRcdFx0JzxkaXYgY2xhc3M9XCInICsgY2xhc3NQcmVmaXggKyAndGhyb2JiZXInICsgKGlubGluZSA/ICcgJyArIGNsYXNzUHJlZml4ICsgJ3Rocm9iYmVyLWlubGluZScgOiAnJykgKyAnXCI+PC9kaXY+J1xuXHRcdFx0XHRcdFx0KTtcblxuXHRcdFx0XHRcdFx0aWYgKGNhbGxiYWNrKSB7XG5cdFx0XHRcdFx0XHRcdGNhbGxiYWNrKCk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRzZWxmLmhpZGUoKTtcblxuXHRcdFx0c3RhdGUgPSB0cnVlO1xuXG5cdFx0XHRpZiAodGltZSkge1xuXHRcdFx0XHR0aW1lciA9IERlbGF5LnNldFRpbWVvdXQocmVuZGVyLCB0aW1lKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHJlbmRlcigpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gc2VsZjtcblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogSGlkZXMgdGhlIHRocm9iYmVyLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBoaWRlXG5cdFx0ICogQHJldHVybiB7dGlueW1jZS51aS5UaHJvYmJlcn0gQ3VycmVudCB0aHJvYmJlciBpbnN0YW5jZS5cblx0XHQgKi9cblx0XHRzZWxmLmhpZGUgPSBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBjaGlsZCA9IGVsbS5sYXN0Q2hpbGQ7XG5cblx0XHRcdERlbGF5LmNsZWFyVGltZW91dCh0aW1lcik7XG5cblx0XHRcdGlmIChjaGlsZCAmJiBjaGlsZC5jbGFzc05hbWUuaW5kZXhPZigndGhyb2JiZXInKSAhPSAtMSkge1xuXHRcdFx0XHRjaGlsZC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGNoaWxkKTtcblx0XHRcdH1cblxuXHRcdFx0c3RhdGUgPSBmYWxzZTtcblxuXHRcdFx0cmV0dXJuIHNlbGY7XG5cdFx0fTtcblx0fTtcbn0pO1xuXG4vLyBJbmNsdWRlZCBmcm9tOiBqcy90aW55bWNlL2NsYXNzZXMvdWkvTWVudS5qc1xuXG4vKipcbiAqIE1lbnUuanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBDcmVhdGVzIGEgbmV3IG1lbnUuXG4gKlxuICogQC14LWxlc3MgTWVudS5sZXNzXG4gKiBAY2xhc3MgdGlueW1jZS51aS5NZW51XG4gKiBAZXh0ZW5kcyB0aW55bWNlLnVpLkZsb2F0UGFuZWxcbiAqL1xuZGVmaW5lKFwidGlueW1jZS91aS9NZW51XCIsIFtcblx0XCJ0aW55bWNlL3VpL0Zsb2F0UGFuZWxcIixcblx0XCJ0aW55bWNlL3VpL01lbnVJdGVtXCIsXG5cdFwidGlueW1jZS91aS9UaHJvYmJlclwiLFxuXHRcInRpbnltY2UvdXRpbC9Ub29sc1wiXG5dLCBmdW5jdGlvbihGbG9hdFBhbmVsLCBNZW51SXRlbSwgVGhyb2JiZXIsIFRvb2xzKSB7XG5cdFwidXNlIHN0cmljdFwiO1xuXG5cdHJldHVybiBGbG9hdFBhbmVsLmV4dGVuZCh7XG5cdFx0RGVmYXVsdHM6IHtcblx0XHRcdGRlZmF1bHRUeXBlOiAnbWVudWl0ZW0nLFxuXHRcdFx0Ym9yZGVyOiAxLFxuXHRcdFx0bGF5b3V0OiAnc3RhY2snLFxuXHRcdFx0cm9sZTogJ2FwcGxpY2F0aW9uJyxcblx0XHRcdGJvZHlSb2xlOiAnbWVudScsXG5cdFx0XHRhcmlhUm9vdDogdHJ1ZVxuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBDb25zdHJ1Y3RzIGEgaW5zdGFuY2Ugd2l0aCB0aGUgc3BlY2lmaWVkIHNldHRpbmdzLlxuXHRcdCAqXG5cdFx0ICogQGNvbnN0cnVjdG9yXG5cdFx0ICogQHBhcmFtIHtPYmplY3R9IHNldHRpbmdzIE5hbWUvdmFsdWUgb2JqZWN0IHdpdGggc2V0dGluZ3MuXG5cdFx0ICovXG5cdFx0aW5pdDogZnVuY3Rpb24oc2V0dGluZ3MpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0c2V0dGluZ3MuYXV0b2hpZGUgPSB0cnVlO1xuXHRcdFx0c2V0dGluZ3MuY29uc3RyYWluVG9WaWV3cG9ydCA9IHRydWU7XG5cblx0XHRcdGlmICh0eXBlb2Ygc2V0dGluZ3MuaXRlbXMgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0c2V0dGluZ3MuaXRlbXNGYWN0b3J5ID0gc2V0dGluZ3MuaXRlbXM7XG5cdFx0XHRcdHNldHRpbmdzLml0ZW1zID0gW107XG5cdFx0XHR9XG5cblx0XHRcdGlmIChzZXR0aW5ncy5pdGVtRGVmYXVsdHMpIHtcblx0XHRcdFx0dmFyIGl0ZW1zID0gc2V0dGluZ3MuaXRlbXMsIGkgPSBpdGVtcy5sZW5ndGg7XG5cblx0XHRcdFx0d2hpbGUgKGktLSkge1xuXHRcdFx0XHRcdGl0ZW1zW2ldID0gVG9vbHMuZXh0ZW5kKHt9LCBzZXR0aW5ncy5pdGVtRGVmYXVsdHMsIGl0ZW1zW2ldKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRzZWxmLl9zdXBlcihzZXR0aW5ncyk7XG5cdFx0XHRzZWxmLmNsYXNzZXMuYWRkKCdtZW51Jyk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFJlcGFpbnRzIHRoZSBjb250cm9sIGFmdGVyIGEgbGF5b3V0IG9wZXJhdGlvbi5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgcmVwYWludFxuXHRcdCAqL1xuXHRcdHJlcGFpbnQ6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dGhpcy5jbGFzc2VzLnRvZ2dsZSgnbWVudS1hbGlnbicsIHRydWUpO1xuXG5cdFx0XHR0aGlzLl9zdXBlcigpO1xuXG5cdFx0XHR0aGlzLmdldEVsKCkuc3R5bGUuaGVpZ2h0ID0gJyc7XG5cdFx0XHR0aGlzLmdldEVsKCdib2R5Jykuc3R5bGUuaGVpZ2h0ID0gJyc7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBIaWRlcy9jbG9zZXMgdGhlIG1lbnUuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGNhbmNlbFxuXHRcdCAqL1xuXHRcdGNhbmNlbDogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdHNlbGYuaGlkZUFsbCgpO1xuXHRcdFx0c2VsZi5maXJlKCdzZWxlY3QnKTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogTG9hZHMgbmV3IGl0ZW1zIGZyb20gdGhlIGZhY3RvcnkgaXRlbXMgZnVuY3Rpb24uXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGxvYWRcblx0XHQgKi9cblx0XHRsb2FkOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgdGltZSwgZmFjdG9yeTtcblxuXHRcdFx0ZnVuY3Rpb24gaGlkZVRocm9iYmVyKCkge1xuXHRcdFx0XHRpZiAoc2VsZi50aHJvYmJlcikge1xuXHRcdFx0XHRcdHNlbGYudGhyb2JiZXIuaGlkZSgpO1xuXHRcdFx0XHRcdHNlbGYudGhyb2JiZXIgPSBudWxsO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGZhY3RvcnkgPSBzZWxmLnNldHRpbmdzLml0ZW1zRmFjdG9yeTtcblx0XHRcdGlmICghZmFjdG9yeSkge1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdGlmICghc2VsZi50aHJvYmJlcikge1xuXHRcdFx0XHRzZWxmLnRocm9iYmVyID0gbmV3IFRocm9iYmVyKHNlbGYuZ2V0RWwoJ2JvZHknKSwgdHJ1ZSk7XG5cblx0XHRcdFx0aWYgKHNlbGYuaXRlbXMoKS5sZW5ndGggPT09IDApIHtcblx0XHRcdFx0XHRzZWxmLnRocm9iYmVyLnNob3coKTtcblx0XHRcdFx0XHRzZWxmLmZpcmUoJ2xvYWRpbmcnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRzZWxmLnRocm9iYmVyLnNob3coMTAwLCBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRcdHNlbGYuaXRlbXMoKS5yZW1vdmUoKTtcblx0XHRcdFx0XHRcdHNlbGYuZmlyZSgnbG9hZGluZycpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0c2VsZi5vbignaGlkZSBjbG9zZScsIGhpZGVUaHJvYmJlcik7XG5cdFx0XHR9XG5cblx0XHRcdHNlbGYucmVxdWVzdFRpbWUgPSB0aW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG5cblx0XHRcdHNlbGYuc2V0dGluZ3MuaXRlbXNGYWN0b3J5KGZ1bmN0aW9uKGl0ZW1zKSB7XG5cdFx0XHRcdGlmIChpdGVtcy5sZW5ndGggPT09IDApIHtcblx0XHRcdFx0XHRzZWxmLmhpZGUoKTtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoc2VsZi5yZXF1ZXN0VGltZSAhPT0gdGltZSkge1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHNlbGYuZ2V0RWwoKS5zdHlsZS53aWR0aCA9ICcnO1xuXHRcdFx0XHRzZWxmLmdldEVsKCdib2R5Jykuc3R5bGUud2lkdGggPSAnJztcblxuXHRcdFx0XHRoaWRlVGhyb2JiZXIoKTtcblx0XHRcdFx0c2VsZi5pdGVtcygpLnJlbW92ZSgpO1xuXHRcdFx0XHRzZWxmLmdldEVsKCdib2R5JykuaW5uZXJIVE1MID0gJyc7XG5cblx0XHRcdFx0c2VsZi5hZGQoaXRlbXMpO1xuXHRcdFx0XHRzZWxmLnJlbmRlck5ldygpO1xuXHRcdFx0XHRzZWxmLmZpcmUoJ2xvYWRlZCcpO1xuXHRcdFx0fSk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIEhpZGUgbWVudSBhbmQgYWxsIHN1YiBtZW51cy5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgaGlkZUFsbFxuXHRcdCAqL1xuXHRcdGhpZGVBbGw6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHR0aGlzLmZpbmQoJ21lbnVpdGVtJykuZXhlYygnaGlkZU1lbnUnKTtcblxuXHRcdFx0cmV0dXJuIHNlbGYuX3N1cGVyKCk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIEludm9rZWQgYmVmb3JlIHRoZSBtZW51IGlzIHJlbmRlcmVkLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBwcmVSZW5kZXJcblx0XHQgKi9cblx0XHRwcmVSZW5kZXI6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHRzZWxmLml0ZW1zKCkuZWFjaChmdW5jdGlvbihjdHJsKSB7XG5cdFx0XHRcdHZhciBzZXR0aW5ncyA9IGN0cmwuc2V0dGluZ3M7XG5cblx0XHRcdFx0aWYgKHNldHRpbmdzLmljb24gfHwgc2V0dGluZ3MuaW1hZ2UgfHwgc2V0dGluZ3Muc2VsZWN0YWJsZSkge1xuXHRcdFx0XHRcdHNlbGYuX2hhc0ljb25zID0gdHJ1ZTtcblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRpZiAoc2VsZi5zZXR0aW5ncy5pdGVtc0ZhY3RvcnkpIHtcblx0XHRcdFx0c2VsZi5vbigncG9zdHJlbmRlcicsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdGlmIChzZWxmLnNldHRpbmdzLml0ZW1zRmFjdG9yeSkge1xuXHRcdFx0XHRcdFx0c2VsZi5sb2FkKCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHNlbGYuX3N1cGVyKCk7XG5cdFx0fVxuXHR9KTtcbn0pO1xuXG4vLyBJbmNsdWRlZCBmcm9tOiBqcy90aW55bWNlL2NsYXNzZXMvdWkvTGlzdEJveC5qc1xuXG4vKipcbiAqIExpc3RCb3guanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBDcmVhdGVzIGEgbmV3IGxpc3QgYm94IGNvbnRyb2wuXG4gKlxuICogQC14LWxlc3MgTGlzdEJveC5sZXNzXG4gKiBAY2xhc3MgdGlueW1jZS51aS5MaXN0Qm94XG4gKiBAZXh0ZW5kcyB0aW55bWNlLnVpLk1lbnVCdXR0b25cbiAqL1xuZGVmaW5lKFwidGlueW1jZS91aS9MaXN0Qm94XCIsIFtcblx0XCJ0aW55bWNlL3VpL01lbnVCdXR0b25cIixcblx0XCJ0aW55bWNlL3VpL01lbnVcIlxuXSwgZnVuY3Rpb24oTWVudUJ1dHRvbiwgTWVudSkge1xuXHRcInVzZSBzdHJpY3RcIjtcblxuXHRyZXR1cm4gTWVudUJ1dHRvbi5leHRlbmQoe1xuXHRcdC8qKlxuXHRcdCAqIENvbnN0cnVjdHMgYSBpbnN0YW5jZSB3aXRoIHRoZSBzcGVjaWZpZWQgc2V0dGluZ3MuXG5cdFx0ICpcblx0XHQgKiBAY29uc3RydWN0b3Jcblx0XHQgKiBAcGFyYW0ge09iamVjdH0gc2V0dGluZ3MgTmFtZS92YWx1ZSBvYmplY3Qgd2l0aCBzZXR0aW5ncy5cblx0XHQgKiBAc2V0dGluZyB7QXJyYXl9IHZhbHVlcyBBcnJheSB3aXRoIHZhbHVlcyB0byBhZGQgdG8gbGlzdCBib3guXG5cdFx0ICovXG5cdFx0aW5pdDogZnVuY3Rpb24oc2V0dGluZ3MpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgdmFsdWVzLCBzZWxlY3RlZCwgc2VsZWN0ZWRUZXh0LCBsYXN0SXRlbUN0cmw7XG5cblx0XHRcdGZ1bmN0aW9uIHNldFNlbGVjdGVkKG1lbnVWYWx1ZXMpIHtcblx0XHRcdFx0Ly8gVHJ5IHRvIGZpbmQgYSBzZWxlY3RlZCB2YWx1ZVxuXHRcdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IG1lbnVWYWx1ZXMubGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0XHRzZWxlY3RlZCA9IG1lbnVWYWx1ZXNbaV0uc2VsZWN0ZWQgfHwgc2V0dGluZ3MudmFsdWUgPT09IG1lbnVWYWx1ZXNbaV0udmFsdWU7XG5cblx0XHRcdFx0XHRpZiAoc2VsZWN0ZWQpIHtcblx0XHRcdFx0XHRcdHNlbGVjdGVkVGV4dCA9IHNlbGVjdGVkVGV4dCB8fCBtZW51VmFsdWVzW2ldLnRleHQ7XG5cdFx0XHRcdFx0XHRzZWxmLnN0YXRlLnNldCgndmFsdWUnLCBtZW51VmFsdWVzW2ldLnZhbHVlKTtcblx0XHRcdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdC8vIElmIHRoZSB2YWx1ZSBoYXMgYSBzdWJtZW51LCB0cnkgdG8gZmluZCB0aGUgc2VsZWN0ZWQgdmFsdWVzIGluIHRoYXQgbWVudVxuXHRcdFx0XHRcdGlmIChtZW51VmFsdWVzW2ldLm1lbnUpIHtcblx0XHRcdFx0XHRcdGlmIChzZXRTZWxlY3RlZChtZW51VmFsdWVzW2ldLm1lbnUpKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRzZWxmLl9zdXBlcihzZXR0aW5ncyk7XG5cdFx0XHRzZXR0aW5ncyA9IHNlbGYuc2V0dGluZ3M7XG5cblx0XHRcdHNlbGYuX3ZhbHVlcyA9IHZhbHVlcyA9IHNldHRpbmdzLnZhbHVlcztcblx0XHRcdGlmICh2YWx1ZXMpIHtcblx0XHRcdFx0aWYgKHR5cGVvZiBzZXR0aW5ncy52YWx1ZSAhPSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0XHRcdFx0c2V0U2VsZWN0ZWQodmFsdWVzKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIERlZmF1bHQgd2l0aCBmaXJzdCBpdGVtXG5cdFx0XHRcdGlmICghc2VsZWN0ZWQgJiYgdmFsdWVzLmxlbmd0aCA+IDApIHtcblx0XHRcdFx0XHRzZWxlY3RlZFRleHQgPSB2YWx1ZXNbMF0udGV4dDtcblx0XHRcdFx0XHRzZWxmLnN0YXRlLnNldCgndmFsdWUnLCB2YWx1ZXNbMF0udmFsdWUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0c2VsZi5zdGF0ZS5zZXQoJ21lbnUnLCB2YWx1ZXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRzZWxmLnN0YXRlLnNldCgndGV4dCcsIHNldHRpbmdzLnRleHQgfHwgc2VsZWN0ZWRUZXh0KTtcblxuXHRcdFx0c2VsZi5jbGFzc2VzLmFkZCgnbGlzdGJveCcpO1xuXG5cdFx0XHRzZWxmLm9uKCdzZWxlY3QnLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdHZhciBjdHJsID0gZS5jb250cm9sO1xuXG5cdFx0XHRcdGlmIChsYXN0SXRlbUN0cmwpIHtcblx0XHRcdFx0XHRlLmxhc3RDb250cm9sID0gbGFzdEl0ZW1DdHJsO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHNldHRpbmdzLm11bHRpcGxlKSB7XG5cdFx0XHRcdFx0Y3RybC5hY3RpdmUoIWN0cmwuYWN0aXZlKCkpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHNlbGYudmFsdWUoZS5jb250cm9sLnZhbHVlKCkpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0bGFzdEl0ZW1DdHJsID0gY3RybDtcblx0XHRcdH0pO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBHZXR0ZXIvc2V0dGVyIGZ1bmN0aW9uIGZvciB0aGUgY29udHJvbCB2YWx1ZS5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgdmFsdWVcblx0XHQgKiBAcGFyYW0ge1N0cmluZ30gW3ZhbHVlXSBWYWx1ZSB0byBiZSBzZXQuXG5cdFx0ICogQHJldHVybiB7Qm9vbGVhbi90aW55bWNlLnVpLkxpc3RCb3h9IFZhbHVlIG9yIHNlbGYgaWYgaXQncyBhIHNldCBvcGVyYXRpb24uXG5cdFx0ICovXG5cdFx0YmluZFN0YXRlczogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdGZ1bmN0aW9uIGFjdGl2YXRlTWVudUl0ZW1zQnlWYWx1ZShtZW51LCB2YWx1ZSkge1xuXHRcdFx0XHRpZiAobWVudSBpbnN0YW5jZW9mIE1lbnUpIHtcblx0XHRcdFx0XHRtZW51Lml0ZW1zKCkuZWFjaChmdW5jdGlvbihjdHJsKSB7XG5cdFx0XHRcdFx0XHRpZiAoIWN0cmwuaGFzTWVudXMoKSkge1xuXHRcdFx0XHRcdFx0XHRjdHJsLmFjdGl2ZShjdHJsLnZhbHVlKCkgPT09IHZhbHVlKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRmdW5jdGlvbiBnZXRTZWxlY3RlZEl0ZW0obWVudVZhbHVlcywgdmFsdWUpIHtcblx0XHRcdFx0dmFyIHNlbGVjdGVkSXRlbTtcblxuXHRcdFx0XHRpZiAoIW1lbnVWYWx1ZXMpIHtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IG1lbnVWYWx1ZXMubGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0XHRpZiAobWVudVZhbHVlc1tpXS52YWx1ZSA9PT0gdmFsdWUpIHtcblx0XHRcdFx0XHRcdHJldHVybiBtZW51VmFsdWVzW2ldO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmIChtZW51VmFsdWVzW2ldLm1lbnUpIHtcblx0XHRcdFx0XHRcdHNlbGVjdGVkSXRlbSA9IGdldFNlbGVjdGVkSXRlbShtZW51VmFsdWVzW2ldLm1lbnUsIHZhbHVlKTtcblx0XHRcdFx0XHRcdGlmIChzZWxlY3RlZEl0ZW0pIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHNlbGVjdGVkSXRlbTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0c2VsZi5vbignc2hvdycsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0YWN0aXZhdGVNZW51SXRlbXNCeVZhbHVlKGUuY29udHJvbCwgc2VsZi52YWx1ZSgpKTtcblx0XHRcdH0pO1xuXG5cdFx0XHRzZWxmLnN0YXRlLm9uKCdjaGFuZ2U6dmFsdWUnLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdHZhciBzZWxlY3RlZEl0ZW0gPSBnZXRTZWxlY3RlZEl0ZW0oc2VsZi5zdGF0ZS5nZXQoJ21lbnUnKSwgZS52YWx1ZSk7XG5cblx0XHRcdFx0aWYgKHNlbGVjdGVkSXRlbSkge1xuXHRcdFx0XHRcdHNlbGYudGV4dChzZWxlY3RlZEl0ZW0udGV4dCk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0c2VsZi50ZXh0KHNlbGYuc2V0dGluZ3MudGV4dCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRyZXR1cm4gc2VsZi5fc3VwZXIoKTtcblx0XHR9XG5cdH0pO1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy91aS9SYWRpby5qc1xuXG4vKipcbiAqIFJhZGlvLmpzXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgTEdQTCBMaWNlbnNlLlxuICogQ29weXJpZ2h0IChjKSAxOTk5LTIwMTUgRXBob3ggQ29ycC4gQWxsIHJpZ2h0cyByZXNlcnZlZFxuICpcbiAqIExpY2Vuc2U6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vbGljZW5zZVxuICogQ29udHJpYnV0aW5nOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2NvbnRyaWJ1dGluZ1xuICovXG5cbi8qKlxuICogQ3JlYXRlcyBhIG5ldyByYWRpbyBidXR0b24uXG4gKlxuICogQC14LWxlc3MgUmFkaW8ubGVzc1xuICogQGNsYXNzIHRpbnltY2UudWkuUmFkaW9cbiAqIEBleHRlbmRzIHRpbnltY2UudWkuQ2hlY2tib3hcbiAqL1xuZGVmaW5lKFwidGlueW1jZS91aS9SYWRpb1wiLCBbXG5cdFwidGlueW1jZS91aS9DaGVja2JveFwiXG5dLCBmdW5jdGlvbihDaGVja2JveCkge1xuXHRcInVzZSBzdHJpY3RcIjtcblxuXHRyZXR1cm4gQ2hlY2tib3guZXh0ZW5kKHtcblx0XHREZWZhdWx0czoge1xuXHRcdFx0Y2xhc3NlczogXCJyYWRpb1wiLFxuXHRcdFx0cm9sZTogXCJyYWRpb1wiXG5cdFx0fVxuXHR9KTtcbn0pO1xuXG4vLyBJbmNsdWRlZCBmcm9tOiBqcy90aW55bWNlL2NsYXNzZXMvdWkvUmVzaXplSGFuZGxlLmpzXG5cbi8qKlxuICogUmVzaXplSGFuZGxlLmpzXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgTEdQTCBMaWNlbnNlLlxuICogQ29weXJpZ2h0IChjKSAxOTk5LTIwMTUgRXBob3ggQ29ycC4gQWxsIHJpZ2h0cyByZXNlcnZlZFxuICpcbiAqIExpY2Vuc2U6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vbGljZW5zZVxuICogQ29udHJpYnV0aW5nOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2NvbnRyaWJ1dGluZ1xuICovXG5cbi8qKlxuICogUmVuZGVycyBhIHJlc2l6ZSBoYW5kbGUgdGhhdCBmaXJlcyBSZXNpemVTdGFydCwgUmVzaXplIGFuZCBSZXNpemVFbmQgZXZlbnRzLlxuICpcbiAqIEAteC1sZXNzIFJlc2l6ZUhhbmRsZS5sZXNzXG4gKiBAY2xhc3MgdGlueW1jZS51aS5SZXNpemVIYW5kbGVcbiAqIEBleHRlbmRzIHRpbnltY2UudWkuV2lkZ2V0XG4gKi9cbmRlZmluZShcInRpbnltY2UvdWkvUmVzaXplSGFuZGxlXCIsIFtcblx0XCJ0aW55bWNlL3VpL1dpZGdldFwiLFxuXHRcInRpbnltY2UvdWkvRHJhZ0hlbHBlclwiXG5dLCBmdW5jdGlvbihXaWRnZXQsIERyYWdIZWxwZXIpIHtcblx0XCJ1c2Ugc3RyaWN0XCI7XG5cblx0cmV0dXJuIFdpZGdldC5leHRlbmQoe1xuXHRcdC8qKlxuXHRcdCAqIFJlbmRlcnMgdGhlIGNvbnRyb2wgYXMgYSBIVE1MIHN0cmluZy5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgcmVuZGVySHRtbFxuXHRcdCAqIEByZXR1cm4ge1N0cmluZ30gSFRNTCByZXByZXNlbnRpbmcgdGhlIGNvbnRyb2wuXG5cdFx0ICovXG5cdFx0cmVuZGVySHRtbDogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIHByZWZpeCA9IHNlbGYuY2xhc3NQcmVmaXg7XG5cblx0XHRcdHNlbGYuY2xhc3Nlcy5hZGQoJ3Jlc2l6ZWhhbmRsZScpO1xuXG5cdFx0XHRpZiAoc2VsZi5zZXR0aW5ncy5kaXJlY3Rpb24gPT0gXCJib3RoXCIpIHtcblx0XHRcdFx0c2VsZi5jbGFzc2VzLmFkZCgncmVzaXplaGFuZGxlLWJvdGgnKTtcblx0XHRcdH1cblxuXHRcdFx0c2VsZi5jYW5Gb2N1cyA9IGZhbHNlO1xuXG5cdFx0XHRyZXR1cm4gKFxuXHRcdFx0XHQnPGRpdiBpZD1cIicgKyBzZWxmLl9pZCArICdcIiBjbGFzcz1cIicgKyBzZWxmLmNsYXNzZXMgKyAnXCI+JyArXG5cdFx0XHRcdFx0JzxpIGNsYXNzPVwiJyArIHByZWZpeCArICdpY28gJyArIHByZWZpeCArICdpLXJlc2l6ZVwiPjwvaT4nICtcblx0XHRcdFx0JzwvZGl2Pidcblx0XHRcdCk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIENhbGxlZCBhZnRlciB0aGUgY29udHJvbCBoYXMgYmVlbiByZW5kZXJlZC5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgcG9zdFJlbmRlclxuXHRcdCAqL1xuXHRcdHBvc3RSZW5kZXI6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHRzZWxmLl9zdXBlcigpO1xuXG5cdFx0XHRzZWxmLnJlc2l6ZURyYWdIZWxwZXIgPSBuZXcgRHJhZ0hlbHBlcih0aGlzLl9pZCwge1xuXHRcdFx0XHRzdGFydDogZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0c2VsZi5maXJlKCdSZXNpemVTdGFydCcpO1xuXHRcdFx0XHR9LFxuXG5cdFx0XHRcdGRyYWc6IGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0XHRpZiAoc2VsZi5zZXR0aW5ncy5kaXJlY3Rpb24gIT0gXCJib3RoXCIpIHtcblx0XHRcdFx0XHRcdGUuZGVsdGFYID0gMDtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRzZWxmLmZpcmUoJ1Jlc2l6ZScsIGUpO1xuXHRcdFx0XHR9LFxuXG5cdFx0XHRcdHN0b3A6IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdHNlbGYuZmlyZSgnUmVzaXplRW5kJyk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH0sXG5cblx0XHRyZW1vdmU6IGZ1bmN0aW9uKCkge1xuXHRcdFx0aWYgKHRoaXMucmVzaXplRHJhZ0hlbHBlcikge1xuXHRcdFx0XHR0aGlzLnJlc2l6ZURyYWdIZWxwZXIuZGVzdHJveSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gdGhpcy5fc3VwZXIoKTtcblx0XHR9XG5cdH0pO1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy91aS9TZWxlY3RCb3guanNcblxuLyoqXG4gKiBTZWxlY3RCb3guanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBDcmVhdGVzIGEgbmV3IHNlbGVjdCBib3ggY29udHJvbC5cbiAqXG4gKiBALXgtbGVzcyBTZWxlY3RCb3gubGVzc1xuICogQGNsYXNzIHRpbnltY2UudWkuU2VsZWN0Qm94XG4gKiBAZXh0ZW5kcyB0aW55bWNlLnVpLldpZGdldFxuICovXG5kZWZpbmUoXCJ0aW55bWNlL3VpL1NlbGVjdEJveFwiLCBbXG5cdFwidGlueW1jZS91aS9XaWRnZXRcIlxuXSwgZnVuY3Rpb24oV2lkZ2V0KSB7XG5cdFwidXNlIHN0cmljdFwiO1xuXG5cdGZ1bmN0aW9uIGNyZWF0ZU9wdGlvbnMob3B0aW9ucykge1xuXHRcdHZhciBzdHJPcHRpb25zID0gJyc7XG5cdFx0aWYgKG9wdGlvbnMpIHtcblx0XHRcdGZvciAodmFyIGkgPSAwOyBpIDwgb3B0aW9ucy5sZW5ndGg7IGkrKykge1xuXHRcdFx0XHRzdHJPcHRpb25zICs9ICc8b3B0aW9uIHZhbHVlPVwiJyArIG9wdGlvbnNbaV0gKyAnXCI+JyArIG9wdGlvbnNbaV0gKyAnPC9vcHRpb24+Jztcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHN0ck9wdGlvbnM7XG5cdH1cblxuXHRyZXR1cm4gV2lkZ2V0LmV4dGVuZCh7XG5cdFx0RGVmYXVsdHM6IHtcblx0XHRcdGNsYXNzZXM6IFwic2VsZWN0Ym94XCIsXG5cdFx0XHRyb2xlOiBcInNlbGVjdGJveFwiLFxuXHRcdFx0b3B0aW9uczogW11cblx0XHR9LFxuXHRcdC8qKlxuXHRcdCAqIENvbnN0cnVjdHMgYSBpbnN0YW5jZSB3aXRoIHRoZSBzcGVjaWZpZWQgc2V0dGluZ3MuXG5cdFx0ICpcblx0XHQgKiBAY29uc3RydWN0b3Jcblx0XHQgKiBAcGFyYW0ge09iamVjdH0gc2V0dGluZ3MgTmFtZS92YWx1ZSBvYmplY3Qgd2l0aCBzZXR0aW5ncy5cblx0XHQgKiBAc2V0dGluZyB7QXJyYXl9IG9wdGlvbnMgQXJyYXkgd2l0aCBvcHRpb25zIHRvIGFkZCB0byB0aGUgc2VsZWN0IGJveC5cblx0XHQgKi9cblx0XHRpbml0OiBmdW5jdGlvbihzZXR0aW5ncykge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHRzZWxmLl9zdXBlcihzZXR0aW5ncyk7XG5cblx0XHRcdGlmIChzZWxmLnNldHRpbmdzLnNpemUpIHtcblx0XHRcdFx0c2VsZi5zaXplID0gc2VsZi5zZXR0aW5ncy5zaXplO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoc2VsZi5zZXR0aW5ncy5vcHRpb25zKSB7XG5cdFx0XHRcdHNlbGYuX29wdGlvbnMgPSBzZWxmLnNldHRpbmdzLm9wdGlvbnM7XG5cdFx0XHR9XG5cblx0XHRcdHNlbGYub24oJ2tleWRvd24nLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdHZhciByb290Q29udHJvbDtcblxuXHRcdFx0XHRpZiAoZS5rZXlDb2RlID09IDEzKSB7XG5cdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdFx0XHRcdFx0Ly8gRmluZCByb290IGNvbnRyb2wgdGhhdCB3ZSBjYW4gZG8gdG9KU09OIG9uXG5cdFx0XHRcdFx0c2VsZi5wYXJlbnRzKCkucmV2ZXJzZSgpLmVhY2goZnVuY3Rpb24oY3RybCkge1xuXHRcdFx0XHRcdFx0aWYgKGN0cmwudG9KU09OKSB7XG5cdFx0XHRcdFx0XHRcdHJvb3RDb250cm9sID0gY3RybDtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0Ly8gRmlyZSBldmVudCBvbiBjdXJyZW50IHRleHQgYm94IHdpdGggdGhlIHNlcmlhbGl6ZWQgZGF0YSBvZiB0aGUgd2hvbGUgZm9ybVxuXHRcdFx0XHRcdHNlbGYuZmlyZSgnc3VibWl0Jywge2RhdGE6IHJvb3RDb250cm9sLnRvSlNPTigpfSk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBHZXR0ZXIvc2V0dGVyIGZ1bmN0aW9uIGZvciB0aGUgb3B0aW9ucyBzdGF0ZS5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2Qgb3B0aW9uc1xuXHRcdCAqIEBwYXJhbSB7QXJyYXl9IFtzdGF0ZV0gU3RhdGUgdG8gYmUgc2V0LlxuXHRcdCAqIEByZXR1cm4ge0FycmF5fHRpbnltY2UudWkuU2VsZWN0Qm94fSBBcnJheSBvZiBzdHJpbmcgb3B0aW9ucy5cblx0XHQgKi9cblx0XHRvcHRpb25zOiBmdW5jdGlvbihzdGF0ZSkge1xuXHRcdFx0aWYgKCFhcmd1bWVudHMubGVuZ3RoKSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0YXRlLmdldCgnb3B0aW9ucycpO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLnN0YXRlLnNldCgnb3B0aW9ucycsIHN0YXRlKTtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblxuXHRcdHJlbmRlckh0bWw6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLCBvcHRpb25zLCBzaXplID0gJyc7XG5cblx0XHRcdG9wdGlvbnMgPSBjcmVhdGVPcHRpb25zKHNlbGYuX29wdGlvbnMpO1xuXG5cdFx0XHRpZiAoc2VsZi5zaXplKSB7XG5cdFx0XHRcdHNpemUgPSAnIHNpemUgPSBcIicgKyBzZWxmLnNpemUgKyAnXCInO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gKFxuXHRcdFx0XHQnPHNlbGVjdCBpZD1cIicgKyBzZWxmLl9pZCArICdcIiBjbGFzcz1cIicgKyBzZWxmLmNsYXNzZXMgKyAnXCInICsgc2l6ZSArICc+JyArXG5cdFx0XHRcdFx0b3B0aW9ucyArXG5cdFx0XHRcdCc8L3NlbGVjdD4nXG5cdFx0XHQpO1xuXHRcdH0sXG5cblx0XHRiaW5kU3RhdGVzOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0c2VsZi5zdGF0ZS5vbignY2hhbmdlOm9wdGlvbnMnLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdHNlbGYuZ2V0RWwoKS5pbm5lckhUTUwgPSBjcmVhdGVPcHRpb25zKGUudmFsdWUpO1xuXHRcdFx0fSk7XG5cblx0XHRcdHJldHVybiBzZWxmLl9zdXBlcigpO1xuXHRcdH1cblx0fSk7XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL3VpL1NsaWRlci5qc1xuXG4vKipcbiAqIFNsaWRlci5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE1IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKipcbiAqIFNsaWRlciBjb250cm9sLlxuICpcbiAqIEAteC1sZXNzIFNsaWRlci5sZXNzXG4gKiBAY2xhc3MgdGlueW1jZS51aS5TbGlkZXJcbiAqIEBleHRlbmRzIHRpbnltY2UudWkuV2lkZ2V0XG4gKi9cbmRlZmluZShcInRpbnltY2UvdWkvU2xpZGVyXCIsIFtcblx0XCJ0aW55bWNlL3VpL1dpZGdldFwiLFxuXHRcInRpbnltY2UvdWkvRHJhZ0hlbHBlclwiLFxuXHRcInRpbnltY2UvdWkvRG9tVXRpbHNcIlxuXSwgZnVuY3Rpb24oV2lkZ2V0LCBEcmFnSGVscGVyLCBEb21VdGlscykge1xuXHRcInVzZSBzdHJpY3RcIjtcblxuXHRmdW5jdGlvbiBjb25zdHJhaW4odmFsdWUsIG1pblZhbCwgbWF4VmFsKSB7XG5cdFx0aWYgKHZhbHVlIDwgbWluVmFsKSB7XG5cdFx0XHR2YWx1ZSA9IG1pblZhbDtcblx0XHR9XG5cblx0XHRpZiAodmFsdWUgPiBtYXhWYWwpIHtcblx0XHRcdHZhbHVlID0gbWF4VmFsO1xuXHRcdH1cblxuXHRcdHJldHVybiB2YWx1ZTtcblx0fVxuXG5cdGZ1bmN0aW9uIHNldEFyaWFQcm9wKGVsLCBuYW1lLCB2YWx1ZSkge1xuXHRcdGVsLnNldEF0dHJpYnV0ZSgnYXJpYS0nICsgbmFtZSwgdmFsdWUpO1xuXHR9XG5cblx0ZnVuY3Rpb24gdXBkYXRlU2xpZGVySGFuZGxlKGN0cmwsIHZhbHVlKSB7XG5cdFx0dmFyIG1heEhhbmRsZVBvcywgc2hvcnRTaXplTmFtZSwgc2l6ZU5hbWUsIHN0eWxlUG9zTmFtZSwgc3R5bGVWYWx1ZSwgaGFuZGxlRWw7XG5cblx0XHRpZiAoY3RybC5zZXR0aW5ncy5vcmllbnRhdGlvbiA9PSBcInZcIikge1xuXHRcdFx0c3R5bGVQb3NOYW1lID0gXCJ0b3BcIjtcblx0XHRcdHNpemVOYW1lID0gXCJoZWlnaHRcIjtcblx0XHRcdHNob3J0U2l6ZU5hbWUgPSBcImhcIjtcblx0XHR9IGVsc2Uge1xuXHRcdFx0c3R5bGVQb3NOYW1lID0gXCJsZWZ0XCI7XG5cdFx0XHRzaXplTmFtZSA9IFwid2lkdGhcIjtcblx0XHRcdHNob3J0U2l6ZU5hbWUgPSBcIndcIjtcblx0XHR9XG5cblx0XHRoYW5kbGVFbCA9IGN0cmwuZ2V0RWwoJ2hhbmRsZScpO1xuXHRcdG1heEhhbmRsZVBvcyA9IChjdHJsLmxheW91dFJlY3QoKVtzaG9ydFNpemVOYW1lXSB8fCAxMDApIC0gRG9tVXRpbHMuZ2V0U2l6ZShoYW5kbGVFbClbc2l6ZU5hbWVdO1xuXG5cdFx0c3R5bGVWYWx1ZSA9IChtYXhIYW5kbGVQb3MgKiAoKHZhbHVlIC0gY3RybC5fbWluVmFsdWUpIC8gKGN0cmwuX21heFZhbHVlIC0gY3RybC5fbWluVmFsdWUpKSkgKyAncHgnO1xuXHRcdGhhbmRsZUVsLnN0eWxlW3N0eWxlUG9zTmFtZV0gPSBzdHlsZVZhbHVlO1xuXHRcdGhhbmRsZUVsLnN0eWxlLmhlaWdodCA9IGN0cmwubGF5b3V0UmVjdCgpLmggKyAncHgnO1xuXG5cdFx0c2V0QXJpYVByb3AoaGFuZGxlRWwsICd2YWx1ZW5vdycsIHZhbHVlKTtcblx0XHRzZXRBcmlhUHJvcChoYW5kbGVFbCwgJ3ZhbHVldGV4dCcsICcnICsgY3RybC5zZXR0aW5ncy5wcmV2aWV3RmlsdGVyKHZhbHVlKSk7XG5cdFx0c2V0QXJpYVByb3AoaGFuZGxlRWwsICd2YWx1ZW1pbicsIGN0cmwuX21pblZhbHVlKTtcblx0XHRzZXRBcmlhUHJvcChoYW5kbGVFbCwgJ3ZhbHVlbWF4JywgY3RybC5fbWF4VmFsdWUpO1xuXHR9XG5cblx0cmV0dXJuIFdpZGdldC5leHRlbmQoe1xuXHRcdGluaXQ6IGZ1bmN0aW9uKHNldHRpbmdzKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdGlmICghc2V0dGluZ3MucHJldmlld0ZpbHRlcikge1xuXHRcdFx0XHRzZXR0aW5ncy5wcmV2aWV3RmlsdGVyID0gZnVuY3Rpb24odmFsdWUpIHtcblx0XHRcdFx0XHRyZXR1cm4gTWF0aC5yb3VuZCh2YWx1ZSAqIDEwMCkgLyAxMDAuMDtcblx0XHRcdFx0fTtcblx0XHRcdH1cblxuXHRcdFx0c2VsZi5fc3VwZXIoc2V0dGluZ3MpO1xuXHRcdFx0c2VsZi5jbGFzc2VzLmFkZCgnc2xpZGVyJyk7XG5cblx0XHRcdGlmIChzZXR0aW5ncy5vcmllbnRhdGlvbiA9PSBcInZcIikge1xuXHRcdFx0XHRzZWxmLmNsYXNzZXMuYWRkKCd2ZXJ0aWNhbCcpO1xuXHRcdFx0fVxuXG5cdFx0XHRzZWxmLl9taW5WYWx1ZSA9IHNldHRpbmdzLm1pblZhbHVlIHx8IDA7XG5cdFx0XHRzZWxmLl9tYXhWYWx1ZSA9IHNldHRpbmdzLm1heFZhbHVlIHx8IDEwMDtcblx0XHRcdHNlbGYuX2luaXRWYWx1ZSA9IHNlbGYuc3RhdGUuZ2V0KCd2YWx1ZScpO1xuXHRcdH0sXG5cblx0XHRyZW5kZXJIdG1sOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgaWQgPSBzZWxmLl9pZCwgcHJlZml4ID0gc2VsZi5jbGFzc1ByZWZpeDtcblxuXHRcdFx0cmV0dXJuIChcblx0XHRcdFx0JzxkaXYgaWQ9XCInICsgaWQgKyAnXCIgY2xhc3M9XCInICsgc2VsZi5jbGFzc2VzICsgJ1wiPicgK1xuXHRcdFx0XHRcdCc8ZGl2IGlkPVwiJyArIGlkICsgJy1oYW5kbGVcIiBjbGFzcz1cIicgKyBwcmVmaXggKyAnc2xpZGVyLWhhbmRsZVwiIHJvbGU9XCJzbGlkZXJcIiB0YWJpbmRleD1cIi0xXCI+PC9kaXY+JyArXG5cdFx0XHRcdCc8L2Rpdj4nXG5cdFx0XHQpO1xuXHRcdH0sXG5cblx0XHRyZXNldDogZnVuY3Rpb24oKSB7XG5cdFx0XHR0aGlzLnZhbHVlKHRoaXMuX2luaXRWYWx1ZSkucmVwYWludCgpO1xuXHRcdH0sXG5cblx0XHRwb3N0UmVuZGVyOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgbWluVmFsdWUsIG1heFZhbHVlLCBzY3JlZW5Db3JkTmFtZSxcblx0XHRcdFx0XHRzdHlsZVBvc05hbWUsIHNpemVOYW1lLCBzaG9ydFNpemVOYW1lO1xuXG5cdFx0XHRmdW5jdGlvbiB0b0ZyYWN0aW9uKG1pbiwgbWF4LCB2YWwpIHtcblx0XHRcdFx0cmV0dXJuICh2YWwgKyBtaW4pIC8gKG1heCAtIG1pbik7XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIGZyb21GcmFjdGlvbihtaW4sIG1heCwgdmFsKSB7XG5cdFx0XHRcdHJldHVybiAodmFsICogKG1heCAtIG1pbikpIC0gbWluO1xuXHRcdFx0fVxuXG5cdFx0XHRmdW5jdGlvbiBoYW5kbGVLZXlib2FyZChtaW5WYWx1ZSwgbWF4VmFsdWUpIHtcblx0XHRcdFx0ZnVuY3Rpb24gYWx0ZXIoZGVsdGEpIHtcblx0XHRcdFx0XHR2YXIgdmFsdWU7XG5cblx0XHRcdFx0XHR2YWx1ZSA9IHNlbGYudmFsdWUoKTtcblx0XHRcdFx0XHR2YWx1ZSA9IGZyb21GcmFjdGlvbihtaW5WYWx1ZSwgbWF4VmFsdWUsIHRvRnJhY3Rpb24obWluVmFsdWUsIG1heFZhbHVlLCB2YWx1ZSkgKyAoZGVsdGEgKiAwLjA1KSk7XG5cdFx0XHRcdFx0dmFsdWUgPSBjb25zdHJhaW4odmFsdWUsIG1pblZhbHVlLCBtYXhWYWx1ZSk7XG5cblx0XHRcdFx0XHRzZWxmLnZhbHVlKHZhbHVlKTtcblxuXHRcdFx0XHRcdHNlbGYuZmlyZSgnZHJhZ3N0YXJ0Jywge3ZhbHVlOiB2YWx1ZX0pO1xuXHRcdFx0XHRcdHNlbGYuZmlyZSgnZHJhZycsIHt2YWx1ZTogdmFsdWV9KTtcblx0XHRcdFx0XHRzZWxmLmZpcmUoJ2RyYWdlbmQnLCB7dmFsdWU6IHZhbHVlfSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRzZWxmLm9uKCdrZXlkb3duJywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRcdHN3aXRjaCAoZS5rZXlDb2RlKSB7XG5cdFx0XHRcdFx0XHRjYXNlIDM3OlxuXHRcdFx0XHRcdFx0Y2FzZSAzODpcblx0XHRcdFx0XHRcdFx0YWx0ZXIoLTEpO1xuXHRcdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdFx0Y2FzZSAzOTpcblx0XHRcdFx0XHRcdGNhc2UgNDA6XG5cdFx0XHRcdFx0XHRcdGFsdGVyKDEpO1xuXHRcdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRmdW5jdGlvbiBoYW5kbGVEcmFnKG1pblZhbHVlLCBtYXhWYWx1ZSwgaGFuZGxlRWwpIHtcblx0XHRcdFx0dmFyIHN0YXJ0UG9zLCBzdGFydEhhbmRsZVBvcywgbWF4SGFuZGxlUG9zLCBoYW5kbGVQb3MsIHZhbHVlO1xuXG5cdFx0XHRcdHNlbGYuX2RyYWdIZWxwZXIgPSBuZXcgRHJhZ0hlbHBlcihzZWxmLl9pZCwge1xuXHRcdFx0XHRcdGhhbmRsZTogc2VsZi5faWQgKyBcIi1oYW5kbGVcIixcblxuXHRcdFx0XHRcdHN0YXJ0OiBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdFx0XHRzdGFydFBvcyA9IGVbc2NyZWVuQ29yZE5hbWVdO1xuXHRcdFx0XHRcdFx0c3RhcnRIYW5kbGVQb3MgPSBwYXJzZUludChzZWxmLmdldEVsKCdoYW5kbGUnKS5zdHlsZVtzdHlsZVBvc05hbWVdLCAxMCk7XG5cdFx0XHRcdFx0XHRtYXhIYW5kbGVQb3MgPSAoc2VsZi5sYXlvdXRSZWN0KClbc2hvcnRTaXplTmFtZV0gfHwgMTAwKSAtIERvbVV0aWxzLmdldFNpemUoaGFuZGxlRWwpW3NpemVOYW1lXTtcblx0XHRcdFx0XHRcdHNlbGYuZmlyZSgnZHJhZ3N0YXJ0Jywge3ZhbHVlOiB2YWx1ZX0pO1xuXHRcdFx0XHRcdH0sXG5cblx0XHRcdFx0XHRkcmFnOiBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdFx0XHR2YXIgZGVsdGEgPSBlW3NjcmVlbkNvcmROYW1lXSAtIHN0YXJ0UG9zO1xuXG5cdFx0XHRcdFx0XHRoYW5kbGVQb3MgPSBjb25zdHJhaW4oc3RhcnRIYW5kbGVQb3MgKyBkZWx0YSwgMCwgbWF4SGFuZGxlUG9zKTtcblx0XHRcdFx0XHRcdGhhbmRsZUVsLnN0eWxlW3N0eWxlUG9zTmFtZV0gPSBoYW5kbGVQb3MgKyAncHgnO1xuXG5cdFx0XHRcdFx0XHR2YWx1ZSA9IG1pblZhbHVlICsgKGhhbmRsZVBvcyAvIG1heEhhbmRsZVBvcykgKiAobWF4VmFsdWUgLSBtaW5WYWx1ZSk7XG5cdFx0XHRcdFx0XHRzZWxmLnZhbHVlKHZhbHVlKTtcblxuXHRcdFx0XHRcdFx0c2VsZi50b29sdGlwKCkudGV4dCgnJyArIHNlbGYuc2V0dGluZ3MucHJldmlld0ZpbHRlcih2YWx1ZSkpLnNob3coKS5tb3ZlUmVsKGhhbmRsZUVsLCAnYmMgdGMnKTtcblxuXHRcdFx0XHRcdFx0c2VsZi5maXJlKCdkcmFnJywge3ZhbHVlOiB2YWx1ZX0pO1xuXHRcdFx0XHRcdH0sXG5cblx0XHRcdFx0XHRzdG9wOiBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRcdHNlbGYudG9vbHRpcCgpLmhpZGUoKTtcblx0XHRcdFx0XHRcdHNlbGYuZmlyZSgnZHJhZ2VuZCcsIHt2YWx1ZTogdmFsdWV9KTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRtaW5WYWx1ZSA9IHNlbGYuX21pblZhbHVlO1xuXHRcdFx0bWF4VmFsdWUgPSBzZWxmLl9tYXhWYWx1ZTtcblxuXHRcdFx0aWYgKHNlbGYuc2V0dGluZ3Mub3JpZW50YXRpb24gPT0gXCJ2XCIpIHtcblx0XHRcdFx0c2NyZWVuQ29yZE5hbWUgPSBcInNjcmVlbllcIjtcblx0XHRcdFx0c3R5bGVQb3NOYW1lID0gXCJ0b3BcIjtcblx0XHRcdFx0c2l6ZU5hbWUgPSBcImhlaWdodFwiO1xuXHRcdFx0XHRzaG9ydFNpemVOYW1lID0gXCJoXCI7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRzY3JlZW5Db3JkTmFtZSA9IFwic2NyZWVuWFwiO1xuXHRcdFx0XHRzdHlsZVBvc05hbWUgPSBcImxlZnRcIjtcblx0XHRcdFx0c2l6ZU5hbWUgPSBcIndpZHRoXCI7XG5cdFx0XHRcdHNob3J0U2l6ZU5hbWUgPSBcIndcIjtcblx0XHRcdH1cblxuXHRcdFx0c2VsZi5fc3VwZXIoKTtcblxuXHRcdFx0aGFuZGxlS2V5Ym9hcmQobWluVmFsdWUsIG1heFZhbHVlLCBzZWxmLmdldEVsKCdoYW5kbGUnKSk7XG5cdFx0XHRoYW5kbGVEcmFnKG1pblZhbHVlLCBtYXhWYWx1ZSwgc2VsZi5nZXRFbCgnaGFuZGxlJykpO1xuXHRcdH0sXG5cblx0XHRyZXBhaW50OiBmdW5jdGlvbigpIHtcblx0XHRcdHRoaXMuX3N1cGVyKCk7XG5cdFx0XHR1cGRhdGVTbGlkZXJIYW5kbGUodGhpcywgdGhpcy52YWx1ZSgpKTtcblx0XHR9LFxuXG5cdFx0YmluZFN0YXRlczogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdHNlbGYuc3RhdGUub24oJ2NoYW5nZTp2YWx1ZScsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0dXBkYXRlU2xpZGVySGFuZGxlKHNlbGYsIGUudmFsdWUpO1xuXHRcdFx0fSk7XG5cblx0XHRcdHJldHVybiBzZWxmLl9zdXBlcigpO1xuXHRcdH1cblx0fSk7XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL3VpL1NwYWNlci5qc1xuXG4vKipcbiAqIFNwYWNlci5qc1xuICpcbiAqIFJlbGVhc2VkIHVuZGVyIExHUEwgTGljZW5zZS5cbiAqIENvcHlyaWdodCAoYykgMTk5OS0yMDE1IEVwaG94IENvcnAuIEFsbCByaWdodHMgcmVzZXJ2ZWRcbiAqXG4gKiBMaWNlbnNlOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2xpY2Vuc2VcbiAqIENvbnRyaWJ1dGluZzogaHR0cDovL3d3dy50aW55bWNlLmNvbS9jb250cmlidXRpbmdcbiAqL1xuXG4vKipcbiAqIENyZWF0ZXMgYSBzcGFjZXIuIFRoaXMgY29udHJvbCBpcyB1c2VkIGluIGZsZXggbGF5b3V0cyBmb3IgZXhhbXBsZS5cbiAqXG4gKiBALXgtbGVzcyBTcGFjZXIubGVzc1xuICogQGNsYXNzIHRpbnltY2UudWkuU3BhY2VyXG4gKiBAZXh0ZW5kcyB0aW55bWNlLnVpLldpZGdldFxuICovXG5kZWZpbmUoXCJ0aW55bWNlL3VpL1NwYWNlclwiLCBbXG5cdFwidGlueW1jZS91aS9XaWRnZXRcIlxuXSwgZnVuY3Rpb24oV2lkZ2V0KSB7XG5cdFwidXNlIHN0cmljdFwiO1xuXG5cdHJldHVybiBXaWRnZXQuZXh0ZW5kKHtcblx0XHQvKipcblx0XHQgKiBSZW5kZXJzIHRoZSBjb250cm9sIGFzIGEgSFRNTCBzdHJpbmcuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHJlbmRlckh0bWxcblx0XHQgKiBAcmV0dXJuIHtTdHJpbmd9IEhUTUwgcmVwcmVzZW50aW5nIHRoZSBjb250cm9sLlxuXHRcdCAqL1xuXHRcdHJlbmRlckh0bWw6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHRzZWxmLmNsYXNzZXMuYWRkKCdzcGFjZXInKTtcblx0XHRcdHNlbGYuY2FuRm9jdXMgPSBmYWxzZTtcblxuXHRcdFx0cmV0dXJuICc8ZGl2IGlkPVwiJyArIHNlbGYuX2lkICsgJ1wiIGNsYXNzPVwiJyArIHNlbGYuY2xhc3NlcyArICdcIj48L2Rpdj4nO1xuXHRcdH1cblx0fSk7XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL3VpL1NwbGl0QnV0dG9uLmpzXG5cbi8qKlxuICogU3BsaXRCdXR0b24uanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBDcmVhdGVzIGEgc3BsaXQgYnV0dG9uLlxuICpcbiAqIEAteC1sZXNzIFNwbGl0QnV0dG9uLmxlc3NcbiAqIEBjbGFzcyB0aW55bWNlLnVpLlNwbGl0QnV0dG9uXG4gKiBAZXh0ZW5kcyB0aW55bWNlLnVpLkJ1dHRvblxuICovXG5kZWZpbmUoXCJ0aW55bWNlL3VpL1NwbGl0QnV0dG9uXCIsIFtcblx0XCJ0aW55bWNlL3VpL01lbnVCdXR0b25cIixcblx0XCJ0aW55bWNlL3VpL0RvbVV0aWxzXCIsXG5cdFwidGlueW1jZS9kb20vRG9tUXVlcnlcIlxuXSwgZnVuY3Rpb24oTWVudUJ1dHRvbiwgRG9tVXRpbHMsICQpIHtcblx0cmV0dXJuIE1lbnVCdXR0b24uZXh0ZW5kKHtcblx0XHREZWZhdWx0czoge1xuXHRcdFx0Y2xhc3NlczogXCJ3aWRnZXQgYnRuIHNwbGl0YnRuXCIsXG5cdFx0XHRyb2xlOiBcImJ1dHRvblwiXG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFJlcGFpbnRzIHRoZSBjb250cm9sIGFmdGVyIGEgbGF5b3V0IG9wZXJhdGlvbi5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgcmVwYWludFxuXHRcdCAqL1xuXHRcdHJlcGFpbnQ6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLCBlbG0gPSBzZWxmLmdldEVsKCksIHJlY3QgPSBzZWxmLmxheW91dFJlY3QoKSwgbWFpbkJ1dHRvbkVsbSwgbWVudUJ1dHRvbkVsbTtcblxuXHRcdFx0c2VsZi5fc3VwZXIoKTtcblxuXHRcdFx0bWFpbkJ1dHRvbkVsbSA9IGVsbS5maXJzdENoaWxkO1xuXHRcdFx0bWVudUJ1dHRvbkVsbSA9IGVsbS5sYXN0Q2hpbGQ7XG5cblx0XHRcdCQobWFpbkJ1dHRvbkVsbSkuY3NzKHtcblx0XHRcdFx0d2lkdGg6IHJlY3QudyAtIERvbVV0aWxzLmdldFNpemUobWVudUJ1dHRvbkVsbSkud2lkdGgsXG5cdFx0XHRcdGhlaWdodDogcmVjdC5oIC0gMlxuXHRcdFx0fSk7XG5cblx0XHRcdCQobWVudUJ1dHRvbkVsbSkuY3NzKHtcblx0XHRcdFx0aGVpZ2h0OiByZWN0LmggLSAyXG5cdFx0XHR9KTtcblxuXHRcdFx0cmV0dXJuIHNlbGY7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIFNldHMgdGhlIGFjdGl2ZSBtZW51IHN0YXRlLlxuXHRcdCAqXG5cdFx0ICogQHByaXZhdGVcblx0XHQgKi9cblx0XHRhY3RpdmVNZW51OiBmdW5jdGlvbihzdGF0ZSkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHQkKHNlbGYuZ2V0RWwoKS5sYXN0Q2hpbGQpLnRvZ2dsZUNsYXNzKHNlbGYuY2xhc3NQcmVmaXggKyAnYWN0aXZlJywgc3RhdGUpO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZW5kZXJzIHRoZSBjb250cm9sIGFzIGEgSFRNTCBzdHJpbmcuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHJlbmRlckh0bWxcblx0XHQgKiBAcmV0dXJuIHtTdHJpbmd9IEhUTUwgcmVwcmVzZW50aW5nIHRoZSBjb250cm9sLlxuXHRcdCAqL1xuXHRcdHJlbmRlckh0bWw6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLCBpZCA9IHNlbGYuX2lkLCBwcmVmaXggPSBzZWxmLmNsYXNzUHJlZml4LCBpbWFnZTtcblx0XHRcdHZhciBpY29uID0gc2VsZi5zdGF0ZS5nZXQoJ2ljb24nKSwgdGV4dCA9IHNlbGYuc3RhdGUuZ2V0KCd0ZXh0JyksXG5cdFx0XHRcdHRleHRIdG1sID0gJyc7XG5cblx0XHRcdGltYWdlID0gc2VsZi5zZXR0aW5ncy5pbWFnZTtcblx0XHRcdGlmIChpbWFnZSkge1xuXHRcdFx0XHRpY29uID0gJ25vbmUnO1xuXG5cdFx0XHRcdC8vIFN1cHBvcnQgZm9yIFtoaWdoIGRwaSwgbG93IGRwaV0gaW1hZ2Ugc291cmNlc1xuXHRcdFx0XHRpZiAodHlwZW9mIGltYWdlICE9IFwic3RyaW5nXCIpIHtcblx0XHRcdFx0XHRpbWFnZSA9IHdpbmRvdy5nZXRTZWxlY3Rpb24gPyBpbWFnZVswXSA6IGltYWdlWzFdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aW1hZ2UgPSAnIHN0eWxlPVwiYmFja2dyb3VuZC1pbWFnZTogdXJsKFxcJycgKyBpbWFnZSArICdcXCcpXCInO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0aW1hZ2UgPSAnJztcblx0XHRcdH1cblxuXHRcdFx0aWNvbiA9IHNlbGYuc2V0dGluZ3MuaWNvbiA/IHByZWZpeCArICdpY28gJyArIHByZWZpeCArICdpLScgKyBpY29uIDogJyc7XG5cblx0XHRcdGlmICh0ZXh0KSB7XG5cdFx0XHRcdHNlbGYuY2xhc3Nlcy5hZGQoJ2J0bi1oYXMtdGV4dCcpO1xuXHRcdFx0XHR0ZXh0SHRtbCA9ICc8c3BhbiBjbGFzcz1cIicgKyBwcmVmaXggKyAndHh0XCI+JyArIHNlbGYuZW5jb2RlKHRleHQpICsgJzwvc3Bhbj4nO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gKFxuXHRcdFx0XHQnPGRpdiBpZD1cIicgKyBpZCArICdcIiBjbGFzcz1cIicgKyBzZWxmLmNsYXNzZXMgKyAnXCIgcm9sZT1cImJ1dHRvblwiIHRhYmluZGV4PVwiLTFcIj4nICtcblx0XHRcdFx0XHQnPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgaGlkZWZvY3VzPVwiMVwiIHRhYmluZGV4PVwiLTFcIj4nICtcblx0XHRcdFx0XHRcdChpY29uID8gJzxpIGNsYXNzPVwiJyArIGljb24gKyAnXCInICsgaW1hZ2UgKyAnPjwvaT4nIDogJycpICtcblx0XHRcdFx0XHRcdHRleHRIdG1sICtcblx0XHRcdFx0XHQnPC9idXR0b24+JyArXG5cdFx0XHRcdFx0JzxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwiJyArIHByZWZpeCArICdvcGVuXCIgaGlkZWZvY3VzPVwiMVwiIHRhYmluZGV4PVwiLTFcIj4nICtcblx0XHRcdFx0XHRcdC8vKGljb24gPyAnPGkgY2xhc3M9XCInICsgaWNvbiArICdcIj48L2k+JyA6ICcnKSArXG5cdFx0XHRcdFx0XHQoc2VsZi5fbWVudUJ0blRleHQgPyAoaWNvbiA/ICdcXHUwMGEwJyA6ICcnKSArIHNlbGYuX21lbnVCdG5UZXh0IDogJycpICtcblx0XHRcdFx0XHRcdCcgPGkgY2xhc3M9XCInICsgcHJlZml4ICsgJ2NhcmV0XCI+PC9pPicgK1xuXHRcdFx0XHRcdCc8L2J1dHRvbj4nICtcblx0XHRcdFx0JzwvZGl2Pidcblx0XHRcdCk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIENhbGxlZCBhZnRlciB0aGUgY29udHJvbCBoYXMgYmVlbiByZW5kZXJlZC5cblx0XHQgKlxuXHRcdCAqIEBtZXRob2QgcG9zdFJlbmRlclxuXHRcdCAqL1xuXHRcdHBvc3RSZW5kZXI6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLCBvbkNsaWNrSGFuZGxlciA9IHNlbGYuc2V0dGluZ3Mub25jbGljaztcblxuXHRcdFx0c2VsZi5vbignY2xpY2snLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdHZhciBub2RlID0gZS50YXJnZXQ7XG5cblx0XHRcdFx0aWYgKGUuY29udHJvbCA9PSB0aGlzKSB7XG5cdFx0XHRcdFx0Ly8gRmluZCBjbGlja3MgdGhhdCBpcyBvbiB0aGUgbWFpbiBidXR0b25cblx0XHRcdFx0XHR3aGlsZSAobm9kZSkge1xuXHRcdFx0XHRcdFx0aWYgKChlLmFyaWEgJiYgZS5hcmlhLmtleSAhPSAnZG93bicpIHx8IChub2RlLm5vZGVOYW1lID09ICdCVVRUT04nICYmIG5vZGUuY2xhc3NOYW1lLmluZGV4T2YoJ29wZW4nKSA9PSAtMSkpIHtcblx0XHRcdFx0XHRcdFx0ZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcblxuXHRcdFx0XHRcdFx0XHRpZiAob25DbGlja0hhbmRsZXIpIHtcblx0XHRcdFx0XHRcdFx0XHRvbkNsaWNrSGFuZGxlci5jYWxsKHRoaXMsIGUpO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRub2RlID0gbm9kZS5wYXJlbnROb2RlO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdGRlbGV0ZSBzZWxmLnNldHRpbmdzLm9uY2xpY2s7XG5cblx0XHRcdHJldHVybiBzZWxmLl9zdXBlcigpO1xuXHRcdH1cblx0fSk7XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL3VpL1N0YWNrTGF5b3V0LmpzXG5cbi8qKlxuICogU3RhY2tMYXlvdXQuanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBUaGlzIGxheW91dCB1c2VzIHRoZSBicm93c2VycyBsYXlvdXQgd2hlbiB0aGUgaXRlbXMgYXJlIGJsb2Nrcy5cbiAqXG4gKiBALXgtbGVzcyBTdGFja0xheW91dC5sZXNzXG4gKiBAY2xhc3MgdGlueW1jZS51aS5TdGFja0xheW91dFxuICogQGV4dGVuZHMgdGlueW1jZS51aS5GbG93TGF5b3V0XG4gKi9cbmRlZmluZShcInRpbnltY2UvdWkvU3RhY2tMYXlvdXRcIiwgW1xuXHRcInRpbnltY2UvdWkvRmxvd0xheW91dFwiXG5dLCBmdW5jdGlvbihGbG93TGF5b3V0KSB7XG5cdFwidXNlIHN0cmljdFwiO1xuXG5cdHJldHVybiBGbG93TGF5b3V0LmV4dGVuZCh7XG5cdFx0RGVmYXVsdHM6IHtcblx0XHRcdGNvbnRhaW5lckNsYXNzOiAnc3RhY2stbGF5b3V0Jyxcblx0XHRcdGNvbnRyb2xDbGFzczogJ3N0YWNrLWxheW91dC1pdGVtJyxcblx0XHRcdGVuZENsYXNzOiAnYnJlYWsnXG5cdFx0fSxcblxuXHRcdGlzTmF0aXZlOiBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiB0cnVlO1xuXHRcdH1cblx0fSk7XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL3VpL1RhYlBhbmVsLmpzXG5cbi8qKlxuICogVGFiUGFuZWwuanNcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciBMR1BMIExpY2Vuc2UuXG4gKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAxNSBFcGhveCBDb3JwLiBBbGwgcmlnaHRzIHJlc2VydmVkXG4gKlxuICogTGljZW5zZTogaHR0cDovL3d3dy50aW55bWNlLmNvbS9saWNlbnNlXG4gKiBDb250cmlidXRpbmc6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vY29udHJpYnV0aW5nXG4gKi9cblxuLyoqXG4gKiBDcmVhdGVzIGEgdGFiIHBhbmVsIGNvbnRyb2wuXG4gKlxuICogQC14LWxlc3MgVGFiUGFuZWwubGVzc1xuICogQGNsYXNzIHRpbnltY2UudWkuVGFiUGFuZWxcbiAqIEBleHRlbmRzIHRpbnltY2UudWkuUGFuZWxcbiAqXG4gKiBAc2V0dGluZyB7TnVtYmVyfSBhY3RpdmVUYWIgQWN0aXZlIHRhYiBpbmRleC5cbiAqL1xuZGVmaW5lKFwidGlueW1jZS91aS9UYWJQYW5lbFwiLCBbXG5cdFwidGlueW1jZS91aS9QYW5lbFwiLFxuXHRcInRpbnltY2UvZG9tL0RvbVF1ZXJ5XCIsXG5cdFwidGlueW1jZS91aS9Eb21VdGlsc1wiXG5dLCBmdW5jdGlvbihQYW5lbCwgJCwgRG9tVXRpbHMpIHtcblx0XCJ1c2Ugc3RyaWN0XCI7XG5cblx0cmV0dXJuIFBhbmVsLmV4dGVuZCh7XG5cdFx0RGVmYXVsdHM6IHtcblx0XHRcdGxheW91dDogJ2Fic29sdXRlJyxcblx0XHRcdGRlZmF1bHRzOiB7XG5cdFx0XHRcdHR5cGU6ICdwYW5lbCdcblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogQWN0aXZhdGVzIHRoZSBzcGVjaWZpZWQgdGFiIGJ5IGluZGV4LlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCBhY3RpdmF0ZVRhYlxuXHRcdCAqIEBwYXJhbSB7TnVtYmVyfSBpZHggSW5kZXggb2YgdGhlIHRhYiB0byBhY3RpdmF0ZS5cblx0XHQgKi9cblx0XHRhY3RpdmF0ZVRhYjogZnVuY3Rpb24oaWR4KSB7XG5cdFx0XHR2YXIgYWN0aXZlVGFiRWxtO1xuXG5cdFx0XHRpZiAodGhpcy5hY3RpdmVUYWJJZCkge1xuXHRcdFx0XHRhY3RpdmVUYWJFbG0gPSB0aGlzLmdldEVsKHRoaXMuYWN0aXZlVGFiSWQpO1xuXHRcdFx0XHQkKGFjdGl2ZVRhYkVsbSkucmVtb3ZlQ2xhc3ModGhpcy5jbGFzc1ByZWZpeCArICdhY3RpdmUnKTtcblx0XHRcdFx0YWN0aXZlVGFiRWxtLnNldEF0dHJpYnV0ZSgnYXJpYS1zZWxlY3RlZCcsIFwiZmFsc2VcIik7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMuYWN0aXZlVGFiSWQgPSAndCcgKyBpZHg7XG5cblx0XHRcdGFjdGl2ZVRhYkVsbSA9IHRoaXMuZ2V0RWwoJ3QnICsgaWR4KTtcblx0XHRcdGFjdGl2ZVRhYkVsbS5zZXRBdHRyaWJ1dGUoJ2FyaWEtc2VsZWN0ZWQnLCBcInRydWVcIik7XG5cdFx0XHQkKGFjdGl2ZVRhYkVsbSkuYWRkQ2xhc3ModGhpcy5jbGFzc1ByZWZpeCArICdhY3RpdmUnKTtcblxuXHRcdFx0dGhpcy5pdGVtcygpW2lkeF0uc2hvdygpLmZpcmUoJ3Nob3d0YWInKTtcblx0XHRcdHRoaXMucmVmbG93KCk7XG5cblx0XHRcdHRoaXMuaXRlbXMoKS5lYWNoKGZ1bmN0aW9uKGl0ZW0sIGkpIHtcblx0XHRcdFx0aWYgKGlkeCAhPSBpKSB7XG5cdFx0XHRcdFx0aXRlbS5oaWRlKCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBSZW5kZXJzIHRoZSBjb250cm9sIGFzIGEgSFRNTCBzdHJpbmcuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHJlbmRlckh0bWxcblx0XHQgKiBAcmV0dXJuIHtTdHJpbmd9IEhUTUwgcmVwcmVzZW50aW5nIHRoZSBjb250cm9sLlxuXHRcdCAqL1xuXHRcdHJlbmRlckh0bWw6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLCBsYXlvdXQgPSBzZWxmLl9sYXlvdXQsIHRhYnNIdG1sID0gJycsIHByZWZpeCA9IHNlbGYuY2xhc3NQcmVmaXg7XG5cblx0XHRcdHNlbGYucHJlUmVuZGVyKCk7XG5cdFx0XHRsYXlvdXQucHJlUmVuZGVyKHNlbGYpO1xuXG5cdFx0XHRzZWxmLml0ZW1zKCkuZWFjaChmdW5jdGlvbihjdHJsLCBpKSB7XG5cdFx0XHRcdHZhciBpZCA9IHNlbGYuX2lkICsgJy10JyArIGk7XG5cblx0XHRcdFx0Y3RybC5hcmlhKCdyb2xlJywgJ3RhYnBhbmVsJyk7XG5cdFx0XHRcdGN0cmwuYXJpYSgnbGFiZWxsZWRieScsIGlkKTtcblxuXHRcdFx0XHR0YWJzSHRtbCArPSAoXG5cdFx0XHRcdFx0JzxkaXYgaWQ9XCInICsgaWQgKyAnXCIgY2xhc3M9XCInICsgcHJlZml4ICsgJ3RhYlwiICcgK1xuXHRcdFx0XHRcdFx0J3Vuc2VsZWN0YWJsZT1cIm9uXCIgcm9sZT1cInRhYlwiIGFyaWEtY29udHJvbHM9XCInICsgY3RybC5faWQgKyAnXCIgYXJpYS1zZWxlY3RlZD1cImZhbHNlXCIgdGFiSW5kZXg9XCItMVwiPicgK1xuXHRcdFx0XHRcdFx0c2VsZi5lbmNvZGUoY3RybC5zZXR0aW5ncy50aXRsZSkgK1xuXHRcdFx0XHRcdCc8L2Rpdj4nXG5cdFx0XHRcdCk7XG5cdFx0XHR9KTtcblxuXHRcdFx0cmV0dXJuIChcblx0XHRcdFx0JzxkaXYgaWQ9XCInICsgc2VsZi5faWQgKyAnXCIgY2xhc3M9XCInICsgc2VsZi5jbGFzc2VzICsgJ1wiIGhpZGVmb2N1cz1cIjFcIiB0YWJpbmRleD1cIi0xXCI+JyArXG5cdFx0XHRcdFx0JzxkaXYgaWQ9XCInICsgc2VsZi5faWQgKyAnLWhlYWRcIiBjbGFzcz1cIicgKyBwcmVmaXggKyAndGFic1wiIHJvbGU9XCJ0YWJsaXN0XCI+JyArXG5cdFx0XHRcdFx0XHR0YWJzSHRtbCArXG5cdFx0XHRcdFx0JzwvZGl2PicgK1xuXHRcdFx0XHRcdCc8ZGl2IGlkPVwiJyArIHNlbGYuX2lkICsgJy1ib2R5XCIgY2xhc3M9XCInICsgc2VsZi5ib2R5Q2xhc3NlcyArICdcIj4nICtcblx0XHRcdFx0XHRcdGxheW91dC5yZW5kZXJIdG1sKHNlbGYpICtcblx0XHRcdFx0XHQnPC9kaXY+JyArXG5cdFx0XHRcdCc8L2Rpdj4nXG5cdFx0XHQpO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBDYWxsZWQgYWZ0ZXIgdGhlIGNvbnRyb2wgaGFzIGJlZW4gcmVuZGVyZWQuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHBvc3RSZW5kZXJcblx0XHQgKi9cblx0XHRwb3N0UmVuZGVyOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0c2VsZi5fc3VwZXIoKTtcblxuXHRcdFx0c2VsZi5zZXR0aW5ncy5hY3RpdmVUYWIgPSBzZWxmLnNldHRpbmdzLmFjdGl2ZVRhYiB8fCAwO1xuXHRcdFx0c2VsZi5hY3RpdmF0ZVRhYihzZWxmLnNldHRpbmdzLmFjdGl2ZVRhYik7XG5cblx0XHRcdHRoaXMub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHR2YXIgdGFyZ2V0UGFyZW50ID0gZS50YXJnZXQucGFyZW50Tm9kZTtcblxuXHRcdFx0XHRpZiAodGFyZ2V0UGFyZW50ICYmIHRhcmdldFBhcmVudC5pZCA9PSBzZWxmLl9pZCArICctaGVhZCcpIHtcblx0XHRcdFx0XHR2YXIgaSA9IHRhcmdldFBhcmVudC5jaGlsZE5vZGVzLmxlbmd0aDtcblxuXHRcdFx0XHRcdHdoaWxlIChpLS0pIHtcblx0XHRcdFx0XHRcdGlmICh0YXJnZXRQYXJlbnQuY2hpbGROb2Rlc1tpXSA9PSBlLnRhcmdldCkge1xuXHRcdFx0XHRcdFx0XHRzZWxmLmFjdGl2YXRlVGFiKGkpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIEluaXRpYWxpemVzIHRoZSBjdXJyZW50IGNvbnRyb2xzIGxheW91dCByZWN0LlxuXHRcdCAqIFRoaXMgd2lsbCBiZSBleGVjdXRlZCBieSB0aGUgbGF5b3V0IG1hbmFnZXJzIHRvIGRldGVybWluZSB0aGVcblx0XHQgKiBkZWZhdWx0IG1pbldpZHRoL21pbkhlaWdodCBldGMuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIGluaXRMYXlvdXRSZWN0XG5cdFx0ICogQHJldHVybiB7T2JqZWN0fSBMYXlvdXQgcmVjdCBpbnN0YW5jZS5cblx0XHQgKi9cblx0XHRpbml0TGF5b3V0UmVjdDogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIHJlY3QsIG1pblcsIG1pbkg7XG5cblx0XHRcdG1pblcgPSBEb21VdGlscy5nZXRTaXplKHNlbGYuZ2V0RWwoJ2hlYWQnKSkud2lkdGg7XG5cdFx0XHRtaW5XID0gbWluVyA8IDAgPyAwIDogbWluVztcblx0XHRcdG1pbkggPSAwO1xuXG5cdFx0XHRzZWxmLml0ZW1zKCkuZWFjaChmdW5jdGlvbihpdGVtKSB7XG5cdFx0XHRcdG1pblcgPSBNYXRoLm1heChtaW5XLCBpdGVtLmxheW91dFJlY3QoKS5taW5XKTtcblx0XHRcdFx0bWluSCA9IE1hdGgubWF4KG1pbkgsIGl0ZW0ubGF5b3V0UmVjdCgpLm1pbkgpO1xuXHRcdFx0fSk7XG5cblx0XHRcdHNlbGYuaXRlbXMoKS5lYWNoKGZ1bmN0aW9uKGN0cmwpIHtcblx0XHRcdFx0Y3RybC5zZXR0aW5ncy54ID0gMDtcblx0XHRcdFx0Y3RybC5zZXR0aW5ncy55ID0gMDtcblx0XHRcdFx0Y3RybC5zZXR0aW5ncy53ID0gbWluVztcblx0XHRcdFx0Y3RybC5zZXR0aW5ncy5oID0gbWluSDtcblxuXHRcdFx0XHRjdHJsLmxheW91dFJlY3Qoe1xuXHRcdFx0XHRcdHg6IDAsXG5cdFx0XHRcdFx0eTogMCxcblx0XHRcdFx0XHR3OiBtaW5XLFxuXHRcdFx0XHRcdGg6IG1pbkhcblx0XHRcdFx0fSk7XG5cdFx0XHR9KTtcblxuXHRcdFx0dmFyIGhlYWRIID0gRG9tVXRpbHMuZ2V0U2l6ZShzZWxmLmdldEVsKCdoZWFkJykpLmhlaWdodDtcblxuXHRcdFx0c2VsZi5zZXR0aW5ncy5taW5XaWR0aCA9IG1pblc7XG5cdFx0XHRzZWxmLnNldHRpbmdzLm1pbkhlaWdodCA9IG1pbkggKyBoZWFkSDtcblxuXHRcdFx0cmVjdCA9IHNlbGYuX3N1cGVyKCk7XG5cdFx0XHRyZWN0LmRlbHRhSCArPSBoZWFkSDtcblx0XHRcdHJlY3QuaW5uZXJIID0gcmVjdC5oIC0gcmVjdC5kZWx0YUg7XG5cblx0XHRcdHJldHVybiByZWN0O1xuXHRcdH1cblx0fSk7XG59KTtcblxuLy8gSW5jbHVkZWQgZnJvbToganMvdGlueW1jZS9jbGFzc2VzL3VpL1RleHRCb3guanNcblxuLyoqXG4gKiBUZXh0Qm94LmpzXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgTEdQTCBMaWNlbnNlLlxuICogQ29weXJpZ2h0IChjKSAxOTk5LTIwMTUgRXBob3ggQ29ycC4gQWxsIHJpZ2h0cyByZXNlcnZlZFxuICpcbiAqIExpY2Vuc2U6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vbGljZW5zZVxuICogQ29udHJpYnV0aW5nOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2NvbnRyaWJ1dGluZ1xuICovXG5cbi8qKlxuICogQ3JlYXRlcyBhIG5ldyB0ZXh0Ym94LlxuICpcbiAqIEAteC1sZXNzIFRleHRCb3gubGVzc1xuICogQGNsYXNzIHRpbnltY2UudWkuVGV4dEJveFxuICogQGV4dGVuZHMgdGlueW1jZS51aS5XaWRnZXRcbiAqL1xuZGVmaW5lKFwidGlueW1jZS91aS9UZXh0Qm94XCIsIFtcblx0XCJ0aW55bWNlL3VpL1dpZGdldFwiLFxuXHRcInRpbnltY2UvdXRpbC9Ub29sc1wiLFxuXHRcInRpbnltY2UvdWkvRG9tVXRpbHNcIlxuXSwgZnVuY3Rpb24oV2lkZ2V0LCBUb29scywgRG9tVXRpbHMpIHtcblx0cmV0dXJuIFdpZGdldC5leHRlbmQoe1xuXHRcdC8qKlxuXHRcdCAqIENvbnN0cnVjdHMgYSBpbnN0YW5jZSB3aXRoIHRoZSBzcGVjaWZpZWQgc2V0dGluZ3MuXG5cdFx0ICpcblx0XHQgKiBAY29uc3RydWN0b3Jcblx0XHQgKiBAcGFyYW0ge09iamVjdH0gc2V0dGluZ3MgTmFtZS92YWx1ZSBvYmplY3Qgd2l0aCBzZXR0aW5ncy5cblx0XHQgKiBAc2V0dGluZyB7Qm9vbGVhbn0gbXVsdGlsaW5lIFRydWUgaWYgdGhlIHRleHRib3ggaXMgYSBtdWx0aWxpbmUgY29udHJvbC5cblx0XHQgKiBAc2V0dGluZyB7TnVtYmVyfSBtYXhMZW5ndGggTWF4IGxlbmd0aCBmb3IgdGhlIHRleHRib3guXG5cdFx0ICogQHNldHRpbmcge051bWJlcn0gc2l6ZSBTaXplIG9mIHRoZSB0ZXh0Ym94IGluIGNoYXJhY3RlcnMuXG5cdFx0ICovXG5cdFx0aW5pdDogZnVuY3Rpb24oc2V0dGluZ3MpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0c2VsZi5fc3VwZXIoc2V0dGluZ3MpO1xuXG5cdFx0XHRzZWxmLmNsYXNzZXMuYWRkKCd0ZXh0Ym94Jyk7XG5cblx0XHRcdGlmIChzZXR0aW5ncy5tdWx0aWxpbmUpIHtcblx0XHRcdFx0c2VsZi5jbGFzc2VzLmFkZCgnbXVsdGlsaW5lJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRzZWxmLm9uKCdrZXlkb3duJywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRcdHZhciByb290Q29udHJvbDtcblxuXHRcdFx0XHRcdGlmIChlLmtleUNvZGUgPT0gMTMpIHtcblx0XHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdFx0XHRcdFx0Ly8gRmluZCByb290IGNvbnRyb2wgdGhhdCB3ZSBjYW4gZG8gdG9KU09OIG9uXG5cdFx0XHRcdFx0XHRzZWxmLnBhcmVudHMoKS5yZXZlcnNlKCkuZWFjaChmdW5jdGlvbihjdHJsKSB7XG5cdFx0XHRcdFx0XHRcdGlmIChjdHJsLnRvSlNPTikge1xuXHRcdFx0XHRcdFx0XHRcdHJvb3RDb250cm9sID0gY3RybDtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0XHQvLyBGaXJlIGV2ZW50IG9uIGN1cnJlbnQgdGV4dCBib3ggd2l0aCB0aGUgc2VyaWFsaXplZCBkYXRhIG9mIHRoZSB3aG9sZSBmb3JtXG5cdFx0XHRcdFx0XHRzZWxmLmZpcmUoJ3N1Ym1pdCcsIHtkYXRhOiByb290Q29udHJvbC50b0pTT04oKX0pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0c2VsZi5vbigna2V5dXAnLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdFx0c2VsZi5zdGF0ZS5zZXQoJ3ZhbHVlJywgZS50YXJnZXQudmFsdWUpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmVwYWludHMgdGhlIGNvbnRyb2wgYWZ0ZXIgYSBsYXlvdXQgb3BlcmF0aW9uLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCByZXBhaW50XG5cdFx0ICovXG5cdFx0cmVwYWludDogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIHN0eWxlLCByZWN0LCBib3JkZXJCb3gsIGJvcmRlclcsIGJvcmRlckggPSAwLCBsYXN0UmVwYWludFJlY3Q7XG5cblx0XHRcdHN0eWxlID0gc2VsZi5nZXRFbCgpLnN0eWxlO1xuXHRcdFx0cmVjdCA9IHNlbGYuX2xheW91dFJlY3Q7XG5cdFx0XHRsYXN0UmVwYWludFJlY3QgPSBzZWxmLl9sYXN0UmVwYWludFJlY3QgfHwge307XG5cblx0XHRcdC8vIERldGVjdCBvbGQgSUUgNys4IGFkZCBsaW5lSGVpZ2h0IHRvIGFsaWduIGNhcmV0IHZlcnRpY2FsbHkgaW4gdGhlIG1pZGRsZVxuXHRcdFx0dmFyIGRvYyA9IGRvY3VtZW50O1xuXHRcdFx0aWYgKCFzZWxmLnNldHRpbmdzLm11bHRpbGluZSAmJiBkb2MuYWxsICYmICghZG9jLmRvY3VtZW50TW9kZSB8fCBkb2MuZG9jdW1lbnRNb2RlIDw9IDgpKSB7XG5cdFx0XHRcdHN0eWxlLmxpbmVIZWlnaHQgPSAocmVjdC5oIC0gYm9yZGVySCkgKyAncHgnO1xuXHRcdFx0fVxuXG5cdFx0XHRib3JkZXJCb3ggPSBzZWxmLmJvcmRlckJveDtcblx0XHRcdGJvcmRlclcgPSBib3JkZXJCb3gubGVmdCArIGJvcmRlckJveC5yaWdodCArIDg7XG5cdFx0XHRib3JkZXJIID0gYm9yZGVyQm94LnRvcCArIGJvcmRlckJveC5ib3R0b20gKyAoc2VsZi5zZXR0aW5ncy5tdWx0aWxpbmUgPyA4IDogMCk7XG5cblx0XHRcdGlmIChyZWN0LnggIT09IGxhc3RSZXBhaW50UmVjdC54KSB7XG5cdFx0XHRcdHN0eWxlLmxlZnQgPSByZWN0LnggKyAncHgnO1xuXHRcdFx0XHRsYXN0UmVwYWludFJlY3QueCA9IHJlY3QueDtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHJlY3QueSAhPT0gbGFzdFJlcGFpbnRSZWN0LnkpIHtcblx0XHRcdFx0c3R5bGUudG9wID0gcmVjdC55ICsgJ3B4Jztcblx0XHRcdFx0bGFzdFJlcGFpbnRSZWN0LnkgPSByZWN0Lnk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChyZWN0LncgIT09IGxhc3RSZXBhaW50UmVjdC53KSB7XG5cdFx0XHRcdHN0eWxlLndpZHRoID0gKHJlY3QudyAtIGJvcmRlclcpICsgJ3B4Jztcblx0XHRcdFx0bGFzdFJlcGFpbnRSZWN0LncgPSByZWN0Lnc7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChyZWN0LmggIT09IGxhc3RSZXBhaW50UmVjdC5oKSB7XG5cdFx0XHRcdHN0eWxlLmhlaWdodCA9IChyZWN0LmggLSBib3JkZXJIKSArICdweCc7XG5cdFx0XHRcdGxhc3RSZXBhaW50UmVjdC5oID0gcmVjdC5oO1xuXHRcdFx0fVxuXG5cdFx0XHRzZWxmLl9sYXN0UmVwYWludFJlY3QgPSBsYXN0UmVwYWludFJlY3Q7XG5cdFx0XHRzZWxmLmZpcmUoJ3JlcGFpbnQnLCB7fSwgZmFsc2UpO1xuXG5cdFx0XHRyZXR1cm4gc2VsZjtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogUmVuZGVycyB0aGUgY29udHJvbCBhcyBhIEhUTUwgc3RyaW5nLlxuXHRcdCAqXG5cdFx0ICogQG1ldGhvZCByZW5kZXJIdG1sXG5cdFx0ICogQHJldHVybiB7U3RyaW5nfSBIVE1MIHJlcHJlc2VudGluZyB0aGUgY29udHJvbC5cblx0XHQgKi9cblx0XHRyZW5kZXJIdG1sOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcywgc2V0dGluZ3MgPSBzZWxmLnNldHRpbmdzLCBhdHRycywgZWxtO1xuXG5cdFx0XHRhdHRycyA9IHtcblx0XHRcdFx0aWQ6IHNlbGYuX2lkLFxuXHRcdFx0XHRoaWRlZm9jdXM6ICcxJ1xuXHRcdFx0fTtcblxuXHRcdFx0VG9vbHMuZWFjaChbXG5cdFx0XHRcdCdyb3dzJyxcdCdzcGVsbGNoZWNrJyxcdCdtYXhMZW5ndGgnLCAnc2l6ZScsICdyZWFkb25seScsICdtaW4nLFxuXHRcdFx0XHQnbWF4JywgJ3N0ZXAnLCAnbGlzdCcsICdwYXR0ZXJuJywgJ3BsYWNlaG9sZGVyJywgJ3JlcXVpcmVkJywgJ211bHRpcGxlJ1xuXHRcdFx0XSwgZnVuY3Rpb24obmFtZSkge1xuXHRcdFx0XHRhdHRyc1tuYW1lXSA9IHNldHRpbmdzW25hbWVdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGlmIChzZWxmLmRpc2FibGVkKCkpIHtcblx0XHRcdFx0YXR0cnMuZGlzYWJsZWQgPSAnZGlzYWJsZWQnO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoc2V0dGluZ3Muc3VidHlwZSkge1xuXHRcdFx0XHRhdHRycy50eXBlID0gc2V0dGluZ3Muc3VidHlwZTtcblx0XHRcdH1cblxuXHRcdFx0ZWxtID0gRG9tVXRpbHMuY3JlYXRlKHNldHRpbmdzLm11bHRpbGluZSA/ICd0ZXh0YXJlYScgOiAnaW5wdXQnLCBhdHRycyk7XG5cdFx0XHRlbG0udmFsdWUgPSBzZWxmLnN0YXRlLmdldCgndmFsdWUnKTtcblx0XHRcdGVsbS5jbGFzc05hbWUgPSBzZWxmLmNsYXNzZXM7XG5cblx0XHRcdHJldHVybiBlbG0ub3V0ZXJIVE1MO1xuXHRcdH0sXG5cblx0XHR2YWx1ZTogZnVuY3Rpb24odmFsdWUpIHtcblx0XHRcdGlmIChhcmd1bWVudHMubGVuZ3RoKSB7XG5cdFx0XHRcdHRoaXMuc3RhdGUuc2V0KCd2YWx1ZScsIHZhbHVlKTtcblx0XHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0XHR9XG5cblx0XHRcdC8vIE1ha2Ugc3VyZSB0aGUgcmVhbCBzdGF0ZSBpcyBpbiBzeW5jXG5cdFx0XHRpZiAodGhpcy5zdGF0ZS5nZXQoJ3JlbmRlcmVkJykpIHtcblx0XHRcdFx0dGhpcy5zdGF0ZS5zZXQoJ3ZhbHVlJywgdGhpcy5nZXRFbCgpLnZhbHVlKTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHRoaXMuc3RhdGUuZ2V0KCd2YWx1ZScpO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBDYWxsZWQgYWZ0ZXIgdGhlIGNvbnRyb2wgaGFzIGJlZW4gcmVuZGVyZWQuXG5cdFx0ICpcblx0XHQgKiBAbWV0aG9kIHBvc3RSZW5kZXJcblx0XHQgKi9cblx0XHRwb3N0UmVuZGVyOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0c2VsZi5nZXRFbCgpLnZhbHVlID0gc2VsZi5zdGF0ZS5nZXQoJ3ZhbHVlJyk7XG5cdFx0XHRzZWxmLl9zdXBlcigpO1xuXG5cdFx0XHRzZWxmLiRlbC5vbignY2hhbmdlJywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRzZWxmLnN0YXRlLnNldCgndmFsdWUnLCBlLnRhcmdldC52YWx1ZSk7XG5cdFx0XHRcdHNlbGYuZmlyZSgnY2hhbmdlJywgZSk7XG5cdFx0XHR9KTtcblx0XHR9LFxuXG5cdFx0YmluZFN0YXRlczogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdHNlbGYuc3RhdGUub24oJ2NoYW5nZTp2YWx1ZScsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0aWYgKHNlbGYuZ2V0RWwoKS52YWx1ZSAhPSBlLnZhbHVlKSB7XG5cdFx0XHRcdFx0c2VsZi5nZXRFbCgpLnZhbHVlID0gZS52YWx1ZTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdHNlbGYuc3RhdGUub24oJ2NoYW5nZTpkaXNhYmxlZCcsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0c2VsZi5nZXRFbCgpLmRpc2FibGVkID0gZS52YWx1ZTtcblx0XHRcdH0pO1xuXG5cdFx0XHRyZXR1cm4gc2VsZi5fc3VwZXIoKTtcblx0XHR9LFxuXG5cdFx0cmVtb3ZlOiBmdW5jdGlvbigpIHtcblx0XHRcdHRoaXMuJGVsLm9mZigpO1xuXHRcdFx0dGhpcy5fc3VwZXIoKTtcblx0XHR9XG5cdH0pO1xufSk7XG5cbi8vIEluY2x1ZGVkIGZyb206IGpzL3RpbnltY2UvY2xhc3Nlcy9SZWdpc3Rlci5qc1xuXG4vKipcbiAqIFJlZ2lzdGVyLmpzXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgTEdQTCBMaWNlbnNlLlxuICogQ29weXJpZ2h0IChjKSAxOTk5LTIwMTUgRXBob3ggQ29ycC4gQWxsIHJpZ2h0cyByZXNlcnZlZFxuICpcbiAqIExpY2Vuc2U6IGh0dHA6Ly93d3cudGlueW1jZS5jb20vbGljZW5zZVxuICogQ29udHJpYnV0aW5nOiBodHRwOi8vd3d3LnRpbnltY2UuY29tL2NvbnRyaWJ1dGluZ1xuICovXG5cbi8qKlxuICogVGhpcyByZWdpc3RlcnMgdGlueW1jZSBpbiBjb21tb24gbW9kdWxlIGxvYWRlcnMuXG4gKlxuICogQHByaXZhdGVcbiAqIEBjbGFzcyB0aW55bWNlLlJlZ2lzdGVyXG4gKi9cbmRlZmluZShcInRpbnltY2UvUmVnaXN0ZXJcIiwgW1xuXSwgZnVuY3Rpb24oKSB7XG5cdC8qZXNsaW50IGNvbnNpc3RlbnQtdGhpczogMCAqL1xuXHR2YXIgY29udGV4dCA9IHRoaXMgfHwgd2luZG93O1xuXG5cdHZhciB0aW55bWNlID0gZnVuY3Rpb24oKSB7XG5cdFx0cmV0dXJuIGNvbnRleHQudGlueW1jZTtcblx0fTtcblxuXHRpZiAodHlwZW9mIGNvbnRleHQuZGVmaW5lID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHQvLyBCb2x0XG5cdFx0aWYgKCFjb250ZXh0LmRlZmluZS5hbWQpIHtcblx0XHRcdGNvbnRleHQuZGVmaW5lKFwiZXBob3gvdGlueW1jZVwiLCBbXSwgdGlueW1jZSk7XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZiBtb2R1bGUgPT09ICdvYmplY3QnKSB7XG5cdFx0LyogZ2xvYmFsIG1vZHVsZSAqL1xuXHRcdG1vZHVsZS5leHBvcnRzID0gd2luZG93LnRpbnltY2U7XG5cdH1cblxuXHRyZXR1cm4ge307XG59KTtcblxuZXhwb3NlKFtcInRpbnltY2UvZ2VvbS9SZWN0XCIsXCJ0aW55bWNlL3V0aWwvUHJvbWlzZVwiLFwidGlueW1jZS91dGlsL0RlbGF5XCIsXCJ0aW55bWNlL0VudlwiLFwidGlueW1jZS9kb20vRXZlbnRVdGlsc1wiLFwidGlueW1jZS9kb20vU2l6emxlXCIsXCJ0aW55bWNlL3V0aWwvVG9vbHNcIixcInRpbnltY2UvZG9tL0RvbVF1ZXJ5XCIsXCJ0aW55bWNlL2h0bWwvU3R5bGVzXCIsXCJ0aW55bWNlL2RvbS9UcmVlV2Fsa2VyXCIsXCJ0aW55bWNlL2h0bWwvRW50aXRpZXNcIixcInRpbnltY2UvZG9tL0RPTVV0aWxzXCIsXCJ0aW55bWNlL2RvbS9TY3JpcHRMb2FkZXJcIixcInRpbnltY2UvQWRkT25NYW5hZ2VyXCIsXCJ0aW55bWNlL2RvbS9SYW5nZVV0aWxzXCIsXCJ0aW55bWNlL2h0bWwvTm9kZVwiLFwidGlueW1jZS9odG1sL1NjaGVtYVwiLFwidGlueW1jZS9odG1sL1NheFBhcnNlclwiLFwidGlueW1jZS9odG1sL0RvbVBhcnNlclwiLFwidGlueW1jZS9odG1sL1dyaXRlclwiLFwidGlueW1jZS9odG1sL1NlcmlhbGl6ZXJcIixcInRpbnltY2UvZG9tL1NlcmlhbGl6ZXJcIixcInRpbnltY2UvdXRpbC9WS1wiLFwidGlueW1jZS9kb20vQ29udHJvbFNlbGVjdGlvblwiLFwidGlueW1jZS9kb20vQm9va21hcmtNYW5hZ2VyXCIsXCJ0aW55bWNlL2RvbS9TZWxlY3Rpb25cIixcInRpbnltY2UvRm9ybWF0dGVyXCIsXCJ0aW55bWNlL1VuZG9NYW5hZ2VyXCIsXCJ0aW55bWNlL0VkaXRvckNvbW1hbmRzXCIsXCJ0aW55bWNlL3V0aWwvVVJJXCIsXCJ0aW55bWNlL3V0aWwvQ2xhc3NcIixcInRpbnltY2UvdXRpbC9FdmVudERpc3BhdGNoZXJcIixcInRpbnltY2UvdXRpbC9PYnNlcnZhYmxlXCIsXCJ0aW55bWNlL3VpL1NlbGVjdG9yXCIsXCJ0aW55bWNlL3VpL0NvbGxlY3Rpb25cIixcInRpbnltY2UvdWkvUmVmbG93UXVldWVcIixcInRpbnltY2UvdWkvQ29udHJvbFwiLFwidGlueW1jZS91aS9GYWN0b3J5XCIsXCJ0aW55bWNlL3VpL0tleWJvYXJkTmF2aWdhdGlvblwiLFwidGlueW1jZS91aS9Db250YWluZXJcIixcInRpbnltY2UvdWkvRHJhZ0hlbHBlclwiLFwidGlueW1jZS91aS9TY3JvbGxhYmxlXCIsXCJ0aW55bWNlL3VpL1BhbmVsXCIsXCJ0aW55bWNlL3VpL01vdmFibGVcIixcInRpbnltY2UvdWkvUmVzaXphYmxlXCIsXCJ0aW55bWNlL3VpL0Zsb2F0UGFuZWxcIixcInRpbnltY2UvdWkvV2luZG93XCIsXCJ0aW55bWNlL3VpL01lc3NhZ2VCb3hcIixcInRpbnltY2UvV2luZG93TWFuYWdlclwiLFwidGlueW1jZS91aS9Ub29sdGlwXCIsXCJ0aW55bWNlL3VpL1dpZGdldFwiLFwidGlueW1jZS91aS9Qcm9ncmVzc1wiLFwidGlueW1jZS91aS9Ob3RpZmljYXRpb25cIixcInRpbnltY2UvTm90aWZpY2F0aW9uTWFuYWdlclwiLFwidGlueW1jZS9FZGl0b3JPYnNlcnZhYmxlXCIsXCJ0aW55bWNlL1Nob3J0Y3V0c1wiLFwidGlueW1jZS9FZGl0b3JcIixcInRpbnltY2UvdXRpbC9JMThuXCIsXCJ0aW55bWNlL0ZvY3VzTWFuYWdlclwiLFwidGlueW1jZS9FZGl0b3JNYW5hZ2VyXCIsXCJ0aW55bWNlL3V0aWwvWEhSXCIsXCJ0aW55bWNlL3V0aWwvSlNPTlwiLFwidGlueW1jZS91dGlsL0pTT05SZXF1ZXN0XCIsXCJ0aW55bWNlL3V0aWwvSlNPTlBcIixcInRpbnltY2UvdXRpbC9Mb2NhbFN0b3JhZ2VcIixcInRpbnltY2UvQ29tcGF0XCIsXCJ0aW55bWNlL3VpL0xheW91dFwiLFwidGlueW1jZS91aS9BYnNvbHV0ZUxheW91dFwiLFwidGlueW1jZS91aS9CdXR0b25cIixcInRpbnltY2UvdWkvQnV0dG9uR3JvdXBcIixcInRpbnltY2UvdWkvQ2hlY2tib3hcIixcInRpbnltY2UvdWkvQ29tYm9Cb3hcIixcInRpbnltY2UvdWkvQ29sb3JCb3hcIixcInRpbnltY2UvdWkvUGFuZWxCdXR0b25cIixcInRpbnltY2UvdWkvQ29sb3JCdXR0b25cIixcInRpbnltY2UvdXRpbC9Db2xvclwiLFwidGlueW1jZS91aS9Db2xvclBpY2tlclwiLFwidGlueW1jZS91aS9QYXRoXCIsXCJ0aW55bWNlL3VpL0VsZW1lbnRQYXRoXCIsXCJ0aW55bWNlL3VpL0Zvcm1JdGVtXCIsXCJ0aW55bWNlL3VpL0Zvcm1cIixcInRpbnltY2UvdWkvRmllbGRTZXRcIixcInRpbnltY2UvdWkvRmlsZVBpY2tlclwiLFwidGlueW1jZS91aS9GaXRMYXlvdXRcIixcInRpbnltY2UvdWkvRmxleExheW91dFwiLFwidGlueW1jZS91aS9GbG93TGF5b3V0XCIsXCJ0aW55bWNlL3VpL0Zvcm1hdENvbnRyb2xzXCIsXCJ0aW55bWNlL3VpL0dyaWRMYXlvdXRcIixcInRpbnltY2UvdWkvSWZyYW1lXCIsXCJ0aW55bWNlL3VpL0luZm9Cb3hcIixcInRpbnltY2UvdWkvTGFiZWxcIixcInRpbnltY2UvdWkvVG9vbGJhclwiLFwidGlueW1jZS91aS9NZW51QmFyXCIsXCJ0aW55bWNlL3VpL01lbnVCdXR0b25cIixcInRpbnltY2UvdWkvTWVudUl0ZW1cIixcInRpbnltY2UvdWkvVGhyb2JiZXJcIixcInRpbnltY2UvdWkvTWVudVwiLFwidGlueW1jZS91aS9MaXN0Qm94XCIsXCJ0aW55bWNlL3VpL1JhZGlvXCIsXCJ0aW55bWNlL3VpL1Jlc2l6ZUhhbmRsZVwiLFwidGlueW1jZS91aS9TZWxlY3RCb3hcIixcInRpbnltY2UvdWkvU2xpZGVyXCIsXCJ0aW55bWNlL3VpL1NwYWNlclwiLFwidGlueW1jZS91aS9TcGxpdEJ1dHRvblwiLFwidGlueW1jZS91aS9TdGFja0xheW91dFwiLFwidGlueW1jZS91aS9UYWJQYW5lbFwiLFwidGlueW1jZS91aS9UZXh0Qm94XCJdKTtcbn0pKHdpbmRvdyk7XG5cbi8qKiogRVhQT1JUUyBGUk9NIGV4cG9ydHMtbG9hZGVyICoqKi9cbm1vZHVsZS5leHBvcnRzID0gd2luZG93LnRpbnltY2U7XG59LmNhbGwod2luZG93KSk7XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9+L3RpbnltY2UvdGlueW1jZS5qc1xuLy8gbW9kdWxlIGlkID0gOTc4XG4vLyBtb2R1bGUgY2h1bmtzID0gMCAxIDIiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ },

/***/ 979:
/***/ function(module, exports, __webpack_require__) {

"use strict";
eval("\"use strict\";\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __metadata = (this && this.__metadata) || function (k, v) {\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\nvar core_1 = __webpack_require__(1);\nvar ng_file_drop_1 = __webpack_require__(962);\nvar ng_file_select_1 = __webpack_require__(963);\nvar ng2_uploader_1 = __webpack_require__(959);\nvar Ng2UploaderModule = (function () {\n    function Ng2UploaderModule() {\n    }\n    return Ng2UploaderModule;\n}());\nNg2UploaderModule = __decorate([\n    core_1.NgModule({\n        declarations: [\n            ng_file_drop_1.NgFileDropDirective,\n            ng_file_select_1.NgFileSelectDirective\n        ],\n        providers: [\n            ng2_uploader_1.Ng2Uploader\n        ],\n        exports: [\n            ng_file_drop_1.NgFileDropDirective,\n            ng_file_select_1.NgFileSelectDirective\n        ]\n    }),\n    __metadata(\"design:paramtypes\", [])\n], Ng2UploaderModule);\nexports.Ng2UploaderModule = Ng2UploaderModule;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTc5LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vfi9uZzItdXBsb2FkZXIvc3JjL21vZHVsZS9uZzItdXBsb2FkZXIubW9kdWxlLmpzPzI1NTkiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19kZWNvcmF0ZSA9ICh0aGlzICYmIHRoaXMuX19kZWNvcmF0ZSkgfHwgZnVuY3Rpb24gKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKSB7XG4gICAgdmFyIGMgPSBhcmd1bWVudHMubGVuZ3RoLCByID0gYyA8IDMgPyB0YXJnZXQgOiBkZXNjID09PSBudWxsID8gZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGFyZ2V0LCBrZXkpIDogZGVzYywgZDtcbiAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIFJlZmxlY3QuZGVjb3JhdGUgPT09IFwiZnVuY3Rpb25cIikgciA9IFJlZmxlY3QuZGVjb3JhdGUoZGVjb3JhdG9ycywgdGFyZ2V0LCBrZXksIGRlc2MpO1xuICAgIGVsc2UgZm9yICh2YXIgaSA9IGRlY29yYXRvcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIGlmIChkID0gZGVjb3JhdG9yc1tpXSkgciA9IChjIDwgMyA/IGQocikgOiBjID4gMyA/IGQodGFyZ2V0LCBrZXksIHIpIDogZCh0YXJnZXQsIGtleSkpIHx8IHI7XG4gICAgcmV0dXJuIGMgPiAzICYmIHIgJiYgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCByKSwgcjtcbn07XG52YXIgX19tZXRhZGF0YSA9ICh0aGlzICYmIHRoaXMuX19tZXRhZGF0YSkgfHwgZnVuY3Rpb24gKGssIHYpIHtcbiAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIFJlZmxlY3QubWV0YWRhdGEgPT09IFwiZnVuY3Rpb25cIikgcmV0dXJuIFJlZmxlY3QubWV0YWRhdGEoaywgdik7XG59O1xudmFyIGNvcmVfMSA9IHJlcXVpcmUoXCJAYW5ndWxhci9jb3JlXCIpO1xudmFyIG5nX2ZpbGVfZHJvcF8xID0gcmVxdWlyZShcIi4vLi4vZGlyZWN0aXZlcy9uZy1maWxlLWRyb3BcIik7XG52YXIgbmdfZmlsZV9zZWxlY3RfMSA9IHJlcXVpcmUoXCIuLy4uL2RpcmVjdGl2ZXMvbmctZmlsZS1zZWxlY3RcIik7XG52YXIgbmcyX3VwbG9hZGVyXzEgPSByZXF1aXJlKFwiLi8uLi9zZXJ2aWNlcy9uZzItdXBsb2FkZXJcIik7XG52YXIgTmcyVXBsb2FkZXJNb2R1bGUgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE5nMlVwbG9hZGVyTW9kdWxlKCkge1xuICAgIH1cbiAgICByZXR1cm4gTmcyVXBsb2FkZXJNb2R1bGU7XG59KCkpO1xuTmcyVXBsb2FkZXJNb2R1bGUgPSBfX2RlY29yYXRlKFtcbiAgICBjb3JlXzEuTmdNb2R1bGUoe1xuICAgICAgICBkZWNsYXJhdGlvbnM6IFtcbiAgICAgICAgICAgIG5nX2ZpbGVfZHJvcF8xLk5nRmlsZURyb3BEaXJlY3RpdmUsXG4gICAgICAgICAgICBuZ19maWxlX3NlbGVjdF8xLk5nRmlsZVNlbGVjdERpcmVjdGl2ZVxuICAgICAgICBdLFxuICAgICAgICBwcm92aWRlcnM6IFtcbiAgICAgICAgICAgIG5nMl91cGxvYWRlcl8xLk5nMlVwbG9hZGVyXG4gICAgICAgIF0sXG4gICAgICAgIGV4cG9ydHM6IFtcbiAgICAgICAgICAgIG5nX2ZpbGVfZHJvcF8xLk5nRmlsZURyb3BEaXJlY3RpdmUsXG4gICAgICAgICAgICBuZ19maWxlX3NlbGVjdF8xLk5nRmlsZVNlbGVjdERpcmVjdGl2ZVxuICAgICAgICBdXG4gICAgfSksXG4gICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtdKVxuXSwgTmcyVXBsb2FkZXJNb2R1bGUpO1xuZXhwb3J0cy5OZzJVcGxvYWRlck1vZHVsZSA9IE5nMlVwbG9hZGVyTW9kdWxlO1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9+L25nMi11cGxvYWRlci9zcmMvbW9kdWxlL25nMi11cGxvYWRlci5tb2R1bGUuanNcbi8vIG1vZHVsZSBpZCA9IDk3OVxuLy8gbW9kdWxlIGNodW5rcyA9IDAgMSAyIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9");

/***/ },

/***/ 980:
/***/ function(module, exports) {

eval("module.exports = \"#error-panel{\\r\\n    margin: 0 0 10px 0;\\r\\n}\\r\\n.card-panel{\\r\\n    background: #ef5350;\\r\\n    color: #fff;\\r\\n}\\r\\n#error-panel .error-text{\\r\\n    margin: 0;\\r\\n}\"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTgwLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vYXNzZXRzL2FwcC9lcnJvci9lcnJvci5jb21wb25lbnQuY3NzP2E1ZDEiXSwic291cmNlc0NvbnRlbnQiOlsibW9kdWxlLmV4cG9ydHMgPSBcIiNlcnJvci1wYW5lbHtcXHJcXG4gICAgbWFyZ2luOiAwIDAgMTBweCAwO1xcclxcbn1cXHJcXG4uY2FyZC1wYW5lbHtcXHJcXG4gICAgYmFja2dyb3VuZDogI2VmNTM1MDtcXHJcXG4gICAgY29sb3I6ICNmZmY7XFxyXFxufVxcclxcbiNlcnJvci1wYW5lbCAuZXJyb3ItdGV4dHtcXHJcXG4gICAgbWFyZ2luOiAwO1xcclxcbn1cIlxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vYXNzZXRzL2FwcC9lcnJvci9lcnJvci5jb21wb25lbnQuY3NzXG4vLyBtb2R1bGUgaWQgPSA5ODBcbi8vIG1vZHVsZSBjaHVua3MgPSAwIDEgMiJdLCJtYXBwaW5ncyI6IkFBQUEiLCJzb3VyY2VSb290IjoiIn0=");

/***/ },

/***/ 981:
/***/ function(module, exports) {

eval("module.exports = \".combobox{\\r\\n    position: relative;\\r\\n    float: left;\\r\\n}\\r\\n.cb-trigger{\\r\\n    position: relative;\\r\\n    padding: 10px 30px 10px 10px;\\r\\n    border-bottom: 1px solid #c3c3c3;\\r\\n    min-width: 120px;\\r\\n    box-sizing: border-box;\\r\\n}\\r\\n.cb-trigger.empty{\\r\\n    color: #cccccc;\\r\\n}\\r\\n.cb-trigger .down-arrow{\\r\\n    width: 0;\\r\\n    height: 0;\\r\\n    border-left: 7px solid transparent;\\r\\n    border-right: 7px solid transparent;\\r\\n    border-top: 7px solid #c3c3c3;\\r\\n    position: absolute;\\r\\n    right: 5px;\\r\\n    top: 16px;\\r\\n}\\r\\n.cb-items{\\r\\n    width: 100%;\\r\\n    max-height:200px;\\r\\n    overflow: auto;\\r\\n    position: absolute;\\r\\n    top: 0;\\r\\n    background: white;\\r\\n    list-style: none;\\r\\n    z-index: 15;\\r\\n    padding:0;\\r\\n    margin: 0;\\r\\n    box-shadow: 0 2px 2px 0 rgba(0,0,0,0.14),0 1px 5px 0 rgba(0,0,0,0.12),0 3px 1px -2px rgba(0,0,0,0.2);\\r\\n}\\r\\n.cb-item{\\r\\n    padding: 10px;\\r\\n    border-bottom: 1px solid gray;\\r\\n    cursor: pointer;\\r\\n}\\r\\n.cb-item.selected,\\r\\n.cb-item:hover{\\r\\n    background: #e2e2e2;\\r\\n}\"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTgxLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vYXNzZXRzL2FwcC9zaGFyZWQvY29udHJvbHMvY29tYm9ib3guY29tcG9uZW50LmNzcz9mNTA1Il0sInNvdXJjZXNDb250ZW50IjpbIm1vZHVsZS5leHBvcnRzID0gXCIuY29tYm9ib3h7XFxyXFxuICAgIHBvc2l0aW9uOiByZWxhdGl2ZTtcXHJcXG4gICAgZmxvYXQ6IGxlZnQ7XFxyXFxufVxcclxcbi5jYi10cmlnZ2Vye1xcclxcbiAgICBwb3NpdGlvbjogcmVsYXRpdmU7XFxyXFxuICAgIHBhZGRpbmc6IDEwcHggMzBweCAxMHB4IDEwcHg7XFxyXFxuICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjYzNjM2MzO1xcclxcbiAgICBtaW4td2lkdGg6IDEyMHB4O1xcclxcbiAgICBib3gtc2l6aW5nOiBib3JkZXItYm94O1xcclxcbn1cXHJcXG4uY2ItdHJpZ2dlci5lbXB0eXtcXHJcXG4gICAgY29sb3I6ICNjY2NjY2M7XFxyXFxufVxcclxcbi5jYi10cmlnZ2VyIC5kb3duLWFycm93e1xcclxcbiAgICB3aWR0aDogMDtcXHJcXG4gICAgaGVpZ2h0OiAwO1xcclxcbiAgICBib3JkZXItbGVmdDogN3B4IHNvbGlkIHRyYW5zcGFyZW50O1xcclxcbiAgICBib3JkZXItcmlnaHQ6IDdweCBzb2xpZCB0cmFuc3BhcmVudDtcXHJcXG4gICAgYm9yZGVyLXRvcDogN3B4IHNvbGlkICNjM2MzYzM7XFxyXFxuICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcXHJcXG4gICAgcmlnaHQ6IDVweDtcXHJcXG4gICAgdG9wOiAxNnB4O1xcclxcbn1cXHJcXG4uY2ItaXRlbXN7XFxyXFxuICAgIHdpZHRoOiAxMDAlO1xcclxcbiAgICBtYXgtaGVpZ2h0OjIwMHB4O1xcclxcbiAgICBvdmVyZmxvdzogYXV0bztcXHJcXG4gICAgcG9zaXRpb246IGFic29sdXRlO1xcclxcbiAgICB0b3A6IDA7XFxyXFxuICAgIGJhY2tncm91bmQ6IHdoaXRlO1xcclxcbiAgICBsaXN0LXN0eWxlOiBub25lO1xcclxcbiAgICB6LWluZGV4OiAxNTtcXHJcXG4gICAgcGFkZGluZzowO1xcclxcbiAgICBtYXJnaW46IDA7XFxyXFxuICAgIGJveC1zaGFkb3c6IDAgMnB4IDJweCAwIHJnYmEoMCwwLDAsMC4xNCksMCAxcHggNXB4IDAgcmdiYSgwLDAsMCwwLjEyKSwwIDNweCAxcHggLTJweCByZ2JhKDAsMCwwLDAuMik7XFxyXFxufVxcclxcbi5jYi1pdGVte1xcclxcbiAgICBwYWRkaW5nOiAxMHB4O1xcclxcbiAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgZ3JheTtcXHJcXG4gICAgY3Vyc29yOiBwb2ludGVyO1xcclxcbn1cXHJcXG4uY2ItaXRlbS5zZWxlY3RlZCxcXHJcXG4uY2ItaXRlbTpob3ZlcntcXHJcXG4gICAgYmFja2dyb3VuZDogI2UyZTJlMjtcXHJcXG59XCJcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL2Fzc2V0cy9hcHAvc2hhcmVkL2NvbnRyb2xzL2NvbWJvYm94LmNvbXBvbmVudC5jc3Ncbi8vIG1vZHVsZSBpZCA9IDk4MVxuLy8gbW9kdWxlIGNodW5rcyA9IDAgMSAyIl0sIm1hcHBpbmdzIjoiQUFBQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ },

/***/ 982:
/***/ function(module, exports) {

eval("module.exports = \".uploader{\\r\\n    position: relative;\\r\\n    width: 500px;\\r\\n    height: 200px;\\r\\n    background: #93cac7;\\r\\n}\\r\\n\\r\\n.uploader .with-background{\\r\\n    width: 100%;\\r\\n    height: 100%;\\r\\n    background-size: contain !important;\\r\\n    background: no-repeat center;\\r\\n    position: relative;\\r\\n}\\r\\n\\r\\n.uploader .delete-image{\\r\\n    position: absolute;\\r\\n    width: 50px;\\r\\n    height: 50px;\\r\\n    background: red;\\r\\n    bottom: 20px;\\r\\n    right: 20px;\\r\\n}\\r\\n\\r\\n.uploader-zone{\\r\\n    width: 100%;\\r\\n    height: 100%;\\r\\n    display: flex;\\r\\n    justify-content:center;\\r\\n    align-items: center;\\r\\n    font-size: 30px;\\r\\n    color: #fff;\\r\\n    cursor: pointer;\\r\\n    padding: 20px;\\r\\n    box-sizing: border-box;\\r\\n}\\r\\n\\r\\n.uploader-zone.file-over{\\r\\n    background: blue;\\r\\n}\\r\\n\"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTgyLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vYXNzZXRzL2FwcC9zaGFyZWQvY29udHJvbHMvdXBsb2FkZXIvdXBsb2FkZXIuY29tcG9uZW50LmNzcz9hODJlIl0sInNvdXJjZXNDb250ZW50IjpbIm1vZHVsZS5leHBvcnRzID0gXCIudXBsb2FkZXJ7XFxyXFxuICAgIHBvc2l0aW9uOiByZWxhdGl2ZTtcXHJcXG4gICAgd2lkdGg6IDUwMHB4O1xcclxcbiAgICBoZWlnaHQ6IDIwMHB4O1xcclxcbiAgICBiYWNrZ3JvdW5kOiAjOTNjYWM3O1xcclxcbn1cXHJcXG5cXHJcXG4udXBsb2FkZXIgLndpdGgtYmFja2dyb3VuZHtcXHJcXG4gICAgd2lkdGg6IDEwMCU7XFxyXFxuICAgIGhlaWdodDogMTAwJTtcXHJcXG4gICAgYmFja2dyb3VuZC1zaXplOiBjb250YWluICFpbXBvcnRhbnQ7XFxyXFxuICAgIGJhY2tncm91bmQ6IG5vLXJlcGVhdCBjZW50ZXI7XFxyXFxuICAgIHBvc2l0aW9uOiByZWxhdGl2ZTtcXHJcXG59XFxyXFxuXFxyXFxuLnVwbG9hZGVyIC5kZWxldGUtaW1hZ2V7XFxyXFxuICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcXHJcXG4gICAgd2lkdGg6IDUwcHg7XFxyXFxuICAgIGhlaWdodDogNTBweDtcXHJcXG4gICAgYmFja2dyb3VuZDogcmVkO1xcclxcbiAgICBib3R0b206IDIwcHg7XFxyXFxuICAgIHJpZ2h0OiAyMHB4O1xcclxcbn1cXHJcXG5cXHJcXG4udXBsb2FkZXItem9uZXtcXHJcXG4gICAgd2lkdGg6IDEwMCU7XFxyXFxuICAgIGhlaWdodDogMTAwJTtcXHJcXG4gICAgZGlzcGxheTogZmxleDtcXHJcXG4gICAganVzdGlmeS1jb250ZW50OmNlbnRlcjtcXHJcXG4gICAgYWxpZ24taXRlbXM6IGNlbnRlcjtcXHJcXG4gICAgZm9udC1zaXplOiAzMHB4O1xcclxcbiAgICBjb2xvcjogI2ZmZjtcXHJcXG4gICAgY3Vyc29yOiBwb2ludGVyO1xcclxcbiAgICBwYWRkaW5nOiAyMHB4O1xcclxcbiAgICBib3gtc2l6aW5nOiBib3JkZXItYm94O1xcclxcbn1cXHJcXG5cXHJcXG4udXBsb2FkZXItem9uZS5maWxlLW92ZXJ7XFxyXFxuICAgIGJhY2tncm91bmQ6IGJsdWU7XFxyXFxufVxcclxcblwiXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9hc3NldHMvYXBwL3NoYXJlZC9jb250cm9scy91cGxvYWRlci91cGxvYWRlci5jb21wb25lbnQuY3NzXG4vLyBtb2R1bGUgaWQgPSA5ODJcbi8vIG1vZHVsZSBjaHVua3MgPSAwIDEgMiJdLCJtYXBwaW5ncyI6IkFBQUEiLCJzb3VyY2VSb290IjoiIn0=");

/***/ },

/***/ 990:
/***/ function(module, exports, __webpack_require__) {

"use strict";
eval("\"use strict\";\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nvar core_1 = __webpack_require__(1);\r\nvar AuthComponent = (function () {\r\n    function AuthComponent() {\r\n    }\r\n    AuthComponent = __decorate([\r\n        core_1.Component({\r\n            selector: 'dip-auth',\r\n            template: __webpack_require__(1036)\r\n        }), \r\n        __metadata('design:paramtypes', [])\r\n    ], AuthComponent);\r\n    return AuthComponent;\r\n}());\r\nexports.AuthComponent = AuthComponent;\r\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTkwLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vYXNzZXRzL2FwcC9hdXRoL2F1dGguY29tcG9uZW50LnRzP2ZkZWQiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XHJcbnZhciBfX2RlY29yYXRlID0gKHRoaXMgJiYgdGhpcy5fX2RlY29yYXRlKSB8fCBmdW5jdGlvbiAoZGVjb3JhdG9ycywgdGFyZ2V0LCBrZXksIGRlc2MpIHtcclxuICAgIHZhciBjID0gYXJndW1lbnRzLmxlbmd0aCwgciA9IGMgPCAzID8gdGFyZ2V0IDogZGVzYyA9PT0gbnVsbCA/IGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHRhcmdldCwga2V5KSA6IGRlc2MsIGQ7XHJcbiAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIFJlZmxlY3QuZGVjb3JhdGUgPT09IFwiZnVuY3Rpb25cIikgciA9IFJlZmxlY3QuZGVjb3JhdGUoZGVjb3JhdG9ycywgdGFyZ2V0LCBrZXksIGRlc2MpO1xyXG4gICAgZWxzZSBmb3IgKHZhciBpID0gZGVjb3JhdG9ycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgaWYgKGQgPSBkZWNvcmF0b3JzW2ldKSByID0gKGMgPCAzID8gZChyKSA6IGMgPiAzID8gZCh0YXJnZXQsIGtleSwgcikgOiBkKHRhcmdldCwga2V5KSkgfHwgcjtcclxuICAgIHJldHVybiBjID4gMyAmJiByICYmIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgciksIHI7XHJcbn07XHJcbnZhciBfX21ldGFkYXRhID0gKHRoaXMgJiYgdGhpcy5fX21ldGFkYXRhKSB8fCBmdW5jdGlvbiAoaywgdikge1xyXG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0Lm1ldGFkYXRhID09PSBcImZ1bmN0aW9uXCIpIHJldHVybiBSZWZsZWN0Lm1ldGFkYXRhKGssIHYpO1xyXG59O1xyXG52YXIgY29yZV8xID0gcmVxdWlyZShcIkBhbmd1bGFyL2NvcmVcIik7XHJcbnZhciBBdXRoQ29tcG9uZW50ID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIEF1dGhDb21wb25lbnQoKSB7XHJcbiAgICB9XHJcbiAgICBBdXRoQ29tcG9uZW50ID0gX19kZWNvcmF0ZShbXHJcbiAgICAgICAgY29yZV8xLkNvbXBvbmVudCh7XHJcbiAgICAgICAgICAgIHNlbGVjdG9yOiAnZGlwLWF1dGgnLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZTogcmVxdWlyZSgnLi9hdXRoLmNvbXBvbmVudC5odG1sJylcclxuICAgICAgICB9KSwgXHJcbiAgICAgICAgX19tZXRhZGF0YSgnZGVzaWduOnBhcmFtdHlwZXMnLCBbXSlcclxuICAgIF0sIEF1dGhDb21wb25lbnQpO1xyXG4gICAgcmV0dXJuIEF1dGhDb21wb25lbnQ7XHJcbn0oKSk7XHJcbmV4cG9ydHMuQXV0aENvbXBvbmVudCA9IEF1dGhDb21wb25lbnQ7XHJcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vYXNzZXRzL2FwcC9hdXRoL2F1dGguY29tcG9uZW50LnRzXG4vLyBtb2R1bGUgaWQgPSA5OTBcbi8vIG1vZHVsZSBjaHVua3MgPSAxIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9");

/***/ },

/***/ 991:
/***/ function(module, exports, __webpack_require__) {

"use strict";
eval("\"use strict\";\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nvar core_1 = __webpack_require__(1);\r\nvar forms_1 = __webpack_require__(417);\r\nvar router_1 = __webpack_require__(100);\r\nvar auth_service_1 = __webpack_require__(125);\r\nvar user_1 = __webpack_require__(993);\r\nvar error_service_1 = __webpack_require__(418);\r\nvar LoginComponent = (function () {\r\n    function LoginComponent(_fb, _authSvc, _router, _errorSvc) {\r\n        this._fb = _fb;\r\n        this._authSvc = _authSvc;\r\n        this._router = _router;\r\n        this._errorSvc = _errorSvc;\r\n    }\r\n    LoginComponent.prototype.ngOnInit = function () {\r\n        this.loginForm = this._fb.group({\r\n            email: ['', forms_1.Validators.compose([\r\n                    forms_1.Validators.required,\r\n                    this._authSvc.isEmail\r\n                ])],\r\n            password: ['', forms_1.Validators.required]\r\n        });\r\n    };\r\n    /**\r\n     * resolves the userId value so that the IDE doesnt mak it as unresolved (WebStorm IDE)\r\n     * @param data.userId   Information about the object's members.\r\n     */\r\n    LoginComponent.prototype.onSubmit = function () {\r\n        var _this = this;\r\n        var user = new user_1.User(this.loginForm.value.email, this.loginForm.value.password);\r\n        this._authSvc.onSignIn(user).subscribe(function (data) {\r\n            _this._router.navigateByUrl('/');\r\n        }, function (error) { return _this._errorSvc.handleError(error); });\r\n    };\r\n    LoginComponent = __decorate([\r\n        core_1.Component({\r\n            selector: 'dip-login',\r\n            template: __webpack_require__(1037)\r\n        }), \r\n        __metadata('design:paramtypes', [(typeof (_a = typeof forms_1.FormBuilder !== 'undefined' && forms_1.FormBuilder) === 'function' && _a) || Object, (typeof (_b = typeof auth_service_1.AuthService !== 'undefined' && auth_service_1.AuthService) === 'function' && _b) || Object, (typeof (_c = typeof router_1.Router !== 'undefined' && router_1.Router) === 'function' && _c) || Object, (typeof (_d = typeof error_service_1.ErrorService !== 'undefined' && error_service_1.ErrorService) === 'function' && _d) || Object])\r\n    ], LoginComponent);\r\n    return LoginComponent;\r\n    var _a, _b, _c, _d;\r\n}());\r\nexports.LoginComponent = LoginComponent;\r\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTkxLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vYXNzZXRzL2FwcC9hdXRoL2xvZ2luLmNvbXBvbmVudC50cz8xNjk1Il0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xyXG52YXIgX19kZWNvcmF0ZSA9ICh0aGlzICYmIHRoaXMuX19kZWNvcmF0ZSkgfHwgZnVuY3Rpb24gKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKSB7XHJcbiAgICB2YXIgYyA9IGFyZ3VtZW50cy5sZW5ndGgsIHIgPSBjIDwgMyA/IHRhcmdldCA6IGRlc2MgPT09IG51bGwgPyBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0YXJnZXQsIGtleSkgOiBkZXNjLCBkO1xyXG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0LmRlY29yYXRlID09PSBcImZ1bmN0aW9uXCIpIHIgPSBSZWZsZWN0LmRlY29yYXRlKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKTtcclxuICAgIGVsc2UgZm9yICh2YXIgaSA9IGRlY29yYXRvcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIGlmIChkID0gZGVjb3JhdG9yc1tpXSkgciA9IChjIDwgMyA/IGQocikgOiBjID4gMyA/IGQodGFyZ2V0LCBrZXksIHIpIDogZCh0YXJnZXQsIGtleSkpIHx8IHI7XHJcbiAgICByZXR1cm4gYyA+IDMgJiYgciAmJiBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHIpLCByO1xyXG59O1xyXG52YXIgX19tZXRhZGF0YSA9ICh0aGlzICYmIHRoaXMuX19tZXRhZGF0YSkgfHwgZnVuY3Rpb24gKGssIHYpIHtcclxuICAgIGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgUmVmbGVjdC5tZXRhZGF0YSA9PT0gXCJmdW5jdGlvblwiKSByZXR1cm4gUmVmbGVjdC5tZXRhZGF0YShrLCB2KTtcclxufTtcclxudmFyIGNvcmVfMSA9IHJlcXVpcmUoXCJAYW5ndWxhci9jb3JlXCIpO1xyXG52YXIgZm9ybXNfMSA9IHJlcXVpcmUoXCJAYW5ndWxhci9mb3Jtc1wiKTtcclxudmFyIHJvdXRlcl8xID0gcmVxdWlyZShcIkBhbmd1bGFyL3JvdXRlclwiKTtcclxudmFyIGF1dGhfc2VydmljZV8xID0gcmVxdWlyZShcIi4vYXV0aC5zZXJ2aWNlXCIpO1xyXG52YXIgdXNlcl8xID0gcmVxdWlyZShcIi4vdXNlclwiKTtcclxudmFyIGVycm9yX3NlcnZpY2VfMSA9IHJlcXVpcmUoXCIuLi9lcnJvci9lcnJvci5zZXJ2aWNlXCIpO1xyXG52YXIgTG9naW5Db21wb25lbnQgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gTG9naW5Db21wb25lbnQoX2ZiLCBfYXV0aFN2YywgX3JvdXRlciwgX2Vycm9yU3ZjKSB7XHJcbiAgICAgICAgdGhpcy5fZmIgPSBfZmI7XHJcbiAgICAgICAgdGhpcy5fYXV0aFN2YyA9IF9hdXRoU3ZjO1xyXG4gICAgICAgIHRoaXMuX3JvdXRlciA9IF9yb3V0ZXI7XHJcbiAgICAgICAgdGhpcy5fZXJyb3JTdmMgPSBfZXJyb3JTdmM7XHJcbiAgICB9XHJcbiAgICBMb2dpbkNvbXBvbmVudC5wcm90b3R5cGUubmdPbkluaXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhpcy5sb2dpbkZvcm0gPSB0aGlzLl9mYi5ncm91cCh7XHJcbiAgICAgICAgICAgIGVtYWlsOiBbJycsIGZvcm1zXzEuVmFsaWRhdG9ycy5jb21wb3NlKFtcclxuICAgICAgICAgICAgICAgICAgICBmb3Jtc18xLlZhbGlkYXRvcnMucmVxdWlyZWQsXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYXV0aFN2Yy5pc0VtYWlsXHJcbiAgICAgICAgICAgICAgICBdKV0sXHJcbiAgICAgICAgICAgIHBhc3N3b3JkOiBbJycsIGZvcm1zXzEuVmFsaWRhdG9ycy5yZXF1aXJlZF1cclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIHJlc29sdmVzIHRoZSB1c2VySWQgdmFsdWUgc28gdGhhdCB0aGUgSURFIGRvZXNudCBtYWsgaXQgYXMgdW5yZXNvbHZlZCAoV2ViU3Rvcm0gSURFKVxyXG4gICAgICogQHBhcmFtIGRhdGEudXNlcklkICAgSW5mb3JtYXRpb24gYWJvdXQgdGhlIG9iamVjdCdzIG1lbWJlcnMuXHJcbiAgICAgKi9cclxuICAgIExvZ2luQ29tcG9uZW50LnByb3RvdHlwZS5vblN1Ym1pdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHZhciB1c2VyID0gbmV3IHVzZXJfMS5Vc2VyKHRoaXMubG9naW5Gb3JtLnZhbHVlLmVtYWlsLCB0aGlzLmxvZ2luRm9ybS52YWx1ZS5wYXNzd29yZCk7XHJcbiAgICAgICAgdGhpcy5fYXV0aFN2Yy5vblNpZ25Jbih1c2VyKS5zdWJzY3JpYmUoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgX3RoaXMuX3JvdXRlci5uYXZpZ2F0ZUJ5VXJsKCcvJyk7XHJcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7IHJldHVybiBfdGhpcy5fZXJyb3JTdmMuaGFuZGxlRXJyb3IoZXJyb3IpOyB9KTtcclxuICAgIH07XHJcbiAgICBMb2dpbkNvbXBvbmVudCA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIGNvcmVfMS5Db21wb25lbnQoe1xyXG4gICAgICAgICAgICBzZWxlY3RvcjogJ2RpcC1sb2dpbicsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlOiByZXF1aXJlKCcuL2xvZ2luLmNvbXBvbmVudC5odG1sJylcclxuICAgICAgICB9KSwgXHJcbiAgICAgICAgX19tZXRhZGF0YSgnZGVzaWduOnBhcmFtdHlwZXMnLCBbKHR5cGVvZiAoX2EgPSB0eXBlb2YgZm9ybXNfMS5Gb3JtQnVpbGRlciAhPT0gJ3VuZGVmaW5lZCcgJiYgZm9ybXNfMS5Gb3JtQnVpbGRlcikgPT09ICdmdW5jdGlvbicgJiYgX2EpIHx8IE9iamVjdCwgKHR5cGVvZiAoX2IgPSB0eXBlb2YgYXV0aF9zZXJ2aWNlXzEuQXV0aFNlcnZpY2UgIT09ICd1bmRlZmluZWQnICYmIGF1dGhfc2VydmljZV8xLkF1dGhTZXJ2aWNlKSA9PT0gJ2Z1bmN0aW9uJyAmJiBfYikgfHwgT2JqZWN0LCAodHlwZW9mIChfYyA9IHR5cGVvZiByb3V0ZXJfMS5Sb3V0ZXIgIT09ICd1bmRlZmluZWQnICYmIHJvdXRlcl8xLlJvdXRlcikgPT09ICdmdW5jdGlvbicgJiYgX2MpIHx8IE9iamVjdCwgKHR5cGVvZiAoX2QgPSB0eXBlb2YgZXJyb3Jfc2VydmljZV8xLkVycm9yU2VydmljZSAhPT0gJ3VuZGVmaW5lZCcgJiYgZXJyb3Jfc2VydmljZV8xLkVycm9yU2VydmljZSkgPT09ICdmdW5jdGlvbicgJiYgX2QpIHx8IE9iamVjdF0pXHJcbiAgICBdLCBMb2dpbkNvbXBvbmVudCk7XHJcbiAgICByZXR1cm4gTG9naW5Db21wb25lbnQ7XHJcbiAgICB2YXIgX2EsIF9iLCBfYywgX2Q7XHJcbn0oKSk7XHJcbmV4cG9ydHMuTG9naW5Db21wb25lbnQgPSBMb2dpbkNvbXBvbmVudDtcclxuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9hc3NldHMvYXBwL2F1dGgvbG9naW4uY29tcG9uZW50LnRzXG4vLyBtb2R1bGUgaWQgPSA5OTFcbi8vIG1vZHVsZSBjaHVua3MgPSAxIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9");

/***/ },

/***/ 992:
/***/ function(module, exports, __webpack_require__) {

"use strict";
eval("\"use strict\";\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nvar core_1 = __webpack_require__(1);\r\nvar forms_1 = __webpack_require__(417);\r\nvar auth_service_1 = __webpack_require__(125);\r\nvar error_service_1 = __webpack_require__(418);\r\nvar user_1 = __webpack_require__(993);\r\nvar router_1 = __webpack_require__(100);\r\nvar SignupComponent = (function () {\r\n    function SignupComponent(_fb, _authSvc, _errorSvc, _router) {\r\n        this._fb = _fb;\r\n        this._authSvc = _authSvc;\r\n        this._errorSvc = _errorSvc;\r\n        this._router = _router;\r\n    }\r\n    ;\r\n    SignupComponent.prototype.ngOnInit = function () {\r\n        this.signUpForm = this._fb.group({\r\n            email: ['', forms_1.Validators.compose([\r\n                    forms_1.Validators.required,\r\n                    this._authSvc.isEmail\r\n                ])],\r\n            password: ['', forms_1.Validators.compose([\r\n                    forms_1.Validators.required,\r\n                    forms_1.Validators.minLength(6)\r\n                ])],\r\n            confirmPassword: ['', forms_1.Validators.compose([\r\n                    forms_1.Validators.required,\r\n                    this.isEqualPassword.bind(this)\r\n                ])],\r\n            firstName: ['', forms_1.Validators.required],\r\n            lastName: ['', forms_1.Validators.required]\r\n        });\r\n    };\r\n    SignupComponent.prototype.onSubmit = function () {\r\n        var _this = this;\r\n        this._authSvc.onSignUp(this.signUpForm.value).subscribe(function (data) {\r\n            //sign in after signup is done\r\n            var user = new user_1.User(_this.signUpForm.value.email, _this.signUpForm.value.password);\r\n            _this._authSvc.onSignIn(user).subscribe(function (data) {\r\n                _this._router.navigateByUrl('/');\r\n            }, function (error) { return _this._errorSvc.handleError(error); });\r\n        }, function (error) { return _this._errorSvc.handleError(error); });\r\n    };\r\n    SignupComponent.prototype.isEqualPassword = function (formControl) {\r\n        if (!this.signUpForm) {\r\n            return { noMatch: true };\r\n        }\r\n        if (formControl.value !== this.signUpForm.controls['password'].value) {\r\n            return { noMatch: true };\r\n        }\r\n    };\r\n    SignupComponent = __decorate([\r\n        core_1.Component({\r\n            selector: 'dip-signup',\r\n            template: __webpack_require__(1038)\r\n        }), \r\n        __metadata('design:paramtypes', [(typeof (_a = typeof forms_1.FormBuilder !== 'undefined' && forms_1.FormBuilder) === 'function' && _a) || Object, (typeof (_b = typeof auth_service_1.AuthService !== 'undefined' && auth_service_1.AuthService) === 'function' && _b) || Object, (typeof (_c = typeof error_service_1.ErrorService !== 'undefined' && error_service_1.ErrorService) === 'function' && _c) || Object, (typeof (_d = typeof router_1.Router !== 'undefined' && router_1.Router) === 'function' && _d) || Object])\r\n    ], SignupComponent);\r\n    return SignupComponent;\r\n    var _a, _b, _c, _d;\r\n}());\r\nexports.SignupComponent = SignupComponent;\r\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTkyLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vYXNzZXRzL2FwcC9hdXRoL3NpZ251cC5jb21wb25lbnQudHM/OTdhMSJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcclxudmFyIF9fZGVjb3JhdGUgPSAodGhpcyAmJiB0aGlzLl9fZGVjb3JhdGUpIHx8IGZ1bmN0aW9uIChkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYykge1xyXG4gICAgdmFyIGMgPSBhcmd1bWVudHMubGVuZ3RoLCByID0gYyA8IDMgPyB0YXJnZXQgOiBkZXNjID09PSBudWxsID8gZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGFyZ2V0LCBrZXkpIDogZGVzYywgZDtcclxuICAgIGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgUmVmbGVjdC5kZWNvcmF0ZSA9PT0gXCJmdW5jdGlvblwiKSByID0gUmVmbGVjdC5kZWNvcmF0ZShkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYyk7XHJcbiAgICBlbHNlIGZvciAodmFyIGkgPSBkZWNvcmF0b3JzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSBpZiAoZCA9IGRlY29yYXRvcnNbaV0pIHIgPSAoYyA8IDMgPyBkKHIpIDogYyA+IDMgPyBkKHRhcmdldCwga2V5LCByKSA6IGQodGFyZ2V0LCBrZXkpKSB8fCByO1xyXG4gICAgcmV0dXJuIGMgPiAzICYmIHIgJiYgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCByKSwgcjtcclxufTtcclxudmFyIF9fbWV0YWRhdGEgPSAodGhpcyAmJiB0aGlzLl9fbWV0YWRhdGEpIHx8IGZ1bmN0aW9uIChrLCB2KSB7XHJcbiAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIFJlZmxlY3QubWV0YWRhdGEgPT09IFwiZnVuY3Rpb25cIikgcmV0dXJuIFJlZmxlY3QubWV0YWRhdGEoaywgdik7XHJcbn07XHJcbnZhciBjb3JlXzEgPSByZXF1aXJlKFwiQGFuZ3VsYXIvY29yZVwiKTtcclxudmFyIGZvcm1zXzEgPSByZXF1aXJlKFwiQGFuZ3VsYXIvZm9ybXNcIik7XHJcbnZhciBhdXRoX3NlcnZpY2VfMSA9IHJlcXVpcmUoXCIuL2F1dGguc2VydmljZVwiKTtcclxudmFyIGVycm9yX3NlcnZpY2VfMSA9IHJlcXVpcmUoXCIuLi9lcnJvci9lcnJvci5zZXJ2aWNlXCIpO1xyXG52YXIgdXNlcl8xID0gcmVxdWlyZShcIi4vdXNlclwiKTtcclxudmFyIHJvdXRlcl8xID0gcmVxdWlyZShcIkBhbmd1bGFyL3JvdXRlclwiKTtcclxudmFyIFNpZ251cENvbXBvbmVudCA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBTaWdudXBDb21wb25lbnQoX2ZiLCBfYXV0aFN2YywgX2Vycm9yU3ZjLCBfcm91dGVyKSB7XHJcbiAgICAgICAgdGhpcy5fZmIgPSBfZmI7XHJcbiAgICAgICAgdGhpcy5fYXV0aFN2YyA9IF9hdXRoU3ZjO1xyXG4gICAgICAgIHRoaXMuX2Vycm9yU3ZjID0gX2Vycm9yU3ZjO1xyXG4gICAgICAgIHRoaXMuX3JvdXRlciA9IF9yb3V0ZXI7XHJcbiAgICB9XHJcbiAgICA7XHJcbiAgICBTaWdudXBDb21wb25lbnQucHJvdG90eXBlLm5nT25Jbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoaXMuc2lnblVwRm9ybSA9IHRoaXMuX2ZiLmdyb3VwKHtcclxuICAgICAgICAgICAgZW1haWw6IFsnJywgZm9ybXNfMS5WYWxpZGF0b3JzLmNvbXBvc2UoW1xyXG4gICAgICAgICAgICAgICAgICAgIGZvcm1zXzEuVmFsaWRhdG9ycy5yZXF1aXJlZCxcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9hdXRoU3ZjLmlzRW1haWxcclxuICAgICAgICAgICAgICAgIF0pXSxcclxuICAgICAgICAgICAgcGFzc3dvcmQ6IFsnJywgZm9ybXNfMS5WYWxpZGF0b3JzLmNvbXBvc2UoW1xyXG4gICAgICAgICAgICAgICAgICAgIGZvcm1zXzEuVmFsaWRhdG9ycy5yZXF1aXJlZCxcclxuICAgICAgICAgICAgICAgICAgICBmb3Jtc18xLlZhbGlkYXRvcnMubWluTGVuZ3RoKDYpXHJcbiAgICAgICAgICAgICAgICBdKV0sXHJcbiAgICAgICAgICAgIGNvbmZpcm1QYXNzd29yZDogWycnLCBmb3Jtc18xLlZhbGlkYXRvcnMuY29tcG9zZShbXHJcbiAgICAgICAgICAgICAgICAgICAgZm9ybXNfMS5WYWxpZGF0b3JzLnJlcXVpcmVkLFxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXNFcXVhbFBhc3N3b3JkLmJpbmQodGhpcylcclxuICAgICAgICAgICAgICAgIF0pXSxcclxuICAgICAgICAgICAgZmlyc3ROYW1lOiBbJycsIGZvcm1zXzEuVmFsaWRhdG9ycy5yZXF1aXJlZF0sXHJcbiAgICAgICAgICAgIGxhc3ROYW1lOiBbJycsIGZvcm1zXzEuVmFsaWRhdG9ycy5yZXF1aXJlZF1cclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBTaWdudXBDb21wb25lbnQucHJvdG90eXBlLm9uU3VibWl0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5fYXV0aFN2Yy5vblNpZ25VcCh0aGlzLnNpZ25VcEZvcm0udmFsdWUpLnN1YnNjcmliZShmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAvL3NpZ24gaW4gYWZ0ZXIgc2lnbnVwIGlzIGRvbmVcclxuICAgICAgICAgICAgdmFyIHVzZXIgPSBuZXcgdXNlcl8xLlVzZXIoX3RoaXMuc2lnblVwRm9ybS52YWx1ZS5lbWFpbCwgX3RoaXMuc2lnblVwRm9ybS52YWx1ZS5wYXNzd29yZCk7XHJcbiAgICAgICAgICAgIF90aGlzLl9hdXRoU3ZjLm9uU2lnbkluKHVzZXIpLnN1YnNjcmliZShmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgX3RoaXMuX3JvdXRlci5uYXZpZ2F0ZUJ5VXJsKCcvJyk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikgeyByZXR1cm4gX3RoaXMuX2Vycm9yU3ZjLmhhbmRsZUVycm9yKGVycm9yKTsgfSk7XHJcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7IHJldHVybiBfdGhpcy5fZXJyb3JTdmMuaGFuZGxlRXJyb3IoZXJyb3IpOyB9KTtcclxuICAgIH07XHJcbiAgICBTaWdudXBDb21wb25lbnQucHJvdG90eXBlLmlzRXF1YWxQYXNzd29yZCA9IGZ1bmN0aW9uIChmb3JtQ29udHJvbCkge1xyXG4gICAgICAgIGlmICghdGhpcy5zaWduVXBGb3JtKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7IG5vTWF0Y2g6IHRydWUgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGZvcm1Db250cm9sLnZhbHVlICE9PSB0aGlzLnNpZ25VcEZvcm0uY29udHJvbHNbJ3Bhc3N3b3JkJ10udmFsdWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHsgbm9NYXRjaDogdHJ1ZSB9O1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBTaWdudXBDb21wb25lbnQgPSBfX2RlY29yYXRlKFtcclxuICAgICAgICBjb3JlXzEuQ29tcG9uZW50KHtcclxuICAgICAgICAgICAgc2VsZWN0b3I6ICdkaXAtc2lnbnVwJyxcclxuICAgICAgICAgICAgdGVtcGxhdGU6IHJlcXVpcmUoJy4vc2lnbnVwLmNvbXBvbmVudC5odG1sJylcclxuICAgICAgICB9KSwgXHJcbiAgICAgICAgX19tZXRhZGF0YSgnZGVzaWduOnBhcmFtdHlwZXMnLCBbKHR5cGVvZiAoX2EgPSB0eXBlb2YgZm9ybXNfMS5Gb3JtQnVpbGRlciAhPT0gJ3VuZGVmaW5lZCcgJiYgZm9ybXNfMS5Gb3JtQnVpbGRlcikgPT09ICdmdW5jdGlvbicgJiYgX2EpIHx8IE9iamVjdCwgKHR5cGVvZiAoX2IgPSB0eXBlb2YgYXV0aF9zZXJ2aWNlXzEuQXV0aFNlcnZpY2UgIT09ICd1bmRlZmluZWQnICYmIGF1dGhfc2VydmljZV8xLkF1dGhTZXJ2aWNlKSA9PT0gJ2Z1bmN0aW9uJyAmJiBfYikgfHwgT2JqZWN0LCAodHlwZW9mIChfYyA9IHR5cGVvZiBlcnJvcl9zZXJ2aWNlXzEuRXJyb3JTZXJ2aWNlICE9PSAndW5kZWZpbmVkJyAmJiBlcnJvcl9zZXJ2aWNlXzEuRXJyb3JTZXJ2aWNlKSA9PT0gJ2Z1bmN0aW9uJyAmJiBfYykgfHwgT2JqZWN0LCAodHlwZW9mIChfZCA9IHR5cGVvZiByb3V0ZXJfMS5Sb3V0ZXIgIT09ICd1bmRlZmluZWQnICYmIHJvdXRlcl8xLlJvdXRlcikgPT09ICdmdW5jdGlvbicgJiYgX2QpIHx8IE9iamVjdF0pXHJcbiAgICBdLCBTaWdudXBDb21wb25lbnQpO1xyXG4gICAgcmV0dXJuIFNpZ251cENvbXBvbmVudDtcclxuICAgIHZhciBfYSwgX2IsIF9jLCBfZDtcclxufSgpKTtcclxuZXhwb3J0cy5TaWdudXBDb21wb25lbnQgPSBTaWdudXBDb21wb25lbnQ7XHJcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vYXNzZXRzL2FwcC9hdXRoL3NpZ251cC5jb21wb25lbnQudHNcbi8vIG1vZHVsZSBpZCA9IDk5MlxuLy8gbW9kdWxlIGNodW5rcyA9IDEiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9");

/***/ },

/***/ 993:
/***/ function(module, exports) {

"use strict";
eval("\"use strict\";\r\nvar User = (function () {\r\n    function User(email, password, firstName, lastName, role, solutions, allowed_solutions) {\r\n        this.email = email;\r\n        this.password = password;\r\n        this.firstName = firstName;\r\n        this.lastName = lastName;\r\n        this.role = role;\r\n        this.solutions = solutions;\r\n        this.allowed_solutions = allowed_solutions;\r\n    }\r\n    return User;\r\n}());\r\nexports.User = User;\r\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTkzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vYXNzZXRzL2FwcC9hdXRoL3VzZXIudHM/ODNiMCJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcclxudmFyIFVzZXIgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gVXNlcihlbWFpbCwgcGFzc3dvcmQsIGZpcnN0TmFtZSwgbGFzdE5hbWUsIHJvbGUsIHNvbHV0aW9ucywgYWxsb3dlZF9zb2x1dGlvbnMpIHtcclxuICAgICAgICB0aGlzLmVtYWlsID0gZW1haWw7XHJcbiAgICAgICAgdGhpcy5wYXNzd29yZCA9IHBhc3N3b3JkO1xyXG4gICAgICAgIHRoaXMuZmlyc3ROYW1lID0gZmlyc3ROYW1lO1xyXG4gICAgICAgIHRoaXMubGFzdE5hbWUgPSBsYXN0TmFtZTtcclxuICAgICAgICB0aGlzLnJvbGUgPSByb2xlO1xyXG4gICAgICAgIHRoaXMuc29sdXRpb25zID0gc29sdXRpb25zO1xyXG4gICAgICAgIHRoaXMuYWxsb3dlZF9zb2x1dGlvbnMgPSBhbGxvd2VkX3NvbHV0aW9ucztcclxuICAgIH1cclxuICAgIHJldHVybiBVc2VyO1xyXG59KCkpO1xyXG5leHBvcnRzLlVzZXIgPSBVc2VyO1xyXG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL2Fzc2V0cy9hcHAvYXV0aC91c2VyLnRzXG4vLyBtb2R1bGUgaWQgPSA5OTNcbi8vIG1vZHVsZSBjaHVua3MgPSAxIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }

});